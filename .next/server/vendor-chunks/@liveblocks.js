"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@liveblocks";
exports.ids = ["vendor-chunks/@liveblocks"];
exports.modules = {

/***/ "(ssr)/./node_modules/@liveblocks/core/dist/index.mjs":
/*!******************************************************!*\
  !*** ./node_modules/@liveblocks/core/dist/index.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ClientMsgCode: () => (/* binding */ ClientMsgCode),\n/* harmony export */   CommentsApiError: () => (/* binding */ CommentsApiError),\n/* harmony export */   CrdtType: () => (/* binding */ CrdtType),\n/* harmony export */   LiveList: () => (/* binding */ LiveList),\n/* harmony export */   LiveMap: () => (/* binding */ LiveMap),\n/* harmony export */   LiveObject: () => (/* binding */ LiveObject),\n/* harmony export */   NotificationsApiError: () => (/* binding */ NotificationsApiError),\n/* harmony export */   OpCode: () => (/* binding */ OpCode),\n/* harmony export */   ServerMsgCode: () => (/* binding */ ServerMsgCode),\n/* harmony export */   WebsocketCloseCodes: () => (/* binding */ WebsocketCloseCodes),\n/* harmony export */   ackOp: () => (/* binding */ ackOp),\n/* harmony export */   addReaction: () => (/* binding */ addReaction),\n/* harmony export */   applyOptimisticUpdates: () => (/* binding */ applyOptimisticUpdates),\n/* harmony export */   asPos: () => (/* binding */ asPos),\n/* harmony export */   assert: () => (/* binding */ assert),\n/* harmony export */   assertNever: () => (/* binding */ assertNever),\n/* harmony export */   b64decode: () => (/* binding */ b64decode),\n/* harmony export */   cloneLson: () => (/* binding */ cloneLson),\n/* harmony export */   console: () => (/* binding */ fancy_console_exports),\n/* harmony export */   convertToCommentData: () => (/* binding */ convertToCommentData),\n/* harmony export */   convertToCommentUserReaction: () => (/* binding */ convertToCommentUserReaction),\n/* harmony export */   convertToInboxNotificationData: () => (/* binding */ convertToInboxNotificationData),\n/* harmony export */   convertToThreadData: () => (/* binding */ convertToThreadData),\n/* harmony export */   createClient: () => (/* binding */ createClient),\n/* harmony export */   createCommentId: () => (/* binding */ createCommentId),\n/* harmony export */   createInboxNotificationId: () => (/* binding */ createInboxNotificationId),\n/* harmony export */   createThreadId: () => (/* binding */ createThreadId),\n/* harmony export */   deleteComment: () => (/* binding */ deleteComment),\n/* harmony export */   deprecate: () => (/* binding */ deprecate),\n/* harmony export */   deprecateIf: () => (/* binding */ deprecateIf),\n/* harmony export */   detectDupes: () => (/* binding */ detectDupes),\n/* harmony export */   errorIf: () => (/* binding */ errorIf),\n/* harmony export */   freeze: () => (/* binding */ freeze),\n/* harmony export */   getMentionedIdsFromCommentBody: () => (/* binding */ getMentionedIdsFromCommentBody),\n/* harmony export */   isChildCrdt: () => (/* binding */ isChildCrdt),\n/* harmony export */   isJsonArray: () => (/* binding */ isJsonArray),\n/* harmony export */   isJsonObject: () => (/* binding */ isJsonObject),\n/* harmony export */   isJsonScalar: () => (/* binding */ isJsonScalar),\n/* harmony export */   isLiveNode: () => (/* binding */ isLiveNode),\n/* harmony export */   isPlainObject: () => (/* binding */ isPlainObject),\n/* harmony export */   isRootCrdt: () => (/* binding */ isRootCrdt),\n/* harmony export */   kInternal: () => (/* binding */ kInternal),\n/* harmony export */   legacy_patchImmutableObject: () => (/* binding */ legacy_patchImmutableObject),\n/* harmony export */   lsonToJson: () => (/* binding */ lsonToJson),\n/* harmony export */   makeEventSource: () => (/* binding */ makeEventSource),\n/* harmony export */   makePoller: () => (/* binding */ makePoller),\n/* harmony export */   makePosition: () => (/* binding */ makePosition),\n/* harmony export */   memoizeOnSuccess: () => (/* binding */ memoizeOnSuccess),\n/* harmony export */   nanoid: () => (/* binding */ nanoid),\n/* harmony export */   nn: () => (/* binding */ nn),\n/* harmony export */   objectToQuery: () => (/* binding */ objectToQuery),\n/* harmony export */   patchLiveObjectKey: () => (/* binding */ patchLiveObjectKey),\n/* harmony export */   raise: () => (/* binding */ raise),\n/* harmony export */   removeReaction: () => (/* binding */ removeReaction),\n/* harmony export */   shallow: () => (/* binding */ shallow),\n/* harmony export */   stringify: () => (/* binding */ stringify),\n/* harmony export */   stringifyCommentBody: () => (/* binding */ stringifyCommentBody),\n/* harmony export */   throwUsageError: () => (/* binding */ throwUsageError),\n/* harmony export */   toPlainLson: () => (/* binding */ toPlainLson),\n/* harmony export */   tryParseJson: () => (/* binding */ tryParseJson),\n/* harmony export */   upsertComment: () => (/* binding */ upsertComment),\n/* harmony export */   wait: () => (/* binding */ wait),\n/* harmony export */   withTimeout: () => (/* binding */ withTimeout)\n/* harmony export */ });\nvar __defProp = Object.defineProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\n\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/core\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/dupe-detection.ts\nvar g = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : {};\nvar crossLinkedDocs = \"https://liveblocks.io/docs/errors/cross-linked\";\nvar dupesDocs = \"https://liveblocks.io/docs/errors/dupes\";\nvar SPACE = \" \";\nfunction error(msg) {\n  if (false) {} else {\n    throw new Error(msg);\n  }\n}\nfunction detectDupes(pkgName, pkgVersion, pkgFormat) {\n  const pkgId = Symbol.for(pkgName);\n  const pkgBuildInfo = pkgFormat ? `${pkgVersion || \"dev\"} (${pkgFormat})` : pkgVersion || \"dev\";\n  if (!g[pkgId]) {\n    g[pkgId] = pkgBuildInfo;\n  } else if (g[pkgId] === pkgBuildInfo) {\n  } else {\n    const msg = [\n      `Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See ${dupesDocs + SPACE}`,\n      \"\",\n      \"Conflicts:\",\n      `- ${pkgName} ${g[pkgId]} (already loaded)`,\n      `- ${pkgName} ${pkgBuildInfo} (trying to load this now)`\n    ].join(\"\\n\");\n    error(msg);\n  }\n  if (pkgVersion && PKG_VERSION && pkgVersion !== PKG_VERSION) {\n    error(\n      [\n        `Cross-linked versions of Liveblocks found, which will cause issues! See ${crossLinkedDocs + SPACE}`,\n        \"\",\n        \"Conflicts:\",\n        `- ${PKG_NAME} is at ${PKG_VERSION}`,\n        `- ${pkgName} is at ${pkgVersion}`,\n        \"\",\n        \"Always upgrade all Liveblocks packages to the same version number.\"\n      ].join(\"\\n\")\n    );\n  }\n}\n\n// src/lib/assert.ts\nfunction assertNever(_value, errmsg) {\n  throw new Error(errmsg);\n}\nfunction assert(condition, errmsg) {\n  if (true) {\n    if (!condition) {\n      const err = new Error(errmsg);\n      err.name = \"Assertion failure\";\n      throw err;\n    }\n  }\n}\nfunction nn(value, errmsg = \"Expected value to be non-nullable\") {\n  assert(value !== null && value !== void 0, errmsg);\n  return value;\n}\n\n// src/lib/controlledPromise.ts\nfunction controlledPromise() {\n  let resolve;\n  let reject;\n  const promise = new Promise((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  return [promise, resolve, reject];\n}\nfunction Promise_withResolvers() {\n  const [promise, resolve, reject] = controlledPromise();\n  return { promise, resolve, reject };\n}\n\n// src/lib/EventSource.ts\nfunction makeEventSource() {\n  const _onetimeObservers = /* @__PURE__ */ new Set();\n  const _observers = /* @__PURE__ */ new Set();\n  let _buffer = null;\n  function pause() {\n    _buffer = [];\n  }\n  function unpause() {\n    if (_buffer === null) {\n      return;\n    }\n    for (const event of _buffer) {\n      notify(event);\n    }\n    _buffer = null;\n  }\n  function subscribe(callback) {\n    _observers.add(callback);\n    return () => _observers.delete(callback);\n  }\n  function subscribeOnce(callback) {\n    _onetimeObservers.add(callback);\n    return () => _onetimeObservers.delete(callback);\n  }\n  async function waitUntil(predicate) {\n    let unsub;\n    return new Promise((res) => {\n      unsub = subscribe((event) => {\n        if (predicate === void 0 || predicate(event)) {\n          res(event);\n        }\n      });\n    }).finally(() => unsub?.());\n  }\n  function notifyOrBuffer(event) {\n    if (_buffer !== null) {\n      _buffer.push(event);\n    } else {\n      notify(event);\n    }\n  }\n  function notify(event) {\n    _onetimeObservers.forEach((callback) => callback(event));\n    _onetimeObservers.clear();\n    _observers.forEach((callback) => callback(event));\n  }\n  function clear() {\n    _onetimeObservers.clear();\n    _observers.clear();\n  }\n  function count() {\n    return _onetimeObservers.size + _observers.size;\n  }\n  return {\n    // Private/internal control over event emission\n    notify: notifyOrBuffer,\n    subscribe,\n    subscribeOnce,\n    clear,\n    count,\n    waitUntil,\n    pause,\n    unpause,\n    // Publicly exposable subscription API\n    observable: {\n      subscribe,\n      subscribeOnce,\n      waitUntil\n    }\n  };\n}\n\n// src/lib/fancy-console.ts\nvar fancy_console_exports = {};\n__export(fancy_console_exports, {\n  error: () => error2,\n  errorWithTitle: () => errorWithTitle,\n  warn: () => warn,\n  warnWithTitle: () => warnWithTitle\n});\nvar badge = \"background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;\";\nvar bold = \"font-weight:600\";\nfunction wrap(method) {\n  return typeof window === \"undefined\" || \"development\" === \"test\" ? console[method] : (\n    /* istanbul ignore next */\n    (message, ...args) => console[method](\"%cLiveblocks\", badge, message, ...args)\n  );\n}\nvar warn = wrap(\"warn\");\nvar error2 = wrap(\"error\");\nfunction wrapWithTitle(method) {\n  return typeof window === \"undefined\" || \"development\" === \"test\" ? console[method] : (\n    /* istanbul ignore next */\n    (title, message, ...args) => console[method](\n      `%cLiveblocks%c ${title}`,\n      badge,\n      bold,\n      message,\n      ...args\n    )\n  );\n}\nvar warnWithTitle = wrapWithTitle(\"warn\");\nvar errorWithTitle = wrapWithTitle(\"error\");\n\n// src/lib/fsm.ts\nfunction distance(state1, state2) {\n  if (state1 === state2) {\n    return [0, 0];\n  }\n  const chunks1 = state1.split(\".\");\n  const chunks2 = state2.split(\".\");\n  const minLen = Math.min(chunks1.length, chunks2.length);\n  let shared = 0;\n  for (; shared < minLen; shared++) {\n    if (chunks1[shared] !== chunks2[shared]) {\n      break;\n    }\n  }\n  const up = chunks1.length - shared;\n  const down = chunks2.length - shared;\n  return [up, down];\n}\nfunction patterns(targetState, levels) {\n  const parts = targetState.split(\".\");\n  if (levels < 1 || levels > parts.length + 1) {\n    throw new Error(\"Invalid number of levels\");\n  }\n  const result = [];\n  if (levels > parts.length) {\n    result.push(\"*\");\n  }\n  for (let i = parts.length - levels + 1; i < parts.length; i++) {\n    const slice = parts.slice(0, i);\n    if (slice.length > 0) {\n      result.push(slice.join(\".\") + \".*\");\n    }\n  }\n  result.push(targetState);\n  return result;\n}\nvar SafeContext = class {\n  constructor(initialContext) {\n    this.curr = initialContext;\n  }\n  get current() {\n    return this.curr;\n  }\n  /**\n   * Call a callback function that allows patching of the context, by\n   * calling `context.patch()`. Patching is only allowed for the duration\n   * of this window.\n   */\n  allowPatching(callback) {\n    const self = this;\n    let allowed = true;\n    const patchableContext = {\n      ...this.curr,\n      patch(patch) {\n        if (allowed) {\n          self.curr = Object.assign({}, self.curr, patch);\n          for (const pair of Object.entries(patch)) {\n            const [key, value] = pair;\n            if (key !== \"patch\") {\n              this[key] = value;\n            }\n          }\n        } else {\n          throw new Error(\"Can no longer patch stale context\");\n        }\n      }\n    };\n    callback(patchableContext);\n    allowed = false;\n    return;\n  }\n};\nvar nextId = 1;\nvar FSM = class {\n  /**\n   * Returns the initial state, which is defined by the first call made to\n   * .addState().\n   */\n  get initialState() {\n    const result = this.states.values()[Symbol.iterator]().next();\n    if (result.done) {\n      throw new Error(\"No states defined yet\");\n    } else {\n      return result.value;\n    }\n  }\n  get currentState() {\n    if (this.currentStateOrNull === null) {\n      if (this.runningState === 0 /* NOT_STARTED_YET */) {\n        throw new Error(\"Not started yet\");\n      } else {\n        throw new Error(\"Already stopped\");\n      }\n    }\n    return this.currentStateOrNull;\n  }\n  /**\n   * Starts the machine by entering the initial state.\n   */\n  start() {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"State machine has already started\");\n    }\n    this.runningState = 1 /* STARTED */;\n    this.currentStateOrNull = this.initialState;\n    this.enter(null);\n    return this;\n  }\n  /**\n   * Stops the state machine. Stopping the state machine will call exit\n   * handlers for the current state, but not enter a new state.\n   */\n  stop() {\n    if (this.runningState !== 1 /* STARTED */) {\n      throw new Error(\"Cannot stop a state machine that hasn't started yet\");\n    }\n    this.exit(null);\n    this.runningState = 2 /* STOPPED */;\n    this.currentStateOrNull = null;\n  }\n  constructor(initialContext) {\n    this.id = nextId++;\n    this.runningState = 0 /* NOT_STARTED_YET */;\n    this.currentStateOrNull = null;\n    this.states = /* @__PURE__ */ new Set();\n    this.enterFns = /* @__PURE__ */ new Map();\n    this.cleanupStack = [];\n    this.knownEventTypes = /* @__PURE__ */ new Set();\n    this.allowedTransitions = /* @__PURE__ */ new Map();\n    this.currentContext = new SafeContext(initialContext);\n    this.eventHub = {\n      didReceiveEvent: makeEventSource(),\n      willTransition: makeEventSource(),\n      didIgnoreEvent: makeEventSource(),\n      willExitState: makeEventSource(),\n      didEnterState: makeEventSource()\n    };\n    this.events = {\n      didReceiveEvent: this.eventHub.didReceiveEvent.observable,\n      willTransition: this.eventHub.willTransition.observable,\n      didIgnoreEvent: this.eventHub.didIgnoreEvent.observable,\n      willExitState: this.eventHub.willExitState.observable,\n      didEnterState: this.eventHub.didEnterState.observable\n    };\n  }\n  get context() {\n    return this.currentContext.current;\n  }\n  /**\n   * Define an explicit finite state in the state machine.\n   */\n  addState(state) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    }\n    this.states.add(state);\n    return this;\n  }\n  onEnter(nameOrPattern, enterFn) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    } else if (this.enterFns.has(nameOrPattern)) {\n      throw new Error(\n        // TODO We _currently_ don't support multiple .onEnters() for the same\n        // state, but this is not a fundamental limitation. Just not\n        // implemented yet. If we wanted to, we could make this an array.\n        `enter/exit function for ${nameOrPattern} already exists`\n      );\n    }\n    this.enterFns.set(nameOrPattern, enterFn);\n    return this;\n  }\n  onEnterAsync(nameOrPattern, promiseFn, onOK, onError) {\n    return this.onEnter(nameOrPattern, () => {\n      const abortController = new AbortController();\n      const signal = abortController.signal;\n      let done = false;\n      void promiseFn(this.currentContext.current, signal).then(\n        // On OK\n        (data) => {\n          if (!signal.aborted) {\n            done = true;\n            this.transition({ type: \"ASYNC_OK\", data }, onOK);\n          }\n        },\n        // On Error\n        (reason) => {\n          if (!signal.aborted) {\n            done = true;\n            this.transition({ type: \"ASYNC_ERROR\", reason }, onError);\n          }\n        }\n      );\n      return () => {\n        if (!done) {\n          abortController.abort();\n        }\n      };\n    });\n  }\n  getStatesMatching(nameOrPattern) {\n    const matches = [];\n    if (nameOrPattern === \"*\") {\n      for (const state of this.states) {\n        matches.push(state);\n      }\n    } else if (nameOrPattern.endsWith(\".*\")) {\n      const prefix = nameOrPattern.slice(0, -1);\n      for (const state of this.states) {\n        if (state.startsWith(prefix)) {\n          matches.push(state);\n        }\n      }\n    } else {\n      const name = nameOrPattern;\n      if (this.states.has(name)) {\n        matches.push(name);\n      }\n    }\n    if (matches.length === 0) {\n      throw new Error(`No states match ${JSON.stringify(nameOrPattern)}`);\n    }\n    return matches;\n  }\n  /**\n   * Define all allowed outgoing transitions for a state.\n   *\n   * The targets for each event can be defined as a function which returns the\n   * next state to transition to. These functions can look at the `event` or\n   * `context` params to conditionally decide which next state to transition\n   * to.\n   *\n   * If you set it to `null`, then the transition will be explicitly forbidden\n   * and throw an error. If you don't define a target for a transition, then\n   * such events will get ignored.\n   */\n  addTransitions(nameOrPattern, mapping) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    }\n    for (const srcState of this.getStatesMatching(nameOrPattern)) {\n      let map = this.allowedTransitions.get(srcState);\n      if (map === void 0) {\n        map = /* @__PURE__ */ new Map();\n        this.allowedTransitions.set(srcState, map);\n      }\n      for (const [type, target_] of Object.entries(mapping)) {\n        if (map.has(type)) {\n          throw new Error(\n            `Trying to set transition \"${type}\" on \"${srcState}\" (via \"${nameOrPattern}\"), but a transition already exists there.`\n          );\n        }\n        const target = target_;\n        this.knownEventTypes.add(type);\n        if (target !== void 0) {\n          const targetFn = typeof target === \"function\" ? target : () => target;\n          map.set(type, targetFn);\n        }\n      }\n    }\n    return this;\n  }\n  /**\n   * Like `.addTransition()`, but takes an (anonymous) transition whenever the\n   * timer fires.\n   *\n   * @param stateOrPattern The state name, or state group pattern name.\n   * @param after          Number of milliseconds after which to take the\n   *                       transition. If in the mean time, another transition\n   *                       is taken, the timer will get cancelled.\n   * @param target     The target state to go to.\n   */\n  addTimedTransition(stateOrPattern, after2, target) {\n    return this.onEnter(stateOrPattern, () => {\n      const ms = typeof after2 === \"function\" ? after2(this.currentContext.current) : after2;\n      const timeoutID = setTimeout(() => {\n        this.transition({ type: \"TIMER\" }, target);\n      }, ms);\n      return () => {\n        clearTimeout(timeoutID);\n      };\n    });\n  }\n  getTargetFn(eventName) {\n    return this.allowedTransitions.get(this.currentState)?.get(eventName);\n  }\n  /**\n   * Exits the current state, and executes any necessary cleanup functions.\n   * Call this before changing the current state to the next state.\n   *\n   * @param levels Defines how many \"levels\" of nesting will be\n   * exited. For example, if you transition from `foo.bar.qux` to\n   * `foo.bar.baz`, then the level is 1. But if you transition from\n   * `foo.bar.qux` to `bla.bla`, then the level is 3.\n   * If `null`, it will exit all levels.\n   */\n  exit(levels) {\n    this.eventHub.willExitState.notify(this.currentState);\n    this.currentContext.allowPatching((patchableContext) => {\n      levels = levels ?? this.cleanupStack.length;\n      for (let i = 0; i < levels; i++) {\n        this.cleanupStack.pop()?.(patchableContext);\n      }\n    });\n  }\n  /**\n   * Enters the current state, and executes any necessary onEnter handlers.\n   * Call this directly _after_ setting the current state to the next state.\n   */\n  enter(levels) {\n    const enterPatterns = patterns(\n      this.currentState,\n      levels ?? this.currentState.split(\".\").length + 1\n    );\n    this.currentContext.allowPatching((patchableContext) => {\n      for (const pattern of enterPatterns) {\n        const enterFn = this.enterFns.get(pattern);\n        const cleanupFn = enterFn?.(patchableContext);\n        if (typeof cleanupFn === \"function\") {\n          this.cleanupStack.push(cleanupFn);\n        } else {\n          this.cleanupStack.push(null);\n        }\n      }\n    });\n    this.eventHub.didEnterState.notify(this.currentState);\n  }\n  /**\n   * Sends an event to the machine, which may cause an internal state\n   * transition to happen. When that happens, will trigger side effects.\n   */\n  send(event) {\n    if (!this.knownEventTypes.has(event.type)) {\n      throw new Error(`Invalid event ${JSON.stringify(event.type)}`);\n    }\n    if (this.runningState === 2 /* STOPPED */) {\n      return;\n    }\n    const targetFn = this.getTargetFn(event.type);\n    if (targetFn !== void 0) {\n      return this.transition(event, targetFn);\n    } else {\n      this.eventHub.didIgnoreEvent.notify(event);\n    }\n  }\n  transition(event, target) {\n    this.eventHub.didReceiveEvent.notify(event);\n    const oldState = this.currentState;\n    const targetFn = typeof target === \"function\" ? target : () => target;\n    const nextTarget = targetFn(event, this.currentContext.current);\n    let nextState;\n    let effects = void 0;\n    if (nextTarget === null) {\n      this.eventHub.didIgnoreEvent.notify(event);\n      return;\n    }\n    if (typeof nextTarget === \"string\") {\n      nextState = nextTarget;\n    } else {\n      nextState = nextTarget.target;\n      effects = Array.isArray(nextTarget.effect) ? nextTarget.effect : [nextTarget.effect];\n    }\n    if (!this.states.has(nextState)) {\n      throw new Error(`Invalid next state name: ${JSON.stringify(nextState)}`);\n    }\n    this.eventHub.willTransition.notify({ from: oldState, to: nextState });\n    const [up, down] = distance(this.currentState, nextState);\n    if (up > 0) {\n      this.exit(up);\n    }\n    this.currentStateOrNull = nextState;\n    if (effects !== void 0) {\n      const effectsToRun = effects;\n      this.currentContext.allowPatching((patchableContext) => {\n        for (const effect of effectsToRun) {\n          if (typeof effect === \"function\") {\n            effect(patchableContext, event);\n          } else {\n            patchableContext.patch(effect);\n          }\n        }\n      });\n    }\n    if (down > 0) {\n      this.enter(down);\n    }\n  }\n};\n\n// src/lib/utils.ts\nfunction raise(msg) {\n  throw new Error(msg);\n}\nfunction isPlainObject(blob) {\n  return blob !== null && typeof blob === \"object\" && Object.prototype.toString.call(blob) === \"[object Object]\";\n}\nfunction entries(obj) {\n  return Object.entries(obj);\n}\nfunction tryParseJson(rawMessage) {\n  try {\n    return JSON.parse(rawMessage);\n  } catch (e) {\n    return void 0;\n  }\n}\nfunction deepClone(value) {\n  return JSON.parse(JSON.stringify(value));\n}\nfunction b64decode(b64value) {\n  try {\n    const formattedValue = b64value.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const decodedValue = decodeURIComponent(\n      atob(formattedValue).split(\"\").map(function(c) {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(\"\")\n    );\n    return decodedValue;\n  } catch (err) {\n    return atob(b64value);\n  }\n}\nfunction compact(items) {\n  return items.filter(\n    (item) => item !== null && item !== void 0\n  );\n}\nfunction compactObject(obj) {\n  const newObj = { ...obj };\n  Object.keys(obj).forEach((k) => {\n    const key = k;\n    if (newObj[key] === void 0) {\n      delete newObj[key];\n    }\n  });\n  return newObj;\n}\nfunction wait(millis) {\n  return new Promise((res) => setTimeout(res, millis));\n}\nasync function withTimeout(promise, millis, errmsg) {\n  let timerID;\n  const timer$ = new Promise((_, reject) => {\n    timerID = setTimeout(() => {\n      reject(new Error(errmsg));\n    }, millis);\n  });\n  return Promise.race([promise, timer$]).finally(() => clearTimeout(timerID));\n}\nfunction memoizeOnSuccess(factoryFn) {\n  let cached = null;\n  return () => {\n    if (cached === null) {\n      cached = factoryFn().catch((err) => {\n        setTimeout(() => {\n          cached = null;\n        }, 5e3);\n        throw err;\n      });\n    }\n    return cached;\n  };\n}\n\n// src/protocol/ServerMsg.ts\nvar ServerMsgCode = /* @__PURE__ */ ((ServerMsgCode2) => {\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_PRESENCE\"] = 100] = \"UPDATE_PRESENCE\";\n  ServerMsgCode2[ServerMsgCode2[\"USER_JOINED\"] = 101] = \"USER_JOINED\";\n  ServerMsgCode2[ServerMsgCode2[\"USER_LEFT\"] = 102] = \"USER_LEFT\";\n  ServerMsgCode2[ServerMsgCode2[\"BROADCASTED_EVENT\"] = 103] = \"BROADCASTED_EVENT\";\n  ServerMsgCode2[ServerMsgCode2[\"ROOM_STATE\"] = 104] = \"ROOM_STATE\";\n  ServerMsgCode2[ServerMsgCode2[\"INITIAL_STORAGE_STATE\"] = 200] = \"INITIAL_STORAGE_STATE\";\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_STORAGE\"] = 201] = \"UPDATE_STORAGE\";\n  ServerMsgCode2[ServerMsgCode2[\"REJECT_STORAGE_OP\"] = 299] = \"REJECT_STORAGE_OP\";\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_YDOC\"] = 300] = \"UPDATE_YDOC\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_CREATED\"] = 400] = \"THREAD_CREATED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_DELETED\"] = 407] = \"THREAD_DELETED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_METADATA_UPDATED\"] = 401] = \"THREAD_METADATA_UPDATED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_UPDATED\"] = 408] = \"THREAD_UPDATED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_CREATED\"] = 402] = \"COMMENT_CREATED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_EDITED\"] = 403] = \"COMMENT_EDITED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_DELETED\"] = 404] = \"COMMENT_DELETED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_REACTION_ADDED\"] = 405] = \"COMMENT_REACTION_ADDED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_REACTION_REMOVED\"] = 406] = \"COMMENT_REACTION_REMOVED\";\n  return ServerMsgCode2;\n})(ServerMsgCode || {});\n\n// src/types/IWebSocket.ts\nvar WebsocketCloseCodes = /* @__PURE__ */ ((WebsocketCloseCodes2) => {\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_NORMAL\"] = 1e3] = \"CLOSE_NORMAL\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_ABNORMAL\"] = 1006] = \"CLOSE_ABNORMAL\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"UNEXPECTED_CONDITION\"] = 1011] = \"UNEXPECTED_CONDITION\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"TRY_AGAIN_LATER\"] = 1013] = \"TRY_AGAIN_LATER\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"INVALID_MESSAGE_FORMAT\"] = 4e3] = \"INVALID_MESSAGE_FORMAT\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"NOT_ALLOWED\"] = 4001] = \"NOT_ALLOWED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_MESSAGES_PER_SECONDS\"] = 4002] = \"MAX_NUMBER_OF_MESSAGES_PER_SECONDS\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS\"] = 4003] = \"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP\"] = 4004] = \"MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM\"] = 4005] = \"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"ROOM_ID_UPDATED\"] = 4006] = \"ROOM_ID_UPDATED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"KICKED\"] = 4100] = \"KICKED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"TOKEN_EXPIRED\"] = 4109] = \"TOKEN_EXPIRED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_WITHOUT_RETRY\"] = 4999] = \"CLOSE_WITHOUT_RETRY\";\n  return WebsocketCloseCodes2;\n})(WebsocketCloseCodes || {});\nfunction shouldDisconnect(code) {\n  return code === 4999 /* CLOSE_WITHOUT_RETRY */ || code >= 4e3 && code < 4100;\n}\nfunction shouldReauth(code) {\n  return code >= 4100 && code < 4200;\n}\nfunction shouldRetryWithoutReauth(code) {\n  return code === 1013 /* TRY_AGAIN_LATER */ || code >= 4200 && code < 4300;\n}\n\n// src/connection.ts\nfunction isIdle(status) {\n  return status === \"initial\" || status === \"disconnected\";\n}\nfunction toNewConnectionStatus(machine) {\n  const state = machine.currentState;\n  switch (state) {\n    case \"@ok.connected\":\n    case \"@ok.awaiting-pong\":\n      return \"connected\";\n    case \"@idle.initial\":\n      return \"initial\";\n    case \"@auth.busy\":\n    case \"@auth.backoff\":\n    case \"@connecting.busy\":\n    case \"@connecting.backoff\":\n    case \"@idle.zombie\":\n      return machine.context.successCount > 0 ? \"reconnecting\" : \"connecting\";\n    case \"@idle.failed\":\n      return \"disconnected\";\n    default:\n      return assertNever(state, \"Unknown state\");\n  }\n}\nvar BACKOFF_DELAYS = [250, 500, 1e3, 2e3, 4e3, 8e3, 1e4];\nvar RESET_DELAY = BACKOFF_DELAYS[0] - 1;\nvar BACKOFF_DELAYS_SLOW = [2e3, 3e4, 6e4, 3e5];\nvar HEARTBEAT_INTERVAL = 3e4;\nvar PONG_TIMEOUT = 2e3;\nvar AUTH_TIMEOUT = 1e4;\nvar SOCKET_CONNECT_TIMEOUT = 1e4;\nvar StopRetrying = class extends Error {\n  constructor(reason) {\n    super(reason);\n  }\n};\nvar LiveblocksError = class extends Error {\n  /** @internal */\n  constructor(message, code) {\n    super(message);\n    this.code = code;\n  }\n};\nfunction nextBackoffDelay(currentDelay, delays) {\n  return delays.find((delay) => delay > currentDelay) ?? delays[delays.length - 1];\n}\nfunction increaseBackoffDelay(context) {\n  context.patch({\n    backoffDelay: nextBackoffDelay(context.backoffDelay, BACKOFF_DELAYS)\n  });\n}\nfunction increaseBackoffDelayAggressively(context) {\n  context.patch({\n    backoffDelay: nextBackoffDelay(context.backoffDelay, BACKOFF_DELAYS_SLOW)\n  });\n}\nfunction resetSuccessCount(context) {\n  context.patch({ successCount: 0 });\n}\nfunction log(level, message) {\n  const logger = level === 2 /* ERROR */ ? error2 : level === 1 /* WARN */ ? warn : (\n    /* black hole */\n    () => {\n    }\n  );\n  return () => {\n    logger(message);\n  };\n}\nfunction logPrematureErrorOrCloseEvent(e) {\n  const conn = \"Connection to Liveblocks websocket server\";\n  return (ctx) => {\n    if (e instanceof Error) {\n      warn(`${conn} could not be established. ${String(e)}`);\n    } else {\n      warn(\n        isCloseEvent(e) ? `${conn} closed prematurely (code: ${e.code}). Retrying in ${ctx.backoffDelay}ms.` : `${conn} could not be established.`\n      );\n    }\n  };\n}\nfunction logCloseEvent(event) {\n  const details = [`code: ${event.code}`];\n  if (event.reason) {\n    details.push(`reason: ${event.reason}`);\n  }\n  return (ctx) => {\n    warn(\n      `Connection to Liveblocks websocket server closed (${details.join(\", \")}). Retrying in ${ctx.backoffDelay}ms.`\n    );\n  };\n}\nvar logPermanentClose = log(\n  1 /* WARN */,\n  \"Connection to WebSocket closed permanently. Won't retry.\"\n);\nfunction isCloseEvent(error3) {\n  return !(error3 instanceof Error) && error3.type === \"close\";\n}\nfunction enableTracing(machine) {\n  const start = (/* @__PURE__ */ new Date()).getTime();\n  function log2(...args) {\n    warn(\n      `${(((/* @__PURE__ */ new Date()).getTime() - start) / 1e3).toFixed(2)} [FSM #${machine.id}]`,\n      ...args\n    );\n  }\n  const unsubs = [\n    machine.events.didReceiveEvent.subscribe((e) => log2(`Event ${e.type}`)),\n    machine.events.willTransition.subscribe(\n      ({ from, to }) => log2(\"Transitioning\", from, \"\\u2192\", to)\n    ),\n    machine.events.didIgnoreEvent.subscribe(\n      (e) => log2(\"Ignored event\", e.type, e, \"(current state won't handle it)\")\n    )\n    // machine.events.willExitState.subscribe((s) => log(\"Exiting state\", s)),\n    // machine.events.didEnterState.subscribe((s) => log(\"Entering state\", s)),\n  ];\n  return () => {\n    for (const unsub of unsubs) {\n      unsub();\n    }\n  };\n}\nfunction defineConnectivityEvents(machine) {\n  const statusDidChange = makeEventSource();\n  const didConnect = makeEventSource();\n  const didDisconnect = makeEventSource();\n  let lastStatus = null;\n  const unsubscribe = machine.events.didEnterState.subscribe(() => {\n    const currStatus = toNewConnectionStatus(machine);\n    if (currStatus !== lastStatus) {\n      statusDidChange.notify(currStatus);\n    }\n    if (lastStatus === \"connected\" && currStatus !== \"connected\") {\n      didDisconnect.notify();\n    } else if (lastStatus !== \"connected\" && currStatus === \"connected\") {\n      didConnect.notify();\n    }\n    lastStatus = currStatus;\n  });\n  return {\n    statusDidChange: statusDidChange.observable,\n    didConnect: didConnect.observable,\n    didDisconnect: didDisconnect.observable,\n    unsubscribe\n  };\n}\nvar assign = (patch) => (ctx) => ctx.patch(patch);\nfunction createConnectionStateMachine(delegates, options) {\n  const onMessage = makeEventSource();\n  onMessage.pause();\n  const onLiveblocksError = makeEventSource();\n  function fireErrorEvent(errmsg, errcode) {\n    return () => {\n      const err = new LiveblocksError(errmsg, errcode);\n      onLiveblocksError.notify(err);\n    };\n  }\n  const initialContext = {\n    successCount: 0,\n    authValue: null,\n    socket: null,\n    backoffDelay: RESET_DELAY\n  };\n  const machine = new FSM(initialContext).addState(\"@idle.initial\").addState(\"@idle.failed\").addState(\"@idle.zombie\").addState(\"@auth.busy\").addState(\"@auth.backoff\").addState(\"@connecting.busy\").addState(\"@connecting.backoff\").addState(\"@ok.connected\").addState(\"@ok.awaiting-pong\");\n  machine.addTransitions(\"*\", {\n    RECONNECT: {\n      target: \"@auth.backoff\",\n      effect: [increaseBackoffDelay, resetSuccessCount]\n    },\n    DISCONNECT: \"@idle.initial\"\n  });\n  machine.onEnter(\"@idle.*\", resetSuccessCount).addTransitions(\"@idle.*\", {\n    CONNECT: (_, ctx) => (\n      // If we still have a known authValue, try to reconnect to the socket directly,\n      // otherwise, try to obtain a new authValue\n      ctx.authValue !== null ? \"@connecting.busy\" : \"@auth.busy\"\n    )\n  });\n  machine.addTransitions(\"@auth.backoff\", {\n    NAVIGATOR_ONLINE: {\n      target: \"@auth.busy\",\n      effect: assign({ backoffDelay: RESET_DELAY })\n    }\n  }).addTimedTransition(\n    \"@auth.backoff\",\n    (ctx) => ctx.backoffDelay,\n    \"@auth.busy\"\n  ).onEnterAsync(\n    \"@auth.busy\",\n    () => withTimeout(\n      delegates.authenticate(),\n      AUTH_TIMEOUT,\n      \"Timed out during auth\"\n    ),\n    // On successful authentication\n    (okEvent) => ({\n      target: \"@connecting.busy\",\n      effect: assign({\n        authValue: okEvent.data\n      })\n    }),\n    // Auth failed\n    (failedEvent) => {\n      if (failedEvent.reason instanceof StopRetrying) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            log(2 /* ERROR */, failedEvent.reason.message),\n            fireErrorEvent(failedEvent.reason.message, -1)\n          ]\n        };\n      }\n      return {\n        target: \"@auth.backoff\",\n        effect: [\n          increaseBackoffDelay,\n          log(\n            2 /* ERROR */,\n            `Authentication failed: ${failedEvent.reason instanceof Error ? failedEvent.reason.message : String(failedEvent.reason)}`\n          )\n        ]\n      };\n    }\n  );\n  const onSocketError = (event) => machine.send({ type: \"EXPLICIT_SOCKET_ERROR\", event });\n  const onSocketClose = (event) => machine.send({ type: \"EXPLICIT_SOCKET_CLOSE\", event });\n  const onSocketMessage = (event) => event.data === \"pong\" ? machine.send({ type: \"PONG\" }) : onMessage.notify(event);\n  function teardownSocket(socket) {\n    if (socket) {\n      socket.removeEventListener(\"error\", onSocketError);\n      socket.removeEventListener(\"close\", onSocketClose);\n      socket.removeEventListener(\"message\", onSocketMessage);\n      socket.close();\n    }\n  }\n  machine.addTransitions(\"@connecting.backoff\", {\n    NAVIGATOR_ONLINE: {\n      target: \"@connecting.busy\",\n      effect: assign({ backoffDelay: RESET_DELAY })\n    }\n  }).addTimedTransition(\n    \"@connecting.backoff\",\n    (ctx) => ctx.backoffDelay,\n    \"@connecting.busy\"\n  ).onEnterAsync(\n    \"@connecting.busy\",\n    //\n    // Use the \"createSocket\" delegate function (provided to the\n    // ManagedSocket) to create the actual WebSocket connection instance.\n    // Then, set up all the necessary event listeners, and wait for the\n    // \"open\" event to occur.\n    //\n    // When the \"open\" event happens, we're ready to transition to the\n    // OK state. This is done by resolving the Promise.\n    //\n    async (ctx, signal) => {\n      let capturedPrematureEvent = null;\n      let unconfirmedSocket = null;\n      const connect$ = new Promise(\n        (resolve, rej) => {\n          if (ctx.authValue === null) {\n            throw new Error(\"No auth authValue\");\n          }\n          const socket = delegates.createSocket(ctx.authValue);\n          unconfirmedSocket = socket;\n          function reject(event) {\n            capturedPrematureEvent = event;\n            socket.removeEventListener(\"message\", onSocketMessage);\n            rej(event);\n          }\n          const [actor$, didReceiveActor] = controlledPromise();\n          if (!options.waitForActorId) {\n            didReceiveActor();\n          }\n          function waitForActorId(event) {\n            const serverMsg = tryParseJson(event.data);\n            if (serverMsg?.type === 104 /* ROOM_STATE */) {\n              didReceiveActor();\n            }\n          }\n          socket.addEventListener(\"message\", onSocketMessage);\n          if (options.waitForActorId) {\n            socket.addEventListener(\"message\", waitForActorId);\n          }\n          socket.addEventListener(\"error\", reject);\n          socket.addEventListener(\"close\", reject);\n          socket.addEventListener(\"open\", () => {\n            socket.addEventListener(\"error\", onSocketError);\n            socket.addEventListener(\"close\", onSocketClose);\n            const unsub = () => {\n              socket.removeEventListener(\"error\", reject);\n              socket.removeEventListener(\"close\", reject);\n              socket.removeEventListener(\"message\", waitForActorId);\n            };\n            void actor$.then(() => {\n              resolve([socket, unsub]);\n            });\n          });\n        }\n      );\n      return withTimeout(\n        connect$,\n        SOCKET_CONNECT_TIMEOUT,\n        \"Timed out during websocket connection\"\n      ).then(\n        //\n        // Part 3:\n        // By now, our \"open\" event has fired, and the promise has been\n        // resolved. Two possible scenarios:\n        //\n        // 1. The happy path. Most likely.\n        // 2. Uh-oh. A premature close/error event has been observed. Let's\n        //    reject the promise after all.\n        //\n        // Any close/error event that will get scheduled after this point\n        // onwards, will be caught in the OK state, and dealt with\n        // accordingly.\n        //\n        ([socket, unsub]) => {\n          unsub();\n          if (signal.aborted) {\n            throw new Error(\"Aborted\");\n          }\n          if (capturedPrematureEvent) {\n            throw capturedPrematureEvent;\n          }\n          return socket;\n        }\n      ).catch((e) => {\n        teardownSocket(unconfirmedSocket);\n        throw e;\n      });\n    },\n    // Only transition to OK state after a successfully opened WebSocket connection\n    (okEvent) => ({\n      target: \"@ok.connected\",\n      effect: assign({\n        socket: okEvent.data,\n        backoffDelay: RESET_DELAY\n      })\n    }),\n    // If the WebSocket connection cannot be established\n    (failure) => {\n      const err = failure.reason;\n      if (err instanceof StopRetrying) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            log(2 /* ERROR */, err.message),\n            fireErrorEvent(err.message, -1)\n          ]\n        };\n      }\n      if (isCloseEvent(err)) {\n        if (err.code === 4109 /* TOKEN_EXPIRED */) {\n          return \"@auth.busy\";\n        }\n        if (shouldRetryWithoutReauth(err.code)) {\n          return {\n            target: \"@connecting.backoff\",\n            effect: [\n              increaseBackoffDelayAggressively,\n              logPrematureErrorOrCloseEvent(err)\n            ]\n          };\n        }\n        if (shouldDisconnect(err.code)) {\n          return {\n            target: \"@idle.failed\",\n            effect: [\n              log(2 /* ERROR */, err.reason),\n              fireErrorEvent(err.reason, err.code)\n            ]\n          };\n        }\n      }\n      return {\n        target: \"@auth.backoff\",\n        effect: [increaseBackoffDelay, logPrematureErrorOrCloseEvent(err)]\n      };\n    }\n  );\n  const sendHeartbeat = {\n    target: \"@ok.awaiting-pong\",\n    effect: (ctx) => {\n      ctx.socket?.send(\"ping\");\n    }\n  };\n  const maybeHeartbeat = () => {\n    const doc = typeof document !== \"undefined\" ? document : void 0;\n    const canZombie = doc?.visibilityState === \"hidden\" && delegates.canZombie();\n    return canZombie ? \"@idle.zombie\" : sendHeartbeat;\n  };\n  machine.addTimedTransition(\"@ok.connected\", HEARTBEAT_INTERVAL, maybeHeartbeat).addTransitions(\"@ok.connected\", {\n    NAVIGATOR_OFFLINE: maybeHeartbeat,\n    // Don't take the browser's word for it when it says it's offline. Do a ping/pong to make sure.\n    WINDOW_GOT_FOCUS: sendHeartbeat\n  });\n  machine.addTransitions(\"@idle.zombie\", {\n    WINDOW_GOT_FOCUS: \"@connecting.backoff\"\n    // When in zombie state, the client will try to wake up automatically when the window regains focus\n  });\n  machine.onEnter(\"@ok.*\", (ctx) => {\n    ctx.patch({ successCount: ctx.successCount + 1 });\n    const timerID = setTimeout(\n      // On the next tick, start delivering all messages that have already\n      // been received, and continue synchronous delivery of all future\n      // incoming messages.\n      onMessage.unpause,\n      0\n    );\n    return (ctx2) => {\n      teardownSocket(ctx2.socket);\n      ctx2.patch({ socket: null });\n      clearTimeout(timerID);\n      onMessage.pause();\n    };\n  }).addTransitions(\"@ok.awaiting-pong\", { PONG: \"@ok.connected\" }).addTimedTransition(\"@ok.awaiting-pong\", PONG_TIMEOUT, {\n    target: \"@connecting.busy\",\n    // Log implicit connection loss and drop the current open socket\n    effect: log(\n      1 /* WARN */,\n      \"Received no pong from server, assume implicit connection loss.\"\n    )\n  }).addTransitions(\"@ok.*\", {\n    // When a socket receives an error, this can cause the closing of the\n    // socket, or not. So always check to see if the socket is still OPEN or\n    // not. When still OPEN, don't transition.\n    EXPLICIT_SOCKET_ERROR: (_, context) => {\n      if (context.socket?.readyState === 1) {\n        return null;\n      }\n      return {\n        target: \"@connecting.backoff\",\n        effect: increaseBackoffDelay\n      };\n    },\n    EXPLICIT_SOCKET_CLOSE: (e) => {\n      if (shouldDisconnect(e.event.code)) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            logPermanentClose,\n            fireErrorEvent(e.event.reason, e.event.code)\n          ]\n        };\n      }\n      if (shouldReauth(e.event.code)) {\n        if (e.event.code === 4109 /* TOKEN_EXPIRED */) {\n          return \"@auth.busy\";\n        } else {\n          return {\n            target: \"@auth.backoff\",\n            effect: [increaseBackoffDelay, logCloseEvent(e.event)]\n          };\n        }\n      }\n      if (shouldRetryWithoutReauth(e.event.code)) {\n        return {\n          target: \"@connecting.backoff\",\n          effect: [increaseBackoffDelayAggressively, logCloseEvent(e.event)]\n        };\n      }\n      return {\n        target: \"@connecting.backoff\",\n        effect: [increaseBackoffDelay, logCloseEvent(e.event)]\n      };\n    }\n  });\n  if (typeof document !== \"undefined\") {\n    const doc = typeof document !== \"undefined\" ? document : void 0;\n    const win = typeof window !== \"undefined\" ? window : void 0;\n    const root = win ?? doc;\n    machine.onEnter(\"*\", (ctx) => {\n      function onNetworkOffline() {\n        machine.send({ type: \"NAVIGATOR_OFFLINE\" });\n      }\n      function onNetworkBackOnline() {\n        machine.send({ type: \"NAVIGATOR_ONLINE\" });\n      }\n      function onVisibilityChange() {\n        if (doc?.visibilityState === \"visible\") {\n          machine.send({ type: \"WINDOW_GOT_FOCUS\" });\n        }\n      }\n      win?.addEventListener(\"online\", onNetworkBackOnline);\n      win?.addEventListener(\"offline\", onNetworkOffline);\n      root?.addEventListener(\"visibilitychange\", onVisibilityChange);\n      return () => {\n        root?.removeEventListener(\"visibilitychange\", onVisibilityChange);\n        win?.removeEventListener(\"online\", onNetworkBackOnline);\n        win?.removeEventListener(\"offline\", onNetworkOffline);\n        teardownSocket(ctx.socket);\n      };\n    });\n  }\n  const cleanups = [];\n  const { statusDidChange, didConnect, didDisconnect, unsubscribe } = defineConnectivityEvents(machine);\n  cleanups.push(unsubscribe);\n  if (options.enableDebugLogging) {\n    cleanups.push(enableTracing(machine));\n  }\n  machine.start();\n  return {\n    machine,\n    cleanups,\n    // Observable events that will be emitted by this machine\n    events: {\n      statusDidChange,\n      didConnect,\n      didDisconnect,\n      onMessage: onMessage.observable,\n      onLiveblocksError: onLiveblocksError.observable\n    }\n  };\n}\nvar ManagedSocket = class {\n  constructor(delegates, enableDebugLogging = false, waitForActorId = true) {\n    const { machine, events, cleanups } = createConnectionStateMachine(\n      delegates,\n      { waitForActorId, enableDebugLogging }\n    );\n    this.machine = machine;\n    this.events = events;\n    this.cleanups = cleanups;\n  }\n  getStatus() {\n    try {\n      return toNewConnectionStatus(this.machine);\n    } catch {\n      return \"initial\";\n    }\n  }\n  /**\n   * Returns the current auth authValue.\n   */\n  get authValue() {\n    return this.machine.context.authValue;\n  }\n  /**\n   * Call this method to try to connect to a WebSocket. This only has an effect\n   * if the machine is idle at the moment, otherwise this is a no-op.\n   */\n  connect() {\n    this.machine.send({ type: \"CONNECT\" });\n  }\n  /**\n   * If idle, will try to connect. Otherwise, it will attempt to reconnect to\n   * the socket, potentially obtaining a new authValue first, if needed.\n   */\n  reconnect() {\n    this.machine.send({ type: \"RECONNECT\" });\n  }\n  /**\n   * Call this method to disconnect from the current WebSocket. Is going to be\n   * a no-op if there is no active connection.\n   */\n  disconnect() {\n    this.machine.send({ type: \"DISCONNECT\" });\n  }\n  /**\n   * Call this to stop the machine and run necessary cleanup functions. After\n   * calling destroy(), you can no longer use this instance. Call this before\n   * letting the instance get garbage collected.\n   */\n  destroy() {\n    this.machine.stop();\n    let cleanup;\n    while (cleanup = this.cleanups.pop()) {\n      cleanup();\n    }\n  }\n  /**\n   * Safely send a message to the current WebSocket connection. Will emit a log\n   * message if this is somehow impossible.\n   */\n  send(data) {\n    const socket = this.machine.context?.socket;\n    if (socket === null) {\n      warn(\"Cannot send: not connected yet\", data);\n    } else if (socket.readyState !== 1) {\n      warn(\"Cannot send: WebSocket no longer open\", data);\n    } else {\n      socket.send(data);\n    }\n  }\n  /**\n   * NOTE: Used by the E2E app only, to simulate explicit events.\n   * Not ideal to keep exposed :(\n   */\n  _privateSendMachineEvent(event) {\n    this.machine.send(event);\n  }\n};\n\n// src/protocol/AuthToken.ts\nfunction canWriteStorage(scopes) {\n  return scopes.includes(\"room:write\" /* Write */);\n}\nfunction canComment(scopes) {\n  return scopes.includes(\"comments:write\" /* CommentsWrite */) || scopes.includes(\"room:write\" /* Write */);\n}\nfunction isValidAuthTokenPayload(data) {\n  return isPlainObject(data) && (data.k === \"acc\" /* ACCESS_TOKEN */ || data.k === \"id\" /* ID_TOKEN */ || data.k === \"sec-legacy\" /* SECRET_LEGACY */);\n}\nfunction parseAuthToken(rawTokenString) {\n  const tokenParts = rawTokenString.split(\".\");\n  if (tokenParts.length !== 3) {\n    throw new Error(\"Authentication error: invalid JWT token\");\n  }\n  const payload = tryParseJson(b64decode(tokenParts[1]));\n  if (!(payload && isValidAuthTokenPayload(payload))) {\n    throw new Error(\n      \"Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback\"\n    );\n  }\n  return {\n    raw: rawTokenString,\n    parsed: payload\n  };\n}\n\n// src/auth-manager.ts\nfunction createAuthManager(authOptions) {\n  const authentication = prepareAuthentication(authOptions);\n  const seenTokens = /* @__PURE__ */ new Set();\n  const tokens = [];\n  const expiryTimes = [];\n  const requestPromises = /* @__PURE__ */ new Map();\n  function reset() {\n    seenTokens.clear();\n    tokens.length = 0;\n    expiryTimes.length = 0;\n    requestPromises.clear();\n  }\n  function hasCorrespondingScopes(requestedScope, scopes) {\n    if (requestedScope === \"comments:read\") {\n      return scopes.includes(\"comments:read\" /* CommentsRead */) || scopes.includes(\"comments:write\" /* CommentsWrite */) || scopes.includes(\"room:read\" /* Read */) || scopes.includes(\"room:write\" /* Write */);\n    } else if (requestedScope === \"room:read\") {\n      return scopes.includes(\"room:read\" /* Read */) || scopes.includes(\"room:write\" /* Write */);\n    }\n    return false;\n  }\n  function getCachedToken(requestOptions) {\n    const now = Math.ceil(Date.now() / 1e3);\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const token = tokens[i];\n      const expiresAt = expiryTimes[i];\n      if (expiresAt <= now) {\n        tokens.splice(i, 1);\n        expiryTimes.splice(i, 1);\n        continue;\n      }\n      if (token.parsed.k === \"id\" /* ID_TOKEN */) {\n        return token;\n      } else if (token.parsed.k === \"acc\" /* ACCESS_TOKEN */) {\n        if (!requestOptions.roomId && Object.entries(token.parsed.perms).length === 0) {\n          return token;\n        }\n        for (const [resource, scopes] of Object.entries(token.parsed.perms)) {\n          if (!requestOptions.roomId) {\n            if (resource.includes(\"*\") && hasCorrespondingScopes(requestOptions.requestedScope, scopes)) {\n              return token;\n            }\n          } else if (resource.includes(\"*\") && requestOptions.roomId.startsWith(resource.replace(\"*\", \"\")) || requestOptions.roomId === resource && hasCorrespondingScopes(requestOptions.requestedScope, scopes)) {\n            return token;\n          }\n        }\n      }\n    }\n    return void 0;\n  }\n  async function makeAuthRequest(options) {\n    const fetcher = authOptions.polyfills?.fetch ?? (typeof window === \"undefined\" ? void 0 : window.fetch);\n    if (authentication.type === \"private\") {\n      if (fetcher === void 0) {\n        throw new StopRetrying(\n          \"To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.\"\n        );\n      }\n      const response = await fetchAuthEndpoint(fetcher, authentication.url, {\n        room: options.roomId\n      });\n      const parsed = parseAuthToken(response.token);\n      if (seenTokens.has(parsed.raw)) {\n        throw new StopRetrying(\n          \"The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.\"\n        );\n      }\n      return parsed;\n    }\n    if (authentication.type === \"custom\") {\n      const response = await authentication.callback(options.roomId);\n      if (response && typeof response === \"object\") {\n        if (typeof response.token === \"string\") {\n          const parsed = parseAuthToken(response.token);\n          return parsed;\n        } else if (typeof response.error === \"string\") {\n          const reason = `Authentication failed: ${\"reason\" in response && typeof response.reason === \"string\" ? response.reason : \"Forbidden\"}`;\n          if (response.error === \"forbidden\") {\n            throw new StopRetrying(reason);\n          } else {\n            throw new Error(reason);\n          }\n        }\n      }\n      throw new Error(\n        'Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: \"...\" }'\n      );\n    }\n    throw new Error(\n      \"Unexpected authentication type. Must be private or custom.\"\n    );\n  }\n  async function getAuthValue(requestOptions) {\n    if (authentication.type === \"public\") {\n      return { type: \"public\", publicApiKey: authentication.publicApiKey };\n    }\n    const cachedToken = getCachedToken(requestOptions);\n    if (cachedToken !== void 0) {\n      return { type: \"secret\", token: cachedToken };\n    }\n    let currentPromise;\n    if (requestOptions.roomId) {\n      currentPromise = requestPromises.get(requestOptions.roomId);\n      if (currentPromise === void 0) {\n        currentPromise = makeAuthRequest(requestOptions);\n        requestPromises.set(requestOptions.roomId, currentPromise);\n      }\n    } else {\n      currentPromise = requestPromises.get(\"liveblocks-user-token\");\n      if (currentPromise === void 0) {\n        currentPromise = makeAuthRequest(requestOptions);\n        requestPromises.set(\"liveblocks-user-token\", currentPromise);\n      }\n    }\n    try {\n      const token = await currentPromise;\n      const BUFFER = 30;\n      const expiresAt = Math.floor(Date.now() / 1e3) + (token.parsed.exp - token.parsed.iat) - BUFFER;\n      seenTokens.add(token.raw);\n      if (token.parsed.k !== \"sec-legacy\" /* SECRET_LEGACY */) {\n        tokens.push(token);\n        expiryTimes.push(expiresAt);\n      }\n      return { type: \"secret\", token };\n    } finally {\n      if (requestOptions.roomId) {\n        requestPromises.delete(requestOptions.roomId);\n      } else {\n        requestPromises.delete(\"liveblocks-user-token\");\n      }\n    }\n  }\n  return {\n    reset,\n    getAuthValue\n  };\n}\nfunction prepareAuthentication(authOptions) {\n  const { publicApiKey, authEndpoint } = authOptions;\n  if (authEndpoint !== void 0 && publicApiKey !== void 0) {\n    throw new Error(\n      \"You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient\"\n    );\n  }\n  if (typeof publicApiKey === \"string\") {\n    if (publicApiKey.startsWith(\"sk_\")) {\n      throw new Error(\n        \"Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey\"\n      );\n    } else if (!publicApiKey.startsWith(\"pk_\")) {\n      throw new Error(\n        \"Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey\"\n      );\n    }\n    return {\n      type: \"public\",\n      publicApiKey\n    };\n  }\n  if (typeof authEndpoint === \"string\") {\n    return {\n      type: \"private\",\n      url: authEndpoint\n    };\n  } else if (typeof authEndpoint === \"function\") {\n    return {\n      type: \"custom\",\n      callback: authEndpoint\n    };\n  } else if (authEndpoint !== void 0) {\n    throw new Error(\n      \"The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint\"\n    );\n  }\n  throw new Error(\n    \"Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient\"\n  );\n}\nasync function fetchAuthEndpoint(fetch2, endpoint, body) {\n  const res = await fetch2(endpoint, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(body)\n  });\n  if (!res.ok) {\n    const reason = `${(await res.text()).trim() || \"reason not provided in auth response\"} (${res.status} returned by POST ${endpoint})`;\n    if (res.status === 401 || res.status === 403) {\n      throw new StopRetrying(`Unauthorized: ${reason}`);\n    } else {\n      throw new Error(`Failed to authenticate: ${reason}`);\n    }\n  }\n  let data;\n  try {\n    data = await res.json();\n  } catch (er) {\n    throw new Error(\n      `Expected a JSON response when doing a POST request on \"${endpoint}\". ${String(\n        er\n      )}`\n    );\n  }\n  if (!isPlainObject(data) || typeof data.token !== \"string\") {\n    throw new Error(\n      `Expected a JSON response of the form \\`{ token: \"...\" }\\` when doing a POST request on \"${endpoint}\", but got ${JSON.stringify(\n        data\n      )}`\n    );\n  }\n  const { token } = data;\n  return { token };\n}\n\n// src/constants.ts\nvar DEFAULT_BASE_URL = \"https://api.liveblocks.io\";\n\n// src/internal.ts\nvar kInternal = Symbol();\n\n// src/devtools/bridge.ts\nvar _bridgeActive = false;\nfunction activateBridge(allowed) {\n  _bridgeActive = allowed;\n}\nfunction sendToPanel(message, options) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  const fullMsg = {\n    ...message,\n    source: \"liveblocks-devtools-client\"\n  };\n  if (!(options?.force || _bridgeActive)) {\n    return;\n  }\n  window.postMessage(fullMsg, \"*\");\n}\nvar eventSource = makeEventSource();\nif ( true && typeof window !== \"undefined\") {\n  window.addEventListener(\"message\", (event) => {\n    if (event.source === window && event.data?.source === \"liveblocks-devtools-panel\") {\n      eventSource.notify(event.data);\n    } else {\n    }\n  });\n}\nvar onMessageFromPanel = eventSource.observable;\n\n// src/devtools/index.ts\nvar VERSION = PKG_VERSION || \"dev\";\nvar _devtoolsSetupHasRun = false;\nfunction setupDevTools(getAllRooms) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  if (_devtoolsSetupHasRun) {\n    return;\n  }\n  _devtoolsSetupHasRun = true;\n  onMessageFromPanel.subscribe((msg) => {\n    switch (msg.msg) {\n      case \"connect\": {\n        activateBridge(true);\n        for (const roomId of getAllRooms()) {\n          sendToPanel({\n            msg: \"room::available\",\n            roomId,\n            clientVersion: VERSION\n          });\n        }\n        break;\n      }\n    }\n  });\n  sendToPanel({ msg: \"wake-up-devtools\" }, { force: true });\n}\nvar unsubsByRoomId = /* @__PURE__ */ new Map();\nfunction stopSyncStream(roomId) {\n  const unsubs = unsubsByRoomId.get(roomId) ?? [];\n  unsubsByRoomId.delete(roomId);\n  for (const unsub of unsubs) {\n    unsub();\n  }\n}\nfunction startSyncStream(room) {\n  stopSyncStream(room.id);\n  fullSync(room);\n  unsubsByRoomId.set(room.id, [\n    // When the connection status changes\n    room.events.status.subscribe(() => partialSyncConnection(room)),\n    // When storage initializes, send the update\n    room.events.storageDidLoad.subscribeOnce(() => partialSyncStorage(room)),\n    // Any time storage updates, send the new storage root\n    room.events.storageBatch.subscribe(() => partialSyncStorage(room)),\n    // Any time \"me\" or \"others\" updates, send the new values accordingly\n    room.events.self.subscribe(() => partialSyncMe(room)),\n    room.events.others.subscribe(() => partialSyncOthers(room)),\n    // Any time ydoc is updated, forward the update\n    room.events.ydoc.subscribe((update) => syncYdocUpdate(room, update)),\n    // Any time a custom room event is received, forward it\n    room.events.customEvent.subscribe(\n      (eventData) => forwardEvent(room, eventData)\n    )\n  ]);\n}\nfunction syncYdocUpdate(room, update) {\n  sendToPanel({\n    msg: \"room::sync::ydoc\",\n    roomId: room.id,\n    update\n  });\n}\nvar loadedAt = Date.now();\nvar eventCounter = 0;\nfunction nextEventId() {\n  return `event-${loadedAt}-${eventCounter++}`;\n}\nfunction forwardEvent(room, eventData) {\n  sendToPanel({\n    msg: \"room::events::custom-event\",\n    roomId: room.id,\n    event: {\n      type: \"CustomEvent\",\n      id: nextEventId(),\n      key: \"Event\",\n      connectionId: eventData.connectionId,\n      payload: eventData.event\n    }\n  });\n}\nfunction partialSyncConnection(room) {\n  sendToPanel({\n    msg: \"room::sync::partial\",\n    roomId: room.id,\n    status: room.getStatus()\n  });\n}\nfunction partialSyncStorage(room) {\n  const root = room.getStorageSnapshot();\n  if (root) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      storage: root.toTreeNode(\"root\").payload\n    });\n  }\n}\nfunction partialSyncMe(room) {\n  const me = room[kInternal].getSelf_forDevTools();\n  if (me) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      me\n    });\n  }\n}\nfunction partialSyncOthers(room) {\n  const others = room[kInternal].getOthers_forDevTools();\n  if (others) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      others\n    });\n  }\n}\nfunction fullSync(room) {\n  const root = room.getStorageSnapshot();\n  const me = room[kInternal].getSelf_forDevTools();\n  const others = room[kInternal].getOthers_forDevTools();\n  room.fetchYDoc(\"\");\n  sendToPanel({\n    msg: \"room::sync::full\",\n    roomId: room.id,\n    status: room.getStatus(),\n    storage: root?.toTreeNode(\"root\").payload ?? null,\n    me,\n    others\n  });\n}\nvar roomChannelListeners = /* @__PURE__ */ new Map();\nfunction stopRoomChannelListener(roomId) {\n  const listener = roomChannelListeners.get(roomId);\n  roomChannelListeners.delete(roomId);\n  if (listener) {\n    listener();\n  }\n}\nfunction linkDevTools(roomId, room) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  sendToPanel({ msg: \"room::available\", roomId, clientVersion: VERSION });\n  stopRoomChannelListener(roomId);\n  roomChannelListeners.set(\n    roomId,\n    // Returns the unsubscribe callback, that we store in the\n    // roomChannelListeners registry\n    onMessageFromPanel.subscribe((msg) => {\n      switch (msg.msg) {\n        case \"room::subscribe\": {\n          if (msg.roomId === roomId) {\n            startSyncStream(room);\n          }\n          break;\n        }\n        case \"room::unsubscribe\": {\n          if (msg.roomId === roomId) {\n            stopSyncStream(roomId);\n          }\n          break;\n        }\n      }\n    })\n  );\n}\nfunction unlinkDevTools(roomId) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  stopSyncStream(roomId);\n  stopRoomChannelListener(roomId);\n  sendToPanel({\n    msg: \"room::unavailable\",\n    roomId\n  });\n}\n\n// src/lib/stringify.ts\nfunction stringify(object, ...args) {\n  if (typeof object !== \"object\" || object === null || Array.isArray(object)) {\n    return JSON.stringify(object, ...args);\n  }\n  const sortedObject = Object.keys(object).sort().reduce(\n    (sortedObject2, key) => {\n      sortedObject2[key] = object[key];\n      return sortedObject2;\n    },\n    {}\n  );\n  return JSON.stringify(sortedObject, ...args);\n}\n\n// src/lib/batch.ts\nvar DEFAULT_SIZE = 50;\nvar BatchCall = class {\n  constructor(input) {\n    this.input = input;\n    const { promise, resolve, reject } = Promise_withResolvers();\n    this.promise = promise;\n    this.resolve = resolve;\n    this.reject = reject;\n  }\n};\nvar Batch = class {\n  constructor(callback, options) {\n    this.queue = [];\n    this.error = false;\n    this.callback = callback;\n    this.size = options.size ?? DEFAULT_SIZE;\n    this.delay = options.delay;\n  }\n  clearDelayTimeout() {\n    if (this.delayTimeoutId !== void 0) {\n      clearTimeout(this.delayTimeoutId);\n      this.delayTimeoutId = void 0;\n    }\n  }\n  schedule() {\n    if (this.queue.length === this.size) {\n      void this.flush();\n    } else if (this.queue.length === 1) {\n      this.clearDelayTimeout();\n      this.delayTimeoutId = setTimeout(() => void this.flush(), this.delay);\n    }\n  }\n  async flush() {\n    if (this.queue.length === 0) {\n      return;\n    }\n    const calls = this.queue.splice(0);\n    const inputs = calls.map((call) => call.input);\n    try {\n      const results = await this.callback(inputs);\n      this.error = false;\n      calls.forEach((call, index) => {\n        const result = results?.[index];\n        if (!Array.isArray(results)) {\n          call.reject(new Error(\"Callback must return an array.\"));\n        } else if (calls.length !== results.length) {\n          call.reject(\n            new Error(\n              `Callback must return an array of the same length as the number of provided items. Expected ${calls.length}, but got ${results.length}.`\n            )\n          );\n        } else if (result instanceof Error) {\n          call.reject(result);\n        } else {\n          call.resolve(result);\n        }\n      });\n    } catch (error3) {\n      this.error = true;\n      calls.forEach((call) => {\n        call.reject(error3);\n      });\n    }\n  }\n  get(input) {\n    const existingCall = this.queue.find(\n      (call2) => stringify(call2.input) === stringify(input)\n    );\n    if (existingCall) {\n      return existingCall.promise;\n    }\n    const call = new BatchCall(input);\n    this.queue.push(call);\n    this.schedule();\n    return call.promise;\n  }\n  clear() {\n    this.queue = [];\n    this.error = false;\n    this.clearDelayTimeout();\n  }\n};\nfunction createBatchStore(callback, options) {\n  const batch = new Batch(callback, options);\n  const cache = /* @__PURE__ */ new Map();\n  const eventSource2 = makeEventSource();\n  function getCacheKey(args) {\n    return stringify(args);\n  }\n  function setStateAndNotify(cacheKey, state) {\n    cache.set(cacheKey, state);\n    eventSource2.notify();\n  }\n  async function get(input) {\n    const cacheKey = getCacheKey(input);\n    if (cache.has(cacheKey)) {\n      return;\n    }\n    try {\n      setStateAndNotify(cacheKey, { isLoading: true });\n      const result = await batch.get(input);\n      setStateAndNotify(cacheKey, { isLoading: false, data: result });\n    } catch (error3) {\n      setStateAndNotify(cacheKey, {\n        isLoading: false,\n        error: error3\n      });\n    }\n  }\n  function getState(input) {\n    const cacheKey = getCacheKey(input);\n    return cache.get(cacheKey);\n  }\n  return {\n    ...eventSource2.observable,\n    get,\n    getState\n  };\n}\n\n// src/lib/create-store.ts\nfunction createStore(initialState) {\n  let state = initialState;\n  const subscribers = /* @__PURE__ */ new Set();\n  function get() {\n    return state;\n  }\n  function set(callback) {\n    const newState = callback(state);\n    if (state === newState) {\n      return;\n    }\n    state = newState;\n    for (const subscriber of subscribers) {\n      subscriber(state);\n    }\n  }\n  function subscribe(callback) {\n    subscribers.add(callback);\n    callback(state);\n    return () => {\n      subscribers.delete(callback);\n    };\n  }\n  return {\n    get,\n    set,\n    subscribe\n  };\n}\n\n// src/convert-plain-data.ts\nfunction convertToCommentData(data) {\n  const editedAt = data.editedAt ? new Date(data.editedAt) : void 0;\n  const createdAt = new Date(data.createdAt);\n  const reactions = data.reactions.map((reaction) => ({\n    ...reaction,\n    createdAt: new Date(reaction.createdAt)\n  }));\n  if (data.body) {\n    return {\n      ...data,\n      reactions,\n      createdAt,\n      editedAt\n    };\n  } else {\n    const deletedAt = new Date(data.deletedAt);\n    return {\n      ...data,\n      reactions,\n      createdAt,\n      editedAt,\n      deletedAt\n    };\n  }\n}\nfunction convertToThreadData(data) {\n  const updatedAt = data.updatedAt ? new Date(data.updatedAt) : void 0;\n  const createdAt = new Date(data.createdAt);\n  const comments = data.comments.map(\n    (comment) => convertToCommentData(comment)\n  );\n  return {\n    ...data,\n    createdAt,\n    updatedAt,\n    comments\n  };\n}\nfunction convertToCommentUserReaction(data) {\n  return {\n    ...data,\n    createdAt: new Date(data.createdAt)\n  };\n}\nfunction convertToInboxNotificationData(data) {\n  const notifiedAt = new Date(data.notifiedAt);\n  const readAt = data.readAt ? new Date(data.readAt) : null;\n  if (\"activities\" in data) {\n    const activities = data.activities.map((activity) => ({\n      ...activity,\n      createdAt: new Date(activity.createdAt)\n    }));\n    return {\n      ...data,\n      notifiedAt,\n      readAt,\n      activities\n    };\n  }\n  return {\n    ...data,\n    notifiedAt,\n    readAt\n  };\n}\nfunction convertToThreadDeleteInfo(data) {\n  const deletedAt = new Date(data.deletedAt);\n  return {\n    ...data,\n    deletedAt\n  };\n}\nfunction convertToInboxNotificationDeleteInfo(data) {\n  const deletedAt = new Date(data.deletedAt);\n  return {\n    ...data,\n    deletedAt\n  };\n}\n\n// src/lib/url.ts\nfunction toURLSearchParams(params) {\n  const result = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== void 0 && value !== null) {\n      result.set(key, value.toString());\n    }\n  }\n  return result;\n}\nfunction urljoin(baseUrl, path, params) {\n  const url = new URL(path, baseUrl);\n  if (params !== void 0) {\n    url.search = (params instanceof URLSearchParams ? params : toURLSearchParams(params)).toString();\n  }\n  return url.toString();\n}\n\n// src/notifications.ts\nvar MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY = 50;\nfunction createNotificationsApi({\n  baseUrl,\n  authManager,\n  currentUserIdStore,\n  fetcher\n}) {\n  async function fetchJson(endpoint, options, params) {\n    const authValue = await authManager.getAuthValue({\n      requestedScope: \"comments:read\"\n    });\n    if (authValue.type === \"secret\" && authValue.token.parsed.k === \"acc\" /* ACCESS_TOKEN */) {\n      const userId = authValue.token.parsed.uid;\n      currentUserIdStore.set(() => userId);\n    }\n    const url = urljoin(baseUrl, `/v2/c${endpoint}`, params);\n    const response = await fetcher(url.toString(), {\n      ...options,\n      headers: {\n        ...options?.headers,\n        Authorization: `Bearer ${getAuthBearerHeaderFromAuthValue(authValue)}`\n      }\n    });\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new NotificationsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new NotificationsApiError(\n            response.statusText,\n            response.status\n          );\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  async function getInboxNotifications() {\n    const json = await fetchJson(\"/inbox-notifications\", void 0, {});\n    return {\n      threads: json.threads.map(convertToThreadData),\n      inboxNotifications: json.inboxNotifications.map(\n        convertToInboxNotificationData\n      ),\n      requestedAt: new Date(json.meta.requestedAt)\n    };\n  }\n  async function getInboxNotificationsSince(options) {\n    const json = await fetchJson(\"/inbox-notifications\", void 0, {\n      since: options.since.toISOString()\n    });\n    return {\n      threads: {\n        updated: json.threads.map(convertToThreadData),\n        deleted: json.deletedThreads.map(convertToThreadDeleteInfo)\n      },\n      inboxNotifications: {\n        updated: json.inboxNotifications.map(convertToInboxNotificationData),\n        deleted: json.deletedInboxNotifications.map(\n          convertToInboxNotificationDeleteInfo\n        )\n      },\n      requestedAt: new Date(json.meta.requestedAt)\n    };\n  }\n  async function getUnreadInboxNotificationsCount() {\n    const { count } = await fetchJson(\"/inbox-notifications/count\");\n    return count;\n  }\n  async function markAllInboxNotificationsAsRead() {\n    await fetchJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds: \"all\" })\n    });\n  }\n  async function markInboxNotificationsAsRead(inboxNotificationIds) {\n    await fetchJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds })\n    });\n  }\n  const batchedMarkInboxNotificationsAsRead = new Batch(\n    async (batchedInboxNotificationIds) => {\n      const inboxNotificationIds = batchedInboxNotificationIds.flat();\n      await markInboxNotificationsAsRead(inboxNotificationIds);\n      return inboxNotificationIds;\n    },\n    { delay: MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY }\n  );\n  async function markInboxNotificationAsRead(inboxNotificationId) {\n    await batchedMarkInboxNotificationsAsRead.get(inboxNotificationId);\n  }\n  async function deleteAllInboxNotifications() {\n    await fetchJson(\"/inbox-notifications\", {\n      method: \"DELETE\"\n    });\n  }\n  async function deleteInboxNotification(inboxNotificationId) {\n    await fetchJson(\n      `/inbox-notifications/${encodeURIComponent(inboxNotificationId)}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  return {\n    getInboxNotifications,\n    getInboxNotificationsSince,\n    getUnreadInboxNotificationsCount,\n    markAllInboxNotificationsAsRead,\n    markInboxNotificationAsRead,\n    deleteAllInboxNotifications,\n    deleteInboxNotification\n  };\n}\n\n// src/lib/position.ts\nvar MIN_CODE = 32;\nvar MAX_CODE = 126;\nvar NUM_DIGITS = MAX_CODE - MIN_CODE + 1;\nvar ZERO = nthDigit(0);\nvar ONE = nthDigit(1);\nvar ZERO_NINE = ZERO + nthDigit(-1);\nfunction nthDigit(n) {\n  const code = MIN_CODE + (n < 0 ? NUM_DIGITS + n : n);\n  if (code < MIN_CODE || code > MAX_CODE) {\n    throw new Error(`Invalid n value: ${n}`);\n  }\n  return String.fromCharCode(code);\n}\nfunction makePosition(x, y) {\n  if (x !== void 0 && y !== void 0) {\n    return between(x, y);\n  } else if (x !== void 0) {\n    return after(x);\n  } else if (y !== void 0) {\n    return before(y);\n  } else {\n    return ONE;\n  }\n}\nfunction before(pos) {\n  const lastIndex = pos.length - 1;\n  for (let i = 0; i <= lastIndex; i++) {\n    const code = pos.charCodeAt(i);\n    if (code <= MIN_CODE) {\n      continue;\n    }\n    if (i === lastIndex) {\n      if (code === MIN_CODE + 1) {\n        return pos.substring(0, i) + ZERO_NINE;\n      } else {\n        return pos.substring(0, i) + String.fromCharCode(code - 1);\n      }\n    } else {\n      return pos.substring(0, i + 1);\n    }\n  }\n  return ONE;\n}\nfunction after(pos) {\n  for (let i = 0; i <= pos.length - 1; i++) {\n    const code = pos.charCodeAt(i);\n    if (code >= MAX_CODE) {\n      continue;\n    }\n    return pos.substring(0, i) + String.fromCharCode(code + 1);\n  }\n  return pos + ONE;\n}\nfunction between(lo, hi) {\n  if (lo < hi) {\n    return _between(lo, hi);\n  } else if (lo > hi) {\n    return _between(hi, lo);\n  } else {\n    throw new Error(\"Cannot compute value between two equal positions\");\n  }\n}\nfunction _between(lo, hi) {\n  let index = 0;\n  const loLen = lo.length;\n  const hiLen = hi.length;\n  while (true) {\n    const loCode = index < loLen ? lo.charCodeAt(index) : MIN_CODE;\n    const hiCode = index < hiLen ? hi.charCodeAt(index) : MAX_CODE;\n    if (loCode === hiCode) {\n      index++;\n      continue;\n    }\n    if (hiCode - loCode === 1) {\n      const size = index + 1;\n      let prefix = lo.substring(0, size);\n      if (prefix.length < size) {\n        prefix += ZERO.repeat(size - prefix.length);\n      }\n      const suffix = lo.substring(size);\n      const nines = \"\";\n      return prefix + _between(suffix, nines);\n    } else {\n      return takeN(lo, index) + String.fromCharCode(hiCode + loCode >> 1);\n    }\n  }\n}\nfunction takeN(pos, n) {\n  return n < pos.length ? pos.substring(0, n) : pos + ZERO.repeat(n - pos.length);\n}\nvar MIN_NON_ZERO_CODE = MIN_CODE + 1;\nfunction isPos(str) {\n  if (str === \"\") {\n    return false;\n  }\n  const lastIdx = str.length - 1;\n  const last = str.charCodeAt(lastIdx);\n  if (last < MIN_NON_ZERO_CODE || last > MAX_CODE) {\n    return false;\n  }\n  for (let i = 0; i < lastIdx; i++) {\n    const code = str.charCodeAt(i);\n    if (code < MIN_CODE || code > MAX_CODE) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction convertToPos(str) {\n  const codes = [];\n  for (let i = 0; i < str.length; i++) {\n    const code = str.charCodeAt(i);\n    codes.push(code < MIN_CODE ? MIN_CODE : code > MAX_CODE ? MAX_CODE : code);\n  }\n  while (codes.length > 0 && codes[codes.length - 1] === MIN_CODE) {\n    codes.length--;\n  }\n  return codes.length > 0 ? String.fromCharCode(...codes) : (\n    // Edge case: the str was a 0-only string, which is invalid. Default back to .1\n    ONE\n  );\n}\nfunction asPos(str) {\n  return isPos(str) ? str : convertToPos(str);\n}\n\n// src/protocol/Op.ts\nvar OpCode = /* @__PURE__ */ ((OpCode2) => {\n  OpCode2[OpCode2[\"INIT\"] = 0] = \"INIT\";\n  OpCode2[OpCode2[\"SET_PARENT_KEY\"] = 1] = \"SET_PARENT_KEY\";\n  OpCode2[OpCode2[\"CREATE_LIST\"] = 2] = \"CREATE_LIST\";\n  OpCode2[OpCode2[\"UPDATE_OBJECT\"] = 3] = \"UPDATE_OBJECT\";\n  OpCode2[OpCode2[\"CREATE_OBJECT\"] = 4] = \"CREATE_OBJECT\";\n  OpCode2[OpCode2[\"DELETE_CRDT\"] = 5] = \"DELETE_CRDT\";\n  OpCode2[OpCode2[\"DELETE_OBJECT_KEY\"] = 6] = \"DELETE_OBJECT_KEY\";\n  OpCode2[OpCode2[\"CREATE_MAP\"] = 7] = \"CREATE_MAP\";\n  OpCode2[OpCode2[\"CREATE_REGISTER\"] = 8] = \"CREATE_REGISTER\";\n  return OpCode2;\n})(OpCode || {});\nfunction ackOp(opId) {\n  return {\n    type: 5 /* DELETE_CRDT */,\n    id: \"ACK\",\n    // (H)ACK\n    opId\n  };\n}\nfunction isAckOp(op) {\n  return op.type === 5 /* DELETE_CRDT */ && op.id === \"ACK\";\n}\n\n// src/crdts/AbstractCrdt.ts\nfunction crdtAsLiveNode(value) {\n  return value;\n}\nfunction HasParent(node, key, pos = asPos(key)) {\n  return Object.freeze({ type: \"HasParent\", node, key, pos });\n}\nvar NoParent = Object.freeze({ type: \"NoParent\" });\nfunction Orphaned(oldKey, oldPos = asPos(oldKey)) {\n  return Object.freeze({ type: \"Orphaned\", oldKey, oldPos });\n}\nvar AbstractCrdt = class {\n  constructor() {\n    /** @internal */\n    this._parent = NoParent;\n  }\n  /** @internal */\n  _getParentKeyOrThrow() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.key;\n      case \"NoParent\":\n        throw new Error(\"Parent key is missing\");\n      case \"Orphaned\":\n        return this.parent.oldKey;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  get _parentPos() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.pos;\n      case \"NoParent\":\n        throw new Error(\"Parent key is missing\");\n      case \"Orphaned\":\n        return this.parent.oldPos;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  get _pool() {\n    return this.__pool;\n  }\n  get roomId() {\n    return this.__pool ? this.__pool.roomId : null;\n  }\n  /** @internal */\n  get _id() {\n    return this.__id;\n  }\n  /** @internal */\n  get parent() {\n    return this._parent;\n  }\n  /** @internal */\n  get _parentKey() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.key;\n      case \"NoParent\":\n        return null;\n      case \"Orphaned\":\n        return this.parent.oldKey;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  _apply(op, _isLocal) {\n    switch (op.type) {\n      case 5 /* DELETE_CRDT */: {\n        if (this.parent.type === \"HasParent\") {\n          return this.parent.node._detachChild(crdtAsLiveNode(this));\n        }\n        return { modified: false };\n      }\n    }\n    return { modified: false };\n  }\n  /** @internal */\n  _setParentLink(newParentNode, newParentKey) {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        if (this.parent.node !== newParentNode) {\n          throw new Error(\"Cannot set parent: node already has a parent\");\n        } else {\n          this._parent = HasParent(newParentNode, newParentKey);\n          return;\n        }\n      case \"Orphaned\":\n      case \"NoParent\": {\n        this._parent = HasParent(newParentNode, newParentKey);\n        return;\n      }\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  _attach(id, pool) {\n    if (this.__id || this.__pool) {\n      throw new Error(\"Cannot attach node: already attached\");\n    }\n    pool.addNode(id, crdtAsLiveNode(this));\n    this.__id = id;\n    this.__pool = pool;\n  }\n  /** @internal */\n  _detach() {\n    if (this.__pool && this.__id) {\n      this.__pool.deleteNode(this.__id);\n    }\n    switch (this.parent.type) {\n      case \"HasParent\": {\n        this._parent = Orphaned(this.parent.key, this.parent.pos);\n        break;\n      }\n      case \"NoParent\": {\n        this._parent = NoParent;\n        break;\n      }\n      case \"Orphaned\": {\n        break;\n      }\n      default:\n        assertNever(this.parent, \"Unknown state\");\n    }\n    this.__pool = void 0;\n  }\n  /**\n   * @internal\n   *\n   * Clear the Immutable cache, so that the next call to `.toImmutable()` will\n   * recompute the equivalent Immutable value again.  Call this after every\n   * mutation to the Live node.\n   */\n  invalidate() {\n    if (this._cachedImmutable !== void 0 || this._cachedTreeNode !== void 0) {\n      this._cachedImmutable = void 0;\n      this._cachedTreeNode = void 0;\n      if (this.parent.type === \"HasParent\") {\n        this.parent.node.invalidate();\n      }\n    }\n  }\n  /**\n   * @internal\n   *\n   * Return an snapshot of this Live tree for use in DevTools.\n   */\n  toTreeNode(key) {\n    if (this._cachedTreeNode === void 0 || this._cachedTreeNodeKey !== key) {\n      this._cachedTreeNodeKey = key;\n      this._cachedTreeNode = this._toTreeNode(key);\n    }\n    return this._cachedTreeNode;\n  }\n  /**\n   * Return an immutable snapshot of this Live node and its children.\n   */\n  toImmutable() {\n    if (this._cachedImmutable === void 0) {\n      this._cachedImmutable = this._toImmutable();\n    }\n    return this._cachedImmutable;\n  }\n};\n\n// src/protocol/SerializedCrdt.ts\nvar CrdtType = /* @__PURE__ */ ((CrdtType2) => {\n  CrdtType2[CrdtType2[\"OBJECT\"] = 0] = \"OBJECT\";\n  CrdtType2[CrdtType2[\"LIST\"] = 1] = \"LIST\";\n  CrdtType2[CrdtType2[\"MAP\"] = 2] = \"MAP\";\n  CrdtType2[CrdtType2[\"REGISTER\"] = 3] = \"REGISTER\";\n  return CrdtType2;\n})(CrdtType || {});\nfunction isRootCrdt(crdt) {\n  return crdt.type === 0 /* OBJECT */ && !isChildCrdt(crdt);\n}\nfunction isChildCrdt(crdt) {\n  return crdt.parentId !== void 0 && crdt.parentKey !== void 0;\n}\n\n// src/lib/nanoid.ts\nvar nanoid = (t = 21) => crypto.getRandomValues(new Uint8Array(t)).reduce(\n  (t2, e) => t2 += (e &= 63) < 36 ? e.toString(36) : e < 62 ? (e - 26).toString(36).toUpperCase() : e < 63 ? \"_\" : \"-\",\n  \"\"\n);\n\n// src/crdts/LiveRegister.ts\nvar LiveRegister = class _LiveRegister extends AbstractCrdt {\n  constructor(data) {\n    super();\n    this._data = data;\n  }\n  get data() {\n    return this._data;\n  }\n  /** @internal */\n  static _deserialize([id, item], _parentToChildren, pool) {\n    const register = new _LiveRegister(item.data);\n    register._attach(id, pool);\n    return register;\n  }\n  /** @internal */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\n        \"Cannot serialize register if parentId or parentKey is undefined\"\n      );\n    }\n    return [\n      {\n        type: 8 /* CREATE_REGISTER */,\n        opId: pool?.generateOpId(),\n        id: this._id,\n        parentId,\n        parentKey,\n        data: this.data\n      }\n    ];\n  }\n  /** @internal */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveRegister if parent is missing\");\n    }\n    return {\n      type: 3 /* REGISTER */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key,\n      data: this.data\n    };\n  }\n  /** @internal */\n  _attachChild(_op) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /** @internal */\n  _detachChild(_crdt) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    return super._apply(op, isLocal);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"Json\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: this._data\n    };\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._data;\n  }\n  clone() {\n    return deepClone(this.data);\n  }\n};\n\n// src/crdts/LiveList.ts\nfunction compareNodePosition(itemA, itemB) {\n  const posA = itemA._parentPos;\n  const posB = itemB._parentPos;\n  return posA === posB ? 0 : posA < posB ? -1 : 1;\n}\nvar LiveList = class _LiveList extends AbstractCrdt {\n  constructor(items) {\n    super();\n    this._items = [];\n    this._implicitlyDeletedItems = /* @__PURE__ */ new WeakSet();\n    this._unacknowledgedSets = /* @__PURE__ */ new Map();\n    let position = void 0;\n    for (const item of items) {\n      const newPosition = makePosition(position);\n      const node = lsonToLiveNode(item);\n      node._setParentLink(this, newPosition);\n      this._items.push(node);\n      position = newPosition;\n    }\n  }\n  /** @internal */\n  static _deserialize([id], parentToChildren, pool) {\n    const list = new _LiveList([]);\n    list._attach(id, pool);\n    const children = parentToChildren.get(id);\n    if (children === void 0) {\n      return list;\n    }\n    for (const [id2, crdt] of children) {\n      const child = deserialize([id2, crdt], parentToChildren, pool);\n      child._setParentLink(list, crdt.parentKey);\n      list._insertAndSort(child);\n    }\n    return list;\n  }\n  /**\n   * @internal\n   * This function assumes that the resulting ops will be sent to the server if they have an 'opId'\n   * so we mutate _unacknowledgedSets to avoid potential flickering\n   * https://github.com/liveblocks/liveblocks/pull/1177\n   *\n   * This is quite unintuitive and should disappear as soon as\n   * we introduce an explicit LiveList.Set operation\n   */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const ops = [];\n    const op = {\n      id: this._id,\n      opId: pool?.generateOpId(),\n      type: 2 /* CREATE_LIST */,\n      parentId,\n      parentKey\n    };\n    ops.push(op);\n    for (const item of this._items) {\n      const parentKey2 = item._getParentKeyOrThrow();\n      const childOps = HACK_addIntentAndDeletedIdToOperation(\n        item._toOps(this._id, parentKey2, pool),\n        void 0\n      );\n      const childOpId = childOps[0].opId;\n      if (childOpId !== void 0) {\n        this._unacknowledgedSets.set(parentKey2, childOpId);\n      }\n      ops.push(...childOps);\n    }\n    return ops;\n  }\n  /**\n   * @internal\n   *\n   * Adds a new item into the sorted list, in the correct position.\n   */\n  _insertAndSort(item) {\n    this._items.push(item);\n    this._sortItems();\n  }\n  /** @internal */\n  _sortItems() {\n    this._items.sort(compareNodePosition);\n    this.invalidate();\n  }\n  /** @internal */\n  _indexOfPosition(position) {\n    return this._items.findIndex(\n      (item) => item._getParentKeyOrThrow() === position\n    );\n  }\n  /** @internal */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const item of this._items) {\n      item._attach(pool.generateId(), pool);\n    }\n  }\n  /** @internal */\n  _detach() {\n    super._detach();\n    for (const item of this._items) {\n      item._detach();\n    }\n  }\n  /** @internal */\n  _applySetRemote(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    child._attach(id, this._pool);\n    child._setParentLink(this, key);\n    const deletedId = op.deletedId;\n    const indexOfItemWithSamePosition = this._indexOfPosition(key);\n    if (indexOfItemWithSamePosition !== -1) {\n      const itemWithSamePosition = this._items[indexOfItemWithSamePosition];\n      if (itemWithSamePosition._id === deletedId) {\n        itemWithSamePosition._detach();\n        this._items[indexOfItemWithSamePosition] = child;\n        return {\n          modified: makeUpdate(this, [\n            setDelta(indexOfItemWithSamePosition, child)\n          ]),\n          reverse: []\n        };\n      } else {\n        this._implicitlyDeletedItems.add(itemWithSamePosition);\n        this._items[indexOfItemWithSamePosition] = child;\n        const delta = [\n          setDelta(indexOfItemWithSamePosition, child)\n        ];\n        const deleteDelta2 = this._detachItemAssociatedToSetOperation(\n          op.deletedId\n        );\n        if (deleteDelta2) {\n          delta.push(deleteDelta2);\n        }\n        return {\n          modified: makeUpdate(this, delta),\n          reverse: []\n        };\n      }\n    } else {\n      const updates = [];\n      const deleteDelta2 = this._detachItemAssociatedToSetOperation(\n        op.deletedId\n      );\n      if (deleteDelta2) {\n        updates.push(deleteDelta2);\n      }\n      this._insertAndSort(child);\n      updates.push(insertDelta(this._indexOfPosition(key), child));\n      return {\n        reverse: [],\n        modified: makeUpdate(this, updates)\n      };\n    }\n  }\n  /** @internal */\n  _applySetAck(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const delta = [];\n    const deletedDelta = this._detachItemAssociatedToSetOperation(op.deletedId);\n    if (deletedDelta) {\n      delta.push(deletedDelta);\n    }\n    const unacknowledgedOpId = this._unacknowledgedSets.get(op.parentKey);\n    if (unacknowledgedOpId !== void 0) {\n      if (unacknowledgedOpId !== op.opId) {\n        return delta.length === 0 ? { modified: false } : { modified: makeUpdate(this, delta), reverse: [] };\n      } else {\n        this._unacknowledgedSets.delete(op.parentKey);\n      }\n    }\n    const indexOfItemWithSamePosition = this._indexOfPosition(op.parentKey);\n    const existingItem = this._items.find((item) => item._id === op.id);\n    if (existingItem !== void 0) {\n      if (existingItem._parentKey === op.parentKey) {\n        return {\n          modified: delta.length > 0 ? makeUpdate(this, delta) : false,\n          reverse: []\n        };\n      }\n      if (indexOfItemWithSamePosition !== -1) {\n        this._implicitlyDeletedItems.add(\n          this._items[indexOfItemWithSamePosition]\n        );\n        this._items.splice(indexOfItemWithSamePosition, 1);\n        delta.push(deleteDelta(indexOfItemWithSamePosition));\n      }\n      const previousIndex = this._items.indexOf(existingItem);\n      existingItem._setParentLink(this, op.parentKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(existingItem);\n      if (newIndex !== previousIndex) {\n        delta.push(moveDelta(previousIndex, newIndex, existingItem));\n      }\n      return {\n        modified: delta.length > 0 ? makeUpdate(this, delta) : false,\n        reverse: []\n      };\n    } else {\n      const orphan = this._pool.getNode(op.id);\n      if (orphan && this._implicitlyDeletedItems.has(orphan)) {\n        orphan._setParentLink(this, op.parentKey);\n        this._implicitlyDeletedItems.delete(orphan);\n        this._insertAndSort(orphan);\n        const recreatedItemIndex = this._items.indexOf(orphan);\n        return {\n          modified: makeUpdate(this, [\n            // If there is an item at this position, update is a set, else it's an insert\n            indexOfItemWithSamePosition === -1 ? insertDelta(recreatedItemIndex, orphan) : setDelta(recreatedItemIndex, orphan),\n            ...delta\n          ]),\n          reverse: []\n        };\n      } else {\n        if (indexOfItemWithSamePosition !== -1) {\n          this._items.splice(indexOfItemWithSamePosition, 1);\n        }\n        const { newItem, newIndex } = this._createAttachItemAndSort(\n          op,\n          op.parentKey\n        );\n        return {\n          modified: makeUpdate(this, [\n            // If there is an item at this position, update is a set, else it's an insert\n            indexOfItemWithSamePosition === -1 ? insertDelta(newIndex, newItem) : setDelta(newIndex, newItem),\n            ...delta\n          ]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /**\n   * Returns the update delta of the deletion or null\n   * @internal\n   */\n  _detachItemAssociatedToSetOperation(deletedId) {\n    if (deletedId === void 0 || this._pool === void 0) {\n      return null;\n    }\n    const deletedItem = this._pool.getNode(deletedId);\n    if (deletedItem === void 0) {\n      return null;\n    }\n    const result = this._detachChild(deletedItem);\n    if (result.modified === false) {\n      return null;\n    }\n    return result.modified.updates[0];\n  }\n  /** @internal */\n  _applyRemoteInsert(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const key = asPos(op.parentKey);\n    const existingItemIndex = this._indexOfPosition(key);\n    if (existingItemIndex !== -1) {\n      this._shiftItemPosition(existingItemIndex, key);\n    }\n    const { newItem, newIndex } = this._createAttachItemAndSort(op, key);\n    return {\n      modified: makeUpdate(this, [insertDelta(newIndex, newItem)]),\n      reverse: []\n    };\n  }\n  /** @internal */\n  _applyInsertAck(op) {\n    const existingItem = this._items.find((item) => item._id === op.id);\n    const key = asPos(op.parentKey);\n    const itemIndexAtPosition = this._indexOfPosition(key);\n    if (existingItem) {\n      if (existingItem._parentKey === key) {\n        return {\n          modified: false\n        };\n      } else {\n        const oldPositionIndex = this._items.indexOf(existingItem);\n        if (itemIndexAtPosition !== -1) {\n          this._shiftItemPosition(itemIndexAtPosition, key);\n        }\n        existingItem._setParentLink(this, key);\n        this._sortItems();\n        const newIndex = this._indexOfPosition(key);\n        if (newIndex === oldPositionIndex) {\n          return { modified: false };\n        }\n        return {\n          modified: makeUpdate(this, [\n            moveDelta(oldPositionIndex, newIndex, existingItem)\n          ]),\n          reverse: []\n        };\n      }\n    } else {\n      const orphan = nn(this._pool).getNode(op.id);\n      if (orphan && this._implicitlyDeletedItems.has(orphan)) {\n        orphan._setParentLink(this, key);\n        this._implicitlyDeletedItems.delete(orphan);\n        this._insertAndSort(orphan);\n        const newIndex = this._indexOfPosition(key);\n        return {\n          modified: makeUpdate(this, [insertDelta(newIndex, orphan)]),\n          reverse: []\n        };\n      } else {\n        if (itemIndexAtPosition !== -1) {\n          this._shiftItemPosition(itemIndexAtPosition, key);\n        }\n        const { newItem, newIndex } = this._createAttachItemAndSort(op, key);\n        return {\n          modified: makeUpdate(this, [insertDelta(newIndex, newItem)]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /** @internal */\n  _applyInsertUndoRedo(op) {\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    if (this._pool?.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    child._attach(id, nn(this._pool));\n    child._setParentLink(this, key);\n    const existingItemIndex = this._indexOfPosition(key);\n    let newKey = key;\n    if (existingItemIndex !== -1) {\n      const before2 = this._items[existingItemIndex]?._parentPos;\n      const after2 = this._items[existingItemIndex + 1]?._parentPos;\n      newKey = makePosition(before2, after2);\n      child._setParentLink(this, newKey);\n    }\n    this._insertAndSort(child);\n    const newIndex = this._indexOfPosition(newKey);\n    return {\n      modified: makeUpdate(this, [insertDelta(newIndex, child)]),\n      reverse: [{ type: 5 /* DELETE_CRDT */, id }]\n    };\n  }\n  /** @internal */\n  _applySetUndoRedo(op) {\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    if (this._pool?.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    this._unacknowledgedSets.set(key, nn(op.opId));\n    const indexOfItemWithSameKey = this._indexOfPosition(key);\n    child._attach(id, nn(this._pool));\n    child._setParentLink(this, key);\n    const newKey = key;\n    if (indexOfItemWithSameKey !== -1) {\n      const existingItem = this._items[indexOfItemWithSameKey];\n      existingItem._detach();\n      this._items[indexOfItemWithSameKey] = child;\n      const reverse = HACK_addIntentAndDeletedIdToOperation(\n        existingItem._toOps(nn(this._id), key, this._pool),\n        op.id\n      );\n      const delta = [setDelta(indexOfItemWithSameKey, child)];\n      const deletedDelta = this._detachItemAssociatedToSetOperation(\n        op.deletedId\n      );\n      if (deletedDelta) {\n        delta.push(deletedDelta);\n      }\n      return {\n        modified: makeUpdate(this, delta),\n        reverse\n      };\n    } else {\n      this._insertAndSort(child);\n      this._detachItemAssociatedToSetOperation(op.deletedId);\n      const newIndex = this._indexOfPosition(newKey);\n      return {\n        reverse: [{ type: 5 /* DELETE_CRDT */, id }],\n        modified: makeUpdate(this, [insertDelta(newIndex, child)])\n      };\n    }\n  }\n  /** @internal */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    let result;\n    if (op.intent === \"set\") {\n      if (source === 1 /* REMOTE */) {\n        result = this._applySetRemote(op);\n      } else if (source === 2 /* ACK */) {\n        result = this._applySetAck(op);\n      } else {\n        result = this._applySetUndoRedo(op);\n      }\n    } else {\n      if (source === 1 /* REMOTE */) {\n        result = this._applyRemoteInsert(op);\n      } else if (source === 2 /* ACK */) {\n        result = this._applyInsertAck(op);\n      } else {\n        result = this._applyInsertUndoRedo(op);\n      }\n    }\n    if (result.modified !== false) {\n      this.invalidate();\n    }\n    return result;\n  }\n  /** @internal */\n  _detachChild(child) {\n    if (child) {\n      const parentKey = nn(child._parentKey);\n      const reverse = child._toOps(nn(this._id), parentKey, this._pool);\n      const indexToDelete = this._items.indexOf(child);\n      if (indexToDelete === -1) {\n        return {\n          modified: false\n        };\n      }\n      this._items.splice(indexToDelete, 1);\n      this.invalidate();\n      child._detach();\n      return {\n        modified: makeUpdate(this, [deleteDelta(indexToDelete)]),\n        reverse\n      };\n    }\n    return { modified: false };\n  }\n  /** @internal */\n  _applySetChildKeyRemote(newKey, child) {\n    if (this._implicitlyDeletedItems.has(child)) {\n      this._implicitlyDeletedItems.delete(child);\n      child._setParentLink(this, newKey);\n      this._insertAndSort(child);\n      const newIndex = this._items.indexOf(child);\n      return {\n        modified: makeUpdate(this, [insertDelta(newIndex, child)]),\n        reverse: []\n      };\n    }\n    const previousKey = child._parentKey;\n    if (newKey === previousKey) {\n      return {\n        modified: false\n      };\n    }\n    const existingItemIndex = this._indexOfPosition(newKey);\n    if (existingItemIndex === -1) {\n      const previousIndex = this._items.indexOf(child);\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (newIndex === previousIndex) {\n        return {\n          modified: false\n        };\n      }\n      return {\n        modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n        reverse: []\n      };\n    } else {\n      this._items[existingItemIndex]._setParentLink(\n        this,\n        makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n      );\n      const previousIndex = this._items.indexOf(child);\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (newIndex === previousIndex) {\n        return {\n          modified: false\n        };\n      }\n      return {\n        modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n        reverse: []\n      };\n    }\n  }\n  /** @internal */\n  _applySetChildKeyAck(newKey, child) {\n    const previousKey = nn(child._parentKey);\n    if (this._implicitlyDeletedItems.has(child)) {\n      const existingItemIndex = this._indexOfPosition(newKey);\n      this._implicitlyDeletedItems.delete(child);\n      if (existingItemIndex !== -1) {\n        this._items[existingItemIndex]._setParentLink(\n          this,\n          makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n        );\n      }\n      child._setParentLink(this, newKey);\n      this._insertAndSort(child);\n      return {\n        modified: false\n      };\n    } else {\n      if (newKey === previousKey) {\n        return {\n          modified: false\n        };\n      }\n      const previousIndex = this._items.indexOf(child);\n      const existingItemIndex = this._indexOfPosition(newKey);\n      if (existingItemIndex !== -1) {\n        this._items[existingItemIndex]._setParentLink(\n          this,\n          makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n        );\n      }\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (previousIndex === newIndex) {\n        return {\n          modified: false\n        };\n      } else {\n        return {\n          modified: makeUpdate(this, [\n            moveDelta(previousIndex, newIndex, child)\n          ]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /** @internal */\n  _applySetChildKeyUndoRedo(newKey, child) {\n    const previousKey = nn(child._parentKey);\n    const previousIndex = this._items.indexOf(child);\n    const existingItemIndex = this._indexOfPosition(newKey);\n    if (existingItemIndex !== -1) {\n      this._items[existingItemIndex]._setParentLink(\n        this,\n        makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n      );\n    }\n    child._setParentLink(this, newKey);\n    this._sortItems();\n    const newIndex = this._items.indexOf(child);\n    if (previousIndex === newIndex) {\n      return {\n        modified: false\n      };\n    }\n    return {\n      modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n      reverse: [\n        {\n          type: 1 /* SET_PARENT_KEY */,\n          id: nn(child._id),\n          parentKey: previousKey\n        }\n      ]\n    };\n  }\n  /** @internal */\n  _setChildKey(newKey, child, source) {\n    if (source === 1 /* REMOTE */) {\n      return this._applySetChildKeyRemote(newKey, child);\n    } else if (source === 2 /* ACK */) {\n      return this._applySetChildKeyAck(newKey, child);\n    } else {\n      return this._applySetChildKeyUndoRedo(newKey, child);\n    }\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    return super._apply(op, isLocal);\n  }\n  /** @internal */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveList if parent is missing\");\n    }\n    return {\n      type: 1 /* LIST */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key\n    };\n  }\n  /**\n   * Returns the number of elements.\n   */\n  get length() {\n    return this._items.length;\n  }\n  /**\n   * Adds one element to the end of the LiveList.\n   * @param element The element to add to the end of the LiveList.\n   */\n  push(element) {\n    this._pool?.assertStorageIsWritable();\n    return this.insert(element, this.length);\n  }\n  /**\n   * Inserts one element at a specified index.\n   * @param element The element to insert.\n   * @param index The index at which you want to insert the element.\n   */\n  insert(element, index) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index > this._items.length) {\n      throw new Error(\n        `Cannot insert list item at index \"\u001d${index}\". index should be between 0 and ${this._items.length}`\n      );\n    }\n    const before2 = this._items[index - 1] ? this._items[index - 1]._parentPos : void 0;\n    const after2 = this._items[index] ? this._items[index]._parentPos : void 0;\n    const position = makePosition(before2, after2);\n    const value = lsonToLiveNode(element);\n    value._setParentLink(this, position);\n    this._insertAndSort(value);\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      value._attach(id, this._pool);\n      this._pool.dispatch(\n        value._toOps(this._id, position, this._pool),\n        [{ type: 5 /* DELETE_CRDT */, id }],\n        /* @__PURE__ */ new Map([\n          [this._id, makeUpdate(this, [insertDelta(index, value)])]\n        ])\n      );\n    }\n  }\n  /**\n   * Move one element from one index to another.\n   * @param index The index of the element to move\n   * @param targetIndex The index where the element should be after moving.\n   */\n  move(index, targetIndex) {\n    this._pool?.assertStorageIsWritable();\n    if (targetIndex < 0) {\n      throw new Error(\"targetIndex cannot be less than 0\");\n    }\n    if (targetIndex >= this._items.length) {\n      throw new Error(\n        \"targetIndex cannot be greater or equal than the list length\"\n      );\n    }\n    if (index < 0) {\n      throw new Error(\"index cannot be less than 0\");\n    }\n    if (index >= this._items.length) {\n      throw new Error(\"index cannot be greater or equal than the list length\");\n    }\n    let beforePosition = null;\n    let afterPosition = null;\n    if (index < targetIndex) {\n      afterPosition = targetIndex === this._items.length - 1 ? void 0 : this._items[targetIndex + 1]._parentPos;\n      beforePosition = this._items[targetIndex]._parentPos;\n    } else {\n      afterPosition = this._items[targetIndex]._parentPos;\n      beforePosition = targetIndex === 0 ? void 0 : this._items[targetIndex - 1]._parentPos;\n    }\n    const position = makePosition(beforePosition, afterPosition);\n    const item = this._items[index];\n    const previousPosition = item._getParentKeyOrThrow();\n    item._setParentLink(this, position);\n    this._sortItems();\n    if (this._pool && this._id) {\n      const storageUpdates = /* @__PURE__ */ new Map([\n        [this._id, makeUpdate(this, [moveDelta(index, targetIndex, item)])]\n      ]);\n      this._pool.dispatch(\n        [\n          {\n            type: 1 /* SET_PARENT_KEY */,\n            id: nn(item._id),\n            opId: this._pool.generateOpId(),\n            parentKey: position\n          }\n        ],\n        [\n          {\n            type: 1 /* SET_PARENT_KEY */,\n            id: nn(item._id),\n            parentKey: previousPosition\n          }\n        ],\n        storageUpdates\n      );\n    }\n  }\n  /**\n   * Deletes an element at the specified index\n   * @param index The index of the element to delete\n   */\n  delete(index) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index >= this._items.length) {\n      throw new Error(\n        `Cannot delete list item at index \"${index}\". index should be between 0 and ${this._items.length - 1}`\n      );\n    }\n    const item = this._items[index];\n    item._detach();\n    this._items.splice(index, 1);\n    this.invalidate();\n    if (this._pool) {\n      const childRecordId = item._id;\n      if (childRecordId) {\n        const storageUpdates = /* @__PURE__ */ new Map();\n        storageUpdates.set(\n          nn(this._id),\n          makeUpdate(this, [deleteDelta(index)])\n        );\n        this._pool.dispatch(\n          [\n            {\n              id: childRecordId,\n              opId: this._pool.generateOpId(),\n              type: 5 /* DELETE_CRDT */\n            }\n          ],\n          item._toOps(nn(this._id), item._getParentKeyOrThrow()),\n          storageUpdates\n        );\n      }\n    }\n  }\n  clear() {\n    this._pool?.assertStorageIsWritable();\n    if (this._pool) {\n      const ops = [];\n      const reverseOps = [];\n      const updateDelta = [];\n      for (const item of this._items) {\n        item._detach();\n        const childId = item._id;\n        if (childId) {\n          ops.push({\n            type: 5 /* DELETE_CRDT */,\n            id: childId,\n            opId: this._pool.generateOpId()\n          });\n          reverseOps.push(\n            ...item._toOps(nn(this._id), item._getParentKeyOrThrow())\n          );\n          updateDelta.push(deleteDelta(0));\n        }\n      }\n      this._items = [];\n      this.invalidate();\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(nn(this._id), makeUpdate(this, updateDelta));\n      this._pool.dispatch(ops, reverseOps, storageUpdates);\n    } else {\n      for (const item of this._items) {\n        item._detach();\n      }\n      this._items = [];\n      this.invalidate();\n    }\n  }\n  set(index, item) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index >= this._items.length) {\n      throw new Error(\n        `Cannot set list item at index \"\u001d${index}\". index should be between 0 and ${this._items.length - 1}`\n      );\n    }\n    const existingItem = this._items[index];\n    const position = existingItem._getParentKeyOrThrow();\n    const existingId = existingItem._id;\n    existingItem._detach();\n    const value = lsonToLiveNode(item);\n    value._setParentLink(this, position);\n    this._items[index] = value;\n    this.invalidate();\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      value._attach(id, this._pool);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(this._id, makeUpdate(this, [setDelta(index, value)]));\n      const ops = HACK_addIntentAndDeletedIdToOperation(\n        value._toOps(this._id, position, this._pool),\n        existingId\n      );\n      this._unacknowledgedSets.set(position, nn(ops[0].opId));\n      const reverseOps = HACK_addIntentAndDeletedIdToOperation(\n        existingItem._toOps(this._id, position, void 0),\n        id\n      );\n      this._pool.dispatch(ops, reverseOps, storageUpdates);\n    }\n  }\n  /**\n   * Returns an Array of all the elements in the LiveList.\n   */\n  toArray() {\n    return this._items.map(\n      (entry) => liveNodeToLson(entry)\n      //                               ^^^^^^^^\n      //                               FIXME! This isn't safe.\n    );\n  }\n  /**\n   * Tests whether all elements pass the test implemented by the provided function.\n   * @param predicate Function to test for each element, taking two arguments (the element and its index).\n   * @returns true if the predicate function returns a truthy value for every element. Otherwise, false.\n   */\n  every(predicate) {\n    return this.toArray().every(predicate);\n  }\n  /**\n   * Creates an array with all elements that pass the test implemented by the provided function.\n   * @param predicate Function to test each element of the LiveList. Return a value that coerces to true to keep the element, or to false otherwise.\n   * @returns An array with the elements that pass the test.\n   */\n  filter(predicate) {\n    return this.toArray().filter(predicate);\n  }\n  /**\n   * Returns the first element that satisfies the provided testing function.\n   * @param predicate Function to execute on each value.\n   * @returns The value of the first element in the LiveList that satisfies the provided testing function. Otherwise, undefined is returned.\n   */\n  find(predicate) {\n    return this.toArray().find(predicate);\n  }\n  /**\n   * Returns the index of the first element in the LiveList that satisfies the provided testing function.\n   * @param predicate Function to execute on each value until the function returns true, indicating that the satisfying element was found.\n   * @returns The index of the first element in the LiveList that passes the test. Otherwise, -1.\n   */\n  findIndex(predicate) {\n    return this.toArray().findIndex(predicate);\n  }\n  /**\n   * Executes a provided function once for each element.\n   * @param callbackfn Function to execute on each element.\n   */\n  forEach(callbackfn) {\n    return this.toArray().forEach(callbackfn);\n  }\n  /**\n   * Get the element at the specified index.\n   * @param index The index on the element to get.\n   * @returns The element at the specified index or undefined.\n   */\n  get(index) {\n    if (index < 0 || index >= this._items.length) {\n      return void 0;\n    }\n    return liveNodeToLson(this._items[index]);\n  }\n  /**\n   * Returns the first index at which a given element can be found in the LiveList, or -1 if it is not present.\n   * @param searchElement Element to locate.\n   * @param fromIndex The index to start the search at.\n   * @returns The first index of the element in the LiveList; -1 if not found.\n   */\n  indexOf(searchElement, fromIndex) {\n    return this.toArray().indexOf(searchElement, fromIndex);\n  }\n  /**\n   * Returns the last index at which a given element can be found in the LiveList, or -1 if it is not present. The LiveLsit is searched backwards, starting at fromIndex.\n   * @param searchElement Element to locate.\n   * @param fromIndex The index at which to start searching backwards.\n   * @returns\n   */\n  lastIndexOf(searchElement, fromIndex) {\n    return this.toArray().lastIndexOf(searchElement, fromIndex);\n  }\n  /**\n   * Creates an array populated with the results of calling a provided function on every element.\n   * @param callback Function that is called for every element.\n   * @returns An array with each element being the result of the callback function.\n   */\n  map(callback) {\n    return this._items.map(\n      (entry, i) => callback(\n        liveNodeToLson(entry),\n        //                    ^^^^^^^^\n        //                    FIXME! This isn't safe.\n        i\n      )\n    );\n  }\n  /**\n   * Tests whether at least one element in the LiveList passes the test implemented by the provided function.\n   * @param predicate Function to test for each element.\n   * @returns true if the callback function returns a truthy value for at least one element. Otherwise, false.\n   */\n  some(predicate) {\n    return this.toArray().some(predicate);\n  }\n  [Symbol.iterator]() {\n    return new LiveListIterator(this._items);\n  }\n  /** @internal */\n  _createAttachItemAndSort(op, key) {\n    const newItem = creationOpToLiveNode(op);\n    newItem._attach(op.id, nn(this._pool));\n    newItem._setParentLink(this, key);\n    this._insertAndSort(newItem);\n    const newIndex = this._indexOfPosition(key);\n    return { newItem, newIndex };\n  }\n  /** @internal */\n  _shiftItemPosition(index, key) {\n    const shiftedPosition = makePosition(\n      key,\n      this._items.length > index + 1 ? this._items[index + 1]?._parentPos : void 0\n    );\n    this._items[index]._setParentLink(this, shiftedPosition);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"LiveList\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: this._items.map(\n        (item, index) => item.toTreeNode(index.toString())\n      )\n    };\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = this._items.map((node) => node.toImmutable());\n    return  false ? 0 : Object.freeze(result);\n  }\n  clone() {\n    return new _LiveList(this._items.map((item) => item.clone()));\n  }\n};\nvar LiveListIterator = class {\n  constructor(items) {\n    this._innerIterator = items[Symbol.iterator]();\n  }\n  [Symbol.iterator]() {\n    return this;\n  }\n  next() {\n    const result = this._innerIterator.next();\n    if (result.done) {\n      return {\n        done: true,\n        value: void 0\n      };\n    }\n    const value = liveNodeToLson(result.value);\n    return { value };\n  }\n};\nfunction makeUpdate(liveList, deltaUpdates) {\n  return {\n    node: liveList,\n    type: \"LiveList\",\n    updates: deltaUpdates\n  };\n}\nfunction setDelta(index, item) {\n  return {\n    index,\n    type: \"set\",\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction deleteDelta(index) {\n  return {\n    index,\n    type: \"delete\"\n  };\n}\nfunction insertDelta(index, item) {\n  return {\n    index,\n    type: \"insert\",\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction moveDelta(previousIndex, index, item) {\n  return {\n    index,\n    type: \"move\",\n    previousIndex,\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction HACK_addIntentAndDeletedIdToOperation(ops, deletedId) {\n  return ops.map((op, index) => {\n    if (index === 0) {\n      const firstOp = op;\n      return {\n        ...firstOp,\n        intent: \"set\",\n        deletedId\n      };\n    } else {\n      return op;\n    }\n  });\n}\n\n// src/lib/freeze.ts\nvar freeze =  false ? (\n  /* istanbul ignore next */\n  0\n) : Object.freeze;\n\n// src/crdts/LiveMap.ts\nvar LiveMap = class _LiveMap extends AbstractCrdt {\n  constructor(entries2) {\n    super();\n    this.unacknowledgedSet = /* @__PURE__ */ new Map();\n    if (entries2) {\n      const mappedEntries = [];\n      for (const [key, value] of entries2) {\n        const node = lsonToLiveNode(value);\n        node._setParentLink(this, key);\n        mappedEntries.push([key, node]);\n      }\n      this._map = new Map(mappedEntries);\n    } else {\n      this._map = /* @__PURE__ */ new Map();\n    }\n  }\n  /**\n   * @internal\n   */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const ops = [];\n    const op = {\n      id: this._id,\n      opId: pool?.generateOpId(),\n      type: 7 /* CREATE_MAP */,\n      parentId,\n      parentKey\n    };\n    ops.push(op);\n    for (const [key, value] of this._map) {\n      ops.push(...value._toOps(this._id, key, pool));\n    }\n    return ops;\n  }\n  /**\n   * @internal\n   */\n  static _deserialize([id, _item], parentToChildren, pool) {\n    const map = new _LiveMap();\n    map._attach(id, pool);\n    const children = parentToChildren.get(id);\n    if (children === void 0) {\n      return map;\n    }\n    for (const [id2, crdt] of children) {\n      const child = deserialize([id2, crdt], parentToChildren, pool);\n      child._setParentLink(map, crdt.parentKey);\n      map._map.set(crdt.parentKey, child);\n      map.invalidate();\n    }\n    return map;\n  }\n  /**\n   * @internal\n   */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const [_key, value] of this._map) {\n      if (isLiveNode(value)) {\n        value._attach(pool.generateId(), pool);\n      }\n    }\n  }\n  /**\n   * @internal\n   */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, parentKey, opId } = op;\n    const key = parentKey;\n    const child = creationOpToLiveNode(op);\n    if (this._pool.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    if (source === 2 /* ACK */) {\n      const lastUpdateOpId = this.unacknowledgedSet.get(key);\n      if (lastUpdateOpId === opId) {\n        this.unacknowledgedSet.delete(key);\n        return { modified: false };\n      } else if (lastUpdateOpId !== void 0) {\n        return { modified: false };\n      }\n    } else if (source === 1 /* REMOTE */) {\n      this.unacknowledgedSet.delete(key);\n    }\n    const previousValue = this._map.get(key);\n    let reverse;\n    if (previousValue) {\n      const thisId = nn(this._id);\n      reverse = previousValue._toOps(thisId, key);\n      previousValue._detach();\n    } else {\n      reverse = [{ type: 5 /* DELETE_CRDT */, id }];\n    }\n    child._setParentLink(this, key);\n    child._attach(id, this._pool);\n    this._map.set(key, child);\n    this.invalidate();\n    return {\n      modified: {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"update\" } }\n      },\n      reverse\n    };\n  }\n  /**\n   * @internal\n   */\n  _detach() {\n    super._detach();\n    for (const item of this._map.values()) {\n      item._detach();\n    }\n  }\n  /**\n   * @internal\n   */\n  _detachChild(child) {\n    const id = nn(this._id);\n    const parentKey = nn(child._parentKey);\n    const reverse = child._toOps(id, parentKey, this._pool);\n    for (const [key, value] of this._map) {\n      if (value === child) {\n        this._map.delete(key);\n        this.invalidate();\n      }\n    }\n    child._detach();\n    const storageUpdate = {\n      node: this,\n      type: \"LiveMap\",\n      updates: { [parentKey]: { type: \"delete\" } }\n    };\n    return { modified: storageUpdate, reverse };\n  }\n  /**\n   * @internal\n   */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveMap if parent is missing\");\n    }\n    return {\n      type: 2 /* MAP */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key\n    };\n  }\n  /**\n   * Returns a specified element from the LiveMap.\n   * @param key The key of the element to return.\n   * @returns The element associated with the specified key, or undefined if the key can't be found in the LiveMap.\n   */\n  get(key) {\n    const value = this._map.get(key);\n    if (value === void 0) {\n      return void 0;\n    }\n    return liveNodeToLson(value);\n  }\n  /**\n   * Adds or updates an element with a specified key and a value.\n   * @param key The key of the element to add. Should be a string.\n   * @param value The value of the element to add. Should be serializable to JSON.\n   */\n  set(key, value) {\n    this._pool?.assertStorageIsWritable();\n    const oldValue = this._map.get(key);\n    if (oldValue) {\n      oldValue._detach();\n    }\n    const item = lsonToLiveNode(value);\n    item._setParentLink(this, key);\n    this._map.set(key, item);\n    this.invalidate();\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      item._attach(id, this._pool);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(this._id, {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"update\" } }\n      });\n      const ops = item._toOps(this._id, key, this._pool);\n      this.unacknowledgedSet.set(key, nn(ops[0].opId));\n      this._pool.dispatch(\n        item._toOps(this._id, key, this._pool),\n        oldValue ? oldValue._toOps(this._id, key) : [{ type: 5 /* DELETE_CRDT */, id }],\n        storageUpdates\n      );\n    }\n  }\n  /**\n   * Returns the number of elements in the LiveMap.\n   */\n  get size() {\n    return this._map.size;\n  }\n  /**\n   * Returns a boolean indicating whether an element with the specified key exists or not.\n   * @param key The key of the element to test for presence.\n   */\n  has(key) {\n    return this._map.has(key);\n  }\n  /**\n   * Removes the specified element by key.\n   * @param key The key of the element to remove.\n   * @returns true if an element existed and has been removed, or false if the element does not exist.\n   */\n  delete(key) {\n    this._pool?.assertStorageIsWritable();\n    const item = this._map.get(key);\n    if (item === void 0) {\n      return false;\n    }\n    item._detach();\n    this._map.delete(key);\n    this.invalidate();\n    if (this._pool && item._id) {\n      const thisId = nn(this._id);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(thisId, {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"delete\" } }\n      });\n      this._pool.dispatch(\n        [\n          {\n            type: 5 /* DELETE_CRDT */,\n            id: item._id,\n            opId: this._pool.generateOpId()\n          }\n        ],\n        item._toOps(thisId, key),\n        storageUpdates\n      );\n    }\n    return true;\n  }\n  /**\n   * Returns a new Iterator object that contains the [key, value] pairs for each element.\n   */\n  entries() {\n    const innerIterator = this._map.entries();\n    return {\n      [Symbol.iterator]() {\n        return this;\n      },\n      next() {\n        const iteratorValue = innerIterator.next();\n        if (iteratorValue.done) {\n          return {\n            done: true,\n            value: void 0\n          };\n        }\n        const entry = iteratorValue.value;\n        const key = entry[0];\n        const value = liveNodeToLson(iteratorValue.value[1]);\n        return {\n          value: [key, value]\n        };\n      }\n    };\n  }\n  /**\n   * Same function object as the initial value of the entries method.\n   */\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  /**\n   * Returns a new Iterator object that contains the keys for each element.\n   */\n  keys() {\n    return this._map.keys();\n  }\n  /**\n   * Returns a new Iterator object that contains the values for each element.\n   */\n  values() {\n    const innerIterator = this._map.values();\n    return {\n      [Symbol.iterator]() {\n        return this;\n      },\n      next() {\n        const iteratorValue = innerIterator.next();\n        if (iteratorValue.done) {\n          return {\n            done: true,\n            value: void 0\n          };\n        }\n        const value = liveNodeToLson(iteratorValue.value);\n        return { value };\n      }\n    };\n  }\n  /**\n   * Executes a provided function once per each key/value pair in the Map object, in insertion order.\n   * @param callback Function to execute for each entry in the map.\n   */\n  forEach(callback) {\n    for (const entry of this) {\n      callback(entry[1], entry[0], this);\n    }\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"LiveMap\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: Array.from(this._map.entries()).map(\n        ([key2, val]) => val.toTreeNode(key2)\n      )\n    };\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = /* @__PURE__ */ new Map();\n    for (const [key, value] of this._map) {\n      result.set(key, value.toImmutable());\n    }\n    return freeze(result);\n  }\n  clone() {\n    return new _LiveMap(\n      Array.from(this._map).map(([key, node]) => [key, node.clone()])\n    );\n  }\n};\n\n// src/crdts/LiveObject.ts\nvar LiveObject = class _LiveObject extends AbstractCrdt {\n  /** @internal */\n  static _buildRootAndParentToChildren(items) {\n    const parentToChildren = /* @__PURE__ */ new Map();\n    let root = null;\n    for (const [id, crdt] of items) {\n      if (isRootCrdt(crdt)) {\n        root = [id, crdt];\n      } else {\n        const tuple = [id, crdt];\n        const children = parentToChildren.get(crdt.parentId);\n        if (children !== void 0) {\n          children.push(tuple);\n        } else {\n          parentToChildren.set(crdt.parentId, [tuple]);\n        }\n      }\n    }\n    if (root === null) {\n      throw new Error(\"Root can't be null\");\n    }\n    return [root, parentToChildren];\n  }\n  /** @internal */\n  static _fromItems(items, pool) {\n    const [root, parentToChildren] = _LiveObject._buildRootAndParentToChildren(items);\n    return _LiveObject._deserialize(\n      root,\n      parentToChildren,\n      pool\n    );\n  }\n  constructor(obj = {}) {\n    super();\n    this._propToLastUpdate = /* @__PURE__ */ new Map();\n    const o = compactObject(obj);\n    for (const key of Object.keys(o)) {\n      const value = o[key];\n      if (isLiveNode(value)) {\n        value._setParentLink(this, key);\n      }\n    }\n    this._map = new Map(Object.entries(o));\n  }\n  /** @internal */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const opId = pool?.generateOpId();\n    const ops = [];\n    const op = {\n      type: 4 /* CREATE_OBJECT */,\n      id: this._id,\n      opId,\n      parentId,\n      parentKey,\n      data: {}\n    };\n    ops.push(op);\n    for (const [key, value] of this._map) {\n      if (isLiveNode(value)) {\n        ops.push(...value._toOps(this._id, key, pool));\n      } else {\n        op.data[key] = value;\n      }\n    }\n    return ops;\n  }\n  /** @internal */\n  static _deserialize([id, item], parentToChildren, pool) {\n    const liveObj = new _LiveObject(item.data);\n    liveObj._attach(id, pool);\n    return this._deserializeChildren(liveObj, parentToChildren, pool);\n  }\n  /** @internal */\n  static _deserializeChildren(liveObj, parentToChildren, pool) {\n    const children = parentToChildren.get(nn(liveObj._id));\n    if (children === void 0) {\n      return liveObj;\n    }\n    for (const [id, crdt] of children) {\n      const child = deserializeToLson([id, crdt], parentToChildren, pool);\n      if (isLiveStructure(child)) {\n        child._setParentLink(liveObj, crdt.parentKey);\n      }\n      liveObj._map.set(crdt.parentKey, child);\n      liveObj.invalidate();\n    }\n    return liveObj;\n  }\n  /** @internal */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const [_key, value] of this._map) {\n      if (isLiveNode(value)) {\n        value._attach(pool.generateId(), pool);\n      }\n    }\n  }\n  /** @internal */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, opId, parentKey: key } = op;\n    const child = creationOpToLson(op);\n    if (this._pool.getNode(id) !== void 0) {\n      if (this._propToLastUpdate.get(key) === opId) {\n        this._propToLastUpdate.delete(key);\n      }\n      return { modified: false };\n    }\n    if (source === 0 /* UNDOREDO_RECONNECT */) {\n      this._propToLastUpdate.set(key, nn(opId));\n    } else if (this._propToLastUpdate.get(key) === void 0) {\n    } else if (this._propToLastUpdate.get(key) === opId) {\n      this._propToLastUpdate.delete(key);\n      return { modified: false };\n    } else {\n      return { modified: false };\n    }\n    const thisId = nn(this._id);\n    const previousValue = this._map.get(key);\n    let reverse;\n    if (isLiveNode(previousValue)) {\n      reverse = previousValue._toOps(thisId, key);\n      previousValue._detach();\n    } else if (previousValue === void 0) {\n      reverse = [{ type: 6 /* DELETE_OBJECT_KEY */, id: thisId, key }];\n    } else {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          id: thisId,\n          data: { [key]: previousValue }\n        }\n      ];\n    }\n    this._map.set(key, child);\n    this.invalidate();\n    if (isLiveStructure(child)) {\n      child._setParentLink(this, key);\n      child._attach(id, this._pool);\n    }\n    return {\n      reverse,\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: { [key]: { type: \"update\" } }\n      }\n    };\n  }\n  /** @internal */\n  _detachChild(child) {\n    if (child) {\n      const id = nn(this._id);\n      const parentKey = nn(child._parentKey);\n      const reverse = child._toOps(id, parentKey, this._pool);\n      for (const [key, value] of this._map) {\n        if (value === child) {\n          this._map.delete(key);\n          this.invalidate();\n        }\n      }\n      child._detach();\n      const storageUpdate = {\n        node: this,\n        type: \"LiveObject\",\n        updates: {\n          [parentKey]: { type: \"delete\" }\n        }\n      };\n      return { modified: storageUpdate, reverse };\n    }\n    return { modified: false };\n  }\n  /**\n   * @internal\n   */\n  _detach() {\n    super._detach();\n    for (const value of this._map.values()) {\n      if (isLiveNode(value)) {\n        value._detach();\n      }\n    }\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    if (op.type === 3 /* UPDATE_OBJECT */) {\n      return this._applyUpdate(op, isLocal);\n    } else if (op.type === 6 /* DELETE_OBJECT_KEY */) {\n      return this._applyDeleteObjectKey(op, isLocal);\n    }\n    return super._apply(op, isLocal);\n  }\n  /**\n   * @internal\n   */\n  _serialize() {\n    const data = {};\n    for (const [key, value] of this._map) {\n      if (!isLiveNode(value)) {\n        data[key] = value;\n      }\n    }\n    if (this.parent.type === \"HasParent\" && this.parent.node._id) {\n      return {\n        type: 0 /* OBJECT */,\n        parentId: this.parent.node._id,\n        parentKey: this.parent.key,\n        data\n      };\n    } else {\n      return {\n        type: 0 /* OBJECT */,\n        data\n      };\n    }\n  }\n  /** @internal */\n  _applyUpdate(op, isLocal) {\n    let isModified = false;\n    const id = nn(this._id);\n    const reverse = [];\n    const reverseUpdate = {\n      type: 3 /* UPDATE_OBJECT */,\n      id,\n      data: {}\n    };\n    for (const key in op.data) {\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        reverse.push(...oldValue._toOps(id, key));\n        oldValue._detach();\n      } else if (oldValue !== void 0) {\n        reverseUpdate.data[key] = oldValue;\n      } else if (oldValue === void 0) {\n        reverse.push({ type: 6 /* DELETE_OBJECT_KEY */, id, key });\n      }\n    }\n    const updateDelta = {};\n    for (const key in op.data) {\n      const value = op.data[key];\n      if (value === void 0) {\n        continue;\n      }\n      if (isLocal) {\n        this._propToLastUpdate.set(key, nn(op.opId));\n      } else if (this._propToLastUpdate.get(key) === void 0) {\n        isModified = true;\n      } else if (this._propToLastUpdate.get(key) === op.opId) {\n        this._propToLastUpdate.delete(key);\n        continue;\n      } else {\n        continue;\n      }\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        oldValue._detach();\n      }\n      isModified = true;\n      updateDelta[key] = { type: \"update\" };\n      this._map.set(key, value);\n      this.invalidate();\n    }\n    if (Object.keys(reverseUpdate.data).length !== 0) {\n      reverse.unshift(reverseUpdate);\n    }\n    return isModified ? {\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: updateDelta\n      },\n      reverse\n    } : { modified: false };\n  }\n  /** @internal */\n  _applyDeleteObjectKey(op, isLocal) {\n    const key = op.key;\n    if (this._map.has(key) === false) {\n      return { modified: false };\n    }\n    if (!isLocal && this._propToLastUpdate.get(key) !== void 0) {\n      return { modified: false };\n    }\n    const oldValue = this._map.get(key);\n    const id = nn(this._id);\n    let reverse = [];\n    if (isLiveNode(oldValue)) {\n      reverse = oldValue._toOps(id, op.key);\n      oldValue._detach();\n    } else if (oldValue !== void 0) {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          id,\n          data: { [key]: oldValue }\n        }\n      ];\n    }\n    this._map.delete(key);\n    this.invalidate();\n    return {\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: { [op.key]: { type: \"delete\" } }\n      },\n      reverse\n    };\n  }\n  /**\n   * Transform the LiveObject into a javascript object\n   */\n  toObject() {\n    return Object.fromEntries(this._map);\n  }\n  /**\n   * Adds or updates a property with a specified key and a value.\n   * @param key The key of the property to add\n   * @param value The value of the property to add\n   */\n  set(key, value) {\n    this._pool?.assertStorageIsWritable();\n    this.update({ [key]: value });\n  }\n  /**\n   * Returns a specified property from the LiveObject.\n   * @param key The key of the property to get\n   */\n  get(key) {\n    return this._map.get(key);\n  }\n  /**\n   * Deletes a key from the LiveObject\n   * @param key The key of the property to delete\n   */\n  delete(key) {\n    this._pool?.assertStorageIsWritable();\n    const keyAsString = key;\n    const oldValue = this._map.get(keyAsString);\n    if (oldValue === void 0) {\n      return;\n    }\n    if (this._pool === void 0 || this._id === void 0) {\n      if (isLiveNode(oldValue)) {\n        oldValue._detach();\n      }\n      this._map.delete(keyAsString);\n      this.invalidate();\n      return;\n    }\n    let reverse;\n    if (isLiveNode(oldValue)) {\n      oldValue._detach();\n      reverse = oldValue._toOps(this._id, keyAsString);\n    } else {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          data: { [keyAsString]: oldValue },\n          id: this._id\n        }\n      ];\n    }\n    this._map.delete(keyAsString);\n    this.invalidate();\n    const storageUpdates = /* @__PURE__ */ new Map();\n    storageUpdates.set(this._id, {\n      node: this,\n      type: \"LiveObject\",\n      updates: { [key]: { type: \"delete\" } }\n    });\n    this._pool.dispatch(\n      [\n        {\n          type: 6 /* DELETE_OBJECT_KEY */,\n          key: keyAsString,\n          id: this._id,\n          opId: this._pool.generateOpId()\n        }\n      ],\n      reverse,\n      storageUpdates\n    );\n  }\n  /**\n   * Adds or updates multiple properties at once with an object.\n   * @param patch The object used to overrides properties\n   */\n  update(patch) {\n    this._pool?.assertStorageIsWritable();\n    if (this._pool === void 0 || this._id === void 0) {\n      for (const key in patch) {\n        const newValue = patch[key];\n        if (newValue === void 0) {\n          continue;\n        }\n        const oldValue = this._map.get(key);\n        if (isLiveNode(oldValue)) {\n          oldValue._detach();\n        }\n        if (isLiveNode(newValue)) {\n          newValue._setParentLink(this, key);\n        }\n        this._map.set(key, newValue);\n        this.invalidate();\n      }\n      return;\n    }\n    const ops = [];\n    const reverseOps = [];\n    const opId = this._pool.generateOpId();\n    const updatedProps = {};\n    const reverseUpdateOp = {\n      id: this._id,\n      type: 3 /* UPDATE_OBJECT */,\n      data: {}\n    };\n    const updateDelta = {};\n    for (const key in patch) {\n      const newValue = patch[key];\n      if (newValue === void 0) {\n        continue;\n      }\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        reverseOps.push(...oldValue._toOps(this._id, key));\n        oldValue._detach();\n      } else if (oldValue === void 0) {\n        reverseOps.push({ type: 6 /* DELETE_OBJECT_KEY */, id: this._id, key });\n      } else {\n        reverseUpdateOp.data[key] = oldValue;\n      }\n      if (isLiveNode(newValue)) {\n        newValue._setParentLink(this, key);\n        newValue._attach(this._pool.generateId(), this._pool);\n        const newAttachChildOps = newValue._toOps(this._id, key, this._pool);\n        const createCrdtOp = newAttachChildOps.find(\n          (op) => op.parentId === this._id\n        );\n        if (createCrdtOp) {\n          this._propToLastUpdate.set(key, nn(createCrdtOp.opId));\n        }\n        ops.push(...newAttachChildOps);\n      } else {\n        updatedProps[key] = newValue;\n        this._propToLastUpdate.set(key, opId);\n      }\n      this._map.set(key, newValue);\n      this.invalidate();\n      updateDelta[key] = { type: \"update\" };\n    }\n    if (Object.keys(reverseUpdateOp.data).length !== 0) {\n      reverseOps.unshift(reverseUpdateOp);\n    }\n    if (Object.keys(updatedProps).length !== 0) {\n      ops.unshift({\n        opId,\n        id: this._id,\n        type: 3 /* UPDATE_OBJECT */,\n        data: updatedProps\n      });\n    }\n    const storageUpdates = /* @__PURE__ */ new Map();\n    storageUpdates.set(this._id, {\n      node: this,\n      type: \"LiveObject\",\n      updates: updateDelta\n    });\n    this._pool.dispatch(ops, reverseOps, storageUpdates);\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  toTreeNode(key) {\n    return super.toTreeNode(key);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    const nodeId = this._id ?? nanoid();\n    return {\n      type: \"LiveObject\",\n      id: nodeId,\n      key,\n      payload: Array.from(this._map.entries()).map(\n        ([key2, value]) => isLiveNode(value) ? value.toTreeNode(key2) : { type: \"Json\", id: `${nodeId}:${key2}`, key: key2, payload: value }\n      )\n    };\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = {};\n    for (const [key, val] of this._map) {\n      result[key] = isLiveStructure(val) ? val.toImmutable() : val;\n    }\n    return  false ? 0 : Object.freeze(result);\n  }\n  clone() {\n    return new _LiveObject(\n      Object.fromEntries(\n        Array.from(this._map).map(([key, value]) => [\n          key,\n          isLiveStructure(value) ? value.clone() : deepClone(value)\n        ])\n      )\n    );\n  }\n};\n\n// src/crdts/liveblocks-helpers.ts\nfunction creationOpToLiveNode(op) {\n  return lsonToLiveNode(creationOpToLson(op));\n}\nfunction creationOpToLson(op) {\n  switch (op.type) {\n    case 8 /* CREATE_REGISTER */:\n      return op.data;\n    case 4 /* CREATE_OBJECT */:\n      return new LiveObject(op.data);\n    case 7 /* CREATE_MAP */:\n      return new LiveMap();\n    case 2 /* CREATE_LIST */:\n      return new LiveList([]);\n    default:\n      return assertNever(op, \"Unknown creation Op\");\n  }\n}\nfunction isSameNodeOrChildOf(node, parent) {\n  if (node === parent) {\n    return true;\n  }\n  if (node.parent.type === \"HasParent\") {\n    return isSameNodeOrChildOf(node.parent.node, parent);\n  }\n  return false;\n}\nfunction deserialize([id, crdt], parentToChildren, pool) {\n  switch (crdt.type) {\n    case 0 /* OBJECT */: {\n      return LiveObject._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 1 /* LIST */: {\n      return LiveList._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 2 /* MAP */: {\n      return LiveMap._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 3 /* REGISTER */: {\n      return LiveRegister._deserialize([id, crdt], parentToChildren, pool);\n    }\n    default: {\n      throw new Error(\"Unexpected CRDT type\");\n    }\n  }\n}\nfunction deserializeToLson([id, crdt], parentToChildren, pool) {\n  switch (crdt.type) {\n    case 0 /* OBJECT */: {\n      return LiveObject._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 1 /* LIST */: {\n      return LiveList._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 2 /* MAP */: {\n      return LiveMap._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 3 /* REGISTER */: {\n      return crdt.data;\n    }\n    default: {\n      throw new Error(\"Unexpected CRDT type\");\n    }\n  }\n}\nfunction isLiveStructure(value) {\n  return isLiveList(value) || isLiveMap(value) || isLiveObject(value);\n}\nfunction isLiveNode(value) {\n  return isLiveStructure(value) || isLiveRegister(value);\n}\nfunction isLiveList(value) {\n  return value instanceof LiveList;\n}\nfunction isLiveMap(value) {\n  return value instanceof LiveMap;\n}\nfunction isLiveObject(value) {\n  return value instanceof LiveObject;\n}\nfunction isLiveRegister(value) {\n  return value instanceof LiveRegister;\n}\nfunction cloneLson(value) {\n  return value === void 0 ? void 0 : isLiveStructure(value) ? value.clone() : deepClone(value);\n}\nfunction liveNodeToLson(obj) {\n  if (obj instanceof LiveRegister) {\n    return obj.data;\n  } else if (obj instanceof LiveList || obj instanceof LiveMap || obj instanceof LiveObject) {\n    return obj;\n  } else {\n    return assertNever(obj, \"Unknown AbstractCrdt\");\n  }\n}\nfunction lsonToLiveNode(value) {\n  if (value instanceof LiveObject || value instanceof LiveMap || value instanceof LiveList) {\n    return value;\n  } else {\n    return new LiveRegister(value);\n  }\n}\nfunction getTreesDiffOperations(currentItems, newItems) {\n  const ops = [];\n  currentItems.forEach((_, id) => {\n    if (!newItems.get(id)) {\n      ops.push({\n        type: 5 /* DELETE_CRDT */,\n        id\n      });\n    }\n  });\n  newItems.forEach((crdt, id) => {\n    const currentCrdt = currentItems.get(id);\n    if (currentCrdt) {\n      if (crdt.type === 0 /* OBJECT */) {\n        if (currentCrdt.type !== 0 /* OBJECT */ || JSON.stringify(crdt.data) !== JSON.stringify(currentCrdt.data)) {\n          ops.push({\n            type: 3 /* UPDATE_OBJECT */,\n            id,\n            data: crdt.data\n          });\n        }\n      }\n      if (crdt.parentKey !== currentCrdt.parentKey) {\n        ops.push({\n          type: 1 /* SET_PARENT_KEY */,\n          id,\n          parentKey: nn(crdt.parentKey, \"Parent key must not be missing\")\n        });\n      }\n    } else {\n      switch (crdt.type) {\n        case 3 /* REGISTER */:\n          ops.push({\n            type: 8 /* CREATE_REGISTER */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey,\n            data: crdt.data\n          });\n          break;\n        case 1 /* LIST */:\n          ops.push({\n            type: 2 /* CREATE_LIST */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey\n          });\n          break;\n        case 0 /* OBJECT */:\n          if (crdt.parentId === void 0 || crdt.parentKey === void 0) {\n            throw new Error(\n              \"Internal error. Cannot serialize storage root into an operation\"\n            );\n          }\n          ops.push({\n            type: 4 /* CREATE_OBJECT */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey,\n            data: crdt.data\n          });\n          break;\n        case 2 /* MAP */:\n          ops.push({\n            type: 7 /* CREATE_MAP */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey\n          });\n          break;\n      }\n    }\n  });\n  return ops;\n}\nfunction mergeObjectStorageUpdates(first, second) {\n  const updates = first.updates;\n  for (const [key, value] of entries(second.updates)) {\n    updates[key] = value;\n  }\n  return {\n    ...second,\n    updates\n  };\n}\nfunction mergeMapStorageUpdates(first, second) {\n  const updates = first.updates;\n  for (const [key, value] of entries(second.updates)) {\n    updates[key] = value;\n  }\n  return {\n    ...second,\n    updates\n  };\n}\nfunction mergeListStorageUpdates(first, second) {\n  const updates = first.updates;\n  return {\n    ...second,\n    updates: updates.concat(second.updates)\n  };\n}\nfunction mergeStorageUpdates(first, second) {\n  if (first === void 0) {\n    return second;\n  }\n  if (first.type === \"LiveObject\" && second.type === \"LiveObject\") {\n    return mergeObjectStorageUpdates(first, second);\n  } else if (first.type === \"LiveMap\" && second.type === \"LiveMap\") {\n    return mergeMapStorageUpdates(first, second);\n  } else if (first.type === \"LiveList\" && second.type === \"LiveList\") {\n    return mergeListStorageUpdates(first, second);\n  } else {\n  }\n  return second;\n}\nfunction isPlain(value) {\n  const type = typeof value;\n  return value === void 0 || value === null || type === \"string\" || type === \"boolean\" || type === \"number\" || Array.isArray(value) || isPlainObject(value);\n}\nfunction findNonSerializableValue(value, path = \"\") {\n  if (!isPlain) {\n    return {\n      path: path || \"root\",\n      value\n    };\n  }\n  if (typeof value !== \"object\" || value === null) {\n    return false;\n  }\n  for (const [key, nestedValue] of Object.entries(value)) {\n    const nestedPath = path ? path + \".\" + key : key;\n    if (!isPlain(nestedValue)) {\n      return {\n        path: nestedPath,\n        value: nestedValue\n      };\n    }\n    if (typeof nestedValue === \"object\") {\n      const nonSerializableNestedValue = findNonSerializableValue(\n        nestedValue,\n        nestedPath\n      );\n      if (nonSerializableNestedValue) {\n        return nonSerializableNestedValue;\n      }\n    }\n  }\n  return false;\n}\n\n// src/lib/createIds.ts\nvar THREAD_ID_PREFIX = \"th\";\nvar COMMENT_ID_PREFIX = \"cm\";\nvar INBOX_NOTIFICATION_ID_PREFIX = \"in\";\nfunction createOptimisticId(prefix) {\n  return `${prefix}_${nanoid()}`;\n}\nfunction createThreadId() {\n  return createOptimisticId(THREAD_ID_PREFIX);\n}\nfunction createCommentId() {\n  return createOptimisticId(COMMENT_ID_PREFIX);\n}\nfunction createInboxNotificationId() {\n  return createOptimisticId(INBOX_NOTIFICATION_ID_PREFIX);\n}\n\n// src/lib/debug.ts\nfunction captureStackTrace(msg, traceRoot) {\n  const errorLike = { name: msg };\n  if (typeof Error.captureStackTrace !== \"function\") {\n    return void 0;\n  }\n  Error.captureStackTrace(errorLike, traceRoot);\n  return errorLike.stack;\n}\n\n// src/lib/Json.ts\nfunction isJsonScalar(data) {\n  return data === null || typeof data === \"string\" || typeof data === \"number\" || typeof data === \"boolean\";\n}\nfunction isJsonArray(data) {\n  return Array.isArray(data);\n}\nfunction isJsonObject(data) {\n  return !isJsonScalar(data) && !isJsonArray(data);\n}\n\n// src/lib/objectToQuery.ts\nvar identifierRegex = /^[a-zA-Z_][a-zA-Z0-9_]*$/;\nfunction objectToQuery(obj) {\n  let filterList = [];\n  const entries2 = Object.entries(obj);\n  const keyValuePairs = [];\n  const keyValuePairsWithOperator = [];\n  const indexedKeys = [];\n  entries2.forEach(([key, value]) => {\n    if (!identifierRegex.test(key)) {\n      throw new Error(\"Key must only contain letters, numbers, _\");\n    }\n    if (isSimpleValue(value)) {\n      keyValuePairs.push([key, value]);\n    } else if (isValueWithOperator(value)) {\n      keyValuePairsWithOperator.push([key, value]);\n    } else if (typeof value === \"object\" && !(\"startsWith\" in value)) {\n      indexedKeys.push([key, value]);\n    }\n  });\n  filterList = [\n    ...getFiltersFromKeyValuePairs(keyValuePairs),\n    ...getFiltersFromKeyValuePairsWithOperator(keyValuePairsWithOperator)\n  ];\n  indexedKeys.forEach(([key, value]) => {\n    const nestedEntries = Object.entries(value);\n    const nKeyValuePairs = [];\n    const nKeyValuePairsWithOperator = [];\n    nestedEntries.forEach(([nestedKey, nestedValue]) => {\n      if (isStringEmpty(nestedKey)) {\n        throw new Error(\"Key cannot be empty\");\n      }\n      if (isSimpleValue(nestedValue)) {\n        nKeyValuePairs.push([formatFilterKey(key, nestedKey), nestedValue]);\n      } else if (isValueWithOperator(nestedValue)) {\n        nKeyValuePairsWithOperator.push([\n          formatFilterKey(key, nestedKey),\n          nestedValue\n        ]);\n      }\n    });\n    filterList = [\n      ...filterList,\n      ...getFiltersFromKeyValuePairs(nKeyValuePairs),\n      ...getFiltersFromKeyValuePairsWithOperator(nKeyValuePairsWithOperator)\n    ];\n  });\n  return filterList.map(\n    ({ key, operator, value }) => formatFilter(key, operator, formatFilterValue(value))\n  ).join(\" AND \");\n}\nvar getFiltersFromKeyValuePairs = (keyValuePairs) => {\n  const filters = [];\n  keyValuePairs.forEach(([key, value]) => {\n    filters.push({\n      key,\n      operator: \":\",\n      value\n    });\n  });\n  return filters;\n};\nvar getFiltersFromKeyValuePairsWithOperator = (keyValuePairsWithOperator) => {\n  const filters = [];\n  keyValuePairsWithOperator.forEach(([key, value]) => {\n    if (\"startsWith\" in value && typeof value.startsWith === \"string\") {\n      filters.push({\n        key,\n        operator: \"^\",\n        value: value.startsWith\n      });\n    }\n  });\n  return filters;\n};\nvar isSimpleValue = (value) => {\n  if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\n    return true;\n  }\n  return false;\n};\nvar isValueWithOperator = (value) => {\n  if (typeof value === \"object\" && value !== null && \"startsWith\" in value) {\n    return true;\n  }\n  return false;\n};\nvar formatFilter = (key, operator, value) => {\n  return `${key}${operator}${value}`;\n};\nvar formatFilterKey = (key, nestedKey) => {\n  if (nestedKey) {\n    return `${key}[${JSON.stringify(nestedKey)}]`;\n  }\n  return key;\n};\nvar formatFilterValue = (value) => {\n  if (typeof value === \"string\") {\n    if (isStringEmpty(value)) {\n      throw new Error(\"Value cannot be empty\");\n    }\n    return JSON.stringify(value);\n  }\n  return value.toString();\n};\nvar isStringEmpty = (value) => {\n  return !value || value.toString().trim() === \"\";\n};\n\n// src/protocol/ClientMsg.ts\nvar ClientMsgCode = /* @__PURE__ */ ((ClientMsgCode2) => {\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_PRESENCE\"] = 100] = \"UPDATE_PRESENCE\";\n  ClientMsgCode2[ClientMsgCode2[\"BROADCAST_EVENT\"] = 103] = \"BROADCAST_EVENT\";\n  ClientMsgCode2[ClientMsgCode2[\"FETCH_STORAGE\"] = 200] = \"FETCH_STORAGE\";\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_STORAGE\"] = 201] = \"UPDATE_STORAGE\";\n  ClientMsgCode2[ClientMsgCode2[\"FETCH_YDOC\"] = 300] = \"FETCH_YDOC\";\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_YDOC\"] = 301] = \"UPDATE_YDOC\";\n  return ClientMsgCode2;\n})(ClientMsgCode || {});\n\n// src/refs/ImmutableRef.ts\nfunction merge(target, patch) {\n  let updated = false;\n  const newValue = { ...target };\n  Object.keys(patch).forEach((k) => {\n    const key = k;\n    const val = patch[key];\n    if (newValue[key] !== val) {\n      if (val === void 0) {\n        delete newValue[key];\n      } else {\n        newValue[key] = val;\n      }\n      updated = true;\n    }\n  });\n  return updated ? newValue : target;\n}\nvar ImmutableRef = class {\n  constructor() {\n    this._ev = makeEventSource();\n  }\n  get didInvalidate() {\n    return this._ev.observable;\n  }\n  invalidate() {\n    if (this._cache !== void 0) {\n      this._cache = void 0;\n      this._ev.notify();\n    }\n  }\n  get current() {\n    return this._cache ?? (this._cache = this._toImmutable());\n  }\n};\n\n// src/refs/OthersRef.ts\nfunction makeUser(conn, presence) {\n  const { connectionId, id, info } = conn;\n  const canWrite = canWriteStorage(conn.scopes);\n  return freeze(\n    compactObject({\n      connectionId,\n      id,\n      info,\n      canWrite,\n      canComment: canComment(conn.scopes),\n      isReadOnly: !canWrite,\n      // Deprecated, kept for backward-compatibility\n      presence\n    })\n  );\n}\nvar OthersRef = class extends ImmutableRef {\n  //\n  // --------------------------------------------------------------\n  //\n  constructor() {\n    super();\n    this._connections = /* @__PURE__ */ new Map();\n    this._presences = /* @__PURE__ */ new Map();\n    this._users = /* @__PURE__ */ new Map();\n  }\n  connectionIds() {\n    return this._connections.keys();\n  }\n  /** @internal */\n  _toImmutable() {\n    const users = compact(\n      Array.from(this._presences.keys()).map(\n        (connectionId) => this.getUser(Number(connectionId))\n      )\n    );\n    return users;\n  }\n  clearOthers() {\n    this._connections = /* @__PURE__ */ new Map();\n    this._presences = /* @__PURE__ */ new Map();\n    this._users = /* @__PURE__ */ new Map();\n    this.invalidate();\n  }\n  /** @internal */\n  _getUser(connectionId) {\n    const conn = this._connections.get(connectionId);\n    const presence = this._presences.get(connectionId);\n    if (conn !== void 0 && presence !== void 0) {\n      return makeUser(conn, presence);\n    }\n    return void 0;\n  }\n  getUser(connectionId) {\n    const cachedUser = this._users.get(connectionId);\n    if (cachedUser) {\n      return cachedUser;\n    }\n    const computedUser = this._getUser(connectionId);\n    if (computedUser) {\n      this._users.set(connectionId, computedUser);\n      return computedUser;\n    }\n    return void 0;\n  }\n  /** @internal */\n  _invalidateUser(connectionId) {\n    if (this._users.has(connectionId)) {\n      this._users.delete(connectionId);\n    }\n    this.invalidate();\n  }\n  /**\n   * Records a known connection. This records the connection ID and the\n   * associated metadata.\n   */\n  setConnection(connectionId, metaUserId, metaUserInfo, scopes) {\n    this._connections.set(\n      connectionId,\n      freeze({\n        connectionId,\n        id: metaUserId,\n        info: metaUserInfo,\n        scopes\n      })\n    );\n    if (this._presences.has(connectionId)) {\n      this._invalidateUser(connectionId);\n    }\n  }\n  /**\n   * Removes a known connectionId. Removes both the connection's metadata and\n   * the presence information.\n   */\n  removeConnection(connectionId) {\n    this._connections.delete(connectionId);\n    this._presences.delete(connectionId);\n    this._invalidateUser(connectionId);\n  }\n  /**\n   * Stores a new user from a full presence update. If the user already exists,\n   * its known presence data is overwritten.\n   */\n  setOther(connectionId, presence) {\n    this._presences.set(connectionId, freeze(compactObject(presence)));\n    if (this._connections.has(connectionId)) {\n      this._invalidateUser(connectionId);\n    }\n  }\n  /**\n   * Patches the presence data for an existing \"other\". If we don't know the\n   * initial presence data for this user yet, discard this patch and await the\n   * full .setOther() call first.\n   */\n  patchOther(connectionId, patch) {\n    const oldPresence = this._presences.get(connectionId);\n    if (oldPresence === void 0) {\n      return;\n    }\n    const newPresence = merge(oldPresence, patch);\n    if (oldPresence !== newPresence) {\n      this._presences.set(connectionId, freeze(newPresence));\n      this._invalidateUser(connectionId);\n    }\n  }\n};\n\n// src/refs/PatchableRef.ts\nvar PatchableRef = class extends ImmutableRef {\n  constructor(data) {\n    super();\n    this._data = freeze(compactObject(data));\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._data;\n  }\n  /**\n   * Patches the current object.\n   */\n  patch(patch) {\n    const oldData = this._data;\n    const newData = merge(oldData, patch);\n    if (oldData !== newData) {\n      this._data = freeze(newData);\n      this.invalidate();\n    }\n  }\n};\n\n// src/refs/ValueRef.ts\nvar ValueRef = class extends ImmutableRef {\n  constructor(initialValue) {\n    super();\n    this._value = freeze(initialValue);\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._value;\n  }\n  set(newValue) {\n    this._value = freeze(newValue);\n    this.invalidate();\n  }\n};\nvar DerivedRef = class extends ImmutableRef {\n  constructor(...args) {\n    super();\n    const transformFn = args.pop();\n    const otherRefs = args;\n    this._refs = otherRefs;\n    this._refs.forEach((ref) => {\n      ref.didInvalidate.subscribe(() => this.invalidate());\n    });\n    this._transform = transformFn;\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._transform(\n      ...this._refs.map((ref) => ref.current)\n    );\n  }\n};\n\n// src/room.ts\nvar MAX_SOCKET_MESSAGE_SIZE = 1024 * 1024 - 1024;\nfunction makeIdFactory(connectionId) {\n  let count = 0;\n  return () => `${connectionId}:${count++}`;\n}\nfunction userToTreeNode(key, user) {\n  return {\n    type: \"User\",\n    id: `${user.connectionId}`,\n    key,\n    payload: {\n      connectionId: user.connectionId,\n      id: user.id,\n      info: user.info,\n      presence: user.presence,\n      isReadOnly: !user.canWrite\n    }\n  };\n}\nfunction installBackgroundTabSpy() {\n  const doc = typeof document !== \"undefined\" ? document : void 0;\n  const inBackgroundSince = { current: null };\n  function onVisibilityChange() {\n    if (doc?.visibilityState === \"hidden\") {\n      inBackgroundSince.current = inBackgroundSince.current ?? Date.now();\n    } else {\n      inBackgroundSince.current = null;\n    }\n  }\n  doc?.addEventListener(\"visibilitychange\", onVisibilityChange);\n  const unsub = () => {\n    doc?.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  };\n  return [inBackgroundSince, unsub];\n}\nvar CommentsApiError = class extends Error {\n  constructor(message, status, details) {\n    super(message);\n    this.message = message;\n    this.status = status;\n    this.details = details;\n  }\n};\nfunction createCommentsApi(roomId, getAuthValue, fetchClientApi) {\n  async function fetchCommentsApi(endpoint, params, options) {\n    const authValue = await getAuthValue();\n    return fetchClientApi(roomId, endpoint, authValue, options, params);\n  }\n  async function fetchJson(endpoint, options, params) {\n    const response = await fetchCommentsApi(endpoint, params, options);\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new CommentsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new CommentsApiError(response.statusText, response.status);\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  async function getThreadsSince(options) {\n    const response = await fetchCommentsApi(\n      \"/threads\",\n      {\n        since: options?.since?.toISOString()\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        threads: {\n          updated: json.data.map(convertToThreadData),\n          deleted: json.deletedThreads.map(convertToThreadDeleteInfo)\n        },\n        inboxNotifications: {\n          updated: json.inboxNotifications.map(convertToInboxNotificationData),\n          deleted: json.deletedInboxNotifications.map(\n            convertToInboxNotificationDeleteInfo\n          )\n        },\n        requestedAt: new Date(json.meta.requestedAt)\n      };\n    } else if (response.status === 404) {\n      return {\n        threads: {\n          updated: [],\n          deleted: []\n        },\n        inboxNotifications: {\n          updated: [],\n          deleted: []\n        },\n        requestedAt: /* @__PURE__ */ new Date()\n      };\n    } else {\n      throw new Error(\"There was an error while getting threads.\");\n    }\n  }\n  async function getThreads(options) {\n    let query;\n    if (options?.query) {\n      query = objectToQuery(options.query);\n    }\n    const response = await fetchCommentsApi(\n      \"/threads\",\n      {\n        query\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        threads: json.data.map(convertToThreadData),\n        inboxNotifications: json.inboxNotifications.map(\n          convertToInboxNotificationData\n        ),\n        requestedAt: new Date(json.meta.requestedAt)\n      };\n    } else if (response.status === 404) {\n      return {\n        threads: [],\n        inboxNotifications: [],\n        deletedThreads: [],\n        deletedInboxNotifications: [],\n        requestedAt: /* @__PURE__ */ new Date()\n      };\n    } else {\n      throw new Error(\"There was an error while getting threads.\");\n    }\n  }\n  async function getThread(threadId) {\n    const response = await fetchCommentsApi(\n      `/thread-with-notification/${threadId}`\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        thread: convertToThreadData(json.thread),\n        inboxNotification: json.inboxNotification ? convertToInboxNotificationData(json.inboxNotification) : void 0\n      };\n    } else if (response.status === 404) {\n      return {\n        thread: void 0,\n        inboxNotification: void 0\n      };\n    } else {\n      throw new Error(`There was an error while getting thread ${threadId}.`);\n    }\n  }\n  async function createThread({\n    metadata,\n    body,\n    commentId = createCommentId(),\n    threadId = createThreadId()\n  }) {\n    const thread = await fetchJson(\"/threads\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: threadId,\n        comment: {\n          id: commentId,\n          body\n        },\n        metadata\n      })\n    });\n    return convertToThreadData(thread);\n  }\n  async function deleteThread(threadId) {\n    await fetchJson(`/threads/${encodeURIComponent(threadId)}`, {\n      method: \"DELETE\"\n    });\n  }\n  async function editThreadMetadata({\n    metadata,\n    threadId\n  }) {\n    return await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/metadata`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(metadata)\n      }\n    );\n  }\n  async function markThreadAsResolved(threadId) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/mark-as-resolved`,\n      {\n        method: \"POST\"\n      }\n    );\n  }\n  async function markThreadAsUnresolved(threadId) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/mark-as-unresolved`,\n      {\n        method: \"POST\"\n      }\n    );\n  }\n  async function createComment({\n    threadId,\n    commentId = createCommentId(),\n    body\n  }) {\n    const comment = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          id: commentId,\n          body\n        })\n      }\n    );\n    return convertToCommentData(comment);\n  }\n  async function editComment({\n    threadId,\n    commentId,\n    body\n  }) {\n    const comment = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          body\n        })\n      }\n    );\n    return convertToCommentData(comment);\n  }\n  async function deleteComment2({\n    threadId,\n    commentId\n  }) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  async function addReaction2({\n    threadId,\n    commentId,\n    emoji\n  }) {\n    const reaction = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}/reactions`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({ emoji })\n      }\n    );\n    return convertToCommentUserReaction(reaction);\n  }\n  async function removeReaction2({\n    threadId,\n    commentId,\n    emoji\n  }) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}/reactions/${encodeURIComponent(emoji)}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  return {\n    getThreads,\n    getThreadsSince,\n    getThread,\n    createThread,\n    deleteThread,\n    editThreadMetadata,\n    markThreadAsResolved,\n    markThreadAsUnresolved,\n    createComment,\n    editComment,\n    deleteComment: deleteComment2,\n    addReaction: addReaction2,\n    removeReaction: removeReaction2\n  };\n}\nvar MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY2 = 50;\nfunction createRoom(options, config) {\n  const initialPresence = options.initialPresence;\n  const initialStorage = options.initialStorage;\n  const [inBackgroundSince, uninstallBgTabSpy] = installBackgroundTabSpy();\n  const delegates = {\n    ...config.delegates,\n    // A connection is allowed to go into \"zombie state\" only if all of the\n    // following conditions apply:\n    //\n    // - The `backgroundKeepAliveTimeout` client option is configured\n    // - The browser window has been in the background for at least\n    //   `backgroundKeepAliveTimeout` milliseconds\n    // - There are no pending changes\n    //\n    canZombie() {\n      return config.backgroundKeepAliveTimeout !== void 0 && inBackgroundSince.current !== null && Date.now() > inBackgroundSince.current + config.backgroundKeepAliveTimeout && getStorageStatus() !== \"synchronizing\";\n    }\n  };\n  const managedSocket = new ManagedSocket(\n    delegates,\n    config.enableDebugLogging\n  );\n  const context = {\n    buffer: {\n      flushTimerID: void 0,\n      lastFlushedAt: 0,\n      presenceUpdates: (\n        // Queue up the initial presence message as a Full Presence update\n        {\n          type: \"full\",\n          data: initialPresence\n        }\n      ),\n      messages: [],\n      storageOperations: []\n    },\n    staticSessionInfo: new ValueRef(null),\n    dynamicSessionInfo: new ValueRef(null),\n    myPresence: new PatchableRef(initialPresence),\n    others: new OthersRef(),\n    initialStorage,\n    idFactory: null,\n    // Storage\n    clock: 0,\n    opClock: 0,\n    nodes: /* @__PURE__ */ new Map(),\n    root: void 0,\n    undoStack: [],\n    redoStack: [],\n    pausedHistory: null,\n    activeBatch: null,\n    unacknowledgedOps: /* @__PURE__ */ new Map(),\n    // Debug\n    opStackTraces:  true ? /* @__PURE__ */ new Map() : 0\n  };\n  const doNotBatchUpdates = (cb) => cb();\n  const batchUpdates = config.unstable_batchedUpdates ?? doNotBatchUpdates;\n  let lastTokenKey;\n  function onStatusDidChange(newStatus) {\n    const authValue = managedSocket.authValue;\n    if (authValue !== null) {\n      const tokenKey = getAuthBearerHeaderFromAuthValue(authValue);\n      if (tokenKey !== lastTokenKey) {\n        lastTokenKey = tokenKey;\n        if (authValue.type === \"secret\") {\n          const token = authValue.token.parsed;\n          context.staticSessionInfo.set({\n            userId: token.k === \"sec-legacy\" /* SECRET_LEGACY */ ? token.id : token.uid,\n            userInfo: token.k === \"sec-legacy\" /* SECRET_LEGACY */ ? token.info : token.ui\n          });\n        } else {\n          context.staticSessionInfo.set({\n            userId: void 0,\n            userInfo: void 0\n          });\n        }\n      }\n    }\n    batchUpdates(() => {\n      eventHub.status.notify(newStatus);\n      notifySelfChanged(doNotBatchUpdates);\n    });\n  }\n  let _connectionLossTimerId;\n  let _hasLostConnection = false;\n  function handleConnectionLossEvent(newStatus) {\n    if (newStatus === \"reconnecting\") {\n      _connectionLossTimerId = setTimeout(() => {\n        batchUpdates(() => {\n          eventHub.lostConnection.notify(\"lost\");\n          _hasLostConnection = true;\n          context.others.clearOthers();\n          notify({ others: [{ type: \"reset\" }] }, doNotBatchUpdates);\n        });\n      }, config.lostConnectionTimeout);\n    } else {\n      clearTimeout(_connectionLossTimerId);\n      if (_hasLostConnection) {\n        if (newStatus === \"disconnected\") {\n          batchUpdates(() => {\n            eventHub.lostConnection.notify(\"failed\");\n          });\n        } else {\n          batchUpdates(() => {\n            eventHub.lostConnection.notify(\"restored\");\n          });\n        }\n        _hasLostConnection = false;\n      }\n    }\n  }\n  function onDidConnect() {\n    context.buffer.presenceUpdates = {\n      type: \"full\",\n      data: (\n        // Because context.me.current is a readonly object, we'll have to\n        // make a copy here. Otherwise, type errors happen later when\n        // \"patching\" my presence.\n        { ...context.myPresence.current }\n      )\n    };\n    if (_getStorage$ !== null) {\n      refreshStorage({ flush: false });\n    }\n    flushNowOrSoon();\n  }\n  function onDidDisconnect() {\n    clearTimeout(context.buffer.flushTimerID);\n  }\n  managedSocket.events.onMessage.subscribe(handleServerMessage);\n  managedSocket.events.statusDidChange.subscribe(onStatusDidChange);\n  managedSocket.events.statusDidChange.subscribe(handleConnectionLossEvent);\n  managedSocket.events.didConnect.subscribe(onDidConnect);\n  managedSocket.events.didDisconnect.subscribe(onDidDisconnect);\n  managedSocket.events.onLiveblocksError.subscribe((err) => {\n    batchUpdates(() => {\n      if (true) {\n        error2(\n          `Connection to websocket server closed. Reason: ${err.message} (code: ${err.code}).`\n        );\n      }\n      eventHub.error.notify(err);\n    });\n  });\n  const pool = {\n    roomId: config.roomId,\n    getNode: (id) => context.nodes.get(id),\n    addNode: (id, node) => void context.nodes.set(id, node),\n    deleteNode: (id) => void context.nodes.delete(id),\n    generateId: () => `${getConnectionId()}:${context.clock++}`,\n    generateOpId: () => `${getConnectionId()}:${context.opClock++}`,\n    dispatch(ops, reverse, storageUpdates) {\n      const activeBatch = context.activeBatch;\n      if (true) {\n        const stackTrace = captureStackTrace(\"Storage mutation\", this.dispatch);\n        if (stackTrace) {\n          for (const op of ops) {\n            if (op.opId) {\n              nn(context.opStackTraces).set(op.opId, stackTrace);\n            }\n          }\n        }\n      }\n      if (activeBatch) {\n        for (const op of ops) {\n          activeBatch.ops.push(op);\n        }\n        for (const [key, value] of storageUpdates) {\n          activeBatch.updates.storageUpdates.set(\n            key,\n            mergeStorageUpdates(\n              activeBatch.updates.storageUpdates.get(key),\n              value\n            )\n          );\n        }\n        activeBatch.reverseOps.unshift(...reverse);\n      } else {\n        batchUpdates(() => {\n          addToUndoStack(reverse, doNotBatchUpdates);\n          context.redoStack.length = 0;\n          dispatchOps(ops);\n          notify({ storageUpdates }, doNotBatchUpdates);\n        });\n      }\n    },\n    assertStorageIsWritable: () => {\n      const scopes = context.dynamicSessionInfo.current?.scopes;\n      if (scopes === void 0) {\n        return;\n      }\n      const canWrite = canWriteStorage(scopes);\n      if (!canWrite) {\n        throw new Error(\n          \"Cannot write to storage with a read only user, please ensure the user has write permissions\"\n        );\n      }\n    }\n  };\n  const eventHub = {\n    status: makeEventSource(),\n    // New/recommended API\n    lostConnection: makeEventSource(),\n    customEvent: makeEventSource(),\n    self: makeEventSource(),\n    myPresence: makeEventSource(),\n    others: makeEventSource(),\n    error: makeEventSource(),\n    storageBatch: makeEventSource(),\n    history: makeEventSource(),\n    storageDidLoad: makeEventSource(),\n    storageStatus: makeEventSource(),\n    ydoc: makeEventSource(),\n    comments: makeEventSource()\n  };\n  async function fetchClientApi(roomId, endpoint, authValue, options2, params) {\n    const url = urljoin(\n      config.baseUrl,\n      `/v2/c/rooms/${encodeURIComponent(roomId)}${endpoint}`,\n      params\n    );\n    const fetcher = config.polyfills?.fetch || /* istanbul ignore next */\n    fetch;\n    return await fetcher(url, {\n      ...options2,\n      headers: {\n        ...options2?.headers,\n        Authorization: `Bearer ${getAuthBearerHeaderFromAuthValue(authValue)}`\n      }\n    });\n  }\n  async function streamFetch(authValue, roomId) {\n    return fetchClientApi(roomId, \"/storage\", authValue, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  }\n  async function httpPostToRoom(endpoint, body) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(config.roomId, endpoint, managedSocket.authValue, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    });\n  }\n  async function createTextMention(userId, mentionId) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(\n      config.roomId,\n      \"/text-mentions\",\n      managedSocket.authValue,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          userId,\n          mentionId\n        })\n      }\n    );\n  }\n  async function deleteTextMention(mentionId) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(\n      config.roomId,\n      `/text-mentions/${mentionId}`,\n      managedSocket.authValue,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  async function reportTextEditor(type, rootKey) {\n    const authValue = await delegates.authenticate();\n    return fetchClientApi(config.roomId, \"/text-metadata\", authValue, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        type,\n        rootKey\n      })\n    });\n  }\n  function sendMessages(messages) {\n    const serializedPayload = JSON.stringify(messages);\n    const nonce = context.dynamicSessionInfo.current?.nonce;\n    if (config.unstable_fallbackToHTTP && nonce) {\n      const size = new TextEncoder().encode(serializedPayload).length;\n      if (size > MAX_SOCKET_MESSAGE_SIZE) {\n        void httpPostToRoom(\"/send-message\", { nonce, messages }).then(\n          (resp) => {\n            if (!resp.ok && resp.status === 403) {\n              managedSocket.reconnect();\n            }\n          }\n        );\n        warn(\n          \"Message was too large for websockets and sent over HTTP instead\"\n        );\n        return;\n      }\n    }\n    managedSocket.send(serializedPayload);\n  }\n  const self = new DerivedRef(\n    context.staticSessionInfo,\n    context.dynamicSessionInfo,\n    context.myPresence,\n    (staticSession, dynamicSession, myPresence) => {\n      if (staticSession === null || dynamicSession === null) {\n        return null;\n      } else {\n        const canWrite = canWriteStorage(dynamicSession.scopes);\n        return {\n          connectionId: dynamicSession.actor,\n          id: staticSession.userId,\n          info: staticSession.userInfo,\n          presence: myPresence,\n          canWrite,\n          canComment: canComment(dynamicSession.scopes)\n        };\n      }\n    }\n  );\n  let _lastSelf;\n  function notifySelfChanged(batchedUpdatesWrapper) {\n    const currSelf = self.current;\n    if (currSelf !== null && currSelf !== _lastSelf) {\n      batchedUpdatesWrapper(() => {\n        eventHub.self.notify(currSelf);\n      });\n      _lastSelf = currSelf;\n    }\n  }\n  const selfAsTreeNode = new DerivedRef(\n    self,\n    (me) => me !== null ? userToTreeNode(\"Me\", me) : null\n  );\n  function createOrUpdateRootFromMessage(message, batchedUpdatesWrapper) {\n    if (message.items.length === 0) {\n      throw new Error(\"Internal error: cannot load storage without items\");\n    }\n    if (context.root !== void 0) {\n      updateRoot(message.items, batchedUpdatesWrapper);\n    } else {\n      context.root = LiveObject._fromItems(message.items, pool);\n    }\n    const canWrite = self.current?.canWrite ?? true;\n    const stackSizeBefore = context.undoStack.length;\n    for (const key in context.initialStorage) {\n      if (context.root.get(key) === void 0) {\n        if (canWrite) {\n          context.root.set(key, cloneLson(context.initialStorage[key]));\n        } else {\n          warn(\n            `Attempted to populate missing storage key '${key}', but current user has no write access`\n          );\n        }\n      }\n    }\n    context.undoStack.length = stackSizeBefore;\n  }\n  function updateRoot(items, batchedUpdatesWrapper) {\n    if (context.root === void 0) {\n      return;\n    }\n    const currentItems = /* @__PURE__ */ new Map();\n    for (const [id, node] of context.nodes) {\n      currentItems.set(id, node._serialize());\n    }\n    const ops = getTreesDiffOperations(currentItems, new Map(items));\n    const result = applyOps(ops, false);\n    notify(result.updates, batchedUpdatesWrapper);\n  }\n  function _addToRealUndoStack(historyOps, batchedUpdatesWrapper) {\n    if (context.undoStack.length >= 50) {\n      context.undoStack.shift();\n    }\n    context.undoStack.push(historyOps);\n    onHistoryChange(batchedUpdatesWrapper);\n  }\n  function addToUndoStack(historyOps, batchedUpdatesWrapper) {\n    if (context.pausedHistory !== null) {\n      context.pausedHistory.unshift(...historyOps);\n    } else {\n      _addToRealUndoStack(historyOps, batchedUpdatesWrapper);\n    }\n  }\n  function notify(updates, batchedUpdatesWrapper) {\n    const storageUpdates = updates.storageUpdates;\n    const othersUpdates = updates.others;\n    batchedUpdatesWrapper(() => {\n      if (othersUpdates !== void 0 && othersUpdates.length > 0) {\n        const others = context.others.current;\n        for (const event of othersUpdates) {\n          eventHub.others.notify({ ...event, others });\n        }\n      }\n      if (updates.presence ?? false) {\n        notifySelfChanged(doNotBatchUpdates);\n        eventHub.myPresence.notify(context.myPresence.current);\n      }\n      if (storageUpdates !== void 0 && storageUpdates.size > 0) {\n        const updates2 = Array.from(storageUpdates.values());\n        eventHub.storageBatch.notify(updates2);\n      }\n      notifyStorageStatus();\n    });\n  }\n  function getConnectionId() {\n    const info = context.dynamicSessionInfo.current;\n    if (info) {\n      return info.actor;\n    }\n    throw new Error(\n      \"Internal. Tried to get connection id but connection was never open\"\n    );\n  }\n  function applyOps(rawOps, isLocal) {\n    const output = {\n      reverse: [],\n      storageUpdates: /* @__PURE__ */ new Map(),\n      presence: false\n    };\n    const createdNodeIds = /* @__PURE__ */ new Set();\n    const ops = rawOps.map((op) => {\n      if (op.type !== \"presence\" && !op.opId) {\n        return { ...op, opId: pool.generateOpId() };\n      } else {\n        return op;\n      }\n    });\n    for (const op of ops) {\n      if (op.type === \"presence\") {\n        const reverse = {\n          type: \"presence\",\n          data: {}\n        };\n        for (const key in op.data) {\n          reverse.data[key] = context.myPresence.current[key];\n        }\n        context.myPresence.patch(op.data);\n        if (context.buffer.presenceUpdates === null) {\n          context.buffer.presenceUpdates = { type: \"partial\", data: op.data };\n        } else {\n          for (const key in op.data) {\n            context.buffer.presenceUpdates.data[key] = op.data[key];\n          }\n        }\n        output.reverse.unshift(reverse);\n        output.presence = true;\n      } else {\n        let source;\n        if (isLocal) {\n          source = 0 /* UNDOREDO_RECONNECT */;\n        } else {\n          const opId = nn(op.opId);\n          if (true) {\n            nn(context.opStackTraces).delete(opId);\n          }\n          const deleted = context.unacknowledgedOps.delete(opId);\n          source = deleted ? 2 /* ACK */ : 1 /* REMOTE */;\n        }\n        const applyOpResult = applyOp(op, source);\n        if (applyOpResult.modified) {\n          const nodeId = applyOpResult.modified.node._id;\n          if (!(nodeId && createdNodeIds.has(nodeId))) {\n            output.storageUpdates.set(\n              nn(applyOpResult.modified.node._id),\n              mergeStorageUpdates(\n                output.storageUpdates.get(nn(applyOpResult.modified.node._id)),\n                applyOpResult.modified\n              )\n            );\n            output.reverse.unshift(...applyOpResult.reverse);\n          }\n          if (op.type === 2 /* CREATE_LIST */ || op.type === 7 /* CREATE_MAP */ || op.type === 4 /* CREATE_OBJECT */) {\n            createdNodeIds.add(nn(op.id));\n          }\n        }\n      }\n    }\n    return {\n      ops,\n      reverse: output.reverse,\n      updates: {\n        storageUpdates: output.storageUpdates,\n        presence: output.presence\n      }\n    };\n  }\n  function applyOp(op, source) {\n    if (isAckOp(op)) {\n      return { modified: false };\n    }\n    switch (op.type) {\n      case 6 /* DELETE_OBJECT_KEY */:\n      case 3 /* UPDATE_OBJECT */:\n      case 5 /* DELETE_CRDT */: {\n        const node = context.nodes.get(op.id);\n        if (node === void 0) {\n          return { modified: false };\n        }\n        return node._apply(op, source === 0 /* UNDOREDO_RECONNECT */);\n      }\n      case 1 /* SET_PARENT_KEY */: {\n        const node = context.nodes.get(op.id);\n        if (node === void 0) {\n          return { modified: false };\n        }\n        if (node.parent.type === \"HasParent\" && isLiveList(node.parent.node)) {\n          return node.parent.node._setChildKey(\n            asPos(op.parentKey),\n            node,\n            source\n          );\n        }\n        return { modified: false };\n      }\n      case 4 /* CREATE_OBJECT */:\n      case 2 /* CREATE_LIST */:\n      case 7 /* CREATE_MAP */:\n      case 8 /* CREATE_REGISTER */: {\n        if (op.parentId === void 0) {\n          return { modified: false };\n        }\n        const parentNode = context.nodes.get(op.parentId);\n        if (parentNode === void 0) {\n          return { modified: false };\n        }\n        return parentNode._attachChild(op, source);\n      }\n    }\n  }\n  function updatePresence(patch, options2) {\n    const oldValues = {};\n    if (context.buffer.presenceUpdates === null) {\n      context.buffer.presenceUpdates = {\n        type: \"partial\",\n        data: {}\n      };\n    }\n    for (const key in patch) {\n      const overrideValue = patch[key];\n      if (overrideValue === void 0) {\n        continue;\n      }\n      context.buffer.presenceUpdates.data[key] = overrideValue;\n      oldValues[key] = context.myPresence.current[key];\n    }\n    context.myPresence.patch(patch);\n    if (context.activeBatch) {\n      if (options2?.addToHistory) {\n        context.activeBatch.reverseOps.unshift({\n          type: \"presence\",\n          data: oldValues\n        });\n      }\n      context.activeBatch.updates.presence = true;\n    } else {\n      flushNowOrSoon();\n      batchUpdates(() => {\n        if (options2?.addToHistory) {\n          addToUndoStack(\n            [{ type: \"presence\", data: oldValues }],\n            doNotBatchUpdates\n          );\n        }\n        notify({ presence: true }, doNotBatchUpdates);\n      });\n    }\n  }\n  function onUpdatePresenceMessage(message) {\n    if (message.targetActor !== void 0) {\n      const oldUser = context.others.getUser(message.actor);\n      context.others.setOther(message.actor, message.data);\n      const newUser = context.others.getUser(message.actor);\n      if (oldUser === void 0 && newUser !== void 0) {\n        return { type: \"enter\", user: newUser };\n      }\n    } else {\n      context.others.patchOther(message.actor, message.data), message;\n    }\n    const user = context.others.getUser(message.actor);\n    if (user) {\n      return {\n        type: \"update\",\n        updates: message.data,\n        user\n      };\n    } else {\n      return void 0;\n    }\n  }\n  function onUserLeftMessage(message) {\n    const user = context.others.getUser(message.actor);\n    if (user) {\n      context.others.removeConnection(message.actor);\n      return { type: \"leave\", user };\n    }\n    return null;\n  }\n  function onRoomStateMessage(message, batchedUpdatesWrapper) {\n    context.dynamicSessionInfo.set({\n      actor: message.actor,\n      nonce: message.nonce,\n      scopes: message.scopes\n    });\n    context.idFactory = makeIdFactory(message.actor);\n    notifySelfChanged(batchedUpdatesWrapper);\n    for (const connectionId of context.others.connectionIds()) {\n      const user = message.users[connectionId];\n      if (user === void 0) {\n        context.others.removeConnection(connectionId);\n      }\n    }\n    for (const key in message.users) {\n      const user = message.users[key];\n      const connectionId = Number(key);\n      context.others.setConnection(\n        connectionId,\n        user.id,\n        user.info,\n        user.scopes\n      );\n    }\n    return { type: \"reset\" };\n  }\n  function canUndo() {\n    return context.undoStack.length > 0;\n  }\n  function canRedo() {\n    return context.redoStack.length > 0;\n  }\n  function onHistoryChange(batchedUpdatesWrapper) {\n    batchedUpdatesWrapper(() => {\n      eventHub.history.notify({ canUndo: canUndo(), canRedo: canRedo() });\n    });\n  }\n  function onUserJoinedMessage(message) {\n    context.others.setConnection(\n      message.actor,\n      message.id,\n      message.info,\n      message.scopes\n    );\n    context.buffer.messages.push({\n      type: 100 /* UPDATE_PRESENCE */,\n      data: context.myPresence.current,\n      targetActor: message.actor\n    });\n    flushNowOrSoon();\n    const user = context.others.getUser(message.actor);\n    return user ? { type: \"enter\", user } : void 0;\n  }\n  function parseServerMessage(data) {\n    if (!isJsonObject(data)) {\n      return null;\n    }\n    return data;\n  }\n  function parseServerMessages(text) {\n    const data = tryParseJson(text);\n    if (data === void 0) {\n      return null;\n    } else if (isJsonArray(data)) {\n      return compact(data.map((item) => parseServerMessage(item)));\n    } else {\n      return compact([parseServerMessage(data)]);\n    }\n  }\n  function applyAndSendOps(offlineOps, batchedUpdatesWrapper) {\n    if (offlineOps.size === 0) {\n      return;\n    }\n    const messages = [];\n    const ops = Array.from(offlineOps.values());\n    const result = applyOps(ops, true);\n    messages.push({\n      type: 201 /* UPDATE_STORAGE */,\n      ops: result.ops\n    });\n    notify(result.updates, batchedUpdatesWrapper);\n    sendMessages(messages);\n  }\n  function handleServerMessage(event) {\n    if (typeof event.data !== \"string\") {\n      return;\n    }\n    const messages = parseServerMessages(event.data);\n    if (messages === null || messages.length === 0) {\n      return;\n    }\n    const updates = {\n      storageUpdates: /* @__PURE__ */ new Map(),\n      others: []\n    };\n    batchUpdates(() => {\n      for (const message of messages) {\n        switch (message.type) {\n          case 101 /* USER_JOINED */: {\n            const userJoinedUpdate = onUserJoinedMessage(message);\n            if (userJoinedUpdate) {\n              updates.others.push(userJoinedUpdate);\n            }\n            break;\n          }\n          case 100 /* UPDATE_PRESENCE */: {\n            const othersPresenceUpdate = onUpdatePresenceMessage(message);\n            if (othersPresenceUpdate) {\n              updates.others.push(othersPresenceUpdate);\n            }\n            break;\n          }\n          case 103 /* BROADCASTED_EVENT */: {\n            const others = context.others.current;\n            eventHub.customEvent.notify({\n              connectionId: message.actor,\n              user: message.actor < 0 ? null : others.find((u) => u.connectionId === message.actor) ?? null,\n              event: message.event\n            });\n            break;\n          }\n          case 102 /* USER_LEFT */: {\n            const event2 = onUserLeftMessage(message);\n            if (event2) {\n              updates.others.push(event2);\n            }\n            break;\n          }\n          case 300 /* UPDATE_YDOC */: {\n            eventHub.ydoc.notify(message);\n            break;\n          }\n          case 104 /* ROOM_STATE */: {\n            updates.others.push(onRoomStateMessage(message, doNotBatchUpdates));\n            break;\n          }\n          case 200 /* INITIAL_STORAGE_STATE */: {\n            processInitialStorage(message);\n            break;\n          }\n          case 201 /* UPDATE_STORAGE */: {\n            const applyResult = applyOps(message.ops, false);\n            for (const [key, value] of applyResult.updates.storageUpdates) {\n              updates.storageUpdates.set(\n                key,\n                mergeStorageUpdates(updates.storageUpdates.get(key), value)\n              );\n            }\n            break;\n          }\n          case 299 /* REJECT_STORAGE_OP */: {\n            errorWithTitle(\n              \"Storage mutation rejection error\",\n              message.reason\n            );\n            if (true) {\n              const traces = /* @__PURE__ */ new Set();\n              for (const opId of message.opIds) {\n                const trace = context.opStackTraces?.get(opId);\n                if (trace) {\n                  traces.add(trace);\n                }\n              }\n              if (traces.size > 0) {\n                warnWithTitle(\n                  \"The following function calls caused the rejected storage mutations:\",\n                  `\n\n${Array.from(traces).join(\"\\n\\n\")}`\n                );\n              }\n              throw new Error(\n                `Storage mutations rejected by server: ${message.reason}`\n              );\n            }\n            break;\n          }\n          case 400 /* THREAD_CREATED */:\n          case 407 /* THREAD_DELETED */:\n          case 401 /* THREAD_METADATA_UPDATED */:\n          case 408 /* THREAD_UPDATED */:\n          case 405 /* COMMENT_REACTION_ADDED */:\n          case 406 /* COMMENT_REACTION_REMOVED */:\n          case 402 /* COMMENT_CREATED */:\n          case 403 /* COMMENT_EDITED */:\n          case 404 /* COMMENT_DELETED */: {\n            eventHub.comments.notify(message);\n            break;\n          }\n        }\n      }\n      notify(updates, doNotBatchUpdates);\n    });\n  }\n  function flushNowOrSoon() {\n    const storageOps = context.buffer.storageOperations;\n    if (storageOps.length > 0) {\n      for (const op of storageOps) {\n        context.unacknowledgedOps.set(nn(op.opId), op);\n      }\n      notifyStorageStatus();\n    }\n    if (managedSocket.getStatus() !== \"connected\") {\n      context.buffer.storageOperations = [];\n      return;\n    }\n    const now = Date.now();\n    const elapsedMillis = now - context.buffer.lastFlushedAt;\n    if (elapsedMillis >= config.throttleDelay) {\n      const messagesToFlush = serializeBuffer();\n      if (messagesToFlush.length === 0) {\n        return;\n      }\n      sendMessages(messagesToFlush);\n      context.buffer = {\n        flushTimerID: void 0,\n        lastFlushedAt: now,\n        messages: [],\n        storageOperations: [],\n        presenceUpdates: null\n      };\n    } else {\n      clearTimeout(context.buffer.flushTimerID);\n      context.buffer.flushTimerID = setTimeout(\n        flushNowOrSoon,\n        config.throttleDelay - elapsedMillis\n      );\n    }\n  }\n  function serializeBuffer() {\n    const messages = [];\n    if (context.buffer.presenceUpdates) {\n      messages.push(\n        context.buffer.presenceUpdates.type === \"full\" ? {\n          type: 100 /* UPDATE_PRESENCE */,\n          // Populating the `targetActor` field turns this message into\n          // a Full Presence update message (not a patch), which will get\n          // interpreted by other clients as such.\n          targetActor: -1,\n          data: context.buffer.presenceUpdates.data\n        } : {\n          type: 100 /* UPDATE_PRESENCE */,\n          data: context.buffer.presenceUpdates.data\n        }\n      );\n    }\n    for (const event of context.buffer.messages) {\n      messages.push(event);\n    }\n    if (context.buffer.storageOperations.length > 0) {\n      messages.push({\n        type: 201 /* UPDATE_STORAGE */,\n        ops: context.buffer.storageOperations\n      });\n    }\n    return messages;\n  }\n  function updateYDoc(update, guid) {\n    const clientMsg = {\n      type: 301 /* UPDATE_YDOC */,\n      update,\n      guid\n    };\n    context.buffer.messages.push(clientMsg);\n    eventHub.ydoc.notify(clientMsg);\n    flushNowOrSoon();\n  }\n  function broadcastEvent(event, options2 = {\n    shouldQueueEventIfNotReady: false\n  }) {\n    if (managedSocket.getStatus() !== \"connected\" && !options2.shouldQueueEventIfNotReady) {\n      return;\n    }\n    context.buffer.messages.push({\n      type: 103 /* BROADCAST_EVENT */,\n      event\n    });\n    flushNowOrSoon();\n  }\n  function dispatchOps(ops) {\n    const { storageOperations } = context.buffer;\n    for (const op of ops) {\n      storageOperations.push(op);\n    }\n    flushNowOrSoon();\n  }\n  let _getStorage$ = null;\n  let _resolveStoragePromise = null;\n  function processInitialStorage(message) {\n    const unacknowledgedOps = new Map(context.unacknowledgedOps);\n    createOrUpdateRootFromMessage(message, doNotBatchUpdates);\n    applyAndSendOps(unacknowledgedOps, doNotBatchUpdates);\n    _resolveStoragePromise?.();\n    notifyStorageStatus();\n    eventHub.storageDidLoad.notify();\n  }\n  async function streamStorage() {\n    if (!managedSocket.authValue) {\n      return;\n    }\n    const result = await streamFetch(managedSocket.authValue, config.roomId);\n    const items = await result.json();\n    processInitialStorage({ type: 200 /* INITIAL_STORAGE_STATE */, items });\n  }\n  function refreshStorage(options2) {\n    const messages = context.buffer.messages;\n    if (config.unstable_streamData) {\n      void streamStorage();\n    } else if (!messages.some((msg) => msg.type === 200 /* FETCH_STORAGE */)) {\n      messages.push({ type: 200 /* FETCH_STORAGE */ });\n    }\n    if (options2.flush) {\n      flushNowOrSoon();\n    }\n  }\n  function startLoadingStorage() {\n    if (_getStorage$ === null) {\n      refreshStorage({ flush: true });\n      _getStorage$ = new Promise((resolve) => {\n        _resolveStoragePromise = resolve;\n      });\n      notifyStorageStatus();\n    }\n    return _getStorage$;\n  }\n  function getStorageSnapshot() {\n    const root = context.root;\n    if (root !== void 0) {\n      return root;\n    } else {\n      void startLoadingStorage();\n      return null;\n    }\n  }\n  async function getStorage() {\n    if (context.root !== void 0) {\n      return Promise.resolve({\n        root: context.root\n      });\n    }\n    await startLoadingStorage();\n    return {\n      root: nn(context.root)\n    };\n  }\n  function fetchYDoc(vector, guid) {\n    if (!context.buffer.messages.find((m) => {\n      return m.type === 300 /* FETCH_YDOC */ && m.vector === vector && m.guid === guid;\n    })) {\n      context.buffer.messages.push({\n        type: 300 /* FETCH_YDOC */,\n        vector,\n        guid\n      });\n    }\n    flushNowOrSoon();\n  }\n  function undo() {\n    if (context.activeBatch) {\n      throw new Error(\"undo is not allowed during a batch\");\n    }\n    const historyOps = context.undoStack.pop();\n    if (historyOps === void 0) {\n      return;\n    }\n    context.pausedHistory = null;\n    const result = applyOps(historyOps, true);\n    batchUpdates(() => {\n      notify(result.updates, doNotBatchUpdates);\n      context.redoStack.push(result.reverse);\n      onHistoryChange(doNotBatchUpdates);\n    });\n    for (const op of result.ops) {\n      if (op.type !== \"presence\") {\n        context.buffer.storageOperations.push(op);\n      }\n    }\n    flushNowOrSoon();\n  }\n  function redo() {\n    if (context.activeBatch) {\n      throw new Error(\"redo is not allowed during a batch\");\n    }\n    const historyOps = context.redoStack.pop();\n    if (historyOps === void 0) {\n      return;\n    }\n    context.pausedHistory = null;\n    const result = applyOps(historyOps, true);\n    batchUpdates(() => {\n      notify(result.updates, doNotBatchUpdates);\n      context.undoStack.push(result.reverse);\n      onHistoryChange(doNotBatchUpdates);\n    });\n    for (const op of result.ops) {\n      if (op.type !== \"presence\") {\n        context.buffer.storageOperations.push(op);\n      }\n    }\n    flushNowOrSoon();\n  }\n  function clear() {\n    context.undoStack.length = 0;\n    context.redoStack.length = 0;\n  }\n  function batch(callback) {\n    if (context.activeBatch) {\n      return callback();\n    }\n    let returnValue = void 0;\n    batchUpdates(() => {\n      context.activeBatch = {\n        ops: [],\n        updates: {\n          storageUpdates: /* @__PURE__ */ new Map(),\n          presence: false,\n          others: []\n        },\n        reverseOps: []\n      };\n      try {\n        returnValue = callback();\n      } finally {\n        const currentBatch = context.activeBatch;\n        context.activeBatch = null;\n        if (currentBatch.reverseOps.length > 0) {\n          addToUndoStack(currentBatch.reverseOps, doNotBatchUpdates);\n        }\n        if (currentBatch.ops.length > 0) {\n          context.redoStack.length = 0;\n        }\n        if (currentBatch.ops.length > 0) {\n          dispatchOps(currentBatch.ops);\n        }\n        notify(currentBatch.updates, doNotBatchUpdates);\n        flushNowOrSoon();\n      }\n    });\n    return returnValue;\n  }\n  function pauseHistory() {\n    if (context.pausedHistory === null) {\n      context.pausedHistory = [];\n    }\n  }\n  function resumeHistory() {\n    const historyOps = context.pausedHistory;\n    context.pausedHistory = null;\n    if (historyOps !== null && historyOps.length > 0) {\n      _addToRealUndoStack(historyOps, batchUpdates);\n    }\n  }\n  function getStorageStatus() {\n    if (context.root === void 0) {\n      return _getStorage$ === null ? \"not-loaded\" : \"loading\";\n    } else {\n      return context.unacknowledgedOps.size === 0 ? \"synchronized\" : \"synchronizing\";\n    }\n  }\n  let _lastStorageStatus = getStorageStatus();\n  function notifyStorageStatus() {\n    const storageStatus = getStorageStatus();\n    if (_lastStorageStatus !== storageStatus) {\n      _lastStorageStatus = storageStatus;\n      eventHub.storageStatus.notify(storageStatus);\n    }\n  }\n  function isPresenceReady() {\n    return self.current !== null;\n  }\n  async function waitUntilPresenceReady() {\n    while (!isPresenceReady()) {\n      const { promise, resolve } = Promise_withResolvers();\n      const unsub1 = events.self.subscribeOnce(resolve);\n      const unsub2 = events.status.subscribeOnce(resolve);\n      await promise;\n      unsub1();\n      unsub2();\n    }\n  }\n  function isStorageReady() {\n    return getStorageSnapshot() !== null;\n  }\n  async function waitUntilStorageReady() {\n    while (!isStorageReady()) {\n      await getStorage();\n    }\n  }\n  const others_forDevTools = new DerivedRef(\n    context.others,\n    (others) => others.map((other, index) => userToTreeNode(`Other ${index}`, other))\n  );\n  const events = {\n    status: eventHub.status.observable,\n    lostConnection: eventHub.lostConnection.observable,\n    customEvent: eventHub.customEvent.observable,\n    others: eventHub.others.observable,\n    self: eventHub.self.observable,\n    myPresence: eventHub.myPresence.observable,\n    error: eventHub.error.observable,\n    /** @deprecated */\n    storage: eventHub.storageBatch.observable,\n    storageBatch: eventHub.storageBatch.observable,\n    history: eventHub.history.observable,\n    storageDidLoad: eventHub.storageDidLoad.observable,\n    storageStatus: eventHub.storageStatus.observable,\n    ydoc: eventHub.ydoc.observable,\n    comments: eventHub.comments.observable\n  };\n  const commentsApi = createCommentsApi(\n    config.roomId,\n    delegates.authenticate,\n    fetchClientApi\n  );\n  async function fetchNotificationsJson(endpoint, options2) {\n    const authValue = await delegates.authenticate();\n    const response = await fetchClientApi(\n      config.roomId,\n      endpoint,\n      authValue,\n      options2\n    );\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new NotificationsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new NotificationsApiError(\n            response.statusText,\n            response.status\n          );\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  function getNotificationSettings() {\n    return fetchNotificationsJson(\n      \"/notification-settings\"\n    );\n  }\n  function updateNotificationSettings(settings) {\n    return fetchNotificationsJson(\n      \"/notification-settings\",\n      {\n        method: \"POST\",\n        body: JSON.stringify(settings),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n  }\n  async function markInboxNotificationsAsRead(inboxNotificationIds) {\n    await fetchNotificationsJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds })\n    });\n  }\n  const batchedMarkInboxNotificationsAsRead = new Batch(\n    async (batchedInboxNotificationIds) => {\n      const inboxNotificationIds = batchedInboxNotificationIds.flat();\n      await markInboxNotificationsAsRead(inboxNotificationIds);\n      return inboxNotificationIds;\n    },\n    { delay: MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY2 }\n  );\n  async function markInboxNotificationAsRead(inboxNotificationId) {\n    await batchedMarkInboxNotificationsAsRead.get(inboxNotificationId);\n  }\n  return Object.defineProperty(\n    {\n      [kInternal]: {\n        get presenceBuffer() {\n          return deepClone(context.buffer.presenceUpdates?.data ?? null);\n        },\n        // prettier-ignore\n        get undoStack() {\n          return deepClone(context.undoStack);\n        },\n        // prettier-ignore\n        get nodeCount() {\n          return context.nodes.size;\n        },\n        // prettier-ignore\n        // send metadata when using a text editor\n        reportTextEditor,\n        // create a text mention when using a text editor\n        createTextMention,\n        // delete a text mention when using a text editor\n        deleteTextMention,\n        // Support for the Liveblocks browser extension\n        getSelf_forDevTools: () => selfAsTreeNode.current,\n        getOthers_forDevTools: () => others_forDevTools.current,\n        // prettier-ignore\n        simulate: {\n          // These exist only for our E2E testing app\n          explicitClose: (event) => managedSocket._privateSendMachineEvent({ type: \"EXPLICIT_SOCKET_CLOSE\", event }),\n          rawSend: (data) => managedSocket.send(data)\n        }\n      },\n      id: config.roomId,\n      subscribe: makeClassicSubscribeFn(events),\n      connect: () => managedSocket.connect(),\n      reconnect: () => managedSocket.reconnect(),\n      disconnect: () => managedSocket.disconnect(),\n      destroy: () => {\n        uninstallBgTabSpy();\n        managedSocket.destroy();\n      },\n      // Presence\n      updatePresence,\n      updateYDoc,\n      broadcastEvent,\n      // Storage\n      batch,\n      history: {\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        clear,\n        pause: pauseHistory,\n        resume: resumeHistory\n      },\n      fetchYDoc,\n      getStorage,\n      getStorageSnapshot,\n      getStorageStatus,\n      isPresenceReady,\n      isStorageReady,\n      waitUntilPresenceReady: memoizeOnSuccess(waitUntilPresenceReady),\n      waitUntilStorageReady: memoizeOnSuccess(waitUntilStorageReady),\n      events,\n      // Core\n      getStatus: () => managedSocket.getStatus(),\n      getSelf: () => self.current,\n      // Presence\n      getPresence: () => context.myPresence.current,\n      getOthers: () => context.others.current,\n      getNotificationSettings,\n      updateNotificationSettings,\n      markInboxNotificationAsRead,\n      ...commentsApi\n    },\n    // Explictly make the internal field non-enumerable, to avoid aggressive\n    // freezing when used with Immer\n    kInternal,\n    { enumerable: false }\n  );\n}\nfunction makeClassicSubscribeFn(events) {\n  function subscribeToLiveStructureDeeply(node, callback) {\n    return events.storageBatch.subscribe((updates) => {\n      const relatedUpdates = updates.filter(\n        (update) => isSameNodeOrChildOf(update.node, node)\n      );\n      if (relatedUpdates.length > 0) {\n        callback(relatedUpdates);\n      }\n    });\n  }\n  function subscribeToLiveStructureShallowly(node, callback) {\n    return events.storageBatch.subscribe((updates) => {\n      for (const update of updates) {\n        if (update.node._id === node._id) {\n          callback(update.node);\n        }\n      }\n    });\n  }\n  function subscribe(first, second, options) {\n    if (typeof first === \"string\" && isRoomEventName(first)) {\n      if (typeof second !== \"function\") {\n        throw new Error(\"Second argument must be a callback function\");\n      }\n      const callback = second;\n      switch (first) {\n        case \"event\":\n          return events.customEvent.subscribe(\n            callback\n          );\n        case \"my-presence\":\n          return events.myPresence.subscribe(callback);\n        case \"others\": {\n          const cb = callback;\n          return events.others.subscribe((event) => {\n            const { others, ...internalEvent } = event;\n            return cb(others, internalEvent);\n          });\n        }\n        case \"error\":\n          return events.error.subscribe(callback);\n        case \"status\":\n          return events.status.subscribe(callback);\n        case \"lost-connection\":\n          return events.lostConnection.subscribe(\n            callback\n          );\n        case \"history\":\n          return events.history.subscribe(callback);\n        case \"storage-status\":\n          return events.storageStatus.subscribe(\n            callback\n          );\n        case \"comments\":\n          return events.comments.subscribe(\n            callback\n          );\n        default:\n          return assertNever(\n            first,\n            `\"${String(first)}\" is not a valid event name`\n          );\n      }\n    }\n    if (second === void 0 || typeof first === \"function\") {\n      if (typeof first === \"function\") {\n        const storageCallback = first;\n        return events.storageBatch.subscribe(storageCallback);\n      } else {\n        throw new Error(\"Please specify a listener callback\");\n      }\n    }\n    if (isLiveNode(first)) {\n      const node = first;\n      if (options?.isDeep) {\n        const storageCallback = second;\n        return subscribeToLiveStructureDeeply(node, storageCallback);\n      } else {\n        const nodeCallback = second;\n        return subscribeToLiveStructureShallowly(node, nodeCallback);\n      }\n    }\n    throw new Error(\n      `${String(first)} is not a value that can be subscribed to.`\n    );\n  }\n  return subscribe;\n}\nfunction isRoomEventName(value) {\n  return value === \"my-presence\" || value === \"others\" || value === \"event\" || value === \"error\" || value === \"history\" || value === \"status\" || value === \"storage-status\" || value === \"lost-connection\" || value === \"connection\" || value === \"comments\";\n}\nfunction makeAuthDelegateForRoom(roomId, authManager) {\n  return async () => {\n    return authManager.getAuthValue({ requestedScope: \"room:read\", roomId });\n  };\n}\nfunction makeCreateSocketDelegateForRoom(roomId, baseUrl, WebSocketPolyfill) {\n  return (authValue) => {\n    const ws = WebSocketPolyfill ?? (typeof WebSocket === \"undefined\" ? void 0 : WebSocket);\n    if (ws === void 0) {\n      throw new StopRetrying(\n        \"To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.\"\n      );\n    }\n    const url = new URL(baseUrl);\n    url.protocol = url.protocol === \"http:\" ? \"ws\" : \"wss\";\n    url.pathname = \"/v7\";\n    url.searchParams.set(\"roomId\", roomId);\n    if (authValue.type === \"secret\") {\n      url.searchParams.set(\"tok\", authValue.token.raw);\n    } else if (authValue.type === \"public\") {\n      url.searchParams.set(\"pubkey\", authValue.publicApiKey);\n    } else {\n      return assertNever(authValue, \"Unhandled case\");\n    }\n    url.searchParams.set(\"version\", PKG_VERSION || \"dev\");\n    return new ws(url.toString());\n  };\n}\n\n// src/store.ts\nfunction createClientStore() {\n  const store = createStore({\n    threads: {},\n    queries: {},\n    optimisticUpdates: [],\n    inboxNotifications: {},\n    notificationSettings: {}\n  });\n  const optimisticUpdatesEventSource = makeEventSource();\n  return {\n    ...store,\n    deleteThread(threadId) {\n      store.set((state) => {\n        return {\n          ...state,\n          threads: deleteKeyImmutable(state.threads, threadId),\n          inboxNotifications: Object.fromEntries(\n            Object.entries(state.inboxNotifications).filter(\n              ([_id, notification]) => notification.kind === \"thread\" && notification.threadId === threadId\n            )\n          )\n        };\n      });\n    },\n    updateThreadAndNotification(thread, inboxNotification) {\n      store.set((state) => {\n        const existingThread = state.threads[thread.id];\n        return {\n          ...state,\n          threads: existingThread === void 0 || compareThreads(thread, existingThread) === 1 ? { ...state.threads, [thread.id]: thread } : state.threads,\n          inboxNotifications: inboxNotification === void 0 ? state.inboxNotifications : {\n            ...state.inboxNotifications,\n            [inboxNotification.id]: inboxNotification\n          }\n        };\n      });\n    },\n    updateThreadsAndNotifications(threads, inboxNotifications, deletedThreads, deletedInboxNotifications, queryKey) {\n      store.set((state) => ({\n        ...state,\n        threads: applyThreadUpdates(state.threads, {\n          newThreads: threads,\n          deletedThreads\n        }),\n        inboxNotifications: applyNotificationsUpdates(\n          state.inboxNotifications,\n          {\n            newInboxNotifications: inboxNotifications,\n            deletedNotifications: deletedInboxNotifications\n          }\n        ),\n        queries: queryKey !== void 0 ? {\n          ...state.queries,\n          [queryKey]: { isLoading: false, data: void 0 }\n        } : state.queries\n      }));\n    },\n    updateRoomInboxNotificationSettings(roomId, settings, queryKey) {\n      store.set((state) => ({\n        ...state,\n        notificationSettings: {\n          ...state.notificationSettings,\n          [roomId]: settings\n        },\n        queries: {\n          ...state.queries,\n          [queryKey]: { isLoading: false, data: void 0 }\n        }\n      }));\n    },\n    pushOptimisticUpdate(optimisticUpdate) {\n      optimisticUpdatesEventSource.notify(optimisticUpdate);\n      store.set((state) => ({\n        ...state,\n        optimisticUpdates: [...state.optimisticUpdates, optimisticUpdate]\n      }));\n    },\n    setQueryState(queryKey, queryState) {\n      store.set((state) => ({\n        ...state,\n        queries: {\n          ...state.queries,\n          [queryKey]: queryState\n        }\n      }));\n    },\n    optimisticUpdatesEventSource\n  };\n}\nfunction deleteKeyImmutable(record, key) {\n  if (Object.prototype.hasOwnProperty.call(record, key)) {\n    const { [key]: _toDelete, ...rest } = record;\n    return rest;\n  }\n  return record;\n}\nfunction compareThreads(thread1, thread2) {\n  if (thread1.updatedAt && thread2.updatedAt) {\n    return thread1.updatedAt > thread2.updatedAt ? 1 : thread1.updatedAt < thread2.updatedAt ? -1 : 0;\n  } else if (thread1.updatedAt || thread2.updatedAt) {\n    return thread1.updatedAt ? 1 : -1;\n  }\n  if (thread1.createdAt > thread2.createdAt) {\n    return 1;\n  } else if (thread1.createdAt < thread2.createdAt) {\n    return -1;\n  }\n  return 0;\n}\nfunction applyOptimisticUpdates(state) {\n  const result = {\n    threads: {\n      ...state.threads\n    },\n    inboxNotifications: {\n      ...state.inboxNotifications\n    },\n    notificationSettings: {\n      ...state.notificationSettings\n    }\n  };\n  for (const optimisticUpdate of state.optimisticUpdates) {\n    switch (optimisticUpdate.type) {\n      case \"create-thread\": {\n        result.threads[optimisticUpdate.thread.id] = optimisticUpdate.thread;\n        break;\n      }\n      case \"edit-thread-metadata\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        if (thread.updatedAt !== void 0 && thread.updatedAt > optimisticUpdate.updatedAt) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          updatedAt: optimisticUpdate.updatedAt,\n          metadata: {\n            ...thread.metadata,\n            ...optimisticUpdate.metadata\n          }\n        };\n        break;\n      }\n      case \"mark-thread-as-resolved\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          resolved: true\n        };\n        break;\n      }\n      case \"mark-thread-as-unresolved\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          resolved: false\n        };\n        break;\n      }\n      case \"create-comment\": {\n        const thread = result.threads[optimisticUpdate.comment.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = upsertComment(\n          thread,\n          optimisticUpdate.comment\n        );\n        const inboxNotification = Object.values(result.inboxNotifications).find(\n          (notification) => notification.kind === \"thread\" && notification.threadId === thread.id\n        );\n        if (inboxNotification === void 0) {\n          break;\n        }\n        result.inboxNotifications[inboxNotification.id] = {\n          ...inboxNotification,\n          notifiedAt: optimisticUpdate.comment.createdAt,\n          readAt: optimisticUpdate.comment.createdAt\n        };\n        break;\n      }\n      case \"edit-comment\": {\n        const thread = result.threads[optimisticUpdate.comment.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = upsertComment(\n          thread,\n          optimisticUpdate.comment\n        );\n        break;\n      }\n      case \"delete-comment\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = deleteComment(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.deletedAt\n        );\n        break;\n      }\n      case \"delete-thread\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[optimisticUpdate.threadId] = {\n          ...result.threads[optimisticUpdate.threadId],\n          deletedAt: optimisticUpdate.deletedAt,\n          updatedAt: optimisticUpdate.deletedAt,\n          comments: []\n        };\n        break;\n      }\n      case \"add-reaction\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = addReaction(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.reaction\n        );\n        break;\n      }\n      case \"remove-reaction\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = removeReaction(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.emoji,\n          optimisticUpdate.userId,\n          optimisticUpdate.removedAt\n        );\n        break;\n      }\n      case \"mark-inbox-notification-as-read\": {\n        result.inboxNotifications[optimisticUpdate.inboxNotificationId] = {\n          ...state.inboxNotifications[optimisticUpdate.inboxNotificationId],\n          readAt: optimisticUpdate.readAt\n        };\n        break;\n      }\n      case \"mark-all-inbox-notifications-as-read\": {\n        for (const id in result.inboxNotifications) {\n          result.inboxNotifications[id] = {\n            ...result.inboxNotifications[id],\n            readAt: optimisticUpdate.readAt\n          };\n        }\n        break;\n      }\n      case \"delete-inbox-notification\": {\n        const {\n          [optimisticUpdate.inboxNotificationId]: _,\n          ...inboxNotifications\n        } = result.inboxNotifications;\n        result.inboxNotifications = inboxNotifications;\n        break;\n      }\n      case \"delete-all-inbox-notifications\": {\n        result.inboxNotifications = {};\n        break;\n      }\n      case \"update-notification-settings\": {\n        result.notificationSettings[optimisticUpdate.roomId] = {\n          ...result.notificationSettings[optimisticUpdate.roomId],\n          ...optimisticUpdate.settings\n        };\n      }\n    }\n  }\n  return result;\n}\nfunction applyThreadUpdates(existingThreads, updates) {\n  const updatedThreads = { ...existingThreads };\n  updates.newThreads.forEach((thread) => {\n    const existingThread = updatedThreads[thread.id];\n    if (existingThread) {\n      const result = compareThreads(existingThread, thread);\n      if (result === 1) return;\n    }\n    updatedThreads[thread.id] = thread;\n  });\n  updates.deletedThreads.forEach(({ id, deletedAt }) => {\n    const existingThread = updatedThreads[id];\n    if (existingThread === void 0) return;\n    existingThread.deletedAt = deletedAt;\n    existingThread.updatedAt = deletedAt;\n    existingThread.comments = [];\n  });\n  return updatedThreads;\n}\nfunction applyNotificationsUpdates(existingInboxNotifications, updates) {\n  const updatedInboxNotifications = { ...existingInboxNotifications };\n  updates.newInboxNotifications.forEach((notification) => {\n    const existingNotification = updatedInboxNotifications[notification.id];\n    if (existingNotification) {\n      const result = compareInboxNotifications(\n        existingNotification,\n        notification\n      );\n      if (result === 1) return;\n    }\n    updatedInboxNotifications[notification.id] = notification;\n  });\n  updates.deletedNotifications.forEach(\n    ({ id }) => delete updatedInboxNotifications[id]\n  );\n  return updatedInboxNotifications;\n}\nfunction compareInboxNotifications(inboxNotificationA, inboxNotificationB) {\n  if (inboxNotificationA.notifiedAt > inboxNotificationB.notifiedAt) {\n    return 1;\n  } else if (inboxNotificationA.notifiedAt < inboxNotificationB.notifiedAt) {\n    return -1;\n  }\n  if (inboxNotificationA.readAt && inboxNotificationB.readAt) {\n    return inboxNotificationA.readAt > inboxNotificationB.readAt ? 1 : inboxNotificationA.readAt < inboxNotificationB.readAt ? -1 : 0;\n  } else if (inboxNotificationA.readAt || inboxNotificationB.readAt) {\n    return inboxNotificationA.readAt ? 1 : -1;\n  }\n  return 0;\n}\nfunction upsertComment(thread, comment) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  if (comment.threadId !== thread.id) {\n    warn(\n      `Comment ${comment.id} does not belong to thread ${thread.id}`\n    );\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (existingComment2) => existingComment2.id === comment.id\n  );\n  if (existingComment === void 0) {\n    const updatedAt = new Date(\n      Math.max(thread.updatedAt?.getTime() || 0, comment.createdAt.getTime())\n    );\n    const updatedThread = {\n      ...thread,\n      updatedAt,\n      comments: [...thread.comments, comment]\n    };\n    return updatedThread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  if (existingComment.editedAt === void 0 || comment.editedAt === void 0 || existingComment.editedAt <= comment.editedAt) {\n    const updatedComments = thread.comments.map(\n      (existingComment2) => existingComment2.id === comment.id ? comment : existingComment2\n    );\n    const updatedThread = {\n      ...thread,\n      updatedAt: new Date(\n        Math.max(\n          thread.updatedAt?.getTime() || 0,\n          comment.editedAt?.getTime() || comment.createdAt.getTime()\n        )\n      ),\n      comments: updatedComments\n    };\n    return updatedThread;\n  }\n  return thread;\n}\nfunction deleteComment(thread, commentId, deletedAt) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      deletedAt,\n      body: void 0\n    } : comment\n  );\n  if (!updatedComments.some((comment) => comment.deletedAt === void 0)) {\n    return {\n      ...thread,\n      deletedAt,\n      updatedAt: deletedAt,\n      comments: []\n    };\n  }\n  return {\n    ...thread,\n    updatedAt: deletedAt,\n    comments: updatedComments\n  };\n}\nfunction addReaction(thread, commentId, reaction) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      reactions: upsertReaction(comment.reactions, reaction)\n    } : comment\n  );\n  return {\n    ...thread,\n    updatedAt: new Date(\n      Math.max(reaction.createdAt.getTime(), thread.updatedAt?.getTime() || 0)\n    ),\n    comments: updatedComments\n  };\n}\nfunction removeReaction(thread, commentId, emoji, userId, removedAt) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      reactions: comment.reactions.map(\n        (reaction) => reaction.emoji === emoji ? {\n          ...reaction,\n          users: reaction.users.filter((user) => user.id !== userId)\n        } : reaction\n      ).filter((reaction) => reaction.users.length > 0)\n      // Remove reactions with no users left\n    } : comment\n  );\n  return {\n    ...thread,\n    updatedAt: new Date(\n      Math.max(removedAt.getTime(), thread.updatedAt?.getTime() || 0)\n    ),\n    comments: updatedComments\n  };\n}\nfunction upsertReaction(reactions, reaction) {\n  const existingReaction = reactions.find(\n    (existingReaction2) => existingReaction2.emoji === reaction.emoji\n  );\n  if (existingReaction === void 0) {\n    return [\n      ...reactions,\n      {\n        emoji: reaction.emoji,\n        createdAt: reaction.createdAt,\n        users: [{ id: reaction.userId }]\n      }\n    ];\n  }\n  if (existingReaction.users.some((user) => user.id === reaction.userId) === false) {\n    return reactions.map(\n      (existingReaction2) => existingReaction2.emoji === reaction.emoji ? {\n        ...existingReaction2,\n        users: [...existingReaction2.users, { id: reaction.userId }]\n      } : existingReaction2\n    );\n  }\n  return reactions;\n}\n\n// src/client.ts\nvar MIN_THROTTLE = 16;\nvar MAX_THROTTLE = 1e3;\nvar DEFAULT_THROTTLE = 100;\nvar MIN_BACKGROUND_KEEP_ALIVE_TIMEOUT = 15e3;\nvar MIN_LOST_CONNECTION_TIMEOUT = 200;\nvar RECOMMENDED_MIN_LOST_CONNECTION_TIMEOUT = 1e3;\nvar MAX_LOST_CONNECTION_TIMEOUT = 3e4;\nvar DEFAULT_LOST_CONNECTION_TIMEOUT = 5e3;\nvar RESOLVE_USERS_BATCH_DELAY = 50;\nvar RESOLVE_ROOMS_INFO_BATCH_DELAY = 50;\nfunction getBaseUrl(baseUrl) {\n  if (typeof baseUrl === \"string\" && baseUrl.startsWith(\"http\")) {\n    return baseUrl;\n  } else {\n    return DEFAULT_BASE_URL;\n  }\n}\nfunction getAuthBearerHeaderFromAuthValue(authValue) {\n  if (authValue.type === \"public\") {\n    return authValue.publicApiKey;\n  } else {\n    return authValue.token.raw;\n  }\n}\nfunction createClient(options) {\n  const clientOptions = options;\n  const throttleDelay = getThrottle(clientOptions.throttle ?? DEFAULT_THROTTLE);\n  const lostConnectionTimeout = getLostConnectionTimeout(\n    clientOptions.lostConnectionTimeout ?? DEFAULT_LOST_CONNECTION_TIMEOUT\n  );\n  const backgroundKeepAliveTimeout = getBackgroundKeepAliveTimeout(\n    clientOptions.backgroundKeepAliveTimeout\n  );\n  const baseUrl = getBaseUrl(clientOptions.baseUrl);\n  const authManager = createAuthManager(options);\n  const roomsById = /* @__PURE__ */ new Map();\n  function teardownRoom(room) {\n    unlinkDevTools(room.id);\n    roomsById.delete(room.id);\n    room.destroy();\n  }\n  function leaseRoom(details) {\n    const leave = () => {\n      const self = leave;\n      if (!details.unsubs.delete(self)) {\n        warn(\n          \"This leave function was already called. Calling it more than once has no effect.\"\n        );\n      } else {\n        if (details.unsubs.size === 0) {\n          teardownRoom(details.room);\n        }\n      }\n    };\n    details.unsubs.add(leave);\n    return {\n      room: details.room,\n      leave\n    };\n  }\n  function enterRoom(roomId, ...args) {\n    const existing = roomsById.get(roomId);\n    if (existing !== void 0) {\n      return leaseRoom(existing);\n    }\n    const options2 = args[0] ?? {};\n    const initialPresence = (typeof options2.initialPresence === \"function\" ? options2.initialPresence(roomId) : options2.initialPresence) ?? {};\n    const initialStorage = (typeof options2.initialStorage === \"function\" ? options2.initialStorage(roomId) : options2.initialStorage) ?? {};\n    const newRoom = createRoom(\n      { initialPresence, initialStorage },\n      {\n        roomId,\n        throttleDelay,\n        lostConnectionTimeout,\n        backgroundKeepAliveTimeout,\n        polyfills: clientOptions.polyfills,\n        delegates: clientOptions.mockedDelegates ?? {\n          createSocket: makeCreateSocketDelegateForRoom(\n            roomId,\n            baseUrl,\n            clientOptions.polyfills?.WebSocket\n          ),\n          authenticate: makeAuthDelegateForRoom(roomId, authManager)\n        },\n        enableDebugLogging: clientOptions.enableDebugLogging,\n        unstable_batchedUpdates: options2?.unstable_batchedUpdates,\n        baseUrl,\n        unstable_fallbackToHTTP: !!clientOptions.unstable_fallbackToHTTP,\n        unstable_streamData: !!clientOptions.unstable_streamData\n      }\n    );\n    const newRoomDetails = {\n      room: newRoom,\n      unsubs: /* @__PURE__ */ new Set()\n    };\n    roomsById.set(roomId, newRoomDetails);\n    setupDevTools(() => Array.from(roomsById.keys()));\n    linkDevTools(roomId, newRoom);\n    const shouldConnect = options2.autoConnect ?? true;\n    if (shouldConnect) {\n      if (typeof atob === \"undefined\") {\n        if (clientOptions.polyfills?.atob === void 0) {\n          throw new Error(\n            \"You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill\"\n          );\n        }\n        global.atob = clientOptions.polyfills.atob;\n      }\n      newRoom.connect();\n    }\n    return leaseRoom(newRoomDetails);\n  }\n  function getRoom(roomId) {\n    const room = roomsById.get(roomId)?.room;\n    return room ? room : null;\n  }\n  function logout() {\n    authManager.reset();\n    for (const { room } of roomsById.values()) {\n      if (!isIdle(room.getStatus())) {\n        room.reconnect();\n      }\n    }\n  }\n  const currentUserIdStore = createStore(null);\n  const {\n    getInboxNotifications,\n    getInboxNotificationsSince,\n    getUnreadInboxNotificationsCount,\n    markAllInboxNotificationsAsRead,\n    markInboxNotificationAsRead,\n    deleteAllInboxNotifications,\n    deleteInboxNotification\n  } = createNotificationsApi({\n    baseUrl,\n    fetcher: clientOptions.polyfills?.fetch || /* istanbul ignore next */\n    fetch,\n    authManager,\n    currentUserIdStore\n  });\n  const cacheStore = createClientStore();\n  const resolveUsers = clientOptions.resolveUsers;\n  const warnIfNoResolveUsers = createDevelopmentWarning(\n    () => !resolveUsers,\n    \"Set the resolveUsers option in createClient to specify user info.\"\n  );\n  const usersStore = createBatchStore(\n    async (batchedUserIds) => {\n      const userIds = batchedUserIds.flat();\n      const users = await resolveUsers?.({ userIds });\n      warnIfNoResolveUsers();\n      return users ?? userIds.map(() => void 0);\n    },\n    { delay: RESOLVE_USERS_BATCH_DELAY }\n  );\n  const resolveRoomsInfo = clientOptions.resolveRoomsInfo;\n  const warnIfNoResolveRoomsInfo = createDevelopmentWarning(\n    () => !resolveRoomsInfo,\n    \"Set the resolveRoomsInfo option in createClient to specify room info.\"\n  );\n  const roomsInfoStore = createBatchStore(\n    async (batchedRoomIds) => {\n      const roomIds = batchedRoomIds.flat();\n      const roomsInfo = await resolveRoomsInfo?.({ roomIds });\n      warnIfNoResolveRoomsInfo();\n      return roomsInfo ?? roomIds.map(() => void 0);\n    },\n    { delay: RESOLVE_ROOMS_INFO_BATCH_DELAY }\n  );\n  return Object.defineProperty(\n    {\n      enterRoom,\n      getRoom,\n      logout,\n      getInboxNotifications,\n      getInboxNotificationsSince,\n      getUnreadInboxNotificationsCount,\n      markAllInboxNotificationsAsRead,\n      markInboxNotificationAsRead,\n      deleteAllInboxNotifications,\n      deleteInboxNotification,\n      // Internal\n      [kInternal]: {\n        currentUserIdStore,\n        resolveMentionSuggestions: clientOptions.resolveMentionSuggestions,\n        cacheStore,\n        usersStore,\n        roomsInfoStore,\n        getRoomIds() {\n          return Array.from(roomsById.keys());\n        }\n      }\n    },\n    kInternal,\n    {\n      enumerable: false\n    }\n  );\n}\nvar NotificationsApiError = class extends Error {\n  constructor(message, status, details) {\n    super(message);\n    this.message = message;\n    this.status = status;\n    this.details = details;\n  }\n};\nfunction checkBounds(option, value, min, max, recommendedMin) {\n  if (typeof value !== \"number\" || value < min || max !== void 0 && value > max) {\n    throw new Error(\n      max !== void 0 ? `${option} should be between ${recommendedMin ?? min} and ${max}.` : `${option} should be at least ${recommendedMin ?? min}.`\n    );\n  }\n  return value;\n}\nfunction getBackgroundKeepAliveTimeout(value) {\n  if (value === void 0) return void 0;\n  return checkBounds(\n    \"backgroundKeepAliveTimeout\",\n    value,\n    MIN_BACKGROUND_KEEP_ALIVE_TIMEOUT\n  );\n}\nfunction getThrottle(value) {\n  return checkBounds(\"throttle\", value, MIN_THROTTLE, MAX_THROTTLE);\n}\nfunction getLostConnectionTimeout(value) {\n  return checkBounds(\n    \"lostConnectionTimeout\",\n    value,\n    MIN_LOST_CONNECTION_TIMEOUT,\n    MAX_LOST_CONNECTION_TIMEOUT,\n    RECOMMENDED_MIN_LOST_CONNECTION_TIMEOUT\n  );\n}\nfunction createDevelopmentWarning(condition, ...args) {\n  let hasWarned = false;\n  if (true) {\n    return () => {\n      if (!hasWarned && (typeof condition === \"function\" ? condition() : condition)) {\n        warn(...args);\n        hasWarned = true;\n      }\n    };\n  } else {}\n}\n\n// src/comments/comment-body.ts\nfunction isCommentBodyParagraph(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyText(element) {\n  return !(\"type\" in element) && \"text\" in element && typeof element.text === \"string\";\n}\nfunction isCommentBodyMention(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyLink(element) {\n  return \"type\" in element && element.type === \"link\";\n}\nvar commentBodyElementsGuards = {\n  paragraph: isCommentBodyParagraph,\n  text: isCommentBodyText,\n  link: isCommentBodyLink,\n  mention: isCommentBodyMention\n};\nvar commentBodyElementsTypes = {\n  paragraph: \"block\",\n  text: \"inline\",\n  link: \"inline\",\n  mention: \"inline\"\n};\nfunction traverseCommentBody(body, elementOrVisitor, possiblyVisitor) {\n  if (!body || !body?.content) {\n    return;\n  }\n  const element = typeof elementOrVisitor === \"string\" ? elementOrVisitor : void 0;\n  const type = element ? commentBodyElementsTypes[element] : \"all\";\n  const guard = element ? commentBodyElementsGuards[element] : () => true;\n  const visitor = typeof elementOrVisitor === \"function\" ? elementOrVisitor : possiblyVisitor;\n  for (const block of body.content) {\n    if (type === \"all\" || type === \"block\") {\n      if (guard(block)) {\n        visitor?.(block);\n      }\n    }\n    if (type === \"all\" || type === \"inline\") {\n      for (const inline of block.children) {\n        if (guard(inline)) {\n          visitor?.(inline);\n        }\n      }\n    }\n  }\n}\nfunction getMentionedIdsFromCommentBody(body) {\n  const mentionedIds = /* @__PURE__ */ new Set();\n  traverseCommentBody(\n    body,\n    \"mention\",\n    (mention) => mentionedIds.add(mention.id)\n  );\n  return Array.from(mentionedIds);\n}\nasync function resolveUsersInCommentBody(body, resolveUsers) {\n  const resolvedUsers = /* @__PURE__ */ new Map();\n  if (!resolveUsers) {\n    return resolvedUsers;\n  }\n  const userIds = getMentionedIdsFromCommentBody(body);\n  const users = await resolveUsers({\n    userIds\n  });\n  for (const [index, userId] of userIds.entries()) {\n    const user = users?.[index];\n    if (user) {\n      resolvedUsers.set(userId, user);\n    }\n  }\n  return resolvedUsers;\n}\nvar htmlEscapables = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&#39;\"\n};\nvar htmlEscapablesRegex = new RegExp(\n  Object.keys(htmlEscapables).map((entity) => `\\\\${entity}`).join(\"|\"),\n  \"g\"\n);\nfunction htmlSafe(value) {\n  return new HtmlSafeString([String(value)], []);\n}\nfunction joinHtml(strings) {\n  if (strings.length <= 0) {\n    return new HtmlSafeString([\"\"], []);\n  }\n  return new HtmlSafeString(\n    [\"\", ...Array(strings.length - 1).fill(\"\"), \"\"],\n    strings\n  );\n}\nfunction escapeHtml(value) {\n  if (value instanceof HtmlSafeString) {\n    return value.toString();\n  }\n  if (Array.isArray(value)) {\n    return joinHtml(value).toString();\n  }\n  return String(value).replace(\n    htmlEscapablesRegex,\n    (character) => htmlEscapables[character]\n  );\n}\nvar HtmlSafeString = class {\n  constructor(strings, values) {\n    this._strings = strings;\n    this._values = values;\n  }\n  toString() {\n    return this._strings.reduce((result, str, i) => {\n      return result + escapeHtml(nn(this._values[i - 1])) + str;\n    });\n  }\n};\nfunction html(strings, ...values) {\n  return new HtmlSafeString(strings, values);\n}\nvar markdownEscapables = {\n  _: \"\\\\_\",\n  \"*\": \"\\\\*\",\n  \"#\": \"\\\\#\",\n  \"`\": \"\\\\`\",\n  \"~\": \"\\\\~\",\n  \"!\": \"\\\\!\",\n  \"|\": \"\\\\|\",\n  \"(\": \"\\\\(\",\n  \")\": \"\\\\)\",\n  \"{\": \"\\\\{\",\n  \"}\": \"\\\\}\",\n  \"[\": \"\\\\[\",\n  \"]\": \"\\\\]\"\n};\nvar markdownEscapablesRegex = new RegExp(\n  Object.keys(markdownEscapables).map((entity) => `\\\\${entity}`).join(\"|\"),\n  \"g\"\n);\nfunction joinMarkdown(strings) {\n  if (strings.length <= 0) {\n    return new MarkdownSafeString([\"\"], []);\n  }\n  return new MarkdownSafeString(\n    [\"\", ...Array(strings.length - 1).fill(\"\"), \"\"],\n    strings\n  );\n}\nfunction escapeMarkdown(value) {\n  if (value instanceof MarkdownSafeString) {\n    return value.toString();\n  }\n  if (Array.isArray(value)) {\n    return joinMarkdown(value).toString();\n  }\n  return String(value).replace(\n    markdownEscapablesRegex,\n    (character) => markdownEscapables[character]\n  );\n}\nvar MarkdownSafeString = class {\n  constructor(strings, values) {\n    this._strings = strings;\n    this._values = values;\n  }\n  toString() {\n    return this._strings.reduce((result, str, i) => {\n      return result + escapeMarkdown(nn(this._values[i - 1])) + str;\n    });\n  }\n};\nfunction markdown(strings, ...values) {\n  return new MarkdownSafeString(strings, values);\n}\nfunction toAbsoluteUrl(url) {\n  if (url.startsWith(\"http://\") || url.startsWith(\"https://\")) {\n    return url;\n  } else if (url.startsWith(\"www.\")) {\n    return \"https://\" + url;\n  }\n  return;\n}\nvar stringifyCommentBodyPlainElements = {\n  paragraph: ({ children }) => children,\n  text: ({ element }) => element.text,\n  link: ({ element }) => element.text ?? element.url,\n  mention: ({ element, user }) => {\n    return `@${user?.name ?? element.id}`;\n  }\n};\nvar stringifyCommentBodyHtmlElements = {\n  paragraph: ({ children }) => {\n    return children ? html`<p>${htmlSafe(children)}</p>` : children;\n  },\n  text: ({ element }) => {\n    let children = element.text;\n    if (!children) {\n      return children;\n    }\n    if (element.bold) {\n      children = html`<strong>${children}</strong>`;\n    }\n    if (element.italic) {\n      children = html`<em>${children}</em>`;\n    }\n    if (element.strikethrough) {\n      children = html`<s>${children}</s>`;\n    }\n    if (element.code) {\n      children = html`<code>${children}</code>`;\n    }\n    return children;\n  },\n  link: ({ element, href }) => {\n    return html`<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${element.text ?? element.url}</a>`;\n  },\n  mention: ({ element, user }) => {\n    return html`<span data-mention>@${user?.name ?? element.id}</span>`;\n  }\n};\nvar stringifyCommentBodyMarkdownElements = {\n  paragraph: ({ children }) => {\n    return children;\n  },\n  text: ({ element }) => {\n    let children = element.text;\n    if (!children) {\n      return children;\n    }\n    if (element.bold) {\n      children = markdown`**${children}**`;\n    }\n    if (element.italic) {\n      children = markdown`_${children}_`;\n    }\n    if (element.strikethrough) {\n      children = markdown`~~${children}~~`;\n    }\n    if (element.code) {\n      children = markdown`\\`${children}\\``;\n    }\n    return children;\n  },\n  link: ({ element, href }) => {\n    return markdown`[${element.text ?? element.url}](${href})`;\n  },\n  mention: ({ element, user }) => {\n    return markdown`@${user?.name ?? element.id}`;\n  }\n};\nasync function stringifyCommentBody(body, options) {\n  const format = options?.format ?? \"plain\";\n  const separator = options?.separator ?? (format === \"markdown\" ? \"\\n\\n\" : \"\\n\");\n  const elements = {\n    ...format === \"html\" ? stringifyCommentBodyHtmlElements : format === \"markdown\" ? stringifyCommentBodyMarkdownElements : stringifyCommentBodyPlainElements,\n    ...options?.elements\n  };\n  const resolvedUsers = await resolveUsersInCommentBody(\n    body,\n    options?.resolveUsers\n  );\n  const blocks = body.content.flatMap((block, blockIndex) => {\n    switch (block.type) {\n      case \"paragraph\": {\n        const inlines = block.children.flatMap((inline, inlineIndex) => {\n          if (isCommentBodyMention(inline)) {\n            return inline.id ? [\n              elements.mention(\n                {\n                  element: inline,\n                  user: resolvedUsers.get(inline.id)\n                },\n                inlineIndex\n              )\n            ] : [];\n          }\n          if (isCommentBodyLink(inline)) {\n            return [\n              elements.link(\n                {\n                  element: inline,\n                  href: toAbsoluteUrl(inline.url) ?? inline.url\n                },\n                inlineIndex\n              )\n            ];\n          }\n          if (isCommentBodyText(inline)) {\n            return [elements.text({ element: inline }, inlineIndex)];\n          }\n          return [];\n        });\n        return [\n          elements.paragraph(\n            { element: block, children: inlines.join(\"\") },\n            blockIndex\n          )\n        ];\n      }\n      default:\n        return [];\n    }\n  });\n  return blocks.join(separator);\n}\n\n// src/crdts/utils.ts\nfunction toPlainLson(lson) {\n  if (lson instanceof LiveObject) {\n    return {\n      liveblocksType: \"LiveObject\",\n      data: Object.fromEntries(\n        Object.entries(lson.toObject()).flatMap(\n          ([key, value]) => value !== void 0 ? [[key, toPlainLson(value)]] : []\n        )\n      )\n    };\n  } else if (lson instanceof LiveMap) {\n    return {\n      liveblocksType: \"LiveMap\",\n      data: Object.fromEntries(\n        [...lson].map(([key, value]) => [key, toPlainLson(value)])\n      )\n    };\n  } else if (lson instanceof LiveList) {\n    return {\n      liveblocksType: \"LiveList\",\n      data: [...lson].map((item) => toPlainLson(item))\n    };\n  } else {\n    return lson;\n  }\n}\n\n// src/immutable.ts\nfunction lsonObjectToJson(obj) {\n  const result = {};\n  for (const key in obj) {\n    const val = obj[key];\n    if (val !== void 0) {\n      result[key] = lsonToJson(val);\n    }\n  }\n  return result;\n}\nfunction liveObjectToJson(liveObject) {\n  return lsonObjectToJson(liveObject.toObject());\n}\nfunction liveMapToJson(map) {\n  const result = {};\n  for (const [key, value] of map.entries()) {\n    result[key] = lsonToJson(value);\n  }\n  return result;\n}\nfunction lsonListToJson(value) {\n  return value.map(lsonToJson);\n}\nfunction liveListToJson(value) {\n  return lsonListToJson(value.toArray());\n}\nfunction lsonToJson(value) {\n  if (value instanceof LiveObject) {\n    return liveObjectToJson(value);\n  } else if (value instanceof LiveList) {\n    return liveListToJson(value);\n  } else if (value instanceof LiveMap) {\n    return liveMapToJson(value);\n  } else if (value instanceof LiveRegister) {\n    return value.data;\n  }\n  if (Array.isArray(value)) {\n    return lsonListToJson(value);\n  } else if (isPlainObject(value)) {\n    return lsonObjectToJson(value);\n  }\n  return value;\n}\nfunction deepLiveify(value) {\n  if (Array.isArray(value)) {\n    return new LiveList(value.map(deepLiveify));\n  } else if (isPlainObject(value)) {\n    const init = {};\n    for (const key in value) {\n      const val = value[key];\n      if (val === void 0) {\n        continue;\n      }\n      init[key] = deepLiveify(val);\n    }\n    return new LiveObject(init);\n  } else {\n    return value;\n  }\n}\nfunction patchLiveList(liveList, prev, next) {\n  let i = 0;\n  let prevEnd = prev.length - 1;\n  let nextEnd = next.length - 1;\n  let prevNode = prev[0];\n  let nextNode = next[0];\n  outer: {\n    while (prevNode === nextNode) {\n      ++i;\n      if (i > prevEnd || i > nextEnd) {\n        break outer;\n      }\n      prevNode = prev[i];\n      nextNode = next[i];\n    }\n    prevNode = prev[prevEnd];\n    nextNode = next[nextEnd];\n    while (prevNode === nextNode) {\n      prevEnd--;\n      nextEnd--;\n      if (i > prevEnd || i > nextEnd) {\n        break outer;\n      }\n      prevNode = prev[prevEnd];\n      nextNode = next[nextEnd];\n    }\n  }\n  if (i > prevEnd) {\n    if (i <= nextEnd) {\n      while (i <= nextEnd) {\n        liveList.insert(deepLiveify(next[i]), i);\n        i++;\n      }\n    }\n  } else if (i > nextEnd) {\n    let localI = i;\n    while (localI <= prevEnd) {\n      liveList.delete(i);\n      localI++;\n    }\n  } else {\n    while (i <= prevEnd && i <= nextEnd) {\n      prevNode = prev[i];\n      nextNode = next[i];\n      const liveListNode = liveList.get(i);\n      if (isLiveObject(liveListNode) && isPlainObject(prevNode) && isPlainObject(nextNode)) {\n        patchLiveObject(liveListNode, prevNode, nextNode);\n      } else {\n        liveList.set(i, deepLiveify(nextNode));\n      }\n      i++;\n    }\n    while (i <= nextEnd) {\n      liveList.insert(deepLiveify(next[i]), i);\n      i++;\n    }\n    let localI = i;\n    while (localI <= prevEnd) {\n      liveList.delete(i);\n      localI++;\n    }\n  }\n}\nfunction patchLiveObjectKey(liveObject, key, prev, next) {\n  if (true) {\n    const nonSerializableValue = findNonSerializableValue(next);\n    if (nonSerializableValue) {\n      error2(\n        `New state path: '${nonSerializableValue.path}' value: '${String(\n          nonSerializableValue.value\n        )}' is not serializable.\nOnly serializable value can be synced with Liveblocks.`\n      );\n      return;\n    }\n  }\n  const value = liveObject.get(key);\n  if (next === void 0) {\n    liveObject.delete(key);\n  } else if (value === void 0) {\n    liveObject.set(key, deepLiveify(next));\n  } else if (prev === next) {\n    return;\n  } else if (isLiveList(value) && Array.isArray(prev) && Array.isArray(next)) {\n    patchLiveList(value, prev, next);\n  } else if (isLiveObject(value) && isPlainObject(prev) && isPlainObject(next)) {\n    patchLiveObject(value, prev, next);\n  } else {\n    liveObject.set(key, deepLiveify(next));\n  }\n}\nfunction patchLiveObject(root, prev, next) {\n  const updates = {};\n  for (const key in next) {\n    patchLiveObjectKey(root, key, prev[key], next[key]);\n  }\n  for (const key in prev) {\n    if (next[key] === void 0) {\n      root.delete(key);\n    }\n  }\n  if (Object.keys(updates).length > 0) {\n    root.update(updates);\n  }\n}\nfunction getParentsPath(node) {\n  const path = [];\n  while (node.parent.type === \"HasParent\") {\n    if (isLiveList(node.parent.node)) {\n      path.push(node.parent.node._indexOfPosition(node.parent.key));\n    } else {\n      path.push(node.parent.key);\n    }\n    node = node.parent.node;\n  }\n  return path;\n}\nfunction legacy_patchImmutableObject(state, updates) {\n  return updates.reduce(\n    (state2, update) => legacy_patchImmutableObjectWithUpdate(state2, update),\n    state\n  );\n}\nfunction legacy_patchImmutableObjectWithUpdate(state, update) {\n  const path = getParentsPath(update.node);\n  return legacy_patchImmutableNode(state, path, update);\n}\nfunction legacy_patchImmutableNode(state, path, update) {\n  const pathItem = path.pop();\n  if (pathItem === void 0) {\n    switch (update.type) {\n      case \"LiveObject\": {\n        if (!isJsonObject(state)) {\n          throw new Error(\n            \"Internal: received update on LiveObject but state was not an object\"\n          );\n        }\n        const newState = Object.assign({}, state);\n        for (const key in update.updates) {\n          if (update.updates[key]?.type === \"update\") {\n            const val = update.node.get(key);\n            if (val !== void 0) {\n              newState[key] = lsonToJson(val);\n            }\n          } else if (update.updates[key]?.type === \"delete\") {\n            delete newState[key];\n          }\n        }\n        return newState;\n      }\n      case \"LiveList\": {\n        if (!Array.isArray(state)) {\n          throw new Error(\n            \"Internal: received update on LiveList but state was not an array\"\n          );\n        }\n        let newState = state.map((x) => x);\n        for (const listUpdate of update.updates) {\n          if (listUpdate.type === \"set\") {\n            newState = newState.map(\n              (item, index) => index === listUpdate.index ? lsonToJson(listUpdate.item) : item\n            );\n          } else if (listUpdate.type === \"insert\") {\n            if (listUpdate.index === newState.length) {\n              newState.push(lsonToJson(listUpdate.item));\n            } else {\n              newState = [\n                ...newState.slice(0, listUpdate.index),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index)\n              ];\n            }\n          } else if (listUpdate.type === \"delete\") {\n            newState.splice(listUpdate.index, 1);\n          } else if (listUpdate.type === \"move\") {\n            if (listUpdate.previousIndex > listUpdate.index) {\n              newState = [\n                ...newState.slice(0, listUpdate.index),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index, listUpdate.previousIndex),\n                ...newState.slice(listUpdate.previousIndex + 1)\n              ];\n            } else {\n              newState = [\n                ...newState.slice(0, listUpdate.previousIndex),\n                ...newState.slice(\n                  listUpdate.previousIndex + 1,\n                  listUpdate.index + 1\n                ),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index + 1)\n              ];\n            }\n          }\n        }\n        return newState;\n      }\n      case \"LiveMap\": {\n        if (!isJsonObject(state)) {\n          throw new Error(\n            \"Internal: received update on LiveMap but state was not an object\"\n          );\n        }\n        const newState = Object.assign({}, state);\n        for (const key in update.updates) {\n          if (update.updates[key]?.type === \"update\") {\n            const value = update.node.get(key);\n            if (value !== void 0) {\n              newState[key] = lsonToJson(value);\n            }\n          } else if (update.updates[key]?.type === \"delete\") {\n            delete newState[key];\n          }\n        }\n        return newState;\n      }\n    }\n  }\n  if (Array.isArray(state)) {\n    const newArray = [...state];\n    newArray[pathItem] = legacy_patchImmutableNode(\n      state[pathItem],\n      path,\n      update\n    );\n    return newArray;\n  } else if (isJsonObject(state)) {\n    const node = state[pathItem];\n    if (node === void 0) {\n      return state;\n    } else {\n      const stateAsObj = state;\n      return {\n        ...stateAsObj,\n        [pathItem]: legacy_patchImmutableNode(node, path, update)\n      };\n    }\n  } else {\n    return state;\n  }\n}\n\n// src/lib/deprecation.ts\nvar _emittedDeprecationWarnings = /* @__PURE__ */ new Set();\nfunction deprecate(message, key = message) {\n  if (true) {\n    if (!_emittedDeprecationWarnings.has(key)) {\n      _emittedDeprecationWarnings.add(key);\n      errorWithTitle(\"Deprecation warning\", message);\n    }\n  }\n}\nfunction deprecateIf(condition, message, key = message) {\n  if (true) {\n    if (condition) {\n      deprecate(message, key);\n    }\n  }\n}\nfunction throwUsageError(message) {\n  if (true) {\n    const usageError = new Error(message);\n    usageError.name = \"Usage error\";\n    errorWithTitle(\"Usage error\", message);\n    throw usageError;\n  }\n}\nfunction errorIf(condition, message) {\n  if (true) {\n    if (condition) {\n      throwUsageError(message);\n    }\n  }\n}\n\n// src/lib/Poller.ts\nfunction makePoller(callback) {\n  let context = {\n    state: \"stopped\",\n    timeoutHandle: null,\n    interval: null,\n    lastScheduledAt: null,\n    remainingInterval: null\n  };\n  function poll() {\n    if (context.state === \"running\") {\n      schedule(context.interval);\n    }\n    void callback();\n  }\n  function schedule(interval) {\n    context = {\n      state: \"running\",\n      interval: context.state !== \"stopped\" ? context.interval : interval,\n      lastScheduledAt: performance.now(),\n      timeoutHandle: setTimeout(poll, interval),\n      remainingInterval: null\n    };\n  }\n  function scheduleRemaining(remaining) {\n    if (context.state !== \"paused\") {\n      return;\n    }\n    context = {\n      state: \"running\",\n      interval: context.interval,\n      lastScheduledAt: context.lastScheduledAt,\n      timeoutHandle: setTimeout(poll, remaining),\n      remainingInterval: null\n    };\n  }\n  function start(interval) {\n    if (context.state === \"running\") {\n      return;\n    }\n    schedule(interval);\n  }\n  function restart(interval) {\n    stop();\n    start(interval);\n  }\n  function pause() {\n    if (context.state !== \"running\") {\n      return;\n    }\n    clearTimeout(context.timeoutHandle);\n    context = {\n      state: \"paused\",\n      interval: context.interval,\n      lastScheduledAt: context.lastScheduledAt,\n      timeoutHandle: null,\n      remainingInterval: context.interval - (performance.now() - context.lastScheduledAt)\n    };\n  }\n  function resume() {\n    if (context.state !== \"paused\") {\n      return;\n    }\n    scheduleRemaining(context.remainingInterval);\n  }\n  function stop() {\n    if (context.state === \"stopped\") {\n      return;\n    }\n    if (context.timeoutHandle) {\n      clearTimeout(context.timeoutHandle);\n    }\n    context = {\n      state: \"stopped\",\n      interval: null,\n      lastScheduledAt: null,\n      timeoutHandle: null,\n      remainingInterval: null\n    };\n  }\n  return {\n    start,\n    restart,\n    pause,\n    resume,\n    stop\n  };\n}\n\n// src/lib/shallow.ts\nfunction shallowArray(xs, ys) {\n  if (xs.length !== ys.length) {\n    return false;\n  }\n  for (let i = 0; i < xs.length; i++) {\n    if (!Object.is(xs[i], ys[i])) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction shallowObj(objA, objB) {\n  if (typeof objA !== \"object\" || objA === null || typeof objB !== \"object\" || objB === null || Object.prototype.toString.call(objA) !== \"[object Object]\" || Object.prototype.toString.call(objB) !== \"[object Object]\") {\n    return false;\n  }\n  const keysA = Object.keys(objA);\n  if (keysA.length !== Object.keys(objB).length) {\n    return false;\n  }\n  return keysA.every(\n    (key) => Object.prototype.hasOwnProperty.call(objB, key) && Object.is(objA[key], objB[key])\n  );\n}\nfunction shallow(a, b) {\n  if (Object.is(a, b)) {\n    return true;\n  }\n  const isArrayA = Array.isArray(a);\n  const isArrayB = Array.isArray(b);\n  if (isArrayA || isArrayB) {\n    if (!isArrayA || !isArrayB) {\n      return false;\n    }\n    return shallowArray(a, b);\n  }\n  return shallowObj(a, b);\n}\n\n// src/index.ts\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvY29yZS9kaXN0L2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsa0NBQWtDO0FBQ2hFOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sS0FBcUMsRUFBRSxFQUUxQyxDQUFDO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxxQkFBcUIsR0FBRyxVQUFVO0FBQ3hFO0FBQ0E7QUFDQSxJQUFJO0FBQ0osSUFBSTtBQUNKO0FBQ0EscUdBQXFHLGtCQUFrQjtBQUN2SDtBQUNBO0FBQ0EsV0FBVyxTQUFTLEVBQUUsVUFBVTtBQUNoQyxXQUFXLFNBQVMsRUFBRSxjQUFjO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRix3QkFBd0I7QUFDM0c7QUFDQTtBQUNBLGFBQWEsVUFBVSxRQUFRLFlBQVk7QUFDM0MsYUFBYSxTQUFTLFFBQVEsV0FBVztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsZ0NBQWdDLHFCQUFxQixXQUFXLGdCQUFnQix1QkFBdUIsZ0JBQWdCO0FBQ3ZIO0FBQ0E7QUFDQSwwQ0FBMEMsYUFBb0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsYUFBb0I7QUFDOUQ7QUFDQTtBQUNBLHdCQUF3QixNQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlCQUFpQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGtCQUFrQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGVBQWU7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLHdCQUF3QjtBQUN0RDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw2QkFBNkI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLDhCQUE4QjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxLQUFLLFFBQVEsU0FBUyxVQUFVLGNBQWM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixlQUFlO0FBQ3pDLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFlBQVk7QUFDbEM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QywyQkFBMkI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsMEJBQTBCO0FBQzVFO0FBQ0EsMENBQTBDLCtCQUErQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHFCQUFxQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsMkJBQTJCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFTLEdBQUcsZUFBZTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxNQUFxQztBQUMzQztBQUNBO0FBQ0EsZ0JBQWdCLHdEQUF3RDtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE1BQU0sTUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDJCQUEyQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSw0R0FBNEcsYUFBYSxZQUFZLGVBQWU7QUFDcEo7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsaUJBQWlCO0FBQ3JEO0FBQ0Esb0NBQW9DLGdDQUFnQztBQUNwRSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxTQUFTO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDRDQUE0QztBQUM3RTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxRQUFRO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLDZCQUE2Qiw2QkFBNkI7QUFDMUQsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCw2QkFBNkIsc0JBQXNCO0FBQ25ELEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qix3Q0FBd0M7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLEVBQUU7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsZ0JBQWdCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHFCQUFxQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixhQUFhO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGNBQWM7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsbUNBQW1DO0FBQzVEO0FBQ0EsK0JBQStCLGtCQUFrQjtBQUNqRDtBQUNBLHlCQUF5QixrQ0FBa0M7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGdCQUFnQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscUJBQXFCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGtCQUFrQixJQUFJO0FBQzVELFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isb0JBQW9CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9CQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFCQUFxQjtBQUNqQztBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwrQkFBK0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFCQUFxQjtBQUNqQztBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtCQUErQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsTUFBTSxtQ0FBbUMsbUJBQW1CO0FBQzFHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVywrQkFBK0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxNQUFNLG1DQUFtQyx1QkFBdUI7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxNQUFNLG1DQUFtQyx1QkFBdUI7QUFDM0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsTUFBcUMsR0FBRyxDQUFNO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0EsYUFBYSxNQUFxQztBQUNsRDtBQUNBLEVBQUUsQ0FBUTtBQUNWOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksc0JBQXNCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLFFBQVE7QUFDUixpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixtQkFBbUIsK0JBQStCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLGVBQWU7QUFDaEM7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFNBQVM7QUFDNUIsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELCtCQUErQjtBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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Q0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBFQUEwRSxxQkFBcUIsT0FBTyxHQUFHLEtBQUs7QUFDOUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxNQUFxQyxHQUFHLENBQU07QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU8sR0FBRyxTQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLE9BQU8sc0JBQXNCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU07QUFDbkM7QUFDQTtBQUNBO0FBQ0EsY0FBYyxJQUFJLEdBQUcsMEJBQTBCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHFCQUFxQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVSx5QkFBeUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGFBQWEsR0FBRyxRQUFRO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxrQkFBa0I7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixJQUFxQztBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEVBQUUsZ0NBQWdDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxlQUFlO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxZQUFZLG9CQUFvQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsOENBQThDO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sc0JBQXNCLCtCQUErQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixhQUFhO0FBQ3BDO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsbUJBQW1CO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRUFBcUUsTUFBTTtBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNB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QTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDRCQUE0QjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILG9DQUFvQyxlQUFlO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsT0FBTyxJQUFJO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVksNEJBQTRCLFVBQVU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixxQkFBcUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMscUJBQXFCO0FBQ25FLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUNBQWlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLE9BQU87QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxTQUFTO0FBQ3BEO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxTQUFTO0FBQzVEO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Q0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQXFDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwwQkFBMEIsWUFBWTtBQUNsRTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQXFDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQXFDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixlQUFlO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQWlFRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvY29yZS9kaXN0L2luZGV4Lm1qcz84ZDMzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7XG52YXIgX19leHBvcnQgPSAodGFyZ2V0LCBhbGwpID0+IHtcbiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpXG4gICAgX19kZWZQcm9wKHRhcmdldCwgbmFtZSwgeyBnZXQ6IGFsbFtuYW1lXSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbn07XG5cbi8vIHNyYy92ZXJzaW9uLnRzXG52YXIgUEtHX05BTUUgPSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcbnZhciBQS0dfVkVSU0lPTiA9IFwiMi40LjBcIjtcbnZhciBQS0dfRk9STUFUID0gXCJlc21cIjtcblxuLy8gc3JjL2R1cGUtZGV0ZWN0aW9uLnRzXG52YXIgZyA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDoge307XG52YXIgY3Jvc3NMaW5rZWREb2NzID0gXCJodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvY3Jvc3MtbGlua2VkXCI7XG52YXIgZHVwZXNEb2NzID0gXCJodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvZHVwZXNcIjtcbnZhciBTUEFDRSA9IFwiIFwiO1xuZnVuY3Rpb24gZXJyb3IobXNnKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBjb25zb2xlLmVycm9yKG1zZyk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gIH1cbn1cbmZ1bmN0aW9uIGRldGVjdER1cGVzKHBrZ05hbWUsIHBrZ1ZlcnNpb24sIHBrZ0Zvcm1hdCkge1xuICBjb25zdCBwa2dJZCA9IFN5bWJvbC5mb3IocGtnTmFtZSk7XG4gIGNvbnN0IHBrZ0J1aWxkSW5mbyA9IHBrZ0Zvcm1hdCA/IGAke3BrZ1ZlcnNpb24gfHwgXCJkZXZcIn0gKCR7cGtnRm9ybWF0fSlgIDogcGtnVmVyc2lvbiB8fCBcImRldlwiO1xuICBpZiAoIWdbcGtnSWRdKSB7XG4gICAgZ1twa2dJZF0gPSBwa2dCdWlsZEluZm87XG4gIH0gZWxzZSBpZiAoZ1twa2dJZF0gPT09IHBrZ0J1aWxkSW5mbykge1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IG1zZyA9IFtcbiAgICAgIGBNdWx0aXBsZSBjb3BpZXMgb2YgTGl2ZWJsb2NrcyBhcmUgYmVpbmcgbG9hZGVkIGluIHlvdXIgcHJvamVjdC4gVGhpcyB3aWxsIGNhdXNlIGlzc3VlcyEgU2VlICR7ZHVwZXNEb2NzICsgU1BBQ0V9YCxcbiAgICAgIFwiXCIsXG4gICAgICBcIkNvbmZsaWN0czpcIixcbiAgICAgIGAtICR7cGtnTmFtZX0gJHtnW3BrZ0lkXX0gKGFscmVhZHkgbG9hZGVkKWAsXG4gICAgICBgLSAke3BrZ05hbWV9ICR7cGtnQnVpbGRJbmZvfSAodHJ5aW5nIHRvIGxvYWQgdGhpcyBub3cpYFxuICAgIF0uam9pbihcIlxcblwiKTtcbiAgICBlcnJvcihtc2cpO1xuICB9XG4gIGlmIChwa2dWZXJzaW9uICYmIFBLR19WRVJTSU9OICYmIHBrZ1ZlcnNpb24gIT09IFBLR19WRVJTSU9OKSB7XG4gICAgZXJyb3IoXG4gICAgICBbXG4gICAgICAgIGBDcm9zcy1saW5rZWQgdmVyc2lvbnMgb2YgTGl2ZWJsb2NrcyBmb3VuZCwgd2hpY2ggd2lsbCBjYXVzZSBpc3N1ZXMhIFNlZSAke2Nyb3NzTGlua2VkRG9jcyArIFNQQUNFfWAsXG4gICAgICAgIFwiXCIsXG4gICAgICAgIFwiQ29uZmxpY3RzOlwiLFxuICAgICAgICBgLSAke1BLR19OQU1FfSBpcyBhdCAke1BLR19WRVJTSU9OfWAsXG4gICAgICAgIGAtICR7cGtnTmFtZX0gaXMgYXQgJHtwa2dWZXJzaW9ufWAsXG4gICAgICAgIFwiXCIsXG4gICAgICAgIFwiQWx3YXlzIHVwZ3JhZGUgYWxsIExpdmVibG9ja3MgcGFja2FnZXMgdG8gdGhlIHNhbWUgdmVyc2lvbiBudW1iZXIuXCJcbiAgICAgIF0uam9pbihcIlxcblwiKVxuICAgICk7XG4gIH1cbn1cblxuLy8gc3JjL2xpYi9hc3NlcnQudHNcbmZ1bmN0aW9uIGFzc2VydE5ldmVyKF92YWx1ZSwgZXJybXNnKSB7XG4gIHRocm93IG5ldyBFcnJvcihlcnJtc2cpO1xufVxuZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgZXJybXNnKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBpZiAoIWNvbmRpdGlvbikge1xuICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKGVycm1zZyk7XG4gICAgICBlcnIubmFtZSA9IFwiQXNzZXJ0aW9uIGZhaWx1cmVcIjtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIG5uKHZhbHVlLCBlcnJtc2cgPSBcIkV4cGVjdGVkIHZhbHVlIHRvIGJlIG5vbi1udWxsYWJsZVwiKSB7XG4gIGFzc2VydCh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwLCBlcnJtc2cpO1xuICByZXR1cm4gdmFsdWU7XG59XG5cbi8vIHNyYy9saWIvY29udHJvbGxlZFByb21pc2UudHNcbmZ1bmN0aW9uIGNvbnRyb2xsZWRQcm9taXNlKCkge1xuICBsZXQgcmVzb2x2ZTtcbiAgbGV0IHJlamVjdDtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgIHJlc29sdmUgPSByZXM7XG4gICAgcmVqZWN0ID0gcmVqO1xuICB9KTtcbiAgcmV0dXJuIFtwcm9taXNlLCByZXNvbHZlLCByZWplY3RdO1xufVxuZnVuY3Rpb24gUHJvbWlzZV93aXRoUmVzb2x2ZXJzKCkge1xuICBjb25zdCBbcHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0XSA9IGNvbnRyb2xsZWRQcm9taXNlKCk7XG4gIHJldHVybiB7IHByb21pc2UsIHJlc29sdmUsIHJlamVjdCB9O1xufVxuXG4vLyBzcmMvbGliL0V2ZW50U291cmNlLnRzXG5mdW5jdGlvbiBtYWtlRXZlbnRTb3VyY2UoKSB7XG4gIGNvbnN0IF9vbmV0aW1lT2JzZXJ2ZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgY29uc3QgX29ic2VydmVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gIGxldCBfYnVmZmVyID0gbnVsbDtcbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgX2J1ZmZlciA9IFtdO1xuICB9XG4gIGZ1bmN0aW9uIHVucGF1c2UoKSB7XG4gICAgaWYgKF9idWZmZXIgPT09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBfYnVmZmVyKSB7XG4gICAgICBub3RpZnkoZXZlbnQpO1xuICAgIH1cbiAgICBfYnVmZmVyID0gbnVsbDtcbiAgfVxuICBmdW5jdGlvbiBzdWJzY3JpYmUoY2FsbGJhY2spIHtcbiAgICBfb2JzZXJ2ZXJzLmFkZChjYWxsYmFjayk7XG4gICAgcmV0dXJuICgpID0+IF9vYnNlcnZlcnMuZGVsZXRlKGNhbGxiYWNrKTtcbiAgfVxuICBmdW5jdGlvbiBzdWJzY3JpYmVPbmNlKGNhbGxiYWNrKSB7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuYWRkKGNhbGxiYWNrKTtcbiAgICByZXR1cm4gKCkgPT4gX29uZXRpbWVPYnNlcnZlcnMuZGVsZXRlKGNhbGxiYWNrKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiB3YWl0VW50aWwocHJlZGljYXRlKSB7XG4gICAgbGV0IHVuc3ViO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzKSA9PiB7XG4gICAgICB1bnN1YiA9IHN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKHByZWRpY2F0ZSA9PT0gdm9pZCAwIHx8IHByZWRpY2F0ZShldmVudCkpIHtcbiAgICAgICAgICByZXMoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KS5maW5hbGx5KCgpID0+IHVuc3ViPy4oKSk7XG4gIH1cbiAgZnVuY3Rpb24gbm90aWZ5T3JCdWZmZXIoZXZlbnQpIHtcbiAgICBpZiAoX2J1ZmZlciAhPT0gbnVsbCkge1xuICAgICAgX2J1ZmZlci5wdXNoKGV2ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm90aWZ5KGV2ZW50KTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gbm90aWZ5KGV2ZW50KSB7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuZm9yRWFjaCgoY2FsbGJhY2spID0+IGNhbGxiYWNrKGV2ZW50KSk7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuY2xlYXIoKTtcbiAgICBfb2JzZXJ2ZXJzLmZvckVhY2goKGNhbGxiYWNrKSA9PiBjYWxsYmFjayhldmVudCkpO1xuICB9XG4gIGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIF9vbmV0aW1lT2JzZXJ2ZXJzLmNsZWFyKCk7XG4gICAgX29ic2VydmVycy5jbGVhcigpO1xuICB9XG4gIGZ1bmN0aW9uIGNvdW50KCkge1xuICAgIHJldHVybiBfb25ldGltZU9ic2VydmVycy5zaXplICsgX29ic2VydmVycy5zaXplO1xuICB9XG4gIHJldHVybiB7XG4gICAgLy8gUHJpdmF0ZS9pbnRlcm5hbCBjb250cm9sIG92ZXIgZXZlbnQgZW1pc3Npb25cbiAgICBub3RpZnk6IG5vdGlmeU9yQnVmZmVyLFxuICAgIHN1YnNjcmliZSxcbiAgICBzdWJzY3JpYmVPbmNlLFxuICAgIGNsZWFyLFxuICAgIGNvdW50LFxuICAgIHdhaXRVbnRpbCxcbiAgICBwYXVzZSxcbiAgICB1bnBhdXNlLFxuICAgIC8vIFB1YmxpY2x5IGV4cG9zYWJsZSBzdWJzY3JpcHRpb24gQVBJXG4gICAgb2JzZXJ2YWJsZToge1xuICAgICAgc3Vic2NyaWJlLFxuICAgICAgc3Vic2NyaWJlT25jZSxcbiAgICAgIHdhaXRVbnRpbFxuICAgIH1cbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9mYW5jeS1jb25zb2xlLnRzXG52YXIgZmFuY3lfY29uc29sZV9leHBvcnRzID0ge307XG5fX2V4cG9ydChmYW5jeV9jb25zb2xlX2V4cG9ydHMsIHtcbiAgZXJyb3I6ICgpID0+IGVycm9yMixcbiAgZXJyb3JXaXRoVGl0bGU6ICgpID0+IGVycm9yV2l0aFRpdGxlLFxuICB3YXJuOiAoKSA9PiB3YXJuLFxuICB3YXJuV2l0aFRpdGxlOiAoKSA9PiB3YXJuV2l0aFRpdGxlXG59KTtcbnZhciBiYWRnZSA9IFwiYmFja2dyb3VuZDojMGUwZDEyO2JvcmRlci1yYWRpdXM6OTk5OXB4O2NvbG9yOiNmZmY7cGFkZGluZzozcHggN3B4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6NjAwO1wiO1xudmFyIGJvbGQgPSBcImZvbnQtd2VpZ2h0OjYwMFwiO1xuZnVuY3Rpb24gd3JhcChtZXRob2QpIHtcbiAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiID8gY29uc29sZVttZXRob2RdIDogKFxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgKG1lc3NhZ2UsIC4uLmFyZ3MpID0+IGNvbnNvbGVbbWV0aG9kXShcIiVjTGl2ZWJsb2Nrc1wiLCBiYWRnZSwgbWVzc2FnZSwgLi4uYXJncylcbiAgKTtcbn1cbnZhciB3YXJuID0gd3JhcChcIndhcm5cIik7XG52YXIgZXJyb3IyID0gd3JhcChcImVycm9yXCIpO1xuZnVuY3Rpb24gd3JhcFdpdGhUaXRsZShtZXRob2QpIHtcbiAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiID8gY29uc29sZVttZXRob2RdIDogKFxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgKHRpdGxlLCBtZXNzYWdlLCAuLi5hcmdzKSA9PiBjb25zb2xlW21ldGhvZF0oXG4gICAgICBgJWNMaXZlYmxvY2tzJWMgJHt0aXRsZX1gLFxuICAgICAgYmFkZ2UsXG4gICAgICBib2xkLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIC4uLmFyZ3NcbiAgICApXG4gICk7XG59XG52YXIgd2FybldpdGhUaXRsZSA9IHdyYXBXaXRoVGl0bGUoXCJ3YXJuXCIpO1xudmFyIGVycm9yV2l0aFRpdGxlID0gd3JhcFdpdGhUaXRsZShcImVycm9yXCIpO1xuXG4vLyBzcmMvbGliL2ZzbS50c1xuZnVuY3Rpb24gZGlzdGFuY2Uoc3RhdGUxLCBzdGF0ZTIpIHtcbiAgaWYgKHN0YXRlMSA9PT0gc3RhdGUyKSB7XG4gICAgcmV0dXJuIFswLCAwXTtcbiAgfVxuICBjb25zdCBjaHVua3MxID0gc3RhdGUxLnNwbGl0KFwiLlwiKTtcbiAgY29uc3QgY2h1bmtzMiA9IHN0YXRlMi5zcGxpdChcIi5cIik7XG4gIGNvbnN0IG1pbkxlbiA9IE1hdGgubWluKGNodW5rczEubGVuZ3RoLCBjaHVua3MyLmxlbmd0aCk7XG4gIGxldCBzaGFyZWQgPSAwO1xuICBmb3IgKDsgc2hhcmVkIDwgbWluTGVuOyBzaGFyZWQrKykge1xuICAgIGlmIChjaHVua3MxW3NoYXJlZF0gIT09IGNodW5rczJbc2hhcmVkXSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIGNvbnN0IHVwID0gY2h1bmtzMS5sZW5ndGggLSBzaGFyZWQ7XG4gIGNvbnN0IGRvd24gPSBjaHVua3MyLmxlbmd0aCAtIHNoYXJlZDtcbiAgcmV0dXJuIFt1cCwgZG93bl07XG59XG5mdW5jdGlvbiBwYXR0ZXJucyh0YXJnZXRTdGF0ZSwgbGV2ZWxzKSB7XG4gIGNvbnN0IHBhcnRzID0gdGFyZ2V0U3RhdGUuc3BsaXQoXCIuXCIpO1xuICBpZiAobGV2ZWxzIDwgMSB8fCBsZXZlbHMgPiBwYXJ0cy5sZW5ndGggKyAxKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBudW1iZXIgb2YgbGV2ZWxzXCIpO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBpZiAobGV2ZWxzID4gcGFydHMubGVuZ3RoKSB7XG4gICAgcmVzdWx0LnB1c2goXCIqXCIpO1xuICB9XG4gIGZvciAobGV0IGkgPSBwYXJ0cy5sZW5ndGggLSBsZXZlbHMgKyAxOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBzbGljZSA9IHBhcnRzLnNsaWNlKDAsIGkpO1xuICAgIGlmIChzbGljZS5sZW5ndGggPiAwKSB7XG4gICAgICByZXN1bHQucHVzaChzbGljZS5qb2luKFwiLlwiKSArIFwiLipcIik7XG4gICAgfVxuICB9XG4gIHJlc3VsdC5wdXNoKHRhcmdldFN0YXRlKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbnZhciBTYWZlQ29udGV4dCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaW5pdGlhbENvbnRleHQpIHtcbiAgICB0aGlzLmN1cnIgPSBpbml0aWFsQ29udGV4dDtcbiAgfVxuICBnZXQgY3VycmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyO1xuICB9XG4gIC8qKlxuICAgKiBDYWxsIGEgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBhbGxvd3MgcGF0Y2hpbmcgb2YgdGhlIGNvbnRleHQsIGJ5XG4gICAqIGNhbGxpbmcgYGNvbnRleHQucGF0Y2goKWAuIFBhdGNoaW5nIGlzIG9ubHkgYWxsb3dlZCBmb3IgdGhlIGR1cmF0aW9uXG4gICAqIG9mIHRoaXMgd2luZG93LlxuICAgKi9cbiAgYWxsb3dQYXRjaGluZyhjYWxsYmFjaykge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBhbGxvd2VkID0gdHJ1ZTtcbiAgICBjb25zdCBwYXRjaGFibGVDb250ZXh0ID0ge1xuICAgICAgLi4udGhpcy5jdXJyLFxuICAgICAgcGF0Y2gocGF0Y2gpIHtcbiAgICAgICAgaWYgKGFsbG93ZWQpIHtcbiAgICAgICAgICBzZWxmLmN1cnIgPSBPYmplY3QuYXNzaWduKHt9LCBzZWxmLmN1cnIsIHBhdGNoKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhaXIgb2YgT2JqZWN0LmVudHJpZXMocGF0Y2gpKSB7XG4gICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBwYWlyO1xuICAgICAgICAgICAgaWYgKGtleSAhPT0gXCJwYXRjaFwiKSB7XG4gICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4gbm8gbG9uZ2VyIHBhdGNoIHN0YWxlIGNvbnRleHRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGNhbGxiYWNrKHBhdGNoYWJsZUNvbnRleHQpO1xuICAgIGFsbG93ZWQgPSBmYWxzZTtcbiAgICByZXR1cm47XG4gIH1cbn07XG52YXIgbmV4dElkID0gMTtcbnZhciBGU00gPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbml0aWFsIHN0YXRlLCB3aGljaCBpcyBkZWZpbmVkIGJ5IHRoZSBmaXJzdCBjYWxsIG1hZGUgdG9cbiAgICogLmFkZFN0YXRlKCkuXG4gICAqL1xuICBnZXQgaW5pdGlhbFN0YXRlKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuc3RhdGVzLnZhbHVlcygpW1N5bWJvbC5pdGVyYXRvcl0oKS5uZXh0KCk7XG4gICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBzdGF0ZXMgZGVmaW5lZCB5ZXRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXN1bHQudmFsdWU7XG4gICAgfVxuICB9XG4gIGdldCBjdXJyZW50U3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID09PSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgPT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBzdGFydGVkIHlldFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgc3RvcHBlZFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsO1xuICB9XG4gIC8qKlxuICAgKiBTdGFydHMgdGhlIG1hY2hpbmUgYnkgZW50ZXJpbmcgdGhlIGluaXRpYWwgc3RhdGUuXG4gICAqL1xuICBzdGFydCgpIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgIT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdGF0ZSBtYWNoaW5lIGhhcyBhbHJlYWR5IHN0YXJ0ZWRcIik7XG4gICAgfVxuICAgIHRoaXMucnVubmluZ1N0YXRlID0gMSAvKiBTVEFSVEVEICovO1xuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gdGhpcy5pbml0aWFsU3RhdGU7XG4gICAgdGhpcy5lbnRlcihudWxsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKipcbiAgICogU3RvcHMgdGhlIHN0YXRlIG1hY2hpbmUuIFN0b3BwaW5nIHRoZSBzdGF0ZSBtYWNoaW5lIHdpbGwgY2FsbCBleGl0XG4gICAqIGhhbmRsZXJzIGZvciB0aGUgY3VycmVudCBzdGF0ZSwgYnV0IG5vdCBlbnRlciBhIG5ldyBzdGF0ZS5cbiAgICovXG4gIHN0b3AoKSB7XG4gICAgaWYgKHRoaXMucnVubmluZ1N0YXRlICE9PSAxIC8qIFNUQVJURUQgKi8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzdG9wIGEgc3RhdGUgbWFjaGluZSB0aGF0IGhhc24ndCBzdGFydGVkIHlldFwiKTtcbiAgICB9XG4gICAgdGhpcy5leGl0KG51bGwpO1xuICAgIHRoaXMucnVubmluZ1N0YXRlID0gMiAvKiBTVE9QUEVEICovO1xuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gbnVsbDtcbiAgfVxuICBjb25zdHJ1Y3Rvcihpbml0aWFsQ29udGV4dCkge1xuICAgIHRoaXMuaWQgPSBuZXh0SWQrKztcbiAgICB0aGlzLnJ1bm5pbmdTdGF0ZSA9IDAgLyogTk9UX1NUQVJURURfWUVUICovO1xuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gbnVsbDtcbiAgICB0aGlzLnN0YXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgdGhpcy5lbnRlckZucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5jbGVhbnVwU3RhY2sgPSBbXTtcbiAgICB0aGlzLmtub3duRXZlbnRUeXBlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgdGhpcy5hbGxvd2VkVHJhbnNpdGlvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQgPSBuZXcgU2FmZUNvbnRleHQoaW5pdGlhbENvbnRleHQpO1xuICAgIHRoaXMuZXZlbnRIdWIgPSB7XG4gICAgICBkaWRSZWNlaXZlRXZlbnQ6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgICAgd2lsbFRyYW5zaXRpb246IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgICAgZGlkSWdub3JlRXZlbnQ6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgICAgd2lsbEV4aXRTdGF0ZTogbWFrZUV2ZW50U291cmNlKCksXG4gICAgICBkaWRFbnRlclN0YXRlOiBtYWtlRXZlbnRTb3VyY2UoKVxuICAgIH07XG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICBkaWRSZWNlaXZlRXZlbnQ6IHRoaXMuZXZlbnRIdWIuZGlkUmVjZWl2ZUV2ZW50Lm9ic2VydmFibGUsXG4gICAgICB3aWxsVHJhbnNpdGlvbjogdGhpcy5ldmVudEh1Yi53aWxsVHJhbnNpdGlvbi5vYnNlcnZhYmxlLFxuICAgICAgZGlkSWdub3JlRXZlbnQ6IHRoaXMuZXZlbnRIdWIuZGlkSWdub3JlRXZlbnQub2JzZXJ2YWJsZSxcbiAgICAgIHdpbGxFeGl0U3RhdGU6IHRoaXMuZXZlbnRIdWIud2lsbEV4aXRTdGF0ZS5vYnNlcnZhYmxlLFxuICAgICAgZGlkRW50ZXJTdGF0ZTogdGhpcy5ldmVudEh1Yi5kaWRFbnRlclN0YXRlLm9ic2VydmFibGVcbiAgICB9O1xuICB9XG4gIGdldCBjb250ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRDb250ZXh0LmN1cnJlbnQ7XG4gIH1cbiAgLyoqXG4gICAqIERlZmluZSBhbiBleHBsaWNpdCBmaW5pdGUgc3RhdGUgaW4gdGhlIHN0YXRlIG1hY2hpbmUuXG4gICAqL1xuICBhZGRTdGF0ZShzdGF0ZSkge1xuICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSAhPT0gMCAvKiBOT1RfU1RBUlRFRF9ZRVQgKi8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgc3RhcnRlZFwiKTtcbiAgICB9XG4gICAgdGhpcy5zdGF0ZXMuYWRkKHN0YXRlKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBvbkVudGVyKG5hbWVPclBhdHRlcm4sIGVudGVyRm4pIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgIT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbHJlYWR5IHN0YXJ0ZWRcIik7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVudGVyRm5zLmhhcyhuYW1lT3JQYXR0ZXJuKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAvLyBUT0RPIFdlIF9jdXJyZW50bHlfIGRvbid0IHN1cHBvcnQgbXVsdGlwbGUgLm9uRW50ZXJzKCkgZm9yIHRoZSBzYW1lXG4gICAgICAgIC8vIHN0YXRlLCBidXQgdGhpcyBpcyBub3QgYSBmdW5kYW1lbnRhbCBsaW1pdGF0aW9uLiBKdXN0IG5vdFxuICAgICAgICAvLyBpbXBsZW1lbnRlZCB5ZXQuIElmIHdlIHdhbnRlZCB0bywgd2UgY291bGQgbWFrZSB0aGlzIGFuIGFycmF5LlxuICAgICAgICBgZW50ZXIvZXhpdCBmdW5jdGlvbiBmb3IgJHtuYW1lT3JQYXR0ZXJufSBhbHJlYWR5IGV4aXN0c2BcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuZW50ZXJGbnMuc2V0KG5hbWVPclBhdHRlcm4sIGVudGVyRm4pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIG9uRW50ZXJBc3luYyhuYW1lT3JQYXR0ZXJuLCBwcm9taXNlRm4sIG9uT0ssIG9uRXJyb3IpIHtcbiAgICByZXR1cm4gdGhpcy5vbkVudGVyKG5hbWVPclBhdHRlcm4sICgpID0+IHtcbiAgICAgIGNvbnN0IGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgIGNvbnN0IHNpZ25hbCA9IGFib3J0Q29udHJvbGxlci5zaWduYWw7XG4gICAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgICAgdm9pZCBwcm9taXNlRm4odGhpcy5jdXJyZW50Q29udGV4dC5jdXJyZW50LCBzaWduYWwpLnRoZW4oXG4gICAgICAgIC8vIE9uIE9LXG4gICAgICAgIChkYXRhKSA9PiB7XG4gICAgICAgICAgaWYgKCFzaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb24oeyB0eXBlOiBcIkFTWU5DX09LXCIsIGRhdGEgfSwgb25PSyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyBPbiBFcnJvclxuICAgICAgICAocmVhc29uKSA9PiB7XG4gICAgICAgICAgaWYgKCFzaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb24oeyB0eXBlOiBcIkFTWU5DX0VSUk9SXCIsIHJlYXNvbiB9LCBvbkVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBpZiAoIWRvbmUpIHtcbiAgICAgICAgICBhYm9ydENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuICBnZXRTdGF0ZXNNYXRjaGluZyhuYW1lT3JQYXR0ZXJuKSB7XG4gICAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICAgIGlmIChuYW1lT3JQYXR0ZXJuID09PSBcIipcIikge1xuICAgICAgZm9yIChjb25zdCBzdGF0ZSBvZiB0aGlzLnN0YXRlcykge1xuICAgICAgICBtYXRjaGVzLnB1c2goc3RhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobmFtZU9yUGF0dGVybi5lbmRzV2l0aChcIi4qXCIpKSB7XG4gICAgICBjb25zdCBwcmVmaXggPSBuYW1lT3JQYXR0ZXJuLnNsaWNlKDAsIC0xKTtcbiAgICAgIGZvciAoY29uc3Qgc3RhdGUgb2YgdGhpcy5zdGF0ZXMpIHtcbiAgICAgICAgaWYgKHN0YXRlLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgICAgIG1hdGNoZXMucHVzaChzdGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmFtZSA9IG5hbWVPclBhdHRlcm47XG4gICAgICBpZiAodGhpcy5zdGF0ZXMuaGFzKG5hbWUpKSB7XG4gICAgICAgIG1hdGNoZXMucHVzaChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHN0YXRlcyBtYXRjaCAke0pTT04uc3RyaW5naWZ5KG5hbWVPclBhdHRlcm4pfWApO1xuICAgIH1cbiAgICByZXR1cm4gbWF0Y2hlcztcbiAgfVxuICAvKipcbiAgICogRGVmaW5lIGFsbCBhbGxvd2VkIG91dGdvaW5nIHRyYW5zaXRpb25zIGZvciBhIHN0YXRlLlxuICAgKlxuICAgKiBUaGUgdGFyZ2V0cyBmb3IgZWFjaCBldmVudCBjYW4gYmUgZGVmaW5lZCBhcyBhIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdGhlXG4gICAqIG5leHQgc3RhdGUgdG8gdHJhbnNpdGlvbiB0by4gVGhlc2UgZnVuY3Rpb25zIGNhbiBsb29rIGF0IHRoZSBgZXZlbnRgIG9yXG4gICAqIGBjb250ZXh0YCBwYXJhbXMgdG8gY29uZGl0aW9uYWxseSBkZWNpZGUgd2hpY2ggbmV4dCBzdGF0ZSB0byB0cmFuc2l0aW9uXG4gICAqIHRvLlxuICAgKlxuICAgKiBJZiB5b3Ugc2V0IGl0IHRvIGBudWxsYCwgdGhlbiB0aGUgdHJhbnNpdGlvbiB3aWxsIGJlIGV4cGxpY2l0bHkgZm9yYmlkZGVuXG4gICAqIGFuZCB0aHJvdyBhbiBlcnJvci4gSWYgeW91IGRvbid0IGRlZmluZSBhIHRhcmdldCBmb3IgYSB0cmFuc2l0aW9uLCB0aGVuXG4gICAqIHN1Y2ggZXZlbnRzIHdpbGwgZ2V0IGlnbm9yZWQuXG4gICAqL1xuICBhZGRUcmFuc2l0aW9ucyhuYW1lT3JQYXR0ZXJuLCBtYXBwaW5nKSB7XG4gICAgaWYgKHRoaXMucnVubmluZ1N0YXRlICE9PSAwIC8qIE5PVF9TVEFSVEVEX1lFVCAqLykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSBzdGFydGVkXCIpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHNyY1N0YXRlIG9mIHRoaXMuZ2V0U3RhdGVzTWF0Y2hpbmcobmFtZU9yUGF0dGVybikpIHtcbiAgICAgIGxldCBtYXAgPSB0aGlzLmFsbG93ZWRUcmFuc2l0aW9ucy5nZXQoc3JjU3RhdGUpO1xuICAgICAgaWYgKG1hcCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIG1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuYWxsb3dlZFRyYW5zaXRpb25zLnNldChzcmNTdGF0ZSwgbWFwKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgW3R5cGUsIHRhcmdldF9dIG9mIE9iamVjdC5lbnRyaWVzKG1hcHBpbmcpKSB7XG4gICAgICAgIGlmIChtYXAuaGFzKHR5cGUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFRyeWluZyB0byBzZXQgdHJhbnNpdGlvbiBcIiR7dHlwZX1cIiBvbiBcIiR7c3JjU3RhdGV9XCIgKHZpYSBcIiR7bmFtZU9yUGF0dGVybn1cIiksIGJ1dCBhIHRyYW5zaXRpb24gYWxyZWFkeSBleGlzdHMgdGhlcmUuYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGFyZ2V0XztcbiAgICAgICAgdGhpcy5rbm93bkV2ZW50VHlwZXMuYWRkKHR5cGUpO1xuICAgICAgICBpZiAodGFyZ2V0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBjb25zdCB0YXJnZXRGbiA9IHR5cGVvZiB0YXJnZXQgPT09IFwiZnVuY3Rpb25cIiA/IHRhcmdldCA6ICgpID0+IHRhcmdldDtcbiAgICAgICAgICBtYXAuc2V0KHR5cGUsIHRhcmdldEZuKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKipcbiAgICogTGlrZSBgLmFkZFRyYW5zaXRpb24oKWAsIGJ1dCB0YWtlcyBhbiAoYW5vbnltb3VzKSB0cmFuc2l0aW9uIHdoZW5ldmVyIHRoZVxuICAgKiB0aW1lciBmaXJlcy5cbiAgICpcbiAgICogQHBhcmFtIHN0YXRlT3JQYXR0ZXJuIFRoZSBzdGF0ZSBuYW1lLCBvciBzdGF0ZSBncm91cCBwYXR0ZXJuIG5hbWUuXG4gICAqIEBwYXJhbSBhZnRlciAgICAgICAgICBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIGFmdGVyIHdoaWNoIHRvIHRha2UgdGhlXG4gICAqICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uLiBJZiBpbiB0aGUgbWVhbiB0aW1lLCBhbm90aGVyIHRyYW5zaXRpb25cbiAgICogICAgICAgICAgICAgICAgICAgICAgIGlzIHRha2VuLCB0aGUgdGltZXIgd2lsbCBnZXQgY2FuY2VsbGVkLlxuICAgKiBAcGFyYW0gdGFyZ2V0ICAgICBUaGUgdGFyZ2V0IHN0YXRlIHRvIGdvIHRvLlxuICAgKi9cbiAgYWRkVGltZWRUcmFuc2l0aW9uKHN0YXRlT3JQYXR0ZXJuLCBhZnRlcjIsIHRhcmdldCkge1xuICAgIHJldHVybiB0aGlzLm9uRW50ZXIoc3RhdGVPclBhdHRlcm4sICgpID0+IHtcbiAgICAgIGNvbnN0IG1zID0gdHlwZW9mIGFmdGVyMiA9PT0gXCJmdW5jdGlvblwiID8gYWZ0ZXIyKHRoaXMuY3VycmVudENvbnRleHQuY3VycmVudCkgOiBhZnRlcjI7XG4gICAgICBjb25zdCB0aW1lb3V0SUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uKHsgdHlwZTogXCJUSU1FUlwiIH0sIHRhcmdldCk7XG4gICAgICB9LCBtcyk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElEKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbiAgZ2V0VGFyZ2V0Rm4oZXZlbnROYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuYWxsb3dlZFRyYW5zaXRpb25zLmdldCh0aGlzLmN1cnJlbnRTdGF0ZSk/LmdldChldmVudE5hbWUpO1xuICB9XG4gIC8qKlxuICAgKiBFeGl0cyB0aGUgY3VycmVudCBzdGF0ZSwgYW5kIGV4ZWN1dGVzIGFueSBuZWNlc3NhcnkgY2xlYW51cCBmdW5jdGlvbnMuXG4gICAqIENhbGwgdGhpcyBiZWZvcmUgY2hhbmdpbmcgdGhlIGN1cnJlbnQgc3RhdGUgdG8gdGhlIG5leHQgc3RhdGUuXG4gICAqXG4gICAqIEBwYXJhbSBsZXZlbHMgRGVmaW5lcyBob3cgbWFueSBcImxldmVsc1wiIG9mIG5lc3Rpbmcgd2lsbCBiZVxuICAgKiBleGl0ZWQuIEZvciBleGFtcGxlLCBpZiB5b3UgdHJhbnNpdGlvbiBmcm9tIGBmb28uYmFyLnF1eGAgdG9cbiAgICogYGZvby5iYXIuYmF6YCwgdGhlbiB0aGUgbGV2ZWwgaXMgMS4gQnV0IGlmIHlvdSB0cmFuc2l0aW9uIGZyb21cbiAgICogYGZvby5iYXIucXV4YCB0byBgYmxhLmJsYWAsIHRoZW4gdGhlIGxldmVsIGlzIDMuXG4gICAqIElmIGBudWxsYCwgaXQgd2lsbCBleGl0IGFsbCBsZXZlbHMuXG4gICAqL1xuICBleGl0KGxldmVscykge1xuICAgIHRoaXMuZXZlbnRIdWIud2lsbEV4aXRTdGF0ZS5ub3RpZnkodGhpcy5jdXJyZW50U3RhdGUpO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQuYWxsb3dQYXRjaGluZygocGF0Y2hhYmxlQ29udGV4dCkgPT4ge1xuICAgICAgbGV2ZWxzID0gbGV2ZWxzID8/IHRoaXMuY2xlYW51cFN0YWNrLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGV2ZWxzOyBpKyspIHtcbiAgICAgICAgdGhpcy5jbGVhbnVwU3RhY2sucG9wKCk/LihwYXRjaGFibGVDb250ZXh0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogRW50ZXJzIHRoZSBjdXJyZW50IHN0YXRlLCBhbmQgZXhlY3V0ZXMgYW55IG5lY2Vzc2FyeSBvbkVudGVyIGhhbmRsZXJzLlxuICAgKiBDYWxsIHRoaXMgZGlyZWN0bHkgX2FmdGVyXyBzZXR0aW5nIHRoZSBjdXJyZW50IHN0YXRlIHRvIHRoZSBuZXh0IHN0YXRlLlxuICAgKi9cbiAgZW50ZXIobGV2ZWxzKSB7XG4gICAgY29uc3QgZW50ZXJQYXR0ZXJucyA9IHBhdHRlcm5zKFxuICAgICAgdGhpcy5jdXJyZW50U3RhdGUsXG4gICAgICBsZXZlbHMgPz8gdGhpcy5jdXJyZW50U3RhdGUuc3BsaXQoXCIuXCIpLmxlbmd0aCArIDFcbiAgICApO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQuYWxsb3dQYXRjaGluZygocGF0Y2hhYmxlQ29udGV4dCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGVudGVyUGF0dGVybnMpIHtcbiAgICAgICAgY29uc3QgZW50ZXJGbiA9IHRoaXMuZW50ZXJGbnMuZ2V0KHBhdHRlcm4pO1xuICAgICAgICBjb25zdCBjbGVhbnVwRm4gPSBlbnRlckZuPy4ocGF0Y2hhYmxlQ29udGV4dCk7XG4gICAgICAgIGlmICh0eXBlb2YgY2xlYW51cEZuID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICB0aGlzLmNsZWFudXBTdGFjay5wdXNoKGNsZWFudXBGbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jbGVhbnVwU3RhY2sucHVzaChudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuZXZlbnRIdWIuZGlkRW50ZXJTdGF0ZS5ub3RpZnkodGhpcy5jdXJyZW50U3RhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBTZW5kcyBhbiBldmVudCB0byB0aGUgbWFjaGluZSwgd2hpY2ggbWF5IGNhdXNlIGFuIGludGVybmFsIHN0YXRlXG4gICAqIHRyYW5zaXRpb24gdG8gaGFwcGVuLiBXaGVuIHRoYXQgaGFwcGVucywgd2lsbCB0cmlnZ2VyIHNpZGUgZWZmZWN0cy5cbiAgICovXG4gIHNlbmQoZXZlbnQpIHtcbiAgICBpZiAoIXRoaXMua25vd25FdmVudFR5cGVzLmhhcyhldmVudC50eXBlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGV2ZW50ICR7SlNPTi5zdHJpbmdpZnkoZXZlbnQudHlwZSl9YCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSA9PT0gMiAvKiBTVE9QUEVEICovKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRhcmdldEZuID0gdGhpcy5nZXRUYXJnZXRGbihldmVudC50eXBlKTtcbiAgICBpZiAodGFyZ2V0Rm4gIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHRoaXMudHJhbnNpdGlvbihldmVudCwgdGFyZ2V0Rm4pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmV2ZW50SHViLmRpZElnbm9yZUV2ZW50Lm5vdGlmeShldmVudCk7XG4gICAgfVxuICB9XG4gIHRyYW5zaXRpb24oZXZlbnQsIHRhcmdldCkge1xuICAgIHRoaXMuZXZlbnRIdWIuZGlkUmVjZWl2ZUV2ZW50Lm5vdGlmeShldmVudCk7XG4gICAgY29uc3Qgb2xkU3RhdGUgPSB0aGlzLmN1cnJlbnRTdGF0ZTtcbiAgICBjb25zdCB0YXJnZXRGbiA9IHR5cGVvZiB0YXJnZXQgPT09IFwiZnVuY3Rpb25cIiA/IHRhcmdldCA6ICgpID0+IHRhcmdldDtcbiAgICBjb25zdCBuZXh0VGFyZ2V0ID0gdGFyZ2V0Rm4oZXZlbnQsIHRoaXMuY3VycmVudENvbnRleHQuY3VycmVudCk7XG4gICAgbGV0IG5leHRTdGF0ZTtcbiAgICBsZXQgZWZmZWN0cyA9IHZvaWQgMDtcbiAgICBpZiAobmV4dFRhcmdldCA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5ldmVudEh1Yi5kaWRJZ25vcmVFdmVudC5ub3RpZnkoZXZlbnQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG5leHRUYXJnZXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIG5leHRTdGF0ZSA9IG5leHRUYXJnZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHRTdGF0ZSA9IG5leHRUYXJnZXQudGFyZ2V0O1xuICAgICAgZWZmZWN0cyA9IEFycmF5LmlzQXJyYXkobmV4dFRhcmdldC5lZmZlY3QpID8gbmV4dFRhcmdldC5lZmZlY3QgOiBbbmV4dFRhcmdldC5lZmZlY3RdO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc3RhdGVzLmhhcyhuZXh0U3RhdGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbmV4dCBzdGF0ZSBuYW1lOiAke0pTT04uc3RyaW5naWZ5KG5leHRTdGF0ZSl9YCk7XG4gICAgfVxuICAgIHRoaXMuZXZlbnRIdWIud2lsbFRyYW5zaXRpb24ubm90aWZ5KHsgZnJvbTogb2xkU3RhdGUsIHRvOiBuZXh0U3RhdGUgfSk7XG4gICAgY29uc3QgW3VwLCBkb3duXSA9IGRpc3RhbmNlKHRoaXMuY3VycmVudFN0YXRlLCBuZXh0U3RhdGUpO1xuICAgIGlmICh1cCA+IDApIHtcbiAgICAgIHRoaXMuZXhpdCh1cCk7XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gbmV4dFN0YXRlO1xuICAgIGlmIChlZmZlY3RzICE9PSB2b2lkIDApIHtcbiAgICAgIGNvbnN0IGVmZmVjdHNUb1J1biA9IGVmZmVjdHM7XG4gICAgICB0aGlzLmN1cnJlbnRDb250ZXh0LmFsbG93UGF0Y2hpbmcoKHBhdGNoYWJsZUNvbnRleHQpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBlZmZlY3Qgb2YgZWZmZWN0c1RvUnVuKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBlZmZlY3QgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgZWZmZWN0KHBhdGNoYWJsZUNvbnRleHQsIGV2ZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGF0Y2hhYmxlQ29udGV4dC5wYXRjaChlZmZlY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChkb3duID4gMCkge1xuICAgICAgdGhpcy5lbnRlcihkb3duKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNyYy9saWIvdXRpbHMudHNcbmZ1bmN0aW9uIHJhaXNlKG1zZykge1xuICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbn1cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QoYmxvYikge1xuICByZXR1cm4gYmxvYiAhPT0gbnVsbCAmJiB0eXBlb2YgYmxvYiA9PT0gXCJvYmplY3RcIiAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYmxvYikgPT09IFwiW29iamVjdCBPYmplY3RdXCI7XG59XG5mdW5jdGlvbiBlbnRyaWVzKG9iaikge1xuICByZXR1cm4gT2JqZWN0LmVudHJpZXMob2JqKTtcbn1cbmZ1bmN0aW9uIHRyeVBhcnNlSnNvbihyYXdNZXNzYWdlKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UocmF3TWVzc2FnZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG59XG5mdW5jdGlvbiBkZWVwQ2xvbmUodmFsdWUpIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbn1cbmZ1bmN0aW9uIGI2NGRlY29kZShiNjR2YWx1ZSkge1xuICB0cnkge1xuICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gYjY0dmFsdWUucmVwbGFjZSgvLS9nLCBcIitcIikucmVwbGFjZSgvXy9nLCBcIi9cIik7XG4gICAgY29uc3QgZGVjb2RlZFZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KFxuICAgICAgYXRvYihmb3JtYXR0ZWRWYWx1ZSkuc3BsaXQoXCJcIikubWFwKGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgcmV0dXJuIFwiJVwiICsgKFwiMDBcIiArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgICAgIH0pLmpvaW4oXCJcIilcbiAgICApO1xuICAgIHJldHVybiBkZWNvZGVkVmFsdWU7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBhdG9iKGI2NHZhbHVlKTtcbiAgfVxufVxuZnVuY3Rpb24gY29tcGFjdChpdGVtcykge1xuICByZXR1cm4gaXRlbXMuZmlsdGVyKFxuICAgIChpdGVtKSA9PiBpdGVtICE9PSBudWxsICYmIGl0ZW0gIT09IHZvaWQgMFxuICApO1xufVxuZnVuY3Rpb24gY29tcGFjdE9iamVjdChvYmopIHtcbiAgY29uc3QgbmV3T2JqID0geyAuLi5vYmogfTtcbiAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gaztcbiAgICBpZiAobmV3T2JqW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgZGVsZXRlIG5ld09ialtrZXldO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBuZXdPYmo7XG59XG5mdW5jdGlvbiB3YWl0KG1pbGxpcykge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlcykgPT4gc2V0VGltZW91dChyZXMsIG1pbGxpcykpO1xufVxuYXN5bmMgZnVuY3Rpb24gd2l0aFRpbWVvdXQocHJvbWlzZSwgbWlsbGlzLCBlcnJtc2cpIHtcbiAgbGV0IHRpbWVySUQ7XG4gIGNvbnN0IHRpbWVyJCA9IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHtcbiAgICB0aW1lcklEID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICByZWplY3QobmV3IEVycm9yKGVycm1zZykpO1xuICAgIH0sIG1pbGxpcyk7XG4gIH0pO1xuICByZXR1cm4gUHJvbWlzZS5yYWNlKFtwcm9taXNlLCB0aW1lciRdKS5maW5hbGx5KCgpID0+IGNsZWFyVGltZW91dCh0aW1lcklEKSk7XG59XG5mdW5jdGlvbiBtZW1vaXplT25TdWNjZXNzKGZhY3RvcnlGbikge1xuICBsZXQgY2FjaGVkID0gbnVsbDtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBpZiAoY2FjaGVkID09PSBudWxsKSB7XG4gICAgICBjYWNoZWQgPSBmYWN0b3J5Rm4oKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGNhY2hlZCA9IG51bGw7XG4gICAgICAgIH0sIDVlMyk7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVkO1xuICB9O1xufVxuXG4vLyBzcmMvcHJvdG9jb2wvU2VydmVyTXNnLnRzXG52YXIgU2VydmVyTXNnQ29kZSA9IC8qIEBfX1BVUkVfXyAqLyAoKFNlcnZlck1zZ0NvZGUyKSA9PiB7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVBEQVRFX1BSRVNFTkNFXCJdID0gMTAwXSA9IFwiVVBEQVRFX1BSRVNFTkNFXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVNFUl9KT0lORURcIl0gPSAxMDFdID0gXCJVU0VSX0pPSU5FRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlVTRVJfTEVGVFwiXSA9IDEwMl0gPSBcIlVTRVJfTEVGVFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIkJST0FEQ0FTVEVEX0VWRU5UXCJdID0gMTAzXSA9IFwiQlJPQURDQVNURURfRVZFTlRcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJST09NX1NUQVRFXCJdID0gMTA0XSA9IFwiUk9PTV9TVEFURVwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIklOSVRJQUxfU1RPUkFHRV9TVEFURVwiXSA9IDIwMF0gPSBcIklOSVRJQUxfU1RPUkFHRV9TVEFURVwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlVQREFURV9TVE9SQUdFXCJdID0gMjAxXSA9IFwiVVBEQVRFX1NUT1JBR0VcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJSRUpFQ1RfU1RPUkFHRV9PUFwiXSA9IDI5OV0gPSBcIlJFSkVDVF9TVE9SQUdFX09QXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVBEQVRFX1lET0NcIl0gPSAzMDBdID0gXCJVUERBVEVfWURPQ1wiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlRIUkVBRF9DUkVBVEVEXCJdID0gNDAwXSA9IFwiVEhSRUFEX0NSRUFURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJUSFJFQURfREVMRVRFRFwiXSA9IDQwN10gPSBcIlRIUkVBRF9ERUxFVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVEhSRUFEX01FVEFEQVRBX1VQREFURURcIl0gPSA0MDFdID0gXCJUSFJFQURfTUVUQURBVEFfVVBEQVRFRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlRIUkVBRF9VUERBVEVEXCJdID0gNDA4XSA9IFwiVEhSRUFEX1VQREFURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX0NSRUFURURcIl0gPSA0MDJdID0gXCJDT01NRU5UX0NSRUFURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX0VESVRFRFwiXSA9IDQwM10gPSBcIkNPTU1FTlRfRURJVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiQ09NTUVOVF9ERUxFVEVEXCJdID0gNDA0XSA9IFwiQ09NTUVOVF9ERUxFVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiQ09NTUVOVF9SRUFDVElPTl9BRERFRFwiXSA9IDQwNV0gPSBcIkNPTU1FTlRfUkVBQ1RJT05fQURERURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX1JFQUNUSU9OX1JFTU9WRURcIl0gPSA0MDZdID0gXCJDT01NRU5UX1JFQUNUSU9OX1JFTU9WRURcIjtcbiAgcmV0dXJuIFNlcnZlck1zZ0NvZGUyO1xufSkoU2VydmVyTXNnQ29kZSB8fCB7fSk7XG5cbi8vIHNyYy90eXBlcy9JV2ViU29ja2V0LnRzXG52YXIgV2Vic29ja2V0Q2xvc2VDb2RlcyA9IC8qIEBfX1BVUkVfXyAqLyAoKFdlYnNvY2tldENsb3NlQ29kZXMyKSA9PiB7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiQ0xPU0VfTk9STUFMXCJdID0gMWUzXSA9IFwiQ0xPU0VfTk9STUFMXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiQ0xPU0VfQUJOT1JNQUxcIl0gPSAxMDA2XSA9IFwiQ0xPU0VfQUJOT1JNQUxcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJVTkVYUEVDVEVEX0NPTkRJVElPTlwiXSA9IDEwMTFdID0gXCJVTkVYUEVDVEVEX0NPTkRJVElPTlwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIlRSWV9BR0FJTl9MQVRFUlwiXSA9IDEwMTNdID0gXCJUUllfQUdBSU5fTEFURVJcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJJTlZBTElEX01FU1NBR0VfRk9STUFUXCJdID0gNGUzXSA9IFwiSU5WQUxJRF9NRVNTQUdFX0ZPUk1BVFwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIk5PVF9BTExPV0VEXCJdID0gNDAwMV0gPSBcIk5PVF9BTExPV0VEXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9NRVNTQUdFU19QRVJfU0VDT05EU1wiXSA9IDQwMDJdID0gXCJNQVhfTlVNQkVSX09GX01FU1NBR0VTX1BFUl9TRUNPTkRTXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9DT05DVVJSRU5UX0NPTk5FQ1RJT05TXCJdID0gNDAwM10gPSBcIk1BWF9OVU1CRVJfT0ZfQ09OQ1VSUkVOVF9DT05ORUNUSU9OU1wiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIk1BWF9OVU1CRVJfT0ZfTUVTU0FHRVNfUEVSX0RBWV9QRVJfQVBQXCJdID0gNDAwNF0gPSBcIk1BWF9OVU1CRVJfT0ZfTUVTU0FHRVNfUEVSX0RBWV9QRVJfQVBQXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9DT05DVVJSRU5UX0NPTk5FQ1RJT05TX1BFUl9ST09NXCJdID0gNDAwNV0gPSBcIk1BWF9OVU1CRVJfT0ZfQ09OQ1VSUkVOVF9DT05ORUNUSU9OU19QRVJfUk9PTVwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIlJPT01fSURfVVBEQVRFRFwiXSA9IDQwMDZdID0gXCJST09NX0lEX1VQREFURURcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJLSUNLRURcIl0gPSA0MTAwXSA9IFwiS0lDS0VEXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiVE9LRU5fRVhQSVJFRFwiXSA9IDQxMDldID0gXCJUT0tFTl9FWFBJUkVEXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiQ0xPU0VfV0lUSE9VVF9SRVRSWVwiXSA9IDQ5OTldID0gXCJDTE9TRV9XSVRIT1VUX1JFVFJZXCI7XG4gIHJldHVybiBXZWJzb2NrZXRDbG9zZUNvZGVzMjtcbn0pKFdlYnNvY2tldENsb3NlQ29kZXMgfHwge30pO1xuZnVuY3Rpb24gc2hvdWxkRGlzY29ubmVjdChjb2RlKSB7XG4gIHJldHVybiBjb2RlID09PSA0OTk5IC8qIENMT1NFX1dJVEhPVVRfUkVUUlkgKi8gfHwgY29kZSA+PSA0ZTMgJiYgY29kZSA8IDQxMDA7XG59XG5mdW5jdGlvbiBzaG91bGRSZWF1dGgoY29kZSkge1xuICByZXR1cm4gY29kZSA+PSA0MTAwICYmIGNvZGUgPCA0MjAwO1xufVxuZnVuY3Rpb24gc2hvdWxkUmV0cnlXaXRob3V0UmVhdXRoKGNvZGUpIHtcbiAgcmV0dXJuIGNvZGUgPT09IDEwMTMgLyogVFJZX0FHQUlOX0xBVEVSICovIHx8IGNvZGUgPj0gNDIwMCAmJiBjb2RlIDwgNDMwMDtcbn1cblxuLy8gc3JjL2Nvbm5lY3Rpb24udHNcbmZ1bmN0aW9uIGlzSWRsZShzdGF0dXMpIHtcbiAgcmV0dXJuIHN0YXR1cyA9PT0gXCJpbml0aWFsXCIgfHwgc3RhdHVzID09PSBcImRpc2Nvbm5lY3RlZFwiO1xufVxuZnVuY3Rpb24gdG9OZXdDb25uZWN0aW9uU3RhdHVzKG1hY2hpbmUpIHtcbiAgY29uc3Qgc3RhdGUgPSBtYWNoaW5lLmN1cnJlbnRTdGF0ZTtcbiAgc3dpdGNoIChzdGF0ZSkge1xuICAgIGNhc2UgXCJAb2suY29ubmVjdGVkXCI6XG4gICAgY2FzZSBcIkBvay5hd2FpdGluZy1wb25nXCI6XG4gICAgICByZXR1cm4gXCJjb25uZWN0ZWRcIjtcbiAgICBjYXNlIFwiQGlkbGUuaW5pdGlhbFwiOlxuICAgICAgcmV0dXJuIFwiaW5pdGlhbFwiO1xuICAgIGNhc2UgXCJAYXV0aC5idXN5XCI6XG4gICAgY2FzZSBcIkBhdXRoLmJhY2tvZmZcIjpcbiAgICBjYXNlIFwiQGNvbm5lY3RpbmcuYnVzeVwiOlxuICAgIGNhc2UgXCJAY29ubmVjdGluZy5iYWNrb2ZmXCI6XG4gICAgY2FzZSBcIkBpZGxlLnpvbWJpZVwiOlxuICAgICAgcmV0dXJuIG1hY2hpbmUuY29udGV4dC5zdWNjZXNzQ291bnQgPiAwID8gXCJyZWNvbm5lY3RpbmdcIiA6IFwiY29ubmVjdGluZ1wiO1xuICAgIGNhc2UgXCJAaWRsZS5mYWlsZWRcIjpcbiAgICAgIHJldHVybiBcImRpc2Nvbm5lY3RlZFwiO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIoc3RhdGUsIFwiVW5rbm93biBzdGF0ZVwiKTtcbiAgfVxufVxudmFyIEJBQ0tPRkZfREVMQVlTID0gWzI1MCwgNTAwLCAxZTMsIDJlMywgNGUzLCA4ZTMsIDFlNF07XG52YXIgUkVTRVRfREVMQVkgPSBCQUNLT0ZGX0RFTEFZU1swXSAtIDE7XG52YXIgQkFDS09GRl9ERUxBWVNfU0xPVyA9IFsyZTMsIDNlNCwgNmU0LCAzZTVdO1xudmFyIEhFQVJUQkVBVF9JTlRFUlZBTCA9IDNlNDtcbnZhciBQT05HX1RJTUVPVVQgPSAyZTM7XG52YXIgQVVUSF9USU1FT1VUID0gMWU0O1xudmFyIFNPQ0tFVF9DT05ORUNUX1RJTUVPVVQgPSAxZTQ7XG52YXIgU3RvcFJldHJ5aW5nID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHJlYXNvbikge1xuICAgIHN1cGVyKHJlYXNvbik7XG4gIH1cbn07XG52YXIgTGl2ZWJsb2Nrc0Vycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IobWVzc2FnZSwgY29kZSkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gIH1cbn07XG5mdW5jdGlvbiBuZXh0QmFja29mZkRlbGF5KGN1cnJlbnREZWxheSwgZGVsYXlzKSB7XG4gIHJldHVybiBkZWxheXMuZmluZCgoZGVsYXkpID0+IGRlbGF5ID4gY3VycmVudERlbGF5KSA/PyBkZWxheXNbZGVsYXlzLmxlbmd0aCAtIDFdO1xufVxuZnVuY3Rpb24gaW5jcmVhc2VCYWNrb2ZmRGVsYXkoY29udGV4dCkge1xuICBjb250ZXh0LnBhdGNoKHtcbiAgICBiYWNrb2ZmRGVsYXk6IG5leHRCYWNrb2ZmRGVsYXkoY29udGV4dC5iYWNrb2ZmRGVsYXksIEJBQ0tPRkZfREVMQVlTKVxuICB9KTtcbn1cbmZ1bmN0aW9uIGluY3JlYXNlQmFja29mZkRlbGF5QWdncmVzc2l2ZWx5KGNvbnRleHQpIHtcbiAgY29udGV4dC5wYXRjaCh7XG4gICAgYmFja29mZkRlbGF5OiBuZXh0QmFja29mZkRlbGF5KGNvbnRleHQuYmFja29mZkRlbGF5LCBCQUNLT0ZGX0RFTEFZU19TTE9XKVxuICB9KTtcbn1cbmZ1bmN0aW9uIHJlc2V0U3VjY2Vzc0NvdW50KGNvbnRleHQpIHtcbiAgY29udGV4dC5wYXRjaCh7IHN1Y2Nlc3NDb3VudDogMCB9KTtcbn1cbmZ1bmN0aW9uIGxvZyhsZXZlbCwgbWVzc2FnZSkge1xuICBjb25zdCBsb2dnZXIgPSBsZXZlbCA9PT0gMiAvKiBFUlJPUiAqLyA/IGVycm9yMiA6IGxldmVsID09PSAxIC8qIFdBUk4gKi8gPyB3YXJuIDogKFxuICAgIC8qIGJsYWNrIGhvbGUgKi9cbiAgICAoKSA9PiB7XG4gICAgfVxuICApO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGxvZ2dlcihtZXNzYWdlKTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGxvZ1ByZW1hdHVyZUVycm9yT3JDbG9zZUV2ZW50KGUpIHtcbiAgY29uc3QgY29ubiA9IFwiQ29ubmVjdGlvbiB0byBMaXZlYmxvY2tzIHdlYnNvY2tldCBzZXJ2ZXJcIjtcbiAgcmV0dXJuIChjdHgpID0+IHtcbiAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB3YXJuKGAke2Nvbm59IGNvdWxkIG5vdCBiZSBlc3RhYmxpc2hlZC4gJHtTdHJpbmcoZSl9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdhcm4oXG4gICAgICAgIGlzQ2xvc2VFdmVudChlKSA/IGAke2Nvbm59IGNsb3NlZCBwcmVtYXR1cmVseSAoY29kZTogJHtlLmNvZGV9KS4gUmV0cnlpbmcgaW4gJHtjdHguYmFja29mZkRlbGF5fW1zLmAgOiBgJHtjb25ufSBjb3VsZCBub3QgYmUgZXN0YWJsaXNoZWQuYFxuICAgICAgKTtcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiBsb2dDbG9zZUV2ZW50KGV2ZW50KSB7XG4gIGNvbnN0IGRldGFpbHMgPSBbYGNvZGU6ICR7ZXZlbnQuY29kZX1gXTtcbiAgaWYgKGV2ZW50LnJlYXNvbikge1xuICAgIGRldGFpbHMucHVzaChgcmVhc29uOiAke2V2ZW50LnJlYXNvbn1gKTtcbiAgfVxuICByZXR1cm4gKGN0eCkgPT4ge1xuICAgIHdhcm4oXG4gICAgICBgQ29ubmVjdGlvbiB0byBMaXZlYmxvY2tzIHdlYnNvY2tldCBzZXJ2ZXIgY2xvc2VkICgke2RldGFpbHMuam9pbihcIiwgXCIpfSkuIFJldHJ5aW5nIGluICR7Y3R4LmJhY2tvZmZEZWxheX1tcy5gXG4gICAgKTtcbiAgfTtcbn1cbnZhciBsb2dQZXJtYW5lbnRDbG9zZSA9IGxvZyhcbiAgMSAvKiBXQVJOICovLFxuICBcIkNvbm5lY3Rpb24gdG8gV2ViU29ja2V0IGNsb3NlZCBwZXJtYW5lbnRseS4gV29uJ3QgcmV0cnkuXCJcbik7XG5mdW5jdGlvbiBpc0Nsb3NlRXZlbnQoZXJyb3IzKSB7XG4gIHJldHVybiAhKGVycm9yMyBpbnN0YW5jZW9mIEVycm9yKSAmJiBlcnJvcjMudHlwZSA9PT0gXCJjbG9zZVwiO1xufVxuZnVuY3Rpb24gZW5hYmxlVHJhY2luZyhtYWNoaW5lKSB7XG4gIGNvbnN0IHN0YXJ0ID0gKC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG4gIGZ1bmN0aW9uIGxvZzIoLi4uYXJncykge1xuICAgIHdhcm4oXG4gICAgICBgJHsoKCgvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gc3RhcnQpIC8gMWUzKS50b0ZpeGVkKDIpfSBbRlNNICMke21hY2hpbmUuaWR9XWAsXG4gICAgICAuLi5hcmdzXG4gICAgKTtcbiAgfVxuICBjb25zdCB1bnN1YnMgPSBbXG4gICAgbWFjaGluZS5ldmVudHMuZGlkUmVjZWl2ZUV2ZW50LnN1YnNjcmliZSgoZSkgPT4gbG9nMihgRXZlbnQgJHtlLnR5cGV9YCkpLFxuICAgIG1hY2hpbmUuZXZlbnRzLndpbGxUcmFuc2l0aW9uLnN1YnNjcmliZShcbiAgICAgICh7IGZyb20sIHRvIH0pID0+IGxvZzIoXCJUcmFuc2l0aW9uaW5nXCIsIGZyb20sIFwiXFx1MjE5MlwiLCB0bylcbiAgICApLFxuICAgIG1hY2hpbmUuZXZlbnRzLmRpZElnbm9yZUV2ZW50LnN1YnNjcmliZShcbiAgICAgIChlKSA9PiBsb2cyKFwiSWdub3JlZCBldmVudFwiLCBlLnR5cGUsIGUsIFwiKGN1cnJlbnQgc3RhdGUgd29uJ3QgaGFuZGxlIGl0KVwiKVxuICAgIClcbiAgICAvLyBtYWNoaW5lLmV2ZW50cy53aWxsRXhpdFN0YXRlLnN1YnNjcmliZSgocykgPT4gbG9nKFwiRXhpdGluZyBzdGF0ZVwiLCBzKSksXG4gICAgLy8gbWFjaGluZS5ldmVudHMuZGlkRW50ZXJTdGF0ZS5zdWJzY3JpYmUoKHMpID0+IGxvZyhcIkVudGVyaW5nIHN0YXRlXCIsIHMpKSxcbiAgXTtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBmb3IgKGNvbnN0IHVuc3ViIG9mIHVuc3Vicykge1xuICAgICAgdW5zdWIoKTtcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiBkZWZpbmVDb25uZWN0aXZpdHlFdmVudHMobWFjaGluZSkge1xuICBjb25zdCBzdGF0dXNEaWRDaGFuZ2UgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgY29uc3QgZGlkQ29ubmVjdCA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBjb25zdCBkaWREaXNjb25uZWN0ID0gbWFrZUV2ZW50U291cmNlKCk7XG4gIGxldCBsYXN0U3RhdHVzID0gbnVsbDtcbiAgY29uc3QgdW5zdWJzY3JpYmUgPSBtYWNoaW5lLmV2ZW50cy5kaWRFbnRlclN0YXRlLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgY29uc3QgY3VyclN0YXR1cyA9IHRvTmV3Q29ubmVjdGlvblN0YXR1cyhtYWNoaW5lKTtcbiAgICBpZiAoY3VyclN0YXR1cyAhPT0gbGFzdFN0YXR1cykge1xuICAgICAgc3RhdHVzRGlkQ2hhbmdlLm5vdGlmeShjdXJyU3RhdHVzKTtcbiAgICB9XG4gICAgaWYgKGxhc3RTdGF0dXMgPT09IFwiY29ubmVjdGVkXCIgJiYgY3VyclN0YXR1cyAhPT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgZGlkRGlzY29ubmVjdC5ub3RpZnkoKTtcbiAgICB9IGVsc2UgaWYgKGxhc3RTdGF0dXMgIT09IFwiY29ubmVjdGVkXCIgJiYgY3VyclN0YXR1cyA9PT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgZGlkQ29ubmVjdC5ub3RpZnkoKTtcbiAgICB9XG4gICAgbGFzdFN0YXR1cyA9IGN1cnJTdGF0dXM7XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIHN0YXR1c0RpZENoYW5nZTogc3RhdHVzRGlkQ2hhbmdlLm9ic2VydmFibGUsXG4gICAgZGlkQ29ubmVjdDogZGlkQ29ubmVjdC5vYnNlcnZhYmxlLFxuICAgIGRpZERpc2Nvbm5lY3Q6IGRpZERpc2Nvbm5lY3Qub2JzZXJ2YWJsZSxcbiAgICB1bnN1YnNjcmliZVxuICB9O1xufVxudmFyIGFzc2lnbiA9IChwYXRjaCkgPT4gKGN0eCkgPT4gY3R4LnBhdGNoKHBhdGNoKTtcbmZ1bmN0aW9uIGNyZWF0ZUNvbm5lY3Rpb25TdGF0ZU1hY2hpbmUoZGVsZWdhdGVzLCBvcHRpb25zKSB7XG4gIGNvbnN0IG9uTWVzc2FnZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBvbk1lc3NhZ2UucGF1c2UoKTtcbiAgY29uc3Qgb25MaXZlYmxvY2tzRXJyb3IgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgZnVuY3Rpb24gZmlyZUVycm9yRXZlbnQoZXJybXNnLCBlcnJjb2RlKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IGVyciA9IG5ldyBMaXZlYmxvY2tzRXJyb3IoZXJybXNnLCBlcnJjb2RlKTtcbiAgICAgIG9uTGl2ZWJsb2Nrc0Vycm9yLm5vdGlmeShlcnIpO1xuICAgIH07XG4gIH1cbiAgY29uc3QgaW5pdGlhbENvbnRleHQgPSB7XG4gICAgc3VjY2Vzc0NvdW50OiAwLFxuICAgIGF1dGhWYWx1ZTogbnVsbCxcbiAgICBzb2NrZXQ6IG51bGwsXG4gICAgYmFja29mZkRlbGF5OiBSRVNFVF9ERUxBWVxuICB9O1xuICBjb25zdCBtYWNoaW5lID0gbmV3IEZTTShpbml0aWFsQ29udGV4dCkuYWRkU3RhdGUoXCJAaWRsZS5pbml0aWFsXCIpLmFkZFN0YXRlKFwiQGlkbGUuZmFpbGVkXCIpLmFkZFN0YXRlKFwiQGlkbGUuem9tYmllXCIpLmFkZFN0YXRlKFwiQGF1dGguYnVzeVwiKS5hZGRTdGF0ZShcIkBhdXRoLmJhY2tvZmZcIikuYWRkU3RhdGUoXCJAY29ubmVjdGluZy5idXN5XCIpLmFkZFN0YXRlKFwiQGNvbm5lY3RpbmcuYmFja29mZlwiKS5hZGRTdGF0ZShcIkBvay5jb25uZWN0ZWRcIikuYWRkU3RhdGUoXCJAb2suYXdhaXRpbmctcG9uZ1wiKTtcbiAgbWFjaGluZS5hZGRUcmFuc2l0aW9ucyhcIipcIiwge1xuICAgIFJFQ09OTkVDVDoge1xuICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCByZXNldFN1Y2Nlc3NDb3VudF1cbiAgICB9LFxuICAgIERJU0NPTk5FQ1Q6IFwiQGlkbGUuaW5pdGlhbFwiXG4gIH0pO1xuICBtYWNoaW5lLm9uRW50ZXIoXCJAaWRsZS4qXCIsIHJlc2V0U3VjY2Vzc0NvdW50KS5hZGRUcmFuc2l0aW9ucyhcIkBpZGxlLipcIiwge1xuICAgIENPTk5FQ1Q6IChfLCBjdHgpID0+IChcbiAgICAgIC8vIElmIHdlIHN0aWxsIGhhdmUgYSBrbm93biBhdXRoVmFsdWUsIHRyeSB0byByZWNvbm5lY3QgdG8gdGhlIHNvY2tldCBkaXJlY3RseSxcbiAgICAgIC8vIG90aGVyd2lzZSwgdHJ5IHRvIG9idGFpbiBhIG5ldyBhdXRoVmFsdWVcbiAgICAgIGN0eC5hdXRoVmFsdWUgIT09IG51bGwgPyBcIkBjb25uZWN0aW5nLmJ1c3lcIiA6IFwiQGF1dGguYnVzeVwiXG4gICAgKVxuICB9KTtcbiAgbWFjaGluZS5hZGRUcmFuc2l0aW9ucyhcIkBhdXRoLmJhY2tvZmZcIiwge1xuICAgIE5BVklHQVRPUl9PTkxJTkU6IHtcbiAgICAgIHRhcmdldDogXCJAYXV0aC5idXN5XCIsXG4gICAgICBlZmZlY3Q6IGFzc2lnbih7IGJhY2tvZmZEZWxheTogUkVTRVRfREVMQVkgfSlcbiAgICB9XG4gIH0pLmFkZFRpbWVkVHJhbnNpdGlvbihcbiAgICBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAoY3R4KSA9PiBjdHguYmFja29mZkRlbGF5LFxuICAgIFwiQGF1dGguYnVzeVwiXG4gICkub25FbnRlckFzeW5jKFxuICAgIFwiQGF1dGguYnVzeVwiLFxuICAgICgpID0+IHdpdGhUaW1lb3V0KFxuICAgICAgZGVsZWdhdGVzLmF1dGhlbnRpY2F0ZSgpLFxuICAgICAgQVVUSF9USU1FT1VULFxuICAgICAgXCJUaW1lZCBvdXQgZHVyaW5nIGF1dGhcIlxuICAgICksXG4gICAgLy8gT24gc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvblxuICAgIChva0V2ZW50KSA9PiAoe1xuICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJ1c3lcIixcbiAgICAgIGVmZmVjdDogYXNzaWduKHtcbiAgICAgICAgYXV0aFZhbHVlOiBva0V2ZW50LmRhdGFcbiAgICAgIH0pXG4gICAgfSksXG4gICAgLy8gQXV0aCBmYWlsZWRcbiAgICAoZmFpbGVkRXZlbnQpID0+IHtcbiAgICAgIGlmIChmYWlsZWRFdmVudC5yZWFzb24gaW5zdGFuY2VvZiBTdG9wUmV0cnlpbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0YXJnZXQ6IFwiQGlkbGUuZmFpbGVkXCIsXG4gICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICBsb2coMiAvKiBFUlJPUiAqLywgZmFpbGVkRXZlbnQucmVhc29uLm1lc3NhZ2UpLFxuICAgICAgICAgICAgZmlyZUVycm9yRXZlbnQoZmFpbGVkRXZlbnQucmVhc29uLm1lc3NhZ2UsIC0xKVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldDogXCJAYXV0aC5iYWNrb2ZmXCIsXG4gICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgIGluY3JlYXNlQmFja29mZkRlbGF5LFxuICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgIDIgLyogRVJST1IgKi8sXG4gICAgICAgICAgICBgQXV0aGVudGljYXRpb24gZmFpbGVkOiAke2ZhaWxlZEV2ZW50LnJlYXNvbiBpbnN0YW5jZW9mIEVycm9yID8gZmFpbGVkRXZlbnQucmVhc29uLm1lc3NhZ2UgOiBTdHJpbmcoZmFpbGVkRXZlbnQucmVhc29uKX1gXG4gICAgICAgICAgKVxuICAgICAgICBdXG4gICAgICB9O1xuICAgIH1cbiAgKTtcbiAgY29uc3Qgb25Tb2NrZXRFcnJvciA9IChldmVudCkgPT4gbWFjaGluZS5zZW5kKHsgdHlwZTogXCJFWFBMSUNJVF9TT0NLRVRfRVJST1JcIiwgZXZlbnQgfSk7XG4gIGNvbnN0IG9uU29ja2V0Q2xvc2UgPSAoZXZlbnQpID0+IG1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiRVhQTElDSVRfU09DS0VUX0NMT1NFXCIsIGV2ZW50IH0pO1xuICBjb25zdCBvblNvY2tldE1lc3NhZ2UgPSAoZXZlbnQpID0+IGV2ZW50LmRhdGEgPT09IFwicG9uZ1wiID8gbWFjaGluZS5zZW5kKHsgdHlwZTogXCJQT05HXCIgfSkgOiBvbk1lc3NhZ2Uubm90aWZ5KGV2ZW50KTtcbiAgZnVuY3Rpb24gdGVhcmRvd25Tb2NrZXQoc29ja2V0KSB7XG4gICAgaWYgKHNvY2tldCkge1xuICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCBvblNvY2tldEVycm9yKTtcbiAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgb25Tb2NrZXRDbG9zZSk7XG4gICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgb25Tb2NrZXRNZXNzYWdlKTtcbiAgICAgIHNvY2tldC5jbG9zZSgpO1xuICAgIH1cbiAgfVxuICBtYWNoaW5lLmFkZFRyYW5zaXRpb25zKFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLCB7XG4gICAgTkFWSUdBVE9SX09OTElORToge1xuICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJ1c3lcIixcbiAgICAgIGVmZmVjdDogYXNzaWduKHsgYmFja29mZkRlbGF5OiBSRVNFVF9ERUxBWSB9KVxuICAgIH1cbiAgfSkuYWRkVGltZWRUcmFuc2l0aW9uKFxuICAgIFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLFxuICAgIChjdHgpID0+IGN0eC5iYWNrb2ZmRGVsYXksXG4gICAgXCJAY29ubmVjdGluZy5idXN5XCJcbiAgKS5vbkVudGVyQXN5bmMoXG4gICAgXCJAY29ubmVjdGluZy5idXN5XCIsXG4gICAgLy9cbiAgICAvLyBVc2UgdGhlIFwiY3JlYXRlU29ja2V0XCIgZGVsZWdhdGUgZnVuY3Rpb24gKHByb3ZpZGVkIHRvIHRoZVxuICAgIC8vIE1hbmFnZWRTb2NrZXQpIHRvIGNyZWF0ZSB0aGUgYWN0dWFsIFdlYlNvY2tldCBjb25uZWN0aW9uIGluc3RhbmNlLlxuICAgIC8vIFRoZW4sIHNldCB1cCBhbGwgdGhlIG5lY2Vzc2FyeSBldmVudCBsaXN0ZW5lcnMsIGFuZCB3YWl0IGZvciB0aGVcbiAgICAvLyBcIm9wZW5cIiBldmVudCB0byBvY2N1ci5cbiAgICAvL1xuICAgIC8vIFdoZW4gdGhlIFwib3BlblwiIGV2ZW50IGhhcHBlbnMsIHdlJ3JlIHJlYWR5IHRvIHRyYW5zaXRpb24gdG8gdGhlXG4gICAgLy8gT0sgc3RhdGUuIFRoaXMgaXMgZG9uZSBieSByZXNvbHZpbmcgdGhlIFByb21pc2UuXG4gICAgLy9cbiAgICBhc3luYyAoY3R4LCBzaWduYWwpID0+IHtcbiAgICAgIGxldCBjYXB0dXJlZFByZW1hdHVyZUV2ZW50ID0gbnVsbDtcbiAgICAgIGxldCB1bmNvbmZpcm1lZFNvY2tldCA9IG51bGw7XG4gICAgICBjb25zdCBjb25uZWN0JCA9IG5ldyBQcm9taXNlKFxuICAgICAgICAocmVzb2x2ZSwgcmVqKSA9PiB7XG4gICAgICAgICAgaWYgKGN0eC5hdXRoVmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGF1dGggYXV0aFZhbHVlXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBzb2NrZXQgPSBkZWxlZ2F0ZXMuY3JlYXRlU29ja2V0KGN0eC5hdXRoVmFsdWUpO1xuICAgICAgICAgIHVuY29uZmlybWVkU29ja2V0ID0gc29ja2V0O1xuICAgICAgICAgIGZ1bmN0aW9uIHJlamVjdChldmVudCkge1xuICAgICAgICAgICAgY2FwdHVyZWRQcmVtYXR1cmVFdmVudCA9IGV2ZW50O1xuICAgICAgICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG9uU29ja2V0TWVzc2FnZSk7XG4gICAgICAgICAgICByZWooZXZlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBbYWN0b3IkLCBkaWRSZWNlaXZlQWN0b3JdID0gY29udHJvbGxlZFByb21pc2UoKTtcbiAgICAgICAgICBpZiAoIW9wdGlvbnMud2FpdEZvckFjdG9ySWQpIHtcbiAgICAgICAgICAgIGRpZFJlY2VpdmVBY3RvcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmdW5jdGlvbiB3YWl0Rm9yQWN0b3JJZChldmVudCkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyTXNnID0gdHJ5UGFyc2VKc29uKGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgaWYgKHNlcnZlck1zZz8udHlwZSA9PT0gMTA0IC8qIFJPT01fU1RBVEUgKi8pIHtcbiAgICAgICAgICAgICAgZGlkUmVjZWl2ZUFjdG9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBvblNvY2tldE1lc3NhZ2UpO1xuICAgICAgICAgIGlmIChvcHRpb25zLndhaXRGb3JBY3RvcklkKSB7XG4gICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgd2FpdEZvckFjdG9ySWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIHJlamVjdCk7XG4gICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCByZWplY3QpO1xuICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwib3BlblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIG9uU29ja2V0RXJyb3IpO1xuICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCBvblNvY2tldENsb3NlKTtcbiAgICAgICAgICAgIGNvbnN0IHVuc3ViID0gKCkgPT4ge1xuICAgICAgICAgICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIHJlamVjdCk7XG4gICAgICAgICAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIHdhaXRGb3JBY3RvcklkKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2b2lkIGFjdG9yJC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShbc29ja2V0LCB1bnN1Yl0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gd2l0aFRpbWVvdXQoXG4gICAgICAgIGNvbm5lY3QkLFxuICAgICAgICBTT0NLRVRfQ09OTkVDVF9USU1FT1VULFxuICAgICAgICBcIlRpbWVkIG91dCBkdXJpbmcgd2Vic29ja2V0IGNvbm5lY3Rpb25cIlxuICAgICAgKS50aGVuKFxuICAgICAgICAvL1xuICAgICAgICAvLyBQYXJ0IDM6XG4gICAgICAgIC8vIEJ5IG5vdywgb3VyIFwib3BlblwiIGV2ZW50IGhhcyBmaXJlZCwgYW5kIHRoZSBwcm9taXNlIGhhcyBiZWVuXG4gICAgICAgIC8vIHJlc29sdmVkLiBUd28gcG9zc2libGUgc2NlbmFyaW9zOlxuICAgICAgICAvL1xuICAgICAgICAvLyAxLiBUaGUgaGFwcHkgcGF0aC4gTW9zdCBsaWtlbHkuXG4gICAgICAgIC8vIDIuIFVoLW9oLiBBIHByZW1hdHVyZSBjbG9zZS9lcnJvciBldmVudCBoYXMgYmVlbiBvYnNlcnZlZC4gTGV0J3NcbiAgICAgICAgLy8gICAgcmVqZWN0IHRoZSBwcm9taXNlIGFmdGVyIGFsbC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gQW55IGNsb3NlL2Vycm9yIGV2ZW50IHRoYXQgd2lsbCBnZXQgc2NoZWR1bGVkIGFmdGVyIHRoaXMgcG9pbnRcbiAgICAgICAgLy8gb253YXJkcywgd2lsbCBiZSBjYXVnaHQgaW4gdGhlIE9LIHN0YXRlLCBhbmQgZGVhbHQgd2l0aFxuICAgICAgICAvLyBhY2NvcmRpbmdseS5cbiAgICAgICAgLy9cbiAgICAgICAgKFtzb2NrZXQsIHVuc3ViXSkgPT4ge1xuICAgICAgICAgIHVuc3ViKCk7XG4gICAgICAgICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBYm9ydGVkXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2FwdHVyZWRQcmVtYXR1cmVFdmVudCkge1xuICAgICAgICAgICAgdGhyb3cgY2FwdHVyZWRQcmVtYXR1cmVFdmVudDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNvY2tldDtcbiAgICAgICAgfVxuICAgICAgKS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICB0ZWFyZG93blNvY2tldCh1bmNvbmZpcm1lZFNvY2tldCk7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8vIE9ubHkgdHJhbnNpdGlvbiB0byBPSyBzdGF0ZSBhZnRlciBhIHN1Y2Nlc3NmdWxseSBvcGVuZWQgV2ViU29ja2V0IGNvbm5lY3Rpb25cbiAgICAob2tFdmVudCkgPT4gKHtcbiAgICAgIHRhcmdldDogXCJAb2suY29ubmVjdGVkXCIsXG4gICAgICBlZmZlY3Q6IGFzc2lnbih7XG4gICAgICAgIHNvY2tldDogb2tFdmVudC5kYXRhLFxuICAgICAgICBiYWNrb2ZmRGVsYXk6IFJFU0VUX0RFTEFZXG4gICAgICB9KVxuICAgIH0pLFxuICAgIC8vIElmIHRoZSBXZWJTb2NrZXQgY29ubmVjdGlvbiBjYW5ub3QgYmUgZXN0YWJsaXNoZWRcbiAgICAoZmFpbHVyZSkgPT4ge1xuICAgICAgY29uc3QgZXJyID0gZmFpbHVyZS5yZWFzb247XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgU3RvcFJldHJ5aW5nKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGFyZ2V0OiBcIkBpZGxlLmZhaWxlZFwiLFxuICAgICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgICAgbG9nKDIgLyogRVJST1IgKi8sIGVyci5tZXNzYWdlKSxcbiAgICAgICAgICAgIGZpcmVFcnJvckV2ZW50KGVyci5tZXNzYWdlLCAtMSlcbiAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoaXNDbG9zZUV2ZW50KGVycikpIHtcbiAgICAgICAgaWYgKGVyci5jb2RlID09PSA0MTA5IC8qIFRPS0VOX0VYUElSRUQgKi8pIHtcbiAgICAgICAgICByZXR1cm4gXCJAYXV0aC5idXN5XCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNob3VsZFJldHJ5V2l0aG91dFJlYXV0aChlcnIuY29kZSkpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJhY2tvZmZcIixcbiAgICAgICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgICAgICBpbmNyZWFzZUJhY2tvZmZEZWxheUFnZ3Jlc3NpdmVseSxcbiAgICAgICAgICAgICAgbG9nUHJlbWF0dXJlRXJyb3JPckNsb3NlRXZlbnQoZXJyKVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNob3VsZERpc2Nvbm5lY3QoZXJyLmNvZGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhcmdldDogXCJAaWRsZS5mYWlsZWRcIixcbiAgICAgICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgICAgICBsb2coMiAvKiBFUlJPUiAqLywgZXJyLnJlYXNvbiksXG4gICAgICAgICAgICAgIGZpcmVFcnJvckV2ZW50KGVyci5yZWFzb24sIGVyci5jb2RlKVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldDogXCJAYXV0aC5iYWNrb2ZmXCIsXG4gICAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCBsb2dQcmVtYXR1cmVFcnJvck9yQ2xvc2VFdmVudChlcnIpXVxuICAgICAgfTtcbiAgICB9XG4gICk7XG4gIGNvbnN0IHNlbmRIZWFydGJlYXQgPSB7XG4gICAgdGFyZ2V0OiBcIkBvay5hd2FpdGluZy1wb25nXCIsXG4gICAgZWZmZWN0OiAoY3R4KSA9PiB7XG4gICAgICBjdHguc29ja2V0Py5zZW5kKFwicGluZ1wiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IG1heWJlSGVhcnRiZWF0ID0gKCkgPT4ge1xuICAgIGNvbnN0IGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGRvY3VtZW50IDogdm9pZCAwO1xuICAgIGNvbnN0IGNhblpvbWJpZSA9IGRvYz8udmlzaWJpbGl0eVN0YXRlID09PSBcImhpZGRlblwiICYmIGRlbGVnYXRlcy5jYW5ab21iaWUoKTtcbiAgICByZXR1cm4gY2FuWm9tYmllID8gXCJAaWRsZS56b21iaWVcIiA6IHNlbmRIZWFydGJlYXQ7XG4gIH07XG4gIG1hY2hpbmUuYWRkVGltZWRUcmFuc2l0aW9uKFwiQG9rLmNvbm5lY3RlZFwiLCBIRUFSVEJFQVRfSU5URVJWQUwsIG1heWJlSGVhcnRiZWF0KS5hZGRUcmFuc2l0aW9ucyhcIkBvay5jb25uZWN0ZWRcIiwge1xuICAgIE5BVklHQVRPUl9PRkZMSU5FOiBtYXliZUhlYXJ0YmVhdCxcbiAgICAvLyBEb24ndCB0YWtlIHRoZSBicm93c2VyJ3Mgd29yZCBmb3IgaXQgd2hlbiBpdCBzYXlzIGl0J3Mgb2ZmbGluZS4gRG8gYSBwaW5nL3BvbmcgdG8gbWFrZSBzdXJlLlxuICAgIFdJTkRPV19HT1RfRk9DVVM6IHNlbmRIZWFydGJlYXRcbiAgfSk7XG4gIG1hY2hpbmUuYWRkVHJhbnNpdGlvbnMoXCJAaWRsZS56b21iaWVcIiwge1xuICAgIFdJTkRPV19HT1RfRk9DVVM6IFwiQGNvbm5lY3RpbmcuYmFja29mZlwiXG4gICAgLy8gV2hlbiBpbiB6b21iaWUgc3RhdGUsIHRoZSBjbGllbnQgd2lsbCB0cnkgdG8gd2FrZSB1cCBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIHdpbmRvdyByZWdhaW5zIGZvY3VzXG4gIH0pO1xuICBtYWNoaW5lLm9uRW50ZXIoXCJAb2suKlwiLCAoY3R4KSA9PiB7XG4gICAgY3R4LnBhdGNoKHsgc3VjY2Vzc0NvdW50OiBjdHguc3VjY2Vzc0NvdW50ICsgMSB9KTtcbiAgICBjb25zdCB0aW1lcklEID0gc2V0VGltZW91dChcbiAgICAgIC8vIE9uIHRoZSBuZXh0IHRpY2ssIHN0YXJ0IGRlbGl2ZXJpbmcgYWxsIG1lc3NhZ2VzIHRoYXQgaGF2ZSBhbHJlYWR5XG4gICAgICAvLyBiZWVuIHJlY2VpdmVkLCBhbmQgY29udGludWUgc3luY2hyb25vdXMgZGVsaXZlcnkgb2YgYWxsIGZ1dHVyZVxuICAgICAgLy8gaW5jb21pbmcgbWVzc2FnZXMuXG4gICAgICBvbk1lc3NhZ2UudW5wYXVzZSxcbiAgICAgIDBcbiAgICApO1xuICAgIHJldHVybiAoY3R4MikgPT4ge1xuICAgICAgdGVhcmRvd25Tb2NrZXQoY3R4Mi5zb2NrZXQpO1xuICAgICAgY3R4Mi5wYXRjaCh7IHNvY2tldDogbnVsbCB9KTtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcklEKTtcbiAgICAgIG9uTWVzc2FnZS5wYXVzZSgpO1xuICAgIH07XG4gIH0pLmFkZFRyYW5zaXRpb25zKFwiQG9rLmF3YWl0aW5nLXBvbmdcIiwgeyBQT05HOiBcIkBvay5jb25uZWN0ZWRcIiB9KS5hZGRUaW1lZFRyYW5zaXRpb24oXCJAb2suYXdhaXRpbmctcG9uZ1wiLCBQT05HX1RJTUVPVVQsIHtcbiAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYnVzeVwiLFxuICAgIC8vIExvZyBpbXBsaWNpdCBjb25uZWN0aW9uIGxvc3MgYW5kIGRyb3AgdGhlIGN1cnJlbnQgb3BlbiBzb2NrZXRcbiAgICBlZmZlY3Q6IGxvZyhcbiAgICAgIDEgLyogV0FSTiAqLyxcbiAgICAgIFwiUmVjZWl2ZWQgbm8gcG9uZyBmcm9tIHNlcnZlciwgYXNzdW1lIGltcGxpY2l0IGNvbm5lY3Rpb24gbG9zcy5cIlxuICAgIClcbiAgfSkuYWRkVHJhbnNpdGlvbnMoXCJAb2suKlwiLCB7XG4gICAgLy8gV2hlbiBhIHNvY2tldCByZWNlaXZlcyBhbiBlcnJvciwgdGhpcyBjYW4gY2F1c2UgdGhlIGNsb3Npbmcgb2YgdGhlXG4gICAgLy8gc29ja2V0LCBvciBub3QuIFNvIGFsd2F5cyBjaGVjayB0byBzZWUgaWYgdGhlIHNvY2tldCBpcyBzdGlsbCBPUEVOIG9yXG4gICAgLy8gbm90LiBXaGVuIHN0aWxsIE9QRU4sIGRvbid0IHRyYW5zaXRpb24uXG4gICAgRVhQTElDSVRfU09DS0VUX0VSUk9SOiAoXywgY29udGV4dCkgPT4ge1xuICAgICAgaWYgKGNvbnRleHQuc29ja2V0Py5yZWFkeVN0YXRlID09PSAxKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJhY2tvZmZcIixcbiAgICAgICAgZWZmZWN0OiBpbmNyZWFzZUJhY2tvZmZEZWxheVxuICAgICAgfTtcbiAgICB9LFxuICAgIEVYUExJQ0lUX1NPQ0tFVF9DTE9TRTogKGUpID0+IHtcbiAgICAgIGlmIChzaG91bGREaXNjb25uZWN0KGUuZXZlbnQuY29kZSkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0YXJnZXQ6IFwiQGlkbGUuZmFpbGVkXCIsXG4gICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICBsb2dQZXJtYW5lbnRDbG9zZSxcbiAgICAgICAgICAgIGZpcmVFcnJvckV2ZW50KGUuZXZlbnQucmVhc29uLCBlLmV2ZW50LmNvZGUpXG4gICAgICAgICAgXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHNob3VsZFJlYXV0aChlLmV2ZW50LmNvZGUpKSB7XG4gICAgICAgIGlmIChlLmV2ZW50LmNvZGUgPT09IDQxMDkgLyogVE9LRU5fRVhQSVJFRCAqLykge1xuICAgICAgICAgIHJldHVybiBcIkBhdXRoLmJ1c3lcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAgICAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCBsb2dDbG9zZUV2ZW50KGUuZXZlbnQpXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzaG91bGRSZXRyeVdpdGhvdXRSZWF1dGgoZS5ldmVudC5jb2RlKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRhcmdldDogXCJAY29ubmVjdGluZy5iYWNrb2ZmXCIsXG4gICAgICAgICAgZWZmZWN0OiBbaW5jcmVhc2VCYWNrb2ZmRGVsYXlBZ2dyZXNzaXZlbHksIGxvZ0Nsb3NlRXZlbnQoZS5ldmVudCldXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLFxuICAgICAgICBlZmZlY3Q6IFtpbmNyZWFzZUJhY2tvZmZEZWxheSwgbG9nQ2xvc2VFdmVudChlLmV2ZW50KV1cbiAgICAgIH07XG4gICAgfVxuICB9KTtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGNvbnN0IGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGRvY3VtZW50IDogdm9pZCAwO1xuICAgIGNvbnN0IHdpbiA9IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB2b2lkIDA7XG4gICAgY29uc3Qgcm9vdCA9IHdpbiA/PyBkb2M7XG4gICAgbWFjaGluZS5vbkVudGVyKFwiKlwiLCAoY3R4KSA9PiB7XG4gICAgICBmdW5jdGlvbiBvbk5ldHdvcmtPZmZsaW5lKCkge1xuICAgICAgICBtYWNoaW5lLnNlbmQoeyB0eXBlOiBcIk5BVklHQVRPUl9PRkZMSU5FXCIgfSk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBvbk5ldHdvcmtCYWNrT25saW5lKCkge1xuICAgICAgICBtYWNoaW5lLnNlbmQoeyB0eXBlOiBcIk5BVklHQVRPUl9PTkxJTkVcIiB9KTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIG9uVmlzaWJpbGl0eUNoYW5nZSgpIHtcbiAgICAgICAgaWYgKGRvYz8udmlzaWJpbGl0eVN0YXRlID09PSBcInZpc2libGVcIikge1xuICAgICAgICAgIG1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiV0lORE9XX0dPVF9GT0NVU1wiIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB3aW4/LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmxpbmVcIiwgb25OZXR3b3JrQmFja09ubGluZSk7XG4gICAgICB3aW4/LmFkZEV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIG9uTmV0d29ya09mZmxpbmUpO1xuICAgICAgcm9vdD8uYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgb25WaXNpYmlsaXR5Q2hhbmdlKTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIHJvb3Q/LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIG9uVmlzaWJpbGl0eUNoYW5nZSk7XG4gICAgICAgIHdpbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCBvbk5ldHdvcmtCYWNrT25saW5lKTtcbiAgICAgICAgd2luPy5yZW1vdmVFdmVudExpc3RlbmVyKFwib2ZmbGluZVwiLCBvbk5ldHdvcmtPZmZsaW5lKTtcbiAgICAgICAgdGVhcmRvd25Tb2NrZXQoY3R4LnNvY2tldCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG4gIGNvbnN0IGNsZWFudXBzID0gW107XG4gIGNvbnN0IHsgc3RhdHVzRGlkQ2hhbmdlLCBkaWRDb25uZWN0LCBkaWREaXNjb25uZWN0LCB1bnN1YnNjcmliZSB9ID0gZGVmaW5lQ29ubmVjdGl2aXR5RXZlbnRzKG1hY2hpbmUpO1xuICBjbGVhbnVwcy5wdXNoKHVuc3Vic2NyaWJlKTtcbiAgaWYgKG9wdGlvbnMuZW5hYmxlRGVidWdMb2dnaW5nKSB7XG4gICAgY2xlYW51cHMucHVzaChlbmFibGVUcmFjaW5nKG1hY2hpbmUpKTtcbiAgfVxuICBtYWNoaW5lLnN0YXJ0KCk7XG4gIHJldHVybiB7XG4gICAgbWFjaGluZSxcbiAgICBjbGVhbnVwcyxcbiAgICAvLyBPYnNlcnZhYmxlIGV2ZW50cyB0aGF0IHdpbGwgYmUgZW1pdHRlZCBieSB0aGlzIG1hY2hpbmVcbiAgICBldmVudHM6IHtcbiAgICAgIHN0YXR1c0RpZENoYW5nZSxcbiAgICAgIGRpZENvbm5lY3QsXG4gICAgICBkaWREaXNjb25uZWN0LFxuICAgICAgb25NZXNzYWdlOiBvbk1lc3NhZ2Uub2JzZXJ2YWJsZSxcbiAgICAgIG9uTGl2ZWJsb2Nrc0Vycm9yOiBvbkxpdmVibG9ja3NFcnJvci5vYnNlcnZhYmxlXG4gICAgfVxuICB9O1xufVxudmFyIE1hbmFnZWRTb2NrZXQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGRlbGVnYXRlcywgZW5hYmxlRGVidWdMb2dnaW5nID0gZmFsc2UsIHdhaXRGb3JBY3RvcklkID0gdHJ1ZSkge1xuICAgIGNvbnN0IHsgbWFjaGluZSwgZXZlbnRzLCBjbGVhbnVwcyB9ID0gY3JlYXRlQ29ubmVjdGlvblN0YXRlTWFjaGluZShcbiAgICAgIGRlbGVnYXRlcyxcbiAgICAgIHsgd2FpdEZvckFjdG9ySWQsIGVuYWJsZURlYnVnTG9nZ2luZyB9XG4gICAgKTtcbiAgICB0aGlzLm1hY2hpbmUgPSBtYWNoaW5lO1xuICAgIHRoaXMuZXZlbnRzID0gZXZlbnRzO1xuICAgIHRoaXMuY2xlYW51cHMgPSBjbGVhbnVwcztcbiAgfVxuICBnZXRTdGF0dXMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB0b05ld0Nvbm5lY3Rpb25TdGF0dXModGhpcy5tYWNoaW5lKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBcImluaXRpYWxcIjtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgYXV0aCBhdXRoVmFsdWUuXG4gICAqL1xuICBnZXQgYXV0aFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLm1hY2hpbmUuY29udGV4dC5hdXRoVmFsdWU7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgdGhpcyBtZXRob2QgdG8gdHJ5IHRvIGNvbm5lY3QgdG8gYSBXZWJTb2NrZXQuIFRoaXMgb25seSBoYXMgYW4gZWZmZWN0XG4gICAqIGlmIHRoZSBtYWNoaW5lIGlzIGlkbGUgYXQgdGhlIG1vbWVudCwgb3RoZXJ3aXNlIHRoaXMgaXMgYSBuby1vcC5cbiAgICovXG4gIGNvbm5lY3QoKSB7XG4gICAgdGhpcy5tYWNoaW5lLnNlbmQoeyB0eXBlOiBcIkNPTk5FQ1RcIiB9KTtcbiAgfVxuICAvKipcbiAgICogSWYgaWRsZSwgd2lsbCB0cnkgdG8gY29ubmVjdC4gT3RoZXJ3aXNlLCBpdCB3aWxsIGF0dGVtcHQgdG8gcmVjb25uZWN0IHRvXG4gICAqIHRoZSBzb2NrZXQsIHBvdGVudGlhbGx5IG9idGFpbmluZyBhIG5ldyBhdXRoVmFsdWUgZmlyc3QsIGlmIG5lZWRlZC5cbiAgICovXG4gIHJlY29ubmVjdCgpIHtcbiAgICB0aGlzLm1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiUkVDT05ORUNUXCIgfSk7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgdGhpcyBtZXRob2QgdG8gZGlzY29ubmVjdCBmcm9tIHRoZSBjdXJyZW50IFdlYlNvY2tldC4gSXMgZ29pbmcgdG8gYmVcbiAgICogYSBuby1vcCBpZiB0aGVyZSBpcyBubyBhY3RpdmUgY29ubmVjdGlvbi5cbiAgICovXG4gIGRpc2Nvbm5lY3QoKSB7XG4gICAgdGhpcy5tYWNoaW5lLnNlbmQoeyB0eXBlOiBcIkRJU0NPTk5FQ1RcIiB9KTtcbiAgfVxuICAvKipcbiAgICogQ2FsbCB0aGlzIHRvIHN0b3AgdGhlIG1hY2hpbmUgYW5kIHJ1biBuZWNlc3NhcnkgY2xlYW51cCBmdW5jdGlvbnMuIEFmdGVyXG4gICAqIGNhbGxpbmcgZGVzdHJveSgpLCB5b3UgY2FuIG5vIGxvbmdlciB1c2UgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzIGJlZm9yZVxuICAgKiBsZXR0aW5nIHRoZSBpbnN0YW5jZSBnZXQgZ2FyYmFnZSBjb2xsZWN0ZWQuXG4gICAqL1xuICBkZXN0cm95KCkge1xuICAgIHRoaXMubWFjaGluZS5zdG9wKCk7XG4gICAgbGV0IGNsZWFudXA7XG4gICAgd2hpbGUgKGNsZWFudXAgPSB0aGlzLmNsZWFudXBzLnBvcCgpKSB7XG4gICAgICBjbGVhbnVwKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBTYWZlbHkgc2VuZCBhIG1lc3NhZ2UgdG8gdGhlIGN1cnJlbnQgV2ViU29ja2V0IGNvbm5lY3Rpb24uIFdpbGwgZW1pdCBhIGxvZ1xuICAgKiBtZXNzYWdlIGlmIHRoaXMgaXMgc29tZWhvdyBpbXBvc3NpYmxlLlxuICAgKi9cbiAgc2VuZChkYXRhKSB7XG4gICAgY29uc3Qgc29ja2V0ID0gdGhpcy5tYWNoaW5lLmNvbnRleHQ/LnNvY2tldDtcbiAgICBpZiAoc29ja2V0ID09PSBudWxsKSB7XG4gICAgICB3YXJuKFwiQ2Fubm90IHNlbmQ6IG5vdCBjb25uZWN0ZWQgeWV0XCIsIGRhdGEpO1xuICAgIH0gZWxzZSBpZiAoc29ja2V0LnJlYWR5U3RhdGUgIT09IDEpIHtcbiAgICAgIHdhcm4oXCJDYW5ub3Qgc2VuZDogV2ViU29ja2V0IG5vIGxvbmdlciBvcGVuXCIsIGRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzb2NrZXQuc2VuZChkYXRhKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIE5PVEU6IFVzZWQgYnkgdGhlIEUyRSBhcHAgb25seSwgdG8gc2ltdWxhdGUgZXhwbGljaXQgZXZlbnRzLlxuICAgKiBOb3QgaWRlYWwgdG8ga2VlcCBleHBvc2VkIDooXG4gICAqL1xuICBfcHJpdmF0ZVNlbmRNYWNoaW5lRXZlbnQoZXZlbnQpIHtcbiAgICB0aGlzLm1hY2hpbmUuc2VuZChldmVudCk7XG4gIH1cbn07XG5cbi8vIHNyYy9wcm90b2NvbC9BdXRoVG9rZW4udHNcbmZ1bmN0aW9uIGNhbldyaXRlU3RvcmFnZShzY29wZXMpIHtcbiAgcmV0dXJuIHNjb3Blcy5pbmNsdWRlcyhcInJvb206d3JpdGVcIiAvKiBXcml0ZSAqLyk7XG59XG5mdW5jdGlvbiBjYW5Db21tZW50KHNjb3Blcykge1xuICByZXR1cm4gc2NvcGVzLmluY2x1ZGVzKFwiY29tbWVudHM6d3JpdGVcIiAvKiBDb21tZW50c1dyaXRlICovKSB8fCBzY29wZXMuaW5jbHVkZXMoXCJyb29tOndyaXRlXCIgLyogV3JpdGUgKi8pO1xufVxuZnVuY3Rpb24gaXNWYWxpZEF1dGhUb2tlblBheWxvYWQoZGF0YSkge1xuICByZXR1cm4gaXNQbGFpbk9iamVjdChkYXRhKSAmJiAoZGF0YS5rID09PSBcImFjY1wiIC8qIEFDQ0VTU19UT0tFTiAqLyB8fCBkYXRhLmsgPT09IFwiaWRcIiAvKiBJRF9UT0tFTiAqLyB8fCBkYXRhLmsgPT09IFwic2VjLWxlZ2FjeVwiIC8qIFNFQ1JFVF9MRUdBQ1kgKi8pO1xufVxuZnVuY3Rpb24gcGFyc2VBdXRoVG9rZW4ocmF3VG9rZW5TdHJpbmcpIHtcbiAgY29uc3QgdG9rZW5QYXJ0cyA9IHJhd1Rva2VuU3RyaW5nLnNwbGl0KFwiLlwiKTtcbiAgaWYgKHRva2VuUGFydHMubGVuZ3RoICE9PSAzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQXV0aGVudGljYXRpb24gZXJyb3I6IGludmFsaWQgSldUIHRva2VuXCIpO1xuICB9XG4gIGNvbnN0IHBheWxvYWQgPSB0cnlQYXJzZUpzb24oYjY0ZGVjb2RlKHRva2VuUGFydHNbMV0pKTtcbiAgaWYgKCEocGF5bG9hZCAmJiBpc1ZhbGlkQXV0aFRva2VuUGF5bG9hZChwYXlsb2FkKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIkF1dGhlbnRpY2F0aW9uIGVycm9yOiBleHBlY3RlZCBhIHZhbGlkIHRva2VuIGJ1dCBkaWQgbm90IGdldCBvbmUuIEhpbnQ6IGlmIHlvdSBhcmUgdXNpbmcgYSBjYWxsYmFjaywgZW5zdXJlIHRoZSByb29tIGlzIHBhc3NlZCB3aGVuIGNyZWF0aW5nIHRoZSB0b2tlbi4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1jbGllbnQjY3JlYXRlQ2xpZW50Q2FsbGJhY2tcIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICByYXc6IHJhd1Rva2VuU3RyaW5nLFxuICAgIHBhcnNlZDogcGF5bG9hZFxuICB9O1xufVxuXG4vLyBzcmMvYXV0aC1tYW5hZ2VyLnRzXG5mdW5jdGlvbiBjcmVhdGVBdXRoTWFuYWdlcihhdXRoT3B0aW9ucykge1xuICBjb25zdCBhdXRoZW50aWNhdGlvbiA9IHByZXBhcmVBdXRoZW50aWNhdGlvbihhdXRoT3B0aW9ucyk7XG4gIGNvbnN0IHNlZW5Ub2tlbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICBjb25zdCB0b2tlbnMgPSBbXTtcbiAgY29uc3QgZXhwaXJ5VGltZXMgPSBbXTtcbiAgY29uc3QgcmVxdWVzdFByb21pc2VzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgc2VlblRva2Vucy5jbGVhcigpO1xuICAgIHRva2Vucy5sZW5ndGggPSAwO1xuICAgIGV4cGlyeVRpbWVzLmxlbmd0aCA9IDA7XG4gICAgcmVxdWVzdFByb21pc2VzLmNsZWFyKCk7XG4gIH1cbiAgZnVuY3Rpb24gaGFzQ29ycmVzcG9uZGluZ1Njb3BlcyhyZXF1ZXN0ZWRTY29wZSwgc2NvcGVzKSB7XG4gICAgaWYgKHJlcXVlc3RlZFNjb3BlID09PSBcImNvbW1lbnRzOnJlYWRcIikge1xuICAgICAgcmV0dXJuIHNjb3Blcy5pbmNsdWRlcyhcImNvbW1lbnRzOnJlYWRcIiAvKiBDb21tZW50c1JlYWQgKi8pIHx8IHNjb3Blcy5pbmNsdWRlcyhcImNvbW1lbnRzOndyaXRlXCIgLyogQ29tbWVudHNXcml0ZSAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwicm9vbTpyZWFkXCIgLyogUmVhZCAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwicm9vbTp3cml0ZVwiIC8qIFdyaXRlICovKTtcbiAgICB9IGVsc2UgaWYgKHJlcXVlc3RlZFNjb3BlID09PSBcInJvb206cmVhZFwiKSB7XG4gICAgICByZXR1cm4gc2NvcGVzLmluY2x1ZGVzKFwicm9vbTpyZWFkXCIgLyogUmVhZCAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwicm9vbTp3cml0ZVwiIC8qIFdyaXRlICovKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZ1bmN0aW9uIGdldENhY2hlZFRva2VuKHJlcXVlc3RPcHRpb25zKSB7XG4gICAgY29uc3Qgbm93ID0gTWF0aC5jZWlsKERhdGUubm93KCkgLyAxZTMpO1xuICAgIGZvciAobGV0IGkgPSB0b2tlbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2ldO1xuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gZXhwaXJ5VGltZXNbaV07XG4gICAgICBpZiAoZXhwaXJlc0F0IDw9IG5vdykge1xuICAgICAgICB0b2tlbnMuc3BsaWNlKGksIDEpO1xuICAgICAgICBleHBpcnlUaW1lcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKHRva2VuLnBhcnNlZC5rID09PSBcImlkXCIgLyogSURfVE9LRU4gKi8pIHtcbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgfSBlbHNlIGlmICh0b2tlbi5wYXJzZWQuayA9PT0gXCJhY2NcIiAvKiBBQ0NFU1NfVE9LRU4gKi8pIHtcbiAgICAgICAgaWYgKCFyZXF1ZXN0T3B0aW9ucy5yb29tSWQgJiYgT2JqZWN0LmVudHJpZXModG9rZW4ucGFyc2VkLnBlcm1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBbcmVzb3VyY2UsIHNjb3Blc10gb2YgT2JqZWN0LmVudHJpZXModG9rZW4ucGFyc2VkLnBlcm1zKSkge1xuICAgICAgICAgIGlmICghcmVxdWVzdE9wdGlvbnMucm9vbUlkKSB7XG4gICAgICAgICAgICBpZiAocmVzb3VyY2UuaW5jbHVkZXMoXCIqXCIpICYmIGhhc0NvcnJlc3BvbmRpbmdTY29wZXMocmVxdWVzdE9wdGlvbnMucmVxdWVzdGVkU2NvcGUsIHNjb3BlcykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAocmVzb3VyY2UuaW5jbHVkZXMoXCIqXCIpICYmIHJlcXVlc3RPcHRpb25zLnJvb21JZC5zdGFydHNXaXRoKHJlc291cmNlLnJlcGxhY2UoXCIqXCIsIFwiXCIpKSB8fCByZXF1ZXN0T3B0aW9ucy5yb29tSWQgPT09IHJlc291cmNlICYmIGhhc0NvcnJlc3BvbmRpbmdTY29wZXMocmVxdWVzdE9wdGlvbnMucmVxdWVzdGVkU2NvcGUsIHNjb3BlcykpIHtcbiAgICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYWtlQXV0aFJlcXVlc3Qob3B0aW9ucykge1xuICAgIGNvbnN0IGZldGNoZXIgPSBhdXRoT3B0aW9ucy5wb2x5ZmlsbHM/LmZldGNoID8/ICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiID8gdm9pZCAwIDogd2luZG93LmZldGNoKTtcbiAgICBpZiAoYXV0aGVudGljYXRpb24udHlwZSA9PT0gXCJwcml2YXRlXCIpIHtcbiAgICAgIGlmIChmZXRjaGVyID09PSB2b2lkIDApIHtcbiAgICAgICAgdGhyb3cgbmV3IFN0b3BSZXRyeWluZyhcbiAgICAgICAgICBcIlRvIHVzZSBMaXZlYmxvY2tzIGNsaWVudCBpbiBhIG5vbi1ET00gZW52aXJvbm1lbnQgd2l0aCBhIHVybCBhcyBhdXRoIGVuZHBvaW50LCB5b3UgbmVlZCB0byBwcm92aWRlIGEgZmV0Y2ggcG9seWZpbGwuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hBdXRoRW5kcG9pbnQoZmV0Y2hlciwgYXV0aGVudGljYXRpb24udXJsLCB7XG4gICAgICAgIHJvb206IG9wdGlvbnMucm9vbUlkXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlQXV0aFRva2VuKHJlc3BvbnNlLnRva2VuKTtcbiAgICAgIGlmIChzZWVuVG9rZW5zLmhhcyhwYXJzZWQucmF3KSkge1xuICAgICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKFxuICAgICAgICAgIFwiVGhlIHNhbWUgTGl2ZWJsb2NrcyBhdXRoIHRva2VuIHdhcyBpc3N1ZWQgZnJvbSB0aGUgYmFja2VuZCBiZWZvcmUuIENhY2hpbmcgTGl2ZWJsb2NrcyB0b2tlbnMgaXMgbm90IHN1cHBvcnRlZC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnNlZDtcbiAgICB9XG4gICAgaWYgKGF1dGhlbnRpY2F0aW9uLnR5cGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXV0aGVudGljYXRpb24uY2FsbGJhY2sob3B0aW9ucy5yb29tSWQpO1xuICAgICAgaWYgKHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLnRva2VuID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgY29uc3QgcGFyc2VkID0gcGFyc2VBdXRoVG9rZW4ocmVzcG9uc2UudG9rZW4pO1xuICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3BvbnNlLmVycm9yID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgY29uc3QgcmVhc29uID0gYEF1dGhlbnRpY2F0aW9uIGZhaWxlZDogJHtcInJlYXNvblwiIGluIHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZS5yZWFzb24gPT09IFwic3RyaW5nXCIgPyByZXNwb25zZS5yZWFzb24gOiBcIkZvcmJpZGRlblwifWA7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yID09PSBcImZvcmJpZGRlblwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKHJlYXNvbik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZWFzb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnWW91ciBhdXRoZW50aWNhdGlvbiBjYWxsYmFjayBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgdG9rZW4sIGJ1dCBpdCBkaWQgbm90LiBIaW50OiB0aGUgcmV0dXJuIHZhbHVlIHNob3VsZCBsb29rIGxpa2U6IHsgdG9rZW46IFwiLi4uXCIgfSdcbiAgICAgICk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiVW5leHBlY3RlZCBhdXRoZW50aWNhdGlvbiB0eXBlLiBNdXN0IGJlIHByaXZhdGUgb3IgY3VzdG9tLlwiXG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRBdXRoVmFsdWUocmVxdWVzdE9wdGlvbnMpIHtcbiAgICBpZiAoYXV0aGVudGljYXRpb24udHlwZSA9PT0gXCJwdWJsaWNcIikge1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJwdWJsaWNcIiwgcHVibGljQXBpS2V5OiBhdXRoZW50aWNhdGlvbi5wdWJsaWNBcGlLZXkgfTtcbiAgICB9XG4gICAgY29uc3QgY2FjaGVkVG9rZW4gPSBnZXRDYWNoZWRUb2tlbihyZXF1ZXN0T3B0aW9ucyk7XG4gICAgaWYgKGNhY2hlZFRva2VuICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwic2VjcmV0XCIsIHRva2VuOiBjYWNoZWRUb2tlbiB9O1xuICAgIH1cbiAgICBsZXQgY3VycmVudFByb21pc2U7XG4gICAgaWYgKHJlcXVlc3RPcHRpb25zLnJvb21JZCkge1xuICAgICAgY3VycmVudFByb21pc2UgPSByZXF1ZXN0UHJvbWlzZXMuZ2V0KHJlcXVlc3RPcHRpb25zLnJvb21JZCk7XG4gICAgICBpZiAoY3VycmVudFByb21pc2UgPT09IHZvaWQgMCkge1xuICAgICAgICBjdXJyZW50UHJvbWlzZSA9IG1ha2VBdXRoUmVxdWVzdChyZXF1ZXN0T3B0aW9ucyk7XG4gICAgICAgIHJlcXVlc3RQcm9taXNlcy5zZXQocmVxdWVzdE9wdGlvbnMucm9vbUlkLCBjdXJyZW50UHJvbWlzZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRQcm9taXNlID0gcmVxdWVzdFByb21pc2VzLmdldChcImxpdmVibG9ja3MtdXNlci10b2tlblwiKTtcbiAgICAgIGlmIChjdXJyZW50UHJvbWlzZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGN1cnJlbnRQcm9taXNlID0gbWFrZUF1dGhSZXF1ZXN0KHJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgcmVxdWVzdFByb21pc2VzLnNldChcImxpdmVibG9ja3MtdXNlci10b2tlblwiLCBjdXJyZW50UHJvbWlzZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGN1cnJlbnRQcm9taXNlO1xuICAgICAgY29uc3QgQlVGRkVSID0gMzA7XG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxZTMpICsgKHRva2VuLnBhcnNlZC5leHAgLSB0b2tlbi5wYXJzZWQuaWF0KSAtIEJVRkZFUjtcbiAgICAgIHNlZW5Ub2tlbnMuYWRkKHRva2VuLnJhdyk7XG4gICAgICBpZiAodG9rZW4ucGFyc2VkLmsgIT09IFwic2VjLWxlZ2FjeVwiIC8qIFNFQ1JFVF9MRUdBQ1kgKi8pIHtcbiAgICAgICAgdG9rZW5zLnB1c2godG9rZW4pO1xuICAgICAgICBleHBpcnlUaW1lcy5wdXNoKGV4cGlyZXNBdCk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyB0eXBlOiBcInNlY3JldFwiLCB0b2tlbiB9O1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpZiAocmVxdWVzdE9wdGlvbnMucm9vbUlkKSB7XG4gICAgICAgIHJlcXVlc3RQcm9taXNlcy5kZWxldGUocmVxdWVzdE9wdGlvbnMucm9vbUlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcXVlc3RQcm9taXNlcy5kZWxldGUoXCJsaXZlYmxvY2tzLXVzZXItdG9rZW5cIik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgcmVzZXQsXG4gICAgZ2V0QXV0aFZhbHVlXG4gIH07XG59XG5mdW5jdGlvbiBwcmVwYXJlQXV0aGVudGljYXRpb24oYXV0aE9wdGlvbnMpIHtcbiAgY29uc3QgeyBwdWJsaWNBcGlLZXksIGF1dGhFbmRwb2ludCB9ID0gYXV0aE9wdGlvbnM7XG4gIGlmIChhdXRoRW5kcG9pbnQgIT09IHZvaWQgMCAmJiBwdWJsaWNBcGlLZXkgIT09IHZvaWQgMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiWW91IGNhbm5vdCBzaW11bHRhbmVvdXNseSB1c2UgYHB1YmxpY0FwaUtleWAgYW5kIGBhdXRoRW5kcG9pbnRgIG9wdGlvbnMuIFBsZWFzZSBwaWNrIG9uZSBhbmQgbGVhdmUgdGhlIG90aGVyIG9wdGlvbiB1bnNwZWNpZmllZC4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1jbGllbnQjY3JlYXRlQ2xpZW50XCJcbiAgICApO1xuICB9XG4gIGlmICh0eXBlb2YgcHVibGljQXBpS2V5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgaWYgKHB1YmxpY0FwaUtleS5zdGFydHNXaXRoKFwic2tfXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiSW52YWxpZCBgcHVibGljQXBpS2V5YCBvcHRpb24uIFRoZSB2YWx1ZSB5b3UgcGFzc2VkIGlzIGEgc2VjcmV0IGtleSwgd2hpY2ggc2hvdWxkIG5vdCBiZSB1c2VkIGZyb20gdGhlIGNsaWVudC4gUGxlYXNlIG9ubHkgZXZlciBwYXNzIGEgcHVibGljIGtleSBoZXJlLiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRQdWJsaWNLZXlcIlxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKCFwdWJsaWNBcGlLZXkuc3RhcnRzV2l0aChcInBrX1wiKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkludmFsaWQga2V5LiBQbGVhc2UgdXNlIHRoZSBwdWJsaWMga2V5IGZvcm1hdDogcGtfPHB1YmxpYyBrZXk+LiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRQdWJsaWNLZXlcIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwicHVibGljXCIsXG4gICAgICBwdWJsaWNBcGlLZXlcbiAgICB9O1xuICB9XG4gIGlmICh0eXBlb2YgYXV0aEVuZHBvaW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwicHJpdmF0ZVwiLFxuICAgICAgdXJsOiBhdXRoRW5kcG9pbnRcbiAgICB9O1xuICB9IGVsc2UgaWYgKHR5cGVvZiBhdXRoRW5kcG9pbnQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcImN1c3RvbVwiLFxuICAgICAgY2FsbGJhY2s6IGF1dGhFbmRwb2ludFxuICAgIH07XG4gIH0gZWxzZSBpZiAoYXV0aEVuZHBvaW50ICE9PSB2b2lkIDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIlRoZSBgYXV0aEVuZHBvaW50YCBvcHRpb24gbXVzdCBiZSBhIHN0cmluZyBvciBhIGZ1bmN0aW9uLiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRBdXRoRW5kcG9pbnRcIlxuICAgICk7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKFxuICAgIFwiSW52YWxpZCBMaXZlYmxvY2tzIGNsaWVudCBvcHRpb25zLiBQbGVhc2UgcHJvdmlkZSBlaXRoZXIgYSBgcHVibGljQXBpS2V5YCBvciBgYXV0aEVuZHBvaW50YCBvcHRpb24uIFRoZXkgY2Fubm90IGJvdGggYmUgZW1wdHkuIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3MtY2xpZW50I2NyZWF0ZUNsaWVudFwiXG4gICk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEF1dGhFbmRwb2ludChmZXRjaDIsIGVuZHBvaW50LCBib2R5KSB7XG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoMihlbmRwb2ludCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXG4gIH0pO1xuICBpZiAoIXJlcy5vaykge1xuICAgIGNvbnN0IHJlYXNvbiA9IGAkeyhhd2FpdCByZXMudGV4dCgpKS50cmltKCkgfHwgXCJyZWFzb24gbm90IHByb3ZpZGVkIGluIGF1dGggcmVzcG9uc2VcIn0gKCR7cmVzLnN0YXR1c30gcmV0dXJuZWQgYnkgUE9TVCAke2VuZHBvaW50fSlgO1xuICAgIGlmIChyZXMuc3RhdHVzID09PSA0MDEgfHwgcmVzLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKGBVbmF1dGhvcml6ZWQ6ICR7cmVhc29ufWApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBhdXRoZW50aWNhdGU6ICR7cmVhc29ufWApO1xuICAgIH1cbiAgfVxuICBsZXQgZGF0YTtcbiAgdHJ5IHtcbiAgICBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgfSBjYXRjaCAoZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgRXhwZWN0ZWQgYSBKU09OIHJlc3BvbnNlIHdoZW4gZG9pbmcgYSBQT1NUIHJlcXVlc3Qgb24gXCIke2VuZHBvaW50fVwiLiAke1N0cmluZyhcbiAgICAgICAgZXJcbiAgICAgICl9YFxuICAgICk7XG4gIH1cbiAgaWYgKCFpc1BsYWluT2JqZWN0KGRhdGEpIHx8IHR5cGVvZiBkYXRhLnRva2VuICE9PSBcInN0cmluZ1wiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYEV4cGVjdGVkIGEgSlNPTiByZXNwb25zZSBvZiB0aGUgZm9ybSBcXGB7IHRva2VuOiBcIi4uLlwiIH1cXGAgd2hlbiBkb2luZyBhIFBPU1QgcmVxdWVzdCBvbiBcIiR7ZW5kcG9pbnR9XCIsIGJ1dCBnb3QgJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgZGF0YVxuICAgICAgKX1gXG4gICAgKTtcbiAgfVxuICBjb25zdCB7IHRva2VuIH0gPSBkYXRhO1xuICByZXR1cm4geyB0b2tlbiB9O1xufVxuXG4vLyBzcmMvY29uc3RhbnRzLnRzXG52YXIgREVGQVVMVF9CQVNFX1VSTCA9IFwiaHR0cHM6Ly9hcGkubGl2ZWJsb2Nrcy5pb1wiO1xuXG4vLyBzcmMvaW50ZXJuYWwudHNcbnZhciBrSW50ZXJuYWwgPSBTeW1ib2woKTtcblxuLy8gc3JjL2RldnRvb2xzL2JyaWRnZS50c1xudmFyIF9icmlkZ2VBY3RpdmUgPSBmYWxzZTtcbmZ1bmN0aW9uIGFjdGl2YXRlQnJpZGdlKGFsbG93ZWQpIHtcbiAgX2JyaWRnZUFjdGl2ZSA9IGFsbG93ZWQ7XG59XG5mdW5jdGlvbiBzZW5kVG9QYW5lbChtZXNzYWdlLCBvcHRpb25zKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgfHwgdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBmdWxsTXNnID0ge1xuICAgIC4uLm1lc3NhZ2UsXG4gICAgc291cmNlOiBcImxpdmVibG9ja3MtZGV2dG9vbHMtY2xpZW50XCJcbiAgfTtcbiAgaWYgKCEob3B0aW9ucz8uZm9yY2UgfHwgX2JyaWRnZUFjdGl2ZSkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgd2luZG93LnBvc3RNZXNzYWdlKGZ1bGxNc2csIFwiKlwiKTtcbn1cbnZhciBldmVudFNvdXJjZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIiAmJiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQuc291cmNlID09PSB3aW5kb3cgJiYgZXZlbnQuZGF0YT8uc291cmNlID09PSBcImxpdmVibG9ja3MtZGV2dG9vbHMtcGFuZWxcIikge1xuICAgICAgZXZlbnRTb3VyY2Uubm90aWZ5KGV2ZW50LmRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgfVxuICB9KTtcbn1cbnZhciBvbk1lc3NhZ2VGcm9tUGFuZWwgPSBldmVudFNvdXJjZS5vYnNlcnZhYmxlO1xuXG4vLyBzcmMvZGV2dG9vbHMvaW5kZXgudHNcbnZhciBWRVJTSU9OID0gUEtHX1ZFUlNJT04gfHwgXCJkZXZcIjtcbnZhciBfZGV2dG9vbHNTZXR1cEhhc1J1biA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0dXBEZXZUb29scyhnZXRBbGxSb29tcykge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiIHx8IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKF9kZXZ0b29sc1NldHVwSGFzUnVuKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIF9kZXZ0b29sc1NldHVwSGFzUnVuID0gdHJ1ZTtcbiAgb25NZXNzYWdlRnJvbVBhbmVsLnN1YnNjcmliZSgobXNnKSA9PiB7XG4gICAgc3dpdGNoIChtc2cubXNnKSB7XG4gICAgICBjYXNlIFwiY29ubmVjdFwiOiB7XG4gICAgICAgIGFjdGl2YXRlQnJpZGdlKHRydWUpO1xuICAgICAgICBmb3IgKGNvbnN0IHJvb21JZCBvZiBnZXRBbGxSb29tcygpKSB7XG4gICAgICAgICAgc2VuZFRvUGFuZWwoe1xuICAgICAgICAgICAgbXNnOiBcInJvb206OmF2YWlsYWJsZVwiLFxuICAgICAgICAgICAgcm9vbUlkLFxuICAgICAgICAgICAgY2xpZW50VmVyc2lvbjogVkVSU0lPTlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHNlbmRUb1BhbmVsKHsgbXNnOiBcIndha2UtdXAtZGV2dG9vbHNcIiB9LCB7IGZvcmNlOiB0cnVlIH0pO1xufVxudmFyIHVuc3Vic0J5Um9vbUlkID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbmZ1bmN0aW9uIHN0b3BTeW5jU3RyZWFtKHJvb21JZCkge1xuICBjb25zdCB1bnN1YnMgPSB1bnN1YnNCeVJvb21JZC5nZXQocm9vbUlkKSA/PyBbXTtcbiAgdW5zdWJzQnlSb29tSWQuZGVsZXRlKHJvb21JZCk7XG4gIGZvciAoY29uc3QgdW5zdWIgb2YgdW5zdWJzKSB7XG4gICAgdW5zdWIoKTtcbiAgfVxufVxuZnVuY3Rpb24gc3RhcnRTeW5jU3RyZWFtKHJvb20pIHtcbiAgc3RvcFN5bmNTdHJlYW0ocm9vbS5pZCk7XG4gIGZ1bGxTeW5jKHJvb20pO1xuICB1bnN1YnNCeVJvb21JZC5zZXQocm9vbS5pZCwgW1xuICAgIC8vIFdoZW4gdGhlIGNvbm5lY3Rpb24gc3RhdHVzIGNoYW5nZXNcbiAgICByb29tLmV2ZW50cy5zdGF0dXMuc3Vic2NyaWJlKCgpID0+IHBhcnRpYWxTeW5jQ29ubmVjdGlvbihyb29tKSksXG4gICAgLy8gV2hlbiBzdG9yYWdlIGluaXRpYWxpemVzLCBzZW5kIHRoZSB1cGRhdGVcbiAgICByb29tLmV2ZW50cy5zdG9yYWdlRGlkTG9hZC5zdWJzY3JpYmVPbmNlKCgpID0+IHBhcnRpYWxTeW5jU3RvcmFnZShyb29tKSksXG4gICAgLy8gQW55IHRpbWUgc3RvcmFnZSB1cGRhdGVzLCBzZW5kIHRoZSBuZXcgc3RvcmFnZSByb290XG4gICAgcm9vbS5ldmVudHMuc3RvcmFnZUJhdGNoLnN1YnNjcmliZSgoKSA9PiBwYXJ0aWFsU3luY1N0b3JhZ2Uocm9vbSkpLFxuICAgIC8vIEFueSB0aW1lIFwibWVcIiBvciBcIm90aGVyc1wiIHVwZGF0ZXMsIHNlbmQgdGhlIG5ldyB2YWx1ZXMgYWNjb3JkaW5nbHlcbiAgICByb29tLmV2ZW50cy5zZWxmLnN1YnNjcmliZSgoKSA9PiBwYXJ0aWFsU3luY01lKHJvb20pKSxcbiAgICByb29tLmV2ZW50cy5vdGhlcnMuc3Vic2NyaWJlKCgpID0+IHBhcnRpYWxTeW5jT3RoZXJzKHJvb20pKSxcbiAgICAvLyBBbnkgdGltZSB5ZG9jIGlzIHVwZGF0ZWQsIGZvcndhcmQgdGhlIHVwZGF0ZVxuICAgIHJvb20uZXZlbnRzLnlkb2Muc3Vic2NyaWJlKCh1cGRhdGUpID0+IHN5bmNZZG9jVXBkYXRlKHJvb20sIHVwZGF0ZSkpLFxuICAgIC8vIEFueSB0aW1lIGEgY3VzdG9tIHJvb20gZXZlbnQgaXMgcmVjZWl2ZWQsIGZvcndhcmQgaXRcbiAgICByb29tLmV2ZW50cy5jdXN0b21FdmVudC5zdWJzY3JpYmUoXG4gICAgICAoZXZlbnREYXRhKSA9PiBmb3J3YXJkRXZlbnQocm9vbSwgZXZlbnREYXRhKVxuICAgIClcbiAgXSk7XG59XG5mdW5jdGlvbiBzeW5jWWRvY1VwZGF0ZShyb29tLCB1cGRhdGUpIHtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjpzeW5jOjp5ZG9jXCIsXG4gICAgcm9vbUlkOiByb29tLmlkLFxuICAgIHVwZGF0ZVxuICB9KTtcbn1cbnZhciBsb2FkZWRBdCA9IERhdGUubm93KCk7XG52YXIgZXZlbnRDb3VudGVyID0gMDtcbmZ1bmN0aW9uIG5leHRFdmVudElkKCkge1xuICByZXR1cm4gYGV2ZW50LSR7bG9hZGVkQXR9LSR7ZXZlbnRDb3VudGVyKyt9YDtcbn1cbmZ1bmN0aW9uIGZvcndhcmRFdmVudChyb29tLCBldmVudERhdGEpIHtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjpldmVudHM6OmN1c3RvbS1ldmVudFwiLFxuICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICBldmVudDoge1xuICAgICAgdHlwZTogXCJDdXN0b21FdmVudFwiLFxuICAgICAgaWQ6IG5leHRFdmVudElkKCksXG4gICAgICBrZXk6IFwiRXZlbnRcIixcbiAgICAgIGNvbm5lY3Rpb25JZDogZXZlbnREYXRhLmNvbm5lY3Rpb25JZCxcbiAgICAgIHBheWxvYWQ6IGV2ZW50RGF0YS5ldmVudFxuICAgIH1cbiAgfSk7XG59XG5mdW5jdGlvbiBwYXJ0aWFsU3luY0Nvbm5lY3Rpb24ocm9vbSkge1xuICBzZW5kVG9QYW5lbCh7XG4gICAgbXNnOiBcInJvb206OnN5bmM6OnBhcnRpYWxcIixcbiAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgc3RhdHVzOiByb29tLmdldFN0YXR1cygpXG4gIH0pO1xufVxuZnVuY3Rpb24gcGFydGlhbFN5bmNTdG9yYWdlKHJvb20pIHtcbiAgY29uc3Qgcm9vdCA9IHJvb20uZ2V0U3RvcmFnZVNuYXBzaG90KCk7XG4gIGlmIChyb290KSB7XG4gICAgc2VuZFRvUGFuZWwoe1xuICAgICAgbXNnOiBcInJvb206OnN5bmM6OnBhcnRpYWxcIixcbiAgICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICAgIHN0b3JhZ2U6IHJvb3QudG9UcmVlTm9kZShcInJvb3RcIikucGF5bG9hZFxuICAgIH0pO1xuICB9XG59XG5mdW5jdGlvbiBwYXJ0aWFsU3luY01lKHJvb20pIHtcbiAgY29uc3QgbWUgPSByb29tW2tJbnRlcm5hbF0uZ2V0U2VsZl9mb3JEZXZUb29scygpO1xuICBpZiAobWUpIHtcbiAgICBzZW5kVG9QYW5lbCh7XG4gICAgICBtc2c6IFwicm9vbTo6c3luYzo6cGFydGlhbFwiLFxuICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgbWVcbiAgICB9KTtcbiAgfVxufVxuZnVuY3Rpb24gcGFydGlhbFN5bmNPdGhlcnMocm9vbSkge1xuICBjb25zdCBvdGhlcnMgPSByb29tW2tJbnRlcm5hbF0uZ2V0T3RoZXJzX2ZvckRldlRvb2xzKCk7XG4gIGlmIChvdGhlcnMpIHtcbiAgICBzZW5kVG9QYW5lbCh7XG4gICAgICBtc2c6IFwicm9vbTo6c3luYzo6cGFydGlhbFwiLFxuICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgb3RoZXJzXG4gICAgfSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGZ1bGxTeW5jKHJvb20pIHtcbiAgY29uc3Qgcm9vdCA9IHJvb20uZ2V0U3RvcmFnZVNuYXBzaG90KCk7XG4gIGNvbnN0IG1lID0gcm9vbVtrSW50ZXJuYWxdLmdldFNlbGZfZm9yRGV2VG9vbHMoKTtcbiAgY29uc3Qgb3RoZXJzID0gcm9vbVtrSW50ZXJuYWxdLmdldE90aGVyc19mb3JEZXZUb29scygpO1xuICByb29tLmZldGNoWURvYyhcIlwiKTtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjpzeW5jOjpmdWxsXCIsXG4gICAgcm9vbUlkOiByb29tLmlkLFxuICAgIHN0YXR1czogcm9vbS5nZXRTdGF0dXMoKSxcbiAgICBzdG9yYWdlOiByb290Py50b1RyZWVOb2RlKFwicm9vdFwiKS5wYXlsb2FkID8/IG51bGwsXG4gICAgbWUsXG4gICAgb3RoZXJzXG4gIH0pO1xufVxudmFyIHJvb21DaGFubmVsTGlzdGVuZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbmZ1bmN0aW9uIHN0b3BSb29tQ2hhbm5lbExpc3RlbmVyKHJvb21JZCkge1xuICBjb25zdCBsaXN0ZW5lciA9IHJvb21DaGFubmVsTGlzdGVuZXJzLmdldChyb29tSWQpO1xuICByb29tQ2hhbm5lbExpc3RlbmVycy5kZWxldGUocm9vbUlkKTtcbiAgaWYgKGxpc3RlbmVyKSB7XG4gICAgbGlzdGVuZXIoKTtcbiAgfVxufVxuZnVuY3Rpb24gbGlua0RldlRvb2xzKHJvb21JZCwgcm9vbSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiIHx8IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgc2VuZFRvUGFuZWwoeyBtc2c6IFwicm9vbTo6YXZhaWxhYmxlXCIsIHJvb21JZCwgY2xpZW50VmVyc2lvbjogVkVSU0lPTiB9KTtcbiAgc3RvcFJvb21DaGFubmVsTGlzdGVuZXIocm9vbUlkKTtcbiAgcm9vbUNoYW5uZWxMaXN0ZW5lcnMuc2V0KFxuICAgIHJvb21JZCxcbiAgICAvLyBSZXR1cm5zIHRoZSB1bnN1YnNjcmliZSBjYWxsYmFjaywgdGhhdCB3ZSBzdG9yZSBpbiB0aGVcbiAgICAvLyByb29tQ2hhbm5lbExpc3RlbmVycyByZWdpc3RyeVxuICAgIG9uTWVzc2FnZUZyb21QYW5lbC5zdWJzY3JpYmUoKG1zZykgPT4ge1xuICAgICAgc3dpdGNoIChtc2cubXNnKSB7XG4gICAgICAgIGNhc2UgXCJyb29tOjpzdWJzY3JpYmVcIjoge1xuICAgICAgICAgIGlmIChtc2cucm9vbUlkID09PSByb29tSWQpIHtcbiAgICAgICAgICAgIHN0YXJ0U3luY1N0cmVhbShyb29tKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInJvb206OnVuc3Vic2NyaWJlXCI6IHtcbiAgICAgICAgICBpZiAobXNnLnJvb21JZCA9PT0gcm9vbUlkKSB7XG4gICAgICAgICAgICBzdG9wU3luY1N0cmVhbShyb29tSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICk7XG59XG5mdW5jdGlvbiB1bmxpbmtEZXZUb29scyhyb29tSWQpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIiB8fCB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHN0b3BTeW5jU3RyZWFtKHJvb21JZCk7XG4gIHN0b3BSb29tQ2hhbm5lbExpc3RlbmVyKHJvb21JZCk7XG4gIHNlbmRUb1BhbmVsKHtcbiAgICBtc2c6IFwicm9vbTo6dW5hdmFpbGFibGVcIixcbiAgICByb29tSWRcbiAgfSk7XG59XG5cbi8vIHNyYy9saWIvc3RyaW5naWZ5LnRzXG5mdW5jdGlvbiBzdHJpbmdpZnkob2JqZWN0LCAuLi5hcmdzKSB7XG4gIGlmICh0eXBlb2Ygb2JqZWN0ICE9PSBcIm9iamVjdFwiIHx8IG9iamVjdCA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iamVjdCkpIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqZWN0LCAuLi5hcmdzKTtcbiAgfVxuICBjb25zdCBzb3J0ZWRPYmplY3QgPSBPYmplY3Qua2V5cyhvYmplY3QpLnNvcnQoKS5yZWR1Y2UoXG4gICAgKHNvcnRlZE9iamVjdDIsIGtleSkgPT4ge1xuICAgICAgc29ydGVkT2JqZWN0MltrZXldID0gb2JqZWN0W2tleV07XG4gICAgICByZXR1cm4gc29ydGVkT2JqZWN0MjtcbiAgICB9LFxuICAgIHt9XG4gICk7XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShzb3J0ZWRPYmplY3QsIC4uLmFyZ3MpO1xufVxuXG4vLyBzcmMvbGliL2JhdGNoLnRzXG52YXIgREVGQVVMVF9TSVpFID0gNTA7XG52YXIgQmF0Y2hDYWxsID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcihpbnB1dCkge1xuICAgIHRoaXMuaW5wdXQgPSBpbnB1dDtcbiAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmUsIHJlamVjdCB9ID0gUHJvbWlzZV93aXRoUmVzb2x2ZXJzKCk7XG4gICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTtcbiAgICB0aGlzLnJlc29sdmUgPSByZXNvbHZlO1xuICAgIHRoaXMucmVqZWN0ID0gcmVqZWN0O1xuICB9XG59O1xudmFyIEJhdGNoID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcihjYWxsYmFjaywgb3B0aW9ucykge1xuICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIHRoaXMuc2l6ZSA9IG9wdGlvbnMuc2l6ZSA/PyBERUZBVUxUX1NJWkU7XG4gICAgdGhpcy5kZWxheSA9IG9wdGlvbnMuZGVsYXk7XG4gIH1cbiAgY2xlYXJEZWxheVRpbWVvdXQoKSB7XG4gICAgaWYgKHRoaXMuZGVsYXlUaW1lb3V0SWQgIT09IHZvaWQgMCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lb3V0SWQpO1xuICAgICAgdGhpcy5kZWxheVRpbWVvdXRJZCA9IHZvaWQgMDtcbiAgICB9XG4gIH1cbiAgc2NoZWR1bGUoKSB7XG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID09PSB0aGlzLnNpemUpIHtcbiAgICAgIHZvaWQgdGhpcy5mbHVzaCgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5xdWV1ZS5sZW5ndGggPT09IDEpIHtcbiAgICAgIHRoaXMuY2xlYXJEZWxheVRpbWVvdXQoKTtcbiAgICAgIHRoaXMuZGVsYXlUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHZvaWQgdGhpcy5mbHVzaCgpLCB0aGlzLmRlbGF5KTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZmx1c2goKSB7XG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNhbGxzID0gdGhpcy5xdWV1ZS5zcGxpY2UoMCk7XG4gICAgY29uc3QgaW5wdXRzID0gY2FsbHMubWFwKChjYWxsKSA9PiBjYWxsLmlucHV0KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuY2FsbGJhY2soaW5wdXRzKTtcbiAgICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICAgIGNhbGxzLmZvckVhY2goKGNhbGwsIGluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc3VsdHM/LltpbmRleF07XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZXN1bHRzKSkge1xuICAgICAgICAgIGNhbGwucmVqZWN0KG5ldyBFcnJvcihcIkNhbGxiYWNrIG11c3QgcmV0dXJuIGFuIGFycmF5LlwiKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY2FsbHMubGVuZ3RoICE9PSByZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgIGNhbGwucmVqZWN0KFxuICAgICAgICAgICAgbmV3IEVycm9yKFxuICAgICAgICAgICAgICBgQ2FsbGJhY2sgbXVzdCByZXR1cm4gYW4gYXJyYXkgb2YgdGhlIHNhbWUgbGVuZ3RoIGFzIHRoZSBudW1iZXIgb2YgcHJvdmlkZWQgaXRlbXMuIEV4cGVjdGVkICR7Y2FsbHMubGVuZ3RofSwgYnV0IGdvdCAke3Jlc3VsdHMubGVuZ3RofS5gXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIGNhbGwucmVqZWN0KHJlc3VsdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yMykge1xuICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICBjYWxscy5mb3JFYWNoKChjYWxsKSA9PiB7XG4gICAgICAgIGNhbGwucmVqZWN0KGVycm9yMyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZ2V0KGlucHV0KSB7XG4gICAgY29uc3QgZXhpc3RpbmdDYWxsID0gdGhpcy5xdWV1ZS5maW5kKFxuICAgICAgKGNhbGwyKSA9PiBzdHJpbmdpZnkoY2FsbDIuaW5wdXQpID09PSBzdHJpbmdpZnkoaW5wdXQpXG4gICAgKTtcbiAgICBpZiAoZXhpc3RpbmdDYWxsKSB7XG4gICAgICByZXR1cm4gZXhpc3RpbmdDYWxsLnByb21pc2U7XG4gICAgfVxuICAgIGNvbnN0IGNhbGwgPSBuZXcgQmF0Y2hDYWxsKGlucHV0KTtcbiAgICB0aGlzLnF1ZXVlLnB1c2goY2FsbCk7XG4gICAgdGhpcy5zY2hlZHVsZSgpO1xuICAgIHJldHVybiBjYWxsLnByb21pc2U7XG4gIH1cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xuICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICB0aGlzLmNsZWFyRGVsYXlUaW1lb3V0KCk7XG4gIH1cbn07XG5mdW5jdGlvbiBjcmVhdGVCYXRjaFN0b3JlKGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gIGNvbnN0IGJhdGNoID0gbmV3IEJhdGNoKGNhbGxiYWNrLCBvcHRpb25zKTtcbiAgY29uc3QgY2FjaGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBjb25zdCBldmVudFNvdXJjZTIgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgZnVuY3Rpb24gZ2V0Q2FjaGVLZXkoYXJncykge1xuICAgIHJldHVybiBzdHJpbmdpZnkoYXJncyk7XG4gIH1cbiAgZnVuY3Rpb24gc2V0U3RhdGVBbmROb3RpZnkoY2FjaGVLZXksIHN0YXRlKSB7XG4gICAgY2FjaGUuc2V0KGNhY2hlS2V5LCBzdGF0ZSk7XG4gICAgZXZlbnRTb3VyY2UyLm5vdGlmeSgpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldChpbnB1dCkge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gZ2V0Q2FjaGVLZXkoaW5wdXQpO1xuICAgIGlmIChjYWNoZS5oYXMoY2FjaGVLZXkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBzZXRTdGF0ZUFuZE5vdGlmeShjYWNoZUtleSwgeyBpc0xvYWRpbmc6IHRydWUgfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiYXRjaC5nZXQoaW5wdXQpO1xuICAgICAgc2V0U3RhdGVBbmROb3RpZnkoY2FjaGVLZXksIHsgaXNMb2FkaW5nOiBmYWxzZSwgZGF0YTogcmVzdWx0IH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yMykge1xuICAgICAgc2V0U3RhdGVBbmROb3RpZnkoY2FjaGVLZXksIHtcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yM1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGdldFN0YXRlKGlucHV0KSB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBnZXRDYWNoZUtleShpbnB1dCk7XG4gICAgcmV0dXJuIGNhY2hlLmdldChjYWNoZUtleSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5ldmVudFNvdXJjZTIub2JzZXJ2YWJsZSxcbiAgICBnZXQsXG4gICAgZ2V0U3RhdGVcbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9jcmVhdGUtc3RvcmUudHNcbmZ1bmN0aW9uIGNyZWF0ZVN0b3JlKGluaXRpYWxTdGF0ZSkge1xuICBsZXQgc3RhdGUgPSBpbml0aWFsU3RhdGU7XG4gIGNvbnN0IHN1YnNjcmliZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuICBmdW5jdGlvbiBzZXQoY2FsbGJhY2spIHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IGNhbGxiYWNrKHN0YXRlKTtcbiAgICBpZiAoc3RhdGUgPT09IG5ld1N0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0YXRlID0gbmV3U3RhdGU7XG4gICAgZm9yIChjb25zdCBzdWJzY3JpYmVyIG9mIHN1YnNjcmliZXJzKSB7XG4gICAgICBzdWJzY3JpYmVyKHN0YXRlKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gc3Vic2NyaWJlKGNhbGxiYWNrKSB7XG4gICAgc3Vic2NyaWJlcnMuYWRkKGNhbGxiYWNrKTtcbiAgICBjYWxsYmFjayhzdGF0ZSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHN1YnNjcmliZXJzLmRlbGV0ZShjYWxsYmFjayk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGdldCxcbiAgICBzZXQsXG4gICAgc3Vic2NyaWJlXG4gIH07XG59XG5cbi8vIHNyYy9jb252ZXJ0LXBsYWluLWRhdGEudHNcbmZ1bmN0aW9uIGNvbnZlcnRUb0NvbW1lbnREYXRhKGRhdGEpIHtcbiAgY29uc3QgZWRpdGVkQXQgPSBkYXRhLmVkaXRlZEF0ID8gbmV3IERhdGUoZGF0YS5lZGl0ZWRBdCkgOiB2b2lkIDA7XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgY29uc3QgcmVhY3Rpb25zID0gZGF0YS5yZWFjdGlvbnMubWFwKChyZWFjdGlvbikgPT4gKHtcbiAgICAuLi5yZWFjdGlvbixcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHJlYWN0aW9uLmNyZWF0ZWRBdClcbiAgfSkpO1xuICBpZiAoZGF0YS5ib2R5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICByZWFjdGlvbnMsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICBlZGl0ZWRBdFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZGVsZXRlZEF0ID0gbmV3IERhdGUoZGF0YS5kZWxldGVkQXQpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgcmVhY3Rpb25zLFxuICAgICAgY3JlYXRlZEF0LFxuICAgICAgZWRpdGVkQXQsXG4gICAgICBkZWxldGVkQXRcbiAgICB9O1xuICB9XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9UaHJlYWREYXRhKGRhdGEpIHtcbiAgY29uc3QgdXBkYXRlZEF0ID0gZGF0YS51cGRhdGVkQXQgPyBuZXcgRGF0ZShkYXRhLnVwZGF0ZWRBdCkgOiB2b2lkIDA7XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgY29uc3QgY29tbWVudHMgPSBkYXRhLmNvbW1lbnRzLm1hcChcbiAgICAoY29tbWVudCkgPT4gY29udmVydFRvQ29tbWVudERhdGEoY29tbWVudClcbiAgKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIGNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQsXG4gICAgY29tbWVudHNcbiAgfTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb0NvbW1lbnRVc2VyUmVhY3Rpb24oZGF0YSkge1xuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdClcbiAgfTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YShkYXRhKSB7XG4gIGNvbnN0IG5vdGlmaWVkQXQgPSBuZXcgRGF0ZShkYXRhLm5vdGlmaWVkQXQpO1xuICBjb25zdCByZWFkQXQgPSBkYXRhLnJlYWRBdCA/IG5ldyBEYXRlKGRhdGEucmVhZEF0KSA6IG51bGw7XG4gIGlmIChcImFjdGl2aXRpZXNcIiBpbiBkYXRhKSB7XG4gICAgY29uc3QgYWN0aXZpdGllcyA9IGRhdGEuYWN0aXZpdGllcy5tYXAoKGFjdGl2aXR5KSA9PiAoe1xuICAgICAgLi4uYWN0aXZpdHksXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKGFjdGl2aXR5LmNyZWF0ZWRBdClcbiAgICB9KSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBub3RpZmllZEF0LFxuICAgICAgcmVhZEF0LFxuICAgICAgYWN0aXZpdGllc1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIG5vdGlmaWVkQXQsXG4gICAgcmVhZEF0XG4gIH07XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9UaHJlYWREZWxldGVJbmZvKGRhdGEpIHtcbiAgY29uc3QgZGVsZXRlZEF0ID0gbmV3IERhdGUoZGF0YS5kZWxldGVkQXQpO1xuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgZGVsZXRlZEF0XG4gIH07XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRlbGV0ZUluZm8oZGF0YSkge1xuICBjb25zdCBkZWxldGVkQXQgPSBuZXcgRGF0ZShkYXRhLmRlbGV0ZWRBdCk7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBkZWxldGVkQXRcbiAgfTtcbn1cblxuLy8gc3JjL2xpYi91cmwudHNcbmZ1bmN0aW9uIHRvVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykge1xuICBjb25zdCByZXN1bHQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHBhcmFtcykpIHtcbiAgICBpZiAodmFsdWUgIT09IHZvaWQgMCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgcmVzdWx0LnNldChrZXksIHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gdXJsam9pbihiYXNlVXJsLCBwYXRoLCBwYXJhbXMpIHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTChwYXRoLCBiYXNlVXJsKTtcbiAgaWYgKHBhcmFtcyAhPT0gdm9pZCAwKSB7XG4gICAgdXJsLnNlYXJjaCA9IChwYXJhbXMgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMgPyBwYXJhbXMgOiB0b1VSTFNlYXJjaFBhcmFtcyhwYXJhbXMpKS50b1N0cmluZygpO1xuICB9XG4gIHJldHVybiB1cmwudG9TdHJpbmcoKTtcbn1cblxuLy8gc3JjL25vdGlmaWNhdGlvbnMudHNcbnZhciBNQVJLX0lOQk9YX05PVElGSUNBVElPTlNfQVNfUkVBRF9CQVRDSF9ERUxBWSA9IDUwO1xuZnVuY3Rpb24gY3JlYXRlTm90aWZpY2F0aW9uc0FwaSh7XG4gIGJhc2VVcmwsXG4gIGF1dGhNYW5hZ2VyLFxuICBjdXJyZW50VXNlcklkU3RvcmUsXG4gIGZldGNoZXJcbn0pIHtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hKc29uKGVuZHBvaW50LCBvcHRpb25zLCBwYXJhbXMpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBhdXRoTWFuYWdlci5nZXRBdXRoVmFsdWUoe1xuICAgICAgcmVxdWVzdGVkU2NvcGU6IFwiY29tbWVudHM6cmVhZFwiXG4gICAgfSk7XG4gICAgaWYgKGF1dGhWYWx1ZS50eXBlID09PSBcInNlY3JldFwiICYmIGF1dGhWYWx1ZS50b2tlbi5wYXJzZWQuayA9PT0gXCJhY2NcIiAvKiBBQ0NFU1NfVE9LRU4gKi8pIHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGF1dGhWYWx1ZS50b2tlbi5wYXJzZWQudWlkO1xuICAgICAgY3VycmVudFVzZXJJZFN0b3JlLnNldCgoKSA9PiB1c2VySWQpO1xuICAgIH1cbiAgICBjb25zdCB1cmwgPSB1cmxqb2luKGJhc2VVcmwsIGAvdjIvYyR7ZW5kcG9pbnR9YCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoZXIodXJsLnRvU3RyaW5nKCksIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLm9wdGlvbnM/LmhlYWRlcnMsXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtnZXRBdXRoQmVhcmVySGVhZGVyRnJvbUF1dGhWYWx1ZShhdXRoVmFsdWUpfWBcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDQwMCAmJiByZXNwb25zZS5zdGF0dXMgPCA2MDApIHtcbiAgICAgICAgbGV0IGVycm9yMztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBlcnJvckJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIGVycm9yQm9keS5tZXNzYWdlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgZXJyb3JCb2R5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yMztcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGJvZHk7XG4gICAgdHJ5IHtcbiAgICAgIGJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBib2R5ID0ge307XG4gICAgfVxuICAgIHJldHVybiBib2R5O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldEluYm94Tm90aWZpY2F0aW9ucygpIHtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnNcIiwgdm9pZCAwLCB7fSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRocmVhZHM6IGpzb24udGhyZWFkcy5tYXAoY29udmVydFRvVGhyZWFkRGF0YSksXG4gICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IGpzb24uaW5ib3hOb3RpZmljYXRpb25zLm1hcChcbiAgICAgICAgY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhXG4gICAgICApLFxuICAgICAgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKGpzb24ubWV0YS5yZXF1ZXN0ZWRBdClcbiAgICB9O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlKG9wdGlvbnMpIHtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnNcIiwgdm9pZCAwLCB7XG4gICAgICBzaW5jZTogb3B0aW9ucy5zaW5jZS50b0lTT1N0cmluZygpXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRocmVhZHM6IHtcbiAgICAgICAgdXBkYXRlZDoganNvbi50aHJlYWRzLm1hcChjb252ZXJ0VG9UaHJlYWREYXRhKSxcbiAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkVGhyZWFkcy5tYXAoY29udmVydFRvVGhyZWFkRGVsZXRlSW5mbylcbiAgICAgIH0sXG4gICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHtcbiAgICAgICAgdXBkYXRlZDoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YSksXG4gICAgICAgIGRlbGV0ZWQ6IGpzb24uZGVsZXRlZEluYm94Tm90aWZpY2F0aW9ucy5tYXAoXG4gICAgICAgICAgY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EZWxldGVJbmZvXG4gICAgICAgIClcbiAgICAgIH0sXG4gICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoanNvbi5tZXRhLnJlcXVlc3RlZEF0KVxuICAgIH07XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0VW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQoKSB7XG4gICAgY29uc3QgeyBjb3VudCB9ID0gYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnMvY291bnRcIik7XG4gICAgcmV0dXJuIGNvdW50O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIG1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnMvcmVhZFwiLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaW5ib3hOb3RpZmljYXRpb25JZHM6IFwiYWxsXCIgfSlcbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWRzKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnMvcmVhZFwiLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaW5ib3hOb3RpZmljYXRpb25JZHMgfSlcbiAgICB9KTtcbiAgfVxuICBjb25zdCBiYXRjaGVkTWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZCA9IG5ldyBCYXRjaChcbiAgICBhc3luYyAoYmF0Y2hlZEluYm94Tm90aWZpY2F0aW9uSWRzKSA9PiB7XG4gICAgICBjb25zdCBpbmJveE5vdGlmaWNhdGlvbklkcyA9IGJhdGNoZWRJbmJveE5vdGlmaWNhdGlvbklkcy5mbGF0KCk7XG4gICAgICBhd2FpdCBtYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWRzKTtcbiAgICAgIHJldHVybiBpbmJveE5vdGlmaWNhdGlvbklkcztcbiAgICB9LFxuICAgIHsgZGVsYXk6IE1BUktfSU5CT1hfTk9USUZJQ0FUSU9OU19BU19SRUFEX0JBVENIX0RFTEFZIH1cbiAgKTtcbiAgYXN5bmMgZnVuY3Rpb24gbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWQpIHtcbiAgICBhd2FpdCBiYXRjaGVkTWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZC5nZXQoaW5ib3hOb3RpZmljYXRpb25JZCk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zKCkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcIi9pbmJveC1ub3RpZmljYXRpb25zXCIsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUluYm94Tm90aWZpY2F0aW9uKGluYm94Tm90aWZpY2F0aW9uSWQpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL2luYm94LW5vdGlmaWNhdGlvbnMvJHtlbmNvZGVVUklDb21wb25lbnQoaW5ib3hOb3RpZmljYXRpb25JZCl9YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGdldEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICBnZXRJbmJveE5vdGlmaWNhdGlvbnNTaW5jZSxcbiAgICBnZXRVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudCxcbiAgICBtYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkLFxuICAgIG1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZCxcbiAgICBkZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgZGVsZXRlSW5ib3hOb3RpZmljYXRpb25cbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9wb3NpdGlvbi50c1xudmFyIE1JTl9DT0RFID0gMzI7XG52YXIgTUFYX0NPREUgPSAxMjY7XG52YXIgTlVNX0RJR0lUUyA9IE1BWF9DT0RFIC0gTUlOX0NPREUgKyAxO1xudmFyIFpFUk8gPSBudGhEaWdpdCgwKTtcbnZhciBPTkUgPSBudGhEaWdpdCgxKTtcbnZhciBaRVJPX05JTkUgPSBaRVJPICsgbnRoRGlnaXQoLTEpO1xuZnVuY3Rpb24gbnRoRGlnaXQobikge1xuICBjb25zdCBjb2RlID0gTUlOX0NPREUgKyAobiA8IDAgPyBOVU1fRElHSVRTICsgbiA6IG4pO1xuICBpZiAoY29kZSA8IE1JTl9DT0RFIHx8IGNvZGUgPiBNQVhfQ09ERSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBuIHZhbHVlOiAke259YCk7XG4gIH1cbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG59XG5mdW5jdGlvbiBtYWtlUG9zaXRpb24oeCwgeSkge1xuICBpZiAoeCAhPT0gdm9pZCAwICYmIHkgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBiZXR3ZWVuKHgsIHkpO1xuICB9IGVsc2UgaWYgKHggIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBhZnRlcih4KTtcbiAgfSBlbHNlIGlmICh5ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gYmVmb3JlKHkpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBPTkU7XG4gIH1cbn1cbmZ1bmN0aW9uIGJlZm9yZShwb3MpIHtcbiAgY29uc3QgbGFzdEluZGV4ID0gcG9zLmxlbmd0aCAtIDE7XG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IGxhc3RJbmRleDsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IHBvcy5jaGFyQ29kZUF0KGkpO1xuICAgIGlmIChjb2RlIDw9IE1JTl9DT0RFKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKGkgPT09IGxhc3RJbmRleCkge1xuICAgICAgaWYgKGNvZGUgPT09IE1JTl9DT0RFICsgMSkge1xuICAgICAgICByZXR1cm4gcG9zLnN1YnN0cmluZygwLCBpKSArIFpFUk9fTklORTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwb3Muc3Vic3RyaW5nKDAsIGkpICsgU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlIC0gMSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBwb3Muc3Vic3RyaW5nKDAsIGkgKyAxKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIE9ORTtcbn1cbmZ1bmN0aW9uIGFmdGVyKHBvcykge1xuICBmb3IgKGxldCBpID0gMDsgaSA8PSBwb3MubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IHBvcy5jaGFyQ29kZUF0KGkpO1xuICAgIGlmIChjb2RlID49IE1BWF9DT0RFKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcmV0dXJuIHBvcy5zdWJzdHJpbmcoMCwgaSkgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUgKyAxKTtcbiAgfVxuICByZXR1cm4gcG9zICsgT05FO1xufVxuZnVuY3Rpb24gYmV0d2VlbihsbywgaGkpIHtcbiAgaWYgKGxvIDwgaGkpIHtcbiAgICByZXR1cm4gX2JldHdlZW4obG8sIGhpKTtcbiAgfSBlbHNlIGlmIChsbyA+IGhpKSB7XG4gICAgcmV0dXJuIF9iZXR3ZWVuKGhpLCBsbyk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGNvbXB1dGUgdmFsdWUgYmV0d2VlbiB0d28gZXF1YWwgcG9zaXRpb25zXCIpO1xuICB9XG59XG5mdW5jdGlvbiBfYmV0d2VlbihsbywgaGkpIHtcbiAgbGV0IGluZGV4ID0gMDtcbiAgY29uc3QgbG9MZW4gPSBsby5sZW5ndGg7XG4gIGNvbnN0IGhpTGVuID0gaGkubGVuZ3RoO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IGxvQ29kZSA9IGluZGV4IDwgbG9MZW4gPyBsby5jaGFyQ29kZUF0KGluZGV4KSA6IE1JTl9DT0RFO1xuICAgIGNvbnN0IGhpQ29kZSA9IGluZGV4IDwgaGlMZW4gPyBoaS5jaGFyQ29kZUF0KGluZGV4KSA6IE1BWF9DT0RFO1xuICAgIGlmIChsb0NvZGUgPT09IGhpQ29kZSkge1xuICAgICAgaW5kZXgrKztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoaGlDb2RlIC0gbG9Db2RlID09PSAxKSB7XG4gICAgICBjb25zdCBzaXplID0gaW5kZXggKyAxO1xuICAgICAgbGV0IHByZWZpeCA9IGxvLnN1YnN0cmluZygwLCBzaXplKTtcbiAgICAgIGlmIChwcmVmaXgubGVuZ3RoIDwgc2l6ZSkge1xuICAgICAgICBwcmVmaXggKz0gWkVSTy5yZXBlYXQoc2l6ZSAtIHByZWZpeC5sZW5ndGgpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3VmZml4ID0gbG8uc3Vic3RyaW5nKHNpemUpO1xuICAgICAgY29uc3QgbmluZXMgPSBcIlwiO1xuICAgICAgcmV0dXJuIHByZWZpeCArIF9iZXR3ZWVuKHN1ZmZpeCwgbmluZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGFrZU4obG8sIGluZGV4KSArIFN0cmluZy5mcm9tQ2hhckNvZGUoaGlDb2RlICsgbG9Db2RlID4+IDEpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gdGFrZU4ocG9zLCBuKSB7XG4gIHJldHVybiBuIDwgcG9zLmxlbmd0aCA/IHBvcy5zdWJzdHJpbmcoMCwgbikgOiBwb3MgKyBaRVJPLnJlcGVhdChuIC0gcG9zLmxlbmd0aCk7XG59XG52YXIgTUlOX05PTl9aRVJPX0NPREUgPSBNSU5fQ09ERSArIDE7XG5mdW5jdGlvbiBpc1BvcyhzdHIpIHtcbiAgaWYgKHN0ciA9PT0gXCJcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBsYXN0SWR4ID0gc3RyLmxlbmd0aCAtIDE7XG4gIGNvbnN0IGxhc3QgPSBzdHIuY2hhckNvZGVBdChsYXN0SWR4KTtcbiAgaWYgKGxhc3QgPCBNSU5fTk9OX1pFUk9fQ09ERSB8fCBsYXN0ID4gTUFYX0NPREUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXN0SWR4OyBpKyspIHtcbiAgICBjb25zdCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgaWYgKGNvZGUgPCBNSU5fQ09ERSB8fCBjb2RlID4gTUFYX0NPREUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9Qb3Moc3RyKSB7XG4gIGNvbnN0IGNvZGVzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIGNvZGVzLnB1c2goY29kZSA8IE1JTl9DT0RFID8gTUlOX0NPREUgOiBjb2RlID4gTUFYX0NPREUgPyBNQVhfQ09ERSA6IGNvZGUpO1xuICB9XG4gIHdoaWxlIChjb2Rlcy5sZW5ndGggPiAwICYmIGNvZGVzW2NvZGVzLmxlbmd0aCAtIDFdID09PSBNSU5fQ09ERSkge1xuICAgIGNvZGVzLmxlbmd0aC0tO1xuICB9XG4gIHJldHVybiBjb2Rlcy5sZW5ndGggPiAwID8gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5jb2RlcykgOiAoXG4gICAgLy8gRWRnZSBjYXNlOiB0aGUgc3RyIHdhcyBhIDAtb25seSBzdHJpbmcsIHdoaWNoIGlzIGludmFsaWQuIERlZmF1bHQgYmFjayB0byAuMVxuICAgIE9ORVxuICApO1xufVxuZnVuY3Rpb24gYXNQb3Moc3RyKSB7XG4gIHJldHVybiBpc1BvcyhzdHIpID8gc3RyIDogY29udmVydFRvUG9zKHN0cik7XG59XG5cbi8vIHNyYy9wcm90b2NvbC9PcC50c1xudmFyIE9wQ29kZSA9IC8qIEBfX1BVUkVfXyAqLyAoKE9wQ29kZTIpID0+IHtcbiAgT3BDb2RlMltPcENvZGUyW1wiSU5JVFwiXSA9IDBdID0gXCJJTklUXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIlNFVF9QQVJFTlRfS0VZXCJdID0gMV0gPSBcIlNFVF9QQVJFTlRfS0VZXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIkNSRUFURV9MSVNUXCJdID0gMl0gPSBcIkNSRUFURV9MSVNUXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIlVQREFURV9PQkpFQ1RcIl0gPSAzXSA9IFwiVVBEQVRFX09CSkVDVFwiO1xuICBPcENvZGUyW09wQ29kZTJbXCJDUkVBVEVfT0JKRUNUXCJdID0gNF0gPSBcIkNSRUFURV9PQkpFQ1RcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiREVMRVRFX0NSRFRcIl0gPSA1XSA9IFwiREVMRVRFX0NSRFRcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiREVMRVRFX09CSkVDVF9LRVlcIl0gPSA2XSA9IFwiREVMRVRFX09CSkVDVF9LRVlcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiQ1JFQVRFX01BUFwiXSA9IDddID0gXCJDUkVBVEVfTUFQXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIkNSRUFURV9SRUdJU1RFUlwiXSA9IDhdID0gXCJDUkVBVEVfUkVHSVNURVJcIjtcbiAgcmV0dXJuIE9wQ29kZTI7XG59KShPcENvZGUgfHwge30pO1xuZnVuY3Rpb24gYWNrT3Aob3BJZCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sXG4gICAgaWQ6IFwiQUNLXCIsXG4gICAgLy8gKEgpQUNLXG4gICAgb3BJZFxuICB9O1xufVxuZnVuY3Rpb24gaXNBY2tPcChvcCkge1xuICByZXR1cm4gb3AudHlwZSA9PT0gNSAvKiBERUxFVEVfQ1JEVCAqLyAmJiBvcC5pZCA9PT0gXCJBQ0tcIjtcbn1cblxuLy8gc3JjL2NyZHRzL0Fic3RyYWN0Q3JkdC50c1xuZnVuY3Rpb24gY3JkdEFzTGl2ZU5vZGUodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gSGFzUGFyZW50KG5vZGUsIGtleSwgcG9zID0gYXNQb3Moa2V5KSkge1xuICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7IHR5cGU6IFwiSGFzUGFyZW50XCIsIG5vZGUsIGtleSwgcG9zIH0pO1xufVxudmFyIE5vUGFyZW50ID0gT2JqZWN0LmZyZWV6ZSh7IHR5cGU6IFwiTm9QYXJlbnRcIiB9KTtcbmZ1bmN0aW9uIE9ycGhhbmVkKG9sZEtleSwgb2xkUG9zID0gYXNQb3Mob2xkS2V5KSkge1xuICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7IHR5cGU6IFwiT3JwaGFuZWRcIiwgb2xkS2V5LCBvbGRQb3MgfSk7XG59XG52YXIgQWJzdHJhY3RDcmR0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgdGhpcy5fcGFyZW50ID0gTm9QYXJlbnQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfZ2V0UGFyZW50S2V5T3JUaHJvdygpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmtleTtcbiAgICAgIGNhc2UgXCJOb1BhcmVudFwiOlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXJlbnQga2V5IGlzIG1pc3NpbmdcIik7XG4gICAgICBjYXNlIFwiT3JwaGFuZWRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Lm9sZEtleTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBhc3NlcnROZXZlcih0aGlzLnBhcmVudCwgXCJVbmtub3duIHN0YXRlXCIpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGdldCBfcGFyZW50UG9zKCkge1xuICAgIHN3aXRjaCAodGhpcy5wYXJlbnQudHlwZSkge1xuICAgICAgY2FzZSBcIkhhc1BhcmVudFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQucG9zO1xuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhcmVudCBrZXkgaXMgbWlzc2luZ1wiKTtcbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQub2xkUG9zO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgZ2V0IF9wb29sKCkge1xuICAgIHJldHVybiB0aGlzLl9fcG9vbDtcbiAgfVxuICBnZXQgcm9vbUlkKCkge1xuICAgIHJldHVybiB0aGlzLl9fcG9vbCA/IHRoaXMuX19wb29sLnJvb21JZCA6IG51bGw7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgX2lkKCkge1xuICAgIHJldHVybiB0aGlzLl9faWQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgcGFyZW50KCkge1xuICAgIHJldHVybiB0aGlzLl9wYXJlbnQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgX3BhcmVudEtleSgpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmtleTtcbiAgICAgIGNhc2UgXCJOb1BhcmVudFwiOlxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQub2xkS2V5O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5KG9wLCBfaXNMb2NhbCkge1xuICAgIHN3aXRjaCAob3AudHlwZSkge1xuICAgICAgY2FzZSA1IC8qIERFTEVURV9DUkRUICovOiB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Lm5vZGUuX2RldGFjaENoaWxkKGNyZHRBc0xpdmVOb2RlKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2V0UGFyZW50TGluayhuZXdQYXJlbnROb2RlLCBuZXdQYXJlbnRLZXkpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjpcbiAgICAgICAgaWYgKHRoaXMucGFyZW50Lm5vZGUgIT09IG5ld1BhcmVudE5vZGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IHBhcmVudDogbm9kZSBhbHJlYWR5IGhhcyBhIHBhcmVudFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9wYXJlbnQgPSBIYXNQYXJlbnQobmV3UGFyZW50Tm9kZSwgbmV3UGFyZW50S2V5KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6IHtcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gSGFzUGFyZW50KG5ld1BhcmVudE5vZGUsIG5ld1BhcmVudEtleSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBhc3NlcnROZXZlcih0aGlzLnBhcmVudCwgXCJVbmtub3duIHN0YXRlXCIpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2goaWQsIHBvb2wpIHtcbiAgICBpZiAodGhpcy5fX2lkIHx8IHRoaXMuX19wb29sKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgYXR0YWNoIG5vZGU6IGFscmVhZHkgYXR0YWNoZWRcIik7XG4gICAgfVxuICAgIHBvb2wuYWRkTm9kZShpZCwgY3JkdEFzTGl2ZU5vZGUodGhpcykpO1xuICAgIHRoaXMuX19pZCA9IGlkO1xuICAgIHRoaXMuX19wb29sID0gcG9vbDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2goKSB7XG4gICAgaWYgKHRoaXMuX19wb29sICYmIHRoaXMuX19pZCkge1xuICAgICAgdGhpcy5fX3Bvb2wuZGVsZXRlTm9kZSh0aGlzLl9faWQpO1xuICAgIH1cbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjoge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBPcnBoYW5lZCh0aGlzLnBhcmVudC5rZXksIHRoaXMucGFyZW50LnBvcyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6IHtcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gTm9QYXJlbnQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIk9ycGhhbmVkXCI6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBhc3NlcnROZXZlcih0aGlzLnBhcmVudCwgXCJVbmtub3duIHN0YXRlXCIpO1xuICAgIH1cbiAgICB0aGlzLl9fcG9vbCA9IHZvaWQgMDtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqXG4gICAqIENsZWFyIHRoZSBJbW11dGFibGUgY2FjaGUsIHNvIHRoYXQgdGhlIG5leHQgY2FsbCB0byBgLnRvSW1tdXRhYmxlKClgIHdpbGxcbiAgICogcmVjb21wdXRlIHRoZSBlcXVpdmFsZW50IEltbXV0YWJsZSB2YWx1ZSBhZ2Fpbi4gIENhbGwgdGhpcyBhZnRlciBldmVyeVxuICAgKiBtdXRhdGlvbiB0byB0aGUgTGl2ZSBub2RlLlxuICAgKi9cbiAgaW52YWxpZGF0ZSgpIHtcbiAgICBpZiAodGhpcy5fY2FjaGVkSW1tdXRhYmxlICE9PSB2b2lkIDAgfHwgdGhpcy5fY2FjaGVkVHJlZU5vZGUgIT09IHZvaWQgMCkge1xuICAgICAgdGhpcy5fY2FjaGVkSW1tdXRhYmxlID0gdm9pZCAwO1xuICAgICAgdGhpcy5fY2FjaGVkVHJlZU5vZGUgPSB2b2lkIDA7XG4gICAgICBpZiAodGhpcy5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIikge1xuICAgICAgICB0aGlzLnBhcmVudC5ub2RlLmludmFsaWRhdGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKlxuICAgKiBSZXR1cm4gYW4gc25hcHNob3Qgb2YgdGhpcyBMaXZlIHRyZWUgZm9yIHVzZSBpbiBEZXZUb29scy5cbiAgICovXG4gIHRvVHJlZU5vZGUoa2V5KSB7XG4gICAgaWYgKHRoaXMuX2NhY2hlZFRyZWVOb2RlID09PSB2b2lkIDAgfHwgdGhpcy5fY2FjaGVkVHJlZU5vZGVLZXkgIT09IGtleSkge1xuICAgICAgdGhpcy5fY2FjaGVkVHJlZU5vZGVLZXkgPSBrZXk7XG4gICAgICB0aGlzLl9jYWNoZWRUcmVlTm9kZSA9IHRoaXMuX3RvVHJlZU5vZGUoa2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NhY2hlZFRyZWVOb2RlO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm4gYW4gaW1tdXRhYmxlIHNuYXBzaG90IG9mIHRoaXMgTGl2ZSBub2RlIGFuZCBpdHMgY2hpbGRyZW4uXG4gICAqL1xuICB0b0ltbXV0YWJsZSgpIHtcbiAgICBpZiAodGhpcy5fY2FjaGVkSW1tdXRhYmxlID09PSB2b2lkIDApIHtcbiAgICAgIHRoaXMuX2NhY2hlZEltbXV0YWJsZSA9IHRoaXMuX3RvSW1tdXRhYmxlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYWNoZWRJbW11dGFibGU7XG4gIH1cbn07XG5cbi8vIHNyYy9wcm90b2NvbC9TZXJpYWxpemVkQ3JkdC50c1xudmFyIENyZHRUeXBlID0gLyogQF9fUFVSRV9fICovICgoQ3JkdFR5cGUyKSA9PiB7XG4gIENyZHRUeXBlMltDcmR0VHlwZTJbXCJPQkpFQ1RcIl0gPSAwXSA9IFwiT0JKRUNUXCI7XG4gIENyZHRUeXBlMltDcmR0VHlwZTJbXCJMSVNUXCJdID0gMV0gPSBcIkxJU1RcIjtcbiAgQ3JkdFR5cGUyW0NyZHRUeXBlMltcIk1BUFwiXSA9IDJdID0gXCJNQVBcIjtcbiAgQ3JkdFR5cGUyW0NyZHRUeXBlMltcIlJFR0lTVEVSXCJdID0gM10gPSBcIlJFR0lTVEVSXCI7XG4gIHJldHVybiBDcmR0VHlwZTI7XG59KShDcmR0VHlwZSB8fCB7fSk7XG5mdW5jdGlvbiBpc1Jvb3RDcmR0KGNyZHQpIHtcbiAgcmV0dXJuIGNyZHQudHlwZSA9PT0gMCAvKiBPQkpFQ1QgKi8gJiYgIWlzQ2hpbGRDcmR0KGNyZHQpO1xufVxuZnVuY3Rpb24gaXNDaGlsZENyZHQoY3JkdCkge1xuICByZXR1cm4gY3JkdC5wYXJlbnRJZCAhPT0gdm9pZCAwICYmIGNyZHQucGFyZW50S2V5ICE9PSB2b2lkIDA7XG59XG5cbi8vIHNyYy9saWIvbmFub2lkLnRzXG52YXIgbmFub2lkID0gKHQgPSAyMSkgPT4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSh0KSkucmVkdWNlKFxuICAodDIsIGUpID0+IHQyICs9IChlICY9IDYzKSA8IDM2ID8gZS50b1N0cmluZygzNikgOiBlIDwgNjIgPyAoZSAtIDI2KS50b1N0cmluZygzNikudG9VcHBlckNhc2UoKSA6IGUgPCA2MyA/IFwiX1wiIDogXCItXCIsXG4gIFwiXCJcbik7XG5cbi8vIHNyYy9jcmR0cy9MaXZlUmVnaXN0ZXIudHNcbnZhciBMaXZlUmVnaXN0ZXIgPSBjbGFzcyBfTGl2ZVJlZ2lzdGVyIGV4dGVuZHMgQWJzdHJhY3RDcmR0IHtcbiAgY29uc3RydWN0b3IoZGF0YSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gIH1cbiAgZ2V0IGRhdGEoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2Rlc2VyaWFsaXplKFtpZCwgaXRlbV0sIF9wYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgcmVnaXN0ZXIgPSBuZXcgX0xpdmVSZWdpc3RlcihpdGVtLmRhdGEpO1xuICAgIHJlZ2lzdGVyLl9hdHRhY2goaWQsIHBvb2wpO1xuICAgIHJldHVybiByZWdpc3RlcjtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b09wcyhwYXJlbnRJZCwgcGFyZW50S2V5LCBwb29sKSB7XG4gICAgaWYgKHRoaXMuX2lkID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJDYW5ub3Qgc2VyaWFsaXplIHJlZ2lzdGVyIGlmIHBhcmVudElkIG9yIHBhcmVudEtleSBpcyB1bmRlZmluZWRcIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgdHlwZTogOCAvKiBDUkVBVEVfUkVHSVNURVIgKi8sXG4gICAgICAgIG9wSWQ6IHBvb2w/LmdlbmVyYXRlT3BJZCgpLFxuICAgICAgICBpZDogdGhpcy5faWQsXG4gICAgICAgIHBhcmVudElkLFxuICAgICAgICBwYXJlbnRLZXksXG4gICAgICAgIGRhdGE6IHRoaXMuZGF0YVxuICAgICAgfVxuICAgIF07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2VyaWFsaXplKCkge1xuICAgIGlmICh0aGlzLnBhcmVudC50eXBlICE9PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIExpdmVSZWdpc3RlciBpZiBwYXJlbnQgaXMgbWlzc2luZ1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IDMgLyogUkVHSVNURVIgKi8sXG4gICAgICBwYXJlbnRJZDogbm4odGhpcy5wYXJlbnQubm9kZS5faWQsIFwiUGFyZW50IG5vZGUgZXhwZWN0ZWQgdG8gaGF2ZSBJRFwiKSxcbiAgICAgIHBhcmVudEtleTogdGhpcy5wYXJlbnQua2V5LFxuICAgICAgZGF0YTogdGhpcy5kYXRhXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2hDaGlsZChfb3ApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2hDaGlsZChfY3JkdCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5KG9wLCBpc0xvY2FsKSB7XG4gICAgcmV0dXJuIHN1cGVyLl9hcHBseShvcCwgaXNMb2NhbCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9UcmVlTm9kZShrZXkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJKc29uXCIsXG4gICAgICBpZDogdGhpcy5faWQgPz8gbmFub2lkKCksXG4gICAgICBrZXksXG4gICAgICBwYXlsb2FkOiB0aGlzLl9kYXRhXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICBjbG9uZSgpIHtcbiAgICByZXR1cm4gZGVlcENsb25lKHRoaXMuZGF0YSk7XG4gIH1cbn07XG5cbi8vIHNyYy9jcmR0cy9MaXZlTGlzdC50c1xuZnVuY3Rpb24gY29tcGFyZU5vZGVQb3NpdGlvbihpdGVtQSwgaXRlbUIpIHtcbiAgY29uc3QgcG9zQSA9IGl0ZW1BLl9wYXJlbnRQb3M7XG4gIGNvbnN0IHBvc0IgPSBpdGVtQi5fcGFyZW50UG9zO1xuICByZXR1cm4gcG9zQSA9PT0gcG9zQiA/IDAgOiBwb3NBIDwgcG9zQiA/IC0xIDogMTtcbn1cbnZhciBMaXZlTGlzdCA9IGNsYXNzIF9MaXZlTGlzdCBleHRlbmRzIEFic3RyYWN0Q3JkdCB7XG4gIGNvbnN0cnVjdG9yKGl0ZW1zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9pdGVtcyA9IFtdO1xuICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtTZXQoKTtcbiAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGxldCBwb3NpdGlvbiA9IHZvaWQgMDtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gbWFrZVBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgIGNvbnN0IG5vZGUgPSBsc29uVG9MaXZlTm9kZShpdGVtKTtcbiAgICAgIG5vZGUuX3NldFBhcmVudExpbmsodGhpcywgbmV3UG9zaXRpb24pO1xuICAgICAgdGhpcy5faXRlbXMucHVzaChub2RlKTtcbiAgICAgIHBvc2l0aW9uID0gbmV3UG9zaXRpb247XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIF9kZXNlcmlhbGl6ZShbaWRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgbGlzdCA9IG5ldyBfTGl2ZUxpc3QoW10pO1xuICAgIGxpc3QuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnRUb0NoaWxkcmVuLmdldChpZCk7XG4gICAgaWYgKGNoaWxkcmVuID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBsaXN0O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtpZDIsIGNyZHRdIG9mIGNoaWxkcmVuKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGRlc2VyaWFsaXplKFtpZDIsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKGxpc3QsIGNyZHQucGFyZW50S2V5KTtcbiAgICAgIGxpc3QuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgIH1cbiAgICByZXR1cm4gbGlzdDtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqIFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IHRoZSByZXN1bHRpbmcgb3BzIHdpbGwgYmUgc2VudCB0byB0aGUgc2VydmVyIGlmIHRoZXkgaGF2ZSBhbiAnb3BJZCdcbiAgICogc28gd2UgbXV0YXRlIF91bmFja25vd2xlZGdlZFNldHMgdG8gYXZvaWQgcG90ZW50aWFsIGZsaWNrZXJpbmdcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL2xpdmVibG9ja3MvbGl2ZWJsb2Nrcy9wdWxsLzExNzdcbiAgICpcbiAgICogVGhpcyBpcyBxdWl0ZSB1bmludHVpdGl2ZSBhbmQgc2hvdWxkIGRpc2FwcGVhciBhcyBzb29uIGFzXG4gICAqIHdlIGludHJvZHVjZSBhbiBleHBsaWNpdCBMaXZlTGlzdC5TZXQgb3BlcmF0aW9uXG4gICAqL1xuICBfdG9PcHMocGFyZW50SWQsIHBhcmVudEtleSwgcG9vbCkge1xuICAgIGlmICh0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIGl0ZW0gaXMgbm90IGF0dGFjaGVkXCIpO1xuICAgIH1cbiAgICBjb25zdCBvcHMgPSBbXTtcbiAgICBjb25zdCBvcCA9IHtcbiAgICAgIGlkOiB0aGlzLl9pZCxcbiAgICAgIG9wSWQ6IHBvb2w/LmdlbmVyYXRlT3BJZCgpLFxuICAgICAgdHlwZTogMiAvKiBDUkVBVEVfTElTVCAqLyxcbiAgICAgIHBhcmVudElkLFxuICAgICAgcGFyZW50S2V5XG4gICAgfTtcbiAgICBvcHMucHVzaChvcCk7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICBjb25zdCBwYXJlbnRLZXkyID0gaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpO1xuICAgICAgY29uc3QgY2hpbGRPcHMgPSBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKFxuICAgICAgICBpdGVtLl90b09wcyh0aGlzLl9pZCwgcGFyZW50S2V5MiwgcG9vbCksXG4gICAgICAgIHZvaWQgMFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNoaWxkT3BJZCA9IGNoaWxkT3BzWzBdLm9wSWQ7XG4gICAgICBpZiAoY2hpbGRPcElkICE9PSB2b2lkIDApIHtcbiAgICAgICAgdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLnNldChwYXJlbnRLZXkyLCBjaGlsZE9wSWQpO1xuICAgICAgfVxuICAgICAgb3BzLnB1c2goLi4uY2hpbGRPcHMpO1xuICAgIH1cbiAgICByZXR1cm4gb3BzO1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICpcbiAgICogQWRkcyBhIG5ldyBpdGVtIGludG8gdGhlIHNvcnRlZCBsaXN0LCBpbiB0aGUgY29ycmVjdCBwb3NpdGlvbi5cbiAgICovXG4gIF9pbnNlcnRBbmRTb3J0KGl0ZW0pIHtcbiAgICB0aGlzLl9pdGVtcy5wdXNoKGl0ZW0pO1xuICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3NvcnRJdGVtcygpIHtcbiAgICB0aGlzLl9pdGVtcy5zb3J0KGNvbXBhcmVOb2RlUG9zaXRpb24pO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2luZGV4T2ZQb3NpdGlvbihwb3NpdGlvbikge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcy5maW5kSW5kZXgoXG4gICAgICAoaXRlbSkgPT4gaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpID09PSBwb3NpdGlvblxuICAgICk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXR0YWNoKGlkLCBwb29sKSB7XG4gICAgc3VwZXIuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICBpdGVtLl9hdHRhY2gocG9vbC5nZW5lcmF0ZUlkKCksIHBvb2wpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2goKSB7XG4gICAgc3VwZXIuX2RldGFjaCgpO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLl9pdGVtcykge1xuICAgICAgaXRlbS5fZGV0YWNoKCk7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5U2V0UmVtb3RlKG9wKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3QgeyBpZCwgcGFyZW50S2V5OiBrZXkgfSA9IG9wO1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGNoaWxkLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY29uc3QgZGVsZXRlZElkID0gb3AuZGVsZXRlZElkO1xuICAgIGNvbnN0IGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgIGlmIChpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gIT09IC0xKSB7XG4gICAgICBjb25zdCBpdGVtV2l0aFNhbWVQb3NpdGlvbiA9IHRoaXMuX2l0ZW1zW2luZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbl07XG4gICAgICBpZiAoaXRlbVdpdGhTYW1lUG9zaXRpb24uX2lkID09PSBkZWxldGVkSWQpIHtcbiAgICAgICAgaXRlbVdpdGhTYW1lUG9zaXRpb24uX2RldGFjaCgpO1xuICAgICAgICB0aGlzLl9pdGVtc1tpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb25dID0gY2hpbGQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgc2V0RGVsdGEoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uLCBjaGlsZClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5hZGQoaXRlbVdpdGhTYW1lUG9zaXRpb24pO1xuICAgICAgICB0aGlzLl9pdGVtc1tpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb25dID0gY2hpbGQ7XG4gICAgICAgIGNvbnN0IGRlbHRhID0gW1xuICAgICAgICAgIHNldERlbHRhKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiwgY2hpbGQpXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGRlbGV0ZURlbHRhMiA9IHRoaXMuX2RldGFjaEl0ZW1Bc3NvY2lhdGVkVG9TZXRPcGVyYXRpb24oXG4gICAgICAgICAgb3AuZGVsZXRlZElkXG4gICAgICAgICk7XG4gICAgICAgIGlmIChkZWxldGVEZWx0YTIpIHtcbiAgICAgICAgICBkZWx0YS5wdXNoKGRlbGV0ZURlbHRhMik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdXBkYXRlcyA9IFtdO1xuICAgICAgY29uc3QgZGVsZXRlRGVsdGEyID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihcbiAgICAgICAgb3AuZGVsZXRlZElkXG4gICAgICApO1xuICAgICAgaWYgKGRlbGV0ZURlbHRhMikge1xuICAgICAgICB1cGRhdGVzLnB1c2goZGVsZXRlRGVsdGEyKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgICAgdXBkYXRlcy5wdXNoKGluc2VydERlbHRhKHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpLCBjaGlsZCkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmV2ZXJzZTogW10sXG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIHVwZGF0ZXMpXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldEFjayhvcCkge1xuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGF0dGFjaCBjaGlsZCBpZiBtYW5hZ2VkIHBvb2wgaXMgbm90IHByZXNlbnRcIik7XG4gICAgfVxuICAgIGNvbnN0IGRlbHRhID0gW107XG4gICAgY29uc3QgZGVsZXRlZERlbHRhID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihvcC5kZWxldGVkSWQpO1xuICAgIGlmIChkZWxldGVkRGVsdGEpIHtcbiAgICAgIGRlbHRhLnB1c2goZGVsZXRlZERlbHRhKTtcbiAgICB9XG4gICAgY29uc3QgdW5hY2tub3dsZWRnZWRPcElkID0gdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLmdldChvcC5wYXJlbnRLZXkpO1xuICAgIGlmICh1bmFja25vd2xlZGdlZE9wSWQgIT09IHZvaWQgMCkge1xuICAgICAgaWYgKHVuYWNrbm93bGVkZ2VkT3BJZCAhPT0gb3Aub3BJZCkge1xuICAgICAgICByZXR1cm4gZGVsdGEubGVuZ3RoID09PSAwID8geyBtb2RpZmllZDogZmFsc2UgfSA6IHsgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgZGVsdGEpLCByZXZlcnNlOiBbXSB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLmRlbGV0ZShvcC5wYXJlbnRLZXkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gPSB0aGlzLl9pbmRleE9mUG9zaXRpb24ob3AucGFyZW50S2V5KTtcbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLl9pdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLl9pZCA9PT0gb3AuaWQpO1xuICAgIGlmIChleGlzdGluZ0l0ZW0gIT09IHZvaWQgMCkge1xuICAgICAgaWYgKGV4aXN0aW5nSXRlbS5fcGFyZW50S2V5ID09PSBvcC5wYXJlbnRLZXkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZGVsdGEubGVuZ3RoID4gMCA/IG1ha2VVcGRhdGUodGhpcywgZGVsdGEpIDogZmFsc2UsXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gIT09IC0xKSB7XG4gICAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuYWRkKFxuICAgICAgICAgIHRoaXMuX2l0ZW1zW2luZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbl1cbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5faXRlbXMuc3BsaWNlKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiwgMSk7XG4gICAgICAgIGRlbHRhLnB1c2goZGVsZXRlRGVsdGEoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uKSk7XG4gICAgICB9XG4gICAgICBjb25zdCBwcmV2aW91c0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihleGlzdGluZ0l0ZW0pO1xuICAgICAgZXhpc3RpbmdJdGVtLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG9wLnBhcmVudEtleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihleGlzdGluZ0l0ZW0pO1xuICAgICAgaWYgKG5ld0luZGV4ICE9PSBwcmV2aW91c0luZGV4KSB7XG4gICAgICAgIGRlbHRhLnB1c2gobW92ZURlbHRhKHByZXZpb3VzSW5kZXgsIG5ld0luZGV4LCBleGlzdGluZ0l0ZW0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBkZWx0YS5sZW5ndGggPiAwID8gbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSkgOiBmYWxzZSxcbiAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG9ycGhhbiA9IHRoaXMuX3Bvb2wuZ2V0Tm9kZShvcC5pZCk7XG4gICAgICBpZiAob3JwaGFuICYmIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuaGFzKG9ycGhhbikpIHtcbiAgICAgICAgb3JwaGFuLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG9wLnBhcmVudEtleSk7XG4gICAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuZGVsZXRlKG9ycGhhbik7XG4gICAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQob3JwaGFuKTtcbiAgICAgICAgY29uc3QgcmVjcmVhdGVkSXRlbUluZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihvcnBoYW4pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGl0ZW0gYXQgdGhpcyBwb3NpdGlvbiwgdXBkYXRlIGlzIGEgc2V0LCBlbHNlIGl0J3MgYW4gaW5zZXJ0XG4gICAgICAgICAgICBpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gPT09IC0xID8gaW5zZXJ0RGVsdGEocmVjcmVhdGVkSXRlbUluZGV4LCBvcnBoYW4pIDogc2V0RGVsdGEocmVjcmVhdGVkSXRlbUluZGV4LCBvcnBoYW4pLFxuICAgICAgICAgICAgLi4uZGVsdGFcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IG5ld0l0ZW0sIG5ld0luZGV4IH0gPSB0aGlzLl9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChcbiAgICAgICAgICBvcCxcbiAgICAgICAgICBvcC5wYXJlbnRLZXlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbXG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpdGVtIGF0IHRoaXMgcG9zaXRpb24sIHVwZGF0ZSBpcyBhIHNldCwgZWxzZSBpdCdzIGFuIGluc2VydFxuICAgICAgICAgICAgaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uID09PSAtMSA/IGluc2VydERlbHRhKG5ld0luZGV4LCBuZXdJdGVtKSA6IHNldERlbHRhKG5ld0luZGV4LCBuZXdJdGVtKSxcbiAgICAgICAgICAgIC4uLmRlbHRhXG4gICAgICAgICAgXSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHVwZGF0ZSBkZWx0YSBvZiB0aGUgZGVsZXRpb24gb3IgbnVsbFxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9kZXRhY2hJdGVtQXNzb2NpYXRlZFRvU2V0T3BlcmF0aW9uKGRlbGV0ZWRJZCkge1xuICAgIGlmIChkZWxldGVkSWQgPT09IHZvaWQgMCB8fCB0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBkZWxldGVkSXRlbSA9IHRoaXMuX3Bvb2wuZ2V0Tm9kZShkZWxldGVkSWQpO1xuICAgIGlmIChkZWxldGVkSXRlbSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5fZGV0YWNoQ2hpbGQoZGVsZXRlZEl0ZW0pO1xuICAgIGlmIChyZXN1bHQubW9kaWZpZWQgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdC5tb2RpZmllZC51cGRhdGVzWzBdO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5UmVtb3RlSW5zZXJ0KG9wKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3Qga2V5ID0gYXNQb3Mob3AucGFyZW50S2V5KTtcbiAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCAhPT0gLTEpIHtcbiAgICAgIHRoaXMuX3NoaWZ0SXRlbVBvc2l0aW9uKGV4aXN0aW5nSXRlbUluZGV4LCBrZXkpO1xuICAgIH1cbiAgICBjb25zdCB7IG5ld0l0ZW0sIG5ld0luZGV4IH0gPSB0aGlzLl9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChvcCwga2V5KTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2luc2VydERlbHRhKG5ld0luZGV4LCBuZXdJdGVtKV0pLFxuICAgICAgcmV2ZXJzZTogW11cbiAgICB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5SW5zZXJ0QWNrKG9wKSB7XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5faXRlbXMuZmluZCgoaXRlbSkgPT4gaXRlbS5faWQgPT09IG9wLmlkKTtcbiAgICBjb25zdCBrZXkgPSBhc1BvcyhvcC5wYXJlbnRLZXkpO1xuICAgIGNvbnN0IGl0ZW1JbmRleEF0UG9zaXRpb24gPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XG4gICAgICBpZiAoZXhpc3RpbmdJdGVtLl9wYXJlbnRLZXkgPT09IGtleSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgb2xkUG9zaXRpb25JbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoZXhpc3RpbmdJdGVtKTtcbiAgICAgICAgaWYgKGl0ZW1JbmRleEF0UG9zaXRpb24gIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5fc2hpZnRJdGVtUG9zaXRpb24oaXRlbUluZGV4QXRQb3NpdGlvbiwga2V5KTtcbiAgICAgICAgfVxuICAgICAgICBleGlzdGluZ0l0ZW0uX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICAgICAgdGhpcy5fc29ydEl0ZW1zKCk7XG4gICAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgICAgIGlmIChuZXdJbmRleCA9PT0gb2xkUG9zaXRpb25JbmRleCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgbW92ZURlbHRhKG9sZFBvc2l0aW9uSW5kZXgsIG5ld0luZGV4LCBleGlzdGluZ0l0ZW0pXG4gICAgICAgICAgXSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgb3JwaGFuID0gbm4odGhpcy5fcG9vbCkuZ2V0Tm9kZShvcC5pZCk7XG4gICAgICBpZiAob3JwaGFuICYmIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuaGFzKG9ycGhhbikpIHtcbiAgICAgICAgb3JwaGFuLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuZGVsZXRlKG9ycGhhbik7XG4gICAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQob3JwaGFuKTtcbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIG9ycGhhbildKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGl0ZW1JbmRleEF0UG9zaXRpb24gIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5fc2hpZnRJdGVtUG9zaXRpb24oaXRlbUluZGV4QXRQb3NpdGlvbiwga2V5KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IG5ld0l0ZW0sIG5ld0luZGV4IH0gPSB0aGlzLl9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChvcCwga2V5KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIG5ld0l0ZW0pXSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlJbnNlcnRVbmRvUmVkbyhvcCkge1xuICAgIGNvbnN0IHsgaWQsIHBhcmVudEtleToga2V5IH0gPSBvcDtcbiAgICBjb25zdCBjaGlsZCA9IGNyZWF0aW9uT3BUb0xpdmVOb2RlKG9wKTtcbiAgICBpZiAodGhpcy5fcG9vbD8uZ2V0Tm9kZShpZCkgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGNoaWxkLl9hdHRhY2goaWQsIG5uKHRoaXMuX3Bvb2wpKTtcbiAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgbGV0IG5ld0tleSA9IGtleTtcbiAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggIT09IC0xKSB7XG4gICAgICBjb25zdCBiZWZvcmUyID0gdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdPy5fcGFyZW50UG9zO1xuICAgICAgY29uc3QgYWZ0ZXIyID0gdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXggKyAxXT8uX3BhcmVudFBvcztcbiAgICAgIG5ld0tleSA9IG1ha2VQb3NpdGlvbihiZWZvcmUyLCBhZnRlcjIpO1xuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICB9XG4gICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2luc2VydERlbHRhKG5ld0luZGV4LCBjaGlsZCldKSxcbiAgICAgIHJldmVyc2U6IFt7IHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sIGlkIH1dXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldFVuZG9SZWRvKG9wKSB7XG4gICAgY29uc3QgeyBpZCwgcGFyZW50S2V5OiBrZXkgfSA9IG9wO1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGlmICh0aGlzLl9wb29sPy5nZXROb2RlKGlkKSAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLnNldChrZXksIG5uKG9wLm9wSWQpKTtcbiAgICBjb25zdCBpbmRleE9mSXRlbVdpdGhTYW1lS2V5ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgY2hpbGQuX2F0dGFjaChpZCwgbm4odGhpcy5fcG9vbCkpO1xuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY29uc3QgbmV3S2V5ID0ga2V5O1xuICAgIGlmIChpbmRleE9mSXRlbVdpdGhTYW1lS2V5ICE9PSAtMSkge1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5faXRlbXNbaW5kZXhPZkl0ZW1XaXRoU2FtZUtleV07XG4gICAgICBleGlzdGluZ0l0ZW0uX2RldGFjaCgpO1xuICAgICAgdGhpcy5faXRlbXNbaW5kZXhPZkl0ZW1XaXRoU2FtZUtleV0gPSBjaGlsZDtcbiAgICAgIGNvbnN0IHJldmVyc2UgPSBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKFxuICAgICAgICBleGlzdGluZ0l0ZW0uX3RvT3BzKG5uKHRoaXMuX2lkKSwga2V5LCB0aGlzLl9wb29sKSxcbiAgICAgICAgb3AuaWRcbiAgICAgICk7XG4gICAgICBjb25zdCBkZWx0YSA9IFtzZXREZWx0YShpbmRleE9mSXRlbVdpdGhTYW1lS2V5LCBjaGlsZCldO1xuICAgICAgY29uc3QgZGVsZXRlZERlbHRhID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihcbiAgICAgICAgb3AuZGVsZXRlZElkXG4gICAgICApO1xuICAgICAgaWYgKGRlbGV0ZWREZWx0YSkge1xuICAgICAgICBkZWx0YS5wdXNoKGRlbGV0ZWREZWx0YSk7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSksXG4gICAgICAgIHJldmVyc2VcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgICAgdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihvcC5kZWxldGVkSWQpO1xuICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJldmVyc2U6IFt7IHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sIGlkIH1dLFxuICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIGNoaWxkKV0pXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2hDaGlsZChvcCwgc291cmNlKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdDtcbiAgICBpZiAob3AuaW50ZW50ID09PSBcInNldFwiKSB7XG4gICAgICBpZiAoc291cmNlID09PSAxIC8qIFJFTU9URSAqLykge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseVNldFJlbW90ZShvcCk7XG4gICAgICB9IGVsc2UgaWYgKHNvdXJjZSA9PT0gMiAvKiBBQ0sgKi8pIHtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5fYXBwbHlTZXRBY2sob3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5fYXBwbHlTZXRVbmRvUmVkbyhvcCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzb3VyY2UgPT09IDEgLyogUkVNT1RFICovKSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuX2FwcGx5UmVtb3RlSW5zZXJ0KG9wKTtcbiAgICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseUluc2VydEFjayhvcCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseUluc2VydFVuZG9SZWRvKG9wKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlc3VsdC5tb2RpZmllZCAhPT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2RldGFjaENoaWxkKGNoaWxkKSB7XG4gICAgaWYgKGNoaWxkKSB7XG4gICAgICBjb25zdCBwYXJlbnRLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICAgIGNvbnN0IHJldmVyc2UgPSBjaGlsZC5fdG9PcHMobm4odGhpcy5faWQpLCBwYXJlbnRLZXksIHRoaXMuX3Bvb2wpO1xuICAgICAgY29uc3QgaW5kZXhUb0RlbGV0ZSA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgaWYgKGluZGV4VG9EZWxldGUgPT09IC0xKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXhUb0RlbGV0ZSwgMSk7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIGNoaWxkLl9kZXRhY2goKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtkZWxldGVEZWx0YShpbmRleFRvRGVsZXRlKV0pLFxuICAgICAgICByZXZlcnNlXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldENoaWxkS2V5UmVtb3RlKG5ld0tleSwgY2hpbGQpIHtcbiAgICBpZiAodGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5oYXMoY2hpbGQpKSB7XG4gICAgICB0aGlzLl9pbXBsaWNpdGx5RGVsZXRlZEl0ZW1zLmRlbGV0ZShjaGlsZCk7XG4gICAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBuZXdLZXkpO1xuICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2luc2VydERlbHRhKG5ld0luZGV4LCBjaGlsZCldKSxcbiAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzS2V5ID0gY2hpbGQuX3BhcmVudEtleTtcbiAgICBpZiAobmV3S2V5ID09PSBwcmV2aW91c0tleSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA9PT0gLTEpIHtcbiAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAobmV3SW5kZXggPT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFttb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgbmV3SW5kZXgsIGNoaWxkKV0pLFxuICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLl9zZXRQYXJlbnRMaW5rKFxuICAgICAgICB0aGlzLFxuICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAobmV3SW5kZXggPT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFttb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgbmV3SW5kZXgsIGNoaWxkKV0pLFxuICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlTZXRDaGlsZEtleUFjayhuZXdLZXksIGNoaWxkKSB7XG4gICAgY29uc3QgcHJldmlvdXNLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICBpZiAodGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5oYXMoY2hpbGQpKSB7XG4gICAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5kZWxldGUoY2hpbGQpO1xuICAgICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ICE9PSAtMSkge1xuICAgICAgICB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uX3NldFBhcmVudExpbmsoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAobmV3S2V5ID09PSBwcmV2aW91c0tleSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLl9zZXRQYXJlbnRMaW5rKFxuICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgbWFrZVBvc2l0aW9uKG5ld0tleSwgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXggKyAxXT8uX3BhcmVudFBvcylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAocHJldmlvdXNJbmRleCA9PT0gbmV3SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgbW92ZURlbHRhKHByZXZpb3VzSW5kZXgsIG5ld0luZGV4LCBjaGlsZClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldENoaWxkS2V5VW5kb1JlZG8obmV3S2V5LCBjaGlsZCkge1xuICAgIGNvbnN0IHByZXZpb3VzS2V5ID0gbm4oY2hpbGQuX3BhcmVudEtleSk7XG4gICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKG5ld0tleSk7XG4gICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ICE9PSAtMSkge1xuICAgICAgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLl9zZXRQYXJlbnRMaW5rKFxuICAgICAgICB0aGlzLFxuICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgKTtcbiAgICB9XG4gICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgIGlmIChwcmV2aW91c0luZGV4ID09PSBuZXdJbmRleCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW21vdmVEZWx0YShwcmV2aW91c0luZGV4LCBuZXdJbmRleCwgY2hpbGQpXSksXG4gICAgICByZXZlcnNlOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAxIC8qIFNFVF9QQVJFTlRfS0VZICovLFxuICAgICAgICAgIGlkOiBubihjaGlsZC5faWQpLFxuICAgICAgICAgIHBhcmVudEtleTogcHJldmlvdXNLZXlcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2V0Q2hpbGRLZXkobmV3S2V5LCBjaGlsZCwgc291cmNlKSB7XG4gICAgaWYgKHNvdXJjZSA9PT0gMSAvKiBSRU1PVEUgKi8pIHtcbiAgICAgIHJldHVybiB0aGlzLl9hcHBseVNldENoaWxkS2V5UmVtb3RlKG5ld0tleSwgY2hpbGQpO1xuICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5U2V0Q2hpbGRLZXlBY2sobmV3S2V5LCBjaGlsZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLl9hcHBseVNldENoaWxkS2V5VW5kb1JlZG8obmV3S2V5LCBjaGlsZCk7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5KG9wLCBpc0xvY2FsKSB7XG4gICAgcmV0dXJuIHN1cGVyLl9hcHBseShvcCwgaXNMb2NhbCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2VyaWFsaXplKCkge1xuICAgIGlmICh0aGlzLnBhcmVudC50eXBlICE9PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIExpdmVMaXN0IGlmIHBhcmVudCBpcyBtaXNzaW5nXCIpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogMSAvKiBMSVNUICovLFxuICAgICAgcGFyZW50SWQ6IG5uKHRoaXMucGFyZW50Lm5vZGUuX2lkLCBcIlBhcmVudCBub2RlIGV4cGVjdGVkIHRvIGhhdmUgSURcIiksXG4gICAgICBwYXJlbnRLZXk6IHRoaXMucGFyZW50LmtleVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cy5cbiAgICovXG4gIGdldCBsZW5ndGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmxlbmd0aDtcbiAgfVxuICAvKipcbiAgICogQWRkcyBvbmUgZWxlbWVudCB0byB0aGUgZW5kIG9mIHRoZSBMaXZlTGlzdC5cbiAgICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gYWRkIHRvIHRoZSBlbmQgb2YgdGhlIExpdmVMaXN0LlxuICAgKi9cbiAgcHVzaChlbGVtZW50KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICByZXR1cm4gdGhpcy5pbnNlcnQoZWxlbWVudCwgdGhpcy5sZW5ndGgpO1xuICB9XG4gIC8qKlxuICAgKiBJbnNlcnRzIG9uZSBlbGVtZW50IGF0IGEgc3BlY2lmaWVkIGluZGV4LlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byBpbnNlcnQuXG4gICAqIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggYXQgd2hpY2ggeW91IHdhbnQgdG8gaW5zZXJ0IHRoZSBlbGVtZW50LlxuICAgKi9cbiAgaW5zZXJ0KGVsZW1lbnQsIGluZGV4KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDYW5ub3QgaW5zZXJ0IGxpc3QgaXRlbSBhdCBpbmRleCBcIlx1MDAxZCR7aW5kZXh9XCIuIGluZGV4IHNob3VsZCBiZSBiZXR3ZWVuIDAgYW5kICR7dGhpcy5faXRlbXMubGVuZ3RofWBcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IGJlZm9yZTIgPSB0aGlzLl9pdGVtc1tpbmRleCAtIDFdID8gdGhpcy5faXRlbXNbaW5kZXggLSAxXS5fcGFyZW50UG9zIDogdm9pZCAwO1xuICAgIGNvbnN0IGFmdGVyMiA9IHRoaXMuX2l0ZW1zW2luZGV4XSA/IHRoaXMuX2l0ZW1zW2luZGV4XS5fcGFyZW50UG9zIDogdm9pZCAwO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gbWFrZVBvc2l0aW9uKGJlZm9yZTIsIGFmdGVyMik7XG4gICAgY29uc3QgdmFsdWUgPSBsc29uVG9MaXZlTm9kZShlbGVtZW50KTtcbiAgICB2YWx1ZS5fc2V0UGFyZW50TGluayh0aGlzLCBwb3NpdGlvbik7XG4gICAgdGhpcy5faW5zZXJ0QW5kU29ydCh2YWx1ZSk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgJiYgdGhpcy5faWQpIHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5fcG9vbC5nZW5lcmF0ZUlkKCk7XG4gICAgICB2YWx1ZS5fYXR0YWNoKGlkLCB0aGlzLl9wb29sKTtcbiAgICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2goXG4gICAgICAgIHZhbHVlLl90b09wcyh0aGlzLl9pZCwgcG9zaXRpb24sIHRoaXMuX3Bvb2wpLFxuICAgICAgICBbeyB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovLCBpZCB9XSxcbiAgICAgICAgLyogQF9fUFVSRV9fICovIG5ldyBNYXAoW1xuICAgICAgICAgIFt0aGlzLl9pZCwgbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEoaW5kZXgsIHZhbHVlKV0pXVxuICAgICAgICBdKVxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIE1vdmUgb25lIGVsZW1lbnQgZnJvbSBvbmUgaW5kZXggdG8gYW5vdGhlci5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgZWxlbWVudCB0byBtb3ZlXG4gICAqIEBwYXJhbSB0YXJnZXRJbmRleCBUaGUgaW5kZXggd2hlcmUgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIGFmdGVyIG1vdmluZy5cbiAgICovXG4gIG1vdmUoaW5kZXgsIHRhcmdldEluZGV4KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAodGFyZ2V0SW5kZXggPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0YXJnZXRJbmRleCBjYW5ub3QgYmUgbGVzcyB0aGFuIDBcIik7XG4gICAgfVxuICAgIGlmICh0YXJnZXRJbmRleCA+PSB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJ0YXJnZXRJbmRleCBjYW5ub3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0aGFuIHRoZSBsaXN0IGxlbmd0aFwiXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbmRleCBjYW5ub3QgYmUgbGVzcyB0aGFuIDBcIik7XG4gICAgfVxuICAgIGlmIChpbmRleCA+PSB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImluZGV4IGNhbm5vdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRoYW4gdGhlIGxpc3QgbGVuZ3RoXCIpO1xuICAgIH1cbiAgICBsZXQgYmVmb3JlUG9zaXRpb24gPSBudWxsO1xuICAgIGxldCBhZnRlclBvc2l0aW9uID0gbnVsbDtcbiAgICBpZiAoaW5kZXggPCB0YXJnZXRJbmRleCkge1xuICAgICAgYWZ0ZXJQb3NpdGlvbiA9IHRhcmdldEluZGV4ID09PSB0aGlzLl9pdGVtcy5sZW5ndGggLSAxID8gdm9pZCAwIDogdGhpcy5faXRlbXNbdGFyZ2V0SW5kZXggKyAxXS5fcGFyZW50UG9zO1xuICAgICAgYmVmb3JlUG9zaXRpb24gPSB0aGlzLl9pdGVtc1t0YXJnZXRJbmRleF0uX3BhcmVudFBvcztcbiAgICB9IGVsc2Uge1xuICAgICAgYWZ0ZXJQb3NpdGlvbiA9IHRoaXMuX2l0ZW1zW3RhcmdldEluZGV4XS5fcGFyZW50UG9zO1xuICAgICAgYmVmb3JlUG9zaXRpb24gPSB0YXJnZXRJbmRleCA9PT0gMCA/IHZvaWQgMCA6IHRoaXMuX2l0ZW1zW3RhcmdldEluZGV4IC0gMV0uX3BhcmVudFBvcztcbiAgICB9XG4gICAgY29uc3QgcG9zaXRpb24gPSBtYWtlUG9zaXRpb24oYmVmb3JlUG9zaXRpb24sIGFmdGVyUG9zaXRpb24pO1xuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07XG4gICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IGl0ZW0uX2dldFBhcmVudEtleU9yVGhyb3coKTtcbiAgICBpdGVtLl9zZXRQYXJlbnRMaW5rKHRoaXMsIHBvc2l0aW9uKTtcbiAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiB0aGlzLl9pZCkge1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcChbXG4gICAgICAgIFt0aGlzLl9pZCwgbWFrZVVwZGF0ZSh0aGlzLCBbbW92ZURlbHRhKGluZGV4LCB0YXJnZXRJbmRleCwgaXRlbSldKV1cbiAgICAgIF0pO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IDEgLyogU0VUX1BBUkVOVF9LRVkgKi8sXG4gICAgICAgICAgICBpZDogbm4oaXRlbS5faWQpLFxuICAgICAgICAgICAgb3BJZDogdGhpcy5fcG9vbC5nZW5lcmF0ZU9wSWQoKSxcbiAgICAgICAgICAgIHBhcmVudEtleTogcG9zaXRpb25cbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAxIC8qIFNFVF9QQVJFTlRfS0VZICovLFxuICAgICAgICAgICAgaWQ6IG5uKGl0ZW0uX2lkKSxcbiAgICAgICAgICAgIHBhcmVudEtleTogcHJldmlvdXNQb3NpdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgc3RvcmFnZVVwZGF0ZXNcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBEZWxldGVzIGFuIGVsZW1lbnQgYXQgdGhlIHNwZWNpZmllZCBpbmRleFxuICAgKiBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHRvIGRlbGV0ZVxuICAgKi9cbiAgZGVsZXRlKGluZGV4KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ2Fubm90IGRlbGV0ZSBsaXN0IGl0ZW0gYXQgaW5kZXggXCIke2luZGV4fVwiLiBpbmRleCBzaG91bGQgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMuX2l0ZW1zLmxlbmd0aCAtIDF9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuX2l0ZW1zW2luZGV4XTtcbiAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIGlmICh0aGlzLl9wb29sKSB7XG4gICAgICBjb25zdCBjaGlsZFJlY29yZElkID0gaXRlbS5faWQ7XG4gICAgICBpZiAoY2hpbGRSZWNvcmRJZCkge1xuICAgICAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzLnNldChcbiAgICAgICAgICBubih0aGlzLl9pZCksXG4gICAgICAgICAgbWFrZVVwZGF0ZSh0aGlzLCBbZGVsZXRlRGVsdGEoaW5kZXgpXSlcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgICBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiBjaGlsZFJlY29yZElkLFxuICAgICAgICAgICAgICBvcElkOiB0aGlzLl9wb29sLmdlbmVyYXRlT3BJZCgpLFxuICAgICAgICAgICAgICB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBpdGVtLl90b09wcyhubih0aGlzLl9pZCksIGl0ZW0uX2dldFBhcmVudEtleU9yVGhyb3coKSksXG4gICAgICAgICAgc3RvcmFnZVVwZGF0ZXNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCkge1xuICAgICAgY29uc3Qgb3BzID0gW107XG4gICAgICBjb25zdCByZXZlcnNlT3BzID0gW107XG4gICAgICBjb25zdCB1cGRhdGVEZWx0YSA9IFtdO1xuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICAgIGl0ZW0uX2RldGFjaCgpO1xuICAgICAgICBjb25zdCBjaGlsZElkID0gaXRlbS5faWQ7XG4gICAgICAgIGlmIChjaGlsZElkKSB7XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLyxcbiAgICAgICAgICAgIGlkOiBjaGlsZElkLFxuICAgICAgICAgICAgb3BJZDogdGhpcy5fcG9vbC5nZW5lcmF0ZU9wSWQoKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldmVyc2VPcHMucHVzaChcbiAgICAgICAgICAgIC4uLml0ZW0uX3RvT3BzKG5uKHRoaXMuX2lkKSwgaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpKVxuICAgICAgICAgICk7XG4gICAgICAgICAgdXBkYXRlRGVsdGEucHVzaChkZWxldGVEZWx0YSgwKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgIHN0b3JhZ2VVcGRhdGVzLnNldChubih0aGlzLl9pZCksIG1ha2VVcGRhdGUodGhpcywgdXBkYXRlRGVsdGEpKTtcbiAgICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2gob3BzLCByZXZlcnNlT3BzLCBzdG9yYWdlVXBkYXRlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLl9pdGVtcykge1xuICAgICAgICBpdGVtLl9kZXRhY2goKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICB9XG4gIH1cbiAgc2V0KGluZGV4LCBpdGVtKSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ2Fubm90IHNldCBsaXN0IGl0ZW0gYXQgaW5kZXggXCJcdTAwMWQke2luZGV4fVwiLiBpbmRleCBzaG91bGQgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMuX2l0ZW1zLmxlbmd0aCAtIDF9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5faXRlbXNbaW5kZXhdO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gZXhpc3RpbmdJdGVtLl9nZXRQYXJlbnRLZXlPclRocm93KCk7XG4gICAgY29uc3QgZXhpc3RpbmdJZCA9IGV4aXN0aW5nSXRlbS5faWQ7XG4gICAgZXhpc3RpbmdJdGVtLl9kZXRhY2goKTtcbiAgICBjb25zdCB2YWx1ZSA9IGxzb25Ub0xpdmVOb2RlKGl0ZW0pO1xuICAgIHZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIHBvc2l0aW9uKTtcbiAgICB0aGlzLl9pdGVtc1tpbmRleF0gPSB2YWx1ZTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiB0aGlzLl9pZCkge1xuICAgICAgY29uc3QgaWQgPSB0aGlzLl9wb29sLmdlbmVyYXRlSWQoKTtcbiAgICAgIHZhbHVlLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXMuX2lkLCBtYWtlVXBkYXRlKHRoaXMsIFtzZXREZWx0YShpbmRleCwgdmFsdWUpXSkpO1xuICAgICAgY29uc3Qgb3BzID0gSEFDS19hZGRJbnRlbnRBbmREZWxldGVkSWRUb09wZXJhdGlvbihcbiAgICAgICAgdmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBwb3NpdGlvbiwgdGhpcy5fcG9vbCksXG4gICAgICAgIGV4aXN0aW5nSWRcbiAgICAgICk7XG4gICAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMuc2V0KHBvc2l0aW9uLCBubihvcHNbMF0ub3BJZCkpO1xuICAgICAgY29uc3QgcmV2ZXJzZU9wcyA9IEhBQ0tfYWRkSW50ZW50QW5kRGVsZXRlZElkVG9PcGVyYXRpb24oXG4gICAgICAgIGV4aXN0aW5nSXRlbS5fdG9PcHModGhpcy5faWQsIHBvc2l0aW9uLCB2b2lkIDApLFxuICAgICAgICBpZFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2gob3BzLCByZXZlcnNlT3BzLCBzdG9yYWdlVXBkYXRlcyk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIEFycmF5IG9mIGFsbCB0aGUgZWxlbWVudHMgaW4gdGhlIExpdmVMaXN0LlxuICAgKi9cbiAgdG9BcnJheSgpIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXMubWFwKFxuICAgICAgKGVudHJ5KSA9PiBsaXZlTm9kZVRvTHNvbihlbnRyeSlcbiAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eXG4gICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGSVhNRSEgVGhpcyBpc24ndCBzYWZlLlxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIFRlc3RzIHdoZXRoZXIgYWxsIGVsZW1lbnRzIHBhc3MgdGhlIHRlc3QgaW1wbGVtZW50ZWQgYnkgdGhlIHByb3ZpZGVkIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0gcHJlZGljYXRlIEZ1bmN0aW9uIHRvIHRlc3QgZm9yIGVhY2ggZWxlbWVudCwgdGFraW5nIHR3byBhcmd1bWVudHMgKHRoZSBlbGVtZW50IGFuZCBpdHMgaW5kZXgpLlxuICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBwcmVkaWNhdGUgZnVuY3Rpb24gcmV0dXJucyBhIHRydXRoeSB2YWx1ZSBmb3IgZXZlcnkgZWxlbWVudC4gT3RoZXJ3aXNlLCBmYWxzZS5cbiAgICovXG4gIGV2ZXJ5KHByZWRpY2F0ZSkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5ldmVyeShwcmVkaWNhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGVsZW1lbnRzIHRoYXQgcGFzcyB0aGUgdGVzdCBpbXBsZW1lbnRlZCBieSB0aGUgcHJvdmlkZWQgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUgRnVuY3Rpb24gdG8gdGVzdCBlYWNoIGVsZW1lbnQgb2YgdGhlIExpdmVMaXN0LiBSZXR1cm4gYSB2YWx1ZSB0aGF0IGNvZXJjZXMgdG8gdHJ1ZSB0byBrZWVwIHRoZSBlbGVtZW50LCBvciB0byBmYWxzZSBvdGhlcndpc2UuXG4gICAqIEByZXR1cm5zIEFuIGFycmF5IHdpdGggdGhlIGVsZW1lbnRzIHRoYXQgcGFzcyB0aGUgdGVzdC5cbiAgICovXG4gIGZpbHRlcihwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuZmlsdGVyKHByZWRpY2F0ZSk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBzYXRpc2ZpZXMgdGhlIHByb3ZpZGVkIHRlc3RpbmcgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUgRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIHZhbHVlLlxuICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIExpdmVMaXN0IHRoYXQgc2F0aXNmaWVzIHRoZSBwcm92aWRlZCB0ZXN0aW5nIGZ1bmN0aW9uLiBPdGhlcndpc2UsIHVuZGVmaW5lZCBpcyByZXR1cm5lZC5cbiAgICovXG4gIGZpbmQocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmZpbmQocHJlZGljYXRlKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIExpdmVMaXN0IHRoYXQgc2F0aXNmaWVzIHRoZSBwcm92aWRlZCB0ZXN0aW5nIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0gcHJlZGljYXRlIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgb24gZWFjaCB2YWx1ZSB1bnRpbCB0aGUgZnVuY3Rpb24gcmV0dXJucyB0cnVlLCBpbmRpY2F0aW5nIHRoYXQgdGhlIHNhdGlzZnlpbmcgZWxlbWVudCB3YXMgZm91bmQuXG4gICAqIEByZXR1cm5zIFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgTGl2ZUxpc3QgdGhhdCBwYXNzZXMgdGhlIHRlc3QuIE90aGVyd2lzZSwgLTEuXG4gICAqL1xuICBmaW5kSW5kZXgocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmZpbmRJbmRleChwcmVkaWNhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBFeGVjdXRlcyBhIHByb3ZpZGVkIGZ1bmN0aW9uIG9uY2UgZm9yIGVhY2ggZWxlbWVudC5cbiAgICogQHBhcmFtIGNhbGxiYWNrZm4gRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIGVsZW1lbnQuXG4gICAqL1xuICBmb3JFYWNoKGNhbGxiYWNrZm4pIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuZm9yRWFjaChjYWxsYmFja2ZuKTtcbiAgfVxuICAvKipcbiAgICogR2V0IHRoZSBlbGVtZW50IGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguXG4gICAqIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb24gdGhlIGVsZW1lbnQgdG8gZ2V0LlxuICAgKiBAcmV0dXJucyBUaGUgZWxlbWVudCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIHVuZGVmaW5lZC5cbiAgICovXG4gIGdldChpbmRleCkge1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgICByZXR1cm4gbGl2ZU5vZGVUb0xzb24odGhpcy5faXRlbXNbaW5kZXhdKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZmlyc3QgaW5kZXggYXQgd2hpY2ggYSBnaXZlbiBlbGVtZW50IGNhbiBiZSBmb3VuZCBpbiB0aGUgTGl2ZUxpc3QsIG9yIC0xIGlmIGl0IGlzIG5vdCBwcmVzZW50LlxuICAgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIGxvY2F0ZS5cbiAgICogQHBhcmFtIGZyb21JbmRleCBUaGUgaW5kZXggdG8gc3RhcnQgdGhlIHNlYXJjaCBhdC5cbiAgICogQHJldHVybnMgVGhlIGZpcnN0IGluZGV4IG9mIHRoZSBlbGVtZW50IGluIHRoZSBMaXZlTGlzdDsgLTEgaWYgbm90IGZvdW5kLlxuICAgKi9cbiAgaW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuaW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsYXN0IGluZGV4IGF0IHdoaWNoIGEgZ2l2ZW4gZWxlbWVudCBjYW4gYmUgZm91bmQgaW4gdGhlIExpdmVMaXN0LCBvciAtMSBpZiBpdCBpcyBub3QgcHJlc2VudC4gVGhlIExpdmVMc2l0IGlzIHNlYXJjaGVkIGJhY2t3YXJkcywgc3RhcnRpbmcgYXQgZnJvbUluZGV4LlxuICAgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIGxvY2F0ZS5cbiAgICogQHBhcmFtIGZyb21JbmRleCBUaGUgaW5kZXggYXQgd2hpY2ggdG8gc3RhcnQgc2VhcmNoaW5nIGJhY2t3YXJkcy5cbiAgICogQHJldHVybnNcbiAgICovXG4gIGxhc3RJbmRleE9mKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5sYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IHBvcHVsYXRlZCB3aXRoIHRoZSByZXN1bHRzIG9mIGNhbGxpbmcgYSBwcm92aWRlZCBmdW5jdGlvbiBvbiBldmVyeSBlbGVtZW50LlxuICAgKiBAcGFyYW0gY2FsbGJhY2sgRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZm9yIGV2ZXJ5IGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIEFuIGFycmF5IHdpdGggZWFjaCBlbGVtZW50IGJlaW5nIHRoZSByZXN1bHQgb2YgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKi9cbiAgbWFwKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zLm1hcChcbiAgICAgIChlbnRyeSwgaSkgPT4gY2FsbGJhY2soXG4gICAgICAgIGxpdmVOb2RlVG9Mc29uKGVudHJ5KSxcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBGSVhNRSEgVGhpcyBpc24ndCBzYWZlLlxuICAgICAgICBpXG4gICAgICApXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogVGVzdHMgd2hldGhlciBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgTGl2ZUxpc3QgcGFzc2VzIHRoZSB0ZXN0IGltcGxlbWVudGVkIGJ5IHRoZSBwcm92aWRlZCBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHByZWRpY2F0ZSBGdW5jdGlvbiB0byB0ZXN0IGZvciBlYWNoIGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHJldHVybnMgYSB0cnV0aHkgdmFsdWUgZm9yIGF0IGxlYXN0IG9uZSBlbGVtZW50LiBPdGhlcndpc2UsIGZhbHNlLlxuICAgKi9cbiAgc29tZShwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuc29tZShwcmVkaWNhdGUpO1xuICB9XG4gIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgIHJldHVybiBuZXcgTGl2ZUxpc3RJdGVyYXRvcih0aGlzLl9pdGVtcyk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfY3JlYXRlQXR0YWNoSXRlbUFuZFNvcnQob3AsIGtleSkge1xuICAgIGNvbnN0IG5ld0l0ZW0gPSBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCk7XG4gICAgbmV3SXRlbS5fYXR0YWNoKG9wLmlkLCBubih0aGlzLl9wb29sKSk7XG4gICAgbmV3SXRlbS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgIHRoaXMuX2luc2VydEFuZFNvcnQobmV3SXRlbSk7XG4gICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICByZXR1cm4geyBuZXdJdGVtLCBuZXdJbmRleCB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3NoaWZ0SXRlbVBvc2l0aW9uKGluZGV4LCBrZXkpIHtcbiAgICBjb25zdCBzaGlmdGVkUG9zaXRpb24gPSBtYWtlUG9zaXRpb24oXG4gICAgICBrZXksXG4gICAgICB0aGlzLl9pdGVtcy5sZW5ndGggPiBpbmRleCArIDEgPyB0aGlzLl9pdGVtc1tpbmRleCArIDFdPy5fcGFyZW50UG9zIDogdm9pZCAwXG4gICAgKTtcbiAgICB0aGlzLl9pdGVtc1tpbmRleF0uX3NldFBhcmVudExpbmsodGhpcywgc2hpZnRlZFBvc2l0aW9uKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b1RyZWVOb2RlKGtleSkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkxpdmVMaXN0XCIsXG4gICAgICBpZDogdGhpcy5faWQgPz8gbmFub2lkKCksXG4gICAgICBrZXksXG4gICAgICBwYXlsb2FkOiB0aGlzLl9pdGVtcy5tYXAoXG4gICAgICAgIChpdGVtLCBpbmRleCkgPT4gaXRlbS50b1RyZWVOb2RlKGluZGV4LnRvU3RyaW5nKCkpXG4gICAgICApXG4gICAgfTtcbiAgfVxuICB0b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gc3VwZXIudG9JbW11dGFibGUoKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9pdGVtcy5tYXAoKG5vZGUpID0+IG5vZGUudG9JbW11dGFibGUoKSk7XG4gICAgcmV0dXJuIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIiA/IHJlc3VsdCA6IE9iamVjdC5mcmVlemUocmVzdWx0KTtcbiAgfVxuICBjbG9uZSgpIHtcbiAgICByZXR1cm4gbmV3IF9MaXZlTGlzdCh0aGlzLl9pdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uY2xvbmUoKSkpO1xuICB9XG59O1xudmFyIExpdmVMaXN0SXRlcmF0b3IgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGl0ZW1zKSB7XG4gICAgdGhpcy5faW5uZXJJdGVyYXRvciA9IGl0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgfVxuICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBuZXh0KCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2lubmVySXRlcmF0b3IubmV4dCgpO1xuICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBsaXZlTm9kZVRvTHNvbihyZXN1bHQudmFsdWUpO1xuICAgIHJldHVybiB7IHZhbHVlIH07XG4gIH1cbn07XG5mdW5jdGlvbiBtYWtlVXBkYXRlKGxpdmVMaXN0LCBkZWx0YVVwZGF0ZXMpIHtcbiAgcmV0dXJuIHtcbiAgICBub2RlOiBsaXZlTGlzdCxcbiAgICB0eXBlOiBcIkxpdmVMaXN0XCIsXG4gICAgdXBkYXRlczogZGVsdGFVcGRhdGVzXG4gIH07XG59XG5mdW5jdGlvbiBzZXREZWx0YShpbmRleCwgaXRlbSkge1xuICByZXR1cm4ge1xuICAgIGluZGV4LFxuICAgIHR5cGU6IFwic2V0XCIsXG4gICAgaXRlbTogaXRlbSBpbnN0YW5jZW9mIExpdmVSZWdpc3RlciA/IGl0ZW0uZGF0YSA6IGl0ZW1cbiAgfTtcbn1cbmZ1bmN0aW9uIGRlbGV0ZURlbHRhKGluZGV4KSB7XG4gIHJldHVybiB7XG4gICAgaW5kZXgsXG4gICAgdHlwZTogXCJkZWxldGVcIlxuICB9O1xufVxuZnVuY3Rpb24gaW5zZXJ0RGVsdGEoaW5kZXgsIGl0ZW0pIHtcbiAgcmV0dXJuIHtcbiAgICBpbmRleCxcbiAgICB0eXBlOiBcImluc2VydFwiLFxuICAgIGl0ZW06IGl0ZW0gaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIgPyBpdGVtLmRhdGEgOiBpdGVtXG4gIH07XG59XG5mdW5jdGlvbiBtb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgaW5kZXgsIGl0ZW0pIHtcbiAgcmV0dXJuIHtcbiAgICBpbmRleCxcbiAgICB0eXBlOiBcIm1vdmVcIixcbiAgICBwcmV2aW91c0luZGV4LFxuICAgIGl0ZW06IGl0ZW0gaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIgPyBpdGVtLmRhdGEgOiBpdGVtXG4gIH07XG59XG5mdW5jdGlvbiBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKG9wcywgZGVsZXRlZElkKSB7XG4gIHJldHVybiBvcHMubWFwKChvcCwgaW5kZXgpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgIGNvbnN0IGZpcnN0T3AgPSBvcDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmZpcnN0T3AsXG4gICAgICAgIGludGVudDogXCJzZXRcIixcbiAgICAgICAgZGVsZXRlZElkXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gb3A7XG4gICAgfVxuICB9KTtcbn1cblxuLy8gc3JjL2xpYi9mcmVlemUudHNcbnZhciBmcmVlemUgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgPyAoXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICh4KSA9PiB4XG4pIDogT2JqZWN0LmZyZWV6ZTtcblxuLy8gc3JjL2NyZHRzL0xpdmVNYXAudHNcbnZhciBMaXZlTWFwID0gY2xhc3MgX0xpdmVNYXAgZXh0ZW5kcyBBYnN0cmFjdENyZHQge1xuICBjb25zdHJ1Y3RvcihlbnRyaWVzMikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy51bmFja25vd2xlZGdlZFNldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgaWYgKGVudHJpZXMyKSB7XG4gICAgICBjb25zdCBtYXBwZWRFbnRyaWVzID0gW107XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzMikge1xuICAgICAgICBjb25zdCBub2RlID0gbHNvblRvTGl2ZU5vZGUodmFsdWUpO1xuICAgICAgICBub2RlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICAgIG1hcHBlZEVudHJpZXMucHVzaChba2V5LCBub2RlXSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9tYXAgPSBuZXcgTWFwKG1hcHBlZEVudHJpZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9tYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfdG9PcHMocGFyZW50SWQsIHBhcmVudEtleSwgcG9vbCkge1xuICAgIGlmICh0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIGl0ZW0gaXMgbm90IGF0dGFjaGVkXCIpO1xuICAgIH1cbiAgICBjb25zdCBvcHMgPSBbXTtcbiAgICBjb25zdCBvcCA9IHtcbiAgICAgIGlkOiB0aGlzLl9pZCxcbiAgICAgIG9wSWQ6IHBvb2w/LmdlbmVyYXRlT3BJZCgpLFxuICAgICAgdHlwZTogNyAvKiBDUkVBVEVfTUFQICovLFxuICAgICAgcGFyZW50SWQsXG4gICAgICBwYXJlbnRLZXlcbiAgICB9O1xuICAgIG9wcy5wdXNoKG9wKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIG9wcy5wdXNoKC4uLnZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5LCBwb29sKSk7XG4gICAgfVxuICAgIHJldHVybiBvcHM7XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIF9kZXNlcmlhbGl6ZShbaWQsIF9pdGVtXSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCkge1xuICAgIGNvbnN0IG1hcCA9IG5ldyBfTGl2ZU1hcCgpO1xuICAgIG1hcC5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICBjb25zdCBjaGlsZHJlbiA9IHBhcmVudFRvQ2hpbGRyZW4uZ2V0KGlkKTtcbiAgICBpZiAoY2hpbGRyZW4gPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG1hcDtcbiAgICB9XG4gICAgZm9yIChjb25zdCBbaWQyLCBjcmR0XSBvZiBjaGlsZHJlbikge1xuICAgICAgY29uc3QgY2hpbGQgPSBkZXNlcmlhbGl6ZShbaWQyLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgICBjaGlsZC5fc2V0UGFyZW50TGluayhtYXAsIGNyZHQucGFyZW50S2V5KTtcbiAgICAgIG1hcC5fbWFwLnNldChjcmR0LnBhcmVudEtleSwgY2hpbGQpO1xuICAgICAgbWFwLmludmFsaWRhdGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIG1hcDtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfYXR0YWNoKGlkLCBwb29sKSB7XG4gICAgc3VwZXIuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgZm9yIChjb25zdCBbX2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9hdHRhY2gocG9vbC5nZW5lcmF0ZUlkKCksIHBvb2wpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfYXR0YWNoQ2hpbGQob3AsIHNvdXJjZSkge1xuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGF0dGFjaCBjaGlsZCBpZiBtYW5hZ2VkIHBvb2wgaXMgbm90IHByZXNlbnRcIik7XG4gICAgfVxuICAgIGNvbnN0IHsgaWQsIHBhcmVudEtleSwgb3BJZCB9ID0gb3A7XG4gICAgY29uc3Qga2V5ID0gcGFyZW50S2V5O1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGlmICh0aGlzLl9wb29sLmdldE5vZGUoaWQpICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgY29uc3QgbGFzdFVwZGF0ZU9wSWQgPSB0aGlzLnVuYWNrbm93bGVkZ2VkU2V0LmdldChrZXkpO1xuICAgICAgaWYgKGxhc3RVcGRhdGVPcElkID09PSBvcElkKSB7XG4gICAgICAgIHRoaXMudW5hY2tub3dsZWRnZWRTZXQuZGVsZXRlKGtleSk7XG4gICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgfSBlbHNlIGlmIChsYXN0VXBkYXRlT3BJZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAxIC8qIFJFTU9URSAqLykge1xuICAgICAgdGhpcy51bmFja25vd2xlZGdlZFNldC5kZWxldGUoa2V5KTtcbiAgICB9XG4gICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBsZXQgcmV2ZXJzZTtcbiAgICBpZiAocHJldmlvdXNWYWx1ZSkge1xuICAgICAgY29uc3QgdGhpc0lkID0gbm4odGhpcy5faWQpO1xuICAgICAgcmV2ZXJzZSA9IHByZXZpb3VzVmFsdWUuX3RvT3BzKHRoaXNJZCwga2V5KTtcbiAgICAgIHByZXZpb3VzVmFsdWUuX2RldGFjaCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZlcnNlID0gW3sgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLywgaWQgfV07XG4gICAgfVxuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY2hpbGQuX2F0dGFjaChpZCwgdGhpcy5fcG9vbCk7XG4gICAgdGhpcy5fbWFwLnNldChrZXksIGNoaWxkKTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICAgIHVwZGF0ZXM6IHsgW2tleV06IHsgdHlwZTogXCJ1cGRhdGVcIiB9IH1cbiAgICAgIH0sXG4gICAgICByZXZlcnNlXG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfZGV0YWNoKCkge1xuICAgIHN1cGVyLl9kZXRhY2goKTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5fbWFwLnZhbHVlcygpKSB7XG4gICAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgX2RldGFjaENoaWxkKGNoaWxkKSB7XG4gICAgY29uc3QgaWQgPSBubih0aGlzLl9pZCk7XG4gICAgY29uc3QgcGFyZW50S2V5ID0gbm4oY2hpbGQuX3BhcmVudEtleSk7XG4gICAgY29uc3QgcmV2ZXJzZSA9IGNoaWxkLl90b09wcyhpZCwgcGFyZW50S2V5LCB0aGlzLl9wb29sKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmICh2YWx1ZSA9PT0gY2hpbGQpIHtcbiAgICAgICAgdGhpcy5fbWFwLmRlbGV0ZShrZXkpO1xuICAgICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2hpbGQuX2RldGFjaCgpO1xuICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGUgPSB7XG4gICAgICBub2RlOiB0aGlzLFxuICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICB1cGRhdGVzOiB7IFtwYXJlbnRLZXldOiB7IHR5cGU6IFwiZGVsZXRlXCIgfSB9XG4gICAgfTtcbiAgICByZXR1cm4geyBtb2RpZmllZDogc3RvcmFnZVVwZGF0ZSwgcmV2ZXJzZSB9O1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9zZXJpYWxpemUoKSB7XG4gICAgaWYgKHRoaXMucGFyZW50LnR5cGUgIT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXJpYWxpemUgTGl2ZU1hcCBpZiBwYXJlbnQgaXMgbWlzc2luZ1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IDIgLyogTUFQICovLFxuICAgICAgcGFyZW50SWQ6IG5uKHRoaXMucGFyZW50Lm5vZGUuX2lkLCBcIlBhcmVudCBub2RlIGV4cGVjdGVkIHRvIGhhdmUgSURcIiksXG4gICAgICBwYXJlbnRLZXk6IHRoaXMucGFyZW50LmtleVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzcGVjaWZpZWQgZWxlbWVudCBmcm9tIHRoZSBMaXZlTWFwLlxuICAgKiBAcGFyYW0ga2V5IFRoZSBrZXkgb2YgdGhlIGVsZW1lbnQgdG8gcmV0dXJuLlxuICAgKiBAcmV0dXJucyBUaGUgZWxlbWVudCBhc3NvY2lhdGVkIHdpdGggdGhlIHNwZWNpZmllZCBrZXksIG9yIHVuZGVmaW5lZCBpZiB0aGUga2V5IGNhbid0IGJlIGZvdW5kIGluIHRoZSBMaXZlTWFwLlxuICAgKi9cbiAgZ2V0KGtleSkge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgICByZXR1cm4gbGl2ZU5vZGVUb0xzb24odmFsdWUpO1xuICB9XG4gIC8qKlxuICAgKiBBZGRzIG9yIHVwZGF0ZXMgYW4gZWxlbWVudCB3aXRoIGEgc3BlY2lmaWVkIGtleSBhbmQgYSB2YWx1ZS5cbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBlbGVtZW50IHRvIGFkZC4gU2hvdWxkIGJlIGEgc3RyaW5nLlxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBlbGVtZW50IHRvIGFkZC4gU2hvdWxkIGJlIHNlcmlhbGl6YWJsZSB0byBKU09OLlxuICAgKi9cbiAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGlmIChvbGRWYWx1ZSkge1xuICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgIH1cbiAgICBjb25zdCBpdGVtID0gbHNvblRvTGl2ZU5vZGUodmFsdWUpO1xuICAgIGl0ZW0uX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICB0aGlzLl9tYXAuc2V0KGtleSwgaXRlbSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgJiYgdGhpcy5faWQpIHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5fcG9vbC5nZW5lcmF0ZUlkKCk7XG4gICAgICBpdGVtLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXMuX2lkLCB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU1hcFwiLFxuICAgICAgICB1cGRhdGVzOiB7IFtrZXldOiB7IHR5cGU6IFwidXBkYXRlXCIgfSB9XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG9wcyA9IGl0ZW0uX3RvT3BzKHRoaXMuX2lkLCBrZXksIHRoaXMuX3Bvb2wpO1xuICAgICAgdGhpcy51bmFja25vd2xlZGdlZFNldC5zZXQoa2V5LCBubihvcHNbMF0ub3BJZCkpO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgaXRlbS5fdG9PcHModGhpcy5faWQsIGtleSwgdGhpcy5fcG9vbCksXG4gICAgICAgIG9sZFZhbHVlID8gb2xkVmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBrZXkpIDogW3sgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLywgaWQgfV0sXG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzXG4gICAgICApO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBMaXZlTWFwLlxuICAgKi9cbiAgZ2V0IHNpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcC5zaXplO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgYW4gZWxlbWVudCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IGV4aXN0cyBvciBub3QuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgZWxlbWVudCB0byB0ZXN0IGZvciBwcmVzZW5jZS5cbiAgICovXG4gIGhhcyhrZXkpIHtcbiAgICByZXR1cm4gdGhpcy5fbWFwLmhhcyhrZXkpO1xuICB9XG4gIC8qKlxuICAgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBieSBrZXkuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgZWxlbWVudCB0byByZW1vdmUuXG4gICAqIEByZXR1cm5zIHRydWUgaWYgYW4gZWxlbWVudCBleGlzdGVkIGFuZCBoYXMgYmVlbiByZW1vdmVkLCBvciBmYWxzZSBpZiB0aGUgZWxlbWVudCBkb2VzIG5vdCBleGlzdC5cbiAgICovXG4gIGRlbGV0ZShrZXkpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgaWYgKGl0ZW0gPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgJiYgaXRlbS5faWQpIHtcbiAgICAgIGNvbnN0IHRoaXNJZCA9IG5uKHRoaXMuX2lkKTtcbiAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgIHN0b3JhZ2VVcGRhdGVzLnNldCh0aGlzSWQsIHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICAgIHVwZGF0ZXM6IHsgW2tleV06IHsgdHlwZTogXCJkZWxldGVcIiB9IH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sXG4gICAgICAgICAgICBpZDogaXRlbS5faWQsXG4gICAgICAgICAgICBvcElkOiB0aGlzLl9wb29sLmdlbmVyYXRlT3BJZCgpXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBpdGVtLl90b09wcyh0aGlzSWQsIGtleSksXG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBJdGVyYXRvciBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgW2tleSwgdmFsdWVdIHBhaXJzIGZvciBlYWNoIGVsZW1lbnQuXG4gICAqL1xuICBlbnRyaWVzKCkge1xuICAgIGNvbnN0IGlubmVySXRlcmF0b3IgPSB0aGlzLl9tYXAuZW50cmllcygpO1xuICAgIHJldHVybiB7XG4gICAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgICAgbmV4dCgpIHtcbiAgICAgICAgY29uc3QgaXRlcmF0b3JWYWx1ZSA9IGlubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICBpZiAoaXRlcmF0b3JWYWx1ZS5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlbnRyeSA9IGl0ZXJhdG9yVmFsdWUudmFsdWU7XG4gICAgICAgIGNvbnN0IGtleSA9IGVudHJ5WzBdO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGxpdmVOb2RlVG9Mc29uKGl0ZXJhdG9yVmFsdWUudmFsdWVbMV0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBba2V5LCB2YWx1ZV1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBTYW1lIGZ1bmN0aW9uIG9iamVjdCBhcyB0aGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgZW50cmllcyBtZXRob2QuXG4gICAqL1xuICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICByZXR1cm4gdGhpcy5lbnRyaWVzKCk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBuZXcgSXRlcmF0b3Igb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIGtleXMgZm9yIGVhY2ggZWxlbWVudC5cbiAgICovXG4gIGtleXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcC5rZXlzKCk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBuZXcgSXRlcmF0b3Igb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIHZhbHVlcyBmb3IgZWFjaCBlbGVtZW50LlxuICAgKi9cbiAgdmFsdWVzKCkge1xuICAgIGNvbnN0IGlubmVySXRlcmF0b3IgPSB0aGlzLl9tYXAudmFsdWVzKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBuZXh0KCkge1xuICAgICAgICBjb25zdCBpdGVyYXRvclZhbHVlID0gaW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIGlmIChpdGVyYXRvclZhbHVlLmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbHVlID0gbGl2ZU5vZGVUb0xzb24oaXRlcmF0b3JWYWx1ZS52YWx1ZSk7XG4gICAgICAgIHJldHVybiB7IHZhbHVlIH07XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogRXhlY3V0ZXMgYSBwcm92aWRlZCBmdW5jdGlvbiBvbmNlIHBlciBlYWNoIGtleS92YWx1ZSBwYWlyIGluIHRoZSBNYXAgb2JqZWN0LCBpbiBpbnNlcnRpb24gb3JkZXIuXG4gICAqIEBwYXJhbSBjYWxsYmFjayBGdW5jdGlvbiB0byBleGVjdXRlIGZvciBlYWNoIGVudHJ5IGluIHRoZSBtYXAuXG4gICAqL1xuICBmb3JFYWNoKGNhbGxiYWNrKSB7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzKSB7XG4gICAgICBjYWxsYmFjayhlbnRyeVsxXSwgZW50cnlbMF0sIHRoaXMpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b1RyZWVOb2RlKGtleSkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkxpdmVNYXBcIixcbiAgICAgIGlkOiB0aGlzLl9pZCA/PyBuYW5vaWQoKSxcbiAgICAgIGtleSxcbiAgICAgIHBheWxvYWQ6IEFycmF5LmZyb20odGhpcy5fbWFwLmVudHJpZXMoKSkubWFwKFxuICAgICAgICAoW2tleTIsIHZhbF0pID0+IHZhbC50b1RyZWVOb2RlKGtleTIpXG4gICAgICApXG4gICAgfTtcbiAgfVxuICB0b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gc3VwZXIudG9JbW11dGFibGUoKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgcmVzdWx0LnNldChrZXksIHZhbHVlLnRvSW1tdXRhYmxlKCkpO1xuICAgIH1cbiAgICByZXR1cm4gZnJlZXplKHJlc3VsdCk7XG4gIH1cbiAgY2xvbmUoKSB7XG4gICAgcmV0dXJuIG5ldyBfTGl2ZU1hcChcbiAgICAgIEFycmF5LmZyb20odGhpcy5fbWFwKS5tYXAoKFtrZXksIG5vZGVdKSA9PiBba2V5LCBub2RlLmNsb25lKCldKVxuICAgICk7XG4gIH1cbn07XG5cbi8vIHNyYy9jcmR0cy9MaXZlT2JqZWN0LnRzXG52YXIgTGl2ZU9iamVjdCA9IGNsYXNzIF9MaXZlT2JqZWN0IGV4dGVuZHMgQWJzdHJhY3RDcmR0IHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2J1aWxkUm9vdEFuZFBhcmVudFRvQ2hpbGRyZW4oaXRlbXMpIHtcbiAgICBjb25zdCBwYXJlbnRUb0NoaWxkcmVuID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICBsZXQgcm9vdCA9IG51bGw7XG4gICAgZm9yIChjb25zdCBbaWQsIGNyZHRdIG9mIGl0ZW1zKSB7XG4gICAgICBpZiAoaXNSb290Q3JkdChjcmR0KSkge1xuICAgICAgICByb290ID0gW2lkLCBjcmR0XTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHR1cGxlID0gW2lkLCBjcmR0XTtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnRUb0NoaWxkcmVuLmdldChjcmR0LnBhcmVudElkKTtcbiAgICAgICAgaWYgKGNoaWxkcmVuICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBjaGlsZHJlbi5wdXNoKHR1cGxlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwYXJlbnRUb0NoaWxkcmVuLnNldChjcmR0LnBhcmVudElkLCBbdHVwbGVdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAocm9vdCA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUm9vdCBjYW4ndCBiZSBudWxsXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3Jvb3QsIHBhcmVudFRvQ2hpbGRyZW5dO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIF9mcm9tSXRlbXMoaXRlbXMsIHBvb2wpIHtcbiAgICBjb25zdCBbcm9vdCwgcGFyZW50VG9DaGlsZHJlbl0gPSBfTGl2ZU9iamVjdC5fYnVpbGRSb290QW5kUGFyZW50VG9DaGlsZHJlbihpdGVtcyk7XG4gICAgcmV0dXJuIF9MaXZlT2JqZWN0Ll9kZXNlcmlhbGl6ZShcbiAgICAgIHJvb3QsXG4gICAgICBwYXJlbnRUb0NoaWxkcmVuLFxuICAgICAgcG9vbFxuICAgICk7XG4gIH1cbiAgY29uc3RydWN0b3Iob2JqID0ge30pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IG8gPSBjb21wYWN0T2JqZWN0KG9iaik7XG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMobykpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gb1trZXldO1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX21hcCA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMobykpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvT3BzKHBhcmVudElkLCBwYXJlbnRLZXksIHBvb2wpIHtcbiAgICBpZiAodGhpcy5faWQgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNlcmlhbGl6ZSBpdGVtIGlzIG5vdCBhdHRhY2hlZFwiKTtcbiAgICB9XG4gICAgY29uc3Qgb3BJZCA9IHBvb2w/LmdlbmVyYXRlT3BJZCgpO1xuICAgIGNvbnN0IG9wcyA9IFtdO1xuICAgIGNvbnN0IG9wID0ge1xuICAgICAgdHlwZTogNCAvKiBDUkVBVEVfT0JKRUNUICovLFxuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgb3BJZCxcbiAgICAgIHBhcmVudElkLFxuICAgICAgcGFyZW50S2V5LFxuICAgICAgZGF0YToge31cbiAgICB9O1xuICAgIG9wcy5wdXNoKG9wKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmIChpc0xpdmVOb2RlKHZhbHVlKSkge1xuICAgICAgICBvcHMucHVzaCguLi52YWx1ZS5fdG9PcHModGhpcy5faWQsIGtleSwgcG9vbCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3AuZGF0YVtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvcHM7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2Rlc2VyaWFsaXplKFtpZCwgaXRlbV0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpIHtcbiAgICBjb25zdCBsaXZlT2JqID0gbmV3IF9MaXZlT2JqZWN0KGl0ZW0uZGF0YSk7XG4gICAgbGl2ZU9iai5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICByZXR1cm4gdGhpcy5fZGVzZXJpYWxpemVDaGlsZHJlbihsaXZlT2JqLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBfZGVzZXJpYWxpemVDaGlsZHJlbihsaXZlT2JqLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnRUb0NoaWxkcmVuLmdldChubihsaXZlT2JqLl9pZCkpO1xuICAgIGlmIChjaGlsZHJlbiA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbGl2ZU9iajtcbiAgICB9XG4gICAgZm9yIChjb25zdCBbaWQsIGNyZHRdIG9mIGNoaWxkcmVuKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGRlc2VyaWFsaXplVG9Mc29uKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgICAgaWYgKGlzTGl2ZVN0cnVjdHVyZShjaGlsZCkpIHtcbiAgICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsobGl2ZU9iaiwgY3JkdC5wYXJlbnRLZXkpO1xuICAgICAgfVxuICAgICAgbGl2ZU9iai5fbWFwLnNldChjcmR0LnBhcmVudEtleSwgY2hpbGQpO1xuICAgICAgbGl2ZU9iai5pbnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHJldHVybiBsaXZlT2JqO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2F0dGFjaChpZCwgcG9vbCkge1xuICAgIHN1cGVyLl9hdHRhY2goaWQsIHBvb2wpO1xuICAgIGZvciAoY29uc3QgW19rZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmIChpc0xpdmVOb2RlKHZhbHVlKSkge1xuICAgICAgICB2YWx1ZS5fYXR0YWNoKHBvb2wuZ2VuZXJhdGVJZCgpLCBwb29sKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXR0YWNoQ2hpbGQob3AsIHNvdXJjZSkge1xuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGF0dGFjaCBjaGlsZCBpZiBtYW5hZ2VkIHBvb2wgaXMgbm90IHByZXNlbnRcIik7XG4gICAgfVxuICAgIGNvbnN0IHsgaWQsIG9wSWQsIHBhcmVudEtleToga2V5IH0gPSBvcDtcbiAgICBjb25zdCBjaGlsZCA9IGNyZWF0aW9uT3BUb0xzb24ob3ApO1xuICAgIGlmICh0aGlzLl9wb29sLmdldE5vZGUoaWQpICE9PSB2b2lkIDApIHtcbiAgICAgIGlmICh0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpID09PSBvcElkKSB7XG4gICAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZSA9PT0gMCAvKiBVTkRPUkVET19SRUNPTk5FQ1QgKi8pIHtcbiAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuc2V0KGtleSwgbm4ob3BJZCkpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5nZXQoa2V5KSA9PT0gdm9pZCAwKSB7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpID09PSBvcElkKSB7XG4gICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmRlbGV0ZShrZXkpO1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBjb25zdCB0aGlzSWQgPSBubih0aGlzLl9pZCk7XG4gICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBsZXQgcmV2ZXJzZTtcbiAgICBpZiAoaXNMaXZlTm9kZShwcmV2aW91c1ZhbHVlKSkge1xuICAgICAgcmV2ZXJzZSA9IHByZXZpb3VzVmFsdWUuX3RvT3BzKHRoaXNJZCwga2V5KTtcbiAgICAgIHByZXZpb3VzVmFsdWUuX2RldGFjaCgpO1xuICAgIH0gZWxzZSBpZiAocHJldmlvdXNWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXZlcnNlID0gW3sgdHlwZTogNiAvKiBERUxFVEVfT0JKRUNUX0tFWSAqLywgaWQ6IHRoaXNJZCwga2V5IH1dO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZlcnNlID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgICAgIGlkOiB0aGlzSWQsXG4gICAgICAgICAgZGF0YTogeyBba2V5XTogcHJldmlvdXNWYWx1ZSB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICAgIHRoaXMuX21hcC5zZXQoa2V5LCBjaGlsZCk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKGlzTGl2ZVN0cnVjdHVyZShjaGlsZCkpIHtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICBjaGlsZC5fYXR0YWNoKGlkLCB0aGlzLl9wb29sKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHJldmVyc2UsXG4gICAgICBtb2RpZmllZDoge1xuICAgICAgICBub2RlOiB0aGlzLFxuICAgICAgICB0eXBlOiBcIkxpdmVPYmplY3RcIixcbiAgICAgICAgdXBkYXRlczogeyBba2V5XTogeyB0eXBlOiBcInVwZGF0ZVwiIH0gfVxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfZGV0YWNoQ2hpbGQoY2hpbGQpIHtcbiAgICBpZiAoY2hpbGQpIHtcbiAgICAgIGNvbnN0IGlkID0gbm4odGhpcy5faWQpO1xuICAgICAgY29uc3QgcGFyZW50S2V5ID0gbm4oY2hpbGQuX3BhcmVudEtleSk7XG4gICAgICBjb25zdCByZXZlcnNlID0gY2hpbGQuX3RvT3BzKGlkLCBwYXJlbnRLZXksIHRoaXMuX3Bvb2wpO1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gY2hpbGQpIHtcbiAgICAgICAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNoaWxkLl9kZXRhY2goKTtcbiAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGUgPSB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB7XG4gICAgICAgICAgW3BhcmVudEtleV06IHsgdHlwZTogXCJkZWxldGVcIiB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogc3RvcmFnZVVwZGF0ZSwgcmV2ZXJzZSB9O1xuICAgIH1cbiAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfZGV0YWNoKCkge1xuICAgIHN1cGVyLl9kZXRhY2goKTtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHRoaXMuX21hcC52YWx1ZXMoKSkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9kZXRhY2goKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHkob3AsIGlzTG9jYWwpIHtcbiAgICBpZiAob3AudHlwZSA9PT0gMyAvKiBVUERBVEVfT0JKRUNUICovKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXBwbHlVcGRhdGUob3AsIGlzTG9jYWwpO1xuICAgIH0gZWxzZSBpZiAob3AudHlwZSA9PT0gNiAvKiBERUxFVEVfT0JKRUNUX0tFWSAqLykge1xuICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5RGVsZXRlT2JqZWN0S2V5KG9wLCBpc0xvY2FsKTtcbiAgICB9XG4gICAgcmV0dXJuIHN1cGVyLl9hcHBseShvcCwgaXNMb2NhbCk7XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgX3NlcmlhbGl6ZSgpIHtcbiAgICBjb25zdCBkYXRhID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICBpZiAoIWlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIGRhdGFba2V5XSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIiAmJiB0aGlzLnBhcmVudC5ub2RlLl9pZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogMCAvKiBPQkpFQ1QgKi8sXG4gICAgICAgIHBhcmVudElkOiB0aGlzLnBhcmVudC5ub2RlLl9pZCxcbiAgICAgICAgcGFyZW50S2V5OiB0aGlzLnBhcmVudC5rZXksXG4gICAgICAgIGRhdGFcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IDAgLyogT0JKRUNUICovLFxuICAgICAgICBkYXRhXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVVwZGF0ZShvcCwgaXNMb2NhbCkge1xuICAgIGxldCBpc01vZGlmaWVkID0gZmFsc2U7XG4gICAgY29uc3QgaWQgPSBubih0aGlzLl9pZCk7XG4gICAgY29uc3QgcmV2ZXJzZSA9IFtdO1xuICAgIGNvbnN0IHJldmVyc2VVcGRhdGUgPSB7XG4gICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICBpZCxcbiAgICAgIGRhdGE6IHt9XG4gICAgfTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvcC5kYXRhKSB7XG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgICByZXZlcnNlLnB1c2goLi4ub2xkVmFsdWUuX3RvT3BzKGlkLCBrZXkpKTtcbiAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgfSBlbHNlIGlmIChvbGRWYWx1ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldmVyc2VVcGRhdGUuZGF0YVtrZXldID0gb2xkVmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKG9sZFZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV2ZXJzZS5wdXNoKHsgdHlwZTogNiAvKiBERUxFVEVfT0JKRUNUX0tFWSAqLywgaWQsIGtleSB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgdXBkYXRlRGVsdGEgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvcC5kYXRhKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG9wLmRhdGFba2V5XTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKGlzTG9jYWwpIHtcbiAgICAgICAgdGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5zZXQoa2V5LCBubihvcC5vcElkKSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZ2V0KGtleSkgPT09IHZvaWQgMCkge1xuICAgICAgICBpc01vZGlmaWVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5nZXQoa2V5KSA9PT0gb3Aub3BJZCkge1xuICAgICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmRlbGV0ZShrZXkpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgICBpZiAoaXNMaXZlTm9kZShvbGRWYWx1ZSkpIHtcbiAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgfVxuICAgICAgaXNNb2RpZmllZCA9IHRydWU7XG4gICAgICB1cGRhdGVEZWx0YVtrZXldID0geyB0eXBlOiBcInVwZGF0ZVwiIH07XG4gICAgICB0aGlzLl9tYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyhyZXZlcnNlVXBkYXRlLmRhdGEpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV2ZXJzZS51bnNoaWZ0KHJldmVyc2VVcGRhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gaXNNb2RpZmllZCA/IHtcbiAgICAgIG1vZGlmaWVkOiB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB1cGRhdGVEZWx0YVxuICAgICAgfSxcbiAgICAgIHJldmVyc2VcbiAgICB9IDogeyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseURlbGV0ZU9iamVjdEtleShvcCwgaXNMb2NhbCkge1xuICAgIGNvbnN0IGtleSA9IG9wLmtleTtcbiAgICBpZiAodGhpcy5fbWFwLmhhcyhrZXkpID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGlmICghaXNMb2NhbCAmJiB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBjb25zdCBpZCA9IG5uKHRoaXMuX2lkKTtcbiAgICBsZXQgcmV2ZXJzZSA9IFtdO1xuICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgcmV2ZXJzZSA9IG9sZFZhbHVlLl90b09wcyhpZCwgb3Aua2V5KTtcbiAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICB9IGVsc2UgaWYgKG9sZFZhbHVlICE9PSB2b2lkIDApIHtcbiAgICAgIHJldmVyc2UgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgZGF0YTogeyBba2V5XTogb2xkVmFsdWUgfVxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1vZGlmaWVkOiB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB7IFtvcC5rZXldOiB7IHR5cGU6IFwiZGVsZXRlXCIgfSB9XG4gICAgICB9LFxuICAgICAgcmV2ZXJzZVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFRyYW5zZm9ybSB0aGUgTGl2ZU9iamVjdCBpbnRvIGEgamF2YXNjcmlwdCBvYmplY3RcbiAgICovXG4gIHRvT2JqZWN0KCkge1xuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModGhpcy5fbWFwKTtcbiAgfVxuICAvKipcbiAgICogQWRkcyBvciB1cGRhdGVzIGEgcHJvcGVydHkgd2l0aCBhIHNwZWNpZmllZCBrZXkgYW5kIGEgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gYWRkXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIHByb3BlcnR5IHRvIGFkZFxuICAgKi9cbiAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIHRoaXMudXBkYXRlKHsgW2tleV06IHZhbHVlIH0pO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgc3BlY2lmaWVkIHByb3BlcnR5IGZyb20gdGhlIExpdmVPYmplY3QuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0XG4gICAqL1xuICBnZXQoa2V5KSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhIGtleSBmcm9tIHRoZSBMaXZlT2JqZWN0XG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZGVsZXRlXG4gICAqL1xuICBkZWxldGUoa2V5KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBjb25zdCBrZXlBc1N0cmluZyA9IGtleTtcbiAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5QXNTdHJpbmcpO1xuICAgIGlmIChvbGRWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDAgfHwgdGhpcy5faWQgPT09IHZvaWQgMCkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUob2xkVmFsdWUpKSB7XG4gICAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX21hcC5kZWxldGUoa2V5QXNTdHJpbmcpO1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCByZXZlcnNlO1xuICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgcmV2ZXJzZSA9IG9sZFZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5QXNTdHJpbmcpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZlcnNlID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgICAgIGRhdGE6IHsgW2tleUFzU3RyaW5nXTogb2xkVmFsdWUgfSxcbiAgICAgICAgICBpZDogdGhpcy5faWRcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gICAgdGhpcy5fbWFwLmRlbGV0ZShrZXlBc1N0cmluZyk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHN0b3JhZ2VVcGRhdGVzLnNldCh0aGlzLl9pZCwge1xuICAgICAgbm9kZTogdGhpcyxcbiAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgdXBkYXRlczogeyBba2V5XTogeyB0eXBlOiBcImRlbGV0ZVwiIH0gfVxuICAgIH0pO1xuICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2goXG4gICAgICBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovLFxuICAgICAgICAgIGtleToga2V5QXNTdHJpbmcsXG4gICAgICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgICAgIG9wSWQ6IHRoaXMuX3Bvb2wuZ2VuZXJhdGVPcElkKClcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIHJldmVyc2UsXG4gICAgICBzdG9yYWdlVXBkYXRlc1xuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZHMgb3IgdXBkYXRlcyBtdWx0aXBsZSBwcm9wZXJ0aWVzIGF0IG9uY2Ugd2l0aCBhbiBvYmplY3QuXG4gICAqIEBwYXJhbSBwYXRjaCBUaGUgb2JqZWN0IHVzZWQgdG8gb3ZlcnJpZGVzIHByb3BlcnRpZXNcbiAgICovXG4gIHVwZGF0ZShwYXRjaCkge1xuICAgIHRoaXMuX3Bvb2w/LmFzc2VydFN0b3JhZ2VJc1dyaXRhYmxlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCB8fCB0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRjaCkge1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhdGNoW2tleV07XG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNMaXZlTm9kZShuZXdWYWx1ZSkpIHtcbiAgICAgICAgICBuZXdWYWx1ZS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21hcC5zZXQoa2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBvcHMgPSBbXTtcbiAgICBjb25zdCByZXZlcnNlT3BzID0gW107XG4gICAgY29uc3Qgb3BJZCA9IHRoaXMuX3Bvb2wuZ2VuZXJhdGVPcElkKCk7XG4gICAgY29uc3QgdXBkYXRlZFByb3BzID0ge307XG4gICAgY29uc3QgcmV2ZXJzZVVwZGF0ZU9wID0ge1xuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgZGF0YToge31cbiAgICB9O1xuICAgIGNvbnN0IHVwZGF0ZURlbHRhID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gcGF0Y2gpIHtcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGF0Y2hba2V5XTtcbiAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgICBpZiAoaXNMaXZlTm9kZShvbGRWYWx1ZSkpIHtcbiAgICAgICAgcmV2ZXJzZU9wcy5wdXNoKC4uLm9sZFZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5KSk7XG4gICAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICAgIH0gZWxzZSBpZiAob2xkVmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgICByZXZlcnNlT3BzLnB1c2goeyB0eXBlOiA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovLCBpZDogdGhpcy5faWQsIGtleSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldmVyc2VVcGRhdGVPcC5kYXRhW2tleV0gPSBvbGRWYWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0xpdmVOb2RlKG5ld1ZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgICAgICBuZXdWYWx1ZS5fYXR0YWNoKHRoaXMuX3Bvb2wuZ2VuZXJhdGVJZCgpLCB0aGlzLl9wb29sKTtcbiAgICAgICAgY29uc3QgbmV3QXR0YWNoQ2hpbGRPcHMgPSBuZXdWYWx1ZS5fdG9PcHModGhpcy5faWQsIGtleSwgdGhpcy5fcG9vbCk7XG4gICAgICAgIGNvbnN0IGNyZWF0ZUNyZHRPcCA9IG5ld0F0dGFjaENoaWxkT3BzLmZpbmQoXG4gICAgICAgICAgKG9wKSA9PiBvcC5wYXJlbnRJZCA9PT0gdGhpcy5faWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNyZWF0ZUNyZHRPcCkge1xuICAgICAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuc2V0KGtleSwgbm4oY3JlYXRlQ3JkdE9wLm9wSWQpKTtcbiAgICAgICAgfVxuICAgICAgICBvcHMucHVzaCguLi5uZXdBdHRhY2hDaGlsZE9wcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1cGRhdGVkUHJvcHNba2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLnNldChrZXksIG9wSWQpO1xuICAgICAgfVxuICAgICAgdGhpcy5fbWFwLnNldChrZXksIG5ld1ZhbHVlKTtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgdXBkYXRlRGVsdGFba2V5XSA9IHsgdHlwZTogXCJ1cGRhdGVcIiB9O1xuICAgIH1cbiAgICBpZiAoT2JqZWN0LmtleXMocmV2ZXJzZVVwZGF0ZU9wLmRhdGEpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV2ZXJzZU9wcy51bnNoaWZ0KHJldmVyc2VVcGRhdGVPcCk7XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVkUHJvcHMpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgb3BzLnVuc2hpZnQoe1xuICAgICAgICBvcElkLFxuICAgICAgICBpZDogdGhpcy5faWQsXG4gICAgICAgIHR5cGU6IDMgLyogVVBEQVRFX09CSkVDVCAqLyxcbiAgICAgICAgZGF0YTogdXBkYXRlZFByb3BzXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHN0b3JhZ2VVcGRhdGVzLnNldCh0aGlzLl9pZCwge1xuICAgICAgbm9kZTogdGhpcyxcbiAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgdXBkYXRlczogdXBkYXRlRGVsdGFcbiAgICB9KTtcbiAgICB0aGlzLl9wb29sLmRpc3BhdGNoKG9wcywgcmV2ZXJzZU9wcywgc3RvcmFnZVVwZGF0ZXMpO1xuICB9XG4gIHRvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiBzdXBlci50b0ltbXV0YWJsZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgdG9UcmVlTm9kZShrZXkpIHtcbiAgICByZXR1cm4gc3VwZXIudG9UcmVlTm9kZShrZXkpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvVHJlZU5vZGUoa2V5KSB7XG4gICAgY29uc3Qgbm9kZUlkID0gdGhpcy5faWQgPz8gbmFub2lkKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgaWQ6IG5vZGVJZCxcbiAgICAgIGtleSxcbiAgICAgIHBheWxvYWQ6IEFycmF5LmZyb20odGhpcy5fbWFwLmVudHJpZXMoKSkubWFwKFxuICAgICAgICAoW2tleTIsIHZhbHVlXSkgPT4gaXNMaXZlTm9kZSh2YWx1ZSkgPyB2YWx1ZS50b1RyZWVOb2RlKGtleTIpIDogeyB0eXBlOiBcIkpzb25cIiwgaWQ6IGAke25vZGVJZH06JHtrZXkyfWAsIGtleToga2V5MiwgcGF5bG9hZDogdmFsdWUgfVxuICAgICAgKVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9JbW11dGFibGUoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIHRoaXMuX21hcCkge1xuICAgICAgcmVzdWx0W2tleV0gPSBpc0xpdmVTdHJ1Y3R1cmUodmFsKSA/IHZhbC50b0ltbXV0YWJsZSgpIDogdmFsO1xuICAgIH1cbiAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiID8gcmVzdWx0IDogT2JqZWN0LmZyZWV6ZShyZXN1bHQpO1xuICB9XG4gIGNsb25lKCkge1xuICAgIHJldHVybiBuZXcgX0xpdmVPYmplY3QoXG4gICAgICBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIEFycmF5LmZyb20odGhpcy5fbWFwKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW1xuICAgICAgICAgIGtleSxcbiAgICAgICAgICBpc0xpdmVTdHJ1Y3R1cmUodmFsdWUpID8gdmFsdWUuY2xvbmUoKSA6IGRlZXBDbG9uZSh2YWx1ZSlcbiAgICAgICAgXSlcbiAgICAgIClcbiAgICApO1xuICB9XG59O1xuXG4vLyBzcmMvY3JkdHMvbGl2ZWJsb2Nrcy1oZWxwZXJzLnRzXG5mdW5jdGlvbiBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCkge1xuICByZXR1cm4gbHNvblRvTGl2ZU5vZGUoY3JlYXRpb25PcFRvTHNvbihvcCkpO1xufVxuZnVuY3Rpb24gY3JlYXRpb25PcFRvTHNvbihvcCkge1xuICBzd2l0Y2ggKG9wLnR5cGUpIHtcbiAgICBjYXNlIDggLyogQ1JFQVRFX1JFR0lTVEVSICovOlxuICAgICAgcmV0dXJuIG9wLmRhdGE7XG4gICAgY2FzZSA0IC8qIENSRUFURV9PQkpFQ1QgKi86XG4gICAgICByZXR1cm4gbmV3IExpdmVPYmplY3Qob3AuZGF0YSk7XG4gICAgY2FzZSA3IC8qIENSRUFURV9NQVAgKi86XG4gICAgICByZXR1cm4gbmV3IExpdmVNYXAoKTtcbiAgICBjYXNlIDIgLyogQ1JFQVRFX0xJU1QgKi86XG4gICAgICByZXR1cm4gbmV3IExpdmVMaXN0KFtdKTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKG9wLCBcIlVua25vd24gY3JlYXRpb24gT3BcIik7XG4gIH1cbn1cbmZ1bmN0aW9uIGlzU2FtZU5vZGVPckNoaWxkT2Yobm9kZSwgcGFyZW50KSB7XG4gIGlmIChub2RlID09PSBwYXJlbnQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAobm9kZS5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIikge1xuICAgIHJldHVybiBpc1NhbWVOb2RlT3JDaGlsZE9mKG5vZGUucGFyZW50Lm5vZGUsIHBhcmVudCk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gZGVzZXJpYWxpemUoW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCkge1xuICBzd2l0Y2ggKGNyZHQudHlwZSkge1xuICAgIGNhc2UgMCAvKiBPQkpFQ1QgKi86IHtcbiAgICAgIHJldHVybiBMaXZlT2JqZWN0Ll9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAxIC8qIExJU1QgKi86IHtcbiAgICAgIHJldHVybiBMaXZlTGlzdC5fZGVzZXJpYWxpemUoW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgfVxuICAgIGNhc2UgMiAvKiBNQVAgKi86IHtcbiAgICAgIHJldHVybiBMaXZlTWFwLl9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAzIC8qIFJFR0lTVEVSICovOiB7XG4gICAgICByZXR1cm4gTGl2ZVJlZ2lzdGVyLl9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBDUkRUIHR5cGVcIik7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBkZXNlcmlhbGl6ZVRvTHNvbihbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gIHN3aXRjaCAoY3JkdC50eXBlKSB7XG4gICAgY2FzZSAwIC8qIE9CSkVDVCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVPYmplY3QuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDEgLyogTElTVCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVMaXN0Ll9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAyIC8qIE1BUCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVNYXAuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDMgLyogUkVHSVNURVIgKi86IHtcbiAgICAgIHJldHVybiBjcmR0LmRhdGE7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgQ1JEVCB0eXBlXCIpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gaXNMaXZlU3RydWN0dXJlKHZhbHVlKSB7XG4gIHJldHVybiBpc0xpdmVMaXN0KHZhbHVlKSB8fCBpc0xpdmVNYXAodmFsdWUpIHx8IGlzTGl2ZU9iamVjdCh2YWx1ZSk7XG59XG5mdW5jdGlvbiBpc0xpdmVOb2RlKHZhbHVlKSB7XG4gIHJldHVybiBpc0xpdmVTdHJ1Y3R1cmUodmFsdWUpIHx8IGlzTGl2ZVJlZ2lzdGVyKHZhbHVlKTtcbn1cbmZ1bmN0aW9uIGlzTGl2ZUxpc3QodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgTGl2ZUxpc3Q7XG59XG5mdW5jdGlvbiBpc0xpdmVNYXAodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgTGl2ZU1hcDtcbn1cbmZ1bmN0aW9uIGlzTGl2ZU9iamVjdCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBMaXZlT2JqZWN0O1xufVxuZnVuY3Rpb24gaXNMaXZlUmVnaXN0ZXIodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgTGl2ZVJlZ2lzdGVyO1xufVxuZnVuY3Rpb24gY2xvbmVMc29uKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXNMaXZlU3RydWN0dXJlKHZhbHVlKSA/IHZhbHVlLmNsb25lKCkgOiBkZWVwQ2xvbmUodmFsdWUpO1xufVxuZnVuY3Rpb24gbGl2ZU5vZGVUb0xzb24ob2JqKSB7XG4gIGlmIChvYmogaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIpIHtcbiAgICByZXR1cm4gb2JqLmRhdGE7XG4gIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgTGl2ZUxpc3QgfHwgb2JqIGluc3RhbmNlb2YgTGl2ZU1hcCB8fCBvYmogaW5zdGFuY2VvZiBMaXZlT2JqZWN0KSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXNzZXJ0TmV2ZXIob2JqLCBcIlVua25vd24gQWJzdHJhY3RDcmR0XCIpO1xuICB9XG59XG5mdW5jdGlvbiBsc29uVG9MaXZlTm9kZSh2YWx1ZSkge1xuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlT2JqZWN0IHx8IHZhbHVlIGluc3RhbmNlb2YgTGl2ZU1hcCB8fCB2YWx1ZSBpbnN0YW5jZW9mIExpdmVMaXN0KSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXcgTGl2ZVJlZ2lzdGVyKHZhbHVlKTtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0VHJlZXNEaWZmT3BlcmF0aW9ucyhjdXJyZW50SXRlbXMsIG5ld0l0ZW1zKSB7XG4gIGNvbnN0IG9wcyA9IFtdO1xuICBjdXJyZW50SXRlbXMuZm9yRWFjaCgoXywgaWQpID0+IHtcbiAgICBpZiAoIW5ld0l0ZW1zLmdldChpZCkpIHtcbiAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLyxcbiAgICAgICAgaWRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIG5ld0l0ZW1zLmZvckVhY2goKGNyZHQsIGlkKSA9PiB7XG4gICAgY29uc3QgY3VycmVudENyZHQgPSBjdXJyZW50SXRlbXMuZ2V0KGlkKTtcbiAgICBpZiAoY3VycmVudENyZHQpIHtcbiAgICAgIGlmIChjcmR0LnR5cGUgPT09IDAgLyogT0JKRUNUICovKSB7XG4gICAgICAgIGlmIChjdXJyZW50Q3JkdC50eXBlICE9PSAwIC8qIE9CSkVDVCAqLyB8fCBKU09OLnN0cmluZ2lmeShjcmR0LmRhdGEpICE9PSBKU09OLnN0cmluZ2lmeShjdXJyZW50Q3JkdC5kYXRhKSkge1xuICAgICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6IDMgLyogVVBEQVRFX09CSkVDVCAqLyxcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgZGF0YTogY3JkdC5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjcmR0LnBhcmVudEtleSAhPT0gY3VycmVudENyZHQucGFyZW50S2V5KSB7XG4gICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAxIC8qIFNFVF9QQVJFTlRfS0VZICovLFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIHBhcmVudEtleTogbm4oY3JkdC5wYXJlbnRLZXksIFwiUGFyZW50IGtleSBtdXN0IG5vdCBiZSBtaXNzaW5nXCIpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzd2l0Y2ggKGNyZHQudHlwZSkge1xuICAgICAgICBjYXNlIDMgLyogUkVHSVNURVIgKi86XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogOCAvKiBDUkVBVEVfUkVHSVNURVIgKi8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHBhcmVudElkOiBjcmR0LnBhcmVudElkLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBjcmR0LnBhcmVudEtleSxcbiAgICAgICAgICAgIGRhdGE6IGNyZHQuZGF0YVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEgLyogTElTVCAqLzpcbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIENSRUFURV9MSVNUICovLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBwYXJlbnRJZDogY3JkdC5wYXJlbnRJZCxcbiAgICAgICAgICAgIHBhcmVudEtleTogY3JkdC5wYXJlbnRLZXlcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAwIC8qIE9CSkVDVCAqLzpcbiAgICAgICAgICBpZiAoY3JkdC5wYXJlbnRJZCA9PT0gdm9pZCAwIHx8IGNyZHQucGFyZW50S2V5ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgXCJJbnRlcm5hbCBlcnJvci4gQ2Fubm90IHNlcmlhbGl6ZSBzdG9yYWdlIHJvb3QgaW50byBhbiBvcGVyYXRpb25cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogNCAvKiBDUkVBVEVfT0JKRUNUICovLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBwYXJlbnRJZDogY3JkdC5wYXJlbnRJZCxcbiAgICAgICAgICAgIHBhcmVudEtleTogY3JkdC5wYXJlbnRLZXksXG4gICAgICAgICAgICBkYXRhOiBjcmR0LmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyIC8qIE1BUCAqLzpcbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiA3IC8qIENSRUFURV9NQVAgKi8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHBhcmVudElkOiBjcmR0LnBhcmVudElkLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBjcmR0LnBhcmVudEtleVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiBvcHM7XG59XG5mdW5jdGlvbiBtZXJnZU9iamVjdFN0b3JhZ2VVcGRhdGVzKGZpcnN0LCBzZWNvbmQpIHtcbiAgY29uc3QgdXBkYXRlcyA9IGZpcnN0LnVwZGF0ZXM7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMoc2Vjb25kLnVwZGF0ZXMpKSB7XG4gICAgdXBkYXRlc1trZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5zZWNvbmQsXG4gICAgdXBkYXRlc1xuICB9O1xufVxuZnVuY3Rpb24gbWVyZ2VNYXBTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKSB7XG4gIGNvbnN0IHVwZGF0ZXMgPSBmaXJzdC51cGRhdGVzO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzKHNlY29uZC51cGRhdGVzKSkge1xuICAgIHVwZGF0ZXNba2V5XSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiB7XG4gICAgLi4uc2Vjb25kLFxuICAgIHVwZGF0ZXNcbiAgfTtcbn1cbmZ1bmN0aW9uIG1lcmdlTGlzdFN0b3JhZ2VVcGRhdGVzKGZpcnN0LCBzZWNvbmQpIHtcbiAgY29uc3QgdXBkYXRlcyA9IGZpcnN0LnVwZGF0ZXM7XG4gIHJldHVybiB7XG4gICAgLi4uc2Vjb25kLFxuICAgIHVwZGF0ZXM6IHVwZGF0ZXMuY29uY2F0KHNlY29uZC51cGRhdGVzKVxuICB9O1xufVxuZnVuY3Rpb24gbWVyZ2VTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKSB7XG4gIGlmIChmaXJzdCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHNlY29uZDtcbiAgfVxuICBpZiAoZmlyc3QudHlwZSA9PT0gXCJMaXZlT2JqZWN0XCIgJiYgc2Vjb25kLnR5cGUgPT09IFwiTGl2ZU9iamVjdFwiKSB7XG4gICAgcmV0dXJuIG1lcmdlT2JqZWN0U3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCk7XG4gIH0gZWxzZSBpZiAoZmlyc3QudHlwZSA9PT0gXCJMaXZlTWFwXCIgJiYgc2Vjb25kLnR5cGUgPT09IFwiTGl2ZU1hcFwiKSB7XG4gICAgcmV0dXJuIG1lcmdlTWFwU3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCk7XG4gIH0gZWxzZSBpZiAoZmlyc3QudHlwZSA9PT0gXCJMaXZlTGlzdFwiICYmIHNlY29uZC50eXBlID09PSBcIkxpdmVMaXN0XCIpIHtcbiAgICByZXR1cm4gbWVyZ2VMaXN0U3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCk7XG4gIH0gZWxzZSB7XG4gIH1cbiAgcmV0dXJuIHNlY29uZDtcbn1cbmZ1bmN0aW9uIGlzUGxhaW4odmFsdWUpIHtcbiAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgcmV0dXJuIHZhbHVlID09PSB2b2lkIDAgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlID09PSBcImJvb2xlYW5cIiB8fCB0eXBlID09PSBcIm51bWJlclwiIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IGlzUGxhaW5PYmplY3QodmFsdWUpO1xufVxuZnVuY3Rpb24gZmluZE5vblNlcmlhbGl6YWJsZVZhbHVlKHZhbHVlLCBwYXRoID0gXCJcIikge1xuICBpZiAoIWlzUGxhaW4pIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGF0aDogcGF0aCB8fCBcInJvb3RcIixcbiAgICAgIHZhbHVlXG4gICAgfTtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAoY29uc3QgW2tleSwgbmVzdGVkVmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkge1xuICAgIGNvbnN0IG5lc3RlZFBhdGggPSBwYXRoID8gcGF0aCArIFwiLlwiICsga2V5IDoga2V5O1xuICAgIGlmICghaXNQbGFpbihuZXN0ZWRWYWx1ZSkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhdGg6IG5lc3RlZFBhdGgsXG4gICAgICAgIHZhbHVlOiBuZXN0ZWRWYWx1ZVxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBuZXN0ZWRWYWx1ZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgY29uc3Qgbm9uU2VyaWFsaXphYmxlTmVzdGVkVmFsdWUgPSBmaW5kTm9uU2VyaWFsaXphYmxlVmFsdWUoXG4gICAgICAgIG5lc3RlZFZhbHVlLFxuICAgICAgICBuZXN0ZWRQYXRoXG4gICAgICApO1xuICAgICAgaWYgKG5vblNlcmlhbGl6YWJsZU5lc3RlZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiBub25TZXJpYWxpemFibGVOZXN0ZWRWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyBzcmMvbGliL2NyZWF0ZUlkcy50c1xudmFyIFRIUkVBRF9JRF9QUkVGSVggPSBcInRoXCI7XG52YXIgQ09NTUVOVF9JRF9QUkVGSVggPSBcImNtXCI7XG52YXIgSU5CT1hfTk9USUZJQ0FUSU9OX0lEX1BSRUZJWCA9IFwiaW5cIjtcbmZ1bmN0aW9uIGNyZWF0ZU9wdGltaXN0aWNJZChwcmVmaXgpIHtcbiAgcmV0dXJuIGAke3ByZWZpeH1fJHtuYW5vaWQoKX1gO1xufVxuZnVuY3Rpb24gY3JlYXRlVGhyZWFkSWQoKSB7XG4gIHJldHVybiBjcmVhdGVPcHRpbWlzdGljSWQoVEhSRUFEX0lEX1BSRUZJWCk7XG59XG5mdW5jdGlvbiBjcmVhdGVDb21tZW50SWQoKSB7XG4gIHJldHVybiBjcmVhdGVPcHRpbWlzdGljSWQoQ09NTUVOVF9JRF9QUkVGSVgpO1xufVxuZnVuY3Rpb24gY3JlYXRlSW5ib3hOb3RpZmljYXRpb25JZCgpIHtcbiAgcmV0dXJuIGNyZWF0ZU9wdGltaXN0aWNJZChJTkJPWF9OT1RJRklDQVRJT05fSURfUFJFRklYKTtcbn1cblxuLy8gc3JjL2xpYi9kZWJ1Zy50c1xuZnVuY3Rpb24gY2FwdHVyZVN0YWNrVHJhY2UobXNnLCB0cmFjZVJvb3QpIHtcbiAgY29uc3QgZXJyb3JMaWtlID0geyBuYW1lOiBtc2cgfTtcbiAgaWYgKHR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZShlcnJvckxpa2UsIHRyYWNlUm9vdCk7XG4gIHJldHVybiBlcnJvckxpa2Uuc3RhY2s7XG59XG5cbi8vIHNyYy9saWIvSnNvbi50c1xuZnVuY3Rpb24gaXNKc29uU2NhbGFyKGRhdGEpIHtcbiAgcmV0dXJuIGRhdGEgPT09IG51bGwgfHwgdHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIGRhdGEgPT09IFwibnVtYmVyXCIgfHwgdHlwZW9mIGRhdGEgPT09IFwiYm9vbGVhblwiO1xufVxuZnVuY3Rpb24gaXNKc29uQXJyYXkoZGF0YSkge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheShkYXRhKTtcbn1cbmZ1bmN0aW9uIGlzSnNvbk9iamVjdChkYXRhKSB7XG4gIHJldHVybiAhaXNKc29uU2NhbGFyKGRhdGEpICYmICFpc0pzb25BcnJheShkYXRhKTtcbn1cblxuLy8gc3JjL2xpYi9vYmplY3RUb1F1ZXJ5LnRzXG52YXIgaWRlbnRpZmllclJlZ2V4ID0gL15bYS16QS1aX11bYS16QS1aMC05X10qJC87XG5mdW5jdGlvbiBvYmplY3RUb1F1ZXJ5KG9iaikge1xuICBsZXQgZmlsdGVyTGlzdCA9IFtdO1xuICBjb25zdCBlbnRyaWVzMiA9IE9iamVjdC5lbnRyaWVzKG9iaik7XG4gIGNvbnN0IGtleVZhbHVlUGFpcnMgPSBbXTtcbiAgY29uc3Qga2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvciA9IFtdO1xuICBjb25zdCBpbmRleGVkS2V5cyA9IFtdO1xuICBlbnRyaWVzMi5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICBpZiAoIWlkZW50aWZpZXJSZWdleC50ZXN0KGtleSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIktleSBtdXN0IG9ubHkgY29udGFpbiBsZXR0ZXJzLCBudW1iZXJzLCBfXCIpO1xuICAgIH1cbiAgICBpZiAoaXNTaW1wbGVWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgIGtleVZhbHVlUGFpcnMucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgIH0gZWxzZSBpZiAoaXNWYWx1ZVdpdGhPcGVyYXRvcih2YWx1ZSkpIHtcbiAgICAgIGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmICEoXCJzdGFydHNXaXRoXCIgaW4gdmFsdWUpKSB7XG4gICAgICBpbmRleGVkS2V5cy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfVxuICB9KTtcbiAgZmlsdGVyTGlzdCA9IFtcbiAgICAuLi5nZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnMoa2V5VmFsdWVQYWlycyksXG4gICAgLi4uZ2V0RmlsdGVyc0Zyb21LZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yKGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IpXG4gIF07XG4gIGluZGV4ZWRLZXlzLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGNvbnN0IG5lc3RlZEVudHJpZXMgPSBPYmplY3QuZW50cmllcyh2YWx1ZSk7XG4gICAgY29uc3QgbktleVZhbHVlUGFpcnMgPSBbXTtcbiAgICBjb25zdCBuS2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvciA9IFtdO1xuICAgIG5lc3RlZEVudHJpZXMuZm9yRWFjaCgoW25lc3RlZEtleSwgbmVzdGVkVmFsdWVdKSA9PiB7XG4gICAgICBpZiAoaXNTdHJpbmdFbXB0eShuZXN0ZWRLZXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIktleSBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgICB9XG4gICAgICBpZiAoaXNTaW1wbGVWYWx1ZShuZXN0ZWRWYWx1ZSkpIHtcbiAgICAgICAgbktleVZhbHVlUGFpcnMucHVzaChbZm9ybWF0RmlsdGVyS2V5KGtleSwgbmVzdGVkS2V5KSwgbmVzdGVkVmFsdWVdKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNWYWx1ZVdpdGhPcGVyYXRvcihuZXN0ZWRWYWx1ZSkpIHtcbiAgICAgICAgbktleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IucHVzaChbXG4gICAgICAgICAgZm9ybWF0RmlsdGVyS2V5KGtleSwgbmVzdGVkS2V5KSxcbiAgICAgICAgICBuZXN0ZWRWYWx1ZVxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBmaWx0ZXJMaXN0ID0gW1xuICAgICAgLi4uZmlsdGVyTGlzdCxcbiAgICAgIC4uLmdldEZpbHRlcnNGcm9tS2V5VmFsdWVQYWlycyhuS2V5VmFsdWVQYWlycyksXG4gICAgICAuLi5nZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IobktleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IpXG4gICAgXTtcbiAgfSk7XG4gIHJldHVybiBmaWx0ZXJMaXN0Lm1hcChcbiAgICAoeyBrZXksIG9wZXJhdG9yLCB2YWx1ZSB9KSA9PiBmb3JtYXRGaWx0ZXIoa2V5LCBvcGVyYXRvciwgZm9ybWF0RmlsdGVyVmFsdWUodmFsdWUpKVxuICApLmpvaW4oXCIgQU5EIFwiKTtcbn1cbnZhciBnZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnMgPSAoa2V5VmFsdWVQYWlycykgPT4ge1xuICBjb25zdCBmaWx0ZXJzID0gW107XG4gIGtleVZhbHVlUGFpcnMuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgZmlsdGVycy5wdXNoKHtcbiAgICAgIGtleSxcbiAgICAgIG9wZXJhdG9yOiBcIjpcIixcbiAgICAgIHZhbHVlXG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gZmlsdGVycztcbn07XG52YXIgZ2V0RmlsdGVyc0Zyb21LZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yID0gKGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IpID0+IHtcbiAgY29uc3QgZmlsdGVycyA9IFtdO1xuICBrZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGlmIChcInN0YXJ0c1dpdGhcIiBpbiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUuc3RhcnRzV2l0aCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgZmlsdGVycy5wdXNoKHtcbiAgICAgICAga2V5LFxuICAgICAgICBvcGVyYXRvcjogXCJeXCIsXG4gICAgICAgIHZhbHVlOiB2YWx1ZS5zdGFydHNXaXRoXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmlsdGVycztcbn07XG52YXIgaXNTaW1wbGVWYWx1ZSA9ICh2YWx1ZSkgPT4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcbnZhciBpc1ZhbHVlV2l0aE9wZXJhdG9yID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwgJiYgXCJzdGFydHNXaXRoXCIgaW4gdmFsdWUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xudmFyIGZvcm1hdEZpbHRlciA9IChrZXksIG9wZXJhdG9yLCB2YWx1ZSkgPT4ge1xuICByZXR1cm4gYCR7a2V5fSR7b3BlcmF0b3J9JHt2YWx1ZX1gO1xufTtcbnZhciBmb3JtYXRGaWx0ZXJLZXkgPSAoa2V5LCBuZXN0ZWRLZXkpID0+IHtcbiAgaWYgKG5lc3RlZEtleSkge1xuICAgIHJldHVybiBgJHtrZXl9WyR7SlNPTi5zdHJpbmdpZnkobmVzdGVkS2V5KX1dYDtcbiAgfVxuICByZXR1cm4ga2V5O1xufTtcbnZhciBmb3JtYXRGaWx0ZXJWYWx1ZSA9ICh2YWx1ZSkgPT4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgaWYgKGlzU3RyaW5nRW1wdHkodmFsdWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG59O1xudmFyIGlzU3RyaW5nRW1wdHkgPSAodmFsdWUpID0+IHtcbiAgcmV0dXJuICF2YWx1ZSB8fCB2YWx1ZS50b1N0cmluZygpLnRyaW0oKSA9PT0gXCJcIjtcbn07XG5cbi8vIHNyYy9wcm90b2NvbC9DbGllbnRNc2cudHNcbnZhciBDbGllbnRNc2dDb2RlID0gLyogQF9fUFVSRV9fICovICgoQ2xpZW50TXNnQ29kZTIpID0+IHtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJVUERBVEVfUFJFU0VOQ0VcIl0gPSAxMDBdID0gXCJVUERBVEVfUFJFU0VOQ0VcIjtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJCUk9BRENBU1RfRVZFTlRcIl0gPSAxMDNdID0gXCJCUk9BRENBU1RfRVZFTlRcIjtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJGRVRDSF9TVE9SQUdFXCJdID0gMjAwXSA9IFwiRkVUQ0hfU1RPUkFHRVwiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIlVQREFURV9TVE9SQUdFXCJdID0gMjAxXSA9IFwiVVBEQVRFX1NUT1JBR0VcIjtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJGRVRDSF9ZRE9DXCJdID0gMzAwXSA9IFwiRkVUQ0hfWURPQ1wiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIlVQREFURV9ZRE9DXCJdID0gMzAxXSA9IFwiVVBEQVRFX1lET0NcIjtcbiAgcmV0dXJuIENsaWVudE1zZ0NvZGUyO1xufSkoQ2xpZW50TXNnQ29kZSB8fCB7fSk7XG5cbi8vIHNyYy9yZWZzL0ltbXV0YWJsZVJlZi50c1xuZnVuY3Rpb24gbWVyZ2UodGFyZ2V0LCBwYXRjaCkge1xuICBsZXQgdXBkYXRlZCA9IGZhbHNlO1xuICBjb25zdCBuZXdWYWx1ZSA9IHsgLi4udGFyZ2V0IH07XG4gIE9iamVjdC5rZXlzKHBhdGNoKS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gaztcbiAgICBjb25zdCB2YWwgPSBwYXRjaFtrZXldO1xuICAgIGlmIChuZXdWYWx1ZVtrZXldICE9PSB2YWwpIHtcbiAgICAgIGlmICh2YWwgPT09IHZvaWQgMCkge1xuICAgICAgICBkZWxldGUgbmV3VmFsdWVba2V5XTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1ZhbHVlW2tleV0gPSB2YWw7XG4gICAgICB9XG4gICAgICB1cGRhdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdXBkYXRlZCA/IG5ld1ZhbHVlIDogdGFyZ2V0O1xufVxudmFyIEltbXV0YWJsZVJlZiA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fZXYgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgfVxuICBnZXQgZGlkSW52YWxpZGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZXYub2JzZXJ2YWJsZTtcbiAgfVxuICBpbnZhbGlkYXRlKCkge1xuICAgIGlmICh0aGlzLl9jYWNoZSAhPT0gdm9pZCAwKSB7XG4gICAgICB0aGlzLl9jYWNoZSA9IHZvaWQgMDtcbiAgICAgIHRoaXMuX2V2Lm5vdGlmeSgpO1xuICAgIH1cbiAgfVxuICBnZXQgY3VycmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2FjaGUgPz8gKHRoaXMuX2NhY2hlID0gdGhpcy5fdG9JbW11dGFibGUoKSk7XG4gIH1cbn07XG5cbi8vIHNyYy9yZWZzL090aGVyc1JlZi50c1xuZnVuY3Rpb24gbWFrZVVzZXIoY29ubiwgcHJlc2VuY2UpIHtcbiAgY29uc3QgeyBjb25uZWN0aW9uSWQsIGlkLCBpbmZvIH0gPSBjb25uO1xuICBjb25zdCBjYW5Xcml0ZSA9IGNhbldyaXRlU3RvcmFnZShjb25uLnNjb3Blcyk7XG4gIHJldHVybiBmcmVlemUoXG4gICAgY29tcGFjdE9iamVjdCh7XG4gICAgICBjb25uZWN0aW9uSWQsXG4gICAgICBpZCxcbiAgICAgIGluZm8sXG4gICAgICBjYW5Xcml0ZSxcbiAgICAgIGNhbkNvbW1lbnQ6IGNhbkNvbW1lbnQoY29ubi5zY29wZXMpLFxuICAgICAgaXNSZWFkT25seTogIWNhbldyaXRlLFxuICAgICAgLy8gRGVwcmVjYXRlZCwga2VwdCBmb3IgYmFja3dhcmQtY29tcGF0aWJpbGl0eVxuICAgICAgcHJlc2VuY2VcbiAgICB9KVxuICApO1xufVxudmFyIE90aGVyc1JlZiA9IGNsYXNzIGV4dGVuZHMgSW1tdXRhYmxlUmVmIHtcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9jb25uZWN0aW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5fcHJlc2VuY2VzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICB0aGlzLl91c2VycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIH1cbiAgY29ubmVjdGlvbklkcygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbnMua2V5cygpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIGNvbnN0IHVzZXJzID0gY29tcGFjdChcbiAgICAgIEFycmF5LmZyb20odGhpcy5fcHJlc2VuY2VzLmtleXMoKSkubWFwKFxuICAgICAgICAoY29ubmVjdGlvbklkKSA9PiB0aGlzLmdldFVzZXIoTnVtYmVyKGNvbm5lY3Rpb25JZCkpXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4gdXNlcnM7XG4gIH1cbiAgY2xlYXJPdGhlcnMoKSB7XG4gICAgdGhpcy5fY29ubmVjdGlvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuX3ByZXNlbmNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5fdXNlcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2dldFVzZXIoY29ubmVjdGlvbklkKSB7XG4gICAgY29uc3QgY29ubiA9IHRoaXMuX2Nvbm5lY3Rpb25zLmdldChjb25uZWN0aW9uSWQpO1xuICAgIGNvbnN0IHByZXNlbmNlID0gdGhpcy5fcHJlc2VuY2VzLmdldChjb25uZWN0aW9uSWQpO1xuICAgIGlmIChjb25uICE9PSB2b2lkIDAgJiYgcHJlc2VuY2UgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG1ha2VVc2VyKGNvbm4sIHByZXNlbmNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBnZXRVc2VyKGNvbm5lY3Rpb25JZCkge1xuICAgIGNvbnN0IGNhY2hlZFVzZXIgPSB0aGlzLl91c2Vycy5nZXQoY29ubmVjdGlvbklkKTtcbiAgICBpZiAoY2FjaGVkVXNlcikge1xuICAgICAgcmV0dXJuIGNhY2hlZFVzZXI7XG4gICAgfVxuICAgIGNvbnN0IGNvbXB1dGVkVXNlciA9IHRoaXMuX2dldFVzZXIoY29ubmVjdGlvbklkKTtcbiAgICBpZiAoY29tcHV0ZWRVc2VyKSB7XG4gICAgICB0aGlzLl91c2Vycy5zZXQoY29ubmVjdGlvbklkLCBjb21wdXRlZFVzZXIpO1xuICAgICAgcmV0dXJuIGNvbXB1dGVkVXNlcjtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9pbnZhbGlkYXRlVXNlcihjb25uZWN0aW9uSWQpIHtcbiAgICBpZiAodGhpcy5fdXNlcnMuaGFzKGNvbm5lY3Rpb25JZCkpIHtcbiAgICAgIHRoaXMuX3VzZXJzLmRlbGV0ZShjb25uZWN0aW9uSWQpO1xuICAgIH1cbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgfVxuICAvKipcbiAgICogUmVjb3JkcyBhIGtub3duIGNvbm5lY3Rpb24uIFRoaXMgcmVjb3JkcyB0aGUgY29ubmVjdGlvbiBJRCBhbmQgdGhlXG4gICAqIGFzc29jaWF0ZWQgbWV0YWRhdGEuXG4gICAqL1xuICBzZXRDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCwgbWV0YVVzZXJJZCwgbWV0YVVzZXJJbmZvLCBzY29wZXMpIHtcbiAgICB0aGlzLl9jb25uZWN0aW9ucy5zZXQoXG4gICAgICBjb25uZWN0aW9uSWQsXG4gICAgICBmcmVlemUoe1xuICAgICAgICBjb25uZWN0aW9uSWQsXG4gICAgICAgIGlkOiBtZXRhVXNlcklkLFxuICAgICAgICBpbmZvOiBtZXRhVXNlckluZm8sXG4gICAgICAgIHNjb3Blc1xuICAgICAgfSlcbiAgICApO1xuICAgIGlmICh0aGlzLl9wcmVzZW5jZXMuaGFzKGNvbm5lY3Rpb25JZCkpIHtcbiAgICAgIHRoaXMuX2ludmFsaWRhdGVVc2VyKGNvbm5lY3Rpb25JZCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZW1vdmVzIGEga25vd24gY29ubmVjdGlvbklkLiBSZW1vdmVzIGJvdGggdGhlIGNvbm5lY3Rpb24ncyBtZXRhZGF0YSBhbmRcbiAgICogdGhlIHByZXNlbmNlIGluZm9ybWF0aW9uLlxuICAgKi9cbiAgcmVtb3ZlQ29ubmVjdGlvbihjb25uZWN0aW9uSWQpIHtcbiAgICB0aGlzLl9jb25uZWN0aW9ucy5kZWxldGUoY29ubmVjdGlvbklkKTtcbiAgICB0aGlzLl9wcmVzZW5jZXMuZGVsZXRlKGNvbm5lY3Rpb25JZCk7XG4gICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgfVxuICAvKipcbiAgICogU3RvcmVzIGEgbmV3IHVzZXIgZnJvbSBhIGZ1bGwgcHJlc2VuY2UgdXBkYXRlLiBJZiB0aGUgdXNlciBhbHJlYWR5IGV4aXN0cyxcbiAgICogaXRzIGtub3duIHByZXNlbmNlIGRhdGEgaXMgb3ZlcndyaXR0ZW4uXG4gICAqL1xuICBzZXRPdGhlcihjb25uZWN0aW9uSWQsIHByZXNlbmNlKSB7XG4gICAgdGhpcy5fcHJlc2VuY2VzLnNldChjb25uZWN0aW9uSWQsIGZyZWV6ZShjb21wYWN0T2JqZWN0KHByZXNlbmNlKSkpO1xuICAgIGlmICh0aGlzLl9jb25uZWN0aW9ucy5oYXMoY29ubmVjdGlvbklkKSkge1xuICAgICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFBhdGNoZXMgdGhlIHByZXNlbmNlIGRhdGEgZm9yIGFuIGV4aXN0aW5nIFwib3RoZXJcIi4gSWYgd2UgZG9uJ3Qga25vdyB0aGVcbiAgICogaW5pdGlhbCBwcmVzZW5jZSBkYXRhIGZvciB0aGlzIHVzZXIgeWV0LCBkaXNjYXJkIHRoaXMgcGF0Y2ggYW5kIGF3YWl0IHRoZVxuICAgKiBmdWxsIC5zZXRPdGhlcigpIGNhbGwgZmlyc3QuXG4gICAqL1xuICBwYXRjaE90aGVyKGNvbm5lY3Rpb25JZCwgcGF0Y2gpIHtcbiAgICBjb25zdCBvbGRQcmVzZW5jZSA9IHRoaXMuX3ByZXNlbmNlcy5nZXQoY29ubmVjdGlvbklkKTtcbiAgICBpZiAob2xkUHJlc2VuY2UgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBuZXdQcmVzZW5jZSA9IG1lcmdlKG9sZFByZXNlbmNlLCBwYXRjaCk7XG4gICAgaWYgKG9sZFByZXNlbmNlICE9PSBuZXdQcmVzZW5jZSkge1xuICAgICAgdGhpcy5fcHJlc2VuY2VzLnNldChjb25uZWN0aW9uSWQsIGZyZWV6ZShuZXdQcmVzZW5jZSkpO1xuICAgICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNyYy9yZWZzL1BhdGNoYWJsZVJlZi50c1xudmFyIFBhdGNoYWJsZVJlZiA9IGNsYXNzIGV4dGVuZHMgSW1tdXRhYmxlUmVmIHtcbiAgY29uc3RydWN0b3IoZGF0YSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YSA9IGZyZWV6ZShjb21wYWN0T2JqZWN0KGRhdGEpKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICAvKipcbiAgICogUGF0Y2hlcyB0aGUgY3VycmVudCBvYmplY3QuXG4gICAqL1xuICBwYXRjaChwYXRjaCkge1xuICAgIGNvbnN0IG9sZERhdGEgPSB0aGlzLl9kYXRhO1xuICAgIGNvbnN0IG5ld0RhdGEgPSBtZXJnZShvbGREYXRhLCBwYXRjaCk7XG4gICAgaWYgKG9sZERhdGEgIT09IG5ld0RhdGEpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBmcmVlemUobmV3RGF0YSk7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNyYy9yZWZzL1ZhbHVlUmVmLnRzXG52YXIgVmFsdWVSZWYgPSBjbGFzcyBleHRlbmRzIEltbXV0YWJsZVJlZiB7XG4gIGNvbnN0cnVjdG9yKGluaXRpYWxWYWx1ZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fdmFsdWUgPSBmcmVlemUoaW5pdGlhbFZhbHVlKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cbiAgc2V0KG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5fdmFsdWUgPSBmcmVlemUobmV3VmFsdWUpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG59O1xudmFyIERlcml2ZWRSZWYgPSBjbGFzcyBleHRlbmRzIEltbXV0YWJsZVJlZiB7XG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICBzdXBlcigpO1xuICAgIGNvbnN0IHRyYW5zZm9ybUZuID0gYXJncy5wb3AoKTtcbiAgICBjb25zdCBvdGhlclJlZnMgPSBhcmdzO1xuICAgIHRoaXMuX3JlZnMgPSBvdGhlclJlZnM7XG4gICAgdGhpcy5fcmVmcy5mb3JFYWNoKChyZWYpID0+IHtcbiAgICAgIHJlZi5kaWRJbnZhbGlkYXRlLnN1YnNjcmliZSgoKSA9PiB0aGlzLmludmFsaWRhdGUoKSk7XG4gICAgfSk7XG4gICAgdGhpcy5fdHJhbnNmb3JtID0gdHJhbnNmb3JtRm47XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9JbW11dGFibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RyYW5zZm9ybShcbiAgICAgIC4uLnRoaXMuX3JlZnMubWFwKChyZWYpID0+IHJlZi5jdXJyZW50KVxuICAgICk7XG4gIH1cbn07XG5cbi8vIHNyYy9yb29tLnRzXG52YXIgTUFYX1NPQ0tFVF9NRVNTQUdFX1NJWkUgPSAxMDI0ICogMTAyNCAtIDEwMjQ7XG5mdW5jdGlvbiBtYWtlSWRGYWN0b3J5KGNvbm5lY3Rpb25JZCkge1xuICBsZXQgY291bnQgPSAwO1xuICByZXR1cm4gKCkgPT4gYCR7Y29ubmVjdGlvbklkfToke2NvdW50Kyt9YDtcbn1cbmZ1bmN0aW9uIHVzZXJUb1RyZWVOb2RlKGtleSwgdXNlcikge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiVXNlclwiLFxuICAgIGlkOiBgJHt1c2VyLmNvbm5lY3Rpb25JZH1gLFxuICAgIGtleSxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBjb25uZWN0aW9uSWQ6IHVzZXIuY29ubmVjdGlvbklkLFxuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICBpbmZvOiB1c2VyLmluZm8sXG4gICAgICBwcmVzZW5jZTogdXNlci5wcmVzZW5jZSxcbiAgICAgIGlzUmVhZE9ubHk6ICF1c2VyLmNhbldyaXRlXG4gICAgfVxuICB9O1xufVxuZnVuY3Rpb24gaW5zdGFsbEJhY2tncm91bmRUYWJTcHkoKSB7XG4gIGNvbnN0IGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGRvY3VtZW50IDogdm9pZCAwO1xuICBjb25zdCBpbkJhY2tncm91bmRTaW5jZSA9IHsgY3VycmVudDogbnVsbCB9O1xuICBmdW5jdGlvbiBvblZpc2liaWxpdHlDaGFuZ2UoKSB7XG4gICAgaWYgKGRvYz8udmlzaWJpbGl0eVN0YXRlID09PSBcImhpZGRlblwiKSB7XG4gICAgICBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ID0gaW5CYWNrZ3JvdW5kU2luY2UuY3VycmVudCA/PyBEYXRlLm5vdygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ID0gbnVsbDtcbiAgICB9XG4gIH1cbiAgZG9jPy5hZGRFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCBvblZpc2liaWxpdHlDaGFuZ2UpO1xuICBjb25zdCB1bnN1YiA9ICgpID0+IHtcbiAgICBkb2M/LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIG9uVmlzaWJpbGl0eUNoYW5nZSk7XG4gIH07XG4gIHJldHVybiBbaW5CYWNrZ3JvdW5kU2luY2UsIHVuc3ViXTtcbn1cbnZhciBDb21tZW50c0FwaUVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHN0YXR1cywgZGV0YWlscykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgdGhpcy5kZXRhaWxzID0gZGV0YWlscztcbiAgfVxufTtcbmZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnRzQXBpKHJvb21JZCwgZ2V0QXV0aFZhbHVlLCBmZXRjaENsaWVudEFwaSkge1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaENvbW1lbnRzQXBpKGVuZHBvaW50LCBwYXJhbXMsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBnZXRBdXRoVmFsdWUoKTtcbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkocm9vbUlkLCBlbmRwb2ludCwgYXV0aFZhbHVlLCBvcHRpb25zLCBwYXJhbXMpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGZldGNoSnNvbihlbmRwb2ludCwgb3B0aW9ucywgcGFyYW1zKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKGVuZHBvaW50LCBwYXJhbXMsIG9wdGlvbnMpO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gNDAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDYwMCkge1xuICAgICAgICBsZXQgZXJyb3IzO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGVycm9yQm9keSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgQ29tbWVudHNBcGlFcnJvcihcbiAgICAgICAgICAgIGVycm9yQm9keS5tZXNzYWdlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgZXJyb3JCb2R5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IENvbW1lbnRzQXBpRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCwgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJvcjM7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBib2R5O1xuICAgIHRyeSB7XG4gICAgICBib2R5ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgYm9keSA9IHt9O1xuICAgIH1cbiAgICByZXR1cm4gYm9keTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRUaHJlYWRzU2luY2Uob3B0aW9ucykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hDb21tZW50c0FwaShcbiAgICAgIFwiL3RocmVhZHNcIixcbiAgICAgIHtcbiAgICAgICAgc2luY2U6IG9wdGlvbnM/LnNpbmNlPy50b0lTT1N0cmluZygpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgIHVwZGF0ZWQ6IGpzb24uZGF0YS5tYXAoY29udmVydFRvVGhyZWFkRGF0YSksXG4gICAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkVGhyZWFkcy5tYXAoY29udmVydFRvVGhyZWFkRGVsZXRlSW5mbylcbiAgICAgICAgfSxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiB7XG4gICAgICAgICAgdXBkYXRlZDoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YSksXG4gICAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkSW5ib3hOb3RpZmljYXRpb25zLm1hcChcbiAgICAgICAgICAgIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGVsZXRlSW5mb1xuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKGpzb24ubWV0YS5yZXF1ZXN0ZWRBdClcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgIHVwZGF0ZWQ6IFtdLFxuICAgICAgICAgIGRlbGV0ZWQ6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uczoge1xuICAgICAgICAgIHVwZGF0ZWQ6IFtdLFxuICAgICAgICAgIGRlbGV0ZWQ6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVlc3RlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhyZWFkcy5cIik7XG4gICAgfVxuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldFRocmVhZHMob3B0aW9ucykge1xuICAgIGxldCBxdWVyeTtcbiAgICBpZiAob3B0aW9ucz8ucXVlcnkpIHtcbiAgICAgIHF1ZXJ5ID0gb2JqZWN0VG9RdWVyeShvcHRpb25zLnF1ZXJ5KTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKFxuICAgICAgXCIvdGhyZWFkc1wiLFxuICAgICAge1xuICAgICAgICBxdWVyeVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZHM6IGpzb24uZGF0YS5tYXAoY29udmVydFRvVGhyZWFkRGF0YSksXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uczoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKFxuICAgICAgICAgIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YVxuICAgICAgICApLFxuICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoanNvbi5tZXRhLnJlcXVlc3RlZEF0KVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWRzOiBbXSxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBbXSxcbiAgICAgICAgZGVsZXRlZFRocmVhZHM6IFtdLFxuICAgICAgICBkZWxldGVkSW5ib3hOb3RpZmljYXRpb25zOiBbXSxcbiAgICAgICAgcmVxdWVzdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aHJlYWRzLlwiKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0VGhyZWFkKHRocmVhZElkKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKFxuICAgICAgYC90aHJlYWQtd2l0aC1ub3RpZmljYXRpb24vJHt0aHJlYWRJZH1gXG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWQ6IGNvbnZlcnRUb1RocmVhZERhdGEoanNvbi50aHJlYWQpLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbjoganNvbi5pbmJveE5vdGlmaWNhdGlvbiA/IGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YShqc29uLmluYm94Tm90aWZpY2F0aW9uKSA6IHZvaWQgMFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWQ6IHZvaWQgMCxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb246IHZvaWQgMFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aHJlYWQgJHt0aHJlYWRJZH0uYCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRocmVhZCh7XG4gICAgbWV0YWRhdGEsXG4gICAgYm9keSxcbiAgICBjb21tZW50SWQgPSBjcmVhdGVDb21tZW50SWQoKSxcbiAgICB0aHJlYWRJZCA9IGNyZWF0ZVRocmVhZElkKClcbiAgfSkge1xuICAgIGNvbnN0IHRocmVhZCA9IGF3YWl0IGZldGNoSnNvbihcIi90aHJlYWRzXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBpZDogdGhyZWFkSWQsXG4gICAgICAgIGNvbW1lbnQ6IHtcbiAgICAgICAgICBpZDogY29tbWVudElkLFxuICAgICAgICAgIGJvZHlcbiAgICAgICAgfSxcbiAgICAgICAgbWV0YWRhdGFcbiAgICAgIH0pXG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb1RocmVhZERhdGEodGhyZWFkKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBkZWxldGVUaHJlYWQodGhyZWFkSWQpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCJcbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBlZGl0VGhyZWFkTWV0YWRhdGEoe1xuICAgIG1ldGFkYXRhLFxuICAgIHRocmVhZElkXG4gIH0pIHtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vbWV0YWRhdGFgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEpXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrVGhyZWFkQXNSZXNvbHZlZCh0aHJlYWRJZCkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L21hcmstYXMtcmVzb2x2ZWRgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrVGhyZWFkQXNVbnJlc29sdmVkKHRocmVhZElkKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vbWFyay1hcy11bnJlc29sdmVkYCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIlxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29tbWVudCh7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkID0gY3JlYXRlQ29tbWVudElkKCksXG4gICAgYm9keVxuICB9KSB7XG4gICAgY29uc3QgY29tbWVudCA9IGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzYCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBpZDogY29tbWVudElkLFxuICAgICAgICAgIGJvZHlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBjb252ZXJ0VG9Db21tZW50RGF0YShjb21tZW50KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBlZGl0Q29tbWVudCh7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkLFxuICAgIGJvZHlcbiAgfSkge1xuICAgIGNvbnN0IGNvbW1lbnQgPSBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9jb21tZW50cy8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgY29tbWVudElkXG4gICAgICApfWAsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgYm9keVxuICAgICAgICB9KVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnREYXRhKGNvbW1lbnQpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQyKHtcbiAgICB0aHJlYWRJZCxcbiAgICBjb21tZW50SWRcbiAgfSkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICBjb21tZW50SWRcbiAgICAgICl9YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBhZGRSZWFjdGlvbjIoe1xuICAgIHRocmVhZElkLFxuICAgIGNvbW1lbnRJZCxcbiAgICBlbW9qaVxuICB9KSB7XG4gICAgY29uc3QgcmVhY3Rpb24gPSBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9jb21tZW50cy8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgY29tbWVudElkXG4gICAgICApfS9yZWFjdGlvbnNgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlbW9qaSB9KVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnRVc2VyUmVhY3Rpb24ocmVhY3Rpb24pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHJlbW92ZVJlYWN0aW9uMih7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkLFxuICAgIGVtb2ppXG4gIH0pIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9jb21tZW50cy8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgY29tbWVudElkXG4gICAgICApfS9yZWFjdGlvbnMvJHtlbmNvZGVVUklDb21wb25lbnQoZW1vamkpfWAsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBnZXRUaHJlYWRzLFxuICAgIGdldFRocmVhZHNTaW5jZSxcbiAgICBnZXRUaHJlYWQsXG4gICAgY3JlYXRlVGhyZWFkLFxuICAgIGRlbGV0ZVRocmVhZCxcbiAgICBlZGl0VGhyZWFkTWV0YWRhdGEsXG4gICAgbWFya1RocmVhZEFzUmVzb2x2ZWQsXG4gICAgbWFya1RocmVhZEFzVW5yZXNvbHZlZCxcbiAgICBjcmVhdGVDb21tZW50LFxuICAgIGVkaXRDb21tZW50LFxuICAgIGRlbGV0ZUNvbW1lbnQ6IGRlbGV0ZUNvbW1lbnQyLFxuICAgIGFkZFJlYWN0aW9uOiBhZGRSZWFjdGlvbjIsXG4gICAgcmVtb3ZlUmVhY3Rpb246IHJlbW92ZVJlYWN0aW9uMlxuICB9O1xufVxudmFyIE1BUktfSU5CT1hfTk9USUZJQ0FUSU9OU19BU19SRUFEX0JBVENIX0RFTEFZMiA9IDUwO1xuZnVuY3Rpb24gY3JlYXRlUm9vbShvcHRpb25zLCBjb25maWcpIHtcbiAgY29uc3QgaW5pdGlhbFByZXNlbmNlID0gb3B0aW9ucy5pbml0aWFsUHJlc2VuY2U7XG4gIGNvbnN0IGluaXRpYWxTdG9yYWdlID0gb3B0aW9ucy5pbml0aWFsU3RvcmFnZTtcbiAgY29uc3QgW2luQmFja2dyb3VuZFNpbmNlLCB1bmluc3RhbGxCZ1RhYlNweV0gPSBpbnN0YWxsQmFja2dyb3VuZFRhYlNweSgpO1xuICBjb25zdCBkZWxlZ2F0ZXMgPSB7XG4gICAgLi4uY29uZmlnLmRlbGVnYXRlcyxcbiAgICAvLyBBIGNvbm5lY3Rpb24gaXMgYWxsb3dlZCB0byBnbyBpbnRvIFwiem9tYmllIHN0YXRlXCIgb25seSBpZiBhbGwgb2YgdGhlXG4gICAgLy8gZm9sbG93aW5nIGNvbmRpdGlvbnMgYXBwbHk6XG4gICAgLy9cbiAgICAvLyAtIFRoZSBgYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXRgIGNsaWVudCBvcHRpb24gaXMgY29uZmlndXJlZFxuICAgIC8vIC0gVGhlIGJyb3dzZXIgd2luZG93IGhhcyBiZWVuIGluIHRoZSBiYWNrZ3JvdW5kIGZvciBhdCBsZWFzdFxuICAgIC8vICAgYGJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0YCBtaWxsaXNlY29uZHNcbiAgICAvLyAtIFRoZXJlIGFyZSBubyBwZW5kaW5nIGNoYW5nZXNcbiAgICAvL1xuICAgIGNhblpvbWJpZSgpIHtcbiAgICAgIHJldHVybiBjb25maWcuYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQgIT09IHZvaWQgMCAmJiBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ICE9PSBudWxsICYmIERhdGUubm93KCkgPiBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ICsgY29uZmlnLmJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0ICYmIGdldFN0b3JhZ2VTdGF0dXMoKSAhPT0gXCJzeW5jaHJvbml6aW5nXCI7XG4gICAgfVxuICB9O1xuICBjb25zdCBtYW5hZ2VkU29ja2V0ID0gbmV3IE1hbmFnZWRTb2NrZXQoXG4gICAgZGVsZWdhdGVzLFxuICAgIGNvbmZpZy5lbmFibGVEZWJ1Z0xvZ2dpbmdcbiAgKTtcbiAgY29uc3QgY29udGV4dCA9IHtcbiAgICBidWZmZXI6IHtcbiAgICAgIGZsdXNoVGltZXJJRDogdm9pZCAwLFxuICAgICAgbGFzdEZsdXNoZWRBdDogMCxcbiAgICAgIHByZXNlbmNlVXBkYXRlczogKFxuICAgICAgICAvLyBRdWV1ZSB1cCB0aGUgaW5pdGlhbCBwcmVzZW5jZSBtZXNzYWdlIGFzIGEgRnVsbCBQcmVzZW5jZeKEoiB1cGRhdGVcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IFwiZnVsbFwiLFxuICAgICAgICAgIGRhdGE6IGluaXRpYWxQcmVzZW5jZVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgbWVzc2FnZXM6IFtdLFxuICAgICAgc3RvcmFnZU9wZXJhdGlvbnM6IFtdXG4gICAgfSxcbiAgICBzdGF0aWNTZXNzaW9uSW5mbzogbmV3IFZhbHVlUmVmKG51bGwpLFxuICAgIGR5bmFtaWNTZXNzaW9uSW5mbzogbmV3IFZhbHVlUmVmKG51bGwpLFxuICAgIG15UHJlc2VuY2U6IG5ldyBQYXRjaGFibGVSZWYoaW5pdGlhbFByZXNlbmNlKSxcbiAgICBvdGhlcnM6IG5ldyBPdGhlcnNSZWYoKSxcbiAgICBpbml0aWFsU3RvcmFnZSxcbiAgICBpZEZhY3Rvcnk6IG51bGwsXG4gICAgLy8gU3RvcmFnZVxuICAgIGNsb2NrOiAwLFxuICAgIG9wQ2xvY2s6IDAsXG4gICAgbm9kZXM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksXG4gICAgcm9vdDogdm9pZCAwLFxuICAgIHVuZG9TdGFjazogW10sXG4gICAgcmVkb1N0YWNrOiBbXSxcbiAgICBwYXVzZWRIaXN0b3J5OiBudWxsLFxuICAgIGFjdGl2ZUJhdGNoOiBudWxsLFxuICAgIHVuYWNrbm93bGVkZ2VkT3BzOiAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLFxuICAgIC8vIERlYnVnXG4gICAgb3BTdGFja1RyYWNlczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiID8gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSA6IHZvaWQgMFxuICB9O1xuICBjb25zdCBkb05vdEJhdGNoVXBkYXRlcyA9IChjYikgPT4gY2IoKTtcbiAgY29uc3QgYmF0Y2hVcGRhdGVzID0gY29uZmlnLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzID8/IGRvTm90QmF0Y2hVcGRhdGVzO1xuICBsZXQgbGFzdFRva2VuS2V5O1xuICBmdW5jdGlvbiBvblN0YXR1c0RpZENoYW5nZShuZXdTdGF0dXMpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBtYW5hZ2VkU29ja2V0LmF1dGhWYWx1ZTtcbiAgICBpZiAoYXV0aFZhbHVlICE9PSBudWxsKSB7XG4gICAgICBjb25zdCB0b2tlbktleSA9IGdldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSk7XG4gICAgICBpZiAodG9rZW5LZXkgIT09IGxhc3RUb2tlbktleSkge1xuICAgICAgICBsYXN0VG9rZW5LZXkgPSB0b2tlbktleTtcbiAgICAgICAgaWYgKGF1dGhWYWx1ZS50eXBlID09PSBcInNlY3JldFwiKSB7XG4gICAgICAgICAgY29uc3QgdG9rZW4gPSBhdXRoVmFsdWUudG9rZW4ucGFyc2VkO1xuICAgICAgICAgIGNvbnRleHQuc3RhdGljU2Vzc2lvbkluZm8uc2V0KHtcbiAgICAgICAgICAgIHVzZXJJZDogdG9rZW4uayA9PT0gXCJzZWMtbGVnYWN5XCIgLyogU0VDUkVUX0xFR0FDWSAqLyA/IHRva2VuLmlkIDogdG9rZW4udWlkLFxuICAgICAgICAgICAgdXNlckluZm86IHRva2VuLmsgPT09IFwic2VjLWxlZ2FjeVwiIC8qIFNFQ1JFVF9MRUdBQ1kgKi8gPyB0b2tlbi5pbmZvIDogdG9rZW4udWlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb250ZXh0LnN0YXRpY1Nlc3Npb25JbmZvLnNldCh7XG4gICAgICAgICAgICB1c2VySWQ6IHZvaWQgMCxcbiAgICAgICAgICAgIHVzZXJJbmZvOiB2b2lkIDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgZXZlbnRIdWIuc3RhdHVzLm5vdGlmeShuZXdTdGF0dXMpO1xuICAgICAgbm90aWZ5U2VsZkNoYW5nZWQoZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgIH0pO1xuICB9XG4gIGxldCBfY29ubmVjdGlvbkxvc3NUaW1lcklkO1xuICBsZXQgX2hhc0xvc3RDb25uZWN0aW9uID0gZmFsc2U7XG4gIGZ1bmN0aW9uIGhhbmRsZUNvbm5lY3Rpb25Mb3NzRXZlbnQobmV3U3RhdHVzKSB7XG4gICAgaWYgKG5ld1N0YXR1cyA9PT0gXCJyZWNvbm5lY3RpbmdcIikge1xuICAgICAgX2Nvbm5lY3Rpb25Mb3NzVGltZXJJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgICAgIGV2ZW50SHViLmxvc3RDb25uZWN0aW9uLm5vdGlmeShcImxvc3RcIik7XG4gICAgICAgICAgX2hhc0xvc3RDb25uZWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgICBjb250ZXh0Lm90aGVycy5jbGVhck90aGVycygpO1xuICAgICAgICAgIG5vdGlmeSh7IG90aGVyczogW3sgdHlwZTogXCJyZXNldFwiIH1dIH0sIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBjb25maWcubG9zdENvbm5lY3Rpb25UaW1lb3V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2xlYXJUaW1lb3V0KF9jb25uZWN0aW9uTG9zc1RpbWVySWQpO1xuICAgICAgaWYgKF9oYXNMb3N0Q29ubmVjdGlvbikge1xuICAgICAgICBpZiAobmV3U3RhdHVzID09PSBcImRpc2Nvbm5lY3RlZFwiKSB7XG4gICAgICAgICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgICAgICAgIGV2ZW50SHViLmxvc3RDb25uZWN0aW9uLm5vdGlmeShcImZhaWxlZFwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgICAgICAgZXZlbnRIdWIubG9zdENvbm5lY3Rpb24ubm90aWZ5KFwicmVzdG9yZWRcIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgX2hhc0xvc3RDb25uZWN0aW9uID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIG9uRGlkQ29ubmVjdCgpIHtcbiAgICBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPSB7XG4gICAgICB0eXBlOiBcImZ1bGxcIixcbiAgICAgIGRhdGE6IChcbiAgICAgICAgLy8gQmVjYXVzZSBjb250ZXh0Lm1lLmN1cnJlbnQgaXMgYSByZWFkb25seSBvYmplY3QsIHdlJ2xsIGhhdmUgdG9cbiAgICAgICAgLy8gbWFrZSBhIGNvcHkgaGVyZS4gT3RoZXJ3aXNlLCB0eXBlIGVycm9ycyBoYXBwZW4gbGF0ZXIgd2hlblxuICAgICAgICAvLyBcInBhdGNoaW5nXCIgbXkgcHJlc2VuY2UuXG4gICAgICAgIHsgLi4uY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnQgfVxuICAgICAgKVxuICAgIH07XG4gICAgaWYgKF9nZXRTdG9yYWdlJCAhPT0gbnVsbCkge1xuICAgICAgcmVmcmVzaFN0b3JhZ2UoeyBmbHVzaDogZmFsc2UgfSk7XG4gICAgfVxuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gb25EaWREaXNjb25uZWN0KCkge1xuICAgIGNsZWFyVGltZW91dChjb250ZXh0LmJ1ZmZlci5mbHVzaFRpbWVySUQpO1xuICB9XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLm9uTWVzc2FnZS5zdWJzY3JpYmUoaGFuZGxlU2VydmVyTWVzc2FnZSk7XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLnN0YXR1c0RpZENoYW5nZS5zdWJzY3JpYmUob25TdGF0dXNEaWRDaGFuZ2UpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5zdGF0dXNEaWRDaGFuZ2Uuc3Vic2NyaWJlKGhhbmRsZUNvbm5lY3Rpb25Mb3NzRXZlbnQpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5kaWRDb25uZWN0LnN1YnNjcmliZShvbkRpZENvbm5lY3QpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5kaWREaXNjb25uZWN0LnN1YnNjcmliZShvbkRpZERpc2Nvbm5lY3QpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5vbkxpdmVibG9ja3NFcnJvci5zdWJzY3JpYmUoKGVycikgPT4ge1xuICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgIGVycm9yMihcbiAgICAgICAgICBgQ29ubmVjdGlvbiB0byB3ZWJzb2NrZXQgc2VydmVyIGNsb3NlZC4gUmVhc29uOiAke2Vyci5tZXNzYWdlfSAoY29kZTogJHtlcnIuY29kZX0pLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGV2ZW50SHViLmVycm9yLm5vdGlmeShlcnIpO1xuICAgIH0pO1xuICB9KTtcbiAgY29uc3QgcG9vbCA9IHtcbiAgICByb29tSWQ6IGNvbmZpZy5yb29tSWQsXG4gICAgZ2V0Tm9kZTogKGlkKSA9PiBjb250ZXh0Lm5vZGVzLmdldChpZCksXG4gICAgYWRkTm9kZTogKGlkLCBub2RlKSA9PiB2b2lkIGNvbnRleHQubm9kZXMuc2V0KGlkLCBub2RlKSxcbiAgICBkZWxldGVOb2RlOiAoaWQpID0+IHZvaWQgY29udGV4dC5ub2Rlcy5kZWxldGUoaWQpLFxuICAgIGdlbmVyYXRlSWQ6ICgpID0+IGAke2dldENvbm5lY3Rpb25JZCgpfToke2NvbnRleHQuY2xvY2srK31gLFxuICAgIGdlbmVyYXRlT3BJZDogKCkgPT4gYCR7Z2V0Q29ubmVjdGlvbklkKCl9OiR7Y29udGV4dC5vcENsb2NrKyt9YCxcbiAgICBkaXNwYXRjaChvcHMsIHJldmVyc2UsIHN0b3JhZ2VVcGRhdGVzKSB7XG4gICAgICBjb25zdCBhY3RpdmVCYXRjaCA9IGNvbnRleHQuYWN0aXZlQmF0Y2g7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrVHJhY2UgPSBjYXB0dXJlU3RhY2tUcmFjZShcIlN0b3JhZ2UgbXV0YXRpb25cIiwgdGhpcy5kaXNwYXRjaCk7XG4gICAgICAgIGlmIChzdGFja1RyYWNlKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgICAgICAgIGlmIChvcC5vcElkKSB7XG4gICAgICAgICAgICAgIG5uKGNvbnRleHQub3BTdGFja1RyYWNlcykuc2V0KG9wLm9wSWQsIHN0YWNrVHJhY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGFjdGl2ZUJhdGNoKSB7XG4gICAgICAgIGZvciAoY29uc3Qgb3Agb2Ygb3BzKSB7XG4gICAgICAgICAgYWN0aXZlQmF0Y2gub3BzLnB1c2gob3ApO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHN0b3JhZ2VVcGRhdGVzKSB7XG4gICAgICAgICAgYWN0aXZlQmF0Y2gudXBkYXRlcy5zdG9yYWdlVXBkYXRlcy5zZXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBtZXJnZVN0b3JhZ2VVcGRhdGVzKFxuICAgICAgICAgICAgICBhY3RpdmVCYXRjaC51cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLmdldChrZXkpLFxuICAgICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgYWN0aXZlQmF0Y2gucmV2ZXJzZU9wcy51bnNoaWZ0KC4uLnJldmVyc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgICAgICBhZGRUb1VuZG9TdGFjayhyZXZlcnNlLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICAgICAgY29udGV4dC5yZWRvU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgICBkaXNwYXRjaE9wcyhvcHMpO1xuICAgICAgICAgIG5vdGlmeSh7IHN0b3JhZ2VVcGRhdGVzIH0sIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBhc3NlcnRTdG9yYWdlSXNXcml0YWJsZTogKCkgPT4ge1xuICAgICAgY29uc3Qgc2NvcGVzID0gY29udGV4dC5keW5hbWljU2Vzc2lvbkluZm8uY3VycmVudD8uc2NvcGVzO1xuICAgICAgaWYgKHNjb3BlcyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNhbldyaXRlID0gY2FuV3JpdGVTdG9yYWdlKHNjb3Blcyk7XG4gICAgICBpZiAoIWNhbldyaXRlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkNhbm5vdCB3cml0ZSB0byBzdG9yYWdlIHdpdGggYSByZWFkIG9ubHkgdXNlciwgcGxlYXNlIGVuc3VyZSB0aGUgdXNlciBoYXMgd3JpdGUgcGVybWlzc2lvbnNcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgZXZlbnRIdWIgPSB7XG4gICAgc3RhdHVzOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICAvLyBOZXcvcmVjb21tZW5kZWQgQVBJXG4gICAgbG9zdENvbm5lY3Rpb246IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGN1c3RvbUV2ZW50OiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBzZWxmOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBteVByZXNlbmNlOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBvdGhlcnM6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGVycm9yOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBzdG9yYWdlQmF0Y2g6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGhpc3Rvcnk6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIHN0b3JhZ2VEaWRMb2FkOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBzdG9yYWdlU3RhdHVzOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICB5ZG9jOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBjb21tZW50czogbWFrZUV2ZW50U291cmNlKClcbiAgfTtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hDbGllbnRBcGkocm9vbUlkLCBlbmRwb2ludCwgYXV0aFZhbHVlLCBvcHRpb25zMiwgcGFyYW1zKSB7XG4gICAgY29uc3QgdXJsID0gdXJsam9pbihcbiAgICAgIGNvbmZpZy5iYXNlVXJsLFxuICAgICAgYC92Mi9jL3Jvb21zLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHJvb21JZCl9JHtlbmRwb2ludH1gLFxuICAgICAgcGFyYW1zXG4gICAgKTtcbiAgICBjb25zdCBmZXRjaGVyID0gY29uZmlnLnBvbHlmaWxscz8uZmV0Y2ggfHwgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBmZXRjaDtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2hlcih1cmwsIHtcbiAgICAgIC4uLm9wdGlvbnMyLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAuLi5vcHRpb25zMj8uaGVhZGVycyxcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2dldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSl9YFxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHN0cmVhbUZldGNoKGF1dGhWYWx1ZSwgcm9vbUlkKSB7XG4gICAgcmV0dXJuIGZldGNoQ2xpZW50QXBpKHJvb21JZCwgXCIvc3RvcmFnZVwiLCBhdXRoVmFsdWUsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBodHRwUG9zdFRvUm9vbShlbmRwb2ludCwgYm9keSkge1xuICAgIGlmICghbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhdXRob3JpemVkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkoY29uZmlnLnJvb21JZCwgZW5kcG9pbnQsIG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGV4dE1lbnRpb24odXNlcklkLCBtZW50aW9uSWQpIHtcbiAgICBpZiAoIW1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgYXV0aG9yaXplZFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZldGNoQ2xpZW50QXBpKFxuICAgICAgY29uZmlnLnJvb21JZCxcbiAgICAgIFwiL3RleHQtbWVudGlvbnNcIixcbiAgICAgIG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBtZW50aW9uSWRcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRleHRNZW50aW9uKG1lbnRpb25JZCkge1xuICAgIGlmICghbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhdXRob3JpemVkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkoXG4gICAgICBjb25maWcucm9vbUlkLFxuICAgICAgYC90ZXh0LW1lbnRpb25zLyR7bWVudGlvbklkfWAsXG4gICAgICBtYW5hZ2VkU29ja2V0LmF1dGhWYWx1ZSxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiByZXBvcnRUZXh0RWRpdG9yKHR5cGUsIHJvb3RLZXkpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBkZWxlZ2F0ZXMuYXV0aGVudGljYXRlKCk7XG4gICAgcmV0dXJuIGZldGNoQ2xpZW50QXBpKGNvbmZpZy5yb29tSWQsIFwiL3RleHQtbWV0YWRhdGFcIiwgYXV0aFZhbHVlLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcm9vdEtleVxuICAgICAgfSlcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBzZW5kTWVzc2FnZXMobWVzc2FnZXMpIHtcbiAgICBjb25zdCBzZXJpYWxpemVkUGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VzKTtcbiAgICBjb25zdCBub25jZSA9IGNvbnRleHQuZHluYW1pY1Nlc3Npb25JbmZvLmN1cnJlbnQ/Lm5vbmNlO1xuICAgIGlmIChjb25maWcudW5zdGFibGVfZmFsbGJhY2tUb0hUVFAgJiYgbm9uY2UpIHtcbiAgICAgIGNvbnN0IHNpemUgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc2VyaWFsaXplZFBheWxvYWQpLmxlbmd0aDtcbiAgICAgIGlmIChzaXplID4gTUFYX1NPQ0tFVF9NRVNTQUdFX1NJWkUpIHtcbiAgICAgICAgdm9pZCBodHRwUG9zdFRvUm9vbShcIi9zZW5kLW1lc3NhZ2VcIiwgeyBub25jZSwgbWVzc2FnZXMgfSkudGhlbihcbiAgICAgICAgICAocmVzcCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFyZXNwLm9rICYmIHJlc3Auc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgICAgICAgbWFuYWdlZFNvY2tldC5yZWNvbm5lY3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHdhcm4oXG4gICAgICAgICAgXCJNZXNzYWdlIHdhcyB0b28gbGFyZ2UgZm9yIHdlYnNvY2tldHMgYW5kIHNlbnQgb3ZlciBIVFRQIGluc3RlYWRcIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIG1hbmFnZWRTb2NrZXQuc2VuZChzZXJpYWxpemVkUGF5bG9hZCk7XG4gIH1cbiAgY29uc3Qgc2VsZiA9IG5ldyBEZXJpdmVkUmVmKFxuICAgIGNvbnRleHQuc3RhdGljU2Vzc2lvbkluZm8sXG4gICAgY29udGV4dC5keW5hbWljU2Vzc2lvbkluZm8sXG4gICAgY29udGV4dC5teVByZXNlbmNlLFxuICAgIChzdGF0aWNTZXNzaW9uLCBkeW5hbWljU2Vzc2lvbiwgbXlQcmVzZW5jZSkgPT4ge1xuICAgICAgaWYgKHN0YXRpY1Nlc3Npb24gPT09IG51bGwgfHwgZHluYW1pY1Nlc3Npb24gPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjYW5Xcml0ZSA9IGNhbldyaXRlU3RvcmFnZShkeW5hbWljU2Vzc2lvbi5zY29wZXMpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvbm5lY3Rpb25JZDogZHluYW1pY1Nlc3Npb24uYWN0b3IsXG4gICAgICAgICAgaWQ6IHN0YXRpY1Nlc3Npb24udXNlcklkLFxuICAgICAgICAgIGluZm86IHN0YXRpY1Nlc3Npb24udXNlckluZm8sXG4gICAgICAgICAgcHJlc2VuY2U6IG15UHJlc2VuY2UsXG4gICAgICAgICAgY2FuV3JpdGUsXG4gICAgICAgICAgY2FuQ29tbWVudDogY2FuQ29tbWVudChkeW5hbWljU2Vzc2lvbi5zY29wZXMpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICApO1xuICBsZXQgX2xhc3RTZWxmO1xuICBmdW5jdGlvbiBub3RpZnlTZWxmQ2hhbmdlZChiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBjb25zdCBjdXJyU2VsZiA9IHNlbGYuY3VycmVudDtcbiAgICBpZiAoY3VyclNlbGYgIT09IG51bGwgJiYgY3VyclNlbGYgIT09IF9sYXN0U2VsZikge1xuICAgICAgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKCgpID0+IHtcbiAgICAgICAgZXZlbnRIdWIuc2VsZi5ub3RpZnkoY3VyclNlbGYpO1xuICAgICAgfSk7XG4gICAgICBfbGFzdFNlbGYgPSBjdXJyU2VsZjtcbiAgICB9XG4gIH1cbiAgY29uc3Qgc2VsZkFzVHJlZU5vZGUgPSBuZXcgRGVyaXZlZFJlZihcbiAgICBzZWxmLFxuICAgIChtZSkgPT4gbWUgIT09IG51bGwgPyB1c2VyVG9UcmVlTm9kZShcIk1lXCIsIG1lKSA6IG51bGxcbiAgKTtcbiAgZnVuY3Rpb24gY3JlYXRlT3JVcGRhdGVSb290RnJvbU1lc3NhZ2UobWVzc2FnZSwgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgaWYgKG1lc3NhZ2UuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnRlcm5hbCBlcnJvcjogY2Fubm90IGxvYWQgc3RvcmFnZSB3aXRob3V0IGl0ZW1zXCIpO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5yb290ICE9PSB2b2lkIDApIHtcbiAgICAgIHVwZGF0ZVJvb3QobWVzc2FnZS5pdGVtcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGV4dC5yb290ID0gTGl2ZU9iamVjdC5fZnJvbUl0ZW1zKG1lc3NhZ2UuaXRlbXMsIHBvb2wpO1xuICAgIH1cbiAgICBjb25zdCBjYW5Xcml0ZSA9IHNlbGYuY3VycmVudD8uY2FuV3JpdGUgPz8gdHJ1ZTtcbiAgICBjb25zdCBzdGFja1NpemVCZWZvcmUgPSBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGg7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gY29udGV4dC5pbml0aWFsU3RvcmFnZSkge1xuICAgICAgaWYgKGNvbnRleHQucm9vdC5nZXQoa2V5KSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGlmIChjYW5Xcml0ZSkge1xuICAgICAgICAgIGNvbnRleHQucm9vdC5zZXQoa2V5LCBjbG9uZUxzb24oY29udGV4dC5pbml0aWFsU3RvcmFnZVtrZXldKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2FybihcbiAgICAgICAgICAgIGBBdHRlbXB0ZWQgdG8gcG9wdWxhdGUgbWlzc2luZyBzdG9yYWdlIGtleSAnJHtrZXl9JywgYnV0IGN1cnJlbnQgdXNlciBoYXMgbm8gd3JpdGUgYWNjZXNzYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY29udGV4dC51bmRvU3RhY2subGVuZ3RoID0gc3RhY2tTaXplQmVmb3JlO1xuICB9XG4gIGZ1bmN0aW9uIHVwZGF0ZVJvb3QoaXRlbXMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGlmIChjb250ZXh0LnJvb3QgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50SXRlbXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGZvciAoY29uc3QgW2lkLCBub2RlXSBvZiBjb250ZXh0Lm5vZGVzKSB7XG4gICAgICBjdXJyZW50SXRlbXMuc2V0KGlkLCBub2RlLl9zZXJpYWxpemUoKSk7XG4gICAgfVxuICAgIGNvbnN0IG9wcyA9IGdldFRyZWVzRGlmZk9wZXJhdGlvbnMoY3VycmVudEl0ZW1zLCBuZXcgTWFwKGl0ZW1zKSk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXBwbHlPcHMob3BzLCBmYWxzZSk7XG4gICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICB9XG4gIGZ1bmN0aW9uIF9hZGRUb1JlYWxVbmRvU3RhY2soaGlzdG9yeU9wcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgaWYgKGNvbnRleHQudW5kb1N0YWNrLmxlbmd0aCA+PSA1MCkge1xuICAgICAgY29udGV4dC51bmRvU3RhY2suc2hpZnQoKTtcbiAgICB9XG4gICAgY29udGV4dC51bmRvU3RhY2sucHVzaChoaXN0b3J5T3BzKTtcbiAgICBvbkhpc3RvcnlDaGFuZ2UoYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKTtcbiAgfVxuICBmdW5jdGlvbiBhZGRUb1VuZG9TdGFjayhoaXN0b3J5T3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBpZiAoY29udGV4dC5wYXVzZWRIaXN0b3J5ICE9PSBudWxsKSB7XG4gICAgICBjb250ZXh0LnBhdXNlZEhpc3RvcnkudW5zaGlmdCguLi5oaXN0b3J5T3BzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX2FkZFRvUmVhbFVuZG9TdGFjayhoaXN0b3J5T3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBub3RpZnkodXBkYXRlcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSB1cGRhdGVzLnN0b3JhZ2VVcGRhdGVzO1xuICAgIGNvbnN0IG90aGVyc1VwZGF0ZXMgPSB1cGRhdGVzLm90aGVycztcbiAgICBiYXRjaGVkVXBkYXRlc1dyYXBwZXIoKCkgPT4ge1xuICAgICAgaWYgKG90aGVyc1VwZGF0ZXMgIT09IHZvaWQgMCAmJiBvdGhlcnNVcGRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgb3RoZXJzID0gY29udGV4dC5vdGhlcnMuY3VycmVudDtcbiAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiBvdGhlcnNVcGRhdGVzKSB7XG4gICAgICAgICAgZXZlbnRIdWIub3RoZXJzLm5vdGlmeSh7IC4uLmV2ZW50LCBvdGhlcnMgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh1cGRhdGVzLnByZXNlbmNlID8/IGZhbHNlKSB7XG4gICAgICAgIG5vdGlmeVNlbGZDaGFuZ2VkKGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgZXZlbnRIdWIubXlQcmVzZW5jZS5ub3RpZnkoY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnQpO1xuICAgICAgfVxuICAgICAgaWYgKHN0b3JhZ2VVcGRhdGVzICE9PSB2b2lkIDAgJiYgc3RvcmFnZVVwZGF0ZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgY29uc3QgdXBkYXRlczIgPSBBcnJheS5mcm9tKHN0b3JhZ2VVcGRhdGVzLnZhbHVlcygpKTtcbiAgICAgICAgZXZlbnRIdWIuc3RvcmFnZUJhdGNoLm5vdGlmeSh1cGRhdGVzMik7XG4gICAgICB9XG4gICAgICBub3RpZnlTdG9yYWdlU3RhdHVzKCk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0Q29ubmVjdGlvbklkKCkge1xuICAgIGNvbnN0IGluZm8gPSBjb250ZXh0LmR5bmFtaWNTZXNzaW9uSW5mby5jdXJyZW50O1xuICAgIGlmIChpbmZvKSB7XG4gICAgICByZXR1cm4gaW5mby5hY3RvcjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJJbnRlcm5hbC4gVHJpZWQgdG8gZ2V0IGNvbm5lY3Rpb24gaWQgYnV0IGNvbm5lY3Rpb24gd2FzIG5ldmVyIG9wZW5cIlxuICAgICk7XG4gIH1cbiAgZnVuY3Rpb24gYXBwbHlPcHMocmF3T3BzLCBpc0xvY2FsKSB7XG4gICAgY29uc3Qgb3V0cHV0ID0ge1xuICAgICAgcmV2ZXJzZTogW10sXG4gICAgICBzdG9yYWdlVXBkYXRlczogLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSxcbiAgICAgIHByZXNlbmNlOiBmYWxzZVxuICAgIH07XG4gICAgY29uc3QgY3JlYXRlZE5vZGVJZHMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICAgIGNvbnN0IG9wcyA9IHJhd09wcy5tYXAoKG9wKSA9PiB7XG4gICAgICBpZiAob3AudHlwZSAhPT0gXCJwcmVzZW5jZVwiICYmICFvcC5vcElkKSB7XG4gICAgICAgIHJldHVybiB7IC4uLm9wLCBvcElkOiBwb29sLmdlbmVyYXRlT3BJZCgpIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gb3A7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgIGlmIChvcC50eXBlID09PSBcInByZXNlbmNlXCIpIHtcbiAgICAgICAgY29uc3QgcmV2ZXJzZSA9IHtcbiAgICAgICAgICB0eXBlOiBcInByZXNlbmNlXCIsXG4gICAgICAgICAgZGF0YToge31cbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gb3AuZGF0YSkge1xuICAgICAgICAgIHJldmVyc2UuZGF0YVtrZXldID0gY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnRba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0Lm15UHJlc2VuY2UucGF0Y2gob3AuZGF0YSk7XG4gICAgICAgIGlmIChjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPT09IG51bGwpIHtcbiAgICAgICAgICBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPSB7IHR5cGU6IFwicGFydGlhbFwiLCBkYXRhOiBvcC5kYXRhIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gb3AuZGF0YSkge1xuICAgICAgICAgICAgY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzLmRhdGFba2V5XSA9IG9wLmRhdGFba2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgb3V0cHV0LnJldmVyc2UudW5zaGlmdChyZXZlcnNlKTtcbiAgICAgICAgb3V0cHV0LnByZXNlbmNlID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBzb3VyY2U7XG4gICAgICAgIGlmIChpc0xvY2FsKSB7XG4gICAgICAgICAgc291cmNlID0gMCAvKiBVTkRPUkVET19SRUNPTk5FQ1QgKi87XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3Qgb3BJZCA9IG5uKG9wLm9wSWQpO1xuICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgIG5uKGNvbnRleHQub3BTdGFja1RyYWNlcykuZGVsZXRlKG9wSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBkZWxldGVkID0gY29udGV4dC51bmFja25vd2xlZGdlZE9wcy5kZWxldGUob3BJZCk7XG4gICAgICAgICAgc291cmNlID0gZGVsZXRlZCA/IDIgLyogQUNLICovIDogMSAvKiBSRU1PVEUgKi87XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXBwbHlPcFJlc3VsdCA9IGFwcGx5T3Aob3AsIHNvdXJjZSk7XG4gICAgICAgIGlmIChhcHBseU9wUmVzdWx0Lm1vZGlmaWVkKSB7XG4gICAgICAgICAgY29uc3Qgbm9kZUlkID0gYXBwbHlPcFJlc3VsdC5tb2RpZmllZC5ub2RlLl9pZDtcbiAgICAgICAgICBpZiAoIShub2RlSWQgJiYgY3JlYXRlZE5vZGVJZHMuaGFzKG5vZGVJZCkpKSB7XG4gICAgICAgICAgICBvdXRwdXQuc3RvcmFnZVVwZGF0ZXMuc2V0KFxuICAgICAgICAgICAgICBubihhcHBseU9wUmVzdWx0Lm1vZGlmaWVkLm5vZGUuX2lkKSxcbiAgICAgICAgICAgICAgbWVyZ2VTdG9yYWdlVXBkYXRlcyhcbiAgICAgICAgICAgICAgICBvdXRwdXQuc3RvcmFnZVVwZGF0ZXMuZ2V0KG5uKGFwcGx5T3BSZXN1bHQubW9kaWZpZWQubm9kZS5faWQpKSxcbiAgICAgICAgICAgICAgICBhcHBseU9wUmVzdWx0Lm1vZGlmaWVkXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBvdXRwdXQucmV2ZXJzZS51bnNoaWZ0KC4uLmFwcGx5T3BSZXN1bHQucmV2ZXJzZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcC50eXBlID09PSAyIC8qIENSRUFURV9MSVNUICovIHx8IG9wLnR5cGUgPT09IDcgLyogQ1JFQVRFX01BUCAqLyB8fCBvcC50eXBlID09PSA0IC8qIENSRUFURV9PQkpFQ1QgKi8pIHtcbiAgICAgICAgICAgIGNyZWF0ZWROb2RlSWRzLmFkZChubihvcC5pZCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgb3BzLFxuICAgICAgcmV2ZXJzZTogb3V0cHV0LnJldmVyc2UsXG4gICAgICB1cGRhdGVzOiB7XG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzOiBvdXRwdXQuc3RvcmFnZVVwZGF0ZXMsXG4gICAgICAgIHByZXNlbmNlOiBvdXRwdXQucHJlc2VuY2VcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGFwcGx5T3Aob3AsIHNvdXJjZSkge1xuICAgIGlmIChpc0Fja09wKG9wKSkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIHN3aXRjaCAob3AudHlwZSkge1xuICAgICAgY2FzZSA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovOlxuICAgICAgY2FzZSAzIC8qIFVQREFURV9PQkpFQ1QgKi86XG4gICAgICBjYXNlIDUgLyogREVMRVRFX0NSRFQgKi86IHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGNvbnRleHQubm9kZXMuZ2V0KG9wLmlkKTtcbiAgICAgICAgaWYgKG5vZGUgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlLl9hcHBseShvcCwgc291cmNlID09PSAwIC8qIFVORE9SRURPX1JFQ09OTkVDVCAqLyk7XG4gICAgICB9XG4gICAgICBjYXNlIDEgLyogU0VUX1BBUkVOVF9LRVkgKi86IHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGNvbnRleHQubm9kZXMuZ2V0KG9wLmlkKTtcbiAgICAgICAgaWYgKG5vZGUgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiICYmIGlzTGl2ZUxpc3Qobm9kZS5wYXJlbnQubm9kZSkpIHtcbiAgICAgICAgICByZXR1cm4gbm9kZS5wYXJlbnQubm9kZS5fc2V0Q2hpbGRLZXkoXG4gICAgICAgICAgICBhc1BvcyhvcC5wYXJlbnRLZXkpLFxuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIHNvdXJjZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICB9XG4gICAgICBjYXNlIDQgLyogQ1JFQVRFX09CSkVDVCAqLzpcbiAgICAgIGNhc2UgMiAvKiBDUkVBVEVfTElTVCAqLzpcbiAgICAgIGNhc2UgNyAvKiBDUkVBVEVfTUFQICovOlxuICAgICAgY2FzZSA4IC8qIENSRUFURV9SRUdJU1RFUiAqLzoge1xuICAgICAgICBpZiAob3AucGFyZW50SWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBjb250ZXh0Lm5vZGVzLmdldChvcC5wYXJlbnRJZCk7XG4gICAgICAgIGlmIChwYXJlbnROb2RlID09PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50Tm9kZS5fYXR0YWNoQ2hpbGQob3AsIHNvdXJjZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIHVwZGF0ZVByZXNlbmNlKHBhdGNoLCBvcHRpb25zMikge1xuICAgIGNvbnN0IG9sZFZhbHVlcyA9IHt9O1xuICAgIGlmIChjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPT09IG51bGwpIHtcbiAgICAgIGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcyA9IHtcbiAgICAgICAgdHlwZTogXCJwYXJ0aWFsXCIsXG4gICAgICAgIGRhdGE6IHt9XG4gICAgICB9O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRjaCkge1xuICAgICAgY29uc3Qgb3ZlcnJpZGVWYWx1ZSA9IHBhdGNoW2tleV07XG4gICAgICBpZiAob3ZlcnJpZGVWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzLmRhdGFba2V5XSA9IG92ZXJyaWRlVmFsdWU7XG4gICAgICBvbGRWYWx1ZXNba2V5XSA9IGNvbnRleHQubXlQcmVzZW5jZS5jdXJyZW50W2tleV07XG4gICAgfVxuICAgIGNvbnRleHQubXlQcmVzZW5jZS5wYXRjaChwYXRjaCk7XG4gICAgaWYgKGNvbnRleHQuYWN0aXZlQmF0Y2gpIHtcbiAgICAgIGlmIChvcHRpb25zMj8uYWRkVG9IaXN0b3J5KSB7XG4gICAgICAgIGNvbnRleHQuYWN0aXZlQmF0Y2gucmV2ZXJzZU9wcy51bnNoaWZ0KHtcbiAgICAgICAgICB0eXBlOiBcInByZXNlbmNlXCIsXG4gICAgICAgICAgZGF0YTogb2xkVmFsdWVzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29udGV4dC5hY3RpdmVCYXRjaC51cGRhdGVzLnByZXNlbmNlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICAgIGlmIChvcHRpb25zMj8uYWRkVG9IaXN0b3J5KSB7XG4gICAgICAgICAgYWRkVG9VbmRvU3RhY2soXG4gICAgICAgICAgICBbeyB0eXBlOiBcInByZXNlbmNlXCIsIGRhdGE6IG9sZFZhbHVlcyB9XSxcbiAgICAgICAgICAgIGRvTm90QmF0Y2hVcGRhdGVzXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBub3RpZnkoeyBwcmVzZW5jZTogdHJ1ZSB9LCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gb25VcGRhdGVQcmVzZW5jZU1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGlmIChtZXNzYWdlLnRhcmdldEFjdG9yICE9PSB2b2lkIDApIHtcbiAgICAgIGNvbnN0IG9sZFVzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgICAgY29udGV4dC5vdGhlcnMuc2V0T3RoZXIobWVzc2FnZS5hY3RvciwgbWVzc2FnZS5kYXRhKTtcbiAgICAgIGNvbnN0IG5ld1VzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgICAgaWYgKG9sZFVzZXIgPT09IHZvaWQgMCAmJiBuZXdVc2VyICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJlbnRlclwiLCB1c2VyOiBuZXdVc2VyIH07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRleHQub3RoZXJzLnBhdGNoT3RoZXIobWVzc2FnZS5hY3RvciwgbWVzc2FnZS5kYXRhKSwgbWVzc2FnZTtcbiAgICB9XG4gICAgY29uc3QgdXNlciA9IGNvbnRleHQub3RoZXJzLmdldFVzZXIobWVzc2FnZS5hY3Rvcik7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwidXBkYXRlXCIsXG4gICAgICAgIHVwZGF0ZXM6IG1lc3NhZ2UuZGF0YSxcbiAgICAgICAgdXNlclxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gb25Vc2VyTGVmdE1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGNvbnN0IHVzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgIGlmICh1c2VyKSB7XG4gICAgICBjb250ZXh0Lm90aGVycy5yZW1vdmVDb25uZWN0aW9uKG1lc3NhZ2UuYWN0b3IpO1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJsZWF2ZVwiLCB1c2VyIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGZ1bmN0aW9uIG9uUm9vbVN0YXRlTWVzc2FnZShtZXNzYWdlLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBjb250ZXh0LmR5bmFtaWNTZXNzaW9uSW5mby5zZXQoe1xuICAgICAgYWN0b3I6IG1lc3NhZ2UuYWN0b3IsXG4gICAgICBub25jZTogbWVzc2FnZS5ub25jZSxcbiAgICAgIHNjb3BlczogbWVzc2FnZS5zY29wZXNcbiAgICB9KTtcbiAgICBjb250ZXh0LmlkRmFjdG9yeSA9IG1ha2VJZEZhY3RvcnkobWVzc2FnZS5hY3Rvcik7XG4gICAgbm90aWZ5U2VsZkNoYW5nZWQoYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKTtcbiAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb25JZCBvZiBjb250ZXh0Lm90aGVycy5jb25uZWN0aW9uSWRzKCkpIHtcbiAgICAgIGNvbnN0IHVzZXIgPSBtZXNzYWdlLnVzZXJzW2Nvbm5lY3Rpb25JZF07XG4gICAgICBpZiAodXNlciA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRleHQub3RoZXJzLnJlbW92ZUNvbm5lY3Rpb24oY29ubmVjdGlvbklkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBrZXkgaW4gbWVzc2FnZS51c2Vycykge1xuICAgICAgY29uc3QgdXNlciA9IG1lc3NhZ2UudXNlcnNba2V5XTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25JZCA9IE51bWJlcihrZXkpO1xuICAgICAgY29udGV4dC5vdGhlcnMuc2V0Q29ubmVjdGlvbihcbiAgICAgICAgY29ubmVjdGlvbklkLFxuICAgICAgICB1c2VyLmlkLFxuICAgICAgICB1c2VyLmluZm8sXG4gICAgICAgIHVzZXIuc2NvcGVzXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4geyB0eXBlOiBcInJlc2V0XCIgfTtcbiAgfVxuICBmdW5jdGlvbiBjYW5VbmRvKCkge1xuICAgIHJldHVybiBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGggPiAwO1xuICB9XG4gIGZ1bmN0aW9uIGNhblJlZG8oKSB7XG4gICAgcmV0dXJuIGNvbnRleHQucmVkb1N0YWNrLmxlbmd0aCA+IDA7XG4gIH1cbiAgZnVuY3Rpb24gb25IaXN0b3J5Q2hhbmdlKGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGJhdGNoZWRVcGRhdGVzV3JhcHBlcigoKSA9PiB7XG4gICAgICBldmVudEh1Yi5oaXN0b3J5Lm5vdGlmeSh7IGNhblVuZG86IGNhblVuZG8oKSwgY2FuUmVkbzogY2FuUmVkbygpIH0pO1xuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIG9uVXNlckpvaW5lZE1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGNvbnRleHQub3RoZXJzLnNldENvbm5lY3Rpb24oXG4gICAgICBtZXNzYWdlLmFjdG9yLFxuICAgICAgbWVzc2FnZS5pZCxcbiAgICAgIG1lc3NhZ2UuaW5mbyxcbiAgICAgIG1lc3NhZ2Uuc2NvcGVzXG4gICAgKTtcbiAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKHtcbiAgICAgIHR5cGU6IDEwMCAvKiBVUERBVEVfUFJFU0VOQ0UgKi8sXG4gICAgICBkYXRhOiBjb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudCxcbiAgICAgIHRhcmdldEFjdG9yOiBtZXNzYWdlLmFjdG9yXG4gICAgfSk7XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICBjb25zdCB1c2VyID0gY29udGV4dC5vdGhlcnMuZ2V0VXNlcihtZXNzYWdlLmFjdG9yKTtcbiAgICByZXR1cm4gdXNlciA/IHsgdHlwZTogXCJlbnRlclwiLCB1c2VyIH0gOiB2b2lkIDA7XG4gIH1cbiAgZnVuY3Rpb24gcGFyc2VTZXJ2ZXJNZXNzYWdlKGRhdGEpIHtcbiAgICBpZiAoIWlzSnNvbk9iamVjdChkYXRhKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xuICB9XG4gIGZ1bmN0aW9uIHBhcnNlU2VydmVyTWVzc2FnZXModGV4dCkge1xuICAgIGNvbnN0IGRhdGEgPSB0cnlQYXJzZUpzb24odGV4dCk7XG4gICAgaWYgKGRhdGEgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChpc0pzb25BcnJheShkYXRhKSkge1xuICAgICAgcmV0dXJuIGNvbXBhY3QoZGF0YS5tYXAoKGl0ZW0pID0+IHBhcnNlU2VydmVyTWVzc2FnZShpdGVtKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29tcGFjdChbcGFyc2VTZXJ2ZXJNZXNzYWdlKGRhdGEpXSk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGFwcGx5QW5kU2VuZE9wcyhvZmZsaW5lT3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBpZiAob2ZmbGluZU9wcy5zaXplID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgY29uc3Qgb3BzID0gQXJyYXkuZnJvbShvZmZsaW5lT3BzLnZhbHVlcygpKTtcbiAgICBjb25zdCByZXN1bHQgPSBhcHBseU9wcyhvcHMsIHRydWUpO1xuICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgdHlwZTogMjAxIC8qIFVQREFURV9TVE9SQUdFICovLFxuICAgICAgb3BzOiByZXN1bHQub3BzXG4gICAgfSk7XG4gICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICAgIHNlbmRNZXNzYWdlcyhtZXNzYWdlcyk7XG4gIH1cbiAgZnVuY3Rpb24gaGFuZGxlU2VydmVyTWVzc2FnZShldmVudCkge1xuICAgIGlmICh0eXBlb2YgZXZlbnQuZGF0YSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXNzYWdlcyA9IHBhcnNlU2VydmVyTWVzc2FnZXMoZXZlbnQuZGF0YSk7XG4gICAgaWYgKG1lc3NhZ2VzID09PSBudWxsIHx8IG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB1cGRhdGVzID0ge1xuICAgICAgc3RvcmFnZVVwZGF0ZXM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksXG4gICAgICBvdGhlcnM6IFtdXG4gICAgfTtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7XG4gICAgICAgIHN3aXRjaCAobWVzc2FnZS50eXBlKSB7XG4gICAgICAgICAgY2FzZSAxMDEgLyogVVNFUl9KT0lORUQgKi86IHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJKb2luZWRVcGRhdGUgPSBvblVzZXJKb2luZWRNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgaWYgKHVzZXJKb2luZWRVcGRhdGUpIHtcbiAgICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaCh1c2VySm9pbmVkVXBkYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDEwMCAvKiBVUERBVEVfUFJFU0VOQ0UgKi86IHtcbiAgICAgICAgICAgIGNvbnN0IG90aGVyc1ByZXNlbmNlVXBkYXRlID0gb25VcGRhdGVQcmVzZW5jZU1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAob3RoZXJzUHJlc2VuY2VVcGRhdGUpIHtcbiAgICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaChvdGhlcnNQcmVzZW5jZVVwZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSAxMDMgLyogQlJPQURDQVNURURfRVZFTlQgKi86IHtcbiAgICAgICAgICAgIGNvbnN0IG90aGVycyA9IGNvbnRleHQub3RoZXJzLmN1cnJlbnQ7XG4gICAgICAgICAgICBldmVudEh1Yi5jdXN0b21FdmVudC5ub3RpZnkoe1xuICAgICAgICAgICAgICBjb25uZWN0aW9uSWQ6IG1lc3NhZ2UuYWN0b3IsXG4gICAgICAgICAgICAgIHVzZXI6IG1lc3NhZ2UuYWN0b3IgPCAwID8gbnVsbCA6IG90aGVycy5maW5kKCh1KSA9PiB1LmNvbm5lY3Rpb25JZCA9PT0gbWVzc2FnZS5hY3RvcikgPz8gbnVsbCxcbiAgICAgICAgICAgICAgZXZlbnQ6IG1lc3NhZ2UuZXZlbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMTAyIC8qIFVTRVJfTEVGVCAqLzoge1xuICAgICAgICAgICAgY29uc3QgZXZlbnQyID0gb25Vc2VyTGVmdE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAoZXZlbnQyKSB7XG4gICAgICAgICAgICAgIHVwZGF0ZXMub3RoZXJzLnB1c2goZXZlbnQyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDMwMCAvKiBVUERBVEVfWURPQyAqLzoge1xuICAgICAgICAgICAgZXZlbnRIdWIueWRvYy5ub3RpZnkobWVzc2FnZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSAxMDQgLyogUk9PTV9TVEFURSAqLzoge1xuICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaChvblJvb21TdGF0ZU1lc3NhZ2UobWVzc2FnZSwgZG9Ob3RCYXRjaFVwZGF0ZXMpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDIwMCAvKiBJTklUSUFMX1NUT1JBR0VfU1RBVEUgKi86IHtcbiAgICAgICAgICAgIHByb2Nlc3NJbml0aWFsU3RvcmFnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDIwMSAvKiBVUERBVEVfU1RPUkFHRSAqLzoge1xuICAgICAgICAgICAgY29uc3QgYXBwbHlSZXN1bHQgPSBhcHBseU9wcyhtZXNzYWdlLm9wcywgZmFsc2UpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgYXBwbHlSZXN1bHQudXBkYXRlcy5zdG9yYWdlVXBkYXRlcykge1xuICAgICAgICAgICAgICB1cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLnNldChcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgbWVyZ2VTdG9yYWdlVXBkYXRlcyh1cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLmdldChrZXkpLCB2YWx1ZSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDI5OSAvKiBSRUpFQ1RfU1RPUkFHRV9PUCAqLzoge1xuICAgICAgICAgICAgZXJyb3JXaXRoVGl0bGUoXG4gICAgICAgICAgICAgIFwiU3RvcmFnZSBtdXRhdGlvbiByZWplY3Rpb24gZXJyb3JcIixcbiAgICAgICAgICAgICAgbWVzc2FnZS5yZWFzb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHRyYWNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgICAgICAgICAgIGZvciAoY29uc3Qgb3BJZCBvZiBtZXNzYWdlLm9wSWRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJhY2UgPSBjb250ZXh0Lm9wU3RhY2tUcmFjZXM/LmdldChvcElkKTtcbiAgICAgICAgICAgICAgICBpZiAodHJhY2UpIHtcbiAgICAgICAgICAgICAgICAgIHRyYWNlcy5hZGQodHJhY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAodHJhY2VzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgd2FybldpdGhUaXRsZShcbiAgICAgICAgICAgICAgICAgIFwiVGhlIGZvbGxvd2luZyBmdW5jdGlvbiBjYWxscyBjYXVzZWQgdGhlIHJlamVjdGVkIHN0b3JhZ2UgbXV0YXRpb25zOlwiLFxuICAgICAgICAgICAgICAgICAgYFxuXG4ke0FycmF5LmZyb20odHJhY2VzKS5qb2luKFwiXFxuXFxuXCIpfWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBgU3RvcmFnZSBtdXRhdGlvbnMgcmVqZWN0ZWQgYnkgc2VydmVyOiAke21lc3NhZ2UucmVhc29ufWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDQwMCAvKiBUSFJFQURfQ1JFQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwNyAvKiBUSFJFQURfREVMRVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwMSAvKiBUSFJFQURfTUVUQURBVEFfVVBEQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwOCAvKiBUSFJFQURfVVBEQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwNSAvKiBDT01NRU5UX1JFQUNUSU9OX0FEREVEICovOlxuICAgICAgICAgIGNhc2UgNDA2IC8qIENPTU1FTlRfUkVBQ1RJT05fUkVNT1ZFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwMiAvKiBDT01NRU5UX0NSRUFURUQgKi86XG4gICAgICAgICAgY2FzZSA0MDMgLyogQ09NTUVOVF9FRElURUQgKi86XG4gICAgICAgICAgY2FzZSA0MDQgLyogQ09NTUVOVF9ERUxFVEVEICovOiB7XG4gICAgICAgICAgICBldmVudEh1Yi5jb21tZW50cy5ub3RpZnkobWVzc2FnZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIG5vdGlmeSh1cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gZmx1c2hOb3dPclNvb24oKSB7XG4gICAgY29uc3Qgc3RvcmFnZU9wcyA9IGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zO1xuICAgIGlmIChzdG9yYWdlT3BzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoY29uc3Qgb3Agb2Ygc3RvcmFnZU9wcykge1xuICAgICAgICBjb250ZXh0LnVuYWNrbm93bGVkZ2VkT3BzLnNldChubihvcC5vcElkKSwgb3ApO1xuICAgICAgfVxuICAgICAgbm90aWZ5U3RvcmFnZVN0YXR1cygpO1xuICAgIH1cbiAgICBpZiAobWFuYWdlZFNvY2tldC5nZXRTdGF0dXMoKSAhPT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnMgPSBbXTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBlbGFwc2VkTWlsbGlzID0gbm93IC0gY29udGV4dC5idWZmZXIubGFzdEZsdXNoZWRBdDtcbiAgICBpZiAoZWxhcHNlZE1pbGxpcyA+PSBjb25maWcudGhyb3R0bGVEZWxheSkge1xuICAgICAgY29uc3QgbWVzc2FnZXNUb0ZsdXNoID0gc2VyaWFsaXplQnVmZmVyKCk7XG4gICAgICBpZiAobWVzc2FnZXNUb0ZsdXNoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBzZW5kTWVzc2FnZXMobWVzc2FnZXNUb0ZsdXNoKTtcbiAgICAgIGNvbnRleHQuYnVmZmVyID0ge1xuICAgICAgICBmbHVzaFRpbWVySUQ6IHZvaWQgMCxcbiAgICAgICAgbGFzdEZsdXNoZWRBdDogbm93LFxuICAgICAgICBtZXNzYWdlczogW10sXG4gICAgICAgIHN0b3JhZ2VPcGVyYXRpb25zOiBbXSxcbiAgICAgICAgcHJlc2VuY2VVcGRhdGVzOiBudWxsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjbGVhclRpbWVvdXQoY29udGV4dC5idWZmZXIuZmx1c2hUaW1lcklEKTtcbiAgICAgIGNvbnRleHQuYnVmZmVyLmZsdXNoVGltZXJJRCA9IHNldFRpbWVvdXQoXG4gICAgICAgIGZsdXNoTm93T3JTb29uLFxuICAgICAgICBjb25maWcudGhyb3R0bGVEZWxheSAtIGVsYXBzZWRNaWxsaXNcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIHNlcmlhbGl6ZUJ1ZmZlcigpIHtcbiAgICBjb25zdCBtZXNzYWdlcyA9IFtdO1xuICAgIGlmIChjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMpIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goXG4gICAgICAgIGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcy50eXBlID09PSBcImZ1bGxcIiA/IHtcbiAgICAgICAgICB0eXBlOiAxMDAgLyogVVBEQVRFX1BSRVNFTkNFICovLFxuICAgICAgICAgIC8vIFBvcHVsYXRpbmcgdGhlIGB0YXJnZXRBY3RvcmAgZmllbGQgdHVybnMgdGhpcyBtZXNzYWdlIGludG9cbiAgICAgICAgICAvLyBhIEZ1bGwgUHJlc2VuY2XihKIgdXBkYXRlIG1lc3NhZ2UgKG5vdCBhIHBhdGNoKSwgd2hpY2ggd2lsbCBnZXRcbiAgICAgICAgICAvLyBpbnRlcnByZXRlZCBieSBvdGhlciBjbGllbnRzIGFzIHN1Y2guXG4gICAgICAgICAgdGFyZ2V0QWN0b3I6IC0xLFxuICAgICAgICAgIGRhdGE6IGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcy5kYXRhXG4gICAgICAgIH0gOiB7XG4gICAgICAgICAgdHlwZTogMTAwIC8qIFVQREFURV9QUkVTRU5DRSAqLyxcbiAgICAgICAgICBkYXRhOiBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMuZGF0YVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKGV2ZW50KTtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICB0eXBlOiAyMDEgLyogVVBEQVRFX1NUT1JBR0UgKi8sXG4gICAgICAgIG9wczogY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnNcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZXM7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlWURvYyh1cGRhdGUsIGd1aWQpIHtcbiAgICBjb25zdCBjbGllbnRNc2cgPSB7XG4gICAgICB0eXBlOiAzMDEgLyogVVBEQVRFX1lET0MgKi8sXG4gICAgICB1cGRhdGUsXG4gICAgICBndWlkXG4gICAgfTtcbiAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKGNsaWVudE1zZyk7XG4gICAgZXZlbnRIdWIueWRvYy5ub3RpZnkoY2xpZW50TXNnKTtcbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGZ1bmN0aW9uIGJyb2FkY2FzdEV2ZW50KGV2ZW50LCBvcHRpb25zMiA9IHtcbiAgICBzaG91bGRRdWV1ZUV2ZW50SWZOb3RSZWFkeTogZmFsc2VcbiAgfSkge1xuICAgIGlmIChtYW5hZ2VkU29ja2V0LmdldFN0YXR1cygpICE9PSBcImNvbm5lY3RlZFwiICYmICFvcHRpb25zMi5zaG91bGRRdWV1ZUV2ZW50SWZOb3RSZWFkeSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKHtcbiAgICAgIHR5cGU6IDEwMyAvKiBCUk9BRENBU1RfRVZFTlQgKi8sXG4gICAgICBldmVudFxuICAgIH0pO1xuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gZGlzcGF0Y2hPcHMob3BzKSB7XG4gICAgY29uc3QgeyBzdG9yYWdlT3BlcmF0aW9ucyB9ID0gY29udGV4dC5idWZmZXI7XG4gICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgIHN0b3JhZ2VPcGVyYXRpb25zLnB1c2gob3ApO1xuICAgIH1cbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGxldCBfZ2V0U3RvcmFnZSQgPSBudWxsO1xuICBsZXQgX3Jlc29sdmVTdG9yYWdlUHJvbWlzZSA9IG51bGw7XG4gIGZ1bmN0aW9uIHByb2Nlc3NJbml0aWFsU3RvcmFnZShtZXNzYWdlKSB7XG4gICAgY29uc3QgdW5hY2tub3dsZWRnZWRPcHMgPSBuZXcgTWFwKGNvbnRleHQudW5hY2tub3dsZWRnZWRPcHMpO1xuICAgIGNyZWF0ZU9yVXBkYXRlUm9vdEZyb21NZXNzYWdlKG1lc3NhZ2UsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICBhcHBseUFuZFNlbmRPcHModW5hY2tub3dsZWRnZWRPcHMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICBfcmVzb2x2ZVN0b3JhZ2VQcm9taXNlPy4oKTtcbiAgICBub3RpZnlTdG9yYWdlU3RhdHVzKCk7XG4gICAgZXZlbnRIdWIuc3RvcmFnZURpZExvYWQubm90aWZ5KCk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gc3RyZWFtU3RvcmFnZSgpIHtcbiAgICBpZiAoIW1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN0cmVhbUZldGNoKG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLCBjb25maWcucm9vbUlkKTtcbiAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHJlc3VsdC5qc29uKCk7XG4gICAgcHJvY2Vzc0luaXRpYWxTdG9yYWdlKHsgdHlwZTogMjAwIC8qIElOSVRJQUxfU1RPUkFHRV9TVEFURSAqLywgaXRlbXMgfSk7XG4gIH1cbiAgZnVuY3Rpb24gcmVmcmVzaFN0b3JhZ2Uob3B0aW9uczIpIHtcbiAgICBjb25zdCBtZXNzYWdlcyA9IGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzO1xuICAgIGlmIChjb25maWcudW5zdGFibGVfc3RyZWFtRGF0YSkge1xuICAgICAgdm9pZCBzdHJlYW1TdG9yYWdlKCk7XG4gICAgfSBlbHNlIGlmICghbWVzc2FnZXMuc29tZSgobXNnKSA9PiBtc2cudHlwZSA9PT0gMjAwIC8qIEZFVENIX1NUT1JBR0UgKi8pKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKHsgdHlwZTogMjAwIC8qIEZFVENIX1NUT1JBR0UgKi8gfSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zMi5mbHVzaCkge1xuICAgICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gc3RhcnRMb2FkaW5nU3RvcmFnZSgpIHtcbiAgICBpZiAoX2dldFN0b3JhZ2UkID09PSBudWxsKSB7XG4gICAgICByZWZyZXNoU3RvcmFnZSh7IGZsdXNoOiB0cnVlIH0pO1xuICAgICAgX2dldFN0b3JhZ2UkID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgX3Jlc29sdmVTdG9yYWdlUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgICB9KTtcbiAgICAgIG5vdGlmeVN0b3JhZ2VTdGF0dXMoKTtcbiAgICB9XG4gICAgcmV0dXJuIF9nZXRTdG9yYWdlJDtcbiAgfVxuICBmdW5jdGlvbiBnZXRTdG9yYWdlU25hcHNob3QoKSB7XG4gICAgY29uc3Qgcm9vdCA9IGNvbnRleHQucm9vdDtcbiAgICBpZiAocm9vdCAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gcm9vdDtcbiAgICB9IGVsc2Uge1xuICAgICAgdm9pZCBzdGFydExvYWRpbmdTdG9yYWdlKCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0U3RvcmFnZSgpIHtcbiAgICBpZiAoY29udGV4dC5yb290ICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICByb290OiBjb250ZXh0LnJvb3RcbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBzdGFydExvYWRpbmdTdG9yYWdlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvb3Q6IG5uKGNvbnRleHQucm9vdClcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGZldGNoWURvYyh2ZWN0b3IsIGd1aWQpIHtcbiAgICBpZiAoIWNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzLmZpbmQoKG0pID0+IHtcbiAgICAgIHJldHVybiBtLnR5cGUgPT09IDMwMCAvKiBGRVRDSF9ZRE9DICovICYmIG0udmVjdG9yID09PSB2ZWN0b3IgJiYgbS5ndWlkID09PSBndWlkO1xuICAgIH0pKSB7XG4gICAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgdHlwZTogMzAwIC8qIEZFVENIX1lET0MgKi8sXG4gICAgICAgIHZlY3RvcixcbiAgICAgICAgZ3VpZFxuICAgICAgfSk7XG4gICAgfVxuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gdW5kbygpIHtcbiAgICBpZiAoY29udGV4dC5hY3RpdmVCYXRjaCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kbyBpcyBub3QgYWxsb3dlZCBkdXJpbmcgYSBiYXRjaFwiKTtcbiAgICB9XG4gICAgY29uc3QgaGlzdG9yeU9wcyA9IGNvbnRleHQudW5kb1N0YWNrLnBvcCgpO1xuICAgIGlmIChoaXN0b3J5T3BzID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29udGV4dC5wYXVzZWRIaXN0b3J5ID0gbnVsbDtcbiAgICBjb25zdCByZXN1bHQgPSBhcHBseU9wcyhoaXN0b3J5T3BzLCB0cnVlKTtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICBjb250ZXh0LnJlZG9TdGFjay5wdXNoKHJlc3VsdC5yZXZlcnNlKTtcbiAgICAgIG9uSGlzdG9yeUNoYW5nZShkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBvcCBvZiByZXN1bHQub3BzKSB7XG4gICAgICBpZiAob3AudHlwZSAhPT0gXCJwcmVzZW5jZVwiKSB7XG4gICAgICAgIGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zLnB1c2gob3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGZ1bmN0aW9uIHJlZG8oKSB7XG4gICAgaWYgKGNvbnRleHQuYWN0aXZlQmF0Y2gpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInJlZG8gaXMgbm90IGFsbG93ZWQgZHVyaW5nIGEgYmF0Y2hcIik7XG4gICAgfVxuICAgIGNvbnN0IGhpc3RvcnlPcHMgPSBjb250ZXh0LnJlZG9TdGFjay5wb3AoKTtcbiAgICBpZiAoaGlzdG9yeU9wcyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnRleHQucGF1c2VkSGlzdG9yeSA9IG51bGw7XG4gICAgY29uc3QgcmVzdWx0ID0gYXBwbHlPcHMoaGlzdG9yeU9wcywgdHJ1ZSk7XG4gICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgIG5vdGlmeShyZXN1bHQudXBkYXRlcywgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgICAgY29udGV4dC51bmRvU3RhY2sucHVzaChyZXN1bHQucmV2ZXJzZSk7XG4gICAgICBvbkhpc3RvcnlDaGFuZ2UoZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgIH0pO1xuICAgIGZvciAoY29uc3Qgb3Agb2YgcmVzdWx0Lm9wcykge1xuICAgICAgaWYgKG9wLnR5cGUgIT09IFwicHJlc2VuY2VcIikge1xuICAgICAgICBjb250ZXh0LmJ1ZmZlci5zdG9yYWdlT3BlcmF0aW9ucy5wdXNoKG9wKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgfVxuICBmdW5jdGlvbiBjbGVhcigpIHtcbiAgICBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGggPSAwO1xuICAgIGNvbnRleHQucmVkb1N0YWNrLmxlbmd0aCA9IDA7XG4gIH1cbiAgZnVuY3Rpb24gYmF0Y2goY2FsbGJhY2spIHtcbiAgICBpZiAoY29udGV4dC5hY3RpdmVCYXRjaCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGxldCByZXR1cm5WYWx1ZSA9IHZvaWQgMDtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgY29udGV4dC5hY3RpdmVCYXRjaCA9IHtcbiAgICAgICAgb3BzOiBbXSxcbiAgICAgICAgdXBkYXRlczoge1xuICAgICAgICAgIHN0b3JhZ2VVcGRhdGVzOiAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLFxuICAgICAgICAgIHByZXNlbmNlOiBmYWxzZSxcbiAgICAgICAgICBvdGhlcnM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHJldmVyc2VPcHM6IFtdXG4gICAgICB9O1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuVmFsdWUgPSBjYWxsYmFjaygpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgY29uc3QgY3VycmVudEJhdGNoID0gY29udGV4dC5hY3RpdmVCYXRjaDtcbiAgICAgICAgY29udGV4dC5hY3RpdmVCYXRjaCA9IG51bGw7XG4gICAgICAgIGlmIChjdXJyZW50QmF0Y2gucmV2ZXJzZU9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYWRkVG9VbmRvU3RhY2soY3VycmVudEJhdGNoLnJldmVyc2VPcHMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudEJhdGNoLm9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29udGV4dC5yZWRvU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudEJhdGNoLm9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZGlzcGF0Y2hPcHMoY3VycmVudEJhdGNoLm9wcyk7XG4gICAgICAgIH1cbiAgICAgICAgbm90aWZ5KGN1cnJlbnRCYXRjaC51cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICAgIGZsdXNoTm93T3JTb29uKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICB9XG4gIGZ1bmN0aW9uIHBhdXNlSGlzdG9yeSgpIHtcbiAgICBpZiAoY29udGV4dC5wYXVzZWRIaXN0b3J5ID09PSBudWxsKSB7XG4gICAgICBjb250ZXh0LnBhdXNlZEhpc3RvcnkgPSBbXTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gcmVzdW1lSGlzdG9yeSgpIHtcbiAgICBjb25zdCBoaXN0b3J5T3BzID0gY29udGV4dC5wYXVzZWRIaXN0b3J5O1xuICAgIGNvbnRleHQucGF1c2VkSGlzdG9yeSA9IG51bGw7XG4gICAgaWYgKGhpc3RvcnlPcHMgIT09IG51bGwgJiYgaGlzdG9yeU9wcy5sZW5ndGggPiAwKSB7XG4gICAgICBfYWRkVG9SZWFsVW5kb1N0YWNrKGhpc3RvcnlPcHMsIGJhdGNoVXBkYXRlcyk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGdldFN0b3JhZ2VTdGF0dXMoKSB7XG4gICAgaWYgKGNvbnRleHQucm9vdCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gX2dldFN0b3JhZ2UkID09PSBudWxsID8gXCJub3QtbG9hZGVkXCIgOiBcImxvYWRpbmdcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNvbnRleHQudW5hY2tub3dsZWRnZWRPcHMuc2l6ZSA9PT0gMCA/IFwic3luY2hyb25pemVkXCIgOiBcInN5bmNocm9uaXppbmdcIjtcbiAgICB9XG4gIH1cbiAgbGV0IF9sYXN0U3RvcmFnZVN0YXR1cyA9IGdldFN0b3JhZ2VTdGF0dXMoKTtcbiAgZnVuY3Rpb24gbm90aWZ5U3RvcmFnZVN0YXR1cygpIHtcbiAgICBjb25zdCBzdG9yYWdlU3RhdHVzID0gZ2V0U3RvcmFnZVN0YXR1cygpO1xuICAgIGlmIChfbGFzdFN0b3JhZ2VTdGF0dXMgIT09IHN0b3JhZ2VTdGF0dXMpIHtcbiAgICAgIF9sYXN0U3RvcmFnZVN0YXR1cyA9IHN0b3JhZ2VTdGF0dXM7XG4gICAgICBldmVudEh1Yi5zdG9yYWdlU3RhdHVzLm5vdGlmeShzdG9yYWdlU3RhdHVzKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gaXNQcmVzZW5jZVJlYWR5KCkge1xuICAgIHJldHVybiBzZWxmLmN1cnJlbnQgIT09IG51bGw7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gd2FpdFVudGlsUHJlc2VuY2VSZWFkeSgpIHtcbiAgICB3aGlsZSAoIWlzUHJlc2VuY2VSZWFkeSgpKSB7XG4gICAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmUgfSA9IFByb21pc2Vfd2l0aFJlc29sdmVycygpO1xuICAgICAgY29uc3QgdW5zdWIxID0gZXZlbnRzLnNlbGYuc3Vic2NyaWJlT25jZShyZXNvbHZlKTtcbiAgICAgIGNvbnN0IHVuc3ViMiA9IGV2ZW50cy5zdGF0dXMuc3Vic2NyaWJlT25jZShyZXNvbHZlKTtcbiAgICAgIGF3YWl0IHByb21pc2U7XG4gICAgICB1bnN1YjEoKTtcbiAgICAgIHVuc3ViMigpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBpc1N0b3JhZ2VSZWFkeSgpIHtcbiAgICByZXR1cm4gZ2V0U3RvcmFnZVNuYXBzaG90KCkgIT09IG51bGw7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gd2FpdFVudGlsU3RvcmFnZVJlYWR5KCkge1xuICAgIHdoaWxlICghaXNTdG9yYWdlUmVhZHkoKSkge1xuICAgICAgYXdhaXQgZ2V0U3RvcmFnZSgpO1xuICAgIH1cbiAgfVxuICBjb25zdCBvdGhlcnNfZm9yRGV2VG9vbHMgPSBuZXcgRGVyaXZlZFJlZihcbiAgICBjb250ZXh0Lm90aGVycyxcbiAgICAob3RoZXJzKSA9PiBvdGhlcnMubWFwKChvdGhlciwgaW5kZXgpID0+IHVzZXJUb1RyZWVOb2RlKGBPdGhlciAke2luZGV4fWAsIG90aGVyKSlcbiAgKTtcbiAgY29uc3QgZXZlbnRzID0ge1xuICAgIHN0YXR1czogZXZlbnRIdWIuc3RhdHVzLm9ic2VydmFibGUsXG4gICAgbG9zdENvbm5lY3Rpb246IGV2ZW50SHViLmxvc3RDb25uZWN0aW9uLm9ic2VydmFibGUsXG4gICAgY3VzdG9tRXZlbnQ6IGV2ZW50SHViLmN1c3RvbUV2ZW50Lm9ic2VydmFibGUsXG4gICAgb3RoZXJzOiBldmVudEh1Yi5vdGhlcnMub2JzZXJ2YWJsZSxcbiAgICBzZWxmOiBldmVudEh1Yi5zZWxmLm9ic2VydmFibGUsXG4gICAgbXlQcmVzZW5jZTogZXZlbnRIdWIubXlQcmVzZW5jZS5vYnNlcnZhYmxlLFxuICAgIGVycm9yOiBldmVudEh1Yi5lcnJvci5vYnNlcnZhYmxlLFxuICAgIC8qKiBAZGVwcmVjYXRlZCAqL1xuICAgIHN0b3JhZ2U6IGV2ZW50SHViLnN0b3JhZ2VCYXRjaC5vYnNlcnZhYmxlLFxuICAgIHN0b3JhZ2VCYXRjaDogZXZlbnRIdWIuc3RvcmFnZUJhdGNoLm9ic2VydmFibGUsXG4gICAgaGlzdG9yeTogZXZlbnRIdWIuaGlzdG9yeS5vYnNlcnZhYmxlLFxuICAgIHN0b3JhZ2VEaWRMb2FkOiBldmVudEh1Yi5zdG9yYWdlRGlkTG9hZC5vYnNlcnZhYmxlLFxuICAgIHN0b3JhZ2VTdGF0dXM6IGV2ZW50SHViLnN0b3JhZ2VTdGF0dXMub2JzZXJ2YWJsZSxcbiAgICB5ZG9jOiBldmVudEh1Yi55ZG9jLm9ic2VydmFibGUsXG4gICAgY29tbWVudHM6IGV2ZW50SHViLmNvbW1lbnRzLm9ic2VydmFibGVcbiAgfTtcbiAgY29uc3QgY29tbWVudHNBcGkgPSBjcmVhdGVDb21tZW50c0FwaShcbiAgICBjb25maWcucm9vbUlkLFxuICAgIGRlbGVnYXRlcy5hdXRoZW50aWNhdGUsXG4gICAgZmV0Y2hDbGllbnRBcGlcbiAgKTtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hOb3RpZmljYXRpb25zSnNvbihlbmRwb2ludCwgb3B0aW9uczIpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBkZWxlZ2F0ZXMuYXV0aGVudGljYXRlKCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENsaWVudEFwaShcbiAgICAgIGNvbmZpZy5yb29tSWQsXG4gICAgICBlbmRwb2ludCxcbiAgICAgIGF1dGhWYWx1ZSxcbiAgICAgIG9wdGlvbnMyXG4gICAgKTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDQwMCAmJiByZXNwb25zZS5zdGF0dXMgPCA2MDApIHtcbiAgICAgICAgbGV0IGVycm9yMztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBlcnJvckJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIGVycm9yQm9keS5tZXNzYWdlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgZXJyb3JCb2R5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yMztcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGJvZHk7XG4gICAgdHJ5IHtcbiAgICAgIGJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBib2R5ID0ge307XG4gICAgfVxuICAgIHJldHVybiBib2R5O1xuICB9XG4gIGZ1bmN0aW9uIGdldE5vdGlmaWNhdGlvblNldHRpbmdzKCkge1xuICAgIHJldHVybiBmZXRjaE5vdGlmaWNhdGlvbnNKc29uKFxuICAgICAgXCIvbm90aWZpY2F0aW9uLXNldHRpbmdzXCJcbiAgICApO1xuICB9XG4gIGZ1bmN0aW9uIHVwZGF0ZU5vdGlmaWNhdGlvblNldHRpbmdzKHNldHRpbmdzKSB7XG4gICAgcmV0dXJuIGZldGNoTm90aWZpY2F0aW9uc0pzb24oXG4gICAgICBcIi9ub3RpZmljYXRpb24tc2V0dGluZ3NcIixcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc2V0dGluZ3MpLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gbWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZChpbmJveE5vdGlmaWNhdGlvbklkcykge1xuICAgIGF3YWl0IGZldGNoTm90aWZpY2F0aW9uc0pzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9ucy9yZWFkXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBpbmJveE5vdGlmaWNhdGlvbklkcyB9KVxuICAgIH0pO1xuICB9XG4gIGNvbnN0IGJhdGNoZWRNYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkID0gbmV3IEJhdGNoKFxuICAgIGFzeW5jIChiYXRjaGVkSW5ib3hOb3RpZmljYXRpb25JZHMpID0+IHtcbiAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uSWRzID0gYmF0Y2hlZEluYm94Tm90aWZpY2F0aW9uSWRzLmZsYXQoKTtcbiAgICAgIGF3YWl0IG1hcmtJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoaW5ib3hOb3RpZmljYXRpb25JZHMpO1xuICAgICAgcmV0dXJuIGluYm94Tm90aWZpY2F0aW9uSWRzO1xuICAgIH0sXG4gICAgeyBkZWxheTogTUFSS19JTkJPWF9OT1RJRklDQVRJT05TX0FTX1JFQURfQkFUQ0hfREVMQVkyIH1cbiAgKTtcbiAgYXN5bmMgZnVuY3Rpb24gbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWQpIHtcbiAgICBhd2FpdCBiYXRjaGVkTWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZC5nZXQoaW5ib3hOb3RpZmljYXRpb25JZCk7XG4gIH1cbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShcbiAgICB7XG4gICAgICBba0ludGVybmFsXToge1xuICAgICAgICBnZXQgcHJlc2VuY2VCdWZmZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIGRlZXBDbG9uZShjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXM/LmRhdGEgPz8gbnVsbCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHByZXR0aWVyLWlnbm9yZVxuICAgICAgICBnZXQgdW5kb1N0YWNrKCkge1xuICAgICAgICAgIHJldHVybiBkZWVwQ2xvbmUoY29udGV4dC51bmRvU3RhY2spO1xuICAgICAgICB9LFxuICAgICAgICAvLyBwcmV0dGllci1pZ25vcmVcbiAgICAgICAgZ2V0IG5vZGVDb3VudCgpIHtcbiAgICAgICAgICByZXR1cm4gY29udGV4dC5ub2Rlcy5zaXplO1xuICAgICAgICB9LFxuICAgICAgICAvLyBwcmV0dGllci1pZ25vcmVcbiAgICAgICAgLy8gc2VuZCBtZXRhZGF0YSB3aGVuIHVzaW5nIGEgdGV4dCBlZGl0b3JcbiAgICAgICAgcmVwb3J0VGV4dEVkaXRvcixcbiAgICAgICAgLy8gY3JlYXRlIGEgdGV4dCBtZW50aW9uIHdoZW4gdXNpbmcgYSB0ZXh0IGVkaXRvclxuICAgICAgICBjcmVhdGVUZXh0TWVudGlvbixcbiAgICAgICAgLy8gZGVsZXRlIGEgdGV4dCBtZW50aW9uIHdoZW4gdXNpbmcgYSB0ZXh0IGVkaXRvclxuICAgICAgICBkZWxldGVUZXh0TWVudGlvbixcbiAgICAgICAgLy8gU3VwcG9ydCBmb3IgdGhlIExpdmVibG9ja3MgYnJvd3NlciBleHRlbnNpb25cbiAgICAgICAgZ2V0U2VsZl9mb3JEZXZUb29sczogKCkgPT4gc2VsZkFzVHJlZU5vZGUuY3VycmVudCxcbiAgICAgICAgZ2V0T3RoZXJzX2ZvckRldlRvb2xzOiAoKSA9PiBvdGhlcnNfZm9yRGV2VG9vbHMuY3VycmVudCxcbiAgICAgICAgLy8gcHJldHRpZXItaWdub3JlXG4gICAgICAgIHNpbXVsYXRlOiB7XG4gICAgICAgICAgLy8gVGhlc2UgZXhpc3Qgb25seSBmb3Igb3VyIEUyRSB0ZXN0aW5nIGFwcFxuICAgICAgICAgIGV4cGxpY2l0Q2xvc2U6IChldmVudCkgPT4gbWFuYWdlZFNvY2tldC5fcHJpdmF0ZVNlbmRNYWNoaW5lRXZlbnQoeyB0eXBlOiBcIkVYUExJQ0lUX1NPQ0tFVF9DTE9TRVwiLCBldmVudCB9KSxcbiAgICAgICAgICByYXdTZW5kOiAoZGF0YSkgPT4gbWFuYWdlZFNvY2tldC5zZW5kKGRhdGEpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpZDogY29uZmlnLnJvb21JZCxcbiAgICAgIHN1YnNjcmliZTogbWFrZUNsYXNzaWNTdWJzY3JpYmVGbihldmVudHMpLFxuICAgICAgY29ubmVjdDogKCkgPT4gbWFuYWdlZFNvY2tldC5jb25uZWN0KCksXG4gICAgICByZWNvbm5lY3Q6ICgpID0+IG1hbmFnZWRTb2NrZXQucmVjb25uZWN0KCksXG4gICAgICBkaXNjb25uZWN0OiAoKSA9PiBtYW5hZ2VkU29ja2V0LmRpc2Nvbm5lY3QoKSxcbiAgICAgIGRlc3Ryb3k6ICgpID0+IHtcbiAgICAgICAgdW5pbnN0YWxsQmdUYWJTcHkoKTtcbiAgICAgICAgbWFuYWdlZFNvY2tldC5kZXN0cm95KCk7XG4gICAgICB9LFxuICAgICAgLy8gUHJlc2VuY2VcbiAgICAgIHVwZGF0ZVByZXNlbmNlLFxuICAgICAgdXBkYXRlWURvYyxcbiAgICAgIGJyb2FkY2FzdEV2ZW50LFxuICAgICAgLy8gU3RvcmFnZVxuICAgICAgYmF0Y2gsXG4gICAgICBoaXN0b3J5OiB7XG4gICAgICAgIHVuZG8sXG4gICAgICAgIHJlZG8sXG4gICAgICAgIGNhblVuZG8sXG4gICAgICAgIGNhblJlZG8sXG4gICAgICAgIGNsZWFyLFxuICAgICAgICBwYXVzZTogcGF1c2VIaXN0b3J5LFxuICAgICAgICByZXN1bWU6IHJlc3VtZUhpc3RvcnlcbiAgICAgIH0sXG4gICAgICBmZXRjaFlEb2MsXG4gICAgICBnZXRTdG9yYWdlLFxuICAgICAgZ2V0U3RvcmFnZVNuYXBzaG90LFxuICAgICAgZ2V0U3RvcmFnZVN0YXR1cyxcbiAgICAgIGlzUHJlc2VuY2VSZWFkeSxcbiAgICAgIGlzU3RvcmFnZVJlYWR5LFxuICAgICAgd2FpdFVudGlsUHJlc2VuY2VSZWFkeTogbWVtb2l6ZU9uU3VjY2Vzcyh3YWl0VW50aWxQcmVzZW5jZVJlYWR5KSxcbiAgICAgIHdhaXRVbnRpbFN0b3JhZ2VSZWFkeTogbWVtb2l6ZU9uU3VjY2Vzcyh3YWl0VW50aWxTdG9yYWdlUmVhZHkpLFxuICAgICAgZXZlbnRzLFxuICAgICAgLy8gQ29yZVxuICAgICAgZ2V0U3RhdHVzOiAoKSA9PiBtYW5hZ2VkU29ja2V0LmdldFN0YXR1cygpLFxuICAgICAgZ2V0U2VsZjogKCkgPT4gc2VsZi5jdXJyZW50LFxuICAgICAgLy8gUHJlc2VuY2VcbiAgICAgIGdldFByZXNlbmNlOiAoKSA9PiBjb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudCxcbiAgICAgIGdldE90aGVyczogKCkgPT4gY29udGV4dC5vdGhlcnMuY3VycmVudCxcbiAgICAgIGdldE5vdGlmaWNhdGlvblNldHRpbmdzLFxuICAgICAgdXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MsXG4gICAgICBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQsXG4gICAgICAuLi5jb21tZW50c0FwaVxuICAgIH0sXG4gICAgLy8gRXhwbGljdGx5IG1ha2UgdGhlIGludGVybmFsIGZpZWxkIG5vbi1lbnVtZXJhYmxlLCB0byBhdm9pZCBhZ2dyZXNzaXZlXG4gICAgLy8gZnJlZXppbmcgd2hlbiB1c2VkIHdpdGggSW1tZXJcbiAgICBrSW50ZXJuYWwsXG4gICAgeyBlbnVtZXJhYmxlOiBmYWxzZSB9XG4gICk7XG59XG5mdW5jdGlvbiBtYWtlQ2xhc3NpY1N1YnNjcmliZUZuKGV2ZW50cykge1xuICBmdW5jdGlvbiBzdWJzY3JpYmVUb0xpdmVTdHJ1Y3R1cmVEZWVwbHkobm9kZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZXZlbnRzLnN0b3JhZ2VCYXRjaC5zdWJzY3JpYmUoKHVwZGF0ZXMpID0+IHtcbiAgICAgIGNvbnN0IHJlbGF0ZWRVcGRhdGVzID0gdXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICh1cGRhdGUpID0+IGlzU2FtZU5vZGVPckNoaWxkT2YodXBkYXRlLm5vZGUsIG5vZGUpXG4gICAgICApO1xuICAgICAgaWYgKHJlbGF0ZWRVcGRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY2FsbGJhY2socmVsYXRlZFVwZGF0ZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIHN1YnNjcmliZVRvTGl2ZVN0cnVjdHVyZVNoYWxsb3dseShub2RlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBldmVudHMuc3RvcmFnZUJhdGNoLnN1YnNjcmliZSgodXBkYXRlcykgPT4ge1xuICAgICAgZm9yIChjb25zdCB1cGRhdGUgb2YgdXBkYXRlcykge1xuICAgICAgICBpZiAodXBkYXRlLm5vZGUuX2lkID09PSBub2RlLl9pZCkge1xuICAgICAgICAgIGNhbGxiYWNrKHVwZGF0ZS5ub2RlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIHN1YnNjcmliZShmaXJzdCwgc2Vjb25kLCBvcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBmaXJzdCA9PT0gXCJzdHJpbmdcIiAmJiBpc1Jvb21FdmVudE5hbWUoZmlyc3QpKSB7XG4gICAgICBpZiAodHlwZW9mIHNlY29uZCAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlY29uZCBhcmd1bWVudCBtdXN0IGJlIGEgY2FsbGJhY2sgZnVuY3Rpb25cIik7XG4gICAgICB9XG4gICAgICBjb25zdCBjYWxsYmFjayA9IHNlY29uZDtcbiAgICAgIHN3aXRjaCAoZmlyc3QpIHtcbiAgICAgICAgY2FzZSBcImV2ZW50XCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5jdXN0b21FdmVudC5zdWJzY3JpYmUoXG4gICAgICAgICAgICBjYWxsYmFja1xuICAgICAgICAgICk7XG4gICAgICAgIGNhc2UgXCJteS1wcmVzZW5jZVwiOlxuICAgICAgICAgIHJldHVybiBldmVudHMubXlQcmVzZW5jZS5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICBjYXNlIFwib3RoZXJzXCI6IHtcbiAgICAgICAgICBjb25zdCBjYiA9IGNhbGxiYWNrO1xuICAgICAgICAgIHJldHVybiBldmVudHMub3RoZXJzLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3RoZXJzLCAuLi5pbnRlcm5hbEV2ZW50IH0gPSBldmVudDtcbiAgICAgICAgICAgIHJldHVybiBjYihvdGhlcnMsIGludGVybmFsRXZlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgICAgIHJldHVybiBldmVudHMuZXJyb3Iuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgY2FzZSBcInN0YXR1c1wiOlxuICAgICAgICAgIHJldHVybiBldmVudHMuc3RhdHVzLnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgIGNhc2UgXCJsb3N0LWNvbm5lY3Rpb25cIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLmxvc3RDb25uZWN0aW9uLnN1YnNjcmliZShcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgY2FzZSBcImhpc3RvcnlcIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLmhpc3Rvcnkuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgY2FzZSBcInN0b3JhZ2Utc3RhdHVzXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5zdG9yYWdlU3RhdHVzLnN1YnNjcmliZShcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgY2FzZSBcImNvbW1lbnRzXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5jb21tZW50cy5zdWJzY3JpYmUoXG4gICAgICAgICAgICBjYWxsYmFja1xuICAgICAgICAgICk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKFxuICAgICAgICAgICAgZmlyc3QsXG4gICAgICAgICAgICBgXCIke1N0cmluZyhmaXJzdCl9XCIgaXMgbm90IGEgdmFsaWQgZXZlbnQgbmFtZWBcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc2Vjb25kID09PSB2b2lkIDAgfHwgdHlwZW9mIGZpcnN0ID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGlmICh0eXBlb2YgZmlyc3QgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjb25zdCBzdG9yYWdlQ2FsbGJhY2sgPSBmaXJzdDtcbiAgICAgICAgcmV0dXJuIGV2ZW50cy5zdG9yYWdlQmF0Y2guc3Vic2NyaWJlKHN0b3JhZ2VDYWxsYmFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQbGVhc2Ugc3BlY2lmeSBhIGxpc3RlbmVyIGNhbGxiYWNrXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaXNMaXZlTm9kZShmaXJzdCkpIHtcbiAgICAgIGNvbnN0IG5vZGUgPSBmaXJzdDtcbiAgICAgIGlmIChvcHRpb25zPy5pc0RlZXApIHtcbiAgICAgICAgY29uc3Qgc3RvcmFnZUNhbGxiYWNrID0gc2Vjb25kO1xuICAgICAgICByZXR1cm4gc3Vic2NyaWJlVG9MaXZlU3RydWN0dXJlRGVlcGx5KG5vZGUsIHN0b3JhZ2VDYWxsYmFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBub2RlQ2FsbGJhY2sgPSBzZWNvbmQ7XG4gICAgICAgIHJldHVybiBzdWJzY3JpYmVUb0xpdmVTdHJ1Y3R1cmVTaGFsbG93bHkobm9kZSwgbm9kZUNhbGxiYWNrKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYCR7U3RyaW5nKGZpcnN0KX0gaXMgbm90IGEgdmFsdWUgdGhhdCBjYW4gYmUgc3Vic2NyaWJlZCB0by5gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gc3Vic2NyaWJlO1xufVxuZnVuY3Rpb24gaXNSb29tRXZlbnROYW1lKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSA9PT0gXCJteS1wcmVzZW5jZVwiIHx8IHZhbHVlID09PSBcIm90aGVyc1wiIHx8IHZhbHVlID09PSBcImV2ZW50XCIgfHwgdmFsdWUgPT09IFwiZXJyb3JcIiB8fCB2YWx1ZSA9PT0gXCJoaXN0b3J5XCIgfHwgdmFsdWUgPT09IFwic3RhdHVzXCIgfHwgdmFsdWUgPT09IFwic3RvcmFnZS1zdGF0dXNcIiB8fCB2YWx1ZSA9PT0gXCJsb3N0LWNvbm5lY3Rpb25cIiB8fCB2YWx1ZSA9PT0gXCJjb25uZWN0aW9uXCIgfHwgdmFsdWUgPT09IFwiY29tbWVudHNcIjtcbn1cbmZ1bmN0aW9uIG1ha2VBdXRoRGVsZWdhdGVGb3JSb29tKHJvb21JZCwgYXV0aE1hbmFnZXIpIHtcbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcbiAgICByZXR1cm4gYXV0aE1hbmFnZXIuZ2V0QXV0aFZhbHVlKHsgcmVxdWVzdGVkU2NvcGU6IFwicm9vbTpyZWFkXCIsIHJvb21JZCB9KTtcbiAgfTtcbn1cbmZ1bmN0aW9uIG1ha2VDcmVhdGVTb2NrZXREZWxlZ2F0ZUZvclJvb20ocm9vbUlkLCBiYXNlVXJsLCBXZWJTb2NrZXRQb2x5ZmlsbCkge1xuICByZXR1cm4gKGF1dGhWYWx1ZSkgPT4ge1xuICAgIGNvbnN0IHdzID0gV2ViU29ja2V0UG9seWZpbGwgPz8gKHR5cGVvZiBXZWJTb2NrZXQgPT09IFwidW5kZWZpbmVkXCIgPyB2b2lkIDAgOiBXZWJTb2NrZXQpO1xuICAgIGlmICh3cyA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKFxuICAgICAgICBcIlRvIHVzZSBMaXZlYmxvY2tzIGNsaWVudCBpbiBhIG5vbi1ET00gZW52aXJvbm1lbnQsIHlvdSBuZWVkIHRvIHByb3ZpZGUgYSBXZWJTb2NrZXQgcG9seWZpbGwuXCJcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYmFzZVVybCk7XG4gICAgdXJsLnByb3RvY29sID0gdXJsLnByb3RvY29sID09PSBcImh0dHA6XCIgPyBcIndzXCIgOiBcIndzc1wiO1xuICAgIHVybC5wYXRobmFtZSA9IFwiL3Y3XCI7XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyb29tSWRcIiwgcm9vbUlkKTtcbiAgICBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwic2VjcmV0XCIpIHtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwidG9rXCIsIGF1dGhWYWx1ZS50b2tlbi5yYXcpO1xuICAgIH0gZWxzZSBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwicHVibGljXCIpIHtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwicHVia2V5XCIsIGF1dGhWYWx1ZS5wdWJsaWNBcGlLZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIoYXV0aFZhbHVlLCBcIlVuaGFuZGxlZCBjYXNlXCIpO1xuICAgIH1cbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInZlcnNpb25cIiwgUEtHX1ZFUlNJT04gfHwgXCJkZXZcIik7XG4gICAgcmV0dXJuIG5ldyB3cyh1cmwudG9TdHJpbmcoKSk7XG4gIH07XG59XG5cbi8vIHNyYy9zdG9yZS50c1xuZnVuY3Rpb24gY3JlYXRlQ2xpZW50U3RvcmUoKSB7XG4gIGNvbnN0IHN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICAgIHRocmVhZHM6IHt9LFxuICAgIHF1ZXJpZXM6IHt9LFxuICAgIG9wdGltaXN0aWNVcGRhdGVzOiBbXSxcbiAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHt9LFxuICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB7fVxuICB9KTtcbiAgY29uc3Qgb3B0aW1pc3RpY1VwZGF0ZXNFdmVudFNvdXJjZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICByZXR1cm4ge1xuICAgIC4uLnN0b3JlLFxuICAgIGRlbGV0ZVRocmVhZCh0aHJlYWRJZCkge1xuICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIHRocmVhZHM6IGRlbGV0ZUtleUltbXV0YWJsZShzdGF0ZS50aHJlYWRzLCB0aHJlYWRJZCksXG4gICAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhzdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMpLmZpbHRlcihcbiAgICAgICAgICAgICAgKFtfaWQsIG5vdGlmaWNhdGlvbl0pID0+IG5vdGlmaWNhdGlvbi5raW5kID09PSBcInRocmVhZFwiICYmIG5vdGlmaWNhdGlvbi50aHJlYWRJZCA9PT0gdGhyZWFkSWRcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVwZGF0ZVRocmVhZEFuZE5vdGlmaWNhdGlvbih0aHJlYWQsIGluYm94Tm90aWZpY2F0aW9uKSB7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWQuaWRdO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIHRocmVhZHM6IGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDAgfHwgY29tcGFyZVRocmVhZHModGhyZWFkLCBleGlzdGluZ1RocmVhZCkgPT09IDEgPyB7IC4uLnN0YXRlLnRocmVhZHMsIFt0aHJlYWQuaWRdOiB0aHJlYWQgfSA6IHN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBpbmJveE5vdGlmaWNhdGlvbiA9PT0gdm9pZCAwID8gc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zIDoge1xuICAgICAgICAgICAgLi4uc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICAgICAgW2luYm94Tm90aWZpY2F0aW9uLmlkXTogaW5ib3hOb3RpZmljYXRpb25cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVwZGF0ZVRocmVhZHNBbmROb3RpZmljYXRpb25zKHRocmVhZHMsIGluYm94Tm90aWZpY2F0aW9ucywgZGVsZXRlZFRocmVhZHMsIGRlbGV0ZWRJbmJveE5vdGlmaWNhdGlvbnMsIHF1ZXJ5S2V5KSB7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgdGhyZWFkczogYXBwbHlUaHJlYWRVcGRhdGVzKHN0YXRlLnRocmVhZHMsIHtcbiAgICAgICAgICBuZXdUaHJlYWRzOiB0aHJlYWRzLFxuICAgICAgICAgIGRlbGV0ZWRUaHJlYWRzXG4gICAgICAgIH0pLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IGFwcGx5Tm90aWZpY2F0aW9uc1VwZGF0ZXMoXG4gICAgICAgICAgc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5ld0luYm94Tm90aWZpY2F0aW9uczogaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICAgICAgZGVsZXRlZE5vdGlmaWNhdGlvbnM6IGRlbGV0ZWRJbmJveE5vdGlmaWNhdGlvbnNcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHF1ZXJpZXM6IHF1ZXJ5S2V5ICE9PSB2b2lkIDAgPyB7XG4gICAgICAgICAgLi4uc3RhdGUucXVlcmllcyxcbiAgICAgICAgICBbcXVlcnlLZXldOiB7IGlzTG9hZGluZzogZmFsc2UsIGRhdGE6IHZvaWQgMCB9XG4gICAgICAgIH0gOiBzdGF0ZS5xdWVyaWVzXG4gICAgICB9KSk7XG4gICAgfSxcbiAgICB1cGRhdGVSb29tSW5ib3hOb3RpZmljYXRpb25TZXR0aW5ncyhyb29tSWQsIHNldHRpbmdzLCBxdWVyeUtleSkge1xuICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB7XG4gICAgICAgICAgLi4uc3RhdGUubm90aWZpY2F0aW9uU2V0dGluZ3MsXG4gICAgICAgICAgW3Jvb21JZF06IHNldHRpbmdzXG4gICAgICAgIH0sXG4gICAgICAgIHF1ZXJpZXM6IHtcbiAgICAgICAgICAuLi5zdGF0ZS5xdWVyaWVzLFxuICAgICAgICAgIFtxdWVyeUtleV06IHsgaXNMb2FkaW5nOiBmYWxzZSwgZGF0YTogdm9pZCAwIH1cbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgcHVzaE9wdGltaXN0aWNVcGRhdGUob3B0aW1pc3RpY1VwZGF0ZSkge1xuICAgICAgb3B0aW1pc3RpY1VwZGF0ZXNFdmVudFNvdXJjZS5ub3RpZnkob3B0aW1pc3RpY1VwZGF0ZSk7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IFsuLi5zdGF0ZS5vcHRpbWlzdGljVXBkYXRlcywgb3B0aW1pc3RpY1VwZGF0ZV1cbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIHNldFF1ZXJ5U3RhdGUocXVlcnlLZXksIHF1ZXJ5U3RhdGUpIHtcbiAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBxdWVyaWVzOiB7XG4gICAgICAgICAgLi4uc3RhdGUucXVlcmllcyxcbiAgICAgICAgICBbcXVlcnlLZXldOiBxdWVyeVN0YXRlXG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIG9wdGltaXN0aWNVcGRhdGVzRXZlbnRTb3VyY2VcbiAgfTtcbn1cbmZ1bmN0aW9uIGRlbGV0ZUtleUltbXV0YWJsZShyZWNvcmQsIGtleSkge1xuICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY29yZCwga2V5KSkge1xuICAgIGNvbnN0IHsgW2tleV06IF90b0RlbGV0ZSwgLi4ucmVzdCB9ID0gcmVjb3JkO1xuICAgIHJldHVybiByZXN0O1xuICB9XG4gIHJldHVybiByZWNvcmQ7XG59XG5mdW5jdGlvbiBjb21wYXJlVGhyZWFkcyh0aHJlYWQxLCB0aHJlYWQyKSB7XG4gIGlmICh0aHJlYWQxLnVwZGF0ZWRBdCAmJiB0aHJlYWQyLnVwZGF0ZWRBdCkge1xuICAgIHJldHVybiB0aHJlYWQxLnVwZGF0ZWRBdCA+IHRocmVhZDIudXBkYXRlZEF0ID8gMSA6IHRocmVhZDEudXBkYXRlZEF0IDwgdGhyZWFkMi51cGRhdGVkQXQgPyAtMSA6IDA7XG4gIH0gZWxzZSBpZiAodGhyZWFkMS51cGRhdGVkQXQgfHwgdGhyZWFkMi51cGRhdGVkQXQpIHtcbiAgICByZXR1cm4gdGhyZWFkMS51cGRhdGVkQXQgPyAxIDogLTE7XG4gIH1cbiAgaWYgKHRocmVhZDEuY3JlYXRlZEF0ID4gdGhyZWFkMi5jcmVhdGVkQXQpIHtcbiAgICByZXR1cm4gMTtcbiAgfSBlbHNlIGlmICh0aHJlYWQxLmNyZWF0ZWRBdCA8IHRocmVhZDIuY3JlYXRlZEF0KSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIHJldHVybiAwO1xufVxuZnVuY3Rpb24gYXBwbHlPcHRpbWlzdGljVXBkYXRlcyhzdGF0ZSkge1xuICBjb25zdCByZXN1bHQgPSB7XG4gICAgdGhyZWFkczoge1xuICAgICAgLi4uc3RhdGUudGhyZWFkc1xuICAgIH0sXG4gICAgaW5ib3hOb3RpZmljYXRpb25zOiB7XG4gICAgICAuLi5zdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnNcbiAgICB9LFxuICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB7XG4gICAgICAuLi5zdGF0ZS5ub3RpZmljYXRpb25TZXR0aW5nc1xuICAgIH1cbiAgfTtcbiAgZm9yIChjb25zdCBvcHRpbWlzdGljVXBkYXRlIG9mIHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzKSB7XG4gICAgc3dpdGNoIChvcHRpbWlzdGljVXBkYXRlLnR5cGUpIHtcbiAgICAgIGNhc2UgXCJjcmVhdGUtdGhyZWFkXCI6IHtcbiAgICAgICAgcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWQuaWRdID0gb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVkaXQtdGhyZWFkLW1ldGFkYXRhXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhyZWFkLnVwZGF0ZWRBdCAhPT0gdm9pZCAwICYmIHRocmVhZC51cGRhdGVkQXQgPiBvcHRpbWlzdGljVXBkYXRlLnVwZGF0ZWRBdCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSB7XG4gICAgICAgICAgLi4udGhyZWFkLFxuICAgICAgICAgIHVwZGF0ZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS51cGRhdGVkQXQsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIC4uLnRocmVhZC5tZXRhZGF0YSxcbiAgICAgICAgICAgIC4uLm9wdGltaXN0aWNVcGRhdGUubWV0YWRhdGFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm1hcmstdGhyZWFkLWFzLXJlc29sdmVkXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0ge1xuICAgICAgICAgIC4uLnRocmVhZCxcbiAgICAgICAgICByZXNvbHZlZDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJtYXJrLXRocmVhZC1hcy11bnJlc29sdmVkXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0ge1xuICAgICAgICAgIC4uLnRocmVhZCxcbiAgICAgICAgICByZXNvbHZlZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY3JlYXRlLWNvbW1lbnRcIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnQudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gdXBzZXJ0Q29tbWVudChcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50XG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zKS5maW5kKFxuICAgICAgICAgIChub3RpZmljYXRpb24pID0+IG5vdGlmaWNhdGlvbi5raW5kID09PSBcInRocmVhZFwiICYmIG5vdGlmaWNhdGlvbi50aHJlYWRJZCA9PT0gdGhyZWFkLmlkXG4gICAgICAgICk7XG4gICAgICAgIGlmIChpbmJveE5vdGlmaWNhdGlvbiA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9uc1tpbmJveE5vdGlmaWNhdGlvbi5pZF0gPSB7XG4gICAgICAgICAgLi4uaW5ib3hOb3RpZmljYXRpb24sXG4gICAgICAgICAgbm90aWZpZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50LmNyZWF0ZWRBdCxcbiAgICAgICAgICByZWFkQXQ6IG9wdGltaXN0aWNVcGRhdGUuY29tbWVudC5jcmVhdGVkQXRcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZWRpdC1jb21tZW50XCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50LnRocmVhZElkXTtcbiAgICAgICAgaWYgKHRocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnRocmVhZHNbdGhyZWFkLmlkXSA9IHVwc2VydENvbW1lbnQoXG4gICAgICAgICAgdGhyZWFkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUuY29tbWVudFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJkZWxldGUtY29tbWVudFwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gZGVsZXRlQ29tbWVudChcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50SWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5kZWxldGVkQXRcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZGVsZXRlLXRocmVhZFwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXSA9IHtcbiAgICAgICAgICAuLi5yZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXSxcbiAgICAgICAgICBkZWxldGVkQXQ6IG9wdGltaXN0aWNVcGRhdGUuZGVsZXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5kZWxldGVkQXQsXG4gICAgICAgICAgY29tbWVudHM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImFkZC1yZWFjdGlvblwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gYWRkUmVhY3Rpb24oXG4gICAgICAgICAgdGhyZWFkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUuY29tbWVudElkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUucmVhY3Rpb25cbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3ZlLXJlYWN0aW9uXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSByZW1vdmVSZWFjdGlvbihcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50SWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5lbW9qaSxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLnVzZXJJZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLnJlbW92ZWRBdFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJtYXJrLWluYm94LW5vdGlmaWNhdGlvbi1hcy1yZWFkXCI6IHtcbiAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9uc1tvcHRpbWlzdGljVXBkYXRlLmluYm94Tm90aWZpY2F0aW9uSWRdID0ge1xuICAgICAgICAgIC4uLnN0YXRlLmluYm94Tm90aWZpY2F0aW9uc1tvcHRpbWlzdGljVXBkYXRlLmluYm94Tm90aWZpY2F0aW9uSWRdLFxuICAgICAgICAgIHJlYWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5yZWFkQXRcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwibWFyay1hbGwtaW5ib3gtbm90aWZpY2F0aW9ucy1hcy1yZWFkXCI6IHtcbiAgICAgICAgZm9yIChjb25zdCBpZCBpbiByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9uc1tpZF0gPSB7XG4gICAgICAgICAgICAuLi5yZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zW2lkXSxcbiAgICAgICAgICAgIHJlYWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5yZWFkQXRcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImRlbGV0ZS1pbmJveC1ub3RpZmljYXRpb25cIjoge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgW29wdGltaXN0aWNVcGRhdGUuaW5ib3hOb3RpZmljYXRpb25JZF06IF8sXG4gICAgICAgICAgLi4uaW5ib3hOb3RpZmljYXRpb25zXG4gICAgICAgIH0gPSByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zO1xuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zID0gaW5ib3hOb3RpZmljYXRpb25zO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJkZWxldGUtYWxsLWluYm94LW5vdGlmaWNhdGlvbnNcIjoge1xuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zID0ge307XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVwZGF0ZS1ub3RpZmljYXRpb24tc2V0dGluZ3NcIjoge1xuICAgICAgICByZXN1bHQubm90aWZpY2F0aW9uU2V0dGluZ3Nbb3B0aW1pc3RpY1VwZGF0ZS5yb29tSWRdID0ge1xuICAgICAgICAgIC4uLnJlc3VsdC5ub3RpZmljYXRpb25TZXR0aW5nc1tvcHRpbWlzdGljVXBkYXRlLnJvb21JZF0sXG4gICAgICAgICAgLi4ub3B0aW1pc3RpY1VwZGF0ZS5zZXR0aW5nc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gYXBwbHlUaHJlYWRVcGRhdGVzKGV4aXN0aW5nVGhyZWFkcywgdXBkYXRlcykge1xuICBjb25zdCB1cGRhdGVkVGhyZWFkcyA9IHsgLi4uZXhpc3RpbmdUaHJlYWRzIH07XG4gIHVwZGF0ZXMubmV3VGhyZWFkcy5mb3JFYWNoKCh0aHJlYWQpID0+IHtcbiAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHVwZGF0ZWRUaHJlYWRzW3RocmVhZC5pZF07XG4gICAgaWYgKGV4aXN0aW5nVGhyZWFkKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlVGhyZWFkcyhleGlzdGluZ1RocmVhZCwgdGhyZWFkKTtcbiAgICAgIGlmIChyZXN1bHQgPT09IDEpIHJldHVybjtcbiAgICB9XG4gICAgdXBkYXRlZFRocmVhZHNbdGhyZWFkLmlkXSA9IHRocmVhZDtcbiAgfSk7XG4gIHVwZGF0ZXMuZGVsZXRlZFRocmVhZHMuZm9yRWFjaCgoeyBpZCwgZGVsZXRlZEF0IH0pID0+IHtcbiAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHVwZGF0ZWRUaHJlYWRzW2lkXTtcbiAgICBpZiAoZXhpc3RpbmdUaHJlYWQgPT09IHZvaWQgMCkgcmV0dXJuO1xuICAgIGV4aXN0aW5nVGhyZWFkLmRlbGV0ZWRBdCA9IGRlbGV0ZWRBdDtcbiAgICBleGlzdGluZ1RocmVhZC51cGRhdGVkQXQgPSBkZWxldGVkQXQ7XG4gICAgZXhpc3RpbmdUaHJlYWQuY29tbWVudHMgPSBbXTtcbiAgfSk7XG4gIHJldHVybiB1cGRhdGVkVGhyZWFkcztcbn1cbmZ1bmN0aW9uIGFwcGx5Tm90aWZpY2F0aW9uc1VwZGF0ZXMoZXhpc3RpbmdJbmJveE5vdGlmaWNhdGlvbnMsIHVwZGF0ZXMpIHtcbiAgY29uc3QgdXBkYXRlZEluYm94Tm90aWZpY2F0aW9ucyA9IHsgLi4uZXhpc3RpbmdJbmJveE5vdGlmaWNhdGlvbnMgfTtcbiAgdXBkYXRlcy5uZXdJbmJveE5vdGlmaWNhdGlvbnMuZm9yRWFjaCgobm90aWZpY2F0aW9uKSA9PiB7XG4gICAgY29uc3QgZXhpc3RpbmdOb3RpZmljYXRpb24gPSB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zW25vdGlmaWNhdGlvbi5pZF07XG4gICAgaWYgKGV4aXN0aW5nTm90aWZpY2F0aW9uKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlSW5ib3hOb3RpZmljYXRpb25zKFxuICAgICAgICBleGlzdGluZ05vdGlmaWNhdGlvbixcbiAgICAgICAgbm90aWZpY2F0aW9uXG4gICAgICApO1xuICAgICAgaWYgKHJlc3VsdCA9PT0gMSkgcmV0dXJuO1xuICAgIH1cbiAgICB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zW25vdGlmaWNhdGlvbi5pZF0gPSBub3RpZmljYXRpb247XG4gIH0pO1xuICB1cGRhdGVzLmRlbGV0ZWROb3RpZmljYXRpb25zLmZvckVhY2goXG4gICAgKHsgaWQgfSkgPT4gZGVsZXRlIHVwZGF0ZWRJbmJveE5vdGlmaWNhdGlvbnNbaWRdXG4gICk7XG4gIHJldHVybiB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zO1xufVxuZnVuY3Rpb24gY29tcGFyZUluYm94Tm90aWZpY2F0aW9ucyhpbmJveE5vdGlmaWNhdGlvbkEsIGluYm94Tm90aWZpY2F0aW9uQikge1xuICBpZiAoaW5ib3hOb3RpZmljYXRpb25BLm5vdGlmaWVkQXQgPiBpbmJveE5vdGlmaWNhdGlvbkIubm90aWZpZWRBdCkge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2UgaWYgKGluYm94Tm90aWZpY2F0aW9uQS5ub3RpZmllZEF0IDwgaW5ib3hOb3RpZmljYXRpb25CLm5vdGlmaWVkQXQpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgaWYgKGluYm94Tm90aWZpY2F0aW9uQS5yZWFkQXQgJiYgaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCkge1xuICAgIHJldHVybiBpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0ID4gaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCA/IDEgOiBpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0IDwgaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCA/IC0xIDogMDtcbiAgfSBlbHNlIGlmIChpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0IHx8IGluYm94Tm90aWZpY2F0aW9uQi5yZWFkQXQpIHtcbiAgICByZXR1cm4gaW5ib3hOb3RpZmljYXRpb25BLnJlYWRBdCA/IDEgOiAtMTtcbiAgfVxuICByZXR1cm4gMDtcbn1cbmZ1bmN0aW9uIHVwc2VydENvbW1lbnQodGhyZWFkLCBjb21tZW50KSB7XG4gIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGlmIChjb21tZW50LnRocmVhZElkICE9PSB0aHJlYWQuaWQpIHtcbiAgICB3YXJuKFxuICAgICAgYENvbW1lbnQgJHtjb21tZW50LmlkfSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhyZWFkICR7dGhyZWFkLmlkfWBcbiAgICApO1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgZXhpc3RpbmdDb21tZW50ID0gdGhyZWFkLmNvbW1lbnRzLmZpbmQoXG4gICAgKGV4aXN0aW5nQ29tbWVudDIpID0+IGV4aXN0aW5nQ29tbWVudDIuaWQgPT09IGNvbW1lbnQuaWRcbiAgKTtcbiAgaWYgKGV4aXN0aW5nQ29tbWVudCA9PT0gdm9pZCAwKSB7XG4gICAgY29uc3QgdXBkYXRlZEF0ID0gbmV3IERhdGUoXG4gICAgICBNYXRoLm1heCh0aHJlYWQudXBkYXRlZEF0Py5nZXRUaW1lKCkgfHwgMCwgY29tbWVudC5jcmVhdGVkQXQuZ2V0VGltZSgpKVxuICAgICk7XG4gICAgY29uc3QgdXBkYXRlZFRocmVhZCA9IHtcbiAgICAgIC4uLnRocmVhZCxcbiAgICAgIHVwZGF0ZWRBdCxcbiAgICAgIGNvbW1lbnRzOiBbLi4udGhyZWFkLmNvbW1lbnRzLCBjb21tZW50XVxuICAgIH07XG4gICAgcmV0dXJuIHVwZGF0ZWRUaHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5lZGl0ZWRBdCA9PT0gdm9pZCAwIHx8IGNvbW1lbnQuZWRpdGVkQXQgPT09IHZvaWQgMCB8fCBleGlzdGluZ0NvbW1lbnQuZWRpdGVkQXQgPD0gY29tbWVudC5lZGl0ZWRBdCkge1xuICAgIGNvbnN0IHVwZGF0ZWRDb21tZW50cyA9IHRocmVhZC5jb21tZW50cy5tYXAoXG4gICAgICAoZXhpc3RpbmdDb21tZW50MikgPT4gZXhpc3RpbmdDb21tZW50Mi5pZCA9PT0gY29tbWVudC5pZCA/IGNvbW1lbnQgOiBleGlzdGluZ0NvbW1lbnQyXG4gICAgKTtcbiAgICBjb25zdCB1cGRhdGVkVGhyZWFkID0ge1xuICAgICAgLi4udGhyZWFkLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShcbiAgICAgICAgTWF0aC5tYXgoXG4gICAgICAgICAgdGhyZWFkLnVwZGF0ZWRBdD8uZ2V0VGltZSgpIHx8IDAsXG4gICAgICAgICAgY29tbWVudC5lZGl0ZWRBdD8uZ2V0VGltZSgpIHx8IGNvbW1lbnQuY3JlYXRlZEF0LmdldFRpbWUoKVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgY29tbWVudHM6IHVwZGF0ZWRDb21tZW50c1xuICAgIH07XG4gICAgcmV0dXJuIHVwZGF0ZWRUaHJlYWQ7XG4gIH1cbiAgcmV0dXJuIHRocmVhZDtcbn1cbmZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQodGhyZWFkLCBjb21tZW50SWQsIGRlbGV0ZWRBdCkge1xuICBpZiAodGhyZWFkLmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCBleGlzdGluZ0NvbW1lbnQgPSB0aHJlYWQuY29tbWVudHMuZmluZChcbiAgICAoY29tbWVudCkgPT4gY29tbWVudC5pZCA9PT0gY29tbWVudElkXG4gICk7XG4gIGlmIChleGlzdGluZ0NvbW1lbnQgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgdXBkYXRlZENvbW1lbnRzID0gdGhyZWFkLmNvbW1lbnRzLm1hcChcbiAgICAoY29tbWVudCkgPT4gY29tbWVudC5pZCA9PT0gY29tbWVudElkID8ge1xuICAgICAgLi4uY29tbWVudCxcbiAgICAgIGRlbGV0ZWRBdCxcbiAgICAgIGJvZHk6IHZvaWQgMFxuICAgIH0gOiBjb21tZW50XG4gICk7XG4gIGlmICghdXBkYXRlZENvbW1lbnRzLnNvbWUoKGNvbW1lbnQpID0+IGNvbW1lbnQuZGVsZXRlZEF0ID09PSB2b2lkIDApKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRocmVhZCxcbiAgICAgIGRlbGV0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogZGVsZXRlZEF0LFxuICAgICAgY29tbWVudHM6IFtdXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIC4uLnRocmVhZCxcbiAgICB1cGRhdGVkQXQ6IGRlbGV0ZWRBdCxcbiAgICBjb21tZW50czogdXBkYXRlZENvbW1lbnRzXG4gIH07XG59XG5mdW5jdGlvbiBhZGRSZWFjdGlvbih0aHJlYWQsIGNvbW1lbnRJZCwgcmVhY3Rpb24pIHtcbiAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgZXhpc3RpbmdDb21tZW50ID0gdGhyZWFkLmNvbW1lbnRzLmZpbmQoXG4gICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IGNvbW1lbnRJZFxuICApO1xuICBpZiAoZXhpc3RpbmdDb21tZW50ID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGlmIChleGlzdGluZ0NvbW1lbnQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGNvbnN0IHVwZGF0ZWRDb21tZW50cyA9IHRocmVhZC5jb21tZW50cy5tYXAoXG4gICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IGNvbW1lbnRJZCA/IHtcbiAgICAgIC4uLmNvbW1lbnQsXG4gICAgICByZWFjdGlvbnM6IHVwc2VydFJlYWN0aW9uKGNvbW1lbnQucmVhY3Rpb25zLCByZWFjdGlvbilcbiAgICB9IDogY29tbWVudFxuICApO1xuICByZXR1cm4ge1xuICAgIC4uLnRocmVhZCxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKFxuICAgICAgTWF0aC5tYXgocmVhY3Rpb24uY3JlYXRlZEF0LmdldFRpbWUoKSwgdGhyZWFkLnVwZGF0ZWRBdD8uZ2V0VGltZSgpIHx8IDApXG4gICAgKSxcbiAgICBjb21tZW50czogdXBkYXRlZENvbW1lbnRzXG4gIH07XG59XG5mdW5jdGlvbiByZW1vdmVSZWFjdGlvbih0aHJlYWQsIGNvbW1lbnRJZCwgZW1vamksIHVzZXJJZCwgcmVtb3ZlZEF0KSB7XG4gIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGNvbnN0IGV4aXN0aW5nQ29tbWVudCA9IHRocmVhZC5jb21tZW50cy5maW5kKFxuICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSBjb21tZW50SWRcbiAgKTtcbiAgaWYgKGV4aXN0aW5nQ29tbWVudCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBpZiAoZXhpc3RpbmdDb21tZW50LmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCB1cGRhdGVkQ29tbWVudHMgPSB0aHJlYWQuY29tbWVudHMubWFwKFxuICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSBjb21tZW50SWQgPyB7XG4gICAgICAuLi5jb21tZW50LFxuICAgICAgcmVhY3Rpb25zOiBjb21tZW50LnJlYWN0aW9ucy5tYXAoXG4gICAgICAgIChyZWFjdGlvbikgPT4gcmVhY3Rpb24uZW1vamkgPT09IGVtb2ppID8ge1xuICAgICAgICAgIC4uLnJlYWN0aW9uLFxuICAgICAgICAgIHVzZXJzOiByZWFjdGlvbi51c2Vycy5maWx0ZXIoKHVzZXIpID0+IHVzZXIuaWQgIT09IHVzZXJJZClcbiAgICAgICAgfSA6IHJlYWN0aW9uXG4gICAgICApLmZpbHRlcigocmVhY3Rpb24pID0+IHJlYWN0aW9uLnVzZXJzLmxlbmd0aCA+IDApXG4gICAgICAvLyBSZW1vdmUgcmVhY3Rpb25zIHdpdGggbm8gdXNlcnMgbGVmdFxuICAgIH0gOiBjb21tZW50XG4gICk7XG4gIHJldHVybiB7XG4gICAgLi4udGhyZWFkLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoXG4gICAgICBNYXRoLm1heChyZW1vdmVkQXQuZ2V0VGltZSgpLCB0aHJlYWQudXBkYXRlZEF0Py5nZXRUaW1lKCkgfHwgMClcbiAgICApLFxuICAgIGNvbW1lbnRzOiB1cGRhdGVkQ29tbWVudHNcbiAgfTtcbn1cbmZ1bmN0aW9uIHVwc2VydFJlYWN0aW9uKHJlYWN0aW9ucywgcmVhY3Rpb24pIHtcbiAgY29uc3QgZXhpc3RpbmdSZWFjdGlvbiA9IHJlYWN0aW9ucy5maW5kKFxuICAgIChleGlzdGluZ1JlYWN0aW9uMikgPT4gZXhpc3RpbmdSZWFjdGlvbjIuZW1vamkgPT09IHJlYWN0aW9uLmVtb2ppXG4gICk7XG4gIGlmIChleGlzdGluZ1JlYWN0aW9uID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gW1xuICAgICAgLi4ucmVhY3Rpb25zLFxuICAgICAge1xuICAgICAgICBlbW9qaTogcmVhY3Rpb24uZW1vamksXG4gICAgICAgIGNyZWF0ZWRBdDogcmVhY3Rpb24uY3JlYXRlZEF0LFxuICAgICAgICB1c2VyczogW3sgaWQ6IHJlYWN0aW9uLnVzZXJJZCB9XVxuICAgICAgfVxuICAgIF07XG4gIH1cbiAgaWYgKGV4aXN0aW5nUmVhY3Rpb24udXNlcnMuc29tZSgodXNlcikgPT4gdXNlci5pZCA9PT0gcmVhY3Rpb24udXNlcklkKSA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gcmVhY3Rpb25zLm1hcChcbiAgICAgIChleGlzdGluZ1JlYWN0aW9uMikgPT4gZXhpc3RpbmdSZWFjdGlvbjIuZW1vamkgPT09IHJlYWN0aW9uLmVtb2ppID8ge1xuICAgICAgICAuLi5leGlzdGluZ1JlYWN0aW9uMixcbiAgICAgICAgdXNlcnM6IFsuLi5leGlzdGluZ1JlYWN0aW9uMi51c2VycywgeyBpZDogcmVhY3Rpb24udXNlcklkIH1dXG4gICAgICB9IDogZXhpc3RpbmdSZWFjdGlvbjJcbiAgICApO1xuICB9XG4gIHJldHVybiByZWFjdGlvbnM7XG59XG5cbi8vIHNyYy9jbGllbnQudHNcbnZhciBNSU5fVEhST1RUTEUgPSAxNjtcbnZhciBNQVhfVEhST1RUTEUgPSAxZTM7XG52YXIgREVGQVVMVF9USFJPVFRMRSA9IDEwMDtcbnZhciBNSU5fQkFDS0dST1VORF9LRUVQX0FMSVZFX1RJTUVPVVQgPSAxNWUzO1xudmFyIE1JTl9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCA9IDIwMDtcbnZhciBSRUNPTU1FTkRFRF9NSU5fTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQgPSAxZTM7XG52YXIgTUFYX0xPU1RfQ09OTkVDVElPTl9USU1FT1VUID0gM2U0O1xudmFyIERFRkFVTFRfTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQgPSA1ZTM7XG52YXIgUkVTT0xWRV9VU0VSU19CQVRDSF9ERUxBWSA9IDUwO1xudmFyIFJFU09MVkVfUk9PTVNfSU5GT19CQVRDSF9ERUxBWSA9IDUwO1xuZnVuY3Rpb24gZ2V0QmFzZVVybChiYXNlVXJsKSB7XG4gIGlmICh0eXBlb2YgYmFzZVVybCA9PT0gXCJzdHJpbmdcIiAmJiBiYXNlVXJsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgcmV0dXJuIGJhc2VVcmw7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERFRkFVTFRfQkFTRV9VUkw7XG4gIH1cbn1cbmZ1bmN0aW9uIGdldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSkge1xuICBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwicHVibGljXCIpIHtcbiAgICByZXR1cm4gYXV0aFZhbHVlLnB1YmxpY0FwaUtleTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXV0aFZhbHVlLnRva2VuLnJhdztcbiAgfVxufVxuZnVuY3Rpb24gY3JlYXRlQ2xpZW50KG9wdGlvbnMpIHtcbiAgY29uc3QgY2xpZW50T3B0aW9ucyA9IG9wdGlvbnM7XG4gIGNvbnN0IHRocm90dGxlRGVsYXkgPSBnZXRUaHJvdHRsZShjbGllbnRPcHRpb25zLnRocm90dGxlID8/IERFRkFVTFRfVEhST1RUTEUpO1xuICBjb25zdCBsb3N0Q29ubmVjdGlvblRpbWVvdXQgPSBnZXRMb3N0Q29ubmVjdGlvblRpbWVvdXQoXG4gICAgY2xpZW50T3B0aW9ucy5sb3N0Q29ubmVjdGlvblRpbWVvdXQgPz8gREVGQVVMVF9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVFxuICApO1xuICBjb25zdCBiYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dCA9IGdldEJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0KFxuICAgIGNsaWVudE9wdGlvbnMuYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXRcbiAgKTtcbiAgY29uc3QgYmFzZVVybCA9IGdldEJhc2VVcmwoY2xpZW50T3B0aW9ucy5iYXNlVXJsKTtcbiAgY29uc3QgYXV0aE1hbmFnZXIgPSBjcmVhdGVBdXRoTWFuYWdlcihvcHRpb25zKTtcbiAgY29uc3Qgcm9vbXNCeUlkID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgZnVuY3Rpb24gdGVhcmRvd25Sb29tKHJvb20pIHtcbiAgICB1bmxpbmtEZXZUb29scyhyb29tLmlkKTtcbiAgICByb29tc0J5SWQuZGVsZXRlKHJvb20uaWQpO1xuICAgIHJvb20uZGVzdHJveSgpO1xuICB9XG4gIGZ1bmN0aW9uIGxlYXNlUm9vbShkZXRhaWxzKSB7XG4gICAgY29uc3QgbGVhdmUgPSAoKSA9PiB7XG4gICAgICBjb25zdCBzZWxmID0gbGVhdmU7XG4gICAgICBpZiAoIWRldGFpbHMudW5zdWJzLmRlbGV0ZShzZWxmKSkge1xuICAgICAgICB3YXJuKFxuICAgICAgICAgIFwiVGhpcyBsZWF2ZSBmdW5jdGlvbiB3YXMgYWxyZWFkeSBjYWxsZWQuIENhbGxpbmcgaXQgbW9yZSB0aGFuIG9uY2UgaGFzIG5vIGVmZmVjdC5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGRldGFpbHMudW5zdWJzLnNpemUgPT09IDApIHtcbiAgICAgICAgICB0ZWFyZG93blJvb20oZGV0YWlscy5yb29tKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgZGV0YWlscy51bnN1YnMuYWRkKGxlYXZlKTtcbiAgICByZXR1cm4ge1xuICAgICAgcm9vbTogZGV0YWlscy5yb29tLFxuICAgICAgbGVhdmVcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGVudGVyUm9vbShyb29tSWQsIC4uLmFyZ3MpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IHJvb21zQnlJZC5nZXQocm9vbUlkKTtcbiAgICBpZiAoZXhpc3RpbmcgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGxlYXNlUm9vbShleGlzdGluZyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdGlvbnMyID0gYXJnc1swXSA/PyB7fTtcbiAgICBjb25zdCBpbml0aWFsUHJlc2VuY2UgPSAodHlwZW9mIG9wdGlvbnMyLmluaXRpYWxQcmVzZW5jZSA9PT0gXCJmdW5jdGlvblwiID8gb3B0aW9uczIuaW5pdGlhbFByZXNlbmNlKHJvb21JZCkgOiBvcHRpb25zMi5pbml0aWFsUHJlc2VuY2UpID8/IHt9O1xuICAgIGNvbnN0IGluaXRpYWxTdG9yYWdlID0gKHR5cGVvZiBvcHRpb25zMi5pbml0aWFsU3RvcmFnZSA9PT0gXCJmdW5jdGlvblwiID8gb3B0aW9uczIuaW5pdGlhbFN0b3JhZ2Uocm9vbUlkKSA6IG9wdGlvbnMyLmluaXRpYWxTdG9yYWdlKSA/PyB7fTtcbiAgICBjb25zdCBuZXdSb29tID0gY3JlYXRlUm9vbShcbiAgICAgIHsgaW5pdGlhbFByZXNlbmNlLCBpbml0aWFsU3RvcmFnZSB9LFxuICAgICAge1xuICAgICAgICByb29tSWQsXG4gICAgICAgIHRocm90dGxlRGVsYXksXG4gICAgICAgIGxvc3RDb25uZWN0aW9uVGltZW91dCxcbiAgICAgICAgYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQsXG4gICAgICAgIHBvbHlmaWxsczogY2xpZW50T3B0aW9ucy5wb2x5ZmlsbHMsXG4gICAgICAgIGRlbGVnYXRlczogY2xpZW50T3B0aW9ucy5tb2NrZWREZWxlZ2F0ZXMgPz8ge1xuICAgICAgICAgIGNyZWF0ZVNvY2tldDogbWFrZUNyZWF0ZVNvY2tldERlbGVnYXRlRm9yUm9vbShcbiAgICAgICAgICAgIHJvb21JZCxcbiAgICAgICAgICAgIGJhc2VVcmwsXG4gICAgICAgICAgICBjbGllbnRPcHRpb25zLnBvbHlmaWxscz8uV2ViU29ja2V0XG4gICAgICAgICAgKSxcbiAgICAgICAgICBhdXRoZW50aWNhdGU6IG1ha2VBdXRoRGVsZWdhdGVGb3JSb29tKHJvb21JZCwgYXV0aE1hbmFnZXIpXG4gICAgICAgIH0sXG4gICAgICAgIGVuYWJsZURlYnVnTG9nZ2luZzogY2xpZW50T3B0aW9ucy5lbmFibGVEZWJ1Z0xvZ2dpbmcsXG4gICAgICAgIHVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzOiBvcHRpb25zMj8udW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMsXG4gICAgICAgIGJhc2VVcmwsXG4gICAgICAgIHVuc3RhYmxlX2ZhbGxiYWNrVG9IVFRQOiAhIWNsaWVudE9wdGlvbnMudW5zdGFibGVfZmFsbGJhY2tUb0hUVFAsXG4gICAgICAgIHVuc3RhYmxlX3N0cmVhbURhdGE6ICEhY2xpZW50T3B0aW9ucy51bnN0YWJsZV9zdHJlYW1EYXRhXG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCBuZXdSb29tRGV0YWlscyA9IHtcbiAgICAgIHJvb206IG5ld1Jvb20sXG4gICAgICB1bnN1YnM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KClcbiAgICB9O1xuICAgIHJvb21zQnlJZC5zZXQocm9vbUlkLCBuZXdSb29tRGV0YWlscyk7XG4gICAgc2V0dXBEZXZUb29scygoKSA9PiBBcnJheS5mcm9tKHJvb21zQnlJZC5rZXlzKCkpKTtcbiAgICBsaW5rRGV2VG9vbHMocm9vbUlkLCBuZXdSb29tKTtcbiAgICBjb25zdCBzaG91bGRDb25uZWN0ID0gb3B0aW9uczIuYXV0b0Nvbm5lY3QgPz8gdHJ1ZTtcbiAgICBpZiAoc2hvdWxkQ29ubmVjdCkge1xuICAgICAgaWYgKHR5cGVvZiBhdG9iID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGlmIChjbGllbnRPcHRpb25zLnBvbHlmaWxscz8uYXRvYiA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJZb3UgbmVlZCB0byBwb2x5ZmlsbCBhdG9iIHRvIHVzZSB0aGUgY2xpZW50IGluIHlvdXIgZW52aXJvbm1lbnQuIFBsZWFzZSBmb2xsb3cgdGhlIGluc3RydWN0aW9ucyBhdCBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvbGl2ZWJsb2Nrcy1jbGllbnQvYXRvYi1wb2x5ZmlsbFwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBnbG9iYWwuYXRvYiA9IGNsaWVudE9wdGlvbnMucG9seWZpbGxzLmF0b2I7XG4gICAgICB9XG4gICAgICBuZXdSb29tLmNvbm5lY3QoKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlYXNlUm9vbShuZXdSb29tRGV0YWlscyk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0Um9vbShyb29tSWQpIHtcbiAgICBjb25zdCByb29tID0gcm9vbXNCeUlkLmdldChyb29tSWQpPy5yb29tO1xuICAgIHJldHVybiByb29tID8gcm9vbSA6IG51bGw7XG4gIH1cbiAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgIGF1dGhNYW5hZ2VyLnJlc2V0KCk7XG4gICAgZm9yIChjb25zdCB7IHJvb20gfSBvZiByb29tc0J5SWQudmFsdWVzKCkpIHtcbiAgICAgIGlmICghaXNJZGxlKHJvb20uZ2V0U3RhdHVzKCkpKSB7XG4gICAgICAgIHJvb20ucmVjb25uZWN0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNvbnN0IGN1cnJlbnRVc2VySWRTdG9yZSA9IGNyZWF0ZVN0b3JlKG51bGwpO1xuICBjb25zdCB7XG4gICAgZ2V0SW5ib3hOb3RpZmljYXRpb25zLFxuICAgIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlLFxuICAgIGdldFVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50LFxuICAgIG1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQsXG4gICAgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkLFxuICAgIGRlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICBkZWxldGVJbmJveE5vdGlmaWNhdGlvblxuICB9ID0gY3JlYXRlTm90aWZpY2F0aW9uc0FwaSh7XG4gICAgYmFzZVVybCxcbiAgICBmZXRjaGVyOiBjbGllbnRPcHRpb25zLnBvbHlmaWxscz8uZmV0Y2ggfHwgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBmZXRjaCxcbiAgICBhdXRoTWFuYWdlcixcbiAgICBjdXJyZW50VXNlcklkU3RvcmVcbiAgfSk7XG4gIGNvbnN0IGNhY2hlU3RvcmUgPSBjcmVhdGVDbGllbnRTdG9yZSgpO1xuICBjb25zdCByZXNvbHZlVXNlcnMgPSBjbGllbnRPcHRpb25zLnJlc29sdmVVc2VycztcbiAgY29uc3Qgd2FybklmTm9SZXNvbHZlVXNlcnMgPSBjcmVhdGVEZXZlbG9wbWVudFdhcm5pbmcoXG4gICAgKCkgPT4gIXJlc29sdmVVc2VycyxcbiAgICBcIlNldCB0aGUgcmVzb2x2ZVVzZXJzIG9wdGlvbiBpbiBjcmVhdGVDbGllbnQgdG8gc3BlY2lmeSB1c2VyIGluZm8uXCJcbiAgKTtcbiAgY29uc3QgdXNlcnNTdG9yZSA9IGNyZWF0ZUJhdGNoU3RvcmUoXG4gICAgYXN5bmMgKGJhdGNoZWRVc2VySWRzKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWRzID0gYmF0Y2hlZFVzZXJJZHMuZmxhdCgpO1xuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCByZXNvbHZlVXNlcnM/Lih7IHVzZXJJZHMgfSk7XG4gICAgICB3YXJuSWZOb1Jlc29sdmVVc2VycygpO1xuICAgICAgcmV0dXJuIHVzZXJzID8/IHVzZXJJZHMubWFwKCgpID0+IHZvaWQgMCk7XG4gICAgfSxcbiAgICB7IGRlbGF5OiBSRVNPTFZFX1VTRVJTX0JBVENIX0RFTEFZIH1cbiAgKTtcbiAgY29uc3QgcmVzb2x2ZVJvb21zSW5mbyA9IGNsaWVudE9wdGlvbnMucmVzb2x2ZVJvb21zSW5mbztcbiAgY29uc3Qgd2FybklmTm9SZXNvbHZlUm9vbXNJbmZvID0gY3JlYXRlRGV2ZWxvcG1lbnRXYXJuaW5nKFxuICAgICgpID0+ICFyZXNvbHZlUm9vbXNJbmZvLFxuICAgIFwiU2V0IHRoZSByZXNvbHZlUm9vbXNJbmZvIG9wdGlvbiBpbiBjcmVhdGVDbGllbnQgdG8gc3BlY2lmeSByb29tIGluZm8uXCJcbiAgKTtcbiAgY29uc3Qgcm9vbXNJbmZvU3RvcmUgPSBjcmVhdGVCYXRjaFN0b3JlKFxuICAgIGFzeW5jIChiYXRjaGVkUm9vbUlkcykgPT4ge1xuICAgICAgY29uc3Qgcm9vbUlkcyA9IGJhdGNoZWRSb29tSWRzLmZsYXQoKTtcbiAgICAgIGNvbnN0IHJvb21zSW5mbyA9IGF3YWl0IHJlc29sdmVSb29tc0luZm8/Lih7IHJvb21JZHMgfSk7XG4gICAgICB3YXJuSWZOb1Jlc29sdmVSb29tc0luZm8oKTtcbiAgICAgIHJldHVybiByb29tc0luZm8gPz8gcm9vbUlkcy5tYXAoKCkgPT4gdm9pZCAwKTtcbiAgICB9LFxuICAgIHsgZGVsYXk6IFJFU09MVkVfUk9PTVNfSU5GT19CQVRDSF9ERUxBWSB9XG4gICk7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoXG4gICAge1xuICAgICAgZW50ZXJSb29tLFxuICAgICAgZ2V0Um9vbSxcbiAgICAgIGxvZ291dCxcbiAgICAgIGdldEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICAgIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlLFxuICAgICAgZ2V0VW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQsXG4gICAgICBtYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkLFxuICAgICAgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkLFxuICAgICAgZGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgZGVsZXRlSW5ib3hOb3RpZmljYXRpb24sXG4gICAgICAvLyBJbnRlcm5hbFxuICAgICAgW2tJbnRlcm5hbF06IHtcbiAgICAgICAgY3VycmVudFVzZXJJZFN0b3JlLFxuICAgICAgICByZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zOiBjbGllbnRPcHRpb25zLnJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMsXG4gICAgICAgIGNhY2hlU3RvcmUsXG4gICAgICAgIHVzZXJzU3RvcmUsXG4gICAgICAgIHJvb21zSW5mb1N0b3JlLFxuICAgICAgICBnZXRSb29tSWRzKCkge1xuICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHJvb21zQnlJZC5rZXlzKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBrSW50ZXJuYWwsXG4gICAge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICB9XG4gICk7XG59XG52YXIgTm90aWZpY2F0aW9uc0FwaUVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHN0YXR1cywgZGV0YWlscykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgdGhpcy5kZXRhaWxzID0gZGV0YWlscztcbiAgfVxufTtcbmZ1bmN0aW9uIGNoZWNrQm91bmRzKG9wdGlvbiwgdmFsdWUsIG1pbiwgbWF4LCByZWNvbW1lbmRlZE1pbikge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm51bWJlclwiIHx8IHZhbHVlIDwgbWluIHx8IG1heCAhPT0gdm9pZCAwICYmIHZhbHVlID4gbWF4KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgbWF4ICE9PSB2b2lkIDAgPyBgJHtvcHRpb259IHNob3VsZCBiZSBiZXR3ZWVuICR7cmVjb21tZW5kZWRNaW4gPz8gbWlufSBhbmQgJHttYXh9LmAgOiBgJHtvcHRpb259IHNob3VsZCBiZSBhdCBsZWFzdCAke3JlY29tbWVuZGVkTWluID8/IG1pbn0uYFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZ2V0QmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQodmFsdWUpIHtcbiAgaWYgKHZhbHVlID09PSB2b2lkIDApIHJldHVybiB2b2lkIDA7XG4gIHJldHVybiBjaGVja0JvdW5kcyhcbiAgICBcImJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0XCIsXG4gICAgdmFsdWUsXG4gICAgTUlOX0JBQ0tHUk9VTkRfS0VFUF9BTElWRV9USU1FT1VUXG4gICk7XG59XG5mdW5jdGlvbiBnZXRUaHJvdHRsZSh2YWx1ZSkge1xuICByZXR1cm4gY2hlY2tCb3VuZHMoXCJ0aHJvdHRsZVwiLCB2YWx1ZSwgTUlOX1RIUk9UVExFLCBNQVhfVEhST1RUTEUpO1xufVxuZnVuY3Rpb24gZ2V0TG9zdENvbm5lY3Rpb25UaW1lb3V0KHZhbHVlKSB7XG4gIHJldHVybiBjaGVja0JvdW5kcyhcbiAgICBcImxvc3RDb25uZWN0aW9uVGltZW91dFwiLFxuICAgIHZhbHVlLFxuICAgIE1JTl9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCxcbiAgICBNQVhfTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQsXG4gICAgUkVDT01NRU5ERURfTUlOX0xPU1RfQ09OTkVDVElPTl9USU1FT1VUXG4gICk7XG59XG5mdW5jdGlvbiBjcmVhdGVEZXZlbG9wbWVudFdhcm5pbmcoY29uZGl0aW9uLCAuLi5hcmdzKSB7XG4gIGxldCBoYXNXYXJuZWQgPSBmYWxzZTtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoIWhhc1dhcm5lZCAmJiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gXCJmdW5jdGlvblwiID8gY29uZGl0aW9uKCkgOiBjb25kaXRpb24pKSB7XG4gICAgICAgIHdhcm4oLi4uYXJncyk7XG4gICAgICAgIGhhc1dhcm5lZCA9IHRydWU7XG4gICAgICB9XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgIH07XG4gIH1cbn1cblxuLy8gc3JjL2NvbW1lbnRzL2NvbW1lbnQtYm9keS50c1xuZnVuY3Rpb24gaXNDb21tZW50Qm9keVBhcmFncmFwaChlbGVtZW50KSB7XG4gIHJldHVybiBcInR5cGVcIiBpbiBlbGVtZW50ICYmIGVsZW1lbnQudHlwZSA9PT0gXCJtZW50aW9uXCI7XG59XG5mdW5jdGlvbiBpc0NvbW1lbnRCb2R5VGV4dChlbGVtZW50KSB7XG4gIHJldHVybiAhKFwidHlwZVwiIGluIGVsZW1lbnQpICYmIFwidGV4dFwiIGluIGVsZW1lbnQgJiYgdHlwZW9mIGVsZW1lbnQudGV4dCA9PT0gXCJzdHJpbmdcIjtcbn1cbmZ1bmN0aW9uIGlzQ29tbWVudEJvZHlNZW50aW9uKGVsZW1lbnQpIHtcbiAgcmV0dXJuIFwidHlwZVwiIGluIGVsZW1lbnQgJiYgZWxlbWVudC50eXBlID09PSBcIm1lbnRpb25cIjtcbn1cbmZ1bmN0aW9uIGlzQ29tbWVudEJvZHlMaW5rKGVsZW1lbnQpIHtcbiAgcmV0dXJuIFwidHlwZVwiIGluIGVsZW1lbnQgJiYgZWxlbWVudC50eXBlID09PSBcImxpbmtcIjtcbn1cbnZhciBjb21tZW50Qm9keUVsZW1lbnRzR3VhcmRzID0ge1xuICBwYXJhZ3JhcGg6IGlzQ29tbWVudEJvZHlQYXJhZ3JhcGgsXG4gIHRleHQ6IGlzQ29tbWVudEJvZHlUZXh0LFxuICBsaW5rOiBpc0NvbW1lbnRCb2R5TGluayxcbiAgbWVudGlvbjogaXNDb21tZW50Qm9keU1lbnRpb25cbn07XG52YXIgY29tbWVudEJvZHlFbGVtZW50c1R5cGVzID0ge1xuICBwYXJhZ3JhcGg6IFwiYmxvY2tcIixcbiAgdGV4dDogXCJpbmxpbmVcIixcbiAgbGluazogXCJpbmxpbmVcIixcbiAgbWVudGlvbjogXCJpbmxpbmVcIlxufTtcbmZ1bmN0aW9uIHRyYXZlcnNlQ29tbWVudEJvZHkoYm9keSwgZWxlbWVudE9yVmlzaXRvciwgcG9zc2libHlWaXNpdG9yKSB7XG4gIGlmICghYm9keSB8fCAhYm9keT8uY29udGVudCkge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBlbGVtZW50ID0gdHlwZW9mIGVsZW1lbnRPclZpc2l0b3IgPT09IFwic3RyaW5nXCIgPyBlbGVtZW50T3JWaXNpdG9yIDogdm9pZCAwO1xuICBjb25zdCB0eXBlID0gZWxlbWVudCA/IGNvbW1lbnRCb2R5RWxlbWVudHNUeXBlc1tlbGVtZW50XSA6IFwiYWxsXCI7XG4gIGNvbnN0IGd1YXJkID0gZWxlbWVudCA/IGNvbW1lbnRCb2R5RWxlbWVudHNHdWFyZHNbZWxlbWVudF0gOiAoKSA9PiB0cnVlO1xuICBjb25zdCB2aXNpdG9yID0gdHlwZW9mIGVsZW1lbnRPclZpc2l0b3IgPT09IFwiZnVuY3Rpb25cIiA/IGVsZW1lbnRPclZpc2l0b3IgOiBwb3NzaWJseVZpc2l0b3I7XG4gIGZvciAoY29uc3QgYmxvY2sgb2YgYm9keS5jb250ZW50KSB7XG4gICAgaWYgKHR5cGUgPT09IFwiYWxsXCIgfHwgdHlwZSA9PT0gXCJibG9ja1wiKSB7XG4gICAgICBpZiAoZ3VhcmQoYmxvY2spKSB7XG4gICAgICAgIHZpc2l0b3I/LihibG9jayk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlID09PSBcImFsbFwiIHx8IHR5cGUgPT09IFwiaW5saW5lXCIpIHtcbiAgICAgIGZvciAoY29uc3QgaW5saW5lIG9mIGJsb2NrLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmIChndWFyZChpbmxpbmUpKSB7XG4gICAgICAgICAgdmlzaXRvcj8uKGlubGluZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldE1lbnRpb25lZElkc0Zyb21Db21tZW50Qm9keShib2R5KSB7XG4gIGNvbnN0IG1lbnRpb25lZElkcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gIHRyYXZlcnNlQ29tbWVudEJvZHkoXG4gICAgYm9keSxcbiAgICBcIm1lbnRpb25cIixcbiAgICAobWVudGlvbikgPT4gbWVudGlvbmVkSWRzLmFkZChtZW50aW9uLmlkKVxuICApO1xuICByZXR1cm4gQXJyYXkuZnJvbShtZW50aW9uZWRJZHMpO1xufVxuYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZVVzZXJzSW5Db21tZW50Qm9keShib2R5LCByZXNvbHZlVXNlcnMpIHtcbiAgY29uc3QgcmVzb2x2ZWRVc2VycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGlmICghcmVzb2x2ZVVzZXJzKSB7XG4gICAgcmV0dXJuIHJlc29sdmVkVXNlcnM7XG4gIH1cbiAgY29uc3QgdXNlcklkcyA9IGdldE1lbnRpb25lZElkc0Zyb21Db21tZW50Qm9keShib2R5KTtcbiAgY29uc3QgdXNlcnMgPSBhd2FpdCByZXNvbHZlVXNlcnMoe1xuICAgIHVzZXJJZHNcbiAgfSk7XG4gIGZvciAoY29uc3QgW2luZGV4LCB1c2VySWRdIG9mIHVzZXJJZHMuZW50cmllcygpKSB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJzPy5baW5kZXhdO1xuICAgIGlmICh1c2VyKSB7XG4gICAgICByZXNvbHZlZFVzZXJzLnNldCh1c2VySWQsIHVzZXIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzb2x2ZWRVc2Vycztcbn1cbnZhciBodG1sRXNjYXBhYmxlcyA9IHtcbiAgXCImXCI6IFwiJmFtcDtcIixcbiAgXCI8XCI6IFwiJmx0O1wiLFxuICBcIj5cIjogXCImZ3Q7XCIsXG4gICdcIic6IFwiJnF1b3Q7XCIsXG4gIFwiJ1wiOiBcIiYjMzk7XCJcbn07XG52YXIgaHRtbEVzY2FwYWJsZXNSZWdleCA9IG5ldyBSZWdFeHAoXG4gIE9iamVjdC5rZXlzKGh0bWxFc2NhcGFibGVzKS5tYXAoKGVudGl0eSkgPT4gYFxcXFwke2VudGl0eX1gKS5qb2luKFwifFwiKSxcbiAgXCJnXCJcbik7XG5mdW5jdGlvbiBodG1sU2FmZSh2YWx1ZSkge1xuICByZXR1cm4gbmV3IEh0bWxTYWZlU3RyaW5nKFtTdHJpbmcodmFsdWUpXSwgW10pO1xufVxuZnVuY3Rpb24gam9pbkh0bWwoc3RyaW5ncykge1xuICBpZiAoc3RyaW5ncy5sZW5ndGggPD0gMCkge1xuICAgIHJldHVybiBuZXcgSHRtbFNhZmVTdHJpbmcoW1wiXCJdLCBbXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBIdG1sU2FmZVN0cmluZyhcbiAgICBbXCJcIiwgLi4uQXJyYXkoc3RyaW5ncy5sZW5ndGggLSAxKS5maWxsKFwiXCIpLCBcIlwiXSxcbiAgICBzdHJpbmdzXG4gICk7XG59XG5mdW5jdGlvbiBlc2NhcGVIdG1sKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEh0bWxTYWZlU3RyaW5nKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIGpvaW5IdG1sKHZhbHVlKS50b1N0cmluZygpO1xuICB9XG4gIHJldHVybiBTdHJpbmcodmFsdWUpLnJlcGxhY2UoXG4gICAgaHRtbEVzY2FwYWJsZXNSZWdleCxcbiAgICAoY2hhcmFjdGVyKSA9PiBodG1sRXNjYXBhYmxlc1tjaGFyYWN0ZXJdXG4gICk7XG59XG52YXIgSHRtbFNhZmVTdHJpbmcgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKHN0cmluZ3MsIHZhbHVlcykge1xuICAgIHRoaXMuX3N0cmluZ3MgPSBzdHJpbmdzO1xuICAgIHRoaXMuX3ZhbHVlcyA9IHZhbHVlcztcbiAgfVxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5fc3RyaW5ncy5yZWR1Y2UoKHJlc3VsdCwgc3RyLCBpKSA9PiB7XG4gICAgICByZXR1cm4gcmVzdWx0ICsgZXNjYXBlSHRtbChubih0aGlzLl92YWx1ZXNbaSAtIDFdKSkgKyBzdHI7XG4gICAgfSk7XG4gIH1cbn07XG5mdW5jdGlvbiBodG1sKHN0cmluZ3MsIC4uLnZhbHVlcykge1xuICByZXR1cm4gbmV3IEh0bWxTYWZlU3RyaW5nKHN0cmluZ3MsIHZhbHVlcyk7XG59XG52YXIgbWFya2Rvd25Fc2NhcGFibGVzID0ge1xuICBfOiBcIlxcXFxfXCIsXG4gIFwiKlwiOiBcIlxcXFwqXCIsXG4gIFwiI1wiOiBcIlxcXFwjXCIsXG4gIFwiYFwiOiBcIlxcXFxgXCIsXG4gIFwiflwiOiBcIlxcXFx+XCIsXG4gIFwiIVwiOiBcIlxcXFwhXCIsXG4gIFwifFwiOiBcIlxcXFx8XCIsXG4gIFwiKFwiOiBcIlxcXFwoXCIsXG4gIFwiKVwiOiBcIlxcXFwpXCIsXG4gIFwie1wiOiBcIlxcXFx7XCIsXG4gIFwifVwiOiBcIlxcXFx9XCIsXG4gIFwiW1wiOiBcIlxcXFxbXCIsXG4gIFwiXVwiOiBcIlxcXFxdXCJcbn07XG52YXIgbWFya2Rvd25Fc2NhcGFibGVzUmVnZXggPSBuZXcgUmVnRXhwKFxuICBPYmplY3Qua2V5cyhtYXJrZG93bkVzY2FwYWJsZXMpLm1hcCgoZW50aXR5KSA9PiBgXFxcXCR7ZW50aXR5fWApLmpvaW4oXCJ8XCIpLFxuICBcImdcIlxuKTtcbmZ1bmN0aW9uIGpvaW5NYXJrZG93bihzdHJpbmdzKSB7XG4gIGlmIChzdHJpbmdzLmxlbmd0aCA8PSAwKSB7XG4gICAgcmV0dXJuIG5ldyBNYXJrZG93blNhZmVTdHJpbmcoW1wiXCJdLCBbXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBNYXJrZG93blNhZmVTdHJpbmcoXG4gICAgW1wiXCIsIC4uLkFycmF5KHN0cmluZ3MubGVuZ3RoIC0gMSkuZmlsbChcIlwiKSwgXCJcIl0sXG4gICAgc3RyaW5nc1xuICApO1xufVxuZnVuY3Rpb24gZXNjYXBlTWFya2Rvd24odmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTWFya2Rvd25TYWZlU3RyaW5nKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIGpvaW5NYXJrZG93bih2YWx1ZSkudG9TdHJpbmcoKTtcbiAgfVxuICByZXR1cm4gU3RyaW5nKHZhbHVlKS5yZXBsYWNlKFxuICAgIG1hcmtkb3duRXNjYXBhYmxlc1JlZ2V4LFxuICAgIChjaGFyYWN0ZXIpID0+IG1hcmtkb3duRXNjYXBhYmxlc1tjaGFyYWN0ZXJdXG4gICk7XG59XG52YXIgTWFya2Rvd25TYWZlU3RyaW5nID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcihzdHJpbmdzLCB2YWx1ZXMpIHtcbiAgICB0aGlzLl9zdHJpbmdzID0gc3RyaW5ncztcbiAgICB0aGlzLl92YWx1ZXMgPSB2YWx1ZXM7XG4gIH1cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3N0cmluZ3MucmVkdWNlKChyZXN1bHQsIHN0ciwgaSkgPT4ge1xuICAgICAgcmV0dXJuIHJlc3VsdCArIGVzY2FwZU1hcmtkb3duKG5uKHRoaXMuX3ZhbHVlc1tpIC0gMV0pKSArIHN0cjtcbiAgICB9KTtcbiAgfVxufTtcbmZ1bmN0aW9uIG1hcmtkb3duKHN0cmluZ3MsIC4uLnZhbHVlcykge1xuICByZXR1cm4gbmV3IE1hcmtkb3duU2FmZVN0cmluZyhzdHJpbmdzLCB2YWx1ZXMpO1xufVxuZnVuY3Rpb24gdG9BYnNvbHV0ZVVybCh1cmwpIHtcbiAgaWYgKHVybC5zdGFydHNXaXRoKFwiaHR0cDovL1wiKSB8fCB1cmwuc3RhcnRzV2l0aChcImh0dHBzOi8vXCIpKSB7XG4gICAgcmV0dXJuIHVybDtcbiAgfSBlbHNlIGlmICh1cmwuc3RhcnRzV2l0aChcInd3dy5cIikpIHtcbiAgICByZXR1cm4gXCJodHRwczovL1wiICsgdXJsO1xuICB9XG4gIHJldHVybjtcbn1cbnZhciBzdHJpbmdpZnlDb21tZW50Qm9keVBsYWluRWxlbWVudHMgPSB7XG4gIHBhcmFncmFwaDogKHsgY2hpbGRyZW4gfSkgPT4gY2hpbGRyZW4sXG4gIHRleHQ6ICh7IGVsZW1lbnQgfSkgPT4gZWxlbWVudC50ZXh0LFxuICBsaW5rOiAoeyBlbGVtZW50IH0pID0+IGVsZW1lbnQudGV4dCA/PyBlbGVtZW50LnVybCxcbiAgbWVudGlvbjogKHsgZWxlbWVudCwgdXNlciB9KSA9PiB7XG4gICAgcmV0dXJuIGBAJHt1c2VyPy5uYW1lID8/IGVsZW1lbnQuaWR9YDtcbiAgfVxufTtcbnZhciBzdHJpbmdpZnlDb21tZW50Qm9keUh0bWxFbGVtZW50cyA9IHtcbiAgcGFyYWdyYXBoOiAoeyBjaGlsZHJlbiB9KSA9PiB7XG4gICAgcmV0dXJuIGNoaWxkcmVuID8gaHRtbGA8cD4ke2h0bWxTYWZlKGNoaWxkcmVuKX08L3A+YCA6IGNoaWxkcmVuO1xuICB9LFxuICB0ZXh0OiAoeyBlbGVtZW50IH0pID0+IHtcbiAgICBsZXQgY2hpbGRyZW4gPSBlbGVtZW50LnRleHQ7XG4gICAgaWYgKCFjaGlsZHJlbikge1xuICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5ib2xkKSB7XG4gICAgICBjaGlsZHJlbiA9IGh0bWxgPHN0cm9uZz4ke2NoaWxkcmVufTwvc3Ryb25nPmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50Lml0YWxpYykge1xuICAgICAgY2hpbGRyZW4gPSBodG1sYDxlbT4ke2NoaWxkcmVufTwvZW0+YDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuc3RyaWtldGhyb3VnaCkge1xuICAgICAgY2hpbGRyZW4gPSBodG1sYDxzPiR7Y2hpbGRyZW59PC9zPmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50LmNvZGUpIHtcbiAgICAgIGNoaWxkcmVuID0gaHRtbGA8Y29kZT4ke2NoaWxkcmVufTwvY29kZT5gO1xuICAgIH1cbiAgICByZXR1cm4gY2hpbGRyZW47XG4gIH0sXG4gIGxpbms6ICh7IGVsZW1lbnQsIGhyZWYgfSkgPT4ge1xuICAgIHJldHVybiBodG1sYDxhIGhyZWY9XCIke2hyZWZ9XCIgdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9vcGVuZXIgbm9yZWZlcnJlclwiPiR7ZWxlbWVudC50ZXh0ID8/IGVsZW1lbnQudXJsfTwvYT5gO1xuICB9LFxuICBtZW50aW9uOiAoeyBlbGVtZW50LCB1c2VyIH0pID0+IHtcbiAgICByZXR1cm4gaHRtbGA8c3BhbiBkYXRhLW1lbnRpb24+QCR7dXNlcj8ubmFtZSA/PyBlbGVtZW50LmlkfTwvc3Bhbj5gO1xuICB9XG59O1xudmFyIHN0cmluZ2lmeUNvbW1lbnRCb2R5TWFya2Rvd25FbGVtZW50cyA9IHtcbiAgcGFyYWdyYXBoOiAoeyBjaGlsZHJlbiB9KSA9PiB7XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xuICB9LFxuICB0ZXh0OiAoeyBlbGVtZW50IH0pID0+IHtcbiAgICBsZXQgY2hpbGRyZW4gPSBlbGVtZW50LnRleHQ7XG4gICAgaWYgKCFjaGlsZHJlbikge1xuICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5ib2xkKSB7XG4gICAgICBjaGlsZHJlbiA9IG1hcmtkb3duYCoqJHtjaGlsZHJlbn0qKmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50Lml0YWxpYykge1xuICAgICAgY2hpbGRyZW4gPSBtYXJrZG93bmBfJHtjaGlsZHJlbn1fYDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuc3RyaWtldGhyb3VnaCkge1xuICAgICAgY2hpbGRyZW4gPSBtYXJrZG93bmB+fiR7Y2hpbGRyZW59fn5gO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5jb2RlKSB7XG4gICAgICBjaGlsZHJlbiA9IG1hcmtkb3duYFxcYCR7Y2hpbGRyZW59XFxgYDtcbiAgICB9XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xuICB9LFxuICBsaW5rOiAoeyBlbGVtZW50LCBocmVmIH0pID0+IHtcbiAgICByZXR1cm4gbWFya2Rvd25gWyR7ZWxlbWVudC50ZXh0ID8/IGVsZW1lbnQudXJsfV0oJHtocmVmfSlgO1xuICB9LFxuICBtZW50aW9uOiAoeyBlbGVtZW50LCB1c2VyIH0pID0+IHtcbiAgICByZXR1cm4gbWFya2Rvd25gQCR7dXNlcj8ubmFtZSA/PyBlbGVtZW50LmlkfWA7XG4gIH1cbn07XG5hc3luYyBmdW5jdGlvbiBzdHJpbmdpZnlDb21tZW50Qm9keShib2R5LCBvcHRpb25zKSB7XG4gIGNvbnN0IGZvcm1hdCA9IG9wdGlvbnM/LmZvcm1hdCA/PyBcInBsYWluXCI7XG4gIGNvbnN0IHNlcGFyYXRvciA9IG9wdGlvbnM/LnNlcGFyYXRvciA/PyAoZm9ybWF0ID09PSBcIm1hcmtkb3duXCIgPyBcIlxcblxcblwiIDogXCJcXG5cIik7XG4gIGNvbnN0IGVsZW1lbnRzID0ge1xuICAgIC4uLmZvcm1hdCA9PT0gXCJodG1sXCIgPyBzdHJpbmdpZnlDb21tZW50Qm9keUh0bWxFbGVtZW50cyA6IGZvcm1hdCA9PT0gXCJtYXJrZG93blwiID8gc3RyaW5naWZ5Q29tbWVudEJvZHlNYXJrZG93bkVsZW1lbnRzIDogc3RyaW5naWZ5Q29tbWVudEJvZHlQbGFpbkVsZW1lbnRzLFxuICAgIC4uLm9wdGlvbnM/LmVsZW1lbnRzXG4gIH07XG4gIGNvbnN0IHJlc29sdmVkVXNlcnMgPSBhd2FpdCByZXNvbHZlVXNlcnNJbkNvbW1lbnRCb2R5KFxuICAgIGJvZHksXG4gICAgb3B0aW9ucz8ucmVzb2x2ZVVzZXJzXG4gICk7XG4gIGNvbnN0IGJsb2NrcyA9IGJvZHkuY29udGVudC5mbGF0TWFwKChibG9jaywgYmxvY2tJbmRleCkgPT4ge1xuICAgIHN3aXRjaCAoYmxvY2sudHlwZSkge1xuICAgICAgY2FzZSBcInBhcmFncmFwaFwiOiB7XG4gICAgICAgIGNvbnN0IGlubGluZXMgPSBibG9jay5jaGlsZHJlbi5mbGF0TWFwKChpbmxpbmUsIGlubGluZUluZGV4KSA9PiB7XG4gICAgICAgICAgaWYgKGlzQ29tbWVudEJvZHlNZW50aW9uKGlubGluZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBpbmxpbmUuaWQgPyBbXG4gICAgICAgICAgICAgIGVsZW1lbnRzLm1lbnRpb24oXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgZWxlbWVudDogaW5saW5lLFxuICAgICAgICAgICAgICAgICAgdXNlcjogcmVzb2x2ZWRVc2Vycy5nZXQoaW5saW5lLmlkKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5saW5lSW5kZXhcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSA6IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNDb21tZW50Qm9keUxpbmsoaW5saW5lKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgZWxlbWVudHMubGluayhcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBlbGVtZW50OiBpbmxpbmUsXG4gICAgICAgICAgICAgICAgICBocmVmOiB0b0Fic29sdXRlVXJsKGlubGluZS51cmwpID8/IGlubGluZS51cmxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlubGluZUluZGV4XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc0NvbW1lbnRCb2R5VGV4dChpbmxpbmUpKSB7XG4gICAgICAgICAgICByZXR1cm4gW2VsZW1lbnRzLnRleHQoeyBlbGVtZW50OiBpbmxpbmUgfSwgaW5saW5lSW5kZXgpXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBlbGVtZW50cy5wYXJhZ3JhcGgoXG4gICAgICAgICAgICB7IGVsZW1lbnQ6IGJsb2NrLCBjaGlsZHJlbjogaW5saW5lcy5qb2luKFwiXCIpIH0sXG4gICAgICAgICAgICBibG9ja0luZGV4XG4gICAgICAgICAgKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBibG9ja3Muam9pbihzZXBhcmF0b3IpO1xufVxuXG4vLyBzcmMvY3JkdHMvdXRpbHMudHNcbmZ1bmN0aW9uIHRvUGxhaW5Mc29uKGxzb24pIHtcbiAgaWYgKGxzb24gaW5zdGFuY2VvZiBMaXZlT2JqZWN0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpdmVibG9ja3NUeXBlOiBcIkxpdmVPYmplY3RcIixcbiAgICAgIGRhdGE6IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgT2JqZWN0LmVudHJpZXMobHNvbi50b09iamVjdCgpKS5mbGF0TWFwKFxuICAgICAgICAgIChba2V5LCB2YWx1ZV0pID0+IHZhbHVlICE9PSB2b2lkIDAgPyBbW2tleSwgdG9QbGFpbkxzb24odmFsdWUpXV0gOiBbXVxuICAgICAgICApXG4gICAgICApXG4gICAgfTtcbiAgfSBlbHNlIGlmIChsc29uIGluc3RhbmNlb2YgTGl2ZU1hcCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaXZlYmxvY2tzVHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICBkYXRhOiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIFsuLi5sc29uXS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgdG9QbGFpbkxzb24odmFsdWUpXSlcbiAgICAgIClcbiAgICB9O1xuICB9IGVsc2UgaWYgKGxzb24gaW5zdGFuY2VvZiBMaXZlTGlzdCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaXZlYmxvY2tzVHlwZTogXCJMaXZlTGlzdFwiLFxuICAgICAgZGF0YTogWy4uLmxzb25dLm1hcCgoaXRlbSkgPT4gdG9QbGFpbkxzb24oaXRlbSkpXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbHNvbjtcbiAgfVxufVxuXG4vLyBzcmMvaW1tdXRhYmxlLnRzXG5mdW5jdGlvbiBsc29uT2JqZWN0VG9Kc29uKG9iaikge1xuICBjb25zdCByZXN1bHQgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgY29uc3QgdmFsID0gb2JqW2tleV07XG4gICAgaWYgKHZhbCAhPT0gdm9pZCAwKSB7XG4gICAgICByZXN1bHRba2V5XSA9IGxzb25Ub0pzb24odmFsKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGxpdmVPYmplY3RUb0pzb24obGl2ZU9iamVjdCkge1xuICByZXR1cm4gbHNvbk9iamVjdFRvSnNvbihsaXZlT2JqZWN0LnRvT2JqZWN0KCkpO1xufVxuZnVuY3Rpb24gbGl2ZU1hcFRvSnNvbihtYXApIHtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG1hcC5lbnRyaWVzKCkpIHtcbiAgICByZXN1bHRba2V5XSA9IGxzb25Ub0pzb24odmFsdWUpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBsc29uTGlzdFRvSnNvbih2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUubWFwKGxzb25Ub0pzb24pO1xufVxuZnVuY3Rpb24gbGl2ZUxpc3RUb0pzb24odmFsdWUpIHtcbiAgcmV0dXJuIGxzb25MaXN0VG9Kc29uKHZhbHVlLnRvQXJyYXkoKSk7XG59XG5mdW5jdGlvbiBsc29uVG9Kc29uKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdmVPYmplY3QpIHtcbiAgICByZXR1cm4gbGl2ZU9iamVjdFRvSnNvbih2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlTGlzdCkge1xuICAgIHJldHVybiBsaXZlTGlzdFRvSnNvbih2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlTWFwKSB7XG4gICAgcmV0dXJuIGxpdmVNYXBUb0pzb24odmFsdWUpO1xuICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgTGl2ZVJlZ2lzdGVyKSB7XG4gICAgcmV0dXJuIHZhbHVlLmRhdGE7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIGxzb25MaXN0VG9Kc29uKHZhbHVlKTtcbiAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KHZhbHVlKSkge1xuICAgIHJldHVybiBsc29uT2JqZWN0VG9Kc29uKHZhbHVlKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBkZWVwTGl2ZWlmeSh2YWx1ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gbmV3IExpdmVMaXN0KHZhbHVlLm1hcChkZWVwTGl2ZWlmeSkpO1xuICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgY29uc3QgaW5pdCA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIHZhbHVlKSB7XG4gICAgICBjb25zdCB2YWwgPSB2YWx1ZVtrZXldO1xuICAgICAgaWYgKHZhbCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaW5pdFtrZXldID0gZGVlcExpdmVpZnkodmFsKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBMaXZlT2JqZWN0KGluaXQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxufVxuZnVuY3Rpb24gcGF0Y2hMaXZlTGlzdChsaXZlTGlzdCwgcHJldiwgbmV4dCkge1xuICBsZXQgaSA9IDA7XG4gIGxldCBwcmV2RW5kID0gcHJldi5sZW5ndGggLSAxO1xuICBsZXQgbmV4dEVuZCA9IG5leHQubGVuZ3RoIC0gMTtcbiAgbGV0IHByZXZOb2RlID0gcHJldlswXTtcbiAgbGV0IG5leHROb2RlID0gbmV4dFswXTtcbiAgb3V0ZXI6IHtcbiAgICB3aGlsZSAocHJldk5vZGUgPT09IG5leHROb2RlKSB7XG4gICAgICArK2k7XG4gICAgICBpZiAoaSA+IHByZXZFbmQgfHwgaSA+IG5leHRFbmQpIHtcbiAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICB9XG4gICAgICBwcmV2Tm9kZSA9IHByZXZbaV07XG4gICAgICBuZXh0Tm9kZSA9IG5leHRbaV07XG4gICAgfVxuICAgIHByZXZOb2RlID0gcHJldltwcmV2RW5kXTtcbiAgICBuZXh0Tm9kZSA9IG5leHRbbmV4dEVuZF07XG4gICAgd2hpbGUgKHByZXZOb2RlID09PSBuZXh0Tm9kZSkge1xuICAgICAgcHJldkVuZC0tO1xuICAgICAgbmV4dEVuZC0tO1xuICAgICAgaWYgKGkgPiBwcmV2RW5kIHx8IGkgPiBuZXh0RW5kKSB7XG4gICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgfVxuICAgICAgcHJldk5vZGUgPSBwcmV2W3ByZXZFbmRdO1xuICAgICAgbmV4dE5vZGUgPSBuZXh0W25leHRFbmRdO1xuICAgIH1cbiAgfVxuICBpZiAoaSA+IHByZXZFbmQpIHtcbiAgICBpZiAoaSA8PSBuZXh0RW5kKSB7XG4gICAgICB3aGlsZSAoaSA8PSBuZXh0RW5kKSB7XG4gICAgICAgIGxpdmVMaXN0Lmluc2VydChkZWVwTGl2ZWlmeShuZXh0W2ldKSwgaSk7XG4gICAgICAgIGkrKztcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAoaSA+IG5leHRFbmQpIHtcbiAgICBsZXQgbG9jYWxJID0gaTtcbiAgICB3aGlsZSAobG9jYWxJIDw9IHByZXZFbmQpIHtcbiAgICAgIGxpdmVMaXN0LmRlbGV0ZShpKTtcbiAgICAgIGxvY2FsSSsrO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB3aGlsZSAoaSA8PSBwcmV2RW5kICYmIGkgPD0gbmV4dEVuZCkge1xuICAgICAgcHJldk5vZGUgPSBwcmV2W2ldO1xuICAgICAgbmV4dE5vZGUgPSBuZXh0W2ldO1xuICAgICAgY29uc3QgbGl2ZUxpc3ROb2RlID0gbGl2ZUxpc3QuZ2V0KGkpO1xuICAgICAgaWYgKGlzTGl2ZU9iamVjdChsaXZlTGlzdE5vZGUpICYmIGlzUGxhaW5PYmplY3QocHJldk5vZGUpICYmIGlzUGxhaW5PYmplY3QobmV4dE5vZGUpKSB7XG4gICAgICAgIHBhdGNoTGl2ZU9iamVjdChsaXZlTGlzdE5vZGUsIHByZXZOb2RlLCBuZXh0Tm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaXZlTGlzdC5zZXQoaSwgZGVlcExpdmVpZnkobmV4dE5vZGUpKTtcbiAgICAgIH1cbiAgICAgIGkrKztcbiAgICB9XG4gICAgd2hpbGUgKGkgPD0gbmV4dEVuZCkge1xuICAgICAgbGl2ZUxpc3QuaW5zZXJ0KGRlZXBMaXZlaWZ5KG5leHRbaV0pLCBpKTtcbiAgICAgIGkrKztcbiAgICB9XG4gICAgbGV0IGxvY2FsSSA9IGk7XG4gICAgd2hpbGUgKGxvY2FsSSA8PSBwcmV2RW5kKSB7XG4gICAgICBsaXZlTGlzdC5kZWxldGUoaSk7XG4gICAgICBsb2NhbEkrKztcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHBhdGNoTGl2ZU9iamVjdEtleShsaXZlT2JqZWN0LCBrZXksIHByZXYsIG5leHQpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgIGNvbnN0IG5vblNlcmlhbGl6YWJsZVZhbHVlID0gZmluZE5vblNlcmlhbGl6YWJsZVZhbHVlKG5leHQpO1xuICAgIGlmIChub25TZXJpYWxpemFibGVWYWx1ZSkge1xuICAgICAgZXJyb3IyKFxuICAgICAgICBgTmV3IHN0YXRlIHBhdGg6ICcke25vblNlcmlhbGl6YWJsZVZhbHVlLnBhdGh9JyB2YWx1ZTogJyR7U3RyaW5nKFxuICAgICAgICAgIG5vblNlcmlhbGl6YWJsZVZhbHVlLnZhbHVlXG4gICAgICAgICl9JyBpcyBub3Qgc2VyaWFsaXphYmxlLlxuT25seSBzZXJpYWxpemFibGUgdmFsdWUgY2FuIGJlIHN5bmNlZCB3aXRoIExpdmVibG9ja3MuYFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgY29uc3QgdmFsdWUgPSBsaXZlT2JqZWN0LmdldChrZXkpO1xuICBpZiAobmV4dCA9PT0gdm9pZCAwKSB7XG4gICAgbGl2ZU9iamVjdC5kZWxldGUoa2V5KTtcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgbGl2ZU9iamVjdC5zZXQoa2V5LCBkZWVwTGl2ZWlmeShuZXh0KSk7XG4gIH0gZWxzZSBpZiAocHJldiA9PT0gbmV4dCkge1xuICAgIHJldHVybjtcbiAgfSBlbHNlIGlmIChpc0xpdmVMaXN0KHZhbHVlKSAmJiBBcnJheS5pc0FycmF5KHByZXYpICYmIEFycmF5LmlzQXJyYXkobmV4dCkpIHtcbiAgICBwYXRjaExpdmVMaXN0KHZhbHVlLCBwcmV2LCBuZXh0KTtcbiAgfSBlbHNlIGlmIChpc0xpdmVPYmplY3QodmFsdWUpICYmIGlzUGxhaW5PYmplY3QocHJldikgJiYgaXNQbGFpbk9iamVjdChuZXh0KSkge1xuICAgIHBhdGNoTGl2ZU9iamVjdCh2YWx1ZSwgcHJldiwgbmV4dCk7XG4gIH0gZWxzZSB7XG4gICAgbGl2ZU9iamVjdC5zZXQoa2V5LCBkZWVwTGl2ZWlmeShuZXh0KSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHBhdGNoTGl2ZU9iamVjdChyb290LCBwcmV2LCBuZXh0KSB7XG4gIGNvbnN0IHVwZGF0ZXMgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gbmV4dCkge1xuICAgIHBhdGNoTGl2ZU9iamVjdEtleShyb290LCBrZXksIHByZXZba2V5XSwgbmV4dFtrZXldKTtcbiAgfVxuICBmb3IgKGNvbnN0IGtleSBpbiBwcmV2KSB7XG4gICAgaWYgKG5leHRba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICByb290LmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgfVxuICBpZiAoT2JqZWN0LmtleXModXBkYXRlcykubGVuZ3RoID4gMCkge1xuICAgIHJvb3QudXBkYXRlKHVwZGF0ZXMpO1xuICB9XG59XG5mdW5jdGlvbiBnZXRQYXJlbnRzUGF0aChub2RlKSB7XG4gIGNvbnN0IHBhdGggPSBbXTtcbiAgd2hpbGUgKG5vZGUucGFyZW50LnR5cGUgPT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICBpZiAoaXNMaXZlTGlzdChub2RlLnBhcmVudC5ub2RlKSkge1xuICAgICAgcGF0aC5wdXNoKG5vZGUucGFyZW50Lm5vZGUuX2luZGV4T2ZQb3NpdGlvbihub2RlLnBhcmVudC5rZXkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGF0aC5wdXNoKG5vZGUucGFyZW50LmtleSk7XG4gICAgfVxuICAgIG5vZGUgPSBub2RlLnBhcmVudC5ub2RlO1xuICB9XG4gIHJldHVybiBwYXRoO1xufVxuZnVuY3Rpb24gbGVnYWN5X3BhdGNoSW1tdXRhYmxlT2JqZWN0KHN0YXRlLCB1cGRhdGVzKSB7XG4gIHJldHVybiB1cGRhdGVzLnJlZHVjZShcbiAgICAoc3RhdGUyLCB1cGRhdGUpID0+IGxlZ2FjeV9wYXRjaEltbXV0YWJsZU9iamVjdFdpdGhVcGRhdGUoc3RhdGUyLCB1cGRhdGUpLFxuICAgIHN0YXRlXG4gICk7XG59XG5mdW5jdGlvbiBsZWdhY3lfcGF0Y2hJbW11dGFibGVPYmplY3RXaXRoVXBkYXRlKHN0YXRlLCB1cGRhdGUpIHtcbiAgY29uc3QgcGF0aCA9IGdldFBhcmVudHNQYXRoKHVwZGF0ZS5ub2RlKTtcbiAgcmV0dXJuIGxlZ2FjeV9wYXRjaEltbXV0YWJsZU5vZGUoc3RhdGUsIHBhdGgsIHVwZGF0ZSk7XG59XG5mdW5jdGlvbiBsZWdhY3lfcGF0Y2hJbW11dGFibGVOb2RlKHN0YXRlLCBwYXRoLCB1cGRhdGUpIHtcbiAgY29uc3QgcGF0aEl0ZW0gPSBwYXRoLnBvcCgpO1xuICBpZiAocGF0aEl0ZW0gPT09IHZvaWQgMCkge1xuICAgIHN3aXRjaCAodXBkYXRlLnR5cGUpIHtcbiAgICAgIGNhc2UgXCJMaXZlT2JqZWN0XCI6IHtcbiAgICAgICAgaWYgKCFpc0pzb25PYmplY3Qoc3RhdGUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJJbnRlcm5hbDogcmVjZWl2ZWQgdXBkYXRlIG9uIExpdmVPYmplY3QgYnV0IHN0YXRlIHdhcyBub3QgYW4gb2JqZWN0XCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB1cGRhdGUudXBkYXRlcykge1xuICAgICAgICAgIGlmICh1cGRhdGUudXBkYXRlc1trZXldPy50eXBlID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB2YWwgPSB1cGRhdGUubm9kZS5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWwgIT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICBuZXdTdGF0ZVtrZXldID0gbHNvblRvSnNvbih2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAodXBkYXRlLnVwZGF0ZXNba2V5XT8udHlwZSA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgZGVsZXRlIG5ld1N0YXRlW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJMaXZlTGlzdFwiOiB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIkludGVybmFsOiByZWNlaXZlZCB1cGRhdGUgb24gTGl2ZUxpc3QgYnV0IHN0YXRlIHdhcyBub3QgYW4gYXJyYXlcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5ld1N0YXRlID0gc3RhdGUubWFwKCh4KSA9PiB4KTtcbiAgICAgICAgZm9yIChjb25zdCBsaXN0VXBkYXRlIG9mIHVwZGF0ZS51cGRhdGVzKSB7XG4gICAgICAgICAgaWYgKGxpc3RVcGRhdGUudHlwZSA9PT0gXCJzZXRcIikge1xuICAgICAgICAgICAgbmV3U3RhdGUgPSBuZXdTdGF0ZS5tYXAoXG4gICAgICAgICAgICAgIChpdGVtLCBpbmRleCkgPT4gaW5kZXggPT09IGxpc3RVcGRhdGUuaW5kZXggPyBsc29uVG9Kc29uKGxpc3RVcGRhdGUuaXRlbSkgOiBpdGVtXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAobGlzdFVwZGF0ZS50eXBlID09PSBcImluc2VydFwiKSB7XG4gICAgICAgICAgICBpZiAobGlzdFVwZGF0ZS5pbmRleCA9PT0gbmV3U3RhdGUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlLnB1c2gobHNvblRvSnNvbihsaXN0VXBkYXRlLml0ZW0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlID0gW1xuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKDAsIGxpc3RVcGRhdGUuaW5kZXgpLFxuICAgICAgICAgICAgICAgIGxzb25Ub0pzb24obGlzdFVwZGF0ZS5pdGVtKSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShsaXN0VXBkYXRlLmluZGV4KVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAobGlzdFVwZGF0ZS50eXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICBuZXdTdGF0ZS5zcGxpY2UobGlzdFVwZGF0ZS5pbmRleCwgMSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChsaXN0VXBkYXRlLnR5cGUgPT09IFwibW92ZVwiKSB7XG4gICAgICAgICAgICBpZiAobGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4ID4gbGlzdFVwZGF0ZS5pbmRleCkge1xuICAgICAgICAgICAgICBuZXdTdGF0ZSA9IFtcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZSgwLCBsaXN0VXBkYXRlLmluZGV4KSxcbiAgICAgICAgICAgICAgICBsc29uVG9Kc29uKGxpc3RVcGRhdGUuaXRlbSksXG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUuc2xpY2UobGlzdFVwZGF0ZS5pbmRleCwgbGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4KSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShsaXN0VXBkYXRlLnByZXZpb3VzSW5kZXggKyAxKVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbmV3U3RhdGUgPSBbXG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUuc2xpY2UoMCwgbGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4KSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShcbiAgICAgICAgICAgICAgICAgIGxpc3RVcGRhdGUucHJldmlvdXNJbmRleCArIDEsXG4gICAgICAgICAgICAgICAgICBsaXN0VXBkYXRlLmluZGV4ICsgMVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgbHNvblRvSnNvbihsaXN0VXBkYXRlLml0ZW0pLFxuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKGxpc3RVcGRhdGUuaW5kZXggKyAxKVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiTGl2ZU1hcFwiOiB7XG4gICAgICAgIGlmICghaXNKc29uT2JqZWN0KHN0YXRlKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiSW50ZXJuYWw6IHJlY2VpdmVkIHVwZGF0ZSBvbiBMaXZlTWFwIGJ1dCBzdGF0ZSB3YXMgbm90IGFuIG9iamVjdFwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIHN0YXRlKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdXBkYXRlLnVwZGF0ZXMpIHtcbiAgICAgICAgICBpZiAodXBkYXRlLnVwZGF0ZXNba2V5XT8udHlwZSA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB1cGRhdGUubm9kZS5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlW2tleV0gPSBsc29uVG9Kc29uKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKHVwZGF0ZS51cGRhdGVzW2tleV0/LnR5cGUgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBuZXdTdGF0ZVtrZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KHN0YXRlKSkge1xuICAgIGNvbnN0IG5ld0FycmF5ID0gWy4uLnN0YXRlXTtcbiAgICBuZXdBcnJheVtwYXRoSXRlbV0gPSBsZWdhY3lfcGF0Y2hJbW11dGFibGVOb2RlKFxuICAgICAgc3RhdGVbcGF0aEl0ZW1dLFxuICAgICAgcGF0aCxcbiAgICAgIHVwZGF0ZVxuICAgICk7XG4gICAgcmV0dXJuIG5ld0FycmF5O1xuICB9IGVsc2UgaWYgKGlzSnNvbk9iamVjdChzdGF0ZSkpIHtcbiAgICBjb25zdCBub2RlID0gc3RhdGVbcGF0aEl0ZW1dO1xuICAgIGlmIChub2RlID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3RhdGVBc09iaiA9IHN0YXRlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGVBc09iaixcbiAgICAgICAgW3BhdGhJdGVtXTogbGVnYWN5X3BhdGNoSW1tdXRhYmxlTm9kZShub2RlLCBwYXRoLCB1cGRhdGUpXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cbn1cblxuLy8gc3JjL2xpYi9kZXByZWNhdGlvbi50c1xudmFyIF9lbWl0dGVkRGVwcmVjYXRpb25XYXJuaW5ncyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG5mdW5jdGlvbiBkZXByZWNhdGUobWVzc2FnZSwga2V5ID0gbWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKCFfZW1pdHRlZERlcHJlY2F0aW9uV2FybmluZ3MuaGFzKGtleSkpIHtcbiAgICAgIF9lbWl0dGVkRGVwcmVjYXRpb25XYXJuaW5ncy5hZGQoa2V5KTtcbiAgICAgIGVycm9yV2l0aFRpdGxlKFwiRGVwcmVjYXRpb24gd2FybmluZ1wiLCBtZXNzYWdlKTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGRlcHJlY2F0ZUlmKGNvbmRpdGlvbiwgbWVzc2FnZSwga2V5ID0gbWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKGNvbmRpdGlvbikge1xuICAgICAgZGVwcmVjYXRlKG1lc3NhZ2UsIGtleSk7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiB0aHJvd1VzYWdlRXJyb3IobWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgY29uc3QgdXNhZ2VFcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB1c2FnZUVycm9yLm5hbWUgPSBcIlVzYWdlIGVycm9yXCI7XG4gICAgZXJyb3JXaXRoVGl0bGUoXCJVc2FnZSBlcnJvclwiLCBtZXNzYWdlKTtcbiAgICB0aHJvdyB1c2FnZUVycm9yO1xuICB9XG59XG5mdW5jdGlvbiBlcnJvcklmKGNvbmRpdGlvbiwgbWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKGNvbmRpdGlvbikge1xuICAgICAgdGhyb3dVc2FnZUVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBzcmMvbGliL1BvbGxlci50c1xuZnVuY3Rpb24gbWFrZVBvbGxlcihjYWxsYmFjaykge1xuICBsZXQgY29udGV4dCA9IHtcbiAgICBzdGF0ZTogXCJzdG9wcGVkXCIsXG4gICAgdGltZW91dEhhbmRsZTogbnVsbCxcbiAgICBpbnRlcnZhbDogbnVsbCxcbiAgICBsYXN0U2NoZWR1bGVkQXQ6IG51bGwsXG4gICAgcmVtYWluaW5nSW50ZXJ2YWw6IG51bGxcbiAgfTtcbiAgZnVuY3Rpb24gcG9sbCgpIHtcbiAgICBpZiAoY29udGV4dC5zdGF0ZSA9PT0gXCJydW5uaW5nXCIpIHtcbiAgICAgIHNjaGVkdWxlKGNvbnRleHQuaW50ZXJ2YWwpO1xuICAgIH1cbiAgICB2b2lkIGNhbGxiYWNrKCk7XG4gIH1cbiAgZnVuY3Rpb24gc2NoZWR1bGUoaW50ZXJ2YWwpIHtcbiAgICBjb250ZXh0ID0ge1xuICAgICAgc3RhdGU6IFwicnVubmluZ1wiLFxuICAgICAgaW50ZXJ2YWw6IGNvbnRleHQuc3RhdGUgIT09IFwic3RvcHBlZFwiID8gY29udGV4dC5pbnRlcnZhbCA6IGludGVydmFsLFxuICAgICAgbGFzdFNjaGVkdWxlZEF0OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgIHRpbWVvdXRIYW5kbGU6IHNldFRpbWVvdXQocG9sbCwgaW50ZXJ2YWwpLFxuICAgICAgcmVtYWluaW5nSW50ZXJ2YWw6IG51bGxcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIHNjaGVkdWxlUmVtYWluaW5nKHJlbWFpbmluZykge1xuICAgIGlmIChjb250ZXh0LnN0YXRlICE9PSBcInBhdXNlZFwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnRleHQgPSB7XG4gICAgICBzdGF0ZTogXCJydW5uaW5nXCIsXG4gICAgICBpbnRlcnZhbDogY29udGV4dC5pbnRlcnZhbCxcbiAgICAgIGxhc3RTY2hlZHVsZWRBdDogY29udGV4dC5sYXN0U2NoZWR1bGVkQXQsXG4gICAgICB0aW1lb3V0SGFuZGxlOiBzZXRUaW1lb3V0KHBvbGwsIHJlbWFpbmluZyksXG4gICAgICByZW1haW5pbmdJbnRlcnZhbDogbnVsbFxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gc3RhcnQoaW50ZXJ2YWwpIHtcbiAgICBpZiAoY29udGV4dC5zdGF0ZSA9PT0gXCJydW5uaW5nXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2NoZWR1bGUoaW50ZXJ2YWwpO1xuICB9XG4gIGZ1bmN0aW9uIHJlc3RhcnQoaW50ZXJ2YWwpIHtcbiAgICBzdG9wKCk7XG4gICAgc3RhcnQoaW50ZXJ2YWwpO1xuICB9XG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlICE9PSBcInJ1bm5pbmdcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjbGVhclRpbWVvdXQoY29udGV4dC50aW1lb3V0SGFuZGxlKTtcbiAgICBjb250ZXh0ID0ge1xuICAgICAgc3RhdGU6IFwicGF1c2VkXCIsXG4gICAgICBpbnRlcnZhbDogY29udGV4dC5pbnRlcnZhbCxcbiAgICAgIGxhc3RTY2hlZHVsZWRBdDogY29udGV4dC5sYXN0U2NoZWR1bGVkQXQsXG4gICAgICB0aW1lb3V0SGFuZGxlOiBudWxsLFxuICAgICAgcmVtYWluaW5nSW50ZXJ2YWw6IGNvbnRleHQuaW50ZXJ2YWwgLSAocGVyZm9ybWFuY2Uubm93KCkgLSBjb250ZXh0Lmxhc3RTY2hlZHVsZWRBdClcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIHJlc3VtZSgpIHtcbiAgICBpZiAoY29udGV4dC5zdGF0ZSAhPT0gXCJwYXVzZWRcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzY2hlZHVsZVJlbWFpbmluZyhjb250ZXh0LnJlbWFpbmluZ0ludGVydmFsKTtcbiAgfVxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlID09PSBcInN0b3BwZWRcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC50aW1lb3V0SGFuZGxlKSB7XG4gICAgICBjbGVhclRpbWVvdXQoY29udGV4dC50aW1lb3V0SGFuZGxlKTtcbiAgICB9XG4gICAgY29udGV4dCA9IHtcbiAgICAgIHN0YXRlOiBcInN0b3BwZWRcIixcbiAgICAgIGludGVydmFsOiBudWxsLFxuICAgICAgbGFzdFNjaGVkdWxlZEF0OiBudWxsLFxuICAgICAgdGltZW91dEhhbmRsZTogbnVsbCxcbiAgICAgIHJlbWFpbmluZ0ludGVydmFsOiBudWxsXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHN0YXJ0LFxuICAgIHJlc3RhcnQsXG4gICAgcGF1c2UsXG4gICAgcmVzdW1lLFxuICAgIHN0b3BcbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9zaGFsbG93LnRzXG5mdW5jdGlvbiBzaGFsbG93QXJyYXkoeHMsIHlzKSB7XG4gIGlmICh4cy5sZW5ndGggIT09IHlzLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IHhzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKCFPYmplY3QuaXMoeHNbaV0sIHlzW2ldKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIHNoYWxsb3dPYmoob2JqQSwgb2JqQikge1xuICBpZiAodHlwZW9mIG9iakEgIT09IFwib2JqZWN0XCIgfHwgb2JqQSA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqQiAhPT0gXCJvYmplY3RcIiB8fCBvYmpCID09PSBudWxsIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmpBKSAhPT0gXCJbb2JqZWN0IE9iamVjdF1cIiB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqQikgIT09IFwiW29iamVjdCBPYmplY3RdXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3Qga2V5c0EgPSBPYmplY3Qua2V5cyhvYmpBKTtcbiAgaWYgKGtleXNBLmxlbmd0aCAhPT0gT2JqZWN0LmtleXMob2JqQikubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBrZXlzQS5ldmVyeShcbiAgICAoa2V5KSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqQiwga2V5KSAmJiBPYmplY3QuaXMob2JqQVtrZXldLCBvYmpCW2tleV0pXG4gICk7XG59XG5mdW5jdGlvbiBzaGFsbG93KGEsIGIpIHtcbiAgaWYgKE9iamVjdC5pcyhhLCBiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IGlzQXJyYXlBID0gQXJyYXkuaXNBcnJheShhKTtcbiAgY29uc3QgaXNBcnJheUIgPSBBcnJheS5pc0FycmF5KGIpO1xuICBpZiAoaXNBcnJheUEgfHwgaXNBcnJheUIpIHtcbiAgICBpZiAoIWlzQXJyYXlBIHx8ICFpc0FycmF5Qikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gc2hhbGxvd0FycmF5KGEsIGIpO1xuICB9XG4gIHJldHVybiBzaGFsbG93T2JqKGEsIGIpO1xufVxuXG4vLyBzcmMvaW5kZXgudHNcbmRldGVjdER1cGVzKFBLR19OQU1FLCBQS0dfVkVSU0lPTiwgUEtHX0ZPUk1BVCk7XG5leHBvcnQge1xuICBDbGllbnRNc2dDb2RlLFxuICBDb21tZW50c0FwaUVycm9yLFxuICBDcmR0VHlwZSxcbiAgTGl2ZUxpc3QsXG4gIExpdmVNYXAsXG4gIExpdmVPYmplY3QsXG4gIE5vdGlmaWNhdGlvbnNBcGlFcnJvcixcbiAgT3BDb2RlLFxuICBTZXJ2ZXJNc2dDb2RlLFxuICBXZWJzb2NrZXRDbG9zZUNvZGVzLFxuICBhY2tPcCxcbiAgYWRkUmVhY3Rpb24sXG4gIGFwcGx5T3B0aW1pc3RpY1VwZGF0ZXMsXG4gIGFzUG9zLFxuICBhc3NlcnQsXG4gIGFzc2VydE5ldmVyLFxuICBiNjRkZWNvZGUsXG4gIGNsb25lTHNvbixcbiAgZmFuY3lfY29uc29sZV9leHBvcnRzIGFzIGNvbnNvbGUsXG4gIGNvbnZlcnRUb0NvbW1lbnREYXRhLFxuICBjb252ZXJ0VG9Db21tZW50VXNlclJlYWN0aW9uLFxuICBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRhdGEsXG4gIGNvbnZlcnRUb1RocmVhZERhdGEsXG4gIGNyZWF0ZUNsaWVudCxcbiAgY3JlYXRlQ29tbWVudElkLFxuICBjcmVhdGVJbmJveE5vdGlmaWNhdGlvbklkLFxuICBjcmVhdGVUaHJlYWRJZCxcbiAgZGVsZXRlQ29tbWVudCxcbiAgZGVwcmVjYXRlLFxuICBkZXByZWNhdGVJZixcbiAgZGV0ZWN0RHVwZXMsXG4gIGVycm9ySWYsXG4gIGZyZWV6ZSxcbiAgZ2V0TWVudGlvbmVkSWRzRnJvbUNvbW1lbnRCb2R5LFxuICBpc0NoaWxkQ3JkdCxcbiAgaXNKc29uQXJyYXksXG4gIGlzSnNvbk9iamVjdCxcbiAgaXNKc29uU2NhbGFyLFxuICBpc0xpdmVOb2RlLFxuICBpc1BsYWluT2JqZWN0LFxuICBpc1Jvb3RDcmR0LFxuICBrSW50ZXJuYWwsXG4gIGxlZ2FjeV9wYXRjaEltbXV0YWJsZU9iamVjdCxcbiAgbHNvblRvSnNvbixcbiAgbWFrZUV2ZW50U291cmNlLFxuICBtYWtlUG9sbGVyLFxuICBtYWtlUG9zaXRpb24sXG4gIG1lbW9pemVPblN1Y2Nlc3MsXG4gIG5hbm9pZCxcbiAgbm4sXG4gIG9iamVjdFRvUXVlcnksXG4gIHBhdGNoTGl2ZU9iamVjdEtleSxcbiAgcmFpc2UsXG4gIHJlbW92ZVJlYWN0aW9uLFxuICBzaGFsbG93LFxuICBzdHJpbmdpZnksXG4gIHN0cmluZ2lmeUNvbW1lbnRCb2R5LFxuICB0aHJvd1VzYWdlRXJyb3IsXG4gIHRvUGxhaW5Mc29uLFxuICB0cnlQYXJzZUpzb24sXG4gIHVwc2VydENvbW1lbnQsXG4gIHdhaXQsXG4gIHdpdGhUaW1lb3V0XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/classnames.mjs":
/*!********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/classnames.mjs ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   classNames: () => (/* binding */ classNames)\n/* harmony export */ });\nfunction classNames(...args) {\n  return args.filter((arg) => typeof arg === \"string\" || typeof arg === \"number\").join(\" \");\n}\n\n\n//# sourceMappingURL=classnames.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NsYXNzbmFtZXMubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRXNCO0FBQ3RCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NsYXNzbmFtZXMubWpzP2EzNzMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gY2xhc3NOYW1lcyguLi5hcmdzKSB7XG4gIHJldHVybiBhcmdzLmZpbHRlcigoYXJnKSA9PiB0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiBhcmcgPT09IFwibnVtYmVyXCIpLmpvaW4oXCIgXCIpO1xufVxuXG5leHBvcnQgeyBjbGFzc05hbWVzIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jbGFzc25hbWVzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/classnames.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/anchored-threads.mjs":
/*!***********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/anchored-threads.mjs ***!
  \***********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AnchoredThreads: () => (/* binding */ AnchoredThreads),\n/* harmony export */   compareNodes: () => (/* binding */ compareNodes)\n/* harmony export */ });\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @liveblocks/react-ui */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Thread.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _classnames_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../classnames.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/classnames.mjs\");\n/* harmony import */ var _liveblocks_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../liveblocks-plugin-provider.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/liveblocks-plugin-provider.mjs\");\n/* harmony import */ var _comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./comment-plugin-provider.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/comment-plugin-provider.mjs\");\n/* harmony import */ var _thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\");\n\n\n\n\n\n\n\n\n\nconst DEFAULT_GAP = 20;\nconst DEFAULT_ACTIVE_THREAD_OFFSET = -12;\nconst GAP = `var(--lb-lexical-anchored-threads-gap, ${DEFAULT_GAP}px)`;\nconst ACTIVE_THREAD_OFFSET = `var(--lb-lexical-anchored-threads-active-thread-offset, ${DEFAULT_ACTIVE_THREAD_OFFSET}px)`;\nfunction compareNodes(a, b) {\n  const position = a.compareDocumentPosition(b);\n  if (position & Node.DOCUMENT_POSITION_FOLLOWING)\n    return -1;\n  if (position & Node.DOCUMENT_POSITION_PRECEDING)\n    return 1;\n  return 0;\n}\nfunction AnchoredThreads({\n  threads,\n  components,\n  className,\n  style,\n  ...props\n}) {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__.useLexicalComposerContext)();\n  const Thread$1 = components?.Thread ?? _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_2__.Thread;\n  const containerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  const activeThreads = useActiveThreads();\n  const nodes = useThreadToNodes();\n  const getOrderedThreads = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    return threads.map((thread) => {\n      const keys = nodes.get(thread.id);\n      if (keys === void 0 || keys.size === 0)\n        return null;\n      const elements2 = Array.from(keys.values()).map((key) => editor.getElementByKey(key)).filter(Boolean);\n      if (elements2.length === 0)\n        return null;\n      const element = elements2.sort(compareNodes)[0];\n      return {\n        thread,\n        element\n      };\n    }).filter(\n      (entry) => entry !== null\n    ).sort((a, b) => {\n      return compareNodes(a.element, b.element);\n    });\n  }, [editor, threads, nodes]);\n  const orderedThreads = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(getOrderedThreads, [getOrderedThreads]);\n  const [elements, setElements] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(/* @__PURE__ */ new Map());\n  const [positions, setPositions] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(/* @__PURE__ */ new Map());\n  const onItemAdd = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((id, el) => {\n    setElements((prev) => new Map(prev).set(id, el));\n  }, []);\n  const onItemRemove = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((id) => {\n    setElements((prev) => {\n      const items = new Map(prev);\n      items.delete(id);\n      return items;\n    });\n  }, []);\n  const handlePositionThreads = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    const container = containerRef.current;\n    if (container === null)\n      return;\n    const orderedThreads2 = getOrderedThreads();\n    function getAscendingThreads() {\n      if (activeThreads.length === 0)\n        return orderedThreads2;\n      const active = orderedThreads2.filter(\n        ({ thread }) => activeThreads.includes(thread.id)\n      );\n      const after = orderedThreads2.filter(({ thread, element }) => {\n        if (activeThreads.includes(thread.id))\n          return false;\n        const isAfter = active.some(({ element: activeElement }) => {\n          return compareNodes(activeElement, element) === -1;\n        });\n        return isAfter;\n      });\n      return active.concat(after);\n    }\n    const ascending = getAscendingThreads();\n    const descending = orderedThreads2.filter(\n      (entry) => !ascending.includes(entry)\n    );\n    const newPositions = /* @__PURE__ */ new Map();\n    for (const { thread, element } of ascending) {\n      const rect = element.getBoundingClientRect();\n      let top = rect.top - container.getBoundingClientRect().top;\n      for (const [id, position] of newPositions) {\n        const el = elements.get(id);\n        if (el === void 0)\n          continue;\n        if (top >= position && top <= position + el.getBoundingClientRect().height) {\n          top = position + el.getBoundingClientRect().height;\n        }\n      }\n      newPositions.set(thread.id, top);\n    }\n    for (const { thread, element } of descending.reverse()) {\n      const rect = element.getBoundingClientRect();\n      const el = elements.get(thread.id);\n      if (el === void 0)\n        continue;\n      let top = rect.top - container.getBoundingClientRect().top;\n      for (const [, position] of newPositions) {\n        if (top >= position - el.getBoundingClientRect().height) {\n          top = position - el.getBoundingClientRect().height;\n        }\n      }\n      newPositions.set(thread.id, top);\n    }\n    setPositions(newPositions);\n  }, [getOrderedThreads, activeThreads, elements]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {\n    handlePositionThreads();\n  }, [handlePositionThreads]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    return editor.registerUpdateListener(() => {\n      handlePositionThreads();\n    });\n  }, [editor, handlePositionThreads]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    const observer = new ResizeObserver(handlePositionThreads);\n    for (const element of elements.values()) {\n      observer.observe(element);\n    }\n    return () => observer.disconnect();\n  }, [elements, handlePositionThreads]);\n  const root = (0,_liveblocks_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_3__.useRootElement)();\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if (root === null)\n      return;\n    const observer = new ResizeObserver(handlePositionThreads);\n    observer.observe(root);\n    return () => observer.disconnect();\n  }, [root, handlePositionThreads]);\n  if (orderedThreads.length === 0)\n    return null;\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    ...props,\n    className: (0,_classnames_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(className, \"lb-root lb-lexical-anchored-threads\"),\n    ref: containerRef,\n    style: {\n      position: \"relative\",\n      ...style\n    }\n  }, orderedThreads.map(({ thread, element }) => {\n    const rect = element.getBoundingClientRect();\n    const offset = root !== null ? root.getBoundingClientRect().top : 0;\n    let top = rect.top - offset;\n    if (positions.has(thread.id)) {\n      top = positions.get(thread.id);\n    }\n    const isActive = activeThreads.includes(thread.id);\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ThreadWrapper, {\n      key: thread.id,\n      Thread: Thread$1,\n      thread,\n      onItemAdd,\n      onItemRemove,\n      style: {\n        position: \"absolute\",\n        transform: `translate3d(${isActive ? ACTIVE_THREAD_OFFSET : 0}, ${top}px, 0)`,\n        insetInlineStart: 0,\n        inlineSize: \"100%\",\n        paddingBlockEnd: GAP\n      }\n    });\n  }));\n}\nfunction ThreadWrapper({\n  onItemAdd,\n  onItemRemove,\n  thread,\n  Thread,\n  className,\n  ...props\n}) {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__.useLexicalComposerContext)();\n  const nodes = useThreadToNodes();\n  const activeThreads = useActiveThreads();\n  const isActive = activeThreads.includes(thread.id);\n  function handleThreadClick() {\n    const keys = nodes.get(thread.id);\n    if (keys === void 0 || keys.size === 0)\n      return;\n    if (activeThreads.includes(thread.id))\n      return;\n    editor.update(() => {\n      const [key] = keys;\n      const node = (0,lexical__WEBPACK_IMPORTED_MODULE_5__.$getNodeByKey)(key);\n      if (!(0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$isThreadMarkNode)(node))\n        return;\n      node.selectStart();\n    });\n  }\n  const handleRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (el) => {\n      onItemAdd(thread.id, el);\n      return () => onItemRemove(thread.id);\n    },\n    [thread.id, onItemAdd, onItemRemove]\n  );\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    ref: handleRef,\n    className: (0,_classnames_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\n      \"lb-lexical-anchored-threads-thread-container\",\n      className\n    ),\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Thread, {\n    thread,\n    \"data-state\": isActive ? \"active\" : \"inactive\",\n    onClick: handleThreadClick,\n    className: \"lb-lexical-anchored-threads-thread\",\n    showComposer: isActive ? true : false\n  }));\n}\nfunction useThreadToNodes() {\n  const threadToNodes = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_7__.ThreadToNodesContext);\n  if (threadToNodes === null) {\n    throw new Error(\n      \"AnchoredThreads component must be used within a LiveblocksPlugin component.\"\n    );\n  }\n  return threadToNodes;\n}\nfunction useActiveThreads() {\n  const activeThreads = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_7__.ActiveThreadsContext);\n  if (activeThreads === null) {\n    throw new Error(\n      \"AnchoredThreads component must be used within LiveblocksPlugin.\"\n    );\n  }\n  return activeThreads;\n}\n\n\n//# sourceMappingURL=anchored-threads.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2FuY2hvcmVkLXRocmVhZHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBa0Y7QUFDcEM7QUFDTjtBQUMrRTtBQUN4RTtBQUNvQjtBQUN3QjtBQUNoQzs7QUFFM0Q7QUFDQTtBQUNBLHNEQUFzRCxZQUFZO0FBQ2xFLHdGQUF3Riw2QkFBNkI7QUFDckg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxtQkFBbUIsZ0dBQXlCO0FBQzVDLHlDQUF5Qyx3REFBTTtBQUMvQyx1QkFBdUIsNkNBQU07QUFDN0I7QUFDQTtBQUNBLDRCQUE0QixrREFBVztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSCx5QkFBeUIsOENBQU87QUFDaEMsa0NBQWtDLCtDQUFRO0FBQzFDLG9DQUFvQywrQ0FBUTtBQUM1QyxvQkFBb0Isa0RBQVc7QUFDL0I7QUFDQSxHQUFHO0FBQ0gsdUJBQXVCLGtEQUFXO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSCxnQ0FBZ0Msa0RBQVc7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQjtBQUNBLDhDQUE4QyxpQkFBaUI7QUFDL0Q7QUFDQTtBQUNBLHVDQUF1Qyx3QkFBd0I7QUFDL0Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsa0JBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixrQkFBa0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxzREFBZTtBQUNqQjtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsZUFBZSwrRUFBYztBQUM3QixFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EseUJBQXlCLGdEQUE0QjtBQUNyRDtBQUNBLGVBQWUsMkRBQVU7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsd0JBQXdCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixnREFBNEI7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msb0NBQW9DLElBQUksSUFBSTtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxtQkFBbUIsZ0dBQXlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsc0RBQWE7QUFDaEMsV0FBVyx3RUFBaUI7QUFDNUI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLG9CQUFvQixrREFBVztBQUMvQjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHlCQUF5QixnREFBNEI7QUFDckQ7QUFDQSxlQUFlLDJEQUFVO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLHdCQUF3QixpREFBVSxDQUFDLDhFQUFvQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGlEQUFVLENBQUMsOEVBQW9CO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV5QztBQUN6QyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LWxleGljYWwvZGlzdC9jb21tZW50cy9hbmNob3JlZC10aHJlYWRzLm1qcz9mMzY0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29tcG9zZXJDb250ZXh0JztcbmltcG9ydCB7IFRocmVhZCB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0LXVpJztcbmltcG9ydCB7ICRnZXROb2RlQnlLZXkgfSBmcm9tICdsZXhpY2FsJztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyB1c2VSZWYsIHVzZUNhbGxiYWNrLCB1c2VNZW1vLCB1c2VTdGF0ZSwgdXNlTGF5b3V0RWZmZWN0LCB1c2VFZmZlY3QsIHVzZUNvbnRleHQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSAnLi4vY2xhc3NuYW1lcy5tanMnO1xuaW1wb3J0IHsgdXNlUm9vdEVsZW1lbnQgfSBmcm9tICcuLi9saXZlYmxvY2tzLXBsdWdpbi1wcm92aWRlci5tanMnO1xuaW1wb3J0IHsgVGhyZWFkVG9Ob2Rlc0NvbnRleHQsIEFjdGl2ZVRocmVhZHNDb250ZXh0IH0gZnJvbSAnLi9jb21tZW50LXBsdWdpbi1wcm92aWRlci5tanMnO1xuaW1wb3J0IHsgJGlzVGhyZWFkTWFya05vZGUgfSBmcm9tICcuL3RocmVhZC1tYXJrLW5vZGUubWpzJztcblxuY29uc3QgREVGQVVMVF9HQVAgPSAyMDtcbmNvbnN0IERFRkFVTFRfQUNUSVZFX1RIUkVBRF9PRkZTRVQgPSAtMTI7XG5jb25zdCBHQVAgPSBgdmFyKC0tbGItbGV4aWNhbC1hbmNob3JlZC10aHJlYWRzLWdhcCwgJHtERUZBVUxUX0dBUH1weClgO1xuY29uc3QgQUNUSVZFX1RIUkVBRF9PRkZTRVQgPSBgdmFyKC0tbGItbGV4aWNhbC1hbmNob3JlZC10aHJlYWRzLWFjdGl2ZS10aHJlYWQtb2Zmc2V0LCAke0RFRkFVTFRfQUNUSVZFX1RIUkVBRF9PRkZTRVR9cHgpYDtcbmZ1bmN0aW9uIGNvbXBhcmVOb2RlcyhhLCBiKSB7XG4gIGNvbnN0IHBvc2l0aW9uID0gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKTtcbiAgaWYgKHBvc2l0aW9uICYgTm9kZS5ET0NVTUVOVF9QT1NJVElPTl9GT0xMT1dJTkcpXG4gICAgcmV0dXJuIC0xO1xuICBpZiAocG9zaXRpb24gJiBOb2RlLkRPQ1VNRU5UX1BPU0lUSU9OX1BSRUNFRElORylcbiAgICByZXR1cm4gMTtcbiAgcmV0dXJuIDA7XG59XG5mdW5jdGlvbiBBbmNob3JlZFRocmVhZHMoe1xuICB0aHJlYWRzLFxuICBjb21wb25lbnRzLFxuICBjbGFzc05hbWUsXG4gIHN0eWxlLFxuICAuLi5wcm9wc1xufSkge1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3QgVGhyZWFkJDEgPSBjb21wb25lbnRzPy5UaHJlYWQgPz8gVGhyZWFkO1xuICBjb25zdCBjb250YWluZXJSZWYgPSB1c2VSZWYobnVsbCk7XG4gIGNvbnN0IGFjdGl2ZVRocmVhZHMgPSB1c2VBY3RpdmVUaHJlYWRzKCk7XG4gIGNvbnN0IG5vZGVzID0gdXNlVGhyZWFkVG9Ob2RlcygpO1xuICBjb25zdCBnZXRPcmRlcmVkVGhyZWFkcyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICByZXR1cm4gdGhyZWFkcy5tYXAoKHRocmVhZCkgPT4ge1xuICAgICAgY29uc3Qga2V5cyA9IG5vZGVzLmdldCh0aHJlYWQuaWQpO1xuICAgICAgaWYgKGtleXMgPT09IHZvaWQgMCB8fCBrZXlzLnNpemUgPT09IDApXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgY29uc3QgZWxlbWVudHMyID0gQXJyYXkuZnJvbShrZXlzLnZhbHVlcygpKS5tYXAoKGtleSkgPT4gZWRpdG9yLmdldEVsZW1lbnRCeUtleShrZXkpKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICBpZiAoZWxlbWVudHMyLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICBjb25zdCBlbGVtZW50ID0gZWxlbWVudHMyLnNvcnQoY29tcGFyZU5vZGVzKVswXTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZCxcbiAgICAgICAgZWxlbWVudFxuICAgICAgfTtcbiAgICB9KS5maWx0ZXIoXG4gICAgICAoZW50cnkpID0+IGVudHJ5ICE9PSBudWxsXG4gICAgKS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICByZXR1cm4gY29tcGFyZU5vZGVzKGEuZWxlbWVudCwgYi5lbGVtZW50KTtcbiAgICB9KTtcbiAgfSwgW2VkaXRvciwgdGhyZWFkcywgbm9kZXNdKTtcbiAgY29uc3Qgb3JkZXJlZFRocmVhZHMgPSB1c2VNZW1vKGdldE9yZGVyZWRUaHJlYWRzLCBbZ2V0T3JkZXJlZFRocmVhZHNdKTtcbiAgY29uc3QgW2VsZW1lbnRzLCBzZXRFbGVtZW50c10gPSB1c2VTdGF0ZSgvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpKTtcbiAgY29uc3QgW3Bvc2l0aW9ucywgc2V0UG9zaXRpb25zXSA9IHVzZVN0YXRlKC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCkpO1xuICBjb25zdCBvbkl0ZW1BZGQgPSB1c2VDYWxsYmFjaygoaWQsIGVsKSA9PiB7XG4gICAgc2V0RWxlbWVudHMoKHByZXYpID0+IG5ldyBNYXAocHJldikuc2V0KGlkLCBlbCkpO1xuICB9LCBbXSk7XG4gIGNvbnN0IG9uSXRlbVJlbW92ZSA9IHVzZUNhbGxiYWNrKChpZCkgPT4ge1xuICAgIHNldEVsZW1lbnRzKChwcmV2KSA9PiB7XG4gICAgICBjb25zdCBpdGVtcyA9IG5ldyBNYXAocHJldik7XG4gICAgICBpdGVtcy5kZWxldGUoaWQpO1xuICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH0pO1xuICB9LCBbXSk7XG4gIGNvbnN0IGhhbmRsZVBvc2l0aW9uVGhyZWFkcyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBjb250YWluZXJSZWYuY3VycmVudDtcbiAgICBpZiAoY29udGFpbmVyID09PSBudWxsKVxuICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IG9yZGVyZWRUaHJlYWRzMiA9IGdldE9yZGVyZWRUaHJlYWRzKCk7XG4gICAgZnVuY3Rpb24gZ2V0QXNjZW5kaW5nVGhyZWFkcygpIHtcbiAgICAgIGlmIChhY3RpdmVUaHJlYWRzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIG9yZGVyZWRUaHJlYWRzMjtcbiAgICAgIGNvbnN0IGFjdGl2ZSA9IG9yZGVyZWRUaHJlYWRzMi5maWx0ZXIoXG4gICAgICAgICh7IHRocmVhZCB9KSA9PiBhY3RpdmVUaHJlYWRzLmluY2x1ZGVzKHRocmVhZC5pZClcbiAgICAgICk7XG4gICAgICBjb25zdCBhZnRlciA9IG9yZGVyZWRUaHJlYWRzMi5maWx0ZXIoKHsgdGhyZWFkLCBlbGVtZW50IH0pID0+IHtcbiAgICAgICAgaWYgKGFjdGl2ZVRocmVhZHMuaW5jbHVkZXModGhyZWFkLmlkKSlcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IGlzQWZ0ZXIgPSBhY3RpdmUuc29tZSgoeyBlbGVtZW50OiBhY3RpdmVFbGVtZW50IH0pID0+IHtcbiAgICAgICAgICByZXR1cm4gY29tcGFyZU5vZGVzKGFjdGl2ZUVsZW1lbnQsIGVsZW1lbnQpID09PSAtMTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpc0FmdGVyO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWN0aXZlLmNvbmNhdChhZnRlcik7XG4gICAgfVxuICAgIGNvbnN0IGFzY2VuZGluZyA9IGdldEFzY2VuZGluZ1RocmVhZHMoKTtcbiAgICBjb25zdCBkZXNjZW5kaW5nID0gb3JkZXJlZFRocmVhZHMyLmZpbHRlcihcbiAgICAgIChlbnRyeSkgPT4gIWFzY2VuZGluZy5pbmNsdWRlcyhlbnRyeSlcbiAgICApO1xuICAgIGNvbnN0IG5ld1Bvc2l0aW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgZm9yIChjb25zdCB7IHRocmVhZCwgZWxlbWVudCB9IG9mIGFzY2VuZGluZykge1xuICAgICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBsZXQgdG9wID0gcmVjdC50b3AgLSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgICAgZm9yIChjb25zdCBbaWQsIHBvc2l0aW9uXSBvZiBuZXdQb3NpdGlvbnMpIHtcbiAgICAgICAgY29uc3QgZWwgPSBlbGVtZW50cy5nZXQoaWQpO1xuICAgICAgICBpZiAoZWwgPT09IHZvaWQgMClcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgaWYgKHRvcCA+PSBwb3NpdGlvbiAmJiB0b3AgPD0gcG9zaXRpb24gKyBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQpIHtcbiAgICAgICAgICB0b3AgPSBwb3NpdGlvbiArIGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbmV3UG9zaXRpb25zLnNldCh0aHJlYWQuaWQsIHRvcCk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgeyB0aHJlYWQsIGVsZW1lbnQgfSBvZiBkZXNjZW5kaW5nLnJldmVyc2UoKSkge1xuICAgICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBjb25zdCBlbCA9IGVsZW1lbnRzLmdldCh0aHJlYWQuaWQpO1xuICAgICAgaWYgKGVsID09PSB2b2lkIDApXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgbGV0IHRvcCA9IHJlY3QudG9wIC0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICAgIGZvciAoY29uc3QgWywgcG9zaXRpb25dIG9mIG5ld1Bvc2l0aW9ucykge1xuICAgICAgICBpZiAodG9wID49IHBvc2l0aW9uIC0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0KSB7XG4gICAgICAgICAgdG9wID0gcG9zaXRpb24gLSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIG5ld1Bvc2l0aW9ucy5zZXQodGhyZWFkLmlkLCB0b3ApO1xuICAgIH1cbiAgICBzZXRQb3NpdGlvbnMobmV3UG9zaXRpb25zKTtcbiAgfSwgW2dldE9yZGVyZWRUaHJlYWRzLCBhY3RpdmVUaHJlYWRzLCBlbGVtZW50c10pO1xuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4ge1xuICAgIGhhbmRsZVBvc2l0aW9uVGhyZWFkcygpO1xuICB9LCBbaGFuZGxlUG9zaXRpb25UaHJlYWRzXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlclVwZGF0ZUxpc3RlbmVyKCgpID0+IHtcbiAgICAgIGhhbmRsZVBvc2l0aW9uVGhyZWFkcygpO1xuICAgIH0pO1xuICB9LCBbZWRpdG9yLCBoYW5kbGVQb3NpdGlvblRocmVhZHNdKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcihoYW5kbGVQb3NpdGlvblRocmVhZHMpO1xuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cy52YWx1ZXMoKSkge1xuICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50KTtcbiAgICB9XG4gICAgcmV0dXJuICgpID0+IG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgfSwgW2VsZW1lbnRzLCBoYW5kbGVQb3NpdGlvblRocmVhZHNdKTtcbiAgY29uc3Qgcm9vdCA9IHVzZVJvb3RFbGVtZW50KCk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHJvb3QgPT09IG51bGwpXG4gICAgICByZXR1cm47XG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoaGFuZGxlUG9zaXRpb25UaHJlYWRzKTtcbiAgICBvYnNlcnZlci5vYnNlcnZlKHJvb3QpO1xuICAgIHJldHVybiAoKSA9PiBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gIH0sIFtyb290LCBoYW5kbGVQb3NpdGlvblRocmVhZHNdKTtcbiAgaWYgKG9yZGVyZWRUaHJlYWRzLmxlbmd0aCA9PT0gMClcbiAgICByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAuLi5wcm9wcyxcbiAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoY2xhc3NOYW1lLCBcImxiLXJvb3QgbGItbGV4aWNhbC1hbmNob3JlZC10aHJlYWRzXCIpLFxuICAgIHJlZjogY29udGFpbmVyUmVmLFxuICAgIHN0eWxlOiB7XG4gICAgICBwb3NpdGlvbjogXCJyZWxhdGl2ZVwiLFxuICAgICAgLi4uc3R5bGVcbiAgICB9XG4gIH0sIG9yZGVyZWRUaHJlYWRzLm1hcCgoeyB0aHJlYWQsIGVsZW1lbnQgfSkgPT4ge1xuICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IG9mZnNldCA9IHJvb3QgIT09IG51bGwgPyByb290LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCA6IDA7XG4gICAgbGV0IHRvcCA9IHJlY3QudG9wIC0gb2Zmc2V0O1xuICAgIGlmIChwb3NpdGlvbnMuaGFzKHRocmVhZC5pZCkpIHtcbiAgICAgIHRvcCA9IHBvc2l0aW9ucy5nZXQodGhyZWFkLmlkKTtcbiAgICB9XG4gICAgY29uc3QgaXNBY3RpdmUgPSBhY3RpdmVUaHJlYWRzLmluY2x1ZGVzKHRocmVhZC5pZCk7XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFRocmVhZFdyYXBwZXIsIHtcbiAgICAgIGtleTogdGhyZWFkLmlkLFxuICAgICAgVGhyZWFkOiBUaHJlYWQkMSxcbiAgICAgIHRocmVhZCxcbiAgICAgIG9uSXRlbUFkZCxcbiAgICAgIG9uSXRlbVJlbW92ZSxcbiAgICAgIHN0eWxlOiB7XG4gICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZTNkKCR7aXNBY3RpdmUgPyBBQ1RJVkVfVEhSRUFEX09GRlNFVCA6IDB9LCAke3RvcH1weCwgMClgLFxuICAgICAgICBpbnNldElubGluZVN0YXJ0OiAwLFxuICAgICAgICBpbmxpbmVTaXplOiBcIjEwMCVcIixcbiAgICAgICAgcGFkZGluZ0Jsb2NrRW5kOiBHQVBcbiAgICAgIH1cbiAgICB9KTtcbiAgfSkpO1xufVxuZnVuY3Rpb24gVGhyZWFkV3JhcHBlcih7XG4gIG9uSXRlbUFkZCxcbiAgb25JdGVtUmVtb3ZlLFxuICB0aHJlYWQsXG4gIFRocmVhZCxcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufSkge1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3Qgbm9kZXMgPSB1c2VUaHJlYWRUb05vZGVzKCk7XG4gIGNvbnN0IGFjdGl2ZVRocmVhZHMgPSB1c2VBY3RpdmVUaHJlYWRzKCk7XG4gIGNvbnN0IGlzQWN0aXZlID0gYWN0aXZlVGhyZWFkcy5pbmNsdWRlcyh0aHJlYWQuaWQpO1xuICBmdW5jdGlvbiBoYW5kbGVUaHJlYWRDbGljaygpIHtcbiAgICBjb25zdCBrZXlzID0gbm9kZXMuZ2V0KHRocmVhZC5pZCk7XG4gICAgaWYgKGtleXMgPT09IHZvaWQgMCB8fCBrZXlzLnNpemUgPT09IDApXG4gICAgICByZXR1cm47XG4gICAgaWYgKGFjdGl2ZVRocmVhZHMuaW5jbHVkZXModGhyZWFkLmlkKSlcbiAgICAgIHJldHVybjtcbiAgICBlZGl0b3IudXBkYXRlKCgpID0+IHtcbiAgICAgIGNvbnN0IFtrZXldID0ga2V5cztcbiAgICAgIGNvbnN0IG5vZGUgPSAkZ2V0Tm9kZUJ5S2V5KGtleSk7XG4gICAgICBpZiAoISRpc1RocmVhZE1hcmtOb2RlKG5vZGUpKVxuICAgICAgICByZXR1cm47XG4gICAgICBub2RlLnNlbGVjdFN0YXJ0KCk7XG4gICAgfSk7XG4gIH1cbiAgY29uc3QgaGFuZGxlUmVmID0gdXNlQ2FsbGJhY2soXG4gICAgKGVsKSA9PiB7XG4gICAgICBvbkl0ZW1BZGQodGhyZWFkLmlkLCBlbCk7XG4gICAgICByZXR1cm4gKCkgPT4gb25JdGVtUmVtb3ZlKHRocmVhZC5pZCk7XG4gICAgfSxcbiAgICBbdGhyZWFkLmlkLCBvbkl0ZW1BZGQsIG9uSXRlbVJlbW92ZV1cbiAgKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICByZWY6IGhhbmRsZVJlZixcbiAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoXG4gICAgICBcImxiLWxleGljYWwtYW5jaG9yZWQtdGhyZWFkcy10aHJlYWQtY29udGFpbmVyXCIsXG4gICAgICBjbGFzc05hbWVcbiAgICApLFxuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFRocmVhZCwge1xuICAgIHRocmVhZCxcbiAgICBcImRhdGEtc3RhdGVcIjogaXNBY3RpdmUgPyBcImFjdGl2ZVwiIDogXCJpbmFjdGl2ZVwiLFxuICAgIG9uQ2xpY2s6IGhhbmRsZVRocmVhZENsaWNrLFxuICAgIGNsYXNzTmFtZTogXCJsYi1sZXhpY2FsLWFuY2hvcmVkLXRocmVhZHMtdGhyZWFkXCIsXG4gICAgc2hvd0NvbXBvc2VyOiBpc0FjdGl2ZSA/IHRydWUgOiBmYWxzZVxuICB9KSk7XG59XG5mdW5jdGlvbiB1c2VUaHJlYWRUb05vZGVzKCkge1xuICBjb25zdCB0aHJlYWRUb05vZGVzID0gdXNlQ29udGV4dChUaHJlYWRUb05vZGVzQ29udGV4dCk7XG4gIGlmICh0aHJlYWRUb05vZGVzID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJBbmNob3JlZFRocmVhZHMgY29tcG9uZW50IG11c3QgYmUgdXNlZCB3aXRoaW4gYSBMaXZlYmxvY2tzUGx1Z2luIGNvbXBvbmVudC5cIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHRocmVhZFRvTm9kZXM7XG59XG5mdW5jdGlvbiB1c2VBY3RpdmVUaHJlYWRzKCkge1xuICBjb25zdCBhY3RpdmVUaHJlYWRzID0gdXNlQ29udGV4dChBY3RpdmVUaHJlYWRzQ29udGV4dCk7XG4gIGlmIChhY3RpdmVUaHJlYWRzID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJBbmNob3JlZFRocmVhZHMgY29tcG9uZW50IG11c3QgYmUgdXNlZCB3aXRoaW4gTGl2ZWJsb2Nrc1BsdWdpbi5cIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGFjdGl2ZVRocmVhZHM7XG59XG5cbmV4cG9ydCB7IEFuY2hvcmVkVGhyZWFkcywgY29tcGFyZU5vZGVzIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hbmNob3JlZC10aHJlYWRzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/anchored-threads.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/comment-plugin-provider.mjs":
/*!******************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/comment-plugin-provider.mjs ***!
  \******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ActiveThreadsContext: () => (/* binding */ ActiveThreadsContext),\n/* harmony export */   CommentPluginProvider: () => (/* binding */ CommentPluginProvider),\n/* harmony export */   IsActiveThreadContext: () => (/* binding */ IsActiveThreadContext),\n/* harmony export */   OnDeleteThreadCallback: () => (/* binding */ OnDeleteThreadCallback),\n/* harmony export */   ThreadToNodesContext: () => (/* binding */ ThreadToNodesContext),\n/* harmony export */   useIsThreadActive: () => (/* binding */ useIsThreadActive)\n/* harmony export */ });\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var _lexical_utils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @lexical/utils */ \"(ssr)/./node_modules/@lexical/utils/LexicalUtils.dev.mjs\");\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! use-sync-external-store/shim/with-selector.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/with-selector.js\");\n/* harmony import */ var _get_thread_mark_ids_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./get-thread-mark-ids.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/get-thread-mark-ids.mjs\");\n/* harmony import */ var _thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\");\n/* harmony import */ var _unwrap_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./unwrap-thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/unwrap-thread-mark-node.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\nconst OnDeleteThreadCallback = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst ActiveThreadsContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst IsActiveThreadContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst ThreadToNodesContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(\n  null\n);\nfunction CommentPluginProvider({ children }) {\n  const [editor, context] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__.useLexicalComposerContext)();\n  const [threadToNodes, setThreadToNodes] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\n    /* @__PURE__ */ new Map()\n  );\n  const [activeThreads, setActiveThreads] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);\n  const client = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_3__.useClient)();\n  const room = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_3__._useRoom)();\n  const isThreadActive = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (threadId) => {\n      return activeThreads.includes(threadId);\n    },\n    [activeThreads]\n  );\n  const handleThreadDelete = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (threadId) => {\n      editor.update(() => {\n        const keys = threadToNodes.get(threadId);\n        if (keys === void 0)\n          return;\n        for (const key of keys) {\n          const node = (0,lexical__WEBPACK_IMPORTED_MODULE_4__.$getNodeByKey)(key);\n          if (!(0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_5__.$isThreadMarkNode)(node))\n            continue;\n          node.deleteID(threadId);\n          if (node.getIDs().length === 0) {\n            (0,_unwrap_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(node);\n          }\n        }\n      });\n    },\n    [editor, threadToNodes]\n  );\n  (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_3__.useCommentsErrorListener)((error) => {\n    if (error instanceof _liveblocks_react__WEBPACK_IMPORTED_MODULE_3__.CreateThreadError) {\n      handleThreadDelete(error.context.threadId);\n    }\n  });\n  const store = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_7__.kInternal].cacheStore;\n  const threads = (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n      () => (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_3__.selectedThreads)(room.id, store.get(), {}).map((thread) => thread.id),\n      [room.id, store]\n    ),\n    _liveblocks_core__WEBPACK_IMPORTED_MODULE_7__.shallow\n  );\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function getThreadMarkElements() {\n      const activeElements = /* @__PURE__ */ new Set();\n      for (const id of threads) {\n        const keys = threadToNodes.get(id);\n        if (keys === void 0)\n          continue;\n        for (const key of keys) {\n          const element = editor.getElementByKey(key);\n          if (element === null)\n            continue;\n          activeElements.add(element);\n        }\n      }\n      return activeElements;\n    }\n    const elements = getThreadMarkElements();\n    const theme = context.getTheme();\n    const classNames = [\"lb-root\", \"lb-lexical-thread-mark\"];\n    if (theme && theme.liveblocks && \"threadMark\" in theme.liveblocks) {\n      classNames.push(theme.liveblocks.threadMark);\n    }\n    elements.forEach((element) => {\n      (0,_lexical_utils__WEBPACK_IMPORTED_MODULE_8__.addClassNamesToElement)(element, ...classNames);\n    });\n    return () => {\n      elements.forEach((element) => {\n        (0,_lexical_utils__WEBPACK_IMPORTED_MODULE_8__.removeClassNamesFromElement)(element, ...classNames);\n      });\n    };\n  }, [context, editor, threadToNodes, threads]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function onMutation(mutations) {\n      const state = editor.getEditorState();\n      setThreadToNodes((prev) => {\n        const updatedMap = new Map(prev);\n        state.read(() => {\n          for (const [key, mutation] of mutations) {\n            if (mutation === \"destroyed\") {\n              for (const [, nodes] of updatedMap) {\n                nodes.delete(key);\n              }\n            } else if (mutation === \"created\" || mutation === \"updated\") {\n              const node = (0,lexical__WEBPACK_IMPORTED_MODULE_4__.$getNodeByKey)(key);\n              if (!(0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_5__.$isThreadMarkNode)(node))\n                continue;\n              const threadIds = node.getIDs();\n              for (const id of threadIds) {\n                const keys = updatedMap.get(id) ?? /* @__PURE__ */ new Set();\n                keys.add(key);\n                updatedMap.set(id, keys);\n              }\n            }\n          }\n        });\n        return updatedMap;\n      });\n    }\n    return editor.registerMutationListener(_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_5__.ThreadMarkNode, onMutation);\n  }, [editor]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function $getThreadIds(selection) {\n      if (selection === null)\n        return [];\n      if (!(0,lexical__WEBPACK_IMPORTED_MODULE_4__.$isRangeSelection)(selection))\n        return [];\n      const anchor = selection.anchor.getNode();\n      if (!(0,lexical__WEBPACK_IMPORTED_MODULE_4__.$isTextNode)(anchor))\n        return [];\n      return (0,_get_thread_mark_ids_mjs__WEBPACK_IMPORTED_MODULE_9__[\"default\"])(anchor, selection.anchor.offset) ?? [];\n    }\n    function $onStateRead() {\n      const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_4__.$getSelection)();\n      const threadIds = $getThreadIds(selection).filter((id) => {\n        return (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_3__.selectedThreads)(room.id, store.get(), {}).some(\n          (thread) => thread.id === id\n        );\n      });\n      setActiveThreads(threadIds);\n    }\n    const unsubscribeCache = store.subscribe(() => {\n      editor.getEditorState().read($onStateRead);\n    });\n    const unregisterUpdateListener = editor.registerUpdateListener(\n      ({ editorState: state }) => {\n        state.read($onStateRead);\n      }\n    );\n    return () => {\n      unregisterUpdateListener();\n      unsubscribeCache();\n    };\n  }, [editor, client, room.id, store]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function getActiveElements() {\n      const activeElements2 = /* @__PURE__ */ new Set();\n      for (const thread of activeThreads) {\n        const keys = threadToNodes.get(thread);\n        if (keys === void 0)\n          continue;\n        for (const key of keys) {\n          const element = editor.getElementByKey(key);\n          if (element === null)\n            continue;\n          activeElements2.add(element);\n        }\n      }\n      return activeElements2;\n    }\n    const activeElements = getActiveElements();\n    activeElements.forEach((element) => {\n      element.setAttribute(\"data-state\", \"active\");\n    });\n    return () => {\n      activeElements.forEach((element) => {\n        element.removeAttribute(\"data-state\");\n      });\n    };\n  }, [activeThreads, editor, threadToNodes]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    return (0,_lexical_utils__WEBPACK_IMPORTED_MODULE_8__.registerNestedElementResolver)(\n      editor,\n      _thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_5__.ThreadMarkNode,\n      (from) => {\n        return (0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_5__.$createThreadMarkNode)(from.getIDs());\n      },\n      (from, to) => {\n        const ids = from.getIDs();\n        ids.forEach((id) => {\n          to.addID(id);\n        });\n      }\n    );\n  }, [editor]);\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(OnDeleteThreadCallback.Provider, {\n    value: handleThreadDelete\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ActiveThreadsContext.Provider, {\n    value: activeThreads\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(IsActiveThreadContext.Provider, {\n    value: isThreadActive\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ThreadToNodesContext.Provider, {\n    value: threadToNodes\n  }, children))));\n}\nfunction useIsThreadActive(threadId) {\n  const isActive = react__WEBPACK_IMPORTED_MODULE_0__.useContext(IsActiveThreadContext);\n  if (isActive === null) {\n    throw new Error(\n      \"useIsThreadActive must be used within LiveblocksPlugin. For more information: https://liveblocks.io/docs/api-reference/liveblocks-react-lexical#useIsThreadActive\"\n    );\n  }\n  return isActive(threadId);\n}\n\n\n//# sourceMappingURL=comment-plugin-provider.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2NvbW1lbnQtcGx1Z2luLXByb3ZpZGVyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQWtGO0FBQ2tDO0FBQzlEO0FBQytEO0FBQzlCO0FBQ3hEO0FBQ3lDO0FBQ3lCO0FBQ3ZDO0FBQ3dDO0FBQ2hDOztBQUVsRSwrQkFBK0Isb0RBQWE7QUFDNUMsNkJBQTZCLG9EQUFhO0FBQzFDLDhCQUE4QixvREFBYTtBQUMzQyw2QkFBNkIsb0RBQWE7QUFDMUM7QUFDQTtBQUNBLGlDQUFpQyxVQUFVO0FBQzNDLDRCQUE0QixnR0FBeUI7QUFDckQsNENBQTRDLCtDQUFRO0FBQ3BEO0FBQ0E7QUFDQSw0Q0FBNEMsK0NBQVE7QUFDcEQsaUJBQWlCLDREQUFTO0FBQzFCLGVBQWUsMkRBQU87QUFDdEIseUJBQXlCLGtEQUFXO0FBQ3BDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZCQUE2QixrREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0RBQWE7QUFDcEMsZUFBZSx3RUFBaUI7QUFDaEM7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3RUFBcUI7QUFDakM7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBLEVBQUUsMkVBQXdCO0FBQzFCLHlCQUF5QixnRUFBaUI7QUFDMUM7QUFDQTtBQUNBLEdBQUc7QUFDSCx1QkFBdUIsdURBQVM7QUFDaEMsa0JBQWtCLCtHQUFnQztBQUNsRDtBQUNBO0FBQ0E7QUFDQSxJQUFJLGtEQUFXO0FBQ2YsWUFBWSxrRUFBZSx5QkFBeUI7QUFDcEQ7QUFDQTtBQUNBLElBQUkscURBQU87QUFDWDtBQUNBLEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sc0VBQXNCO0FBQzVCLEtBQUs7QUFDTDtBQUNBO0FBQ0EsUUFBUSwyRUFBMkI7QUFDbkMsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZCwyQkFBMkIsc0RBQWE7QUFDeEMsbUJBQW1CLHdFQUFpQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQSwyQ0FBMkMsaUVBQWM7QUFDekQsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXLDBEQUFpQjtBQUM1QjtBQUNBO0FBQ0EsV0FBVyxvREFBVztBQUN0QjtBQUNBLGFBQWEsb0VBQWlCO0FBQzlCO0FBQ0E7QUFDQSx3QkFBd0Isc0RBQWE7QUFDckM7QUFDQSxlQUFlLGtFQUFlLHlCQUF5QjtBQUN2RDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsU0FBUyxvQkFBb0I7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYLFdBQVcsNkVBQTZCO0FBQ3hDO0FBQ0EsTUFBTSxpRUFBYztBQUNwQjtBQUNBLGVBQWUsNEVBQXFCO0FBQ3BDLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsR0FBRztBQUNILHlCQUF5QixnREFBbUI7QUFDNUM7QUFDQSxHQUFHLGtCQUFrQixnREFBbUI7QUFDeEM7QUFDQSxHQUFHLGtCQUFrQixnREFBbUI7QUFDeEM7QUFDQSxHQUFHLGtCQUFrQixnREFBbUI7QUFDeEM7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLG1CQUFtQiw2Q0FBZ0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRStJO0FBQy9JIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2NvbW1lbnQtcGx1Z2luLXByb3ZpZGVyLm1qcz8zNDliIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29tcG9zZXJDb250ZXh0JztcbmltcG9ydCB7IGFkZENsYXNzTmFtZXNUb0VsZW1lbnQsIHJlbW92ZUNsYXNzTmFtZXNGcm9tRWxlbWVudCwgcmVnaXN0ZXJOZXN0ZWRFbGVtZW50UmVzb2x2ZXIgfSBmcm9tICdAbGV4aWNhbC91dGlscyc7XG5pbXBvcnQgeyBrSW50ZXJuYWwsIHNoYWxsb3cgfSBmcm9tICdAbGl2ZWJsb2Nrcy9jb3JlJztcbmltcG9ydCB7IHVzZUNsaWVudCwgdXNlUm9vbSwgdXNlQ29tbWVudHNFcnJvckxpc3RlbmVyLCBDcmVhdGVUaHJlYWRFcnJvciwgc2VsZWN0ZWRUaHJlYWRzIH0gZnJvbSAnQGxpdmVibG9ja3MvcmVhY3QnO1xuaW1wb3J0IHsgJGdldE5vZGVCeUtleSwgJGlzUmFuZ2VTZWxlY3Rpb24sICRpc1RleHROb2RlLCAkZ2V0U2VsZWN0aW9uIH0gZnJvbSAnbGV4aWNhbCc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBjcmVhdGVDb250ZXh0LCB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yIH0gZnJvbSAndXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS93aXRoLXNlbGVjdG9yLmpzJztcbmltcG9ydCAkZ2V0VGhyZWFkTWFya0lkcyBmcm9tICcuL2dldC10aHJlYWQtbWFyay1pZHMubWpzJztcbmltcG9ydCB7ICRpc1RocmVhZE1hcmtOb2RlLCBUaHJlYWRNYXJrTm9kZSwgJGNyZWF0ZVRocmVhZE1hcmtOb2RlIH0gZnJvbSAnLi90aHJlYWQtbWFyay1ub2RlLm1qcyc7XG5pbXBvcnQgJHVud3JhcFRocmVhZE1hcmtOb2RlIGZyb20gJy4vdW53cmFwLXRocmVhZC1tYXJrLW5vZGUubWpzJztcblxuY29uc3QgT25EZWxldGVUaHJlYWRDYWxsYmFjayA9IGNyZWF0ZUNvbnRleHQobnVsbCk7XG5jb25zdCBBY3RpdmVUaHJlYWRzQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQobnVsbCk7XG5jb25zdCBJc0FjdGl2ZVRocmVhZENvbnRleHQgPSBjcmVhdGVDb250ZXh0KG51bGwpO1xuY29uc3QgVGhyZWFkVG9Ob2Rlc0NvbnRleHQgPSBjcmVhdGVDb250ZXh0KFxuICBudWxsXG4pO1xuZnVuY3Rpb24gQ29tbWVudFBsdWdpblByb3ZpZGVyKHsgY2hpbGRyZW4gfSkge1xuICBjb25zdCBbZWRpdG9yLCBjb250ZXh0XSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3QgW3RocmVhZFRvTm9kZXMsIHNldFRocmVhZFRvTm9kZXNdID0gdXNlU3RhdGUoXG4gICAgLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKVxuICApO1xuICBjb25zdCBbYWN0aXZlVGhyZWFkcywgc2V0QWN0aXZlVGhyZWFkc10gPSB1c2VTdGF0ZShbXSk7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBpc1RocmVhZEFjdGl2ZSA9IHVzZUNhbGxiYWNrKFxuICAgICh0aHJlYWRJZCkgPT4ge1xuICAgICAgcmV0dXJuIGFjdGl2ZVRocmVhZHMuaW5jbHVkZXModGhyZWFkSWQpO1xuICAgIH0sXG4gICAgW2FjdGl2ZVRocmVhZHNdXG4gICk7XG4gIGNvbnN0IGhhbmRsZVRocmVhZERlbGV0ZSA9IHVzZUNhbGxiYWNrKFxuICAgICh0aHJlYWRJZCkgPT4ge1xuICAgICAgZWRpdG9yLnVwZGF0ZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGtleXMgPSB0aHJlYWRUb05vZGVzLmdldCh0aHJlYWRJZCk7XG4gICAgICAgIGlmIChrZXlzID09PSB2b2lkIDApXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgICAgY29uc3Qgbm9kZSA9ICRnZXROb2RlQnlLZXkoa2V5KTtcbiAgICAgICAgICBpZiAoISRpc1RocmVhZE1hcmtOb2RlKG5vZGUpKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgbm9kZS5kZWxldGVJRCh0aHJlYWRJZCk7XG4gICAgICAgICAgaWYgKG5vZGUuZ2V0SURzKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAkdW53cmFwVGhyZWFkTWFya05vZGUobm9kZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFtlZGl0b3IsIHRocmVhZFRvTm9kZXNdXG4gICk7XG4gIHVzZUNvbW1lbnRzRXJyb3JMaXN0ZW5lcigoZXJyb3IpID0+IHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBDcmVhdGVUaHJlYWRFcnJvcikge1xuICAgICAgaGFuZGxlVGhyZWFkRGVsZXRlKGVycm9yLmNvbnRleHQudGhyZWFkSWQpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHN0b3JlID0gY2xpZW50W2tJbnRlcm5hbF0uY2FjaGVTdG9yZTtcbiAgY29uc3QgdGhyZWFkcyA9IHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yKFxuICAgIHN0b3JlLnN1YnNjcmliZSxcbiAgICBzdG9yZS5nZXQsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHVzZUNhbGxiYWNrKFxuICAgICAgKCkgPT4gc2VsZWN0ZWRUaHJlYWRzKHJvb20uaWQsIHN0b3JlLmdldCgpLCB7fSkubWFwKCh0aHJlYWQpID0+IHRocmVhZC5pZCksXG4gICAgICBbcm9vbS5pZCwgc3RvcmVdXG4gICAgKSxcbiAgICBzaGFsbG93XG4gICk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZnVuY3Rpb24gZ2V0VGhyZWFkTWFya0VsZW1lbnRzKCkge1xuICAgICAgY29uc3QgYWN0aXZlRWxlbWVudHMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICAgICAgZm9yIChjb25zdCBpZCBvZiB0aHJlYWRzKSB7XG4gICAgICAgIGNvbnN0IGtleXMgPSB0aHJlYWRUb05vZGVzLmdldChpZCk7XG4gICAgICAgIGlmIChrZXlzID09PSB2b2lkIDApXG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZWRpdG9yLmdldEVsZW1lbnRCeUtleShrZXkpO1xuICAgICAgICAgIGlmIChlbGVtZW50ID09PSBudWxsKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgYWN0aXZlRWxlbWVudHMuYWRkKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYWN0aXZlRWxlbWVudHM7XG4gICAgfVxuICAgIGNvbnN0IGVsZW1lbnRzID0gZ2V0VGhyZWFkTWFya0VsZW1lbnRzKCk7XG4gICAgY29uc3QgdGhlbWUgPSBjb250ZXh0LmdldFRoZW1lKCk7XG4gICAgY29uc3QgY2xhc3NOYW1lcyA9IFtcImxiLXJvb3RcIiwgXCJsYi1sZXhpY2FsLXRocmVhZC1tYXJrXCJdO1xuICAgIGlmICh0aGVtZSAmJiB0aGVtZS5saXZlYmxvY2tzICYmIFwidGhyZWFkTWFya1wiIGluIHRoZW1lLmxpdmVibG9ja3MpIHtcbiAgICAgIGNsYXNzTmFtZXMucHVzaCh0aGVtZS5saXZlYmxvY2tzLnRocmVhZE1hcmspO1xuICAgIH1cbiAgICBlbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBhZGRDbGFzc05hbWVzVG9FbGVtZW50KGVsZW1lbnQsIC4uLmNsYXNzTmFtZXMpO1xuICAgIH0pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBlbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgIHJlbW92ZUNsYXNzTmFtZXNGcm9tRWxlbWVudChlbGVtZW50LCAuLi5jbGFzc05hbWVzKTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0sIFtjb250ZXh0LCBlZGl0b3IsIHRocmVhZFRvTm9kZXMsIHRocmVhZHNdKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBmdW5jdGlvbiBvbk11dGF0aW9uKG11dGF0aW9ucykge1xuICAgICAgY29uc3Qgc3RhdGUgPSBlZGl0b3IuZ2V0RWRpdG9yU3RhdGUoKTtcbiAgICAgIHNldFRocmVhZFRvTm9kZXMoKHByZXYpID0+IHtcbiAgICAgICAgY29uc3QgdXBkYXRlZE1hcCA9IG5ldyBNYXAocHJldik7XG4gICAgICAgIHN0YXRlLnJlYWQoKCkgPT4ge1xuICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgbXV0YXRpb25dIG9mIG11dGF0aW9ucykge1xuICAgICAgICAgICAgaWYgKG11dGF0aW9uID09PSBcImRlc3Ryb3llZFwiKSB7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgWywgbm9kZXNdIG9mIHVwZGF0ZWRNYXApIHtcbiAgICAgICAgICAgICAgICBub2Rlcy5kZWxldGUoa2V5KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChtdXRhdGlvbiA9PT0gXCJjcmVhdGVkXCIgfHwgbXV0YXRpb24gPT09IFwidXBkYXRlZFwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSAkZ2V0Tm9kZUJ5S2V5KGtleSk7XG4gICAgICAgICAgICAgIGlmICghJGlzVGhyZWFkTWFya05vZGUobm9kZSkpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgIGNvbnN0IHRocmVhZElkcyA9IG5vZGUuZ2V0SURzKCk7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgaWQgb2YgdGhyZWFkSWRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5cyA9IHVwZGF0ZWRNYXAuZ2V0KGlkKSA/PyAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICAgICAgICAgICAgICAgIGtleXMuYWRkKGtleSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlZE1hcC5zZXQoaWQsIGtleXMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHVwZGF0ZWRNYXA7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGVkaXRvci5yZWdpc3Rlck11dGF0aW9uTGlzdGVuZXIoVGhyZWFkTWFya05vZGUsIG9uTXV0YXRpb24pO1xuICB9LCBbZWRpdG9yXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZnVuY3Rpb24gJGdldFRocmVhZElkcyhzZWxlY3Rpb24pIHtcbiAgICAgIGlmIChzZWxlY3Rpb24gPT09IG51bGwpXG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIGlmICghJGlzUmFuZ2VTZWxlY3Rpb24oc2VsZWN0aW9uKSlcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgY29uc3QgYW5jaG9yID0gc2VsZWN0aW9uLmFuY2hvci5nZXROb2RlKCk7XG4gICAgICBpZiAoISRpc1RleHROb2RlKGFuY2hvcikpXG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIHJldHVybiAkZ2V0VGhyZWFkTWFya0lkcyhhbmNob3IsIHNlbGVjdGlvbi5hbmNob3Iub2Zmc2V0KSA/PyBbXTtcbiAgICB9XG4gICAgZnVuY3Rpb24gJG9uU3RhdGVSZWFkKCkge1xuICAgICAgY29uc3Qgc2VsZWN0aW9uID0gJGdldFNlbGVjdGlvbigpO1xuICAgICAgY29uc3QgdGhyZWFkSWRzID0gJGdldFRocmVhZElkcyhzZWxlY3Rpb24pLmZpbHRlcigoaWQpID0+IHtcbiAgICAgICAgcmV0dXJuIHNlbGVjdGVkVGhyZWFkcyhyb29tLmlkLCBzdG9yZS5nZXQoKSwge30pLnNvbWUoXG4gICAgICAgICAgKHRocmVhZCkgPT4gdGhyZWFkLmlkID09PSBpZFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICBzZXRBY3RpdmVUaHJlYWRzKHRocmVhZElkcyk7XG4gICAgfVxuICAgIGNvbnN0IHVuc3Vic2NyaWJlQ2FjaGUgPSBzdG9yZS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgZWRpdG9yLmdldEVkaXRvclN0YXRlKCkucmVhZCgkb25TdGF0ZVJlYWQpO1xuICAgIH0pO1xuICAgIGNvbnN0IHVucmVnaXN0ZXJVcGRhdGVMaXN0ZW5lciA9IGVkaXRvci5yZWdpc3RlclVwZGF0ZUxpc3RlbmVyKFxuICAgICAgKHsgZWRpdG9yU3RhdGU6IHN0YXRlIH0pID0+IHtcbiAgICAgICAgc3RhdGUucmVhZCgkb25TdGF0ZVJlYWQpO1xuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHVucmVnaXN0ZXJVcGRhdGVMaXN0ZW5lcigpO1xuICAgICAgdW5zdWJzY3JpYmVDYWNoZSgpO1xuICAgIH07XG4gIH0sIFtlZGl0b3IsIGNsaWVudCwgcm9vbS5pZCwgc3RvcmVdKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBmdW5jdGlvbiBnZXRBY3RpdmVFbGVtZW50cygpIHtcbiAgICAgIGNvbnN0IGFjdGl2ZUVsZW1lbnRzMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgICBmb3IgKGNvbnN0IHRocmVhZCBvZiBhY3RpdmVUaHJlYWRzKSB7XG4gICAgICAgIGNvbnN0IGtleXMgPSB0aHJlYWRUb05vZGVzLmdldCh0aHJlYWQpO1xuICAgICAgICBpZiAoa2V5cyA9PT0gdm9pZCAwKVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgICAgY29uc3QgZWxlbWVudCA9IGVkaXRvci5nZXRFbGVtZW50QnlLZXkoa2V5KTtcbiAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gbnVsbClcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGFjdGl2ZUVsZW1lbnRzMi5hZGQoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBhY3RpdmVFbGVtZW50czI7XG4gICAgfVxuICAgIGNvbnN0IGFjdGl2ZUVsZW1lbnRzID0gZ2V0QWN0aXZlRWxlbWVudHMoKTtcbiAgICBhY3RpdmVFbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtc3RhdGVcIiwgXCJhY3RpdmVcIik7XG4gICAgfSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGFjdGl2ZUVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJkYXRhLXN0YXRlXCIpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSwgW2FjdGl2ZVRocmVhZHMsIGVkaXRvciwgdGhyZWFkVG9Ob2Rlc10pO1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiByZWdpc3Rlck5lc3RlZEVsZW1lbnRSZXNvbHZlcihcbiAgICAgIGVkaXRvcixcbiAgICAgIFRocmVhZE1hcmtOb2RlLFxuICAgICAgKGZyb20pID0+IHtcbiAgICAgICAgcmV0dXJuICRjcmVhdGVUaHJlYWRNYXJrTm9kZShmcm9tLmdldElEcygpKTtcbiAgICAgIH0sXG4gICAgICAoZnJvbSwgdG8pID0+IHtcbiAgICAgICAgY29uc3QgaWRzID0gZnJvbS5nZXRJRHMoKTtcbiAgICAgICAgaWRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgICAgdG8uYWRkSUQoaWQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICApO1xuICB9LCBbZWRpdG9yXSk7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3QuY3JlYXRlRWxlbWVudChPbkRlbGV0ZVRocmVhZENhbGxiYWNrLlByb3ZpZGVyLCB7XG4gICAgdmFsdWU6IGhhbmRsZVRocmVhZERlbGV0ZVxuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3QuY3JlYXRlRWxlbWVudChBY3RpdmVUaHJlYWRzQ29udGV4dC5Qcm92aWRlciwge1xuICAgIHZhbHVlOiBhY3RpdmVUaHJlYWRzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdC5jcmVhdGVFbGVtZW50KElzQWN0aXZlVGhyZWFkQ29udGV4dC5Qcm92aWRlciwge1xuICAgIHZhbHVlOiBpc1RocmVhZEFjdGl2ZVxuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3QuY3JlYXRlRWxlbWVudChUaHJlYWRUb05vZGVzQ29udGV4dC5Qcm92aWRlciwge1xuICAgIHZhbHVlOiB0aHJlYWRUb05vZGVzXG4gIH0sIGNoaWxkcmVuKSkpKTtcbn1cbmZ1bmN0aW9uIHVzZUlzVGhyZWFkQWN0aXZlKHRocmVhZElkKSB7XG4gIGNvbnN0IGlzQWN0aXZlID0gUmVhY3QudXNlQ29udGV4dChJc0FjdGl2ZVRocmVhZENvbnRleHQpO1xuICBpZiAoaXNBY3RpdmUgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcInVzZUlzVGhyZWFkQWN0aXZlIG11c3QgYmUgdXNlZCB3aXRoaW4gTGl2ZWJsb2Nrc1BsdWdpbi4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1yZWFjdC1sZXhpY2FsI3VzZUlzVGhyZWFkQWN0aXZlXCJcbiAgICApO1xuICB9XG4gIHJldHVybiBpc0FjdGl2ZSh0aHJlYWRJZCk7XG59XG5cbmV4cG9ydCB7IEFjdGl2ZVRocmVhZHNDb250ZXh0LCBDb21tZW50UGx1Z2luUHJvdmlkZXIsIElzQWN0aXZlVGhyZWFkQ29udGV4dCwgT25EZWxldGVUaHJlYWRDYWxsYmFjaywgVGhyZWFkVG9Ob2Rlc0NvbnRleHQsIHVzZUlzVGhyZWFkQWN0aXZlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tZW50LXBsdWdpbi1wcm92aWRlci5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/comment-plugin-provider.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/floating-composer.mjs":
/*!************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/floating-composer.mjs ***!
  \************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FLOATING_COMPOSER_COLLISION_PADDING: () => (/* binding */ FLOATING_COMPOSER_COLLISION_PADDING),\n/* harmony export */   FloatingComposer: () => (/* binding */ FloatingComposer),\n/* harmony export */   OPEN_FLOATING_COMPOSER_COMMAND: () => (/* binding */ OPEN_FLOATING_COMPOSER_COMMAND)\n/* harmony export */ });\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs\");\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @liveblocks/react-ui */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Composer.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-dom.js\");\n/* harmony import */ var _create_dom_range_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../create-dom-range.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/create-dom-range.mjs\");\n/* harmony import */ var _create_rects_from_dom_range_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../create-rects-from-dom-range.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/create-rects-from-dom-range.mjs\");\n/* harmony import */ var _wrap_selection_in_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./wrap-selection-in-thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/wrap-selection-in-thread-mark-node.mjs\");\n\n\n\n\n\n\n\n\n\n\n\nconst OPEN_FLOATING_COMPOSER_COMMAND = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.createCommand)(\"OPEN_FLOATING_COMPOSER_COMMAND\");\nconst FloatingComposer = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(function FloatingComposer2(props, forwardedRef) {\n  const [range, setRange] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_3__.useLexicalComposerContext)();\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    return editor.registerCommand(\n      OPEN_FLOATING_COMPOSER_COMMAND,\n      () => {\n        const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n        if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection))\n          return false;\n        if (selection.isCollapsed())\n          return false;\n        const { anchor, focus } = selection;\n        const range2 = (0,_create_dom_range_mjs__WEBPACK_IMPORTED_MODULE_4__.createDOMRange)(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        setRange(range2);\n        return true;\n      },\n      lexical__WEBPACK_IMPORTED_MODULE_2__.COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n  if (range === null)\n    return null;\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(FloatingComposerImpl, {\n    ref: forwardedRef,\n    ...props,\n    range,\n    onRangeChange: setRange\n  });\n});\nconst FloatingComposerImpl = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(function FloatingComposer3(props, forwardedRef) {\n  const {\n    range,\n    onRangeChange,\n    onKeyDown,\n    onComposerSubmit,\n    ...composerProps\n  } = props;\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_3__.useLexicalComposerContext)();\n  const createThread = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_5__._useCreateThread)();\n  const $onStateRead = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n    if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection) || selection.isCollapsed()) {\n      return null;\n    }\n    const { anchor, focus } = selection;\n    const range2 = (0,_create_dom_range_mjs__WEBPACK_IMPORTED_MODULE_4__.createDOMRange)(\n      editor,\n      anchor.getNode(),\n      anchor.offset,\n      focus.getNode(),\n      focus.offset\n    );\n    return range2;\n  }, [editor]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    return editor.registerUpdateListener(({ editorState: state, tags }) => {\n      if (!tags.has(\"collaboration\")) {\n        onRangeChange(null);\n        return;\n      }\n      const range2 = state.read(() => $onStateRead());\n      onRangeChange(range2);\n    });\n  }, [editor, range, onRangeChange, $onStateRead]);\n  const onThreadCreate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (threadId) => {\n      editor.update(() => {\n        const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n        if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection))\n          return;\n        if (selection.isCollapsed())\n          return;\n        const isBackward = selection.isBackward();\n        (0,_wrap_selection_in_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(selection, isBackward, threadId);\n        (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$setSelection)(null);\n      });\n    },\n    [editor]\n  );\n  const handleComposerSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (comment, event) => {\n      onComposerSubmit?.(comment, event);\n      if (event.defaultPrevented)\n        return;\n      event.preventDefault();\n      const thread = createThread({\n        body: comment.body,\n        metadata: props.metadata ?? {}\n      });\n      onThreadCreate(thread.id);\n    },\n    [onThreadCreate, onComposerSubmit, props.metadata, createThread]\n  );\n  function handleKeyDown(event) {\n    if (event.key === \"Escape\") {\n      onRangeChange(null);\n      editor.focus();\n    }\n    onKeyDown?.(event);\n  }\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ActiveSelectionPortal, {\n    range,\n    container: document.body\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(FloatingComposerPortal, {\n    range,\n    container: document.body\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_7__.Composer, {\n    autoFocus: true,\n    ...composerProps,\n    onKeyDown: handleKeyDown,\n    onComposerSubmit: handleComposerSubmit,\n    ref: forwardedRef\n  })));\n});\nfunction ActiveSelectionPortal({\n  range,\n  container\n}) {\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y\n  } = (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.useFloating)({\n    strategy: \"fixed\",\n    placement: \"bottom\",\n    middleware: [(0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.offset)(-range.getBoundingClientRect().height)],\n    whileElementsMounted: (...args) => {\n      return (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_9__.autoUpdate)(...args, {\n        animationFrame: true\n      });\n    }\n  });\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {\n    setReference({\n      getBoundingClientRect: () => range.getBoundingClientRect()\n    });\n  }, [setReference, range]);\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_3__.useLexicalComposerContext)();\n  const rects = (0,_create_rects_from_dom_range_mjs__WEBPACK_IMPORTED_MODULE_10__.createRectsFromDOMRange)(editor, range);\n  return (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(\n    /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n      ref: setFloating,\n      style: {\n        position: strategy,\n        top: 0,\n        left: 0,\n        transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n        minWidth: \"max-content\",\n        width: range.getBoundingClientRect().width,\n        height: range.getBoundingClientRect().height,\n        pointerEvents: \"none\"\n      },\n      className: \"lb-root lb-portal\"\n    }, rects.map((rect) => /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n      key: JSON.stringify(rect),\n      style: {\n        position: \"absolute\",\n        top: rect.top - range.getBoundingClientRect().top,\n        left: rect.left - range.getBoundingClientRect().left,\n        width: rect.width,\n        height: rect.height,\n        backgroundColor: \"var(--lb-selection, rgba(0, 0, 255, 0.2))\",\n        pointerEvents: \"none\"\n      },\n      className: \"lb-lexical-active-selection\"\n    })))),\n    container\n  );\n}\nconst FLOATING_COMPOSER_COLLISION_PADDING = 10;\nfunction FloatingComposerPortal({\n  container,\n  range,\n  children\n}) {\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y\n  } = (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.useFloating)({\n    strategy: \"fixed\",\n    placement: \"bottom\",\n    middleware: [\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.flip)({ padding: FLOATING_COMPOSER_COLLISION_PADDING, crossAxis: false }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.offset)(10),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.hide)({ padding: FLOATING_COMPOSER_COLLISION_PADDING }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.shift)({\n        padding: FLOATING_COMPOSER_COLLISION_PADDING,\n        limiter: (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.limitShift)()\n      }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.size)({ padding: FLOATING_COMPOSER_COLLISION_PADDING })\n    ],\n    whileElementsMounted: (...args) => {\n      return (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_9__.autoUpdate)(...args, {\n        animationFrame: true\n      });\n    }\n  });\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {\n    setReference({\n      getBoundingClientRect: () => range.getBoundingClientRect()\n    });\n  }, [range, setReference]);\n  return (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(\n    /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n      ref: setFloating,\n      style: {\n        position: strategy,\n        top: 0,\n        left: 0,\n        transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n        minWidth: \"max-content\"\n      },\n      className: \"lb-root lb-portal lb-elevation lb-lexical-floating lb-lexical-floating-composer\"\n    }, children),\n    container\n  );\n}\n\n\n//# sourceMappingURL=floating-composer.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2Zsb2F0aW5nLWNvbXBvc2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUE4RztBQUM1QjtBQUM5QjtBQUNKO0FBQ2tFO0FBQ1o7QUFDN0Q7QUFDZ0I7QUFDb0I7QUFDUzs7QUFFdEYsdUNBQXVDLHNEQUFhO0FBQ3BELHlCQUF5QixpREFBVTtBQUNuQyw0QkFBNEIsK0NBQVE7QUFDcEMsbUJBQW1CLGdHQUF5QjtBQUM1QyxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHNEQUFhO0FBQ3ZDLGFBQWEsMERBQWlCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixnQkFBZ0I7QUFDaEMsdUJBQXVCLHFFQUFjO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTSw0REFBdUI7QUFDN0I7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLHlCQUF5QixnREFBNEI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQ0FBQztBQUNELDZCQUE2QixpREFBVTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osbUJBQW1CLGdHQUF5QjtBQUM1Qyx1QkFBdUIsbUVBQWU7QUFDdEMsdUJBQXVCLGtEQUFXO0FBQ2xDLHNCQUFzQixzREFBYTtBQUNuQyxTQUFTLDBEQUFpQjtBQUMxQjtBQUNBO0FBQ0EsWUFBWSxnQkFBZ0I7QUFDNUIsbUJBQW1CLHFFQUFjO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWCw0Q0FBNEMsMEJBQTBCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0gseUJBQXlCLGtEQUFXO0FBQ3BDO0FBQ0E7QUFDQSwwQkFBMEIsc0RBQWE7QUFDdkMsYUFBYSwwREFBaUI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLG1GQUE4QjtBQUN0QyxRQUFRLHNEQUFhO0FBQ3JCLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBLCtCQUErQixrREFBVztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywyQ0FBdUIsd0JBQXdCLGdEQUE0QjtBQUNqSTtBQUNBO0FBQ0EsR0FBRyxtQkFBbUIsZ0RBQTRCO0FBQ2xEO0FBQ0E7QUFDQSxHQUFHLGtCQUFrQixnREFBNEIsQ0FBQywwREFBUTtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxZQUFZLDJCQUEyQjtBQUN2QztBQUNBO0FBQ0E7QUFDQSxJQUFJLEVBQUUsbUVBQVc7QUFDakI7QUFDQTtBQUNBLGlCQUFpQiw4REFBTTtBQUN2QjtBQUNBLGFBQWEsa0VBQVU7QUFDdkI7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0gsRUFBRSxzREFBZTtBQUNqQjtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSCxtQkFBbUIsZ0dBQXlCO0FBQzVDLGdCQUFnQiwwRkFBdUI7QUFDdkMsU0FBUyx1REFBWTtBQUNyQixvQkFBb0IsZ0RBQTRCLENBQUMsMkNBQXVCLHdCQUF3QixnREFBNEI7QUFDNUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxjQUFjLE1BQU0sY0FBYztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUssc0NBQXNDLGdEQUE0QjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLFlBQVksMkJBQTJCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLElBQUksRUFBRSxtRUFBVztBQUNqQjtBQUNBO0FBQ0E7QUFDQSxNQUFNLDREQUFJLEdBQUcsZ0VBQWdFO0FBQzdFLE1BQU0sOERBQU07QUFDWixNQUFNLDREQUFJLEdBQUcsOENBQThDO0FBQzNELE1BQU0sNkRBQUs7QUFDWDtBQUNBLGlCQUFpQixrRUFBVTtBQUMzQixPQUFPO0FBQ1AsTUFBTSw0REFBSSxHQUFHLDhDQUE4QztBQUMzRDtBQUNBO0FBQ0EsYUFBYSxrRUFBVTtBQUN2QjtBQUNBLE9BQU87QUFDUDtBQUNBLEdBQUc7QUFDSCxFQUFFLHNEQUFlO0FBQ2pCO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILFNBQVMsdURBQVk7QUFDckIsb0JBQW9CLGdEQUE0QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGNBQWMsTUFBTSxjQUFjO0FBQ3BFO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFaUc7QUFDakciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC1sZXhpY2FsL2Rpc3QvY29tbWVudHMvZmxvYXRpbmctY29tcG9zZXIubWpzPzVmODQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlRmxvYXRpbmcsIG9mZnNldCwgYXV0b1VwZGF0ZSwgZmxpcCwgaGlkZSwgc2hpZnQsIGxpbWl0U2hpZnQsIHNpemUgfSBmcm9tICdAZmxvYXRpbmctdWkvcmVhY3QtZG9tJztcbmltcG9ydCB7IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29tcG9zZXJDb250ZXh0JztcbmltcG9ydCB7IHVzZUNyZWF0ZVRocmVhZCB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0JztcbmltcG9ydCB7IENvbXBvc2VyIH0gZnJvbSAnQGxpdmVibG9ja3MvcmVhY3QtdWknO1xuaW1wb3J0IHsgY3JlYXRlQ29tbWFuZCwgJGdldFNlbGVjdGlvbiwgJGlzUmFuZ2VTZWxlY3Rpb24sIENPTU1BTkRfUFJJT1JJVFlfRURJVE9SLCAkc2V0U2VsZWN0aW9uIH0gZnJvbSAnbGV4aWNhbCc7XG5pbXBvcnQgUmVhY3RfX2RlZmF1bHQsIHsgZm9yd2FyZFJlZiwgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2ssIHVzZUxheW91dEVmZmVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGNyZWF0ZVBvcnRhbCB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgeyBjcmVhdGVET01SYW5nZSB9IGZyb20gJy4uL2NyZWF0ZS1kb20tcmFuZ2UubWpzJztcbmltcG9ydCB7IGNyZWF0ZVJlY3RzRnJvbURPTVJhbmdlIH0gZnJvbSAnLi4vY3JlYXRlLXJlY3RzLWZyb20tZG9tLXJhbmdlLm1qcyc7XG5pbXBvcnQgJHdyYXBTZWxlY3Rpb25JblRocmVhZE1hcmtOb2RlIGZyb20gJy4vd3JhcC1zZWxlY3Rpb24taW4tdGhyZWFkLW1hcmstbm9kZS5tanMnO1xuXG5jb25zdCBPUEVOX0ZMT0FUSU5HX0NPTVBPU0VSX0NPTU1BTkQgPSBjcmVhdGVDb21tYW5kKFwiT1BFTl9GTE9BVElOR19DT01QT1NFUl9DT01NQU5EXCIpO1xuY29uc3QgRmxvYXRpbmdDb21wb3NlciA9IGZvcndhcmRSZWYoZnVuY3Rpb24gRmxvYXRpbmdDb21wb3NlcjIocHJvcHMsIGZvcndhcmRlZFJlZikge1xuICBjb25zdCBbcmFuZ2UsIHNldFJhbmdlXSA9IHVzZVN0YXRlKG51bGwpO1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICByZXR1cm4gZWRpdG9yLnJlZ2lzdGVyQ29tbWFuZChcbiAgICAgIE9QRU5fRkxPQVRJTkdfQ09NUE9TRVJfQ09NTUFORCxcbiAgICAgICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gJGdldFNlbGVjdGlvbigpO1xuICAgICAgICBpZiAoISRpc1JhbmdlU2VsZWN0aW9uKHNlbGVjdGlvbikpXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCB7IGFuY2hvciwgZm9jdXMgfSA9IHNlbGVjdGlvbjtcbiAgICAgICAgY29uc3QgcmFuZ2UyID0gY3JlYXRlRE9NUmFuZ2UoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIGFuY2hvci5nZXROb2RlKCksXG4gICAgICAgICAgYW5jaG9yLm9mZnNldCxcbiAgICAgICAgICBmb2N1cy5nZXROb2RlKCksXG4gICAgICAgICAgZm9jdXMub2Zmc2V0XG4gICAgICAgICk7XG4gICAgICAgIHNldFJhbmdlKHJhbmdlMik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICAgIENPTU1BTkRfUFJJT1JJVFlfRURJVE9SXG4gICAgKTtcbiAgfSwgW2VkaXRvcl0pO1xuICBpZiAocmFuZ2UgPT09IG51bGwpXG4gICAgcmV0dXJuIG51bGw7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChGbG9hdGluZ0NvbXBvc2VySW1wbCwge1xuICAgIHJlZjogZm9yd2FyZGVkUmVmLFxuICAgIC4uLnByb3BzLFxuICAgIHJhbmdlLFxuICAgIG9uUmFuZ2VDaGFuZ2U6IHNldFJhbmdlXG4gIH0pO1xufSk7XG5jb25zdCBGbG9hdGluZ0NvbXBvc2VySW1wbCA9IGZvcndhcmRSZWYoZnVuY3Rpb24gRmxvYXRpbmdDb21wb3NlcjMocHJvcHMsIGZvcndhcmRlZFJlZikge1xuICBjb25zdCB7XG4gICAgcmFuZ2UsXG4gICAgb25SYW5nZUNoYW5nZSxcbiAgICBvbktleURvd24sXG4gICAgb25Db21wb3NlclN1Ym1pdCxcbiAgICAuLi5jb21wb3NlclByb3BzXG4gIH0gPSBwcm9wcztcbiAgY29uc3QgW2VkaXRvcl0gPSB1c2VMZXhpY2FsQ29tcG9zZXJDb250ZXh0KCk7XG4gIGNvbnN0IGNyZWF0ZVRocmVhZCA9IHVzZUNyZWF0ZVRocmVhZCgpO1xuICBjb25zdCAkb25TdGF0ZVJlYWQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gJGdldFNlbGVjdGlvbigpO1xuICAgIGlmICghJGlzUmFuZ2VTZWxlY3Rpb24oc2VsZWN0aW9uKSB8fCBzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgYW5jaG9yLCBmb2N1cyB9ID0gc2VsZWN0aW9uO1xuICAgIGNvbnN0IHJhbmdlMiA9IGNyZWF0ZURPTVJhbmdlKFxuICAgICAgZWRpdG9yLFxuICAgICAgYW5jaG9yLmdldE5vZGUoKSxcbiAgICAgIGFuY2hvci5vZmZzZXQsXG4gICAgICBmb2N1cy5nZXROb2RlKCksXG4gICAgICBmb2N1cy5vZmZzZXRcbiAgICApO1xuICAgIHJldHVybiByYW5nZTI7XG4gIH0sIFtlZGl0b3JdKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICByZXR1cm4gZWRpdG9yLnJlZ2lzdGVyVXBkYXRlTGlzdGVuZXIoKHsgZWRpdG9yU3RhdGU6IHN0YXRlLCB0YWdzIH0pID0+IHtcbiAgICAgIGlmICghdGFncy5oYXMoXCJjb2xsYWJvcmF0aW9uXCIpKSB7XG4gICAgICAgIG9uUmFuZ2VDaGFuZ2UobnVsbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJhbmdlMiA9IHN0YXRlLnJlYWQoKCkgPT4gJG9uU3RhdGVSZWFkKCkpO1xuICAgICAgb25SYW5nZUNoYW5nZShyYW5nZTIpO1xuICAgIH0pO1xuICB9LCBbZWRpdG9yLCByYW5nZSwgb25SYW5nZUNoYW5nZSwgJG9uU3RhdGVSZWFkXSk7XG4gIGNvbnN0IG9uVGhyZWFkQ3JlYXRlID0gdXNlQ2FsbGJhY2soXG4gICAgKHRocmVhZElkKSA9PiB7XG4gICAgICBlZGl0b3IudXBkYXRlKCgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gJGdldFNlbGVjdGlvbigpO1xuICAgICAgICBpZiAoISRpc1JhbmdlU2VsZWN0aW9uKHNlbGVjdGlvbikpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBpc0JhY2t3YXJkID0gc2VsZWN0aW9uLmlzQmFja3dhcmQoKTtcbiAgICAgICAgJHdyYXBTZWxlY3Rpb25JblRocmVhZE1hcmtOb2RlKHNlbGVjdGlvbiwgaXNCYWNrd2FyZCwgdGhyZWFkSWQpO1xuICAgICAgICAkc2V0U2VsZWN0aW9uKG51bGwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBbZWRpdG9yXVxuICApO1xuICBjb25zdCBoYW5kbGVDb21wb3NlclN1Ym1pdCA9IHVzZUNhbGxiYWNrKFxuICAgIChjb21tZW50LCBldmVudCkgPT4ge1xuICAgICAgb25Db21wb3NlclN1Ym1pdD8uKGNvbW1lbnQsIGV2ZW50KTtcbiAgICAgIGlmIChldmVudC5kZWZhdWx0UHJldmVudGVkKVxuICAgICAgICByZXR1cm47XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgdGhyZWFkID0gY3JlYXRlVGhyZWFkKHtcbiAgICAgICAgYm9keTogY29tbWVudC5ib2R5LFxuICAgICAgICBtZXRhZGF0YTogcHJvcHMubWV0YWRhdGEgPz8ge31cbiAgICAgIH0pO1xuICAgICAgb25UaHJlYWRDcmVhdGUodGhyZWFkLmlkKTtcbiAgICB9LFxuICAgIFtvblRocmVhZENyZWF0ZSwgb25Db21wb3NlclN1Ym1pdCwgcHJvcHMubWV0YWRhdGEsIGNyZWF0ZVRocmVhZF1cbiAgKTtcbiAgZnVuY3Rpb24gaGFuZGxlS2V5RG93bihldmVudCkge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIG9uUmFuZ2VDaGFuZ2UobnVsbCk7XG4gICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICB9XG4gICAgb25LZXlEb3duPy4oZXZlbnQpO1xuICB9XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChSZWFjdF9fZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQWN0aXZlU2VsZWN0aW9uUG9ydGFsLCB7XG4gICAgcmFuZ2UsXG4gICAgY29udGFpbmVyOiBkb2N1bWVudC5ib2R5XG4gIH0pLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChGbG9hdGluZ0NvbXBvc2VyUG9ydGFsLCB7XG4gICAgcmFuZ2UsXG4gICAgY29udGFpbmVyOiBkb2N1bWVudC5ib2R5XG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbXBvc2VyLCB7XG4gICAgYXV0b0ZvY3VzOiB0cnVlLFxuICAgIC4uLmNvbXBvc2VyUHJvcHMsXG4gICAgb25LZXlEb3duOiBoYW5kbGVLZXlEb3duLFxuICAgIG9uQ29tcG9zZXJTdWJtaXQ6IGhhbmRsZUNvbXBvc2VyU3VibWl0LFxuICAgIHJlZjogZm9yd2FyZGVkUmVmXG4gIH0pKSk7XG59KTtcbmZ1bmN0aW9uIEFjdGl2ZVNlbGVjdGlvblBvcnRhbCh7XG4gIHJhbmdlLFxuICBjb250YWluZXJcbn0pIHtcbiAgY29uc3Qge1xuICAgIHJlZnM6IHsgc2V0UmVmZXJlbmNlLCBzZXRGbG9hdGluZyB9LFxuICAgIHN0cmF0ZWd5LFxuICAgIHgsXG4gICAgeVxuICB9ID0gdXNlRmxvYXRpbmcoe1xuICAgIHN0cmF0ZWd5OiBcImZpeGVkXCIsXG4gICAgcGxhY2VtZW50OiBcImJvdHRvbVwiLFxuICAgIG1pZGRsZXdhcmU6IFtvZmZzZXQoLXJhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCldLFxuICAgIHdoaWxlRWxlbWVudHNNb3VudGVkOiAoLi4uYXJncykgPT4ge1xuICAgICAgcmV0dXJuIGF1dG9VcGRhdGUoLi4uYXJncywge1xuICAgICAgICBhbmltYXRpb25GcmFtZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBzZXRSZWZlcmVuY2Uoe1xuICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0OiAoKSA9PiByYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgIH0pO1xuICB9LCBbc2V0UmVmZXJlbmNlLCByYW5nZV0pO1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3QgcmVjdHMgPSBjcmVhdGVSZWN0c0Zyb21ET01SYW5nZShlZGl0b3IsIHJhbmdlKTtcbiAgcmV0dXJuIGNyZWF0ZVBvcnRhbChcbiAgICAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChSZWFjdF9fZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHtcbiAgICAgIHJlZjogc2V0RmxvYXRpbmcsXG4gICAgICBzdHlsZToge1xuICAgICAgICBwb3NpdGlvbjogc3RyYXRlZ3ksXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlM2QoJHtNYXRoLnJvdW5kKHgpfXB4LCAke01hdGgucm91bmQoeSl9cHgsIDApYCxcbiAgICAgICAgbWluV2lkdGg6IFwibWF4LWNvbnRlbnRcIixcbiAgICAgICAgd2lkdGg6IHJhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHJhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCxcbiAgICAgICAgcG9pbnRlckV2ZW50czogXCJub25lXCJcbiAgICAgIH0sXG4gICAgICBjbGFzc05hbWU6IFwibGItcm9vdCBsYi1wb3J0YWxcIlxuICAgIH0sIHJlY3RzLm1hcCgocmVjdCkgPT4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHtcbiAgICAgIGtleTogSlNPTi5zdHJpbmdpZnkocmVjdCksXG4gICAgICBzdHlsZToge1xuICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICB0b3A6IHJlY3QudG9wIC0gcmFuZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wLFxuICAgICAgICBsZWZ0OiByZWN0LmxlZnQgLSByYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LFxuICAgICAgICB3aWR0aDogcmVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiByZWN0LmhlaWdodCxcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcInZhcigtLWxiLXNlbGVjdGlvbiwgcmdiYSgwLCAwLCAyNTUsIDAuMikpXCIsXG4gICAgICAgIHBvaW50ZXJFdmVudHM6IFwibm9uZVwiXG4gICAgICB9LFxuICAgICAgY2xhc3NOYW1lOiBcImxiLWxleGljYWwtYWN0aXZlLXNlbGVjdGlvblwiXG4gICAgfSkpKSksXG4gICAgY29udGFpbmVyXG4gICk7XG59XG5jb25zdCBGTE9BVElOR19DT01QT1NFUl9DT0xMSVNJT05fUEFERElORyA9IDEwO1xuZnVuY3Rpb24gRmxvYXRpbmdDb21wb3NlclBvcnRhbCh7XG4gIGNvbnRhaW5lcixcbiAgcmFuZ2UsXG4gIGNoaWxkcmVuXG59KSB7XG4gIGNvbnN0IHtcbiAgICByZWZzOiB7IHNldFJlZmVyZW5jZSwgc2V0RmxvYXRpbmcgfSxcbiAgICBzdHJhdGVneSxcbiAgICB4LFxuICAgIHlcbiAgfSA9IHVzZUZsb2F0aW5nKHtcbiAgICBzdHJhdGVneTogXCJmaXhlZFwiLFxuICAgIHBsYWNlbWVudDogXCJib3R0b21cIixcbiAgICBtaWRkbGV3YXJlOiBbXG4gICAgICBmbGlwKHsgcGFkZGluZzogRkxPQVRJTkdfQ09NUE9TRVJfQ09MTElTSU9OX1BBRERJTkcsIGNyb3NzQXhpczogZmFsc2UgfSksXG4gICAgICBvZmZzZXQoMTApLFxuICAgICAgaGlkZSh7IHBhZGRpbmc6IEZMT0FUSU5HX0NPTVBPU0VSX0NPTExJU0lPTl9QQURESU5HIH0pLFxuICAgICAgc2hpZnQoe1xuICAgICAgICBwYWRkaW5nOiBGTE9BVElOR19DT01QT1NFUl9DT0xMSVNJT05fUEFERElORyxcbiAgICAgICAgbGltaXRlcjogbGltaXRTaGlmdCgpXG4gICAgICB9KSxcbiAgICAgIHNpemUoeyBwYWRkaW5nOiBGTE9BVElOR19DT01QT1NFUl9DT0xMSVNJT05fUEFERElORyB9KVxuICAgIF0sXG4gICAgd2hpbGVFbGVtZW50c01vdW50ZWQ6ICguLi5hcmdzKSA9PiB7XG4gICAgICByZXR1cm4gYXV0b1VwZGF0ZSguLi5hcmdzLCB7XG4gICAgICAgIGFuaW1hdGlvbkZyYW1lOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4ge1xuICAgIHNldFJlZmVyZW5jZSh7XG4gICAgICBnZXRCb3VuZGluZ0NsaWVudFJlY3Q6ICgpID0+IHJhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgfSk7XG4gIH0sIFtyYW5nZSwgc2V0UmVmZXJlbmNlXSk7XG4gIHJldHVybiBjcmVhdGVQb3J0YWwoXG4gICAgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwge1xuICAgICAgcmVmOiBzZXRGbG9hdGluZyxcbiAgICAgIHN0eWxlOiB7XG4gICAgICAgIHBvc2l0aW9uOiBzdHJhdGVneSxcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiAwLFxuICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUzZCgke01hdGgucm91bmQoeCl9cHgsICR7TWF0aC5yb3VuZCh5KX1weCwgMClgLFxuICAgICAgICBtaW5XaWR0aDogXCJtYXgtY29udGVudFwiXG4gICAgICB9LFxuICAgICAgY2xhc3NOYW1lOiBcImxiLXJvb3QgbGItcG9ydGFsIGxiLWVsZXZhdGlvbiBsYi1sZXhpY2FsLWZsb2F0aW5nIGxiLWxleGljYWwtZmxvYXRpbmctY29tcG9zZXJcIlxuICAgIH0sIGNoaWxkcmVuKSxcbiAgICBjb250YWluZXJcbiAgKTtcbn1cblxuZXhwb3J0IHsgRkxPQVRJTkdfQ09NUE9TRVJfQ09MTElTSU9OX1BBRERJTkcsIEZsb2F0aW5nQ29tcG9zZXIsIE9QRU5fRkxPQVRJTkdfQ09NUE9TRVJfQ09NTUFORCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmxvYXRpbmctY29tcG9zZXIubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/floating-composer.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/floating-threads.mjs":
/*!***********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/floating-threads.mjs ***!
  \***********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FLOATING_THREAD_COLLISION_PADDING: () => (/* binding */ FLOATING_THREAD_COLLISION_PADDING),\n/* harmony export */   FloatingThreads: () => (/* binding */ FloatingThreads)\n/* harmony export */ });\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs\");\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @liveblocks/react-ui */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Thread.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-dom.js\");\n/* harmony import */ var use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! use-sync-external-store/shim/index.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/index.js\");\n/* harmony import */ var _classnames_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../classnames.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/classnames.mjs\");\n/* harmony import */ var _anchored_threads_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./anchored-threads.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/anchored-threads.mjs\");\n/* harmony import */ var _comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./comment-plugin-provider.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/comment-plugin-provider.mjs\");\n\n\n\n\n\n\n\n\n\n\n\nfunction FloatingThreads({\n  threads,\n  components,\n  ...props\n}) {\n  const activeThreads = useActiveThreads();\n  const Thread$1 = components?.Thread ?? _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_3__.Thread;\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_4__.useLexicalComposerContext)();\n  const nodes = useThreadToNodes();\n  const [range, setRange] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n  const handleUpdateRange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    function getActiveRange() {\n      function getActiveElements() {\n        const activeElements2 = /* @__PURE__ */ new Set();\n        for (const thread of activeThreads) {\n          const keys = nodes.get(thread);\n          if (keys === void 0)\n            continue;\n          for (const key of keys) {\n            const element = editor.getElementByKey(key);\n            if (element === null)\n              continue;\n            activeElements2.add(element);\n          }\n        }\n        return activeElements2;\n      }\n      const activeElements = getActiveElements();\n      const sortedElements = Array.from(activeElements).sort(_anchored_threads_mjs__WEBPACK_IMPORTED_MODULE_5__.compareNodes);\n      if (sortedElements.length === 0)\n        return null;\n      const range3 = document.createRange();\n      range3.setStartBefore(sortedElements[0]);\n      range3.setEndAfter(sortedElements[sortedElements.length - 1]);\n      return range3;\n    }\n    const active = (threads ?? []).filter(\n      (thread) => activeThreads.includes(thread.id)\n    );\n    const range2 = getActiveRange();\n    if (range2 === null) {\n      setRange(null);\n      return;\n    }\n    setRange({ range: range2, threads: active });\n  }, [activeThreads, nodes, editor, threads]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    handleUpdateRange();\n  }, [handleUpdateRange]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    return editor.registerUpdateListener(handleUpdateRange);\n  }, [editor, handleUpdateRange]);\n  const handleEscapeKeydown = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    if (range === null)\n      return false;\n    setRange(null);\n    return true;\n  }, [range]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    return editor.registerCommand(\n      lexical__WEBPACK_IMPORTED_MODULE_6__.KEY_ESCAPE_COMMAND,\n      handleEscapeKeydown,\n      lexical__WEBPACK_IMPORTED_MODULE_6__.COMMAND_PRIORITY_HIGH\n    );\n  }, [editor, handleEscapeKeydown]);\n  const isCollapsed = useIsSelectionCollapsed();\n  if (range === null || isCollapsed === null || !isCollapsed)\n    return null;\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(FloatingThreadPortal, {\n    range: range.range,\n    container: document.body,\n    ...props\n  }, range.threads.map((thread) => /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ThreadWrapper, {\n    key: thread.id,\n    thread,\n    Thread: Thread$1,\n    onEscapeKeydown: handleEscapeKeydown,\n    className: \"lb-lexical-floating-threads-thread\"\n  })));\n}\nconst FLOATING_THREAD_COLLISION_PADDING = 10;\nfunction FloatingThreadPortal({\n  container,\n  range,\n  children,\n  className,\n  style,\n  ...props\n}) {\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y\n  } = (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.useFloating)({\n    strategy: \"absolute\",\n    placement: \"bottom\",\n    middleware: [\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.flip)({ padding: FLOATING_THREAD_COLLISION_PADDING, crossAxis: false }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.offset)(10),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.hide)({ padding: FLOATING_THREAD_COLLISION_PADDING }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.shift)({\n        padding: FLOATING_THREAD_COLLISION_PADDING,\n        limiter: (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.limitShift)()\n      }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_7__.size)({\n        padding: FLOATING_THREAD_COLLISION_PADDING,\n        apply({ availableWidth, availableHeight, elements }) {\n          elements.floating.style.setProperty(\n            \"--lb-lexical-floating-threads-available-width\",\n            `${availableWidth}px`\n          );\n          elements.floating.style.setProperty(\n            \"--lb-lexical-floating-threads-available-height\",\n            `${availableHeight}px`\n          );\n        }\n      })\n    ],\n    whileElementsMounted: (...args) => {\n      return (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.autoUpdate)(...args, {\n        animationFrame: true\n      });\n    }\n  });\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {\n    setReference({\n      getBoundingClientRect: () => range.getBoundingClientRect()\n    });\n  }, [setReference, range]);\n  return (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(\n    /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n      ref: setFloating,\n      ...props,\n      style: {\n        ...style,\n        position: strategy,\n        top: 0,\n        left: 0,\n        transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n        minWidth: \"max-content\"\n      },\n      className: (0,_classnames_mjs__WEBPACK_IMPORTED_MODULE_9__.classNames)(\n        \"lb-root lb-portal lb-elevation lb-lexical-floating lb-lexical-floating-threads\",\n        className\n      )\n    }, children),\n    container\n  );\n}\nfunction ThreadWrapper({\n  thread,\n  Thread,\n  onEscapeKeydown,\n  onKeyDown,\n  ...threadProps\n}) {\n  const handleKeyDown = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (event) => {\n      onKeyDown?.(event);\n      if (event.key === \"Escape\") {\n        onEscapeKeydown();\n      }\n    },\n    [onEscapeKeydown, onKeyDown]\n  );\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Thread, {\n    thread,\n    onKeyDown: handleKeyDown,\n    ...threadProps\n  });\n}\nfunction useThreadToNodes() {\n  const threadToNodes = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_10__.ThreadToNodesContext);\n  if (threadToNodes === null) {\n    throw new Error(\n      \"FloatingThreads component must be used within a LiveblocksPlugin component.\"\n    );\n  }\n  return threadToNodes;\n}\nfunction useIsSelectionCollapsed() {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_4__.useLexicalComposerContext)();\n  const subscribe = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (onStoreChange) => {\n      return editor.registerUpdateListener(onStoreChange);\n    },\n    [editor]\n  );\n  const getSnapshot = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    return editor.getEditorState().read(() => {\n      const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_6__.$getSelection)();\n      if (selection === null)\n        return null;\n      return selection.isCollapsed();\n    });\n  }, [editor]);\n  return (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStore)(subscribe, getSnapshot, getSnapshot);\n}\nfunction useActiveThreads() {\n  const activeThreads = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_10__.ActiveThreadsContext);\n  if (activeThreads === null) {\n    throw new Error(\n      \"FloatingThreads component must be used within LiveblocksPlugin.\"\n    );\n  }\n  return activeThreads;\n}\n\n\n//# sourceMappingURL=floating-threads.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2Zsb2F0aW5nLXRocmVhZHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBOEc7QUFDNUI7QUFDcEM7QUFDcUM7QUFDbUI7QUFDN0Q7QUFDb0M7QUFDOUI7QUFDTztBQUNxQzs7QUFFM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSx5Q0FBeUMsd0RBQU07QUFDL0MsbUJBQW1CLGdHQUF5QjtBQUM1QztBQUNBLDRCQUE0QiwrQ0FBUTtBQUNwQyw0QkFBNEIsa0RBQVc7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCwrREFBWTtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLGdDQUFnQztBQUMvQyxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBLEdBQUc7QUFDSCw4QkFBOEIsa0RBQVc7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0EsTUFBTSx1REFBa0I7QUFDeEI7QUFDQSxNQUFNLDBEQUFxQjtBQUMzQjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsZ0RBQTRCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLEdBQUcsZ0RBQWdELGdEQUE0QjtBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLFlBQVksMkJBQTJCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLElBQUksRUFBRSxtRUFBVztBQUNqQjtBQUNBO0FBQ0E7QUFDQSxNQUFNLDREQUFJLEdBQUcsOERBQThEO0FBQzNFLE1BQU0sOERBQU07QUFDWixNQUFNLDREQUFJLEdBQUcsNENBQTRDO0FBQ3pELE1BQU0sNkRBQUs7QUFDWDtBQUNBLGlCQUFpQixrRUFBVTtBQUMzQixPQUFPO0FBQ1AsTUFBTSw0REFBSTtBQUNWO0FBQ0EsZ0JBQWdCLDJDQUEyQztBQUMzRDtBQUNBO0FBQ0EsZUFBZSxlQUFlO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGVBQWUsZ0JBQWdCO0FBQy9CO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLGFBQWEsa0VBQVU7QUFDdkI7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0gsRUFBRSxzREFBZTtBQUNqQjtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSCxTQUFTLHVEQUFZO0FBQ3JCLG9CQUFvQixnREFBNEI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsY0FBYyxNQUFNLGNBQWM7QUFDcEU7QUFDQSxPQUFPO0FBQ1AsaUJBQWlCLDJEQUFVO0FBQzNCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Qsd0JBQXdCLGtEQUFXO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHlCQUF5QixnREFBNEI7QUFDckQ7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSx3QkFBd0IsaURBQVUsQ0FBQywrRUFBb0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixnR0FBeUI7QUFDNUMsb0JBQW9CLGtEQUFXO0FBQy9CO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHNCQUFzQixrREFBVztBQUNqQztBQUNBLHdCQUF3QixzREFBYTtBQUNyQztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILFNBQVMsMkZBQW9CO0FBQzdCO0FBQ0E7QUFDQSx3QkFBd0IsaURBQVUsQ0FBQywrRUFBb0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRThEO0FBQzlEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2Zsb2F0aW5nLXRocmVhZHMubWpzPzZlMGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlRmxvYXRpbmcsIGZsaXAsIG9mZnNldCwgaGlkZSwgc2hpZnQsIGxpbWl0U2hpZnQsIHNpemUsIGF1dG9VcGRhdGUgfSBmcm9tICdAZmxvYXRpbmctdWkvcmVhY3QtZG9tJztcbmltcG9ydCB7IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29tcG9zZXJDb250ZXh0JztcbmltcG9ydCB7IFRocmVhZCB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0LXVpJztcbmltcG9ydCB7IEtFWV9FU0NBUEVfQ09NTUFORCwgQ09NTUFORF9QUklPUklUWV9ISUdILCAkZ2V0U2VsZWN0aW9uIH0gZnJvbSAnbGV4aWNhbCc7XG5pbXBvcnQgUmVhY3RfX2RlZmF1bHQsIHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZUxheW91dEVmZmVjdCwgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGNyZWF0ZVBvcnRhbCB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgeyB1c2VTeW5jRXh0ZXJuYWxTdG9yZSB9IGZyb20gJ3VzZS1zeW5jLWV4dGVybmFsLXN0b3JlL3NoaW0vaW5kZXguanMnO1xuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gJy4uL2NsYXNzbmFtZXMubWpzJztcbmltcG9ydCB7IGNvbXBhcmVOb2RlcyB9IGZyb20gJy4vYW5jaG9yZWQtdGhyZWFkcy5tanMnO1xuaW1wb3J0IHsgVGhyZWFkVG9Ob2Rlc0NvbnRleHQsIEFjdGl2ZVRocmVhZHNDb250ZXh0IH0gZnJvbSAnLi9jb21tZW50LXBsdWdpbi1wcm92aWRlci5tanMnO1xuXG5mdW5jdGlvbiBGbG9hdGluZ1RocmVhZHMoe1xuICB0aHJlYWRzLFxuICBjb21wb25lbnRzLFxuICAuLi5wcm9wc1xufSkge1xuICBjb25zdCBhY3RpdmVUaHJlYWRzID0gdXNlQWN0aXZlVGhyZWFkcygpO1xuICBjb25zdCBUaHJlYWQkMSA9IGNvbXBvbmVudHM/LlRocmVhZCA/PyBUaHJlYWQ7XG4gIGNvbnN0IFtlZGl0b3JdID0gdXNlTGV4aWNhbENvbXBvc2VyQ29udGV4dCgpO1xuICBjb25zdCBub2RlcyA9IHVzZVRocmVhZFRvTm9kZXMoKTtcbiAgY29uc3QgW3JhbmdlLCBzZXRSYW5nZV0gPSB1c2VTdGF0ZShudWxsKTtcbiAgY29uc3QgaGFuZGxlVXBkYXRlUmFuZ2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgZnVuY3Rpb24gZ2V0QWN0aXZlUmFuZ2UoKSB7XG4gICAgICBmdW5jdGlvbiBnZXRBY3RpdmVFbGVtZW50cygpIHtcbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudHMyID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgICAgICAgZm9yIChjb25zdCB0aHJlYWQgb2YgYWN0aXZlVGhyZWFkcykge1xuICAgICAgICAgIGNvbnN0IGtleXMgPSBub2Rlcy5nZXQodGhyZWFkKTtcbiAgICAgICAgICBpZiAoa2V5cyA9PT0gdm9pZCAwKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGVkaXRvci5nZXRFbGVtZW50QnlLZXkoa2V5KTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ID09PSBudWxsKVxuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIGFjdGl2ZUVsZW1lbnRzMi5hZGQoZWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY3RpdmVFbGVtZW50czI7XG4gICAgICB9XG4gICAgICBjb25zdCBhY3RpdmVFbGVtZW50cyA9IGdldEFjdGl2ZUVsZW1lbnRzKCk7XG4gICAgICBjb25zdCBzb3J0ZWRFbGVtZW50cyA9IEFycmF5LmZyb20oYWN0aXZlRWxlbWVudHMpLnNvcnQoY29tcGFyZU5vZGVzKTtcbiAgICAgIGlmIChzb3J0ZWRFbGVtZW50cy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgY29uc3QgcmFuZ2UzID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIHJhbmdlMy5zZXRTdGFydEJlZm9yZShzb3J0ZWRFbGVtZW50c1swXSk7XG4gICAgICByYW5nZTMuc2V0RW5kQWZ0ZXIoc29ydGVkRWxlbWVudHNbc29ydGVkRWxlbWVudHMubGVuZ3RoIC0gMV0pO1xuICAgICAgcmV0dXJuIHJhbmdlMztcbiAgICB9XG4gICAgY29uc3QgYWN0aXZlID0gKHRocmVhZHMgPz8gW10pLmZpbHRlcihcbiAgICAgICh0aHJlYWQpID0+IGFjdGl2ZVRocmVhZHMuaW5jbHVkZXModGhyZWFkLmlkKVxuICAgICk7XG4gICAgY29uc3QgcmFuZ2UyID0gZ2V0QWN0aXZlUmFuZ2UoKTtcbiAgICBpZiAocmFuZ2UyID09PSBudWxsKSB7XG4gICAgICBzZXRSYW5nZShudWxsKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2V0UmFuZ2UoeyByYW5nZTogcmFuZ2UyLCB0aHJlYWRzOiBhY3RpdmUgfSk7XG4gIH0sIFthY3RpdmVUaHJlYWRzLCBub2RlcywgZWRpdG9yLCB0aHJlYWRzXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaGFuZGxlVXBkYXRlUmFuZ2UoKTtcbiAgfSwgW2hhbmRsZVVwZGF0ZVJhbmdlXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlclVwZGF0ZUxpc3RlbmVyKGhhbmRsZVVwZGF0ZVJhbmdlKTtcbiAgfSwgW2VkaXRvciwgaGFuZGxlVXBkYXRlUmFuZ2VdKTtcbiAgY29uc3QgaGFuZGxlRXNjYXBlS2V5ZG93biA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAocmFuZ2UgPT09IG51bGwpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgc2V0UmFuZ2UobnVsbCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sIFtyYW5nZV0pO1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiBlZGl0b3IucmVnaXN0ZXJDb21tYW5kKFxuICAgICAgS0VZX0VTQ0FQRV9DT01NQU5ELFxuICAgICAgaGFuZGxlRXNjYXBlS2V5ZG93bixcbiAgICAgIENPTU1BTkRfUFJJT1JJVFlfSElHSFxuICAgICk7XG4gIH0sIFtlZGl0b3IsIGhhbmRsZUVzY2FwZUtleWRvd25dKTtcbiAgY29uc3QgaXNDb2xsYXBzZWQgPSB1c2VJc1NlbGVjdGlvbkNvbGxhcHNlZCgpO1xuICBpZiAocmFuZ2UgPT09IG51bGwgfHwgaXNDb2xsYXBzZWQgPT09IG51bGwgfHwgIWlzQ29sbGFwc2VkKVxuICAgIHJldHVybiBudWxsO1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoRmxvYXRpbmdUaHJlYWRQb3J0YWwsIHtcbiAgICByYW5nZTogcmFuZ2UucmFuZ2UsXG4gICAgY29udGFpbmVyOiBkb2N1bWVudC5ib2R5LFxuICAgIC4uLnByb3BzXG4gIH0sIHJhbmdlLnRocmVhZHMubWFwKCh0aHJlYWQpID0+IC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFRocmVhZFdyYXBwZXIsIHtcbiAgICBrZXk6IHRocmVhZC5pZCxcbiAgICB0aHJlYWQsXG4gICAgVGhyZWFkOiBUaHJlYWQkMSxcbiAgICBvbkVzY2FwZUtleWRvd246IGhhbmRsZUVzY2FwZUtleWRvd24sXG4gICAgY2xhc3NOYW1lOiBcImxiLWxleGljYWwtZmxvYXRpbmctdGhyZWFkcy10aHJlYWRcIlxuICB9KSkpO1xufVxuY29uc3QgRkxPQVRJTkdfVEhSRUFEX0NPTExJU0lPTl9QQURESU5HID0gMTA7XG5mdW5jdGlvbiBGbG9hdGluZ1RocmVhZFBvcnRhbCh7XG4gIGNvbnRhaW5lcixcbiAgcmFuZ2UsXG4gIGNoaWxkcmVuLFxuICBjbGFzc05hbWUsXG4gIHN0eWxlLFxuICAuLi5wcm9wc1xufSkge1xuICBjb25zdCB7XG4gICAgcmVmczogeyBzZXRSZWZlcmVuY2UsIHNldEZsb2F0aW5nIH0sXG4gICAgc3RyYXRlZ3ksXG4gICAgeCxcbiAgICB5XG4gIH0gPSB1c2VGbG9hdGluZyh7XG4gICAgc3RyYXRlZ3k6IFwiYWJzb2x1dGVcIixcbiAgICBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsXG4gICAgbWlkZGxld2FyZTogW1xuICAgICAgZmxpcCh7IHBhZGRpbmc6IEZMT0FUSU5HX1RIUkVBRF9DT0xMSVNJT05fUEFERElORywgY3Jvc3NBeGlzOiBmYWxzZSB9KSxcbiAgICAgIG9mZnNldCgxMCksXG4gICAgICBoaWRlKHsgcGFkZGluZzogRkxPQVRJTkdfVEhSRUFEX0NPTExJU0lPTl9QQURESU5HIH0pLFxuICAgICAgc2hpZnQoe1xuICAgICAgICBwYWRkaW5nOiBGTE9BVElOR19USFJFQURfQ09MTElTSU9OX1BBRERJTkcsXG4gICAgICAgIGxpbWl0ZXI6IGxpbWl0U2hpZnQoKVxuICAgICAgfSksXG4gICAgICBzaXplKHtcbiAgICAgICAgcGFkZGluZzogRkxPQVRJTkdfVEhSRUFEX0NPTExJU0lPTl9QQURESU5HLFxuICAgICAgICBhcHBseSh7IGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQsIGVsZW1lbnRzIH0pIHtcbiAgICAgICAgICBlbGVtZW50cy5mbG9hdGluZy5zdHlsZS5zZXRQcm9wZXJ0eShcbiAgICAgICAgICAgIFwiLS1sYi1sZXhpY2FsLWZsb2F0aW5nLXRocmVhZHMtYXZhaWxhYmxlLXdpZHRoXCIsXG4gICAgICAgICAgICBgJHthdmFpbGFibGVXaWR0aH1weGBcbiAgICAgICAgICApO1xuICAgICAgICAgIGVsZW1lbnRzLmZsb2F0aW5nLnN0eWxlLnNldFByb3BlcnR5KFxuICAgICAgICAgICAgXCItLWxiLWxleGljYWwtZmxvYXRpbmctdGhyZWFkcy1hdmFpbGFibGUtaGVpZ2h0XCIsXG4gICAgICAgICAgICBgJHthdmFpbGFibGVIZWlnaHR9cHhgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICBdLFxuICAgIHdoaWxlRWxlbWVudHNNb3VudGVkOiAoLi4uYXJncykgPT4ge1xuICAgICAgcmV0dXJuIGF1dG9VcGRhdGUoLi4uYXJncywge1xuICAgICAgICBhbmltYXRpb25GcmFtZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBzZXRSZWZlcmVuY2Uoe1xuICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0OiAoKSA9PiByYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgIH0pO1xuICB9LCBbc2V0UmVmZXJlbmNlLCByYW5nZV0pO1xuICByZXR1cm4gY3JlYXRlUG9ydGFsKFxuICAgIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAgIHJlZjogc2V0RmxvYXRpbmcsXG4gICAgICAuLi5wcm9wcyxcbiAgICAgIHN0eWxlOiB7XG4gICAgICAgIC4uLnN0eWxlLFxuICAgICAgICBwb3NpdGlvbjogc3RyYXRlZ3ksXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlM2QoJHtNYXRoLnJvdW5kKHgpfXB4LCAke01hdGgucm91bmQoeSl9cHgsIDApYCxcbiAgICAgICAgbWluV2lkdGg6IFwibWF4LWNvbnRlbnRcIlxuICAgICAgfSxcbiAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyhcbiAgICAgICAgXCJsYi1yb290IGxiLXBvcnRhbCBsYi1lbGV2YXRpb24gbGItbGV4aWNhbC1mbG9hdGluZyBsYi1sZXhpY2FsLWZsb2F0aW5nLXRocmVhZHNcIixcbiAgICAgICAgY2xhc3NOYW1lXG4gICAgICApXG4gICAgfSwgY2hpbGRyZW4pLFxuICAgIGNvbnRhaW5lclxuICApO1xufVxuZnVuY3Rpb24gVGhyZWFkV3JhcHBlcih7XG4gIHRocmVhZCxcbiAgVGhyZWFkLFxuICBvbkVzY2FwZUtleWRvd24sXG4gIG9uS2V5RG93bixcbiAgLi4udGhyZWFkUHJvcHNcbn0pIHtcbiAgY29uc3QgaGFuZGxlS2V5RG93biA9IHVzZUNhbGxiYWNrKFxuICAgIChldmVudCkgPT4ge1xuICAgICAgb25LZXlEb3duPy4oZXZlbnQpO1xuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICBvbkVzY2FwZUtleWRvd24oKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFtvbkVzY2FwZUtleWRvd24sIG9uS2V5RG93bl1cbiAgKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFRocmVhZCwge1xuICAgIHRocmVhZCxcbiAgICBvbktleURvd246IGhhbmRsZUtleURvd24sXG4gICAgLi4udGhyZWFkUHJvcHNcbiAgfSk7XG59XG5mdW5jdGlvbiB1c2VUaHJlYWRUb05vZGVzKCkge1xuICBjb25zdCB0aHJlYWRUb05vZGVzID0gdXNlQ29udGV4dChUaHJlYWRUb05vZGVzQ29udGV4dCk7XG4gIGlmICh0aHJlYWRUb05vZGVzID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJGbG9hdGluZ1RocmVhZHMgY29tcG9uZW50IG11c3QgYmUgdXNlZCB3aXRoaW4gYSBMaXZlYmxvY2tzUGx1Z2luIGNvbXBvbmVudC5cIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHRocmVhZFRvTm9kZXM7XG59XG5mdW5jdGlvbiB1c2VJc1NlbGVjdGlvbkNvbGxhcHNlZCgpIHtcbiAgY29uc3QgW2VkaXRvcl0gPSB1c2VMZXhpY2FsQ29tcG9zZXJDb250ZXh0KCk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHVzZUNhbGxiYWNrKFxuICAgIChvblN0b3JlQ2hhbmdlKSA9PiB7XG4gICAgICByZXR1cm4gZWRpdG9yLnJlZ2lzdGVyVXBkYXRlTGlzdGVuZXIob25TdG9yZUNoYW5nZSk7XG4gICAgfSxcbiAgICBbZWRpdG9yXVxuICApO1xuICBjb25zdCBnZXRTbmFwc2hvdCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICByZXR1cm4gZWRpdG9yLmdldEVkaXRvclN0YXRlKCkucmVhZCgoKSA9PiB7XG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSAkZ2V0U2VsZWN0aW9uKCk7XG4gICAgICBpZiAoc2VsZWN0aW9uID09PSBudWxsKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIHJldHVybiBzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKTtcbiAgICB9KTtcbiAgfSwgW2VkaXRvcl0pO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmUoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgZ2V0U25hcHNob3QpO1xufVxuZnVuY3Rpb24gdXNlQWN0aXZlVGhyZWFkcygpIHtcbiAgY29uc3QgYWN0aXZlVGhyZWFkcyA9IHVzZUNvbnRleHQoQWN0aXZlVGhyZWFkc0NvbnRleHQpO1xuICBpZiAoYWN0aXZlVGhyZWFkcyA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiRmxvYXRpbmdUaHJlYWRzIGNvbXBvbmVudCBtdXN0IGJlIHVzZWQgd2l0aGluIExpdmVibG9ja3NQbHVnaW4uXCJcbiAgICApO1xuICB9XG4gIHJldHVybiBhY3RpdmVUaHJlYWRzO1xufVxuXG5leHBvcnQgeyBGTE9BVElOR19USFJFQURfQ09MTElTSU9OX1BBRERJTkcsIEZsb2F0aW5nVGhyZWFkcyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmxvYXRpbmctdGhyZWFkcy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/floating-threads.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/get-thread-mark-ids.mjs":
/*!**************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/get-thread-mark-ids.mjs ***!
  \**************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ $getThreadMarkIds)\n/* harmony export */ });\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var _thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\");\n\n\n\nfunction $getThreadMarkIds(node, offset) {\n  let currentNode = node;\n  while (currentNode !== null) {\n    if ((0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_0__.$isThreadMarkNode)(currentNode)) {\n      return currentNode.getIDs();\n    } else if ((0,lexical__WEBPACK_IMPORTED_MODULE_1__.$isTextNode)(currentNode) && offset === currentNode.getTextContentSize()) {\n      const nextSibling = currentNode.getNextSibling();\n      if ((0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_0__.$isThreadMarkNode)(nextSibling)) {\n        return nextSibling.getIDs();\n      }\n    }\n    currentNode = currentNode.getParent();\n  }\n  return null;\n}\n\n\n//# sourceMappingURL=get-thread-mark-ids.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL2dldC10aHJlYWQtbWFyay1pZHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFzQztBQUNxQjs7QUFFM0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx3RUFBaUI7QUFDekI7QUFDQSxNQUFNLFNBQVMsb0RBQVc7QUFDMUI7QUFDQSxVQUFVLHdFQUFpQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFd0M7QUFDeEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC1sZXhpY2FsL2Rpc3QvY29tbWVudHMvZ2V0LXRocmVhZC1tYXJrLWlkcy5tanM/MzE0MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyAkaXNUZXh0Tm9kZSB9IGZyb20gJ2xleGljYWwnO1xuaW1wb3J0IHsgJGlzVGhyZWFkTWFya05vZGUgfSBmcm9tICcuL3RocmVhZC1tYXJrLW5vZGUubWpzJztcblxuZnVuY3Rpb24gJGdldFRocmVhZE1hcmtJZHMobm9kZSwgb2Zmc2V0KSB7XG4gIGxldCBjdXJyZW50Tm9kZSA9IG5vZGU7XG4gIHdoaWxlIChjdXJyZW50Tm9kZSAhPT0gbnVsbCkge1xuICAgIGlmICgkaXNUaHJlYWRNYXJrTm9kZShjdXJyZW50Tm9kZSkpIHtcbiAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5nZXRJRHMoKTtcbiAgICB9IGVsc2UgaWYgKCRpc1RleHROb2RlKGN1cnJlbnROb2RlKSAmJiBvZmZzZXQgPT09IGN1cnJlbnROb2RlLmdldFRleHRDb250ZW50U2l6ZSgpKSB7XG4gICAgICBjb25zdCBuZXh0U2libGluZyA9IGN1cnJlbnROb2RlLmdldE5leHRTaWJsaW5nKCk7XG4gICAgICBpZiAoJGlzVGhyZWFkTWFya05vZGUobmV4dFNpYmxpbmcpKSB7XG4gICAgICAgIHJldHVybiBuZXh0U2libGluZy5nZXRJRHMoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZS5nZXRQYXJlbnQoKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IHsgJGdldFRocmVhZE1hcmtJZHMgYXMgZGVmYXVsdCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2V0LXRocmVhZC1tYXJrLWlkcy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/get-thread-mark-ids.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs":
/*!***********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs ***!
  \***********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   $createThreadMarkNode: () => (/* binding */ $createThreadMarkNode),\n/* harmony export */   $isThreadMarkNode: () => (/* binding */ $isThreadMarkNode),\n/* harmony export */   ThreadMarkNode: () => (/* binding */ ThreadMarkNode)\n/* harmony export */ });\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n\n\nclass ThreadMarkNode extends lexical__WEBPACK_IMPORTED_MODULE_0__.ElementNode {\n  constructor(ids, key) {\n    super(key);\n    this.__ids = ids || [];\n  }\n  static getType() {\n    return \"lb-thread-mark\";\n  }\n  static clone(node) {\n    return new ThreadMarkNode(Array.from(node.__ids), node.__key);\n  }\n  static importDOM() {\n    return null;\n  }\n  static importJSON(serializedNode) {\n    const node = $createThreadMarkNode(serializedNode.ids);\n    node.setFormat(serializedNode.format);\n    node.setIndent(serializedNode.indent);\n    node.setDirection(serializedNode.direction);\n    return node;\n  }\n  exportJSON() {\n    return {\n      ...super.exportJSON(),\n      ids: this.getIDs(),\n      type: \"lb-thread-mark\",\n      version: 1\n    };\n  }\n  createDOM() {\n    const element = document.createElement(\"span\");\n    return element;\n  }\n  updateDOM() {\n    return false;\n  }\n  hasID(id) {\n    const ids = this.getIDs();\n    for (let i = 0; i < ids.length; i++) {\n      if (id === ids[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n  getIDs() {\n    const self = this.getLatest();\n    return $isThreadMarkNode(self) ? self.__ids : [];\n  }\n  addID(id) {\n    const self = this.getWritable();\n    if ($isThreadMarkNode(self)) {\n      const ids = self.__ids;\n      self.__ids = ids;\n      for (let i = 0; i < ids.length; i++) {\n        if (id === ids[i]) {\n          return;\n        }\n      }\n      ids.push(id);\n    }\n  }\n  deleteID(id) {\n    const self = this.getWritable();\n    if ($isThreadMarkNode(self)) {\n      const ids = self.__ids;\n      self.__ids = ids;\n      for (let i = 0; i < ids.length; i++) {\n        if (id === ids[i]) {\n          ids.splice(i, 1);\n          return;\n        }\n      }\n    }\n  }\n  insertNewAfter(_, restoreSelection = true) {\n    const markNode = $createThreadMarkNode(this.__ids);\n    this.insertAfter(markNode, restoreSelection);\n    return markNode;\n  }\n  canInsertTextBefore() {\n    return false;\n  }\n  canInsertTextAfter() {\n    return false;\n  }\n  canBeEmpty() {\n    return false;\n  }\n  isInline() {\n    return true;\n  }\n  extractWithChild(_, selection, destination) {\n    if (!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isRangeSelection)(selection) || destination === \"html\") {\n      return false;\n    }\n    const anchor = selection.anchor;\n    const focus = selection.focus;\n    const anchorNode = anchor.getNode();\n    const focusNode = focus.getNode();\n    const isBackward = selection.isBackward();\n    const selectionLength = isBackward ? anchor.offset - focus.offset : focus.offset - anchor.offset;\n    return this.isParentOf(anchorNode) && this.isParentOf(focusNode) && this.getTextContent().length === selectionLength;\n  }\n  excludeFromCopy(destination) {\n    return destination !== \"clone\";\n  }\n}\nfunction $createThreadMarkNode(ids) {\n  return (0,lexical__WEBPACK_IMPORTED_MODULE_0__.$applyNodeReplacement)(new ThreadMarkNode(ids));\n}\nfunction $isThreadMarkNode(node) {\n  return node instanceof ThreadMarkNode;\n}\n\n\n//# sourceMappingURL=thread-mark-node.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL3RocmVhZC1tYXJrLW5vZGUubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBZ0Y7O0FBRWhGLDZCQUE2QixnREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQkFBZ0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGdCQUFnQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsZ0JBQWdCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywwREFBaUI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyw4REFBcUI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7O0FBRW9FO0FBQ3BFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL3RocmVhZC1tYXJrLW5vZGUubWpzP2FlY2YiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudE5vZGUsICRpc1JhbmdlU2VsZWN0aW9uLCAkYXBwbHlOb2RlUmVwbGFjZW1lbnQgfSBmcm9tICdsZXhpY2FsJztcblxuY2xhc3MgVGhyZWFkTWFya05vZGUgZXh0ZW5kcyBFbGVtZW50Tm9kZSB7XG4gIGNvbnN0cnVjdG9yKGlkcywga2V5KSB7XG4gICAgc3VwZXIoa2V5KTtcbiAgICB0aGlzLl9faWRzID0gaWRzIHx8IFtdO1xuICB9XG4gIHN0YXRpYyBnZXRUeXBlKCkge1xuICAgIHJldHVybiBcImxiLXRocmVhZC1tYXJrXCI7XG4gIH1cbiAgc3RhdGljIGNsb25lKG5vZGUpIHtcbiAgICByZXR1cm4gbmV3IFRocmVhZE1hcmtOb2RlKEFycmF5LmZyb20obm9kZS5fX2lkcyksIG5vZGUuX19rZXkpO1xuICB9XG4gIHN0YXRpYyBpbXBvcnRET00oKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgc3RhdGljIGltcG9ydEpTT04oc2VyaWFsaXplZE5vZGUpIHtcbiAgICBjb25zdCBub2RlID0gJGNyZWF0ZVRocmVhZE1hcmtOb2RlKHNlcmlhbGl6ZWROb2RlLmlkcyk7XG4gICAgbm9kZS5zZXRGb3JtYXQoc2VyaWFsaXplZE5vZGUuZm9ybWF0KTtcbiAgICBub2RlLnNldEluZGVudChzZXJpYWxpemVkTm9kZS5pbmRlbnQpO1xuICAgIG5vZGUuc2V0RGlyZWN0aW9uKHNlcmlhbGl6ZWROb2RlLmRpcmVjdGlvbik7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cbiAgZXhwb3J0SlNPTigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3VwZXIuZXhwb3J0SlNPTigpLFxuICAgICAgaWRzOiB0aGlzLmdldElEcygpLFxuICAgICAgdHlwZTogXCJsYi10aHJlYWQtbWFya1wiLFxuICAgICAgdmVyc2lvbjogMVxuICAgIH07XG4gIH1cbiAgY3JlYXRlRE9NKCkge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuICB1cGRhdGVET00oKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGhhc0lEKGlkKSB7XG4gICAgY29uc3QgaWRzID0gdGhpcy5nZXRJRHMoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGlkID09PSBpZHNbaV0pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBnZXRJRHMoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXMuZ2V0TGF0ZXN0KCk7XG4gICAgcmV0dXJuICRpc1RocmVhZE1hcmtOb2RlKHNlbGYpID8gc2VsZi5fX2lkcyA6IFtdO1xuICB9XG4gIGFkZElEKGlkKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXMuZ2V0V3JpdGFibGUoKTtcbiAgICBpZiAoJGlzVGhyZWFkTWFya05vZGUoc2VsZikpIHtcbiAgICAgIGNvbnN0IGlkcyA9IHNlbGYuX19pZHM7XG4gICAgICBzZWxmLl9faWRzID0gaWRzO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGlkID09PSBpZHNbaV0pIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlkcy5wdXNoKGlkKTtcbiAgICB9XG4gIH1cbiAgZGVsZXRlSUQoaWQpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcy5nZXRXcml0YWJsZSgpO1xuICAgIGlmICgkaXNUaHJlYWRNYXJrTm9kZShzZWxmKSkge1xuICAgICAgY29uc3QgaWRzID0gc2VsZi5fX2lkcztcbiAgICAgIHNlbGYuX19pZHMgPSBpZHM7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaWQgPT09IGlkc1tpXSkge1xuICAgICAgICAgIGlkcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGluc2VydE5ld0FmdGVyKF8sIHJlc3RvcmVTZWxlY3Rpb24gPSB0cnVlKSB7XG4gICAgY29uc3QgbWFya05vZGUgPSAkY3JlYXRlVGhyZWFkTWFya05vZGUodGhpcy5fX2lkcyk7XG4gICAgdGhpcy5pbnNlcnRBZnRlcihtYXJrTm9kZSwgcmVzdG9yZVNlbGVjdGlvbik7XG4gICAgcmV0dXJuIG1hcmtOb2RlO1xuICB9XG4gIGNhbkluc2VydFRleHRCZWZvcmUoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNhbkluc2VydFRleHRBZnRlcigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY2FuQmVFbXB0eSgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaXNJbmxpbmUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgZXh0cmFjdFdpdGhDaGlsZChfLCBzZWxlY3Rpb24sIGRlc3RpbmF0aW9uKSB7XG4gICAgaWYgKCEkaXNSYW5nZVNlbGVjdGlvbihzZWxlY3Rpb24pIHx8IGRlc3RpbmF0aW9uID09PSBcImh0bWxcIikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBhbmNob3IgPSBzZWxlY3Rpb24uYW5jaG9yO1xuICAgIGNvbnN0IGZvY3VzID0gc2VsZWN0aW9uLmZvY3VzO1xuICAgIGNvbnN0IGFuY2hvck5vZGUgPSBhbmNob3IuZ2V0Tm9kZSgpO1xuICAgIGNvbnN0IGZvY3VzTm9kZSA9IGZvY3VzLmdldE5vZGUoKTtcbiAgICBjb25zdCBpc0JhY2t3YXJkID0gc2VsZWN0aW9uLmlzQmFja3dhcmQoKTtcbiAgICBjb25zdCBzZWxlY3Rpb25MZW5ndGggPSBpc0JhY2t3YXJkID8gYW5jaG9yLm9mZnNldCAtIGZvY3VzLm9mZnNldCA6IGZvY3VzLm9mZnNldCAtIGFuY2hvci5vZmZzZXQ7XG4gICAgcmV0dXJuIHRoaXMuaXNQYXJlbnRPZihhbmNob3JOb2RlKSAmJiB0aGlzLmlzUGFyZW50T2YoZm9jdXNOb2RlKSAmJiB0aGlzLmdldFRleHRDb250ZW50KCkubGVuZ3RoID09PSBzZWxlY3Rpb25MZW5ndGg7XG4gIH1cbiAgZXhjbHVkZUZyb21Db3B5KGRlc3RpbmF0aW9uKSB7XG4gICAgcmV0dXJuIGRlc3RpbmF0aW9uICE9PSBcImNsb25lXCI7XG4gIH1cbn1cbmZ1bmN0aW9uICRjcmVhdGVUaHJlYWRNYXJrTm9kZShpZHMpIHtcbiAgcmV0dXJuICRhcHBseU5vZGVSZXBsYWNlbWVudChuZXcgVGhyZWFkTWFya05vZGUoaWRzKSk7XG59XG5mdW5jdGlvbiAkaXNUaHJlYWRNYXJrTm9kZShub2RlKSB7XG4gIHJldHVybiBub2RlIGluc3RhbmNlb2YgVGhyZWFkTWFya05vZGU7XG59XG5cbmV4cG9ydCB7ICRjcmVhdGVUaHJlYWRNYXJrTm9kZSwgJGlzVGhyZWFkTWFya05vZGUsIFRocmVhZE1hcmtOb2RlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD10aHJlYWQtbWFyay1ub2RlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/unwrap-thread-mark-node.mjs":
/*!******************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/unwrap-thread-mark-node.mjs ***!
  \******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ $unwrapThreadMarkNode)\n/* harmony export */ });\nfunction $unwrapThreadMarkNode(node) {\n  const children = node.getChildren();\n  let target = null;\n  for (let i = 0; i < children.length; i++) {\n    const child = children[i];\n    if (target === null) {\n      node.insertBefore(child);\n    } else {\n      target.insertAfter(child);\n    }\n    target = child;\n  }\n  node.remove();\n}\n\n\n//# sourceMappingURL=unwrap-thread-mark-node.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL3Vud3JhcC10aHJlYWQtbWFyay1ub2RlLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHFCQUFxQjtBQUN2QztBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU0QztBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LWxleGljYWwvZGlzdC9jb21tZW50cy91bndyYXAtdGhyZWFkLW1hcmstbm9kZS5tanM/OGM4YiJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiAkdW53cmFwVGhyZWFkTWFya05vZGUobm9kZSkge1xuICBjb25zdCBjaGlsZHJlbiA9IG5vZGUuZ2V0Q2hpbGRyZW4oKTtcbiAgbGV0IHRhcmdldCA9IG51bGw7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuW2ldO1xuICAgIGlmICh0YXJnZXQgPT09IG51bGwpIHtcbiAgICAgIG5vZGUuaW5zZXJ0QmVmb3JlKGNoaWxkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFyZ2V0Lmluc2VydEFmdGVyKGNoaWxkKTtcbiAgICB9XG4gICAgdGFyZ2V0ID0gY2hpbGQ7XG4gIH1cbiAgbm9kZS5yZW1vdmUoKTtcbn1cblxuZXhwb3J0IHsgJHVud3JhcFRocmVhZE1hcmtOb2RlIGFzIGRlZmF1bHQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVud3JhcC10aHJlYWQtbWFyay1ub2RlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/unwrap-thread-mark-node.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/wrap-selection-in-thread-mark-node.mjs":
/*!*****************************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/comments/wrap-selection-in-thread-mark-node.mjs ***!
  \*****************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ $wrapSelectionInThreadMarkNode)\n/* harmony export */ });\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var _thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\");\n\n\n\nfunction $wrapSelectionInThreadMarkNode(selection, isBackward, id, createNode) {\n  const nodes = selection.getNodes();\n  const anchorOffset = selection.anchor.offset;\n  const focusOffset = selection.focus.offset;\n  const nodesLength = nodes.length;\n  const startOffset = isBackward ? focusOffset : anchorOffset;\n  const endOffset = isBackward ? anchorOffset : focusOffset;\n  let currentNodeParent;\n  let lastCreatedMarkNode;\n  for (let i = 0; i < nodesLength; i++) {\n    const node = nodes[i];\n    if ((0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isElementNode)(lastCreatedMarkNode) && lastCreatedMarkNode.isParentOf(node)) {\n      continue;\n    }\n    const isFirstNode = i === 0;\n    const isLastNode = i === nodesLength - 1;\n    let targetNode = null;\n    if ((0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isTextNode)(node)) {\n      const textContentSize = node.getTextContentSize();\n      const startTextOffset = isFirstNode ? startOffset : 0;\n      const endTextOffset = isLastNode ? endOffset : textContentSize;\n      if (startTextOffset === 0 && endTextOffset === 0) {\n        continue;\n      }\n      const splitNodes = node.splitText(startTextOffset, endTextOffset);\n      targetNode = splitNodes.length > 1 && (splitNodes.length === 3 || isFirstNode && !isLastNode || endTextOffset === textContentSize) ? splitNodes[1] : splitNodes[0];\n    } else if ((0,_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_1__.$isThreadMarkNode)(node)) {\n      continue;\n    } else if ((0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isElementNode)(node) && node.isInline()) {\n      targetNode = node;\n    }\n    if (targetNode !== null) {\n      if (targetNode && targetNode.is(currentNodeParent)) {\n        continue;\n      }\n      const parentNode = targetNode.getParent();\n      if (parentNode === null || !parentNode.is(currentNodeParent)) {\n        lastCreatedMarkNode = void 0;\n      }\n      currentNodeParent = parentNode;\n      if (lastCreatedMarkNode === void 0) {\n        const createMarkNode = createNode || _thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_1__.$createThreadMarkNode;\n        lastCreatedMarkNode = createMarkNode([id]);\n        targetNode.insertBefore(lastCreatedMarkNode);\n      }\n      lastCreatedMarkNode.append(targetNode);\n    } else {\n      currentNodeParent = void 0;\n      lastCreatedMarkNode = void 0;\n    }\n  }\n  if ((0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isElementNode)(lastCreatedMarkNode)) {\n    isBackward ? lastCreatedMarkNode.selectStart() : lastCreatedMarkNode.selectEnd();\n  }\n}\n\n\n//# sourceMappingURL=wrap-selection-in-thread-mark-node.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NvbW1lbnRzL3dyYXAtc2VsZWN0aW9uLWluLXRocmVhZC1tYXJrLW5vZGUubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFzRDtBQUM0Qjs7QUFFbEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlCQUFpQjtBQUNuQztBQUNBLFFBQVEsdURBQWM7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsb0RBQVc7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sU0FBUyx3RUFBaUI7QUFDaEM7QUFDQSxNQUFNLFNBQVMsdURBQWM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLHdFQUFxQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sdURBQWM7QUFDcEI7QUFDQTtBQUNBOztBQUVxRDtBQUNyRCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LWxleGljYWwvZGlzdC9jb21tZW50cy93cmFwLXNlbGVjdGlvbi1pbi10aHJlYWQtbWFyay1ub2RlLm1qcz81YThhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ICRpc0VsZW1lbnROb2RlLCAkaXNUZXh0Tm9kZSB9IGZyb20gJ2xleGljYWwnO1xuaW1wb3J0IHsgJGlzVGhyZWFkTWFya05vZGUsICRjcmVhdGVUaHJlYWRNYXJrTm9kZSB9IGZyb20gJy4vdGhyZWFkLW1hcmstbm9kZS5tanMnO1xuXG5mdW5jdGlvbiAkd3JhcFNlbGVjdGlvbkluVGhyZWFkTWFya05vZGUoc2VsZWN0aW9uLCBpc0JhY2t3YXJkLCBpZCwgY3JlYXRlTm9kZSkge1xuICBjb25zdCBub2RlcyA9IHNlbGVjdGlvbi5nZXROb2RlcygpO1xuICBjb25zdCBhbmNob3JPZmZzZXQgPSBzZWxlY3Rpb24uYW5jaG9yLm9mZnNldDtcbiAgY29uc3QgZm9jdXNPZmZzZXQgPSBzZWxlY3Rpb24uZm9jdXMub2Zmc2V0O1xuICBjb25zdCBub2Rlc0xlbmd0aCA9IG5vZGVzLmxlbmd0aDtcbiAgY29uc3Qgc3RhcnRPZmZzZXQgPSBpc0JhY2t3YXJkID8gZm9jdXNPZmZzZXQgOiBhbmNob3JPZmZzZXQ7XG4gIGNvbnN0IGVuZE9mZnNldCA9IGlzQmFja3dhcmQgPyBhbmNob3JPZmZzZXQgOiBmb2N1c09mZnNldDtcbiAgbGV0IGN1cnJlbnROb2RlUGFyZW50O1xuICBsZXQgbGFzdENyZWF0ZWRNYXJrTm9kZTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlc0xlbmd0aDsgaSsrKSB7XG4gICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldO1xuICAgIGlmICgkaXNFbGVtZW50Tm9kZShsYXN0Q3JlYXRlZE1hcmtOb2RlKSAmJiBsYXN0Q3JlYXRlZE1hcmtOb2RlLmlzUGFyZW50T2Yobm9kZSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBpc0ZpcnN0Tm9kZSA9IGkgPT09IDA7XG4gICAgY29uc3QgaXNMYXN0Tm9kZSA9IGkgPT09IG5vZGVzTGVuZ3RoIC0gMTtcbiAgICBsZXQgdGFyZ2V0Tm9kZSA9IG51bGw7XG4gICAgaWYgKCRpc1RleHROb2RlKG5vZGUpKSB7XG4gICAgICBjb25zdCB0ZXh0Q29udGVudFNpemUgPSBub2RlLmdldFRleHRDb250ZW50U2l6ZSgpO1xuICAgICAgY29uc3Qgc3RhcnRUZXh0T2Zmc2V0ID0gaXNGaXJzdE5vZGUgPyBzdGFydE9mZnNldCA6IDA7XG4gICAgICBjb25zdCBlbmRUZXh0T2Zmc2V0ID0gaXNMYXN0Tm9kZSA/IGVuZE9mZnNldCA6IHRleHRDb250ZW50U2l6ZTtcbiAgICAgIGlmIChzdGFydFRleHRPZmZzZXQgPT09IDAgJiYgZW5kVGV4dE9mZnNldCA9PT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNwbGl0Tm9kZXMgPSBub2RlLnNwbGl0VGV4dChzdGFydFRleHRPZmZzZXQsIGVuZFRleHRPZmZzZXQpO1xuICAgICAgdGFyZ2V0Tm9kZSA9IHNwbGl0Tm9kZXMubGVuZ3RoID4gMSAmJiAoc3BsaXROb2Rlcy5sZW5ndGggPT09IDMgfHwgaXNGaXJzdE5vZGUgJiYgIWlzTGFzdE5vZGUgfHwgZW5kVGV4dE9mZnNldCA9PT0gdGV4dENvbnRlbnRTaXplKSA/IHNwbGl0Tm9kZXNbMV0gOiBzcGxpdE5vZGVzWzBdO1xuICAgIH0gZWxzZSBpZiAoJGlzVGhyZWFkTWFya05vZGUobm9kZSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSBpZiAoJGlzRWxlbWVudE5vZGUobm9kZSkgJiYgbm9kZS5pc0lubGluZSgpKSB7XG4gICAgICB0YXJnZXROb2RlID0gbm9kZTtcbiAgICB9XG4gICAgaWYgKHRhcmdldE5vZGUgIT09IG51bGwpIHtcbiAgICAgIGlmICh0YXJnZXROb2RlICYmIHRhcmdldE5vZGUuaXMoY3VycmVudE5vZGVQYXJlbnQpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFyZW50Tm9kZSA9IHRhcmdldE5vZGUuZ2V0UGFyZW50KCk7XG4gICAgICBpZiAocGFyZW50Tm9kZSA9PT0gbnVsbCB8fCAhcGFyZW50Tm9kZS5pcyhjdXJyZW50Tm9kZVBhcmVudCkpIHtcbiAgICAgICAgbGFzdENyZWF0ZWRNYXJrTm9kZSA9IHZvaWQgMDtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnROb2RlUGFyZW50ID0gcGFyZW50Tm9kZTtcbiAgICAgIGlmIChsYXN0Q3JlYXRlZE1hcmtOb2RlID09PSB2b2lkIDApIHtcbiAgICAgICAgY29uc3QgY3JlYXRlTWFya05vZGUgPSBjcmVhdGVOb2RlIHx8ICRjcmVhdGVUaHJlYWRNYXJrTm9kZTtcbiAgICAgICAgbGFzdENyZWF0ZWRNYXJrTm9kZSA9IGNyZWF0ZU1hcmtOb2RlKFtpZF0pO1xuICAgICAgICB0YXJnZXROb2RlLmluc2VydEJlZm9yZShsYXN0Q3JlYXRlZE1hcmtOb2RlKTtcbiAgICAgIH1cbiAgICAgIGxhc3RDcmVhdGVkTWFya05vZGUuYXBwZW5kKHRhcmdldE5vZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXJyZW50Tm9kZVBhcmVudCA9IHZvaWQgMDtcbiAgICAgIGxhc3RDcmVhdGVkTWFya05vZGUgPSB2b2lkIDA7XG4gICAgfVxuICB9XG4gIGlmICgkaXNFbGVtZW50Tm9kZShsYXN0Q3JlYXRlZE1hcmtOb2RlKSkge1xuICAgIGlzQmFja3dhcmQgPyBsYXN0Q3JlYXRlZE1hcmtOb2RlLnNlbGVjdFN0YXJ0KCkgOiBsYXN0Q3JlYXRlZE1hcmtOb2RlLnNlbGVjdEVuZCgpO1xuICB9XG59XG5cbmV4cG9ydCB7ICR3cmFwU2VsZWN0aW9uSW5UaHJlYWRNYXJrTm9kZSBhcyBkZWZhdWx0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD13cmFwLXNlbGVjdGlvbi1pbi10aHJlYWQtbWFyay1ub2RlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/wrap-selection-in-thread-mark-node.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/create-dom-range.mjs":
/*!**************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/create-dom-range.mjs ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDOMRange: () => (/* binding */ createDOMRange)\n/* harmony export */ });\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n\n\nfunction getDOMTextNode(element) {\n  let node = element;\n  while (node !== null) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      return node;\n    }\n    node = node.firstChild;\n  }\n  return null;\n}\nfunction getDOMIndexWithinParent(node) {\n  const parent = node.parentNode;\n  if (parent === null) {\n    throw new Error(\"Should never happen\");\n  }\n  return [parent, Array.from(parent.childNodes).indexOf(node)];\n}\nfunction createDOMRange(editor, anchorNode, _anchorOffset, focusNode, _focusOffset) {\n  const anchorKey = anchorNode.getKey();\n  const focusKey = focusNode.getKey();\n  const range = document.createRange();\n  let anchorDOM = editor.getElementByKey(anchorKey);\n  let focusDOM = editor.getElementByKey(focusKey);\n  let anchorOffset = _anchorOffset;\n  let focusOffset = _focusOffset;\n  if ((0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isTextNode)(anchorNode)) {\n    anchorDOM = getDOMTextNode(anchorDOM);\n  }\n  if ((0,lexical__WEBPACK_IMPORTED_MODULE_0__.$isTextNode)(focusNode)) {\n    focusDOM = getDOMTextNode(focusDOM);\n  }\n  if (anchorNode === void 0 || focusNode === void 0 || anchorDOM === null || focusDOM === null) {\n    return null;\n  }\n  if (anchorDOM.nodeName === \"BR\") {\n    [anchorDOM, anchorOffset] = getDOMIndexWithinParent(anchorDOM);\n  }\n  if (focusDOM.nodeName === \"BR\") {\n    [focusDOM, focusOffset] = getDOMIndexWithinParent(focusDOM);\n  }\n  const firstChild = anchorDOM.firstChild;\n  if (anchorDOM === focusDOM && firstChild !== null && firstChild.nodeName === \"BR\" && anchorOffset === 0 && focusOffset === 0) {\n    focusOffset = 1;\n  }\n  try {\n    range.setStart(anchorDOM, anchorOffset);\n    range.setEnd(focusDOM, focusOffset);\n  } catch (e) {\n    return null;\n  }\n  if (range.collapsed && (anchorOffset !== focusOffset || anchorKey !== focusKey)) {\n    range.setStart(focusDOM, focusOffset);\n    range.setEnd(anchorDOM, anchorOffset);\n  }\n  return range;\n}\n\n\n//# sourceMappingURL=create-dom-range.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NyZWF0ZS1kb20tcmFuZ2UubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXNDOztBQUV0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sb0RBQVc7QUFDakI7QUFDQTtBQUNBLE1BQU0sb0RBQVc7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTBCO0FBQzFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NyZWF0ZS1kb20tcmFuZ2UubWpzPzliMGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgJGlzVGV4dE5vZGUgfSBmcm9tICdsZXhpY2FsJztcblxuZnVuY3Rpb24gZ2V0RE9NVGV4dE5vZGUoZWxlbWVudCkge1xuICBsZXQgbm9kZSA9IGVsZW1lbnQ7XG4gIHdoaWxlIChub2RlICE9PSBudWxsKSB7XG4gICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKSB7XG4gICAgICByZXR1cm4gbm9kZTtcbiAgICB9XG4gICAgbm9kZSA9IG5vZGUuZmlyc3RDaGlsZDtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cbmZ1bmN0aW9uIGdldERPTUluZGV4V2l0aGluUGFyZW50KG5vZGUpIHtcbiAgY29uc3QgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuICBpZiAocGFyZW50ID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5ldmVyIGhhcHBlblwiKTtcbiAgfVxuICByZXR1cm4gW3BhcmVudCwgQXJyYXkuZnJvbShwYXJlbnQuY2hpbGROb2RlcykuaW5kZXhPZihub2RlKV07XG59XG5mdW5jdGlvbiBjcmVhdGVET01SYW5nZShlZGl0b3IsIGFuY2hvck5vZGUsIF9hbmNob3JPZmZzZXQsIGZvY3VzTm9kZSwgX2ZvY3VzT2Zmc2V0KSB7XG4gIGNvbnN0IGFuY2hvcktleSA9IGFuY2hvck5vZGUuZ2V0S2V5KCk7XG4gIGNvbnN0IGZvY3VzS2V5ID0gZm9jdXNOb2RlLmdldEtleSgpO1xuICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gIGxldCBhbmNob3JET00gPSBlZGl0b3IuZ2V0RWxlbWVudEJ5S2V5KGFuY2hvcktleSk7XG4gIGxldCBmb2N1c0RPTSA9IGVkaXRvci5nZXRFbGVtZW50QnlLZXkoZm9jdXNLZXkpO1xuICBsZXQgYW5jaG9yT2Zmc2V0ID0gX2FuY2hvck9mZnNldDtcbiAgbGV0IGZvY3VzT2Zmc2V0ID0gX2ZvY3VzT2Zmc2V0O1xuICBpZiAoJGlzVGV4dE5vZGUoYW5jaG9yTm9kZSkpIHtcbiAgICBhbmNob3JET00gPSBnZXRET01UZXh0Tm9kZShhbmNob3JET00pO1xuICB9XG4gIGlmICgkaXNUZXh0Tm9kZShmb2N1c05vZGUpKSB7XG4gICAgZm9jdXNET00gPSBnZXRET01UZXh0Tm9kZShmb2N1c0RPTSk7XG4gIH1cbiAgaWYgKGFuY2hvck5vZGUgPT09IHZvaWQgMCB8fCBmb2N1c05vZGUgPT09IHZvaWQgMCB8fCBhbmNob3JET00gPT09IG51bGwgfHwgZm9jdXNET00gPT09IG51bGwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBpZiAoYW5jaG9yRE9NLm5vZGVOYW1lID09PSBcIkJSXCIpIHtcbiAgICBbYW5jaG9yRE9NLCBhbmNob3JPZmZzZXRdID0gZ2V0RE9NSW5kZXhXaXRoaW5QYXJlbnQoYW5jaG9yRE9NKTtcbiAgfVxuICBpZiAoZm9jdXNET00ubm9kZU5hbWUgPT09IFwiQlJcIikge1xuICAgIFtmb2N1c0RPTSwgZm9jdXNPZmZzZXRdID0gZ2V0RE9NSW5kZXhXaXRoaW5QYXJlbnQoZm9jdXNET00pO1xuICB9XG4gIGNvbnN0IGZpcnN0Q2hpbGQgPSBhbmNob3JET00uZmlyc3RDaGlsZDtcbiAgaWYgKGFuY2hvckRPTSA9PT0gZm9jdXNET00gJiYgZmlyc3RDaGlsZCAhPT0gbnVsbCAmJiBmaXJzdENoaWxkLm5vZGVOYW1lID09PSBcIkJSXCIgJiYgYW5jaG9yT2Zmc2V0ID09PSAwICYmIGZvY3VzT2Zmc2V0ID09PSAwKSB7XG4gICAgZm9jdXNPZmZzZXQgPSAxO1xuICB9XG4gIHRyeSB7XG4gICAgcmFuZ2Uuc2V0U3RhcnQoYW5jaG9yRE9NLCBhbmNob3JPZmZzZXQpO1xuICAgIHJhbmdlLnNldEVuZChmb2N1c0RPTSwgZm9jdXNPZmZzZXQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgaWYgKHJhbmdlLmNvbGxhcHNlZCAmJiAoYW5jaG9yT2Zmc2V0ICE9PSBmb2N1c09mZnNldCB8fCBhbmNob3JLZXkgIT09IGZvY3VzS2V5KSkge1xuICAgIHJhbmdlLnNldFN0YXJ0KGZvY3VzRE9NLCBmb2N1c09mZnNldCk7XG4gICAgcmFuZ2Uuc2V0RW5kKGFuY2hvckRPTSwgYW5jaG9yT2Zmc2V0KTtcbiAgfVxuICByZXR1cm4gcmFuZ2U7XG59XG5cbmV4cG9ydCB7IGNyZWF0ZURPTVJhbmdlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jcmVhdGUtZG9tLXJhbmdlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/create-dom-range.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/create-rects-from-dom-range.mjs":
/*!*************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/create-rects-from-dom-range.mjs ***!
  \*************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createRectsFromDOMRange: () => (/* binding */ createRectsFromDOMRange)\n/* harmony export */ });\nfunction createRectsFromDOMRange(editor, range) {\n  const rootElement = editor.getRootElement();\n  if (rootElement === null) {\n    return [];\n  }\n  const rootRect = rootElement.getBoundingClientRect();\n  const computedStyle = getComputedStyle(rootElement);\n  const rootPadding = parseFloat(computedStyle.paddingLeft) + parseFloat(computedStyle.paddingRight);\n  const selectionRects = Array.from(range.getClientRects());\n  let selectionRectsLength = selectionRects.length;\n  selectionRects.sort((a, b) => {\n    const top = a.top - b.top;\n    if (Math.abs(top) <= 3) {\n      return a.left - b.left;\n    }\n    return top;\n  });\n  let prevRect;\n  for (let i = 0; i < selectionRectsLength; i++) {\n    const selectionRect = selectionRects[i];\n    const isOverlappingRect = prevRect && prevRect.top <= selectionRect.top && prevRect.top + prevRect.height > selectionRect.top && prevRect.left + prevRect.width > selectionRect.left;\n    const selectionSpansElement = selectionRect.width + rootPadding === rootRect.width;\n    if (isOverlappingRect || selectionSpansElement) {\n      selectionRects.splice(i--, 1);\n      selectionRectsLength--;\n      continue;\n    }\n    prevRect = selectionRect;\n  }\n  return selectionRects;\n}\n\n\n//# sourceMappingURL=create-rects-from-dom-range.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NyZWF0ZS1yZWN0cy1mcm9tLWRvbS1yYW5nZS5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0Esa0JBQWtCLDBCQUEwQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRW1DO0FBQ25DIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2NyZWF0ZS1yZWN0cy1mcm9tLWRvbS1yYW5nZS5tanM/NGI5MSJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBjcmVhdGVSZWN0c0Zyb21ET01SYW5nZShlZGl0b3IsIHJhbmdlKSB7XG4gIGNvbnN0IHJvb3RFbGVtZW50ID0gZWRpdG9yLmdldFJvb3RFbGVtZW50KCk7XG4gIGlmIChyb290RWxlbWVudCA9PT0gbnVsbCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBjb25zdCByb290UmVjdCA9IHJvb3RFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBjb25zdCBjb21wdXRlZFN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShyb290RWxlbWVudCk7XG4gIGNvbnN0IHJvb3RQYWRkaW5nID0gcGFyc2VGbG9hdChjb21wdXRlZFN0eWxlLnBhZGRpbmdMZWZ0KSArIHBhcnNlRmxvYXQoY29tcHV0ZWRTdHlsZS5wYWRkaW5nUmlnaHQpO1xuICBjb25zdCBzZWxlY3Rpb25SZWN0cyA9IEFycmF5LmZyb20ocmFuZ2UuZ2V0Q2xpZW50UmVjdHMoKSk7XG4gIGxldCBzZWxlY3Rpb25SZWN0c0xlbmd0aCA9IHNlbGVjdGlvblJlY3RzLmxlbmd0aDtcbiAgc2VsZWN0aW9uUmVjdHMuc29ydCgoYSwgYikgPT4ge1xuICAgIGNvbnN0IHRvcCA9IGEudG9wIC0gYi50b3A7XG4gICAgaWYgKE1hdGguYWJzKHRvcCkgPD0gMykge1xuICAgICAgcmV0dXJuIGEubGVmdCAtIGIubGVmdDtcbiAgICB9XG4gICAgcmV0dXJuIHRvcDtcbiAgfSk7XG4gIGxldCBwcmV2UmVjdDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3Rpb25SZWN0c0xlbmd0aDsgaSsrKSB7XG4gICAgY29uc3Qgc2VsZWN0aW9uUmVjdCA9IHNlbGVjdGlvblJlY3RzW2ldO1xuICAgIGNvbnN0IGlzT3ZlcmxhcHBpbmdSZWN0ID0gcHJldlJlY3QgJiYgcHJldlJlY3QudG9wIDw9IHNlbGVjdGlvblJlY3QudG9wICYmIHByZXZSZWN0LnRvcCArIHByZXZSZWN0LmhlaWdodCA+IHNlbGVjdGlvblJlY3QudG9wICYmIHByZXZSZWN0LmxlZnQgKyBwcmV2UmVjdC53aWR0aCA+IHNlbGVjdGlvblJlY3QubGVmdDtcbiAgICBjb25zdCBzZWxlY3Rpb25TcGFuc0VsZW1lbnQgPSBzZWxlY3Rpb25SZWN0LndpZHRoICsgcm9vdFBhZGRpbmcgPT09IHJvb3RSZWN0LndpZHRoO1xuICAgIGlmIChpc092ZXJsYXBwaW5nUmVjdCB8fCBzZWxlY3Rpb25TcGFuc0VsZW1lbnQpIHtcbiAgICAgIHNlbGVjdGlvblJlY3RzLnNwbGljZShpLS0sIDEpO1xuICAgICAgc2VsZWN0aW9uUmVjdHNMZW5ndGgtLTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBwcmV2UmVjdCA9IHNlbGVjdGlvblJlY3Q7XG4gIH1cbiAgcmV0dXJuIHNlbGVjdGlvblJlY3RzO1xufVxuXG5leHBvcnQgeyBjcmVhdGVSZWN0c0Zyb21ET01SYW5nZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y3JlYXRlLXJlY3RzLWZyb20tZG9tLXJhbmdlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/create-rects-from-dom-range.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/liveblocks-config.mjs":
/*!***************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/liveblocks-config.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   liveblocksConfig: () => (/* binding */ liveblocksConfig)\n/* harmony export */ });\n/* harmony import */ var _comments_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./comments/thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\");\n/* harmony import */ var _mentions_mention_node_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./mentions/mention-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-node.mjs\");\n\n\n\nfunction liveblocksConfig(editorConfig) {\n  const nodes = [...editorConfig.nodes ?? []];\n  nodes.push(_comments_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_0__.ThreadMarkNode, _mentions_mention_node_mjs__WEBPACK_IMPORTED_MODULE_1__.MentionNode);\n  return {\n    ...editorConfig,\n    nodes,\n    editorState: null\n  };\n}\n\n\n//# sourceMappingURL=liveblocks-config.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2xpdmVibG9ja3MtY29uZmlnLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBaUU7QUFDUDs7QUFFMUQ7QUFDQTtBQUNBLGFBQWEsMEVBQWMsRUFBRSxtRUFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTRCO0FBQzVCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2xpdmVibG9ja3MtY29uZmlnLm1qcz9kMTYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRocmVhZE1hcmtOb2RlIH0gZnJvbSAnLi9jb21tZW50cy90aHJlYWQtbWFyay1ub2RlLm1qcyc7XG5pbXBvcnQgeyBNZW50aW9uTm9kZSB9IGZyb20gJy4vbWVudGlvbnMvbWVudGlvbi1ub2RlLm1qcyc7XG5cbmZ1bmN0aW9uIGxpdmVibG9ja3NDb25maWcoZWRpdG9yQ29uZmlnKSB7XG4gIGNvbnN0IG5vZGVzID0gWy4uLmVkaXRvckNvbmZpZy5ub2RlcyA/PyBbXV07XG4gIG5vZGVzLnB1c2goVGhyZWFkTWFya05vZGUsIE1lbnRpb25Ob2RlKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5lZGl0b3JDb25maWcsXG4gICAgbm9kZXMsXG4gICAgZWRpdG9yU3RhdGU6IG51bGxcbiAgfTtcbn1cblxuZXhwb3J0IHsgbGl2ZWJsb2Nrc0NvbmZpZyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGl2ZWJsb2Nrcy1jb25maWcubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/liveblocks-config.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/liveblocks-plugin-provider.mjs":
/*!************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/liveblocks-plugin-provider.mjs ***!
  \************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LiveblocksPlugin: () => (/* binding */ LiveblocksPlugin),\n/* harmony export */   useEditorStatus: () => (/* binding */ useEditorStatus),\n/* harmony export */   useRootElement: () => (/* binding */ useRootElement)\n/* harmony export */ });\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs\");\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var _lexical_react_LexicalCollaborationContext__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @lexical/react/LexicalCollaborationContext */ \"(ssr)/./node_modules/@lexical/react/LexicalCollaborationContext.dev.mjs\");\n/* harmony import */ var _lexical_react_LexicalCollaborationPlugin__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @lexical/react/LexicalCollaborationPlugin */ \"(ssr)/./node_modules/@lexical/react/LexicalCollaborationPlugin.dev.mjs\");\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _liveblocks_yjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @liveblocks/yjs */ \"(ssr)/./node_modules/@liveblocks/yjs/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! use-sync-external-store/shim/index.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/index.js\");\n/* harmony import */ var yjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! yjs */ \"(ssr)/./node_modules/yjs/dist/yjs.mjs\");\n/* harmony import */ var _comments_comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./comments/comment-plugin-provider.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/comment-plugin-provider.mjs\");\n/* harmony import */ var _comments_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./comments/thread-mark-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/comments/thread-mark-node.mjs\");\n/* harmony import */ var _mentions_mention_node_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./mentions/mention-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-node.mjs\");\n/* harmony import */ var _mentions_mention_plugin_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./mentions/mention-plugin.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-plugin.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst providersMap = /* @__PURE__ */ new Map();\nfunction getEditorStatus(provider) {\n  if (provider === void 0) {\n    return \"not-loaded\";\n  }\n  return provider.synced ? \"synchronized\" : \"loading\";\n}\nfunction useEditorStatus() {\n  const room = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__._useRoom)();\n  const provider = providersMap.get(room.id);\n  const [status, setStatus] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(getEditorStatus(provider));\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    const provider2 = providersMap.get(room.id);\n    setStatus(getEditorStatus(provider2));\n    if (provider2 === void 0) {\n      return;\n    }\n    const cb = () => setStatus(getEditorStatus(provider2));\n    provider2.on(\"sync\", cb);\n    return () => provider2.off(\"sync\", cb);\n  }, [room]);\n  return status;\n}\nconst LiveblocksPlugin = ({\n  children\n}) => {\n  const client = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__.useClient)();\n  const hasResolveMentionSuggestions = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].resolveMentionSuggestions !== void 0;\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_4__.useLexicalComposerContext)();\n  const room = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__._useRoom)();\n  const collabContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_lexical_react_LexicalCollaborationContext__WEBPACK_IMPORTED_MODULE_5__.CollaborationContext);\n  const previousRoomIdRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  if (!editor.hasNodes([_comments_thread_mark_node_mjs__WEBPACK_IMPORTED_MODULE_6__.ThreadMarkNode, _mentions_mention_node_mjs__WEBPACK_IMPORTED_MODULE_7__.MentionNode])) {\n    throw new Error(\n      \"LiveblocksPlugin requires Lexical configuration to be wrapped in the `liveblocksConfig(options)` function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-react-lexical#liveblocksConfig\"\n    );\n  }\n  const [containerRef, setContainerRef] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(void 0);\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y\n  } = (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_8__.useFloating)({\n    strategy: \"fixed\",\n    placement: \"bottom\",\n    whileElementsMounted: (...args) => {\n      return (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_9__.autoUpdate)(...args, {\n        animationFrame: true\n      });\n    }\n  });\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if (true) {\n      if (!editor.getEditorState().isEmpty()) {\n        console.warn(\n          \"Warning: LiveblocksPlugin: editorState in initialConfig detected, but must be null.\"\n        );\n      }\n    }\n  }, []);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    room[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].reportTextEditor(\"lexical\", \"root\");\n  }, [room]);\n  const info = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__._useSelf)((me) => me.info);\n  const username = info?.name || \"\";\n  const cursorcolor = info?.color;\n  const providerFactory = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (id, yjsDocMap) => {\n      if (previousRoomIdRef.current !== null && previousRoomIdRef.current !== id) {\n        const previousProvider = providersMap.get(id);\n        if (previousProvider !== void 0) {\n          previousProvider.destroy();\n        }\n      }\n      let doc = yjsDocMap.get(id);\n      if (doc === void 0) {\n        doc = new yjs__WEBPACK_IMPORTED_MODULE_10__.Doc();\n        const provider = new _liveblocks_yjs__WEBPACK_IMPORTED_MODULE_11__.LiveblocksYjsProvider(room, doc);\n        yjsDocMap.set(id, doc);\n        providersMap.set(id, provider);\n      }\n      return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nn)(\n        providersMap.get(id),\n        \"Internal error. Should never happen\"\n      );\n    },\n    [room]\n  );\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    collabContext.name = username || \"\";\n  }, [collabContext, username]);\n  const root = useRootElement();\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {\n    if (root === null)\n      return;\n    setReference({\n      getBoundingClientRect: () => root.getBoundingClientRect()\n    });\n  }, [setReference, root]);\n  const handleFloatingRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (node) => {\n      setFloating(node);\n      setContainerRef({ current: node });\n    },\n    [setFloating, setContainerRef]\n  );\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    ref: handleFloatingRef,\n    style: {\n      position: strategy,\n      top: 0,\n      left: 0,\n      transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n      minWidth: \"max-content\"\n    }\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_lexical_react_LexicalCollaborationPlugin__WEBPACK_IMPORTED_MODULE_12__.CollaborationPlugin, {\n    key: room.id,\n    id: room.id,\n    providerFactory,\n    username,\n    cursorColor: cursorcolor,\n    cursorsContainerRef: containerRef,\n    shouldBootstrap: true\n  }), hasResolveMentionSuggestions && /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mentions_mention_plugin_mjs__WEBPACK_IMPORTED_MODULE_13__.MentionPlugin, null), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_comments_comment_plugin_provider_mjs__WEBPACK_IMPORTED_MODULE_14__.CommentPluginProvider, null, children));\n};\nfunction useRootElement() {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_4__.useLexicalComposerContext)();\n  const subscribe = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (onStoreChange) => {\n      return editor.registerRootListener(onStoreChange);\n    },\n    [editor]\n  );\n  const getSnapshot = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    return editor.getRootElement();\n  }, [editor]);\n  return (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStore)(subscribe, getSnapshot, getSnapshot);\n}\n\n\n//# sourceMappingURL=liveblocks-plugin-provider.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L2xpdmVibG9ja3MtcGx1Z2luLXByb3ZpZGVyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBaUU7QUFDaUI7QUFDRjtBQUNFO0FBQ2pDO0FBQ2U7QUFDUjtBQUNzRDtBQUNqQztBQUNuRDtBQUNxRDtBQUNkO0FBQ1A7QUFDSTs7QUFFOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsMkRBQU87QUFDdEI7QUFDQSw4QkFBOEIsK0NBQVE7QUFDdEMsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsaUJBQWlCLDREQUFTO0FBQzFCLDhDQUE4Qyx1REFBUztBQUN2RCxtQkFBbUIsZ0dBQXlCO0FBQzVDLGVBQWUsMkRBQU87QUFDdEIsd0JBQXdCLGlEQUFVLENBQUMsNEZBQW9CO0FBQ3ZELDRCQUE0Qiw2Q0FBTTtBQUNsQyx3QkFBd0IsMEVBQWMsRUFBRSxtRUFBVztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQywrQ0FBUTtBQUNsRDtBQUNBLFlBQVksMkJBQTJCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLElBQUksRUFBRSxtRUFBVztBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhLGtFQUFVO0FBQ3ZCO0FBQ0EsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWCxRQUFRLElBQXFDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1gsU0FBUyx1REFBUztBQUNsQixHQUFHO0FBQ0gsZUFBZSwyREFBTztBQUN0QjtBQUNBO0FBQ0EsMEJBQTBCLGtEQUFXO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixxQ0FBRztBQUNyQiw2QkFBNkIsbUVBQXFCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLGFBQWEsb0RBQUU7QUFDZjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEVBQUUsZ0RBQVM7QUFDWDtBQUNBLEdBQUc7QUFDSDtBQUNBLEVBQUUsc0RBQWU7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILDRCQUE0QixrREFBVztBQUN2QztBQUNBO0FBQ0Esd0JBQXdCLGVBQWU7QUFDdkMsS0FBSztBQUNMO0FBQ0E7QUFDQSx5QkFBeUIsZ0RBQTRCLENBQUMsMkNBQXVCLHdCQUF3QixnREFBNEI7QUFDakk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxjQUFjLE1BQU0sY0FBYztBQUNsRTtBQUNBO0FBQ0EsR0FBRyxtQkFBbUIsZ0RBQTRCLENBQUMsMkZBQW1CO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxtREFBbUQsZ0RBQTRCLENBQUMsd0VBQWEseUJBQXlCLGdEQUE0QixDQUFDLHlGQUFxQjtBQUMzSztBQUNBO0FBQ0EsbUJBQW1CLGdHQUF5QjtBQUM1QyxvQkFBb0Isa0RBQVc7QUFDL0I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esc0JBQXNCLGtEQUFXO0FBQ2pDO0FBQ0EsR0FBRztBQUNILFNBQVMsMkZBQW9CO0FBQzdCOztBQUU2RDtBQUM3RCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LWxleGljYWwvZGlzdC9saXZlYmxvY2tzLXBsdWdpbi1wcm92aWRlci5tanM/MTExNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VGbG9hdGluZywgYXV0b1VwZGF0ZSB9IGZyb20gJ0BmbG9hdGluZy11aS9yZWFjdC1kb20nO1xuaW1wb3J0IHsgQ29sbGFib3JhdGlvbkNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29sbGFib3JhdGlvbkNvbnRleHQnO1xuaW1wb3J0IHsgQ29sbGFib3JhdGlvblBsdWdpbiB9IGZyb20gJ0BsZXhpY2FsL3JlYWN0L0xleGljYWxDb2xsYWJvcmF0aW9uUGx1Z2luJztcbmltcG9ydCB7IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29tcG9zZXJDb250ZXh0JztcbmltcG9ydCB7IGtJbnRlcm5hbCwgbm4gfSBmcm9tICdAbGl2ZWJsb2Nrcy9jb3JlJztcbmltcG9ydCB7IHVzZVJvb20sIHVzZUNsaWVudCwgdXNlU2VsZiB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0JztcbmltcG9ydCB7IExpdmVibG9ja3NZanNQcm92aWRlciB9IGZyb20gJ0BsaXZlYmxvY2tzL3lqcyc7XG5pbXBvcnQgUmVhY3RfX2RlZmF1bHQsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ29udGV4dCwgdXNlUmVmLCB1c2VDYWxsYmFjaywgdXNlTGF5b3V0RWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlU3luY0V4dGVybmFsU3RvcmUgfSBmcm9tICd1c2Utc3luYy1leHRlcm5hbC1zdG9yZS9zaGltL2luZGV4LmpzJztcbmltcG9ydCB7IERvYyB9IGZyb20gJ3lqcyc7XG5pbXBvcnQgeyBDb21tZW50UGx1Z2luUHJvdmlkZXIgfSBmcm9tICcuL2NvbW1lbnRzL2NvbW1lbnQtcGx1Z2luLXByb3ZpZGVyLm1qcyc7XG5pbXBvcnQgeyBUaHJlYWRNYXJrTm9kZSB9IGZyb20gJy4vY29tbWVudHMvdGhyZWFkLW1hcmstbm9kZS5tanMnO1xuaW1wb3J0IHsgTWVudGlvbk5vZGUgfSBmcm9tICcuL21lbnRpb25zL21lbnRpb24tbm9kZS5tanMnO1xuaW1wb3J0IHsgTWVudGlvblBsdWdpbiB9IGZyb20gJy4vbWVudGlvbnMvbWVudGlvbi1wbHVnaW4ubWpzJztcblxuY29uc3QgcHJvdmlkZXJzTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbmZ1bmN0aW9uIGdldEVkaXRvclN0YXR1cyhwcm92aWRlcikge1xuICBpZiAocHJvdmlkZXIgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBcIm5vdC1sb2FkZWRcIjtcbiAgfVxuICByZXR1cm4gcHJvdmlkZXIuc3luY2VkID8gXCJzeW5jaHJvbml6ZWRcIiA6IFwibG9hZGluZ1wiO1xufVxuZnVuY3Rpb24gdXNlRWRpdG9yU3RhdHVzKCkge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBwcm92aWRlciA9IHByb3ZpZGVyc01hcC5nZXQocm9vbS5pZCk7XG4gIGNvbnN0IFtzdGF0dXMsIHNldFN0YXR1c10gPSB1c2VTdGF0ZShnZXRFZGl0b3JTdGF0dXMocHJvdmlkZXIpKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBwcm92aWRlcjIgPSBwcm92aWRlcnNNYXAuZ2V0KHJvb20uaWQpO1xuICAgIHNldFN0YXR1cyhnZXRFZGl0b3JTdGF0dXMocHJvdmlkZXIyKSk7XG4gICAgaWYgKHByb3ZpZGVyMiA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNiID0gKCkgPT4gc2V0U3RhdHVzKGdldEVkaXRvclN0YXR1cyhwcm92aWRlcjIpKTtcbiAgICBwcm92aWRlcjIub24oXCJzeW5jXCIsIGNiKTtcbiAgICByZXR1cm4gKCkgPT4gcHJvdmlkZXIyLm9mZihcInN5bmNcIiwgY2IpO1xuICB9LCBbcm9vbV0pO1xuICByZXR1cm4gc3RhdHVzO1xufVxuY29uc3QgTGl2ZWJsb2Nrc1BsdWdpbiA9ICh7XG4gIGNoaWxkcmVuXG59KSA9PiB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCBoYXNSZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zID0gY2xpZW50W2tJbnRlcm5hbF0ucmVzb2x2ZU1lbnRpb25TdWdnZXN0aW9ucyAhPT0gdm9pZCAwO1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgY29uc3QgY29sbGFiQ29udGV4dCA9IHVzZUNvbnRleHQoQ29sbGFib3JhdGlvbkNvbnRleHQpO1xuICBjb25zdCBwcmV2aW91c1Jvb21JZFJlZiA9IHVzZVJlZihudWxsKTtcbiAgaWYgKCFlZGl0b3IuaGFzTm9kZXMoW1RocmVhZE1hcmtOb2RlLCBNZW50aW9uTm9kZV0pKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJMaXZlYmxvY2tzUGx1Z2luIHJlcXVpcmVzIExleGljYWwgY29uZmlndXJhdGlvbiB0byBiZSB3cmFwcGVkIGluIHRoZSBgbGl2ZWJsb2Nrc0NvbmZpZyhvcHRpb25zKWAgZnVuY3Rpb24uIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3MtcmVhY3QtbGV4aWNhbCNsaXZlYmxvY2tzQ29uZmlnXCJcbiAgICApO1xuICB9XG4gIGNvbnN0IFtjb250YWluZXJSZWYsIHNldENvbnRhaW5lclJlZl0gPSB1c2VTdGF0ZSh2b2lkIDApO1xuICBjb25zdCB7XG4gICAgcmVmczogeyBzZXRSZWZlcmVuY2UsIHNldEZsb2F0aW5nIH0sXG4gICAgc3RyYXRlZ3ksXG4gICAgeCxcbiAgICB5XG4gIH0gPSB1c2VGbG9hdGluZyh7XG4gICAgc3RyYXRlZ3k6IFwiZml4ZWRcIixcbiAgICBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsXG4gICAgd2hpbGVFbGVtZW50c01vdW50ZWQ6ICguLi5hcmdzKSA9PiB7XG4gICAgICByZXR1cm4gYXV0b1VwZGF0ZSguLi5hcmdzLCB7XG4gICAgICAgIGFuaW1hdGlvbkZyYW1lOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgIGlmICghZWRpdG9yLmdldEVkaXRvclN0YXRlKCkuaXNFbXB0eSgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICBcIldhcm5pbmc6IExpdmVibG9ja3NQbHVnaW46IGVkaXRvclN0YXRlIGluIGluaXRpYWxDb25maWcgZGV0ZWN0ZWQsIGJ1dCBtdXN0IGJlIG51bGwuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIFtdKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICByb29tW2tJbnRlcm5hbF0ucmVwb3J0VGV4dEVkaXRvcihcImxleGljYWxcIiwgXCJyb290XCIpO1xuICB9LCBbcm9vbV0pO1xuICBjb25zdCBpbmZvID0gdXNlU2VsZigobWUpID0+IG1lLmluZm8pO1xuICBjb25zdCB1c2VybmFtZSA9IGluZm8/Lm5hbWUgfHwgXCJcIjtcbiAgY29uc3QgY3Vyc29yY29sb3IgPSBpbmZvPy5jb2xvcjtcbiAgY29uc3QgcHJvdmlkZXJGYWN0b3J5ID0gdXNlQ2FsbGJhY2soXG4gICAgKGlkLCB5anNEb2NNYXApID0+IHtcbiAgICAgIGlmIChwcmV2aW91c1Jvb21JZFJlZi5jdXJyZW50ICE9PSBudWxsICYmIHByZXZpb3VzUm9vbUlkUmVmLmN1cnJlbnQgIT09IGlkKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzUHJvdmlkZXIgPSBwcm92aWRlcnNNYXAuZ2V0KGlkKTtcbiAgICAgICAgaWYgKHByZXZpb3VzUHJvdmlkZXIgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHByZXZpb3VzUHJvdmlkZXIuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsZXQgZG9jID0geWpzRG9jTWFwLmdldChpZCk7XG4gICAgICBpZiAoZG9jID09PSB2b2lkIDApIHtcbiAgICAgICAgZG9jID0gbmV3IERvYygpO1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IG5ldyBMaXZlYmxvY2tzWWpzUHJvdmlkZXIocm9vbSwgZG9jKTtcbiAgICAgICAgeWpzRG9jTWFwLnNldChpZCwgZG9jKTtcbiAgICAgICAgcHJvdmlkZXJzTWFwLnNldChpZCwgcHJvdmlkZXIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5uKFxuICAgICAgICBwcm92aWRlcnNNYXAuZ2V0KGlkKSxcbiAgICAgICAgXCJJbnRlcm5hbCBlcnJvci4gU2hvdWxkIG5ldmVyIGhhcHBlblwiXG4gICAgICApO1xuICAgIH0sXG4gICAgW3Jvb21dXG4gICk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29sbGFiQ29udGV4dC5uYW1lID0gdXNlcm5hbWUgfHwgXCJcIjtcbiAgfSwgW2NvbGxhYkNvbnRleHQsIHVzZXJuYW1lXSk7XG4gIGNvbnN0IHJvb3QgPSB1c2VSb290RWxlbWVudCgpO1xuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChyb290ID09PSBudWxsKVxuICAgICAgcmV0dXJuO1xuICAgIHNldFJlZmVyZW5jZSh7XG4gICAgICBnZXRCb3VuZGluZ0NsaWVudFJlY3Q6ICgpID0+IHJvb3QuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICB9KTtcbiAgfSwgW3NldFJlZmVyZW5jZSwgcm9vdF0pO1xuICBjb25zdCBoYW5kbGVGbG9hdGluZ1JlZiA9IHVzZUNhbGxiYWNrKFxuICAgIChub2RlKSA9PiB7XG4gICAgICBzZXRGbG9hdGluZyhub2RlKTtcbiAgICAgIHNldENvbnRhaW5lclJlZih7IGN1cnJlbnQ6IG5vZGUgfSk7XG4gICAgfSxcbiAgICBbc2V0RmxvYXRpbmcsIHNldENvbnRhaW5lclJlZl1cbiAgKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFJlYWN0X19kZWZhdWx0LkZyYWdtZW50LCBudWxsLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7XG4gICAgcmVmOiBoYW5kbGVGbG9hdGluZ1JlZixcbiAgICBzdHlsZToge1xuICAgICAgcG9zaXRpb246IHN0cmF0ZWd5LFxuICAgICAgdG9wOiAwLFxuICAgICAgbGVmdDogMCxcbiAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZTNkKCR7TWF0aC5yb3VuZCh4KX1weCwgJHtNYXRoLnJvdW5kKHkpfXB4LCAwKWAsXG4gICAgICBtaW5XaWR0aDogXCJtYXgtY29udGVudFwiXG4gICAgfVxuICB9KSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29sbGFib3JhdGlvblBsdWdpbiwge1xuICAgIGtleTogcm9vbS5pZCxcbiAgICBpZDogcm9vbS5pZCxcbiAgICBwcm92aWRlckZhY3RvcnksXG4gICAgdXNlcm5hbWUsXG4gICAgY3Vyc29yQ29sb3I6IGN1cnNvcmNvbG9yLFxuICAgIGN1cnNvcnNDb250YWluZXJSZWY6IGNvbnRhaW5lclJlZixcbiAgICBzaG91bGRCb290c3RyYXA6IHRydWVcbiAgfSksIGhhc1Jlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMgJiYgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTWVudGlvblBsdWdpbiwgbnVsbCksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbW1lbnRQbHVnaW5Qcm92aWRlciwgbnVsbCwgY2hpbGRyZW4pKTtcbn07XG5mdW5jdGlvbiB1c2VSb290RWxlbWVudCgpIHtcbiAgY29uc3QgW2VkaXRvcl0gPSB1c2VMZXhpY2FsQ29tcG9zZXJDb250ZXh0KCk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHVzZUNhbGxiYWNrKFxuICAgIChvblN0b3JlQ2hhbmdlKSA9PiB7XG4gICAgICByZXR1cm4gZWRpdG9yLnJlZ2lzdGVyUm9vdExpc3RlbmVyKG9uU3RvcmVDaGFuZ2UpO1xuICAgIH0sXG4gICAgW2VkaXRvcl1cbiAgKTtcbiAgY29uc3QgZ2V0U25hcHNob3QgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgcmV0dXJuIGVkaXRvci5nZXRSb290RWxlbWVudCgpO1xuICB9LCBbZWRpdG9yXSk7XG4gIHJldHVybiB1c2VTeW5jRXh0ZXJuYWxTdG9yZShzdWJzY3JpYmUsIGdldFNuYXBzaG90LCBnZXRTbmFwc2hvdCk7XG59XG5cbmV4cG9ydCB7IExpdmVibG9ja3NQbHVnaW4sIHVzZUVkaXRvclN0YXR1cywgdXNlUm9vdEVsZW1lbnQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpdmVibG9ja3MtcGx1Z2luLXByb3ZpZGVyLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/liveblocks-plugin-provider.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/avatar.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/mentions/avatar.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Avatar: () => (/* binding */ Avatar)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _classnames_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../classnames.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/classnames.mjs\");\n\n\n\n\nconst Avatar = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  function Avatar2(props, forwardedRef) {\n    const { userId, className, ...spanProps } = props;\n    const { user, isLoading } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__._useUser)(userId);\n    const avatar = user ? user.avatar : void 0;\n    const name = user ? user.name : void 0;\n    function Initials() {\n      const initials = name ? getInitials(name) : void 0;\n      if (initials) {\n        return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n          \"aria-hidden\": true,\n          className: \"lb-avatar-fallback\"\n        }, initials);\n      }\n      if (isLoading)\n        return null;\n      if (user === void 0)\n        return null;\n      return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        \"aria-label\": userId,\n        title: userId,\n        className: \"lb-avatar-fallback\"\n      }, getInitials(userId));\n    }\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n      \"data-loading\": isLoading ? \"\" : void 0,\n      ...spanProps,\n      className: (0,_classnames_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-avatar\", className),\n      ref: forwardedRef\n    }, avatar && /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"img\", {\n      src: avatar,\n      alt: name,\n      className: \"lb-avatar-image\"\n    }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Initials, null));\n  }\n);\nfunction getInitials(name) {\n  return name.trim().split(\" \").reduce((initials, name2, index, array) => {\n    if (index === 0 || index === array.length - 1) {\n      initials += name2.charAt(0).toLocaleUpperCase();\n    }\n    return initials;\n  }, \"\");\n}\n\n\n//# sourceMappingURL=avatar.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL2F2YXRhci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUE0QztBQUNPO0FBQ0o7O0FBRS9DLGVBQWUsaURBQVU7QUFDekI7QUFDQSxZQUFZLGtDQUFrQztBQUM5QyxZQUFZLGtCQUFrQixFQUFFLDJEQUFPO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsZ0RBQTRCO0FBQzNEO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixnREFBNEI7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsMkJBQTJCLGdEQUE0QjtBQUN2RDtBQUNBO0FBQ0EsaUJBQWlCLDJEQUFVO0FBQzNCO0FBQ0EsS0FBSyw0QkFBNEIsZ0RBQTRCO0FBQzdEO0FBQ0E7QUFDQTtBQUNBLEtBQUssbUJBQW1CLGdEQUE0QjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVrQjtBQUNsQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LWxleGljYWwvZGlzdC9tZW50aW9ucy9hdmF0YXIubWpzP2MzZDgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlVXNlciB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0JztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyBmb3J3YXJkUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gJy4uL2NsYXNzbmFtZXMubWpzJztcblxuY29uc3QgQXZhdGFyID0gZm9yd2FyZFJlZihcbiAgZnVuY3Rpb24gQXZhdGFyMihwcm9wcywgZm9yd2FyZGVkUmVmKSB7XG4gICAgY29uc3QgeyB1c2VySWQsIGNsYXNzTmFtZSwgLi4uc3BhblByb3BzIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHVzZXIsIGlzTG9hZGluZyB9ID0gdXNlVXNlcih1c2VySWQpO1xuICAgIGNvbnN0IGF2YXRhciA9IHVzZXIgPyB1c2VyLmF2YXRhciA6IHZvaWQgMDtcbiAgICBjb25zdCBuYW1lID0gdXNlciA/IHVzZXIubmFtZSA6IHZvaWQgMDtcbiAgICBmdW5jdGlvbiBJbml0aWFscygpIHtcbiAgICAgIGNvbnN0IGluaXRpYWxzID0gbmFtZSA/IGdldEluaXRpYWxzKG5hbWUpIDogdm9pZCAwO1xuICAgICAgaWYgKGluaXRpYWxzKSB7XG4gICAgICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInNwYW5cIiwge1xuICAgICAgICAgIFwiYXJpYS1oaWRkZW5cIjogdHJ1ZSxcbiAgICAgICAgICBjbGFzc05hbWU6IFwibGItYXZhdGFyLWZhbGxiYWNrXCJcbiAgICAgICAgfSwgaW5pdGlhbHMpO1xuICAgICAgfVxuICAgICAgaWYgKGlzTG9hZGluZylcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICBpZiAodXNlciA9PT0gdm9pZCAwKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInNwYW5cIiwge1xuICAgICAgICBcImFyaWEtbGFiZWxcIjogdXNlcklkLFxuICAgICAgICB0aXRsZTogdXNlcklkLFxuICAgICAgICBjbGFzc05hbWU6IFwibGItYXZhdGFyLWZhbGxiYWNrXCJcbiAgICAgIH0sIGdldEluaXRpYWxzKHVzZXJJZCkpO1xuICAgIH1cbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHtcbiAgICAgIFwiZGF0YS1sb2FkaW5nXCI6IGlzTG9hZGluZyA/IFwiXCIgOiB2b2lkIDAsXG4gICAgICAuLi5zcGFuUHJvcHMsXG4gICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoXCJsYi1hdmF0YXJcIiwgY2xhc3NOYW1lKSxcbiAgICAgIHJlZjogZm9yd2FyZGVkUmVmXG4gICAgfSwgYXZhdGFyICYmIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiaW1nXCIsIHtcbiAgICAgIHNyYzogYXZhdGFyLFxuICAgICAgYWx0OiBuYW1lLFxuICAgICAgY2xhc3NOYW1lOiBcImxiLWF2YXRhci1pbWFnZVwiXG4gICAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEluaXRpYWxzLCBudWxsKSk7XG4gIH1cbik7XG5mdW5jdGlvbiBnZXRJbml0aWFscyhuYW1lKSB7XG4gIHJldHVybiBuYW1lLnRyaW0oKS5zcGxpdChcIiBcIikucmVkdWNlKChpbml0aWFscywgbmFtZTIsIGluZGV4LCBhcnJheSkgPT4ge1xuICAgIGlmIChpbmRleCA9PT0gMCB8fCBpbmRleCA9PT0gYXJyYXkubGVuZ3RoIC0gMSkge1xuICAgICAgaW5pdGlhbHMgKz0gbmFtZTIuY2hhckF0KDApLnRvTG9jYWxlVXBwZXJDYXNlKCk7XG4gICAgfVxuICAgIHJldHVybiBpbml0aWFscztcbiAgfSwgXCJcIik7XG59XG5cbmV4cG9ydCB7IEF2YXRhciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXZhdGFyLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/avatar.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-component.mjs":
/*!************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/mentions/mention-component.mjs ***!
  \************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Mention: () => (/* binding */ Mention)\n/* harmony export */ });\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! use-sync-external-store/shim/index.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/index.js\");\n\n\n\n\n\nfunction Mention({\n  nodeKey,\n  children\n}) {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__.useLexicalComposerContext)();\n  const isSelected = useIsNodeSelected(nodeKey);\n  function handleClick(event) {\n    editor.update(() => {\n      event.stopPropagation();\n      event.preventDefault();\n      const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_3__.$createNodeSelection)();\n      selection.add(nodeKey);\n      (0,lexical__WEBPACK_IMPORTED_MODULE_3__.$setSelection)(selection);\n    });\n  }\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n    onClick: handleClick,\n    \"data-selected\": isSelected ? \"\" : void 0,\n    className: \"lb-root lb-lexical-mention\"\n  }, children);\n}\nfunction $isNodeSelected(key) {\n  const node = (0,lexical__WEBPACK_IMPORTED_MODULE_3__.$getNodeByKey)(key);\n  if (node === null)\n    return false;\n  return node.isSelected();\n}\nfunction useIsNodeSelected(key) {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__.useLexicalComposerContext)();\n  const subscribe = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (onStoreChange) => {\n      return editor.registerUpdateListener(onStoreChange);\n    },\n    [editor]\n  );\n  const getSnapshot = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    return editor.getEditorState().read(() => $isNodeSelected(key));\n  }, [editor, key]);\n  return (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStore)(subscribe, getSnapshot, getSnapshot);\n}\n\n\n//# sourceMappingURL=mention-component.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL21lbnRpb24tY29tcG9uZW50Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFrRjtBQUNMO0FBQ3pCO0FBQ3lCOztBQUU3RTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsbUJBQW1CLGdHQUF5QjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDZEQUFvQjtBQUM1QztBQUNBLE1BQU0sc0RBQWE7QUFDbkIsS0FBSztBQUNMO0FBQ0EseUJBQXlCLGdEQUE0QjtBQUNyRDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLGVBQWUsc0RBQWE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixnR0FBeUI7QUFDNUMsb0JBQW9CLGtEQUFXO0FBQy9CO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHNCQUFzQixrREFBVztBQUNqQztBQUNBLEdBQUc7QUFDSCxTQUFTLDJGQUFvQjtBQUM3Qjs7QUFFbUI7QUFDbkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC1sZXhpY2FsL2Rpc3QvbWVudGlvbnMvbWVudGlvbi1jb21wb25lbnQubWpzPzZiYzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlTGV4aWNhbENvbXBvc2VyQ29udGV4dCB9IGZyb20gJ0BsZXhpY2FsL3JlYWN0L0xleGljYWxDb21wb3NlckNvbnRleHQnO1xuaW1wb3J0IHsgJGNyZWF0ZU5vZGVTZWxlY3Rpb24sICRzZXRTZWxlY3Rpb24sICRnZXROb2RlQnlLZXkgfSBmcm9tICdsZXhpY2FsJztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVN5bmNFeHRlcm5hbFN0b3JlIH0gZnJvbSAndXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS9pbmRleC5qcyc7XG5cbmZ1bmN0aW9uIE1lbnRpb24oe1xuICBub2RlS2V5LFxuICBjaGlsZHJlblxufSkge1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3QgaXNTZWxlY3RlZCA9IHVzZUlzTm9kZVNlbGVjdGVkKG5vZGVLZXkpO1xuICBmdW5jdGlvbiBoYW5kbGVDbGljayhldmVudCkge1xuICAgIGVkaXRvci51cGRhdGUoKCkgPT4ge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3Qgc2VsZWN0aW9uID0gJGNyZWF0ZU5vZGVTZWxlY3Rpb24oKTtcbiAgICAgIHNlbGVjdGlvbi5hZGQobm9kZUtleSk7XG4gICAgICAkc2V0U2VsZWN0aW9uKHNlbGVjdGlvbik7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7XG4gICAgb25DbGljazogaGFuZGxlQ2xpY2ssXG4gICAgXCJkYXRhLXNlbGVjdGVkXCI6IGlzU2VsZWN0ZWQgPyBcIlwiIDogdm9pZCAwLFxuICAgIGNsYXNzTmFtZTogXCJsYi1yb290IGxiLWxleGljYWwtbWVudGlvblwiXG4gIH0sIGNoaWxkcmVuKTtcbn1cbmZ1bmN0aW9uICRpc05vZGVTZWxlY3RlZChrZXkpIHtcbiAgY29uc3Qgbm9kZSA9ICRnZXROb2RlQnlLZXkoa2V5KTtcbiAgaWYgKG5vZGUgPT09IG51bGwpXG4gICAgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4gbm9kZS5pc1NlbGVjdGVkKCk7XG59XG5mdW5jdGlvbiB1c2VJc05vZGVTZWxlY3RlZChrZXkpIHtcbiAgY29uc3QgW2VkaXRvcl0gPSB1c2VMZXhpY2FsQ29tcG9zZXJDb250ZXh0KCk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHVzZUNhbGxiYWNrKFxuICAgIChvblN0b3JlQ2hhbmdlKSA9PiB7XG4gICAgICByZXR1cm4gZWRpdG9yLnJlZ2lzdGVyVXBkYXRlTGlzdGVuZXIob25TdG9yZUNoYW5nZSk7XG4gICAgfSxcbiAgICBbZWRpdG9yXVxuICApO1xuICBjb25zdCBnZXRTbmFwc2hvdCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICByZXR1cm4gZWRpdG9yLmdldEVkaXRvclN0YXRlKCkucmVhZCgoKSA9PiAkaXNOb2RlU2VsZWN0ZWQoa2V5KSk7XG4gIH0sIFtlZGl0b3IsIGtleV0pO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmUoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgZ2V0U25hcHNob3QpO1xufVxuXG5leHBvcnQgeyBNZW50aW9uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZW50aW9uLWNvbXBvbmVudC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-component.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-node.mjs":
/*!*******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/mentions/mention-node.mjs ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   $createMentionNode: () => (/* binding */ $createMentionNode),\n/* harmony export */   $isMentionNode: () => (/* binding */ $isMentionNode),\n/* harmony export */   MentionNode: () => (/* binding */ MentionNode)\n/* harmony export */ });\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _mention_component_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./mention-component.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-component.mjs\");\n/* harmony import */ var _user_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./user.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/user.mjs\");\n\n\n\n\n\n\nconst MENTION_CHARACTER = \"@\";\nclass MentionNode extends lexical__WEBPACK_IMPORTED_MODULE_1__.DecoratorNode {\n  constructor(id, userId, key) {\n    super(key);\n    this.__id = id;\n    this.__userId = userId;\n  }\n  static getType() {\n    return \"lb-mention\";\n  }\n  static clone(node) {\n    return new MentionNode(node.__id, node.__userId);\n  }\n  createDOM() {\n    const element = document.createElement(\"span\");\n    element.style.display = \"inline-block\";\n    element.style.userSelect = \"none\";\n    return element;\n  }\n  updateDOM() {\n    return false;\n  }\n  static importDom() {\n    return {\n      span: () => ({\n        conversion: (element) => {\n          const value = atob(element.getAttribute(\"data-lexical-lb-mention\"));\n          const node = $createMentionNode(value);\n          return { node };\n        },\n        priority: 1\n      })\n    };\n  }\n  exportDOM() {\n    const element = document.createElement(\"span\");\n    const value = this.getTextContent();\n    element.setAttribute(\"data-lexical-lb-mention\", btoa(value));\n    element.textContent = this.getTextContent();\n    return { element };\n  }\n  static importJSON(serializedNode) {\n    const node = $createMentionNode(serializedNode.userId);\n    return node;\n  }\n  exportJSON() {\n    return {\n      userId: this.__userId,\n      type: \"lb-mention\",\n      version: 1\n    };\n  }\n  getUserId() {\n    const self = this.getLatest();\n    return self.__userId;\n  }\n  getId() {\n    const self = this.getLatest();\n    return self.__id;\n  }\n  decorate() {\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mention_component_mjs__WEBPACK_IMPORTED_MODULE_2__.Mention, {\n      nodeKey: this.getKey()\n    }, MENTION_CHARACTER, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_user_mjs__WEBPACK_IMPORTED_MODULE_3__.User, {\n      userId: this.getUserId()\n    }));\n  }\n}\nfunction $isMentionNode(node) {\n  return node instanceof MentionNode;\n}\nfunction $createMentionNode(userId) {\n  const node = new MentionNode((0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_4__.createInboxNotificationId)(), userId);\n  return (0,lexical__WEBPACK_IMPORTED_MODULE_1__.$applyNodeReplacement)(node);\n}\n\n\n//# sourceMappingURL=mention-node.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL21lbnRpb24tbm9kZS5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBK0Q7QUFDRjtBQUM5QjtBQUNtQjtBQUNoQjs7QUFFbEM7QUFDQSwwQkFBMEIsa0RBQWE7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQixTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGdEQUFtQixDQUFDLDJEQUFPO0FBQ3REO0FBQ0EsS0FBSyxxQ0FBcUMsZ0RBQW1CLENBQUMsMkNBQUk7QUFDbEU7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDJFQUF5QjtBQUN4RCxTQUFTLDhEQUFxQjtBQUM5Qjs7QUFFMkQ7QUFDM0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC1sZXhpY2FsL2Rpc3QvbWVudGlvbnMvbWVudGlvbi1ub2RlLm1qcz9jY2FmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlY29yYXRvck5vZGUsICRhcHBseU5vZGVSZXBsYWNlbWVudCB9IGZyb20gJ2xleGljYWwnO1xuaW1wb3J0IHsgY3JlYXRlSW5ib3hOb3RpZmljYXRpb25JZCB9IGZyb20gJ0BsaXZlYmxvY2tzL2NvcmUnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWVudGlvbiB9IGZyb20gJy4vbWVudGlvbi1jb21wb25lbnQubWpzJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuL3VzZXIubWpzJztcblxuY29uc3QgTUVOVElPTl9DSEFSQUNURVIgPSBcIkBcIjtcbmNsYXNzIE1lbnRpb25Ob2RlIGV4dGVuZHMgRGVjb3JhdG9yTm9kZSB7XG4gIGNvbnN0cnVjdG9yKGlkLCB1c2VySWQsIGtleSkge1xuICAgIHN1cGVyKGtleSk7XG4gICAgdGhpcy5fX2lkID0gaWQ7XG4gICAgdGhpcy5fX3VzZXJJZCA9IHVzZXJJZDtcbiAgfVxuICBzdGF0aWMgZ2V0VHlwZSgpIHtcbiAgICByZXR1cm4gXCJsYi1tZW50aW9uXCI7XG4gIH1cbiAgc3RhdGljIGNsb25lKG5vZGUpIHtcbiAgICByZXR1cm4gbmV3IE1lbnRpb25Ob2RlKG5vZGUuX19pZCwgbm9kZS5fX3VzZXJJZCk7XG4gIH1cbiAgY3JlYXRlRE9NKCkge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgIGVsZW1lbnQuc3R5bGUudXNlclNlbGVjdCA9IFwibm9uZVwiO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG4gIHVwZGF0ZURPTSgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgc3RhdGljIGltcG9ydERvbSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3BhbjogKCkgPT4gKHtcbiAgICAgICAgY29udmVyc2lvbjogKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF0b2IoZWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWxleGljYWwtbGItbWVudGlvblwiKSk7XG4gICAgICAgICAgY29uc3Qgbm9kZSA9ICRjcmVhdGVNZW50aW9uTm9kZSh2YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHsgbm9kZSB9O1xuICAgICAgICB9LFxuICAgICAgICBwcmlvcml0eTogMVxuICAgICAgfSlcbiAgICB9O1xuICB9XG4gIGV4cG9ydERPTSgpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFRleHRDb250ZW50KCk7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWxleGljYWwtbGItbWVudGlvblwiLCBidG9hKHZhbHVlKSk7XG4gICAgZWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0VGV4dENvbnRlbnQoKTtcbiAgICByZXR1cm4geyBlbGVtZW50IH07XG4gIH1cbiAgc3RhdGljIGltcG9ydEpTT04oc2VyaWFsaXplZE5vZGUpIHtcbiAgICBjb25zdCBub2RlID0gJGNyZWF0ZU1lbnRpb25Ob2RlKHNlcmlhbGl6ZWROb2RlLnVzZXJJZCk7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cbiAgZXhwb3J0SlNPTigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcklkOiB0aGlzLl9fdXNlcklkLFxuICAgICAgdHlwZTogXCJsYi1tZW50aW9uXCIsXG4gICAgICB2ZXJzaW9uOiAxXG4gICAgfTtcbiAgfVxuICBnZXRVc2VySWQoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXMuZ2V0TGF0ZXN0KCk7XG4gICAgcmV0dXJuIHNlbGYuX191c2VySWQ7XG4gIH1cbiAgZ2V0SWQoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXMuZ2V0TGF0ZXN0KCk7XG4gICAgcmV0dXJuIHNlbGYuX19pZDtcbiAgfVxuICBkZWNvcmF0ZSgpIHtcbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTWVudGlvbiwge1xuICAgICAgbm9kZUtleTogdGhpcy5nZXRLZXkoKVxuICAgIH0sIE1FTlRJT05fQ0hBUkFDVEVSLCAvKiBAX19QVVJFX18gKi8gUmVhY3QuY3JlYXRlRWxlbWVudChVc2VyLCB7XG4gICAgICB1c2VySWQ6IHRoaXMuZ2V0VXNlcklkKClcbiAgICB9KSk7XG4gIH1cbn1cbmZ1bmN0aW9uICRpc01lbnRpb25Ob2RlKG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUgaW5zdGFuY2VvZiBNZW50aW9uTm9kZTtcbn1cbmZ1bmN0aW9uICRjcmVhdGVNZW50aW9uTm9kZSh1c2VySWQpIHtcbiAgY29uc3Qgbm9kZSA9IG5ldyBNZW50aW9uTm9kZShjcmVhdGVJbmJveE5vdGlmaWNhdGlvbklkKCksIHVzZXJJZCk7XG4gIHJldHVybiAkYXBwbHlOb2RlUmVwbGFjZW1lbnQobm9kZSk7XG59XG5cbmV4cG9ydCB7ICRjcmVhdGVNZW50aW9uTm9kZSwgJGlzTWVudGlvbk5vZGUsIE1lbnRpb25Ob2RlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZW50aW9uLW5vZGUubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-node.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-plugin.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/mentions/mention-plugin.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MentionPlugin: () => (/* binding */ MentionPlugin),\n/* harmony export */   SUGGESTIONS_COLLISION_PADDING: () => (/* binding */ SUGGESTIONS_COLLISION_PADDING)\n/* harmony export */ });\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs\");\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @liveblocks/react-ui */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-dom.js\");\n/* harmony import */ var _avatar_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./avatar.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/avatar.mjs\");\n/* harmony import */ var _mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./mention-node.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-node.mjs\");\n/* harmony import */ var _suggestions_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./suggestions.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/suggestions.mjs\");\n/* harmony import */ var _user_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./user.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/user.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst MENTION_TRIGGER = \"@\";\nconst PUNCTUATIONS = `\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%'\"~=<>_:;`;\nconst VALID_CHARACTERS = \"[^\" + MENTION_TRIGGER + PUNCTUATIONS + \"\\\\s]\";\nconst VALID_JOINS = \"(?:\\\\.[ |$]| |[\" + PUNCTUATIONS + \"]|)\";\nconst LENGTH_LIMIT = 75;\nconst MentionRegex = new RegExp(\n  \"(^|\\\\s|\\\\()([\" + MENTION_TRIGGER + \"]((?:\" + VALID_CHARACTERS + VALID_JOINS + \"){0,\" + LENGTH_LIMIT + \"}))$\"\n);\nfunction $getAnchorNodeTextContent() {\n  const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n  if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection))\n    return null;\n  const anchor = selection.anchor;\n  if (anchor.type !== \"text\")\n    return null;\n  const anchorNode = anchor.getNode();\n  if (!anchorNode.isSimpleText())\n    return null;\n  const anchorOffset = anchor.offset;\n  return anchorNode.getTextContent().slice(0, anchorOffset);\n}\nfunction getFullMatchOffset(documentText, entryText, offset2) {\n  let triggerOffset = offset2;\n  for (let i = triggerOffset; i <= entryText.length; i++) {\n    if (documentText.substr(-i) === entryText.substr(0, i)) {\n      triggerOffset = i;\n    }\n  }\n  return triggerOffset;\n}\nfunction $isCurrentSelectionAtBoundary(offset2) {\n  if (offset2 !== 0)\n    return false;\n  const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n  if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection))\n    return false;\n  const anchor = selection.anchor.getNode();\n  const prevSibling = anchor.getPreviousSibling();\n  if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isTextNode)(prevSibling))\n    return false;\n  if (!prevSibling.isTextEntity())\n    return false;\n  return true;\n}\nfunction $getRangeAtMatch(match) {\n  const offsetWithWhitespaces = match.index + match[1].length;\n  if ($isCurrentSelectionAtBoundary(offsetWithWhitespaces))\n    return null;\n  const selection = window.getSelection();\n  if (selection === null)\n    return null;\n  if (!selection.isCollapsed)\n    return null;\n  const anchor = selection.anchorNode;\n  if (anchor === null)\n    return null;\n  const endOffset = selection.anchorOffset;\n  if (endOffset === null)\n    return null;\n  const range = document.createRange();\n  try {\n    range.setStart(anchor, offsetWithWhitespaces);\n    range.setEnd(anchor, endOffset);\n    return range;\n  } catch (error) {\n    return null;\n  }\n}\nfunction MentionPlugin() {\n  const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_3__.useLexicalComposerContext)();\n  const [match, setMatch] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n  const matchingString = match?.[3];\n  const suggestions = (0,_liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_4__.useMentionSuggestions)(matchingString);\n  const room = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_5__._useRoom)();\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function $handleMutation(mutations, {\n      prevEditorState\n    }) {\n      for (const [key, mutation] of mutations) {\n        if (mutation === \"created\") {\n          editor.getEditorState().read(() => {\n            const node = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getNodeByKey)(key);\n            if (node === null)\n              return;\n            if (!(0,_mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$isMentionNode)(node))\n              return;\n            room[_liveblocks_core__WEBPACK_IMPORTED_MODULE_7__.kInternal].createTextMention(node.getUserId(), node.getId()).catch((err) => {\n              console.error(err);\n            });\n          });\n        } else if (mutation === \"destroyed\") {\n          prevEditorState.read(() => {\n            const node = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getNodeByKey)(key);\n            if (node === null)\n              return;\n            if (!(0,_mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$isMentionNode)(node))\n              return;\n            room[_liveblocks_core__WEBPACK_IMPORTED_MODULE_7__.kInternal].deleteTextMention(node.getId()).catch((err) => {\n              console.error(err);\n            });\n          });\n        }\n      }\n    }\n    return editor.registerMutationListener(\n      _mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.MentionNode,\n      (mutations, payload) => {\n        if (payload.updateTags.has(\"collaboration\"))\n          return;\n        $handleMutation(mutations, payload);\n      }\n    );\n  }, [editor, room]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function $onStateRead() {\n      const text = $getAnchorNodeTextContent();\n      if (text === null) {\n        setMatch(null);\n        return;\n      }\n      const match2 = MentionRegex.exec(text);\n      setMatch(match2);\n    }\n    return editor.registerUpdateListener(({ editorState: state }) => {\n      state.read($onStateRead);\n    });\n  }, [editor]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    function $handleBackspace(event) {\n      const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n      if (selection === null)\n        return false;\n      if ((0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isNodeSelection)(selection)) {\n        const nodes = selection.getNodes();\n        if (nodes.length !== 1)\n          return false;\n        const node = nodes[0];\n        if (!(0,_mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$isMentionNode)(node))\n          return false;\n        const text = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$createTextNode)(\"@\");\n        node.replace(text);\n        const newSelection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$createRangeSelection)();\n        newSelection.setTextNodeRange(text, 1, text, 1);\n        (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$setSelection)(newSelection);\n        event.preventDefault();\n        return true;\n      } else if ((0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection)) {\n        if (!selection.isCollapsed())\n          return false;\n        const anchor = selection.anchor.getNode();\n        const prevSibling = anchor.getPreviousSibling();\n        if (selection.anchor.offset === 0 && (0,_mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$isMentionNode)(prevSibling)) {\n          const text = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$createTextNode)(\"@\");\n          prevSibling.replace(text);\n          const newSelection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$createRangeSelection)();\n          newSelection.setTextNodeRange(text, 1, text, 1);\n          (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$setSelection)(newSelection);\n          event.preventDefault();\n          return true;\n        } else if ((0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isElementNode)(anchor)) {\n          const child = anchor.getChildAtIndex(selection.anchor.offset - 1);\n          if (!(0,_mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$isMentionNode)(child))\n            return false;\n          const text = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$createTextNode)(\"@\");\n          child.replace(text);\n          const newSelection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$createRangeSelection)();\n          newSelection.setTextNodeRange(text, 1, text, 1);\n          (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$setSelection)(newSelection);\n          event.preventDefault();\n          return true;\n        }\n        return false;\n      }\n      return false;\n    }\n    return editor.registerCommand(\n      lexical__WEBPACK_IMPORTED_MODULE_2__.KEY_BACKSPACE_COMMAND,\n      $handleBackspace,\n      lexical__WEBPACK_IMPORTED_MODULE_2__.COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n  const handleValueSelect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (userId) => {\n      function $onValueSelect() {\n        if (match === null)\n          return;\n        setMatch(null);\n        const selection = (0,lexical__WEBPACK_IMPORTED_MODULE_2__.$getSelection)();\n        if (!(0,lexical__WEBPACK_IMPORTED_MODULE_2__.$isRangeSelection)(selection))\n          return;\n        if (!selection.isCollapsed())\n          return;\n        const anchor = selection.anchor;\n        if (anchor.type !== \"text\")\n          return;\n        const anchorNode = anchor.getNode();\n        if (!anchorNode.isSimpleText())\n          return;\n        const selectionOffset = anchor.offset;\n        const text = anchorNode.getTextContent().slice(0, selectionOffset);\n        const characterOffset = match[2].length;\n        const queryOffset = getFullMatchOffset(text, match[2], characterOffset);\n        const startOffset = selectionOffset - queryOffset;\n        if (startOffset < 0)\n          return;\n        const mentionNode = (0,_mention_node_mjs__WEBPACK_IMPORTED_MODULE_6__.$createMentionNode)(userId);\n        if (startOffset === 0) {\n          const [node] = anchorNode.splitText(selectionOffset);\n          node.replace(mentionNode);\n        } else {\n          const [, node] = anchorNode.splitText(startOffset, selectionOffset);\n          node.replace(mentionNode);\n        }\n      }\n      editor.update($onValueSelect);\n    },\n    [editor, match]\n  );\n  if (match === null || matchingString === void 0)\n    return null;\n  if (suggestions === void 0 || suggestions.length === 0)\n    return null;\n  const range = editor.getEditorState().read(() => $getRangeAtMatch(match));\n  if (range === null)\n    return null;\n  return (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(\n    /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_suggestions_mjs__WEBPACK_IMPORTED_MODULE_8__.SuggestionsContext.Provider, {\n      value: suggestions\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_suggestions_mjs__WEBPACK_IMPORTED_MODULE_8__.OnValueSelectCallbackContext.Provider, {\n      value: handleValueSelect\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_suggestions_mjs__WEBPACK_IMPORTED_MODULE_8__.OnResetMatchCallbackContext.Provider, {\n      value: () => setMatch(null)\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(SuggestionsPortal, {\n      range,\n      container: document.body,\n      key: matchingString\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_suggestions_mjs__WEBPACK_IMPORTED_MODULE_8__.List, {\n      className: \"lb-lexical-suggestions-list lb-lexical-mention-suggestions-list\"\n    }, suggestions.map((userId) => /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_suggestions_mjs__WEBPACK_IMPORTED_MODULE_8__.Item, {\n      key: userId,\n      value: userId,\n      className: \"lb-lexical-suggestions-list-item lb-lexical-mention-suggestion\"\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_avatar_mjs__WEBPACK_IMPORTED_MODULE_9__.Avatar, {\n      userId,\n      className: \"lb-lexical-mention-suggestion-avatar\"\n    }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_user_mjs__WEBPACK_IMPORTED_MODULE_10__.User, {\n      userId,\n      className: \"lb-lexical-mention-suggestion-user\"\n    })))))))),\n    document.body\n  );\n}\nconst SUGGESTIONS_COLLISION_PADDING = 10;\nfunction SuggestionsPortal({\n  children,\n  range,\n  container\n}) {\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y\n  } = (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.useFloating)({\n    strategy: \"fixed\",\n    placement: \"top-start\",\n    middleware: [\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.flip)({ padding: SUGGESTIONS_COLLISION_PADDING, crossAxis: false }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.offset)(10),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.hide)({ padding: SUGGESTIONS_COLLISION_PADDING }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.shift)({ padding: SUGGESTIONS_COLLISION_PADDING, limiter: (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.limitShift)() }),\n      (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_11__.size)({ padding: SUGGESTIONS_COLLISION_PADDING })\n    ],\n    whileElementsMounted: (...args) => {\n      return (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_12__.autoUpdate)(...args, {\n        animationFrame: true\n      });\n    }\n  });\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {\n    setReference({\n      getBoundingClientRect: () => range.getBoundingClientRect()\n    });\n  }, [setReference, range]);\n  return (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(\n    /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n      ref: setFloating,\n      style: {\n        position: strategy,\n        top: 0,\n        left: 0,\n        transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n        minWidth: \"max-content\"\n      },\n      className: \"lb-root lb-portal lb-elevation lb-lexical-suggestions lb-lexical-mention-suggestions\"\n    }, children),\n    container\n  );\n}\n\n\n//# sourceMappingURL=mention-plugin.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL21lbnRpb24tcGx1Z2luLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBOEc7QUFDNUI7QUFDckM7QUFDRDtBQUNpQjtBQUNnSztBQUNuSTtBQUNqRDtBQUNIO0FBQytDO0FBQ3lDO0FBQzVGOztBQUVsQztBQUNBLCtDQUErQyxrQ0FBa0M7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRkFBb0YsdUJBQXVCO0FBQzNHO0FBQ0E7QUFDQSxvQkFBb0Isc0RBQWE7QUFDakMsT0FBTywwREFBaUI7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLHVCQUF1QjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isc0RBQWE7QUFDakMsT0FBTywwREFBaUI7QUFDeEI7QUFDQTtBQUNBO0FBQ0EsT0FBTyxvREFBVztBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixnR0FBeUI7QUFDNUMsNEJBQTRCLCtDQUFRO0FBQ3BDO0FBQ0Esc0JBQXNCLDJFQUFxQjtBQUMzQyxlQUFlLDJEQUFPO0FBQ3RCLEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixzREFBYTtBQUN0QztBQUNBO0FBQ0EsaUJBQWlCLGlFQUFjO0FBQy9CO0FBQ0EsaUJBQWlCLHVEQUFTO0FBQzFCO0FBQ0EsYUFBYTtBQUNiLFdBQVc7QUFDWCxV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QSxHQUFHO0FBQ0gsRUFBRSxzREFBZTtBQUNqQjtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSCxTQUFTLHVEQUFZO0FBQ3JCLG9CQUFvQixnREFBNEI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxjQUFjLE1BQU0sY0FBYztBQUNwRTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRXdEO0FBQ3hEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL21lbnRpb24tcGx1Z2luLm1qcz9jZWUyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUZsb2F0aW5nLCBmbGlwLCBvZmZzZXQsIGhpZGUsIHNoaWZ0LCBsaW1pdFNoaWZ0LCBzaXplLCBhdXRvVXBkYXRlIH0gZnJvbSAnQGZsb2F0aW5nLXVpL3JlYWN0LWRvbSc7XG5pbXBvcnQgeyB1c2VMZXhpY2FsQ29tcG9zZXJDb250ZXh0IH0gZnJvbSAnQGxleGljYWwvcmVhY3QvTGV4aWNhbENvbXBvc2VyQ29udGV4dCc7XG5pbXBvcnQgeyBrSW50ZXJuYWwgfSBmcm9tICdAbGl2ZWJsb2Nrcy9jb3JlJztcbmltcG9ydCB7IHVzZVJvb20gfSBmcm9tICdAbGl2ZWJsb2Nrcy9yZWFjdCc7XG5pbXBvcnQgeyB1c2VNZW50aW9uU3VnZ2VzdGlvbnMgfSBmcm9tICdAbGl2ZWJsb2Nrcy9yZWFjdC11aSc7XG5pbXBvcnQgeyAkZ2V0U2VsZWN0aW9uLCAkaXNSYW5nZVNlbGVjdGlvbiwgJGlzVGV4dE5vZGUsICRnZXROb2RlQnlLZXksICRpc05vZGVTZWxlY3Rpb24sICRjcmVhdGVUZXh0Tm9kZSwgJGNyZWF0ZVJhbmdlU2VsZWN0aW9uLCAkc2V0U2VsZWN0aW9uLCAkaXNFbGVtZW50Tm9kZSwgS0VZX0JBQ0tTUEFDRV9DT01NQU5ELCBDT01NQU5EX1BSSU9SSVRZX0xPVyB9IGZyb20gJ2xleGljYWwnO1xuaW1wb3J0IFJlYWN0X19kZWZhdWx0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrLCB1c2VMYXlvdXRFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBjcmVhdGVQb3J0YWwgfSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IHsgQXZhdGFyIH0gZnJvbSAnLi9hdmF0YXIubWpzJztcbmltcG9ydCB7ICRpc01lbnRpb25Ob2RlLCBNZW50aW9uTm9kZSwgJGNyZWF0ZU1lbnRpb25Ob2RlIH0gZnJvbSAnLi9tZW50aW9uLW5vZGUubWpzJztcbmltcG9ydCB7IFN1Z2dlc3Rpb25zQ29udGV4dCwgT25WYWx1ZVNlbGVjdENhbGxiYWNrQ29udGV4dCwgT25SZXNldE1hdGNoQ2FsbGJhY2tDb250ZXh0LCBMaXN0LCBJdGVtIH0gZnJvbSAnLi9zdWdnZXN0aW9ucy5tanMnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4vdXNlci5tanMnO1xuXG5jb25zdCBNRU5USU9OX1RSSUdHRVIgPSBcIkBcIjtcbmNvbnN0IFBVTkNUVUFUSU9OUyA9IGBcXFxcLixcXFxcK1xcXFwqXFxcXD9cXFxcJFxcXFxAXFxcXHwje31cXFxcKFxcXFwpXFxcXF5cXFxcLVxcXFxbXFxcXF1cXFxcXFxcXC8hJSdcIn49PD5fOjtgO1xuY29uc3QgVkFMSURfQ0hBUkFDVEVSUyA9IFwiW15cIiArIE1FTlRJT05fVFJJR0dFUiArIFBVTkNUVUFUSU9OUyArIFwiXFxcXHNdXCI7XG5jb25zdCBWQUxJRF9KT0lOUyA9IFwiKD86XFxcXC5bIHwkXXwgfFtcIiArIFBVTkNUVUFUSU9OUyArIFwiXXwpXCI7XG5jb25zdCBMRU5HVEhfTElNSVQgPSA3NTtcbmNvbnN0IE1lbnRpb25SZWdleCA9IG5ldyBSZWdFeHAoXG4gIFwiKF58XFxcXHN8XFxcXCgpKFtcIiArIE1FTlRJT05fVFJJR0dFUiArIFwiXSgoPzpcIiArIFZBTElEX0NIQVJBQ1RFUlMgKyBWQUxJRF9KT0lOUyArIFwiKXswLFwiICsgTEVOR1RIX0xJTUlUICsgXCJ9KSkkXCJcbik7XG5mdW5jdGlvbiAkZ2V0QW5jaG9yTm9kZVRleHRDb250ZW50KCkge1xuICBjb25zdCBzZWxlY3Rpb24gPSAkZ2V0U2VsZWN0aW9uKCk7XG4gIGlmICghJGlzUmFuZ2VTZWxlY3Rpb24oc2VsZWN0aW9uKSlcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3QgYW5jaG9yID0gc2VsZWN0aW9uLmFuY2hvcjtcbiAgaWYgKGFuY2hvci50eXBlICE9PSBcInRleHRcIilcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3QgYW5jaG9yTm9kZSA9IGFuY2hvci5nZXROb2RlKCk7XG4gIGlmICghYW5jaG9yTm9kZS5pc1NpbXBsZVRleHQoKSlcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3QgYW5jaG9yT2Zmc2V0ID0gYW5jaG9yLm9mZnNldDtcbiAgcmV0dXJuIGFuY2hvck5vZGUuZ2V0VGV4dENvbnRlbnQoKS5zbGljZSgwLCBhbmNob3JPZmZzZXQpO1xufVxuZnVuY3Rpb24gZ2V0RnVsbE1hdGNoT2Zmc2V0KGRvY3VtZW50VGV4dCwgZW50cnlUZXh0LCBvZmZzZXQyKSB7XG4gIGxldCB0cmlnZ2VyT2Zmc2V0ID0gb2Zmc2V0MjtcbiAgZm9yIChsZXQgaSA9IHRyaWdnZXJPZmZzZXQ7IGkgPD0gZW50cnlUZXh0Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGRvY3VtZW50VGV4dC5zdWJzdHIoLWkpID09PSBlbnRyeVRleHQuc3Vic3RyKDAsIGkpKSB7XG4gICAgICB0cmlnZ2VyT2Zmc2V0ID0gaTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRyaWdnZXJPZmZzZXQ7XG59XG5mdW5jdGlvbiAkaXNDdXJyZW50U2VsZWN0aW9uQXRCb3VuZGFyeShvZmZzZXQyKSB7XG4gIGlmIChvZmZzZXQyICE9PSAwKVxuICAgIHJldHVybiBmYWxzZTtcbiAgY29uc3Qgc2VsZWN0aW9uID0gJGdldFNlbGVjdGlvbigpO1xuICBpZiAoISRpc1JhbmdlU2VsZWN0aW9uKHNlbGVjdGlvbikpXG4gICAgcmV0dXJuIGZhbHNlO1xuICBjb25zdCBhbmNob3IgPSBzZWxlY3Rpb24uYW5jaG9yLmdldE5vZGUoKTtcbiAgY29uc3QgcHJldlNpYmxpbmcgPSBhbmNob3IuZ2V0UHJldmlvdXNTaWJsaW5nKCk7XG4gIGlmICghJGlzVGV4dE5vZGUocHJldlNpYmxpbmcpKVxuICAgIHJldHVybiBmYWxzZTtcbiAgaWYgKCFwcmV2U2libGluZy5pc1RleHRFbnRpdHkoKSlcbiAgICByZXR1cm4gZmFsc2U7XG4gIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gJGdldFJhbmdlQXRNYXRjaChtYXRjaCkge1xuICBjb25zdCBvZmZzZXRXaXRoV2hpdGVzcGFjZXMgPSBtYXRjaC5pbmRleCArIG1hdGNoWzFdLmxlbmd0aDtcbiAgaWYgKCRpc0N1cnJlbnRTZWxlY3Rpb25BdEJvdW5kYXJ5KG9mZnNldFdpdGhXaGl0ZXNwYWNlcykpXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgaWYgKHNlbGVjdGlvbiA9PT0gbnVsbClcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFzZWxlY3Rpb24uaXNDb2xsYXBzZWQpXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGFuY2hvciA9IHNlbGVjdGlvbi5hbmNob3JOb2RlO1xuICBpZiAoYW5jaG9yID09PSBudWxsKVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBlbmRPZmZzZXQgPSBzZWxlY3Rpb24uYW5jaG9yT2Zmc2V0O1xuICBpZiAoZW5kT2Zmc2V0ID09PSBudWxsKVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gIHRyeSB7XG4gICAgcmFuZ2Uuc2V0U3RhcnQoYW5jaG9yLCBvZmZzZXRXaXRoV2hpdGVzcGFjZXMpO1xuICAgIHJhbmdlLnNldEVuZChhbmNob3IsIGVuZE9mZnNldCk7XG4gICAgcmV0dXJuIHJhbmdlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5mdW5jdGlvbiBNZW50aW9uUGx1Z2luKCkge1xuICBjb25zdCBbZWRpdG9yXSA9IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQoKTtcbiAgY29uc3QgW21hdGNoLCBzZXRNYXRjaF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgY29uc3QgbWF0Y2hpbmdTdHJpbmcgPSBtYXRjaD8uWzNdO1xuICBjb25zdCBzdWdnZXN0aW9ucyA9IHVzZU1lbnRpb25TdWdnZXN0aW9ucyhtYXRjaGluZ1N0cmluZyk7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZnVuY3Rpb24gJGhhbmRsZU11dGF0aW9uKG11dGF0aW9ucywge1xuICAgICAgcHJldkVkaXRvclN0YXRlXG4gICAgfSkge1xuICAgICAgZm9yIChjb25zdCBba2V5LCBtdXRhdGlvbl0gb2YgbXV0YXRpb25zKSB7XG4gICAgICAgIGlmIChtdXRhdGlvbiA9PT0gXCJjcmVhdGVkXCIpIHtcbiAgICAgICAgICBlZGl0b3IuZ2V0RWRpdG9yU3RhdGUoKS5yZWFkKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSAkZ2V0Tm9kZUJ5S2V5KGtleSk7XG4gICAgICAgICAgICBpZiAobm9kZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKCEkaXNNZW50aW9uTm9kZShub2RlKSlcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgcm9vbVtrSW50ZXJuYWxdLmNyZWF0ZVRleHRNZW50aW9uKG5vZGUuZ2V0VXNlcklkKCksIG5vZGUuZ2V0SWQoKSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChtdXRhdGlvbiA9PT0gXCJkZXN0cm95ZWRcIikge1xuICAgICAgICAgIHByZXZFZGl0b3JTdGF0ZS5yZWFkKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSAkZ2V0Tm9kZUJ5S2V5KGtleSk7XG4gICAgICAgICAgICBpZiAobm9kZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKCEkaXNNZW50aW9uTm9kZShub2RlKSlcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgcm9vbVtrSW50ZXJuYWxdLmRlbGV0ZVRleHRNZW50aW9uKG5vZGUuZ2V0SWQoKSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZWRpdG9yLnJlZ2lzdGVyTXV0YXRpb25MaXN0ZW5lcihcbiAgICAgIE1lbnRpb25Ob2RlLFxuICAgICAgKG11dGF0aW9ucywgcGF5bG9hZCkgPT4ge1xuICAgICAgICBpZiAocGF5bG9hZC51cGRhdGVUYWdzLmhhcyhcImNvbGxhYm9yYXRpb25cIikpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkaGFuZGxlTXV0YXRpb24obXV0YXRpb25zLCBwYXlsb2FkKTtcbiAgICAgIH1cbiAgICApO1xuICB9LCBbZWRpdG9yLCByb29tXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZnVuY3Rpb24gJG9uU3RhdGVSZWFkKCkge1xuICAgICAgY29uc3QgdGV4dCA9ICRnZXRBbmNob3JOb2RlVGV4dENvbnRlbnQoKTtcbiAgICAgIGlmICh0ZXh0ID09PSBudWxsKSB7XG4gICAgICAgIHNldE1hdGNoKG51bGwpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBtYXRjaDIgPSBNZW50aW9uUmVnZXguZXhlYyh0ZXh0KTtcbiAgICAgIHNldE1hdGNoKG1hdGNoMik7XG4gICAgfVxuICAgIHJldHVybiBlZGl0b3IucmVnaXN0ZXJVcGRhdGVMaXN0ZW5lcigoeyBlZGl0b3JTdGF0ZTogc3RhdGUgfSkgPT4ge1xuICAgICAgc3RhdGUucmVhZCgkb25TdGF0ZVJlYWQpO1xuICAgIH0pO1xuICB9LCBbZWRpdG9yXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZnVuY3Rpb24gJGhhbmRsZUJhY2tzcGFjZShldmVudCkge1xuICAgICAgY29uc3Qgc2VsZWN0aW9uID0gJGdldFNlbGVjdGlvbigpO1xuICAgICAgaWYgKHNlbGVjdGlvbiA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgaWYgKCRpc05vZGVTZWxlY3Rpb24oc2VsZWN0aW9uKSkge1xuICAgICAgICBjb25zdCBub2RlcyA9IHNlbGVjdGlvbi5nZXROb2RlcygpO1xuICAgICAgICBpZiAobm9kZXMubGVuZ3RoICE9PSAxKVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzWzBdO1xuICAgICAgICBpZiAoISRpc01lbnRpb25Ob2RlKG5vZGUpKVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgdGV4dCA9ICRjcmVhdGVUZXh0Tm9kZShcIkBcIik7XG4gICAgICAgIG5vZGUucmVwbGFjZSh0ZXh0KTtcbiAgICAgICAgY29uc3QgbmV3U2VsZWN0aW9uID0gJGNyZWF0ZVJhbmdlU2VsZWN0aW9uKCk7XG4gICAgICAgIG5ld1NlbGVjdGlvbi5zZXRUZXh0Tm9kZVJhbmdlKHRleHQsIDEsIHRleHQsIDEpO1xuICAgICAgICAkc2V0U2VsZWN0aW9uKG5ld1NlbGVjdGlvbik7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmICgkaXNSYW5nZVNlbGVjdGlvbihzZWxlY3Rpb24pKSB7XG4gICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCBhbmNob3IgPSBzZWxlY3Rpb24uYW5jaG9yLmdldE5vZGUoKTtcbiAgICAgICAgY29uc3QgcHJldlNpYmxpbmcgPSBhbmNob3IuZ2V0UHJldmlvdXNTaWJsaW5nKCk7XG4gICAgICAgIGlmIChzZWxlY3Rpb24uYW5jaG9yLm9mZnNldCA9PT0gMCAmJiAkaXNNZW50aW9uTm9kZShwcmV2U2libGluZykpIHtcbiAgICAgICAgICBjb25zdCB0ZXh0ID0gJGNyZWF0ZVRleHROb2RlKFwiQFwiKTtcbiAgICAgICAgICBwcmV2U2libGluZy5yZXBsYWNlKHRleHQpO1xuICAgICAgICAgIGNvbnN0IG5ld1NlbGVjdGlvbiA9ICRjcmVhdGVSYW5nZVNlbGVjdGlvbigpO1xuICAgICAgICAgIG5ld1NlbGVjdGlvbi5zZXRUZXh0Tm9kZVJhbmdlKHRleHQsIDEsIHRleHQsIDEpO1xuICAgICAgICAgICRzZXRTZWxlY3Rpb24obmV3U2VsZWN0aW9uKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKCRpc0VsZW1lbnROb2RlKGFuY2hvcikpIHtcbiAgICAgICAgICBjb25zdCBjaGlsZCA9IGFuY2hvci5nZXRDaGlsZEF0SW5kZXgoc2VsZWN0aW9uLmFuY2hvci5vZmZzZXQgLSAxKTtcbiAgICAgICAgICBpZiAoISRpc01lbnRpb25Ob2RlKGNoaWxkKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICBjb25zdCB0ZXh0ID0gJGNyZWF0ZVRleHROb2RlKFwiQFwiKTtcbiAgICAgICAgICBjaGlsZC5yZXBsYWNlKHRleHQpO1xuICAgICAgICAgIGNvbnN0IG5ld1NlbGVjdGlvbiA9ICRjcmVhdGVSYW5nZVNlbGVjdGlvbigpO1xuICAgICAgICAgIG5ld1NlbGVjdGlvbi5zZXRUZXh0Tm9kZVJhbmdlKHRleHQsIDEsIHRleHQsIDEpO1xuICAgICAgICAgICRzZXRTZWxlY3Rpb24obmV3U2VsZWN0aW9uKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlckNvbW1hbmQoXG4gICAgICBLRVlfQkFDS1NQQUNFX0NPTU1BTkQsXG4gICAgICAkaGFuZGxlQmFja3NwYWNlLFxuICAgICAgQ09NTUFORF9QUklPUklUWV9MT1dcbiAgICApO1xuICB9LCBbZWRpdG9yXSk7XG4gIGNvbnN0IGhhbmRsZVZhbHVlU2VsZWN0ID0gdXNlQ2FsbGJhY2soXG4gICAgKHVzZXJJZCkgPT4ge1xuICAgICAgZnVuY3Rpb24gJG9uVmFsdWVTZWxlY3QoKSB7XG4gICAgICAgIGlmIChtYXRjaCA9PT0gbnVsbClcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIHNldE1hdGNoKG51bGwpO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSAkZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIGlmICghJGlzUmFuZ2VTZWxlY3Rpb24oc2VsZWN0aW9uKSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBhbmNob3IgPSBzZWxlY3Rpb24uYW5jaG9yO1xuICAgICAgICBpZiAoYW5jaG9yLnR5cGUgIT09IFwidGV4dFwiKVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgYW5jaG9yTm9kZSA9IGFuY2hvci5nZXROb2RlKCk7XG4gICAgICAgIGlmICghYW5jaG9yTm9kZS5pc1NpbXBsZVRleHQoKSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbk9mZnNldCA9IGFuY2hvci5vZmZzZXQ7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhbmNob3JOb2RlLmdldFRleHRDb250ZW50KCkuc2xpY2UoMCwgc2VsZWN0aW9uT2Zmc2V0KTtcbiAgICAgICAgY29uc3QgY2hhcmFjdGVyT2Zmc2V0ID0gbWF0Y2hbMl0ubGVuZ3RoO1xuICAgICAgICBjb25zdCBxdWVyeU9mZnNldCA9IGdldEZ1bGxNYXRjaE9mZnNldCh0ZXh0LCBtYXRjaFsyXSwgY2hhcmFjdGVyT2Zmc2V0KTtcbiAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPSBzZWxlY3Rpb25PZmZzZXQgLSBxdWVyeU9mZnNldDtcbiAgICAgICAgaWYgKHN0YXJ0T2Zmc2V0IDwgMClcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IG1lbnRpb25Ob2RlID0gJGNyZWF0ZU1lbnRpb25Ob2RlKHVzZXJJZCk7XG4gICAgICAgIGlmIChzdGFydE9mZnNldCA9PT0gMCkge1xuICAgICAgICAgIGNvbnN0IFtub2RlXSA9IGFuY2hvck5vZGUuc3BsaXRUZXh0KHNlbGVjdGlvbk9mZnNldCk7XG4gICAgICAgICAgbm9kZS5yZXBsYWNlKG1lbnRpb25Ob2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBbLCBub2RlXSA9IGFuY2hvck5vZGUuc3BsaXRUZXh0KHN0YXJ0T2Zmc2V0LCBzZWxlY3Rpb25PZmZzZXQpO1xuICAgICAgICAgIG5vZGUucmVwbGFjZShtZW50aW9uTm9kZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVkaXRvci51cGRhdGUoJG9uVmFsdWVTZWxlY3QpO1xuICAgIH0sXG4gICAgW2VkaXRvciwgbWF0Y2hdXG4gICk7XG4gIGlmIChtYXRjaCA9PT0gbnVsbCB8fCBtYXRjaGluZ1N0cmluZyA9PT0gdm9pZCAwKVxuICAgIHJldHVybiBudWxsO1xuICBpZiAoc3VnZ2VzdGlvbnMgPT09IHZvaWQgMCB8fCBzdWdnZXN0aW9ucy5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IHJhbmdlID0gZWRpdG9yLmdldEVkaXRvclN0YXRlKCkucmVhZCgoKSA9PiAkZ2V0UmFuZ2VBdE1hdGNoKG1hdGNoKSk7XG4gIGlmIChyYW5nZSA9PT0gbnVsbClcbiAgICByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIGNyZWF0ZVBvcnRhbChcbiAgICAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChTdWdnZXN0aW9uc0NvbnRleHQuUHJvdmlkZXIsIHtcbiAgICAgIHZhbHVlOiBzdWdnZXN0aW9uc1xuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KE9uVmFsdWVTZWxlY3RDYWxsYmFja0NvbnRleHQuUHJvdmlkZXIsIHtcbiAgICAgIHZhbHVlOiBoYW5kbGVWYWx1ZVNlbGVjdFxuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KE9uUmVzZXRNYXRjaENhbGxiYWNrQ29udGV4dC5Qcm92aWRlciwge1xuICAgICAgdmFsdWU6ICgpID0+IHNldE1hdGNoKG51bGwpXG4gICAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoU3VnZ2VzdGlvbnNQb3J0YWwsIHtcbiAgICAgIHJhbmdlLFxuICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5ib2R5LFxuICAgICAga2V5OiBtYXRjaGluZ1N0cmluZ1xuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KExpc3QsIHtcbiAgICAgIGNsYXNzTmFtZTogXCJsYi1sZXhpY2FsLXN1Z2dlc3Rpb25zLWxpc3QgbGItbGV4aWNhbC1tZW50aW9uLXN1Z2dlc3Rpb25zLWxpc3RcIlxuICAgIH0sIHN1Z2dlc3Rpb25zLm1hcCgodXNlcklkKSA9PiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChJdGVtLCB7XG4gICAgICBrZXk6IHVzZXJJZCxcbiAgICAgIHZhbHVlOiB1c2VySWQsXG4gICAgICBjbGFzc05hbWU6IFwibGItbGV4aWNhbC1zdWdnZXN0aW9ucy1saXN0LWl0ZW0gbGItbGV4aWNhbC1tZW50aW9uLXN1Z2dlc3Rpb25cIlxuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEF2YXRhciwge1xuICAgICAgdXNlcklkLFxuICAgICAgY2xhc3NOYW1lOiBcImxiLWxleGljYWwtbWVudGlvbi1zdWdnZXN0aW9uLWF2YXRhclwiXG4gICAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFVzZXIsIHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNsYXNzTmFtZTogXCJsYi1sZXhpY2FsLW1lbnRpb24tc3VnZ2VzdGlvbi11c2VyXCJcbiAgICB9KSkpKSkpKSksXG4gICAgZG9jdW1lbnQuYm9keVxuICApO1xufVxuY29uc3QgU1VHR0VTVElPTlNfQ09MTElTSU9OX1BBRERJTkcgPSAxMDtcbmZ1bmN0aW9uIFN1Z2dlc3Rpb25zUG9ydGFsKHtcbiAgY2hpbGRyZW4sXG4gIHJhbmdlLFxuICBjb250YWluZXJcbn0pIHtcbiAgY29uc3Qge1xuICAgIHJlZnM6IHsgc2V0UmVmZXJlbmNlLCBzZXRGbG9hdGluZyB9LFxuICAgIHN0cmF0ZWd5LFxuICAgIHgsXG4gICAgeVxuICB9ID0gdXNlRmxvYXRpbmcoe1xuICAgIHN0cmF0ZWd5OiBcImZpeGVkXCIsXG4gICAgcGxhY2VtZW50OiBcInRvcC1zdGFydFwiLFxuICAgIG1pZGRsZXdhcmU6IFtcbiAgICAgIGZsaXAoeyBwYWRkaW5nOiBTVUdHRVNUSU9OU19DT0xMSVNJT05fUEFERElORywgY3Jvc3NBeGlzOiBmYWxzZSB9KSxcbiAgICAgIG9mZnNldCgxMCksXG4gICAgICBoaWRlKHsgcGFkZGluZzogU1VHR0VTVElPTlNfQ09MTElTSU9OX1BBRERJTkcgfSksXG4gICAgICBzaGlmdCh7IHBhZGRpbmc6IFNVR0dFU1RJT05TX0NPTExJU0lPTl9QQURESU5HLCBsaW1pdGVyOiBsaW1pdFNoaWZ0KCkgfSksXG4gICAgICBzaXplKHsgcGFkZGluZzogU1VHR0VTVElPTlNfQ09MTElTSU9OX1BBRERJTkcgfSlcbiAgICBdLFxuICAgIHdoaWxlRWxlbWVudHNNb3VudGVkOiAoLi4uYXJncykgPT4ge1xuICAgICAgcmV0dXJuIGF1dG9VcGRhdGUoLi4uYXJncywge1xuICAgICAgICBhbmltYXRpb25GcmFtZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBzZXRSZWZlcmVuY2Uoe1xuICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0OiAoKSA9PiByYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgIH0pO1xuICB9LCBbc2V0UmVmZXJlbmNlLCByYW5nZV0pO1xuICByZXR1cm4gY3JlYXRlUG9ydGFsKFxuICAgIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAgIHJlZjogc2V0RmxvYXRpbmcsXG4gICAgICBzdHlsZToge1xuICAgICAgICBwb3NpdGlvbjogc3RyYXRlZ3ksXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlM2QoJHtNYXRoLnJvdW5kKHgpfXB4LCAke01hdGgucm91bmQoeSl9cHgsIDApYCxcbiAgICAgICAgbWluV2lkdGg6IFwibWF4LWNvbnRlbnRcIlxuICAgICAgfSxcbiAgICAgIGNsYXNzTmFtZTogXCJsYi1yb290IGxiLXBvcnRhbCBsYi1lbGV2YXRpb24gbGItbGV4aWNhbC1zdWdnZXN0aW9ucyBsYi1sZXhpY2FsLW1lbnRpb24tc3VnZ2VzdGlvbnNcIlxuICAgIH0sIGNoaWxkcmVuKSxcbiAgICBjb250YWluZXJcbiAgKTtcbn1cblxuZXhwb3J0IHsgTWVudGlvblBsdWdpbiwgU1VHR0VTVElPTlNfQ09MTElTSU9OX1BBRERJTkcgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1lbnRpb24tcGx1Z2luLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/mention-plugin.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/suggestions.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/mentions/suggestions.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Item: () => (/* binding */ Item),\n/* harmony export */   List: () => (/* binding */ List),\n/* harmony export */   OnResetMatchCallbackContext: () => (/* binding */ OnResetMatchCallbackContext),\n/* harmony export */   OnValueSelectCallbackContext: () => (/* binding */ OnValueSelectCallbackContext),\n/* harmony export */   SuggestionsContext: () => (/* binding */ SuggestionsContext)\n/* harmony export */ });\n/* harmony import */ var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @lexical/react/LexicalComposerContext */ \"(ssr)/./node_modules/@lexical/react/LexicalComposerContext.dev.mjs\");\n/* harmony import */ var lexical__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lexical */ \"(ssr)/./node_modules/lexical/Lexical.dev.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\n\n\nconst SuggestionsContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst OnValueSelectCallbackContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst OnResetMatchCallbackContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(\n  null\n);\nconst HighlightedIndexContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst List = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  function(props, forwardedRef) {\n    const { children, ...divProps } = props;\n    const [editor] = (0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__.useLexicalComposerContext)();\n    const [highlightedIndex, setHighlightedIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0);\n    const values = useSuggestions();\n    const onValueSelect = useOnValueSelectCallback();\n    const onEscapeKeyDown = useOnResetMatchCallback();\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      function onKeyArrowDown(event) {\n        if (values.length === 0)\n          return true;\n        if (highlightedIndex === null)\n          return true;\n        const nextIndex = highlightedIndex === values.length - 1 ? 0 : highlightedIndex + 1;\n        setHighlightedIndex(nextIndex);\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        return true;\n      }\n      return editor.registerCommand(\n        lexical__WEBPACK_IMPORTED_MODULE_2__.KEY_ARROW_DOWN_COMMAND,\n        onKeyArrowDown,\n        lexical__WEBPACK_IMPORTED_MODULE_2__.COMMAND_PRIORITY_LOW\n      );\n    }, [editor, highlightedIndex, values]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      function onKeyArrowUp(event) {\n        if (values.length === 0)\n          return true;\n        if (highlightedIndex === null)\n          return true;\n        const nextIndex = highlightedIndex === 0 ? values.length - 1 : highlightedIndex - 1;\n        setHighlightedIndex(nextIndex);\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        return true;\n      }\n      return editor.registerCommand(\n        lexical__WEBPACK_IMPORTED_MODULE_2__.KEY_ARROW_UP_COMMAND,\n        onKeyArrowUp,\n        lexical__WEBPACK_IMPORTED_MODULE_2__.COMMAND_PRIORITY_LOW\n      );\n    }, [editor, highlightedIndex, values]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      function onKeyEscape(event) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        onEscapeKeyDown();\n        return true;\n      }\n      return editor.registerCommand(\n        lexical__WEBPACK_IMPORTED_MODULE_2__.KEY_ESCAPE_COMMAND,\n        onKeyEscape,\n        lexical__WEBPACK_IMPORTED_MODULE_2__.COMMAND_PRIORITY_LOW\n      );\n    }, [editor, onEscapeKeyDown]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      function onKeyEnter(event) {\n        if (values.length === 0)\n          return true;\n        onValueSelect(values[highlightedIndex]);\n        if (event === null)\n          return true;\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        return true;\n      }\n      return editor.registerCommand(\n        lexical__WEBPACK_IMPORTED_MODULE_2__.KEY_ENTER_COMMAND,\n        onKeyEnter,\n        lexical__WEBPACK_IMPORTED_MODULE_2__.COMMAND_PRIORITY_LOW\n      );\n    }, [editor, onValueSelect, highlightedIndex, values]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      const root = editor.getRootElement();\n      if (root === null)\n        return;\n      root.setAttribute(\n        \"aria-activedescendant\",\n        `typeahead-item-${highlightedIndex}`\n      );\n      return () => {\n        root.removeAttribute(\"aria-activedescendant\");\n      };\n    }, [editor, highlightedIndex]);\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(HighlightedIndexContext.Provider, {\n      value: [highlightedIndex, setHighlightedIndex]\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n      role: \"listbox\",\n      ...divProps,\n      ref: forwardedRef\n    }, children));\n  }\n);\nconst Item = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  function Item2(props, forwardedRef) {\n    const { children, value, onMouseEnter, onClick, ...divProps } = props;\n    const divRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const [highlightedIndex, setHighlightedIndex] = useHighlightedIndex();\n    const suggestions = useSuggestions();\n    const onValueSelect = useOnValueSelectCallback();\n    const isHighlighted = suggestions[highlightedIndex] === value;\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useImperativeHandle)(\n      forwardedRef,\n      () => divRef.current\n    );\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      if (!isHighlighted)\n        return;\n      const div = divRef.current;\n      if (div === null)\n        return;\n      div.scrollIntoView({ block: \"nearest\" });\n    }, [isHighlighted]);\n    function handleMouseEnter(event) {\n      onMouseEnter?.(event);\n      if (event.isDefaultPrevented())\n        return;\n      const index = suggestions.indexOf(value);\n      if (index === -1)\n        return;\n      setHighlightedIndex(index);\n    }\n    function handleClick(event) {\n      onClick?.(event);\n      if (event.isDefaultPrevented())\n        return;\n      onValueSelect(value);\n    }\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n      role: \"option\",\n      \"data-highlighted\": isHighlighted || void 0,\n      onMouseEnter: handleMouseEnter,\n      onClick: handleClick,\n      ...divProps,\n      ref: divRef\n    }, children);\n  }\n);\nfunction useHighlightedIndex() {\n  const context = react__WEBPACK_IMPORTED_MODULE_0__.useContext(HighlightedIndexContext);\n  if (context === null) {\n    throw new Error(\n      \"useHighlightedIndex must be used within a HighlightedIndexProvider\"\n    );\n  }\n  return context;\n}\nfunction useSuggestions() {\n  const suggestions = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(SuggestionsContext);\n  if (suggestions === null) {\n    throw new Error(\"useSuggestions: SuggestionsContext not found\");\n  }\n  return suggestions;\n}\nfunction useOnValueSelectCallback() {\n  const onValueSelect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(OnValueSelectCallbackContext);\n  if (onValueSelect === null) {\n    throw new Error(\"useOnValueSelectCallback: OnValueSelectContext not found\");\n  }\n  return onValueSelect;\n}\nfunction useOnResetMatchCallback() {\n  const onResetMatch = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(OnResetMatchCallbackContext);\n  if (onResetMatch === null) {\n    throw new Error(\"useOnResetMatchCallback: OnResetMatchContext not found\");\n  }\n  return onResetMatch;\n}\n\n\n//# sourceMappingURL=suggestions.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL3N1Z2dlc3Rpb25zLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFrRjtBQUNrRDtBQUNKOztBQUVoSSwyQkFBMkIsb0RBQWE7QUFDeEMscUNBQXFDLG9EQUFhO0FBQ2xELG9DQUFvQyxvREFBYTtBQUNqRDtBQUNBO0FBQ0EsZ0NBQWdDLG9EQUFhO0FBQzdDLGFBQWEsaURBQVU7QUFDdkI7QUFDQSxZQUFZLHdCQUF3QjtBQUNwQyxxQkFBcUIsZ0dBQXlCO0FBQzlDLG9EQUFvRCwrQ0FBUTtBQUM1RDtBQUNBO0FBQ0E7QUFDQSxJQUFJLGdEQUFTO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwyREFBc0I7QUFDOUI7QUFDQSxRQUFRLHlEQUFvQjtBQUM1QjtBQUNBLEtBQUs7QUFDTCxJQUFJLGdEQUFTO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSx5REFBb0I7QUFDNUI7QUFDQSxRQUFRLHlEQUFvQjtBQUM1QjtBQUNBLEtBQUs7QUFDTCxJQUFJLGdEQUFTO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVEQUFrQjtBQUMxQjtBQUNBLFFBQVEseURBQW9CO0FBQzVCO0FBQ0EsS0FBSztBQUNMLElBQUksZ0RBQVM7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBaUI7QUFDekI7QUFDQSxRQUFRLHlEQUFvQjtBQUM1QjtBQUNBLEtBQUs7QUFDTCxJQUFJLGdEQUFTO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpQkFBaUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsMkJBQTJCLGdEQUE0QjtBQUN2RDtBQUNBLEtBQUssa0JBQWtCLGdEQUE0QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGFBQWEsaURBQVU7QUFDdkI7QUFDQSxZQUFZLHNEQUFzRDtBQUNsRSxtQkFBbUIsNkNBQU07QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLDBEQUFtQjtBQUN2QjtBQUNBO0FBQ0E7QUFDQSxJQUFJLGdEQUFTO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0MsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixnREFBNEI7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiw2Q0FBeUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixpREFBVTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsaURBQVU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlEQUFVO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFHO0FBQ3JHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL3N1Z2dlc3Rpb25zLm1qcz9jYjE5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUxleGljYWxDb21wb3NlckNvbnRleHQgfSBmcm9tICdAbGV4aWNhbC9yZWFjdC9MZXhpY2FsQ29tcG9zZXJDb250ZXh0JztcbmltcG9ydCB7IEtFWV9BUlJPV19ET1dOX0NPTU1BTkQsIENPTU1BTkRfUFJJT1JJVFlfTE9XLCBLRVlfQVJST1dfVVBfQ09NTUFORCwgS0VZX0VTQ0FQRV9DT01NQU5ELCBLRVlfRU5URVJfQ09NTUFORCB9IGZyb20gJ2xleGljYWwnO1xuaW1wb3J0IFJlYWN0X19kZWZhdWx0LCB7IGNyZWF0ZUNvbnRleHQsIGZvcndhcmRSZWYsIHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlSW1wZXJhdGl2ZUhhbmRsZSwgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcblxuY29uc3QgU3VnZ2VzdGlvbnNDb250ZXh0ID0gY3JlYXRlQ29udGV4dChudWxsKTtcbmNvbnN0IE9uVmFsdWVTZWxlY3RDYWxsYmFja0NvbnRleHQgPSBjcmVhdGVDb250ZXh0KG51bGwpO1xuY29uc3QgT25SZXNldE1hdGNoQ2FsbGJhY2tDb250ZXh0ID0gY3JlYXRlQ29udGV4dChcbiAgbnVsbFxuKTtcbmNvbnN0IEhpZ2hsaWdodGVkSW5kZXhDb250ZXh0ID0gY3JlYXRlQ29udGV4dChudWxsKTtcbmNvbnN0IExpc3QgPSBmb3J3YXJkUmVmKFxuICBmdW5jdGlvbihwcm9wcywgZm9yd2FyZGVkUmVmKSB7XG4gICAgY29uc3QgeyBjaGlsZHJlbiwgLi4uZGl2UHJvcHMgfSA9IHByb3BzO1xuICAgIGNvbnN0IFtlZGl0b3JdID0gdXNlTGV4aWNhbENvbXBvc2VyQ29udGV4dCgpO1xuICAgIGNvbnN0IFtoaWdobGlnaHRlZEluZGV4LCBzZXRIaWdobGlnaHRlZEluZGV4XSA9IHVzZVN0YXRlKDApO1xuICAgIGNvbnN0IHZhbHVlcyA9IHVzZVN1Z2dlc3Rpb25zKCk7XG4gICAgY29uc3Qgb25WYWx1ZVNlbGVjdCA9IHVzZU9uVmFsdWVTZWxlY3RDYWxsYmFjaygpO1xuICAgIGNvbnN0IG9uRXNjYXBlS2V5RG93biA9IHVzZU9uUmVzZXRNYXRjaENhbGxiYWNrKCk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGZ1bmN0aW9uIG9uS2V5QXJyb3dEb3duKGV2ZW50KSB7XG4gICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAoaGlnaGxpZ2h0ZWRJbmRleCA9PT0gbnVsbClcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gaGlnaGxpZ2h0ZWRJbmRleCA9PT0gdmFsdWVzLmxlbmd0aCAtIDEgPyAwIDogaGlnaGxpZ2h0ZWRJbmRleCArIDE7XG4gICAgICAgIHNldEhpZ2hsaWdodGVkSW5kZXgobmV4dEluZGV4KTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlckNvbW1hbmQoXG4gICAgICAgIEtFWV9BUlJPV19ET1dOX0NPTU1BTkQsXG4gICAgICAgIG9uS2V5QXJyb3dEb3duLFxuICAgICAgICBDT01NQU5EX1BSSU9SSVRZX0xPV1xuICAgICAgKTtcbiAgICB9LCBbZWRpdG9yLCBoaWdobGlnaHRlZEluZGV4LCB2YWx1ZXNdKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgZnVuY3Rpb24gb25LZXlBcnJvd1VwKGV2ZW50KSB7XG4gICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAoaGlnaGxpZ2h0ZWRJbmRleCA9PT0gbnVsbClcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gaGlnaGxpZ2h0ZWRJbmRleCA9PT0gMCA/IHZhbHVlcy5sZW5ndGggLSAxIDogaGlnaGxpZ2h0ZWRJbmRleCAtIDE7XG4gICAgICAgIHNldEhpZ2hsaWdodGVkSW5kZXgobmV4dEluZGV4KTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlckNvbW1hbmQoXG4gICAgICAgIEtFWV9BUlJPV19VUF9DT01NQU5ELFxuICAgICAgICBvbktleUFycm93VXAsXG4gICAgICAgIENPTU1BTkRfUFJJT1JJVFlfTE9XXG4gICAgICApO1xuICAgIH0sIFtlZGl0b3IsIGhpZ2hsaWdodGVkSW5kZXgsIHZhbHVlc10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBmdW5jdGlvbiBvbktleUVzY2FwZShldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgb25Fc2NhcGVLZXlEb3duKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlckNvbW1hbmQoXG4gICAgICAgIEtFWV9FU0NBUEVfQ09NTUFORCxcbiAgICAgICAgb25LZXlFc2NhcGUsXG4gICAgICAgIENPTU1BTkRfUFJJT1JJVFlfTE9XXG4gICAgICApO1xuICAgIH0sIFtlZGl0b3IsIG9uRXNjYXBlS2V5RG93bl0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBmdW5jdGlvbiBvbktleUVudGVyKGV2ZW50KSB7XG4gICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBvblZhbHVlU2VsZWN0KHZhbHVlc1toaWdobGlnaHRlZEluZGV4XSk7XG4gICAgICAgIGlmIChldmVudCA9PT0gbnVsbClcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVkaXRvci5yZWdpc3RlckNvbW1hbmQoXG4gICAgICAgIEtFWV9FTlRFUl9DT01NQU5ELFxuICAgICAgICBvbktleUVudGVyLFxuICAgICAgICBDT01NQU5EX1BSSU9SSVRZX0xPV1xuICAgICAgKTtcbiAgICB9LCBbZWRpdG9yLCBvblZhbHVlU2VsZWN0LCBoaWdobGlnaHRlZEluZGV4LCB2YWx1ZXNdKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgY29uc3Qgcm9vdCA9IGVkaXRvci5nZXRSb290RWxlbWVudCgpO1xuICAgICAgaWYgKHJvb3QgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICAgIHJvb3Quc2V0QXR0cmlidXRlKFxuICAgICAgICBcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFxuICAgICAgICBgdHlwZWFoZWFkLWl0ZW0tJHtoaWdobGlnaHRlZEluZGV4fWBcbiAgICAgICk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICByb290LnJlbW92ZUF0dHJpYnV0ZShcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiKTtcbiAgICAgIH07XG4gICAgfSwgW2VkaXRvciwgaGlnaGxpZ2h0ZWRJbmRleF0pO1xuICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChIaWdobGlnaHRlZEluZGV4Q29udGV4dC5Qcm92aWRlciwge1xuICAgICAgdmFsdWU6IFtoaWdobGlnaHRlZEluZGV4LCBzZXRIaWdobGlnaHRlZEluZGV4XVxuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAgIHJvbGU6IFwibGlzdGJveFwiLFxuICAgICAgLi4uZGl2UHJvcHMsXG4gICAgICByZWY6IGZvcndhcmRlZFJlZlxuICAgIH0sIGNoaWxkcmVuKSk7XG4gIH1cbik7XG5jb25zdCBJdGVtID0gZm9yd2FyZFJlZihcbiAgZnVuY3Rpb24gSXRlbTIocHJvcHMsIGZvcndhcmRlZFJlZikge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4sIHZhbHVlLCBvbk1vdXNlRW50ZXIsIG9uQ2xpY2ssIC4uLmRpdlByb3BzIH0gPSBwcm9wcztcbiAgICBjb25zdCBkaXZSZWYgPSB1c2VSZWYobnVsbCk7XG4gICAgY29uc3QgW2hpZ2hsaWdodGVkSW5kZXgsIHNldEhpZ2hsaWdodGVkSW5kZXhdID0gdXNlSGlnaGxpZ2h0ZWRJbmRleCgpO1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gdXNlU3VnZ2VzdGlvbnMoKTtcbiAgICBjb25zdCBvblZhbHVlU2VsZWN0ID0gdXNlT25WYWx1ZVNlbGVjdENhbGxiYWNrKCk7XG4gICAgY29uc3QgaXNIaWdobGlnaHRlZCA9IHN1Z2dlc3Rpb25zW2hpZ2hsaWdodGVkSW5kZXhdID09PSB2YWx1ZTtcbiAgICB1c2VJbXBlcmF0aXZlSGFuZGxlKFxuICAgICAgZm9yd2FyZGVkUmVmLFxuICAgICAgKCkgPT4gZGl2UmVmLmN1cnJlbnRcbiAgICApO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoIWlzSGlnaGxpZ2h0ZWQpXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNvbnN0IGRpdiA9IGRpdlJlZi5jdXJyZW50O1xuICAgICAgaWYgKGRpdiA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgICAgZGl2LnNjcm9sbEludG9WaWV3KHsgYmxvY2s6IFwibmVhcmVzdFwiIH0pO1xuICAgIH0sIFtpc0hpZ2hsaWdodGVkXSk7XG4gICAgZnVuY3Rpb24gaGFuZGxlTW91c2VFbnRlcihldmVudCkge1xuICAgICAgb25Nb3VzZUVudGVyPy4oZXZlbnQpO1xuICAgICAgaWYgKGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKVxuICAgICAgICByZXR1cm47XG4gICAgICBjb25zdCBpbmRleCA9IHN1Z2dlc3Rpb25zLmluZGV4T2YodmFsdWUpO1xuICAgICAgaWYgKGluZGV4ID09PSAtMSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgc2V0SGlnaGxpZ2h0ZWRJbmRleChpbmRleCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGV2ZW50KSB7XG4gICAgICBvbkNsaWNrPy4oZXZlbnQpO1xuICAgICAgaWYgKGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKVxuICAgICAgICByZXR1cm47XG4gICAgICBvblZhbHVlU2VsZWN0KHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAgIHJvbGU6IFwib3B0aW9uXCIsXG4gICAgICBcImRhdGEtaGlnaGxpZ2h0ZWRcIjogaXNIaWdobGlnaHRlZCB8fCB2b2lkIDAsXG4gICAgICBvbk1vdXNlRW50ZXI6IGhhbmRsZU1vdXNlRW50ZXIsXG4gICAgICBvbkNsaWNrOiBoYW5kbGVDbGljayxcbiAgICAgIC4uLmRpdlByb3BzLFxuICAgICAgcmVmOiBkaXZSZWZcbiAgICB9LCBjaGlsZHJlbik7XG4gIH1cbik7XG5mdW5jdGlvbiB1c2VIaWdobGlnaHRlZEluZGV4KCkge1xuICBjb25zdCBjb250ZXh0ID0gUmVhY3RfX2RlZmF1bHQudXNlQ29udGV4dChIaWdobGlnaHRlZEluZGV4Q29udGV4dCk7XG4gIGlmIChjb250ZXh0ID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJ1c2VIaWdobGlnaHRlZEluZGV4IG11c3QgYmUgdXNlZCB3aXRoaW4gYSBIaWdobGlnaHRlZEluZGV4UHJvdmlkZXJcIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGNvbnRleHQ7XG59XG5mdW5jdGlvbiB1c2VTdWdnZXN0aW9ucygpIHtcbiAgY29uc3Qgc3VnZ2VzdGlvbnMgPSB1c2VDb250ZXh0KFN1Z2dlc3Rpb25zQ29udGV4dCk7XG4gIGlmIChzdWdnZXN0aW9ucyA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcInVzZVN1Z2dlc3Rpb25zOiBTdWdnZXN0aW9uc0NvbnRleHQgbm90IGZvdW5kXCIpO1xuICB9XG4gIHJldHVybiBzdWdnZXN0aW9ucztcbn1cbmZ1bmN0aW9uIHVzZU9uVmFsdWVTZWxlY3RDYWxsYmFjaygpIHtcbiAgY29uc3Qgb25WYWx1ZVNlbGVjdCA9IHVzZUNvbnRleHQoT25WYWx1ZVNlbGVjdENhbGxiYWNrQ29udGV4dCk7XG4gIGlmIChvblZhbHVlU2VsZWN0ID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwidXNlT25WYWx1ZVNlbGVjdENhbGxiYWNrOiBPblZhbHVlU2VsZWN0Q29udGV4dCBub3QgZm91bmRcIik7XG4gIH1cbiAgcmV0dXJuIG9uVmFsdWVTZWxlY3Q7XG59XG5mdW5jdGlvbiB1c2VPblJlc2V0TWF0Y2hDYWxsYmFjaygpIHtcbiAgY29uc3Qgb25SZXNldE1hdGNoID0gdXNlQ29udGV4dChPblJlc2V0TWF0Y2hDYWxsYmFja0NvbnRleHQpO1xuICBpZiAob25SZXNldE1hdGNoID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwidXNlT25SZXNldE1hdGNoQ2FsbGJhY2s6IE9uUmVzZXRNYXRjaENvbnRleHQgbm90IGZvdW5kXCIpO1xuICB9XG4gIHJldHVybiBvblJlc2V0TWF0Y2g7XG59XG5cbmV4cG9ydCB7IEl0ZW0sIExpc3QsIE9uUmVzZXRNYXRjaENhbGxiYWNrQ29udGV4dCwgT25WYWx1ZVNlbGVjdENhbGxiYWNrQ29udGV4dCwgU3VnZ2VzdGlvbnNDb250ZXh0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdWdnZXN0aW9ucy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/suggestions.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/user.mjs":
/*!***********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-lexical/dist/mentions/user.mjs ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   User: () => (/* binding */ User)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @liveblocks/react-ui */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _classnames_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../classnames.mjs */ \"(ssr)/./node_modules/@liveblocks/react-lexical/dist/classnames.mjs\");\n\n\n\n\n\nconst User = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  function User2(props, forwardedRef) {\n    const { userId, className, ...spanProps } = props;\n    const { user, isLoading } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__._useUser)(userId);\n    const $ = (0,_liveblocks_react_ui__WEBPACK_IMPORTED_MODULE_2__.useOverrides)();\n    const name = user === void 0 || user === null ? $.USER_UNKNOWN : user.name;\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n      \"data-loading\": isLoading ? \"\" : void 0,\n      ...spanProps,\n      ref: forwardedRef,\n      className: (0,_classnames_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-name lb-user\", className)\n    }, isLoading ? null : name);\n  }\n);\n\n\n//# sourceMappingURL=user.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL3VzZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTRDO0FBQ1E7QUFDRDtBQUNKOztBQUUvQyxhQUFhLGlEQUFVO0FBQ3ZCO0FBQ0EsWUFBWSxrQ0FBa0M7QUFDOUMsWUFBWSxrQkFBa0IsRUFBRSwyREFBTztBQUN2QyxjQUFjLGtFQUFZO0FBQzFCO0FBQ0EsMkJBQTJCLGdEQUE0QjtBQUN2RDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsMkRBQVU7QUFDM0IsS0FBSztBQUNMO0FBQ0E7O0FBRWdCO0FBQ2hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtbGV4aWNhbC9kaXN0L21lbnRpb25zL3VzZXIubWpzPzk4OGIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlVXNlciB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0JztcbmltcG9ydCB7IHVzZU92ZXJyaWRlcyB9IGZyb20gJ0BsaXZlYmxvY2tzL3JlYWN0LXVpJztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyBmb3J3YXJkUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gJy4uL2NsYXNzbmFtZXMubWpzJztcblxuY29uc3QgVXNlciA9IGZvcndhcmRSZWYoXG4gIGZ1bmN0aW9uIFVzZXIyKHByb3BzLCBmb3J3YXJkZWRSZWYpIHtcbiAgICBjb25zdCB7IHVzZXJJZCwgY2xhc3NOYW1lLCAuLi5zcGFuUHJvcHMgfSA9IHByb3BzO1xuICAgIGNvbnN0IHsgdXNlciwgaXNMb2FkaW5nIH0gPSB1c2VVc2VyKHVzZXJJZCk7XG4gICAgY29uc3QgJCA9IHVzZU92ZXJyaWRlcygpO1xuICAgIGNvbnN0IG5hbWUgPSB1c2VyID09PSB2b2lkIDAgfHwgdXNlciA9PT0gbnVsbCA/ICQuVVNFUl9VTktOT1dOIDogdXNlci5uYW1lO1xuICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInNwYW5cIiwge1xuICAgICAgXCJkYXRhLWxvYWRpbmdcIjogaXNMb2FkaW5nID8gXCJcIiA6IHZvaWQgMCxcbiAgICAgIC4uLnNwYW5Qcm9wcyxcbiAgICAgIHJlZjogZm9yd2FyZGVkUmVmLFxuICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKFwibGItbmFtZSBsYi11c2VyXCIsIGNsYXNzTmFtZSlcbiAgICB9LCBpc0xvYWRpbmcgPyBudWxsIDogbmFtZSk7XG4gIH1cbik7XG5cbmV4cG9ydCB7IFVzZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZXIubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-lexical/dist/mentions/user.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components.mjs":
/*!***************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components.mjs ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ComponentsContext: () => (/* binding */ ComponentsContext),\n/* harmony export */   ComponentsProvider: () => (/* binding */ ComponentsProvider),\n/* harmony export */   defaultComponents: () => (/* binding */ defaultComponents),\n/* harmony export */   useComponents: () => (/* binding */ useComponents)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* __next_internal_client_entry_do_not_use__ ComponentsContext,ComponentsProvider,defaultComponents,useComponents auto */ \n\nconst defaultComponents = {\n    Anchor: \"a\"\n};\nconst ComponentsContext = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0);\nfunction useComponents(components) {\n    const contextComponents = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(ComponentsContext);\n    return (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            ...defaultComponents,\n            ...contextComponents,\n            ...components\n        }), [\n        contextComponents,\n        components\n    ]);\n}\nfunction ComponentsProvider({ children, components: providerComponents }) {\n    const contextComponents = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(ComponentsContext);\n    const components = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            ...defaultComponents,\n            ...contextComponents,\n            ...providerComponents\n        }), [\n        contextComponents,\n        providerComponents\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComponentsContext.Provider, {\n        value: components\n    }, children);\n}\n //# sourceMappingURL=components.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBb0JPLE1BQUFBLG9CQUFBO0lBQXNDQyxRQUFBO0FBRTdDO0FBRU8sTUFBQUMsa0NBQUFDLG9EQUFBQSxDQUEwQjtBQUkxQixTQUFBQyxjQUFBQyxVQUFBO0lBQ0wsTUFBQUMsb0JBQUFDLGlEQUFBQSxDQUFBTDtJQUVBLE9BQUFNLDhDQUFBQSxDQUFPO1lBQ0UsR0FBQVIsaUJBQUE7WUFDRixHQUFBTSxpQkFBQTtZQUNBLEdBQUFELFVBQUE7UUFDQSxJQUNMO1FBQUFDO1FBQUFEO0tBQUE7QUFHSjtBQUVPLFNBQUFJLG1CQUFBLEVBQTRCQyxRQUFBLEVBQ2pDTCxZQUFBTSxrQkFBQSxFQUVGO0lBQ0UsTUFBQUwsb0JBQUFDLGlEQUFBQSxDQUFBTDtJQUNBLE1BQUFHLGFBQUFHLDhDQUFBQSxDQUFtQjtZQUNWLEdBQUFSLGlCQUFBO1lBQ0YsR0FBQU0saUJBQUE7WUFDQSxHQUFBSyxrQkFBQTtRQUNBLElBQ0w7UUFBQUw7UUFBQUs7S0FBQTtJQUlGLHFDQUFBQyxnREFBQSxDQUFBVixrQkFBQVksUUFBQTtRQUNHQyxPQUFBVjtJQUFrQyxHQUFBSztBQUl2QyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uL3NyYy9jb21wb25lbnRzLnRzeD83MTQ0Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgdHlwZSB7XG4gIENvbXBvbmVudFByb3BzV2l0aG91dFJlZixcbiAgQ29tcG9uZW50VHlwZSxcbiAgUHJvcHNXaXRoQ2hpbGRyZW4sXG59IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgY3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCwgdXNlTWVtbyB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2xvYmFsQ29tcG9uZW50cyB7XG4gIEFuY2hvcjogQ29tcG9uZW50VHlwZTxDb21wb25lbnRQcm9wc1dpdGhvdXRSZWY8XCJhXCI+PiB8IFwiYVwiO1xufVxuXG5leHBvcnQgdHlwZSBDb21wb25lbnRzID0gR2xvYmFsQ29tcG9uZW50cztcblxudHlwZSBDb21wb25lbnRzUHJvdmlkZXJQcm9wcyA9IFByb3BzV2l0aENoaWxkcmVuPHtcbiAgY29tcG9uZW50cz86IFBhcnRpYWw8Q29tcG9uZW50cz47XG59PjtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb21wb25lbnRzOiBDb21wb25lbnRzID0ge1xuICBBbmNob3I6IFwiYVwiLFxufTtcblxuZXhwb3J0IGNvbnN0IENvbXBvbmVudHNDb250ZXh0ID0gY3JlYXRlQ29udGV4dDxDb21wb25lbnRzIHwgdW5kZWZpbmVkPihcbiAgdW5kZWZpbmVkXG4pO1xuXG5leHBvcnQgZnVuY3Rpb24gdXNlQ29tcG9uZW50cyhjb21wb25lbnRzPzogUGFydGlhbDxDb21wb25lbnRzPik6IENvbXBvbmVudHMge1xuICBjb25zdCBjb250ZXh0Q29tcG9uZW50cyA9IHVzZUNvbnRleHQoQ29tcG9uZW50c0NvbnRleHQpO1xuXG4gIHJldHVybiB1c2VNZW1vKFxuICAgICgpID0+ICh7XG4gICAgICAuLi5kZWZhdWx0Q29tcG9uZW50cyxcbiAgICAgIC4uLmNvbnRleHRDb21wb25lbnRzLFxuICAgICAgLi4uY29tcG9uZW50cyxcbiAgICB9KSxcbiAgICBbY29udGV4dENvbXBvbmVudHMsIGNvbXBvbmVudHNdXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBDb21wb25lbnRzUHJvdmlkZXIoe1xuICBjaGlsZHJlbixcbiAgY29tcG9uZW50czogcHJvdmlkZXJDb21wb25lbnRzLFxufTogQ29tcG9uZW50c1Byb3ZpZGVyUHJvcHMpIHtcbiAgY29uc3QgY29udGV4dENvbXBvbmVudHMgPSB1c2VDb250ZXh0KENvbXBvbmVudHNDb250ZXh0KTtcbiAgY29uc3QgY29tcG9uZW50cyA9IHVzZU1lbW8oXG4gICAgKCkgPT4gKHtcbiAgICAgIC4uLmRlZmF1bHRDb21wb25lbnRzLFxuICAgICAgLi4uY29udGV4dENvbXBvbmVudHMsXG4gICAgICAuLi5wcm92aWRlckNvbXBvbmVudHMsXG4gICAgfSksXG4gICAgW2NvbnRleHRDb21wb25lbnRzLCBwcm92aWRlckNvbXBvbmVudHNdXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8Q29tcG9uZW50c0NvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NvbXBvbmVudHN9PlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvQ29tcG9uZW50c0NvbnRleHQuUHJvdmlkZXI+XG4gICk7XG59XG4iXSwibmFtZXMiOlsiZGVmYXVsdENvbXBvbmVudHMiLCJBbmNob3IiLCJDb21wb25lbnRzQ29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJ1c2VDb21wb25lbnRzIiwiY29tcG9uZW50cyIsImNvbnRleHRDb21wb25lbnRzIiwidXNlQ29udGV4dCIsInVzZU1lbW8iLCJDb21wb25lbnRzUHJvdmlkZXIiLCJjaGlsZHJlbiIsInByb3ZpZGVyQ29tcG9uZW50cyIsIlJlYWN0IiwiY3JlYXRlRWxlbWVudCIsIlByb3ZpZGVyIiwidmFsdWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Comment.mjs":
/*!***********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/Comment.mjs ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Comment: () => (/* binding */ Comment),\n/* harmony export */   CommentLink: () => (/* binding */ CommentLink),\n/* harmony export */   CommentMention: () => (/* binding */ CommentMention),\n/* harmony export */   CommentNonInteractiveLink: () => (/* binding */ CommentNonInteractiveLink),\n/* harmony export */   CommentNonInteractiveReaction: () => (/* binding */ CommentNonInteractiveReaction),\n/* harmony export */   CommentReaction: () => (/* binding */ CommentReaction)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _radix_ui_react_toggle__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @radix-ui/react-toggle */ \"(ssr)/./node_modules/@radix-ui/react-toggle/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _icons_Check_mjs__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../icons/Check.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Check.mjs\");\n/* harmony import */ var _icons_Cross_mjs__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../icons/Cross.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Cross.mjs\");\n/* harmony import */ var _icons_Delete_mjs__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../icons/Delete.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Delete.mjs\");\n/* harmony import */ var _icons_Edit_mjs__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../icons/Edit.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Edit.mjs\");\n/* harmony import */ var _icons_Ellipsis_mjs__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../icons/Ellipsis.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Ellipsis.mjs\");\n/* harmony import */ var _icons_EmojiAdd_mjs__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../icons/EmojiAdd.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/EmojiAdd.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _primitives_Comment_index_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../primitives/Comment/index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/index.mjs\");\n/* harmony import */ var _primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../primitives/Composer/index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/index.mjs\");\n/* harmony import */ var _primitives_Timestamp_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../primitives/Timestamp.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Timestamp.mjs\");\n/* harmony import */ var _shared_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs\");\n/* harmony import */ var _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../slate/plugins/mentions.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_use_refs_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../utils/use-refs.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-refs.mjs\");\n/* harmony import */ var _utils_use_visible_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../utils/use-visible.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-visible.mjs\");\n/* harmony import */ var _utils_use_window_focus_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../utils/use-window-focus.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-window-focus.mjs\");\n/* harmony import */ var _Composer_mjs__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./Composer.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Composer.mjs\");\n/* harmony import */ var _internal_Avatar_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./internal/Avatar.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Avatar.mjs\");\n/* harmony import */ var _internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./internal/Button.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs\");\n/* harmony import */ var _internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./internal/Dropdown.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Dropdown.mjs\");\n/* harmony import */ var _internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./internal/Emoji.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Emoji.mjs\");\n/* harmony import */ var _internal_EmojiPicker_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./internal/EmojiPicker.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/EmojiPicker.mjs\");\n/* harmony import */ var _internal_List_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./internal/List.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/List.mjs\");\n/* harmony import */ var _internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./internal/Tooltip.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs\");\n/* harmony import */ var _internal_User_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./internal/User.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs\");\n/* harmony import */ var _radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @radix-ui/react-tooltip */ \"(ssr)/./node_modules/@radix-ui/react-tooltip/dist/index.mjs\");\n/* harmony import */ var _radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @radix-ui/react-popover */ \"(ssr)/./node_modules/@radix-ui/react-popover/dist/index.mjs\");\n/* harmony import */ var _radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @radix-ui/react-dropdown-menu */ \"(ssr)/./node_modules/@radix-ui/react-dropdown-menu/dist/index.mjs\");\n/* __next_internal_client_entry_do_not_use__ Comment,CommentLink,CommentMention,CommentNonInteractiveLink,CommentNonInteractiveReaction,CommentReaction auto */ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst REACTIONS_TRUNCATE = 5;\nfunction CommentMention({ userId, className, ...props }) {\n    const currentId = (0,_shared_mjs__WEBPACK_IMPORTED_MODULE_1__.useCurrentUserId)();\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Comment_index_mjs__WEBPACK_IMPORTED_MODULE_2__.Mention, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-comment-mention\", className),\n        \"data-self\": userId === currentId ? \"\" : void 0,\n        ...props\n    }, _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_4__.MENTION_CHARACTER, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_5__.User, {\n        userId\n    }));\n}\nfunction CommentLink({ href, children, className, ...props }) {\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Comment_index_mjs__WEBPACK_IMPORTED_MODULE_2__.Link, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-comment-link\", className),\n        href,\n        ...props\n    }, children);\n}\nfunction CommentNonInteractiveLink({ href: _href, children, className, ...props }) {\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-comment-link\", className),\n        ...props\n    }, children);\n}\nconst CommentReactionButton = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ reaction, overrides, className, ...props }, forwardedRef)=>{\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_6__.useOverrides)(overrides);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__.Button, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-comment-reaction\", className),\n        variant: \"outline\",\n        \"aria-label\": $.COMMENT_REACTION_DESCRIPTION(reaction.emoji, reaction.users.length),\n        ...props,\n        ref: forwardedRef\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_8__.Emoji, {\n        className: \"lb-comment-reaction-emoji\",\n        emoji: reaction.emoji\n    }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-comment-reaction-count\"\n    }, reaction.users.length));\n});\nconst CommentReaction = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ comment, reaction, overrides, disabled, ...props }, forwardedRef)=>{\n    const addReaction = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__._useAddReaction)();\n    const removeReaction = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__.useRemoveReaction)();\n    const currentId = (0,_shared_mjs__WEBPACK_IMPORTED_MODULE_1__.useCurrentUserId)();\n    const isActive = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return reaction.users.some((users)=>users.id === currentId);\n    }, [\n        currentId,\n        reaction\n    ]);\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_6__.useOverrides)(overrides);\n    const tooltipContent = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", null, $.COMMENT_REACTION_LIST(/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_List_mjs__WEBPACK_IMPORTED_MODULE_10__.List, {\n            values: reaction.users.map((users, index)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_5__.User, {\n                    key: users.id,\n                    userId: users.id,\n                    capitalize: index === 0,\n                    replaceSelf: true\n                })),\n            formatRemaining: $.LIST_REMAINING_USERS,\n            truncate: REACTIONS_TRUNCATE\n        }), reaction.emoji, reaction.users.length)), [\n        $,\n        reaction\n    ]);\n    const handlePressedChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((isPressed)=>{\n        if (isPressed) {\n            addReaction({\n                threadId: comment.threadId,\n                commentId: comment.id,\n                emoji: reaction.emoji\n            });\n        } else {\n            removeReaction({\n                threadId: comment.threadId,\n                commentId: comment.id,\n                emoji: reaction.emoji\n            });\n        }\n    }, [\n        addReaction,\n        comment.threadId,\n        comment.id,\n        reaction.emoji,\n        removeReaction\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.Tooltip, {\n        content: tooltipContent,\n        multiline: true,\n        className: \"lb-comment-reaction-tooltip\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_toggle__WEBPACK_IMPORTED_MODULE_12__.Root, {\n        asChild: true,\n        pressed: isActive,\n        onPressedChange: handlePressedChange,\n        disabled,\n        ref: forwardedRef\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CommentReactionButton, {\n        \"data-self\": isActive ? \"\" : void 0,\n        reaction,\n        overrides,\n        ...props\n    })));\n});\nconst CommentNonInteractiveReaction = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ reaction, overrides, ...props }, forwardedRef)=>{\n    const currentId = (0,_shared_mjs__WEBPACK_IMPORTED_MODULE_1__.useCurrentUserId)();\n    const isActive = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return reaction.users.some((users)=>users.id === currentId);\n    }, [\n        currentId,\n        reaction\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CommentReactionButton, {\n        disableable: false,\n        \"data-self\": isActive ? \"\" : void 0,\n        reaction,\n        overrides,\n        ...props,\n        ref: forwardedRef\n    });\n});\nfunction AutoMarkReadThreadIdHandler({ threadId, commentRef }) {\n    const markThreadAsRead = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__.useMarkThreadAsRead)();\n    const isWindowFocused = (0,_utils_use_window_focus_mjs__WEBPACK_IMPORTED_MODULE_13__.useWindowFocus)();\n    (0,_utils_use_visible_mjs__WEBPACK_IMPORTED_MODULE_14__.useVisibleCallback)(commentRef, ()=>{\n        markThreadAsRead(threadId);\n    }, {\n        enabled: isWindowFocused\n    });\n    return null;\n}\nconst Comment = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ comment, indentContent = true, showDeleted, showActions = \"hover\", showReactions = true, onAuthorClick, onMentionClick, onCommentEdit, onCommentDelete, overrides, className, additionalActions, additionalActionsClassName, autoMarkReadThreadId, ...props }, forwardedRef)=>{\n    const ref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const mergedRefs = (0,_utils_use_refs_mjs__WEBPACK_IMPORTED_MODULE_15__.useRefs)(forwardedRef, ref);\n    const self = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__._useSelf)();\n    const deleteComment = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__.useDeleteComment)();\n    const editComment = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__.useEditComment)();\n    const addReaction = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__._useAddReaction)();\n    const removeReaction = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_9__.useRemoveReaction)();\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_6__.useOverrides)(overrides);\n    const [isEditing, setEditing] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [isTarget, setTarget] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [isMoreActionOpen, setMoreActionOpen] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [isReactionActionOpen, setReactionActionOpen] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const stopPropagation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.stopPropagation();\n    }, []);\n    const handleEdit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        setEditing(true);\n    }, []);\n    const handleEditCancel = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.stopPropagation();\n        setEditing(false);\n    }, []);\n    const handleEditSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({ body }, event)=>{\n        onCommentEdit?.(comment);\n        event.preventDefault();\n        setEditing(false);\n        editComment({\n            commentId: comment.id,\n            threadId: comment.threadId,\n            body\n        });\n    }, [\n        comment,\n        editComment,\n        onCommentEdit\n    ]);\n    const handleDelete = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        onCommentDelete?.(comment);\n        deleteComment({\n            commentId: comment.id,\n            threadId: comment.threadId\n        });\n    }, [\n        comment,\n        deleteComment,\n        onCommentDelete\n    ]);\n    const handleAuthorClick = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onAuthorClick?.(comment.userId, event);\n    }, [\n        comment.userId,\n        onAuthorClick\n    ]);\n    const handleReactionSelect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((emoji)=>{\n        const reactionIndex = comment.reactions.findIndex((reaction)=>reaction.emoji === emoji);\n        if (reactionIndex >= 0 && self?.id && comment.reactions[reactionIndex].users.some((user)=>user.id === self?.id)) {\n            removeReaction({\n                threadId: comment.threadId,\n                commentId: comment.id,\n                emoji\n            });\n        } else {\n            addReaction({\n                threadId: comment.threadId,\n                commentId: comment.id,\n                emoji\n            });\n        }\n    }, [\n        addReaction,\n        comment.id,\n        comment.reactions,\n        comment.threadId,\n        removeReaction,\n        self?.id\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        const isWindowDefined = \"undefined\" !== \"undefined\";\n        if (!isWindowDefined) return;\n        const hash = window.location.hash;\n        const commentId = hash.slice(1);\n        if (commentId === comment.id) {\n            setTarget(true);\n        }\n    }, []);\n    if (!showDeleted && !comment.body) {\n        return null;\n    }\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_16__.TooltipProvider, null, autoMarkReadThreadId && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(AutoMarkReadThreadIdHandler, {\n        commentRef: ref,\n        threadId: autoMarkReadThreadId\n    }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        id: comment.id,\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-root lb-comment\", indentContent && \"lb-comment:indent-content\", showActions === \"hover\" && \"lb-comment:show-actions-hover\", (isMoreActionOpen || isReactionActionOpen) && \"lb-comment:action-open\", className),\n        \"data-deleted\": !comment.body ? \"\" : void 0,\n        \"data-editing\": isEditing ? \"\" : void 0,\n        \"data-target\": isTarget ? \"\" : void 0,\n        dir: $.dir,\n        ...props,\n        ref: mergedRefs\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-comment-header\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-comment-details\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Avatar_mjs__WEBPACK_IMPORTED_MODULE_17__.Avatar, {\n        className: \"lb-comment-avatar\",\n        userId: comment.userId,\n        onClick: handleAuthorClick\n    }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-comment-details-labels\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_5__.User, {\n        className: \"lb-comment-author\",\n        userId: comment.userId,\n        onClick: handleAuthorClick\n    }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-comment-date\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Timestamp_mjs__WEBPACK_IMPORTED_MODULE_18__.Timestamp, {\n        locale: $.locale,\n        date: comment.createdAt,\n        className: \"lb-comment-date-created\"\n    }), comment.editedAt && comment.body && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, \" \", /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-comment-date-edited\"\n    }, $.COMMENT_EDITED))))), showActions && !isEditing && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-comment-actions\", additionalActionsClassName)\n    }, additionalActions ?? null, showReactions && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_EmojiPicker_mjs__WEBPACK_IMPORTED_MODULE_19__.EmojiPicker, {\n        onEmojiSelect: handleReactionSelect,\n        onOpenChange: setReactionActionOpen\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.Tooltip, {\n        content: $.COMMENT_ADD_REACTION\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_20__.PopoverTrigger, {\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__.Button, {\n        className: \"lb-comment-action\",\n        onClick: stopPropagation,\n        \"aria-label\": $.COMMENT_ADD_REACTION\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_EmojiAdd_mjs__WEBPACK_IMPORTED_MODULE_21__.EmojiAddIcon, {\n        className: \"lb-button-icon\"\n    }))))), comment.userId === self?.id && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_22__.Dropdown, {\n        open: isMoreActionOpen,\n        onOpenChange: setMoreActionOpen,\n        align: \"end\",\n        content: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_22__.DropdownItem, {\n            onSelect: handleEdit,\n            onClick: stopPropagation\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Edit_mjs__WEBPACK_IMPORTED_MODULE_23__.EditIcon, {\n            className: \"lb-dropdown-item-icon\"\n        }), $.COMMENT_EDIT), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_22__.DropdownItem, {\n            onSelect: handleDelete,\n            onClick: stopPropagation\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Delete_mjs__WEBPACK_IMPORTED_MODULE_24__.DeleteIcon, {\n            className: \"lb-dropdown-item-icon\"\n        }), $.COMMENT_DELETE))\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.Tooltip, {\n        content: $.COMMENT_MORE\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_25__.DropdownMenuTrigger, {\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__.Button, {\n        className: \"lb-comment-action\",\n        disabled: !comment.body,\n        onClick: stopPropagation,\n        \"aria-label\": $.COMMENT_MORE\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Ellipsis_mjs__WEBPACK_IMPORTED_MODULE_26__.EllipsisIcon, {\n        className: \"lb-button-icon\"\n    }))))))), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-comment-content\"\n    }, isEditing ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Composer_mjs__WEBPACK_IMPORTED_MODULE_27__.Composer, {\n        className: \"lb-comment-composer\",\n        onComposerSubmit: handleEditSubmit,\n        defaultValue: comment.body,\n        autoFocus: true,\n        showAttribution: false,\n        actions: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.Tooltip, {\n            content: $.COMMENT_EDIT_COMPOSER_CANCEL,\n            \"aria-label\": $.COMMENT_EDIT_COMPOSER_CANCEL\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__.Button, {\n            className: \"lb-composer-action\",\n            onClick: handleEditCancel\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Cross_mjs__WEBPACK_IMPORTED_MODULE_28__.CrossIcon, {\n            className: \"lb-button-icon\"\n        }))), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.ShortcutTooltip, {\n            content: $.COMMENT_EDIT_COMPOSER_SAVE,\n            shortcut: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.ShortcutTooltipKey, {\n                name: \"enter\"\n            })\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_29__.Submit, {\n            asChild: true\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__.Button, {\n            variant: \"primary\",\n            className: \"lb-composer-action\",\n            onClick: stopPropagation,\n            \"aria-label\": $.COMMENT_EDIT_COMPOSER_SAVE\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Check_mjs__WEBPACK_IMPORTED_MODULE_30__.CheckIcon, {\n            className: \"lb-button-icon\"\n        }))))),\n        overrides: {\n            COMPOSER_PLACEHOLDER: $.COMMENT_EDIT_COMPOSER_PLACEHOLDER\n        }\n    }) : comment.body ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Comment_index_mjs__WEBPACK_IMPORTED_MODULE_2__.Body, {\n        className: \"lb-comment-body\",\n        body: comment.body,\n        components: {\n            Mention: ({ userId })=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CommentMention, {\n                    userId,\n                    onClick: (event)=>onMentionClick?.(userId, event)\n                }),\n            Link: CommentLink\n        }\n    }), showReactions && comment.reactions.length > 0 && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-comment-reactions\"\n    }, comment.reactions.map((reaction)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CommentReaction, {\n            key: reaction.emoji,\n            comment,\n            reaction,\n            overrides\n        })), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_EmojiPicker_mjs__WEBPACK_IMPORTED_MODULE_19__.EmojiPicker, {\n        onEmojiSelect: handleReactionSelect\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.Tooltip, {\n        content: $.COMMENT_ADD_REACTION\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_20__.PopoverTrigger, {\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_7__.Button, {\n        className: \"lb-comment-reaction lb-comment-reaction-add\",\n        variant: \"outline\",\n        onClick: stopPropagation,\n        \"aria-label\": $.COMMENT_ADD_REACTION\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_EmojiAdd_mjs__WEBPACK_IMPORTED_MODULE_21__.EmojiAddIcon, {\n        className: \"lb-button-icon\"\n    }))))))) : /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-comment-body\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"p\", {\n        className: \"lb-comment-deleted\"\n    }, $.COMMENT_DELETED)))));\n});\n //# sourceMappingURL=Comment.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL0NvbW1lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkVBLE1BQUFBLHFCQUFBO0FBbUZPLFNBQUFDLGVBQUEsRUFBd0JDLE1BQUEsRUFDN0JDLFNBQUEsRUFDQSxHQUFBQyxPQUVGO0lBQ0UsTUFBQUMsWUFBQUMsNkRBQUFBO0lBQ0EscUNBQUFDLGdEQUFBLENBQUFFLGtFQUFBQSxFQUFBO1FBQ0dOLFdBQUFPLGtFQUFBQSxDQUFBLHNCQUFBUDtRQUNzRCxhQUFBRCxXQUFBRyxZQUFBO1FBQ2QsR0FBQUQsS0FBQTtJQUNuQyxHQUFBTywwRUFBQUEsRUFBQSw4QkFBQUosZ0RBQUEsQ0FBQUssb0RBQUFBLEVBQUE7UUFHSFY7SUFBSztBQUdaO0FBRU8sU0FBQVcsWUFBQSxFQUFxQkMsSUFBQSxFQUMxQkMsUUFBQSxFQUNBWixTQUFBLEVBQ0EsR0FBQUMsT0FFRjtJQUNFLHFDQUFBRyxnREFBQSxDQUFBUywrREFBQUEsRUFBQTtRQUNHYixXQUFBTyxrRUFBQUEsQ0FBQSxtQkFBQVA7UUFDbURXO1FBQ2xELEdBQUFWLEtBQUE7SUFDSSxHQUFBVztBQUtWO0FBRU8sU0FBQUUsMEJBQUEsRUFBbUNILE1BQUFJLEtBQUEsRUFDbENILFFBQUEsRUFDTlosU0FBQSxFQUNBLEdBQUFDLE9BRUY7SUFDRSxxQ0FBQUcsZ0RBQUE7UUFDR0osV0FBQU8sa0VBQUFBLENBQUEsbUJBQUFQO1FBQXVELEdBQUFDLEtBQUE7SUFBTyxHQUFBVztBQUluRTtBQUVBLE1BQUFJLHNDQUFBQyxpREFBQUEsQ0FBQSxHQUFBQyxRQUFBLEVBQUFDLFNBQUEsRUFBQW5CLFNBQUEsS0FBQUMsT0FBQSxFQUFBbUI7SUFJRSxNQUFBQyxJQUFBQyw0REFBQUEsQ0FBQUg7SUFDQSxx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QixnREFBQTtRQUdDSixXQUFBO0lBQWMsR0FBQWdDLFFBQUFzRixTQUFBLENBQUF4RSxHQUFBLEVBQUE1QixXQUFBLDhCQUFBZCxnREFBQSxDQUFBMkIsaUJBQUE7WUFFVmlCLEtBQUE5QixTQUFBUSxLQUFBO1lBQ2VNO1lBQ2RkO1lBQ0FDO1FBQ0EsbUNBQUFmLGdEQUFBLENBQUFzSSxtRUFBQUEsRUFBQTtRQUdIQyxlQUFBdkI7SUFBMkIsaUNBQUFoSCxnREFBQSxDQUFBdUQsMkRBQUFBLEVBQUE7UUFDekJDLFNBQUF2QyxFQUFBd0gsb0JBQUE7SUFBbUIsaUNBQUF6SSxnREFBQSxDQUFBMEksb0VBQUFBLEVBQUE7UUFDakI5RSxTQUFBO0lBQTBCLGlDQUFBNUQsZ0RBQUEsQ0FBQW1CLHdEQUFBQSxFQUFBO1FBQ3hCdkIsV0FBQTtRQUNXd0IsU0FBQTtRQUNGMEcsU0FBQXZCO1FBQ0MsY0FBQXRGLEVBQUF3SCxvQkFBQTtJQUNLLGlDQUFBekksZ0RBQUEsQ0FBQTJJLDhEQUFBQSxFQUFBO1FBRWIvSSxXQUFBO0lBQXVCLHlDQUFBSSxnREFBQTtRQVNyQ0osV0FBQTtJQUFjLGlDQUFBSSxnREFBQTtRQUNaSixXQUFBO0lBQVksR0FBQXFCLEVBQUE0SixlQUFBO0FBS3ZCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi4vLi4vc3JjL2NvbXBvbmVudHMvQ29tbWVudC50c3g/ZGE0NiJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcblxuaW1wb3J0IHR5cGUge1xuICBDb21tZW50RGF0YSxcbiAgQ29tbWVudFJlYWN0aW9uIGFzIENvbW1lbnRSZWFjdGlvbkRhdGEsXG59IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5pbXBvcnQge1xuICB1c2VBZGRSZWFjdGlvbixcbiAgdXNlRGVsZXRlQ29tbWVudCxcbiAgdXNlRWRpdENvbW1lbnQsXG4gIHVzZU1hcmtUaHJlYWRBc1JlYWQsXG4gIHVzZVJlbW92ZVJlYWN0aW9uLFxuICB1c2VTZWxmLFxufSBmcm9tIFwiQGxpdmVibG9ja3MvcmVhY3RcIjtcbmltcG9ydCAqIGFzIFRvZ2dsZVByaW1pdGl2ZSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LXRvZ2dsZVwiO1xuaW1wb3J0IHR5cGUge1xuICBDb21wb25lbnRQcm9wc1dpdGhvdXRSZWYsXG4gIEZvcm1FdmVudCxcbiAgTW91c2VFdmVudCxcbiAgUmVhY3ROb2RlLFxuICBSZWZPYmplY3QsXG4gIFN5bnRoZXRpY0V2ZW50LFxufSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwge1xuICBmb3J3YXJkUmVmLFxuICB1c2VDYWxsYmFjayxcbiAgdXNlRWZmZWN0LFxuICB1c2VNZW1vLFxuICB1c2VSZWYsXG4gIHVzZVN0YXRlLFxufSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgQ2hlY2tJY29uIH0gZnJvbSBcIi4uL2ljb25zL0NoZWNrXCI7XG5pbXBvcnQgeyBDcm9zc0ljb24gfSBmcm9tIFwiLi4vaWNvbnMvQ3Jvc3NcIjtcbmltcG9ydCB7IERlbGV0ZUljb24gfSBmcm9tIFwiLi4vaWNvbnMvRGVsZXRlXCI7XG5pbXBvcnQgeyBFZGl0SWNvbiB9IGZyb20gXCIuLi9pY29ucy9FZGl0XCI7XG5pbXBvcnQgeyBFbGxpcHNpc0ljb24gfSBmcm9tIFwiLi4vaWNvbnMvRWxsaXBzaXNcIjtcbmltcG9ydCB7IEVtb2ppQWRkSWNvbiB9IGZyb20gXCIuLi9pY29ucy9FbW9qaUFkZFwiO1xuaW1wb3J0IHR5cGUge1xuICBDb21tZW50T3ZlcnJpZGVzLFxuICBDb21wb3Nlck92ZXJyaWRlcyxcbiAgR2xvYmFsT3ZlcnJpZGVzLFxufSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyB1c2VPdmVycmlkZXMgfSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgdHlwZSB7IENvbXBvc2VyU3VibWl0Q29tbWVudCB9IGZyb20gXCIuLi9wcmltaXRpdmVzXCI7XG5pbXBvcnQgKiBhcyBDb21tZW50UHJpbWl0aXZlIGZyb20gXCIuLi9wcmltaXRpdmVzL0NvbW1lbnRcIjtcbmltcG9ydCB0eXBlIHtcbiAgQ29tbWVudEJvZHlMaW5rUHJvcHMsXG4gIENvbW1lbnRCb2R5TWVudGlvblByb3BzLFxuICBDb21tZW50TGlua1Byb3BzLFxuICBDb21tZW50TWVudGlvblByb3BzLFxufSBmcm9tIFwiLi4vcHJpbWl0aXZlcy9Db21tZW50L3R5cGVzXCI7XG5pbXBvcnQgKiBhcyBDb21wb3NlclByaW1pdGl2ZSBmcm9tIFwiLi4vcHJpbWl0aXZlcy9Db21wb3NlclwiO1xuaW1wb3J0IHsgVGltZXN0YW1wIH0gZnJvbSBcIi4uL3ByaW1pdGl2ZXMvVGltZXN0YW1wXCI7XG5pbXBvcnQgeyB1c2VDdXJyZW50VXNlcklkIH0gZnJvbSBcIi4uL3NoYXJlZFwiO1xuaW1wb3J0IHsgTUVOVElPTl9DSEFSQUNURVIgfSBmcm9tIFwiLi4vc2xhdGUvcGx1Z2lucy9tZW50aW9uc1wiO1xuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gXCIuLi91dGlscy9jbGFzcy1uYW1lc1wiO1xuaW1wb3J0IHsgdXNlUmVmcyB9IGZyb20gXCIuLi91dGlscy91c2UtcmVmc1wiO1xuaW1wb3J0IHsgdXNlVmlzaWJsZUNhbGxiYWNrIH0gZnJvbSBcIi4uL3V0aWxzL3VzZS12aXNpYmxlXCI7XG5pbXBvcnQgeyB1c2VXaW5kb3dGb2N1cyB9IGZyb20gXCIuLi91dGlscy91c2Utd2luZG93LWZvY3VzXCI7XG5pbXBvcnQgeyBDb21wb3NlciB9IGZyb20gXCIuL0NvbXBvc2VyXCI7XG5pbXBvcnQgeyBBdmF0YXIgfSBmcm9tIFwiLi9pbnRlcm5hbC9BdmF0YXJcIjtcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gXCIuL2ludGVybmFsL0J1dHRvblwiO1xuaW1wb3J0IHsgRHJvcGRvd24sIERyb3Bkb3duSXRlbSwgRHJvcGRvd25UcmlnZ2VyIH0gZnJvbSBcIi4vaW50ZXJuYWwvRHJvcGRvd25cIjtcbmltcG9ydCB7IEVtb2ppIH0gZnJvbSBcIi4vaW50ZXJuYWwvRW1vamlcIjtcbmltcG9ydCB7IEVtb2ppUGlja2VyLCBFbW9qaVBpY2tlclRyaWdnZXIgfSBmcm9tIFwiLi9pbnRlcm5hbC9FbW9qaVBpY2tlclwiO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gXCIuL2ludGVybmFsL0xpc3RcIjtcbmltcG9ydCB7XG4gIFNob3J0Y3V0VG9vbHRpcCxcbiAgU2hvcnRjdXRUb29sdGlwS2V5LFxuICBUb29sdGlwLFxuICBUb29sdGlwUHJvdmlkZXIsXG59IGZyb20gXCIuL2ludGVybmFsL1Rvb2x0aXBcIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi9pbnRlcm5hbC9Vc2VyXCI7XG5cbmNvbnN0IFJFQUNUSU9OU19UUlVOQ0FURSA9IDU7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbWVudFByb3BzIGV4dGVuZHMgQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmPFwiZGl2XCI+IHtcbiAgLyoqXG4gICAqIFRoZSBjb21tZW50IHRvIGRpc3BsYXkuXG4gICAqL1xuICBjb21tZW50OiBDb21tZW50RGF0YTtcblxuICAvKipcbiAgICogSG93IHRvIHNob3cgb3IgaGlkZSB0aGUgYWN0aW9ucy5cbiAgICovXG4gIHNob3dBY3Rpb25zPzogYm9vbGVhbiB8IFwiaG92ZXJcIjtcblxuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHRoZSBjb21tZW50IGlmIGl0IHdhcyBkZWxldGVkLiBJZiBzZXQgdG8gYGZhbHNlYCwgaXQgd2lsbCByZW5kZXIgZGVsZXRlZCBjb21tZW50cyBhcyBgbnVsbGAuXG4gICAqL1xuICBzaG93RGVsZXRlZD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gc2hvdyByZWFjdGlvbnMuXG4gICAqL1xuICBzaG93UmVhY3Rpb25zPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogV2hldGhlciB0byBpbmRlbnQgdGhlIGNvbW1lbnQncyBjb250ZW50LlxuICAgKi9cbiAgaW5kZW50Q29udGVudD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBoYW5kbGVyIGNhbGxlZCB3aGVuIHRoZSBjb21tZW50IGlzIGVkaXRlZC5cbiAgICovXG4gIG9uQ29tbWVudEVkaXQ/OiAoY29tbWVudDogQ29tbWVudERhdGEpID0+IHZvaWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBoYW5kbGVyIGNhbGxlZCB3aGVuIHRoZSBjb21tZW50IGlzIGRlbGV0ZWQuXG4gICAqL1xuICBvbkNvbW1lbnREZWxldGU/OiAoY29tbWVudDogQ29tbWVudERhdGEpID0+IHZvaWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBoYW5kbGVyIGNhbGxlZCB3aGVuIGNsaWNraW5nIG9uIHRoZSBhdXRob3IuXG4gICAqL1xuICBvbkF1dGhvckNsaWNrPzogKHVzZXJJZDogc3RyaW5nLCBldmVudDogTW91c2VFdmVudDxIVE1MRWxlbWVudD4pID0+IHZvaWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBoYW5kbGVyIGNhbGxlZCB3aGVuIGNsaWNraW5nIG9uIGEgbWVudGlvbi5cbiAgICovXG4gIG9uTWVudGlvbkNsaWNrPzogKHVzZXJJZDogc3RyaW5nLCBldmVudDogTW91c2VFdmVudDxIVE1MRWxlbWVudD4pID0+IHZvaWQ7XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlIHRoZSBjb21wb25lbnQncyBzdHJpbmdzLlxuICAgKi9cbiAgb3ZlcnJpZGVzPzogUGFydGlhbDxHbG9iYWxPdmVycmlkZXMgJiBDb21tZW50T3ZlcnJpZGVzICYgQ29tcG9zZXJPdmVycmlkZXM+O1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGF1dG9NYXJrUmVhZFRocmVhZElkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGFkZGl0aW9uYWxBY3Rpb25zPzogUmVhY3ROb2RlO1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGFkZGl0aW9uYWxBY3Rpb25zQ2xhc3NOYW1lPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ29tbWVudFJlYWN0aW9uQnV0dG9uUHJvcHNcbiAgZXh0ZW5kcyBDb21wb25lbnRQcm9wc1dpdGhvdXRSZWY8dHlwZW9mIEJ1dHRvbj4ge1xuICByZWFjdGlvbjogQ29tbWVudFJlYWN0aW9uRGF0YTtcbiAgb3ZlcnJpZGVzPzogUGFydGlhbDxHbG9iYWxPdmVycmlkZXMgJiBDb21tZW50T3ZlcnJpZGVzPjtcbn1cblxuaW50ZXJmYWNlIENvbW1lbnRSZWFjdGlvblByb3BzIGV4dGVuZHMgQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmPFwiYnV0dG9uXCI+IHtcbiAgY29tbWVudDogQ29tbWVudERhdGE7XG4gIHJlYWN0aW9uOiBDb21tZW50UmVhY3Rpb25EYXRhO1xuICBvdmVycmlkZXM/OiBQYXJ0aWFsPEdsb2JhbE92ZXJyaWRlcyAmIENvbW1lbnRPdmVycmlkZXM+O1xufVxuXG50eXBlIENvbW1lbnROb25JbnRlcmFjdGl2ZVJlYWN0aW9uUHJvcHMgPSBPbWl0PENvbW1lbnRSZWFjdGlvblByb3BzLCBcImNvbW1lbnRcIj47XG5cbmV4cG9ydCBmdW5jdGlvbiBDb21tZW50TWVudGlvbih7XG4gIHVzZXJJZCxcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufTogQ29tbWVudEJvZHlNZW50aW9uUHJvcHMgJiBDb21tZW50TWVudGlvblByb3BzKSB7XG4gIGNvbnN0IGN1cnJlbnRJZCA9IHVzZUN1cnJlbnRVc2VySWQoKTtcbiAgcmV0dXJuIChcbiAgICA8Q29tbWVudFByaW1pdGl2ZS5NZW50aW9uXG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJsYi1jb21tZW50LW1lbnRpb25cIiwgY2xhc3NOYW1lKX1cbiAgICAgIGRhdGEtc2VsZj17dXNlcklkID09PSBjdXJyZW50SWQgPyBcIlwiIDogdW5kZWZpbmVkfVxuICAgICAgey4uLnByb3BzfVxuICAgID5cbiAgICAgIHtNRU5USU9OX0NIQVJBQ1RFUn1cbiAgICAgIDxVc2VyIHVzZXJJZD17dXNlcklkfSAvPlxuICAgIDwvQ29tbWVudFByaW1pdGl2ZS5NZW50aW9uPlxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gQ29tbWVudExpbmsoe1xuICBocmVmLFxuICBjaGlsZHJlbixcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufTogQ29tbWVudEJvZHlMaW5rUHJvcHMgJiBDb21tZW50TGlua1Byb3BzKSB7XG4gIHJldHVybiAoXG4gICAgPENvbW1lbnRQcmltaXRpdmUuTGlua1xuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibGItY29tbWVudC1saW5rXCIsIGNsYXNzTmFtZSl9XG4gICAgICBocmVmPXtocmVmfVxuICAgICAgey4uLnByb3BzfVxuICAgID5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L0NvbW1lbnRQcmltaXRpdmUuTGluaz5cbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIENvbW1lbnROb25JbnRlcmFjdGl2ZUxpbmsoe1xuICBocmVmOiBfaHJlZixcbiAgY2hpbGRyZW4sXG4gIGNsYXNzTmFtZSxcbiAgLi4ucHJvcHNcbn06IENvbW1lbnRCb2R5TGlua1Byb3BzICYgQ29tbWVudExpbmtQcm9wcykge1xuICByZXR1cm4gKFxuICAgIDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImxiLWNvbW1lbnQtbGlua1wiLCBjbGFzc05hbWUpfSB7Li4ucHJvcHN9PlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvc3Bhbj5cbiAgKTtcbn1cblxuY29uc3QgQ29tbWVudFJlYWN0aW9uQnV0dG9uID0gZm9yd2FyZFJlZjxcbiAgSFRNTEJ1dHRvbkVsZW1lbnQsXG4gIENvbW1lbnRSZWFjdGlvbkJ1dHRvblByb3BzXG4+KCh7IHJlYWN0aW9uLCBvdmVycmlkZXMsIGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMob3ZlcnJpZGVzKTtcbiAgcmV0dXJuIChcbiAgICA8QnV0dG9uXG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJsYi1jb21tZW50LXJlYWN0aW9uXCIsIGNsYXNzTmFtZSl9XG4gICAgICB2YXJpYW50PVwib3V0bGluZVwiXG4gICAgICBhcmlhLWxhYmVsPXskLkNPTU1FTlRfUkVBQ1RJT05fREVTQ1JJUFRJT04oXG4gICAgICAgIHJlYWN0aW9uLmVtb2ppLFxuICAgICAgICByZWFjdGlvbi51c2Vycy5sZW5ndGhcbiAgICAgICl9XG4gICAgICB7Li4ucHJvcHN9XG4gICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICA+XG4gICAgICA8RW1vamkgY2xhc3NOYW1lPVwibGItY29tbWVudC1yZWFjdGlvbi1lbW9qaVwiIGVtb2ppPXtyZWFjdGlvbi5lbW9qaX0gLz5cbiAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtcmVhY3Rpb24tY291bnRcIj57cmVhY3Rpb24udXNlcnMubGVuZ3RofTwvc3Bhbj5cbiAgICA8L0J1dHRvbj5cbiAgKTtcbn0pO1xuXG5leHBvcnQgY29uc3QgQ29tbWVudFJlYWN0aW9uID0gZm9yd2FyZFJlZjxcbiAgSFRNTEJ1dHRvbkVsZW1lbnQsXG4gIENvbW1lbnRSZWFjdGlvblByb3BzXG4+KCh7IGNvbW1lbnQsIHJlYWN0aW9uLCBvdmVycmlkZXMsIGRpc2FibGVkLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgY29uc3QgYWRkUmVhY3Rpb24gPSB1c2VBZGRSZWFjdGlvbigpO1xuICBjb25zdCByZW1vdmVSZWFjdGlvbiA9IHVzZVJlbW92ZVJlYWN0aW9uKCk7XG4gIGNvbnN0IGN1cnJlbnRJZCA9IHVzZUN1cnJlbnRVc2VySWQoKTtcbiAgY29uc3QgaXNBY3RpdmUgPSB1c2VNZW1vKCgpID0+IHtcbiAgICByZXR1cm4gcmVhY3Rpb24udXNlcnMuc29tZSgodXNlcnMpID0+IHVzZXJzLmlkID09PSBjdXJyZW50SWQpO1xuICB9LCBbY3VycmVudElkLCByZWFjdGlvbl0pO1xuICBjb25zdCAkID0gdXNlT3ZlcnJpZGVzKG92ZXJyaWRlcyk7XG4gIGNvbnN0IHRvb2x0aXBDb250ZW50ID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoXG4gICAgICA8c3Bhbj5cbiAgICAgICAgeyQuQ09NTUVOVF9SRUFDVElPTl9MSVNUKFxuICAgICAgICAgIDxMaXN0XG4gICAgICAgICAgICB2YWx1ZXM9e3JlYWN0aW9uLnVzZXJzLm1hcCgodXNlcnMsIGluZGV4KSA9PiAoXG4gICAgICAgICAgICAgIDxVc2VyXG4gICAgICAgICAgICAgICAga2V5PXt1c2Vycy5pZH1cbiAgICAgICAgICAgICAgICB1c2VySWQ9e3VzZXJzLmlkfVxuICAgICAgICAgICAgICAgIGNhcGl0YWxpemU9e2luZGV4ID09PSAwfVxuICAgICAgICAgICAgICAgIHJlcGxhY2VTZWxmXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApKX1cbiAgICAgICAgICAgIGZvcm1hdFJlbWFpbmluZz17JC5MSVNUX1JFTUFJTklOR19VU0VSU31cbiAgICAgICAgICAgIHRydW5jYXRlPXtSRUFDVElPTlNfVFJVTkNBVEV9XG4gICAgICAgICAgLz4sXG4gICAgICAgICAgcmVhY3Rpb24uZW1vamksXG4gICAgICAgICAgcmVhY3Rpb24udXNlcnMubGVuZ3RoXG4gICAgICAgICl9XG4gICAgICA8L3NwYW4+XG4gICAgKSxcbiAgICBbJCwgcmVhY3Rpb25dXG4gICk7XG5cbiAgY29uc3QgaGFuZGxlUHJlc3NlZENoYW5nZSA9IHVzZUNhbGxiYWNrKFxuICAgIChpc1ByZXNzZWQ6IGJvb2xlYW4pID0+IHtcbiAgICAgIGlmIChpc1ByZXNzZWQpIHtcbiAgICAgICAgYWRkUmVhY3Rpb24oe1xuICAgICAgICAgIHRocmVhZElkOiBjb21tZW50LnRocmVhZElkLFxuICAgICAgICAgIGNvbW1lbnRJZDogY29tbWVudC5pZCxcbiAgICAgICAgICBlbW9qaTogcmVhY3Rpb24uZW1vamksXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVtb3ZlUmVhY3Rpb24oe1xuICAgICAgICAgIHRocmVhZElkOiBjb21tZW50LnRocmVhZElkLFxuICAgICAgICAgIGNvbW1lbnRJZDogY29tbWVudC5pZCxcbiAgICAgICAgICBlbW9qaTogcmVhY3Rpb24uZW1vamksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgW2FkZFJlYWN0aW9uLCBjb21tZW50LnRocmVhZElkLCBjb21tZW50LmlkLCByZWFjdGlvbi5lbW9qaSwgcmVtb3ZlUmVhY3Rpb25dXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8VG9vbHRpcFxuICAgICAgY29udGVudD17dG9vbHRpcENvbnRlbnR9XG4gICAgICBtdWx0aWxpbmVcbiAgICAgIGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtcmVhY3Rpb24tdG9vbHRpcFwiXG4gICAgPlxuICAgICAgPFRvZ2dsZVByaW1pdGl2ZS5Sb290XG4gICAgICAgIGFzQ2hpbGRcbiAgICAgICAgcHJlc3NlZD17aXNBY3RpdmV9XG4gICAgICAgIG9uUHJlc3NlZENoYW5nZT17aGFuZGxlUHJlc3NlZENoYW5nZX1cbiAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgID5cbiAgICAgICAgPENvbW1lbnRSZWFjdGlvbkJ1dHRvblxuICAgICAgICAgIGRhdGEtc2VsZj17aXNBY3RpdmUgPyBcIlwiIDogdW5kZWZpbmVkfVxuICAgICAgICAgIHJlYWN0aW9uPXtyZWFjdGlvbn1cbiAgICAgICAgICBvdmVycmlkZXM9e292ZXJyaWRlc31cbiAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIC8+XG4gICAgICA8L1RvZ2dsZVByaW1pdGl2ZS5Sb290PlxuICAgIDwvVG9vbHRpcD5cbiAgKTtcbn0pO1xuXG5leHBvcnQgY29uc3QgQ29tbWVudE5vbkludGVyYWN0aXZlUmVhY3Rpb24gPSBmb3J3YXJkUmVmPFxuICBIVE1MQnV0dG9uRWxlbWVudCxcbiAgQ29tbWVudE5vbkludGVyYWN0aXZlUmVhY3Rpb25Qcm9wc1xuPigoeyByZWFjdGlvbiwgb3ZlcnJpZGVzLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgY29uc3QgY3VycmVudElkID0gdXNlQ3VycmVudFVzZXJJZCgpO1xuICBjb25zdCBpc0FjdGl2ZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIHJldHVybiByZWFjdGlvbi51c2Vycy5zb21lKCh1c2VycykgPT4gdXNlcnMuaWQgPT09IGN1cnJlbnRJZCk7XG4gIH0sIFtjdXJyZW50SWQsIHJlYWN0aW9uXSk7XG5cbiAgcmV0dXJuIChcbiAgICA8Q29tbWVudFJlYWN0aW9uQnV0dG9uXG4gICAgICBkaXNhYmxlYWJsZT17ZmFsc2V9XG4gICAgICBkYXRhLXNlbGY9e2lzQWN0aXZlID8gXCJcIiA6IHVuZGVmaW5lZH1cbiAgICAgIHJlYWN0aW9uPXtyZWFjdGlvbn1cbiAgICAgIG92ZXJyaWRlcz17b3ZlcnJpZGVzfVxuICAgICAgey4uLnByb3BzfVxuICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgLz5cbiAgKTtcbn0pO1xuXG4vLyBBIHZvaWQgY29tcG9uZW50ICh3aGljaCBkb2Vzbid0IHJlbmRlciBhbnl0aGluZykgcmVzcG9uc2libGUgZm9yIG1hcmtpbmcgYSB0aHJlYWRcbi8vIGFzIHJlYWQgd2hlbiB0aGUgY29tbWVudCBpdCdzIHVzZWQgaW4gYmVjb21lcyB2aXNpYmxlLlxuLy8gTW92aW5nIHRoaXMgbG9naWMgaW50byBhIHNlcGFyYXRlIGNvbXBvbmVudCBhbGxvd3MgdXMgdG8gdXNlIHRoZSB2aXNpYmlsaXR5XG4vLyBhbmQgZm9jdXMgaG9va3MgXCJjb25kaXRpb25hbGx5XCIgYnkgY29uZGl0aW9uYWxseSByZW5kZXJpbmcgdGhpcyBjb21wb25lbnQuXG5mdW5jdGlvbiBBdXRvTWFya1JlYWRUaHJlYWRJZEhhbmRsZXIoe1xuICB0aHJlYWRJZCxcbiAgY29tbWVudFJlZixcbn06IHtcbiAgdGhyZWFkSWQ6IHN0cmluZztcbiAgY29tbWVudFJlZjogUmVmT2JqZWN0PEhUTUxFbGVtZW50Pjtcbn0pIHtcbiAgY29uc3QgbWFya1RocmVhZEFzUmVhZCA9IHVzZU1hcmtUaHJlYWRBc1JlYWQoKTtcbiAgY29uc3QgaXNXaW5kb3dGb2N1c2VkID0gdXNlV2luZG93Rm9jdXMoKTtcblxuICB1c2VWaXNpYmxlQ2FsbGJhY2soXG4gICAgY29tbWVudFJlZixcbiAgICAoKSA9PiB7XG4gICAgICBtYXJrVGhyZWFkQXNSZWFkKHRocmVhZElkKTtcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIFRoZSB1bmRlcmx5aW5nIEludGVyc2VjdGlvbk9ic2VydmVyIGlzIG9ubHkgZW5hYmxlZCB3aGVuIHRoZSB3aW5kb3cgaXMgZm9jdXNlZFxuICAgICAgZW5hYmxlZDogaXNXaW5kb3dGb2N1c2VkLFxuICAgIH1cbiAgKTtcblxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhIHNpbmdsZSBjb21tZW50LlxuICpcbiAqIEBleGFtcGxlXG4gKiA8PlxuICogICB7dGhyZWFkLmNvbW1lbnRzLm1hcCgoY29tbWVudCkgPT4gKFxuICogICAgIDxDb21tZW50IGtleT17Y29tbWVudC5pZH0gY29tbWVudD17Y29tbWVudH0gLz5cbiAqICAgKSl9XG4gKiA8Lz5cbiAqL1xuZXhwb3J0IGNvbnN0IENvbW1lbnQgPSBmb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBDb21tZW50UHJvcHM+KFxuICAoXG4gICAge1xuICAgICAgY29tbWVudCxcbiAgICAgIGluZGVudENvbnRlbnQgPSB0cnVlLFxuICAgICAgc2hvd0RlbGV0ZWQsXG4gICAgICBzaG93QWN0aW9ucyA9IFwiaG92ZXJcIixcbiAgICAgIHNob3dSZWFjdGlvbnMgPSB0cnVlLFxuICAgICAgb25BdXRob3JDbGljayxcbiAgICAgIG9uTWVudGlvbkNsaWNrLFxuICAgICAgb25Db21tZW50RWRpdCxcbiAgICAgIG9uQ29tbWVudERlbGV0ZSxcbiAgICAgIG92ZXJyaWRlcyxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGFkZGl0aW9uYWxBY3Rpb25zLFxuICAgICAgYWRkaXRpb25hbEFjdGlvbnNDbGFzc05hbWUsXG4gICAgICBhdXRvTWFya1JlYWRUaHJlYWRJZCxcbiAgICAgIC4uLnByb3BzXG4gICAgfSxcbiAgICBmb3J3YXJkZWRSZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgcmVmID0gdXNlUmVmPEhUTUxEaXZFbGVtZW50PihudWxsKTtcbiAgICBjb25zdCBtZXJnZWRSZWZzID0gdXNlUmVmcyhmb3J3YXJkZWRSZWYsIHJlZik7XG4gICAgY29uc3Qgc2VsZiA9IHVzZVNlbGYoKTtcbiAgICBjb25zdCBkZWxldGVDb21tZW50ID0gdXNlRGVsZXRlQ29tbWVudCgpO1xuICAgIGNvbnN0IGVkaXRDb21tZW50ID0gdXNlRWRpdENvbW1lbnQoKTtcbiAgICBjb25zdCBhZGRSZWFjdGlvbiA9IHVzZUFkZFJlYWN0aW9uKCk7XG4gICAgY29uc3QgcmVtb3ZlUmVhY3Rpb24gPSB1c2VSZW1vdmVSZWFjdGlvbigpO1xuICAgIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMob3ZlcnJpZGVzKTtcbiAgICBjb25zdCBbaXNFZGl0aW5nLCBzZXRFZGl0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbaXNUYXJnZXQsIHNldFRhcmdldF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2lzTW9yZUFjdGlvbk9wZW4sIHNldE1vcmVBY3Rpb25PcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbaXNSZWFjdGlvbkFjdGlvbk9wZW4sIHNldFJlYWN0aW9uQWN0aW9uT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgICBjb25zdCBzdG9wUHJvcGFnYXRpb24gPSB1c2VDYWxsYmFjaygoZXZlbnQ6IFN5bnRoZXRpY0V2ZW50KSA9PiB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9LCBbXSk7XG5cbiAgICBjb25zdCBoYW5kbGVFZGl0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgc2V0RWRpdGluZyh0cnVlKTtcbiAgICB9LCBbXSk7XG5cbiAgICBjb25zdCBoYW5kbGVFZGl0Q2FuY2VsID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZXZlbnQ6IE1vdXNlRXZlbnQ8SFRNTEJ1dHRvbkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBzZXRFZGl0aW5nKGZhbHNlKTtcbiAgICAgIH0sXG4gICAgICBbXVxuICAgICk7XG5cbiAgICBjb25zdCBoYW5kbGVFZGl0U3VibWl0ID0gdXNlQ2FsbGJhY2soXG4gICAgICAoeyBib2R5IH06IENvbXBvc2VyU3VibWl0Q29tbWVudCwgZXZlbnQ6IEZvcm1FdmVudDxIVE1MRm9ybUVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIC8vIFRPRE86IEFkZCBhIHdheSB0byBwcmV2ZW50RGVmYXVsdCBmcm9tIHdpdGhpbiB0aGlzIGNhbGxiYWNrLCB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBiZWhhdmlvciAoZS5nLiBzaG93aW5nIGEgY29uZmlybWF0aW9uIGRpYWxvZylcbiAgICAgICAgb25Db21tZW50RWRpdD8uKGNvbW1lbnQpO1xuXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHNldEVkaXRpbmcoZmFsc2UpO1xuICAgICAgICBlZGl0Q29tbWVudCh7XG4gICAgICAgICAgY29tbWVudElkOiBjb21tZW50LmlkLFxuICAgICAgICAgIHRocmVhZElkOiBjb21tZW50LnRocmVhZElkLFxuICAgICAgICAgIGJvZHksXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIFtjb21tZW50LCBlZGl0Q29tbWVudCwgb25Db21tZW50RWRpdF1cbiAgICApO1xuXG4gICAgY29uc3QgaGFuZGxlRGVsZXRlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgLy8gVE9ETzogQWRkIGEgd2F5IHRvIHByZXZlbnREZWZhdWx0IGZyb20gd2l0aGluIHRoaXMgY2FsbGJhY2ssIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGJlaGF2aW9yIChlLmcuIHNob3dpbmcgYSBjb25maXJtYXRpb24gZGlhbG9nKVxuICAgICAgb25Db21tZW50RGVsZXRlPy4oY29tbWVudCk7XG5cbiAgICAgIGRlbGV0ZUNvbW1lbnQoe1xuICAgICAgICBjb21tZW50SWQ6IGNvbW1lbnQuaWQsXG4gICAgICAgIHRocmVhZElkOiBjb21tZW50LnRocmVhZElkLFxuICAgICAgfSk7XG4gICAgfSwgW2NvbW1lbnQsIGRlbGV0ZUNvbW1lbnQsIG9uQ29tbWVudERlbGV0ZV0pO1xuXG4gICAgY29uc3QgaGFuZGxlQXV0aG9yQ2xpY2sgPSB1c2VDYWxsYmFjayhcbiAgICAgIChldmVudDogTW91c2VFdmVudDxIVE1MRWxlbWVudD4pID0+IHtcbiAgICAgICAgb25BdXRob3JDbGljaz8uKGNvbW1lbnQudXNlcklkLCBldmVudCk7XG4gICAgICB9LFxuICAgICAgW2NvbW1lbnQudXNlcklkLCBvbkF1dGhvckNsaWNrXVxuICAgICk7XG5cbiAgICBjb25zdCBoYW5kbGVSZWFjdGlvblNlbGVjdCA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGVtb2ppOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgcmVhY3Rpb25JbmRleCA9IGNvbW1lbnQucmVhY3Rpb25zLmZpbmRJbmRleChcbiAgICAgICAgICAocmVhY3Rpb24pID0+IHJlYWN0aW9uLmVtb2ppID09PSBlbW9qaVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICByZWFjdGlvbkluZGV4ID49IDAgJiZcbiAgICAgICAgICBzZWxmPy5pZCAmJlxuICAgICAgICAgIGNvbW1lbnQucmVhY3Rpb25zW3JlYWN0aW9uSW5kZXhdLnVzZXJzLnNvbWUoXG4gICAgICAgICAgICAodXNlcikgPT4gdXNlci5pZCA9PT0gc2VsZj8uaWRcbiAgICAgICAgICApXG4gICAgICAgICkge1xuICAgICAgICAgIHJlbW92ZVJlYWN0aW9uKHtcbiAgICAgICAgICAgIHRocmVhZElkOiBjb21tZW50LnRocmVhZElkLFxuICAgICAgICAgICAgY29tbWVudElkOiBjb21tZW50LmlkLFxuICAgICAgICAgICAgZW1vamksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWRkUmVhY3Rpb24oe1xuICAgICAgICAgICAgdGhyZWFkSWQ6IGNvbW1lbnQudGhyZWFkSWQsXG4gICAgICAgICAgICBjb21tZW50SWQ6IGNvbW1lbnQuaWQsXG4gICAgICAgICAgICBlbW9qaSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtcbiAgICAgICAgYWRkUmVhY3Rpb24sXG4gICAgICAgIGNvbW1lbnQuaWQsXG4gICAgICAgIGNvbW1lbnQucmVhY3Rpb25zLFxuICAgICAgICBjb21tZW50LnRocmVhZElkLFxuICAgICAgICByZW1vdmVSZWFjdGlvbixcbiAgICAgICAgc2VsZj8uaWQsXG4gICAgICBdXG4gICAgKTtcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBjb25zdCBpc1dpbmRvd0RlZmluZWQgPSB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiO1xuICAgICAgaWYgKCFpc1dpbmRvd0RlZmluZWQpIHJldHVybjtcblxuICAgICAgY29uc3QgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgICAgY29uc3QgY29tbWVudElkID0gaGFzaC5zbGljZSgxKTtcblxuICAgICAgaWYgKGNvbW1lbnRJZCA9PT0gY29tbWVudC5pZCkge1xuICAgICAgICBzZXRUYXJnZXQodHJ1ZSk7XG4gICAgICB9XG4gICAgfSwgW10pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuXG4gICAgaWYgKCFzaG93RGVsZXRlZCAmJiAhY29tbWVudC5ib2R5KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFRvb2x0aXBQcm92aWRlcj5cbiAgICAgICAge2F1dG9NYXJrUmVhZFRocmVhZElkICYmIChcbiAgICAgICAgICA8QXV0b01hcmtSZWFkVGhyZWFkSWRIYW5kbGVyXG4gICAgICAgICAgICBjb21tZW50UmVmPXtyZWZ9XG4gICAgICAgICAgICB0aHJlYWRJZD17YXV0b01hcmtSZWFkVGhyZWFkSWR9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGlkPXtjb21tZW50LmlkfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcbiAgICAgICAgICAgIFwibGItcm9vdCBsYi1jb21tZW50XCIsXG4gICAgICAgICAgICBpbmRlbnRDb250ZW50ICYmIFwibGItY29tbWVudDppbmRlbnQtY29udGVudFwiLFxuICAgICAgICAgICAgc2hvd0FjdGlvbnMgPT09IFwiaG92ZXJcIiAmJiBcImxiLWNvbW1lbnQ6c2hvdy1hY3Rpb25zLWhvdmVyXCIsXG4gICAgICAgICAgICAoaXNNb3JlQWN0aW9uT3BlbiB8fCBpc1JlYWN0aW9uQWN0aW9uT3BlbikgJiZcbiAgICAgICAgICAgICAgXCJsYi1jb21tZW50OmFjdGlvbi1vcGVuXCIsXG4gICAgICAgICAgICBjbGFzc05hbWVcbiAgICAgICAgICApfVxuICAgICAgICAgIGRhdGEtZGVsZXRlZD17IWNvbW1lbnQuYm9keSA/IFwiXCIgOiB1bmRlZmluZWR9XG4gICAgICAgICAgZGF0YS1lZGl0aW5nPXtpc0VkaXRpbmcgPyBcIlwiIDogdW5kZWZpbmVkfVxuICAgICAgICAgIC8vIEluIHNvbWUgY2FzZXMsIGA6dGFyZ2V0YCBkb2Vzbid0IHdvcmsgYXMgZXhwZWN0ZWQgc28gd2UgYWxzbyBkZWZpbmUgaXQgbWFudWFsbHkuXG4gICAgICAgICAgZGF0YS10YXJnZXQ9e2lzVGFyZ2V0ID8gXCJcIiA6IHVuZGVmaW5lZH1cbiAgICAgICAgICBkaXI9eyQuZGlyfVxuICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICByZWY9e21lcmdlZFJlZnN9XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtaGVhZGVyXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtZGV0YWlsc1wiPlxuICAgICAgICAgICAgICA8QXZhdGFyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItY29tbWVudC1hdmF0YXJcIlxuICAgICAgICAgICAgICAgIHVzZXJJZD17Y29tbWVudC51c2VySWR9XG4gICAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlQXV0aG9yQ2xpY2t9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtZGV0YWlscy1sYWJlbHNcIj5cbiAgICAgICAgICAgICAgICA8VXNlclxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItY29tbWVudC1hdXRob3JcIlxuICAgICAgICAgICAgICAgICAgdXNlcklkPXtjb21tZW50LnVzZXJJZH1cbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUF1dGhvckNsaWNrfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibGItY29tbWVudC1kYXRlXCI+XG4gICAgICAgICAgICAgICAgICA8VGltZXN0YW1wXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsZT17JC5sb2NhbGV9XG4gICAgICAgICAgICAgICAgICAgIGRhdGU9e2NvbW1lbnQuY3JlYXRlZEF0fVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYi1jb21tZW50LWRhdGUtY3JlYXRlZFwiXG4gICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAge2NvbW1lbnQuZWRpdGVkQXQgJiYgY29tbWVudC5ib2R5ICYmIChcbiAgICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAgICB7XCIgXCJ9XG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibGItY29tbWVudC1kYXRlLWVkaXRlZFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyQuQ09NTUVOVF9FRElURUR9XG4gICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIHtzaG93QWN0aW9ucyAmJiAhaXNFZGl0aW5nICYmIChcbiAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcbiAgICAgICAgICAgICAgICAgIFwibGItY29tbWVudC1hY3Rpb25zXCIsXG4gICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQWN0aW9uc0NsYXNzTmFtZVxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7YWRkaXRpb25hbEFjdGlvbnMgPz8gbnVsbH1cbiAgICAgICAgICAgICAgICB7c2hvd1JlYWN0aW9ucyAmJiAoXG4gICAgICAgICAgICAgICAgICA8RW1vamlQaWNrZXJcbiAgICAgICAgICAgICAgICAgICAgb25FbW9qaVNlbGVjdD17aGFuZGxlUmVhY3Rpb25TZWxlY3R9XG4gICAgICAgICAgICAgICAgICAgIG9uT3BlbkNoYW5nZT17c2V0UmVhY3Rpb25BY3Rpb25PcGVufVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8VG9vbHRpcCBjb250ZW50PXskLkNPTU1FTlRfQUREX1JFQUNUSU9OfT5cbiAgICAgICAgICAgICAgICAgICAgICA8RW1vamlQaWNrZXJUcmlnZ2VyIGFzQ2hpbGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtYWN0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17c3RvcFByb3BhZ2F0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXskLkNPTU1FTlRfQUREX1JFQUNUSU9OfVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8RW1vamlBZGRJY29uIGNsYXNzTmFtZT1cImxiLWJ1dHRvbi1pY29uXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgIDwvRW1vamlQaWNrZXJUcmlnZ2VyPlxuICAgICAgICAgICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgICAgICAgICA8L0Vtb2ppUGlja2VyPlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAge2NvbW1lbnQudXNlcklkID09PSBzZWxmPy5pZCAmJiAoXG4gICAgICAgICAgICAgICAgICA8RHJvcGRvd25cbiAgICAgICAgICAgICAgICAgICAgb3Blbj17aXNNb3JlQWN0aW9uT3Blbn1cbiAgICAgICAgICAgICAgICAgICAgb25PcGVuQ2hhbmdlPXtzZXRNb3JlQWN0aW9uT3Blbn1cbiAgICAgICAgICAgICAgICAgICAgYWxpZ249XCJlbmRcIlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50PXtcbiAgICAgICAgICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgICAgICAgICAgPERyb3Bkb3duSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17aGFuZGxlRWRpdH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17c3RvcFByb3BhZ2F0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8RWRpdEljb24gY2xhc3NOYW1lPVwibGItZHJvcGRvd24taXRlbS1pY29uXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgeyQuQ09NTUVOVF9FRElUfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Ecm9wZG93bkl0ZW0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8RHJvcGRvd25JdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0PXtoYW5kbGVEZWxldGV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3N0b3BQcm9wYWdhdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPERlbGV0ZUljb24gY2xhc3NOYW1lPVwibGItZHJvcGRvd24taXRlbS1pY29uXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgeyQuQ09NTUVOVF9ERUxFVEV9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duSXRlbT5cbiAgICAgICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8VG9vbHRpcCBjb250ZW50PXskLkNPTU1FTlRfTU9SRX0+XG4gICAgICAgICAgICAgICAgICAgICAgPERyb3Bkb3duVHJpZ2dlciBhc0NoaWxkPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYi1jb21tZW50LWFjdGlvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshY29tbWVudC5ib2R5fVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtzdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9eyQuQ09NTUVOVF9NT1JFfVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8RWxsaXBzaXNJY29uIGNsYXNzTmFtZT1cImxiLWJ1dHRvbi1pY29uXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgIDwvRHJvcGRvd25UcmlnZ2VyPlxuICAgICAgICAgICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duPlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtY29udGVudFwiPlxuICAgICAgICAgICAge2lzRWRpdGluZyA/IChcbiAgICAgICAgICAgICAgPENvbXBvc2VyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItY29tbWVudC1jb21wb3NlclwiXG4gICAgICAgICAgICAgICAgb25Db21wb3NlclN1Ym1pdD17aGFuZGxlRWRpdFN1Ym1pdH1cbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU9e2NvbW1lbnQuYm9keX1cbiAgICAgICAgICAgICAgICBhdXRvRm9jdXNcbiAgICAgICAgICAgICAgICBzaG93QXR0cmlidXRpb249e2ZhbHNlfVxuICAgICAgICAgICAgICAgIGFjdGlvbnM9e1xuICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAgPFRvb2x0aXBcbiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50PXskLkNPTU1FTlRfRURJVF9DT01QT1NFUl9DQU5DRUx9XG4gICAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17JC5DT01NRU5UX0VESVRfQ09NUE9TRVJfQ0FOQ0VMfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItY29tcG9zZXItYWN0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUVkaXRDYW5jZWx9XG4gICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgPENyb3NzSWNvbiBjbGFzc05hbWU9XCJsYi1idXR0b24taWNvblwiIC8+XG4gICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgICAgPFNob3J0Y3V0VG9vbHRpcFxuICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ9eyQuQ09NTUVOVF9FRElUX0NPTVBPU0VSX1NBVkV9XG4gICAgICAgICAgICAgICAgICAgICAgc2hvcnRjdXQ9ezxTaG9ydGN1dFRvb2x0aXBLZXkgbmFtZT1cImVudGVyXCIgLz59XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICA8Q29tcG9zZXJQcmltaXRpdmUuU3VibWl0IGFzQ2hpbGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItY29tcG9zZXItYWN0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17c3RvcFByb3BhZ2F0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXskLkNPTU1FTlRfRURJVF9DT01QT1NFUl9TQVZFfVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8Q2hlY2tJY29uIGNsYXNzTmFtZT1cImxiLWJ1dHRvbi1pY29uXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgIDwvQ29tcG9zZXJQcmltaXRpdmUuU3VibWl0PlxuICAgICAgICAgICAgICAgICAgICA8L1Nob3J0Y3V0VG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvdmVycmlkZXM9e3tcbiAgICAgICAgICAgICAgICAgIENPTVBPU0VSX1BMQUNFSE9MREVSOiAkLkNPTU1FTlRfRURJVF9DT01QT1NFUl9QTEFDRUhPTERFUixcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSA6IGNvbW1lbnQuYm9keSA/IChcbiAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICA8Q29tbWVudFByaW1pdGl2ZS5Cb2R5XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYi1jb21tZW50LWJvZHlcIlxuICAgICAgICAgICAgICAgICAgYm9keT17Y29tbWVudC5ib2R5fVxuICAgICAgICAgICAgICAgICAgY29tcG9uZW50cz17e1xuICAgICAgICAgICAgICAgICAgICBNZW50aW9uOiAoeyB1c2VySWQgfSkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgIDxDb21tZW50TWVudGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkPXt1c2VySWR9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IG9uTWVudGlvbkNsaWNrPy4odXNlcklkLCBldmVudCl9XG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgTGluazogQ29tbWVudExpbmssXG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAge3Nob3dSZWFjdGlvbnMgJiYgY29tbWVudC5yZWFjdGlvbnMubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtcmVhY3Rpb25zXCI+XG4gICAgICAgICAgICAgICAgICAgIHtjb21tZW50LnJlYWN0aW9ucy5tYXAoKHJlYWN0aW9uKSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgPENvbW1lbnRSZWFjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtyZWFjdGlvbi5lbW9qaX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQ9e2NvbW1lbnR9XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbj17cmVhY3Rpb259XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZXM9e292ZXJyaWRlc31cbiAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICApKX1cbiAgICAgICAgICAgICAgICAgICAgPEVtb2ppUGlja2VyIG9uRW1vamlTZWxlY3Q9e2hhbmRsZVJlYWN0aW9uU2VsZWN0fT5cbiAgICAgICAgICAgICAgICAgICAgICA8VG9vbHRpcCBjb250ZW50PXskLkNPTU1FTlRfQUREX1JFQUNUSU9OfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxFbW9qaVBpY2tlclRyaWdnZXIgYXNDaGlsZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtcmVhY3Rpb24gbGItY29tbWVudC1yZWFjdGlvbi1hZGRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtzdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17JC5DT01NRU5UX0FERF9SRUFDVElPTn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxFbW9qaUFkZEljb24gY2xhc3NOYW1lPVwibGItYnV0dG9uLWljb25cIiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvRW1vamlQaWNrZXJUcmlnZ2VyPlxuICAgICAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgICAgPC9FbW9qaVBpY2tlcj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsYi1jb21tZW50LWJvZHlcIj5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJsYi1jb21tZW50LWRlbGV0ZWRcIj57JC5DT01NRU5UX0RFTEVURUR9PC9wPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9Ub29sdGlwUHJvdmlkZXI+XG4gICAgKTtcbiAgfVxuKTtcbiJdLCJuYW1lcyI6WyJSRUFDVElPTlNfVFJVTkNBVEUiLCJDb21tZW50TWVudGlvbiIsInVzZXJJZCIsImNsYXNzTmFtZSIsInByb3BzIiwiY3VycmVudElkIiwidXNlQ3VycmVudFVzZXJJZCIsIlJlYWN0X19kZWZhdWx0IiwiY3JlYXRlRWxlbWVudCIsIkNvbW1lbnRNZW50aW9uJDEiLCJjbGFzc05hbWVzIiwiTUVOVElPTl9DSEFSQUNURVIiLCJVc2VyIiwiQ29tbWVudExpbmsiLCJocmVmIiwiY2hpbGRyZW4iLCJDb21tZW50TGluayQxIiwiQ29tbWVudE5vbkludGVyYWN0aXZlTGluayIsIl9ocmVmIiwiQ29tbWVudFJlYWN0aW9uQnV0dG9uIiwiZm9yd2FyZFJlZiIsInJlYWN0aW9uIiwib3ZlcnJpZGVzIiwiZm9yd2FyZGVkUmVmIiwiJCIsInVzZU92ZXJyaWRlcyIsIkJ1dHRvbiIsInZhcmlhbnQiLCJDT01NRU5UX1JFQUNUSU9OX0RFU0NSSVBUSU9OIiwiZW1vamkiLCJ1c2VycyIsImxlbmd0aCIsInJlZiIsIkVtb2ppIiwiQ29tbWVudFJlYWN0aW9uIiwiY29tbWVudCIsImRpc2FibGVkIiwiYWRkUmVhY3Rpb24iLCJ1c2VBZGRSZWFjdGlvbiIsInJlbW92ZVJlYWN0aW9uIiwidXNlUmVtb3ZlUmVhY3Rpb24iLCJpc0FjdGl2ZSIsInVzZU1lbW8iLCJzb21lIiwiaWQiLCJ0b29sdGlwQ29udGVudCIsIkNPTU1FTlRfUkVBQ1RJT05fTElTVCIsIkxpc3QiLCJ2YWx1ZXMiLCJtYXAiLCJpbmRleCIsImtleSIsImNhcGl0YWxpemUiLCJyZXBsYWNlU2VsZiIsImZvcm1hdFJlbWFpbmluZyIsIkxJU1RfUkVNQUlOSU5HX1VTRVJTIiwidHJ1bmNhdGUiLCJoYW5kbGVQcmVzc2VkQ2hhbmdlIiwidXNlQ2FsbGJhY2siLCJpc1ByZXNzZWQiLCJ0aHJlYWRJZCIsImNvbW1lbnRJZCIsIlRvb2x0aXAiLCJjb250ZW50IiwibXVsdGlsaW5lIiwiVG9nZ2xlUHJpbWl0aXZlIiwiUm9vdCIsImFzQ2hpbGQiLCJwcmVzc2VkIiwib25QcmVzc2VkQ2hhbmdlIiwiQ29tbWVudE5vbkludGVyYWN0aXZlUmVhY3Rpb24iLCJkaXNhYmxlYWJsZSIsIkF1dG9NYXJrUmVhZFRocmVhZElkSGFuZGxlciIsImNvbW1lbnRSZWYiLCJtYXJrVGhyZWFkQXNSZWFkIiwidXNlTWFya1RocmVhZEFzUmVhZCIsImlzV2luZG93Rm9jdXNlZCIsInVzZVdpbmRvd0ZvY3VzIiwidXNlVmlzaWJsZUNhbGxiYWNrIiwiZW5hYmxlZCIsIkNvbW1lbnQiLCJpbmRlbnRDb250ZW50Iiwic2hvd0RlbGV0ZWQiLCJzaG93QWN0aW9ucyIsInNob3dSZWFjdGlvbnMiLCJvbkF1dGhvckNsaWNrIiwib25NZW50aW9uQ2xpY2siLCJvbkNvbW1lbnRFZGl0Iiwib25Db21tZW50RGVsZXRlIiwiYWRkaXRpb25hbEFjdGlvbnMiLCJhZGRpdGlvbmFsQWN0aW9uc0NsYXNzTmFtZSIsImF1dG9NYXJrUmVhZFRocmVhZElkIiwidXNlUmVmIiwibWVyZ2VkUmVmcyIsInVzZVJlZnMiLCJzZWxmIiwidXNlU2VsZiIsImRlbGV0ZUNvbW1lbnQiLCJ1c2VEZWxldGVDb21tZW50IiwiZWRpdENvbW1lbnQiLCJ1c2VFZGl0Q29tbWVudCIsImlzRWRpdGluZyIsInNldEVkaXRpbmciLCJ1c2VTdGF0ZSIsImlzVGFyZ2V0Iiwic2V0VGFyZ2V0IiwiaXNNb3JlQWN0aW9uT3BlbiIsInNldE1vcmVBY3Rpb25PcGVuIiwiaXNSZWFjdGlvbkFjdGlvbk9wZW4iLCJzZXRSZWFjdGlvbkFjdGlvbk9wZW4iLCJzdG9wUHJvcGFnYXRpb24iLCJldmVudCIsImhhbmRsZUVkaXQiLCJoYW5kbGVFZGl0Q2FuY2VsIiwiaGFuZGxlRWRpdFN1Ym1pdCIsImJvZHkiLCJwcmV2ZW50RGVmYXVsdCIsImhhbmRsZURlbGV0ZSIsImhhbmRsZUF1dGhvckNsaWNrIiwiaGFuZGxlUmVhY3Rpb25TZWxlY3QiLCJyZWFjdGlvbkluZGV4IiwicmVhY3Rpb25zIiwiZmluZEluZGV4IiwidXNlciIsInVzZUVmZmVjdCIsImlzV2luZG93RGVmaW5lZCIsImhhc2giLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNsaWNlIiwiVG9vbHRpcFByb3ZpZGVyIiwiZGlyIiwiQXZhdGFyIiwib25DbGljayIsIlRpbWVzdGFtcCIsImxvY2FsZSIsImRhdGUiLCJjcmVhdGVkQXQiLCJlZGl0ZWRBdCIsIkZyYWdtZW50IiwiQ09NTUVOVF9FRElURUQiLCJFbW9qaVBpY2tlciIsIm9uRW1vamlTZWxlY3QiLCJvbk9wZW5DaGFuZ2UiLCJDT01NRU5UX0FERF9SRUFDVElPTiIsIlBvcG92ZXJUcmlnZ2VyIiwiRW1vamlBZGRJY29uIiwiRHJvcGRvd24iLCJvcGVuIiwiYWxpZ24iLCJEcm9wZG93bkl0ZW0iLCJvblNlbGVjdCIsIkVkaXRJY29uIiwiQ09NTUVOVF9FRElUIiwiRGVsZXRlSWNvbiIsIkNPTU1FTlRfREVMRVRFIiwiQ09NTUVOVF9NT1JFIiwiRHJvcGRvd25NZW51VHJpZ2dlciIsIkVsbGlwc2lzSWNvbiIsIkNvbXBvc2VyIiwib25Db21wb3NlclN1Ym1pdCIsImRlZmF1bHRWYWx1ZSIsImF1dG9Gb2N1cyIsInNob3dBdHRyaWJ1dGlvbiIsImFjdGlvbnMiLCJDT01NRU5UX0VESVRfQ09NUE9TRVJfQ0FOQ0VMIiwiQ3Jvc3NJY29uIiwiU2hvcnRjdXRUb29sdGlwIiwiQ09NTUVOVF9FRElUX0NPTVBPU0VSX1NBVkUiLCJzaG9ydGN1dCIsIlNob3J0Y3V0VG9vbHRpcEtleSIsIm5hbWUiLCJDb21wb3NlclN1Ym1pdCIsIkNoZWNrSWNvbiIsIkNPTVBPU0VSX1BMQUNFSE9MREVSIiwiQ09NTUVOVF9FRElUX0NPTVBPU0VSX1BMQUNFSE9MREVSIiwiQ29tbWVudEJvZHkiLCJjb21wb25lbnRzIiwiTWVudGlvbiIsIkxpbmsiLCJDT01NRU5UX0RFTEVURUQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Comment.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Composer.mjs":
/*!************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/Composer.mjs ***!
  \************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Composer: () => (/* binding */ Composer)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _icons_Emoji_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../icons/Emoji.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Emoji.mjs\");\n/* harmony import */ var _icons_Mention_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../icons/Mention.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Mention.mjs\");\n/* harmony import */ var _icons_Send_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../icons/Send.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Send.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../primitives/Composer/index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/index.mjs\");\n/* harmony import */ var _primitives_Composer_contexts_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../primitives/Composer/contexts.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/contexts.mjs\");\n/* harmony import */ var _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../slate/plugins/mentions.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_use_controllable_state_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../utils/use-controllable-state.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-controllable-state.mjs\");\n/* harmony import */ var _internal_Attribution_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./internal/Attribution.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Attribution.mjs\");\n/* harmony import */ var _internal_Avatar_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./internal/Avatar.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Avatar.mjs\");\n/* harmony import */ var _internal_Button_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./internal/Button.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs\");\n/* harmony import */ var _internal_EmojiPicker_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./internal/EmojiPicker.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/EmojiPicker.mjs\");\n/* harmony import */ var _internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./internal/Tooltip.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs\");\n/* harmony import */ var _internal_User_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./internal/User.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs\");\n/* harmony import */ var _radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @radix-ui/react-tooltip */ \"(ssr)/./node_modules/@radix-ui/react-tooltip/dist/index.mjs\");\n/* harmony import */ var _radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @radix-ui/react-popover */ \"(ssr)/./node_modules/@radix-ui/react-popover/dist/index.mjs\");\n/* __next_internal_client_entry_do_not_use__ Composer auto */ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction ComposerInsertMentionEditorAction({ label, className, onClick, ...props }) {\n    const { createMention } = (0,_primitives_Composer_contexts_mjs__WEBPACK_IMPORTED_MODULE_1__.useComposer)();\n    const preventDefault = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.preventDefault();\n    }, []);\n    const handleClick = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onClick?.(event);\n        if (!event.isDefaultPrevented()) {\n            event.stopPropagation();\n            createMention();\n        }\n    }, [\n        createMention,\n        onClick\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_2__.Tooltip, {\n        content: label\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_3__.Button, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-composer-editor-action\", className),\n        onMouseDown: preventDefault,\n        onClick: handleClick,\n        \"aria-label\": label,\n        ...props\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Mention_mjs__WEBPACK_IMPORTED_MODULE_5__.MentionIcon, {\n        className: \"lb-button-icon\"\n    })));\n}\nfunction ComposerInsertEmojiEditorAction({ label, onPickerOpenChange, className, ...props }) {\n    const { insertText } = (0,_primitives_Composer_contexts_mjs__WEBPACK_IMPORTED_MODULE_1__.useComposer)();\n    const preventDefault = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.preventDefault();\n    }, []);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_EmojiPicker_mjs__WEBPACK_IMPORTED_MODULE_6__.EmojiPicker, {\n        onEmojiSelect: insertText,\n        onOpenChange: onPickerOpenChange\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_2__.Tooltip, {\n        content: label\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_7__.PopoverTrigger, {\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_3__.Button, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-composer-editor-action\", className),\n        onMouseDown: preventDefault,\n        \"aria-label\": label,\n        ...props\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Emoji_mjs__WEBPACK_IMPORTED_MODULE_8__.EmojiIcon, {\n        className: \"lb-button-icon\"\n    })))));\n}\nfunction ComposerMention({ userId }) {\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.Mention, {\n        className: \"lb-composer-mention\"\n    }, _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_10__.MENTION_CHARACTER, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_11__.User, {\n        userId\n    }));\n}\nfunction ComposerMentionSuggestions({ userIds }) {\n    return userIds.length > 0 ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.Suggestions, {\n        className: \"lb-root lb-portal lb-elevation lb-composer-suggestions lb-composer-mention-suggestions\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.SuggestionsList, {\n        className: \"lb-composer-suggestions-list lb-composer-mention-suggestions-list\"\n    }, userIds.map((userId)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.SuggestionsListItem, {\n            key: userId,\n            className: \"lb-composer-suggestions-list-item lb-composer-mention-suggestion\",\n            value: userId\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Avatar_mjs__WEBPACK_IMPORTED_MODULE_12__.Avatar, {\n            userId,\n            className: \"lb-composer-mention-suggestion-avatar\"\n        }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_11__.User, {\n            userId,\n            className: \"lb-composer-mention-suggestion-user\"\n        }))))) : null;\n}\nfunction ComposerLink({ href, children }) {\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.Link, {\n        href,\n        className: \"lb-composer-link\"\n    }, children);\n}\nconst editorComponents = {\n    Mention: ComposerMention,\n    MentionSuggestions: ComposerMentionSuggestions,\n    Link: ComposerLink\n};\nconst ComposerWithContext = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ defaultValue, disabled, autoFocus, collapsed: controlledCollapsed, defaultCollapsed, onCollapsedChange: controlledOnCollapsedChange, actions, overrides, showAttribution, onFocus, onBlur, className, ...props }, forwardedRef)=>{\n    const client = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_13__.useClient)();\n    const hasResolveMentionSuggestions = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_14__.kInternal].resolveMentionSuggestions !== void 0;\n    const self = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_13__._useSelf)();\n    const isDisabled = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>disabled || !self?.canComment, [\n        disabled,\n        self?.canComment\n    ]);\n    const { isEmpty } = (0,_primitives_Composer_contexts_mjs__WEBPACK_IMPORTED_MODULE_1__.useComposer)();\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_15__.useOverrides)(overrides);\n    const [isEmojiPickerOpen, setEmojiPickerOpen] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [collapsed, onCollapsedChange] = (0,_utils_use_controllable_state_mjs__WEBPACK_IMPORTED_MODULE_16__.useControllableState)(controlledCollapsed === void 0 && defaultCollapsed === void 0 ? false : controlledCollapsed, controlledOnCollapsedChange, defaultCollapsed);\n    const preventDefault = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.preventDefault();\n    }, []);\n    const stopPropagation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.stopPropagation();\n    }, []);\n    const handleEditorClick = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.stopPropagation();\n        if (isEmpty) {\n            onCollapsedChange?.(false);\n        }\n    }, [\n        isEmpty,\n        onCollapsedChange\n    ]);\n    const handleFocus = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onFocus?.(event);\n        if (event.isDefaultPrevented()) {\n            return;\n        }\n        if (isEmpty) {\n            onCollapsedChange?.(false);\n        }\n    }, [\n        isEmpty,\n        onCollapsedChange,\n        onFocus\n    ]);\n    const handleBlur = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onBlur?.(event);\n        if (event.isDefaultPrevented()) {\n            return;\n        }\n        const isOutside = !event.currentTarget.contains(event.relatedTarget);\n        if (isOutside && isEmpty && !isEmojiPickerOpen) {\n            onCollapsedChange?.(true);\n        }\n    }, [\n        isEmojiPickerOpen,\n        isEmpty,\n        onBlur,\n        onCollapsedChange\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"form\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-root lb-composer lb-composer-form\", className),\n        dir: $.dir,\n        ...props,\n        ref: forwardedRef,\n        \"data-collapsed\": collapsed ? \"\" : void 0,\n        onFocus: handleFocus,\n        onBlur: handleBlur\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.Editor, {\n        className: \"lb-composer-editor\",\n        onClick: handleEditorClick,\n        placeholder: $.COMPOSER_PLACEHOLDER,\n        defaultValue,\n        disabled: isDisabled,\n        autoFocus,\n        components: editorComponents,\n        dir: $.dir\n    }), !collapsed && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-composer-footer\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-composer-editor-actions\"\n    }, hasResolveMentionSuggestions && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerInsertMentionEditorAction, {\n        label: $.COMPOSER_INSERT_MENTION,\n        disabled: isDisabled\n    }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerInsertEmojiEditorAction, {\n        label: $.COMPOSER_INSERT_EMOJI,\n        onPickerOpenChange: setEmojiPickerOpen,\n        disabled: isDisabled\n    })), showAttribution && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Attribution_mjs__WEBPACK_IMPORTED_MODULE_17__.Attribution, null), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-composer-actions\"\n    }, actions ?? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_2__.ShortcutTooltip, {\n        content: $.COMPOSER_SEND,\n        shortcut: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_2__.ShortcutTooltipKey, {\n            name: \"enter\"\n        })\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.Submit, {\n        disabled: isDisabled,\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_3__.Button, {\n        onMouseDown: preventDefault,\n        onClick: stopPropagation,\n        className: \"lb-composer-action\",\n        variant: \"primary\",\n        \"aria-label\": $.COMPOSER_SEND\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Send_mjs__WEBPACK_IMPORTED_MODULE_18__.SendIcon, null))))))));\n});\nconst Composer = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ threadId, commentId, metadata, onComposerSubmit, onFocus, ...props }, forwardedRef)=>{\n    const createThread = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_13__._useCreateThread)();\n    const createComment = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_13__.useCreateComment)();\n    const editComment = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_13__.useEditComment)();\n    const handleCommentSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((comment, event)=>{\n        onComposerSubmit?.(comment, event);\n        if (event.isDefaultPrevented()) {\n            return;\n        }\n        if (commentId && threadId) {\n            editComment({\n                commentId,\n                threadId,\n                body: comment.body\n            });\n        } else if (threadId) {\n            createComment({\n                threadId,\n                body: comment.body\n            });\n        } else {\n            createThread({\n                body: comment.body,\n                metadata: metadata ?? {}\n            });\n        }\n    }, [\n        commentId,\n        createComment,\n        createThread,\n        editComment,\n        metadata,\n        onComposerSubmit,\n        threadId\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_19__.TooltipProvider, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Composer_index_mjs__WEBPACK_IMPORTED_MODULE_9__.Form, {\n        onComposerSubmit: handleCommentSubmit,\n        onFocus,\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerWithContext, {\n        ...props,\n        ref: forwardedRef\n    })));\n});\n //# sourceMappingURL=Composer.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL0NvbXBvc2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZKQSxTQUFBQSxrQ0FBQSxFQUEyQ0MsS0FBQSxFQUN6Q0MsU0FBQSxFQUNBQyxPQUFBLEVBQ0EsR0FBQUMsT0FFRjtJQUNFLFFBQUFDLGFBQUEsS0FBQUMsOEVBQUFBO0lBRUEsTUFBQUMsaUJBQUFDLGtEQUFBQSxDQUFBLENBQUFDO1FBQ0VBLE1BQUFGLGNBQUE7SUFBcUI7SUFHdkIsTUFBQUcsY0FBQUYsa0RBQUFBLENBQW9CLENBQUFDO1FBRWhCTixVQUFBTTtRQUVBLEtBQUFBLE1BQUFFLGtCQUFBO1lBQ0VGLE1BQUFHLGVBQUE7WUFDQVA7UUFBYztJQUNoQixHQUNGO1FBQUFBO1FBQUFGO0tBQUE7SUFJRixxQ0FBQVUsZ0RBQUEsQ0FBQUUsMERBQUFBLEVBQUE7UUFDR0MsU0FBQWY7SUFBaUIsaUNBQUFZLGdEQUFBLENBQUFJLHdEQUFBQSxFQUFBO1FBQ2ZmLFdBQUFnQixrRUFBQUEsQ0FBQSw2QkFBQWhCO1FBQzZEaUIsYUFBQVo7UUFDL0NKLFNBQUFPO1FBQ0osY0FBQVQ7UUFDRyxHQUFBRyxLQUFBO0lBQ1IsaUNBQUFTLGdEQUFBLENBQUFPLDJEQUFBQSxFQUFBO1FBRUhsQixXQUFBO0lBQXNCO0FBSS9CO0FBRUEsU0FBQW1CLGdDQUFBLEVBQXlDcEIsS0FBQSxFQUN2Q3FCLGtCQUFBLEVBQ0FwQixTQUFBLEVBQ0EsR0FBQUUsT0FFRjtJQUNFLFFBQUFtQixVQUFBLEtBQUFqQiw4RUFBQUE7SUFFQSxNQUFBQyxpQkFBQUMsa0RBQUFBLENBQUEsQ0FBQUM7UUFDRUEsTUFBQUYsY0FBQTtJQUFxQjtJQUd2QixxQ0FBQU0sZ0RBQUEsQ0FBQVcsa0VBQUFBLEVBQUE7UUFDR0MsZUFBQUY7UUFBMkJHLGNBQUFKO0lBQTBCLGlD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QUVETSxjQUFBO2dCQUFjTjtnQkFDWlksTUFBQUQsUUFBQUMsSUFBQTtZQUNjO1FBQ2Y7WUFFRFIsYUFBQTtnQkFBYVEsTUFBQUQsUUFBQUMsSUFBQTtnQkFDR1YsVUFBQUEsWUFBQTtZQUNTO1FBQ3hCO0lBQ0gsR0FDRjtRQUNBRDtRQUNFSztRQUNBRjtRQUNBSTtRQUNBTjtRQUNBQztRQUNBSDtLQUNBO0lBSUoscUNBQUFuRyxnREFBQSxDQUFBZ0gscUVBQUFBLEVBQUEsb0NBQUFoSCxnREFBQSxDQUFBaUgsZ0VBQUFBLEVBQUE7UUFFS1gsa0JBQUFPO1FBQ21CeEQ7UUFDbEJ0QyxTQUFBO0lBQ08saUNBQUFmLGdEQUFBLENBQUF3QyxxQkFBQTtRQUVOLEdBQUFqRCxLQUFBO1FBQXdCMEYsS0FBQTFCO0lBQVk7QUFFekMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uLi8uLi9zcmMvY29tcG9uZW50cy9Db21wb3Nlci50c3g/ZjEyMyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcblxuaW1wb3J0IHR5cGUgeyBCYXNlTWV0YWRhdGEsIERNIH0gZnJvbSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcbmltcG9ydCB7IGtJbnRlcm5hbCB9IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5pbXBvcnQge1xuICB1c2VDbGllbnQsXG4gIHVzZUNyZWF0ZUNvbW1lbnQsXG4gIHVzZUNyZWF0ZVRocmVhZCxcbiAgdXNlRWRpdENvbW1lbnQsXG4gIHVzZVNlbGYsXG59IGZyb20gXCJAbGl2ZWJsb2Nrcy9yZWFjdFwiO1xuaW1wb3J0IHR5cGUge1xuICBDb21wb25lbnRQcm9wc1dpdGhvdXRSZWYsXG4gIEZvY3VzRXZlbnQsXG4gIEZvcm1FdmVudCxcbiAgRm9yd2FyZGVkUmVmLFxuICBNb3VzZUV2ZW50LFxuICBSZWFjdE5vZGUsXG4gIFJlZkF0dHJpYnV0ZXMsXG4gIFN5bnRoZXRpY0V2ZW50LFxufSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwgeyBmb3J3YXJkUmVmLCB1c2VDYWxsYmFjaywgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgRW1vamlJY29uIH0gZnJvbSBcIi4uL2ljb25zL0Vtb2ppXCI7XG5pbXBvcnQgeyBNZW50aW9uSWNvbiB9IGZyb20gXCIuLi9pY29ucy9NZW50aW9uXCI7XG5pbXBvcnQgeyBTZW5kSWNvbiB9IGZyb20gXCIuLi9pY29ucy9TZW5kXCI7XG5pbXBvcnQgdHlwZSB7IENvbXBvc2VyT3ZlcnJpZGVzLCBHbG9iYWxPdmVycmlkZXMgfSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyB1c2VPdmVycmlkZXMgfSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgKiBhcyBDb21wb3NlclByaW1pdGl2ZSBmcm9tIFwiLi4vcHJpbWl0aXZlcy9Db21wb3NlclwiO1xuaW1wb3J0IHsgdXNlQ29tcG9zZXIgfSBmcm9tIFwiLi4vcHJpbWl0aXZlcy9Db21wb3Nlci9jb250ZXh0c1wiO1xuaW1wb3J0IHR5cGUge1xuICBDb21wb3NlckVkaXRvckNvbXBvbmVudHMsXG4gIENvbXBvc2VyRWRpdG9yTGlua1Byb3BzLFxuICBDb21wb3NlckVkaXRvck1lbnRpb25Qcm9wcyxcbiAgQ29tcG9zZXJFZGl0b3JNZW50aW9uU3VnZ2VzdGlvbnNQcm9wcyxcbiAgQ29tcG9zZXJFZGl0b3JQcm9wcyxcbiAgQ29tcG9zZXJTdWJtaXRDb21tZW50LFxufSBmcm9tIFwiLi4vcHJpbWl0aXZlcy9Db21wb3Nlci90eXBlc1wiO1xuaW1wb3J0IHsgTUVOVElPTl9DSEFSQUNURVIgfSBmcm9tIFwiLi4vc2xhdGUvcGx1Z2lucy9tZW50aW9uc1wiO1xuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gXCIuLi91dGlscy9jbGFzcy1uYW1lc1wiO1xuaW1wb3J0IHsgdXNlQ29udHJvbGxhYmxlU3RhdGUgfSBmcm9tIFwiLi4vdXRpbHMvdXNlLWNvbnRyb2xsYWJsZS1zdGF0ZVwiO1xuaW1wb3J0IHsgQXR0cmlidXRpb24gfSBmcm9tIFwiLi9pbnRlcm5hbC9BdHRyaWJ1dGlvblwiO1xuaW1wb3J0IHsgQXZhdGFyIH0gZnJvbSBcIi4vaW50ZXJuYWwvQXZhdGFyXCI7XG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tIFwiLi9pbnRlcm5hbC9CdXR0b25cIjtcbmltcG9ydCB0eXBlIHsgRW1vamlQaWNrZXJQcm9wcyB9IGZyb20gXCIuL2ludGVybmFsL0Vtb2ppUGlja2VyXCI7XG5pbXBvcnQgeyBFbW9qaVBpY2tlciwgRW1vamlQaWNrZXJUcmlnZ2VyIH0gZnJvbSBcIi4vaW50ZXJuYWwvRW1vamlQaWNrZXJcIjtcbmltcG9ydCB7XG4gIFNob3J0Y3V0VG9vbHRpcCxcbiAgU2hvcnRjdXRUb29sdGlwS2V5LFxuICBUb29sdGlwLFxuICBUb29sdGlwUHJvdmlkZXIsXG59IGZyb20gXCIuL2ludGVybmFsL1Rvb2x0aXBcIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi9pbnRlcm5hbC9Vc2VyXCI7XG5cbmludGVyZmFjZSBFZGl0b3JBY3Rpb25Qcm9wcyBleHRlbmRzIENvbXBvbmVudFByb3BzV2l0aG91dFJlZjxcImJ1dHRvblwiPiB7XG4gIGxhYmVsOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBFbW9qaUVkaXRvckFjdGlvblByb3BzIGV4dGVuZHMgRWRpdG9yQWN0aW9uUHJvcHMge1xuICBvblBpY2tlck9wZW5DaGFuZ2U/OiBFbW9qaVBpY2tlclByb3BzW1wib25PcGVuQ2hhbmdlXCJdO1xufVxuXG50eXBlIENvbXBvc2VyQ3JlYXRlVGhyZWFkUHJvcHM8TSBleHRlbmRzIEJhc2VNZXRhZGF0YT4gPSB7XG4gIHRocmVhZElkPzogbmV2ZXI7XG4gIGNvbW1lbnRJZD86IG5ldmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgbWV0YWRhdGEgb2YgdGhlIHRocmVhZCB0byBjcmVhdGUuXG4gICAqL1xuICBtZXRhZGF0YT86IE07XG59O1xuXG50eXBlIENvbXBvc2VyQ3JlYXRlQ29tbWVudFByb3BzID0ge1xuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSB0aHJlYWQgdG8gcmVwbHkgdG8uXG4gICAqL1xuICB0aHJlYWRJZDogc3RyaW5nO1xuICBjb21tZW50SWQ/OiBuZXZlcjtcbiAgbWV0YWRhdGE/OiBuZXZlcjtcbn07XG5cbnR5cGUgQ29tcG9zZXJFZGl0Q29tbWVudFByb3BzID0ge1xuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSB0aHJlYWQgdG8gZWRpdCBhIGNvbW1lbnQgaW4uXG4gICAqL1xuICB0aHJlYWRJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGNvbW1lbnQgdG8gZWRpdC5cbiAgICovXG4gIGNvbW1lbnRJZDogc3RyaW5nO1xuICBtZXRhZGF0YT86IG5ldmVyO1xufTtcblxuZXhwb3J0IHR5cGUgQ29tcG9zZXJQcm9wczxNIGV4dGVuZHMgQmFzZU1ldGFkYXRhID0gRE0+ID0gT21pdDxcbiAgQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmPFwiZm9ybVwiPixcbiAgXCJkZWZhdWx0VmFsdWVcIlxuPiAmXG4gIChcbiAgICB8IENvbXBvc2VyQ3JlYXRlVGhyZWFkUHJvcHM8TT5cbiAgICB8IENvbXBvc2VyQ3JlYXRlQ29tbWVudFByb3BzXG4gICAgfCBDb21wb3NlckVkaXRDb21tZW50UHJvcHNcbiAgKSAmIHtcbiAgICAvKipcbiAgICAgKiBUaGUgZXZlbnQgaGFuZGxlciBjYWxsZWQgd2hlbiB0aGUgY29tcG9zZXIgaXMgc3VibWl0dGVkLlxuICAgICAqL1xuICAgIG9uQ29tcG9zZXJTdWJtaXQ/OiAoXG4gICAgICBjb21tZW50OiBDb21wb3NlclN1Ym1pdENvbW1lbnQsXG4gICAgICBldmVudDogRm9ybUV2ZW50PEhUTUxGb3JtRWxlbWVudD5cbiAgICApID0+IFByb21pc2U8dm9pZD4gfCB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbXBvc2VyJ3MgaW5pdGlhbCB2YWx1ZS5cbiAgICAgKi9cbiAgICBkZWZhdWx0VmFsdWU/OiBDb21wb3NlckVkaXRvclByb3BzW1wiZGVmYXVsdFZhbHVlXCJdO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgY29tcG9zZXIgaXMgY29sbGFwc2VkLiBTZXR0aW5nIGEgdmFsdWUgd2lsbCBtYWtlIHRoZSBjb21wb3NlciBjb250cm9sbGVkLlxuICAgICAqL1xuICAgIGNvbGxhcHNlZD86IGJvb2xlYW47XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZXZlbnQgaGFuZGxlciBjYWxsZWQgd2hlbiB0aGUgY29sbGFwc2VkIHN0YXRlIG9mIHRoZSBjb21wb3NlciBjaGFuZ2VzLlxuICAgICAqL1xuICAgIG9uQ29sbGFwc2VkQ2hhbmdlPzogKGNvbGxhcHNlZDogYm9vbGVhbikgPT4gdm9pZDtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIGNvbXBvc2VyIGlzIGluaXRpYWxseSBjb2xsYXBzZWQuIFNldHRpbmcgYSB2YWx1ZSB3aWxsIG1ha2UgdGhlIGNvbXBvc2VyIHVuY29udHJvbGxlZC5cbiAgICAgKi9cbiAgICBkZWZhdWx0Q29sbGFwc2VkPzogYm9vbGVhbjtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIGNvbXBvc2VyIGlzIGRpc2FibGVkLlxuICAgICAqL1xuICAgIGRpc2FibGVkPzogQ29tcG9zZXJFZGl0b3JQcm9wc1tcImRpc2FibGVkXCJdO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0byBmb2N1cyB0aGUgY29tcG9zZXIgb24gbW91bnQuXG4gICAgICovXG4gICAgYXV0b0ZvY3VzPzogQ29tcG9zZXJFZGl0b3JQcm9wc1tcImF1dG9Gb2N1c1wiXTtcblxuICAgIC8qKlxuICAgICAqIE92ZXJyaWRlIHRoZSBjb21wb25lbnQncyBzdHJpbmdzLlxuICAgICAqL1xuICAgIG92ZXJyaWRlcz86IFBhcnRpYWw8R2xvYmFsT3ZlcnJpZGVzICYgQ29tcG9zZXJPdmVycmlkZXM+O1xuXG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgYWN0aW9ucz86IFJlYWN0Tm9kZTtcblxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHNob3dBdHRyaWJ1dGlvbj86IGJvb2xlYW47XG4gIH07XG5cbmZ1bmN0aW9uIENvbXBvc2VySW5zZXJ0TWVudGlvbkVkaXRvckFjdGlvbih7XG4gIGxhYmVsLFxuICBjbGFzc05hbWUsXG4gIG9uQ2xpY2ssXG4gIC4uLnByb3BzXG59OiBFZGl0b3JBY3Rpb25Qcm9wcykge1xuICBjb25zdCB7IGNyZWF0ZU1lbnRpb24gfSA9IHVzZUNvbXBvc2VyKCk7XG5cbiAgY29uc3QgcHJldmVudERlZmF1bHQgPSB1c2VDYWxsYmFjaygoZXZlbnQ6IFN5bnRoZXRpY0V2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGhhbmRsZUNsaWNrID0gdXNlQ2FsbGJhY2soXG4gICAgKGV2ZW50OiBNb3VzZUV2ZW50PEhUTUxCdXR0b25FbGVtZW50PikgPT4ge1xuICAgICAgb25DbGljaz8uKGV2ZW50KTtcblxuICAgICAgaWYgKCFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY3JlYXRlTWVudGlvbigpO1xuICAgICAgfVxuICAgIH0sXG4gICAgW2NyZWF0ZU1lbnRpb24sIG9uQ2xpY2tdXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8VG9vbHRpcCBjb250ZW50PXtsYWJlbH0+XG4gICAgICA8QnV0dG9uXG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImxiLWNvbXBvc2VyLWVkaXRvci1hY3Rpb25cIiwgY2xhc3NOYW1lKX1cbiAgICAgICAgb25Nb3VzZURvd249e3ByZXZlbnREZWZhdWx0fVxuICAgICAgICBvbkNsaWNrPXtoYW5kbGVDbGlja31cbiAgICAgICAgYXJpYS1sYWJlbD17bGFiZWx9XG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgID5cbiAgICAgICAgPE1lbnRpb25JY29uIGNsYXNzTmFtZT1cImxiLWJ1dHRvbi1pY29uXCIgLz5cbiAgICAgIDwvQnV0dG9uPlxuICAgIDwvVG9vbHRpcD5cbiAgKTtcbn1cblxuZnVuY3Rpb24gQ29tcG9zZXJJbnNlcnRFbW9qaUVkaXRvckFjdGlvbih7XG4gIGxhYmVsLFxuICBvblBpY2tlck9wZW5DaGFuZ2UsXG4gIGNsYXNzTmFtZSxcbiAgLi4ucHJvcHNcbn06IEVtb2ppRWRpdG9yQWN0aW9uUHJvcHMpIHtcbiAgY29uc3QgeyBpbnNlcnRUZXh0IH0gPSB1c2VDb21wb3NlcigpO1xuXG4gIGNvbnN0IHByZXZlbnREZWZhdWx0ID0gdXNlQ2FsbGJhY2soKGV2ZW50OiBTeW50aGV0aWNFdmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gKFxuICAgIDxFbW9qaVBpY2tlciBvbkVtb2ppU2VsZWN0PXtpbnNlcnRUZXh0fSBvbk9wZW5DaGFuZ2U9e29uUGlja2VyT3BlbkNoYW5nZX0+XG4gICAgICA8VG9vbHRpcCBjb250ZW50PXtsYWJlbH0+XG4gICAgICAgIDxFbW9qaVBpY2tlclRyaWdnZXIgYXNDaGlsZD5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJsYi1jb21wb3Nlci1lZGl0b3ItYWN0aW9uXCIsIGNsYXNzTmFtZSl9XG4gICAgICAgICAgICBvbk1vdXNlRG93bj17cHJldmVudERlZmF1bHR9XG4gICAgICAgICAgICBhcmlhLWxhYmVsPXtsYWJlbH1cbiAgICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8RW1vamlJY29uIGNsYXNzTmFtZT1cImxiLWJ1dHRvbi1pY29uXCIgLz5cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC9FbW9qaVBpY2tlclRyaWdnZXI+XG4gICAgICA8L1Rvb2x0aXA+XG4gICAgPC9FbW9qaVBpY2tlcj5cbiAgKTtcbn1cblxuZnVuY3Rpb24gQ29tcG9zZXJNZW50aW9uKHsgdXNlcklkIH06IENvbXBvc2VyRWRpdG9yTWVudGlvblByb3BzKSB7XG4gIHJldHVybiAoXG4gICAgPENvbXBvc2VyUHJpbWl0aXZlLk1lbnRpb24gY2xhc3NOYW1lPVwibGItY29tcG9zZXItbWVudGlvblwiPlxuICAgICAge01FTlRJT05fQ0hBUkFDVEVSfVxuICAgICAgPFVzZXIgdXNlcklkPXt1c2VySWR9IC8+XG4gICAgPC9Db21wb3NlclByaW1pdGl2ZS5NZW50aW9uPlxuICApO1xufVxuXG5mdW5jdGlvbiBDb21wb3Nlck1lbnRpb25TdWdnZXN0aW9ucyh7XG4gIHVzZXJJZHMsXG59OiBDb21wb3NlckVkaXRvck1lbnRpb25TdWdnZXN0aW9uc1Byb3BzKSB7XG4gIHJldHVybiB1c2VySWRzLmxlbmd0aCA+IDAgPyAoXG4gICAgPENvbXBvc2VyUHJpbWl0aXZlLlN1Z2dlc3Rpb25zIGNsYXNzTmFtZT1cImxiLXJvb3QgbGItcG9ydGFsIGxiLWVsZXZhdGlvbiBsYi1jb21wb3Nlci1zdWdnZXN0aW9ucyBsYi1jb21wb3Nlci1tZW50aW9uLXN1Z2dlc3Rpb25zXCI+XG4gICAgICA8Q29tcG9zZXJQcmltaXRpdmUuU3VnZ2VzdGlvbnNMaXN0IGNsYXNzTmFtZT1cImxiLWNvbXBvc2VyLXN1Z2dlc3Rpb25zLWxpc3QgbGItY29tcG9zZXItbWVudGlvbi1zdWdnZXN0aW9ucy1saXN0XCI+XG4gICAgICAgIHt1c2VySWRzLm1hcCgodXNlcklkKSA9PiAoXG4gICAgICAgICAgPENvbXBvc2VyUHJpbWl0aXZlLlN1Z2dlc3Rpb25zTGlzdEl0ZW1cbiAgICAgICAgICAgIGtleT17dXNlcklkfVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItY29tcG9zZXItc3VnZ2VzdGlvbnMtbGlzdC1pdGVtIGxiLWNvbXBvc2VyLW1lbnRpb24tc3VnZ2VzdGlvblwiXG4gICAgICAgICAgICB2YWx1ZT17dXNlcklkfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxBdmF0YXJcbiAgICAgICAgICAgICAgdXNlcklkPXt1c2VySWR9XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxiLWNvbXBvc2VyLW1lbnRpb24tc3VnZ2VzdGlvbi1hdmF0YXJcIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxVc2VyXG4gICAgICAgICAgICAgIHVzZXJJZD17dXNlcklkfVxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYi1jb21wb3Nlci1tZW50aW9uLXN1Z2dlc3Rpb24tdXNlclwiXG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvQ29tcG9zZXJQcmltaXRpdmUuU3VnZ2VzdGlvbnNMaXN0SXRlbT5cbiAgICAgICAgKSl9XG4gICAgICA8L0NvbXBvc2VyUHJpbWl0aXZlLlN1Z2dlc3Rpb25zTGlzdD5cbiAgICA8L0NvbXBvc2VyUHJpbWl0aXZlLlN1Z2dlc3Rpb25zPlxuICApIDogbnVsbDtcbn1cblxuZnVuY3Rpb24gQ29tcG9zZXJMaW5rKHsgaHJlZiwgY2hpbGRyZW4gfTogQ29tcG9zZXJFZGl0b3JMaW5rUHJvcHMpIHtcbiAgcmV0dXJuIChcbiAgICA8Q29tcG9zZXJQcmltaXRpdmUuTGluayBocmVmPXtocmVmfSBjbGFzc05hbWU9XCJsYi1jb21wb3Nlci1saW5rXCI+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9Db21wb3NlclByaW1pdGl2ZS5MaW5rPlxuICApO1xufVxuXG5jb25zdCBlZGl0b3JDb21wb25lbnRzOiBDb21wb3NlckVkaXRvckNvbXBvbmVudHMgPSB7XG4gIE1lbnRpb246IENvbXBvc2VyTWVudGlvbixcbiAgTWVudGlvblN1Z2dlc3Rpb25zOiBDb21wb3Nlck1lbnRpb25TdWdnZXN0aW9ucyxcbiAgTGluazogQ29tcG9zZXJMaW5rLFxufTtcblxuY29uc3QgQ29tcG9zZXJXaXRoQ29udGV4dCA9IGZvcndhcmRSZWY8XG4gIEhUTUxGb3JtRWxlbWVudCxcbiAgT21pdDxDb21wb3NlclByb3BzLCBcInRocmVhZElkXCIgfCBcImNvbW1lbnRJZFwiIHwgXCJvbkNvbXBvc2VyU3VibWl0XCI+XG4+KFxuICAoXG4gICAge1xuICAgICAgZGVmYXVsdFZhbHVlLFxuICAgICAgZGlzYWJsZWQsXG4gICAgICBhdXRvRm9jdXMsXG4gICAgICBjb2xsYXBzZWQ6IGNvbnRyb2xsZWRDb2xsYXBzZWQsXG4gICAgICBkZWZhdWx0Q29sbGFwc2VkLFxuICAgICAgb25Db2xsYXBzZWRDaGFuZ2U6IGNvbnRyb2xsZWRPbkNvbGxhcHNlZENoYW5nZSxcbiAgICAgIGFjdGlvbnMsXG4gICAgICBvdmVycmlkZXMsXG4gICAgICBzaG93QXR0cmlidXRpb24sXG4gICAgICBvbkZvY3VzLFxuICAgICAgb25CbHVyLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgLi4ucHJvcHNcbiAgICB9LFxuICAgIGZvcndhcmRlZFJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGllbnQgPSB1c2VDbGllbnQoKTtcbiAgICBjb25zdCBoYXNSZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zID1cbiAgICAgIGNsaWVudFtrSW50ZXJuYWxdLnJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMgIT09IHVuZGVmaW5lZDtcbiAgICBjb25zdCBzZWxmID0gdXNlU2VsZigpO1xuICAgIGNvbnN0IGlzRGlzYWJsZWQgPSB1c2VNZW1vKFxuICAgICAgKCkgPT4gZGlzYWJsZWQgfHwgIXNlbGY/LmNhbkNvbW1lbnQsXG4gICAgICBbZGlzYWJsZWQsIHNlbGY/LmNhbkNvbW1lbnRdXG4gICAgKTtcbiAgICBjb25zdCB7IGlzRW1wdHkgfSA9IHVzZUNvbXBvc2VyKCk7XG4gICAgY29uc3QgJCA9IHVzZU92ZXJyaWRlcyhvdmVycmlkZXMpO1xuICAgIGNvbnN0IFtpc0Vtb2ppUGlja2VyT3Blbiwgc2V0RW1vamlQaWNrZXJPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbY29sbGFwc2VkLCBvbkNvbGxhcHNlZENoYW5nZV0gPSB1c2VDb250cm9sbGFibGVTdGF0ZShcbiAgICAgIC8vIElmIHRoZSBjb21wb3NlciBpcyBuZWl0aGVyIGNvbnRyb2xsZWQgbm9yIHVuY29udHJvbGxlZCwgaXQgZGVmYXVsdHMgdG8gY29udHJvbGxlZCBhcyB1bmNvbGxhcHNlZC5cbiAgICAgIGNvbnRyb2xsZWRDb2xsYXBzZWQgPT09IHVuZGVmaW5lZCAmJiBkZWZhdWx0Q29sbGFwc2VkID09PSB1bmRlZmluZWRcbiAgICAgICAgPyBmYWxzZVxuICAgICAgICA6IGNvbnRyb2xsZWRDb2xsYXBzZWQsXG4gICAgICBjb250cm9sbGVkT25Db2xsYXBzZWRDaGFuZ2UsXG4gICAgICBkZWZhdWx0Q29sbGFwc2VkXG4gICAgKTtcblxuICAgIGNvbnN0IHByZXZlbnREZWZhdWx0ID0gdXNlQ2FsbGJhY2soKGV2ZW50OiBTeW50aGV0aWNFdmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9LCBbXSk7XG5cbiAgICBjb25zdCBzdG9wUHJvcGFnYXRpb24gPSB1c2VDYWxsYmFjaygoZXZlbnQ6IFN5bnRoZXRpY0V2ZW50KSA9PiB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9LCBbXSk7XG5cbiAgICBjb25zdCBoYW5kbGVFZGl0b3JDbGljayA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGV2ZW50OiBNb3VzZUV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgICAgIG9uQ29sbGFwc2VkQ2hhbmdlPy4oZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW2lzRW1wdHksIG9uQ29sbGFwc2VkQ2hhbmdlXVxuICAgICk7XG5cbiAgICBjb25zdCBoYW5kbGVGb2N1cyA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGV2ZW50OiBGb2N1c0V2ZW50PEhUTUxGb3JtRWxlbWVudD4pID0+IHtcbiAgICAgICAgb25Gb2N1cz8uKGV2ZW50KTtcblxuICAgICAgICBpZiAoZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgICAgIG9uQ29sbGFwc2VkQ2hhbmdlPy4oZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW2lzRW1wdHksIG9uQ29sbGFwc2VkQ2hhbmdlLCBvbkZvY3VzXVxuICAgICk7XG5cbiAgICBjb25zdCBoYW5kbGVCbHVyID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZXZlbnQ6IEZvY3VzRXZlbnQ8SFRNTEZvcm1FbGVtZW50PikgPT4ge1xuICAgICAgICBvbkJsdXI/LihldmVudCk7XG5cbiAgICAgICAgaWYgKGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNPdXRzaWRlID0gIWV2ZW50LmN1cnJlbnRUYXJnZXQuY29udGFpbnMoZXZlbnQucmVsYXRlZFRhcmdldCk7XG5cbiAgICAgICAgaWYgKGlzT3V0c2lkZSAmJiBpc0VtcHR5ICYmICFpc0Vtb2ppUGlja2VyT3Blbikge1xuICAgICAgICAgIG9uQ29sbGFwc2VkQ2hhbmdlPy4odHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbaXNFbW9qaVBpY2tlck9wZW4sIGlzRW1wdHksIG9uQmx1ciwgb25Db2xsYXBzZWRDaGFuZ2VdXG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Zm9ybVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgXCJsYi1yb290IGxiLWNvbXBvc2VyIGxiLWNvbXBvc2VyLWZvcm1cIixcbiAgICAgICAgICBjbGFzc05hbWVcbiAgICAgICAgKX1cbiAgICAgICAgZGlyPXskLmRpcn1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgICAgZGF0YS1jb2xsYXBzZWQ9e2NvbGxhcHNlZCA/IFwiXCIgOiB1bmRlZmluZWR9XG4gICAgICAgIG9uRm9jdXM9e2hhbmRsZUZvY3VzfVxuICAgICAgICBvbkJsdXI9e2hhbmRsZUJsdXJ9XG4gICAgICA+XG4gICAgICAgIDxDb21wb3NlclByaW1pdGl2ZS5FZGl0b3JcbiAgICAgICAgICBjbGFzc05hbWU9XCJsYi1jb21wb3Nlci1lZGl0b3JcIlxuICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUVkaXRvckNsaWNrfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPXskLkNPTVBPU0VSX1BMQUNFSE9MREVSfVxuICAgICAgICAgIGRlZmF1bHRWYWx1ZT17ZGVmYXVsdFZhbHVlfVxuICAgICAgICAgIGRpc2FibGVkPXtpc0Rpc2FibGVkfVxuICAgICAgICAgIGF1dG9Gb2N1cz17YXV0b0ZvY3VzfVxuICAgICAgICAgIGNvbXBvbmVudHM9e2VkaXRvckNvbXBvbmVudHN9XG4gICAgICAgICAgZGlyPXskLmRpcn1cbiAgICAgICAgLz5cbiAgICAgICAgeyFjb2xsYXBzZWQgJiYgKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGItY29tcG9zZXItZm9vdGVyXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLWNvbXBvc2VyLWVkaXRvci1hY3Rpb25zXCI+XG4gICAgICAgICAgICAgIHtoYXNSZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zICYmIChcbiAgICAgICAgICAgICAgICA8Q29tcG9zZXJJbnNlcnRNZW50aW9uRWRpdG9yQWN0aW9uXG4gICAgICAgICAgICAgICAgICBsYWJlbD17JC5DT01QT1NFUl9JTlNFUlRfTUVOVElPTn1cbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0Rpc2FibGVkfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDxDb21wb3Nlckluc2VydEVtb2ppRWRpdG9yQWN0aW9uXG4gICAgICAgICAgICAgICAgbGFiZWw9eyQuQ09NUE9TRVJfSU5TRVJUX0VNT0pJfVxuICAgICAgICAgICAgICAgIG9uUGlja2VyT3BlbkNoYW5nZT17c2V0RW1vamlQaWNrZXJPcGVufVxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0Rpc2FibGVkfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICB7c2hvd0F0dHJpYnV0aW9uICYmIDxBdHRyaWJ1dGlvbiAvPn1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGItY29tcG9zZXItYWN0aW9uc1wiPlxuICAgICAgICAgICAgICB7YWN0aW9ucyA/PyAoXG4gICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgIDxTaG9ydGN1dFRvb2x0aXBcbiAgICAgICAgICAgICAgICAgICAgY29udGVudD17JC5DT01QT1NFUl9TRU5EfVxuICAgICAgICAgICAgICAgICAgICBzaG9ydGN1dD17PFNob3J0Y3V0VG9vbHRpcEtleSBuYW1lPVwiZW50ZXJcIiAvPn1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPENvbXBvc2VyUHJpbWl0aXZlLlN1Ym1pdCBkaXNhYmxlZD17aXNEaXNhYmxlZH0gYXNDaGlsZD5cbiAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlRG93bj17cHJldmVudERlZmF1bHR9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtzdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYi1jb21wb3Nlci1hY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudD1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17JC5DT01QT1NFUl9TRU5EfVxuICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxTZW5kSWNvbiAvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L0NvbXBvc2VyUHJpbWl0aXZlLlN1Ym1pdD5cbiAgICAgICAgICAgICAgICAgIDwvU2hvcnRjdXRUb29sdGlwPlxuICAgICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICl9XG4gICAgICA8L2Zvcm0+XG4gICAgKTtcbiAgfVxuKTtcblxuLyoqXG4gKiBEaXNwbGF5cyBhIGNvbXBvc2VyIHRvIGNyZWF0ZSBjb21tZW50cy5cbiAqXG4gKiBAZXhhbXBsZVxuICogPENvbXBvc2VyIC8+XG4gKi9cbmV4cG9ydCBjb25zdCBDb21wb3NlciA9IGZvcndhcmRSZWYoXG4gIDxNIGV4dGVuZHMgQmFzZU1ldGFkYXRhID0gRE0+KFxuICAgIHtcbiAgICAgIHRocmVhZElkLFxuICAgICAgY29tbWVudElkLFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBvbkNvbXBvc2VyU3VibWl0LFxuICAgICAgb25Gb2N1cyxcbiAgICAgIC4uLnByb3BzXG4gICAgfTogQ29tcG9zZXJQcm9wczxNPixcbiAgICBmb3J3YXJkZWRSZWY6IEZvcndhcmRlZFJlZjxIVE1MRm9ybUVsZW1lbnQ+XG4gICkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZVRocmVhZCA9IHVzZUNyZWF0ZVRocmVhZCgpO1xuICAgIGNvbnN0IGNyZWF0ZUNvbW1lbnQgPSB1c2VDcmVhdGVDb21tZW50KCk7XG4gICAgY29uc3QgZWRpdENvbW1lbnQgPSB1c2VFZGl0Q29tbWVudCgpO1xuXG4gICAgY29uc3QgaGFuZGxlQ29tbWVudFN1Ym1pdCA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGNvbW1lbnQ6IENvbXBvc2VyU3VibWl0Q29tbWVudCwgZXZlbnQ6IEZvcm1FdmVudDxIVE1MRm9ybUVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIG9uQ29tcG9zZXJTdWJtaXQ/Lihjb21tZW50LCBldmVudCk7XG5cbiAgICAgICAgaWYgKGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbW1lbnRJZCAmJiB0aHJlYWRJZCkge1xuICAgICAgICAgIGVkaXRDb21tZW50KHtcbiAgICAgICAgICAgIGNvbW1lbnRJZCxcbiAgICAgICAgICAgIHRocmVhZElkLFxuICAgICAgICAgICAgYm9keTogY29tbWVudC5ib2R5LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHRocmVhZElkKSB7XG4gICAgICAgICAgY3JlYXRlQ29tbWVudCh7XG4gICAgICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgICAgIGJvZHk6IGNvbW1lbnQuYm9keSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjcmVhdGVUaHJlYWQoe1xuICAgICAgICAgICAgYm9keTogY29tbWVudC5ib2R5LFxuICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhID8/IHt9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW1xuICAgICAgICBjb21tZW50SWQsXG4gICAgICAgIGNyZWF0ZUNvbW1lbnQsXG4gICAgICAgIGNyZWF0ZVRocmVhZCxcbiAgICAgICAgZWRpdENvbW1lbnQsXG4gICAgICAgIG1ldGFkYXRhLFxuICAgICAgICBvbkNvbXBvc2VyU3VibWl0LFxuICAgICAgICB0aHJlYWRJZCxcbiAgICAgIF1cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxUb29sdGlwUHJvdmlkZXI+XG4gICAgICAgIDxDb21wb3NlclByaW1pdGl2ZS5Gb3JtXG4gICAgICAgICAgb25Db21wb3NlclN1Ym1pdD17aGFuZGxlQ29tbWVudFN1Ym1pdH1cbiAgICAgICAgICBvbkZvY3VzPXtvbkZvY3VzfVxuICAgICAgICAgIGFzQ2hpbGRcbiAgICAgICAgPlxuICAgICAgICAgIDxDb21wb3NlcldpdGhDb250ZXh0IHsuLi5wcm9wc30gcmVmPXtmb3J3YXJkZWRSZWZ9IC8+XG4gICAgICAgIDwvQ29tcG9zZXJQcmltaXRpdmUuRm9ybT5cbiAgICAgIDwvVG9vbHRpcFByb3ZpZGVyPlxuICAgICk7XG4gIH1cbikgYXMgPE0gZXh0ZW5kcyBCYXNlTWV0YWRhdGEgPSBETT4oXG4gIHByb3BzOiBDb21wb3NlclByb3BzPE0+ICYgUmVmQXR0cmlidXRlczxIVE1MRm9ybUVsZW1lbnQ+XG4pID0+IEpTWC5FbGVtZW50O1xuIl0sIm5hbWVzIjpbIkNvbXBvc2VySW5zZXJ0TWVudGlvbkVkaXRvckFjdGlvbiIsImxhYmVsIiwiY2xhc3NOYW1lIiwib25DbGljayIsInByb3BzIiwiY3JlYXRlTWVudGlvbiIsInVzZUNvbXBvc2VyIiwicHJldmVudERlZmF1bHQiLCJ1c2VDYWxsYmFjayIsImV2ZW50IiwiaGFuZGxlQ2xpY2siLCJpc0RlZmF1bHRQcmV2ZW50ZWQiLCJzdG9wUHJvcGFnYXRpb24iLCJSZWFjdF9fZGVmYXVsdCIsImNyZWF0ZUVsZW1lbnQiLCJUb29sdGlwIiwiY29udGVudCIsIkJ1dHRvbiIsImNsYXNzTmFtZXMiLCJvbk1vdXNlRG93biIsIk1lbnRpb25JY29uIiwiQ29tcG9zZXJJbnNlcnRFbW9qaUVkaXRvckFjdGlvbiIsIm9uUGlja2VyT3BlbkNoYW5nZSIsImluc2VydFRleHQiLCJFbW9qaVBpY2tlciIsIm9uRW1vamlTZWxlY3QiLCJvbk9wZW5DaGFuZ2UiLCJQb3BvdmVyVHJpZ2dlciIsImFzQ2hpbGQiLCJFbW9qaUljb24iLCJDb21wb3Nlck1lbnRpb24iLCJ1c2VySWQiLCJDb21wb3Nlck1lbnRpb24kMSIsIk1FTlRJT05fQ0hBUkFDVEVSIiwiVXNlciIsIkNvbXBvc2VyTWVudGlvblN1Z2dlc3Rpb25zIiwidXNlcklkcyIsImxlbmd0aCIsIkNvbXBvc2VyU3VnZ2VzdGlvbnMiLCJDb21wb3NlclN1Z2dlc3Rpb25zTGlzdCIsIm1hcCIsIkNvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0SXRlbSIsImtleSIsInZhbHVlIiwiQXZhdGFyIiwiQ29tcG9zZXJMaW5rIiwiaHJlZiIsImNoaWxkcmVuIiwiQ29tcG9zZXJMaW5rJDEiLCJlZGl0b3JDb21wb25lbnRzIiwiTWVudGlvbiIsIk1lbnRpb25TdWdnZXN0aW9ucyIsIkxpbmsiLCJDb21wb3NlcldpdGhDb250ZXh0IiwiZm9yd2FyZFJlZiIsImRlZmF1bHRWYWx1ZSIsImRpc2FibGVkIiwiYXV0b0ZvY3VzIiwiY29sbGFwc2VkIiwiY29udHJvbGxlZENvbGxhcHNlZCIsImRlZmF1bHRDb2xsYXBzZWQiLCJvbkNvbGxhcHNlZENoYW5nZSIsImNvbnRyb2xsZWRPbkNvbGxhcHNlZENoYW5nZSIsImFjdGlvbnMiLCJvdmVycmlkZXMiLCJzaG93QXR0cmlidXRpb24iLCJvbkZvY3VzIiwib25CbHVyIiwiZm9yd2FyZGVkUmVmIiwiY2xpZW50IiwidXNlQ2xpZW50IiwiaGFzUmVzb2x2ZU1lbnRpb25TdWdnZXN0aW9ucyIsImtJbnRlcm5hbCIsInJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMiLCJzZWxmIiwidXNlU2VsZiIsImlzRGlzYWJsZWQiLCJ1c2VNZW1vIiwiY2FuQ29tbWVudCIsImlzRW1wdHkiLCIkIiwidXNlT3ZlcnJpZGVzIiwiaXNFbW9qaVBpY2tlck9wZW4iLCJzZXRFbW9qaVBpY2tlck9wZW4iLCJ1c2VTdGF0ZSIsInVzZUNvbnRyb2xsYWJsZVN0YXRlIiwiaGFuZGxlRWRpdG9yQ2xpY2siLCJoYW5kbGVGb2N1cyIsImhhbmRsZUJsdXIiLCJpc091dHNpZGUiLCJjdXJyZW50VGFyZ2V0IiwiY29udGFpbnMiLCJyZWxhdGVkVGFyZ2V0IiwiZGlyIiwicmVmIiwiQ29tcG9zZXJFZGl0b3IiLCJwbGFjZWhvbGRlciIsIkNPTVBPU0VSX1BMQUNFSE9MREVSIiwiY29tcG9uZW50cyIsIkNPTVBPU0VSX0lOU0VSVF9NRU5USU9OIiwiQ09NUE9TRVJfSU5TRVJUX0VNT0pJIiwiQXR0cmlidXRpb24iLCJGcmFnbWVudCIsIlNob3J0Y3V0VG9vbHRpcCIsIkNPTVBPU0VSX1NFTkQiLCJzaG9ydGN1dCIsIlNob3J0Y3V0VG9vbHRpcEtleSIsIm5hbWUiLCJDb21wb3NlclN1Ym1pdCIsInZhcmlhbnQiLCJTZW5kSWNvbiIsIkNvbXBvc2VyIiwidGhyZWFkSWQiLCJjb21tZW50SWQiLCJtZXRhZGF0YSIsIm9uQ29tcG9zZXJTdWJtaXQiLCJjcmVhdGVUaHJlYWQiLCJ1c2VDcmVhdGVUaHJlYWQiLCJjcmVhdGVDb21tZW50IiwidXNlQ3JlYXRlQ29tbWVudCIsImVkaXRDb21tZW50IiwidXNlRWRpdENvbW1lbnQiLCJoYW5kbGVDb21tZW50U3VibWl0IiwiY29tbWVudCIsImJvZHkiLCJUb29sdGlwUHJvdmlkZXIiLCJDb21wb3NlckZvcm0iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Composer.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/InboxNotification.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/InboxNotification.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   InboxNotification: () => (/* binding */ InboxNotification)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var _radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @radix-ui/react-tooltip */ \"(ssr)/./node_modules/@radix-ui/react-tooltip/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../components.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components.mjs\");\n/* harmony import */ var _icons_Check_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../icons/Check.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Check.mjs\");\n/* harmony import */ var _icons_Delete_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../icons/Delete.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Delete.mjs\");\n/* harmony import */ var _icons_Ellipsis_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../icons/Ellipsis.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Ellipsis.mjs\");\n/* harmony import */ var _icons_Missing_mjs__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../icons/Missing.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Missing.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _primitives_Timestamp_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../primitives/Timestamp.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Timestamp.mjs\");\n/* harmony import */ var _shared_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../shared.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_url_mjs__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../utils/url.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/url.mjs\");\n/* harmony import */ var _internal_Avatar_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./internal/Avatar.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Avatar.mjs\");\n/* harmony import */ var _internal_Button_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./internal/Button.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs\");\n/* harmony import */ var _internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./internal/Dropdown.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Dropdown.mjs\");\n/* harmony import */ var _internal_InboxNotificationThread_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./internal/InboxNotificationThread.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/InboxNotificationThread.mjs\");\n/* harmony import */ var _internal_List_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./internal/List.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/List.mjs\");\n/* harmony import */ var _internal_Room_mjs__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./internal/Room.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Room.mjs\");\n/* harmony import */ var _internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./internal/Tooltip.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs\");\n/* harmony import */ var _internal_User_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./internal/User.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs\");\n/* harmony import */ var _radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @radix-ui/react-dropdown-menu */ \"(ssr)/./node_modules/@radix-ui/react-dropdown-menu/dist/index.mjs\");\n/* __next_internal_client_entry_do_not_use__ InboxNotification auto */ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst InboxNotificationLayout = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ inboxNotification, children, aside, title, date, unread, markAsReadOnClick, onClick, href, showActions, overrides, components, className, asChild, ...props }, forwardedRef)=>{\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_1__.useOverrides)(overrides);\n    const { Anchor } = (0,_components_mjs__WEBPACK_IMPORTED_MODULE_2__.useComponents)(components);\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_3__.Slot : Anchor;\n    const [isMoreActionOpen, setMoreActionOpen] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const markInboxNotificationAsRead = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_4__.useMarkInboxNotificationAsRead)();\n    const deleteInboxNotification = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_4__.useDeleteInboxNotification)();\n    const handleClick = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onClick?.(event);\n        const shouldMarkAsReadOnClick = markAsReadOnClick ?? Boolean(href);\n        if (unread && shouldMarkAsReadOnClick) {\n            markInboxNotificationAsRead(inboxNotification.id);\n        }\n    }, [\n        href,\n        inboxNotification.id,\n        markAsReadOnClick,\n        markInboxNotificationAsRead,\n        onClick,\n        unread\n    ]);\n    const stopPropagation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.stopPropagation();\n    }, []);\n    const preventDefaultAndStopPropagation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.preventDefault();\n        event.stopPropagation();\n    }, []);\n    const handleMoreClick = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.preventDefault();\n        event.stopPropagation();\n        setMoreActionOpen((open)=>!open);\n    }, []);\n    const handleMarkAsRead = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        markInboxNotificationAsRead(inboxNotification.id);\n    }, [\n        inboxNotification.id,\n        markInboxNotificationAsRead\n    ]);\n    const handleDelete = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        deleteInboxNotification(inboxNotification.id);\n    }, [\n        inboxNotification.id,\n        deleteInboxNotification\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_5__.TooltipProvider, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_6__.classNames)(\"lb-root lb-inbox-notification\", showActions === \"hover\" && \"lb-inbox-notification:show-actions-hover\", isMoreActionOpen && \"lb-inbox-notification:action-open\", className),\n        dir: $.dir,\n        \"data-unread\": unread ? \"\" : void 0,\n        \"data-kind\": inboxNotification.kind,\n        onClick: handleClick,\n        href,\n        ...props,\n        ref: forwardedRef\n    }, aside && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-inbox-notification-aside\"\n    }, aside), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-inbox-notification-content\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-inbox-notification-header\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-inbox-notification-title\"\n    }, title), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-inbox-notification-details\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-inbox-notification-details-labels\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Timestamp_mjs__WEBPACK_IMPORTED_MODULE_7__.Timestamp, {\n        locale: $.locale,\n        date,\n        className: \"lb-inbox-notification-date\"\n    }), unread && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-inbox-notification-unread-indicator\",\n        role: \"presentation\"\n    }))), showActions && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-inbox-notification-actions\"\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_8__.Dropdown, {\n        open: isMoreActionOpen,\n        onOpenChange: setMoreActionOpen,\n        align: \"end\",\n        content: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, unread ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_8__.DropdownItem, {\n            onSelect: handleMarkAsRead,\n            onClick: stopPropagation\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Check_mjs__WEBPACK_IMPORTED_MODULE_9__.CheckIcon, {\n            className: \"lb-dropdown-item-icon\"\n        }), $.INBOX_NOTIFICATION_MARK_AS_READ) : null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Dropdown_mjs__WEBPACK_IMPORTED_MODULE_8__.DropdownItem, {\n            onSelect: handleDelete,\n            onClick: stopPropagation\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Delete_mjs__WEBPACK_IMPORTED_MODULE_10__.DeleteIcon, {\n            className: \"lb-dropdown-item-icon\"\n        }), $.INBOX_NOTIFICATION_DELETE))\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_11__.Tooltip, {\n        content: $.INBOX_NOTIFICATION_MORE\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_12__.DropdownMenuTrigger, {\n        asChild: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_13__.Button, {\n        className: \"lb-inbox-notification-action\",\n        onClick: handleMoreClick,\n        onPointerDown: preventDefaultAndStopPropagation,\n        onPointerUp: preventDefaultAndStopPropagation,\n        \"aria-label\": $.INBOX_NOTIFICATION_MORE\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Ellipsis_mjs__WEBPACK_IMPORTED_MODULE_14__.EllipsisIcon, {\n        className: \"lb-button-icon\"\n    }))))))), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-inbox-notification-body\"\n    }, children))));\n});\nfunction InboxNotificationIcon({ className, ...props }) {\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_6__.classNames)(\"lb-inbox-notification-icon\", className),\n        ...props\n    });\n}\nfunction InboxNotificationAvatar({ className, ...props }) {\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Avatar_mjs__WEBPACK_IMPORTED_MODULE_15__.Avatar, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_6__.classNames)(\"lb-inbox-notification-avatar\", className),\n        ...props\n    });\n}\nconst InboxNotificationThread = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ inboxNotification, href, showRoomName = true, showActions = \"hover\", overrides, ...props }, forwardedRef)=>{\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_1__.useOverrides)(overrides);\n    const thread = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_4__._useInboxNotificationThread)(inboxNotification.id);\n    const currentUserId = (0,_shared_mjs__WEBPACK_IMPORTED_MODULE_16__.useCurrentUserId)();\n    const { info } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_4__.useRoomInfo)(inboxNotification.roomId);\n    const { unread, date, aside, title, content, commentId } = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        const contents = (0,_internal_InboxNotificationThread_mjs__WEBPACK_IMPORTED_MODULE_17__.generateInboxNotificationThreadContents)(inboxNotification, thread, currentUserId ?? \"\");\n        switch(contents.type){\n            case \"comments\":\n                {\n                    const reversedUserIds = [\n                        ...contents.userIds\n                    ].reverse();\n                    const firstUserId = reversedUserIds[0];\n                    const aside2 = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationAvatar, {\n                        userId: firstUserId\n                    });\n                    const title2 = $.INBOX_NOTIFICATION_THREAD_COMMENTS_LIST(/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_List_mjs__WEBPACK_IMPORTED_MODULE_18__.List, {\n                        values: reversedUserIds.map((userId, index)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_19__.User, {\n                                key: userId,\n                                userId,\n                                capitalize: index === 0,\n                                replaceSelf: true\n                            })),\n                        formatRemaining: $.LIST_REMAINING_USERS,\n                        truncate: _internal_InboxNotificationThread_mjs__WEBPACK_IMPORTED_MODULE_17__.INBOX_NOTIFICATION_THREAD_MAX_COMMENTS - 1\n                    }), showRoomName ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Room_mjs__WEBPACK_IMPORTED_MODULE_20__.Room, {\n                        roomId: thread.roomId\n                    }) : void 0, reversedUserIds.length);\n                    const content2 = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n                        className: \"lb-inbox-notification-comments\"\n                    }, contents.comments.map((comment)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_InboxNotificationThread_mjs__WEBPACK_IMPORTED_MODULE_17__.InboxNotificationComment, {\n                            key: comment.id,\n                            comment,\n                            showHeader: contents.comments.length > 1,\n                            overrides\n                        })));\n                    return {\n                        unread: contents.unread,\n                        date: contents.date,\n                        aside: aside2,\n                        title: title2,\n                        content: content2,\n                        threadId: thread.id,\n                        commentId: contents.comments[contents.comments.length - 1].id\n                    };\n                }\n            case \"mention\":\n                {\n                    const mentionUserId = contents.userIds[0];\n                    const mentionComment = contents.comments[0];\n                    const aside2 = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationAvatar, {\n                        userId: mentionUserId\n                    });\n                    const title2 = $.INBOX_NOTIFICATION_THREAD_MENTION(/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_19__.User, {\n                        key: mentionUserId,\n                        userId: mentionUserId,\n                        capitalize: true\n                    }), showRoomName ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Room_mjs__WEBPACK_IMPORTED_MODULE_20__.Room, {\n                        roomId: thread.roomId\n                    }) : void 0);\n                    const content2 = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n                        className: \"lb-inbox-notification-comments\"\n                    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_InboxNotificationThread_mjs__WEBPACK_IMPORTED_MODULE_17__.InboxNotificationComment, {\n                        key: mentionComment.id,\n                        comment: mentionComment,\n                        showHeader: false\n                    }));\n                    return {\n                        unread: contents.unread,\n                        date: contents.date,\n                        aside: aside2,\n                        title: title2,\n                        content: content2,\n                        threadId: thread.id,\n                        commentId: mentionComment.id\n                    };\n                }\n            default:\n                return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_21__.assertNever)(contents, \"Unexpected thread inbox notification type\");\n        }\n    }, [\n        $,\n        currentUserId,\n        inboxNotification,\n        overrides,\n        showRoomName,\n        thread\n    ]);\n    const resolvedHref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        const resolvedHref2 = href ?? info?.url;\n        return resolvedHref2 ? (0,_utils_url_mjs__WEBPACK_IMPORTED_MODULE_22__.generateURL)(resolvedHref2, void 0, commentId) : void 0;\n    }, [\n        commentId,\n        href,\n        info?.url\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationLayout, {\n        inboxNotification,\n        aside,\n        title,\n        date,\n        unread,\n        overrides,\n        href: resolvedHref,\n        showActions,\n        markAsReadOnClick: false,\n        ...props,\n        ref: forwardedRef\n    }, content);\n});\nconst InboxNotificationTextMention = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ inboxNotification, showActions = \"hover\", showRoomName = true, overrides, ...props }, ref)=>{\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_1__.useOverrides)(overrides);\n    const unread = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return !inboxNotification.readAt || inboxNotification.notifiedAt > inboxNotification.readAt;\n    }, [\n        inboxNotification.notifiedAt,\n        inboxNotification.readAt\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationLayout, {\n        inboxNotification,\n        aside: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationAvatar, {\n            userId: inboxNotification.createdBy\n        }),\n        title: $.INBOX_NOTIFICATION_TEXT_MENTION(/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_User_mjs__WEBPACK_IMPORTED_MODULE_19__.User, {\n            key: inboxNotification.createdBy,\n            userId: inboxNotification.createdBy,\n            capitalize: true\n        }), showRoomName ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Room_mjs__WEBPACK_IMPORTED_MODULE_20__.Room, {\n            roomId: inboxNotification.roomId\n        }) : void 0),\n        date: inboxNotification.notifiedAt,\n        unread,\n        overrides,\n        showActions,\n        ...props,\n        ref\n    });\n});\nconst InboxNotificationCustom = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ inboxNotification, showActions = \"hover\", title, aside, children, overrides, ...props }, forwardedRef)=>{\n    const unread = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return !inboxNotification.readAt || inboxNotification.notifiedAt > inboxNotification.readAt;\n    }, [\n        inboxNotification.notifiedAt,\n        inboxNotification.readAt\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationLayout, {\n        inboxNotification,\n        aside,\n        title,\n        date: inboxNotification.notifiedAt,\n        unread,\n        overrides,\n        showActions,\n        ...props,\n        ref: forwardedRef\n    }, children);\n});\nconst InboxNotificationCustomMissing = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ inboxNotification, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationCustom, {\n        inboxNotification,\n        ...props,\n        title: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, \"Custom notification kind \", /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"code\", null, inboxNotification.kind), \" is not handled\"),\n        aside: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationIcon, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Missing_mjs__WEBPACK_IMPORTED_MODULE_23__.MissingIcon, null)),\n        ref: forwardedRef,\n        \"data-missing\": \"\"\n    }, \"Notifications of this kind wont be displayed in production. Use the\", \" \", /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"code\", null, \"kinds\"), \" prop to define how they should be rendered.\");\n});\nconst inboxNotificationKindsWarnings = /* @__PURE__ */ new Set();\nconst InboxNotification = Object.assign(/*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ inboxNotification, kinds, ...props }, forwardedRef)=>{\n    switch(inboxNotification.kind){\n        case \"thread\":\n            {\n                const ResolvedInboxNotificationThread = kinds?.thread ?? InboxNotificationThread;\n                return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ResolvedInboxNotificationThread, {\n                    inboxNotification,\n                    ...props,\n                    ref: forwardedRef\n                });\n            }\n        case \"textMention\":\n            {\n                const ResolvedInboxNotificationTextMention = kinds?.textMention ?? InboxNotificationTextMention;\n                return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ResolvedInboxNotificationTextMention, {\n                    inboxNotification,\n                    ...props,\n                    ref: forwardedRef\n                });\n            }\n        default:\n            {\n                const ResolvedInboxNotificationCustom = kinds?.[inboxNotification.kind];\n                if (!ResolvedInboxNotificationCustom) {\n                    if (true) {\n                        if (!inboxNotificationKindsWarnings.has(inboxNotification.kind)) {\n                            inboxNotificationKindsWarnings.add(inboxNotification.kind);\n                            _liveblocks_core__WEBPACK_IMPORTED_MODULE_21__.console.warn(`Custom notification kind \"${inboxNotification.kind}\" is not handled so notifications of this kind will not be displayed in production. Use the kinds prop to define how they should be rendered.`);\n                        }\n                        return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(InboxNotificationCustomMissing, {\n                            inboxNotification,\n                            ...props,\n                            ref: forwardedRef\n                        });\n                    } else {}\n                }\n                return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ResolvedInboxNotificationCustom, {\n                    inboxNotification,\n                    ...props,\n                    ref: forwardedRef\n                });\n            }\n    }\n}), {\n    Thread: InboxNotificationThread,\n    TextMention: InboxNotificationTextMention,\n    Custom: InboxNotificationCustom,\n    Icon: InboxNotificationIcon,\n    Avatar: InboxNotificationAvatar\n});\n //# sourceMappingURL=InboxNotification.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL0luYm94Tm90aWZpY2F0aW9uLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNk1BLE1BQUFBLHdDQUFBQyxpREFBQUEsQ0FBZ0MsR0FLNUJDLGlCQUFBLEVBQ0VDLFFBQUEsRUFDQUMsS0FBQSxFQUNBQyxLQUFBLEVBQ0FDLElBQUEsRUFDQUMsTUFBQSxFQUNBQyxpQkFBQSxFQUNBQyxPQUFBLEVBQ0FDLElBQUEsRUFDQUMsV0FBQSxFQUNBQyxTQUFBLEVBQ0FDLFVBQUEsRUFDQUMsU0FBQSxFQUNBQyxPQUFBLEVBQ0EsR0FBQUMsT0FDRyxFQUFBQztJQUlMLE1BQUFDLElBQUFDLDREQUFBQSxDQUFBUDtJQUNBLFFBQUFRLE1BQUEsS0FBQUMsOERBQUFBLENBQUFSO0lBQ0EsTUFBQVMsWUFBQVAsVUFBQVEsc0RBQUFBLEdBQUFIO0lBQ0EsT0FBQUksa0JBQUFDLGtCQUFBLEdBQUFDLCtDQUFBQSxDQUFBO0lBQ0EsTUFBQUMsOEJBQUFDLGlGQUFBQTtJQUNBLE1BQUFDLDBCQUFBQyw2RUFBQUE7SUFFQSxNQUFBQyxjQUFBQyxrREFBQUEsQ0FBb0IsQ0FBQUM7UUFFaEJ4QixVQUFBd0I7UUFFQSxNQUFBQywwQkFBQTFCLHFCQUFBMkIsUUFBQXpCO1FBRUEsSUFBQUgsVUFBQTJCLHlCQUFBO1lBQ0VQLDRCQUFBekIsa0JBQUFrQyxFQUFBO1FBQWdEO0lBQ2xELEdBQ0Y7UUFDQTFCO1FBQ0VSLGtCQUFBa0MsRUFBQTtRQUNrQjVCO1FBQ2xCbUI7UUFDQWxCO1FBQ0FGO0tBQ0E7SUFJSixNQUFBOEIsa0JBQUFMLGtEQUFBQSxDQUFBLENBQUFDO1FBQ0VBLE1BQUFJLGVBQUE7SUFBc0I7SUFHeEIsTUFBQUMsbUNBQUFOLGtEQUFBQSxDQUF5QyxDQUFBQztRQUVyQ0EsTUFBQU0sY0FBQTtR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QUE5SSxrQkFBQStDLElBQUE7NEJBQ0VvRiwrQkFBQVksR0FBQSxDQUFBL0ksa0JBQUErQyxJQUFBOzRCQUVBaUcsc0RBQU9BLENBQVBDLElBQUEsQ0FBUSw2QkFBQWpKLGtCQUFBK0MsSUFBQTt3QkFFUjt3QkFHRixxQ0FBQUwsZ0RBQUEsQ0FBQXVGLGdDQUFBOzRCQUNHakk7NEJBQ0MsR0FBQWMsS0FBQTs0QkFDSWtDLEtBQUFqQzt3QkFDQztvQkFDUCxTQUlLO2dCQUNUO2dCQUdGLHFDQUFBMkIsZ0RBQUEsQ0FBQWtHLGlDQUFBO29CQUNHNUk7b0JBQ0MsR0FBQWMsS0FBQTtvQkFDSWtDLEtBQUFqQztnQkFDQztZQUNQO0lBRUo7QUFDRixJQUVKO0lBQ0FtSSxRQUFBekU7SUFDVTBFLGFBQUF4QjtJQUNLeUIsUUFBQXBCO0lBQ0xxQixNQUFBL0U7SUFDRkUsUUFBQUQ7QUFDRSIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uL3NyYy9jb21wb25lbnRzL0luYm94Tm90aWZpY2F0aW9uLnRzeD84YzliIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgdHlwZSB7XG4gIEluYm94Tm90aWZpY2F0aW9uQ3VzdG9tRGF0YSxcbiAgSW5ib3hOb3RpZmljYXRpb25EYXRhLFxuICBJbmJveE5vdGlmaWNhdGlvblRleHRNZW50aW9uRGF0YSxcbiAgSW5ib3hOb3RpZmljYXRpb25UaHJlYWREYXRhLFxuICBLREFELFxufSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuaW1wb3J0IHsgYXNzZXJ0TmV2ZXIsIGNvbnNvbGUgfSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuaW1wb3J0IHtcbiAgdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb24sXG4gIHVzZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkLFxuICB1c2VNYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQsXG4gIHVzZVJvb21JbmZvLFxufSBmcm9tIFwiQGxpdmVibG9ja3MvcmVhY3RcIjtcbmltcG9ydCB7IFNsb3QgfSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LXNsb3RcIjtcbmltcG9ydCB7IFRvb2x0aXBQcm92aWRlciB9IGZyb20gXCJAcmFkaXgtdWkvcmVhY3QtdG9vbHRpcFwiO1xuaW1wb3J0IHR5cGUge1xuICBDb21wb25lbnRQcm9wcyxcbiAgQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmLFxuICBDb21wb25lbnRUeXBlLFxuICBNb3VzZUV2ZW50IGFzIFJlYWN0TW91c2VFdmVudCxcbiAgUmVhY3ROb2RlLFxuICBTeW50aGV0aWNFdmVudCxcbn0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVhY3QsIHsgZm9yd2FyZFJlZiwgdXNlQ2FsbGJhY2ssIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB0eXBlIHsgR2xvYmFsQ29tcG9uZW50cyB9IGZyb20gXCIuLi9jb21wb25lbnRzXCI7XG5pbXBvcnQgeyB1c2VDb21wb25lbnRzIH0gZnJvbSBcIi4uL2NvbXBvbmVudHNcIjtcbmltcG9ydCB7IENoZWNrSWNvbiB9IGZyb20gXCIuLi9pY29ucy9DaGVja1wiO1xuaW1wb3J0IHsgRGVsZXRlSWNvbiB9IGZyb20gXCIuLi9pY29ucy9EZWxldGVcIjtcbmltcG9ydCB7IEVsbGlwc2lzSWNvbiB9IGZyb20gXCIuLi9pY29ucy9FbGxpcHNpc1wiO1xuaW1wb3J0IHsgTWlzc2luZ0ljb24gfSBmcm9tIFwiLi4vaWNvbnMvTWlzc2luZ1wiO1xuaW1wb3J0IHR5cGUge1xuICBDb21tZW50T3ZlcnJpZGVzLFxuICBHbG9iYWxPdmVycmlkZXMsXG4gIEluYm94Tm90aWZpY2F0aW9uT3ZlcnJpZGVzLFxufSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyB1c2VPdmVycmlkZXMgfSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyBUaW1lc3RhbXAgfSBmcm9tIFwiLi4vcHJpbWl0aXZlcy9UaW1lc3RhbXBcIjtcbmltcG9ydCB7IHVzZUN1cnJlbnRVc2VySWQgfSBmcm9tIFwiLi4vc2hhcmVkXCI7XG5pbXBvcnQgdHlwZSB7IFNsb3RQcm9wIH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSBcIi4uL3V0aWxzL2NsYXNzLW5hbWVzXCI7XG5pbXBvcnQgeyBnZW5lcmF0ZVVSTCB9IGZyb20gXCIuLi91dGlscy91cmxcIjtcbmltcG9ydCB7IEF2YXRhciwgdHlwZSBBdmF0YXJQcm9wcyB9IGZyb20gXCIuL2ludGVybmFsL0F2YXRhclwiO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSBcIi4vaW50ZXJuYWwvQnV0dG9uXCI7XG5pbXBvcnQgeyBEcm9wZG93biwgRHJvcGRvd25JdGVtLCBEcm9wZG93blRyaWdnZXIgfSBmcm9tIFwiLi9pbnRlcm5hbC9Ecm9wZG93blwiO1xuaW1wb3J0IHtcbiAgZ2VuZXJhdGVJbmJveE5vdGlmaWNhdGlvblRocmVhZENvbnRlbnRzLFxuICBJTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX01BWF9DT01NRU5UUyxcbiAgSW5ib3hOb3RpZmljYXRpb25Db21tZW50LFxufSBmcm9tIFwiLi9pbnRlcm5hbC9JbmJveE5vdGlmaWNhdGlvblRocmVhZFwiO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gXCIuL2ludGVybmFsL0xpc3RcIjtcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwiLi9pbnRlcm5hbC9Sb29tXCI7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSBcIi4vaW50ZXJuYWwvVG9vbHRpcFwiO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gXCIuL2ludGVybmFsL1VzZXJcIjtcblxudHlwZSBDb21wb25lbnRUeXBlV2l0aFJlZjxcbiAgVCBleHRlbmRzIGtleW9mIEpTWC5JbnRyaW5zaWNFbGVtZW50cyxcbiAgUCxcbj4gPSBDb21wb25lbnRUeXBlPFAgJiBQaWNrPENvbXBvbmVudFByb3BzPFQ+LCBcInJlZlwiPj47XG5cbnR5cGUgSW5ib3hOb3RpZmljYXRpb25LaW5kczxLUyBleHRlbmRzIEtEQUQgPSBLREFEPiA9IHtcbiAgLy8gRm9yIHNvbWUgcmVhc29uLCB3ZSBjYW5ub3QgZGlyZWN0bHkgdXNlIEtEQUQgaW4gdGhlIG1hcHBlZCB0eXBlIGxpbmVcbiAgLy8gYmVsb3csIGJlY2F1c2UgaXQgd2lsbCByZXN1bHQgaW4gJ3t9JyByYXRoZXIgdGhhbiBwaWNraW5nIHVwIHRoZVxuICAvLyBkZWZpbml0aW9uIGZyb20gdGhlIHVzZXItcHJvdmlkZWQgJ0FjdGl2aXRpZXNEYXRhJy4gTWlnaHQgYmUgYW4gaW50ZXJuYWxcbiAgLy8gVFMgb3B0aW1pemF0aW9uLCBzbyB3ZSdyZSBtYWtpbmcgaXQgYSBwYXJhbSB0byBkZWZlciB0aGUgcmVzb2x1dGlvbi5cbiAgW0sgaW4gS1NdOiBDb21wb25lbnRUeXBlV2l0aFJlZjxcImFcIiwgSW5ib3hOb3RpZmljYXRpb25DdXN0b21LaW5kUHJvcHM8Sz4+O1xufSAmIHtcbiAgdGhyZWFkOiBDb21wb25lbnRUeXBlV2l0aFJlZjxcImFcIiwgSW5ib3hOb3RpZmljYXRpb25UaHJlYWRLaW5kUHJvcHM+O1xuICB0ZXh0TWVudGlvbjogQ29tcG9uZW50VHlwZVdpdGhSZWY8XCJhXCIsIEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb25LaW5kUHJvcHM+O1xufTtcblxuaW50ZXJmYWNlIEluYm94Tm90aWZpY2F0aW9uU2hhcmVkUHJvcHMge1xuICAvKipcbiAgICogSG93IHRvIHNob3cgb3IgaGlkZSB0aGUgYWN0aW9ucy5cbiAgICovXG4gIHNob3dBY3Rpb25zPzogYm9vbGVhbiB8IFwiaG92ZXJcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbmJveE5vdGlmaWNhdGlvblByb3BzXG4gIGV4dGVuZHMgT21pdDxDb21wb25lbnRQcm9wc1dpdGhvdXRSZWY8XCJhXCI+LCBcInRpdGxlXCI+LFxuICAgIEluYm94Tm90aWZpY2F0aW9uU2hhcmVkUHJvcHMge1xuICAvKipcbiAgICogVGhlIGluYm94IG5vdGlmaWNhdGlvbiB0byBkaXNwbGF5LlxuICAgKi9cbiAgaW5ib3hOb3RpZmljYXRpb246IEluYm94Tm90aWZpY2F0aW9uRGF0YTtcblxuICAvKipcbiAgICogT3ZlcnJpZGUgc3BlY2lmaWMga2luZHMgb2YgaW5ib3ggbm90aWZpY2F0aW9ucy5cbiAgICovXG4gIGtpbmRzPzogUGFydGlhbDxJbmJveE5vdGlmaWNhdGlvbktpbmRzPjtcblxuICAvKipcbiAgICogT3ZlcnJpZGUgdGhlIGNvbXBvbmVudCdzIHN0cmluZ3MuXG4gICAqL1xuICBvdmVycmlkZXM/OiBQYXJ0aWFsPFxuICAgIEdsb2JhbE92ZXJyaWRlcyAmIEluYm94Tm90aWZpY2F0aW9uT3ZlcnJpZGVzICYgQ29tbWVudE92ZXJyaWRlc1xuICA+O1xuXG4gIC8qKlxuICAgKiBPdmVycmlkZSB0aGUgY29tcG9uZW50J3MgY29tcG9uZW50cy5cbiAgICovXG4gIGNvbXBvbmVudHM/OiBQYXJ0aWFsPEdsb2JhbENvbXBvbmVudHM+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluYm94Tm90aWZpY2F0aW9uVGhyZWFkUHJvcHNcbiAgZXh0ZW5kcyBPbWl0PEluYm94Tm90aWZpY2F0aW9uUHJvcHMsIFwia2luZHNcIiB8IFwiY2hpbGRyZW5cIj4sXG4gICAgSW5ib3hOb3RpZmljYXRpb25TaGFyZWRQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgaW5ib3ggbm90aWZpY2F0aW9uIHRvIGRpc3BsYXkuXG4gICAqL1xuICBpbmJveE5vdGlmaWNhdGlvbjogSW5ib3hOb3RpZmljYXRpb25UaHJlYWREYXRhO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHNob3cgdGhlIHJvb20gbmFtZSBpbiB0aGUgdGl0bGUuXG4gICAqL1xuICBzaG93Um9vbU5hbWU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb25Qcm9wc1xuICBleHRlbmRzIE9taXQ8SW5ib3hOb3RpZmljYXRpb25Qcm9wcywgXCJraW5kc1wiPixcbiAgICBJbmJveE5vdGlmaWNhdGlvblNoYXJlZFByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBpbmJveCBub3RpZmljYXRpb24gdG8gZGlzcGxheS5cbiAgICovXG4gIGluYm94Tm90aWZpY2F0aW9uOiBJbmJveE5vdGlmaWNhdGlvblRleHRNZW50aW9uRGF0YTtcblxuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHRoZSByb29tIG5hbWUgaW4gdGhlIHRpdGxlLlxuICAgKi9cbiAgc2hvd1Jvb21OYW1lPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbmJveE5vdGlmaWNhdGlvbkN1c3RvbVByb3BzXG4gIGV4dGVuZHMgT21pdDxJbmJveE5vdGlmaWNhdGlvblByb3BzLCBcImtpbmRzXCI+LFxuICAgIEluYm94Tm90aWZpY2F0aW9uU2hhcmVkUHJvcHMsXG4gICAgU2xvdFByb3Age1xuICAvKipcbiAgICogVGhlIGluYm94IG5vdGlmaWNhdGlvbiB0byBkaXNwbGF5LlxuICAgKi9cbiAgaW5ib3hOb3RpZmljYXRpb246IEluYm94Tm90aWZpY2F0aW9uQ3VzdG9tRGF0YTtcblxuICAvKipcbiAgICogVGhlIGluYm94IG5vdGlmaWNhdGlvbidzIGNvbnRlbnQuXG4gICAqL1xuICBjaGlsZHJlbjogUmVhY3ROb2RlO1xuXG4gIC8qKlxuICAgKiBUaGUgaW5ib3ggbm90aWZpY2F0aW9uJ3MgdGl0bGUuXG4gICAqL1xuICB0aXRsZTogUmVhY3ROb2RlO1xuXG4gIC8qKlxuICAgKiBUaGUgaW5ib3ggbm90aWZpY2F0aW9uJ3MgYXNpZGUgY29udGVudC5cbiAgICogQ2FuIGJlIGNvbWJpbmVkIHdpdGggYEluYm94Tm90aWZpY2F0aW9uLkljb25gIG9yIGBJbmJveE5vdGlmaWNhdGlvbi5BdmF0YXJgIHRvIGVhc2lseSBmb2xsb3cgZGVmYXVsdCBzdHlsZXMuXG4gICAqL1xuICBhc2lkZT86IFJlYWN0Tm9kZTtcblxuICAvKipcbiAgICogV2hldGhlciB0byBtYXJrIHRoZSBpbmJveCBub3RpZmljYXRpb24gYXMgcmVhZCB3aGVuIGNsaWNrZWQuXG4gICAqL1xuICBtYXJrQXNSZWFkT25DbGljaz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCB0eXBlIEluYm94Tm90aWZpY2F0aW9uVGhyZWFkS2luZFByb3BzID0gT21pdDxcbiAgSW5ib3hOb3RpZmljYXRpb25Qcm9wcyxcbiAgXCJraW5kc1wiXG4+ICYge1xuICBpbmJveE5vdGlmaWNhdGlvbjogSW5ib3hOb3RpZmljYXRpb25UaHJlYWREYXRhO1xufTtcblxuZXhwb3J0IHR5cGUgSW5ib3hOb3RpZmljYXRpb25UZXh0TWVudGlvbktpbmRQcm9wcyA9IE9taXQ8XG4gIEluYm94Tm90aWZpY2F0aW9uUHJvcHMsXG4gIFwia2luZHNcIlxuPiAmIHtcbiAgaW5ib3hOb3RpZmljYXRpb246IEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb25EYXRhO1xufTtcblxuZXhwb3J0IHR5cGUgSW5ib3hOb3RpZmljYXRpb25DdXN0b21LaW5kUHJvcHM8SyBleHRlbmRzIEtEQUQgPSBLREFEPiA9IE9taXQ8XG4gIEluYm94Tm90aWZpY2F0aW9uUHJvcHMsXG4gIFwia2luZHNcIlxuPiAmIHtcbiAgaW5ib3hOb3RpZmljYXRpb246IEluYm94Tm90aWZpY2F0aW9uQ3VzdG9tRGF0YTxLPjtcbn07XG5cbmludGVyZmFjZSBJbmJveE5vdGlmaWNhdGlvbkxheW91dFByb3BzXG4gIGV4dGVuZHMgT21pdDxDb21wb25lbnRQcm9wc1dpdGhvdXRSZWY8XCJhXCI+LCBcInRpdGxlXCI+LFxuICAgIEluYm94Tm90aWZpY2F0aW9uU2hhcmVkUHJvcHMsXG4gICAgU2xvdFByb3Age1xuICBpbmJveE5vdGlmaWNhdGlvbjogSW5ib3hOb3RpZmljYXRpb25EYXRhO1xuICBhc2lkZTogUmVhY3ROb2RlO1xuICB0aXRsZTogUmVhY3ROb2RlO1xuICBkYXRlOiBEYXRlIHwgc3RyaW5nIHwgbnVtYmVyO1xuICB1bnJlYWQ/OiBib29sZWFuO1xuICBvdmVycmlkZXM/OiBQYXJ0aWFsPEdsb2JhbE92ZXJyaWRlcyAmIEluYm94Tm90aWZpY2F0aW9uT3ZlcnJpZGVzPjtcbiAgY29tcG9uZW50cz86IFBhcnRpYWw8R2xvYmFsQ29tcG9uZW50cz47XG4gIG1hcmtBc1JlYWRPbkNsaWNrPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgSW5ib3hOb3RpZmljYXRpb25JY29uUHJvcHMgPSBDb21wb25lbnRQcm9wczxcImRpdlwiPjtcblxuZXhwb3J0IHR5cGUgSW5ib3hOb3RpZmljYXRpb25BdmF0YXJQcm9wcyA9IEF2YXRhclByb3BzO1xuXG5jb25zdCBJbmJveE5vdGlmaWNhdGlvbkxheW91dCA9IGZvcndhcmRSZWY8XG4gIEhUTUxBbmNob3JFbGVtZW50LFxuICBJbmJveE5vdGlmaWNhdGlvbkxheW91dFByb3BzXG4+KFxuICAoXG4gICAge1xuICAgICAgaW5ib3hOb3RpZmljYXRpb24sXG4gICAgICBjaGlsZHJlbixcbiAgICAgIGFzaWRlLFxuICAgICAgdGl0bGUsXG4gICAgICBkYXRlLFxuICAgICAgdW5yZWFkLFxuICAgICAgbWFya0FzUmVhZE9uQ2xpY2ssXG4gICAgICBvbkNsaWNrLFxuICAgICAgaHJlZixcbiAgICAgIHNob3dBY3Rpb25zLFxuICAgICAgb3ZlcnJpZGVzLFxuICAgICAgY29tcG9uZW50cyxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGFzQ2hpbGQsXG4gICAgICAuLi5wcm9wc1xuICAgIH0sXG4gICAgZm9yd2FyZGVkUmVmXG4gICkgPT4ge1xuICAgIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMob3ZlcnJpZGVzKTtcbiAgICBjb25zdCB7IEFuY2hvciB9ID0gdXNlQ29tcG9uZW50cyhjb21wb25lbnRzKTtcbiAgICBjb25zdCBDb21wb25lbnQgPSBhc0NoaWxkID8gU2xvdCA6IEFuY2hvcjtcbiAgICBjb25zdCBbaXNNb3JlQWN0aW9uT3Blbiwgc2V0TW9yZUFjdGlvbk9wZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IG1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZCA9IHVzZU1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZCgpO1xuICAgIGNvbnN0IGRlbGV0ZUluYm94Tm90aWZpY2F0aW9uID0gdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb24oKTtcblxuICAgIGNvbnN0IGhhbmRsZUNsaWNrID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZXZlbnQ6IFJlYWN0TW91c2VFdmVudDxIVE1MQW5jaG9yRWxlbWVudCwgTW91c2VFdmVudD4pID0+IHtcbiAgICAgICAgb25DbGljaz8uKGV2ZW50KTtcblxuICAgICAgICBjb25zdCBzaG91bGRNYXJrQXNSZWFkT25DbGljayA9IG1hcmtBc1JlYWRPbkNsaWNrID8/IEJvb2xlYW4oaHJlZik7XG5cbiAgICAgICAgaWYgKHVucmVhZCAmJiBzaG91bGRNYXJrQXNSZWFkT25DbGljaykge1xuICAgICAgICAgIG1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZChpbmJveE5vdGlmaWNhdGlvbi5pZCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbXG4gICAgICAgIGhyZWYsXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uLmlkLFxuICAgICAgICBtYXJrQXNSZWFkT25DbGljayxcbiAgICAgICAgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkLFxuICAgICAgICBvbkNsaWNrLFxuICAgICAgICB1bnJlYWQsXG4gICAgICBdXG4gICAgKTtcblxuICAgIGNvbnN0IHN0b3BQcm9wYWdhdGlvbiA9IHVzZUNhbGxiYWNrKChldmVudDogU3ludGhldGljRXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0sIFtdKTtcblxuICAgIGNvbnN0IHByZXZlbnREZWZhdWx0QW5kU3RvcFByb3BhZ2F0aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZXZlbnQ6IFN5bnRoZXRpY0V2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfSxcbiAgICAgIFtdXG4gICAgKTtcblxuICAgIGNvbnN0IGhhbmRsZU1vcmVDbGljayA9IHVzZUNhbGxiYWNrKChldmVudDogUmVhY3RNb3VzZUV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBzZXRNb3JlQWN0aW9uT3Blbigob3BlbikgPT4gIW9wZW4pO1xuICAgIH0sIFtdKTtcblxuICAgIGNvbnN0IGhhbmRsZU1hcmtBc1JlYWQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQoaW5ib3hOb3RpZmljYXRpb24uaWQpO1xuICAgIH0sIFtpbmJveE5vdGlmaWNhdGlvbi5pZCwgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkXSk7XG5cbiAgICBjb25zdCBoYW5kbGVEZWxldGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBkZWxldGVJbmJveE5vdGlmaWNhdGlvbihpbmJveE5vdGlmaWNhdGlvbi5pZCk7XG4gICAgfSwgW2luYm94Tm90aWZpY2F0aW9uLmlkLCBkZWxldGVJbmJveE5vdGlmaWNhdGlvbl0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxUb29sdGlwUHJvdmlkZXI+XG4gICAgICAgIDxDb21wb25lbnRcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgICBcImxiLXJvb3QgbGItaW5ib3gtbm90aWZpY2F0aW9uXCIsXG4gICAgICAgICAgICBzaG93QWN0aW9ucyA9PT0gXCJob3ZlclwiICYmXG4gICAgICAgICAgICAgIFwibGItaW5ib3gtbm90aWZpY2F0aW9uOnNob3ctYWN0aW9ucy1ob3ZlclwiLFxuICAgICAgICAgICAgaXNNb3JlQWN0aW9uT3BlbiAmJiBcImxiLWluYm94LW5vdGlmaWNhdGlvbjphY3Rpb24tb3BlblwiLFxuICAgICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICAgKX1cbiAgICAgICAgICBkaXI9eyQuZGlyfVxuICAgICAgICAgIGRhdGEtdW5yZWFkPXt1bnJlYWQgPyBcIlwiIDogdW5kZWZpbmVkfVxuICAgICAgICAgIGRhdGEta2luZD17aW5ib3hOb3RpZmljYXRpb24ua2luZH1cbiAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVDbGlja31cbiAgICAgICAgICBocmVmPXtocmVmfVxuICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgICAgPlxuICAgICAgICAgIHthc2lkZSAmJiA8ZGl2IGNsYXNzTmFtZT1cImxiLWluYm94LW5vdGlmaWNhdGlvbi1hc2lkZVwiPnthc2lkZX08L2Rpdj59XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsYi1pbmJveC1ub3RpZmljYXRpb24tY29udGVudFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsYi1pbmJveC1ub3RpZmljYXRpb24taGVhZGVyXCI+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxiLWluYm94LW5vdGlmaWNhdGlvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGItaW5ib3gtbm90aWZpY2F0aW9uLWRldGFpbHNcIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJsYi1pbmJveC1ub3RpZmljYXRpb24tZGV0YWlscy1sYWJlbHNcIj5cbiAgICAgICAgICAgICAgICAgIDxUaW1lc3RhbXBcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxlPXskLmxvY2FsZX1cbiAgICAgICAgICAgICAgICAgICAgZGF0ZT17ZGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItaW5ib3gtbm90aWZpY2F0aW9uLWRhdGVcIlxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgIHt1bnJlYWQgJiYgKFxuICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxiLWluYm94LW5vdGlmaWNhdGlvbi11bnJlYWQtaW5kaWNhdG9yXCJcbiAgICAgICAgICAgICAgICAgICAgICByb2xlPVwicHJlc2VudGF0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAge3Nob3dBY3Rpb25zICYmIChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLWluYm94LW5vdGlmaWNhdGlvbi1hY3Rpb25zXCI+XG4gICAgICAgICAgICAgICAgICA8RHJvcGRvd25cbiAgICAgICAgICAgICAgICAgICAgb3Blbj17aXNNb3JlQWN0aW9uT3Blbn1cbiAgICAgICAgICAgICAgICAgICAgb25PcGVuQ2hhbmdlPXtzZXRNb3JlQWN0aW9uT3Blbn1cbiAgICAgICAgICAgICAgICAgICAgYWxpZ249XCJlbmRcIlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50PXtcbiAgICAgICAgICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgICAgICAgICAge3VucmVhZCA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPERyb3Bkb3duSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0PXtoYW5kbGVNYXJrQXNSZWFkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3N0b3BQcm9wYWdhdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDaGVja0ljb24gY2xhc3NOYW1lPVwibGItZHJvcGRvd24taXRlbS1pY29uXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JC5JTkJPWF9OT1RJRklDQVRJT05fTUFSS19BU19SRUFEfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duSXRlbT5cbiAgICAgICAgICAgICAgICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICAgICAgICAgICAgICAgICAgPERyb3Bkb3duSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17aGFuZGxlRGVsZXRlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtzdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxEZWxldGVJY29uIGNsYXNzTmFtZT1cImxiLWRyb3Bkb3duLWl0ZW0taWNvblwiIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHskLklOQk9YX05PVElGSUNBVElPTl9ERUxFVEV9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duSXRlbT5cbiAgICAgICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8VG9vbHRpcCBjb250ZW50PXskLklOQk9YX05PVElGSUNBVElPTl9NT1JFfT5cbiAgICAgICAgICAgICAgICAgICAgICA8RHJvcGRvd25UcmlnZ2VyIGFzQ2hpbGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxiLWluYm94LW5vdGlmaWNhdGlvbi1hY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVNb3JlQ2xpY2t9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uUG9pbnRlckRvd249e3ByZXZlbnREZWZhdWx0QW5kU3RvcFByb3BhZ2F0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvblBvaW50ZXJVcD17cHJldmVudERlZmF1bHRBbmRTdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9eyQuSU5CT1hfTk9USUZJQ0FUSU9OX01PUkV9XG4gICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxFbGxpcHNpc0ljb24gY2xhc3NOYW1lPVwibGItYnV0dG9uLWljb25cIiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgPC9Ecm9wZG93blRyaWdnZXI+XG4gICAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgIDwvRHJvcGRvd24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGItaW5ib3gtbm90aWZpY2F0aW9uLWJvZHlcIj57Y2hpbGRyZW59PC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQ29tcG9uZW50PlxuICAgICAgPC9Ub29sdGlwUHJvdmlkZXI+XG4gICAgKTtcbiAgfVxuKTtcblxuZnVuY3Rpb24gSW5ib3hOb3RpZmljYXRpb25JY29uKHtcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufTogSW5ib3hOb3RpZmljYXRpb25JY29uUHJvcHMpIHtcbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJsYi1pbmJveC1ub3RpZmljYXRpb24taWNvblwiLCBjbGFzc05hbWUpfVxuICAgICAgey4uLnByb3BzfVxuICAgIC8+XG4gICk7XG59XG5cbmZ1bmN0aW9uIEluYm94Tm90aWZpY2F0aW9uQXZhdGFyKHtcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufTogSW5ib3hOb3RpZmljYXRpb25BdmF0YXJQcm9wcykge1xuICByZXR1cm4gKFxuICAgIDxBdmF0YXJcbiAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImxiLWluYm94LW5vdGlmaWNhdGlvbi1hdmF0YXJcIiwgY2xhc3NOYW1lKX1cbiAgICAgIHsuLi5wcm9wc31cbiAgICAvPlxuICApO1xufVxuXG4vKipcbiAqIERpc3BsYXlzIGEgdGhyZWFkIGluYm94IG5vdGlmaWNhdGlvbi5cbiAqL1xuY29uc3QgSW5ib3hOb3RpZmljYXRpb25UaHJlYWQgPSBmb3J3YXJkUmVmPFxuICBIVE1MQW5jaG9yRWxlbWVudCxcbiAgSW5ib3hOb3RpZmljYXRpb25UaHJlYWRQcm9wc1xuPihcbiAgKFxuICAgIHtcbiAgICAgIGluYm94Tm90aWZpY2F0aW9uLFxuICAgICAgaHJlZixcbiAgICAgIHNob3dSb29tTmFtZSA9IHRydWUsXG4gICAgICBzaG93QWN0aW9ucyA9IFwiaG92ZXJcIixcbiAgICAgIG92ZXJyaWRlcyxcbiAgICAgIC4uLnByb3BzXG4gICAgfSxcbiAgICBmb3J3YXJkZWRSZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgJCA9IHVzZU92ZXJyaWRlcyhvdmVycmlkZXMpO1xuICAgIGNvbnN0IHRocmVhZCA9IHVzZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkKGluYm94Tm90aWZpY2F0aW9uLmlkKTtcbiAgICBjb25zdCBjdXJyZW50VXNlcklkID0gdXNlQ3VycmVudFVzZXJJZCgpO1xuICAgIC8vIFRPRE86IElmIHlvdSBwcm92aWRlIGBocmVmYCAob3IgcGxhbiB0byksIHdlIHNob3VsZG4ndCBydW4gdGhpcyBob29rLiBXZSBzaG91bGQgZmluZCBhIHdheSB0byBjb25kaXRpb25hbGx5IHJ1biBpdC5cbiAgICAvLyAgICAgICBCZWNhdXNlIG9mIGJhdGNoaW5nIGFuZCB0aGUgZmFjdCB0aGF0IHRoZSBzYW1lIGhvb2sgd2lsbCBiZSBjYWxsZWQgd2l0aGluIDxSb29tIC8+IGluIHRoZSBub3RpZmljYXRpb24ncyB0aXRsZSxcbiAgICAvLyAgICAgICBpdCdzIG5vdCBhIGJpZyBkZWFsLCB0aGUgb25seSBzY2VuYXJpbyB3aGVyZSBpdCB3b3VsZCBiZSBzdXBlcmZsdW91cyB3b3VsZCBiZSBpZiB0aGUgdXNlciBwcm92aWRlcyB0aGVpciBvd25cbiAgICAvLyAgICAgICBgaHJlZmAgQU5EIGRpc2FibGVzIHJvb20gbmFtZXMgaW4gdGhlIHRpdGxlIHZpYSBgc2hvd1Jvb21OYW1lPXtmYWxzZX1gLlxuICAgIGNvbnN0IHsgaW5mbyB9ID0gdXNlUm9vbUluZm8oaW5ib3hOb3RpZmljYXRpb24ucm9vbUlkKTtcbiAgICBjb25zdCB7IHVucmVhZCwgZGF0ZSwgYXNpZGUsIHRpdGxlLCBjb250ZW50LCBjb21tZW50SWQgfSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudHMgPSBnZW5lcmF0ZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkQ29udGVudHMoXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uLFxuICAgICAgICB0aHJlYWQsXG4gICAgICAgIGN1cnJlbnRVc2VySWQgPz8gXCJcIlxuICAgICAgKTtcblxuICAgICAgc3dpdGNoIChjb250ZW50cy50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJjb21tZW50c1wiOiB7XG4gICAgICAgICAgY29uc3QgcmV2ZXJzZWRVc2VySWRzID0gWy4uLmNvbnRlbnRzLnVzZXJJZHNdLnJldmVyc2UoKTtcbiAgICAgICAgICBjb25zdCBmaXJzdFVzZXJJZCA9IHJldmVyc2VkVXNlcklkc1swXTtcblxuICAgICAgICAgIGNvbnN0IGFzaWRlID0gPEluYm94Tm90aWZpY2F0aW9uQXZhdGFyIHVzZXJJZD17Zmlyc3RVc2VySWR9IC8+O1xuICAgICAgICAgIGNvbnN0IHRpdGxlID0gJC5JTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX0NPTU1FTlRTX0xJU1QoXG4gICAgICAgICAgICA8TGlzdFxuICAgICAgICAgICAgICB2YWx1ZXM9e3JldmVyc2VkVXNlcklkcy5tYXAoKHVzZXJJZCwgaW5kZXgpID0+IChcbiAgICAgICAgICAgICAgICA8VXNlclxuICAgICAgICAgICAgICAgICAga2V5PXt1c2VySWR9XG4gICAgICAgICAgICAgICAgICB1c2VySWQ9e3VzZXJJZH1cbiAgICAgICAgICAgICAgICAgIGNhcGl0YWxpemU9e2luZGV4ID09PSAwfVxuICAgICAgICAgICAgICAgICAgcmVwbGFjZVNlbGZcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApKX1cbiAgICAgICAgICAgICAgZm9ybWF0UmVtYWluaW5nPXskLkxJU1RfUkVNQUlOSU5HX1VTRVJTfVxuICAgICAgICAgICAgICB0cnVuY2F0ZT17SU5CT1hfTk9USUZJQ0FUSU9OX1RIUkVBRF9NQVhfQ09NTUVOVFMgLSAxfVxuICAgICAgICAgICAgLz4sXG4gICAgICAgICAgICBzaG93Um9vbU5hbWUgPyA8Um9vbSByb29tSWQ9e3RocmVhZC5yb29tSWR9IC8+IDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcmV2ZXJzZWRVc2VySWRzLmxlbmd0aFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGItaW5ib3gtbm90aWZpY2F0aW9uLWNvbW1lbnRzXCI+XG4gICAgICAgICAgICAgIHtjb250ZW50cy5jb21tZW50cy5tYXAoKGNvbW1lbnQpID0+IChcbiAgICAgICAgICAgICAgICA8SW5ib3hOb3RpZmljYXRpb25Db21tZW50XG4gICAgICAgICAgICAgICAgICBrZXk9e2NvbW1lbnQuaWR9XG4gICAgICAgICAgICAgICAgICBjb21tZW50PXtjb21tZW50fVxuICAgICAgICAgICAgICAgICAgc2hvd0hlYWRlcj17Y29udGVudHMuY29tbWVudHMubGVuZ3RoID4gMX1cbiAgICAgICAgICAgICAgICAgIG92ZXJyaWRlcz17b3ZlcnJpZGVzfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1bnJlYWQ6IGNvbnRlbnRzLnVucmVhZCxcbiAgICAgICAgICAgIGRhdGU6IGNvbnRlbnRzLmRhdGUsXG4gICAgICAgICAgICBhc2lkZSxcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgY29udGVudCxcbiAgICAgICAgICAgIHRocmVhZElkOiB0aHJlYWQuaWQsXG4gICAgICAgICAgICBjb21tZW50SWQ6IGNvbnRlbnRzLmNvbW1lbnRzW2NvbnRlbnRzLmNvbW1lbnRzLmxlbmd0aCAtIDFdLmlkLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjYXNlIFwibWVudGlvblwiOiB7XG4gICAgICAgICAgY29uc3QgbWVudGlvblVzZXJJZCA9IGNvbnRlbnRzLnVzZXJJZHNbMF07XG4gICAgICAgICAgY29uc3QgbWVudGlvbkNvbW1lbnQgPSBjb250ZW50cy5jb21tZW50c1swXTtcblxuICAgICAgICAgIGNvbnN0IGFzaWRlID0gPEluYm94Tm90aWZpY2F0aW9uQXZhdGFyIHVzZXJJZD17bWVudGlvblVzZXJJZH0gLz47XG4gICAgICAgICAgY29uc3QgdGl0bGUgPSAkLklOQk9YX05PVElGSUNBVElPTl9USFJFQURfTUVOVElPTihcbiAgICAgICAgICAgIDxVc2VyIGtleT17bWVudGlvblVzZXJJZH0gdXNlcklkPXttZW50aW9uVXNlcklkfSBjYXBpdGFsaXplIC8+LFxuICAgICAgICAgICAgc2hvd1Jvb21OYW1lID8gPFJvb20gcm9vbUlkPXt0aHJlYWQucm9vbUlkfSAvPiA6IHVuZGVmaW5lZFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGItaW5ib3gtbm90aWZpY2F0aW9uLWNvbW1lbnRzXCI+XG4gICAgICAgICAgICAgIDxJbmJveE5vdGlmaWNhdGlvbkNvbW1lbnRcbiAgICAgICAgICAgICAgICBrZXk9e21lbnRpb25Db21tZW50LmlkfVxuICAgICAgICAgICAgICAgIGNvbW1lbnQ9e21lbnRpb25Db21tZW50fVxuICAgICAgICAgICAgICAgIHNob3dIZWFkZXI9e2ZhbHNlfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1bnJlYWQ6IGNvbnRlbnRzLnVucmVhZCxcbiAgICAgICAgICAgIGRhdGU6IGNvbnRlbnRzLmRhdGUsXG4gICAgICAgICAgICBhc2lkZSxcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgY29udGVudCxcbiAgICAgICAgICAgIHRocmVhZElkOiB0aHJlYWQuaWQsXG4gICAgICAgICAgICBjb21tZW50SWQ6IG1lbnRpb25Db21tZW50LmlkLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBhc3NlcnROZXZlcihcbiAgICAgICAgICAgIGNvbnRlbnRzLFxuICAgICAgICAgICAgXCJVbmV4cGVjdGVkIHRocmVhZCBpbmJveCBub3RpZmljYXRpb24gdHlwZVwiXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LCBbJCwgY3VycmVudFVzZXJJZCwgaW5ib3hOb3RpZmljYXRpb24sIG92ZXJyaWRlcywgc2hvd1Jvb21OYW1lLCB0aHJlYWRdKTtcbiAgICAvLyBBZGQgdGhlIHRocmVhZCBJRCBhbmQgY29tbWVudCBJRCB0byB0aGUgYGhyZWZgLlxuICAgIC8vIEFuZCB1c2UgVVJMIGZyb20gYHJlc29sdmVSb29tc0luZm9gIGlmIGBocmVmYCBpc24ndCBzZXQuXG4gICAgY29uc3QgcmVzb2x2ZWRIcmVmID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICBjb25zdCByZXNvbHZlZEhyZWYgPSBocmVmID8/IGluZm8/LnVybDtcblxuICAgICAgcmV0dXJuIHJlc29sdmVkSHJlZlxuICAgICAgICA/IGdlbmVyYXRlVVJMKHJlc29sdmVkSHJlZiwgdW5kZWZpbmVkLCBjb21tZW50SWQpXG4gICAgICAgIDogdW5kZWZpbmVkO1xuICAgIH0sIFtjb21tZW50SWQsIGhyZWYsIGluZm8/LnVybF0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxJbmJveE5vdGlmaWNhdGlvbkxheW91dFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbj17aW5ib3hOb3RpZmljYXRpb259XG4gICAgICAgIGFzaWRlPXthc2lkZX1cbiAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICBkYXRlPXtkYXRlfVxuICAgICAgICB1bnJlYWQ9e3VucmVhZH1cbiAgICAgICAgb3ZlcnJpZGVzPXtvdmVycmlkZXN9XG4gICAgICAgIGhyZWY9e3Jlc29sdmVkSHJlZn1cbiAgICAgICAgc2hvd0FjdGlvbnM9e3Nob3dBY3Rpb25zfVxuICAgICAgICBtYXJrQXNSZWFkT25DbGljaz17ZmFsc2V9XG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgICA+XG4gICAgICAgIHtjb250ZW50fVxuICAgICAgPC9JbmJveE5vdGlmaWNhdGlvbkxheW91dD5cbiAgICApO1xuICB9XG4pO1xuXG4vKipcbiAqIERpc3BsYXlzIGEgdGV4dCBtZW50aW9uIG5vdGlmaWNhdGlvbiBraW5kLlxuICovXG5jb25zdCBJbmJveE5vdGlmaWNhdGlvblRleHRNZW50aW9uID0gZm9yd2FyZFJlZjxcbiAgSFRNTEFuY2hvckVsZW1lbnQsXG4gIEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb25Qcm9wc1xuPihcbiAgKFxuICAgIHtcbiAgICAgIGluYm94Tm90aWZpY2F0aW9uLFxuICAgICAgc2hvd0FjdGlvbnMgPSBcImhvdmVyXCIsXG4gICAgICBzaG93Um9vbU5hbWUgPSB0cnVlLFxuICAgICAgb3ZlcnJpZGVzLFxuICAgICAgLi4ucHJvcHNcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCAkID0gdXNlT3ZlcnJpZGVzKG92ZXJyaWRlcyk7XG5cbiAgICBjb25zdCB1bnJlYWQgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgICFpbmJveE5vdGlmaWNhdGlvbi5yZWFkQXQgfHxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb24ubm90aWZpZWRBdCA+IGluYm94Tm90aWZpY2F0aW9uLnJlYWRBdFxuICAgICAgKTtcbiAgICB9LCBbaW5ib3hOb3RpZmljYXRpb24ubm90aWZpZWRBdCwgaW5ib3hOb3RpZmljYXRpb24ucmVhZEF0XSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEluYm94Tm90aWZpY2F0aW9uTGF5b3V0XG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uPXtpbmJveE5vdGlmaWNhdGlvbn1cbiAgICAgICAgYXNpZGU9ezxJbmJveE5vdGlmaWNhdGlvbkF2YXRhciB1c2VySWQ9e2luYm94Tm90aWZpY2F0aW9uLmNyZWF0ZWRCeX0gLz59XG4gICAgICAgIHRpdGxlPXskLklOQk9YX05PVElGSUNBVElPTl9URVhUX01FTlRJT04oXG4gICAgICAgICAgPFVzZXJcbiAgICAgICAgICAgIGtleT17aW5ib3hOb3RpZmljYXRpb24uY3JlYXRlZEJ5fVxuICAgICAgICAgICAgdXNlcklkPXtpbmJveE5vdGlmaWNhdGlvbi5jcmVhdGVkQnl9XG4gICAgICAgICAgICBjYXBpdGFsaXplXG4gICAgICAgICAgLz4sXG4gICAgICAgICAgc2hvd1Jvb21OYW1lID8gPFJvb20gcm9vbUlkPXtpbmJveE5vdGlmaWNhdGlvbi5yb29tSWR9IC8+IDogdW5kZWZpbmVkXG4gICAgICAgICl9XG4gICAgICAgIGRhdGU9e2luYm94Tm90aWZpY2F0aW9uLm5vdGlmaWVkQXR9XG4gICAgICAgIHVucmVhZD17dW5yZWFkfVxuICAgICAgICBvdmVycmlkZXM9e292ZXJyaWRlc31cbiAgICAgICAgc2hvd0FjdGlvbnM9e3Nob3dBY3Rpb25zfVxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgLz5cbiAgICApO1xuICB9XG4pO1xuXG4vKipcbiAqIERpc3BsYXlzIGEgY3VzdG9tIG5vdGlmaWNhdGlvbiBraW5kLlxuICovXG5jb25zdCBJbmJveE5vdGlmaWNhdGlvbkN1c3RvbSA9IGZvcndhcmRSZWY8XG4gIEhUTUxBbmNob3JFbGVtZW50LFxuICBJbmJveE5vdGlmaWNhdGlvbkN1c3RvbVByb3BzXG4+KFxuICAoXG4gICAge1xuICAgICAgaW5ib3hOb3RpZmljYXRpb24sXG4gICAgICBzaG93QWN0aW9ucyA9IFwiaG92ZXJcIixcbiAgICAgIHRpdGxlLFxuICAgICAgYXNpZGUsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIG92ZXJyaWRlcyxcbiAgICAgIC4uLnByb3BzXG4gICAgfSxcbiAgICBmb3J3YXJkZWRSZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgdW5yZWFkID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAhaW5ib3hOb3RpZmljYXRpb24ucmVhZEF0IHx8XG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uLm5vdGlmaWVkQXQgPiBpbmJveE5vdGlmaWNhdGlvbi5yZWFkQXRcbiAgICAgICk7XG4gICAgfSwgW2luYm94Tm90aWZpY2F0aW9uLm5vdGlmaWVkQXQsIGluYm94Tm90aWZpY2F0aW9uLnJlYWRBdF0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxJbmJveE5vdGlmaWNhdGlvbkxheW91dFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbj17aW5ib3hOb3RpZmljYXRpb259XG4gICAgICAgIGFzaWRlPXthc2lkZX1cbiAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICBkYXRlPXtpbmJveE5vdGlmaWNhdGlvbi5ub3RpZmllZEF0fVxuICAgICAgICB1bnJlYWQ9e3VucmVhZH1cbiAgICAgICAgb3ZlcnJpZGVzPXtvdmVycmlkZXN9XG4gICAgICAgIHNob3dBY3Rpb25zPXtzaG93QWN0aW9uc31cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgID5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9JbmJveE5vdGlmaWNhdGlvbkxheW91dD5cbiAgICApO1xuICB9XG4pO1xuXG5jb25zdCBJbmJveE5vdGlmaWNhdGlvbkN1c3RvbU1pc3NpbmcgPSBmb3J3YXJkUmVmPFxuICBIVE1MQW5jaG9yRWxlbWVudCxcbiAgT21pdDxJbmJveE5vdGlmaWNhdGlvbkN1c3RvbVByb3BzLCBcImNoaWxkcmVuXCIgfCBcInRpdGxlXCIgfCBcImFzaWRlXCI+XG4+KCh7IGluYm94Tm90aWZpY2F0aW9uLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgcmV0dXJuIChcbiAgICA8SW5ib3hOb3RpZmljYXRpb25DdXN0b21cbiAgICAgIGluYm94Tm90aWZpY2F0aW9uPXtpbmJveE5vdGlmaWNhdGlvbn1cbiAgICAgIHsuLi5wcm9wc31cbiAgICAgIHRpdGxlPXtcbiAgICAgICAgPD5cbiAgICAgICAgICBDdXN0b20gbm90aWZpY2F0aW9uIGtpbmQgPGNvZGU+e2luYm94Tm90aWZpY2F0aW9uLmtpbmR9PC9jb2RlPiBpcyBub3RcbiAgICAgICAgICBoYW5kbGVkXG4gICAgICAgIDwvPlxuICAgICAgfVxuICAgICAgYXNpZGU9e1xuICAgICAgICA8SW5ib3hOb3RpZmljYXRpb25JY29uPlxuICAgICAgICAgIDxNaXNzaW5nSWNvbiAvPlxuICAgICAgICA8L0luYm94Tm90aWZpY2F0aW9uSWNvbj5cbiAgICAgIH1cbiAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgZGF0YS1taXNzaW5nPVwiXCJcbiAgICA+XG4gICAgICB7LyogVE9ETzogQWRkIGxpbmsgdG8gdGhlIGRvY3MgKi99XG4gICAgICBOb3RpZmljYXRpb25zIG9mIHRoaXMga2luZCB3b27igJl0IGJlIGRpc3BsYXllZCBpbiBwcm9kdWN0aW9uLiBVc2UgdGhle1wiIFwifVxuICAgICAgPGNvZGU+a2luZHM8L2NvZGU+IHByb3AgdG8gZGVmaW5lIGhvdyB0aGV5IHNob3VsZCBiZSByZW5kZXJlZC5cbiAgICA8L0luYm94Tm90aWZpY2F0aW9uQ3VzdG9tPlxuICApO1xufSk7XG5cbi8vIEtlZXBzIHRyYWNrIG9mIHdoaWNoIGluYm94IG5vdGlmaWNhdGlvbiBraW5kcyBpdCBoYXMgd2FybmVkIGFib3V0IGFscmVhZHkuXG5jb25zdCBpbmJveE5vdGlmaWNhdGlvbktpbmRzV2FybmluZ3M6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuXG4vKipcbiAqIERpc3BsYXlzIGEgc2luZ2xlIGluYm94IG5vdGlmaWNhdGlvbi5cbiAqXG4gKiBAZXhhbXBsZVxuICogPD5cbiAqICAge2luYm94Tm90aWZpY2F0aW9ucy5tYXAoKGluYm94Tm90aWZpY2F0aW9uKSA9PiAoXG4gKiAgICAgPEluYm94Tm90aWZpY2F0aW9uXG4gKiAgICAgICBrZXk9e2luYm94Tm90aWZpY2F0aW9uLmlkfVxuICogICAgICAgaW5ib3hOb3RpZmljYXRpb249e2luYm94Tm90aWZpY2F0aW9ufVxuICogICAgICAgaHJlZj17YC9yb29tcy8ke2luYm94Tm90aWZpY2F0aW9uLnJvb21JZH1gXG4gKiAgICAgLz5cbiAqICAgKSl9XG4gKiA8Lz5cbiAqL1xuZXhwb3J0IGNvbnN0IEluYm94Tm90aWZpY2F0aW9uID0gT2JqZWN0LmFzc2lnbihcbiAgZm9yd2FyZFJlZjxIVE1MQW5jaG9yRWxlbWVudCwgSW5ib3hOb3RpZmljYXRpb25Qcm9wcz4oXG4gICAgKHsgaW5ib3hOb3RpZmljYXRpb24sIGtpbmRzLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgICAgIHN3aXRjaCAoaW5ib3hOb3RpZmljYXRpb24ua2luZCkge1xuICAgICAgICBjYXNlIFwidGhyZWFkXCI6IHtcbiAgICAgICAgICBjb25zdCBSZXNvbHZlZEluYm94Tm90aWZpY2F0aW9uVGhyZWFkID1cbiAgICAgICAgICAgIGtpbmRzPy50aHJlYWQgPz8gSW5ib3hOb3RpZmljYXRpb25UaHJlYWQ7XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFJlc29sdmVkSW5ib3hOb3RpZmljYXRpb25UaHJlYWRcbiAgICAgICAgICAgICAgaW5ib3hOb3RpZmljYXRpb249e2luYm94Tm90aWZpY2F0aW9ufVxuICAgICAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FzZSBcInRleHRNZW50aW9uXCI6IHtcbiAgICAgICAgICBjb25zdCBSZXNvbHZlZEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb24gPVxuICAgICAgICAgICAga2luZHM/LnRleHRNZW50aW9uID8/IEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb247XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFJlc29sdmVkSW5ib3hOb3RpZmljYXRpb25UZXh0TWVudGlvblxuICAgICAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbj17aW5ib3hOb3RpZmljYXRpb259XG4gICAgICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgY29uc3QgUmVzb2x2ZWRJbmJveE5vdGlmaWNhdGlvbkN1c3RvbSA9XG4gICAgICAgICAgICBraW5kcz8uW2luYm94Tm90aWZpY2F0aW9uLmtpbmRdO1xuXG4gICAgICAgICAgaWYgKCFSZXNvbHZlZEluYm94Tm90aWZpY2F0aW9uQ3VzdG9tKSB7XG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgICAgICAgIGlmICghaW5ib3hOb3RpZmljYXRpb25LaW5kc1dhcm5pbmdzLmhhcyhpbmJveE5vdGlmaWNhdGlvbi5raW5kKSkge1xuICAgICAgICAgICAgICAgIGluYm94Tm90aWZpY2F0aW9uS2luZHNXYXJuaW5ncy5hZGQoaW5ib3hOb3RpZmljYXRpb24ua2luZCk7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogQWRkIGxpbmsgdG8gdGhlIGRvY3NcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICAgICBgQ3VzdG9tIG5vdGlmaWNhdGlvbiBraW5kIFwiJHtpbmJveE5vdGlmaWNhdGlvbi5raW5kfVwiIGlzIG5vdCBoYW5kbGVkIHNvIG5vdGlmaWNhdGlvbnMgb2YgdGhpcyBraW5kIHdpbGwgbm90IGJlIGRpc3BsYXllZCBpbiBwcm9kdWN0aW9uLiBVc2UgdGhlIGtpbmRzIHByb3AgdG8gZGVmaW5lIGhvdyB0aGV5IHNob3VsZCBiZSByZW5kZXJlZC5gXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEluYm94Tm90aWZpY2F0aW9uQ3VzdG9tTWlzc2luZ1xuICAgICAgICAgICAgICAgICAgaW5ib3hOb3RpZmljYXRpb249e2luYm94Tm90aWZpY2F0aW9ufVxuICAgICAgICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgICAgICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIERvbid0IHJlbmRlciBhbnl0aGluZyBpbiBwcm9kdWN0aW9uIGlmIHRoaXMgaW5ib3ggbm90aWZpY2F0aW9uIGtpbmQgaXMgbm90IGRlZmluZWQuXG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8UmVzb2x2ZWRJbmJveE5vdGlmaWNhdGlvbkN1c3RvbVxuICAgICAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbj17aW5ib3hOb3RpZmljYXRpb259XG4gICAgICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICksXG4gIHtcbiAgICBUaHJlYWQ6IEluYm94Tm90aWZpY2F0aW9uVGhyZWFkLFxuICAgIFRleHRNZW50aW9uOiBJbmJveE5vdGlmaWNhdGlvblRleHRNZW50aW9uLFxuICAgIEN1c3RvbTogSW5ib3hOb3RpZmljYXRpb25DdXN0b20sXG4gICAgSWNvbjogSW5ib3hOb3RpZmljYXRpb25JY29uLFxuICAgIEF2YXRhcjogSW5ib3hOb3RpZmljYXRpb25BdmF0YXIsXG4gIH1cbik7XG4iXSwibmFtZXMiOlsiSW5ib3hOb3RpZmljYXRpb25MYXlvdXQiLCJmb3J3YXJkUmVmIiwiaW5ib3hOb3RpZmljYXRpb24iLCJjaGlsZHJlbiIsImFzaWRlIiwidGl0bGUiLCJkYXRlIiwidW5yZWFkIiwibWFya0FzUmVhZE9uQ2xpY2siLCJvbkNsaWNrIiwiaHJlZiIsInNob3dBY3Rpb25zIiwib3ZlcnJpZGVzIiwiY29tcG9uZW50cyIsImNsYXNzTmFtZSIsImFzQ2hpbGQiLCJwcm9wcyIsImZvcndhcmRlZFJlZiIsIiQiLCJ1c2VPdmVycmlkZXMiLCJBbmNob3IiLCJ1c2VDb21wb25lbnRzIiwiQ29tcG9uZW50IiwiU2xvdCIsImlzTW9yZUFjdGlvbk9wZW4iLCJzZXRNb3JlQWN0aW9uT3BlbiIsInVzZVN0YXRlIiwibWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkIiwidXNlTWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkIiwiZGVsZXRlSW5ib3hOb3RpZmljYXRpb24iLCJ1c2VEZWxldGVJbmJveE5vdGlmaWNhdGlvbiIsImhhbmRsZUNsaWNrIiwidXNlQ2FsbGJhY2siLCJldmVudCIsInNob3VsZE1hcmtBc1JlYWRPbkNsaWNrIiwiQm9vbGVhbiIsImlkIiwic3RvcFByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHRBbmRTdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImhhbmRsZU1vcmVDbGljayIsIm9wZW4iLCJoYW5kbGVNYXJrQXNSZWFkIiwiaGFuZGxlRGVsZXRlIiwiUmVhY3RfX2RlZmF1bHQiLCJjcmVhdGVFbGVtZW50IiwiVG9vbHRpcFByb3ZpZGVyIiwiY2xhc3NOYW1lcyIsImRpciIsImtpbmQiLCJyZWYiLCJUaW1lc3RhbXAiLCJsb2NhbGUiLCJyb2xlIiwiRHJvcGRvd24iLCJvbk9wZW5DaGFuZ2UiLCJhbGlnbiIsImNvbnRlbnQiLCJGcmFnbWVudCIsIkRyb3Bkb3duSXRlbSIsIm9uU2VsZWN0IiwiQ2hlY2tJY29uIiwiSU5CT1hfTk9USUZJQ0FUSU9OX01BUktfQVNfUkVBRCIsIkRlbGV0ZUljb24iLCJJTkJPWF9OT1RJRklDQVRJT05fREVMRVRFIiwiVG9vbHRpcCIsIklOQk9YX05PVElGSUNBVElPTl9NT1JFIiwiRHJvcGRvd25NZW51VHJpZ2dlciIsIkJ1dHRvbiIsIm9uUG9pbnRlckRvd24iLCJvblBvaW50ZXJVcCIsIkVsbGlwc2lzSWNvbiIsIkluYm94Tm90aWZpY2F0aW9uSWNvbiIsIkluYm94Tm90aWZpY2F0aW9uQXZhdGFyIiwiQXZhdGFyIiwiSW5ib3hOb3RpZmljYXRpb25UaHJlYWQiLCJzaG93Um9vbU5hbWUiLCJ0aHJlYWQiLCJ1c2VJbmJveE5vdGlmaWNhdGlvblRocmVhZCIsImN1cnJlbnRVc2VySWQiLCJ1c2VDdXJyZW50VXNlcklkIiwiaW5mbyIsInVzZVJvb21JbmZvIiwicm9vbUlkIiwiY29tbWVudElkIiwidXNlTWVtbyIsImNvbnRlbnRzIiwiZ2VuZXJhdGVJbmJveE5vdGlmaWNhdGlvblRocmVhZENvbnRlbnRzIiwidHlwZSIsInJldmVyc2VkVXNlcklkcyIsInVzZXJJZHMiLCJyZXZlcnNlIiwiZmlyc3RVc2VySWQiLCJhc2lkZTIiLCJ1c2VySWQiLCJ0aXRsZTIiLCJJTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX0NPTU1FTlRTX0xJU1QiLCJMaXN0IiwidmFsdWVzIiwibWFwIiwiaW5kZXgiLCJVc2VyIiwia2V5IiwiY2FwaXRhbGl6ZSIsInJlcGxhY2VTZWxmIiwiZm9ybWF0UmVtYWluaW5nIiwiTElTVF9SRU1BSU5JTkdfVVNFUlMiLCJ0cnVuY2F0ZSIsIklOQk9YX05PVElGSUNBVElPTl9USFJFQURfTUFYX0NPTU1FTlRTIiwiUm9vbSIsImxlbmd0aCIsImNvbnRlbnQyIiwiY29tbWVudHMiLCJjb21tZW50IiwiSW5ib3hOb3RpZmljYXRpb25Db21tZW50Iiwic2hvd0hlYWRlciIsInRocmVhZElkIiwibWVudGlvblVzZXJJZCIsIm1lbnRpb25Db21tZW50IiwiSU5CT1hfTk9USUZJQ0FUSU9OX1RIUkVBRF9NRU5USU9OIiwiYXNzZXJ0TmV2ZXIiLCJyZXNvbHZlZEhyZWYiLCJyZXNvbHZlZEhyZWYyIiwidXJsIiwiZ2VuZXJhdGVVUkwiLCJJbmJveE5vdGlmaWNhdGlvblRleHRNZW50aW9uIiwicmVhZEF0Iiwibm90aWZpZWRBdCIsImNyZWF0ZWRCeSIsIklOQk9YX05PVElGSUNBVElPTl9URVhUX01FTlRJT04iLCJJbmJveE5vdGlmaWNhdGlvbkN1c3RvbSIsIkluYm94Tm90aWZpY2F0aW9uQ3VzdG9tTWlzc2luZyIsIk1pc3NpbmdJY29uIiwiaW5ib3hOb3RpZmljYXRpb25LaW5kc1dhcm5pbmdzIiwiU2V0IiwiSW5ib3hOb3RpZmljYXRpb24iLCJPYmplY3QiLCJhc3NpZ24iLCJraW5kcyIsIlJlc29sdmVkSW5ib3hOb3RpZmljYXRpb25UaHJlYWQiLCJSZXNvbHZlZEluYm94Tm90aWZpY2F0aW9uVGV4dE1lbnRpb24iLCJ0ZXh0TWVudGlvbiIsIlJlc29sdmVkSW5ib3hOb3RpZmljYXRpb25DdXN0b20iLCJwcm9jZXNzIiwiaGFzIiwiYWRkIiwiY29uc29sZSIsIndhcm4iLCJUaHJlYWQiLCJUZXh0TWVudGlvbiIsIkN1c3RvbSIsIkljb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/InboxNotification.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/InboxNotificationList.mjs":
/*!*************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/InboxNotificationList.mjs ***!
  \*************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   InboxNotificationList: () => (/* binding */ InboxNotificationList)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* __next_internal_client_entry_do_not_use__ InboxNotificationList auto */ \n\nconst InboxNotificationList = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, className, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"ol\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__.classNames)(\"lb-root lb-inbox-notification-list\", className),\n        ...props,\n        ref: forwardedRef\n    }, react__WEBPACK_IMPORTED_MODULE_0__.Children.map(children, (child, index)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"li\", {\n            key: index,\n            className: \"lb-inbox-notification-list-item\"\n        }, child)));\n});\n //# sourceMappingURL=InboxNotificationList.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL0luYm94Tm90aWZpY2F0aW9uTGlzdC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFtQmEsTUFBQUEsc0NBQUFDLGlEQUFBQSxDQUFBLEdBQUFDLFFBQUEsRUFBQUMsU0FBQSxLQUFBQyxPQUFBLEVBQUFDO0lBSVgscUNBQUFDLGdEQUFBO1FBQ0dILFdBQUFLLGtFQUFBQSxDQUFBLHNDQUFBTDtRQUNzRSxHQUFBQyxLQUFBO1FBQ2pFSyxLQUFBSjtJQUNDLEdBQUFLLDJDQUFBQSxDQUFBQyxHQUFBLENBQUFULFVBQUEsQ0FBQVUsT0FBQUMsUUFBQSw4QkFBQVAsZ0RBQUE7WUFHRlEsS0FBQUQ7WUFBUVYsV0FBQTtRQUFpQixHQUFBUztBQU1sQyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uL3NyYy9jb21wb25lbnRzL0luYm94Tm90aWZpY2F0aW9uTGlzdC50c3g/NjQ1NSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcblxuaW1wb3J0IHR5cGUgeyBDb21wb25lbnRQcm9wc1dpdGhvdXRSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwgeyBDaGlsZHJlbiwgZm9yd2FyZFJlZiB9IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSBcIi4uL3V0aWxzL2NsYXNzLW5hbWVzXCI7XG5cbmV4cG9ydCB0eXBlIEluYm94Tm90aWZpY2F0aW9uTGlzdFByb3BzID0gQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmPFwib2xcIj47XG5cbi8qKlxuICogRGlzcGxheXMgaW5ib3ggbm90aWZpY2F0aW9ucyBhcyBhIGxpc3QuXG4gKlxuICogQGV4YW1wbGVcbiAqIDxJbmJveE5vdGlmaWNhdGlvbkxpc3Q+XG4gKiAgIHtpbmJveE5vdGlmaWNhdGlvbnMubWFwKChpbmJveE5vdGlmaWNhdGlvbikgPT4gKFxuICogICAgIDxJbmJveE5vdGlmaWNhdGlvbiBrZXk9e2luYm94Tm90aWZpY2F0aW9uLmlkfSBpbmJveE5vdGlmaWNhdGlvbj17aW5ib3hOb3RpZmljYXRpb259IC8+XG4gKiAgICkpfVxuICogPC9JbmJveE5vdGlmaWNhdGlvbkxpc3Q+XG4gKi9cbmV4cG9ydCBjb25zdCBJbmJveE5vdGlmaWNhdGlvbkxpc3QgPSBmb3J3YXJkUmVmPFxuICBIVE1MT0xpc3RFbGVtZW50LFxuICBJbmJveE5vdGlmaWNhdGlvbkxpc3RQcm9wc1xuPigoeyBjaGlsZHJlbiwgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgcmV0dXJuIChcbiAgICA8b2xcbiAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImxiLXJvb3QgbGItaW5ib3gtbm90aWZpY2F0aW9uLWxpc3RcIiwgY2xhc3NOYW1lKX1cbiAgICAgIHsuLi5wcm9wc31cbiAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgID5cbiAgICAgIHtDaGlsZHJlbi5tYXAoY2hpbGRyZW4sIChjaGlsZCwgaW5kZXgpID0+IChcbiAgICAgICAgPGxpIGtleT17aW5kZXh9IGNsYXNzTmFtZT1cImxiLWluYm94LW5vdGlmaWNhdGlvbi1saXN0LWl0ZW1cIj5cbiAgICAgICAgICB7Y2hpbGR9XG4gICAgICAgIDwvbGk+XG4gICAgICApKX1cbiAgICA8L29sPlxuICApO1xufSk7XG4iXSwibmFtZXMiOlsiSW5ib3hOb3RpZmljYXRpb25MaXN0IiwiZm9yd2FyZFJlZiIsImNoaWxkcmVuIiwiY2xhc3NOYW1lIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJSZWFjdF9fZGVmYXVsdCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWVzIiwicmVmIiwiQ2hpbGRyZW4iLCJtYXAiLCJjaGlsZCIsImluZGV4Iiwia2V5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/InboxNotificationList.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Thread.mjs":
/*!**********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/Thread.mjs ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Thread: () => (/* binding */ Thread)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _radix_ui_react_toggle__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @radix-ui/react-toggle */ \"(ssr)/./node_modules/@radix-ui/react-toggle/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _icons_ArrowDown_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../icons/ArrowDown.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/ArrowDown.mjs\");\n/* harmony import */ var _icons_Resolve_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../icons/Resolve.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Resolve.mjs\");\n/* harmony import */ var _icons_Resolved_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../icons/Resolved.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Resolved.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_find_last_index_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/find-last-index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/find-last-index.mjs\");\n/* harmony import */ var _Comment_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Comment.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Comment.mjs\");\n/* harmony import */ var _Composer_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./Composer.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Composer.mjs\");\n/* harmony import */ var _internal_Button_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./internal/Button.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs\");\n/* harmony import */ var _internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./internal/Tooltip.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs\");\n/* harmony import */ var _radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @radix-ui/react-tooltip */ \"(ssr)/./node_modules/@radix-ui/react-tooltip/dist/index.mjs\");\n/* __next_internal_client_entry_do_not_use__ Thread auto */ \n\n\n\n\n\n\n\n\n\n\n\n\n\nconst Thread = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ thread, indentCommentContent = true, showActions = \"hover\", showDeletedComments, showResolveAction = true, showReactions = true, showComposer = \"collapsed\", onResolvedChange, onCommentEdit, onCommentDelete, onThreadDelete, onAuthorClick, onMentionClick, overrides, className, ...props }, forwardedRef)=>{\n    const markThreadAsResolved = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__.useMarkThreadAsResolved)();\n    const markThreadAsUnresolved = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__.useMarkThreadAsUnresolved)();\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_2__.useOverrides)(overrides);\n    const firstCommentIndex = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return showDeletedComments ? 0 : thread.comments.findIndex((comment)=>comment.body);\n    }, [\n        showDeletedComments,\n        thread.comments\n    ]);\n    const lastCommentIndex = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return showDeletedComments ? thread.comments.length - 1 : (0,_utils_find_last_index_mjs__WEBPACK_IMPORTED_MODULE_3__.findLastIndex)(thread.comments, (comment)=>comment.body);\n    }, [\n        showDeletedComments,\n        thread.comments\n    ]);\n    const { status: subscriptionStatus, unreadSince } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__.useThreadSubscription)(thread.id);\n    const unreadIndex = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        if (subscriptionStatus !== \"subscribed\") {\n            return;\n        }\n        if (unreadSince === null) {\n            return firstCommentIndex;\n        }\n        const unreadIndex2 = thread.comments.findIndex((comment)=>(showDeletedComments ? true : comment.body) && comment.createdAt > unreadSince);\n        return unreadIndex2 >= 0 && unreadIndex2 < thread.comments.length ? unreadIndex2 : void 0;\n    }, [\n        firstCommentIndex,\n        showDeletedComments,\n        subscriptionStatus,\n        thread.comments,\n        unreadSince\n    ]);\n    const [newIndex, setNewIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)();\n    const newIndicatorIndex = newIndex === void 0 ? unreadIndex : newIndex;\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (unreadIndex) {\n            setNewIndex((persistedUnreadIndex)=>Math.min(persistedUnreadIndex ?? Infinity, unreadIndex));\n        }\n    }, [\n        unreadIndex\n    ]);\n    const stopPropagation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.stopPropagation();\n    }, []);\n    const handleResolvedChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((resolved)=>{\n        onResolvedChange?.(resolved);\n        if (resolved) {\n            markThreadAsResolved(thread.id);\n        } else {\n            markThreadAsUnresolved(thread.id);\n        }\n    }, [\n        markThreadAsResolved,\n        markThreadAsUnresolved,\n        onResolvedChange,\n        thread.id\n    ]);\n    const handleCommentDelete = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((comment)=>{\n        onCommentDelete?.(comment);\n        const filteredComments = thread.comments.filter((comment2)=>comment2.body);\n        if (filteredComments.length <= 1) {\n            onThreadDelete?.(thread);\n        }\n    }, [\n        onCommentDelete,\n        onThreadDelete,\n        thread\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_4__.TooltipProvider, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_5__.classNames)(\"lb-root lb-thread\", showActions === \"hover\" && \"lb-thread:show-actions-hover\", className),\n        \"data-resolved\": thread.resolved ? \"\" : void 0,\n        \"data-unread\": unreadIndex !== void 0 ? \"\" : void 0,\n        dir: $.dir,\n        ...props,\n        ref: forwardedRef\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: \"lb-thread-comments\"\n    }, thread.comments.map((comment, index)=>{\n        const isFirstComment = index === firstCommentIndex;\n        const isUnread = unreadIndex !== void 0 && index >= unreadIndex;\n        const children = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Comment_mjs__WEBPACK_IMPORTED_MODULE_6__.Comment, {\n            key: comment.id,\n            className: \"lb-thread-comment\",\n            \"data-unread\": isUnread ? \"\" : void 0,\n            comment,\n            indentContent: indentCommentContent,\n            showDeleted: showDeletedComments,\n            showActions,\n            showReactions,\n            onCommentEdit,\n            onCommentDelete: handleCommentDelete,\n            onAuthorClick,\n            onMentionClick,\n            autoMarkReadThreadId: index === lastCommentIndex && isUnread ? thread.id : void 0,\n            additionalActionsClassName: isFirstComment ? \"lb-thread-actions\" : void 0,\n            additionalActions: isFirstComment && showResolveAction ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Tooltip_mjs__WEBPACK_IMPORTED_MODULE_7__.Tooltip, {\n                content: thread.resolved ? $.THREAD_UNRESOLVE : $.THREAD_RESOLVE\n            }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_radix_ui_react_toggle__WEBPACK_IMPORTED_MODULE_8__.Root, {\n                pressed: thread.resolved,\n                onPressedChange: handleResolvedChange,\n                asChild: true\n            }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Button_mjs__WEBPACK_IMPORTED_MODULE_9__.Button, {\n                className: \"lb-comment-action\",\n                onClick: stopPropagation,\n                \"aria-label\": thread.resolved ? $.THREAD_UNRESOLVE : $.THREAD_RESOLVE\n            }, thread.resolved ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Resolved_mjs__WEBPACK_IMPORTED_MODULE_10__.ResolvedIcon, {\n                className: \"lb-button-icon\"\n            }) : /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_Resolve_mjs__WEBPACK_IMPORTED_MODULE_11__.ResolveIcon, {\n                className: \"lb-button-icon\"\n            })))) : null\n        });\n        return index === newIndicatorIndex && newIndicatorIndex !== firstCommentIndex && newIndicatorIndex <= lastCommentIndex ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, {\n            key: comment.id\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            className: \"lb-thread-new-indicator\",\n            \"aria-label\": $.THREAD_NEW_INDICATOR_DESCRIPTION\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n            className: \"lb-thread-new-indicator-label\"\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icons_ArrowDown_mjs__WEBPACK_IMPORTED_MODULE_12__.ArrowDownIcon, {\n            className: \"lb-thread-new-indicator-label-icon\"\n        }), $.THREAD_NEW_INDICATOR)), children) : children;\n    })), showComposer && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Composer_mjs__WEBPACK_IMPORTED_MODULE_13__.Composer, {\n        className: \"lb-thread-composer\",\n        threadId: thread.id,\n        defaultCollapsed: showComposer === \"collapsed\" ? true : void 0,\n        overrides: {\n            COMPOSER_PLACEHOLDER: $.THREAD_COMPOSER_PLACEHOLDER,\n            COMPOSER_SEND: $.THREAD_COMPOSER_SEND\n        }\n    })));\n});\n //# sourceMappingURL=Thread.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL1RocmVhZC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzSU8sTUFBQUEsdUJBQUFDLGlEQUFBQSxDQUFlLEdBRWxCQyxNQUFBLEVBQ0VDLHVCQUFBLE1BQ3VCQyxjQUFBLFNBQ1RDLG1CQUFBLEVBQ2RDLG9CQUFBLE1BQ29CQyxnQkFBQSxNQUNKQyxlQUFBLGFBQ0RDLGdCQUFBLEVBQ2ZDLGFBQUEsRUFDQUMsZUFBQSxFQUNBQyxjQUFBLEVBQ0FDLGFBQUEsRUFDQUMsY0FBQSxFQUNBQyxTQUFBLEVBQ0FDLFNBQUEsRUFDQSxHQUFBQyxPQUNHLEVBQUFDO0lBSUwsTUFBQUMsdUJBQUFDLDBFQUFBQTtJQUNBLE1BQUFDLHlCQUFBQyw0RUFBQUE7SUFDQSxNQUFBQyxJQUFBQyw0REFBQUEsQ0FBQVQ7SUFDQSxNQUFBVSxvQkFBQUMsOENBQUFBLENBQUE7UUFDRSxPQUFBckIsc0JBQUEsSUFBQUgsT0FBQXlCLFFBQUEsQ0FBQUMsU0FBQSxFQUFBQyxVQUFBQSxRQUFBQyxJQUFBO0lBRXVEO1FBQUF6QjtRQUFBSCxPQUFBeUIsUUFBQTtLQUFBO0lBRXpELE1BQUFJLG1CQUFBTCw4Q0FBQUEsQ0FBQTtRQUNFLE9BQUFyQixzQkFBQUgsT0FBQXlCLFFBQUEsQ0FBQUssTUFBQSxPQUFBQyx5RUFBQUEsQ0FBQS9CLE9BQUF5QixRQUFBLEdBQUFFLFVBQUFBLFFBQUFDLElBQUE7SUFFNEQ7UUFBQXpCO1FBQUFILE9BQUF5QixRQUFBO0tBQUE7SUFFOUQsUUFBQU8sUUFBQUMsa0JBQUEsRUFBQUMsV0FBQSxLQUFBQyx3RUFBQUEsQ0FBb0RuQyxPQUFBb0MsRUFBQTtJQUdwRCxNQUFBQyxjQUFBYiw4Q0FBQUEsQ0FBQTtRQUVFLElBQUFTLHVCQUFBO1lBQ0U7UUFBQTtRQUlGLElBQUFDLGdCQUFBO1lBQ0UsT0FBQVg7UUFBTztR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QUEwRCxjQUFBO1lBSUQsR0FBQS9FLE9BQUFxRCxRQUFBLGlDQUFBSyxnREFBQSxDQUFBNkIsOERBQUFBLEVBQUE7Z0JBSUx6RSxXQUFBO1lBQXVCLG1DQUFBNEMsZ0RBQUEsQ0FBQThCLDREQUFBQSxFQUFBO2dCQUV2QjFFLFdBQUE7WUFBc0I7UUFLN0I7UUFLVixPQUFBbUQsVUFBQXRCLHFCQUFBQSxzQkFBQXBCLHFCQUFBb0IscUJBQUFkLG1CQUFBLDhCQUFBNkIsZ0RBQUEsQ0FBQStCLDJDQUFBQSxFQUFBO1lBR0duQixLQUFBM0MsUUFBQVMsRUFBQTtRQUFzQixpQ0FBQXNCLGdEQUFBO1lBQ3BCNUMsV0FBQTtZQUNXLGNBQUFPLEVBQUFxRSxnQ0FBQTtRQUNJLGlDQUFBaEMsZ0RBQUE7WUFFYjVDLFdBQUE7UUFBZSxpQ0FBQTRDLGdEQUFBLENBQUFpQyxnRUFBQUEsRUFBQTtZQUNiN0UsV0FBQTtRQUF3QixJQUFBTyxFQUFBdUUsb0JBQUEsSUFBQXhCLFlBQUFBO0lBTy9CLEtBQUE5RCxnQkFBQSw4QkFBQW9ELGdEQUFBLENBQUFtQyxvREFBQUEsRUFBQTtRQUtIL0UsV0FBQTtRQUNXZ0YsVUFBQTlGLE9BQUFvQyxFQUFBO1FBQ08yRCxrQkFBQXpGLGlCQUFBO1FBQ3VDTyxXQUFBO1lBQzdDbUYsc0JBQUEzRSxFQUFBNEUsMkJBQUE7WUFDZUMsZUFBQTdFLEVBQUE4RSxvQkFBQTtRQUNQO0lBQ25CO0FBSVIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uLi8uLi9zcmMvY29tcG9uZW50cy9UaHJlYWQudHN4P2E1YjYiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB0eXBlIHtcbiAgQmFzZU1ldGFkYXRhLFxuICBDb21tZW50RGF0YSxcbiAgRE0sXG4gIFRocmVhZERhdGEsXG59IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5pbXBvcnQge1xuICB1c2VNYXJrVGhyZWFkQXNSZXNvbHZlZCxcbiAgdXNlTWFya1RocmVhZEFzVW5yZXNvbHZlZCxcbiAgdXNlVGhyZWFkU3Vic2NyaXB0aW9uLFxufSBmcm9tIFwiQGxpdmVibG9ja3MvcmVhY3RcIjtcbmltcG9ydCAqIGFzIFRvZ2dsZVByaW1pdGl2ZSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LXRvZ2dsZVwiO1xuaW1wb3J0IHR5cGUge1xuICBDb21wb25lbnRQcm9wc1dpdGhvdXRSZWYsXG4gIEZvcndhcmRlZFJlZixcbiAgUmVmQXR0cmlidXRlcyxcbiAgU3ludGhldGljRXZlbnQsXG59IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IFJlYWN0LCB7XG4gIGZvcndhcmRSZWYsXG4gIEZyYWdtZW50LFxuICB1c2VDYWxsYmFjayxcbiAgdXNlRWZmZWN0LFxuICB1c2VNZW1vLFxuICB1c2VTdGF0ZSxcbn0gZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB7IEFycm93RG93bkljb24gfSBmcm9tIFwiLi4vaWNvbnMvQXJyb3dEb3duXCI7XG5pbXBvcnQgeyBSZXNvbHZlSWNvbiB9IGZyb20gXCIuLi9pY29ucy9SZXNvbHZlXCI7XG5pbXBvcnQgeyBSZXNvbHZlZEljb24gfSBmcm9tIFwiLi4vaWNvbnMvUmVzb2x2ZWRcIjtcbmltcG9ydCB0eXBlIHtcbiAgQ29tbWVudE92ZXJyaWRlcyxcbiAgQ29tcG9zZXJPdmVycmlkZXMsXG4gIEdsb2JhbE92ZXJyaWRlcyxcbiAgVGhyZWFkT3ZlcnJpZGVzLFxufSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyB1c2VPdmVycmlkZXMgfSBmcm9tIFwiLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSBcIi4uL3V0aWxzL2NsYXNzLW5hbWVzXCI7XG5pbXBvcnQgeyBmaW5kTGFzdEluZGV4IH0gZnJvbSBcIi4uL3V0aWxzL2ZpbmQtbGFzdC1pbmRleFwiO1xuaW1wb3J0IHR5cGUgeyBDb21tZW50UHJvcHMgfSBmcm9tIFwiLi9Db21tZW50XCI7XG5pbXBvcnQgeyBDb21tZW50IH0gZnJvbSBcIi4vQ29tbWVudFwiO1xuaW1wb3J0IHsgQ29tcG9zZXIgfSBmcm9tIFwiLi9Db21wb3NlclwiO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSBcIi4vaW50ZXJuYWwvQnV0dG9uXCI7XG5pbXBvcnQgeyBUb29sdGlwLCBUb29sdGlwUHJvdmlkZXIgfSBmcm9tIFwiLi9pbnRlcm5hbC9Ub29sdGlwXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGhyZWFkUHJvcHM8TSBleHRlbmRzIEJhc2VNZXRhZGF0YSA9IERNPlxuICBleHRlbmRzIENvbXBvbmVudFByb3BzV2l0aG91dFJlZjxcImRpdlwiPiB7XG4gIC8qKlxuICAgKiBUaGUgdGhyZWFkIHRvIGRpc3BsYXkuXG4gICAqL1xuICB0aHJlYWQ6IFRocmVhZERhdGE8TT47XG5cbiAgLyoqXG4gICAqIEhvdyB0byBzaG93IG9yIGhpZGUgdGhlIGNvbXBvc2VyIHRvIHJlcGx5IHRvIHRoZSB0aHJlYWQuXG4gICAqL1xuICBzaG93Q29tcG9zZXI/OiBib29sZWFuIHwgXCJjb2xsYXBzZWRcIjtcblxuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHRoZSBhY3Rpb24gdG8gcmVzb2x2ZSB0aGUgdGhyZWFkLlxuICAgKi9cbiAgc2hvd1Jlc29sdmVBY3Rpb24/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBIb3cgdG8gc2hvdyBvciBoaWRlIHRoZSBhY3Rpb25zLlxuICAgKi9cbiAgc2hvd0FjdGlvbnM/OiBDb21tZW50UHJvcHNbXCJzaG93QWN0aW9uc1wiXTtcblxuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHJlYWN0aW9ucy5cbiAgICovXG4gIHNob3dSZWFjdGlvbnM/OiBDb21tZW50UHJvcHNbXCJzaG93UmVhY3Rpb25zXCJdO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGluZGVudCB0aGUgY29tbWVudHMnIGNvbnRlbnQuXG4gICAqL1xuICBpbmRlbnRDb21tZW50Q29udGVudD86IENvbW1lbnRQcm9wc1tcImluZGVudENvbnRlbnRcIl07XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gc2hvdyBkZWxldGVkIGNvbW1lbnRzLlxuICAgKi9cbiAgc2hvd0RlbGV0ZWRDb21tZW50cz86IENvbW1lbnRQcm9wc1tcInNob3dEZWxldGVkXCJdO1xuXG4gIC8qKlxuICAgKiBUaGUgZXZlbnQgaGFuZGxlciBjYWxsZWQgd2hlbiBjaGFuZ2luZyB0aGUgcmVzb2x2ZWQgc3RhdHVzLlxuICAgKi9cbiAgb25SZXNvbHZlZENoYW5nZT86IChyZXNvbHZlZDogYm9vbGVhbikgPT4gdm9pZDtcblxuICAvKipcbiAgICogVGhlIGV2ZW50IGhhbmRsZXIgY2FsbGVkIHdoZW4gYSBjb21tZW50IGlzIGVkaXRlZC5cbiAgICovXG4gIG9uQ29tbWVudEVkaXQ/OiBDb21tZW50UHJvcHNbXCJvbkNvbW1lbnRFZGl0XCJdO1xuXG4gIC8qKlxuICAgKiBUaGUgZXZlbnQgaGFuZGxlciBjYWxsZWQgd2hlbiBhIGNvbW1lbnQgaXMgZGVsZXRlZC5cbiAgICovXG4gIG9uQ29tbWVudERlbGV0ZT86IENvbW1lbnRQcm9wc1tcIm9uQ29tbWVudERlbGV0ZVwiXTtcblxuICAvKipcbiAgICogVGhlIGV2ZW50IGhhbmRsZXIgY2FsbGVkIHdoZW4gdGhlIHRocmVhZCBpcyBkZWxldGVkLlxuICAgKiBBIHRocmVhZCBpcyBkZWxldGVkIHdoZW4gYWxsIGl0cyBjb21tZW50cyBhcmUgZGVsZXRlZC5cbiAgICovXG4gIG9uVGhyZWFkRGVsZXRlPzogKHRocmVhZDogVGhyZWFkRGF0YTxNPikgPT4gdm9pZDtcblxuICAvKipcbiAgICogVGhlIGV2ZW50IGhhbmRsZXIgY2FsbGVkIHdoZW4gY2xpY2tpbmcgb24gYSBjb21tZW50J3MgYXV0aG9yLlxuICAgKi9cbiAgb25BdXRob3JDbGljaz86IENvbW1lbnRQcm9wc1tcIm9uQXV0aG9yQ2xpY2tcIl07XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBoYW5kbGVyIGNhbGxlZCB3aGVuIGNsaWNraW5nIG9uIGEgbWVudGlvbi5cbiAgICovXG4gIG9uTWVudGlvbkNsaWNrPzogQ29tbWVudFByb3BzW1wib25NZW50aW9uQ2xpY2tcIl07XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlIHRoZSBjb21wb25lbnQncyBzdHJpbmdzLlxuICAgKi9cbiAgb3ZlcnJpZGVzPzogUGFydGlhbDxcbiAgICBHbG9iYWxPdmVycmlkZXMgJiBUaHJlYWRPdmVycmlkZXMgJiBDb21tZW50T3ZlcnJpZGVzICYgQ29tcG9zZXJPdmVycmlkZXNcbiAgPjtcbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhIHRocmVhZCBvZiBjb21tZW50cywgd2l0aCBhIGNvbXBvc2VyIHRvIHJlcGx5XG4gKiB0byBpdC5cbiAqXG4gKiBAZXhhbXBsZVxuICogPD5cbiAqICAge3RocmVhZHMubWFwKCh0aHJlYWQpID0+IChcbiAqICAgICA8VGhyZWFkIGtleT17dGhyZWFkLmlkfSB0aHJlYWQ9e3RocmVhZH0gLz5cbiAqICAgKSl9XG4gKiA8Lz5cbiAqL1xuZXhwb3J0IGNvbnN0IFRocmVhZCA9IGZvcndhcmRSZWYoXG4gIDxNIGV4dGVuZHMgQmFzZU1ldGFkYXRhID0gRE0+KFxuICAgIHtcbiAgICAgIHRocmVhZCxcbiAgICAgIGluZGVudENvbW1lbnRDb250ZW50ID0gdHJ1ZSxcbiAgICAgIHNob3dBY3Rpb25zID0gXCJob3ZlclwiLFxuICAgICAgc2hvd0RlbGV0ZWRDb21tZW50cyxcbiAgICAgIHNob3dSZXNvbHZlQWN0aW9uID0gdHJ1ZSxcbiAgICAgIHNob3dSZWFjdGlvbnMgPSB0cnVlLFxuICAgICAgc2hvd0NvbXBvc2VyID0gXCJjb2xsYXBzZWRcIixcbiAgICAgIG9uUmVzb2x2ZWRDaGFuZ2UsXG4gICAgICBvbkNvbW1lbnRFZGl0LFxuICAgICAgb25Db21tZW50RGVsZXRlLFxuICAgICAgb25UaHJlYWREZWxldGUsXG4gICAgICBvbkF1dGhvckNsaWNrLFxuICAgICAgb25NZW50aW9uQ2xpY2ssXG4gICAgICBvdmVycmlkZXMsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICAuLi5wcm9wc1xuICAgIH06IFRocmVhZFByb3BzPE0+LFxuICAgIGZvcndhcmRlZFJlZjogRm9yd2FyZGVkUmVmPEhUTUxEaXZFbGVtZW50PlxuICApID0+IHtcbiAgICBjb25zdCBtYXJrVGhyZWFkQXNSZXNvbHZlZCA9IHVzZU1hcmtUaHJlYWRBc1Jlc29sdmVkKCk7XG4gICAgY29uc3QgbWFya1RocmVhZEFzVW5yZXNvbHZlZCA9IHVzZU1hcmtUaHJlYWRBc1VucmVzb2x2ZWQoKTtcbiAgICBjb25zdCAkID0gdXNlT3ZlcnJpZGVzKG92ZXJyaWRlcyk7XG4gICAgY29uc3QgZmlyc3RDb21tZW50SW5kZXggPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiBzaG93RGVsZXRlZENvbW1lbnRzXG4gICAgICAgID8gMFxuICAgICAgICA6IHRocmVhZC5jb21tZW50cy5maW5kSW5kZXgoKGNvbW1lbnQpID0+IGNvbW1lbnQuYm9keSk7XG4gICAgfSwgW3Nob3dEZWxldGVkQ29tbWVudHMsIHRocmVhZC5jb21tZW50c10pO1xuICAgIGNvbnN0IGxhc3RDb21tZW50SW5kZXggPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiBzaG93RGVsZXRlZENvbW1lbnRzXG4gICAgICAgID8gdGhyZWFkLmNvbW1lbnRzLmxlbmd0aCAtIDFcbiAgICAgICAgOiBmaW5kTGFzdEluZGV4KHRocmVhZC5jb21tZW50cywgKGNvbW1lbnQpID0+IGNvbW1lbnQuYm9keSk7XG4gICAgfSwgW3Nob3dEZWxldGVkQ29tbWVudHMsIHRocmVhZC5jb21tZW50c10pO1xuICAgIGNvbnN0IHsgc3RhdHVzOiBzdWJzY3JpcHRpb25TdGF0dXMsIHVucmVhZFNpbmNlIH0gPSB1c2VUaHJlYWRTdWJzY3JpcHRpb24oXG4gICAgICB0aHJlYWQuaWRcbiAgICApO1xuICAgIGNvbnN0IHVucmVhZEluZGV4ID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAvLyBUaGUgdXNlciBpcyBub3Qgc3Vic2NyaWJlZCB0byB0aGlzIHRocmVhZC5cbiAgICAgIGlmIChzdWJzY3JpcHRpb25TdGF0dXMgIT09IFwic3Vic2NyaWJlZFwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gVGhlIHVzZXIgaGFzbid0IHJlYWQgdGhlIHRocmVhZCB5ZXQsIHNvIGFsbCBjb21tZW50cyBhcmUgdW5yZWFkLlxuICAgICAgaWYgKHVucmVhZFNpbmNlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmaXJzdENvbW1lbnRJbmRleDtcbiAgICAgIH1cblxuICAgICAgLy8gVGhlIHVzZXIgaGFzIHJlYWQgdGhlIHRocmVhZCwgc28gd2UgZmluZCB0aGUgZmlyc3QgdW5yZWFkIGNvbW1lbnQuXG4gICAgICBjb25zdCB1bnJlYWRJbmRleCA9IHRocmVhZC5jb21tZW50cy5maW5kSW5kZXgoXG4gICAgICAgIChjb21tZW50KSA9PlxuICAgICAgICAgIChzaG93RGVsZXRlZENvbW1lbnRzID8gdHJ1ZSA6IGNvbW1lbnQuYm9keSkgJiZcbiAgICAgICAgICBjb21tZW50LmNyZWF0ZWRBdCA+IHVucmVhZFNpbmNlXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdW5yZWFkSW5kZXggPj0gMCAmJiB1bnJlYWRJbmRleCA8IHRocmVhZC5jb21tZW50cy5sZW5ndGhcbiAgICAgICAgPyB1bnJlYWRJbmRleFxuICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICB9LCBbXG4gICAgICBmaXJzdENvbW1lbnRJbmRleCxcbiAgICAgIHNob3dEZWxldGVkQ29tbWVudHMsXG4gICAgICBzdWJzY3JpcHRpb25TdGF0dXMsXG4gICAgICB0aHJlYWQuY29tbWVudHMsXG4gICAgICB1bnJlYWRTaW5jZSxcbiAgICBdKTtcbiAgICBjb25zdCBbbmV3SW5kZXgsIHNldE5ld0luZGV4XSA9IHVzZVN0YXRlPG51bWJlcj4oKTtcbiAgICBjb25zdCBuZXdJbmRpY2F0b3JJbmRleCA9IG5ld0luZGV4ID09PSB1bmRlZmluZWQgPyB1bnJlYWRJbmRleCA6IG5ld0luZGV4O1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICh1bnJlYWRJbmRleCkge1xuICAgICAgICAvLyBLZWVwIHRoZSBcIm5ld1wiIGluZGljYXRvciBhdCB0aGUgbG93ZXN0IHVucmVhZCBpbmRleC5cbiAgICAgICAgc2V0TmV3SW5kZXgoKHBlcnNpc3RlZFVucmVhZEluZGV4KSA9PlxuICAgICAgICAgIE1hdGgubWluKHBlcnNpc3RlZFVucmVhZEluZGV4ID8/IEluZmluaXR5LCB1bnJlYWRJbmRleClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LCBbdW5yZWFkSW5kZXhdKTtcblxuICAgIGNvbnN0IHN0b3BQcm9wYWdhdGlvbiA9IHVzZUNhbGxiYWNrKChldmVudDogU3ludGhldGljRXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0sIFtdKTtcblxuICAgIGNvbnN0IGhhbmRsZVJlc29sdmVkQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgICAocmVzb2x2ZWQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgb25SZXNvbHZlZENoYW5nZT8uKHJlc29sdmVkKTtcblxuICAgICAgICBpZiAocmVzb2x2ZWQpIHtcbiAgICAgICAgICBtYXJrVGhyZWFkQXNSZXNvbHZlZCh0aHJlYWQuaWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hcmtUaHJlYWRBc1VucmVzb2x2ZWQodGhyZWFkLmlkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtcbiAgICAgICAgbWFya1RocmVhZEFzUmVzb2x2ZWQsXG4gICAgICAgIG1hcmtUaHJlYWRBc1VucmVzb2x2ZWQsXG4gICAgICAgIG9uUmVzb2x2ZWRDaGFuZ2UsXG4gICAgICAgIHRocmVhZC5pZCxcbiAgICAgIF1cbiAgICApO1xuXG4gICAgY29uc3QgaGFuZGxlQ29tbWVudERlbGV0ZSA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGNvbW1lbnQ6IENvbW1lbnREYXRhKSA9PiB7XG4gICAgICAgIG9uQ29tbWVudERlbGV0ZT8uKGNvbW1lbnQpO1xuXG4gICAgICAgIGNvbnN0IGZpbHRlcmVkQ29tbWVudHMgPSB0aHJlYWQuY29tbWVudHMuZmlsdGVyKFxuICAgICAgICAgIChjb21tZW50KSA9PiBjb21tZW50LmJvZHlcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoZmlsdGVyZWRDb21tZW50cy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgIG9uVGhyZWFkRGVsZXRlPy4odGhyZWFkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtvbkNvbW1lbnREZWxldGUsIG9uVGhyZWFkRGVsZXRlLCB0aHJlYWRdXG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8VG9vbHRpcFByb3ZpZGVyPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFxuICAgICAgICAgICAgXCJsYi1yb290IGxiLXRocmVhZFwiLFxuICAgICAgICAgICAgc2hvd0FjdGlvbnMgPT09IFwiaG92ZXJcIiAmJiBcImxiLXRocmVhZDpzaG93LWFjdGlvbnMtaG92ZXJcIixcbiAgICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICAgICl9XG4gICAgICAgICAgZGF0YS1yZXNvbHZlZD17dGhyZWFkLnJlc29sdmVkID8gXCJcIiA6IHVuZGVmaW5lZH1cbiAgICAgICAgICBkYXRhLXVucmVhZD17dW5yZWFkSW5kZXggIT09IHVuZGVmaW5lZCA/IFwiXCIgOiB1bmRlZmluZWR9XG4gICAgICAgICAgZGlyPXskLmRpcn1cbiAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxiLXRocmVhZC1jb21tZW50c1wiPlxuICAgICAgICAgICAge3RocmVhZC5jb21tZW50cy5tYXAoKGNvbW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGlzRmlyc3RDb21tZW50ID0gaW5kZXggPT09IGZpcnN0Q29tbWVudEluZGV4O1xuICAgICAgICAgICAgICBjb25zdCBpc1VucmVhZCA9XG4gICAgICAgICAgICAgICAgdW5yZWFkSW5kZXggIT09IHVuZGVmaW5lZCAmJiBpbmRleCA+PSB1bnJlYWRJbmRleDtcblxuICAgICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IChcbiAgICAgICAgICAgICAgICA8Q29tbWVudFxuICAgICAgICAgICAgICAgICAga2V5PXtjb21tZW50LmlkfVxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItdGhyZWFkLWNvbW1lbnRcIlxuICAgICAgICAgICAgICAgICAgZGF0YS11bnJlYWQ9e2lzVW5yZWFkID8gXCJcIiA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgIGNvbW1lbnQ9e2NvbW1lbnR9XG4gICAgICAgICAgICAgICAgICBpbmRlbnRDb250ZW50PXtpbmRlbnRDb21tZW50Q29udGVudH1cbiAgICAgICAgICAgICAgICAgIHNob3dEZWxldGVkPXtzaG93RGVsZXRlZENvbW1lbnRzfVxuICAgICAgICAgICAgICAgICAgc2hvd0FjdGlvbnM9e3Nob3dBY3Rpb25zfVxuICAgICAgICAgICAgICAgICAgc2hvd1JlYWN0aW9ucz17c2hvd1JlYWN0aW9uc31cbiAgICAgICAgICAgICAgICAgIG9uQ29tbWVudEVkaXQ9e29uQ29tbWVudEVkaXR9XG4gICAgICAgICAgICAgICAgICBvbkNvbW1lbnREZWxldGU9e2hhbmRsZUNvbW1lbnREZWxldGV9XG4gICAgICAgICAgICAgICAgICBvbkF1dGhvckNsaWNrPXtvbkF1dGhvckNsaWNrfVxuICAgICAgICAgICAgICAgICAgb25NZW50aW9uQ2xpY2s9e29uTWVudGlvbkNsaWNrfVxuICAgICAgICAgICAgICAgICAgYXV0b01hcmtSZWFkVGhyZWFkSWQ9e1xuICAgICAgICAgICAgICAgICAgICBpbmRleCA9PT0gbGFzdENvbW1lbnRJbmRleCAmJiBpc1VucmVhZFxuICAgICAgICAgICAgICAgICAgICAgID8gdGhyZWFkLmlkXG4gICAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxBY3Rpb25zQ2xhc3NOYW1lPXtcbiAgICAgICAgICAgICAgICAgICAgaXNGaXJzdENvbW1lbnQgPyBcImxiLXRocmVhZC1hY3Rpb25zXCIgOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxBY3Rpb25zPXtcbiAgICAgICAgICAgICAgICAgICAgaXNGaXJzdENvbW1lbnQgJiYgc2hvd1Jlc29sdmVBY3Rpb24gPyAoXG4gICAgICAgICAgICAgICAgICAgICAgPFRvb2x0aXBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ9e1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWQucmVzb2x2ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICQuVEhSRUFEX1VOUkVTT0xWRVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJC5USFJFQURfUkVTT0xWRVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxUb2dnbGVQcmltaXRpdmUuUm9vdFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVzc2VkPXt0aHJlYWQucmVzb2x2ZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJlc3NlZENoYW5nZT17aGFuZGxlUmVzb2x2ZWRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFzQ2hpbGRcbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxiLWNvbW1lbnQtYWN0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtzdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWQucmVzb2x2ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAkLlRIUkVBRF9VTlJFU09MVkVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAkLlRIUkVBRF9SRVNPTFZFXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3RocmVhZC5yZXNvbHZlZCA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZXNvbHZlZEljb24gY2xhc3NOYW1lPVwibGItYnV0dG9uLWljb25cIiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8UmVzb2x2ZUljb24gY2xhc3NOYW1lPVwibGItYnV0dG9uLWljb25cIiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Ub2dnbGVQcmltaXRpdmUuUm9vdD5cbiAgICAgICAgICAgICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgICAgICAgICAgICkgOiBudWxsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICByZXR1cm4gaW5kZXggPT09IG5ld0luZGljYXRvckluZGV4ICYmXG4gICAgICAgICAgICAgICAgbmV3SW5kaWNhdG9ySW5kZXggIT09IGZpcnN0Q29tbWVudEluZGV4ICYmXG4gICAgICAgICAgICAgICAgbmV3SW5kaWNhdG9ySW5kZXggPD0gbGFzdENvbW1lbnRJbmRleCA/IChcbiAgICAgICAgICAgICAgICA8RnJhZ21lbnQga2V5PXtjb21tZW50LmlkfT5cbiAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibGItdGhyZWFkLW5ldy1pbmRpY2F0b3JcIlxuICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXskLlRIUkVBRF9ORVdfSU5ESUNBVE9SX0RFU0NSSVBUSU9OfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJsYi10aHJlYWQtbmV3LWluZGljYXRvci1sYWJlbFwiPlxuICAgICAgICAgICAgICAgICAgICAgIDxBcnJvd0Rvd25JY29uIGNsYXNzTmFtZT1cImxiLXRocmVhZC1uZXctaW5kaWNhdG9yLWxhYmVsLWljb25cIiAvPlxuICAgICAgICAgICAgICAgICAgICAgIHskLlRIUkVBRF9ORVdfSU5ESUNBVE9SfVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAgICA8L0ZyYWdtZW50PlxuICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICB7c2hvd0NvbXBvc2VyICYmIChcbiAgICAgICAgICAgIDxDb21wb3NlclxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYi10aHJlYWQtY29tcG9zZXJcIlxuICAgICAgICAgICAgICB0aHJlYWRJZD17dGhyZWFkLmlkfVxuICAgICAgICAgICAgICBkZWZhdWx0Q29sbGFwc2VkPXtzaG93Q29tcG9zZXIgPT09IFwiY29sbGFwc2VkXCIgPyB0cnVlIDogdW5kZWZpbmVkfVxuICAgICAgICAgICAgICBvdmVycmlkZXM9e3tcbiAgICAgICAgICAgICAgICBDT01QT1NFUl9QTEFDRUhPTERFUjogJC5USFJFQURfQ09NUE9TRVJfUExBQ0VIT0xERVIsXG4gICAgICAgICAgICAgICAgQ09NUE9TRVJfU0VORDogJC5USFJFQURfQ09NUE9TRVJfU0VORCxcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L1Rvb2x0aXBQcm92aWRlcj5cbiAgICApO1xuICB9XG4pIGFzIDxNIGV4dGVuZHMgQmFzZU1ldGFkYXRhID0gRE0+KFxuICBwcm9wczogVGhyZWFkUHJvcHM8TT4gJiBSZWZBdHRyaWJ1dGVzPEhUTUxEaXZFbGVtZW50PlxuKSA9PiBKU1guRWxlbWVudDtcbiJdLCJuYW1lcyI6WyJUaHJlYWQiLCJmb3J3YXJkUmVmIiwidGhyZWFkIiwiaW5kZW50Q29tbWVudENvbnRlbnQiLCJzaG93QWN0aW9ucyIsInNob3dEZWxldGVkQ29tbWVudHMiLCJzaG93UmVzb2x2ZUFjdGlvbiIsInNob3dSZWFjdGlvbnMiLCJzaG93Q29tcG9zZXIiLCJvblJlc29sdmVkQ2hhbmdlIiwib25Db21tZW50RWRpdCIsIm9uQ29tbWVudERlbGV0ZSIsIm9uVGhyZWFkRGVsZXRlIiwib25BdXRob3JDbGljayIsIm9uTWVudGlvbkNsaWNrIiwib3ZlcnJpZGVzIiwiY2xhc3NOYW1lIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJtYXJrVGhyZWFkQXNSZXNvbHZlZCIsInVzZU1hcmtUaHJlYWRBc1Jlc29sdmVkIiwibWFya1RocmVhZEFzVW5yZXNvbHZlZCIsInVzZU1hcmtUaHJlYWRBc1VucmVzb2x2ZWQiLCIkIiwidXNlT3ZlcnJpZGVzIiwiZmlyc3RDb21tZW50SW5kZXgiLCJ1c2VNZW1vIiwiY29tbWVudHMiLCJmaW5kSW5kZXgiLCJjb21tZW50IiwiYm9keSIsImxhc3RDb21tZW50SW5kZXgiLCJsZW5ndGgiLCJmaW5kTGFzdEluZGV4Iiwic3RhdHVzIiwic3Vic2NyaXB0aW9uU3RhdHVzIiwidW5yZWFkU2luY2UiLCJ1c2VUaHJlYWRTdWJzY3JpcHRpb24iLCJpZCIsInVucmVhZEluZGV4IiwidW5yZWFkSW5kZXgyIiwiY3JlYXRlZEF0IiwibmV3SW5kZXgiLCJzZXROZXdJbmRleCIsInVzZVN0YXRlIiwibmV3SW5kaWNhdG9ySW5kZXgiLCJ1c2VFZmZlY3QiLCJwZXJzaXN0ZWRVbnJlYWRJbmRleCIsIk1hdGgiLCJtaW4iLCJJbmZpbml0eSIsInN0b3BQcm9wYWdhdGlvbiIsInVzZUNhbGxiYWNrIiwiZXZlbnQiLCJoYW5kbGVSZXNvbHZlZENoYW5nZSIsInJlc29sdmVkIiwiaGFuZGxlQ29tbWVudERlbGV0ZSIsImZpbHRlcmVkQ29tbWVudHMiLCJmaWx0ZXIiLCJjb21tZW50MiIsIlJlYWN0X19kZWZhdWx0IiwiY3JlYXRlRWxlbWVudCIsIlRvb2x0aXBQcm92aWRlciIsImNsYXNzTmFtZXMiLCJkaXIiLCJyZWYiLCJtYXAiLCJpbmRleCIsImlzRmlyc3RDb21tZW50IiwiaXNVbnJlYWQiLCJjaGlsZHJlbiIsIkNvbW1lbnQiLCJrZXkiLCJpbmRlbnRDb250ZW50Iiwic2hvd0RlbGV0ZWQiLCJhdXRvTWFya1JlYWRUaHJlYWRJZCIsImFkZGl0aW9uYWxBY3Rpb25zQ2xhc3NOYW1lIiwiYWRkaXRpb25hbEFjdGlvbnMiLCJUb29sdGlwIiwiY29udGVudCIsIlRIUkVBRF9VTlJFU09MVkUiLCJUSFJFQURfUkVTT0xWRSIsIlRvZ2dsZVByaW1pdGl2ZSIsIlJvb3QiLCJwcmVzc2VkIiwib25QcmVzc2VkQ2hhbmdlIiwiYXNDaGlsZCIsIkJ1dHRvbiIsIm9uQ2xpY2siLCJSZXNvbHZlZEljb24iLCJSZXNvbHZlSWNvbiIsIkZyYWdtZW50IiwiVEhSRUFEX05FV19JTkRJQ0FUT1JfREVTQ1JJUFRJT04iLCJBcnJvd0Rvd25JY29uIiwiVEhSRUFEX05FV19JTkRJQ0FUT1IiLCJDb21wb3NlciIsInRocmVhZElkIiwiZGVmYXVsdENvbGxhcHNlZCIsIkNPTVBPU0VSX1BMQUNFSE9MREVSIiwiVEhSRUFEX0NPTVBPU0VSX1BMQUNFSE9MREVSIiwiQ09NUE9TRVJfU0VORCIsIlRIUkVBRF9DT01QT1NFUl9TRU5EIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Thread.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Attribution.mjs":
/*!************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Attribution.mjs ***!
  \************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Attribution: () => (/* binding */ Attribution)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n\n\n\nfunction Attribution({ className, ...props }) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"a\", {\n    href: \"https://liveblocks.io\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__.classNames)(\"lb-composer-attribution\", className),\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 384 72\",\n    \"aria-label\": \"Made with Liveblocks\"\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M86 10h-8v50h8V10Zm16 14h-8v36h8V24Zm0-15h-8v9h8V9Zm13 15h-9l12 36h10l13-36h-9l-9 28-8-28Zm44-1c-11 0-18 8-18 19s7 19 18 19c8 0 15-4 17-13h-8c-1 4-5 6-9 6-6 0-9-3-9-10h27c0-10-6-21-18-21Zm0 7c5 0 9 3 9 8h-18c0-5 4-8 9-8Zm42-7c-4 0-8 2-11 6V10h-8v50h8v-5c3 4 7 6 11 6 11 0 16-9 16-19s-5-19-16-19Zm-2 32c-7 0-9-7-9-13s2-13 9-13 9 7 9 13-2 13-9 13Zm32-45h-8v50h8V10Zm24 51c11 0 18-8 18-19s-8-19-18-19c-11 0-19 8-19 19s7 19 19 19Zm0-6c-8 0-10-7-10-13s2-13 10-13c7 0 9 7 9 13s-2 13-9 13Zm39 6c8 0 15-4 17-12l-8-1c-2 4-4 6-9 6-7 0-9-6-9-12s2-12 9-12c5 0 8 3 8 7l9-1c-2-8-9-13-17-13-11 0-18 9-18 19 0 11 7 19 18 19Zm30-14 4-4 10 17h10l-15-23 15-13h-11l-13 13V10h-9v50h9V47Zm39 14c8 0 16-3 16-12 0-8-8-10-15-11-2-1-7-1-7-5 0-3 3-4 6-4 4 0 7 3 7 7l8-1c-1-9-8-12-15-12s-15 3-15 11 9 10 15 11c3 1 8 2 8 5 0 4-4 5-7 5-5 0-8-3-9-7l-8 1c1 8 9 12 16 12ZM41 27H0l12 12v17l29-29ZM20 60h40L48 48V32L20 60Z\",\n    fill: \"currentColor\"\n  })));\n}\n\n\n//# sourceMappingURL=Attribution.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0F0dHJpYnV0aW9uLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDc0I7O0FBRXpELHVCQUF1QixxQkFBcUI7QUFDNUMseUJBQXlCLGdEQUE0QjtBQUNyRDtBQUNBO0FBQ0E7QUFDQSxlQUFlLGtFQUFVO0FBQ3pCO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFdUI7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2NvbXBvbmVudHMvaW50ZXJuYWwvQXR0cmlidXRpb24ubWpzPzk1ZWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGNsYXNzTmFtZXMgfSBmcm9tICcuLi8uLi91dGlscy9jbGFzcy1uYW1lcy5tanMnO1xuXG5mdW5jdGlvbiBBdHRyaWJ1dGlvbih7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSkge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHtcbiAgICBocmVmOiBcImh0dHBzOi8vbGl2ZWJsb2Nrcy5pb1wiLFxuICAgIHRhcmdldDogXCJfYmxhbmtcIixcbiAgICByZWw6IFwibm9vcGVuZXIgbm9yZWZlcnJlclwiLFxuICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyhcImxiLWNvbXBvc2VyLWF0dHJpYnV0aW9uXCIsIGNsYXNzTmFtZSksXG4gICAgLi4ucHJvcHNcbiAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJzdmdcIiwge1xuICAgIHhtbG5zOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsXG4gICAgdmlld0JveDogXCIwIDAgMzg0IDcyXCIsXG4gICAgXCJhcmlhLWxhYmVsXCI6IFwiTWFkZSB3aXRoIExpdmVibG9ja3NcIlxuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBhdGhcIiwge1xuICAgIGZpbGxSdWxlOiBcImV2ZW5vZGRcIixcbiAgICBjbGlwUnVsZTogXCJldmVub2RkXCIsXG4gICAgZDogXCJNODYgMTBoLTh2NTBoOFYxMFptMTYgMTRoLTh2MzZoOFYyNFptMC0xNWgtOHY5aDhWOVptMTMgMTVoLTlsMTIgMzZoMTBsMTMtMzZoLTlsLTkgMjgtOC0yOFptNDQtMWMtMTEgMC0xOCA4LTE4IDE5czcgMTkgMTggMTljOCAwIDE1LTQgMTctMTNoLThjLTEgNC01IDYtOSA2LTYgMC05LTMtOS0xMGgyN2MwLTEwLTYtMjEtMTgtMjFabTAgN2M1IDAgOSAzIDkgOGgtMThjMC01IDQtOCA5LThabTQyLTdjLTQgMC04IDItMTEgNlYxMGgtOHY1MGg4di01YzMgNCA3IDYgMTEgNiAxMSAwIDE2LTkgMTYtMTlzLTUtMTktMTYtMTlabS0yIDMyYy03IDAtOS03LTktMTNzMi0xMyA5LTEzIDkgNyA5IDEzLTIgMTMtOSAxM1ptMzItNDVoLTh2NTBoOFYxMFptMjQgNTFjMTEgMCAxOC04IDE4LTE5cy04LTE5LTE4LTE5Yy0xMSAwLTE5IDgtMTkgMTlzNyAxOSAxOSAxOVptMC02Yy04IDAtMTAtNy0xMC0xM3MyLTEzIDEwLTEzYzcgMCA5IDcgOSAxM3MtMiAxMy05IDEzWm0zOSA2YzggMCAxNS00IDE3LTEybC04LTFjLTIgNC00IDYtOSA2LTcgMC05LTYtOS0xMnMyLTEyIDktMTJjNSAwIDggMyA4IDdsOS0xYy0yLTgtOS0xMy0xNy0xMy0xMSAwLTE4IDktMTggMTkgMCAxMSA3IDE5IDE4IDE5Wm0zMC0xNCA0LTQgMTAgMTdoMTBsLTE1LTIzIDE1LTEzaC0xMWwtMTMgMTNWMTBoLTl2NTBoOVY0N1ptMzkgMTRjOCAwIDE2LTMgMTYtMTIgMC04LTgtMTAtMTUtMTEtMi0xLTctMS03LTUgMC0zIDMtNCA2LTQgNCAwIDcgMyA3IDdsOC0xYy0xLTktOC0xMi0xNS0xMnMtMTUgMy0xNSAxMSA5IDEwIDE1IDExYzMgMSA4IDIgOCA1IDAgNC00IDUtNyA1LTUgMC04LTMtOS03bC04IDFjMSA4IDkgMTIgMTYgMTJaTTQxIDI3SDBsMTIgMTJ2MTdsMjktMjlaTTIwIDYwaDQwTDQ4IDQ4VjMyTDIwIDYwWlwiLFxuICAgIGZpbGw6IFwiY3VycmVudENvbG9yXCJcbiAgfSkpKTtcbn1cblxuZXhwb3J0IHsgQXR0cmlidXRpb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUF0dHJpYnV0aW9uLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Attribution.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Avatar.mjs":
/*!*******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Avatar.mjs ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Avatar: () => (/* binding */ Avatar)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_get_initials_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/get-initials.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/get-initials.mjs\");\n/* __next_internal_client_entry_do_not_use__ Avatar auto */ \n\n\n\nfunction Avatar({ userId, className, ...props }) {\n    const { user, isLoading } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__._useUser)(userId);\n    const resolvedUserName = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>user?.name, [\n        user\n    ]);\n    const resolvedUserAvatar = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>user?.avatar, [\n        user\n    ]);\n    const resolvedUserInitials = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>resolvedUserName ? (0,_utils_get_initials_mjs__WEBPACK_IMPORTED_MODULE_2__.getInitials)(resolvedUserName) : void 0, [\n        resolvedUserName\n    ]);\n    const resolvedUserIdInitials = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>!isLoading && !user ? (0,_utils_get_initials_mjs__WEBPACK_IMPORTED_MODULE_2__.getInitials)(userId) : void 0, [\n        isLoading,\n        user,\n        userId\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_3__.classNames)(\"lb-avatar\", className),\n        \"data-loading\": isLoading ? \"\" : void 0,\n        ...props\n    }, resolvedUserAvatar && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"img\", {\n        className: \"lb-avatar-image\",\n        src: resolvedUserAvatar,\n        alt: resolvedUserName\n    }), resolvedUserInitials ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-avatar-fallback\",\n        \"aria-hidden\": true\n    }, resolvedUserInitials) : resolvedUserIdInitials ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: \"lb-avatar-fallback\",\n        \"aria-label\": userId,\n        title: userId\n    }, resolvedUserIdInitials) : null);\n}\n //# sourceMappingURL=Avatar.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0F2YXRhci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBZ0JPLFNBQUFBLE9BQUEsRUFBQUMsTUFBQSxFQUFBQyxTQUFBLEtBQUFDLE9BQUE7SUFDTCxRQUFBQyxJQUFBLEVBQUFDLFNBQUEsS0FBQUMsMkRBQUFBLENBQUFMO0lBQ0EsTUFBQU0sbUJBQUFDLDhDQUFBQSxDQUFBLElBQUFKLE1BQUFLLE1BQUE7UUFBQUw7S0FBQTtJQUNBLE1BQUFNLHFCQUFBRiw4Q0FBQUEsQ0FBQSxJQUFBSixNQUFBTyxRQUFBO1FBQUFQO0tBQUE7SUFDQSxNQUFBUSx1QkFBQUosOENBQUFBLENBQTZCLElBQUFELG1CQUFBTSxvRUFBQUEsQ0FBQU4sb0JBQUEsUUFDK0I7UUFBQUE7S0FBQTtJQUc1RCxNQUFBTyx5QkFBQU4sOENBQUFBLENBQStCLEtBQUFILGFBQUEsQ0FBQUQsT0FBQVMsb0VBQUFBLENBQUFaLFVBQUEsUUFDc0I7UUFBQUk7UUFBQUQ7UUFBQUg7S0FBQTtJQUlyRCxxQ0FBQWMsZ0RBQUE7UUFDR2IsV0FBQWUsa0VBQUFBLENBQUEsYUFBQWY7UUFDNkMsZ0JBQUFHLFlBQUE7UUFDYixHQUFBRixLQUFBO0lBQzNCLEdBQUFPLHNCQUFBLDhCQUFBSyxnREFBQTtRQUdEYixXQUFBO1FBQ1dnQixLQUFBUjtRQUNMUyxLQUFBWjtJQUNBLElBQUFLLHVCQUFBLDhCQUFBRyxnREFBQTtRQUlOYixXQUFBO1FBQWU7SUFBZ0MsR0FBQVUsd0JBQUFFLHlCQUFBLDhCQUFBQyxnREFBQTtRQUkvQ2IsV0FBQTtRQUFlLGNBQUFEO1FBQWlDbUIsT0FBQW5CO0lBQWUsR0FBQWEsMEJBQUE7QUFNeEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9pbnRlcm5hbC9BdmF0YXIudHN4PzlhYmEiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB7IHVzZVVzZXIgfSBmcm9tIFwiQGxpdmVibG9ja3MvcmVhY3RcIjtcbmltcG9ydCB0eXBlIHsgQ29tcG9uZW50UHJvcHMgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwgeyB1c2VNZW1vIH0gZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB7IGNsYXNzTmFtZXMgfSBmcm9tIFwiLi4vLi4vdXRpbHMvY2xhc3MtbmFtZXNcIjtcbmltcG9ydCB7IGdldEluaXRpYWxzIH0gZnJvbSBcIi4uLy4uL3V0aWxzL2dldC1pbml0aWFsc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF2YXRhclByb3BzIGV4dGVuZHMgQ29tcG9uZW50UHJvcHM8XCJkaXZcIj4ge1xuICAvKipcbiAgICogVGhlIHVzZXIgSUQgdG8gZGlzcGxheSB0aGUgYXZhdGFyIGZvci5cbiAgICovXG4gIHVzZXJJZDogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gQXZhdGFyKHsgdXNlcklkLCBjbGFzc05hbWUsIC4uLnByb3BzIH06IEF2YXRhclByb3BzKSB7XG4gIGNvbnN0IHsgdXNlciwgaXNMb2FkaW5nIH0gPSB1c2VVc2VyKHVzZXJJZCk7XG4gIGNvbnN0IHJlc29sdmVkVXNlck5hbWUgPSB1c2VNZW1vKCgpID0+IHVzZXI/Lm5hbWUsIFt1c2VyXSk7XG4gIGNvbnN0IHJlc29sdmVkVXNlckF2YXRhciA9IHVzZU1lbW8oKCkgPT4gdXNlcj8uYXZhdGFyLCBbdXNlcl0pO1xuICBjb25zdCByZXNvbHZlZFVzZXJJbml0aWFscyA9IHVzZU1lbW8oXG4gICAgKCkgPT4gKHJlc29sdmVkVXNlck5hbWUgPyBnZXRJbml0aWFscyhyZXNvbHZlZFVzZXJOYW1lKSA6IHVuZGVmaW5lZCksXG4gICAgW3Jlc29sdmVkVXNlck5hbWVdXG4gICk7XG4gIGNvbnN0IHJlc29sdmVkVXNlcklkSW5pdGlhbHMgPSB1c2VNZW1vKFxuICAgICgpID0+ICghaXNMb2FkaW5nICYmICF1c2VyID8gZ2V0SW5pdGlhbHModXNlcklkKSA6IHVuZGVmaW5lZCksXG4gICAgW2lzTG9hZGluZywgdXNlciwgdXNlcklkXVxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdlxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibGItYXZhdGFyXCIsIGNsYXNzTmFtZSl9XG4gICAgICBkYXRhLWxvYWRpbmc9e2lzTG9hZGluZyA/IFwiXCIgOiB1bmRlZmluZWR9XG4gICAgICB7Li4ucHJvcHN9XG4gICAgPlxuICAgICAge3Jlc29sdmVkVXNlckF2YXRhciAmJiAoXG4gICAgICAgIDxpbWdcbiAgICAgICAgICBjbGFzc05hbWU9XCJsYi1hdmF0YXItaW1hZ2VcIlxuICAgICAgICAgIHNyYz17cmVzb2x2ZWRVc2VyQXZhdGFyfVxuICAgICAgICAgIGFsdD17cmVzb2x2ZWRVc2VyTmFtZX1cbiAgICAgICAgLz5cbiAgICAgICl9XG4gICAgICB7cmVzb2x2ZWRVc2VySW5pdGlhbHMgPyAoXG4gICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxiLWF2YXRhci1mYWxsYmFja1wiIGFyaWEtaGlkZGVuPlxuICAgICAgICAgIHtyZXNvbHZlZFVzZXJJbml0aWFsc31cbiAgICAgICAgPC9zcGFuPlxuICAgICAgKSA6IHJlc29sdmVkVXNlcklkSW5pdGlhbHMgPyAoXG4gICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxiLWF2YXRhci1mYWxsYmFja1wiIGFyaWEtbGFiZWw9e3VzZXJJZH0gdGl0bGU9e3VzZXJJZH0+XG4gICAgICAgICAge3Jlc29sdmVkVXNlcklkSW5pdGlhbHN9XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICkgOiBudWxsfVxuICAgIDwvZGl2PlxuICApO1xufVxuIl0sIm5hbWVzIjpbIkF2YXRhciIsInVzZXJJZCIsImNsYXNzTmFtZSIsInByb3BzIiwidXNlciIsImlzTG9hZGluZyIsInVzZVVzZXIiLCJyZXNvbHZlZFVzZXJOYW1lIiwidXNlTWVtbyIsIm5hbWUiLCJyZXNvbHZlZFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJyZXNvbHZlZFVzZXJJbml0aWFscyIsImdldEluaXRpYWxzIiwicmVzb2x2ZWRVc2VySWRJbml0aWFscyIsIlJlYWN0X19kZWZhdWx0IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZXMiLCJzcmMiLCJhbHQiLCJ0aXRsZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Avatar.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs":
/*!*******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Button: () => (/* binding */ Button)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* __next_internal_client_entry_do_not_use__ Button auto */ \n\nconst Button = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ variant = \"default\", disableable = true, className, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"button\", {\n        type: \"button\",\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__.classNames)(\"lb-button\", !disableable && \"lb-button:non-disableable\", className),\n        \"data-variant\": variant,\n        ...props,\n        ref: forwardedRef\n    });\n});\n //# sourceMappingURL=Button.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0J1dHRvbi5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFZTyxNQUFBQSx1QkFBQUMsaURBQUFBLENBQWUsR0FBQUMsVUFBQSxXQUFBQyxjQUFBLE1BQUFDLFNBQUEsS0FBQUMsT0FBQSxFQUFBQztJQUtsQixxQ0FBQUMsZ0RBQUE7UUFDR0UsTUFBQTtRQUNNTCxXQUFBTSxrRUFBQUEsQ0FDTSxhQUNULENBQUFQLGVBQUEsNkJBQ2dCQztRQUVsQixnQkFBQUY7UUFDYyxHQUFBRyxLQUFBO1FBQ1ZNLEtBQUFMO0lBQ0M7QUFDUCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2ludGVybmFsL0J1dHRvbi50c3g/NDkxZCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcblxuaW1wb3J0IHR5cGUgeyBDb21wb25lbnRQcm9wcyB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IFJlYWN0LCB7IGZvcndhcmRSZWYgfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gXCIuLi8uLi91dGlscy9jbGFzcy1uYW1lc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJ1dHRvblByb3BzIGV4dGVuZHMgQ29tcG9uZW50UHJvcHM8XCJidXR0b25cIj4ge1xuICB2YXJpYW50PzogXCJkZWZhdWx0XCIgfCBcIm91dGxpbmVcIiB8IFwicHJpbWFyeVwiO1xuICBkaXNhYmxlYWJsZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCBCdXR0b24gPSBmb3J3YXJkUmVmPEhUTUxCdXR0b25FbGVtZW50LCBCdXR0b25Qcm9wcz4oXG4gIChcbiAgICB7IHZhcmlhbnQgPSBcImRlZmF1bHRcIiwgZGlzYWJsZWFibGUgPSB0cnVlLCBjbGFzc05hbWUsIC4uLnByb3BzIH0sXG4gICAgZm9yd2FyZGVkUmVmXG4gICkgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICA8YnV0dG9uXG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgXCJsYi1idXR0b25cIixcbiAgICAgICAgICAhZGlzYWJsZWFibGUgJiYgXCJsYi1idXR0b246bm9uLWRpc2FibGVhYmxlXCIsXG4gICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICl9XG4gICAgICAgIGRhdGEtdmFyaWFudD17dmFyaWFudH1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuKTtcbiJdLCJuYW1lcyI6WyJCdXR0b24iLCJmb3J3YXJkUmVmIiwidmFyaWFudCIsImRpc2FibGVhYmxlIiwiY2xhc3NOYW1lIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJSZWFjdF9fZGVmYXVsdCIsImNyZWF0ZUVsZW1lbnQiLCJ0eXBlIiwiY2xhc3NOYW1lcyIsInJlZiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Button.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Dropdown.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Dropdown.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Dropdown: () => (/* binding */ Dropdown),\n/* harmony export */   DropdownItem: () => (/* binding */ DropdownItem),\n/* harmony export */   DropdownTrigger: () => (/* reexport safe */ _radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_0__.DropdownMenuTrigger)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @radix-ui/react-dropdown-menu */ \"(ssr)/./node_modules/@radix-ui/react-dropdown-menu/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _config_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/config.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../constants.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* __next_internal_client_entry_do_not_use__ DropdownTrigger,Dropdown,DropdownItem auto */ \n\n\n\n\n\n\nfunction Dropdown({ children, content, defaultOpen, open, onOpenChange, className, ...props }) {\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_2__.useOverrides)();\n    const { portalContainer } = (0,_config_mjs__WEBPACK_IMPORTED_MODULE_3__.useLiveblocksUIConfig)();\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_0__.Root, {\n        defaultOpen,\n        open,\n        onOpenChange,\n        dir: $.dir\n    }, children, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_0__.Portal, {\n        container: portalContainer\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_0__.Content, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-root lb-portal lb-elevation lb-dropdown\", className),\n        sideOffset: _constants_mjs__WEBPACK_IMPORTED_MODULE_5__.FLOATING_ELEMENT_SIDE_OFFSET,\n        collisionPadding: _constants_mjs__WEBPACK_IMPORTED_MODULE_5__.FLOATING_ELEMENT_COLLISION_PADDING,\n        ...props\n    }, content)));\n}\nconst DropdownItem = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_1__.forwardRef)(({ children, className, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_dropdown_menu__WEBPACK_IMPORTED_MODULE_0__.DropdownMenuItem, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-dropdown-item\", className),\n        ...props,\n        ref: forwardedRef\n    }, children);\n});\n //# sourceMappingURL=Dropdown.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0Ryb3Bkb3duLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JPLFNBQUFBLFNBQUEsRUFBa0JDLFFBQUEsRUFDdkJDLE9BQUEsRUFDQUMsV0FBQSxFQUNBQyxJQUFBLEVBQ0FDLFlBQUEsRUFDQUMsU0FBQSxFQUNBLEdBQUFDLE9BRUY7SUFDRSxNQUFBQyxJQUFBQyw0REFBQUE7SUFDQSxRQUFBQyxlQUFBLEtBQUFDLGtFQUFBQTtJQUVBLHFDQUFBQyxnREFBQSxDQUFBRSwrREFBQTtRQUNHWDtRQUNDQztRQUNBQztRQUNBVyxLQUFBUixFQUFBUSxHQUFBO0lBQ08sR0FBQWYsVUFBQSw4QkFBQVcsZ0RBQUEsQ0FBQUUsaUVBQUE7UUFHTkksV0FBQVI7SUFBd0MsaUNBQUFFLGdEQUFBLENBQUFFLGtFQUFBO1FBQ3RDUixXQUFBYyxrRUFBQUEsQ0FDWSw4Q0FDVGQ7UUFFRmUsWUFBQUMsd0VBQUFBO1FBQ1lDLGtCQUFBQyw4RUFBQUE7UUFDTSxHQUFBakIsS0FBQTtJQUNkLEdBQUFMO0FBT2Q7QUFFYSxNQUFBdUIsNkJBQUFDLGlEQUFBQSxDQUFBLEdBQUF6QixRQUFBLEVBQUFLLFNBQUEsS0FBQUMsT0FBQSxFQUFBb0I7SUFJWCxxQ0FBQWYsZ0RBQUEsQ0FBQUUsMkVBQUE7UUFDR1IsV0FBQWMsa0VBQUFBLENBQUEsb0JBQUFkO1FBQ29ELEdBQUFDLEtBQUE7UUFDL0NzQixLQUFBRjtJQUNDLEdBQUExQjtBQUtYIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaW50ZXJuYWwvRHJvcGRvd24udHN4PzE5MjUiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCAqIGFzIERyb3Bkb3duTWVudVByaW1pdGl2ZSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LWRyb3Bkb3duLW1lbnVcIjtcbmltcG9ydCB0eXBlIHsgUmVhY3ROb2RlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVhY3QsIHsgZm9yd2FyZFJlZiB9IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgeyB1c2VMaXZlYmxvY2tzVUlDb25maWcgfSBmcm9tIFwiLi4vLi4vY29uZmlnXCI7XG5pbXBvcnQge1xuICBGTE9BVElOR19FTEVNRU5UX0NPTExJU0lPTl9QQURESU5HLFxuICBGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VULFxufSBmcm9tIFwiLi4vLi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyB1c2VPdmVycmlkZXMgfSBmcm9tIFwiLi4vLi4vb3ZlcnJpZGVzXCI7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSBcIi4uLy4uL3V0aWxzL2NsYXNzLW5hbWVzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJvcGRvd25Qcm9wc1xuICBleHRlbmRzIFBpY2s8XG4gICAgICBEcm9wZG93bk1lbnVQcmltaXRpdmUuRHJvcGRvd25NZW51UHJvcHMsXG4gICAgICBcImRlZmF1bHRPcGVuXCIgfCBcIm9wZW5cIiB8IFwib25PcGVuQ2hhbmdlXCJcbiAgICA+LFxuICAgIFBpY2s8RHJvcGRvd25NZW51UHJpbWl0aXZlLkRyb3Bkb3duTWVudVRyaWdnZXJQcm9wcywgXCJjaGlsZHJlblwiPixcbiAgICBPbWl0PERyb3Bkb3duTWVudVByaW1pdGl2ZS5Ecm9wZG93bk1lbnVDb250ZW50UHJvcHMsIFwiY29udGVudFwiPiB7XG4gIGNvbnRlbnQ6IFJlYWN0Tm9kZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIERyb3Bkb3duKHtcbiAgY2hpbGRyZW4sXG4gIGNvbnRlbnQsXG4gIGRlZmF1bHRPcGVuLFxuICBvcGVuLFxuICBvbk9wZW5DaGFuZ2UsXG4gIGNsYXNzTmFtZSxcbiAgLi4ucHJvcHNcbn06IERyb3Bkb3duUHJvcHMpIHtcbiAgY29uc3QgJCA9IHVzZU92ZXJyaWRlcygpO1xuICBjb25zdCB7IHBvcnRhbENvbnRhaW5lciB9ID0gdXNlTGl2ZWJsb2Nrc1VJQ29uZmlnKCk7XG5cbiAgcmV0dXJuIChcbiAgICA8RHJvcGRvd25NZW51UHJpbWl0aXZlLlJvb3RcbiAgICAgIGRlZmF1bHRPcGVuPXtkZWZhdWx0T3Blbn1cbiAgICAgIG9wZW49e29wZW59XG4gICAgICBvbk9wZW5DaGFuZ2U9e29uT3BlbkNoYW5nZX1cbiAgICAgIGRpcj17JC5kaXJ9XG4gICAgPlxuICAgICAge2NoaWxkcmVufVxuICAgICAgPERyb3Bkb3duTWVudVByaW1pdGl2ZS5Qb3J0YWwgY29udGFpbmVyPXtwb3J0YWxDb250YWluZXJ9PlxuICAgICAgICA8RHJvcGRvd25NZW51UHJpbWl0aXZlLkNvbnRlbnRcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgICBcImxiLXJvb3QgbGItcG9ydGFsIGxiLWVsZXZhdGlvbiBsYi1kcm9wZG93blwiLFxuICAgICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICAgKX1cbiAgICAgICAgICBzaWRlT2Zmc2V0PXtGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VUfVxuICAgICAgICAgIGNvbGxpc2lvblBhZGRpbmc9e0ZMT0FUSU5HX0VMRU1FTlRfQ09MTElTSU9OX1BBRERJTkd9XG4gICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICA+XG4gICAgICAgICAge2NvbnRlbnR9XG4gICAgICAgIDwvRHJvcGRvd25NZW51UHJpbWl0aXZlLkNvbnRlbnQ+XG4gICAgICA8L0Ryb3Bkb3duTWVudVByaW1pdGl2ZS5Qb3J0YWw+XG4gICAgPC9Ecm9wZG93bk1lbnVQcmltaXRpdmUuUm9vdD5cbiAgKTtcbn1cblxuZXhwb3J0IGNvbnN0IERyb3Bkb3duSXRlbSA9IGZvcndhcmRSZWY8XG4gIEhUTUxEaXZFbGVtZW50LFxuICBEcm9wZG93bk1lbnVQcmltaXRpdmUuRHJvcGRvd25NZW51SXRlbVByb3BzXG4+KCh7IGNoaWxkcmVuLCBjbGFzc05hbWUsIC4uLnByb3BzIH0sIGZvcndhcmRlZFJlZikgPT4ge1xuICByZXR1cm4gKFxuICAgIDxEcm9wZG93bk1lbnVQcmltaXRpdmUuRHJvcGRvd25NZW51SXRlbVxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibGItZHJvcGRvd24taXRlbVwiLCBjbGFzc05hbWUpfVxuICAgICAgey4uLnByb3BzfVxuICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgPlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvRHJvcGRvd25NZW51UHJpbWl0aXZlLkRyb3Bkb3duTWVudUl0ZW0+XG4gICk7XG59KTtcblxuZXhwb3J0IHsgRHJvcGRvd25NZW51VHJpZ2dlciBhcyBEcm9wZG93blRyaWdnZXIgfSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LWRyb3Bkb3duLW1lbnVcIjtcbiJdLCJuYW1lcyI6WyJEcm9wZG93biIsImNoaWxkcmVuIiwiY29udGVudCIsImRlZmF1bHRPcGVuIiwib3BlbiIsIm9uT3BlbkNoYW5nZSIsImNsYXNzTmFtZSIsInByb3BzIiwiJCIsInVzZU92ZXJyaWRlcyIsInBvcnRhbENvbnRhaW5lciIsInVzZUxpdmVibG9ja3NVSUNvbmZpZyIsIlJlYWN0X19kZWZhdWx0IiwiY3JlYXRlRWxlbWVudCIsIkRyb3Bkb3duTWVudVByaW1pdGl2ZSIsIlJvb3QiLCJkaXIiLCJQb3J0YWwiLCJjb250YWluZXIiLCJDb250ZW50IiwiY2xhc3NOYW1lcyIsInNpZGVPZmZzZXQiLCJGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VUIiwiY29sbGlzaW9uUGFkZGluZyIsIkZMT0FUSU5HX0VMRU1FTlRfQ09MTElTSU9OX1BBRERJTkciLCJEcm9wZG93bkl0ZW0iLCJmb3J3YXJkUmVmIiwiZm9yd2FyZGVkUmVmIiwiRHJvcGRvd25NZW51SXRlbSIsInJlZiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Dropdown.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Emoji.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Emoji.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Emoji: () => (/* binding */ Emoji)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _primitives_internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../primitives/internal/Emoji.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/internal/Emoji.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n\n\n\n\nconst Emoji = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  ({ className, ...props }, forwardedRef) => {\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_1__.Emoji, {\n      className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji\", className),\n      ...props,\n      ref: forwardedRef\n    });\n  }\n);\n\n\n//# sourceMappingURL=Emoji.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0Vtb2ppLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQW1EO0FBQ29CO0FBQ2Q7O0FBRXpELGNBQWMsaURBQVU7QUFDeEIsS0FBSyxxQkFBcUI7QUFDMUIsMkJBQTJCLGdEQUE0QixDQUFDLGlFQUFPO0FBQy9ELGlCQUFpQixrRUFBVTtBQUMzQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRWlCO0FBQ2pCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0Vtb2ppLm1qcz80N2JhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyBmb3J3YXJkUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRW1vamkgYXMgRW1vamkkMSB9IGZyb20gJy4uLy4uL3ByaW1pdGl2ZXMvaW50ZXJuYWwvRW1vamkubWpzJztcbmltcG9ydCB7IGNsYXNzTmFtZXMgfSBmcm9tICcuLi8uLi91dGlscy9jbGFzcy1uYW1lcy5tanMnO1xuXG5jb25zdCBFbW9qaSA9IGZvcndhcmRSZWYoXG4gICh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEVtb2ppJDEsIHtcbiAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyhcImxiLWVtb2ppXCIsIGNsYXNzTmFtZSksXG4gICAgICAuLi5wcm9wcyxcbiAgICAgIHJlZjogZm9yd2FyZGVkUmVmXG4gICAgfSk7XG4gIH1cbik7XG5cbmV4cG9ydCB7IEVtb2ppIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1FbW9qaS5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Emoji.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/EmojiPicker.mjs":
/*!************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/EmojiPicker.mjs ***!
  \************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EmojiPicker: () => (/* binding */ EmojiPicker),\n/* harmony export */   EmojiPickerTrigger: () => (/* reexport safe */ _radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_0__.PopoverTrigger)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @radix-ui/react-popover */ \"(ssr)/./node_modules/@radix-ui/react-popover/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _config_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../config.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/config.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../constants.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\");\n/* harmony import */ var _icons_Search_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../icons/Search.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Search.mjs\");\n/* harmony import */ var _icons_Spinner_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../icons/Spinner.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Spinner.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _primitives_EmojiPicker_index_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../primitives/EmojiPicker/index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/index.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _Emoji_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Emoji.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Emoji.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\nfunction EmojiPickerLoading({\n  className,\n  ...props\n}) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-loading\", className),\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_icons_Spinner_mjs__WEBPACK_IMPORTED_MODULE_3__.SpinnerIcon, null));\n}\nfunction EmojiPickerEmpty({\n  className,\n  ...props\n}) {\n  const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_4__.useOverrides)();\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-empty\", className),\n    ...props\n  }, $.EMOJI_PICKER_EMPTY);\n}\nfunction EmojiPickerError({\n  error,\n  className,\n  ...props\n}) {\n  const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_4__.useOverrides)();\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-error\", className),\n    ...props\n  }, $.EMOJI_PICKER_ERROR(error));\n}\nfunction EmojiPickerCategoryHeader({\n  category,\n  className,\n  ...props\n}) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-category-header\", className),\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"span\", {\n    className: \"lb-emoji-picker-category-header-title\"\n  }, category));\n}\nfunction EmojiPickerGrid({\n  children,\n  className,\n  ...props\n}) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-grid\", className),\n    ...props\n  }, children);\n}\nfunction EmojiPickerRow({\n  attributes,\n  children,\n  className,\n  ...props\n}) {\n  const isFirstRow = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(\n    () => attributes.categoryRowIndex === 0,\n    [attributes.categoryRowIndex]\n  );\n  const isLastRow = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(\n    () => attributes.categoryRowIndex === attributes.categoryRowsCount - 1,\n    [attributes.categoryRowIndex, attributes.categoryRowsCount]\n  );\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-row\", className),\n    \"data-first\": isFirstRow ? \"\" : void 0,\n    \"data-last\": isLastRow ? \"\" : void 0,\n    ...props\n  }, children);\n}\nfunction EmojiPickerEmoji({\n  emoji,\n  className,\n  ...props\n}) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"button\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-emoji-picker-emoji\", className),\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_Emoji_mjs__WEBPACK_IMPORTED_MODULE_5__.Emoji, {\n    emoji\n  }));\n}\nconst EmojiPicker = (0,react__WEBPACK_IMPORTED_MODULE_1__.forwardRef)(\n  ({ onEmojiSelect, onOpenChange, children, className, ...props }, forwardedRef) => {\n    const [isOpen, setOpen] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);\n    const { portalContainer } = (0,_config_mjs__WEBPACK_IMPORTED_MODULE_6__.useLiveblocksUIConfig)();\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_4__.useOverrides)();\n    const handleOpenChange = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(\n      (isOpen2) => {\n        setOpen(isOpen2);\n        onOpenChange?.(isOpen2);\n      },\n      [onOpenChange]\n    );\n    const handleEmojiSelect = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(\n      (emoji) => {\n        setOpen(false);\n        onEmojiSelect?.(emoji);\n      },\n      [onEmojiSelect]\n    );\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_0__.Root, {\n      open: isOpen,\n      onOpenChange: handleOpenChange\n    }, children, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_0__.Portal, {\n      container: portalContainer\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_popover__WEBPACK_IMPORTED_MODULE_0__.Content, {\n      side: \"top\",\n      align: \"center\",\n      sideOffset: _constants_mjs__WEBPACK_IMPORTED_MODULE_7__.FLOATING_ELEMENT_SIDE_OFFSET,\n      collisionPadding: _constants_mjs__WEBPACK_IMPORTED_MODULE_7__.FLOATING_ELEMENT_COLLISION_PADDING,\n      className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\n        \"lb-root lb-portal lb-elevation lb-emoji-picker\",\n        className\n      ),\n      ...props,\n      ref: forwardedRef\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_primitives_EmojiPicker_index_mjs__WEBPACK_IMPORTED_MODULE_8__.Root, {\n      onEmojiSelect: handleEmojiSelect,\n      locale: $.locale\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n      className: \"lb-emoji-picker-header\"\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"div\", {\n      className: \"lb-emoji-picker-search-container\"\n    }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_primitives_EmojiPicker_index_mjs__WEBPACK_IMPORTED_MODULE_8__.Search, {\n      className: \"lb-emoji-picker-search\",\n      placeholder: $.EMOJI_PICKER_SEARCH_PLACEHOLDER,\n      autoFocus: true\n    }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_icons_Search_mjs__WEBPACK_IMPORTED_MODULE_9__.SearchIcon, {\n      className: \"lb-emoji-picker-search-icon\"\n    }))), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_primitives_EmojiPicker_index_mjs__WEBPACK_IMPORTED_MODULE_8__.Content, {\n      className: \"lb-emoji-picker-content\",\n      components: {\n        Loading: EmojiPickerLoading,\n        Empty: EmojiPickerEmpty,\n        Error: EmojiPickerError,\n        CategoryHeader: EmojiPickerCategoryHeader,\n        Grid: EmojiPickerGrid,\n        Row: EmojiPickerRow,\n        Emoji: EmojiPickerEmoji\n      }\n    })))));\n  }\n);\n\n\n//# sourceMappingURL=EmojiPicker.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0Vtb2ppUGlja2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBNEQ7QUFDbUI7QUFDSTtBQUMxQjtBQUM4QztBQUNuRDtBQUNFO0FBQ0g7QUFDMEY7QUFDcEY7QUFDckI7O0FBRXBDO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCx5QkFBeUIsZ0RBQTRCO0FBQ3JELGVBQWUsa0VBQVU7QUFDekI7QUFDQSxHQUFHLGtCQUFrQixnREFBNEIsQ0FBQywyREFBVztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxZQUFZLDREQUFZO0FBQ3hCLHlCQUF5QixnREFBNEI7QUFDckQsZUFBZSxrRUFBVTtBQUN6QjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELFlBQVksNERBQVk7QUFDeEIseUJBQXlCLGdEQUE0QjtBQUNyRCxlQUFlLGtFQUFVO0FBQ3pCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QseUJBQXlCLGdEQUE0QjtBQUNyRCxlQUFlLGtFQUFVO0FBQ3pCO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QseUJBQXlCLGdEQUE0QjtBQUNyRCxlQUFlLGtFQUFVO0FBQ3pCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxxQkFBcUIsOENBQU87QUFDNUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDhDQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixnREFBNEI7QUFDckQsZUFBZSxrRUFBVTtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCx5QkFBeUIsZ0RBQTRCO0FBQ3JELGVBQWUsa0VBQVU7QUFDekI7QUFDQSxHQUFHLGtCQUFrQixnREFBNEIsQ0FBQyw2Q0FBSztBQUN2RDtBQUNBLEdBQUc7QUFDSDtBQUNBLG9CQUFvQixpREFBVTtBQUM5QixLQUFLLDREQUE0RDtBQUNqRSw4QkFBOEIsK0NBQVE7QUFDdEMsWUFBWSxrQkFBa0IsRUFBRSxrRUFBcUI7QUFDckQsY0FBYyw0REFBWTtBQUMxQiw2QkFBNkIsa0RBQVc7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSw4QkFBOEIsa0RBQVc7QUFDekM7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSwyQkFBMkIsZ0RBQTRCLENBQUMseURBQXFCO0FBQzdFO0FBQ0E7QUFDQSxLQUFLLDRCQUE0QixnREFBNEIsQ0FBQywyREFBdUI7QUFDckY7QUFDQSxLQUFLLGtCQUFrQixnREFBNEIsQ0FBQyw0REFBd0I7QUFDNUU7QUFDQTtBQUNBLGtCQUFrQix3RUFBNEI7QUFDOUMsd0JBQXdCLDhFQUFrQztBQUMxRCxpQkFBaUIsa0VBQVU7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssa0JBQWtCLGdEQUE0QixDQUFDLG1FQUFlO0FBQ25FO0FBQ0E7QUFDQSxLQUFLLGtCQUFrQixnREFBNEI7QUFDbkQ7QUFDQSxLQUFLLGtCQUFrQixnREFBNEI7QUFDbkQ7QUFDQSxLQUFLLGtCQUFrQixnREFBNEIsQ0FBQyxxRUFBaUI7QUFDckU7QUFDQTtBQUNBO0FBQ0EsS0FBSyxtQkFBbUIsZ0RBQTRCLENBQUMseURBQVU7QUFDL0Q7QUFDQSxLQUFLLHFCQUFxQixnREFBNEIsQ0FBQyxzRUFBa0I7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFdUI7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2NvbXBvbmVudHMvaW50ZXJuYWwvRW1vamlQaWNrZXIubWpzPzMwMDUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUG9wb3ZlclByaW1pdGl2ZSBmcm9tICdAcmFkaXgtdWkvcmVhY3QtcG9wb3Zlcic7XG5leHBvcnQgeyBQb3BvdmVyVHJpZ2dlciBhcyBFbW9qaVBpY2tlclRyaWdnZXIgfSBmcm9tICdAcmFkaXgtdWkvcmVhY3QtcG9wb3Zlcic7XG5pbXBvcnQgUmVhY3RfX2RlZmF1bHQsIHsgZm9yd2FyZFJlZiwgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VNZW1vIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlTGl2ZWJsb2Nrc1VJQ29uZmlnIH0gZnJvbSAnLi4vLi4vY29uZmlnLm1qcyc7XG5pbXBvcnQgeyBGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VULCBGTE9BVElOR19FTEVNRU5UX0NPTExJU0lPTl9QQURESU5HIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzLm1qcyc7XG5pbXBvcnQgeyBTZWFyY2hJY29uIH0gZnJvbSAnLi4vLi4vaWNvbnMvU2VhcmNoLm1qcyc7XG5pbXBvcnQgeyBTcGlubmVySWNvbiB9IGZyb20gJy4uLy4uL2ljb25zL1NwaW5uZXIubWpzJztcbmltcG9ydCB7IHVzZU92ZXJyaWRlcyB9IGZyb20gJy4uLy4uL292ZXJyaWRlcy5tanMnO1xuaW1wb3J0IHsgUm9vdCBhcyBFbW9qaVBpY2tlclJvb3QsIFNlYXJjaCBhcyBFbW9qaVBpY2tlclNlYXJjaCwgQ29udGVudCBhcyBFbW9qaVBpY2tlckNvbnRlbnQgfSBmcm9tICcuLi8uLi9wcmltaXRpdmVzL0Vtb2ppUGlja2VyL2luZGV4Lm1qcyc7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSAnLi4vLi4vdXRpbHMvY2xhc3MtbmFtZXMubWpzJztcbmltcG9ydCB7IEVtb2ppIH0gZnJvbSAnLi9FbW9qaS5tanMnO1xuXG5mdW5jdGlvbiBFbW9qaVBpY2tlckxvYWRpbmcoe1xuICBjbGFzc05hbWUsXG4gIC4uLnByb3BzXG59KSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7XG4gICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKFwibGItZW1vamktcGlja2VyLWxvYWRpbmdcIiwgY2xhc3NOYW1lKSxcbiAgICAuLi5wcm9wc1xuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChTcGlubmVySWNvbiwgbnVsbCkpO1xufVxuZnVuY3Rpb24gRW1vamlQaWNrZXJFbXB0eSh7XG4gIGNsYXNzTmFtZSxcbiAgLi4ucHJvcHNcbn0pIHtcbiAgY29uc3QgJCA9IHVzZU92ZXJyaWRlcygpO1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwge1xuICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyhcImxiLWVtb2ppLXBpY2tlci1lbXB0eVwiLCBjbGFzc05hbWUpLFxuICAgIC4uLnByb3BzXG4gIH0sICQuRU1PSklfUElDS0VSX0VNUFRZKTtcbn1cbmZ1bmN0aW9uIEVtb2ppUGlja2VyRXJyb3Ioe1xuICBlcnJvcixcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufSkge1xuICBjb25zdCAkID0gdXNlT3ZlcnJpZGVzKCk7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7XG4gICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKFwibGItZW1vamktcGlja2VyLWVycm9yXCIsIGNsYXNzTmFtZSksXG4gICAgLi4ucHJvcHNcbiAgfSwgJC5FTU9KSV9QSUNLRVJfRVJST1IoZXJyb3IpKTtcbn1cbmZ1bmN0aW9uIEVtb2ppUGlja2VyQ2F0ZWdvcnlIZWFkZXIoe1xuICBjYXRlZ29yeSxcbiAgY2xhc3NOYW1lLFxuICAuLi5wcm9wc1xufSkge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwge1xuICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyhcImxiLWVtb2ppLXBpY2tlci1jYXRlZ29yeS1oZWFkZXJcIiwgY2xhc3NOYW1lKSxcbiAgICAuLi5wcm9wc1xuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInNwYW5cIiwge1xuICAgIGNsYXNzTmFtZTogXCJsYi1lbW9qaS1waWNrZXItY2F0ZWdvcnktaGVhZGVyLXRpdGxlXCJcbiAgfSwgY2F0ZWdvcnkpKTtcbn1cbmZ1bmN0aW9uIEVtb2ppUGlja2VyR3JpZCh7XG4gIGNoaWxkcmVuLFxuICBjbGFzc05hbWUsXG4gIC4uLnByb3BzXG59KSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7XG4gICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKFwibGItZW1vamktcGlja2VyLWdyaWRcIiwgY2xhc3NOYW1lKSxcbiAgICAuLi5wcm9wc1xuICB9LCBjaGlsZHJlbik7XG59XG5mdW5jdGlvbiBFbW9qaVBpY2tlclJvdyh7XG4gIGF0dHJpYnV0ZXMsXG4gIGNoaWxkcmVuLFxuICBjbGFzc05hbWUsXG4gIC4uLnByb3BzXG59KSB7XG4gIGNvbnN0IGlzRmlyc3RSb3cgPSB1c2VNZW1vKFxuICAgICgpID0+IGF0dHJpYnV0ZXMuY2F0ZWdvcnlSb3dJbmRleCA9PT0gMCxcbiAgICBbYXR0cmlidXRlcy5jYXRlZ29yeVJvd0luZGV4XVxuICApO1xuICBjb25zdCBpc0xhc3RSb3cgPSB1c2VNZW1vKFxuICAgICgpID0+IGF0dHJpYnV0ZXMuY2F0ZWdvcnlSb3dJbmRleCA9PT0gYXR0cmlidXRlcy5jYXRlZ29yeVJvd3NDb3VudCAtIDEsXG4gICAgW2F0dHJpYnV0ZXMuY2F0ZWdvcnlSb3dJbmRleCwgYXR0cmlidXRlcy5jYXRlZ29yeVJvd3NDb3VudF1cbiAgKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoXCJsYi1lbW9qaS1waWNrZXItcm93XCIsIGNsYXNzTmFtZSksXG4gICAgXCJkYXRhLWZpcnN0XCI6IGlzRmlyc3RSb3cgPyBcIlwiIDogdm9pZCAwLFxuICAgIFwiZGF0YS1sYXN0XCI6IGlzTGFzdFJvdyA/IFwiXCIgOiB2b2lkIDAsXG4gICAgLi4ucHJvcHNcbiAgfSwgY2hpbGRyZW4pO1xufVxuZnVuY3Rpb24gRW1vamlQaWNrZXJFbW9qaSh7XG4gIGVtb2ppLFxuICBjbGFzc05hbWUsXG4gIC4uLnByb3BzXG59KSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7XG4gICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKFwibGItZW1vamktcGlja2VyLWVtb2ppXCIsIGNsYXNzTmFtZSksXG4gICAgLi4ucHJvcHNcbiAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoRW1vamksIHtcbiAgICBlbW9qaVxuICB9KSk7XG59XG5jb25zdCBFbW9qaVBpY2tlciA9IGZvcndhcmRSZWYoXG4gICh7IG9uRW1vamlTZWxlY3QsIG9uT3BlbkNoYW5nZSwgY2hpbGRyZW4sIGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgW2lzT3Blbiwgc2V0T3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgeyBwb3J0YWxDb250YWluZXIgfSA9IHVzZUxpdmVibG9ja3NVSUNvbmZpZygpO1xuICAgIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMoKTtcbiAgICBjb25zdCBoYW5kbGVPcGVuQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgICAoaXNPcGVuMikgPT4ge1xuICAgICAgICBzZXRPcGVuKGlzT3BlbjIpO1xuICAgICAgICBvbk9wZW5DaGFuZ2U/Lihpc09wZW4yKTtcbiAgICAgIH0sXG4gICAgICBbb25PcGVuQ2hhbmdlXVxuICAgICk7XG4gICAgY29uc3QgaGFuZGxlRW1vamlTZWxlY3QgPSB1c2VDYWxsYmFjayhcbiAgICAgIChlbW9qaSkgPT4ge1xuICAgICAgICBzZXRPcGVuKGZhbHNlKTtcbiAgICAgICAgb25FbW9qaVNlbGVjdD8uKGVtb2ppKTtcbiAgICAgIH0sXG4gICAgICBbb25FbW9qaVNlbGVjdF1cbiAgICApO1xuICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChQb3BvdmVyUHJpbWl0aXZlLlJvb3QsIHtcbiAgICAgIG9wZW46IGlzT3BlbixcbiAgICAgIG9uT3BlbkNoYW5nZTogaGFuZGxlT3BlbkNoYW5nZVxuICAgIH0sIGNoaWxkcmVuLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChQb3BvdmVyUHJpbWl0aXZlLlBvcnRhbCwge1xuICAgICAgY29udGFpbmVyOiBwb3J0YWxDb250YWluZXJcbiAgICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChQb3BvdmVyUHJpbWl0aXZlLkNvbnRlbnQsIHtcbiAgICAgIHNpZGU6IFwidG9wXCIsXG4gICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgIHNpZGVPZmZzZXQ6IEZMT0FUSU5HX0VMRU1FTlRfU0lERV9PRkZTRVQsXG4gICAgICBjb2xsaXNpb25QYWRkaW5nOiBGTE9BVElOR19FTEVNRU5UX0NPTExJU0lPTl9QQURESU5HLFxuICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKFxuICAgICAgICBcImxiLXJvb3QgbGItcG9ydGFsIGxiLWVsZXZhdGlvbiBsYi1lbW9qaS1waWNrZXJcIixcbiAgICAgICAgY2xhc3NOYW1lXG4gICAgICApLFxuICAgICAgLi4ucHJvcHMsXG4gICAgICByZWY6IGZvcndhcmRlZFJlZlxuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEVtb2ppUGlja2VyUm9vdCwge1xuICAgICAgb25FbW9qaVNlbGVjdDogaGFuZGxlRW1vamlTZWxlY3QsXG4gICAgICBsb2NhbGU6ICQubG9jYWxlXG4gICAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwge1xuICAgICAgY2xhc3NOYW1lOiBcImxiLWVtb2ppLXBpY2tlci1oZWFkZXJcIlxuICAgIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAgIGNsYXNzTmFtZTogXCJsYi1lbW9qaS1waWNrZXItc2VhcmNoLWNvbnRhaW5lclwiXG4gICAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoRW1vamlQaWNrZXJTZWFyY2gsIHtcbiAgICAgIGNsYXNzTmFtZTogXCJsYi1lbW9qaS1waWNrZXItc2VhcmNoXCIsXG4gICAgICBwbGFjZWhvbGRlcjogJC5FTU9KSV9QSUNLRVJfU0VBUkNIX1BMQUNFSE9MREVSLFxuICAgICAgYXV0b0ZvY3VzOiB0cnVlXG4gICAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFNlYXJjaEljb24sIHtcbiAgICAgIGNsYXNzTmFtZTogXCJsYi1lbW9qaS1waWNrZXItc2VhcmNoLWljb25cIlxuICAgIH0pKSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEVtb2ppUGlja2VyQ29udGVudCwge1xuICAgICAgY2xhc3NOYW1lOiBcImxiLWVtb2ppLXBpY2tlci1jb250ZW50XCIsXG4gICAgICBjb21wb25lbnRzOiB7XG4gICAgICAgIExvYWRpbmc6IEVtb2ppUGlja2VyTG9hZGluZyxcbiAgICAgICAgRW1wdHk6IEVtb2ppUGlja2VyRW1wdHksXG4gICAgICAgIEVycm9yOiBFbW9qaVBpY2tlckVycm9yLFxuICAgICAgICBDYXRlZ29yeUhlYWRlcjogRW1vamlQaWNrZXJDYXRlZ29yeUhlYWRlcixcbiAgICAgICAgR3JpZDogRW1vamlQaWNrZXJHcmlkLFxuICAgICAgICBSb3c6IEVtb2ppUGlja2VyUm93LFxuICAgICAgICBFbW9qaTogRW1vamlQaWNrZXJFbW9qaVxuICAgICAgfVxuICAgIH0pKSkpKTtcbiAgfVxuKTtcblxuZXhwb3J0IHsgRW1vamlQaWNrZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVtb2ppUGlja2VyLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/EmojiPicker.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ICON_HEIGHT: () => (/* binding */ ICON_HEIGHT),\n/* harmony export */   ICON_WIDTH: () => (/* binding */ ICON_WIDTH),\n/* harmony export */   Icon: () => (/* binding */ Icon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n\n\n\nconst ICON_WIDTH = 20;\nconst ICON_HEIGHT = 20;\nfunction Icon({ children, className, ...props }) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: ICON_WIDTH,\n    height: ICON_HEIGHT,\n    viewBox: `0 0 ${ICON_WIDTH} ${ICON_HEIGHT}`,\n    fill: \"none\",\n    stroke: \"currentColor\",\n    strokeWidth: 1.5,\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    role: \"presentation\",\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_1__.classNames)(\"lb-icon\", className),\n    ...props\n  }, children);\n}\n\n\n//# sourceMappingURL=Icon.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQW1DO0FBQ3NCOztBQUV6RDtBQUNBO0FBQ0EsZ0JBQWdCLCtCQUErQjtBQUMvQyx5QkFBeUIsZ0RBQTRCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixZQUFZLEVBQUUsWUFBWTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLGtFQUFVO0FBQ3pCO0FBQ0EsR0FBRztBQUNIOztBQUV5QztBQUN6QyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvY29tcG9uZW50cy9pbnRlcm5hbC9JY29uLm1qcz8wNzQyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdF9fZGVmYXVsdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSAnLi4vLi4vdXRpbHMvY2xhc3MtbmFtZXMubWpzJztcblxuY29uc3QgSUNPTl9XSURUSCA9IDIwO1xuY29uc3QgSUNPTl9IRUlHSFQgPSAyMDtcbmZ1bmN0aW9uIEljb24oeyBjaGlsZHJlbiwgY2xhc3NOYW1lLCAuLi5wcm9wcyB9KSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInN2Z1wiLCB7XG4gICAgeG1sbnM6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIixcbiAgICB3aWR0aDogSUNPTl9XSURUSCxcbiAgICBoZWlnaHQ6IElDT05fSEVJR0hULFxuICAgIHZpZXdCb3g6IGAwIDAgJHtJQ09OX1dJRFRIfSAke0lDT05fSEVJR0hUfWAsXG4gICAgZmlsbDogXCJub25lXCIsXG4gICAgc3Ryb2tlOiBcImN1cnJlbnRDb2xvclwiLFxuICAgIHN0cm9rZVdpZHRoOiAxLjUsXG4gICAgc3Ryb2tlTGluZWNhcDogXCJyb3VuZFwiLFxuICAgIHN0cm9rZUxpbmVqb2luOiBcInJvdW5kXCIsXG4gICAgcm9sZTogXCJwcmVzZW50YXRpb25cIixcbiAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoXCJsYi1pY29uXCIsIGNsYXNzTmFtZSksXG4gICAgLi4ucHJvcHNcbiAgfSwgY2hpbGRyZW4pO1xufVxuXG5leHBvcnQgeyBJQ09OX0hFSUdIVCwgSUNPTl9XSURUSCwgSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SWNvbi5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/InboxNotificationThread.mjs":
/*!************************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/InboxNotificationThread.mjs ***!
  \************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   INBOX_NOTIFICATION_THREAD_MAX_COMMENTS: () => (/* binding */ INBOX_NOTIFICATION_THREAD_MAX_COMMENTS),\n/* harmony export */   InboxNotificationComment: () => (/* binding */ InboxNotificationComment),\n/* harmony export */   generateInboxNotificationThreadContents: () => (/* binding */ generateInboxNotificationThreadContents)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _primitives_Comment_index_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../primitives/Comment/index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/index.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _Comment_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../Comment.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/Comment.mjs\");\n/* harmony import */ var _User_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./User.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs\");\n\n\n\n\n\n\n\n\nconst INBOX_NOTIFICATION_THREAD_MAX_COMMENTS = 3;\nfunction InboxNotificationComment({\n  comment,\n  showHeader = true,\n  overrides,\n  className,\n  ...props\n}) {\n  const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_1__.useOverrides)(overrides);\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\n      \"lb-root lb-inbox-notification-comment lb-comment\",\n      className\n    ),\n    ...props\n  }, showHeader && /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    className: \"lb-comment-header\"\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_User_mjs__WEBPACK_IMPORTED_MODULE_3__.User, {\n    className: \"lb-comment-author\",\n    userId: comment.userId\n  })), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    className: \"lb-comment-content\"\n  }, comment.body ? /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_primitives_Comment_index_mjs__WEBPACK_IMPORTED_MODULE_4__.Body, {\n    className: \"lb-comment-body\",\n    body: comment.body,\n    components: {\n      Mention: _Comment_mjs__WEBPACK_IMPORTED_MODULE_5__.CommentMention,\n      Link: _Comment_mjs__WEBPACK_IMPORTED_MODULE_5__.CommentNonInteractiveLink\n    }\n  }), comment.reactions.length > 0 && /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    className: \"lb-comment-reactions\"\n  }, comment.reactions.map((reaction) => /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Comment_mjs__WEBPACK_IMPORTED_MODULE_5__.CommentNonInteractiveReaction, {\n    key: reaction.emoji,\n    reaction,\n    overrides,\n    disabled: true\n  })))) : /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n    className: \"lb-comment-body\"\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"p\", {\n    className: \"lb-comment-deleted\"\n  }, $.COMMENT_DELETED))));\n}\nfunction findLastCommentWithMentionedId(comments, mentionedId) {\n  for (let i = comments.length - 1; i >= 0; i--) {\n    const comment = comments[i];\n    if (comment.userId === mentionedId) {\n      continue;\n    }\n    if (comment.body) {\n      const mentionedIds = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_6__.getMentionedIdsFromCommentBody)(comment.body);\n      if (mentionedIds.includes(mentionedId)) {\n        return comment;\n      }\n    }\n  }\n  return;\n}\nfunction getUserIdsFromComments(comments) {\n  return Array.from(new Set(comments.map((comment) => comment.userId)));\n}\nfunction generateInboxNotificationThreadContents(inboxNotification, thread, userId) {\n  const unreadComments = thread.comments.filter((comment) => {\n    if (!comment.body) {\n      return false;\n    }\n    return inboxNotification.readAt ? comment.createdAt > inboxNotification.readAt && comment.createdAt <= inboxNotification.notifiedAt : comment.createdAt <= inboxNotification.notifiedAt;\n  });\n  if (unreadComments.length === 0) {\n    const lastComments = thread.comments.filter((comment) => comment.body).slice(-INBOX_NOTIFICATION_THREAD_MAX_COMMENTS);\n    return {\n      type: \"comments\",\n      unread: false,\n      comments: lastComments,\n      userIds: getUserIdsFromComments(lastComments),\n      date: inboxNotification.notifiedAt\n    };\n  }\n  const commentWithMention = findLastCommentWithMentionedId(\n    unreadComments,\n    userId\n  );\n  if (commentWithMention) {\n    return {\n      type: \"mention\",\n      unread: true,\n      comments: [commentWithMention],\n      userIds: [commentWithMention.userId],\n      date: commentWithMention.createdAt\n    };\n  }\n  const lastUnreadComments = unreadComments.slice(\n    -INBOX_NOTIFICATION_THREAD_MAX_COMMENTS\n  );\n  return {\n    type: \"comments\",\n    unread: true,\n    comments: lastUnreadComments,\n    userIds: getUserIdsFromComments(unreadComments),\n    date: inboxNotification.notifiedAt\n  };\n}\n\n\n//# sourceMappingURL=InboxNotificationThread.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0luYm94Tm90aWZpY2F0aW9uVGhyZWFkLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQWtFO0FBQy9CO0FBQ2dCO0FBQ3NCO0FBQ2hCO0FBQ2lEO0FBQ3hFOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxZQUFZLDREQUFZO0FBQ3hCLHlCQUF5QixnREFBNEI7QUFDckQsZUFBZSxrRUFBVTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsZ0NBQWdDLGdEQUE0QjtBQUMvRDtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QixDQUFDLDJDQUFJO0FBQ3REO0FBQ0E7QUFDQSxHQUFHLG9CQUFvQixnREFBNEI7QUFDbkQ7QUFDQSxHQUFHLGlDQUFpQyxnREFBNEIsQ0FBQywyQ0FBdUIsd0JBQXdCLGdEQUE0QixDQUFDLCtEQUFXO0FBQ3hKO0FBQ0E7QUFDQTtBQUNBLGVBQWUsd0RBQWM7QUFDN0IsWUFBWSxtRUFBeUI7QUFDckM7QUFDQSxHQUFHLG1EQUFtRCxnREFBNEI7QUFDbEY7QUFDQSxHQUFHLHNEQUFzRCxnREFBNEIsQ0FBQyx1RUFBNkI7QUFDbkg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLHVCQUF1QixnREFBNEI7QUFDdEQ7QUFDQSxHQUFHLGtCQUFrQixnREFBNEI7QUFDakQ7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLG9DQUFvQyxRQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsZ0ZBQThCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVxSDtBQUNySCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvY29tcG9uZW50cy9pbnRlcm5hbC9JbmJveE5vdGlmaWNhdGlvblRocmVhZC5tanM/NGY4YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRNZW50aW9uZWRJZHNGcm9tQ29tbWVudEJvZHkgfSBmcm9tICdAbGl2ZWJsb2Nrcy9jb3JlJztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VPdmVycmlkZXMgfSBmcm9tICcuLi8uLi9vdmVycmlkZXMubWpzJztcbmltcG9ydCB7IEJvZHkgYXMgQ29tbWVudEJvZHkgfSBmcm9tICcuLi8uLi9wcmltaXRpdmVzL0NvbW1lbnQvaW5kZXgubWpzJztcbmltcG9ydCB7IGNsYXNzTmFtZXMgfSBmcm9tICcuLi8uLi91dGlscy9jbGFzcy1uYW1lcy5tanMnO1xuaW1wb3J0IHsgQ29tbWVudE1lbnRpb24sIENvbW1lbnROb25JbnRlcmFjdGl2ZUxpbmssIENvbW1lbnROb25JbnRlcmFjdGl2ZVJlYWN0aW9uIH0gZnJvbSAnLi4vQ29tbWVudC5tanMnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4vVXNlci5tanMnO1xuXG5jb25zdCBJTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX01BWF9DT01NRU5UUyA9IDM7XG5mdW5jdGlvbiBJbmJveE5vdGlmaWNhdGlvbkNvbW1lbnQoe1xuICBjb21tZW50LFxuICBzaG93SGVhZGVyID0gdHJ1ZSxcbiAgb3ZlcnJpZGVzLFxuICBjbGFzc05hbWUsXG4gIC4uLnByb3BzXG59KSB7XG4gIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMob3ZlcnJpZGVzKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoXG4gICAgICBcImxiLXJvb3QgbGItaW5ib3gtbm90aWZpY2F0aW9uLWNvbW1lbnQgbGItY29tbWVudFwiLFxuICAgICAgY2xhc3NOYW1lXG4gICAgKSxcbiAgICAuLi5wcm9wc1xuICB9LCBzaG93SGVhZGVyICYmIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICBjbGFzc05hbWU6IFwibGItY29tbWVudC1oZWFkZXJcIlxuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChVc2VyLCB7XG4gICAgY2xhc3NOYW1lOiBcImxiLWNvbW1lbnQtYXV0aG9yXCIsXG4gICAgdXNlcklkOiBjb21tZW50LnVzZXJJZFxuICB9KSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICBjbGFzc05hbWU6IFwibGItY29tbWVudC1jb250ZW50XCJcbiAgfSwgY29tbWVudC5ib2R5ID8gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoUmVhY3RfX2RlZmF1bHQuRnJhZ21lbnQsIG51bGwsIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbW1lbnRCb2R5LCB7XG4gICAgY2xhc3NOYW1lOiBcImxiLWNvbW1lbnQtYm9keVwiLFxuICAgIGJvZHk6IGNvbW1lbnQuYm9keSxcbiAgICBjb21wb25lbnRzOiB7XG4gICAgICBNZW50aW9uOiBDb21tZW50TWVudGlvbixcbiAgICAgIExpbms6IENvbW1lbnROb25JbnRlcmFjdGl2ZUxpbmtcbiAgICB9XG4gIH0pLCBjb21tZW50LnJlYWN0aW9ucy5sZW5ndGggPiAwICYmIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICBjbGFzc05hbWU6IFwibGItY29tbWVudC1yZWFjdGlvbnNcIlxuICB9LCBjb21tZW50LnJlYWN0aW9ucy5tYXAoKHJlYWN0aW9uKSA9PiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChDb21tZW50Tm9uSW50ZXJhY3RpdmVSZWFjdGlvbiwge1xuICAgIGtleTogcmVhY3Rpb24uZW1vamksXG4gICAgcmVhY3Rpb24sXG4gICAgb3ZlcnJpZGVzLFxuICAgIGRpc2FibGVkOiB0cnVlXG4gIH0pKSkpIDogLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwge1xuICAgIGNsYXNzTmFtZTogXCJsYi1jb21tZW50LWJvZHlcIlxuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBcIiwge1xuICAgIGNsYXNzTmFtZTogXCJsYi1jb21tZW50LWRlbGV0ZWRcIlxuICB9LCAkLkNPTU1FTlRfREVMRVRFRCkpKSk7XG59XG5mdW5jdGlvbiBmaW5kTGFzdENvbW1lbnRXaXRoTWVudGlvbmVkSWQoY29tbWVudHMsIG1lbnRpb25lZElkKSB7XG4gIGZvciAobGV0IGkgPSBjb21tZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IGNvbW1lbnQgPSBjb21tZW50c1tpXTtcbiAgICBpZiAoY29tbWVudC51c2VySWQgPT09IG1lbnRpb25lZElkKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKGNvbW1lbnQuYm9keSkge1xuICAgICAgY29uc3QgbWVudGlvbmVkSWRzID0gZ2V0TWVudGlvbmVkSWRzRnJvbUNvbW1lbnRCb2R5KGNvbW1lbnQuYm9keSk7XG4gICAgICBpZiAobWVudGlvbmVkSWRzLmluY2x1ZGVzKG1lbnRpb25lZElkKSkge1xuICAgICAgICByZXR1cm4gY29tbWVudDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuO1xufVxuZnVuY3Rpb24gZ2V0VXNlcklkc0Zyb21Db21tZW50cyhjb21tZW50cykge1xuICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGNvbW1lbnRzLm1hcCgoY29tbWVudCkgPT4gY29tbWVudC51c2VySWQpKSk7XG59XG5mdW5jdGlvbiBnZW5lcmF0ZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkQ29udGVudHMoaW5ib3hOb3RpZmljYXRpb24sIHRocmVhZCwgdXNlcklkKSB7XG4gIGNvbnN0IHVucmVhZENvbW1lbnRzID0gdGhyZWFkLmNvbW1lbnRzLmZpbHRlcigoY29tbWVudCkgPT4ge1xuICAgIGlmICghY29tbWVudC5ib2R5KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBpbmJveE5vdGlmaWNhdGlvbi5yZWFkQXQgPyBjb21tZW50LmNyZWF0ZWRBdCA+IGluYm94Tm90aWZpY2F0aW9uLnJlYWRBdCAmJiBjb21tZW50LmNyZWF0ZWRBdCA8PSBpbmJveE5vdGlmaWNhdGlvbi5ub3RpZmllZEF0IDogY29tbWVudC5jcmVhdGVkQXQgPD0gaW5ib3hOb3RpZmljYXRpb24ubm90aWZpZWRBdDtcbiAgfSk7XG4gIGlmICh1bnJlYWRDb21tZW50cy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zdCBsYXN0Q29tbWVudHMgPSB0aHJlYWQuY29tbWVudHMuZmlsdGVyKChjb21tZW50KSA9PiBjb21tZW50LmJvZHkpLnNsaWNlKC1JTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX01BWF9DT01NRU5UUyk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiY29tbWVudHNcIixcbiAgICAgIHVucmVhZDogZmFsc2UsXG4gICAgICBjb21tZW50czogbGFzdENvbW1lbnRzLFxuICAgICAgdXNlcklkczogZ2V0VXNlcklkc0Zyb21Db21tZW50cyhsYXN0Q29tbWVudHMpLFxuICAgICAgZGF0ZTogaW5ib3hOb3RpZmljYXRpb24ubm90aWZpZWRBdFxuICAgIH07XG4gIH1cbiAgY29uc3QgY29tbWVudFdpdGhNZW50aW9uID0gZmluZExhc3RDb21tZW50V2l0aE1lbnRpb25lZElkKFxuICAgIHVucmVhZENvbW1lbnRzLFxuICAgIHVzZXJJZFxuICApO1xuICBpZiAoY29tbWVudFdpdGhNZW50aW9uKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwibWVudGlvblwiLFxuICAgICAgdW5yZWFkOiB0cnVlLFxuICAgICAgY29tbWVudHM6IFtjb21tZW50V2l0aE1lbnRpb25dLFxuICAgICAgdXNlcklkczogW2NvbW1lbnRXaXRoTWVudGlvbi51c2VySWRdLFxuICAgICAgZGF0ZTogY29tbWVudFdpdGhNZW50aW9uLmNyZWF0ZWRBdFxuICAgIH07XG4gIH1cbiAgY29uc3QgbGFzdFVucmVhZENvbW1lbnRzID0gdW5yZWFkQ29tbWVudHMuc2xpY2UoXG4gICAgLUlOQk9YX05PVElGSUNBVElPTl9USFJFQURfTUFYX0NPTU1FTlRTXG4gICk7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJjb21tZW50c1wiLFxuICAgIHVucmVhZDogdHJ1ZSxcbiAgICBjb21tZW50czogbGFzdFVucmVhZENvbW1lbnRzLFxuICAgIHVzZXJJZHM6IGdldFVzZXJJZHNGcm9tQ29tbWVudHModW5yZWFkQ29tbWVudHMpLFxuICAgIGRhdGU6IGluYm94Tm90aWZpY2F0aW9uLm5vdGlmaWVkQXRcbiAgfTtcbn1cblxuZXhwb3J0IHsgSU5CT1hfTk9USUZJQ0FUSU9OX1RIUkVBRF9NQVhfQ09NTUVOVFMsIEluYm94Tm90aWZpY2F0aW9uQ29tbWVudCwgZ2VuZXJhdGVJbmJveE5vdGlmaWNhdGlvblRocmVhZENvbnRlbnRzIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1JbmJveE5vdGlmaWNhdGlvblRocmVhZC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/InboxNotificationThread.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/List.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/List.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   List: () => (/* binding */ List)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_intl_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/intl.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/intl.mjs\");\n\n\n\n\n\n\nconst List = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  ({ values, formatRemaining, truncate, locale, className, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__.Slot : \"span\";\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_2__.useOverrides)();\n    const formatRemainingWithDefault = formatRemaining ?? $.LIST_REMAINING;\n    const formattedList = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {\n      const elements = truncate && truncate < values.length - 1 ? [\n        ...values.slice(0, truncate),\n        formatRemainingWithDefault(values.length - truncate)\n      ] : [...values];\n      const placeholders = Array(elements.length).fill(\".\");\n      const parts = (0,_utils_intl_mjs__WEBPACK_IMPORTED_MODULE_3__.listFormat)(locale).formatToParts(placeholders);\n      return parts.map(\n        (part) => part.type === \"element\" ? elements.shift() : part.value\n      );\n    }, [formatRemainingWithDefault, locale, truncate, values]);\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n      className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-list\", className),\n      ...props,\n      ref: forwardedRef\n    }, formattedList);\n  }\n);\n\n\n//# sourceMappingURL=List.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0xpc3QubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUE0QztBQUNnQjtBQUNUO0FBQ007QUFDUDs7QUFFbEQsYUFBYSxpREFBVTtBQUN2QixLQUFLLHlFQUF5RTtBQUM5RSxnQ0FBZ0Msc0RBQUk7QUFDcEMsY0FBYyw0REFBWTtBQUMxQjtBQUNBLDBCQUEwQiw4Q0FBTztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDJEQUFVO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCwyQkFBMkIsZ0RBQTRCO0FBQ3ZELGlCQUFpQixrRUFBVTtBQUMzQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRWdCO0FBQ2hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL0xpc3QubWpzPzMxNWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2xvdCB9IGZyb20gJ0ByYWRpeC11aS9yZWFjdC1zbG90JztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyBmb3J3YXJkUmVmLCB1c2VNZW1vIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlT3ZlcnJpZGVzIH0gZnJvbSAnLi4vLi4vb3ZlcnJpZGVzLm1qcyc7XG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSAnLi4vLi4vdXRpbHMvY2xhc3MtbmFtZXMubWpzJztcbmltcG9ydCB7IGxpc3RGb3JtYXQgfSBmcm9tICcuLi8uLi91dGlscy9pbnRsLm1qcyc7XG5cbmNvbnN0IExpc3QgPSBmb3J3YXJkUmVmKFxuICAoeyB2YWx1ZXMsIGZvcm1hdFJlbWFpbmluZywgdHJ1bmNhdGUsIGxvY2FsZSwgY2xhc3NOYW1lLCBhc0NoaWxkLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgICBjb25zdCBDb21wb25lbnQgPSBhc0NoaWxkID8gU2xvdCA6IFwic3BhblwiO1xuICAgIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMoKTtcbiAgICBjb25zdCBmb3JtYXRSZW1haW5pbmdXaXRoRGVmYXVsdCA9IGZvcm1hdFJlbWFpbmluZyA/PyAkLkxJU1RfUkVNQUlOSU5HO1xuICAgIGNvbnN0IGZvcm1hdHRlZExpc3QgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIGNvbnN0IGVsZW1lbnRzID0gdHJ1bmNhdGUgJiYgdHJ1bmNhdGUgPCB2YWx1ZXMubGVuZ3RoIC0gMSA/IFtcbiAgICAgICAgLi4udmFsdWVzLnNsaWNlKDAsIHRydW5jYXRlKSxcbiAgICAgICAgZm9ybWF0UmVtYWluaW5nV2l0aERlZmF1bHQodmFsdWVzLmxlbmd0aCAtIHRydW5jYXRlKVxuICAgICAgXSA6IFsuLi52YWx1ZXNdO1xuICAgICAgY29uc3QgcGxhY2Vob2xkZXJzID0gQXJyYXkoZWxlbWVudHMubGVuZ3RoKS5maWxsKFwiLlwiKTtcbiAgICAgIGNvbnN0IHBhcnRzID0gbGlzdEZvcm1hdChsb2NhbGUpLmZvcm1hdFRvUGFydHMocGxhY2Vob2xkZXJzKTtcbiAgICAgIHJldHVybiBwYXJ0cy5tYXAoXG4gICAgICAgIChwYXJ0KSA9PiBwYXJ0LnR5cGUgPT09IFwiZWxlbWVudFwiID8gZWxlbWVudHMuc2hpZnQoKSA6IHBhcnQudmFsdWVcbiAgICAgICk7XG4gICAgfSwgW2Zvcm1hdFJlbWFpbmluZ1dpdGhEZWZhdWx0LCBsb2NhbGUsIHRydW5jYXRlLCB2YWx1ZXNdKTtcbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tcG9uZW50LCB7XG4gICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoXCJsYi1saXN0XCIsIGNsYXNzTmFtZSksXG4gICAgICAuLi5wcm9wcyxcbiAgICAgIHJlZjogZm9yd2FyZGVkUmVmXG4gICAgfSwgZm9ybWF0dGVkTGlzdCk7XG4gIH1cbik7XG5cbmV4cG9ydCB7IExpc3QgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxpc3QubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/List.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Room.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Room.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Room: () => (/* binding */ Room)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* __next_internal_client_entry_do_not_use__ Room auto */ \n\n\nfunction Room({ roomId, className, ...props }) {\n    const { info, isLoading } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_1__.useRoomInfo)(roomId);\n    const resolvedRoomName = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return info?.name ?? roomId;\n    }, [\n        info?.name,\n        roomId\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_2__.classNames)(\"lb-name lb-room\", className),\n        \"data-loading\": isLoading ? \"\" : void 0,\n        ...props\n    }, isLoading ? null : resolvedRoomName);\n}\n //# sourceMappingURL=Room.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL1Jvb20ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFZTyxTQUFBQSxLQUFBLEVBQUFDLE1BQUEsRUFBQUMsU0FBQSxLQUFBQyxPQUFBO0lBQ0wsUUFBQUMsSUFBQSxFQUFBQyxTQUFBLEtBQUFDLDhEQUFBQSxDQUFBTDtJQUNBLE1BQUFNLG1CQUFBQyw4Q0FBQUEsQ0FBQTtRQUNFLE9BQUFKLE1BQUFLLFFBQUFSO0lBQXFCO1FBQUFHLE1BQUFLO1FBQUFSO0tBQUE7SUFHdkIscUNBQUFTLGdEQUFBO1FBQ0dSLFdBQUFVLGtFQUFBQSxDQUFBLG1CQUFBVjtRQUNtRCxnQkFBQUcsWUFBQTtRQUNuQixHQUFBRixLQUFBO0lBQzNCLEdBQUFFLFlBQUEsT0FBQUU7QUFLViIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2ludGVybmFsL1Jvb20udHN4P2ExM2QiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB7IHVzZVJvb21JbmZvIH0gZnJvbSBcIkBsaXZlYmxvY2tzL3JlYWN0XCI7XG5pbXBvcnQgdHlwZSB7IENvbXBvbmVudFByb3BzIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVhY3QsIHsgdXNlTWVtbyB9IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgeyBjbGFzc05hbWVzIH0gZnJvbSBcIi4uLy4uL3V0aWxzL2NsYXNzLW5hbWVzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUm9vbVByb3BzIGV4dGVuZHMgQ29tcG9uZW50UHJvcHM8XCJzcGFuXCI+IHtcbiAgcm9vbUlkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBSb29tKHsgcm9vbUlkLCBjbGFzc05hbWUsIC4uLnByb3BzIH06IFJvb21Qcm9wcykge1xuICBjb25zdCB7IGluZm8sIGlzTG9hZGluZyB9ID0gdXNlUm9vbUluZm8ocm9vbUlkKTtcbiAgY29uc3QgcmVzb2x2ZWRSb29tTmFtZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIHJldHVybiBpbmZvPy5uYW1lID8/IHJvb21JZDtcbiAgfSwgW2luZm8/Lm5hbWUsIHJvb21JZF0pO1xuXG4gIHJldHVybiAoXG4gICAgPHNwYW5cbiAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImxiLW5hbWUgbGItcm9vbVwiLCBjbGFzc05hbWUpfVxuICAgICAgZGF0YS1sb2FkaW5nPXtpc0xvYWRpbmcgPyBcIlwiIDogdW5kZWZpbmVkfVxuICAgICAgey4uLnByb3BzfVxuICAgID5cbiAgICAgIHtpc0xvYWRpbmcgPyBudWxsIDogcmVzb2x2ZWRSb29tTmFtZX1cbiAgICA8L3NwYW4+XG4gICk7XG59XG4iXSwibmFtZXMiOlsiUm9vbSIsInJvb21JZCIsImNsYXNzTmFtZSIsInByb3BzIiwiaW5mbyIsImlzTG9hZGluZyIsInVzZVJvb21JbmZvIiwicmVzb2x2ZWRSb29tTmFtZSIsInVzZU1lbW8iLCJuYW1lIiwiUmVhY3RfX2RlZmF1bHQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Room.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs":
/*!********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs ***!
  \********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ShortcutTooltip: () => (/* binding */ ShortcutTooltip),\n/* harmony export */   ShortcutTooltipKey: () => (/* binding */ ShortcutTooltipKey),\n/* harmony export */   Tooltip: () => (/* binding */ Tooltip),\n/* harmony export */   TooltipProvider: () => (/* reexport safe */ _radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_0__.TooltipProvider)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @radix-ui/react-tooltip */ \"(ssr)/./node_modules/@radix-ui/react-tooltip/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _config_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/config.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../constants.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* harmony import */ var _utils_is_apple_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/is-apple.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-apple.mjs\");\n/* __next_internal_client_entry_do_not_use__ TooltipProvider,ShortcutTooltip,ShortcutTooltipKey,Tooltip auto */ \n\n\n\n\n\n\nconst KEYS = {\n    alt: ()=>({\n            title: \"Alt\",\n            key: \"\"\n        }),\n    mod: ()=>(0,_utils_is_apple_mjs__WEBPACK_IMPORTED_MODULE_2__.isApple)() ? {\n            title: \"Command\",\n            key: \"\"\n        } : {\n            title: \"Ctrl\",\n            key: \"\"\n        },\n    shift: ()=>{\n        return {\n            title: \"Shift\",\n            key: \"\"\n        };\n    },\n    enter: ()=>{\n        return {\n            title: \"Enter\",\n            key: \"\"\n        };\n    }\n};\nconst Tooltip = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_1__.forwardRef)(({ children, content, multiline, className, ...props }, forwardedRef)=>{\n    const { portalContainer } = (0,_config_mjs__WEBPACK_IMPORTED_MODULE_3__.useLiveblocksUIConfig)();\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_0__.Root, {\n        disableHoverableContent: true\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_0__.Trigger, {\n        asChild: true,\n        ref: forwardedRef\n    }, children), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_0__.Portal, {\n        container: portalContainer\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_0__.Content, {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_4__.classNames)(\"lb-root lb-portal lb-tooltip\", multiline && \"lb-tooltip:multiline\", className),\n        side: \"top\",\n        align: \"center\",\n        sideOffset: _constants_mjs__WEBPACK_IMPORTED_MODULE_5__.FLOATING_ELEMENT_SIDE_OFFSET,\n        collisionPadding: _constants_mjs__WEBPACK_IMPORTED_MODULE_5__.FLOATING_ELEMENT_COLLISION_PADDING,\n        ...props\n    }, content)));\n});\nconst ShortcutTooltip = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_1__.forwardRef)(({ children, content, shortcut, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(Tooltip, {\n        content: /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(react__WEBPACK_IMPORTED_MODULE_1__.Fragment, null, content, shortcut && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"kbd\", {\n            className: \"lb-tooltip-shortcut\"\n        }, shortcut)),\n        ...props,\n        ref: forwardedRef\n    }, children);\n});\nfunction ShortcutTooltipKey({ name, ...props }) {\n    const { title, key } = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>KEYS[name]?.(), [\n        name\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1__.createElement(\"abbr\", {\n        title,\n        ...props\n    }, key);\n}\n //# sourceMappingURL=Tooltip.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL1Rvb2x0aXAubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBY0EsTUFBQUEsT0FBQTtJQUFhQyxLQUFBO1lBQUFDLE9BQUE7WUFBQUMsS0FBQTtRQUFBO0lBQzBCQyxLQUFBLElBQUFDLDREQUFBQSxLQUFBO1lBQUFILE9BQUE7WUFBQUMsS0FBQTtRQUFBO1lBQUFELE9BQUE7WUFBQUMsS0FBQTtRQUFBO0lBRW9DRyxPQUFBO1FBRXZFO1lBQUFKLE9BQUE7WUFBQUMsS0FBQTtRQUFBO0lBQWtDO0lBQ3BDSSxPQUFBO1FBRUU7WUFBQUwsT0FBQTtZQUFBQyxLQUFBO1FBQUE7SUFBa0M7QUFFdEM7QUFpQk8sTUFBQUssd0JBQUFDLGlEQUFBQSxDQUFnQixHQUFBQyxRQUFBLEVBQUFDLE9BQUEsRUFBQUMsU0FBQSxFQUFBQyxTQUFBLEtBQUFDLE9BQUEsRUFBQUM7SUFFbkIsUUFBQUMsZUFBQSxLQUFBQyxrRUFBQUE7SUFFQSxxQ0FBQUMsZ0RBQUEsQ0FBQUUseURBQUE7UUFDR0UseUJBQUE7SUFBNkMsaUNBQUFKLGdEQUFBLENBQUFFLDREQUFBO1FBQzNDSSxTQUFBO1FBQWdDQyxLQUFBVjtJQUFNLEdBQUFMLFdBQUEsOEJBQUFRLGdEQUFBLENBQUFFLDJEQUFBO1FBR3RDTyxXQUFBWDtJQUFtQyxpQ0FBQUUsZ0RBQUEsQ0FBQUUsNERBQUE7UUFDakNQLFdBQUFnQixrRUFBQUEsQ0FDWSxnQ0FDVGpCLGFBQUEsd0JBQ2FDO1FBRWZpQixNQUFBO1FBQ0tDLE9BQUE7UUFDQ0MsWUFBQUMsd0VBQUFBO1FBQ01DLGtCQUFBQyw4RUFBQUE7UUFDTSxHQUFBckIsS0FBQTtJQUNkLEdBQUFIO0FBS1Y7QUFLTyxNQUFBeUIsZ0NBQUEzQixpREFBQUEsQ0FBQSxHQUFBQyxRQUFBLEVBQUFDLE9BQUEsRUFBQTBCLFFBQUEsS0FBQXZCLE9BQUEsRUFBQUM7SUFJWCxxQ0FBQUcsZ0RBQUEsQ0FBQVYsU0FBQTtRQUNHRyxTQUFBLDhCQUFBTyxnREFBQSxDQUFBQSwyQ0FBQSxRQUFBUCxTQUFBMEIsWUFBQSw4QkFBQW5CLGdEQUFBO1lBSW1CTCxXQUFBO1FBQWMsR0FBQXdCO1FBQzlCLEdBQUF2QixLQUFBO1FBRUVXLEtBQUFWO0lBQ0MsR0FBQUw7QUFLWDtBQUVPLFNBQUE2QixtQkFBQSxFQUE0QkMsSUFBQSxFQUNqQyxHQUFBMUIsT0FFRjtJQUNFLFFBQUFaLEtBQUEsRUFBQUMsR0FBQSxLQUFBc0MsOENBQUFBLENBQUEsSUFBQXpDLElBQUEsQ0FBQXdDLEtBQUE7UUFBQUE7S0FBQTtJQUVBLHFDQUFBdEIsZ0RBQUE7UUFDR2hCO1FBQUssR0FBQVksS0FBQTtJQUFrQixHQUFBWDtBQUk1QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2ludGVybmFsL1Rvb2x0aXAudHN4P2ZjMzAiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCAqIGFzIFRvb2x0aXBQcmltaXRpdmUgZnJvbSBcIkByYWRpeC11aS9yZWFjdC10b29sdGlwXCI7XG5pbXBvcnQgdHlwZSB7IENvbXBvbmVudFByb3BzLCBSZWFjdE5vZGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwgeyBmb3J3YXJkUmVmLCB1c2VNZW1vIH0gZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB7IHVzZUxpdmVibG9ja3NVSUNvbmZpZyB9IGZyb20gXCIuLi8uLi9jb25maWdcIjtcbmltcG9ydCB7XG4gIEZMT0FUSU5HX0VMRU1FTlRfQ09MTElTSU9OX1BBRERJTkcsXG4gIEZMT0FUSU5HX0VMRU1FTlRfU0lERV9PRkZTRVQsXG59IGZyb20gXCIuLi8uLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IGNsYXNzTmFtZXMgfSBmcm9tIFwiLi4vLi4vdXRpbHMvY2xhc3MtbmFtZXNcIjtcbmltcG9ydCB7IGlzQXBwbGUgfSBmcm9tIFwiLi4vLi4vdXRpbHMvaXMtYXBwbGVcIjtcblxuY29uc3QgS0VZUyA9IHtcbiAgYWx0OiAoKSA9PiAoeyB0aXRsZTogXCJBbHRcIiwga2V5OiBcIuKMpVwiIH0pLFxuICBtb2Q6ICgpID0+XG4gICAgaXNBcHBsZSgpID8geyB0aXRsZTogXCJDb21tYW5kXCIsIGtleTogXCLijJhcIiB9IDogeyB0aXRsZTogXCJDdHJsXCIsIGtleTogXCLijINcIiB9LFxuICBzaGlmdDogKCkgPT4ge1xuICAgIHJldHVybiB7IHRpdGxlOiBcIlNoaWZ0XCIsIGtleTogXCLih6dcIiB9O1xuICB9LFxuICBlbnRlcjogKCkgPT4ge1xuICAgIHJldHVybiB7IHRpdGxlOiBcIkVudGVyXCIsIGtleTogXCLij45cIiB9O1xuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGludGVyZmFjZSBUb29sdGlwUHJvcHNcbiAgZXh0ZW5kcyBQaWNrPFRvb2x0aXBQcmltaXRpdmUuVG9vbHRpcFRyaWdnZXJQcm9wcywgXCJjaGlsZHJlblwiPixcbiAgICBPbWl0PFRvb2x0aXBQcmltaXRpdmUuVG9vbHRpcENvbnRlbnRQcm9wcywgXCJjb250ZW50XCI+IHtcbiAgY29udGVudDogUmVhY3ROb2RlO1xuICBtdWx0aWxpbmU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNob3J0Y3V0VG9vbHRpcFByb3BzIGV4dGVuZHMgVG9vbHRpcFByb3BzIHtcbiAgc2hvcnRjdXQ/OiBSZWFjdE5vZGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2hvcnRjdXRUb29sdGlwS2V5UHJvcHMgZXh0ZW5kcyBDb21wb25lbnRQcm9wczxcImFiYnJcIj4ge1xuICBuYW1lOiBrZXlvZiB0eXBlb2YgS0VZUztcbn1cblxuZXhwb3J0IGNvbnN0IFRvb2x0aXAgPSBmb3J3YXJkUmVmPEhUTUxCdXR0b25FbGVtZW50LCBUb29sdGlwUHJvcHM+KFxuICAoeyBjaGlsZHJlbiwgY29udGVudCwgbXVsdGlsaW5lLCBjbGFzc05hbWUsIC4uLnByb3BzIH0sIGZvcndhcmRlZFJlZikgPT4ge1xuICAgIGNvbnN0IHsgcG9ydGFsQ29udGFpbmVyIH0gPSB1c2VMaXZlYmxvY2tzVUlDb25maWcoKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8VG9vbHRpcFByaW1pdGl2ZS5Sb290IGRpc2FibGVIb3ZlcmFibGVDb250ZW50PlxuICAgICAgICA8VG9vbHRpcFByaW1pdGl2ZS5UcmlnZ2VyIGFzQ2hpbGQgcmVmPXtmb3J3YXJkZWRSZWZ9PlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9Ub29sdGlwUHJpbWl0aXZlLlRyaWdnZXI+XG4gICAgICAgIDxUb29sdGlwUHJpbWl0aXZlLlBvcnRhbCBjb250YWluZXI9e3BvcnRhbENvbnRhaW5lcn0+XG4gICAgICAgICAgPFRvb2x0aXBQcmltaXRpdmUuQ29udGVudFxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFxuICAgICAgICAgICAgICBcImxiLXJvb3QgbGItcG9ydGFsIGxiLXRvb2x0aXBcIixcbiAgICAgICAgICAgICAgbXVsdGlsaW5lICYmIFwibGItdG9vbHRpcDptdWx0aWxpbmVcIixcbiAgICAgICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgc2lkZT1cInRvcFwiXG4gICAgICAgICAgICBhbGlnbj1cImNlbnRlclwiXG4gICAgICAgICAgICBzaWRlT2Zmc2V0PXtGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VUfVxuICAgICAgICAgICAgY29sbGlzaW9uUGFkZGluZz17RkxPQVRJTkdfRUxFTUVOVF9DT0xMSVNJT05fUEFERElOR31cbiAgICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y29udGVudH1cbiAgICAgICAgICA8L1Rvb2x0aXBQcmltaXRpdmUuQ29udGVudD5cbiAgICAgICAgPC9Ub29sdGlwUHJpbWl0aXZlLlBvcnRhbD5cbiAgICAgIDwvVG9vbHRpcFByaW1pdGl2ZS5Sb290PlxuICAgICk7XG4gIH1cbik7XG5cbmV4cG9ydCBjb25zdCBTaG9ydGN1dFRvb2x0aXAgPSBmb3J3YXJkUmVmPFxuICBIVE1MQnV0dG9uRWxlbWVudCxcbiAgU2hvcnRjdXRUb29sdGlwUHJvcHNcbj4oKHsgY2hpbGRyZW4sIGNvbnRlbnQsIHNob3J0Y3V0LCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgcmV0dXJuIChcbiAgICA8VG9vbHRpcFxuICAgICAgY29udGVudD17XG4gICAgICAgIDw+XG4gICAgICAgICAge2NvbnRlbnR9XG4gICAgICAgICAge3Nob3J0Y3V0ICYmIDxrYmQgY2xhc3NOYW1lPVwibGItdG9vbHRpcC1zaG9ydGN1dFwiPntzaG9ydGN1dH08L2tiZD59XG4gICAgICAgIDwvPlxuICAgICAgfVxuICAgICAgey4uLnByb3BzfVxuICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgPlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvVG9vbHRpcD5cbiAgKTtcbn0pO1xuXG5leHBvcnQgZnVuY3Rpb24gU2hvcnRjdXRUb29sdGlwS2V5KHtcbiAgbmFtZSxcbiAgLi4ucHJvcHNcbn06IFNob3J0Y3V0VG9vbHRpcEtleVByb3BzKSB7XG4gIGNvbnN0IHsgdGl0bGUsIGtleSB9ID0gdXNlTWVtbygoKSA9PiBLRVlTW25hbWVdPy4oKSwgW25hbWVdKTtcblxuICByZXR1cm4gKFxuICAgIDxhYmJyIHRpdGxlPXt0aXRsZX0gey4uLnByb3BzfT5cbiAgICAgIHtrZXl9XG4gICAgPC9hYmJyPlxuICApO1xufVxuXG5leHBvcnQgeyBUb29sdGlwUHJvdmlkZXIgfSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LXRvb2x0aXBcIjtcbiJdLCJuYW1lcyI6WyJLRVlTIiwiYWx0IiwidGl0bGUiLCJrZXkiLCJtb2QiLCJpc0FwcGxlIiwic2hpZnQiLCJlbnRlciIsIlRvb2x0aXAiLCJmb3J3YXJkUmVmIiwiY2hpbGRyZW4iLCJjb250ZW50IiwibXVsdGlsaW5lIiwiY2xhc3NOYW1lIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJwb3J0YWxDb250YWluZXIiLCJ1c2VMaXZlYmxvY2tzVUlDb25maWciLCJSZWFjdF9fZGVmYXVsdCIsImNyZWF0ZUVsZW1lbnQiLCJUb29sdGlwUHJpbWl0aXZlIiwiUm9vdCIsImRpc2FibGVIb3ZlcmFibGVDb250ZW50IiwiVHJpZ2dlciIsImFzQ2hpbGQiLCJyZWYiLCJQb3J0YWwiLCJjb250YWluZXIiLCJDb250ZW50IiwiY2xhc3NOYW1lcyIsInNpZGUiLCJhbGlnbiIsInNpZGVPZmZzZXQiLCJGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VUIiwiY29sbGlzaW9uUGFkZGluZyIsIkZMT0FUSU5HX0VMRU1FTlRfQ09MTElTSU9OX1BBRERJTkciLCJTaG9ydGN1dFRvb2x0aXAiLCJzaG9ydGN1dCIsIkZyYWdtZW50IiwiU2hvcnRjdXRUb29sdGlwS2V5IiwibmFtZSIsInVzZU1lbW8iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Tooltip.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   User: () => (/* binding */ User)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* harmony import */ var _shared_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../shared.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs\");\n/* harmony import */ var _utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/capitalize.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/capitalize.mjs\");\n/* harmony import */ var _utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/class-names.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\");\n/* __next_internal_client_entry_do_not_use__ User auto */ \n\n\n\n\n\nfunction User({ userId, replaceSelf, capitalize: shouldCapitalize, className, ...props }) {\n    const currentId = (0,_shared_mjs__WEBPACK_IMPORTED_MODULE_1__.useCurrentUserId)();\n    const { user, isLoading } = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__._useUser)(userId);\n    const $ = (0,_overrides_mjs__WEBPACK_IMPORTED_MODULE_3__.useOverrides)();\n    const resolvedUserName = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        const name = replaceSelf && currentId === userId ? $.USER_SELF : user?.name ?? $.USER_UNKNOWN;\n        return shouldCapitalize ? (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_4__.capitalize)(name) : name;\n    }, [\n        replaceSelf,\n        currentId,\n        userId,\n        $.USER_SELF,\n        $.USER_UNKNOWN,\n        user?.name,\n        shouldCapitalize\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        className: (0,_utils_class_names_mjs__WEBPACK_IMPORTED_MODULE_5__.classNames)(\"lb-name lb-user\", className),\n        \"data-loading\": isLoading ? \"\" : void 0,\n        ...props\n    }, isLoading ? null : resolvedUserName);\n}\n //# sourceMappingURL=User.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb21wb25lbnRzL2ludGVybmFsL1VzZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0Qk8sU0FBQUEsS0FBQSxFQUFjQyxNQUFBLEVBQ25CQyxXQUFBLEVBQ0FDLFlBQUFDLGdCQUFBLEVBQ1lDLFNBQUEsRUFDWixHQUFBQyxPQUVGO0lBQ0UsTUFBQUMsWUFBQUMsNkRBQUFBO0lBQ0EsUUFBQUMsSUFBQSxFQUFBQyxTQUFBLEtBQUFDLDJEQUFBQSxDQUFBVjtJQUNBLE1BQUFXLElBQUFDLDREQUFBQTtJQUNBLE1BQUFDLG1CQUFBQyw4Q0FBQUEsQ0FBQTtRQUNFLE1BQUFDLE9BQUFkLGVBQUFLLGNBQUFOLFNBQUFXLEVBQUFLLFNBQUEsR0FBQVIsTUFBQU8sUUFBQUosRUFBQU0sWUFBQTtRQUtBLE9BQUFkLG1CQUFBRCxpRUFBQUEsQ0FBQWEsUUFBQUE7SUFBNkM7UUFDNUNkO1FBQ0RLO1FBQ0FOO1FBQ0FXLEVBQUFLLFNBQUE7UUFDRUwsRUFBQU0sWUFBQTtRQUNBVCxNQUFBTztRQUNJWjtLQUNOO0lBR0YscUNBQUFlLGdEQUFBO1FBQ0dkLFdBQUFnQixrRUFBQUEsQ0FBQSxtQkFBQWhCO1FBQ21ELGdCQUFBSyxZQUFBO1FBQ25CLEdBQUFKLEtBQUE7SUFDM0IsR0FBQUksWUFBQSxPQUFBSTtBQUtWIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaW50ZXJuYWwvVXNlci50c3g/ZThiNSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcblxuaW1wb3J0IHsgdXNlVXNlciB9IGZyb20gXCJAbGl2ZWJsb2Nrcy9yZWFjdFwiO1xuaW1wb3J0IHR5cGUgeyBDb21wb25lbnRQcm9wcyB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IFJlYWN0LCB7IHVzZU1lbW8gfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgdXNlT3ZlcnJpZGVzIH0gZnJvbSBcIi4uLy4uL292ZXJyaWRlc1wiO1xuaW1wb3J0IHsgdXNlQ3VycmVudFVzZXJJZCB9IGZyb20gXCIuLi8uLi9zaGFyZWRcIjtcbmltcG9ydCB7IGNhcGl0YWxpemUgfSBmcm9tIFwiLi4vLi4vdXRpbHMvY2FwaXRhbGl6ZVwiO1xuaW1wb3J0IHsgY2xhc3NOYW1lcyB9IGZyb20gXCIuLi8uLi91dGlscy9jbGFzcy1uYW1lc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJQcm9wcyBleHRlbmRzIENvbXBvbmVudFByb3BzPFwic3BhblwiPiB7XG4gIC8qKlxuICAgKiBUaGUgdXNlciBJRCB0byBkaXNwbGF5IHRoZSB1c2VyIG5hbWUgZm9yLlxuICAgKi9cbiAgdXNlcklkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gcmVwbGFjZSB0aGUgdXNlciBuYW1lIHdpdGggXCJ5b3VcIiAoJC5VU0VSX1NFTEYpIGZvciB0aGUgY3VycmVudCB1c2VyLlxuICAgKi9cbiAgcmVwbGFjZVNlbGY/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGNhcGl0YWxpemUgdGhlIHVzZXIgbmFtZS5cbiAgICovXG4gIGNhcGl0YWxpemU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gVXNlcih7XG4gIHVzZXJJZCxcbiAgcmVwbGFjZVNlbGYsXG4gIGNhcGl0YWxpemU6IHNob3VsZENhcGl0YWxpemUsXG4gIGNsYXNzTmFtZSxcbiAgLi4ucHJvcHNcbn06IFVzZXJQcm9wcykge1xuICBjb25zdCBjdXJyZW50SWQgPSB1c2VDdXJyZW50VXNlcklkKCk7XG4gIGNvbnN0IHsgdXNlciwgaXNMb2FkaW5nIH0gPSB1c2VVc2VyKHVzZXJJZCk7XG4gIGNvbnN0ICQgPSB1c2VPdmVycmlkZXMoKTtcbiAgY29uc3QgcmVzb2x2ZWRVc2VyTmFtZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IG5hbWUgPVxuICAgICAgcmVwbGFjZVNlbGYgJiYgY3VycmVudElkID09PSB1c2VySWRcbiAgICAgICAgPyAkLlVTRVJfU0VMRlxuICAgICAgICA6IHVzZXI/Lm5hbWUgPz8gJC5VU0VSX1VOS05PV047XG5cbiAgICByZXR1cm4gc2hvdWxkQ2FwaXRhbGl6ZSA/IGNhcGl0YWxpemUobmFtZSkgOiBuYW1lO1xuICB9LCBbXG4gICAgcmVwbGFjZVNlbGYsXG4gICAgY3VycmVudElkLFxuICAgIHVzZXJJZCxcbiAgICAkLlVTRVJfU0VMRixcbiAgICAkLlVTRVJfVU5LTk9XTixcbiAgICB1c2VyPy5uYW1lLFxuICAgIHNob3VsZENhcGl0YWxpemUsXG4gIF0pO1xuXG4gIHJldHVybiAoXG4gICAgPHNwYW5cbiAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImxiLW5hbWUgbGItdXNlclwiLCBjbGFzc05hbWUpfVxuICAgICAgZGF0YS1sb2FkaW5nPXtpc0xvYWRpbmcgPyBcIlwiIDogdW5kZWZpbmVkfVxuICAgICAgey4uLnByb3BzfVxuICAgID5cbiAgICAgIHtpc0xvYWRpbmcgPyBudWxsIDogcmVzb2x2ZWRVc2VyTmFtZX1cbiAgICA8L3NwYW4+XG4gICk7XG59XG4iXSwibmFtZXMiOlsiVXNlciIsInVzZXJJZCIsInJlcGxhY2VTZWxmIiwiY2FwaXRhbGl6ZSIsInNob3VsZENhcGl0YWxpemUiLCJjbGFzc05hbWUiLCJwcm9wcyIsImN1cnJlbnRJZCIsInVzZUN1cnJlbnRVc2VySWQiLCJ1c2VyIiwiaXNMb2FkaW5nIiwidXNlVXNlciIsIiQiLCJ1c2VPdmVycmlkZXMiLCJyZXNvbHZlZFVzZXJOYW1lIiwidXNlTWVtbyIsIm5hbWUiLCJVU0VSX1NFTEYiLCJVU0VSX1VOS05PV04iLCJSZWFjdF9fZGVmYXVsdCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/User.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/config.mjs":
/*!***********************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/config.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LiveblocksUIConfig: () => (/* binding */ LiveblocksUIConfig),\n/* harmony export */   useLiveblocksUIConfig: () => (/* binding */ useLiveblocksUIConfig)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components.mjs\");\n/* harmony import */ var _overrides_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./overrides.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\");\n/* __next_internal_client_entry_do_not_use__ LiveblocksUIConfig,useLiveblocksUIConfig auto */ \n\n\nconst LiveblocksUIConfigContext = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)({});\nfunction useLiveblocksUIConfig() {\n    return (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(LiveblocksUIConfigContext);\n}\nfunction LiveblocksUIConfig({ overrides, components, portalContainer, children }) {\n    const liveblocksUIConfig = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            portalContainer\n        }), [\n        portalContainer\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(LiveblocksUIConfigContext.Provider, {\n        value: liveblocksUIConfig\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_overrides_mjs__WEBPACK_IMPORTED_MODULE_1__.OverridesProvider, {\n        overrides\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_mjs__WEBPACK_IMPORTED_MODULE_2__.ComponentsProvider, {\n        components\n    }, children)));\n}\n //# sourceMappingURL=config.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb25maWcubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBOEJBLE1BQUFBLDBDQUFBQyxvREFBQUEsQ0FBQTtBQUVPLFNBQUFDO0lBQ0wsT0FBQUMsaURBQUFBLENBQUFIO0FBQ0Y7QUFVTyxTQUFBSSxtQkFBQSxFQUE0QkMsU0FBQSxFQUNqQ0MsVUFBQSxFQUNBQyxlQUFBLEVBQ0FDLFFBQUEsRUFFRjtJQUNFLE1BQUFDLHFCQUFBQyw4Q0FBQUEsQ0FBMkI7WUFBQUg7UUFBQSxJQUNBO1FBQUFBO0tBQUE7SUFJM0IscUNBQUFJLGdEQUFBLENBQUFYLDBCQUFBYSxRQUFBO1FBQ0dDLE9BQUFMO0lBQTBDLGlDQUFBRSxnREFBQSxDQUFBSSw2REFBQUEsRUFBQTtRQUN4Q1Y7SUFBa0IsaUNBQUFNLGdEQUFBLENBQUFLLCtEQUFBQSxFQUFBO1FBQ2hCVjtJQUFtQixHQUFBRTtBQU01QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uL3NyYy9jb25maWcudHN4PzlmYzIiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB0eXBlIHsgUHJvcHNXaXRoQ2hpbGRyZW4gfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VNZW1vIH0gZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB7IHR5cGUgQ29tcG9uZW50cywgQ29tcG9uZW50c1Byb3ZpZGVyIH0gZnJvbSBcIi4vY29tcG9uZW50c1wiO1xuaW1wb3J0IHR5cGUgeyBPdmVycmlkZXMgfSBmcm9tIFwiLi9vdmVycmlkZXNcIjtcbmltcG9ydCB7IE92ZXJyaWRlc1Byb3ZpZGVyIH0gZnJvbSBcIi4vb3ZlcnJpZGVzXCI7XG5cbnR5cGUgTGl2ZWJsb2Nrc1VJQ29uZmlnUHJvcHMgPSBQcm9wc1dpdGhDaGlsZHJlbjx7XG4gIC8qKlxuICAgKiBPdmVycmlkZSB0aGUgY29tcG9uZW50cycgc3RyaW5ncy5cbiAgICovXG4gIG92ZXJyaWRlcz86IFBhcnRpYWw8T3ZlcnJpZGVzPjtcblxuICAvKipcbiAgICogT3ZlcnJpZGUgdGhlIGNvbXBvbmVudHMnIGNvbXBvbmVudHMuXG4gICAqL1xuICBjb21wb25lbnRzPzogUGFydGlhbDxDb21wb25lbnRzPjtcblxuICAvKipcbiAgICogVGhlIGNvbnRhaW5lciB0byByZW5kZXIgdGhlIHBvcnRhbCBpbnRvLlxuICAgKi9cbiAgcG9ydGFsQ29udGFpbmVyPzogSFRNTEVsZW1lbnQ7XG59PjtcblxuaW50ZXJmYWNlIExpdmVibG9ja3NVSUNvbmZpZ0NvbnRleHQge1xuICBwb3J0YWxDb250YWluZXI/OiBIVE1MRWxlbWVudDtcbn1cblxuY29uc3QgTGl2ZWJsb2Nrc1VJQ29uZmlnQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8TGl2ZWJsb2Nrc1VJQ29uZmlnQ29udGV4dD4oe30pO1xuXG5leHBvcnQgZnVuY3Rpb24gdXNlTGl2ZWJsb2Nrc1VJQ29uZmlnKCkge1xuICByZXR1cm4gdXNlQ29udGV4dChMaXZlYmxvY2tzVUlDb25maWdDb250ZXh0KTtcbn1cblxuLyoqXG4gKiBTZXQgY29uZmlndXJhdGlvbiBvcHRpb25zIGZvciBhbGwgY29tcG9uZW50cy5cbiAqXG4gKiBAZXhhbXBsZVxuICogPExpdmVibG9ja3NVSUNvbmZpZyBvdmVycmlkZXM9e3sgbG9jYWxlOiBcImZyXCIsIFVTRVJfVU5LTk9XTjogXCJBbm9ueW1lXCIsIC4uLiB9fT5cbiAqICAgPEFwcCAvPlxuICogPC9MaXZlYmxvY2tzVUlDb25maWc+XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBMaXZlYmxvY2tzVUlDb25maWcoe1xuICBvdmVycmlkZXMsXG4gIGNvbXBvbmVudHMsXG4gIHBvcnRhbENvbnRhaW5lcixcbiAgY2hpbGRyZW4sXG59OiBMaXZlYmxvY2tzVUlDb25maWdQcm9wcykge1xuICBjb25zdCBsaXZlYmxvY2tzVUlDb25maWcgPSB1c2VNZW1vKFxuICAgICgpID0+ICh7IHBvcnRhbENvbnRhaW5lciB9KSxcbiAgICBbcG9ydGFsQ29udGFpbmVyXVxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPExpdmVibG9ja3NVSUNvbmZpZ0NvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2xpdmVibG9ja3NVSUNvbmZpZ30+XG4gICAgICA8T3ZlcnJpZGVzUHJvdmlkZXIgb3ZlcnJpZGVzPXtvdmVycmlkZXN9PlxuICAgICAgICA8Q29tcG9uZW50c1Byb3ZpZGVyIGNvbXBvbmVudHM9e2NvbXBvbmVudHN9PlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9Db21wb25lbnRzUHJvdmlkZXI+XG4gICAgICA8L092ZXJyaWRlc1Byb3ZpZGVyPlxuICAgIDwvTGl2ZWJsb2Nrc1VJQ29uZmlnQ29udGV4dC5Qcm92aWRlcj5cbiAgKTtcbn1cbiJdLCJuYW1lcyI6WyJMaXZlYmxvY2tzVUlDb25maWdDb250ZXh0IiwiY3JlYXRlQ29udGV4dCIsInVzZUxpdmVibG9ja3NVSUNvbmZpZyIsInVzZUNvbnRleHQiLCJMaXZlYmxvY2tzVUlDb25maWciLCJvdmVycmlkZXMiLCJjb21wb25lbnRzIiwicG9ydGFsQ29udGFpbmVyIiwiY2hpbGRyZW4iLCJsaXZlYmxvY2tzVUlDb25maWciLCJ1c2VNZW1vIiwiUmVhY3RfX2RlZmF1bHQiLCJjcmVhdGVFbGVtZW50IiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIk92ZXJyaWRlc1Byb3ZpZGVyIiwiQ29tcG9uZW50c1Byb3ZpZGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/config.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs":
/*!**************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/constants.mjs ***!
  \**************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EMOJI_FONT_FAMILY: () => (/* binding */ EMOJI_FONT_FAMILY),\n/* harmony export */   FLOATING_ELEMENT_COLLISION_PADDING: () => (/* binding */ FLOATING_ELEMENT_COLLISION_PADDING),\n/* harmony export */   FLOATING_ELEMENT_SIDE_OFFSET: () => (/* binding */ FLOATING_ELEMENT_SIDE_OFFSET)\n/* harmony export */ });\nconst FLOATING_ELEMENT_SIDE_OFFSET = 6;\nconst FLOATING_ELEMENT_COLLISION_PADDING = 10;\nconst EMOJI_FONT_FAMILY = \"'Apple Color Emoji', 'Noto Color Emoji', 'Twemoji Mozilla', 'Android Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', EmojiSymbols, sans-serif\";\n\n\n//# sourceMappingURL=constants.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9jb25zdGFudHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTs7QUFFK0Y7QUFDL0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2NvbnN0YW50cy5tanM/NzllZSJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBGTE9BVElOR19FTEVNRU5UX1NJREVfT0ZGU0VUID0gNjtcbmNvbnN0IEZMT0FUSU5HX0VMRU1FTlRfQ09MTElTSU9OX1BBRERJTkcgPSAxMDtcbmNvbnN0IEVNT0pJX0ZPTlRfRkFNSUxZID0gXCInQXBwbGUgQ29sb3IgRW1vamknLCAnTm90byBDb2xvciBFbW9qaScsICdUd2Vtb2ppIE1vemlsbGEnLCAnQW5kcm9pZCBFbW9qaScsICdTZWdvZSBVSSBFbW9qaScsICdTZWdvZSBVSSBTeW1ib2wnLCBFbW9qaVN5bWJvbHMsIHNhbnMtc2VyaWZcIjtcblxuZXhwb3J0IHsgRU1PSklfRk9OVF9GQU1JTFksIEZMT0FUSU5HX0VMRU1FTlRfQ09MTElTSU9OX1BBRERJTkcsIEZMT0FUSU5HX0VMRU1FTlRfU0lERV9PRkZTRVQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbnN0YW50cy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/ArrowDown.mjs":
/*!********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/ArrowDown.mjs ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ArrowDownIcon: () => (/* binding */ ArrowDownIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction ArrowDownIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M10 4v12m6-6-6 6-6-6\"\n  }));\n}\n\n\n//# sourceMappingURL=ArrowDown.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9BcnJvd0Rvd24ubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtQztBQUNvQjs7QUFFdkQ7QUFDQSx5QkFBeUIsZ0RBQTRCLENBQUMsK0RBQUk7QUFDMUQ7QUFDQSxHQUFHLGtCQUFrQixnREFBNEI7QUFDakQ7QUFDQSxHQUFHO0FBQ0g7O0FBRXlCO0FBQ3pCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9BcnJvd0Rvd24ubWpzPzdiYjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gQXJyb3dEb3duSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNMTAgNHYxMm02LTYtNiA2LTYtNlwiXG4gIH0pKTtcbn1cblxuZXhwb3J0IHsgQXJyb3dEb3duSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QXJyb3dEb3duLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/ArrowDown.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Check.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Check.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CheckIcon: () => (/* binding */ CheckIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction CheckIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M16 6L8 14L4 10\"\n  }));\n}\n\n\n//# sourceMappingURL=Check.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9DaGVjay5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW1DO0FBQ29COztBQUV2RDtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywrREFBSTtBQUMxRDtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QjtBQUNqRDtBQUNBLEdBQUc7QUFDSDs7QUFFcUI7QUFDckIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2ljb25zL0NoZWNrLm1qcz8yMWI3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdF9fZGVmYXVsdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJY29uIH0gZnJvbSAnLi4vY29tcG9uZW50cy9pbnRlcm5hbC9JY29uLm1qcyc7XG5cbmZ1bmN0aW9uIENoZWNrSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNMTYgNkw4IDE0TDQgMTBcIlxuICB9KSk7XG59XG5cbmV4cG9ydCB7IENoZWNrSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hlY2subWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Check.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Cross.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Cross.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CrossIcon: () => (/* binding */ CrossIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction CrossIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M15 5L5 15\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M5 5L15 15\"\n  }));\n}\n\n\n//# sourceMappingURL=Cross.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9Dcm9zcy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW1DO0FBQ29COztBQUV2RDtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywrREFBSTtBQUMxRDtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QjtBQUNqRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUc7QUFDSDs7QUFFcUI7QUFDckIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2ljb25zL0Nyb3NzLm1qcz8xNWM5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdF9fZGVmYXVsdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJY29uIH0gZnJvbSAnLi4vY29tcG9uZW50cy9pbnRlcm5hbC9JY29uLm1qcyc7XG5cbmZ1bmN0aW9uIENyb3NzSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNMTUgNUw1IDE1XCJcbiAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNNSA1TDE1IDE1XCJcbiAgfSkpO1xufVxuXG5leHBvcnQgeyBDcm9zc0ljb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNyb3NzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Cross.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Delete.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Delete.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DeleteIcon: () => (/* binding */ DeleteIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction DeleteIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M4.5 6.5h11M14 6.5V14a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 6 14V6.5M7.5 6.5V5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v1.5\"\n  }));\n}\n\n\n//# sourceMappingURL=Delete.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9EZWxldGUubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtQztBQUNvQjs7QUFFdkQ7QUFDQSx5QkFBeUIsZ0RBQTRCLENBQUMsK0RBQUk7QUFDMUQ7QUFDQSxHQUFHLGtCQUFrQixnREFBNEI7QUFDakQ7QUFDQSxHQUFHO0FBQ0g7O0FBRXNCO0FBQ3RCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9EZWxldGUubWpzP2M4ZDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gRGVsZXRlSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNNC41IDYuNWgxMU0xNCA2LjVWMTRhMS41IDEuNSAwIDAgMS0xLjUgMS41aC01QTEuNSAxLjUgMCAwIDEgNiAxNFY2LjVNNy41IDYuNVY1YTEgMSAwIDAgMSAxLTFoM2ExIDEgMCAwIDEgMSAxdjEuNVwiXG4gIH0pKTtcbn1cblxuZXhwb3J0IHsgRGVsZXRlSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGVsZXRlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Delete.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Edit.mjs":
/*!***************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Edit.mjs ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EditIcon: () => (/* binding */ EditIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction EditIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"m11.784 5.797-6.13 6.138a4 4 0 0 0-1.03 1.775L4 16l2.285-.624a4 4 0 0 0 1.776-1.032l6.145-6.152m-2.422-2.395 1.244-1.246c.608-.608 1.826-.81 2.53-.104.7.7.499 1.893-.122 2.515l-1.23 1.23m-2.422-2.395 2.422 2.395\"\n  }));\n}\n\n\n//# sourceMappingURL=Edit.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9FZGl0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDb0I7O0FBRXZEO0FBQ0EseUJBQXlCLGdEQUE0QixDQUFDLCtEQUFJO0FBQzFEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0EsR0FBRztBQUNIOztBQUVvQjtBQUNwQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvRWRpdC5tanM/YWVkYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3RfX2RlZmF1bHQgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL2NvbXBvbmVudHMvaW50ZXJuYWwvSWNvbi5tanMnO1xuXG5mdW5jdGlvbiBFZGl0SWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJtMTEuNzg0IDUuNzk3LTYuMTMgNi4xMzhhNCA0IDAgMCAwLTEuMDMgMS43NzVMNCAxNmwyLjI4NS0uNjI0YTQgNCAwIDAgMCAxLjc3Ni0xLjAzMmw2LjE0NS02LjE1Mm0tMi40MjItMi4zOTUgMS4yNDQtMS4yNDZjLjYwOC0uNjA4IDEuODI2LS44MSAyLjUzLS4xMDQuNy43LjQ5OSAxLjg5My0uMTIyIDIuNTE1bC0xLjIzIDEuMjNtLTIuNDIyLTIuMzk1IDIuNDIyIDIuMzk1XCJcbiAgfSkpO1xufVxuXG5leHBvcnQgeyBFZGl0SWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RWRpdC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Edit.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Ellipsis.mjs":
/*!*******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Ellipsis.mjs ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EllipsisIcon: () => (/* binding */ EllipsisIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction EllipsisIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    fill: \"currentColor\",\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 5,\n    cy: 10,\n    r: 0.75\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 10,\n    cy: 10,\n    r: 0.75\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 15,\n    cy: 10,\n    r: 0.75\n  }));\n}\n\n\n//# sourceMappingURL=Ellipsis.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9FbGxpcHNpcy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW1DO0FBQ29COztBQUV2RDtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywrREFBSTtBQUMxRDtBQUNBO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQSxHQUFHLG1CQUFtQixnREFBNEI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUV3QjtBQUN4QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvRWxsaXBzaXMubWpzPzYwMTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gRWxsaXBzaXNJY29uKHByb3BzKSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChJY29uLCB7XG4gICAgZmlsbDogXCJjdXJyZW50Q29sb3JcIixcbiAgICAuLi5wcm9wc1xuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImNpcmNsZVwiLCB7XG4gICAgY3g6IDUsXG4gICAgY3k6IDEwLFxuICAgIHI6IDAuNzVcbiAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiY2lyY2xlXCIsIHtcbiAgICBjeDogMTAsXG4gICAgY3k6IDEwLFxuICAgIHI6IDAuNzVcbiAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiY2lyY2xlXCIsIHtcbiAgICBjeDogMTUsXG4gICAgY3k6IDEwLFxuICAgIHI6IDAuNzVcbiAgfSkpO1xufVxuXG5leHBvcnQgeyBFbGxpcHNpc0ljb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVsbGlwc2lzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Ellipsis.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Emoji.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Emoji.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EmojiIcon: () => (/* binding */ EmojiIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction EmojiIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14Z\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M7.5 11.5S8.25 13 10 13s2.5-1.5 2.5-1.5M8 8h.007\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M12 8h.007\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 8,\n    cy: 8,\n    r: 0.25\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 12,\n    cy: 8,\n    r: 0.25\n  }));\n}\n\n\n//# sourceMappingURL=Emoji.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9FbW9qaS5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW1DO0FBQ29COztBQUV2RDtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywrREFBSTtBQUMxRDtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QjtBQUNqRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQSxHQUFHLG1CQUFtQixnREFBNEI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVxQjtBQUNyQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvRW1vamkubWpzPzVlOTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gRW1vamlJY29uKHByb3BzKSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChJY29uLCB7XG4gICAgLi4ucHJvcHNcbiAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJwYXRoXCIsIHtcbiAgICBkOiBcIk0xMCAxN2E3IDcgMCAxIDAgMC0xNCA3IDcgMCAwIDAgMCAxNFpcIlxuICB9KSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJwYXRoXCIsIHtcbiAgICBkOiBcIk03LjUgMTEuNVM4LjI1IDEzIDEwIDEzczIuNS0xLjUgMi41LTEuNU04IDhoLjAwN1wiXG4gIH0pLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBhdGhcIiwge1xuICAgIGQ6IFwiTTEyIDhoLjAwN1wiXG4gIH0pLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImNpcmNsZVwiLCB7XG4gICAgY3g6IDgsXG4gICAgY3k6IDgsXG4gICAgcjogMC4yNVxuICB9KSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJjaXJjbGVcIiwge1xuICAgIGN4OiAxMixcbiAgICBjeTogOCxcbiAgICByOiAwLjI1XG4gIH0pKTtcbn1cblxuZXhwb3J0IHsgRW1vamlJY29uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1FbW9qaS5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Emoji.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/EmojiAdd.mjs":
/*!*******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/EmojiAdd.mjs ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EmojiAddIcon: () => (/* binding */ EmojiAddIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction EmojiAddIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M11 3.07A7 7 0 1 0 16.93 9\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M7.5 11.5S8.25 13 10 13s2.5-1.5 2.5-1.5M8 8h0\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M12 8h0\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M13 5h4m-2-2v4\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: \"8\",\n    cy: \"8\",\n    r: \".25\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: \"12\",\n    cy: \"8\",\n    r: \".25\"\n  }));\n}\n\n\n//# sourceMappingURL=EmojiAdd.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9FbW9qaUFkZC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW1DO0FBQ29COztBQUV2RDtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywrREFBSTtBQUMxRDtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QjtBQUNqRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQSxHQUFHLG1CQUFtQixnREFBNEI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUV3QjtBQUN4QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvRW1vamlBZGQubWpzP2I2NDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gRW1vamlBZGRJY29uKHByb3BzKSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChJY29uLCB7XG4gICAgLi4ucHJvcHNcbiAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJwYXRoXCIsIHtcbiAgICBkOiBcIk0xMSAzLjA3QTcgNyAwIDEgMCAxNi45MyA5XCJcbiAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNNy41IDExLjVTOC4yNSAxMyAxMCAxM3MyLjUtMS41IDIuNS0xLjVNOCA4aDBcIlxuICB9KSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJwYXRoXCIsIHtcbiAgICBkOiBcIk0xMiA4aDBcIlxuICB9KSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJwYXRoXCIsIHtcbiAgICBkOiBcIk0xMyA1aDRtLTItMnY0XCJcbiAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiY2lyY2xlXCIsIHtcbiAgICBjeDogXCI4XCIsXG4gICAgY3k6IFwiOFwiLFxuICAgIHI6IFwiLjI1XCJcbiAgfSksIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwiY2lyY2xlXCIsIHtcbiAgICBjeDogXCIxMlwiLFxuICAgIGN5OiBcIjhcIixcbiAgICByOiBcIi4yNVwiXG4gIH0pKTtcbn1cblxuZXhwb3J0IHsgRW1vamlBZGRJY29uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1FbW9qaUFkZC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/EmojiAdd.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Mention.mjs":
/*!******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Mention.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MentionIcon: () => (/* binding */ MentionIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction MentionIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M13 7v3.7c0 1.105.855 2.1 1.9 2.1a2.12 2.12 0 0 0 2.1-2.1V10a7 7 0 1 0-2.8 5.6\"\n  }));\n}\n\n\n//# sourceMappingURL=Mention.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9NZW50aW9uLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDb0I7O0FBRXZEO0FBQ0EseUJBQXlCLGdEQUE0QixDQUFDLCtEQUFJO0FBQzFEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0EsR0FBRyxtQkFBbUIsZ0RBQTRCO0FBQ2xEO0FBQ0EsR0FBRztBQUNIOztBQUV1QjtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvTWVudGlvbi5tanM/NzQ5ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3RfX2RlZmF1bHQgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL2NvbXBvbmVudHMvaW50ZXJuYWwvSWNvbi5tanMnO1xuXG5mdW5jdGlvbiBNZW50aW9uSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNMTAgMTNhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2WlwiXG4gIH0pLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBhdGhcIiwge1xuICAgIGQ6IFwiTTEzIDd2My43YzAgMS4xMDUuODU1IDIuMSAxLjkgMi4xYTIuMTIgMi4xMiAwIDAgMCAyLjEtMi4xVjEwYTcgNyAwIDEgMC0yLjggNS42XCJcbiAgfSkpO1xufVxuXG5leHBvcnQgeyBNZW50aW9uSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9TWVudGlvbi5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Mention.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Missing.mjs":
/*!******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Missing.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MissingIcon: () => (/* binding */ MissingIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction MissingIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"m3.794 13.526 5.326-9.89a1 1 0 0 1 1.76 0l5.326 9.89a1 1 0 0 1-.88 1.474H4.674a1 1 0 0 1-.88-1.474ZM10 7.5v2m0 2.5h.007\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 10,\n    cy: 12,\n    r: 0.25\n  }));\n}\n\n\n//# sourceMappingURL=Missing.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9NaXNzaW5nLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDb0I7O0FBRXZEO0FBQ0EseUJBQXlCLGdEQUE0QixDQUFDLCtEQUFJO0FBQzFEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0EsR0FBRyxtQkFBbUIsZ0RBQTRCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFdUI7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2ljb25zL01pc3NpbmcubWpzPzk0MWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gTWlzc2luZ0ljb24ocHJvcHMpIHtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEljb24sIHtcbiAgICAuLi5wcm9wc1xuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBhdGhcIiwge1xuICAgIGQ6IFwibTMuNzk0IDEzLjUyNiA1LjMyNi05Ljg5YTEgMSAwIDAgMSAxLjc2IDBsNS4zMjYgOS44OWExIDEgMCAwIDEtLjg4IDEuNDc0SDQuNjc0YTEgMSAwIDAgMS0uODgtMS40NzRaTTEwIDcuNXYybTAgMi41aC4wMDdcIlxuICB9KSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJjaXJjbGVcIiwge1xuICAgIGN4OiAxMCxcbiAgICBjeTogMTIsXG4gICAgcjogMC4yNVxuICB9KSk7XG59XG5cbmV4cG9ydCB7IE1pc3NpbmdJY29uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1NaXNzaW5nLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Missing.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Resolve.mjs":
/*!******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Resolve.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ResolveIcon: () => (/* binding */ ResolveIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction ResolveIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 10,\n    cy: 10,\n    r: 7\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"m13 8-4 4-2-2\"\n  }));\n}\n\n\n//# sourceMappingURL=Resolve.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9SZXNvbHZlLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDb0I7O0FBRXZEO0FBQ0EseUJBQXlCLGdEQUE0QixDQUFDLCtEQUFJO0FBQzFEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBLEdBQUc7QUFDSDs7QUFFdUI7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L2ljb25zL1Jlc29sdmUubWpzPzJlMzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gUmVzb2x2ZUljb24ocHJvcHMpIHtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KEljb24sIHtcbiAgICAuLi5wcm9wc1xuICB9LCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImNpcmNsZVwiLCB7XG4gICAgY3g6IDEwLFxuICAgIGN5OiAxMCxcbiAgICByOiA3XG4gIH0pLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBhdGhcIiwge1xuICAgIGQ6IFwibTEzIDgtNCA0LTItMlwiXG4gIH0pKTtcbn1cblxuZXhwb3J0IHsgUmVzb2x2ZUljb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVJlc29sdmUubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Resolve.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Resolved.mjs":
/*!*******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Resolved.mjs ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ResolvedIcon: () => (/* binding */ ResolvedIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction ResolvedIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"circle\", {\n    cx: 10,\n    cy: 10,\n    r: 7,\n    fill: \"currentColor\"\n  }), /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"m13 8-4 4-2-2\",\n    stroke: \"var(--lb-icon-background)\"\n  }));\n}\n\n\n//# sourceMappingURL=Resolved.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9SZXNvbHZlZC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW1DO0FBQ29COztBQUV2RDtBQUNBLHlCQUF5QixnREFBNEIsQ0FBQywrREFBSTtBQUMxRDtBQUNBLEdBQUcsa0JBQWtCLGdEQUE0QjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsbUJBQW1CLGdEQUE0QjtBQUNsRDtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUV3QjtBQUN4QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvUmVzb2x2ZWQubWpzPzQ0ZTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gUmVzb2x2ZWRJY29uKHByb3BzKSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChJY29uLCB7XG4gICAgLi4ucHJvcHNcbiAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJjaXJjbGVcIiwge1xuICAgIGN4OiAxMCxcbiAgICBjeTogMTAsXG4gICAgcjogNyxcbiAgICBmaWxsOiBcImN1cnJlbnRDb2xvclwiXG4gIH0pLCAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInBhdGhcIiwge1xuICAgIGQ6IFwibTEzIDgtNCA0LTItMlwiLFxuICAgIHN0cm9rZTogXCJ2YXIoLS1sYi1pY29uLWJhY2tncm91bmQpXCJcbiAgfSkpO1xufVxuXG5leHBvcnQgeyBSZXNvbHZlZEljb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVJlc29sdmVkLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Resolved.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Search.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Search.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SearchIcon: () => (/* binding */ SearchIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction SearchIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M9 15A6 6 0 1 0 9 3a6 6 0 0 0 0 12Zm7.5 1.5-3.25-3.25\"\n  }));\n}\n\n\n//# sourceMappingURL=Search.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9TZWFyY2gubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtQztBQUNvQjs7QUFFdkQ7QUFDQSx5QkFBeUIsZ0RBQTRCLENBQUMsK0RBQUk7QUFDMUQ7QUFDQSxHQUFHLGtCQUFrQixnREFBNEI7QUFDakQ7QUFDQSxHQUFHO0FBQ0g7O0FBRXNCO0FBQ3RCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9TZWFyY2gubWpzP2ZlZGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0X19kZWZhdWx0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9jb21wb25lbnRzL2ludGVybmFsL0ljb24ubWpzJztcblxuZnVuY3Rpb24gU2VhcmNoSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNOSAxNUE2IDYgMCAxIDAgOSAzYTYgNiAwIDAgMCAwIDEyWm03LjUgMS41LTMuMjUtMy4yNVwiXG4gIH0pKTtcbn1cblxuZXhwb3J0IHsgU2VhcmNoSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VhcmNoLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Search.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Send.mjs":
/*!***************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Send.mjs ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SendIcon: () => (/* binding */ SendIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction SendIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"m5 16 12-6L5 4l2 6-2 6ZM7 10h10\"\n  }));\n}\n\n\n//# sourceMappingURL=Send.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9TZW5kLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDb0I7O0FBRXZEO0FBQ0EseUJBQXlCLGdEQUE0QixDQUFDLCtEQUFJO0FBQzFEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0EsR0FBRztBQUNIOztBQUVvQjtBQUNwQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvaWNvbnMvU2VuZC5tanM/MWViYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3RfX2RlZmF1bHQgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL2NvbXBvbmVudHMvaW50ZXJuYWwvSWNvbi5tanMnO1xuXG5mdW5jdGlvbiBTZW5kSWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJtNSAxNiAxMi02TDUgNGwyIDYtMiA2Wk03IDEwaDEwXCJcbiAgfSkpO1xufVxuXG5leHBvcnQgeyBTZW5kSWNvbiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VuZC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Send.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Spinner.mjs":
/*!******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/icons/Spinner.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SpinnerIcon: () => (/* binding */ SpinnerIcon)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/internal/Icon.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Icon.mjs\");\n\n\n\nfunction SpinnerIcon(props) {\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.Icon, {\n    ...props\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"path\", {\n    d: \"M3 10a7 7 0 0 1 7-7\"\n  }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"animateTransform\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    attributeName: \"transform\",\n    type: \"rotate\",\n    dur: \"0.75s\",\n    values: `0 ${_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.ICON_WIDTH / 2} ${_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.ICON_HEIGHT / 2};360 ${_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.ICON_WIDTH / 2} ${_components_internal_Icon_mjs__WEBPACK_IMPORTED_MODULE_1__.ICON_HEIGHT / 2}`,\n    repeatCount: \"indefinite\"\n  })));\n}\n\n\n//# sourceMappingURL=Spinner.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9TcGlubmVyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUM7QUFDNkM7O0FBRWhGO0FBQ0EseUJBQXlCLGdEQUE0QixDQUFDLCtEQUFJO0FBQzFEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0EsR0FBRyxrQkFBa0IsZ0RBQTRCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHFFQUFVLE1BQU0sRUFBRSxzRUFBVyxNQUFNLE1BQU0scUVBQVUsTUFBTSxFQUFFLHNFQUFXLEtBQUs7QUFDNUY7QUFDQSxHQUFHO0FBQ0g7O0FBRXVCO0FBQ3ZCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9pY29ucy9TcGlubmVyLm1qcz9mNzQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdF9fZGVmYXVsdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJY29uLCBJQ09OX1dJRFRILCBJQ09OX0hFSUdIVCB9IGZyb20gJy4uL2NvbXBvbmVudHMvaW50ZXJuYWwvSWNvbi5tanMnO1xuXG5mdW5jdGlvbiBTcGlubmVySWNvbihwcm9wcykge1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSWNvbiwge1xuICAgIC4uLnByb3BzXG4gIH0sIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7XG4gICAgZDogXCJNMyAxMGE3IDcgMCAwIDEgNy03XCJcbiAgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJhbmltYXRlVHJhbnNmb3JtXCIsIHtcbiAgICB4bWxuczogXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLFxuICAgIGF0dHJpYnV0ZU5hbWU6IFwidHJhbnNmb3JtXCIsXG4gICAgdHlwZTogXCJyb3RhdGVcIixcbiAgICBkdXI6IFwiMC43NXNcIixcbiAgICB2YWx1ZXM6IGAwICR7SUNPTl9XSURUSCAvIDJ9ICR7SUNPTl9IRUlHSFQgLyAyfTszNjAgJHtJQ09OX1dJRFRIIC8gMn0gJHtJQ09OX0hFSUdIVCAvIDJ9YCxcbiAgICByZXBlYXRDb3VudDogXCJpbmRlZmluaXRlXCJcbiAgfSkpKTtcbn1cblxuZXhwb3J0IHsgU3Bpbm5lckljb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNwaW5uZXIubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/icons/Spinner.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs":
/*!**************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/overrides.mjs ***!
  \**************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OverridesContext: () => (/* binding */ OverridesContext),\n/* harmony export */   OverridesProvider: () => (/* binding */ OverridesProvider),\n/* harmony export */   defaultOverrides: () => (/* binding */ defaultOverrides),\n/* harmony export */   useOverrides: () => (/* binding */ useOverrides)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _components_internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/internal/Emoji.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/components/internal/Emoji.mjs\");\n/* harmony import */ var _utils_pluralize_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils/pluralize.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/pluralize.mjs\");\n/* __next_internal_client_entry_do_not_use__ OverridesContext,OverridesProvider,defaultOverrides,useOverrides auto */ \n\n\n\nconst defaultOverrides = {\n    locale: \"en\",\n    dir: \"ltr\",\n    USER_SELF: \"you\",\n    USER_UNKNOWN: \"Anonymous\",\n    LIST_REMAINING: (count)=>`${count} more`,\n    LIST_REMAINING_USERS: (count)=>`${count} ${(0,_utils_pluralize_mjs__WEBPACK_IMPORTED_MODULE_1__.pluralize)(count, \"other\")}`,\n    LIST_REMAINING_COMMENTS: (count)=>`${count} more ${(0,_utils_pluralize_mjs__WEBPACK_IMPORTED_MODULE_1__.pluralize)(count, \"comment\")}`,\n    EMOJI_PICKER_SEARCH_PLACEHOLDER: \"Search\",\n    EMOJI_PICKER_EMPTY: \"No emoji found.\",\n    EMOJI_PICKER_ERROR: ()=>\"There was an error while getting the list of emoji.\",\n    COMPOSER_INSERT_MENTION: \"Mention someone\",\n    COMPOSER_INSERT_EMOJI: \"Add emoji\",\n    COMPOSER_PLACEHOLDER: \"Write a comment\",\n    COMPOSER_SEND: \"Send\",\n    COMMENT_EDITED: \"(edited)\",\n    COMMENT_DELETED: \"This comment has been deleted.\",\n    COMMENT_MORE: \"More\",\n    COMMENT_EDIT: \"Edit comment\",\n    COMMENT_EDIT_COMPOSER_PLACEHOLDER: \"Edit comment\",\n    COMMENT_EDIT_COMPOSER_CANCEL: \"Cancel\",\n    COMMENT_EDIT_COMPOSER_SAVE: \"Save\",\n    COMMENT_DELETE: \"Delete comment\",\n    COMMENT_ADD_REACTION: \"Add reaction\",\n    COMMENT_REACTION_LIST: (list, emoji)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, list, \" reacted with \", /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_2__.Emoji, {\n            emoji\n        })),\n    COMMENT_REACTION_DESCRIPTION: (emoji, count)=>`${count} ${(0,_utils_pluralize_mjs__WEBPACK_IMPORTED_MODULE_1__.pluralize)(count, \"reaction\")}, react with ${emoji}`,\n    THREAD_RESOLVE: \"Resolve thread\",\n    THREAD_UNRESOLVE: \"Re-open thread\",\n    THREAD_NEW_INDICATOR: \"New\",\n    THREAD_NEW_INDICATOR_DESCRIPTION: \"New comments\",\n    THREAD_COMPOSER_PLACEHOLDER: \"Reply to thread\",\n    THREAD_COMPOSER_SEND: \"Reply\",\n    INBOX_NOTIFICATION_MORE: \"More\",\n    INBOX_NOTIFICATION_MARK_AS_READ: \"Mark as read\",\n    INBOX_NOTIFICATION_DELETE: \"Delete notification\",\n    INBOX_NOTIFICATION_THREAD_COMMENTS_LIST: (list, room)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, list, \" commented\", room ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, \" in \", room) : /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, \" in a thread\")),\n    INBOX_NOTIFICATION_THREAD_MENTION: (user, room)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, user, \" mentioned you\", room ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, \" in \", room) : null),\n    INBOX_NOTIFICATION_TEXT_MENTION: (user, room)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, user, \" mentioned you\", room ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, \" in \", room) : null)\n};\nconst OverridesContext = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0);\nfunction useOverrides(overrides) {\n    const contextOverrides = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(OverridesContext);\n    return (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            ...defaultOverrides,\n            ...contextOverrides,\n            ...overrides\n        }), [\n        contextOverrides,\n        overrides\n    ]);\n}\nfunction OverridesProvider({ children, overrides: providerOverrides }) {\n    const contextOverrides = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(OverridesContext);\n    const overrides = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            ...defaultOverrides,\n            ...contextOverrides,\n            ...providerOverrides\n        }), [\n        contextOverrides,\n        providerOverrides\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(OverridesContext.Provider, {\n        value: overrides\n    }, children);\n}\n //# sourceMappingURL=overrides.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9vdmVycmlkZXMubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBMEZPLE1BQUFBLG1CQUFBO0lBQW9DQyxRQUFBO0lBQ2pDQyxLQUFBO0lBQ0hDLFdBQUE7SUFDTUMsY0FBQTtJQUNHQyxnQkFBQSxDQUFBQyxRQUFBLEdBQUFBLE1BQUE7SUFDZ0JDLHNCQUFBLENBQUFELFFBQUEsR0FBQUEsTUFBQSxHQUFBRSwrREFBQUEsQ0FBQUYsT0FBQTtJQUN1Q0cseUJBQUEsQ0FBQUgsUUFBQSxHQUFBQSxNQUFBLFFBQUFFLCtEQUFBQSxDQUFBRixPQUFBO0lBRXhCSSxpQ0FBQTtJQUNaQyxvQkFBQTtJQUNiQyxvQkFBQTtJQUVsQkMseUJBQUE7SUFDdUJDLHVCQUFBO0lBQ0ZDLHNCQUFBO0lBQ0RDLGVBQUE7SUFDUEMsZ0JBQUE7SUFDQ0MsaUJBQUE7SUFDQ0MsY0FBQTtJQUNIQyxjQUFBO0lBQ0FDLG1DQUFBO0lBQ3FCQyw4QkFBQTtJQUNMQyw0QkFBQTtJQUNGQyxnQkFBQTtJQUNaQyxzQkFBQTtJQUNNQyx1QkFBQSxDQUFBQyxNQUFBQyxRQUFBLDhCQUFBQyxnREFBQSxDQUFBQSwyQ0FBQSxRQUFBRixNQUFBLGdEQUFBRSxnREFBQSxDQUFBRyxpRUFBQUEsRUFBQTtZQUdHSjtRQUFNO0lBQzdCSyw4QkFBQSxDQUFBTCxPQUFBdEIsUUFBQSxHQUFBQSxNQUFBLEdBQUFFLCtEQUFBQSxDQUFBRixPQUFBLDJCQUFBc0IsTUFBQTtJQUd3RE0sZ0JBQUE7SUFDMUNDLGtCQUFBO0lBQ0VDLHNCQUFBO0lBQ0lDLGtDQUFBO0lBQ1lDLDZCQUFBO0lBQ0xDLHNCQUFBO0lBQ1BDLHlCQUFBO0lBQ0dDLGlDQUFBO0lBQ1FDLDJCQUFBO0lBQ05DLHlDQUFBLENBQUFoQixNQUFBaUIsT0FBQSw4QkFBQWYsZ0RBQUEsQ0FBQUEsMkNBQUEsUUFBQUYsTUFBQSxjQUFBaUIsT0FBQSw4QkFBQWYsZ0RBQUEsQ0FBQUEsMkNBQUEsZ0JBQUFlLFFBQUEsOEJBQUFmLGdEQUFBLENBQUFBLDJDQUFBO0lBUXpCZ0IsbUNBQUEsQ0FBQUMsTUFBQUYsT0FBQSw4QkFBQWYsZ0RBQUEsQ0FBQUEsMkNBQUEsUUFBQWlCLE1BQUEsa0JBQUFGLE9BQUEsOEJBQUFmLGdEQUFBLENBQUFBLDJDQUFBLGdCQUFBZSxRQUFBO0lBS0FHLGlDQUFBLENBQUFELE1BQUFGLE9BQUEsOEJBQUFmLGdEQUFBLENBQUFBLDJDQUFBLFFBQUFpQixNQUFBLGtCQUFBRixPQUFBLDhCQUFBZixnREFBQSxDQUFBQSwyQ0FBQSxnQkFBQWUsUUFBQTtBQU9KO0FBRWEsTUFBQUksaUNBQUFDLG9EQUFBQSxDQUFBO0FBRU4sU0FBQUMsYUFBQUMsU0FBQTtJQUNMLE1BQUFDLG1CQUFBQyxpREFBQUEsQ0FBQUw7SUFFQSxPQUFBTSw4Q0FBQUEsQ0FBTztZQUNFLEdBQUF0RCxnQkFBQTtZQUNGLEdBQUFvRCxnQkFBQTtZQUNBLEdBQUFELFNBQUE7UUFDQSxJQUNMO1FBQUFDO1FBQUFEO0tBQUE7QUFHSjtBQUVPLFNBQUFJLGtCQUFBLEVBQTJCQyxRQUFBLEVBQ2hDTCxXQUFBTSxpQkFBQSxFQUVGO0lBQ0UsTUFBQUwsbUJBQUFDLGlEQUFBQSxDQUFBTDtJQUNBLE1BQUFHLFlBQUFHLDhDQUFBQSxDQUFrQjtZQUNULEdBQUF0RCxnQkFBQTtZQUNGLEdBQUFvRCxnQkFBQTtZQUNBLEdBQUFLLGlCQUFBO1FBQ0EsSUFDTDtRQUFBTDtRQUFBSztLQUFBO0lBSUYscUNBQUE1QixnREFBQSxDQUFBbUIsaUJBQUFVLFFBQUE7UUFDR0MsT0FBQVI7SUFBaUMsR0FBQUs7QUFJdEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uLi9zcmMvb3ZlcnJpZGVzLnRzeD8xMzE2Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgdHlwZSB7IFByb3BzV2l0aENoaWxkcmVuLCBSZWFjdE5vZGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IGNyZWF0ZUNvbnRleHQsIHVzZUNvbnRleHQsIHVzZU1lbW8gfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgeyBFbW9qaSB9IGZyb20gXCIuL2NvbXBvbmVudHMvaW50ZXJuYWwvRW1vamlcIjtcbmltcG9ydCB0eXBlIHsgRGlyZWN0aW9uIH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IHBsdXJhbGl6ZSB9IGZyb20gXCIuL3V0aWxzL3BsdXJhbGl6ZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIExvY2FsaXphdGlvbk92ZXJyaWRlcyB7XG4gIGxvY2FsZTogc3RyaW5nO1xuICBkaXI6IERpcmVjdGlvbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHbG9iYWxPdmVycmlkZXMge1xuICBVU0VSX1NFTEY6IHN0cmluZztcbiAgVVNFUl9VTktOT1dOOiBzdHJpbmc7XG4gIExJU1RfUkVNQUlOSU5HOiAoY291bnQ6IG51bWJlcikgPT4gc3RyaW5nO1xuICBMSVNUX1JFTUFJTklOR19VU0VSUzogKGNvdW50OiBudW1iZXIpID0+IHN0cmluZztcbiAgTElTVF9SRU1BSU5JTkdfQ09NTUVOVFM6IChjb3VudDogbnVtYmVyKSA9PiBzdHJpbmc7XG4gIEVNT0pJX1BJQ0tFUl9TRUFSQ0hfUExBQ0VIT0xERVI6IHN0cmluZztcbiAgRU1PSklfUElDS0VSX0VNUFRZOiBSZWFjdE5vZGU7XG4gIEVNT0pJX1BJQ0tFUl9FUlJPUjogKGVycm9yOiBFcnJvcikgPT4gUmVhY3ROb2RlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1lbnRPdmVycmlkZXMge1xuICBDT01NRU5UX0VESVRFRDogUmVhY3ROb2RlO1xuICBDT01NRU5UX0RFTEVURUQ6IFJlYWN0Tm9kZTtcbiAgQ09NTUVOVF9NT1JFOiBzdHJpbmc7XG4gIENPTU1FTlRfRURJVDogc3RyaW5nO1xuICBDT01NRU5UX0VESVRfQ09NUE9TRVJfUExBQ0VIT0xERVI6IHN0cmluZztcbiAgQ09NTUVOVF9FRElUX0NPTVBPU0VSX0NBTkNFTDogc3RyaW5nO1xuICBDT01NRU5UX0VESVRfQ09NUE9TRVJfU0FWRTogc3RyaW5nO1xuICBDT01NRU5UX0RFTEVURTogc3RyaW5nO1xuICBDT01NRU5UX0FERF9SRUFDVElPTjogc3RyaW5nO1xuICBDT01NRU5UX1JFQUNUSU9OX0xJU1Q6IChcbiAgICBsaXN0OiBSZWFjdE5vZGUsXG4gICAgZW1vamk6IHN0cmluZyxcbiAgICBjb3VudDogbnVtYmVyXG4gICkgPT4gUmVhY3ROb2RlO1xuICBDT01NRU5UX1JFQUNUSU9OX0RFU0NSSVBUSU9OOiAoZW1vamk6IHN0cmluZywgY291bnQ6IG51bWJlcikgPT4gc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBvc2VyT3ZlcnJpZGVzIHtcbiAgQ09NUE9TRVJfSU5TRVJUX01FTlRJT046IHN0cmluZztcbiAgQ09NUE9TRVJfSU5TRVJUX0VNT0pJOiBzdHJpbmc7XG4gIENPTVBPU0VSX1BMQUNFSE9MREVSOiBzdHJpbmc7XG4gIENPTVBPU0VSX1NFTkQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUaHJlYWRPdmVycmlkZXMge1xuICBUSFJFQURfUkVTT0xWRTogc3RyaW5nO1xuICBUSFJFQURfVU5SRVNPTFZFOiBzdHJpbmc7XG4gIFRIUkVBRF9ORVdfSU5ESUNBVE9SOiBzdHJpbmc7XG4gIFRIUkVBRF9ORVdfSU5ESUNBVE9SX0RFU0NSSVBUSU9OOiBzdHJpbmc7XG4gIFRIUkVBRF9DT01QT1NFUl9QTEFDRUhPTERFUjogc3RyaW5nO1xuICBUSFJFQURfQ09NUE9TRVJfU0VORDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluYm94Tm90aWZpY2F0aW9uT3ZlcnJpZGVzIHtcbiAgSU5CT1hfTk9USUZJQ0FUSU9OX01PUkU6IHN0cmluZztcbiAgSU5CT1hfTk9USUZJQ0FUSU9OX01BUktfQVNfUkVBRDogc3RyaW5nO1xuICBJTkJPWF9OT1RJRklDQVRJT05fREVMRVRFOiBzdHJpbmc7XG4gIElOQk9YX05PVElGSUNBVElPTl9USFJFQURfQ09NTUVOVFNfTElTVDogKFxuICAgIGxpc3Q6IFJlYWN0Tm9kZSxcbiAgICByb29tOiBSZWFjdE5vZGUgfCB1bmRlZmluZWQsXG4gICAgY291bnQ6IG51bWJlclxuICApID0+IFJlYWN0Tm9kZTtcbiAgSU5CT1hfTk9USUZJQ0FUSU9OX1RIUkVBRF9NRU5USU9OOiAoXG4gICAgdXNlcjogUmVhY3ROb2RlLFxuICAgIHJvb206IFJlYWN0Tm9kZSB8IHVuZGVmaW5lZFxuICApID0+IFJlYWN0Tm9kZTtcbiAgSU5CT1hfTk9USUZJQ0FUSU9OX1RFWFRfTUVOVElPTjogKFxuICAgIHVzZXI6IFJlYWN0Tm9kZSxcbiAgICByb29tOiBSZWFjdE5vZGUgfCB1bmRlZmluZWRcbiAgKSA9PiBSZWFjdE5vZGU7XG59XG5cbmV4cG9ydCB0eXBlIE92ZXJyaWRlcyA9IExvY2FsaXphdGlvbk92ZXJyaWRlcyAmXG4gIEdsb2JhbE92ZXJyaWRlcyAmXG4gIENvbXBvc2VyT3ZlcnJpZGVzICZcbiAgQ29tbWVudE92ZXJyaWRlcyAmXG4gIFRocmVhZE92ZXJyaWRlcyAmXG4gIEluYm94Tm90aWZpY2F0aW9uT3ZlcnJpZGVzO1xuXG50eXBlIE92ZXJyaWRlc1Byb3ZpZGVyUHJvcHMgPSBQcm9wc1dpdGhDaGlsZHJlbjx7XG4gIG92ZXJyaWRlcz86IFBhcnRpYWw8T3ZlcnJpZGVzPjtcbn0+O1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdE92ZXJyaWRlczogT3ZlcnJpZGVzID0ge1xuICBsb2NhbGU6IFwiZW5cIixcbiAgZGlyOiBcImx0clwiLFxuICBVU0VSX1NFTEY6IFwieW91XCIsXG4gIFVTRVJfVU5LTk9XTjogXCJBbm9ueW1vdXNcIixcbiAgTElTVF9SRU1BSU5JTkc6IChjb3VudCkgPT4gYCR7Y291bnR9IG1vcmVgLFxuICBMSVNUX1JFTUFJTklOR19VU0VSUzogKGNvdW50KSA9PiBgJHtjb3VudH0gJHtwbHVyYWxpemUoY291bnQsIFwib3RoZXJcIil9YCxcbiAgTElTVF9SRU1BSU5JTkdfQ09NTUVOVFM6IChjb3VudCkgPT5cbiAgICBgJHtjb3VudH0gbW9yZSAke3BsdXJhbGl6ZShjb3VudCwgXCJjb21tZW50XCIpfWAsXG4gIEVNT0pJX1BJQ0tFUl9TRUFSQ0hfUExBQ0VIT0xERVI6IFwiU2VhcmNo4oCmXCIsXG4gIEVNT0pJX1BJQ0tFUl9FTVBUWTogXCJObyBlbW9qaSBmb3VuZC5cIixcbiAgRU1PSklfUElDS0VSX0VSUk9SOiAoKSA9PlxuICAgIFwiVGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhlIGxpc3Qgb2YgZW1vamkuXCIsXG4gIENPTVBPU0VSX0lOU0VSVF9NRU5USU9OOiBcIk1lbnRpb24gc29tZW9uZVwiLFxuICBDT01QT1NFUl9JTlNFUlRfRU1PSkk6IFwiQWRkIGVtb2ppXCIsXG4gIENPTVBPU0VSX1BMQUNFSE9MREVSOiBcIldyaXRlIGEgY29tbWVudOKAplwiLFxuICBDT01QT1NFUl9TRU5EOiBcIlNlbmRcIixcbiAgQ09NTUVOVF9FRElURUQ6IFwiKGVkaXRlZClcIixcbiAgQ09NTUVOVF9ERUxFVEVEOiBcIlRoaXMgY29tbWVudCBoYXMgYmVlbiBkZWxldGVkLlwiLFxuICBDT01NRU5UX01PUkU6IFwiTW9yZVwiLFxuICBDT01NRU5UX0VESVQ6IFwiRWRpdCBjb21tZW50XCIsXG4gIENPTU1FTlRfRURJVF9DT01QT1NFUl9QTEFDRUhPTERFUjogXCJFZGl0IGNvbW1lbnTigKZcIixcbiAgQ09NTUVOVF9FRElUX0NPTVBPU0VSX0NBTkNFTDogXCJDYW5jZWxcIixcbiAgQ09NTUVOVF9FRElUX0NPTVBPU0VSX1NBVkU6IFwiU2F2ZVwiLFxuICBDT01NRU5UX0RFTEVURTogXCJEZWxldGUgY29tbWVudFwiLFxuICBDT01NRU5UX0FERF9SRUFDVElPTjogXCJBZGQgcmVhY3Rpb25cIixcbiAgQ09NTUVOVF9SRUFDVElPTl9MSVNUOiAobGlzdCwgZW1vamkpID0+IChcbiAgICA8PlxuICAgICAge2xpc3R9IHJlYWN0ZWQgd2l0aCA8RW1vamkgZW1vamk9e2Vtb2ppfSAvPlxuICAgIDwvPlxuICApLFxuICBDT01NRU5UX1JFQUNUSU9OX0RFU0NSSVBUSU9OOiAoZW1vamksIGNvdW50KSA9PlxuICAgIGAke2NvdW50fSAke3BsdXJhbGl6ZShjb3VudCwgXCJyZWFjdGlvblwiKX0sIHJlYWN0IHdpdGggJHtlbW9qaX1gLFxuICBUSFJFQURfUkVTT0xWRTogXCJSZXNvbHZlIHRocmVhZFwiLFxuICBUSFJFQURfVU5SRVNPTFZFOiBcIlJlLW9wZW4gdGhyZWFkXCIsXG4gIFRIUkVBRF9ORVdfSU5ESUNBVE9SOiBcIk5ld1wiLFxuICBUSFJFQURfTkVXX0lORElDQVRPUl9ERVNDUklQVElPTjogXCJOZXcgY29tbWVudHNcIixcbiAgVEhSRUFEX0NPTVBPU0VSX1BMQUNFSE9MREVSOiBcIlJlcGx5IHRvIHRocmVhZOKAplwiLFxuICBUSFJFQURfQ09NUE9TRVJfU0VORDogXCJSZXBseVwiLFxuICBJTkJPWF9OT1RJRklDQVRJT05fTU9SRTogXCJNb3JlXCIsXG4gIElOQk9YX05PVElGSUNBVElPTl9NQVJLX0FTX1JFQUQ6IFwiTWFyayBhcyByZWFkXCIsXG4gIElOQk9YX05PVElGSUNBVElPTl9ERUxFVEU6IFwiRGVsZXRlIG5vdGlmaWNhdGlvblwiLFxuICBJTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX0NPTU1FTlRTX0xJU1Q6IChcbiAgICBsaXN0OiBSZWFjdE5vZGUsXG4gICAgcm9vbTogUmVhY3ROb2RlXG4gICkgPT4gKFxuICAgIDw+XG4gICAgICB7bGlzdH0gY29tbWVudGVkXG4gICAgICB7cm9vbSA/IDw+IGluIHtyb29tfTwvPiA6IDw+IGluIGEgdGhyZWFkPC8+fVxuICAgIDwvPlxuICApLFxuICBJTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX01FTlRJT046ICh1c2VyOiBSZWFjdE5vZGUsIHJvb206IFJlYWN0Tm9kZSkgPT4gKFxuICAgIDw+XG4gICAgICB7dXNlcn0gbWVudGlvbmVkIHlvdXtyb29tID8gPD4gaW4ge3Jvb219PC8+IDogbnVsbH1cbiAgICA8Lz5cbiAgKSxcbiAgSU5CT1hfTk9USUZJQ0FUSU9OX1RFWFRfTUVOVElPTjogKHVzZXI6IFJlYWN0Tm9kZSwgcm9vbTogUmVhY3ROb2RlKSA9PiAoXG4gICAgPD5cbiAgICAgIHt1c2VyfSBtZW50aW9uZWQgeW91e3Jvb20gPyA8PiBpbiB7cm9vbX08Lz4gOiBudWxsfVxuICAgIDwvPlxuICApLFxufTtcblxuZXhwb3J0IGNvbnN0IE92ZXJyaWRlc0NvbnRleHQgPSBjcmVhdGVDb250ZXh0PE92ZXJyaWRlcyB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHVzZU92ZXJyaWRlcyhvdmVycmlkZXM/OiBQYXJ0aWFsPE92ZXJyaWRlcz4pOiBPdmVycmlkZXMge1xuICBjb25zdCBjb250ZXh0T3ZlcnJpZGVzID0gdXNlQ29udGV4dChPdmVycmlkZXNDb250ZXh0KTtcblxuICByZXR1cm4gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgLi4uZGVmYXVsdE92ZXJyaWRlcyxcbiAgICAgIC4uLmNvbnRleHRPdmVycmlkZXMsXG4gICAgICAuLi5vdmVycmlkZXMsXG4gICAgfSksXG4gICAgW2NvbnRleHRPdmVycmlkZXMsIG92ZXJyaWRlc11cbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIE92ZXJyaWRlc1Byb3ZpZGVyKHtcbiAgY2hpbGRyZW4sXG4gIG92ZXJyaWRlczogcHJvdmlkZXJPdmVycmlkZXMsXG59OiBPdmVycmlkZXNQcm92aWRlclByb3BzKSB7XG4gIGNvbnN0IGNvbnRleHRPdmVycmlkZXMgPSB1c2VDb250ZXh0KE92ZXJyaWRlc0NvbnRleHQpO1xuICBjb25zdCBvdmVycmlkZXMgPSB1c2VNZW1vKFxuICAgICgpID0+ICh7XG4gICAgICAuLi5kZWZhdWx0T3ZlcnJpZGVzLFxuICAgICAgLi4uY29udGV4dE92ZXJyaWRlcyxcbiAgICAgIC4uLnByb3ZpZGVyT3ZlcnJpZGVzLFxuICAgIH0pLFxuICAgIFtjb250ZXh0T3ZlcnJpZGVzLCBwcm92aWRlck92ZXJyaWRlc11cbiAgKTtcblxuICByZXR1cm4gKFxuICAgIDxPdmVycmlkZXNDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXtvdmVycmlkZXN9PlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvT3ZlcnJpZGVzQ29udGV4dC5Qcm92aWRlcj5cbiAgKTtcbn1cbiJdLCJuYW1lcyI6WyJkZWZhdWx0T3ZlcnJpZGVzIiwibG9jYWxlIiwiZGlyIiwiVVNFUl9TRUxGIiwiVVNFUl9VTktOT1dOIiwiTElTVF9SRU1BSU5JTkciLCJjb3VudCIsIkxJU1RfUkVNQUlOSU5HX1VTRVJTIiwicGx1cmFsaXplIiwiTElTVF9SRU1BSU5JTkdfQ09NTUVOVFMiLCJFTU9KSV9QSUNLRVJfU0VBUkNIX1BMQUNFSE9MREVSIiwiRU1PSklfUElDS0VSX0VNUFRZIiwiRU1PSklfUElDS0VSX0VSUk9SIiwiQ09NUE9TRVJfSU5TRVJUX01FTlRJT04iLCJDT01QT1NFUl9JTlNFUlRfRU1PSkkiLCJDT01QT1NFUl9QTEFDRUhPTERFUiIsIkNPTVBPU0VSX1NFTkQiLCJDT01NRU5UX0VESVRFRCIsIkNPTU1FTlRfREVMRVRFRCIsIkNPTU1FTlRfTU9SRSIsIkNPTU1FTlRfRURJVCIsIkNPTU1FTlRfRURJVF9DT01QT1NFUl9QTEFDRUhPTERFUiIsIkNPTU1FTlRfRURJVF9DT01QT1NFUl9DQU5DRUwiLCJDT01NRU5UX0VESVRfQ09NUE9TRVJfU0FWRSIsIkNPTU1FTlRfREVMRVRFIiwiQ09NTUVOVF9BRERfUkVBQ1RJT04iLCJDT01NRU5UX1JFQUNUSU9OX0xJU1QiLCJsaXN0IiwiZW1vamkiLCJSZWFjdCIsImNyZWF0ZUVsZW1lbnQiLCJGcmFnbWVudCIsIkVtb2ppIiwiQ09NTUVOVF9SRUFDVElPTl9ERVNDUklQVElPTiIsIlRIUkVBRF9SRVNPTFZFIiwiVEhSRUFEX1VOUkVTT0xWRSIsIlRIUkVBRF9ORVdfSU5ESUNBVE9SIiwiVEhSRUFEX05FV19JTkRJQ0FUT1JfREVTQ1JJUFRJT04iLCJUSFJFQURfQ09NUE9TRVJfUExBQ0VIT0xERVIiLCJUSFJFQURfQ09NUE9TRVJfU0VORCIsIklOQk9YX05PVElGSUNBVElPTl9NT1JFIiwiSU5CT1hfTk9USUZJQ0FUSU9OX01BUktfQVNfUkVBRCIsIklOQk9YX05PVElGSUNBVElPTl9ERUxFVEUiLCJJTkJPWF9OT1RJRklDQVRJT05fVEhSRUFEX0NPTU1FTlRTX0xJU1QiLCJyb29tIiwiSU5CT1hfTk9USUZJQ0FUSU9OX1RIUkVBRF9NRU5USU9OIiwidXNlciIsIklOQk9YX05PVElGSUNBVElPTl9URVhUX01FTlRJT04iLCJPdmVycmlkZXNDb250ZXh0IiwiY3JlYXRlQ29udGV4dCIsInVzZU92ZXJyaWRlcyIsIm92ZXJyaWRlcyIsImNvbnRleHRPdmVycmlkZXMiLCJ1c2VDb250ZXh0IiwidXNlTWVtbyIsIk92ZXJyaWRlc1Byb3ZpZGVyIiwiY2hpbGRyZW4iLCJwcm92aWRlck92ZXJyaWRlcyIsIlByb3ZpZGVyIiwidmFsdWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/overrides.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/index.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/Comment/index.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Body: () => (/* binding */ CommentBody),\n/* harmony export */   Link: () => (/* binding */ CommentLink),\n/* harmony export */   Mention: () => (/* binding */ CommentMention)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../slate/plugins/mentions.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs\");\n/* harmony import */ var _utils_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/utils.mjs\");\n\n\n\n\n\nconst COMMENT_MENTION_NAME = \"CommentMention\";\nconst COMMENT_BODY_NAME = \"CommentBody\";\nconst COMMENT_LINK_NAME = \"CommentLink\";\nconst CommentMention = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  ({ children, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__.Slot : \"span\";\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n      ...props,\n      ref: forwardedRef\n    }, children);\n  }\n);\nconst CommentLink = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  ({ children, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__.Slot : \"a\";\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n      target: \"_blank\",\n      rel: \"noopener noreferrer nofollow\",\n      ...props,\n      ref: forwardedRef\n    }, children);\n  }\n);\nconst defaultBodyComponents = {\n  Mention: ({ userId }) => {\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CommentMention, null, _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_2__.MENTION_CHARACTER, userId);\n  },\n  Link: ({ href, children }) => {\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CommentLink, {\n      href\n    }, children);\n  }\n};\nconst CommentBody = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  ({ body, components, style, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__.Slot : \"div\";\n    const { Mention, Link } = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(\n      () => ({ ...defaultBodyComponents, ...components }),\n      [components]\n    );\n    if (!body || !body?.content) {\n      return null;\n    }\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n      ...props,\n      style: { whiteSpace: \"break-spaces\", ...style },\n      ref: forwardedRef\n    }, body.content.map((block, index) => {\n      switch (block.type) {\n        case \"paragraph\":\n          return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"p\", {\n            key: index,\n            style: { minHeight: \"1lh\" }\n          }, block.children.map((inline, index2) => {\n            if ((0,_utils_mjs__WEBPACK_IMPORTED_MODULE_3__.isCommentBodyMention)(inline)) {\n              return inline.id ? /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Mention, {\n                userId: inline.id,\n                key: index2\n              }) : null;\n            }\n            if ((0,_utils_mjs__WEBPACK_IMPORTED_MODULE_3__.isCommentBodyLink)(inline)) {\n              const href = (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_3__.toAbsoluteUrl)(inline.url) ?? inline.url;\n              return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Link, {\n                href,\n                key: index2\n              }, inline.text ?? inline.url);\n            }\n            let children = inline.text;\n            if (inline.bold) {\n              children = /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"strong\", {\n                key: index2\n              }, children);\n            }\n            if (inline.italic) {\n              children = /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"em\", {\n                key: index2\n              }, children);\n            }\n            if (inline.strikethrough) {\n              children = /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"s\", {\n                key: index2\n              }, children);\n            }\n            if (inline.code) {\n              children = /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"code\", {\n                key: index2\n              }, children);\n            }\n            return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n              key: index2\n            }, children);\n          }));\n        default:\n          return null;\n      }\n    }));\n  }\n);\nif (true) {\n  CommentBody.displayName = COMMENT_BODY_NAME;\n  CommentMention.displayName = COMMENT_MENTION_NAME;\n  CommentLink.displayName = COMMENT_LINK_NAME;\n}\n\n\n//# sourceMappingURL=index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0NvbW1lbnQvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBNEM7QUFDZ0I7QUFDUztBQUNnQjs7QUFFckY7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlEQUFVO0FBQ2pDLEtBQUssNkJBQTZCO0FBQ2xDLGdDQUFnQyxzREFBSTtBQUNwQywyQkFBMkIsZ0RBQTRCO0FBQ3ZEO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixpREFBVTtBQUM5QixLQUFLLDZCQUE2QjtBQUNsQyxnQ0FBZ0Msc0RBQUk7QUFDcEMsMkJBQTJCLGdEQUE0QjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxjQUFjLFFBQVE7QUFDdEIsMkJBQTJCLGdEQUE0Qix1QkFBdUIsMEVBQWlCO0FBQy9GLEdBQUc7QUFDSCxXQUFXLGdCQUFnQjtBQUMzQiwyQkFBMkIsZ0RBQTRCO0FBQ3ZEO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsaURBQVU7QUFDOUIsS0FBSyw0Q0FBNEM7QUFDakQsZ0NBQWdDLHNEQUFJO0FBQ3BDLFlBQVksZ0JBQWdCLEVBQUUsOENBQU87QUFDckMsZUFBZSx5Q0FBeUM7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixnREFBNEI7QUFDdkQ7QUFDQSxlQUFlLHNDQUFzQztBQUNyRDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsaUNBQWlDLGdEQUE0QjtBQUM3RDtBQUNBLHFCQUFxQjtBQUNyQixXQUFXO0FBQ1gsZ0JBQWdCLGdFQUFvQjtBQUNwQyxpREFBaUQsZ0RBQTRCO0FBQzdFO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxnQkFBZ0IsNkRBQWlCO0FBQ2pDLDJCQUEyQix5REFBYTtBQUN4QyxxQ0FBcUMsZ0RBQTRCO0FBQ2pFO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGdEQUE0QjtBQUNyRTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EseUNBQXlDLGdEQUE0QjtBQUNyRTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EseUNBQXlDLGdEQUE0QjtBQUNyRTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EseUNBQXlDLGdEQUE0QjtBQUNyRTtBQUNBLGVBQWU7QUFDZjtBQUNBLG1DQUFtQyxnREFBNEI7QUFDL0Q7QUFDQSxhQUFhO0FBQ2IsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSSxJQUFxQztBQUN6QztBQUNBO0FBQ0E7QUFDQTs7QUFFK0U7QUFDL0UiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3ByaW1pdGl2ZXMvQ29tbWVudC9pbmRleC5tanM/MzNiNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTbG90IH0gZnJvbSAnQHJhZGl4LXVpL3JlYWN0LXNsb3QnO1xuaW1wb3J0IFJlYWN0X19kZWZhdWx0LCB7IGZvcndhcmRSZWYsIHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBNRU5USU9OX0NIQVJBQ1RFUiB9IGZyb20gJy4uLy4uL3NsYXRlL3BsdWdpbnMvbWVudGlvbnMubWpzJztcbmltcG9ydCB7IGlzQ29tbWVudEJvZHlNZW50aW9uLCBpc0NvbW1lbnRCb2R5TGluaywgdG9BYnNvbHV0ZVVybCB9IGZyb20gJy4vdXRpbHMubWpzJztcblxuY29uc3QgQ09NTUVOVF9NRU5USU9OX05BTUUgPSBcIkNvbW1lbnRNZW50aW9uXCI7XG5jb25zdCBDT01NRU5UX0JPRFlfTkFNRSA9IFwiQ29tbWVudEJvZHlcIjtcbmNvbnN0IENPTU1FTlRfTElOS19OQU1FID0gXCJDb21tZW50TGlua1wiO1xuY29uc3QgQ29tbWVudE1lbnRpb24gPSBmb3J3YXJkUmVmKFxuICAoeyBjaGlsZHJlbiwgYXNDaGlsZCwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcInNwYW5cIjtcbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tcG9uZW50LCB7XG4gICAgICAuLi5wcm9wcyxcbiAgICAgIHJlZjogZm9yd2FyZGVkUmVmXG4gICAgfSwgY2hpbGRyZW4pO1xuICB9XG4pO1xuY29uc3QgQ29tbWVudExpbmsgPSBmb3J3YXJkUmVmKFxuICAoeyBjaGlsZHJlbiwgYXNDaGlsZCwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcImFcIjtcbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tcG9uZW50LCB7XG4gICAgICB0YXJnZXQ6IFwiX2JsYW5rXCIsXG4gICAgICByZWw6IFwibm9vcGVuZXIgbm9yZWZlcnJlciBub2ZvbGxvd1wiLFxuICAgICAgLi4ucHJvcHMsXG4gICAgICByZWY6IGZvcndhcmRlZFJlZlxuICAgIH0sIGNoaWxkcmVuKTtcbiAgfVxuKTtcbmNvbnN0IGRlZmF1bHRCb2R5Q29tcG9uZW50cyA9IHtcbiAgTWVudGlvbjogKHsgdXNlcklkIH0pID0+IHtcbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tbWVudE1lbnRpb24sIG51bGwsIE1FTlRJT05fQ0hBUkFDVEVSLCB1c2VySWQpO1xuICB9LFxuICBMaW5rOiAoeyBocmVmLCBjaGlsZHJlbiB9KSA9PiB7XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbW1lbnRMaW5rLCB7XG4gICAgICBocmVmXG4gICAgfSwgY2hpbGRyZW4pO1xuICB9XG59O1xuY29uc3QgQ29tbWVudEJvZHkgPSBmb3J3YXJkUmVmKFxuICAoeyBib2R5LCBjb21wb25lbnRzLCBzdHlsZSwgYXNDaGlsZCwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcImRpdlwiO1xuICAgIGNvbnN0IHsgTWVudGlvbiwgTGluayB9ID0gdXNlTWVtbyhcbiAgICAgICgpID0+ICh7IC4uLmRlZmF1bHRCb2R5Q29tcG9uZW50cywgLi4uY29tcG9uZW50cyB9KSxcbiAgICAgIFtjb21wb25lbnRzXVxuICAgICk7XG4gICAgaWYgKCFib2R5IHx8ICFib2R5Py5jb250ZW50KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbXBvbmVudCwge1xuICAgICAgLi4ucHJvcHMsXG4gICAgICBzdHlsZTogeyB3aGl0ZVNwYWNlOiBcImJyZWFrLXNwYWNlc1wiLCAuLi5zdHlsZSB9LFxuICAgICAgcmVmOiBmb3J3YXJkZWRSZWZcbiAgICB9LCBib2R5LmNvbnRlbnQubWFwKChibG9jaywgaW5kZXgpID0+IHtcbiAgICAgIHN3aXRjaCAoYmxvY2sudHlwZSkge1xuICAgICAgICBjYXNlIFwicGFyYWdyYXBoXCI6XG4gICAgICAgICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KFwicFwiLCB7XG4gICAgICAgICAgICBrZXk6IGluZGV4LFxuICAgICAgICAgICAgc3R5bGU6IHsgbWluSGVpZ2h0OiBcIjFsaFwiIH1cbiAgICAgICAgICB9LCBibG9jay5jaGlsZHJlbi5tYXAoKGlubGluZSwgaW5kZXgyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNDb21tZW50Qm9keU1lbnRpb24oaW5saW5lKSkge1xuICAgICAgICAgICAgICByZXR1cm4gaW5saW5lLmlkID8gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTWVudGlvbiwge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogaW5saW5lLmlkLFxuICAgICAgICAgICAgICAgIGtleTogaW5kZXgyXG4gICAgICAgICAgICAgIH0pIDogbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0NvbW1lbnRCb2R5TGluayhpbmxpbmUpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGhyZWYgPSB0b0Fic29sdXRlVXJsKGlubGluZS51cmwpID8/IGlubGluZS51cmw7XG4gICAgICAgICAgICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChMaW5rLCB7XG4gICAgICAgICAgICAgICAgaHJlZixcbiAgICAgICAgICAgICAgICBrZXk6IGluZGV4MlxuICAgICAgICAgICAgICB9LCBpbmxpbmUudGV4dCA/PyBpbmxpbmUudXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjaGlsZHJlbiA9IGlubGluZS50ZXh0O1xuICAgICAgICAgICAgaWYgKGlubGluZS5ib2xkKSB7XG4gICAgICAgICAgICAgIGNoaWxkcmVuID0gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJzdHJvbmdcIiwge1xuICAgICAgICAgICAgICAgIGtleTogaW5kZXgyXG4gICAgICAgICAgICAgIH0sIGNoaWxkcmVuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbmxpbmUuaXRhbGljKSB7XG4gICAgICAgICAgICAgIGNoaWxkcmVuID0gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJlbVwiLCB7XG4gICAgICAgICAgICAgICAga2V5OiBpbmRleDJcbiAgICAgICAgICAgICAgfSwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlubGluZS5zdHJpa2V0aHJvdWdoKSB7XG4gICAgICAgICAgICAgIGNoaWxkcmVuID0gLyogQF9fUFVSRV9fICovIFJlYWN0X19kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJzXCIsIHtcbiAgICAgICAgICAgICAgICBrZXk6IGluZGV4MlxuICAgICAgICAgICAgICB9LCBjaGlsZHJlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW5saW5lLmNvZGUpIHtcbiAgICAgICAgICAgICAgY2hpbGRyZW4gPSAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcImNvZGVcIiwge1xuICAgICAgICAgICAgICAgIGtleTogaW5kZXgyXG4gICAgICAgICAgICAgIH0sIGNoaWxkcmVuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3RfX2RlZmF1bHQuY3JlYXRlRWxlbWVudChcInNwYW5cIiwge1xuICAgICAgICAgICAgICBrZXk6IGluZGV4MlxuICAgICAgICAgICAgfSwgY2hpbGRyZW4pO1xuICAgICAgICAgIH0pKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9KSk7XG4gIH1cbik7XG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gIENvbW1lbnRCb2R5LmRpc3BsYXlOYW1lID0gQ09NTUVOVF9CT0RZX05BTUU7XG4gIENvbW1lbnRNZW50aW9uLmRpc3BsYXlOYW1lID0gQ09NTUVOVF9NRU5USU9OX05BTUU7XG4gIENvbW1lbnRMaW5rLmRpc3BsYXlOYW1lID0gQ09NTUVOVF9MSU5LX05BTUU7XG59XG5cbmV4cG9ydCB7IENvbW1lbnRCb2R5IGFzIEJvZHksIENvbW1lbnRMaW5rIGFzIExpbmssIENvbW1lbnRNZW50aW9uIGFzIE1lbnRpb24gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4Lm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/utils.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/Comment/utils.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isCommentBodyLink: () => (/* binding */ isCommentBodyLink),\n/* harmony export */   isCommentBodyMention: () => (/* binding */ isCommentBodyMention),\n/* harmony export */   isCommentBodyText: () => (/* binding */ isCommentBodyText),\n/* harmony export */   toAbsoluteUrl: () => (/* binding */ toAbsoluteUrl)\n/* harmony export */ });\nfunction isCommentBodyText(element) {\n  return !(\"type\" in element) && \"text\" in element && typeof element.text === \"string\";\n}\nfunction isCommentBodyMention(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyLink(element) {\n  return \"type\" in element && element.type === \"link\";\n}\nfunction toAbsoluteUrl(url) {\n  if (url.startsWith(\"http://\") || url.startsWith(\"https://\")) {\n    return url;\n  } else if (url.startsWith(\"www.\")) {\n    return \"https://\" + url;\n  }\n  return;\n}\n\n\n//# sourceMappingURL=utils.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0NvbW1lbnQvdXRpbHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRXFGO0FBQ3JGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0NvbW1lbnQvdXRpbHMubWpzP2YxZTIiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gaXNDb21tZW50Qm9keVRleHQoZWxlbWVudCkge1xuICByZXR1cm4gIShcInR5cGVcIiBpbiBlbGVtZW50KSAmJiBcInRleHRcIiBpbiBlbGVtZW50ICYmIHR5cGVvZiBlbGVtZW50LnRleHQgPT09IFwic3RyaW5nXCI7XG59XG5mdW5jdGlvbiBpc0NvbW1lbnRCb2R5TWVudGlvbihlbGVtZW50KSB7XG4gIHJldHVybiBcInR5cGVcIiBpbiBlbGVtZW50ICYmIGVsZW1lbnQudHlwZSA9PT0gXCJtZW50aW9uXCI7XG59XG5mdW5jdGlvbiBpc0NvbW1lbnRCb2R5TGluayhlbGVtZW50KSB7XG4gIHJldHVybiBcInR5cGVcIiBpbiBlbGVtZW50ICYmIGVsZW1lbnQudHlwZSA9PT0gXCJsaW5rXCI7XG59XG5mdW5jdGlvbiB0b0Fic29sdXRlVXJsKHVybCkge1xuICBpZiAodXJsLnN0YXJ0c1dpdGgoXCJodHRwOi8vXCIpIHx8IHVybC5zdGFydHNXaXRoKFwiaHR0cHM6Ly9cIikpIHtcbiAgICByZXR1cm4gdXJsO1xuICB9IGVsc2UgaWYgKHVybC5zdGFydHNXaXRoKFwid3d3LlwiKSkge1xuICAgIHJldHVybiBcImh0dHBzOi8vXCIgKyB1cmw7XG4gIH1cbiAgcmV0dXJuO1xufVxuXG5leHBvcnQgeyBpc0NvbW1lbnRCb2R5TGluaywgaXNDb21tZW50Qm9keU1lbnRpb24sIGlzQ29tbWVudEJvZHlUZXh0LCB0b0Fic29sdXRlVXJsIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD11dGlscy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/utils.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/contexts.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/Composer/contexts.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ComposerContext: () => (/* binding */ ComposerContext),\n/* harmony export */   ComposerEditorContext: () => (/* binding */ ComposerEditorContext),\n/* harmony export */   ComposerSuggestionsContext: () => (/* binding */ ComposerSuggestionsContext),\n/* harmony export */   useComposer: () => (/* binding */ useComposer),\n/* harmony export */   useComposerEditorContext: () => (/* binding */ useComposerEditorContext),\n/* harmony export */   useComposerSuggestionsContext: () => (/* binding */ useComposerSuggestionsContext)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\n\nconst ComposerContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst ComposerEditorContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nconst ComposerSuggestionsContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nfunction useComposerEditorContext() {\n  const composerEditorContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(ComposerEditorContext);\n  return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_1__.nn)(\n    composerEditorContext,\n    \"Composer.Form is missing from the React tree.\"\n  );\n}\nfunction useComposer() {\n  const composerContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(ComposerContext);\n  return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_1__.nn)(composerContext, \"Composer.Form is missing from the React tree.\");\n}\nfunction useComposerSuggestionsContext(source = \"useComposerSuggestionsContext\") {\n  const composerSuggestionsContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(ComposerSuggestionsContext);\n  return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_1__.nn)(\n    composerSuggestionsContext,\n    `${source} can\\u2019t be used outside of Composer.Editor.`\n  );\n}\n\n\n//# sourceMappingURL=contexts.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0NvbXBvc2VyL2NvbnRleHRzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzQztBQUNZOztBQUVsRCx3QkFBd0Isb0RBQWE7QUFDckMsOEJBQThCLG9EQUFhO0FBQzNDLG1DQUFtQyxvREFBYTtBQUNoRDtBQUNBLGdDQUFnQyxpREFBVTtBQUMxQyxTQUFTLG9EQUFFO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpREFBVTtBQUNwQyxTQUFTLG9EQUFFO0FBQ1g7QUFDQTtBQUNBLHFDQUFxQyxpREFBVTtBQUMvQyxTQUFTLG9EQUFFO0FBQ1g7QUFDQSxPQUFPLFFBQVE7QUFDZjtBQUNBOztBQUVvSjtBQUNwSiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvcHJpbWl0aXZlcy9Db21wb3Nlci9jb250ZXh0cy5tanM/M2IxNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBubiB9IGZyb20gJ0BsaXZlYmxvY2tzL2NvcmUnO1xuaW1wb3J0IHsgY3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcblxuY29uc3QgQ29tcG9zZXJDb250ZXh0ID0gY3JlYXRlQ29udGV4dChudWxsKTtcbmNvbnN0IENvbXBvc2VyRWRpdG9yQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQobnVsbCk7XG5jb25zdCBDb21wb3NlclN1Z2dlc3Rpb25zQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQobnVsbCk7XG5mdW5jdGlvbiB1c2VDb21wb3NlckVkaXRvckNvbnRleHQoKSB7XG4gIGNvbnN0IGNvbXBvc2VyRWRpdG9yQ29udGV4dCA9IHVzZUNvbnRleHQoQ29tcG9zZXJFZGl0b3JDb250ZXh0KTtcbiAgcmV0dXJuIG5uKFxuICAgIGNvbXBvc2VyRWRpdG9yQ29udGV4dCxcbiAgICBcIkNvbXBvc2VyLkZvcm0gaXMgbWlzc2luZyBmcm9tIHRoZSBSZWFjdCB0cmVlLlwiXG4gICk7XG59XG5mdW5jdGlvbiB1c2VDb21wb3NlcigpIHtcbiAgY29uc3QgY29tcG9zZXJDb250ZXh0ID0gdXNlQ29udGV4dChDb21wb3NlckNvbnRleHQpO1xuICByZXR1cm4gbm4oY29tcG9zZXJDb250ZXh0LCBcIkNvbXBvc2VyLkZvcm0gaXMgbWlzc2luZyBmcm9tIHRoZSBSZWFjdCB0cmVlLlwiKTtcbn1cbmZ1bmN0aW9uIHVzZUNvbXBvc2VyU3VnZ2VzdGlvbnNDb250ZXh0KHNvdXJjZSA9IFwidXNlQ29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHRcIikge1xuICBjb25zdCBjb21wb3NlclN1Z2dlc3Rpb25zQ29udGV4dCA9IHVzZUNvbnRleHQoQ29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHQpO1xuICByZXR1cm4gbm4oXG4gICAgY29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHQsXG4gICAgYCR7c291cmNlfSBjYW5cXHUyMDE5dCBiZSB1c2VkIG91dHNpZGUgb2YgQ29tcG9zZXIuRWRpdG9yLmBcbiAgKTtcbn1cblxuZXhwb3J0IHsgQ29tcG9zZXJDb250ZXh0LCBDb21wb3NlckVkaXRvckNvbnRleHQsIENvbXBvc2VyU3VnZ2VzdGlvbnNDb250ZXh0LCB1c2VDb21wb3NlciwgdXNlQ29tcG9zZXJFZGl0b3JDb250ZXh0LCB1c2VDb21wb3NlclN1Z2dlc3Rpb25zQ29udGV4dCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29udGV4dHMubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/contexts.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/index.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/Composer/index.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Editor: () => (/* binding */ ComposerEditor),\n/* harmony export */   Form: () => (/* binding */ ComposerForm),\n/* harmony export */   Link: () => (/* binding */ ComposerLink),\n/* harmony export */   Mention: () => (/* binding */ ComposerMention),\n/* harmony export */   Submit: () => (/* binding */ ComposerSubmit),\n/* harmony export */   Suggestions: () => (/* binding */ ComposerSuggestions),\n/* harmony export */   SuggestionsList: () => (/* binding */ ComposerSuggestionsList),\n/* harmony export */   SuggestionsListItem: () => (/* binding */ ComposerSuggestionsListItem)\n/* harmony export */ });\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs\");\n/* harmony import */ var _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @floating-ui/react-dom */ \"(ssr)/./node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var slate_history__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! slate-history */ \"(ssr)/./node_modules/slate-history/dist/index.es.js\");\n/* harmony import */ var slate_react__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! slate-react */ \"(ssr)/./node_modules/slate-react/dist/index.es.js\");\n/* harmony import */ var _config_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../config.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/config.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../constants.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\");\n/* harmony import */ var _shared_mjs__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../shared.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs\");\n/* harmony import */ var _slate_plugins_auto_formatting_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../slate/plugins/auto-formatting.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-formatting.mjs\");\n/* harmony import */ var _slate_plugins_auto_links_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../slate/plugins/auto-links.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-links.mjs\");\n/* harmony import */ var _slate_plugins_custom_links_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../slate/plugins/custom-links.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/custom-links.mjs\");\n/* harmony import */ var _slate_plugins_empty_clear_formatting_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../slate/plugins/empty-clear-formatting.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/empty-clear-formatting.mjs\");\n/* harmony import */ var _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../slate/plugins/mentions.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs\");\n/* harmony import */ var _slate_plugins_paste_html_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../slate/plugins/paste-html.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/paste-html.mjs\");\n/* harmony import */ var _slate_utils_get_dom_range_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../slate/utils/get-dom-range.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-dom-range.mjs\");\n/* harmony import */ var _slate_utils_is_empty_mjs__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../slate/utils/is-empty.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty.mjs\");\n/* harmony import */ var _slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../slate/utils/marks.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/marks.mjs\");\n/* harmony import */ var _utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../utils/is-key.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-key.mjs\");\n/* harmony import */ var _utils_Persist_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../utils/Persist.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/Persist.mjs\");\n/* harmony import */ var _utils_Portal_mjs__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../utils/Portal.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/Portal.mjs\");\n/* harmony import */ var _utils_request_submit_mjs__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../utils/request-submit.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/request-submit.mjs\");\n/* harmony import */ var _utils_use_id_mjs__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../utils/use-id.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-id.mjs\");\n/* harmony import */ var _utils_use_index_mjs__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../utils/use-index.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-index.mjs\");\n/* harmony import */ var _utils_use_initial_mjs__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../utils/use-initial.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-initial.mjs\");\n/* harmony import */ var _utils_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../utils/use-layout-effect.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs\");\n/* harmony import */ var _utils_use_refs_mjs__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../utils/use-refs.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-refs.mjs\");\n/* harmony import */ var _Comment_utils_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../Comment/utils.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/utils.mjs\");\n/* harmony import */ var _contexts_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./contexts.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/contexts.mjs\");\n/* harmony import */ var _utils_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./utils.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/utils.mjs\");\n/* __next_internal_client_entry_do_not_use__ Editor,Form,Link,Mention,Submit,Suggestions,SuggestionsList,SuggestionsListItem auto */ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst MENTION_SUGGESTIONS_POSITION = \"top\";\nconst COMPOSER_MENTION_NAME = \"ComposerMention\";\nconst COMPOSER_LINK_NAME = \"ComposerLink\";\nconst COMPOSER_SUGGESTIONS_NAME = \"ComposerSuggestions\";\nconst COMPOSER_SUGGESTIONS_LIST_NAME = \"ComposerSuggestionsList\";\nconst COMPOSER_SUGGESTIONS_LIST_ITEM_NAME = \"ComposerSuggestionsListItem\";\nconst COMPOSER_SUBMIT_NAME = \"ComposerSubmit\";\nconst COMPOSER_EDITOR_NAME = \"ComposerEditor\";\nconst COMPOSER_FORM_NAME = \"ComposerForm\";\nconst emptyCommentBody = {\n    version: 1,\n    content: [\n        {\n            type: \"paragraph\",\n            children: [\n                {\n                    text: \"\"\n                }\n            ]\n        }\n    ]\n};\nfunction createComposerEditor() {\n    return (0,_slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_1__.withMentions)((0,_slate_plugins_custom_links_mjs__WEBPACK_IMPORTED_MODULE_2__.withCustomLinks)((0,_slate_plugins_auto_links_mjs__WEBPACK_IMPORTED_MODULE_3__.withAutoLinks)((0,_slate_plugins_auto_formatting_mjs__WEBPACK_IMPORTED_MODULE_4__.withAutoFormatting)((0,_slate_plugins_empty_clear_formatting_mjs__WEBPACK_IMPORTED_MODULE_5__.withEmptyClearFormatting)((0,_slate_plugins_paste_html_mjs__WEBPACK_IMPORTED_MODULE_6__.withPasteHtml)((0,slate_history__WEBPACK_IMPORTED_MODULE_7__.withHistory)((0,slate_react__WEBPACK_IMPORTED_MODULE_8__.withReact)((0,slate__WEBPACK_IMPORTED_MODULE_9__.createEditor)()))))))));\n}\nfunction ComposerEditorMentionWrapper({ Mention, attributes, children, element }) {\n    const isSelected = (0,slate_react__WEBPACK_IMPORTED_MODULE_8__.useSelected)();\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        ...attributes\n    }, element.id ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Mention, {\n        userId: element.id,\n        isSelected\n    }) : null, children);\n}\nfunction ComposerEditorLinkWrapper({ Link, attributes, element, children }) {\n    const href = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>(0,_Comment_utils_mjs__WEBPACK_IMPORTED_MODULE_10__.toAbsoluteUrl)(element.url) ?? element.url, [\n        element.url\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        ...attributes\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Link, {\n        href\n    }, children));\n}\nfunction ComposerEditorMentionSuggestionsWrapper({ id, itemId, userIds, selectedUserId, setSelectedUserId, mentionDraft, onItemSelect, position = MENTION_SUGGESTIONS_POSITION, dir, MentionSuggestions }) {\n    const editor = (0,slate_react__WEBPACK_IMPORTED_MODULE_8__.useSlateStatic)();\n    const { isFocused } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposer)();\n    const [content, setContent] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n    const [contentZIndex, setContentZIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)();\n    const contentRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(setContent, [\n        setContent\n    ]);\n    const { portalContainer } = (0,_config_mjs__WEBPACK_IMPORTED_MODULE_12__.useLiveblocksUIConfig)();\n    const floatingOptions = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        const detectOverflowOptions = {\n            padding: _constants_mjs__WEBPACK_IMPORTED_MODULE_13__.FLOATING_ELEMENT_COLLISION_PADDING\n        };\n        return {\n            strategy: \"fixed\",\n            placement: (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_14__.getPlacementFromPosition)(position, dir),\n            middleware: [\n                (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__.flip)({\n                    ...detectOverflowOptions,\n                    crossAxis: false\n                }),\n                (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__.hide)(detectOverflowOptions),\n                (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__.shift)({\n                    ...detectOverflowOptions,\n                    limiter: (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__.limitShift)()\n                }),\n                (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__.size)({\n                    ...detectOverflowOptions,\n                    apply ({ availableWidth, availableHeight, elements }) {\n                        elements.floating.style.setProperty(\"--lb-composer-suggestions-available-width\", `${availableWidth}px`);\n                        elements.floating.style.setProperty(\"--lb-composer-suggestions-available-height\", `${availableHeight}px`);\n                    }\n                })\n            ],\n            whileElementsMounted: _floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_16__.autoUpdate\n        };\n    }, [\n        position,\n        dir\n    ]);\n    const { refs: { setReference, setFloating }, strategy, isPositioned, placement, x, y } = (0,_floating_ui_react_dom__WEBPACK_IMPORTED_MODULE_15__.useFloating)(floatingOptions);\n    (0,_utils_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_17__.useLayoutEffect)(()=>{\n        if (content) {\n            setContentZIndex(window.getComputedStyle(content).zIndex);\n        }\n    }, [\n        content\n    ]);\n    (0,_utils_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_17__.useLayoutEffect)(()=>{\n        if (!mentionDraft) {\n            return;\n        }\n        const domRange = (0,_slate_utils_get_dom_range_mjs__WEBPACK_IMPORTED_MODULE_18__.getDOMRange)(editor, mentionDraft.range);\n        if (domRange) {\n            setReference({\n                getBoundingClientRect: ()=>domRange.getBoundingClientRect(),\n                getClientRects: ()=>domRange.getClientRects()\n            });\n        }\n    }, [\n        setReference,\n        editor,\n        mentionDraft\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_utils_Persist_mjs__WEBPACK_IMPORTED_MODULE_19__.Persist, null, mentionDraft?.range && isFocused && userIds ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.ComposerSuggestionsContext.Provider, {\n        value: {\n            id,\n            itemId,\n            selectedValue: selectedUserId,\n            setSelectedValue: setSelectedUserId,\n            onItemSelect,\n            placement,\n            dir,\n            ref: contentRef\n        }\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_utils_Portal_mjs__WEBPACK_IMPORTED_MODULE_20__.Portal, {\n        ref: setFloating,\n        container: portalContainer,\n        style: {\n            position: strategy,\n            top: 0,\n            left: 0,\n            transform: isPositioned ? `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)` : \"translate3d(0, -200%, 0)\",\n            minWidth: \"max-content\",\n            zIndex: contentZIndex\n        }\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(MentionSuggestions, {\n        userIds,\n        selectedUserId\n    }))) : null);\n}\nfunction ComposerEditorElement({ Mention, Link, ...props }) {\n    const { attributes, children, element } = props;\n    switch(element.type){\n        case \"mention\":\n            return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerEditorMentionWrapper, {\n                Mention,\n                ...props\n            });\n        case \"auto-link\":\n        case \"custom-link\":\n            return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerEditorLinkWrapper, {\n                Link,\n                ...props\n            });\n        case \"paragraph\":\n            return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"p\", {\n                ...attributes,\n                style: {\n                    position: \"relative\"\n                }\n            }, children);\n        default:\n            return null;\n    }\n}\nfunction ComposerEditorLeaf({ attributes, children, leaf }) {\n    if (leaf.bold) {\n        children = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"strong\", null, children);\n    }\n    if (leaf.italic) {\n        children = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"em\", null, children);\n    }\n    if (leaf.strikethrough) {\n        children = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"s\", null, children);\n    }\n    if (leaf.code) {\n        children = /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"code\", null, children);\n    }\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        ...attributes\n    }, children);\n}\nfunction ComposerEditorPlaceholder({ attributes, children }) {\n    const { opacity: _opacity, ...style } = attributes.style;\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"span\", {\n        ...attributes,\n        style,\n        \"data-placeholder\": \"\"\n    }, children);\n}\nconst ComposerMention = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"span\";\n    const isSelected = (0,slate_react__WEBPACK_IMPORTED_MODULE_8__.useSelected)();\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        \"data-selected\": isSelected || void 0,\n        ...props,\n        ref: forwardedRef\n    }, children);\n});\nconst ComposerLink = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"a\";\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        target: \"_blank\",\n        rel: \"noopener noreferrer nofollow\",\n        ...props,\n        ref: forwardedRef\n    }, children);\n});\nconst ComposerSuggestions = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, style, asChild, ...props }, forwardedRef)=>{\n    const [isPresent] = (0,_utils_Persist_mjs__WEBPACK_IMPORTED_MODULE_19__.usePersist)();\n    const ref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const { ref: contentRef, placement, dir } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposerSuggestionsContext)(COMPOSER_SUGGESTIONS_NAME);\n    const mergedRefs = (0,_utils_use_refs_mjs__WEBPACK_IMPORTED_MODULE_22__.useRefs)(forwardedRef, contentRef, ref);\n    const [side, align] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>(0,_utils_mjs__WEBPACK_IMPORTED_MODULE_14__.getSideAndAlignFromPlacement)(placement), [\n        placement\n    ]);\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"div\";\n    (0,_utils_Persist_mjs__WEBPACK_IMPORTED_MODULE_19__.useAnimationPersist)(ref);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        dir,\n        ...props,\n        \"data-state\": isPresent ? \"open\" : \"closed\",\n        \"data-side\": side,\n        \"data-align\": align,\n        style: {\n            display: \"flex\",\n            flexDirection: \"column\",\n            maxHeight: \"var(--lb-composer-suggestions-available-height)\",\n            overflowY: \"auto\",\n            ...style\n        },\n        ref: mergedRefs\n    }, children);\n});\nconst ComposerSuggestionsList = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, asChild, ...props }, forwardedRef)=>{\n    const { id } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposerSuggestionsContext)(COMPOSER_SUGGESTIONS_LIST_NAME);\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"ul\";\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        role: \"listbox\",\n        id,\n        \"aria-label\": \"Suggestions list\",\n        ...props,\n        ref: forwardedRef\n    }, children);\n});\nconst ComposerSuggestionsListItem = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ value, children, onPointerMove, onPointerDown, asChild, ...props }, forwardedRef)=>{\n    const ref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const mergedRefs = (0,_utils_use_refs_mjs__WEBPACK_IMPORTED_MODULE_22__.useRefs)(forwardedRef, ref);\n    const { selectedValue, setSelectedValue, itemId, onItemSelect } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposerSuggestionsContext)(COMPOSER_SUGGESTIONS_LIST_ITEM_NAME);\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"li\";\n    const isSelected = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>selectedValue === value, [\n        selectedValue,\n        value\n    ]);\n    const id = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>itemId(value), [\n        itemId,\n        value\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (ref?.current && isSelected) {\n            ref.current.scrollIntoView({\n                block: \"nearest\"\n            });\n        }\n    }, [\n        isSelected\n    ]);\n    const handlePointerMove = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onPointerMove?.(event);\n        if (!event.isDefaultPrevented()) {\n            setSelectedValue(value);\n        }\n    }, [\n        onPointerMove,\n        setSelectedValue,\n        value\n    ]);\n    const handlePointerDown = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onPointerDown?.(event);\n        if (!event.isDefaultPrevented()) {\n            const target = event.target;\n            if (target.hasPointerCapture(event.pointerId)) {\n                target.releasePointerCapture(event.pointerId);\n            }\n            if (event.button === 0 && event.ctrlKey === false) {\n                onItemSelect(value);\n                event.preventDefault();\n            }\n        }\n    }, [\n        onItemSelect,\n        onPointerDown,\n        value\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        role: \"option\",\n        id,\n        \"data-selected\": isSelected || void 0,\n        \"aria-selected\": isSelected || void 0,\n        onPointerMove: handlePointerMove,\n        onPointerDown: handlePointerDown,\n        ...props,\n        ref: mergedRefs\n    }, children);\n});\nconst defaultEditorComponents = {\n    Link: ({ href, children })=>{\n        return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerLink, {\n            href\n        }, children);\n    },\n    Mention: ({ userId })=>{\n        return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerMention, null, _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_1__.MENTION_CHARACTER, userId);\n    },\n    MentionSuggestions: ({ userIds })=>{\n        return userIds.length > 0 ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerSuggestions, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerSuggestionsList, null, userIds.map((userId)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerSuggestionsListItem, {\n                key: userId,\n                value: userId\n            }, userId)))) : null;\n    }\n};\nconst ComposerEditor = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ defaultValue, onKeyDown, onFocus, onBlur, disabled, autoFocus, components, dir, ...props }, forwardedRef)=>{\n    const self = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_23__._useSelf)();\n    const isDisabled = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>disabled || !self?.canComment, [\n        disabled,\n        self?.canComment\n    ]);\n    const { editor, validate, setFocused } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposerEditorContext)();\n    const { submit, focus, select, isEmpty, isFocused } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposer)();\n    const initialBody = (0,_utils_use_initial_mjs__WEBPACK_IMPORTED_MODULE_24__.useInitial)(defaultValue ?? emptyCommentBody);\n    const initialEditorValue = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>{\n        return (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_14__.commentBodyToComposerBody)(initialBody);\n    }, [\n        initialBody\n    ]);\n    const { Link, Mention, MentionSuggestions } = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            ...defaultEditorComponents,\n            ...components\n        }), [\n        components\n    ]);\n    const [mentionDraft, setMentionDraft] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)();\n    const mentionSuggestions = (0,_shared_mjs__WEBPACK_IMPORTED_MODULE_25__.useMentionSuggestions)(mentionDraft?.text);\n    const [selectedMentionSuggestionIndex, setPreviousSelectedMentionSuggestionIndex, setNextSelectedMentionSuggestionIndex, setSelectedMentionSuggestionIndex] = (0,_utils_use_index_mjs__WEBPACK_IMPORTED_MODULE_26__.useIndex)(0, mentionSuggestions?.length ?? 0);\n    const id = (0,_utils_use_id_mjs__WEBPACK_IMPORTED_MODULE_27__.useId)();\n    const suggestionsListId = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>`liveblocks-suggestions-list-${id}`, [\n        id\n    ]);\n    const suggestionsListItemId = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((userId)=>userId ? `liveblocks-suggestions-list-item-${id}-${userId}` : void 0, [\n        id\n    ]);\n    const renderElement = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((props2)=>{\n        return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerEditorElement, {\n            Mention,\n            Link,\n            ...props2\n        });\n    }, [\n        Link,\n        Mention\n    ]);\n    const handleChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((value)=>{\n        validate(value);\n        setMentionDraft((0,_slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_1__.getMentionDraftAtSelection)(editor));\n    }, [\n        editor,\n        validate\n    ]);\n    const createMention = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((userId)=>{\n        if (!mentionDraft || !userId) {\n            return;\n        }\n        slate__WEBPACK_IMPORTED_MODULE_9__.Transforms.select(editor, mentionDraft.range);\n        (0,_slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_1__.insertMention)(editor, userId);\n        setMentionDraft(void 0);\n        setSelectedMentionSuggestionIndex(0);\n    }, [\n        editor,\n        mentionDraft,\n        setSelectedMentionSuggestionIndex\n    ]);\n    const handleKeyDown = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onKeyDown?.(event);\n        if (event.isDefaultPrevented()) {\n            return;\n        }\n        if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"ArrowLeft\")) {\n            (0,_slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__.leaveMarkEdge)(editor, \"start\");\n        }\n        if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"ArrowRight\")) {\n            (0,_slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__.leaveMarkEdge)(editor, \"end\");\n        }\n        if (mentionDraft && mentionSuggestions?.length) {\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"ArrowDown\")) {\n                event.preventDefault();\n                setNextSelectedMentionSuggestionIndex();\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"ArrowUp\")) {\n                event.preventDefault();\n                setPreviousSelectedMentionSuggestionIndex();\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"Enter\") || (0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"Tab\")) {\n                event.preventDefault();\n                const userId = mentionSuggestions?.[selectedMentionSuggestionIndex];\n                createMention(userId);\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"Escape\")) {\n                event.preventDefault();\n                setMentionDraft(void 0);\n                setSelectedMentionSuggestionIndex(0);\n            }\n        } else {\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"Escape\")) {\n                event.preventDefault();\n                slate_react__WEBPACK_IMPORTED_MODULE_8__.ReactEditor.blur(editor);\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"Enter\", {\n                shift: false\n            }) && !isEmpty) {\n                event.preventDefault();\n                submit();\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"Enter\", {\n                shift: true\n            })) {\n                event.preventDefault();\n                editor.insertBreak();\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"b\", {\n                mod: true\n            })) {\n                event.preventDefault();\n                (0,_slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__.toggleMark)(editor, \"bold\");\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"i\", {\n                mod: true\n            })) {\n                event.preventDefault();\n                (0,_slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__.toggleMark)(editor, \"italic\");\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"s\", {\n                mod: true,\n                shift: true\n            })) {\n                event.preventDefault();\n                (0,_slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__.toggleMark)(editor, \"strikethrough\");\n            }\n            if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_28__.isKey)(event, \"e\", {\n                mod: true\n            })) {\n                event.preventDefault();\n                (0,_slate_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_29__.toggleMark)(editor, \"code\");\n            }\n        }\n    }, [\n        createMention,\n        editor,\n        isEmpty,\n        mentionDraft,\n        mentionSuggestions,\n        selectedMentionSuggestionIndex,\n        onKeyDown,\n        setNextSelectedMentionSuggestionIndex,\n        setPreviousSelectedMentionSuggestionIndex,\n        setSelectedMentionSuggestionIndex,\n        submit\n    ]);\n    const handleFocus = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onFocus?.(event);\n        if (!event.isDefaultPrevented()) {\n            setFocused(true);\n        }\n    }, [\n        onFocus,\n        setFocused\n    ]);\n    const handleBlur = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onBlur?.(event);\n        if (!event.isDefaultPrevented()) {\n            setFocused(false);\n        }\n    }, [\n        onBlur,\n        setFocused\n    ]);\n    const selectedMentionSuggestionUserId = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>mentionSuggestions?.[selectedMentionSuggestionIndex], [\n        selectedMentionSuggestionIndex,\n        mentionSuggestions\n    ]);\n    const setSelectedMentionSuggestionUserId = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((userId)=>{\n        const index = mentionSuggestions?.indexOf(userId);\n        if (index !== void 0 && index >= 0) {\n            setSelectedMentionSuggestionIndex(index);\n        }\n    }, [\n        setSelectedMentionSuggestionIndex,\n        mentionSuggestions\n    ]);\n    const propsWhileSuggesting = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>mentionDraft ? {\n            role: \"combobox\",\n            \"aria-autocomplete\": \"list\",\n            \"aria-expanded\": true,\n            \"aria-controls\": suggestionsListId,\n            \"aria-activedescendant\": suggestionsListItemId(selectedMentionSuggestionUserId)\n        } : {}, [\n        mentionDraft,\n        suggestionsListId,\n        suggestionsListItemId,\n        selectedMentionSuggestionUserId\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useImperativeHandle)(forwardedRef, ()=>{\n        return slate_react__WEBPACK_IMPORTED_MODULE_8__.ReactEditor.toDOMNode(editor, editor);\n    }, [\n        editor\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (autoFocus) {\n            focus();\n        }\n    }, [\n        autoFocus,\n        editor,\n        focus\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (isFocused && editor.selection === null) {\n            select();\n        }\n    }, [\n        editor,\n        select,\n        isFocused\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(slate_react__WEBPACK_IMPORTED_MODULE_8__.Slate, {\n        editor,\n        initialValue: initialEditorValue,\n        onChange: handleChange\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(slate_react__WEBPACK_IMPORTED_MODULE_8__.Editable, {\n        dir,\n        enterKeyHint: mentionDraft ? \"enter\" : \"send\",\n        autoCapitalize: \"sentences\",\n        \"aria-label\": \"Composer editor\",\n        \"data-focused\": isFocused || void 0,\n        \"data-disabled\": isDisabled || void 0,\n        ...propsWhileSuggesting,\n        ...props,\n        readOnly: isDisabled,\n        disabled: isDisabled,\n        onKeyDown: handleKeyDown,\n        onFocus: handleFocus,\n        onBlur: handleBlur,\n        renderElement,\n        renderLeaf: ComposerEditorLeaf,\n        renderPlaceholder: ComposerEditorPlaceholder\n    }), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ComposerEditorMentionSuggestionsWrapper, {\n        dir,\n        mentionDraft,\n        selectedUserId: selectedMentionSuggestionUserId,\n        setSelectedUserId: setSelectedMentionSuggestionUserId,\n        userIds: mentionSuggestions,\n        id: suggestionsListId,\n        itemId: suggestionsListItemId,\n        onItemSelect: createMention,\n        MentionSuggestions\n    }));\n});\nconst ComposerForm = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, onSubmit, onComposerSubmit, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"form\";\n    const editor = (0,_utils_use_initial_mjs__WEBPACK_IMPORTED_MODULE_24__.useInitial)(createComposerEditor);\n    const [isEmpty$1, setEmpty] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(true);\n    const [isFocused, setFocused] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const ref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const mergedRefs = (0,_utils_use_refs_mjs__WEBPACK_IMPORTED_MODULE_22__.useRefs)(forwardedRef, ref);\n    const validate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((value)=>{\n        setEmpty((0,_slate_utils_is_empty_mjs__WEBPACK_IMPORTED_MODULE_30__.isEmpty)(editor, value));\n    }, [\n        editor\n    ]);\n    const submit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        requestAnimationFrame(()=>{\n            if (ref.current) {\n                (0,_utils_request_submit_mjs__WEBPACK_IMPORTED_MODULE_31__.requestSubmit)(ref.current);\n            }\n        });\n    }, []);\n    const clear = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        slate__WEBPACK_IMPORTED_MODULE_9__.Transforms.delete(editor, {\n            at: {\n                anchor: slate__WEBPACK_IMPORTED_MODULE_9__.Editor.start(editor, []),\n                focus: slate__WEBPACK_IMPORTED_MODULE_9__.Editor.end(editor, [])\n            }\n        });\n    }, [\n        editor\n    ]);\n    const select = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        slate__WEBPACK_IMPORTED_MODULE_9__.Transforms.select(editor, {\n            anchor: slate__WEBPACK_IMPORTED_MODULE_9__.Editor.end(editor, []),\n            focus: slate__WEBPACK_IMPORTED_MODULE_9__.Editor.end(editor, [])\n        });\n    }, [\n        editor\n    ]);\n    const focus = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((resetSelection = true)=>{\n        if (!slate_react__WEBPACK_IMPORTED_MODULE_8__.ReactEditor.isFocused(editor)) {\n            slate__WEBPACK_IMPORTED_MODULE_9__.Transforms.select(editor, resetSelection || !editor.selection ? slate__WEBPACK_IMPORTED_MODULE_9__.Editor.end(editor, []) : editor.selection);\n            slate_react__WEBPACK_IMPORTED_MODULE_8__.ReactEditor.focus(editor);\n        }\n    }, [\n        editor\n    ]);\n    const blur = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        slate_react__WEBPACK_IMPORTED_MODULE_8__.ReactEditor.blur(editor);\n    }, [\n        editor\n    ]);\n    const onSubmitEnd = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        clear();\n        blur();\n    }, [\n        blur,\n        clear\n    ]);\n    const createMention = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        focus();\n        (0,_slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_1__.insertMentionCharacter)(editor);\n    }, [\n        editor,\n        focus\n    ]);\n    const insertText$1 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((text)=>{\n        focus(false);\n        (0,slate__WEBPACK_IMPORTED_MODULE_9__.insertText)(editor, text);\n    }, [\n        editor,\n        focus\n    ]);\n    const handleSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        const isEmpty2 = (0,_slate_utils_is_empty_mjs__WEBPACK_IMPORTED_MODULE_30__.isEmpty)(editor, editor.children);\n        if (isEmpty2) {\n            event.preventDefault();\n            return;\n        }\n        onSubmit?.(event);\n        if (!onComposerSubmit || event.isDefaultPrevented()) {\n            event.preventDefault();\n            return;\n        }\n        const body = (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_14__.composerBodyToCommentBody)(editor.children);\n        const comment = {\n            body\n        };\n        const promise = onComposerSubmit(comment, event);\n        event.preventDefault();\n        if (promise) {\n            promise.then(onSubmitEnd);\n        } else {\n            onSubmitEnd();\n        }\n    }, [\n        editor,\n        onComposerSubmit,\n        onSubmit,\n        onSubmitEnd\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.ComposerEditorContext.Provider, {\n        value: {\n            editor,\n            validate,\n            setFocused\n        }\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.ComposerContext.Provider, {\n        value: {\n            isFocused,\n            isEmpty: isEmpty$1,\n            submit,\n            clear,\n            select,\n            focus,\n            blur,\n            createMention,\n            insertText: insertText$1\n        }\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        ...props,\n        onSubmit: handleSubmit,\n        ref: mergedRefs\n    }, children)));\n});\nconst ComposerSubmit = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, disabled, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_21__.Slot : \"button\";\n    const { isEmpty } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_11__.useComposer)();\n    const self = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_23__._useSelf)();\n    const isDisabled = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>disabled || isEmpty || !self?.canComment, [\n        disabled,\n        isEmpty,\n        self?.canComment\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        type: \"submit\",\n        ...props,\n        ref: forwardedRef,\n        disabled: isDisabled\n    }, children);\n});\nif (true) {\n    ComposerEditor.displayName = COMPOSER_EDITOR_NAME;\n    ComposerForm.displayName = COMPOSER_FORM_NAME;\n    ComposerMention.displayName = COMPOSER_MENTION_NAME;\n    ComposerLink.displayName = COMPOSER_LINK_NAME;\n    ComposerSubmit.displayName = COMPOSER_SUBMIT_NAME;\n    ComposerSuggestions.displayName = COMPOSER_SUGGESTIONS_NAME;\n    ComposerSuggestionsList.displayName = COMPOSER_SUGGESTIONS_LIST_NAME;\n    ComposerSuggestionsListItem.displayName = COMPOSER_SUGGESTIONS_LIST_ITEM_NAME;\n}\n //# sourceMappingURL=index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0NvbXBvc2VyL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThIQSxNQUFBQSwrQkFBQTtBQUVBLE1BQUFDLHdCQUFBO0FBQ0EsTUFBQUMscUJBQUE7QUFDQSxNQUFBQyw0QkFBQTtBQUNBLE1BQUFDLGlDQUFBO0FBQ0EsTUFBQUMsc0NBQUE7QUFDQSxNQUFBQyx1QkFBQTtBQUNBLE1BQUFDLHVCQUFBO0FBQ0EsTUFBQUMscUJBQUE7QUFFQSxNQUFBQyxtQkFBQTtJQUFzQ0MsU0FBQTtJQUMzQkMsU0FBQTtRQUFBO1lBQUFDLE1BQUE7WUFBQUMsVUFBQTtnQkFBQTtvQkFBQUMsTUFBQTtnQkFBQTthQUFBO1FBQUE7S0FBQTtBQUVYO0FBRUEsU0FBQUM7SUFDRSxPQUFBQyx5RUFBQUEsQ0FBT0MsZ0ZBQUFBLENBQ0xDLDRFQUFBQSxDQUNFQyxzRkFBQUEsQ0FDRUMsbUdBQUFBLENBQ0VDLDRFQUFBQSxDQUFBQywwREFBQUEsQ0FBQUMsc0RBQUFBLENBQUFDLG1EQUFBQTtBQU9WO0FBRUEsU0FBQUMsNkJBQUEsRUFBc0NDLE9BQUEsRUFDcENDLFVBQUEsRUFDQWQsUUFBQSxFQUNBZSxPQUFBLEVBRUY7SUFDRSxNQUFBQyxhQUFBQyx3REFBQUE7SUFFQSxxQ0FBQUMsZ0RBQUE7UUFDRyxHQUFBSixVQUFBO0lBQVMsR0FBQUMsUUFBQUssRUFBQSxpQ0FBQUYsZ0RBQUEsQ0FBQUwsU0FBQTtRQUVMUSxRQUFBTixRQUFBSyxFQUFBO1FBQXdCSjtJQUFJLFdBQUFoQjtBQUtyQztBQUVBLFNBQUFzQiwwQkFBQSxFQUFtQ0MsSUFBQSxFQUNqQ1QsVUFBQSxFQUNBQyxPQUFBLEVBQ0FmLFFBQUEsRUFFRjtJQUNFLE1BQUF3QixPQUFBQyw4Q0FB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QWtHLFdBQUEsR0FBQTVRO0lBQ0E4TyxhQUFBOEIsV0FBQSxHQUFBM1E7SUFDQXlILGdCQUFBa0osV0FBQSxHQUFBbFI7SUFDQXNJLGFBQUE0SSxXQUFBLEdBQUFqUjtJQUNBK1EsZUFBQUUsV0FBQSxHQUFBN1E7SUFDQW9JLG9CQUFBeUksV0FBQSxHQUFBaFI7SUFDQXNKLHdCQUFBMEgsV0FBQSxHQUFBL1E7SUFDQXVKLDRCQUFBd0gsV0FBQSxHQUFBOVE7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uLy4uL3NyYy9wcmltaXRpdmVzL0NvbXBvc2VyL2luZGV4LnRzeD9kZDIyIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgdHlwZSB7XG4gIERldGVjdE92ZXJmbG93T3B0aW9ucyxcbiAgVXNlRmxvYXRpbmdPcHRpb25zLFxufSBmcm9tIFwiQGZsb2F0aW5nLXVpL3JlYWN0LWRvbVwiO1xuaW1wb3J0IHtcbiAgYXV0b1VwZGF0ZSxcbiAgZmxpcCxcbiAgaGlkZSxcbiAgbGltaXRTaGlmdCxcbiAgc2hpZnQsXG4gIHNpemUsXG4gIHVzZUZsb2F0aW5nLFxufSBmcm9tIFwiQGZsb2F0aW5nLXVpL3JlYWN0LWRvbVwiO1xuaW1wb3J0IHR5cGUgeyBDb21tZW50Qm9keSB9IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5pbXBvcnQgeyB1c2VTZWxmIH0gZnJvbSBcIkBsaXZlYmxvY2tzL3JlYWN0XCI7XG5pbXBvcnQgeyBTbG90IH0gZnJvbSBcIkByYWRpeC11aS9yZWFjdC1zbG90XCI7XG5pbXBvcnQgdHlwZSB7XG4gIEFyaWFBdHRyaWJ1dGVzLFxuICBGb2N1c0V2ZW50LFxuICBGb3JtRXZlbnQsXG4gIEtleWJvYXJkRXZlbnQsXG4gIFBvaW50ZXJFdmVudCxcbn0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVhY3QsIHtcbiAgZm9yd2FyZFJlZixcbiAgdXNlQ2FsbGJhY2ssXG4gIHVzZUVmZmVjdCxcbiAgdXNlSW1wZXJhdGl2ZUhhbmRsZSxcbiAgdXNlTWVtbyxcbiAgdXNlUmVmLFxuICB1c2VTdGF0ZSxcbn0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgdHlwZSB7XG4gIERlc2NlbmRhbnQgYXMgU2xhdGVEZXNjZW5kYW50LFxuICBFbGVtZW50IGFzIFNsYXRlRWxlbWVudCxcbn0gZnJvbSBcInNsYXRlXCI7XG5pbXBvcnQge1xuICBjcmVhdGVFZGl0b3IsXG4gIEVkaXRvciBhcyBTbGF0ZUVkaXRvcixcbiAgaW5zZXJ0VGV4dCBhcyBpbnNlcnRTbGF0ZVRleHQsXG4gIFRyYW5zZm9ybXMgYXMgU2xhdGVUcmFuc2Zvcm1zLFxufSBmcm9tIFwic2xhdGVcIjtcbmltcG9ydCB7IHdpdGhIaXN0b3J5IH0gZnJvbSBcInNsYXRlLWhpc3RvcnlcIjtcbmltcG9ydCB0eXBlIHtcbiAgUmVuZGVyRWxlbWVudFByb3BzLFxuICBSZW5kZXJFbGVtZW50U3BlY2lmaWNQcm9wcyxcbiAgUmVuZGVyTGVhZlByb3BzLFxuICBSZW5kZXJQbGFjZWhvbGRlclByb3BzLFxufSBmcm9tIFwic2xhdGUtcmVhY3RcIjtcbmltcG9ydCB7XG4gIEVkaXRhYmxlLFxuICBSZWFjdEVkaXRvcixcbiAgU2xhdGUsXG4gIHVzZVNlbGVjdGVkLFxuICB1c2VTbGF0ZVN0YXRpYyxcbiAgd2l0aFJlYWN0LFxufSBmcm9tIFwic2xhdGUtcmVhY3RcIjtcblxuaW1wb3J0IHsgdXNlTGl2ZWJsb2Nrc1VJQ29uZmlnIH0gZnJvbSBcIi4uLy4uL2NvbmZpZ1wiO1xuaW1wb3J0IHsgRkxPQVRJTkdfRUxFTUVOVF9DT0xMSVNJT05fUEFERElORyB9IGZyb20gXCIuLi8uLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IHVzZU1lbnRpb25TdWdnZXN0aW9ucyB9IGZyb20gXCIuLi8uLi9zaGFyZWRcIjtcbmltcG9ydCB7IHdpdGhBdXRvRm9ybWF0dGluZyB9IGZyb20gXCIuLi8uLi9zbGF0ZS9wbHVnaW5zL2F1dG8tZm9ybWF0dGluZ1wiO1xuaW1wb3J0IHsgd2l0aEF1dG9MaW5rcyB9IGZyb20gXCIuLi8uLi9zbGF0ZS9wbHVnaW5zL2F1dG8tbGlua3NcIjtcbmltcG9ydCB7IHdpdGhDdXN0b21MaW5rcyB9IGZyb20gXCIuLi8uLi9zbGF0ZS9wbHVnaW5zL2N1c3RvbS1saW5rc1wiO1xuaW1wb3J0IHsgd2l0aEVtcHR5Q2xlYXJGb3JtYXR0aW5nIH0gZnJvbSBcIi4uLy4uL3NsYXRlL3BsdWdpbnMvZW1wdHktY2xlYXItZm9ybWF0dGluZ1wiO1xuaW1wb3J0IHR5cGUgeyBNZW50aW9uRHJhZnQgfSBmcm9tIFwiLi4vLi4vc2xhdGUvcGx1Z2lucy9tZW50aW9uc1wiO1xuaW1wb3J0IHtcbiAgZ2V0TWVudGlvbkRyYWZ0QXRTZWxlY3Rpb24sXG4gIGluc2VydE1lbnRpb24sXG4gIGluc2VydE1lbnRpb25DaGFyYWN0ZXIsXG4gIE1FTlRJT05fQ0hBUkFDVEVSLFxuICB3aXRoTWVudGlvbnMsXG59IGZyb20gXCIuLi8uLi9zbGF0ZS9wbHVnaW5zL21lbnRpb25zXCI7XG5pbXBvcnQgeyB3aXRoUGFzdGVIdG1sIH0gZnJvbSBcIi4uLy4uL3NsYXRlL3BsdWdpbnMvcGFzdGUtaHRtbFwiO1xuaW1wb3J0IHsgZ2V0RE9NUmFuZ2UgfSBmcm9tIFwiLi4vLi4vc2xhdGUvdXRpbHMvZ2V0LWRvbS1yYW5nZVwiO1xuaW1wb3J0IHsgaXNFbXB0eSBhcyBpc0VkaXRvckVtcHR5IH0gZnJvbSBcIi4uLy4uL3NsYXRlL3V0aWxzL2lzLWVtcHR5XCI7XG5pbXBvcnQgeyBsZWF2ZU1hcmtFZGdlLCB0b2dnbGVNYXJrIH0gZnJvbSBcIi4uLy4uL3NsYXRlL3V0aWxzL21hcmtzXCI7XG5pbXBvcnQgdHlwZSB7XG4gIENvbXBvc2VyQm9keSBhcyBDb21wb3NlckJvZHlEYXRhLFxuICBDb21wb3NlckJvZHlBdXRvTGluayxcbiAgQ29tcG9zZXJCb2R5Q3VzdG9tTGluayxcbiAgQ29tcG9zZXJCb2R5TWVudGlvbixcbn0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBpc0tleSB9IGZyb20gXCIuLi8uLi91dGlscy9pcy1rZXlcIjtcbmltcG9ydCB7IFBlcnNpc3QsIHVzZUFuaW1hdGlvblBlcnNpc3QsIHVzZVBlcnNpc3QgfSBmcm9tIFwiLi4vLi4vdXRpbHMvUGVyc2lzdFwiO1xuaW1wb3J0IHsgUG9ydGFsIH0gZnJvbSBcIi4uLy4uL3V0aWxzL1BvcnRhbFwiO1xuaW1wb3J0IHsgcmVxdWVzdFN1Ym1pdCB9IGZyb20gXCIuLi8uLi91dGlscy9yZXF1ZXN0LXN1Ym1pdFwiO1xuaW1wb3J0IHsgdXNlSWQgfSBmcm9tIFwiLi4vLi4vdXRpbHMvdXNlLWlkXCI7XG5pbXBvcnQgeyB1c2VJbmRleCB9IGZyb20gXCIuLi8uLi91dGlscy91c2UtaW5kZXhcIjtcbmltcG9ydCB7IHVzZUluaXRpYWwgfSBmcm9tIFwiLi4vLi4vdXRpbHMvdXNlLWluaXRpYWxcIjtcbmltcG9ydCB7IHVzZUxheW91dEVmZmVjdCB9IGZyb20gXCIuLi8uLi91dGlscy91c2UtbGF5b3V0LWVmZmVjdFwiO1xuaW1wb3J0IHsgdXNlUmVmcyB9IGZyb20gXCIuLi8uLi91dGlscy91c2UtcmVmc1wiO1xuaW1wb3J0IHsgdG9BYnNvbHV0ZVVybCB9IGZyb20gXCIuLi9Db21tZW50L3V0aWxzXCI7XG5pbXBvcnQge1xuICBDb21wb3NlckNvbnRleHQsXG4gIENvbXBvc2VyRWRpdG9yQ29udGV4dCxcbiAgQ29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHQsXG4gIHVzZUNvbXBvc2VyLFxuICB1c2VDb21wb3NlckVkaXRvckNvbnRleHQsXG4gIHVzZUNvbXBvc2VyU3VnZ2VzdGlvbnNDb250ZXh0LFxufSBmcm9tIFwiLi9jb250ZXh0c1wiO1xuaW1wb3J0IHR5cGUge1xuICBDb21wb3NlckVkaXRvckNvbXBvbmVudHMsXG4gIENvbXBvc2VyRWRpdG9yRWxlbWVudFByb3BzLFxuICBDb21wb3NlckVkaXRvckxpbmtXcmFwcGVyUHJvcHMsXG4gIENvbXBvc2VyRWRpdG9yTWVudGlvblN1Z2dlc3Rpb25zV3JhcHBlclByb3BzLFxuICBDb21wb3NlckVkaXRvck1lbnRpb25XcmFwcGVyUHJvcHMsXG4gIENvbXBvc2VyRWRpdG9yUHJvcHMsXG4gIENvbXBvc2VyRm9ybVByb3BzLFxuICBDb21wb3NlckxpbmtQcm9wcyxcbiAgQ29tcG9zZXJNZW50aW9uUHJvcHMsXG4gIENvbXBvc2VyU3VibWl0UHJvcHMsXG4gIENvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0SXRlbVByb3BzLFxuICBDb21wb3NlclN1Z2dlc3Rpb25zTGlzdFByb3BzLFxuICBDb21wb3NlclN1Z2dlc3Rpb25zUHJvcHMsXG4gIFN1Z2dlc3Rpb25zUG9zaXRpb24sXG59IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQge1xuICBjb21tZW50Qm9keVRvQ29tcG9zZXJCb2R5LFxuICBjb21wb3NlckJvZHlUb0NvbW1lbnRCb2R5LFxuICBnZXRQbGFjZW1lbnRGcm9tUG9zaXRpb24sXG4gIGdldFNpZGVBbmRBbGlnbkZyb21QbGFjZW1lbnQsXG59IGZyb20gXCIuL3V0aWxzXCI7XG5cbmNvbnN0IE1FTlRJT05fU1VHR0VTVElPTlNfUE9TSVRJT046IFN1Z2dlc3Rpb25zUG9zaXRpb24gPSBcInRvcFwiO1xuXG5jb25zdCBDT01QT1NFUl9NRU5USU9OX05BTUUgPSBcIkNvbXBvc2VyTWVudGlvblwiO1xuY29uc3QgQ09NUE9TRVJfTElOS19OQU1FID0gXCJDb21wb3NlckxpbmtcIjtcbmNvbnN0IENPTVBPU0VSX1NVR0dFU1RJT05TX05BTUUgPSBcIkNvbXBvc2VyU3VnZ2VzdGlvbnNcIjtcbmNvbnN0IENPTVBPU0VSX1NVR0dFU1RJT05TX0xJU1RfTkFNRSA9IFwiQ29tcG9zZXJTdWdnZXN0aW9uc0xpc3RcIjtcbmNvbnN0IENPTVBPU0VSX1NVR0dFU1RJT05TX0xJU1RfSVRFTV9OQU1FID0gXCJDb21wb3NlclN1Z2dlc3Rpb25zTGlzdEl0ZW1cIjtcbmNvbnN0IENPTVBPU0VSX1NVQk1JVF9OQU1FID0gXCJDb21wb3NlclN1Ym1pdFwiO1xuY29uc3QgQ09NUE9TRVJfRURJVE9SX05BTUUgPSBcIkNvbXBvc2VyRWRpdG9yXCI7XG5jb25zdCBDT01QT1NFUl9GT1JNX05BTUUgPSBcIkNvbXBvc2VyRm9ybVwiO1xuXG5jb25zdCBlbXB0eUNvbW1lbnRCb2R5OiBDb21tZW50Qm9keSA9IHtcbiAgdmVyc2lvbjogMSxcbiAgY29udGVudDogW3sgdHlwZTogXCJwYXJhZ3JhcGhcIiwgY2hpbGRyZW46IFt7IHRleHQ6IFwiXCIgfV0gfV0sXG59O1xuXG5mdW5jdGlvbiBjcmVhdGVDb21wb3NlckVkaXRvcigpIHtcbiAgcmV0dXJuIHdpdGhNZW50aW9ucyhcbiAgICB3aXRoQ3VzdG9tTGlua3MoXG4gICAgICB3aXRoQXV0b0xpbmtzKFxuICAgICAgICB3aXRoQXV0b0Zvcm1hdHRpbmcoXG4gICAgICAgICAgd2l0aEVtcHR5Q2xlYXJGb3JtYXR0aW5nKFxuICAgICAgICAgICAgd2l0aFBhc3RlSHRtbCh3aXRoSGlzdG9yeSh3aXRoUmVhY3QoY3JlYXRlRWRpdG9yKCkpKSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG59XG5cbmZ1bmN0aW9uIENvbXBvc2VyRWRpdG9yTWVudGlvbldyYXBwZXIoe1xuICBNZW50aW9uLFxuICBhdHRyaWJ1dGVzLFxuICBjaGlsZHJlbixcbiAgZWxlbWVudCxcbn06IENvbXBvc2VyRWRpdG9yTWVudGlvbldyYXBwZXJQcm9wcykge1xuICBjb25zdCBpc1NlbGVjdGVkID0gdXNlU2VsZWN0ZWQoKTtcblxuICByZXR1cm4gKFxuICAgIDxzcGFuIHsuLi5hdHRyaWJ1dGVzfT5cbiAgICAgIHtlbGVtZW50LmlkID8gKFxuICAgICAgICA8TWVudGlvbiB1c2VySWQ9e2VsZW1lbnQuaWR9IGlzU2VsZWN0ZWQ9e2lzU2VsZWN0ZWR9IC8+XG4gICAgICApIDogbnVsbH1cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L3NwYW4+XG4gICk7XG59XG5cbmZ1bmN0aW9uIENvbXBvc2VyRWRpdG9yTGlua1dyYXBwZXIoe1xuICBMaW5rLFxuICBhdHRyaWJ1dGVzLFxuICBlbGVtZW50LFxuICBjaGlsZHJlbixcbn06IENvbXBvc2VyRWRpdG9yTGlua1dyYXBwZXJQcm9wcykge1xuICBjb25zdCBocmVmID0gdXNlTWVtbyhcbiAgICAoKSA9PiB0b0Fic29sdXRlVXJsKGVsZW1lbnQudXJsKSA/PyBlbGVtZW50LnVybCxcbiAgICBbZWxlbWVudC51cmxdXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8c3BhbiB7Li4uYXR0cmlidXRlc30+XG4gICAgICA8TGluayBocmVmPXtocmVmfT57Y2hpbGRyZW59PC9MaW5rPlxuICAgIDwvc3Bhbj5cbiAgKTtcbn1cblxuZnVuY3Rpb24gQ29tcG9zZXJFZGl0b3JNZW50aW9uU3VnZ2VzdGlvbnNXcmFwcGVyKHtcbiAgaWQsXG4gIGl0ZW1JZCxcbiAgdXNlcklkcyxcbiAgc2VsZWN0ZWRVc2VySWQsXG4gIHNldFNlbGVjdGVkVXNlcklkLFxuICBtZW50aW9uRHJhZnQsXG4gIG9uSXRlbVNlbGVjdCxcbiAgcG9zaXRpb24gPSBNRU5USU9OX1NVR0dFU1RJT05TX1BPU0lUSU9OLFxuICBkaXIsXG4gIE1lbnRpb25TdWdnZXN0aW9ucyxcbn06IENvbXBvc2VyRWRpdG9yTWVudGlvblN1Z2dlc3Rpb25zV3JhcHBlclByb3BzKSB7XG4gIGNvbnN0IGVkaXRvciA9IHVzZVNsYXRlU3RhdGljKCk7XG4gIGNvbnN0IHsgaXNGb2N1c2VkIH0gPSB1c2VDb21wb3NlcigpO1xuICBjb25zdCBbY29udGVudCwgc2V0Q29udGVudF0gPSB1c2VTdGF0ZTxIVE1MRGl2RWxlbWVudCB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbY29udGVudFpJbmRleCwgc2V0Q29udGVudFpJbmRleF0gPSB1c2VTdGF0ZTxzdHJpbmc+KCk7XG4gIGNvbnN0IGNvbnRlbnRSZWYgPSB1c2VDYWxsYmFjayhzZXRDb250ZW50LCBbc2V0Q29udGVudF0pO1xuICBjb25zdCB7IHBvcnRhbENvbnRhaW5lciB9ID0gdXNlTGl2ZWJsb2Nrc1VJQ29uZmlnKCk7XG4gIGNvbnN0IGZsb2F0aW5nT3B0aW9uczogVXNlRmxvYXRpbmdPcHRpb25zID0gdXNlTWVtbygoKSA9PiB7XG4gICAgY29uc3QgZGV0ZWN0T3ZlcmZsb3dPcHRpb25zOiBEZXRlY3RPdmVyZmxvd09wdGlvbnMgPSB7XG4gICAgICBwYWRkaW5nOiBGTE9BVElOR19FTEVNRU5UX0NPTExJU0lPTl9QQURESU5HLFxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3RyYXRlZ3k6IFwiZml4ZWRcIixcbiAgICAgIHBsYWNlbWVudDogZ2V0UGxhY2VtZW50RnJvbVBvc2l0aW9uKHBvc2l0aW9uLCBkaXIpLFxuICAgICAgbWlkZGxld2FyZTogW1xuICAgICAgICBmbGlwKHsgLi4uZGV0ZWN0T3ZlcmZsb3dPcHRpb25zLCBjcm9zc0F4aXM6IGZhbHNlIH0pLFxuICAgICAgICBoaWRlKGRldGVjdE92ZXJmbG93T3B0aW9ucyksXG4gICAgICAgIHNoaWZ0KHtcbiAgICAgICAgICAuLi5kZXRlY3RPdmVyZmxvd09wdGlvbnMsXG4gICAgICAgICAgbGltaXRlcjogbGltaXRTaGlmdCgpLFxuICAgICAgICB9KSxcbiAgICAgICAgc2l6ZSh7XG4gICAgICAgICAgLi4uZGV0ZWN0T3ZlcmZsb3dPcHRpb25zLFxuICAgICAgICAgIGFwcGx5KHsgYXZhaWxhYmxlV2lkdGgsIGF2YWlsYWJsZUhlaWdodCwgZWxlbWVudHMgfSkge1xuICAgICAgICAgICAgZWxlbWVudHMuZmxvYXRpbmcuc3R5bGUuc2V0UHJvcGVydHkoXG4gICAgICAgICAgICAgIFwiLS1sYi1jb21wb3Nlci1zdWdnZXN0aW9ucy1hdmFpbGFibGUtd2lkdGhcIixcbiAgICAgICAgICAgICAgYCR7YXZhaWxhYmxlV2lkdGh9cHhgXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgZWxlbWVudHMuZmxvYXRpbmcuc3R5bGUuc2V0UHJvcGVydHkoXG4gICAgICAgICAgICAgIFwiLS1sYi1jb21wb3Nlci1zdWdnZXN0aW9ucy1hdmFpbGFibGUtaGVpZ2h0XCIsXG4gICAgICAgICAgICAgIGAke2F2YWlsYWJsZUhlaWdodH1weGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgICAgd2hpbGVFbGVtZW50c01vdW50ZWQ6IGF1dG9VcGRhdGUsXG4gICAgfTtcbiAgfSwgW3Bvc2l0aW9uLCBkaXJdKTtcbiAgY29uc3Qge1xuICAgIHJlZnM6IHsgc2V0UmVmZXJlbmNlLCBzZXRGbG9hdGluZyB9LFxuICAgIHN0cmF0ZWd5LFxuICAgIGlzUG9zaXRpb25lZCxcbiAgICBwbGFjZW1lbnQsXG4gICAgeCxcbiAgICB5LFxuICB9ID0gdXNlRmxvYXRpbmcoZmxvYXRpbmdPcHRpb25zKTtcblxuICAvLyBDb3B5IGB6LWluZGV4YCBmcm9tIGNvbnRlbnQgdG8gd3JhcHBlci5cbiAgLy8gSW5zcGlyZWQgYnkgaHR0cHM6Ly9naXRodWIuY29tL3JhZGl4LXVpL3ByaW1pdGl2ZXMvYmxvYi9tYWluL3BhY2thZ2VzL3JlYWN0L3BvcHBlci9zcmMvUG9wcGVyLnRzeFxuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChjb250ZW50KSB7XG4gICAgICBzZXRDb250ZW50WkluZGV4KHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGNvbnRlbnQpLnpJbmRleCk7XG4gICAgfVxuICB9LCBbY29udGVudF0pO1xuXG4gIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFtZW50aW9uRHJhZnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBkb21SYW5nZSA9IGdldERPTVJhbmdlKGVkaXRvciwgbWVudGlvbkRyYWZ0LnJhbmdlKTtcblxuICAgIGlmIChkb21SYW5nZSkge1xuICAgICAgc2V0UmVmZXJlbmNlKHtcbiAgICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0OiAoKSA9PiBkb21SYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgZ2V0Q2xpZW50UmVjdHM6ICgpID0+IGRvbVJhbmdlLmdldENsaWVudFJlY3RzKCksXG4gICAgICB9KTtcbiAgICB9XG4gIH0sIFtzZXRSZWZlcmVuY2UsIGVkaXRvciwgbWVudGlvbkRyYWZ0XSk7XG5cbiAgcmV0dXJuIChcbiAgICA8UGVyc2lzdD5cbiAgICAgIHttZW50aW9uRHJhZnQ/LnJhbmdlICYmIGlzRm9jdXNlZCAmJiB1c2VySWRzID8gKFxuICAgICAgICA8Q29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHQuUHJvdmlkZXJcbiAgICAgICAgICB2YWx1ZT17e1xuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBpdGVtSWQsXG4gICAgICAgICAgICBzZWxlY3RlZFZhbHVlOiBzZWxlY3RlZFVzZXJJZCxcbiAgICAgICAgICAgIHNldFNlbGVjdGVkVmFsdWU6IHNldFNlbGVjdGVkVXNlcklkLFxuICAgICAgICAgICAgb25JdGVtU2VsZWN0LFxuICAgICAgICAgICAgcGxhY2VtZW50LFxuICAgICAgICAgICAgZGlyLFxuICAgICAgICAgICAgcmVmOiBjb250ZW50UmVmLFxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICA8UG9ydGFsXG4gICAgICAgICAgICByZWY9e3NldEZsb2F0aW5nfVxuICAgICAgICAgICAgY29udGFpbmVyPXtwb3J0YWxDb250YWluZXJ9XG4gICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICBwb3NpdGlvbjogc3RyYXRlZ3ksXG4gICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgdHJhbnNmb3JtOiBpc1Bvc2l0aW9uZWRcbiAgICAgICAgICAgICAgICA/IGB0cmFuc2xhdGUzZCgke01hdGgucm91bmQoeCl9cHgsICR7TWF0aC5yb3VuZCh5KX1weCwgMClgXG4gICAgICAgICAgICAgICAgOiBcInRyYW5zbGF0ZTNkKDAsIC0yMDAlLCAwKVwiLFxuICAgICAgICAgICAgICBtaW5XaWR0aDogXCJtYXgtY29udGVudFwiLFxuICAgICAgICAgICAgICB6SW5kZXg6IGNvbnRlbnRaSW5kZXgsXG4gICAgICAgICAgICB9fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxNZW50aW9uU3VnZ2VzdGlvbnNcbiAgICAgICAgICAgICAgdXNlcklkcz17dXNlcklkc31cbiAgICAgICAgICAgICAgc2VsZWN0ZWRVc2VySWQ9e3NlbGVjdGVkVXNlcklkfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L1BvcnRhbD5cbiAgICAgICAgPC9Db21wb3NlclN1Z2dlc3Rpb25zQ29udGV4dC5Qcm92aWRlcj5cbiAgICAgICkgOiBudWxsfVxuICAgIDwvUGVyc2lzdD5cbiAgKTtcbn1cblxuZnVuY3Rpb24gQ29tcG9zZXJFZGl0b3JFbGVtZW50KHtcbiAgTWVudGlvbixcbiAgTGluayxcbiAgLi4ucHJvcHNcbn06IENvbXBvc2VyRWRpdG9yRWxlbWVudFByb3BzKSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFzc2lnbm1lbnRcbiAgY29uc3QgeyBhdHRyaWJ1dGVzLCBjaGlsZHJlbiwgZWxlbWVudCB9ID0gcHJvcHM7XG5cbiAgc3dpdGNoIChlbGVtZW50LnR5cGUpIHtcbiAgICBjYXNlIFwibWVudGlvblwiOlxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPENvbXBvc2VyRWRpdG9yTWVudGlvbldyYXBwZXJcbiAgICAgICAgICBNZW50aW9uPXtNZW50aW9ufVxuICAgICAgICAgIHsuLi4ocHJvcHMgYXMgUmVuZGVyRWxlbWVudFNwZWNpZmljUHJvcHM8Q29tcG9zZXJCb2R5TWVudGlvbj4pfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICBjYXNlIFwiYXV0by1saW5rXCI6XG4gICAgY2FzZSBcImN1c3RvbS1saW5rXCI6XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Q29tcG9zZXJFZGl0b3JMaW5rV3JhcHBlclxuICAgICAgICAgIExpbms9e0xpbmt9XG4gICAgICAgICAgey4uLihwcm9wcyBhcyBSZW5kZXJFbGVtZW50U3BlY2lmaWNQcm9wczxcbiAgICAgICAgICAgIENvbXBvc2VyQm9keUF1dG9MaW5rIHwgQ29tcG9zZXJCb2R5Q3VzdG9tTGlua1xuICAgICAgICAgID4pfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICBjYXNlIFwicGFyYWdyYXBoXCI6XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8cCB7Li4uYXR0cmlidXRlc30gc3R5bGU9e3sgcG9zaXRpb246IFwicmVsYXRpdmVcIiB9fT5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvcD5cbiAgICAgICk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIDxjb2RlPjxzPjxlbT48c3Ryb25nPnRleHQ8L3N0cm9uZz48L3M+PC9lbT48L2NvZGU+XG5mdW5jdGlvbiBDb21wb3NlckVkaXRvckxlYWYoeyBhdHRyaWJ1dGVzLCBjaGlsZHJlbiwgbGVhZiB9OiBSZW5kZXJMZWFmUHJvcHMpIHtcbiAgaWYgKGxlYWYuYm9sZCkge1xuICAgIGNoaWxkcmVuID0gPHN0cm9uZz57Y2hpbGRyZW59PC9zdHJvbmc+O1xuICB9XG5cbiAgaWYgKGxlYWYuaXRhbGljKSB7XG4gICAgY2hpbGRyZW4gPSA8ZW0+e2NoaWxkcmVufTwvZW0+O1xuICB9XG5cbiAgaWYgKGxlYWYuc3RyaWtldGhyb3VnaCkge1xuICAgIGNoaWxkcmVuID0gPHM+e2NoaWxkcmVufTwvcz47XG4gIH1cblxuICBpZiAobGVhZi5jb2RlKSB7XG4gICAgY2hpbGRyZW4gPSA8Y29kZT57Y2hpbGRyZW59PC9jb2RlPjtcbiAgfVxuXG4gIHJldHVybiA8c3BhbiB7Li4uYXR0cmlidXRlc30+e2NoaWxkcmVufTwvc3Bhbj47XG59XG5cbmZ1bmN0aW9uIENvbXBvc2VyRWRpdG9yUGxhY2Vob2xkZXIoe1xuICBhdHRyaWJ1dGVzLFxuICBjaGlsZHJlbixcbn06IFJlbmRlclBsYWNlaG9sZGVyUHJvcHMpIHtcbiAgY29uc3QgeyBvcGFjaXR5OiBfb3BhY2l0eSwgLi4uc3R5bGUgfSA9IGF0dHJpYnV0ZXMuc3R5bGU7XG5cbiAgcmV0dXJuIChcbiAgICA8c3BhbiB7Li4uYXR0cmlidXRlc30gc3R5bGU9e3N0eWxlfSBkYXRhLXBsYWNlaG9sZGVyPVwiXCI+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9zcGFuPlxuICApO1xufVxuXG4vKipcbiAqIERpc3BsYXlzIG1lbnRpb25zIHdpdGhpbiBgQ29tcG9zZXIuRWRpdG9yYC5cbiAqXG4gKiBAZXhhbXBsZVxuICogPENvbXBvc2VyLk1lbnRpb24+QHt1c2VySWR9PC9Db21wb3Nlci5NZW50aW9uPlxuICovXG5jb25zdCBDb21wb3Nlck1lbnRpb24gPSBmb3J3YXJkUmVmPEhUTUxTcGFuRWxlbWVudCwgQ29tcG9zZXJNZW50aW9uUHJvcHM+KFxuICAoeyBjaGlsZHJlbiwgYXNDaGlsZCwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcInNwYW5cIjtcbiAgICBjb25zdCBpc1NlbGVjdGVkID0gdXNlU2VsZWN0ZWQoKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Q29tcG9uZW50XG4gICAgICAgIGRhdGEtc2VsZWN0ZWQ9e2lzU2VsZWN0ZWQgfHwgdW5kZWZpbmVkfVxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgPlxuICAgICAgICB7Y2hpbGRyZW59XG4gICAgICA8L0NvbXBvbmVudD5cbiAgICApO1xuICB9XG4pO1xuXG4vKipcbiAqIERpc3BsYXlzIGxpbmtzIHdpdGhpbiBgQ29tcG9zZXIuRWRpdG9yYC5cbiAqXG4gKiBAZXhhbXBsZVxuICogPENvbXBvc2VyLkxpbmsgaHJlZj17aHJlZn0+e2NoaWxkcmVufTwvQ29tcG9zZXIuTGluaz5cbiAqL1xuY29uc3QgQ29tcG9zZXJMaW5rID0gZm9yd2FyZFJlZjxIVE1MQW5jaG9yRWxlbWVudCwgQ29tcG9zZXJMaW5rUHJvcHM+KFxuICAoeyBjaGlsZHJlbiwgYXNDaGlsZCwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcImFcIjtcblxuICAgIHJldHVybiAoXG4gICAgICA8Q29tcG9uZW50XG4gICAgICAgIHRhcmdldD1cIl9ibGFua1wiXG4gICAgICAgIHJlbD1cIm5vb3BlbmVyIG5vcmVmZXJyZXIgbm9mb2xsb3dcIlxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgPlxuICAgICAgICB7Y2hpbGRyZW59XG4gICAgICA8L0NvbXBvbmVudD5cbiAgICApO1xuICB9XG4pO1xuXG4vKipcbiAqIENvbnRhaW5zIHN1Z2dlc3Rpb25zIHdpdGhpbiBgQ29tcG9zZXIuRWRpdG9yYC5cbiAqL1xuY29uc3QgQ29tcG9zZXJTdWdnZXN0aW9ucyA9IGZvcndhcmRSZWY8XG4gIEhUTUxEaXZFbGVtZW50LFxuICBDb21wb3NlclN1Z2dlc3Rpb25zUHJvcHNcbj4oKHsgY2hpbGRyZW4sIHN0eWxlLCBhc0NoaWxkLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgY29uc3QgW2lzUHJlc2VudF0gPSB1c2VQZXJzaXN0KCk7XG4gIGNvbnN0IHJlZiA9IHVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IHtcbiAgICByZWY6IGNvbnRlbnRSZWYsXG4gICAgcGxhY2VtZW50LFxuICAgIGRpcixcbiAgfSA9IHVzZUNvbXBvc2VyU3VnZ2VzdGlvbnNDb250ZXh0KENPTVBPU0VSX1NVR0dFU1RJT05TX05BTUUpO1xuICBjb25zdCBtZXJnZWRSZWZzID0gdXNlUmVmcyhmb3J3YXJkZWRSZWYsIGNvbnRlbnRSZWYsIHJlZik7XG4gIGNvbnN0IFtzaWRlLCBhbGlnbl0gPSB1c2VNZW1vKFxuICAgICgpID0+IGdldFNpZGVBbmRBbGlnbkZyb21QbGFjZW1lbnQocGxhY2VtZW50KSxcbiAgICBbcGxhY2VtZW50XVxuICApO1xuICBjb25zdCBDb21wb25lbnQgPSBhc0NoaWxkID8gU2xvdCA6IFwiZGl2XCI7XG4gIHVzZUFuaW1hdGlvblBlcnNpc3QocmVmKTtcblxuICByZXR1cm4gKFxuICAgIDxDb21wb25lbnRcbiAgICAgIGRpcj17ZGlyfVxuICAgICAgey4uLnByb3BzfVxuICAgICAgZGF0YS1zdGF0ZT17aXNQcmVzZW50ID8gXCJvcGVuXCIgOiBcImNsb3NlZFwifVxuICAgICAgZGF0YS1zaWRlPXtzaWRlfVxuICAgICAgZGF0YS1hbGlnbj17YWxpZ259XG4gICAgICBzdHlsZT17e1xuICAgICAgICBkaXNwbGF5OiBcImZsZXhcIixcbiAgICAgICAgZmxleERpcmVjdGlvbjogXCJjb2x1bW5cIixcbiAgICAgICAgbWF4SGVpZ2h0OiBcInZhcigtLWxiLWNvbXBvc2VyLXN1Z2dlc3Rpb25zLWF2YWlsYWJsZS1oZWlnaHQpXCIsXG4gICAgICAgIG92ZXJmbG93WTogXCJhdXRvXCIsXG4gICAgICAgIC4uLnN0eWxlLFxuICAgICAgfX1cbiAgICAgIHJlZj17bWVyZ2VkUmVmc31cbiAgICA+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9Db21wb25lbnQ+XG4gICk7XG59KTtcblxuLyoqXG4gKiBEaXNwbGF5cyBhIGxpc3Qgb2Ygc3VnZ2VzdGlvbnMgd2l0aGluIGBDb21wb3Nlci5FZGl0b3JgLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8Q29tcG9zZXIuU3VnZ2VzdGlvbnNMaXN0PlxuICogICB7dXNlcklkcy5tYXAoKHVzZXJJZCkgPT4gKFxuICogICAgIDxDb21wb3Nlci5TdWdnZXN0aW9uc0xpc3RJdGVtIGtleT17dXNlcklkfSB2YWx1ZT17dXNlcklkfT5cbiAqICAgICAgIEB7dXNlcklkfVxuICogICAgIDwvQ29tcG9zZXIuU3VnZ2VzdGlvbnNMaXN0SXRlbT5cbiAqICAgKSl9XG4gKiA8L0NvbXBvc2VyLlN1Z2dlc3Rpb25zTGlzdD5cbiAqL1xuY29uc3QgQ29tcG9zZXJTdWdnZXN0aW9uc0xpc3QgPSBmb3J3YXJkUmVmPFxuICBIVE1MVUxpc3RFbGVtZW50LFxuICBDb21wb3NlclN1Z2dlc3Rpb25zTGlzdFByb3BzXG4+KCh7IGNoaWxkcmVuLCBhc0NoaWxkLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgY29uc3QgeyBpZCB9ID0gdXNlQ29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHQoQ09NUE9TRVJfU1VHR0VTVElPTlNfTElTVF9OQU1FKTtcbiAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcInVsXCI7XG5cbiAgcmV0dXJuIChcbiAgICA8Q29tcG9uZW50XG4gICAgICByb2xlPVwibGlzdGJveFwiXG4gICAgICBpZD17aWR9XG4gICAgICBhcmlhLWxhYmVsPVwiU3VnZ2VzdGlvbnMgbGlzdFwiXG4gICAgICB7Li4ucHJvcHN9XG4gICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICA+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9Db21wb25lbnQ+XG4gICk7XG59KTtcblxuLyoqXG4gKiBEaXNwbGF5cyBhIHN1Z2dlc3Rpb24gd2l0aGluIGBDb21wb3Nlci5TdWdnZXN0aW9uc0xpc3RgLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8Q29tcG9zZXIuU3VnZ2VzdGlvbnNMaXN0SXRlbSBrZXk9e3VzZXJJZH0gdmFsdWU9e3VzZXJJZH0+XG4gKiAgIEB7dXNlcklkfVxuICogPC9Db21wb3Nlci5TdWdnZXN0aW9uc0xpc3RJdGVtPlxuICovXG5jb25zdCBDb21wb3NlclN1Z2dlc3Rpb25zTGlzdEl0ZW0gPSBmb3J3YXJkUmVmPFxuICBIVE1MTElFbGVtZW50LFxuICBDb21wb3NlclN1Z2dlc3Rpb25zTGlzdEl0ZW1Qcm9wc1xuPihcbiAgKFxuICAgIHsgdmFsdWUsIGNoaWxkcmVuLCBvblBvaW50ZXJNb3ZlLCBvblBvaW50ZXJEb3duLCBhc0NoaWxkLCAuLi5wcm9wcyB9LFxuICAgIGZvcndhcmRlZFJlZlxuICApID0+IHtcbiAgICBjb25zdCByZWYgPSB1c2VSZWY8SFRNTExJRWxlbWVudD4obnVsbCk7XG4gICAgY29uc3QgbWVyZ2VkUmVmcyA9IHVzZVJlZnMoZm9yd2FyZGVkUmVmLCByZWYpO1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRWYWx1ZSwgc2V0U2VsZWN0ZWRWYWx1ZSwgaXRlbUlkLCBvbkl0ZW1TZWxlY3QgfSA9XG4gICAgICB1c2VDb21wb3NlclN1Z2dlc3Rpb25zQ29udGV4dChDT01QT1NFUl9TVUdHRVNUSU9OU19MSVNUX0lURU1fTkFNRSk7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcImxpXCI7XG4gICAgY29uc3QgaXNTZWxlY3RlZCA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBzZWxlY3RlZFZhbHVlID09PSB2YWx1ZSxcbiAgICAgIFtzZWxlY3RlZFZhbHVlLCB2YWx1ZV1cbiAgICApO1xuICAgIC8vIFRPRE86IFN1cHBvcnQgcHJvcHMuaWQgaWYgcHJvdmlkZWQsIGl0IHdpbGwgbmVlZCB0byBiZSBzZW50IHVwIHRvIENvbXBvc2VyLkVkaXRvciB0byB1c2UgaXQgaW4gYXJpYS1hY3RpdmVkZXNjZW5kYW50XG4gICAgY29uc3QgaWQgPSB1c2VNZW1vKCgpID0+IGl0ZW1JZCh2YWx1ZSksIFtpdGVtSWQsIHZhbHVlXSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKHJlZj8uY3VycmVudCAmJiBpc1NlbGVjdGVkKSB7XG4gICAgICAgIHJlZi5jdXJyZW50LnNjcm9sbEludG9WaWV3KHsgYmxvY2s6IFwibmVhcmVzdFwiIH0pO1xuICAgICAgfVxuICAgIH0sIFtpc1NlbGVjdGVkXSk7XG5cbiAgICBjb25zdCBoYW5kbGVQb2ludGVyTW92ZSA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGV2ZW50OiBQb2ludGVyRXZlbnQ8SFRNTExJRWxlbWVudD4pID0+IHtcbiAgICAgICAgb25Qb2ludGVyTW92ZT8uKGV2ZW50KTtcblxuICAgICAgICBpZiAoIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgc2V0U2VsZWN0ZWRWYWx1ZSh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbb25Qb2ludGVyTW92ZSwgc2V0U2VsZWN0ZWRWYWx1ZSwgdmFsdWVdXG4gICAgKTtcblxuICAgIGNvbnN0IGhhbmRsZVBvaW50ZXJEb3duID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZXZlbnQ6IFBvaW50ZXJFdmVudDxIVE1MTElFbGVtZW50PikgPT4ge1xuICAgICAgICBvblBvaW50ZXJEb3duPy4oZXZlbnQpO1xuXG4gICAgICAgIGlmICghZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cbiAgICAgICAgICBpZiAodGFyZ2V0Lmhhc1BvaW50ZXJDYXB0dXJlKGV2ZW50LnBvaW50ZXJJZCkpIHtcbiAgICAgICAgICAgIHRhcmdldC5yZWxlYXNlUG9pbnRlckNhcHR1cmUoZXZlbnQucG9pbnRlcklkKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09PSAwICYmIGV2ZW50LmN0cmxLZXkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBvbkl0ZW1TZWxlY3QodmFsdWUpO1xuXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtvbkl0ZW1TZWxlY3QsIG9uUG9pbnRlckRvd24sIHZhbHVlXVxuICAgICk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbXBvbmVudFxuICAgICAgICByb2xlPVwib3B0aW9uXCJcbiAgICAgICAgaWQ9e2lkfVxuICAgICAgICBkYXRhLXNlbGVjdGVkPXtpc1NlbGVjdGVkIHx8IHVuZGVmaW5lZH1cbiAgICAgICAgYXJpYS1zZWxlY3RlZD17aXNTZWxlY3RlZCB8fCB1bmRlZmluZWR9XG4gICAgICAgIG9uUG9pbnRlck1vdmU9e2hhbmRsZVBvaW50ZXJNb3ZlfVxuICAgICAgICBvblBvaW50ZXJEb3duPXtoYW5kbGVQb2ludGVyRG93bn1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICByZWY9e21lcmdlZFJlZnN9XG4gICAgICA+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvQ29tcG9uZW50PlxuICAgICk7XG4gIH1cbik7XG5cbmNvbnN0IGRlZmF1bHRFZGl0b3JDb21wb25lbnRzOiBDb21wb3NlckVkaXRvckNvbXBvbmVudHMgPSB7XG4gIExpbms6ICh7IGhyZWYsIGNoaWxkcmVuIH0pID0+IHtcbiAgICByZXR1cm4gPENvbXBvc2VyTGluayBocmVmPXtocmVmfT57Y2hpbGRyZW59PC9Db21wb3Nlckxpbms+O1xuICB9LFxuICBNZW50aW9uOiAoeyB1c2VySWQgfSkgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICA8Q29tcG9zZXJNZW50aW9uPlxuICAgICAgICB7TUVOVElPTl9DSEFSQUNURVJ9XG4gICAgICAgIHt1c2VySWR9XG4gICAgICA8L0NvbXBvc2VyTWVudGlvbj5cbiAgICApO1xuICB9LFxuICBNZW50aW9uU3VnZ2VzdGlvbnM6ICh7IHVzZXJJZHMgfSkgPT4ge1xuICAgIHJldHVybiB1c2VySWRzLmxlbmd0aCA+IDAgPyAoXG4gICAgICA8Q29tcG9zZXJTdWdnZXN0aW9ucz5cbiAgICAgICAgPENvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0PlxuICAgICAgICAgIHt1c2VySWRzLm1hcCgodXNlcklkKSA9PiAoXG4gICAgICAgICAgICA8Q29tcG9zZXJTdWdnZXN0aW9uc0xpc3RJdGVtIGtleT17dXNlcklkfSB2YWx1ZT17dXNlcklkfT5cbiAgICAgICAgICAgICAge3VzZXJJZH1cbiAgICAgICAgICAgIDwvQ29tcG9zZXJTdWdnZXN0aW9uc0xpc3RJdGVtPlxuICAgICAgICAgICkpfVxuICAgICAgICA8L0NvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0PlxuICAgICAgPC9Db21wb3NlclN1Z2dlc3Rpb25zPlxuICAgICkgOiBudWxsO1xuICB9LFxufTtcblxuLyoqXG4gKiBEaXNwbGF5cyB0aGUgY29tcG9zZXIncyBlZGl0b3IuXG4gKlxuICogQGV4YW1wbGVcbiAqIDxDb21wb3Nlci5FZGl0b3IgcGxhY2Vob2xkZXI9XCJXcml0ZSBhIGNvbW1lbnTigKZcIiAvPlxuICovXG5jb25zdCBDb21wb3NlckVkaXRvciA9IGZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIENvbXBvc2VyRWRpdG9yUHJvcHM+KFxuICAoXG4gICAge1xuICAgICAgZGVmYXVsdFZhbHVlLFxuICAgICAgb25LZXlEb3duLFxuICAgICAgb25Gb2N1cyxcbiAgICAgIG9uQmx1cixcbiAgICAgIGRpc2FibGVkLFxuICAgICAgYXV0b0ZvY3VzLFxuICAgICAgY29tcG9uZW50cyxcbiAgICAgIGRpcixcbiAgICAgIC4uLnByb3BzXG4gICAgfSxcbiAgICBmb3J3YXJkZWRSZWZcbiAgKSA9PiB7XG4gICAgY29uc3Qgc2VsZiA9IHVzZVNlbGYoKTtcbiAgICBjb25zdCBpc0Rpc2FibGVkID0gdXNlTWVtbyhcbiAgICAgICgpID0+IGRpc2FibGVkIHx8ICFzZWxmPy5jYW5Db21tZW50LFxuICAgICAgW2Rpc2FibGVkLCBzZWxmPy5jYW5Db21tZW50XVxuICAgICk7XG4gICAgY29uc3QgeyBlZGl0b3IsIHZhbGlkYXRlLCBzZXRGb2N1c2VkIH0gPSB1c2VDb21wb3NlckVkaXRvckNvbnRleHQoKTtcbiAgICBjb25zdCB7IHN1Ym1pdCwgZm9jdXMsIHNlbGVjdCwgaXNFbXB0eSwgaXNGb2N1c2VkIH0gPSB1c2VDb21wb3NlcigpO1xuICAgIGNvbnN0IGluaXRpYWxCb2R5ID0gdXNlSW5pdGlhbChkZWZhdWx0VmFsdWUgPz8gZW1wdHlDb21tZW50Qm9keSk7XG4gICAgY29uc3QgaW5pdGlhbEVkaXRvclZhbHVlID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICByZXR1cm4gY29tbWVudEJvZHlUb0NvbXBvc2VyQm9keShpbml0aWFsQm9keSk7XG4gICAgfSwgW2luaXRpYWxCb2R5XSk7XG4gICAgY29uc3QgeyBMaW5rLCBNZW50aW9uLCBNZW50aW9uU3VnZ2VzdGlvbnMgfSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiAoeyAuLi5kZWZhdWx0RWRpdG9yQ29tcG9uZW50cywgLi4uY29tcG9uZW50cyB9KSxcbiAgICAgIFtjb21wb25lbnRzXVxuICAgICk7XG5cbiAgICBjb25zdCBbbWVudGlvbkRyYWZ0LCBzZXRNZW50aW9uRHJhZnRdID0gdXNlU3RhdGU8TWVudGlvbkRyYWZ0PigpO1xuICAgIGNvbnN0IG1lbnRpb25TdWdnZXN0aW9ucyA9IHVzZU1lbnRpb25TdWdnZXN0aW9ucyhtZW50aW9uRHJhZnQ/LnRleHQpO1xuICAgIGNvbnN0IFtcbiAgICAgIHNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCxcbiAgICAgIHNldFByZXZpb3VzU2VsZWN0ZWRNZW50aW9uU3VnZ2VzdGlvbkluZGV4LFxuICAgICAgc2V0TmV4dFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCxcbiAgICAgIHNldFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCxcbiAgICBdID0gdXNlSW5kZXgoMCwgbWVudGlvblN1Z2dlc3Rpb25zPy5sZW5ndGggPz8gMCk7XG4gICAgY29uc3QgaWQgPSB1c2VJZCgpO1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zTGlzdElkID0gdXNlTWVtbyhcbiAgICAgICgpID0+IGBsaXZlYmxvY2tzLXN1Z2dlc3Rpb25zLWxpc3QtJHtpZH1gLFxuICAgICAgW2lkXVxuICAgICk7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbnNMaXN0SXRlbUlkID0gdXNlQ2FsbGJhY2soXG4gICAgICAodXNlcklkPzogc3RyaW5nKSA9PlxuICAgICAgICB1c2VySWQgPyBgbGl2ZWJsb2Nrcy1zdWdnZXN0aW9ucy1saXN0LWl0ZW0tJHtpZH0tJHt1c2VySWR9YCA6IHVuZGVmaW5lZCxcbiAgICAgIFtpZF1cbiAgICApO1xuICAgIGNvbnN0IHJlbmRlckVsZW1lbnQgPSB1c2VDYWxsYmFjayhcbiAgICAgIChwcm9wczogUmVuZGVyRWxlbWVudFByb3BzKSA9PiB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPENvbXBvc2VyRWRpdG9yRWxlbWVudCBNZW50aW9uPXtNZW50aW9ufSBMaW5rPXtMaW5rfSB7Li4ucHJvcHN9IC8+XG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgW0xpbmssIE1lbnRpb25dXG4gICAgKTtcblxuICAgIGNvbnN0IGhhbmRsZUNoYW5nZSA9IHVzZUNhbGxiYWNrKFxuICAgICAgKHZhbHVlOiBTbGF0ZURlc2NlbmRhbnRbXSkgPT4ge1xuICAgICAgICB2YWxpZGF0ZSh2YWx1ZSBhcyBTbGF0ZUVsZW1lbnRbXSk7XG5cbiAgICAgICAgc2V0TWVudGlvbkRyYWZ0KGdldE1lbnRpb25EcmFmdEF0U2VsZWN0aW9uKGVkaXRvcikpO1xuICAgICAgfSxcbiAgICAgIFtlZGl0b3IsIHZhbGlkYXRlXVxuICAgICk7XG5cbiAgICBjb25zdCBjcmVhdGVNZW50aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgICAodXNlcklkPzogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmICghbWVudGlvbkRyYWZ0IHx8ICF1c2VySWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBTbGF0ZVRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgbWVudGlvbkRyYWZ0LnJhbmdlKTtcbiAgICAgICAgaW5zZXJ0TWVudGlvbihlZGl0b3IsIHVzZXJJZCk7XG4gICAgICAgIHNldE1lbnRpb25EcmFmdCh1bmRlZmluZWQpO1xuICAgICAgICBzZXRTZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXgoMCk7XG4gICAgICB9LFxuICAgICAgW2VkaXRvciwgbWVudGlvbkRyYWZ0LCBzZXRTZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXhdXG4gICAgKTtcblxuICAgIGNvbnN0IGhhbmRsZUtleURvd24gPSB1c2VDYWxsYmFjayhcbiAgICAgIChldmVudDogS2V5Ym9hcmRFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgb25LZXlEb3duPy4oZXZlbnQpO1xuXG4gICAgICAgIGlmIChldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFsbG93IGxlYXZpbmcgbWFya3Mgd2l0aCBBcnJvd0xlZnRcbiAgICAgICAgaWYgKGlzS2V5KGV2ZW50LCBcIkFycm93TGVmdFwiKSkge1xuICAgICAgICAgIGxlYXZlTWFya0VkZ2UoZWRpdG9yLCBcInN0YXJ0XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWxsb3cgbGVhdmluZyBtYXJrcyB3aXRoIEFycm93UmlnaHRcbiAgICAgICAgaWYgKGlzS2V5KGV2ZW50LCBcIkFycm93UmlnaHRcIikpIHtcbiAgICAgICAgICBsZWF2ZU1hcmtFZGdlKGVkaXRvciwgXCJlbmRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWVudGlvbkRyYWZ0ICYmIG1lbnRpb25TdWdnZXN0aW9ucz8ubGVuZ3RoKSB7XG4gICAgICAgICAgLy8gU2VsZWN0IHRoZSBuZXh0IG1lbnRpb24gc3VnZ2VzdGlvbiBvbiBBcnJvd0Rvd25cbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiQXJyb3dEb3duXCIpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc2V0TmV4dFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFNlbGVjdCB0aGUgcHJldmlvdXMgbWVudGlvbiBzdWdnZXN0aW9uIG9uIEFycm93VXBcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiQXJyb3dVcFwiKSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHNldFByZXZpb3VzU2VsZWN0ZWRNZW50aW9uU3VnZ2VzdGlvbkluZGV4KCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ3JlYXRlIGEgbWVudGlvbiBvbiBFbnRlci9UYWJcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiRW50ZXJcIikgfHwgaXNLZXkoZXZlbnQsIFwiVGFiXCIpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBjb25zdCB1c2VySWQgPSBtZW50aW9uU3VnZ2VzdGlvbnM/LltzZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXhdO1xuICAgICAgICAgICAgY3JlYXRlTWVudGlvbih1c2VySWQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENsb3NlIHRoZSBzdWdnZXN0aW9ucyBvbiBFc2NhcGVcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiRXNjYXBlXCIpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc2V0TWVudGlvbkRyYWZ0KHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBzZXRTZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXgoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEJsdXIgdGhlIGVkaXRvciBvbiBFc2NhcGVcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiRXNjYXBlXCIpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgUmVhY3RFZGl0b3IuYmx1cihlZGl0b3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFN1Ym1pdCB0aGUgZWRpdG9yIG9uIEVudGVyXG4gICAgICAgICAgaWYgKGlzS2V5KGV2ZW50LCBcIkVudGVyXCIsIHsgc2hpZnQ6IGZhbHNlIH0pICYmICFpc0VtcHR5KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3VibWl0KCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGxpbmUgb24gU2hpZnQgKyBFbnRlclxuICAgICAgICAgIGlmIChpc0tleShldmVudCwgXCJFbnRlclwiLCB7IHNoaWZ0OiB0cnVlIH0pKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZWRpdG9yLmluc2VydEJyZWFrKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVG9nZ2xlIGJvbGQgb24gQ29tbWFuZC9Db250cm9sICsgQlxuICAgICAgICAgIGlmIChpc0tleShldmVudCwgXCJiXCIsIHsgbW9kOiB0cnVlIH0pKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdG9nZ2xlTWFyayhlZGl0b3IsIFwiYm9sZFwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUb2dnbGUgaXRhbGljIG9uIENvbW1hbmQvQ29udHJvbCArIElcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiaVwiLCB7IG1vZDogdHJ1ZSB9KSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRvZ2dsZU1hcmsoZWRpdG9yLCBcIml0YWxpY1wiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUb2dnbGUgc3RyaWtldGhyb3VnaCBvbiBDb21tYW5kL0NvbnRyb2wgKyBTaGlmdCArIFNcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwic1wiLCB7IG1vZDogdHJ1ZSwgc2hpZnQ6IHRydWUgfSkpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0b2dnbGVNYXJrKGVkaXRvciwgXCJzdHJpa2V0aHJvdWdoXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFRvZ2dsZSBjb2RlIG9uIENvbW1hbmQvQ29udHJvbCArIEVcbiAgICAgICAgICBpZiAoaXNLZXkoZXZlbnQsIFwiZVwiLCB7IG1vZDogdHJ1ZSB9KSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRvZ2dsZU1hcmsoZWRpdG9yLCBcImNvZGVcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW1xuICAgICAgICBjcmVhdGVNZW50aW9uLFxuICAgICAgICBlZGl0b3IsXG4gICAgICAgIGlzRW1wdHksXG4gICAgICAgIG1lbnRpb25EcmFmdCxcbiAgICAgICAgbWVudGlvblN1Z2dlc3Rpb25zLFxuICAgICAgICBzZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXgsXG4gICAgICAgIG9uS2V5RG93bixcbiAgICAgICAgc2V0TmV4dFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCxcbiAgICAgICAgc2V0UHJldmlvdXNTZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXgsXG4gICAgICAgIHNldFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCxcbiAgICAgICAgc3VibWl0LFxuICAgICAgXVxuICAgICk7XG5cbiAgICBjb25zdCBoYW5kbGVGb2N1cyA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGV2ZW50OiBGb2N1c0V2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICBvbkZvY3VzPy4oZXZlbnQpO1xuXG4gICAgICAgIGlmICghZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICBzZXRGb2N1c2VkKHRydWUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW29uRm9jdXMsIHNldEZvY3VzZWRdXG4gICAgKTtcblxuICAgIGNvbnN0IGhhbmRsZUJsdXIgPSB1c2VDYWxsYmFjayhcbiAgICAgIChldmVudDogRm9jdXNFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgb25CbHVyPy4oZXZlbnQpO1xuXG4gICAgICAgIGlmICghZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICBzZXRGb2N1c2VkKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtvbkJsdXIsIHNldEZvY3VzZWRdXG4gICAgKTtcblxuICAgIGNvbnN0IHNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25Vc2VySWQgPSB1c2VNZW1vKFxuICAgICAgKCkgPT4gbWVudGlvblN1Z2dlc3Rpb25zPy5bc2VsZWN0ZWRNZW50aW9uU3VnZ2VzdGlvbkluZGV4XSxcbiAgICAgIFtzZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXgsIG1lbnRpb25TdWdnZXN0aW9uc11cbiAgICApO1xuICAgIGNvbnN0IHNldFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25Vc2VySWQgPSB1c2VDYWxsYmFjayhcbiAgICAgICh1c2VySWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBpbmRleCA9IG1lbnRpb25TdWdnZXN0aW9ucz8uaW5kZXhPZih1c2VySWQpO1xuXG4gICAgICAgIGlmIChpbmRleCAhPT0gdW5kZWZpbmVkICYmIGluZGV4ID49IDApIHtcbiAgICAgICAgICBzZXRTZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uSW5kZXgoaW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW3NldFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCwgbWVudGlvblN1Z2dlc3Rpb25zXVxuICAgICk7XG5cbiAgICBjb25zdCBwcm9wc1doaWxlU3VnZ2VzdGluZzogQXJpYUF0dHJpYnV0ZXMgPSB1c2VNZW1vKFxuICAgICAgKCkgPT5cbiAgICAgICAgbWVudGlvbkRyYWZ0XG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIHJvbGU6IFwiY29tYm9ib3hcIixcbiAgICAgICAgICAgICAgXCJhcmlhLWF1dG9jb21wbGV0ZVwiOiBcImxpc3RcIixcbiAgICAgICAgICAgICAgXCJhcmlhLWV4cGFuZGVkXCI6IHRydWUsXG4gICAgICAgICAgICAgIFwiYXJpYS1jb250cm9sc1wiOiBzdWdnZXN0aW9uc0xpc3RJZCxcbiAgICAgICAgICAgICAgXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIjogc3VnZ2VzdGlvbnNMaXN0SXRlbUlkKFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25Vc2VySWRcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICA6IHt9LFxuICAgICAgW1xuICAgICAgICBtZW50aW9uRHJhZnQsXG4gICAgICAgIHN1Z2dlc3Rpb25zTGlzdElkLFxuICAgICAgICBzdWdnZXN0aW9uc0xpc3RJdGVtSWQsXG4gICAgICAgIHNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25Vc2VySWQsXG4gICAgICBdXG4gICAgKTtcblxuICAgIHVzZUltcGVyYXRpdmVIYW5kbGUoZm9yd2FyZGVkUmVmLCAoKSA9PiB7XG4gICAgICByZXR1cm4gUmVhY3RFZGl0b3IudG9ET01Ob2RlKGVkaXRvciwgZWRpdG9yKSBhcyBIVE1MRGl2RWxlbWVudDtcbiAgICB9LCBbZWRpdG9yXSk7XG5cbiAgICAvLyBNYW51YWxseSBmb2N1cyB0aGUgZWRpdG9yIHdoZW4gYGF1dG9Gb2N1c2AgaXMgdHJ1ZVxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoYXV0b0ZvY3VzKSB7XG4gICAgICAgIGZvY3VzKCk7XG4gICAgICB9XG4gICAgfSwgW2F1dG9Gb2N1cywgZWRpdG9yLCBmb2N1c10pO1xuXG4gICAgLy8gTWFudWFsbHkgYWRkIGEgc2VsZWN0aW9uIGluIHRoZSBlZGl0b3IgaWYgdGhlIHNlbGVjdGlvblxuICAgIC8vIGlzIHN0aWxsIGVtcHR5IGFmdGVyIGJlaW5nIGZvY3VzZWRcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKGlzRm9jdXNlZCAmJiBlZGl0b3Iuc2VsZWN0aW9uID09PSBudWxsKSB7XG4gICAgICAgIHNlbGVjdCgpO1xuICAgICAgfVxuICAgIH0sIFtlZGl0b3IsIHNlbGVjdCwgaXNGb2N1c2VkXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFNsYXRlXG4gICAgICAgIGVkaXRvcj17ZWRpdG9yfVxuICAgICAgICBpbml0aWFsVmFsdWU9e2luaXRpYWxFZGl0b3JWYWx1ZX1cbiAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX1cbiAgICAgID5cbiAgICAgICAgPEVkaXRhYmxlXG4gICAgICAgICAgZGlyPXtkaXJ9XG4gICAgICAgICAgZW50ZXJLZXlIaW50PXttZW50aW9uRHJhZnQgPyBcImVudGVyXCIgOiBcInNlbmRcIn1cbiAgICAgICAgICBhdXRvQ2FwaXRhbGl6ZT1cInNlbnRlbmNlc1wiXG4gICAgICAgICAgYXJpYS1sYWJlbD1cIkNvbXBvc2VyIGVkaXRvclwiXG4gICAgICAgICAgZGF0YS1mb2N1c2VkPXtpc0ZvY3VzZWQgfHwgdW5kZWZpbmVkfVxuICAgICAgICAgIGRhdGEtZGlzYWJsZWQ9e2lzRGlzYWJsZWQgfHwgdW5kZWZpbmVkfVxuICAgICAgICAgIHsuLi5wcm9wc1doaWxlU3VnZ2VzdGluZ31cbiAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgcmVhZE9ubHk9e2lzRGlzYWJsZWR9XG4gICAgICAgICAgZGlzYWJsZWQ9e2lzRGlzYWJsZWR9XG4gICAgICAgICAgb25LZXlEb3duPXtoYW5kbGVLZXlEb3dufVxuICAgICAgICAgIG9uRm9jdXM9e2hhbmRsZUZvY3VzfVxuICAgICAgICAgIG9uQmx1cj17aGFuZGxlQmx1cn1cbiAgICAgICAgICByZW5kZXJFbGVtZW50PXtyZW5kZXJFbGVtZW50fVxuICAgICAgICAgIHJlbmRlckxlYWY9e0NvbXBvc2VyRWRpdG9yTGVhZn1cbiAgICAgICAgICByZW5kZXJQbGFjZWhvbGRlcj17Q29tcG9zZXJFZGl0b3JQbGFjZWhvbGRlcn1cbiAgICAgICAgLz5cbiAgICAgICAgPENvbXBvc2VyRWRpdG9yTWVudGlvblN1Z2dlc3Rpb25zV3JhcHBlclxuICAgICAgICAgIGRpcj17ZGlyfVxuICAgICAgICAgIG1lbnRpb25EcmFmdD17bWVudGlvbkRyYWZ0fVxuICAgICAgICAgIHNlbGVjdGVkVXNlcklkPXtzZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uVXNlcklkfVxuICAgICAgICAgIHNldFNlbGVjdGVkVXNlcklkPXtzZXRTZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uVXNlcklkfVxuICAgICAgICAgIHVzZXJJZHM9e21lbnRpb25TdWdnZXN0aW9uc31cbiAgICAgICAgICBpZD17c3VnZ2VzdGlvbnNMaXN0SWR9XG4gICAgICAgICAgaXRlbUlkPXtzdWdnZXN0aW9uc0xpc3RJdGVtSWR9XG4gICAgICAgICAgb25JdGVtU2VsZWN0PXtjcmVhdGVNZW50aW9ufVxuICAgICAgICAgIE1lbnRpb25TdWdnZXN0aW9ucz17TWVudGlvblN1Z2dlc3Rpb25zfVxuICAgICAgICAvPlxuICAgICAgPC9TbGF0ZT5cbiAgICApO1xuICB9XG4pO1xuXG4vKipcbiAqIFN1cnJvdW5kcyB0aGUgY29tcG9zZXIncyBjb250ZW50IGFuZCBoYW5kbGVzIHN1Ym1pc3Npb25zLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8Q29tcG9zZXIuRm9ybSBvbkNvbXBvc2VyU3VibWl0PXsoeyBib2R5IH0pID0+IHt9fT5cbiAqXHQgPENvbXBvc2VyLkVkaXRvciAvPlxuICogICA8Q29tcG9zZXIuU3VibWl0IC8+XG4gKiA8L0NvbXBvc2VyLkZvcm0+XG4gKi9cbmNvbnN0IENvbXBvc2VyRm9ybSA9IGZvcndhcmRSZWY8SFRNTEZvcm1FbGVtZW50LCBDb21wb3NlckZvcm1Qcm9wcz4oXG4gIChcbiAgICB7IGNoaWxkcmVuLCBvblN1Ym1pdCwgb25Db21wb3NlclN1Ym1pdCwgYXNDaGlsZCwgLi4ucHJvcHMgfSxcbiAgICBmb3J3YXJkZWRSZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcImZvcm1cIjtcbiAgICBjb25zdCBlZGl0b3IgPSB1c2VJbml0aWFsKGNyZWF0ZUNvbXBvc2VyRWRpdG9yKTtcbiAgICBjb25zdCBbaXNFbXB0eSwgc2V0RW1wdHldID0gdXNlU3RhdGUodHJ1ZSk7XG4gICAgY29uc3QgW2lzRm9jdXNlZCwgc2V0Rm9jdXNlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgcmVmID0gdXNlUmVmPEhUTUxGb3JtRWxlbWVudD4obnVsbCk7XG4gICAgY29uc3QgbWVyZ2VkUmVmcyA9IHVzZVJlZnMoZm9yd2FyZGVkUmVmLCByZWYpO1xuXG4gICAgY29uc3QgdmFsaWRhdGUgPSB1c2VDYWxsYmFjayhcbiAgICAgICh2YWx1ZTogU2xhdGVFbGVtZW50W10pID0+IHtcbiAgICAgICAgc2V0RW1wdHkoaXNFZGl0b3JFbXB0eShlZGl0b3IsIHZhbHVlKSk7XG4gICAgICB9LFxuICAgICAgW2VkaXRvcl1cbiAgICApO1xuXG4gICAgY29uc3Qgc3VibWl0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgLy8gV2UgbmVlZCB0byB3YWl0IGZvciB0aGUgbmV4dCBmcmFtZSBpbiBzb21lIGNhc2VzIGxpa2Ugd2hlbiBjb21wb3NpbmcgZGlhY3JpdGljcyxcbiAgICAgIC8vIHdlIHdhbnQgYW55IG5hdGl2ZSBoYW5kbGluZyB0byBiZSBkb25lIGZpcnN0IHdoaWxlIHN0aWxsIGJlaW5nIGhhbmRsZWQgb24gYGtleWRvd25gLlxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgaWYgKHJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgcmVxdWVzdFN1Ym1pdChyZWYuY3VycmVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIFtdKTtcblxuICAgIGNvbnN0IGNsZWFyID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgU2xhdGVUcmFuc2Zvcm1zLmRlbGV0ZShlZGl0b3IsIHtcbiAgICAgICAgYXQ6IHtcbiAgICAgICAgICBhbmNob3I6IFNsYXRlRWRpdG9yLnN0YXJ0KGVkaXRvciwgW10pLFxuICAgICAgICAgIGZvY3VzOiBTbGF0ZUVkaXRvci5lbmQoZWRpdG9yLCBbXSksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9LCBbZWRpdG9yXSk7XG5cbiAgICBjb25zdCBzZWxlY3QgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBTbGF0ZVRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwge1xuICAgICAgICBhbmNob3I6IFNsYXRlRWRpdG9yLmVuZChlZGl0b3IsIFtdKSxcbiAgICAgICAgZm9jdXM6IFNsYXRlRWRpdG9yLmVuZChlZGl0b3IsIFtdKSxcbiAgICAgIH0pO1xuICAgIH0sIFtlZGl0b3JdKTtcblxuICAgIGNvbnN0IGZvY3VzID0gdXNlQ2FsbGJhY2soXG4gICAgICAocmVzZXRTZWxlY3Rpb24gPSB0cnVlKSA9PiB7XG4gICAgICAgIGlmICghUmVhY3RFZGl0b3IuaXNGb2N1c2VkKGVkaXRvcikpIHtcbiAgICAgICAgICBTbGF0ZVRyYW5zZm9ybXMuc2VsZWN0KFxuICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgcmVzZXRTZWxlY3Rpb24gfHwgIWVkaXRvci5zZWxlY3Rpb25cbiAgICAgICAgICAgICAgPyBTbGF0ZUVkaXRvci5lbmQoZWRpdG9yLCBbXSlcbiAgICAgICAgICAgICAgOiBlZGl0b3Iuc2VsZWN0aW9uXG4gICAgICAgICAgKTtcbiAgICAgICAgICBSZWFjdEVkaXRvci5mb2N1cyhlZGl0b3IpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW2VkaXRvcl1cbiAgICApO1xuXG4gICAgY29uc3QgYmx1ciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIFJlYWN0RWRpdG9yLmJsdXIoZWRpdG9yKTtcbiAgICB9LCBbZWRpdG9yXSk7XG5cbiAgICBjb25zdCBvblN1Ym1pdEVuZCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGNsZWFyKCk7XG4gICAgICBibHVyKCk7XG4gICAgfSwgW2JsdXIsIGNsZWFyXSk7XG5cbiAgICBjb25zdCBjcmVhdGVNZW50aW9uID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgZm9jdXMoKTtcbiAgICAgIGluc2VydE1lbnRpb25DaGFyYWN0ZXIoZWRpdG9yKTtcbiAgICB9LCBbZWRpdG9yLCBmb2N1c10pO1xuXG4gICAgY29uc3QgaW5zZXJ0VGV4dCA9IHVzZUNhbGxiYWNrKFxuICAgICAgKHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgICBmb2N1cyhmYWxzZSk7XG4gICAgICAgIGluc2VydFNsYXRlVGV4dChlZGl0b3IsIHRleHQpO1xuICAgICAgfSxcbiAgICAgIFtlZGl0b3IsIGZvY3VzXVxuICAgICk7XG5cbiAgICBjb25zdCBoYW5kbGVTdWJtaXQgPSB1c2VDYWxsYmFjayhcbiAgICAgIChldmVudDogRm9ybUV2ZW50PEhUTUxGb3JtRWxlbWVudD4pID0+IHtcbiAgICAgICAgLy8gSW4gc29tZSBzaXR1YXRpb25zIChlLmcuIHByZXNzaW5nIEVudGVyIHdoaWxlIGNvbXBvc2luZyBkaWFjcml0aWNzKSwgaXQncyBwb3NzaWJsZVxuICAgICAgICAvLyBmb3IgdGhlIGZvcm0gdG8gYmUgc3VibWl0dGVkIGFzIGVtcHR5IGV2ZW4gdGhvdWdoIHdlIGFscmVhZHkgY2hlY2tlZCB3aGV0aGVyIHRoZVxuICAgICAgICAvLyBlZGl0b3Igd2FzIGVtcHR5IHdoZW4gaGFuZGxpbmcgdGhlIGtleSBwcmVzcy5cbiAgICAgICAgY29uc3QgaXNFbXB0eSA9IGlzRWRpdG9yRW1wdHkoZWRpdG9yLCBlZGl0b3IuY2hpbGRyZW4pO1xuXG4gICAgICAgIC8vIFdlIGV2ZW4gcHJldmVudCB0aGUgdXNlcidzIGBvblN1Ym1pdGAgaGFuZGxlciBmcm9tIGJlaW5nIGNhbGxlZCBpZiB0aGUgZWRpdG9yIGlzIGVtcHR5LlxuICAgICAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBvblN1Ym1pdD8uKGV2ZW50KTtcblxuICAgICAgICBpZiAoIW9uQ29tcG9zZXJTdWJtaXQgfHwgZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYm9keSA9IGNvbXBvc2VyQm9keVRvQ29tbWVudEJvZHkoXG4gICAgICAgICAgZWRpdG9yLmNoaWxkcmVuIGFzIENvbXBvc2VyQm9keURhdGFcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgY29tbWVudCA9IHsgYm9keSB9O1xuXG4gICAgICAgIGNvbnN0IHByb21pc2UgPSBvbkNvbXBvc2VyU3VibWl0KGNvbW1lbnQsIGV2ZW50KTtcblxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmIChwcm9taXNlKSB7XG4gICAgICAgICAgcHJvbWlzZS50aGVuKG9uU3VibWl0RW5kKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvblN1Ym1pdEVuZCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW2VkaXRvciwgb25Db21wb3NlclN1Ym1pdCwgb25TdWJtaXQsIG9uU3VibWl0RW5kXVxuICAgICk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbXBvc2VyRWRpdG9yQ29udGV4dC5Qcm92aWRlclxuICAgICAgICB2YWx1ZT17e1xuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2YWxpZGF0ZSxcbiAgICAgICAgICBzZXRGb2N1c2VkLFxuICAgICAgICB9fVxuICAgICAgPlxuICAgICAgICA8Q29tcG9zZXJDb250ZXh0LlByb3ZpZGVyXG4gICAgICAgICAgdmFsdWU9e3tcbiAgICAgICAgICAgIGlzRm9jdXNlZCxcbiAgICAgICAgICAgIGlzRW1wdHksXG4gICAgICAgICAgICBzdWJtaXQsXG4gICAgICAgICAgICBjbGVhcixcbiAgICAgICAgICAgIHNlbGVjdCxcbiAgICAgICAgICAgIGZvY3VzLFxuICAgICAgICAgICAgYmx1cixcbiAgICAgICAgICAgIGNyZWF0ZU1lbnRpb24sXG4gICAgICAgICAgICBpbnNlcnRUZXh0LFxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICA8Q29tcG9uZW50IHsuLi5wcm9wc30gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdH0gcmVmPXttZXJnZWRSZWZzfT5cbiAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICA8L0NvbXBvbmVudD5cbiAgICAgICAgPC9Db21wb3NlckNvbnRleHQuUHJvdmlkZXI+XG4gICAgICA8L0NvbXBvc2VyRWRpdG9yQ29udGV4dC5Qcm92aWRlcj5cbiAgICApO1xuICB9XG4pO1xuXG4vKipcbiAqIEEgYnV0dG9uIHRvIHN1Ym1pdCB0aGUgY29tcG9zZXIuXG4gKlxuICogQGV4YW1wbGVcbiAqIDxDb21wb3Nlci5TdWJtaXQ+U2VuZDwvQ29tcG9zZXIuU3VibWl0PlxuICovXG5jb25zdCBDb21wb3NlclN1Ym1pdCA9IGZvcndhcmRSZWY8SFRNTEJ1dHRvbkVsZW1lbnQsIENvbXBvc2VyU3VibWl0UHJvcHM+KFxuICAoeyBjaGlsZHJlbiwgZGlzYWJsZWQsIGFzQ2hpbGQsIC4uLnByb3BzIH0sIGZvcndhcmRlZFJlZikgPT4ge1xuICAgIGNvbnN0IENvbXBvbmVudCA9IGFzQ2hpbGQgPyBTbG90IDogXCJidXR0b25cIjtcbiAgICBjb25zdCB7IGlzRW1wdHkgfSA9IHVzZUNvbXBvc2VyKCk7XG4gICAgY29uc3Qgc2VsZiA9IHVzZVNlbGYoKTtcbiAgICBjb25zdCBpc0Rpc2FibGVkID0gdXNlTWVtbyhcbiAgICAgICgpID0+IGRpc2FibGVkIHx8IGlzRW1wdHkgfHwgIXNlbGY/LmNhbkNvbW1lbnQsXG4gICAgICBbZGlzYWJsZWQsIGlzRW1wdHksIHNlbGY/LmNhbkNvbW1lbnRdXG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Q29tcG9uZW50XG4gICAgICAgIHR5cGU9XCJzdWJtaXRcIlxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgICBkaXNhYmxlZD17aXNEaXNhYmxlZH1cbiAgICAgID5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9Db21wb25lbnQ+XG4gICAgKTtcbiAgfVxuKTtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICBDb21wb3NlckVkaXRvci5kaXNwbGF5TmFtZSA9IENPTVBPU0VSX0VESVRPUl9OQU1FO1xuICBDb21wb3NlckZvcm0uZGlzcGxheU5hbWUgPSBDT01QT1NFUl9GT1JNX05BTUU7XG4gIENvbXBvc2VyTWVudGlvbi5kaXNwbGF5TmFtZSA9IENPTVBPU0VSX01FTlRJT05fTkFNRTtcbiAgQ29tcG9zZXJMaW5rLmRpc3BsYXlOYW1lID0gQ09NUE9TRVJfTElOS19OQU1FO1xuICBDb21wb3NlclN1Ym1pdC5kaXNwbGF5TmFtZSA9IENPTVBPU0VSX1NVQk1JVF9OQU1FO1xuICBDb21wb3NlclN1Z2dlc3Rpb25zLmRpc3BsYXlOYW1lID0gQ09NUE9TRVJfU1VHR0VTVElPTlNfTkFNRTtcbiAgQ29tcG9zZXJTdWdnZXN0aW9uc0xpc3QuZGlzcGxheU5hbWUgPSBDT01QT1NFUl9TVUdHRVNUSU9OU19MSVNUX05BTUU7XG4gIENvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0SXRlbS5kaXNwbGF5TmFtZSA9IENPTVBPU0VSX1NVR0dFU1RJT05TX0xJU1RfSVRFTV9OQU1FO1xufVxuXG4vLyBOT1RFOiBFdmVyeSBleHBvcnQgZnJvbSB0aGlzIGZpbGUgd2lsbCBiZSBhdmFpbGFibGUgcHVibGljbHkgYXMgQ29tcG9zZXIuKlxuZXhwb3J0IHtcbiAgQ29tcG9zZXJFZGl0b3IgYXMgRWRpdG9yLFxuICBDb21wb3NlckZvcm0gYXMgRm9ybSxcbiAgQ29tcG9zZXJMaW5rIGFzIExpbmssXG4gIENvbXBvc2VyTWVudGlvbiBhcyBNZW50aW9uLFxuICBDb21wb3NlclN1Ym1pdCBhcyBTdWJtaXQsXG4gIENvbXBvc2VyU3VnZ2VzdGlvbnMgYXMgU3VnZ2VzdGlvbnMsXG4gIENvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0IGFzIFN1Z2dlc3Rpb25zTGlzdCxcbiAgQ29tcG9zZXJTdWdnZXN0aW9uc0xpc3RJdGVtIGFzIFN1Z2dlc3Rpb25zTGlzdEl0ZW0sXG59O1xuIl0sIm5hbWVzIjpbIk1FTlRJT05fU1VHR0VTVElPTlNfUE9TSVRJT04iLCJDT01QT1NFUl9NRU5USU9OX05BTUUiLCJDT01QT1NFUl9MSU5LX05BTUUiLCJDT01QT1NFUl9TVUdHRVNUSU9OU19OQU1FIiwiQ09NUE9TRVJfU1VHR0VTVElPTlNfTElTVF9OQU1FIiwiQ09NUE9TRVJfU1VHR0VTVElPTlNfTElTVF9JVEVNX05BTUUiLCJDT01QT1NFUl9TVUJNSVRfTkFNRSIsIkNPTVBPU0VSX0VESVRPUl9OQU1FIiwiQ09NUE9TRVJfRk9STV9OQU1FIiwiZW1wdHlDb21tZW50Qm9keSIsInZlcnNpb24iLCJjb250ZW50IiwidHlwZSIsImNoaWxkcmVuIiwidGV4dCIsImNyZWF0ZUNvbXBvc2VyRWRpdG9yIiwid2l0aE1lbnRpb25zIiwid2l0aEN1c3RvbUxpbmtzIiwid2l0aEF1dG9MaW5rcyIsIndpdGhBdXRvRm9ybWF0dGluZyIsIndpdGhFbXB0eUNsZWFyRm9ybWF0dGluZyIsIndpdGhQYXN0ZUh0bWwiLCJ3aXRoSGlzdG9yeSIsIndpdGhSZWFjdCIsImNyZWF0ZUVkaXRvciIsIkNvbXBvc2VyRWRpdG9yTWVudGlvbldyYXBwZXIiLCJNZW50aW9uIiwiYXR0cmlidXRlcyIsImVsZW1lbnQiLCJpc1NlbGVjdGVkIiwidXNlU2VsZWN0ZWQiLCJSZWFjdF9fZGVmYXVsdCIsImNyZWF0ZUVsZW1lbnQiLCJpZCIsInVzZXJJZCIsIkNvbXBvc2VyRWRpdG9yTGlua1dyYXBwZXIiLCJMaW5rIiwiaHJlZiIsInVzZU1lbW8iLCJ0b0Fic29sdXRlVXJsIiwidXJsIiwiQ29tcG9zZXJFZGl0b3JNZW50aW9uU3VnZ2VzdGlvbnNXcmFwcGVyIiwiaXRlbUlkIiwidXNlcklkcyIsInNlbGVjdGVkVXNlcklkIiwic2V0U2VsZWN0ZWRVc2VySWQiLCJtZW50aW9uRHJhZnQiLCJvbkl0ZW1TZWxlY3QiLCJwb3NpdGlvbiIsImRpciIsIk1lbnRpb25TdWdnZXN0aW9ucyIsImVkaXRvciIsInVzZVNsYXRlU3RhdGljIiwiaXNGb2N1c2VkIiwidXNlQ29tcG9zZXIiLCJzZXRDb250ZW50IiwidXNlU3RhdGUiLCJjb250ZW50WkluZGV4Iiwic2V0Q29udGVudFpJbmRleCIsImNvbnRlbnRSZWYiLCJ1c2VDYWxsYmFjayIsInBvcnRhbENvbnRhaW5lciIsInVzZUxpdmVibG9ja3NVSUNvbmZpZyIsImZsb2F0aW5nT3B0aW9ucyIsImRldGVjdE92ZXJmbG93T3B0aW9ucyIsInBhZGRpbmciLCJGTE9BVElOR19FTEVNRU5UX0NPTExJU0lPTl9QQURESU5HIiwic3RyYXRlZ3kiLCJwbGFjZW1lbnQiLCJnZXRQbGFjZW1lbnRGcm9tUG9zaXRpb24iLCJtaWRkbGV3YXJlIiwiZmxpcCIsImNyb3NzQXhpcyIsImhpZGUiLCJzaGlmdCIsImxpbWl0ZXIiLCJsaW1pdFNoaWZ0Iiwic2l6ZSIsImFwcGx5IiwiYXZhaWxhYmxlV2lkdGgiLCJhdmFpbGFibGVIZWlnaHQiLCJlbGVtZW50cyIsImZsb2F0aW5nIiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsIndoaWxlRWxlbWVudHNNb3VudGVkIiwiYXV0b1VwZGF0ZSIsInJlZnMiLCJzZXRSZWZlcmVuY2UiLCJzZXRGbG9hdGluZyIsImlzUG9zaXRpb25lZCIsIngiLCJ5IiwidXNlRmxvYXRpbmciLCJ1c2VMYXlvdXRFZmZlY3QiLCJ3aW5kb3ciLCJnZXRDb21wdXRlZFN0eWxlIiwiekluZGV4IiwiZG9tUmFuZ2UiLCJnZXRET01SYW5nZSIsInJhbmdlIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiZ2V0Q2xpZW50UmVjdHMiLCJQZXJzaXN0IiwiQ29tcG9zZXJTdWdnZXN0aW9uc0NvbnRleHQiLCJQcm92aWRlciIsInZhbHVlIiwic2VsZWN0ZWRWYWx1ZSIsInNldFNlbGVjdGVkVmFsdWUiLCJyZWYiLCJQb3J0YWwiLCJjb250YWluZXIiLCJ0b3AiLCJsZWZ0IiwidHJhbnNmb3JtIiwiTWF0aCIsInJvdW5kIiwibWluV2lkdGgiLCJDb21wb3NlckVkaXRvckVsZW1lbnQiLCJwcm9wcyIsIkNvbXBvc2VyRWRpdG9yTGVhZiIsImxlYWYiLCJib2xkIiwiaXRhbGljIiwic3RyaWtldGhyb3VnaCIsImNvZGUiLCJDb21wb3NlckVkaXRvclBsYWNlaG9sZGVyIiwib3BhY2l0eSIsIl9vcGFjaXR5IiwiQ29tcG9zZXJNZW50aW9uIiwiZm9yd2FyZFJlZiIsImFzQ2hpbGQiLCJmb3J3YXJkZWRSZWYiLCJDb21wb25lbnQiLCJTbG90IiwiQ29tcG9zZXJMaW5rIiwidGFyZ2V0IiwicmVsIiwiQ29tcG9zZXJTdWdnZXN0aW9ucyIsImlzUHJlc2VudCIsInVzZVBlcnNpc3QiLCJ1c2VSZWYiLCJ1c2VDb21wb3NlclN1Z2dlc3Rpb25zQ29udGV4dCIsIm1lcmdlZFJlZnMiLCJ1c2VSZWZzIiwic2lkZSIsImFsaWduIiwiZ2V0U2lkZUFuZEFsaWduRnJvbVBsYWNlbWVudCIsInVzZUFuaW1hdGlvblBlcnNpc3QiLCJkaXNwbGF5IiwiZmxleERpcmVjdGlvbiIsIm1heEhlaWdodCIsIm92ZXJmbG93WSIsIkNvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0Iiwicm9sZSIsIkNvbXBvc2VyU3VnZ2VzdGlvbnNMaXN0SXRlbSIsIm9uUG9pbnRlck1vdmUiLCJvblBvaW50ZXJEb3duIiwidXNlRWZmZWN0IiwiY3VycmVudCIsInNjcm9sbEludG9WaWV3IiwiYmxvY2siLCJoYW5kbGVQb2ludGVyTW92ZSIsImV2ZW50IiwiaXNEZWZhdWx0UHJldmVudGVkIiwiaGFuZGxlUG9pbnRlckRvd24iLCJoYXNQb2ludGVyQ2FwdHVyZSIsInBvaW50ZXJJZCIsInJlbGVhc2VQb2ludGVyQ2FwdHVyZSIsImJ1dHRvbiIsImN0cmxLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImRlZmF1bHRFZGl0b3JDb21wb25lbnRzIiwiTUVOVElPTl9DSEFSQUNURVIiLCJsZW5ndGgiLCJtYXAiLCJrZXkiLCJDb21wb3NlckVkaXRvciIsImRlZmF1bHRWYWx1ZSIsIm9uS2V5RG93biIsIm9uRm9jdXMiLCJvbkJsdXIiLCJkaXNhYmxlZCIsImF1dG9Gb2N1cyIsImNvbXBvbmVudHMiLCJzZWxmIiwidXNlU2VsZiIsImlzRGlzYWJsZWQiLCJjYW5Db21tZW50IiwidmFsaWRhdGUiLCJzZXRGb2N1c2VkIiwidXNlQ29tcG9zZXJFZGl0b3JDb250ZXh0Iiwic3VibWl0IiwiZm9jdXMiLCJzZWxlY3QiLCJpc0VtcHR5IiwiaW5pdGlhbEJvZHkiLCJ1c2VJbml0aWFsIiwiaW5pdGlhbEVkaXRvclZhbHVlIiwiY29tbWVudEJvZHlUb0NvbXBvc2VyQm9keSIsInNldE1lbnRpb25EcmFmdCIsIm1lbnRpb25TdWdnZXN0aW9ucyIsInVzZU1lbnRpb25TdWdnZXN0aW9ucyIsInNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCIsInNldFByZXZpb3VzU2VsZWN0ZWRNZW50aW9uU3VnZ2VzdGlvbkluZGV4Iiwic2V0TmV4dFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCIsInNldFNlbGVjdGVkTWVudGlvblN1Z2dlc3Rpb25JbmRleCIsInVzZUluZGV4IiwidXNlSWQiLCJzdWdnZXN0aW9uc0xpc3RJZCIsInN1Z2dlc3Rpb25zTGlzdEl0ZW1JZCIsInJlbmRlckVsZW1lbnQiLCJwcm9wczIiLCJoYW5kbGVDaGFuZ2UiLCJnZXRNZW50aW9uRHJhZnRBdFNlbGVjdGlvbiIsImNyZWF0ZU1lbnRpb24iLCJUcmFuc2Zvcm1zIiwiaW5zZXJ0TWVudGlvbiIsImhhbmRsZUtleURvd24iLCJpc0tleSIsImxlYXZlTWFya0VkZ2UiLCJSZWFjdEVkaXRvciIsImJsdXIiLCJpbnNlcnRCcmVhayIsIm1vZCIsInRvZ2dsZU1hcmsiLCJoYW5kbGVGb2N1cyIsImhhbmRsZUJsdXIiLCJzZWxlY3RlZE1lbnRpb25TdWdnZXN0aW9uVXNlcklkIiwic2V0U2VsZWN0ZWRNZW50aW9uU3VnZ2VzdGlvblVzZXJJZCIsImluZGV4IiwiaW5kZXhPZiIsInByb3BzV2hpbGVTdWdnZXN0aW5nIiwidXNlSW1wZXJhdGl2ZUhhbmRsZSIsInRvRE9NTm9kZSIsInNlbGVjdGlvbiIsIlNsYXRlIiwiaW5pdGlhbFZhbHVlIiwib25DaGFuZ2UiLCJFZGl0YWJsZSIsImVudGVyS2V5SGludCIsImF1dG9DYXBpdGFsaXplIiwicmVhZE9ubHkiLCJyZW5kZXJMZWFmIiwicmVuZGVyUGxhY2Vob2xkZXIiLCJDb21wb3NlckZvcm0iLCJvblN1Ym1pdCIsIm9uQ29tcG9zZXJTdWJtaXQiLCJpc0VtcHR5JDEiLCJzZXRFbXB0eSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlcXVlc3RTdWJtaXQiLCJjbGVhciIsImRlbGV0ZSIsImF0IiwiYW5jaG9yIiwiRWRpdG9yIiwic3RhcnQiLCJlbmQiLCJyZXNldFNlbGVjdGlvbiIsIm9uU3VibWl0RW5kIiwiaW5zZXJ0TWVudGlvbkNoYXJhY3RlciIsImluc2VydFRleHQkMSIsImluc2VydFRleHQiLCJoYW5kbGVTdWJtaXQiLCJpc0VtcHR5MiIsImJvZHkiLCJjb21wb3NlckJvZHlUb0NvbW1lbnRCb2R5IiwiY29tbWVudCIsInByb21pc2UiLCJ0aGVuIiwiQ29tcG9zZXJFZGl0b3JDb250ZXh0IiwiQ29tcG9zZXJDb250ZXh0IiwiQ29tcG9zZXJTdWJtaXQiLCJwcm9jZXNzIiwiZGlzcGxheU5hbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/utils.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/Composer/utils.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   commentBodyLinkToComposerBodyLink: () => (/* binding */ commentBodyLinkToComposerBodyLink),\n/* harmony export */   commentBodyMentionToComposerBodyMention: () => (/* binding */ commentBodyMentionToComposerBodyMention),\n/* harmony export */   commentBodyToComposerBody: () => (/* binding */ commentBodyToComposerBody),\n/* harmony export */   composerBodyAutoLinkToCommentBodyLink: () => (/* binding */ composerBodyAutoLinkToCommentBodyLink),\n/* harmony export */   composerBodyCustomLinkToCommentBodyLink: () => (/* binding */ composerBodyCustomLinkToCommentBodyLink),\n/* harmony export */   composerBodyMentionToCommentBodyMention: () => (/* binding */ composerBodyMentionToCommentBodyMention),\n/* harmony export */   composerBodyToCommentBody: () => (/* binding */ composerBodyToCommentBody),\n/* harmony export */   getPlacementFromPosition: () => (/* binding */ getPlacementFromPosition),\n/* harmony export */   getSideAndAlignFromPlacement: () => (/* binding */ getSideAndAlignFromPlacement)\n/* harmony export */ });\n/* harmony import */ var _slate_plugins_auto_links_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../slate/plugins/auto-links.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-links.mjs\");\n/* harmony import */ var _slate_plugins_custom_links_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../slate/plugins/custom-links.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/custom-links.mjs\");\n/* harmony import */ var _slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../slate/plugins/mentions.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs\");\n/* harmony import */ var _slate_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../slate/utils/is-text.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs\");\n/* harmony import */ var _utils_exists_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/exists.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/exists.mjs\");\n/* harmony import */ var _Comment_utils_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../Comment/utils.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Comment/utils.mjs\");\n\n\n\n\n\n\n\nfunction composerBodyMentionToCommentBodyMention(mention) {\n  return {\n    type: \"mention\",\n    id: mention.id\n  };\n}\nfunction composerBodyAutoLinkToCommentBodyLink(link) {\n  return {\n    type: \"link\",\n    url: link.url\n  };\n}\nfunction composerBodyCustomLinkToCommentBodyLink(link) {\n  return {\n    type: \"link\",\n    url: link.url,\n    text: link.children.map((child) => child.text).join(\"\")\n  };\n}\nfunction commentBodyMentionToComposerBodyMention(mention) {\n  return {\n    type: \"mention\",\n    id: mention.id,\n    children: [{ text: \"\" }]\n  };\n}\nfunction commentBodyLinkToComposerBodyLink(link) {\n  if (link.text) {\n    return {\n      type: \"custom-link\",\n      url: link.url,\n      children: [{ text: link.text }]\n    };\n  } else {\n    return {\n      type: \"auto-link\",\n      url: link.url,\n      children: [{ text: link.url }]\n    };\n  }\n}\nfunction composerBodyToCommentBody(body) {\n  return {\n    version: 1,\n    content: body.map((block) => {\n      if (block.type !== \"paragraph\") {\n        return null;\n      }\n      const children = block.children.map((inline) => {\n        if ((0,_slate_plugins_mentions_mjs__WEBPACK_IMPORTED_MODULE_0__.isComposerBodyMention)(inline)) {\n          return composerBodyMentionToCommentBodyMention(inline);\n        }\n        if ((0,_slate_plugins_auto_links_mjs__WEBPACK_IMPORTED_MODULE_1__.isComposerBodyAutoLink)(inline)) {\n          return composerBodyAutoLinkToCommentBodyLink(inline);\n        }\n        if ((0,_slate_plugins_custom_links_mjs__WEBPACK_IMPORTED_MODULE_2__.isComposerBodyCustomLink)(inline)) {\n          return composerBodyCustomLinkToCommentBodyLink(inline);\n        }\n        if ((0,_slate_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_3__.isText)(inline)) {\n          return inline;\n        }\n        return null;\n      }).filter(_utils_exists_mjs__WEBPACK_IMPORTED_MODULE_4__.exists);\n      return {\n        ...block,\n        children\n      };\n    }).filter(_utils_exists_mjs__WEBPACK_IMPORTED_MODULE_4__.exists)\n  };\n}\nconst emptyComposerBody = [];\nfunction commentBodyToComposerBody(body) {\n  if (!body || !body?.content) {\n    return emptyComposerBody;\n  }\n  return body.content.map((block) => {\n    if (block.type !== \"paragraph\") {\n      return null;\n    }\n    const children = block.children.map((inline) => {\n      if ((0,_Comment_utils_mjs__WEBPACK_IMPORTED_MODULE_5__.isCommentBodyMention)(inline)) {\n        return commentBodyMentionToComposerBodyMention(inline);\n      }\n      if ((0,_Comment_utils_mjs__WEBPACK_IMPORTED_MODULE_5__.isCommentBodyLink)(inline)) {\n        return commentBodyLinkToComposerBodyLink(inline);\n      }\n      if ((0,_Comment_utils_mjs__WEBPACK_IMPORTED_MODULE_5__.isCommentBodyText)(inline)) {\n        return inline;\n      }\n      return null;\n    }).filter(_utils_exists_mjs__WEBPACK_IMPORTED_MODULE_4__.exists);\n    return {\n      ...block,\n      children\n    };\n  }).filter(_utils_exists_mjs__WEBPACK_IMPORTED_MODULE_4__.exists);\n}\nfunction getPlacementFromPosition(position, direction = \"ltr\") {\n  return `${position}-${direction === \"rtl\" ? \"end\" : \"start\"}`;\n}\nfunction getSideAndAlignFromPlacement(placement) {\n  const [side, align = \"center\"] = placement.split(\"-\");\n  return [side, align];\n}\n\n\n//# sourceMappingURL=utils.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0NvbXBvc2VyL3V0aWxzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNEU7QUFDSTtBQUNQO0FBQ2xCO0FBQ1A7QUFDa0Q7O0FBRWxHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsVUFBVTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixpQkFBaUI7QUFDcEM7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGdCQUFnQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrRkFBcUI7QUFDakM7QUFDQTtBQUNBLFlBQVkscUZBQXNCO0FBQ2xDO0FBQ0E7QUFDQSxZQUFZLHlGQUF3QjtBQUNwQztBQUNBO0FBQ0EsWUFBWSxnRUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVMscURBQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLFNBQVMscURBQU07QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx3RUFBb0I7QUFDOUI7QUFDQTtBQUNBLFVBQVUscUVBQWlCO0FBQzNCO0FBQ0E7QUFDQSxVQUFVLHFFQUFpQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQSxLQUFLLFNBQVMscURBQU07QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLFNBQVMscURBQU07QUFDbEI7QUFDQTtBQUNBLFlBQVksU0FBUyxHQUFHLHNDQUFzQztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU2VDtBQUM3VCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvcHJpbWl0aXZlcy9Db21wb3Nlci91dGlscy5tanM/ZmY0MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc0NvbXBvc2VyQm9keUF1dG9MaW5rIH0gZnJvbSAnLi4vLi4vc2xhdGUvcGx1Z2lucy9hdXRvLWxpbmtzLm1qcyc7XG5pbXBvcnQgeyBpc0NvbXBvc2VyQm9keUN1c3RvbUxpbmsgfSBmcm9tICcuLi8uLi9zbGF0ZS9wbHVnaW5zL2N1c3RvbS1saW5rcy5tanMnO1xuaW1wb3J0IHsgaXNDb21wb3NlckJvZHlNZW50aW9uIH0gZnJvbSAnLi4vLi4vc2xhdGUvcGx1Z2lucy9tZW50aW9ucy5tanMnO1xuaW1wb3J0IHsgaXNUZXh0IH0gZnJvbSAnLi4vLi4vc2xhdGUvdXRpbHMvaXMtdGV4dC5tanMnO1xuaW1wb3J0IHsgZXhpc3RzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXhpc3RzLm1qcyc7XG5pbXBvcnQgeyBpc0NvbW1lbnRCb2R5TWVudGlvbiwgaXNDb21tZW50Qm9keUxpbmssIGlzQ29tbWVudEJvZHlUZXh0IH0gZnJvbSAnLi4vQ29tbWVudC91dGlscy5tanMnO1xuXG5mdW5jdGlvbiBjb21wb3NlckJvZHlNZW50aW9uVG9Db21tZW50Qm9keU1lbnRpb24obWVudGlvbikge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwibWVudGlvblwiLFxuICAgIGlkOiBtZW50aW9uLmlkXG4gIH07XG59XG5mdW5jdGlvbiBjb21wb3NlckJvZHlBdXRvTGlua1RvQ29tbWVudEJvZHlMaW5rKGxpbmspIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcImxpbmtcIixcbiAgICB1cmw6IGxpbmsudXJsXG4gIH07XG59XG5mdW5jdGlvbiBjb21wb3NlckJvZHlDdXN0b21MaW5rVG9Db21tZW50Qm9keUxpbmsobGluaykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwibGlua1wiLFxuICAgIHVybDogbGluay51cmwsXG4gICAgdGV4dDogbGluay5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC50ZXh0KS5qb2luKFwiXCIpXG4gIH07XG59XG5mdW5jdGlvbiBjb21tZW50Qm9keU1lbnRpb25Ub0NvbXBvc2VyQm9keU1lbnRpb24obWVudGlvbikge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwibWVudGlvblwiLFxuICAgIGlkOiBtZW50aW9uLmlkLFxuICAgIGNoaWxkcmVuOiBbeyB0ZXh0OiBcIlwiIH1dXG4gIH07XG59XG5mdW5jdGlvbiBjb21tZW50Qm9keUxpbmtUb0NvbXBvc2VyQm9keUxpbmsobGluaykge1xuICBpZiAobGluay50ZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiY3VzdG9tLWxpbmtcIixcbiAgICAgIHVybDogbGluay51cmwsXG4gICAgICBjaGlsZHJlbjogW3sgdGV4dDogbGluay50ZXh0IH1dXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJhdXRvLWxpbmtcIixcbiAgICAgIHVybDogbGluay51cmwsXG4gICAgICBjaGlsZHJlbjogW3sgdGV4dDogbGluay51cmwgfV1cbiAgICB9O1xuICB9XG59XG5mdW5jdGlvbiBjb21wb3NlckJvZHlUb0NvbW1lbnRCb2R5KGJvZHkpIHtcbiAgcmV0dXJuIHtcbiAgICB2ZXJzaW9uOiAxLFxuICAgIGNvbnRlbnQ6IGJvZHkubWFwKChibG9jaykgPT4ge1xuICAgICAgaWYgKGJsb2NrLnR5cGUgIT09IFwicGFyYWdyYXBoXCIpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBjaGlsZHJlbiA9IGJsb2NrLmNoaWxkcmVuLm1hcCgoaW5saW5lKSA9PiB7XG4gICAgICAgIGlmIChpc0NvbXBvc2VyQm9keU1lbnRpb24oaW5saW5lKSkge1xuICAgICAgICAgIHJldHVybiBjb21wb3NlckJvZHlNZW50aW9uVG9Db21tZW50Qm9keU1lbnRpb24oaW5saW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNDb21wb3NlckJvZHlBdXRvTGluayhpbmxpbmUpKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbXBvc2VyQm9keUF1dG9MaW5rVG9Db21tZW50Qm9keUxpbmsoaW5saW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNDb21wb3NlckJvZHlDdXN0b21MaW5rKGlubGluZSkpIHtcbiAgICAgICAgICByZXR1cm4gY29tcG9zZXJCb2R5Q3VzdG9tTGlua1RvQ29tbWVudEJvZHlMaW5rKGlubGluZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzVGV4dChpbmxpbmUpKSB7XG4gICAgICAgICAgcmV0dXJuIGlubGluZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pLmZpbHRlcihleGlzdHMpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgIGNoaWxkcmVuXG4gICAgICB9O1xuICAgIH0pLmZpbHRlcihleGlzdHMpXG4gIH07XG59XG5jb25zdCBlbXB0eUNvbXBvc2VyQm9keSA9IFtdO1xuZnVuY3Rpb24gY29tbWVudEJvZHlUb0NvbXBvc2VyQm9keShib2R5KSB7XG4gIGlmICghYm9keSB8fCAhYm9keT8uY29udGVudCkge1xuICAgIHJldHVybiBlbXB0eUNvbXBvc2VyQm9keTtcbiAgfVxuICByZXR1cm4gYm9keS5jb250ZW50Lm1hcCgoYmxvY2spID0+IHtcbiAgICBpZiAoYmxvY2sudHlwZSAhPT0gXCJwYXJhZ3JhcGhcIikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGNoaWxkcmVuID0gYmxvY2suY2hpbGRyZW4ubWFwKChpbmxpbmUpID0+IHtcbiAgICAgIGlmIChpc0NvbW1lbnRCb2R5TWVudGlvbihpbmxpbmUpKSB7XG4gICAgICAgIHJldHVybiBjb21tZW50Qm9keU1lbnRpb25Ub0NvbXBvc2VyQm9keU1lbnRpb24oaW5saW5lKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0NvbW1lbnRCb2R5TGluayhpbmxpbmUpKSB7XG4gICAgICAgIHJldHVybiBjb21tZW50Qm9keUxpbmtUb0NvbXBvc2VyQm9keUxpbmsoaW5saW5lKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0NvbW1lbnRCb2R5VGV4dChpbmxpbmUpKSB7XG4gICAgICAgIHJldHVybiBpbmxpbmU7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9KS5maWx0ZXIoZXhpc3RzKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uYmxvY2ssXG4gICAgICBjaGlsZHJlblxuICAgIH07XG4gIH0pLmZpbHRlcihleGlzdHMpO1xufVxuZnVuY3Rpb24gZ2V0UGxhY2VtZW50RnJvbVBvc2l0aW9uKHBvc2l0aW9uLCBkaXJlY3Rpb24gPSBcImx0clwiKSB7XG4gIHJldHVybiBgJHtwb3NpdGlvbn0tJHtkaXJlY3Rpb24gPT09IFwicnRsXCIgPyBcImVuZFwiIDogXCJzdGFydFwifWA7XG59XG5mdW5jdGlvbiBnZXRTaWRlQW5kQWxpZ25Gcm9tUGxhY2VtZW50KHBsYWNlbWVudCkge1xuICBjb25zdCBbc2lkZSwgYWxpZ24gPSBcImNlbnRlclwiXSA9IHBsYWNlbWVudC5zcGxpdChcIi1cIik7XG4gIHJldHVybiBbc2lkZSwgYWxpZ25dO1xufVxuXG5leHBvcnQgeyBjb21tZW50Qm9keUxpbmtUb0NvbXBvc2VyQm9keUxpbmssIGNvbW1lbnRCb2R5TWVudGlvblRvQ29tcG9zZXJCb2R5TWVudGlvbiwgY29tbWVudEJvZHlUb0NvbXBvc2VyQm9keSwgY29tcG9zZXJCb2R5QXV0b0xpbmtUb0NvbW1lbnRCb2R5TGluaywgY29tcG9zZXJCb2R5Q3VzdG9tTGlua1RvQ29tbWVudEJvZHlMaW5rLCBjb21wb3NlckJvZHlNZW50aW9uVG9Db21tZW50Qm9keU1lbnRpb24sIGNvbXBvc2VyQm9keVRvQ29tbWVudEJvZHksIGdldFBsYWNlbWVudEZyb21Qb3NpdGlvbiwgZ2V0U2lkZUFuZEFsaWduRnJvbVBsYWNlbWVudCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbHMubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Composer/utils.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/contexts.mjs":
/*!************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/contexts.mjs ***!
  \************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EmojiPickerContext: () => (/* binding */ EmojiPickerContext),\n/* harmony export */   useEmojiPicker: () => (/* binding */ useEmojiPicker)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\n\nconst EmojiPickerContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(\n  null\n);\nfunction useEmojiPicker() {\n  const emojiPickerContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(EmojiPickerContext);\n  return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_1__.nn)(\n    emojiPickerContext,\n    \"EmojiPicker.Root is missing from the React tree.\"\n  );\n}\n\n\n//# sourceMappingURL=contexts.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0Vtb2ppUGlja2VyL2NvbnRleHRzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXNDO0FBQ1k7O0FBRWxELDJCQUEyQixvREFBYTtBQUN4QztBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsaURBQVU7QUFDdkMsU0FBUyxvREFBRTtBQUNYO0FBQ0E7QUFDQTtBQUNBOztBQUU4QztBQUM5QyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvcHJpbWl0aXZlcy9FbW9qaVBpY2tlci9jb250ZXh0cy5tanM/NjcxYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBubiB9IGZyb20gJ0BsaXZlYmxvY2tzL2NvcmUnO1xuaW1wb3J0IHsgY3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcblxuY29uc3QgRW1vamlQaWNrZXJDb250ZXh0ID0gY3JlYXRlQ29udGV4dChcbiAgbnVsbFxuKTtcbmZ1bmN0aW9uIHVzZUVtb2ppUGlja2VyKCkge1xuICBjb25zdCBlbW9qaVBpY2tlckNvbnRleHQgPSB1c2VDb250ZXh0KEVtb2ppUGlja2VyQ29udGV4dCk7XG4gIHJldHVybiBubihcbiAgICBlbW9qaVBpY2tlckNvbnRleHQsXG4gICAgXCJFbW9qaVBpY2tlci5Sb290IGlzIG1pc3NpbmcgZnJvbSB0aGUgUmVhY3QgdHJlZS5cIlxuICApO1xufVxuXG5leHBvcnQgeyBFbW9qaVBpY2tlckNvbnRleHQsIHVzZUVtb2ppUGlja2VyIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb250ZXh0cy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/contexts.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/index.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/index.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Content: () => (/* binding */ EmojiPickerContent),\n/* harmony export */   Root: () => (/* binding */ EmojiPickerRoot),\n/* harmony export */   Search: () => (/* binding */ EmojiPickerSearch)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react_virtuoso__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! react-virtuoso */ \"(ssr)/./node_modules/react-virtuoso/dist/index.mjs\");\n/* harmony import */ var _utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/is-key.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-key.mjs\");\n/* harmony import */ var _utils_request_idle_callback_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/request-idle-callback.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/request-idle-callback.mjs\");\n/* harmony import */ var _utils_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../utils/use-layout-effect.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs\");\n/* harmony import */ var _utils_use_transition_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/use-transition.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-transition.mjs\");\n/* harmony import */ var _utils_visually_hidden_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../utils/visually-hidden.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/visually-hidden.mjs\");\n/* harmony import */ var _internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../internal/Emoji.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/internal/Emoji.mjs\");\n/* harmony import */ var _contexts_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./contexts.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/contexts.mjs\");\n/* harmony import */ var _utils_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/utils.mjs\");\n/* __next_internal_client_entry_do_not_use__ Content,Root,Search auto */ \n\n\n\n\n\n\n\n\n\n\nconst DEFAULT_COLUMNS = 10;\nconst DEFAULT_LOCALE = \"en\";\nconst LOADING_MINIMUM_TIMEOUT = 100;\nconst EMOJIPICKER_ROOT_NAME = \"EmojiPickerRoot\";\nconst EMOJIPICKER_CONTENT_NAME = \"EmojiPickerContent\";\nconst EMOJIPICKER_SEARCH_NAME = \"EmojiPickerSearch\";\nfunction EmojiPickerRoot({ columns = DEFAULT_COLUMNS, locale = DEFAULT_LOCALE, onEmojiSelect, children }) {\n    const emojiData = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)();\n    const search = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(\"\");\n    const [, startEmojisTransition] = (0,_utils_use_transition_mjs__WEBPACK_IMPORTED_MODULE_1__.useTransition)();\n    const [data, setData] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)();\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)();\n    const [selectedColumnIndex, setSelectedColumnIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0);\n    const [selectedRowIndex, setSelectedRowIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0);\n    const [interaction, setInteraction] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\"none\");\n    const selectCurrentEmoji = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (onEmojiSelect) {\n            const emoji = data?.rows[selectedRowIndex]?.[selectedColumnIndex];\n            if (emoji) {\n                onEmojiSelect(emoji.emoji);\n            }\n        }\n    }, [\n        data?.rows,\n        onEmojiSelect,\n        selectedColumnIndex,\n        selectedRowIndex\n    ]);\n    const resetSelection = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        setSelectedColumnIndex(0);\n        setSelectedRowIndex(0);\n    }, []);\n    const setPointerSelection = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((columnIndex, rowIndex)=>{\n        setInteraction(\"pointer\");\n        setSelectedColumnIndex(columnIndex);\n        setSelectedRowIndex(rowIndex);\n    }, []);\n    const moveSelection = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((direction, event)=>{\n        if (!data) {\n            return;\n        }\n        event.preventDefault();\n        if (interaction === \"none\") {\n            setInteraction(\"keyboard\");\n            return;\n        }\n        setInteraction(\"keyboard\");\n        switch(direction){\n            case \"left\":\n                {\n                    if (selectedColumnIndex === 0) {\n                        const previousRowIndex = selectedRowIndex - 1;\n                        const previousRow = data.rows[previousRowIndex];\n                        if (previousRow) {\n                            setSelectedRowIndex(previousRowIndex);\n                            setSelectedColumnIndex(previousRow.length - 1);\n                        }\n                    } else {\n                        setSelectedColumnIndex(selectedColumnIndex - 1);\n                    }\n                    break;\n                }\n            case \"right\":\n                {\n                    const currentRow = data.rows[selectedRowIndex];\n                    if (selectedColumnIndex === currentRow.length - 1) {\n                        const nextRowIndex = selectedRowIndex + 1;\n                        const nextRow = data.rows[nextRowIndex];\n                        if (nextRow) {\n                            setSelectedRowIndex(nextRowIndex);\n                            setSelectedColumnIndex(0);\n                        }\n                    } else {\n                        setSelectedColumnIndex(selectedColumnIndex + 1);\n                    }\n                    break;\n                }\n            case \"up\":\n                {\n                    const previousRow = data.rows[selectedRowIndex - 1];\n                    if (previousRow) {\n                        setSelectedRowIndex(selectedRowIndex - 1);\n                        if (!previousRow[selectedColumnIndex]) {\n                            setSelectedColumnIndex(previousRow.length - 1);\n                        }\n                    }\n                    break;\n                }\n            case \"down\":\n                {\n                    const nextRow = data.rows[selectedRowIndex + 1];\n                    if (nextRow) {\n                        setSelectedRowIndex(selectedRowIndex + 1);\n                        if (!nextRow[selectedColumnIndex]) {\n                            setSelectedColumnIndex(nextRow.length - 1);\n                        }\n                    }\n                    break;\n                }\n        }\n    }, [\n        data,\n        interaction,\n        selectedColumnIndex,\n        selectedRowIndex\n    ]);\n    const updateEmojis = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (!emojiData.current) {\n            return;\n        }\n        startEmojisTransition(()=>{\n            setData(()=>{\n                if (!emojiData.current) {\n                    return;\n                }\n                const filteredEmojis = (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_2__.filterEmojis)(emojiData.current.emojis, search.current);\n                return (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_2__.generateEmojiPickerData)(filteredEmojis, emojiData.current.categories, columns);\n            });\n            resetSelection();\n        });\n    }, [\n        columns,\n        resetSelection\n    ]);\n    const handleSearch = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((value)=>{\n        search.current = value;\n        updateEmojis();\n    }, [\n        updateEmojis\n    ]);\n    const initializeEmojiData = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async (locale2)=>{\n        try {\n            emojiData.current = await (0,_utils_mjs__WEBPACK_IMPORTED_MODULE_2__.getEmojiData)(locale2);\n            updateEmojis();\n        } catch (error2) {\n            setError(error2);\n        }\n    }, [\n        updateEmojis\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        let idleCallbackId;\n        const timeoutId = setTimeout(()=>{\n            idleCallbackId = (0,_utils_request_idle_callback_mjs__WEBPACK_IMPORTED_MODULE_3__.requestIdleCallback)(()=>{\n                initializeEmojiData(locale);\n            });\n        }, LOADING_MINIMUM_TIMEOUT);\n        return ()=>{\n            clearTimeout(timeoutId);\n            (0,_utils_request_idle_callback_mjs__WEBPACK_IMPORTED_MODULE_3__.cancelIdleCallback)(idleCallbackId);\n        };\n    }, [\n        locale\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (interaction === \"none\") {\n            resetSelection();\n        }\n    }, [\n        interaction\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_contexts_mjs__WEBPACK_IMPORTED_MODULE_4__.EmojiPickerContext.Provider, {\n        value: {\n            data,\n            error,\n            isLoading: !data && !error,\n            columns,\n            onSearch: handleSearch,\n            onEmojiSelect,\n            selectCurrentEmoji,\n            selectedRowIndex,\n            selectedColumnIndex,\n            moveSelection,\n            setPointerSelection,\n            interaction,\n            setInteraction\n        }\n    }, children);\n}\nconst EmojiPickerSearch = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ asChild, value, defaultValue, onChange, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_5__.Slot : \"input\";\n    const { onSearch, selectCurrentEmoji, moveSelection, interaction, setInteraction } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_4__.useEmojiPicker)();\n    const handleChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        onChange?.(event);\n        if (event.isDefaultPrevented()) {\n            return;\n        }\n        const value2 = event.target.value;\n        setInteraction(value2 ? \"keyboard\" : \"none\");\n        onSearch(value2);\n    }, [\n        onChange,\n        onSearch,\n        setInteraction\n    ]);\n    const handleKeyDown = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        if (event.isDefaultPrevented()) {\n            return;\n        }\n        if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_6__.isKey)(event, \"ArrowLeft\")) {\n            moveSelection(\"left\", event);\n        } else if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_6__.isKey)(event, \"ArrowRight\")) {\n            moveSelection(\"right\", event);\n        } else if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_6__.isKey)(event, \"ArrowUp\")) {\n            moveSelection(\"up\", event);\n        } else if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_6__.isKey)(event, \"ArrowDown\")) {\n            moveSelection(\"down\", event);\n        } else if ((0,_utils_is_key_mjs__WEBPACK_IMPORTED_MODULE_6__.isKey)(event, \"Enter\")) {\n            if (interaction !== \"none\") {\n                event.preventDefault();\n                selectCurrentEmoji();\n            }\n        }\n    }, [\n        interaction,\n        moveSelection,\n        selectCurrentEmoji\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        onSearch(value ? String(value) : defaultValue ? String(defaultValue) : \"\");\n    }, []);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        type: \"search\",\n        value,\n        defaultValue,\n        onChange: handleChange,\n        onKeyDown: handleKeyDown,\n        ...props,\n        ref: forwardedRef\n    });\n});\nconst defaultContentComponents = {\n    CategoryHeader: ({ category, ...props })=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            ...props\n        }, category),\n    Row: ({ children, attributes, ...props })=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            ...props\n        }, children),\n    Emoji: ({ emoji, ...props })=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"button\", {\n            ...props\n        }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(_internal_Emoji_mjs__WEBPACK_IMPORTED_MODULE_7__.Emoji, {\n            emoji\n        })),\n    Loading: (props)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            ...props\n        }),\n    Empty: (props)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            ...props\n        }),\n    Grid: (props)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            ...props\n        }),\n    Error: ({ error, ...props })=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n            ...props\n        })\n};\nconst placeholderRowAttributes = {\n    rowIndex: -1,\n    categoryRowIndex: -1,\n    categoryRowsCount: 0\n};\nconst VirtuosoScroller = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        ...props,\n        tabIndex: -1,\n        \"data-testid\": void 0,\n        ref: forwardedRef\n    }, children);\n});\nconst VirtuosoTopList = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, ...props }, forwardedRef)=>{\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        ...props,\n        \"data-testid\": void 0,\n        ref: forwardedRef\n    }, children);\n});\nconst EmojiPickerContent = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ components, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_5__.Slot : \"div\";\n    const virtuosoRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const placeholderContainerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const rowScrollMarginTopRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);\n    const rowScrollMarginBottomRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);\n    const categoryHeaderHeightRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);\n    const { data, error, isLoading, columns, onEmojiSelect, selectedColumnIndex, selectedRowIndex, setPointerSelection, interaction, setInteraction } = (0,_contexts_mjs__WEBPACK_IMPORTED_MODULE_4__.useEmojiPicker)();\n    const selectedEmoji = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>data?.rows[selectedRowIndex]?.[selectedColumnIndex], [\n        data?.rows,\n        selectedColumnIndex,\n        selectedRowIndex\n    ]);\n    const { Loading, Empty, Error, CategoryHeader, Grid, Row, Emoji } = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({\n            ...defaultContentComponents,\n            ...components\n        }), [\n        components\n    ]);\n    const VirtuosoList = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>/*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ children, ...props2 }, forwardedRef2)=>{\n            return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n                role: \"grid\",\n                \"aria-colcount\": columns,\n                ...props2,\n                \"data-testid\": void 0,\n                ref: forwardedRef2\n            }, children);\n        }), [\n        columns\n    ]);\n    const placeholderColumns = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>Array(columns).fill(\"\\uD83C\\uDF2B\"), [\n        columns\n    ]);\n    const preventDefault = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event)=>{\n        event.preventDefault();\n    }, []);\n    const handleEmojiPointerLeave = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (interaction === \"pointer\") {\n            setInteraction(\"none\");\n        }\n    }, [\n        interaction,\n        setInteraction\n    ]);\n    (0,_utils_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_8__.useLayoutEffect)(()=>{\n        if (!placeholderContainerRef.current) {\n            return;\n        }\n        const row = placeholderContainerRef.current.childNodes[0];\n        const categoryHeader = placeholderContainerRef.current.childNodes[1];\n        if (row instanceof HTMLElement) {\n            const style = window.getComputedStyle(row);\n            rowScrollMarginTopRef.current = parseFloat(style.scrollMarginTop);\n            rowScrollMarginBottomRef.current = parseFloat(style.scrollMarginBottom);\n        }\n        if (categoryHeader instanceof HTMLElement) {\n            categoryHeaderHeightRef.current = categoryHeader.offsetHeight;\n        }\n    }, []);\n    const calculateViewLocation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({ itemTop, itemBottom, viewportTop, viewportBottom, locationParams: { behavior, align, ...params } })=>{\n        if (itemTop - (categoryHeaderHeightRef.current + rowScrollMarginTopRef.current) < viewportTop) {\n            return {\n                ...params,\n                behavior,\n                align: align ?? \"start\"\n            };\n        }\n        if (itemBottom > viewportBottom) {\n            return {\n                ...params,\n                behavior,\n                align: align ?? \"end\",\n                offset: rowScrollMarginBottomRef.current\n            };\n        }\n        return null;\n    }, []);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (interaction === \"keyboard\") {\n            virtuosoRef.current?.scrollIntoView({\n                index: selectedRowIndex,\n                behavior: \"auto\",\n                calculateViewLocation\n            });\n        }\n    }, [\n        interaction,\n        selectedRowIndex,\n        calculateViewLocation\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        ...props,\n        ref: forwardedRef\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        style: {\n            visibility: \"hidden\",\n            height: 0\n        },\n        ref: placeholderContainerRef\n    }, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Row, {\n        attributes: placeholderRowAttributes\n    }, placeholderColumns.map((placeholder, index)=>/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Emoji, {\n            emoji: placeholder,\n            key: index\n        }))), /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CategoryHeader, {\n        category: \"Category\"\n    })), isLoading ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Loading, null) : error ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Error, {\n        error\n    }) : data.count === 0 ? /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Empty, null) : /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Grid, null, /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_virtuoso__WEBPACK_IMPORTED_MODULE_9__.GroupedVirtuoso, {\n        ref: virtuosoRef,\n        components: {\n            Scroller: VirtuosoScroller,\n            List: VirtuosoList,\n            TopItemList: VirtuosoTopList\n        },\n        groupCounts: data.categoriesRowCounts,\n        groupContent: (groupIndex)=>{\n            return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(CategoryHeader, {\n                category: data.categories[groupIndex]\n            });\n        },\n        itemContent: (rowIndex, groupIndex)=>{\n            const categoryRowIndex = data.categoriesRowIndices[groupIndex].indexOf(rowIndex);\n            const categoryRowsCount = data.categoriesRowCounts[groupIndex];\n            return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Row, {\n                attributes: {\n                    rowIndex,\n                    categoryRowIndex,\n                    categoryRowsCount\n                }\n            }, data.rows[rowIndex].map((emoji, columnIndex)=>{\n                const isSelected = interaction !== \"none\" && selectedColumnIndex === columnIndex && selectedRowIndex === rowIndex;\n                return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Emoji, {\n                    key: emoji.emoji,\n                    role: \"gridcell\",\n                    \"aria-colindex\": columnIndex,\n                    \"aria-selected\": isSelected || void 0,\n                    \"data-selected\": isSelected || void 0,\n                    onMouseDown: preventDefault,\n                    tabIndex: -1,\n                    onPointerEnter: ()=>{\n                        setPointerSelection(columnIndex, rowIndex);\n                    },\n                    onPointerLeave: handleEmojiPointerLeave,\n                    onClick: (event)=>{\n                        onEmojiSelect?.(emoji.emoji);\n                        event.stopPropagation();\n                    },\n                    emoji: emoji.emoji\n                });\n            }));\n        }\n    })), selectedEmoji && interaction !== \"none\" && /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", {\n        \"aria-live\": \"polite\",\n        style: _utils_visually_hidden_mjs__WEBPACK_IMPORTED_MODULE_10__.visuallyHidden\n    }, selectedEmoji.name));\n});\nif (true) {\n    EmojiPickerRoot.displayName = EMOJIPICKER_ROOT_NAME;\n    EmojiPickerContent.displayName = EMOJIPICKER_CONTENT_NAME;\n    EmojiPickerSearch.displayName = EMOJIPICKER_SEARCH_NAME;\n}\n //# sourceMappingURL=index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0Vtb2ppUGlja2VyL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkNBLE1BQUFBLGtCQUFBO0FBQ0EsTUFBQUMsaUJBQUE7QUFDQSxNQUFBQywwQkFBQTtBQUVBLE1BQUFDLHdCQUFBO0FBQ0EsTUFBQUMsMkJBQUE7QUFDQSxNQUFBQywwQkFBQTtBQWtCQSxTQUFBQyxnQkFBQSxFQUF5QkMsVUFBQVAsZUFBQSxFQUNiUSxTQUFBUCxjQUFBLEVBQ0RRLGFBQUEsRUFDVEMsUUFBQSxFQUVGO0lBQ0UsTUFBQUMsWUFBQUMsNkNBQUFBO0lBQ0EsTUFBQUMsU0FBQUQsNkNBQUFBLENBQUE7SUFDQSxTQUFBRSxzQkFBQSxHQUFBQyx3RUFBQUE7SUFDQSxPQUFBQyxNQUFBQyxRQUFBLEdBQUFDLCtDQUFBQTtJQUNBLE9BQUFDLE9BQUFDLFNBQUEsR0FBQUYsK0NBQUFBO0lBQ0EsT0FBQUcscUJBQUFDLHVCQUFBLEdBQUFKLCtDQUFBQSxDQUFBO0lBQ0EsT0FBQUssa0JBQUFDLG9CQUFBLEdBQUFOLCtDQUFBQSxDQUFBO0lBQ0EsT0FBQU8sYUFBQUMsZUFBQSxHQUFBUiwrQ0FBQUEsQ0FBQTtJQUlBLE1BQUFTLHFCQUFBQyxrREFBQUEsQ0FBQTtRQUNFLElBQUFuQixlQUFBO1lBQ0UsTUFBQW9CLFFBQUFiLE1BQUFjLElBQUEsQ0FBQVAsaUJBQUEsR0FBQUYsb0JBQUE7WUFFQSxJQUFBUSxPQUFBO2dCQUNFcEIsY0FBQW9CLE1BQUFBLEtBQUE7WUFBeUI7UUFDM0I7SUFDRjtRQUFBYixNQUFBYztRQUFBckI7UUFBQVk7UUFBQUU7S0FBQTtJQUdGLE1BQUFRLGlCQUFBSCxrREFBQUEsQ0FBQTtRQUNFTix1QkFBQTtRQUNBRSxvQkFBQTtJQUFxQjtJQUd2QixNQUFBUSxzQkFBQUosa0RBQUFBLENBQTRCLENBQUFLLGFBQUFDO1FBRXhCUixlQUFBO1FBQ0FKLHVCQUFBVztRQUNBVCxvQkFBQVU7SUFBNEIsR0FDOUI7SUFJRixNQUFBQyxnQkFBQVAsa0RBQUFBLENBQXNCLENBQUFRLFdBQUFDO1FBS2xCLEtBQUFyQixNQUFBO1lBQ0U7UUFBQTtRQUdGcUIsTUFBQUMsY0FBQTtRQUVBLElBQUFiLGdCQUFBO1lBQ0VDLGVBQUE7WUFDQTtRQUFBO1FBR0ZBLGVBQUE7UUFFQSxPQUFBVTtZQUFtQjtnQkFBQTtvQkFJZixJQUFBZix3QkFBQTt3QkFDRSxNQUFBa0IsbUJBQUFoQixtQkFBQTt3QkFDQSxNQUFBaUIsY0FBQXhCLEtBQUFjLElBQUEsQ0FBQVMsaUJBQUE7d0JBRUEsSUFBQUMsYUFBQTs0QkFDRWhCLG9CQUFBZTs0QkFDQWpCLHVCQUFBa0IsWUFBQUMsTUFBQTt3QkFBNkM7b0JBQy9DO3dCQUVBbkIsdUJBQUFELHNCQUFBO29CQUE4QztvQkFHaEQ7Z0JBQUE7WUFDRjtnQkFBQTtvQkFLRSxNQUFBcUIsYUFBQTFCLEtBQUFjLElBQUEsQ0FBQVAsaUJBQUE7b0JBRUEsSUFBQUYsd0JBQUFxQixXQUFBRCxNQUFBO3dCQUNFLE1BQUFFLGVBQUFwQixtQkFBQTt3QkFDQSxNQUFBcUIsVUFBQTVCLEtBQUFjLElBQUEsQ0FBQWEsYUFBQTt3QkFFQSxJQUFBQyxTQUFBOzRCQUNFcEIsb0JBQUFtQjs0QkFDQXJCLHVCQUFBO3dCQUF3QjtvQkFDMUI7d0JBRUFBLHVCQUFBRCxzQkFBQTtvQkFBOEM7b0JBR2hEO2dCQUFBO1lBQ0Y7Z0JBQUE7b0JBS0UsTUFBQW1CLGNBQUF4QixLQUFBYyxJQUFBLENBQUFQLG1CQUFBO29CQUVBLElBQUFpQixhQUFBO3dCQUNFaEIsb0JBQUFELG1CQUFBO3dCQUVBLEtBQUFpQixXQUFBLENBQUFuQixvQkFBQTs0QkFDRUMsdUJBQUFrQixZQUFBQyxNQUFBO3dCQUE2QztvQkFDL0M7b0JBR0Y7Z0JBQUE7WUFDRjtnQkFBQTtvQkFLRSxNQUFBRyxVQUFBNUIsS0FBQWMsSUFBQSxDQUFBUCxtQkFBQTtvQkFFQSxJQUFBcUIsU0FBQTt3QkFDRXBCLG9CQUFBRCxtQkFBQTt3QkFFQSxLQUFBcUIsT0FBQSxDQUFBdkIsb0JBQUE7NEJBQ0VDLHVCQUFBc0IsUUFBQUgsTUFBQTt3QkFBeUM7b0JBQzNDO29CQUdGO2dCQUFBO1FBQ0Y7SUFDRixHQUNGO1FBQUF6QjtRQUFBUztRQUFBSjtRQUFBRTtLQUFBO0lBSUYsTUFBQXNCLGVBQUFqQixrREFBQUEsQ0FBQTtRQUNFLEtBQUFqQixVQUFBbUMsT0FBQTtZQUNFO1FBQUE7UUFHRmhDLHNCQUFBO1lBQ0VHLFFBQUE7Z0JBQ0UsS0FBQU4sVUFBQW1DLE9BQUE7b0JBQ0U7Z0JBQUE7Z0JBR0YsTUFBQUMsaUJBQUFDLHdEQUFBQSxDQUF1QnJDLFVBQUFtQyxPQUFBLENBQUFHLE1BQUEsRUFDSHBDLE9BQUFpQyxPQUFBO2dCQUlwQixPQUFBSSxtRUFBQUEsQ0FBT0gsZ0JBQ0xwQyxVQUFBbUMsT0FBQSxDQUFBSyxVQUFBLEVBQ2tCNUM7WUFFcEI7WUFFRndCO1FBQWU7SUFDaEI7UUFBQXhCO1FBQUF3QjtLQUFBO0lBR0gsTUFBQXFCLGVBQUF4QixrREFBQUEsQ0FBcUIsQ0FBQXlCO1FBRWpCeEMsT0FBQWlDLE9BQUEsR0FBQU87UUFDQVI7SUFBYSxHQUNmO1FBQUFBO0tBQUE7SUFJRixNQUFBUyxzQkFBQTFCLGtEQUFBQSxDQUE0QixPQUFBMkI7UUFFeEI7WUFDRTVDLFVBQUFtQyxPQUFBLFNBQUFVLHdEQUFBQSxDQUFBRDtZQUNBVjtRQUFhLFNBQUFZLFFBQUE7WUFFYnJDLFNBQUFxQztRQUF1QjtJQUN6QixHQUNGO1FBQUFaO0tBQUE7SUFJRmEsZ0RBQVNBLENBQVQ7UUFDRSxJQUFBQztRQUNBLE1BQUFDLFlBQUFDLFdBQUE7WUFDRUYsaUJBQUFHLHFGQUFBQSxDQUFBO2dCQUNFUixvQkFBQTlDO1lBQTBCO1FBQzNCLEdBQUFOO1FBR0g7WUFDRTZELGFBQUFIO1lBQ0FJLG9GQUFrQkEsQ0FBbEJMO1FBQWlDO0lBQ25DO1FBQUFuRDtLQUFBO0lBR0ZrRCxnREFBU0EsQ0FBVDtRQUNFLElBQUFqQyxnQkFBQTtZQUNFTTtRQUFlO0lBQ2pCO1FBQUFOO0tBQUE7SUFHRixxQ0FBQXdDLGdEQUFBLENBQUFFLDZEQUFBQSxDQUFBQyxRQUFBO1FBQ0dmLE9BQUE7WUFDUXJDO1lBQ0xHO1lBQ0FrRCxXQUFBLENBQUFyRCxRQUFBLENBQUFHO1lBQ3NCWjtZQUN0QitELFVBQUFsQjtZQUNVM0M7WUFDVmtCO1lBQ0FKO1lBQ0FGO1lBQ0FjO1lBQ0FIO1lBQ0FQO1lBQ0FDO1FBQ0E7SUFDRixHQUFBaEI7QUFLTjtBQWVBLE1BQUE2RCxrQ0FBQUMsaURBQUFBLENBQTBCLEdBQUFDLE9BQUEsRUFBQXBCLEtBQUEsRUFBQXFCLFlBQUEsRUFBQUMsUUFBQSxLQUFBQyxPQUFBLEVBQUFDO0lBRXRCLE1BQUFDLFlBQUFMLFVBQUFNLHNEQUFBQSxHQUFBO0lBQ0EsUUFBTVQsUUFBQSxFQUNKM0Msa0JBQUEsRUFDQVEsYUFBQSxFQUNBVixXQUFBLEVBQ0FDLGNBQUEsRUFDQSxHQUFBc0QsNkRBQUFBO0lBR0YsTUFBQUMsZUFBQXJELGtEQUFBQSxDQUFxQixDQUFBUztRQUVqQnNDLFdBQUF0QztRQUVBLElBQUFBLE1BQUE2QyxrQkFBQTtZQUNFO1FBQUE7UUFHRixNQUFBQyxTQUFBOUMsTUFBQStDLE1BQUEsQ0FBQS9CLEtBQUE7UUFDQTNCLGVBQUF5RCxTQUFBO1FBQ0FiLFNBQUFhO0lBQWMsR0FDaEI7UUFBQVI7UUFBQUw7UUFBQTVDO0tBQUE7SUFJRixNQUFBMkQsZ0JBQUF6RCxrREFBQUEsQ0FBc0IsQ0FBQVM7UUFFbEIsSUFBQUEsTUFBQTZDLGtCQUFBO1lBQ0U7UUFBQTtRQUdGLElBQUFJLHdEQUFBQSxDQUFBakQsT0FBQTtZQUNFRixjQUFBLFFBQUFFO1FBQTJCLFdBQUFpRCx3REFBQUEsQ0FBQWpELE9BQUE7WUFFM0JGLGNBQUEsU0FBQUU7UUFBNEIsV0FBQWlELHdEQUFBQSxDQUFBakQsT0FBQTtZQUU1QkYsY0FBQSxNQUFBRTtRQUF5QixXQUFBaUQsd0RBQUFBLENBQUFqRCxPQUFBO1lBRXpCRixjQUFBLFFBQUFFO1FBQTJCLFdBQUFpRCx3REFBQUEsQ0FBQWpELE9BQUE7WUFFM0IsSUFBQVosZ0JBQUE7Z0JBQ0VZLE1BQUFDLGNBQUE7Z0JBQ0FYO1lBQW1CO1FBQ3JCO0lBQ0YsR0FDRjtRQUFBRjtRQUFBVTtRQUFBUjtLQUFBO0lBSUYrQixnREFBU0EsQ0FBVDtRQUNFWSxTQUFBakIsUUFBQWtDLE9BQUFsQyxTQUFBcUIsZUFBQWEsT0FBQWIsZ0JBQUE7SUFFQTtJQUdGLHFDQUFBVCxnREFBQSxDQUFBYSxXQUFBO1FBQ0dVLE1BQUE7UUFDTW5DO1FBQ0xxQjtRQUNBQyxVQUFBTTtRQUNVUSxXQUFBSjtRQUNDLEdBQUFULEtBQUE7UUFDUGMsS0FBQWI7SUFDQztBQUNQO0FBS04sTUFBQWMsMkJBQUE7SUFBK0RDLGdCQUFBLEdBQUFDLFFBQUEsS0FBQWpCLE9BQUEsaUNBQUFYLGdEQUFBO1lBQ2hCLEdBQUFXLEtBQUE7UUFBUSxHQUFBaUI7SUFBaUJDLEtBQUEsR0FBQXBGLFFBQUEsRUFBQXFGLFVBQUEsS0FBQW5CLE9BQUEsaUNBQUFYLGdEQUFBO1lBRXhCLEdBQUFXLEtBQUE7UUFBUSxHQUFBbEU7SUFBaUJzRixPQUFBLEdBQUFuRSxLQUFBLEtBQUErQyxPQUFBLGlDQUFBWCxnREFBQTtZQUVwRSxHQUFBVyxLQUFBO1FBQVcsaUNBQUFYLGdEQUFBLENBQUErQixzREFBQUEsRUFBQTtZQUNUbkU7UUFBZTtJQUNsQm9FLFNBQUEsQ0FBQXJCLFFBQUEsOEJBQUFYLGdEQUFBO1lBRW1CLEdBQUFXLEtBQUE7UUFBUTtJQUFPc0IsT0FBQSxDQUFBdEIsUUFBQSw4QkFBQVgsZ0RBQUE7WUFDakIsR0FBQVcsS0FBQTtRQUFRO0lBQU91QixNQUFBLENBQUF2QixRQUFBLDhCQUFBWCxnREFBQTtZQUNoQixHQUFBVyxLQUFBO1FBQVE7SUFBT3dCLE9BQUEsR0FBQWpGLEtBQUEsS0FBQXlELE9BQUEsaUNBQUFYLGdEQUFBO1lBRUEsR0FBQVcsS0FBQTtRQUFRO0FBQzNDO0FBRUEsTUFBQXlCLDJCQUFBO0lBQXVFbkUsVUFBQTtJQUMzRG9FLGtCQUFBO0lBQ1FDLG1CQUFBO0FBRXBCO0FBS0EsTUFBQUMsaUNBQUFoQyxpREFBQUEsQ0FBeUIsR0FBQTlELFFBQUEsS0FBQWtFLE9BQUEsRUFBQUM7SUFFckIscUNBQUFaLGdEQUFBO1FBQ0csR0FBQVcsS0FBQTtRQUFRNkIsVUFBQTtRQUFpQjtRQUFpQmYsS0FBQWI7SUFBZ0IsR0FBQW5FO0FBRTNEO0FBS04sTUFBQWdHLGdDQUFBbEMsaURBQUFBLENBQXdCLEdBQUE5RCxRQUFBLEtBQUFrRSxPQUFBLEVBQUFDO0lBRXBCLHFDQUFBWixnREFBQTtRQUNHLEdBQUFXLEtBQUE7UUFBUTtRQUFvQmMsS0FBQWI7SUFBZ0IsR0FBQW5FO0FBRTdDO0FBNEJOLE1BQUFpRyxtQ0FBQW5DLGlEQUFBQSxDQUEyQixHQUFBb0MsVUFBQSxFQUFBbkMsT0FBQSxLQUFBRyxPQUFBLEVBQUFDO0lBRXZCLE1BQUFDLFlBQUFMLFVBQUFNLHNEQUFBQSxHQUFBO0lBQ0EsTUFBQThCLGNBQUFqRyw2Q0FBQUEsQ0FBQTtJQUNBLE1BQUFrRywwQkFBQWxHLDZDQUFBQSxDQUFBO0lBQ0EsTUFBQW1HLHdCQUFBbkcsNkNBQUFBLENBQUE7SUFDQSxNQUFBb0csMkJBQUFwRyw2Q0FBQUEsQ0FBQTtJQUNBLE1BQUFxRywwQkFBQXJHLDZDQUFBQSxDQUFBO0lBQ0EsUUFBTUksSUFBQSxFQUNKRyxLQUFBLEVBQ0FrRCxTQUFBLEVBQ0E5RCxPQUFBLEVBQ0FFLGFBQUEsRUFDQVksbUJBQUEsRUFDQUUsZ0JBQUEsRUFDQVMsbUJBQUEsRUFDQVAsV0FBQSxFQUNBQyxjQUFBLEVBQ0EsR0FBQXNELDZEQUFBQTtJQUVGLE1BQUFrQyxnQkFBQUMsOENBQUFBLENBQXNCLElBQUFuRyxNQUFBYyxJQUFBLENBQUFQLGlCQUFBLEdBQUFGLG9CQUFBLEVBQ2lCO1FBQUFMLE1BQUFjO1FBQUFUO1FBQUFFO0tBQUE7SUFHdkMsUUFBQTBFLE9BQUEsRUFBQUMsS0FBQSxFQUFBRSxLQUFBLEVBQUFSLGNBQUEsRUFBQU8sSUFBQSxFQUFBTCxHQUFBLEVBQUFFLEtBQUEsS0FBQW1CLDhDQUFBQSxDQUFvRTtZQUFBLEdBQUF4Qix3QkFBQTtZQUFBLEdBQUFpQixVQUFBO1FBQUEsSUFDZDtRQUFBQTtLQUFBO0lBR3RELE1BQUFRLGVBQUFELDhDQUFBQSxDQUFxQixrQkFBQTNDLGlEQUFBQSxDQUVqQixHQUFBOUQsUUFBQSxLQUFBMkcsUUFBQSxFQUFBQztZQUVJLHFDQUFBckQsZ0RBQUE7Z0JBQ0dzRCxNQUFBO2dCQUNNLGlCQUFBaEg7Z0JBQ1UsR0FBQThHLE1BQUE7Z0JBQ1g7Z0JBQ1MzQixLQUFBNEI7WUFDUixHQUFBNUc7UUFHUCxJQUdOO1FBQUFIO0tBQUE7SUFHSixNQUFBaUgscUJBQUFMLDhDQUFBQSxDQUEyQixJQUFBTSxNQUFBbEgsU0FBQW1ILElBQUEsbUJBQ2M7UUFBQW5IO0tBQUE7SUFJekMsTUFBQStCLGlCQUFBVixrREFBQUEsQ0FBQSxDQUFBUztRQUNFQSxNQUFBQyxjQUFBO0lBQXFCO0lBR3ZCLE1BQUFxRiwwQkFBQS9GLGtEQUFBQSxDQUFBO1FBQ0UsSUFBQUgsZ0JBQUE7WUFDRUMsZUFBQTtRQUFxQjtJQUN2QjtRQUFBRDtRQUFBQztLQUFBO0lBR0ZrRyw2RUFBZUEsQ0FBZjtRQUNFLEtBQUFkLHdCQUFBaEUsT0FBQTtZQUNFO1FBQUE7UUFHRixNQUFBK0UsTUFBQWYsd0JBQUFoRSxPQUFBLENBQUFnRixVQUFBO1FBQ0EsTUFBQUMsaUJBQUFqQix3QkFBQWhFLE9BQUEsQ0FBQWdGLFVBQUE7UUFFQSxJQUFBRCxlQUFBRyxhQUFBO1lBQ0UsTUFBQUMsUUFBQUMsT0FBQUMsZ0JBQUEsQ0FBQU47WUFFQWQsc0JBQUFqRSxPQUFBLEdBQUFzRixXQUFBSCxNQUFBSSxlQUFBO1lBQ0FyQix5QkFBQWxFLE9BQUEsR0FBQXNGLFdBQUFILE1BQUFLLGtCQUFBO1FBQXNFO1FBR3hFLElBQUFQLDBCQUFBQyxhQUFBO1lBQ0VmLHdCQUFBbkUsT0FBQSxHQUFBaUYsZUFBQVEsWUFBQTtRQUFpRDtJQUNuRDtJQUlGLE1BQUFDLHdCQUFBNUcsa0RBQUFBLENBQThCLEdBQzNCNkcsT0FBQSxFQUNDQyxVQUFBLEVBQ0FDLFdBQUEsRUFDQUMsY0FBQSxFQUNBQyxnQkFBQSxFQUFBQyxRQUFBLEVBQUFDLEtBQUEsS0FBQUMsUUFBQSxFQUM2QztRQUU3QyxJQUFBUCxVQUFBeEIsQ0FBQUEsd0JBQUFuRSxPQUFBLEdBQUFpRSxzQkFBQWpFLE9BQUEsSUFBQTZGLGFBQUE7WUFLRTtnQkFBTyxHQUFBSyxNQUFBO2dCQUNGRjtnQkFDSEMsT0FBQUEsU0FBQTtZQUNnQjtRQUNsQjtRQUdGLElBQUFMLGFBQUFFLGdCQUFBO1lBQ0U7Z0JBQU8sR0FBQUksTUFBQTtnQkFDRkY7Z0JBQ0hDLE9BQUFBLFNBQUE7Z0JBQ2dCRSxRQUFBakMseUJBQUFsRSxPQUFBO1lBQ2lCO1FBQ25DO1FBR0Y7SUFBTyxHQUNUO0lBSUZZLGdEQUFTQSxDQUFUO1FBQ0UsSUFBQWpDLGdCQUFBO1lBQ0VvRixZQUFBL0QsT0FBQSxFQUFBb0csZUFBQTtnQkFBb0NDLE9BQUE1SDtnQkFDM0J1SCxVQUFBO2dCQUNHTjtZQUNWO1FBQ0Q7SUFDSDtRQUFBL0c7UUFBQUY7UUFBQWlIO0tBQUE7SUFHRixxQ0FBQXZFLGdEQUFBLENBQUFhLFdBQUE7UUFDRyxHQUFBRixLQUFBO1FBQWNjLEtBQUFiO0lBQVksaUNBQUFaLGdEQUFBO1FBQ3hCZ0UsT0FBQTtZQUNRbUIsWUFBQTtZQUNPQyxRQUFBO1FBQ0o7UUFDVjNELEtBQUFvQjtJQUNLLGlDQUFBN0MsZ0RBQUEsQ0FBQTZCLEtBQUE7UUFLSkMsWUFBQU07SUFBZ0IsR0FBQW1CLG1CQUFBOEIsR0FBQSxFQUFBQyxhQUFBSixRQUFBLDhCQUFBbEYsZ0RBQUEsQ0FBQStCLE9BQUE7WUFFWm5FLE9BQUEwSDtZQUFhQyxLQUFBTDtRQUFrQixvQ0FBQWxGLGdEQUFBLENBQUEyQixnQkFBQTtRQUluQ0MsVUFBQTtJQUF3QixLQUFBeEIsWUFBQSw4QkFBQUosZ0RBQUEsQ0FBQWdDLFNBQUEsUUFBQTlFLFFBQUEsOEJBQUE4QyxnREFBQSxDQUFBbUMsT0FBQTtRQUt4QmpGO0lBQU0sS0FBQUgsS0FBQXlJLEtBQUEsdUNBQUF4RixnREFBQSxDQUFBaUMsT0FBQSxzQ0FBQWpDLGdEQUFBLENBQUFrQyxNQUFBLG9DQUFBbEMsZ0RBQUEsQ0FBQXlGLDJEQUFBQSxFQUFBO1FBS0poRSxLQUFBbUI7UUFDTUQsWUFBQTtZQUNPK0MsVUFBQW5EO1lBQ0FvRCxNQUFBeEM7WUFDSnlDLGFBQUFuRDtRQUNPO1FBQ2ZvRCxhQUFBOUksS0FBQStJLG1CQUFBO1FBQ2tCQyxjQUFBLENBQUFDO1lBRWhCLHFDQUFBaEcsZ0RBQUEsQ0FBQTJCLGdCQUFBO2dCQUNHQyxVQUFBN0UsS0FBQW1DLFVBQUEsQ0FBQThHLFdBQUE7WUFBeUM7UUFBYTtRQUUzREMsYUFBQSxDQUFBaEksVUFBQStIO1lBRUUsTUFBQTNELG1CQUFBdEYsS0FBQW1KLG9CQUFBLENBQUFGLFdBQUEsQ0FBQUcsT0FBQSxDQUFBbEk7WUFFQSxNQUFBcUUsb0JBQUF2RixLQUFBK0ksbUJBQUEsQ0FBQUUsV0FBQTtZQUVBLHFDQUFBaEcsZ0RBQUEsQ0FBQTZCLEtBQUE7Z0JBQ0dDLFlBQUE7b0JBQ2E3RDtvQkFDVm9FO29CQUNBQztnQkFDQTtZQUNGLEdBQUF2RixLQUFBYyxJQUFBLENBQUFJLFNBQUEsQ0FBQW9ILEdBQUEsRUFBQXpILE9BQUFJO2dCQUdFLE1BQUFvSSxhQUFBNUksZ0JBQUEsVUFBQUosd0JBQUFZLGVBQUFWLHFCQUFBVztnQkFLQSxxQ0FBQStCLGdEQUFBLENBQUErQixPQUFBO29CQUNHd0QsS0FBQTNILE1BQUFBLEtBQUE7b0JBQ1kwRixNQUFBO29CQUNOLGlCQUFBdEY7b0JBQ1UsaUJBQUFvSSxjQUFBO29CQUNjLGlCQUFBQSxjQUFBO29CQUNBQyxhQUFBaEk7b0JBQ2hCbUUsVUFBQTtvQkFDSDhELGdCQUFBO3dCQUVSdkksb0JBQUFDLGFBQUFDO29CQUF5QztvQkFDM0NzSSxnQkFBQTdDO29CQUNnQjhDLFNBQUEsQ0FBQXBJO3dCQUVkNUIsZ0JBQUFvQixNQUFBQSxLQUFBO3dCQUNBUSxNQUFBcUksZUFBQTtvQkFBc0I7b0JBQ3hCN0ksT0FBQUEsTUFBQUEsS0FBQTtnQkFDYTtZQUNmO1FBR047SUFFSixLQUFBcUYsaUJBQUF6RixnQkFBQSx3Q0FBQXdDLGdEQUFBO1FBS0g7UUFBY2dFLE9BQUEwQyx1RUFBQUE7SUFBZ0IsR0FBQXpELGNBQUEwRCxJQUFBO0FBSW5DO0FBS04sSUFBQUMsSUFBQTtJQUNFdkssZ0JBQUF3SyxXQUFBLEdBQUEzSztJQUNBd0csbUJBQUFtRSxXQUFBLEdBQUExSztJQUNBbUUsa0JBQUF1RyxXQUFBLEdBQUF6SztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi4vLi4vLi4vc3JjL3ByaW1pdGl2ZXMvRW1vamlQaWNrZXIvaW5kZXgudHN4PzQxNTciXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB7IFNsb3QgfSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LXNsb3RcIjtcbmltcG9ydCB0eXBlIHsgQ2hhbmdlRXZlbnQsIEtleWJvYXJkRXZlbnQsIFN5bnRoZXRpY0V2ZW50IH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVhY3QsIHtcbiAgZm9yd2FyZFJlZixcbiAgdXNlQ2FsbGJhY2ssXG4gIHVzZUVmZmVjdCxcbiAgdXNlTWVtbyxcbiAgdXNlUmVmLFxuICB1c2VTdGF0ZSxcbn0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgdHlwZSB7XG4gIENhbGN1bGF0ZVZpZXdMb2NhdGlvblBhcmFtcyxcbiAgR3JvdXBlZFZpcnR1b3NvSGFuZGxlLFxuICBMaXN0UHJvcHMgYXMgVmlydHVvc29MaXN0UHJvcHMsXG4gIFNjcm9sbGVyUHJvcHMsXG4gIFRvcEl0ZW1MaXN0UHJvcHMsXG59IGZyb20gXCJyZWFjdC12aXJ0dW9zb1wiO1xuaW1wb3J0IHsgR3JvdXBlZFZpcnR1b3NvIH0gZnJvbSBcInJlYWN0LXZpcnR1b3NvXCI7XG5cbmltcG9ydCB7IGlzS2V5IH0gZnJvbSBcIi4uLy4uL3V0aWxzL2lzLWtleVwiO1xuaW1wb3J0IHtcbiAgY2FuY2VsSWRsZUNhbGxiYWNrLFxuICByZXF1ZXN0SWRsZUNhbGxiYWNrLFxufSBmcm9tIFwiLi4vLi4vdXRpbHMvcmVxdWVzdC1pZGxlLWNhbGxiYWNrXCI7XG5pbXBvcnQgeyB1c2VMYXlvdXRFZmZlY3QgfSBmcm9tIFwiLi4vLi4vdXRpbHMvdXNlLWxheW91dC1lZmZlY3RcIjtcbmltcG9ydCB7IHVzZVRyYW5zaXRpb24gfSBmcm9tIFwiLi4vLi4vdXRpbHMvdXNlLXRyYW5zaXRpb25cIjtcbmltcG9ydCB7IHZpc3VhbGx5SGlkZGVuIH0gZnJvbSBcIi4uLy4uL3V0aWxzL3Zpc3VhbGx5LWhpZGRlblwiO1xuaW1wb3J0IHsgRW1vamkgYXMgRW1vamlQcmltaXRpdmUgfSBmcm9tIFwiLi4vaW50ZXJuYWwvRW1vamlcIjtcbmltcG9ydCB7IEVtb2ppUGlja2VyQ29udGV4dCwgdXNlRW1vamlQaWNrZXIgfSBmcm9tIFwiLi9jb250ZXh0c1wiO1xuaW1wb3J0IHR5cGUge1xuICBFbW9qaURhdGEsXG4gIEVtb2ppUGlja2VyQ29udGVudENvbXBvbmVudHMsXG4gIEVtb2ppUGlja2VyQ29udGVudEVtb2ppUm93QXR0cmlidXRlcyxcbiAgRW1vamlQaWNrZXJDb250ZW50UHJvcHMsXG4gIEVtb2ppUGlja2VyRGF0YSxcbiAgRW1vamlQaWNrZXJSb290UHJvcHMsXG4gIEVtb2ppUGlja2VyU2VhcmNoUHJvcHMsXG4gIEVtb2ppUGlja2VyU2VsZWN0aW9uRGlyZWN0aW9uLFxufSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgZmlsdGVyRW1vamlzLCBnZW5lcmF0ZUVtb2ppUGlja2VyRGF0YSwgZ2V0RW1vamlEYXRhIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuY29uc3QgREVGQVVMVF9DT0xVTU5TID0gMTA7XG5jb25zdCBERUZBVUxUX0xPQ0FMRSA9IFwiZW5cIjtcbmNvbnN0IExPQURJTkdfTUlOSU1VTV9USU1FT1VUID0gMTAwO1xuXG5jb25zdCBFTU9KSVBJQ0tFUl9ST09UX05BTUUgPSBcIkVtb2ppUGlja2VyUm9vdFwiO1xuY29uc3QgRU1PSklQSUNLRVJfQ09OVEVOVF9OQU1FID0gXCJFbW9qaVBpY2tlckNvbnRlbnRcIjtcbmNvbnN0IEVNT0pJUElDS0VSX1NFQVJDSF9OQU1FID0gXCJFbW9qaVBpY2tlclNlYXJjaFwiO1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKiBUaGUgRW1vamlQaWNrZXIgcHJpbWl0aXZlIGlzIHVuZG9jdW1lbnRlZCBmb3Igbm93IGFuZCBzdWJqZWN0IHRvIGNoYW5nZSxcbiAqIHVzZSBhdCB5b3VyIG93biByaXNrLiBJZiB5b3UgaGF2ZSBhbnkgZmVlZGJhY2sgb24gaXQsIHBsZWFzZSBsZXQgdXMga25vdyFcbiAqIFNlZSBob3cgd2UgdXNlIGl0IGluIHRoZSBkZWZhdWx0IGNvbXBvbmVudHMgdG8gbGVhcm4gaG93IHRvIHVzZSBpdDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9saXZlYmxvY2tzL2xpdmVibG9ja3MvYmxvYi9tYWluL3BhY2thZ2VzL2xpdmVibG9ja3MtcmVhY3QtdWkvc3JjL2NvbXBvbmVudHMvaW50ZXJuYWwvRW1vamlQaWNrZXIudHN4LlxuICpcbiAqIFN1cnJvdW5kcyB0aGUgZW1vamkgcGlja2VyLCBpdCBoYW5kbGVzIGVtb2ppIGRhdGEgYW5kIGNvb3JkaW5hdGVzXG4gKiBgRW1vamlQaWNrZXIuU2VhcmNoYCBhbmQgYEVtb2ppUGlja2VyLkNvbnRlbnRgLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8RW1vamlQaWNrZXIuUm9vdD5cbiAqICAgPEVtb2ppUGlja2VyLlNlYXJjaCAvPlxuICogICA8RW1vamlQaWNrZXIuQ29udGVudCAvPlxuICogPC9FbW9qaVBpY2tlci5Sb290PlxuICovXG5mdW5jdGlvbiBFbW9qaVBpY2tlclJvb3Qoe1xuICBjb2x1bW5zID0gREVGQVVMVF9DT0xVTU5TLFxuICBsb2NhbGUgPSBERUZBVUxUX0xPQ0FMRSxcbiAgb25FbW9qaVNlbGVjdCxcbiAgY2hpbGRyZW4sXG59OiBFbW9qaVBpY2tlclJvb3RQcm9wcykge1xuICBjb25zdCBlbW9qaURhdGEgPSB1c2VSZWY8RW1vamlEYXRhPigpO1xuICBjb25zdCBzZWFyY2ggPSB1c2VSZWYoXCJcIik7XG4gIGNvbnN0IFssIHN0YXJ0RW1vamlzVHJhbnNpdGlvbl0gPSB1c2VUcmFuc2l0aW9uKCk7XG4gIGNvbnN0IFtkYXRhLCBzZXREYXRhXSA9IHVzZVN0YXRlPEVtb2ppUGlja2VyRGF0YT4oKTtcbiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZTxFcnJvcj4oKTtcbiAgY29uc3QgW3NlbGVjdGVkQ29sdW1uSW5kZXgsIHNldFNlbGVjdGVkQ29sdW1uSW5kZXhdID0gdXNlU3RhdGUoMCk7XG4gIGNvbnN0IFtzZWxlY3RlZFJvd0luZGV4LCBzZXRTZWxlY3RlZFJvd0luZGV4XSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbaW50ZXJhY3Rpb24sIHNldEludGVyYWN0aW9uXSA9IHVzZVN0YXRlPFxuICAgIFwia2V5Ym9hcmRcIiB8IFwicG9pbnRlclwiIHwgXCJub25lXCJcbiAgPihcIm5vbmVcIik7XG5cbiAgY29uc3Qgc2VsZWN0Q3VycmVudEVtb2ppID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChvbkVtb2ppU2VsZWN0KSB7XG4gICAgICBjb25zdCBlbW9qaSA9IGRhdGE/LnJvd3Nbc2VsZWN0ZWRSb3dJbmRleF0/LltzZWxlY3RlZENvbHVtbkluZGV4XTtcblxuICAgICAgaWYgKGVtb2ppKSB7XG4gICAgICAgIG9uRW1vamlTZWxlY3QoZW1vamkuZW1vamkpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgW2RhdGE/LnJvd3MsIG9uRW1vamlTZWxlY3QsIHNlbGVjdGVkQ29sdW1uSW5kZXgsIHNlbGVjdGVkUm93SW5kZXhdKTtcblxuICBjb25zdCByZXNldFNlbGVjdGlvbiA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRTZWxlY3RlZENvbHVtbkluZGV4KDApO1xuICAgIHNldFNlbGVjdGVkUm93SW5kZXgoMCk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBzZXRQb2ludGVyU2VsZWN0aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgKGNvbHVtbkluZGV4OiBudW1iZXIsIHJvd0luZGV4OiBudW1iZXIpID0+IHtcbiAgICAgIHNldEludGVyYWN0aW9uKFwicG9pbnRlclwiKTtcbiAgICAgIHNldFNlbGVjdGVkQ29sdW1uSW5kZXgoY29sdW1uSW5kZXgpO1xuICAgICAgc2V0U2VsZWN0ZWRSb3dJbmRleChyb3dJbmRleCk7XG4gICAgfSxcbiAgICBbXVxuICApO1xuXG4gIGNvbnN0IG1vdmVTZWxlY3Rpb24gPSB1c2VDYWxsYmFjayhcbiAgICAoXG4gICAgICBkaXJlY3Rpb246IEVtb2ppUGlja2VyU2VsZWN0aW9uRGlyZWN0aW9uLFxuICAgICAgZXZlbnQ6IEtleWJvYXJkRXZlbnQ8SFRNTElucHV0RWxlbWVudD5cbiAgICApID0+IHtcbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIGlmIChpbnRlcmFjdGlvbiA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgc2V0SW50ZXJhY3Rpb24oXCJrZXlib2FyZFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzZXRJbnRlcmFjdGlvbihcImtleWJvYXJkXCIpO1xuXG4gICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xuICAgICAgICAvLyBJZiBmaXJzdCBjb2x1bW4sIG1vdmUgdG8gbGFzdCBjb2x1bW4gb2YgcHJldmlvdXMgcm93IChpZiBhdmFpbGFibGUpXG4gICAgICAgIC8vIE90aGVyd2lzZSwgbW92ZSB0byBwcmV2aW91cyBjb2x1bW5cbiAgICAgICAgY2FzZSBcImxlZnRcIjoge1xuICAgICAgICAgIGlmIChzZWxlY3RlZENvbHVtbkluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBwcmV2aW91c1Jvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAtIDE7XG4gICAgICAgICAgICBjb25zdCBwcmV2aW91c1JvdyA9IGRhdGEucm93c1twcmV2aW91c1Jvd0luZGV4XTtcblxuICAgICAgICAgICAgaWYgKHByZXZpb3VzUm93KSB7XG4gICAgICAgICAgICAgIHNldFNlbGVjdGVkUm93SW5kZXgocHJldmlvdXNSb3dJbmRleCk7XG4gICAgICAgICAgICAgIHNldFNlbGVjdGVkQ29sdW1uSW5kZXgocHJldmlvdXNSb3cubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNldFNlbGVjdGVkQ29sdW1uSW5kZXgoc2VsZWN0ZWRDb2x1bW5JbmRleCAtIDEpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgbGFzdCBjb2x1bW4sIG1vdmUgdG8gZmlyc3QgY29sdW1uIG9mIG5leHQgcm93IChpZiBhdmFpbGFibGUpXG4gICAgICAgIC8vIE90aGVyd2lzZSwgbW92ZSB0byBuZXh0IGNvbHVtblxuICAgICAgICBjYXNlIFwicmlnaHRcIjoge1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3cgPSBkYXRhLnJvd3Nbc2VsZWN0ZWRSb3dJbmRleF07XG5cbiAgICAgICAgICBpZiAoc2VsZWN0ZWRDb2x1bW5JbmRleCA9PT0gY3VycmVudFJvdy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBjb25zdCBuZXh0Um93SW5kZXggPSBzZWxlY3RlZFJvd0luZGV4ICsgMTtcbiAgICAgICAgICAgIGNvbnN0IG5leHRSb3cgPSBkYXRhLnJvd3NbbmV4dFJvd0luZGV4XTtcblxuICAgICAgICAgICAgaWYgKG5leHRSb3cpIHtcbiAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRSb3dJbmRleChuZXh0Um93SW5kZXgpO1xuICAgICAgICAgICAgICBzZXRTZWxlY3RlZENvbHVtbkluZGV4KDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRTZWxlY3RlZENvbHVtbkluZGV4KHNlbGVjdGVkQ29sdW1uSW5kZXggKyAxKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1vdmUgdG8gc2FtZSBjb2x1bW4gb2YgcHJldmlvdXMgcm93XG4gICAgICAgIC8vIElmIHNhbWUgY29sdW1uIGlzIG5vdCBhdmFpbGFibGUsIG1vdmUgdG8gbGFzdCBjb2x1bW4gb2YgcHJldmlvdXMgcm93XG4gICAgICAgIGNhc2UgXCJ1cFwiOiB7XG4gICAgICAgICAgY29uc3QgcHJldmlvdXNSb3cgPSBkYXRhLnJvd3Nbc2VsZWN0ZWRSb3dJbmRleCAtIDFdO1xuXG4gICAgICAgICAgaWYgKHByZXZpb3VzUm93KSB7XG4gICAgICAgICAgICBzZXRTZWxlY3RlZFJvd0luZGV4KHNlbGVjdGVkUm93SW5kZXggLSAxKTtcblxuICAgICAgICAgICAgaWYgKCFwcmV2aW91c1Jvd1tzZWxlY3RlZENvbHVtbkluZGV4XSkge1xuICAgICAgICAgICAgICBzZXRTZWxlY3RlZENvbHVtbkluZGV4KHByZXZpb3VzUm93Lmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTW92ZSB0byBzYW1lIGNvbHVtbiBvZiBuZXh0IHJvd1xuICAgICAgICAvLyBJZiBzYW1lIGNvbHVtbiBpcyBub3QgYXZhaWxhYmxlLCBtb3ZlIHRvIGxhc3QgY29sdW1uIG9mIG5leHQgcm93XG4gICAgICAgIGNhc2UgXCJkb3duXCI6IHtcbiAgICAgICAgICBjb25zdCBuZXh0Um93ID0gZGF0YS5yb3dzW3NlbGVjdGVkUm93SW5kZXggKyAxXTtcblxuICAgICAgICAgIGlmIChuZXh0Um93KSB7XG4gICAgICAgICAgICBzZXRTZWxlY3RlZFJvd0luZGV4KHNlbGVjdGVkUm93SW5kZXggKyAxKTtcblxuICAgICAgICAgICAgaWYgKCFuZXh0Um93W3NlbGVjdGVkQ29sdW1uSW5kZXhdKSB7XG4gICAgICAgICAgICAgIHNldFNlbGVjdGVkQ29sdW1uSW5kZXgobmV4dFJvdy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgW2RhdGEsIGludGVyYWN0aW9uLCBzZWxlY3RlZENvbHVtbkluZGV4LCBzZWxlY3RlZFJvd0luZGV4XVxuICApO1xuXG4gIGNvbnN0IHVwZGF0ZUVtb2ppcyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoIWVtb2ppRGF0YS5jdXJyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RhcnRFbW9qaXNUcmFuc2l0aW9uKCgpID0+IHtcbiAgICAgIHNldERhdGEoKCkgPT4ge1xuICAgICAgICBpZiAoIWVtb2ppRGF0YS5jdXJyZW50KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmlsdGVyZWRFbW9qaXMgPSBmaWx0ZXJFbW9qaXMoXG4gICAgICAgICAgZW1vamlEYXRhLmN1cnJlbnQuZW1vamlzLFxuICAgICAgICAgIHNlYXJjaC5jdXJyZW50XG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIGdlbmVyYXRlRW1vamlQaWNrZXJEYXRhKFxuICAgICAgICAgIGZpbHRlcmVkRW1vamlzLFxuICAgICAgICAgIGVtb2ppRGF0YS5jdXJyZW50LmNhdGVnb3JpZXMsXG4gICAgICAgICAgY29sdW1uc1xuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICByZXNldFNlbGVjdGlvbigpO1xuICAgIH0pO1xuICB9LCBbY29sdW1ucywgcmVzZXRTZWxlY3Rpb25dKTtcblxuICBjb25zdCBoYW5kbGVTZWFyY2ggPSB1c2VDYWxsYmFjayhcbiAgICAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgc2VhcmNoLmN1cnJlbnQgPSB2YWx1ZTtcbiAgICAgIHVwZGF0ZUVtb2ppcygpO1xuICAgIH0sXG4gICAgW3VwZGF0ZUVtb2ppc11cbiAgKTtcblxuICBjb25zdCBpbml0aWFsaXplRW1vamlEYXRhID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKGxvY2FsZTogc3RyaW5nKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBlbW9qaURhdGEuY3VycmVudCA9IGF3YWl0IGdldEVtb2ppRGF0YShsb2NhbGUpO1xuICAgICAgICB1cGRhdGVFbW9qaXMoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHNldEVycm9yKGVycm9yIGFzIEVycm9yKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFt1cGRhdGVFbW9qaXNdXG4gICk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBsZXQgaWRsZUNhbGxiYWNrSWQ6IG51bWJlcjtcbiAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlkbGVDYWxsYmFja0lkID0gcmVxdWVzdElkbGVDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGluaXRpYWxpemVFbW9qaURhdGEobG9jYWxlKTtcbiAgICAgIH0pO1xuICAgIH0sIExPQURJTkdfTUlOSU1VTV9USU1FT1VUKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIGNhbmNlbElkbGVDYWxsYmFjayhpZGxlQ2FsbGJhY2tJZCk7XG4gICAgfTtcbiAgfSwgW2xvY2FsZV0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGludGVyYWN0aW9uID09PSBcIm5vbmVcIikge1xuICAgICAgcmVzZXRTZWxlY3Rpb24oKTtcbiAgICB9XG4gIH0sIFtpbnRlcmFjdGlvbl0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuXG4gIHJldHVybiAoXG4gICAgPEVtb2ppUGlja2VyQ29udGV4dC5Qcm92aWRlclxuICAgICAgdmFsdWU9e3tcbiAgICAgICAgZGF0YTogZGF0YSBhcyBFbW9qaVBpY2tlckRhdGEsXG4gICAgICAgIGVycm9yOiBlcnJvciBhcyB1bmRlZmluZWQsXG4gICAgICAgIGlzTG9hZGluZzogKCFkYXRhICYmICFlcnJvcikgYXMgZmFsc2UsXG4gICAgICAgIGNvbHVtbnMsXG4gICAgICAgIG9uU2VhcmNoOiBoYW5kbGVTZWFyY2gsXG4gICAgICAgIG9uRW1vamlTZWxlY3QsXG4gICAgICAgIHNlbGVjdEN1cnJlbnRFbW9qaSxcbiAgICAgICAgc2VsZWN0ZWRSb3dJbmRleCxcbiAgICAgICAgc2VsZWN0ZWRDb2x1bW5JbmRleCxcbiAgICAgICAgbW92ZVNlbGVjdGlvbixcbiAgICAgICAgc2V0UG9pbnRlclNlbGVjdGlvbixcbiAgICAgICAgaW50ZXJhY3Rpb24sXG4gICAgICAgIHNldEludGVyYWN0aW9uLFxuICAgICAgfX1cbiAgICA+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9FbW9qaVBpY2tlckNvbnRleHQuUHJvdmlkZXI+XG4gICk7XG59XG5cbi8qKlxuICogQHByaXZhdGVcbiAqIFRoZSBFbW9qaVBpY2tlciBwcmltaXRpdmUgaXMgdW5kb2N1bWVudGVkIGZvciBub3cgYW5kIHN1YmplY3QgdG8gY2hhbmdlLFxuICogdXNlIGF0IHlvdXIgb3duIHJpc2suIElmIHlvdSBoYXZlIGFueSBmZWVkYmFjayBvbiBpdCwgcGxlYXNlIGxldCB1cyBrbm93IVxuICogU2VlIGhvdyB3ZSB1c2UgaXQgaW4gdGhlIGRlZmF1bHQgY29tcG9uZW50cyB0byBsZWFybiBob3cgdG8gdXNlIGl0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2xpdmVibG9ja3MvbGl2ZWJsb2Nrcy9ibG9iL21haW4vcGFja2FnZXMvbGl2ZWJsb2Nrcy1yZWFjdC11aS9zcmMvY29tcG9uZW50cy9pbnRlcm5hbC9FbW9qaVBpY2tlci50c3guXG4gKlxuICogVGhlIHNlYXJjaCBpbnB1dCBvZiB0aGUgZW1vamkgcGlja2VyLiBJdCBhbHNvIGFmZmVjdHMgdGhlIGZvY3VzIGFuZCBzZWxlY3Rpb25cbiAqIHdpdGhpbiBgRW1vamlQaWNrZXIuQ29udGVudGAuXG4gKlxuICogQGV4YW1wbGVcbiAqIDxFbW9qaVBpY2tlci5TZWFyY2ggLz5cbiAqL1xuY29uc3QgRW1vamlQaWNrZXJTZWFyY2ggPSBmb3J3YXJkUmVmPEhUTUxJbnB1dEVsZW1lbnQsIEVtb2ppUGlja2VyU2VhcmNoUHJvcHM+KFxuICAoeyBhc0NoaWxkLCB2YWx1ZSwgZGVmYXVsdFZhbHVlLCBvbkNoYW5nZSwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgY29uc3QgQ29tcG9uZW50ID0gYXNDaGlsZCA/IFNsb3QgOiBcImlucHV0XCI7XG4gICAgY29uc3Qge1xuICAgICAgb25TZWFyY2gsXG4gICAgICBzZWxlY3RDdXJyZW50RW1vamksXG4gICAgICBtb3ZlU2VsZWN0aW9uLFxuICAgICAgaW50ZXJhY3Rpb24sXG4gICAgICBzZXRJbnRlcmFjdGlvbixcbiAgICB9ID0gdXNlRW1vamlQaWNrZXIoKTtcblxuICAgIGNvbnN0IGhhbmRsZUNoYW5nZSA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGV2ZW50OiBDaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgICBvbkNoYW5nZT8uKGV2ZW50KTtcblxuICAgICAgICBpZiAoZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgc2V0SW50ZXJhY3Rpb24odmFsdWUgPyBcImtleWJvYXJkXCIgOiBcIm5vbmVcIik7XG4gICAgICAgIG9uU2VhcmNoKHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICBbb25DaGFuZ2UsIG9uU2VhcmNoLCBzZXRJbnRlcmFjdGlvbl1cbiAgICApO1xuXG4gICAgY29uc3QgaGFuZGxlS2V5RG93biA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGV2ZW50OiBLZXlib2FyZEV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGlmIChldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0tleShldmVudCwgXCJBcnJvd0xlZnRcIikpIHtcbiAgICAgICAgICBtb3ZlU2VsZWN0aW9uKFwibGVmdFwiLCBldmVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNLZXkoZXZlbnQsIFwiQXJyb3dSaWdodFwiKSkge1xuICAgICAgICAgIG1vdmVTZWxlY3Rpb24oXCJyaWdodFwiLCBldmVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNLZXkoZXZlbnQsIFwiQXJyb3dVcFwiKSkge1xuICAgICAgICAgIG1vdmVTZWxlY3Rpb24oXCJ1cFwiLCBldmVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNLZXkoZXZlbnQsIFwiQXJyb3dEb3duXCIpKSB7XG4gICAgICAgICAgbW92ZVNlbGVjdGlvbihcImRvd25cIiwgZXZlbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKGlzS2V5KGV2ZW50LCBcIkVudGVyXCIpKSB7XG4gICAgICAgICAgaWYgKGludGVyYWN0aW9uICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHNlbGVjdEN1cnJlbnRFbW9qaSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtpbnRlcmFjdGlvbiwgbW92ZVNlbGVjdGlvbiwgc2VsZWN0Q3VycmVudEVtb2ppXVxuICAgICk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgb25TZWFyY2goXG4gICAgICAgIHZhbHVlID8gU3RyaW5nKHZhbHVlKSA6IGRlZmF1bHRWYWx1ZSA/IFN0cmluZyhkZWZhdWx0VmFsdWUpIDogXCJcIlxuICAgICAgKTtcbiAgICB9LCBbXSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbXBvbmVudFxuICAgICAgICB0eXBlPVwic2VhcmNoXCJcbiAgICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgICBkZWZhdWx0VmFsdWU9e2RlZmF1bHRWYWx1ZX1cbiAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX1cbiAgICAgICAgb25LZXlEb3duPXtoYW5kbGVLZXlEb3dufVxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgLz5cbiAgICApO1xuICB9XG4pO1xuXG5jb25zdCBkZWZhdWx0Q29udGVudENvbXBvbmVudHM6IEVtb2ppUGlja2VyQ29udGVudENvbXBvbmVudHMgPSB7XG4gIENhdGVnb3J5SGVhZGVyOiAoeyBjYXRlZ29yeSwgLi4ucHJvcHMgfSkgPT4gPGRpdiB7Li4ucHJvcHN9PntjYXRlZ29yeX08L2Rpdj4sXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgUm93OiAoeyBjaGlsZHJlbiwgYXR0cmlidXRlcywgLi4ucHJvcHMgfSkgPT4gPGRpdiB7Li4ucHJvcHN9PntjaGlsZHJlbn08L2Rpdj4sXG4gIEVtb2ppOiAoeyBlbW9qaSwgLi4ucHJvcHMgfSkgPT4gKFxuICAgIDxidXR0b24gey4uLnByb3BzfT5cbiAgICAgIDxFbW9qaVByaW1pdGl2ZSBlbW9qaT17ZW1vaml9IC8+XG4gICAgPC9idXR0b24+XG4gICksXG4gIExvYWRpbmc6IChwcm9wcykgPT4gPGRpdiB7Li4ucHJvcHN9IC8+LFxuICBFbXB0eTogKHByb3BzKSA9PiA8ZGl2IHsuLi5wcm9wc30gLz4sXG4gIEdyaWQ6IChwcm9wcykgPT4gPGRpdiB7Li4ucHJvcHN9IC8+LFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gIEVycm9yOiAoeyBlcnJvciwgLi4ucHJvcHMgfSkgPT4gPGRpdiB7Li4ucHJvcHN9IC8+LFxufTtcblxuY29uc3QgcGxhY2Vob2xkZXJSb3dBdHRyaWJ1dGVzOiBFbW9qaVBpY2tlckNvbnRlbnRFbW9qaVJvd0F0dHJpYnV0ZXMgPSB7XG4gIHJvd0luZGV4OiAtMSxcbiAgY2F0ZWdvcnlSb3dJbmRleDogLTEsXG4gIGNhdGVnb3J5Um93c0NvdW50OiAwLFxufTtcblxuLy8gQWJvdXQgYGRhdGEtdGVzdGlkPXt1bmRlZmluZWR9YDogVmlydHVvc28gYmFrZXMgdGVzdCBJRHMgaW50byB0aGUgY29tcG9uZW50cyB3ZSBwYXNzXG4vLyB0byBpdCwgc28gd2UgbWFudWFsbHkgcmVtb3ZlIHRoZW0uXG5cbmNvbnN0IFZpcnR1b3NvU2Nyb2xsZXIgPSBmb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBTY3JvbGxlclByb3BzPihcbiAgKHsgY2hpbGRyZW4sIC4uLnByb3BzIH0sIGZvcndhcmRlZFJlZikgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IHsuLi5wcm9wc30gdGFiSW5kZXg9ey0xfSBkYXRhLXRlc3RpZD17dW5kZWZpbmVkfSByZWY9e2ZvcndhcmRlZFJlZn0+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbik7XG5cbmNvbnN0IFZpcnR1b3NvVG9wTGlzdCA9IGZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIFRvcEl0ZW1MaXN0UHJvcHM+KFxuICAoeyBjaGlsZHJlbiwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgey4uLnByb3BzfSBkYXRhLXRlc3RpZD17dW5kZWZpbmVkfSByZWY9e2ZvcndhcmRlZFJlZn0+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbik7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqIFRoZSBFbW9qaVBpY2tlciBwcmltaXRpdmUgaXMgdW5kb2N1bWVudGVkIGZvciBub3cgYW5kIHN1YmplY3QgdG8gY2hhbmdlLFxuICogdXNlIGF0IHlvdXIgb3duIHJpc2suIElmIHlvdSBoYXZlIGFueSBmZWVkYmFjayBvbiBpdCwgcGxlYXNlIGxldCB1cyBrbm93IVxuICogU2VlIGhvdyB3ZSB1c2UgaXQgaW4gdGhlIGRlZmF1bHQgY29tcG9uZW50cyB0byBsZWFybiBob3cgdG8gdXNlIGl0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2xpdmVibG9ja3MvbGl2ZWJsb2Nrcy9ibG9iL21haW4vcGFja2FnZXMvbGl2ZWJsb2Nrcy1yZWFjdC11aS9zcmMvY29tcG9uZW50cy9pbnRlcm5hbC9FbW9qaVBpY2tlci50c3guXG4gKlxuICogVGhlIG1haW4gY29udGVudCBvZiB0aGUgZW1vamkgcGlja2VyLCBlaXRoZXIgZGlzcGxheWluZyB0aGUgZW1vamkgZ3JpZCBvciB2YXJpb3VzXG4gKiBhbHRlcm5hdGl2ZSBzdGF0ZXMgKGxvYWRpbmcsIGVtcHR5LCBhbmQgZXJyb3IpLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8RW1vamlQaWNrZXIuQ29udGVudFxuICogIGNvbXBvbmVudHM9e3tcbiAqICAgIExvYWRpbmc6IEVtb2ppUGlja2VyTG9hZGluZyxcbiAqICAgIEVtcHR5OiBFbW9qaVBpY2tlckVtcHR5LFxuICogICAgRXJyb3I6IEVtb2ppUGlja2VyRXJyb3IsXG4gKiAgICBDYXRlZ29yeUhlYWRlcjogRW1vamlQaWNrZXJDYXRlZ29yeUhlYWRlcixcbiAqICAgIEdyaWQ6IEVtb2ppUGlja2VyR3JpZCxcbiAqICAgIFJvdzogRW1vamlQaWNrZXJSb3csXG4gKiAgICBFbW9qaTogRW1vamlQaWNrZXJFbW9qaSxcbiAqICB9fVxuICogLz5cbiAqL1xuY29uc3QgRW1vamlQaWNrZXJDb250ZW50ID0gZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgRW1vamlQaWNrZXJDb250ZW50UHJvcHM+KFxuICAoeyBjb21wb25lbnRzLCBhc0NoaWxkLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgICBjb25zdCBDb21wb25lbnQgPSBhc0NoaWxkID8gU2xvdCA6IFwiZGl2XCI7XG4gICAgY29uc3QgdmlydHVvc29SZWYgPSB1c2VSZWY8R3JvdXBlZFZpcnR1b3NvSGFuZGxlPihudWxsKTtcbiAgICBjb25zdCBwbGFjZWhvbGRlckNvbnRhaW5lclJlZiA9IHVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCk7XG4gICAgY29uc3Qgcm93U2Nyb2xsTWFyZ2luVG9wUmVmID0gdXNlUmVmPG51bWJlcj4oMCk7XG4gICAgY29uc3Qgcm93U2Nyb2xsTWFyZ2luQm90dG9tUmVmID0gdXNlUmVmPG51bWJlcj4oMCk7XG4gICAgY29uc3QgY2F0ZWdvcnlIZWFkZXJIZWlnaHRSZWYgPSB1c2VSZWY8bnVtYmVyPigwKTtcbiAgICBjb25zdCB7XG4gICAgICBkYXRhLFxuICAgICAgZXJyb3IsXG4gICAgICBpc0xvYWRpbmcsXG4gICAgICBjb2x1bW5zLFxuICAgICAgb25FbW9qaVNlbGVjdCxcbiAgICAgIHNlbGVjdGVkQ29sdW1uSW5kZXgsXG4gICAgICBzZWxlY3RlZFJvd0luZGV4LFxuICAgICAgc2V0UG9pbnRlclNlbGVjdGlvbixcbiAgICAgIGludGVyYWN0aW9uLFxuICAgICAgc2V0SW50ZXJhY3Rpb24sXG4gICAgfSA9IHVzZUVtb2ppUGlja2VyKCk7XG4gICAgY29uc3Qgc2VsZWN0ZWRFbW9qaSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBkYXRhPy5yb3dzW3NlbGVjdGVkUm93SW5kZXhdPy5bc2VsZWN0ZWRDb2x1bW5JbmRleF0sXG4gICAgICBbZGF0YT8ucm93cywgc2VsZWN0ZWRDb2x1bW5JbmRleCwgc2VsZWN0ZWRSb3dJbmRleF1cbiAgICApO1xuICAgIGNvbnN0IHsgTG9hZGluZywgRW1wdHksIEVycm9yLCBDYXRlZ29yeUhlYWRlciwgR3JpZCwgUm93LCBFbW9qaSB9ID0gdXNlTWVtbyhcbiAgICAgICgpID0+ICh7IC4uLmRlZmF1bHRDb250ZW50Q29tcG9uZW50cywgLi4uY29tcG9uZW50cyB9KSxcbiAgICAgIFtjb21wb25lbnRzXVxuICAgICk7XG4gICAgY29uc3QgVmlydHVvc29MaXN0ID0gdXNlTWVtbyhcbiAgICAgICgpID0+XG4gICAgICAgIGZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIFZpcnR1b3NvTGlzdFByb3BzPihcbiAgICAgICAgICAoeyBjaGlsZHJlbiwgLi4ucHJvcHMgfSwgZm9yd2FyZGVkUmVmKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgcm9sZT1cImdyaWRcIlxuICAgICAgICAgICAgICAgIGFyaWEtY29sY291bnQ9e2NvbHVtbnN9XG4gICAgICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPXt1bmRlZmluZWR9XG4gICAgICAgICAgICAgICAgcmVmPXtmb3J3YXJkZWRSZWZ9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICBbY29sdW1uc11cbiAgICApO1xuICAgIGNvbnN0IHBsYWNlaG9sZGVyQ29sdW1ucyA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBBcnJheTxzdHJpbmc+KGNvbHVtbnMpLmZpbGwoXCLwn4yr77iPXCIpLFxuICAgICAgW2NvbHVtbnNdXG4gICAgKTtcblxuICAgIGNvbnN0IHByZXZlbnREZWZhdWx0ID0gdXNlQ2FsbGJhY2soKGV2ZW50OiBTeW50aGV0aWNFdmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9LCBbXSk7XG5cbiAgICBjb25zdCBoYW5kbGVFbW9qaVBvaW50ZXJMZWF2ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmIChpbnRlcmFjdGlvbiA9PT0gXCJwb2ludGVyXCIpIHtcbiAgICAgICAgc2V0SW50ZXJhY3Rpb24oXCJub25lXCIpO1xuICAgICAgfVxuICAgIH0sIFtpbnRlcmFjdGlvbiwgc2V0SW50ZXJhY3Rpb25dKTtcblxuICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoIXBsYWNlaG9sZGVyQ29udGFpbmVyUmVmLmN1cnJlbnQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByb3cgPSBwbGFjZWhvbGRlckNvbnRhaW5lclJlZi5jdXJyZW50LmNoaWxkTm9kZXNbMF07XG4gICAgICBjb25zdCBjYXRlZ29yeUhlYWRlciA9IHBsYWNlaG9sZGVyQ29udGFpbmVyUmVmLmN1cnJlbnQuY2hpbGROb2Rlc1sxXTtcblxuICAgICAgaWYgKHJvdyBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocm93KTtcblxuICAgICAgICByb3dTY3JvbGxNYXJnaW5Ub3BSZWYuY3VycmVudCA9IHBhcnNlRmxvYXQoc3R5bGUuc2Nyb2xsTWFyZ2luVG9wKTtcbiAgICAgICAgcm93U2Nyb2xsTWFyZ2luQm90dG9tUmVmLmN1cnJlbnQgPSBwYXJzZUZsb2F0KHN0eWxlLnNjcm9sbE1hcmdpbkJvdHRvbSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYXRlZ29yeUhlYWRlciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGNhdGVnb3J5SGVhZGVySGVpZ2h0UmVmLmN1cnJlbnQgPSBjYXRlZ29yeUhlYWRlci5vZmZzZXRIZWlnaHQ7XG4gICAgICB9XG4gICAgfSwgW10pO1xuXG4gICAgLy8gQ3VzdG9taXplIGBzY3JvbGxJbnRvVmlld2AgYmVoYXZpb3IgdG8gdGFrZSBpbnRvIGFjY291bnQgY2F0ZWdvcnkgaGVhZGVycyBhbmQgbWFyZ2luc1xuICAgIGNvbnN0IGNhbGN1bGF0ZVZpZXdMb2NhdGlvbiA9IHVzZUNhbGxiYWNrKFxuICAgICAgKHtcbiAgICAgICAgaXRlbVRvcCxcbiAgICAgICAgaXRlbUJvdHRvbSxcbiAgICAgICAgdmlld3BvcnRUb3AsXG4gICAgICAgIHZpZXdwb3J0Qm90dG9tLFxuICAgICAgICBsb2NhdGlvblBhcmFtczogeyBiZWhhdmlvciwgYWxpZ24sIC4uLnBhcmFtcyB9LFxuICAgICAgfTogQ2FsY3VsYXRlVmlld0xvY2F0aW9uUGFyYW1zKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBpdGVtVG9wIC1cbiAgICAgICAgICAgIChjYXRlZ29yeUhlYWRlckhlaWdodFJlZi5jdXJyZW50ICsgcm93U2Nyb2xsTWFyZ2luVG9wUmVmLmN1cnJlbnQpIDxcbiAgICAgICAgICB2aWV3cG9ydFRvcFxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4ucGFyYW1zLFxuICAgICAgICAgICAgYmVoYXZpb3IsXG4gICAgICAgICAgICBhbGlnbjogYWxpZ24gPz8gXCJzdGFydFwiLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXRlbUJvdHRvbSA+IHZpZXdwb3J0Qm90dG9tKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgICAgIGJlaGF2aW9yLFxuICAgICAgICAgICAgYWxpZ246IGFsaWduID8/IFwiZW5kXCIsXG4gICAgICAgICAgICBvZmZzZXQ6IHJvd1Njcm9sbE1hcmdpbkJvdHRvbVJlZi5jdXJyZW50LFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBbXVxuICAgICk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKGludGVyYWN0aW9uID09PSBcImtleWJvYXJkXCIpIHtcbiAgICAgICAgdmlydHVvc29SZWYuY3VycmVudD8uc2Nyb2xsSW50b1ZpZXcoe1xuICAgICAgICAgIGluZGV4OiBzZWxlY3RlZFJvd0luZGV4LFxuICAgICAgICAgIGJlaGF2aW9yOiBcImF1dG9cIixcbiAgICAgICAgICBjYWxjdWxhdGVWaWV3TG9jYXRpb24sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sIFtpbnRlcmFjdGlvbiwgc2VsZWN0ZWRSb3dJbmRleCwgY2FsY3VsYXRlVmlld0xvY2F0aW9uXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbXBvbmVudCB7Li4ucHJvcHN9IHJlZj17Zm9yd2FyZGVkUmVmfT5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICB2aXNpYmlsaXR5OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgaGVpZ2h0OiAwLFxuICAgICAgICAgIH19XG4gICAgICAgICAgcmVmPXtwbGFjZWhvbGRlckNvbnRhaW5lclJlZn1cbiAgICAgICAgPlxuICAgICAgICAgIHsvKiBWaXJ0dWFsaXplZCByb3dzIGFyZSBhYnNvbHV0ZWx5IHBvc2l0aW9uZWQgc28gdGhleSB3b24ndCBtYWtlXG4gICAgICAgICAgICB0aGUgY29udGFpbmVyIGF1dG9tYXRpY2FsbHkgcGljayB1cCB0aGVpciB3aWR0aC4gVG8gYWNoaWV2ZVxuICAgICAgICAgICAgYW4gYXV0b21hdGljIHdpZHRoLCB3ZSBhZGQgYSByZWxhdGl2ZSAoYnV0IGhpZGRlbikgZnVsbCByb3cuICovfVxuICAgICAgICAgIDxSb3cgYXR0cmlidXRlcz17cGxhY2Vob2xkZXJSb3dBdHRyaWJ1dGVzfT5cbiAgICAgICAgICAgIHtwbGFjZWhvbGRlckNvbHVtbnMubWFwKChwbGFjZWhvbGRlciwgaW5kZXgpID0+IChcbiAgICAgICAgICAgICAgPEVtb2ppIGVtb2ppPXtwbGFjZWhvbGRlcn0ga2V5PXtpbmRleH0gLz5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvUm93PlxuICAgICAgICAgIHsvKiBXZSBhbHNvIGFkZCBhIGhpZGRlbiBjYXRlZ29yeSBoZWFkZXIgdG8gZ2V0IGl0cyBjb21wdXRlZCBoZWlnaHQuICovfVxuICAgICAgICAgIDxDYXRlZ29yeUhlYWRlciBjYXRlZ29yeT1cIkNhdGVnb3J5XCIgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIHtpc0xvYWRpbmcgPyAoXG4gICAgICAgICAgPExvYWRpbmcgLz5cbiAgICAgICAgKSA6IGVycm9yID8gKFxuICAgICAgICAgIDxFcnJvciBlcnJvcj17ZXJyb3J9IC8+XG4gICAgICAgICkgOiBkYXRhLmNvdW50ID09PSAwID8gKFxuICAgICAgICAgIDxFbXB0eSAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxHcmlkPlxuICAgICAgICAgICAgPEdyb3VwZWRWaXJ0dW9zb1xuICAgICAgICAgICAgICByZWY9e3ZpcnR1b3NvUmVmfVxuICAgICAgICAgICAgICBjb21wb25lbnRzPXt7XG4gICAgICAgICAgICAgICAgU2Nyb2xsZXI6IFZpcnR1b3NvU2Nyb2xsZXIsXG4gICAgICAgICAgICAgICAgTGlzdDogVmlydHVvc29MaXN0LFxuICAgICAgICAgICAgICAgIFRvcEl0ZW1MaXN0OiBWaXJ0dW9zb1RvcExpc3QsXG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgIGdyb3VwQ291bnRzPXtkYXRhLmNhdGVnb3JpZXNSb3dDb3VudHN9XG4gICAgICAgICAgICAgIGdyb3VwQ29udGVudD17KGdyb3VwSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgPENhdGVnb3J5SGVhZGVyIGNhdGVnb3J5PXtkYXRhLmNhdGVnb3JpZXNbZ3JvdXBJbmRleF19IC8+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgaXRlbUNvbnRlbnQ9eyhyb3dJbmRleCwgZ3JvdXBJbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhdGVnb3J5Um93SW5kZXggPVxuICAgICAgICAgICAgICAgICAgZGF0YS5jYXRlZ29yaWVzUm93SW5kaWNlc1tncm91cEluZGV4XS5pbmRleE9mKHJvd0luZGV4KTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYXRlZ29yeVJvd3NDb3VudCA9IGRhdGEuY2F0ZWdvcmllc1Jvd0NvdW50c1tncm91cEluZGV4XTtcblxuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICA8Um93XG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM9e3tcbiAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeVJvd0luZGV4LFxuICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5Um93c0NvdW50LFxuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7ZGF0YS5yb3dzW3Jvd0luZGV4XS5tYXAoKGVtb2ppLCBjb2x1bW5JbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gIT09IFwibm9uZVwiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbkluZGV4ID09PSBjb2x1bW5JbmRleCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dJbmRleCA9PT0gcm93SW5kZXg7XG5cbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgPEVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17ZW1vamkuZW1vaml9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU9XCJncmlkY2VsbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtY29saW5kZXg9e2NvbHVtbkluZGV4fVxuICAgICAgICAgICAgICAgICAgICAgICAgICBhcmlhLXNlbGVjdGVkPXtpc1NlbGVjdGVkIHx8IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1zZWxlY3RlZD17aXNTZWxlY3RlZCB8fCB1bmRlZmluZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VEb3duPXtwcmV2ZW50RGVmYXVsdH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg9ey0xfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvblBvaW50ZXJFbnRlcj17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFBvaW50ZXJTZWxlY3Rpb24oY29sdW1uSW5kZXgsIHJvd0luZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgb25Qb2ludGVyTGVhdmU9e2hhbmRsZUVtb2ppUG9pbnRlckxlYXZlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkVtb2ppU2VsZWN0Py4oZW1vamkuZW1vamkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaT17ZW1vamkuZW1vaml9XG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgPC9Sb3c+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9HcmlkPlxuICAgICAgICApfVxuICAgICAgICB7c2VsZWN0ZWRFbW9qaSAmJiBpbnRlcmFjdGlvbiAhPT0gXCJub25lXCIgJiYgKFxuICAgICAgICAgIDxkaXYgYXJpYS1saXZlPVwicG9saXRlXCIgc3R5bGU9e3Zpc3VhbGx5SGlkZGVufT5cbiAgICAgICAgICAgIHtzZWxlY3RlZEVtb2ppLm5hbWV9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICl9XG4gICAgICA8L0NvbXBvbmVudD5cbiAgICApO1xuICB9XG4pO1xuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gIEVtb2ppUGlja2VyUm9vdC5kaXNwbGF5TmFtZSA9IEVNT0pJUElDS0VSX1JPT1RfTkFNRTtcbiAgRW1vamlQaWNrZXJDb250ZW50LmRpc3BsYXlOYW1lID0gRU1PSklQSUNLRVJfQ09OVEVOVF9OQU1FO1xuICBFbW9qaVBpY2tlclNlYXJjaC5kaXNwbGF5TmFtZSA9IEVNT0pJUElDS0VSX1NFQVJDSF9OQU1FO1xufVxuXG4vLyBOT1RFOiBFdmVyeSBleHBvcnQgZnJvbSB0aGlzIGZpbGUgd2lsbCBiZSBhdmFpbGFibGUgcHVibGljbHkgYXMgRW1vamlQaWNrZXIuKlxuZXhwb3J0IHtcbiAgRW1vamlQaWNrZXJDb250ZW50IGFzIENvbnRlbnQsXG4gIEVtb2ppUGlja2VyUm9vdCBhcyBSb290LFxuICBFbW9qaVBpY2tlclNlYXJjaCBhcyBTZWFyY2gsXG59O1xuIl0sIm5hbWVzIjpbIkRFRkFVTFRfQ09MVU1OUyIsIkRFRkFVTFRfTE9DQUxFIiwiTE9BRElOR19NSU5JTVVNX1RJTUVPVVQiLCJFTU9KSVBJQ0tFUl9ST09UX05BTUUiLCJFTU9KSVBJQ0tFUl9DT05URU5UX05BTUUiLCJFTU9KSVBJQ0tFUl9TRUFSQ0hfTkFNRSIsIkVtb2ppUGlja2VyUm9vdCIsImNvbHVtbnMiLCJsb2NhbGUiLCJvbkVtb2ppU2VsZWN0IiwiY2hpbGRyZW4iLCJlbW9qaURhdGEiLCJ1c2VSZWYiLCJzZWFyY2giLCJzdGFydEVtb2ppc1RyYW5zaXRpb24iLCJ1c2VUcmFuc2l0aW9uIiwiZGF0YSIsInNldERhdGEiLCJ1c2VTdGF0ZSIsImVycm9yIiwic2V0RXJyb3IiLCJzZWxlY3RlZENvbHVtbkluZGV4Iiwic2V0U2VsZWN0ZWRDb2x1bW5JbmRleCIsInNlbGVjdGVkUm93SW5kZXgiLCJzZXRTZWxlY3RlZFJvd0luZGV4IiwiaW50ZXJhY3Rpb24iLCJzZXRJbnRlcmFjdGlvbiIsInNlbGVjdEN1cnJlbnRFbW9qaSIsInVzZUNhbGxiYWNrIiwiZW1vamkiLCJyb3dzIiwicmVzZXRTZWxlY3Rpb24iLCJzZXRQb2ludGVyU2VsZWN0aW9uIiwiY29sdW1uSW5kZXgiLCJyb3dJbmRleCIsIm1vdmVTZWxlY3Rpb24iLCJkaXJlY3Rpb24iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwicHJldmlvdXNSb3dJbmRleCIsInByZXZpb3VzUm93IiwibGVuZ3RoIiwiY3VycmVudFJvdyIsIm5leHRSb3dJbmRleCIsIm5leHRSb3ciLCJ1cGRhdGVFbW9qaXMiLCJjdXJyZW50IiwiZmlsdGVyZWRFbW9qaXMiLCJmaWx0ZXJFbW9qaXMiLCJlbW9qaXMiLCJnZW5lcmF0ZUVtb2ppUGlja2VyRGF0YSIsImNhdGVnb3JpZXMiLCJoYW5kbGVTZWFyY2giLCJ2YWx1ZSIsImluaXRpYWxpemVFbW9qaURhdGEiLCJsb2NhbGUyIiwiZ2V0RW1vamlEYXRhIiwiZXJyb3IyIiwidXNlRWZmZWN0IiwiaWRsZUNhbGxiYWNrSWQiLCJ0aW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwicmVxdWVzdElkbGVDYWxsYmFjayIsImNsZWFyVGltZW91dCIsImNhbmNlbElkbGVDYWxsYmFjayIsIlJlYWN0X19kZWZhdWx0IiwiY3JlYXRlRWxlbWVudCIsIkVtb2ppUGlja2VyQ29udGV4dCIsIlByb3ZpZGVyIiwiaXNMb2FkaW5nIiwib25TZWFyY2giLCJFbW9qaVBpY2tlclNlYXJjaCIsImZvcndhcmRSZWYiLCJhc0NoaWxkIiwiZGVmYXVsdFZhbHVlIiwib25DaGFuZ2UiLCJwcm9wcyIsImZvcndhcmRlZFJlZiIsIkNvbXBvbmVudCIsIlNsb3QiLCJ1c2VFbW9qaVBpY2tlciIsImhhbmRsZUNoYW5nZSIsImlzRGVmYXVsdFByZXZlbnRlZCIsInZhbHVlMiIsInRhcmdldCIsImhhbmRsZUtleURvd24iLCJpc0tleSIsIlN0cmluZyIsInR5cGUiLCJvbktleURvd24iLCJyZWYiLCJkZWZhdWx0Q29udGVudENvbXBvbmVudHMiLCJDYXRlZ29yeUhlYWRlciIsImNhdGVnb3J5IiwiUm93IiwiYXR0cmlidXRlcyIsIkVtb2ppIiwiTG9hZGluZyIsIkVtcHR5IiwiR3JpZCIsIkVycm9yIiwicGxhY2Vob2xkZXJSb3dBdHRyaWJ1dGVzIiwiY2F0ZWdvcnlSb3dJbmRleCIsImNhdGVnb3J5Um93c0NvdW50IiwiVmlydHVvc29TY3JvbGxlciIsInRhYkluZGV4IiwiVmlydHVvc29Ub3BMaXN0IiwiRW1vamlQaWNrZXJDb250ZW50IiwiY29tcG9uZW50cyIsInZpcnR1b3NvUmVmIiwicGxhY2Vob2xkZXJDb250YWluZXJSZWYiLCJyb3dTY3JvbGxNYXJnaW5Ub3BSZWYiLCJyb3dTY3JvbGxNYXJnaW5Cb3R0b21SZWYiLCJjYXRlZ29yeUhlYWRlckhlaWdodFJlZiIsInNlbGVjdGVkRW1vamkiLCJ1c2VNZW1vIiwiVmlydHVvc29MaXN0IiwicHJvcHMyIiwiZm9yd2FyZGVkUmVmMiIsInJvbGUiLCJwbGFjZWhvbGRlckNvbHVtbnMiLCJBcnJheSIsImZpbGwiLCJoYW5kbGVFbW9qaVBvaW50ZXJMZWF2ZSIsInVzZUxheW91dEVmZmVjdCIsInJvdyIsImNoaWxkTm9kZXMiLCJjYXRlZ29yeUhlYWRlciIsIkhUTUxFbGVtZW50Iiwic3R5bGUiLCJ3aW5kb3ciLCJnZXRDb21wdXRlZFN0eWxlIiwicGFyc2VGbG9hdCIsInNjcm9sbE1hcmdpblRvcCIsInNjcm9sbE1hcmdpbkJvdHRvbSIsIm9mZnNldEhlaWdodCIsImNhbGN1bGF0ZVZpZXdMb2NhdGlvbiIsIml0ZW1Ub3AiLCJpdGVtQm90dG9tIiwidmlld3BvcnRUb3AiLCJ2aWV3cG9ydEJvdHRvbSIsImxvY2F0aW9uUGFyYW1zIiwiYmVoYXZpb3IiLCJhbGlnbiIsInBhcmFtcyIsIm9mZnNldCIsInNjcm9sbEludG9WaWV3IiwiaW5kZXgiLCJ2aXNpYmlsaXR5IiwiaGVpZ2h0IiwibWFwIiwicGxhY2Vob2xkZXIiLCJrZXkiLCJjb3VudCIsIkdyb3VwZWRWaXJ0dW9zbyIsIlNjcm9sbGVyIiwiTGlzdCIsIlRvcEl0ZW1MaXN0IiwiZ3JvdXBDb3VudHMiLCJjYXRlZ29yaWVzUm93Q291bnRzIiwiZ3JvdXBDb250ZW50IiwiZ3JvdXBJbmRleCIsIml0ZW1Db250ZW50IiwiY2F0ZWdvcmllc1Jvd0luZGljZXMiLCJpbmRleE9mIiwiaXNTZWxlY3RlZCIsIm9uTW91c2VEb3duIiwib25Qb2ludGVyRW50ZXIiLCJvblBvaW50ZXJMZWF2ZSIsIm9uQ2xpY2siLCJzdG9wUHJvcGFnYXRpb24iLCJ2aXN1YWxseUhpZGRlbiIsIm5hbWUiLCJwcm9jZXNzIiwiZGlzcGxheU5hbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/utils.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/utils.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   filterEmojis: () => (/* binding */ filterEmojis),\n/* harmony export */   generateEmojiPickerData: () => (/* binding */ generateEmojiPickerData),\n/* harmony export */   getEmojiData: () => (/* binding */ getEmojiData)\n/* harmony export */ });\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../constants.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\");\n/* harmony import */ var _utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/capitalize.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/capitalize.mjs\");\n/* harmony import */ var _utils_chunk_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/chunk.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/chunk.mjs\");\n\n\n\n\nconst EMOJIBASE_VERSION = \"15.3.0\";\nconst EMOJIBASE_CDN_URL = `https://cdn.jsdelivr.net/npm/emojibase-data@${EMOJIBASE_VERSION}`;\nconst EMOJIBASE_EMOJIS_URL = (locale) => `${EMOJIBASE_CDN_URL}/${locale}/data.json`;\nconst EMOJIBASE_MESSAGES_URL = (locale) => `${EMOJIBASE_CDN_URL}/${locale}/messages.json`;\nconst EMOJIBASE_LOCALES = [\n  \"bn\",\n  \"da\",\n  \"de\",\n  \"en\",\n  \"en-gb\",\n  \"es\",\n  \"es-mx\",\n  \"et\",\n  \"fi\",\n  \"fr\",\n  \"hi\",\n  \"hu\",\n  \"it\",\n  \"ja\",\n  \"ko\",\n  \"lt\",\n  \"ms\",\n  \"nb\",\n  \"nl\",\n  \"pl\",\n  \"pt\",\n  \"ru\",\n  \"sv\",\n  \"th\",\n  \"uk\",\n  \"zh\",\n  \"zh-hant\"\n];\nconst EMOJIBASE_DEFAULT_LOCALE = \"en\";\nconst CACHE_EMOJI_DATA_KEY = (locale) => `lb-emoji-data-${locale}`;\nconst CACHE_EMOJI_METADATA_KEY = (locale) => `lb-emoji-metadata-${locale}`;\nconst CACHE_EMOJI_SESSION_METADATA_KEY = \"lb-emoji-metadata\";\nconst EMOJI_DETECTION_CANVAS_WIDTH = 20;\nconst EMOJI_DETECTION_CANVAS_HEIGHT = 25;\nconst EMOJI_DETECTION_COUNTRY_FLAG = \"\\u{1F1EB}\\u{1F1F7}\";\nfunction generateRangeIndices(start, end) {\n  const range = [];\n  for (let i = start; i <= end; i++) {\n    range.push(i);\n  }\n  return range;\n}\nfunction getStorageItem(storage, key) {\n  const item = storage.getItem(key);\n  return item ? JSON.parse(item) : null;\n}\nfunction setStorageItem(storage, key, value) {\n  storage.setItem(key, JSON.stringify(value));\n}\nasync function fetchEtag(url) {\n  try {\n    const response = await fetch(url, { method: \"HEAD\" });\n    return response.headers.get(\"etag\");\n  } catch (error) {\n    return null;\n  }\n}\nfunction getEmojibaseSupportedLocale(locale) {\n  return EMOJIBASE_LOCALES.includes(locale) ? locale : EMOJIBASE_DEFAULT_LOCALE;\n}\nasync function fetchEmojibaseData(locale) {\n  const [{ emojis, emojisEtag }, { messages, messagesEtag }] = await Promise.all([\n    fetch(EMOJIBASE_EMOJIS_URL(locale)).then(async (response) => {\n      return {\n        emojis: await response.json(),\n        emojisEtag: response.headers.get(\"etag\")\n      };\n    }),\n    fetch(EMOJIBASE_MESSAGES_URL(locale)).then(async (response) => {\n      return {\n        messages: await response.json(),\n        messagesEtag: response.headers.get(\"etag\")\n      };\n    })\n  ]);\n  return {\n    emojis,\n    messages,\n    emojisEtag,\n    messagesEtag\n  };\n}\nasync function fetchEmojibaseEtags(locale) {\n  const [emojisEtag, messagesEtag] = await Promise.all([\n    fetchEtag(EMOJIBASE_EMOJIS_URL(locale)),\n    fetchEtag(EMOJIBASE_MESSAGES_URL(locale))\n  ]);\n  return {\n    emojisEtag,\n    messagesEtag\n  };\n}\nasync function fetchEmojiData(locale) {\n  const { emojis, emojisEtag, messages, messagesEtag } = await fetchEmojibaseData(locale);\n  const countryFlagsSubgroup = messages.subgroups.find(\n    (subgroup) => subgroup.key === \"subdivision-flag\"\n  );\n  const filteredGroups = messages.groups.filter(\n    (group) => group.key !== \"component\"\n  );\n  const filteredEmojis = emojis.filter((emoji) => {\n    return \"group\" in emoji;\n  });\n  const categories = filteredGroups.map((group) => ({\n    key: group.order,\n    name: (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_0__.capitalize)(group.message)\n  }));\n  const skinTones = messages.skinTones.map((skinTone) => ({\n    key: skinTone.key,\n    name: (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_0__.capitalize)(skinTone.message)\n  }));\n  const compactEmojis = filteredEmojis.map((emoji) => {\n    const compactEmoji = {\n      emoji: emoji.emoji,\n      category: emoji.group,\n      version: emoji.version,\n      name: (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_0__.capitalize)(emoji.label),\n      tags: emoji.tags\n    };\n    if (countryFlagsSubgroup && emoji.subgroup === countryFlagsSubgroup.order) {\n      compactEmoji.countryFlag = true;\n    }\n    return compactEmoji;\n  });\n  const emojiData = {\n    emojis: compactEmojis,\n    categories,\n    skinTones\n  };\n  setStorageItem(\n    localStorage,\n    CACHE_EMOJI_DATA_KEY(locale),\n    emojiData\n  );\n  setStorageItem(\n    localStorage,\n    CACHE_EMOJI_METADATA_KEY(locale),\n    {\n      emojisEtag,\n      messagesEtag\n    }\n  );\n  return emojiData;\n}\nfunction detectEmojiSupport(canvasContext, emoji) {\n  canvasContext.clearRect(\n    0,\n    0,\n    EMOJI_DETECTION_CANVAS_WIDTH * 2,\n    EMOJI_DETECTION_CANVAS_HEIGHT\n  );\n  canvasContext.fillStyle = \"#f00\";\n  canvasContext.fillText(emoji, 0, 22);\n  canvasContext.fillStyle = \"#00f\";\n  canvasContext.fillText(emoji, EMOJI_DETECTION_CANVAS_WIDTH, 22);\n  const pixels = canvasContext.getImageData(\n    0,\n    0,\n    EMOJI_DETECTION_CANVAS_WIDTH,\n    EMOJI_DETECTION_CANVAS_HEIGHT\n  ).data;\n  const pixelCount = pixels.length;\n  let i = 0;\n  for (; i < pixelCount && !pixels[i + 3]; i += 4)\n    ;\n  if (i >= pixelCount) {\n    return false;\n  }\n  const x = EMOJI_DETECTION_CANVAS_WIDTH + i / 4 % EMOJI_DETECTION_CANVAS_WIDTH;\n  const y = Math.floor(i / 4 / EMOJI_DETECTION_CANVAS_WIDTH);\n  const pixel = canvasContext.getImageData(x, y, 1, 1).data;\n  if (pixels[i] !== pixel[0] || pixels[i + 2] !== pixel[2]) {\n    return false;\n  }\n  if (canvasContext.measureText(emoji).width >= EMOJI_DETECTION_CANVAS_WIDTH) {\n    return false;\n  }\n  return true;\n}\nfunction getEmojiFontFamily() {\n  try {\n    const element = document.createElement(\"span\");\n    element.style.display = \"none\";\n    element.dataset.emoji = \"\";\n    document.body.appendChild(element);\n    const computedFontFamily = window.getComputedStyle(element).fontFamily;\n    document.body.removeChild(element);\n    return computedFontFamily;\n  } catch {\n    return _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.EMOJI_FONT_FAMILY;\n  }\n}\nfunction getEmojiSessionMetadata(emojis) {\n  const versions = /* @__PURE__ */ new Map();\n  for (const emoji of emojis) {\n    if (!versions.has(emoji.version)) {\n      versions.set(emoji.version, emoji.emoji);\n    }\n  }\n  const descendingVersions = [...versions.keys()].sort((a, b) => b - a);\n  const canvasContext = document.createElement(\"canvas\").getContext(\"2d\", { willReadFrequently: true });\n  if (!canvasContext) {\n    return { emojiVersion: descendingVersions[0], countryFlags: true };\n  }\n  canvasContext.font = `${Math.floor(\n    EMOJI_DETECTION_CANVAS_HEIGHT / 2\n  )}px ${getEmojiFontFamily()}`;\n  canvasContext.textBaseline = \"top\";\n  canvasContext.canvas.width = EMOJI_DETECTION_CANVAS_WIDTH * 2;\n  canvasContext.canvas.height = EMOJI_DETECTION_CANVAS_HEIGHT;\n  const supportsCountryFlags = detectEmojiSupport(\n    canvasContext,\n    EMOJI_DETECTION_COUNTRY_FLAG\n  );\n  for (const version of descendingVersions) {\n    const emoji = versions.get(version);\n    const isSupported = detectEmojiSupport(canvasContext, emoji);\n    if (isSupported) {\n      return {\n        emojiVersion: version,\n        countryFlags: supportsCountryFlags\n      };\n    }\n  }\n  return {\n    emojiVersion: descendingVersions[0],\n    countryFlags: supportsCountryFlags\n  };\n}\nasync function getEmojiData(locale) {\n  const emojibaseLocale = getEmojibaseSupportedLocale(locale);\n  const sessionMetadata = getStorageItem(\n    sessionStorage,\n    CACHE_EMOJI_SESSION_METADATA_KEY\n  );\n  const cachedData = getStorageItem(\n    localStorage,\n    CACHE_EMOJI_DATA_KEY(emojibaseLocale)\n  );\n  let data;\n  if (cachedData) {\n    if (sessionMetadata) {\n      data = cachedData;\n    } else {\n      const { emojisEtag, messagesEtag } = await fetchEmojibaseEtags(emojibaseLocale);\n      const cachedMetadata = getStorageItem(\n        localStorage,\n        CACHE_EMOJI_METADATA_KEY(emojibaseLocale)\n      );\n      if (cachedMetadata && emojisEtag === cachedMetadata.emojisEtag && messagesEtag === cachedMetadata.messagesEtag) {\n        data = cachedData;\n      } else {\n        data = await fetchEmojiData(emojibaseLocale);\n      }\n    }\n  } else {\n    data = await fetchEmojiData(emojibaseLocale);\n  }\n  const newSessionMetadata = sessionMetadata ?? getEmojiSessionMetadata(data.emojis);\n  setStorageItem(\n    sessionStorage,\n    CACHE_EMOJI_SESSION_METADATA_KEY,\n    newSessionMetadata\n  );\n  const filteredEmojis = data.emojis.filter((emoji) => {\n    const isSupportedVersion = emoji.version <= newSessionMetadata.emojiVersion;\n    return emoji.countryFlag ? isSupportedVersion && newSessionMetadata.countryFlags : isSupportedVersion;\n  });\n  return {\n    emojis: filteredEmojis,\n    categories: data.categories,\n    skinTones: data.skinTones\n  };\n}\nfunction filterEmojis(emojis, search) {\n  if (!search) {\n    return emojis;\n  }\n  const searchText = search.toLowerCase().trim();\n  return emojis.filter(\n    (emoji) => emoji.name.toLowerCase().includes(searchText) || emoji.tags?.some((tag) => tag.toLowerCase().includes(searchText))\n  );\n}\nfunction generateEmojiPickerData(emojis, categories, columns) {\n  let currentIndex = 0;\n  const rows = [];\n  const indexedEmojis = emojis.map((emoji, index) => ({ ...emoji, index }));\n  const categoriesRowCounts = [];\n  const categoriesRowIndices = [];\n  const categoriesNames = [];\n  const categorizedEmojis = categories.map((category) => ({\n    ...category,\n    emojis: indexedEmojis.filter((emoji) => emoji.category === category.key)\n  })).filter((category) => category.emojis.length > 0);\n  for (const category of categorizedEmojis) {\n    const categoryRows = (0,_utils_chunk_mjs__WEBPACK_IMPORTED_MODULE_2__.chunk)(category.emojis, columns);\n    const nextIndex = currentIndex + categoryRows.length;\n    rows.push(...categoryRows);\n    categoriesNames.push(category.name);\n    categoriesRowCounts.push(categoryRows.length);\n    categoriesRowIndices.push(\n      generateRangeIndices(currentIndex, nextIndex - 1)\n    );\n    currentIndex = nextIndex;\n  }\n  return {\n    count: emojis.length,\n    rows,\n    categories: categoriesNames,\n    categoriesRowCounts,\n    categoriesRowIndices\n  };\n}\n\n\n//# sourceMappingURL=utils.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL0Vtb2ppUGlja2VyL3V0aWxzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0Q7QUFDQTtBQUNWOztBQUU5QztBQUNBLHlFQUF5RSxrQkFBa0I7QUFDM0YsNENBQTRDLGtCQUFrQixHQUFHLE9BQU87QUFDeEUsOENBQThDLGtCQUFrQixHQUFHLE9BQU87QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELE9BQU87QUFDakUsa0VBQWtFLE9BQU87QUFDekU7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLE1BQU0sR0FBRyxNQUFNO0FBQ3hEO0FBQ0E7QUFDQSxzQkFBc0IsVUFBVTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxnQkFBZ0I7QUFDeEQ7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLG9CQUFvQixJQUFJLHdCQUF3QjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDZDQUE2QztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxVQUFVLGlFQUFVO0FBQ3BCLEdBQUc7QUFDSDtBQUNBO0FBQ0EsVUFBVSxpRUFBVTtBQUNwQixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksaUVBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsa0NBQWtDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixXQUFXLDZEQUFpQjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSwwQkFBMEI7QUFDdEc7QUFDQSxhQUFhO0FBQ2I7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQSxJQUFJLEtBQUsscUJBQXFCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixjQUFjLDJCQUEyQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELGlCQUFpQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSx5QkFBeUIsdURBQUs7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFK0Q7QUFDL0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3ByaW1pdGl2ZXMvRW1vamlQaWNrZXIvdXRpbHMubWpzPzI5ZWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRU1PSklfRk9OVF9GQU1JTFkgfSBmcm9tICcuLi8uLi9jb25zdGFudHMubWpzJztcbmltcG9ydCB7IGNhcGl0YWxpemUgfSBmcm9tICcuLi8uLi91dGlscy9jYXBpdGFsaXplLm1qcyc7XG5pbXBvcnQgeyBjaHVuayB9IGZyb20gJy4uLy4uL3V0aWxzL2NodW5rLm1qcyc7XG5cbmNvbnN0IEVNT0pJQkFTRV9WRVJTSU9OID0gXCIxNS4zLjBcIjtcbmNvbnN0IEVNT0pJQkFTRV9DRE5fVVJMID0gYGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZW1vamliYXNlLWRhdGFAJHtFTU9KSUJBU0VfVkVSU0lPTn1gO1xuY29uc3QgRU1PSklCQVNFX0VNT0pJU19VUkwgPSAobG9jYWxlKSA9PiBgJHtFTU9KSUJBU0VfQ0ROX1VSTH0vJHtsb2NhbGV9L2RhdGEuanNvbmA7XG5jb25zdCBFTU9KSUJBU0VfTUVTU0FHRVNfVVJMID0gKGxvY2FsZSkgPT4gYCR7RU1PSklCQVNFX0NETl9VUkx9LyR7bG9jYWxlfS9tZXNzYWdlcy5qc29uYDtcbmNvbnN0IEVNT0pJQkFTRV9MT0NBTEVTID0gW1xuICBcImJuXCIsXG4gIFwiZGFcIixcbiAgXCJkZVwiLFxuICBcImVuXCIsXG4gIFwiZW4tZ2JcIixcbiAgXCJlc1wiLFxuICBcImVzLW14XCIsXG4gIFwiZXRcIixcbiAgXCJmaVwiLFxuICBcImZyXCIsXG4gIFwiaGlcIixcbiAgXCJodVwiLFxuICBcIml0XCIsXG4gIFwiamFcIixcbiAgXCJrb1wiLFxuICBcImx0XCIsXG4gIFwibXNcIixcbiAgXCJuYlwiLFxuICBcIm5sXCIsXG4gIFwicGxcIixcbiAgXCJwdFwiLFxuICBcInJ1XCIsXG4gIFwic3ZcIixcbiAgXCJ0aFwiLFxuICBcInVrXCIsXG4gIFwiemhcIixcbiAgXCJ6aC1oYW50XCJcbl07XG5jb25zdCBFTU9KSUJBU0VfREVGQVVMVF9MT0NBTEUgPSBcImVuXCI7XG5jb25zdCBDQUNIRV9FTU9KSV9EQVRBX0tFWSA9IChsb2NhbGUpID0+IGBsYi1lbW9qaS1kYXRhLSR7bG9jYWxlfWA7XG5jb25zdCBDQUNIRV9FTU9KSV9NRVRBREFUQV9LRVkgPSAobG9jYWxlKSA9PiBgbGItZW1vamktbWV0YWRhdGEtJHtsb2NhbGV9YDtcbmNvbnN0IENBQ0hFX0VNT0pJX1NFU1NJT05fTUVUQURBVEFfS0VZID0gXCJsYi1lbW9qaS1tZXRhZGF0YVwiO1xuY29uc3QgRU1PSklfREVURUNUSU9OX0NBTlZBU19XSURUSCA9IDIwO1xuY29uc3QgRU1PSklfREVURUNUSU9OX0NBTlZBU19IRUlHSFQgPSAyNTtcbmNvbnN0IEVNT0pJX0RFVEVDVElPTl9DT1VOVFJZX0ZMQUcgPSBcIlxcdXsxRjFFQn1cXHV7MUYxRjd9XCI7XG5mdW5jdGlvbiBnZW5lcmF0ZVJhbmdlSW5kaWNlcyhzdGFydCwgZW5kKSB7XG4gIGNvbnN0IHJhbmdlID0gW107XG4gIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykge1xuICAgIHJhbmdlLnB1c2goaSk7XG4gIH1cbiAgcmV0dXJuIHJhbmdlO1xufVxuZnVuY3Rpb24gZ2V0U3RvcmFnZUl0ZW0oc3RvcmFnZSwga2V5KSB7XG4gIGNvbnN0IGl0ZW0gPSBzdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgcmV0dXJuIGl0ZW0gPyBKU09OLnBhcnNlKGl0ZW0pIDogbnVsbDtcbn1cbmZ1bmN0aW9uIHNldFN0b3JhZ2VJdGVtKHN0b3JhZ2UsIGtleSwgdmFsdWUpIHtcbiAgc3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoRXRhZyh1cmwpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyBtZXRob2Q6IFwiSEVBRFwiIH0pO1xuICAgIHJldHVybiByZXNwb25zZS5oZWFkZXJzLmdldChcImV0YWdcIik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbmZ1bmN0aW9uIGdldEVtb2ppYmFzZVN1cHBvcnRlZExvY2FsZShsb2NhbGUpIHtcbiAgcmV0dXJuIEVNT0pJQkFTRV9MT0NBTEVTLmluY2x1ZGVzKGxvY2FsZSkgPyBsb2NhbGUgOiBFTU9KSUJBU0VfREVGQVVMVF9MT0NBTEU7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEVtb2ppYmFzZURhdGEobG9jYWxlKSB7XG4gIGNvbnN0IFt7IGVtb2ppcywgZW1vamlzRXRhZyB9LCB7IG1lc3NhZ2VzLCBtZXNzYWdlc0V0YWcgfV0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgZmV0Y2goRU1PSklCQVNFX0VNT0pJU19VUkwobG9jYWxlKSkudGhlbihhc3luYyAocmVzcG9uc2UpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVtb2ppczogYXdhaXQgcmVzcG9uc2UuanNvbigpLFxuICAgICAgICBlbW9qaXNFdGFnOiByZXNwb25zZS5oZWFkZXJzLmdldChcImV0YWdcIilcbiAgICAgIH07XG4gICAgfSksXG4gICAgZmV0Y2goRU1PSklCQVNFX01FU1NBR0VTX1VSTChsb2NhbGUpKS50aGVuKGFzeW5jIChyZXNwb25zZSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZXM6IGF3YWl0IHJlc3BvbnNlLmpzb24oKSxcbiAgICAgICAgbWVzc2FnZXNFdGFnOiByZXNwb25zZS5oZWFkZXJzLmdldChcImV0YWdcIilcbiAgICAgIH07XG4gICAgfSlcbiAgXSk7XG4gIHJldHVybiB7XG4gICAgZW1vamlzLFxuICAgIG1lc3NhZ2VzLFxuICAgIGVtb2ppc0V0YWcsXG4gICAgbWVzc2FnZXNFdGFnXG4gIH07XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEVtb2ppYmFzZUV0YWdzKGxvY2FsZSkge1xuICBjb25zdCBbZW1vamlzRXRhZywgbWVzc2FnZXNFdGFnXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBmZXRjaEV0YWcoRU1PSklCQVNFX0VNT0pJU19VUkwobG9jYWxlKSksXG4gICAgZmV0Y2hFdGFnKEVNT0pJQkFTRV9NRVNTQUdFU19VUkwobG9jYWxlKSlcbiAgXSk7XG4gIHJldHVybiB7XG4gICAgZW1vamlzRXRhZyxcbiAgICBtZXNzYWdlc0V0YWdcbiAgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoRW1vamlEYXRhKGxvY2FsZSkge1xuICBjb25zdCB7IGVtb2ppcywgZW1vamlzRXRhZywgbWVzc2FnZXMsIG1lc3NhZ2VzRXRhZyB9ID0gYXdhaXQgZmV0Y2hFbW9qaWJhc2VEYXRhKGxvY2FsZSk7XG4gIGNvbnN0IGNvdW50cnlGbGFnc1N1Ymdyb3VwID0gbWVzc2FnZXMuc3ViZ3JvdXBzLmZpbmQoXG4gICAgKHN1Ymdyb3VwKSA9PiBzdWJncm91cC5rZXkgPT09IFwic3ViZGl2aXNpb24tZmxhZ1wiXG4gICk7XG4gIGNvbnN0IGZpbHRlcmVkR3JvdXBzID0gbWVzc2FnZXMuZ3JvdXBzLmZpbHRlcihcbiAgICAoZ3JvdXApID0+IGdyb3VwLmtleSAhPT0gXCJjb21wb25lbnRcIlxuICApO1xuICBjb25zdCBmaWx0ZXJlZEVtb2ppcyA9IGVtb2ppcy5maWx0ZXIoKGVtb2ppKSA9PiB7XG4gICAgcmV0dXJuIFwiZ3JvdXBcIiBpbiBlbW9qaTtcbiAgfSk7XG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBmaWx0ZXJlZEdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoe1xuICAgIGtleTogZ3JvdXAub3JkZXIsXG4gICAgbmFtZTogY2FwaXRhbGl6ZShncm91cC5tZXNzYWdlKVxuICB9KSk7XG4gIGNvbnN0IHNraW5Ub25lcyA9IG1lc3NhZ2VzLnNraW5Ub25lcy5tYXAoKHNraW5Ub25lKSA9PiAoe1xuICAgIGtleTogc2tpblRvbmUua2V5LFxuICAgIG5hbWU6IGNhcGl0YWxpemUoc2tpblRvbmUubWVzc2FnZSlcbiAgfSkpO1xuICBjb25zdCBjb21wYWN0RW1vamlzID0gZmlsdGVyZWRFbW9qaXMubWFwKChlbW9qaSkgPT4ge1xuICAgIGNvbnN0IGNvbXBhY3RFbW9qaSA9IHtcbiAgICAgIGVtb2ppOiBlbW9qaS5lbW9qaSxcbiAgICAgIGNhdGVnb3J5OiBlbW9qaS5ncm91cCxcbiAgICAgIHZlcnNpb246IGVtb2ppLnZlcnNpb24sXG4gICAgICBuYW1lOiBjYXBpdGFsaXplKGVtb2ppLmxhYmVsKSxcbiAgICAgIHRhZ3M6IGVtb2ppLnRhZ3NcbiAgICB9O1xuICAgIGlmIChjb3VudHJ5RmxhZ3NTdWJncm91cCAmJiBlbW9qaS5zdWJncm91cCA9PT0gY291bnRyeUZsYWdzU3ViZ3JvdXAub3JkZXIpIHtcbiAgICAgIGNvbXBhY3RFbW9qaS5jb3VudHJ5RmxhZyA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBjb21wYWN0RW1vamk7XG4gIH0pO1xuICBjb25zdCBlbW9qaURhdGEgPSB7XG4gICAgZW1vamlzOiBjb21wYWN0RW1vamlzLFxuICAgIGNhdGVnb3JpZXMsXG4gICAgc2tpblRvbmVzXG4gIH07XG4gIHNldFN0b3JhZ2VJdGVtKFxuICAgIGxvY2FsU3RvcmFnZSxcbiAgICBDQUNIRV9FTU9KSV9EQVRBX0tFWShsb2NhbGUpLFxuICAgIGVtb2ppRGF0YVxuICApO1xuICBzZXRTdG9yYWdlSXRlbShcbiAgICBsb2NhbFN0b3JhZ2UsXG4gICAgQ0FDSEVfRU1PSklfTUVUQURBVEFfS0VZKGxvY2FsZSksXG4gICAge1xuICAgICAgZW1vamlzRXRhZyxcbiAgICAgIG1lc3NhZ2VzRXRhZ1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIGVtb2ppRGF0YTtcbn1cbmZ1bmN0aW9uIGRldGVjdEVtb2ppU3VwcG9ydChjYW52YXNDb250ZXh0LCBlbW9qaSkge1xuICBjYW52YXNDb250ZXh0LmNsZWFyUmVjdChcbiAgICAwLFxuICAgIDAsXG4gICAgRU1PSklfREVURUNUSU9OX0NBTlZBU19XSURUSCAqIDIsXG4gICAgRU1PSklfREVURUNUSU9OX0NBTlZBU19IRUlHSFRcbiAgKTtcbiAgY2FudmFzQ29udGV4dC5maWxsU3R5bGUgPSBcIiNmMDBcIjtcbiAgY2FudmFzQ29udGV4dC5maWxsVGV4dChlbW9qaSwgMCwgMjIpO1xuICBjYW52YXNDb250ZXh0LmZpbGxTdHlsZSA9IFwiIzAwZlwiO1xuICBjYW52YXNDb250ZXh0LmZpbGxUZXh0KGVtb2ppLCBFTU9KSV9ERVRFQ1RJT05fQ0FOVkFTX1dJRFRILCAyMik7XG4gIGNvbnN0IHBpeGVscyA9IGNhbnZhc0NvbnRleHQuZ2V0SW1hZ2VEYXRhKFxuICAgIDAsXG4gICAgMCxcbiAgICBFTU9KSV9ERVRFQ1RJT05fQ0FOVkFTX1dJRFRILFxuICAgIEVNT0pJX0RFVEVDVElPTl9DQU5WQVNfSEVJR0hUXG4gICkuZGF0YTtcbiAgY29uc3QgcGl4ZWxDb3VudCA9IHBpeGVscy5sZW5ndGg7XG4gIGxldCBpID0gMDtcbiAgZm9yICg7IGkgPCBwaXhlbENvdW50ICYmICFwaXhlbHNbaSArIDNdOyBpICs9IDQpXG4gICAgO1xuICBpZiAoaSA+PSBwaXhlbENvdW50KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHggPSBFTU9KSV9ERVRFQ1RJT05fQ0FOVkFTX1dJRFRIICsgaSAvIDQgJSBFTU9KSV9ERVRFQ1RJT05fQ0FOVkFTX1dJRFRIO1xuICBjb25zdCB5ID0gTWF0aC5mbG9vcihpIC8gNCAvIEVNT0pJX0RFVEVDVElPTl9DQU5WQVNfV0lEVEgpO1xuICBjb25zdCBwaXhlbCA9IGNhbnZhc0NvbnRleHQuZ2V0SW1hZ2VEYXRhKHgsIHksIDEsIDEpLmRhdGE7XG4gIGlmIChwaXhlbHNbaV0gIT09IHBpeGVsWzBdIHx8IHBpeGVsc1tpICsgMl0gIT09IHBpeGVsWzJdKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChjYW52YXNDb250ZXh0Lm1lYXN1cmVUZXh0KGVtb2ppKS53aWR0aCA+PSBFTU9KSV9ERVRFQ1RJT05fQ0FOVkFTX1dJRFRIKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gZ2V0RW1vamlGb250RmFtaWx5KCkge1xuICB0cnkge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBlbGVtZW50LmRhdGFzZXQuZW1vamkgPSBcIlwiO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgY29uc3QgY29tcHV0ZWRGb250RmFtaWx5ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkuZm9udEZhbWlseTtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuICAgIHJldHVybiBjb21wdXRlZEZvbnRGYW1pbHk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBFTU9KSV9GT05UX0ZBTUlMWTtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0RW1vamlTZXNzaW9uTWV0YWRhdGEoZW1vamlzKSB7XG4gIGNvbnN0IHZlcnNpb25zID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgZm9yIChjb25zdCBlbW9qaSBvZiBlbW9qaXMpIHtcbiAgICBpZiAoIXZlcnNpb25zLmhhcyhlbW9qaS52ZXJzaW9uKSkge1xuICAgICAgdmVyc2lvbnMuc2V0KGVtb2ppLnZlcnNpb24sIGVtb2ppLmVtb2ppKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgZGVzY2VuZGluZ1ZlcnNpb25zID0gWy4uLnZlcnNpb25zLmtleXMoKV0uc29ydCgoYSwgYikgPT4gYiAtIGEpO1xuICBjb25zdCBjYW52YXNDb250ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKS5nZXRDb250ZXh0KFwiMmRcIiwgeyB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUgfSk7XG4gIGlmICghY2FudmFzQ29udGV4dCkge1xuICAgIHJldHVybiB7IGVtb2ppVmVyc2lvbjogZGVzY2VuZGluZ1ZlcnNpb25zWzBdLCBjb3VudHJ5RmxhZ3M6IHRydWUgfTtcbiAgfVxuICBjYW52YXNDb250ZXh0LmZvbnQgPSBgJHtNYXRoLmZsb29yKFxuICAgIEVNT0pJX0RFVEVDVElPTl9DQU5WQVNfSEVJR0hUIC8gMlxuICApfXB4ICR7Z2V0RW1vamlGb250RmFtaWx5KCl9YDtcbiAgY2FudmFzQ29udGV4dC50ZXh0QmFzZWxpbmUgPSBcInRvcFwiO1xuICBjYW52YXNDb250ZXh0LmNhbnZhcy53aWR0aCA9IEVNT0pJX0RFVEVDVElPTl9DQU5WQVNfV0lEVEggKiAyO1xuICBjYW52YXNDb250ZXh0LmNhbnZhcy5oZWlnaHQgPSBFTU9KSV9ERVRFQ1RJT05fQ0FOVkFTX0hFSUdIVDtcbiAgY29uc3Qgc3VwcG9ydHNDb3VudHJ5RmxhZ3MgPSBkZXRlY3RFbW9qaVN1cHBvcnQoXG4gICAgY2FudmFzQ29udGV4dCxcbiAgICBFTU9KSV9ERVRFQ1RJT05fQ09VTlRSWV9GTEFHXG4gICk7XG4gIGZvciAoY29uc3QgdmVyc2lvbiBvZiBkZXNjZW5kaW5nVmVyc2lvbnMpIHtcbiAgICBjb25zdCBlbW9qaSA9IHZlcnNpb25zLmdldCh2ZXJzaW9uKTtcbiAgICBjb25zdCBpc1N1cHBvcnRlZCA9IGRldGVjdEVtb2ppU3VwcG9ydChjYW52YXNDb250ZXh0LCBlbW9qaSk7XG4gICAgaWYgKGlzU3VwcG9ydGVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbW9qaVZlcnNpb246IHZlcnNpb24sXG4gICAgICAgIGNvdW50cnlGbGFnczogc3VwcG9ydHNDb3VudHJ5RmxhZ3NcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgZW1vamlWZXJzaW9uOiBkZXNjZW5kaW5nVmVyc2lvbnNbMF0sXG4gICAgY291bnRyeUZsYWdzOiBzdXBwb3J0c0NvdW50cnlGbGFnc1xuICB9O1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0RW1vamlEYXRhKGxvY2FsZSkge1xuICBjb25zdCBlbW9qaWJhc2VMb2NhbGUgPSBnZXRFbW9qaWJhc2VTdXBwb3J0ZWRMb2NhbGUobG9jYWxlKTtcbiAgY29uc3Qgc2Vzc2lvbk1ldGFkYXRhID0gZ2V0U3RvcmFnZUl0ZW0oXG4gICAgc2Vzc2lvblN0b3JhZ2UsXG4gICAgQ0FDSEVfRU1PSklfU0VTU0lPTl9NRVRBREFUQV9LRVlcbiAgKTtcbiAgY29uc3QgY2FjaGVkRGF0YSA9IGdldFN0b3JhZ2VJdGVtKFxuICAgIGxvY2FsU3RvcmFnZSxcbiAgICBDQUNIRV9FTU9KSV9EQVRBX0tFWShlbW9qaWJhc2VMb2NhbGUpXG4gICk7XG4gIGxldCBkYXRhO1xuICBpZiAoY2FjaGVkRGF0YSkge1xuICAgIGlmIChzZXNzaW9uTWV0YWRhdGEpIHtcbiAgICAgIGRhdGEgPSBjYWNoZWREYXRhO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IGVtb2ppc0V0YWcsIG1lc3NhZ2VzRXRhZyB9ID0gYXdhaXQgZmV0Y2hFbW9qaWJhc2VFdGFncyhlbW9qaWJhc2VMb2NhbGUpO1xuICAgICAgY29uc3QgY2FjaGVkTWV0YWRhdGEgPSBnZXRTdG9yYWdlSXRlbShcbiAgICAgICAgbG9jYWxTdG9yYWdlLFxuICAgICAgICBDQUNIRV9FTU9KSV9NRVRBREFUQV9LRVkoZW1vamliYXNlTG9jYWxlKVxuICAgICAgKTtcbiAgICAgIGlmIChjYWNoZWRNZXRhZGF0YSAmJiBlbW9qaXNFdGFnID09PSBjYWNoZWRNZXRhZGF0YS5lbW9qaXNFdGFnICYmIG1lc3NhZ2VzRXRhZyA9PT0gY2FjaGVkTWV0YWRhdGEubWVzc2FnZXNFdGFnKSB7XG4gICAgICAgIGRhdGEgPSBjYWNoZWREYXRhO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YSA9IGF3YWl0IGZldGNoRW1vamlEYXRhKGVtb2ppYmFzZUxvY2FsZSk7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGRhdGEgPSBhd2FpdCBmZXRjaEVtb2ppRGF0YShlbW9qaWJhc2VMb2NhbGUpO1xuICB9XG4gIGNvbnN0IG5ld1Nlc3Npb25NZXRhZGF0YSA9IHNlc3Npb25NZXRhZGF0YSA/PyBnZXRFbW9qaVNlc3Npb25NZXRhZGF0YShkYXRhLmVtb2ppcyk7XG4gIHNldFN0b3JhZ2VJdGVtKFxuICAgIHNlc3Npb25TdG9yYWdlLFxuICAgIENBQ0hFX0VNT0pJX1NFU1NJT05fTUVUQURBVEFfS0VZLFxuICAgIG5ld1Nlc3Npb25NZXRhZGF0YVxuICApO1xuICBjb25zdCBmaWx0ZXJlZEVtb2ppcyA9IGRhdGEuZW1vamlzLmZpbHRlcigoZW1vamkpID0+IHtcbiAgICBjb25zdCBpc1N1cHBvcnRlZFZlcnNpb24gPSBlbW9qaS52ZXJzaW9uIDw9IG5ld1Nlc3Npb25NZXRhZGF0YS5lbW9qaVZlcnNpb247XG4gICAgcmV0dXJuIGVtb2ppLmNvdW50cnlGbGFnID8gaXNTdXBwb3J0ZWRWZXJzaW9uICYmIG5ld1Nlc3Npb25NZXRhZGF0YS5jb3VudHJ5RmxhZ3MgOiBpc1N1cHBvcnRlZFZlcnNpb247XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIGVtb2ppczogZmlsdGVyZWRFbW9qaXMsXG4gICAgY2F0ZWdvcmllczogZGF0YS5jYXRlZ29yaWVzLFxuICAgIHNraW5Ub25lczogZGF0YS5za2luVG9uZXNcbiAgfTtcbn1cbmZ1bmN0aW9uIGZpbHRlckVtb2ppcyhlbW9qaXMsIHNlYXJjaCkge1xuICBpZiAoIXNlYXJjaCkge1xuICAgIHJldHVybiBlbW9qaXM7XG4gIH1cbiAgY29uc3Qgc2VhcmNoVGV4dCA9IHNlYXJjaC50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgcmV0dXJuIGVtb2ppcy5maWx0ZXIoXG4gICAgKGVtb2ppKSA9PiBlbW9qaS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGV4dCkgfHwgZW1vamkudGFncz8uc29tZSgodGFnKSA9PiB0YWcudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXh0KSlcbiAgKTtcbn1cbmZ1bmN0aW9uIGdlbmVyYXRlRW1vamlQaWNrZXJEYXRhKGVtb2ppcywgY2F0ZWdvcmllcywgY29sdW1ucykge1xuICBsZXQgY3VycmVudEluZGV4ID0gMDtcbiAgY29uc3Qgcm93cyA9IFtdO1xuICBjb25zdCBpbmRleGVkRW1vamlzID0gZW1vamlzLm1hcCgoZW1vamksIGluZGV4KSA9PiAoeyAuLi5lbW9qaSwgaW5kZXggfSkpO1xuICBjb25zdCBjYXRlZ29yaWVzUm93Q291bnRzID0gW107XG4gIGNvbnN0IGNhdGVnb3JpZXNSb3dJbmRpY2VzID0gW107XG4gIGNvbnN0IGNhdGVnb3JpZXNOYW1lcyA9IFtdO1xuICBjb25zdCBjYXRlZ29yaXplZEVtb2ppcyA9IGNhdGVnb3JpZXMubWFwKChjYXRlZ29yeSkgPT4gKHtcbiAgICAuLi5jYXRlZ29yeSxcbiAgICBlbW9qaXM6IGluZGV4ZWRFbW9qaXMuZmlsdGVyKChlbW9qaSkgPT4gZW1vamkuY2F0ZWdvcnkgPT09IGNhdGVnb3J5LmtleSlcbiAgfSkpLmZpbHRlcigoY2F0ZWdvcnkpID0+IGNhdGVnb3J5LmVtb2ppcy5sZW5ndGggPiAwKTtcbiAgZm9yIChjb25zdCBjYXRlZ29yeSBvZiBjYXRlZ29yaXplZEVtb2ppcykge1xuICAgIGNvbnN0IGNhdGVnb3J5Um93cyA9IGNodW5rKGNhdGVnb3J5LmVtb2ppcywgY29sdW1ucyk7XG4gICAgY29uc3QgbmV4dEluZGV4ID0gY3VycmVudEluZGV4ICsgY2F0ZWdvcnlSb3dzLmxlbmd0aDtcbiAgICByb3dzLnB1c2goLi4uY2F0ZWdvcnlSb3dzKTtcbiAgICBjYXRlZ29yaWVzTmFtZXMucHVzaChjYXRlZ29yeS5uYW1lKTtcbiAgICBjYXRlZ29yaWVzUm93Q291bnRzLnB1c2goY2F0ZWdvcnlSb3dzLmxlbmd0aCk7XG4gICAgY2F0ZWdvcmllc1Jvd0luZGljZXMucHVzaChcbiAgICAgIGdlbmVyYXRlUmFuZ2VJbmRpY2VzKGN1cnJlbnRJbmRleCwgbmV4dEluZGV4IC0gMSlcbiAgICApO1xuICAgIGN1cnJlbnRJbmRleCA9IG5leHRJbmRleDtcbiAgfVxuICByZXR1cm4ge1xuICAgIGNvdW50OiBlbW9qaXMubGVuZ3RoLFxuICAgIHJvd3MsXG4gICAgY2F0ZWdvcmllczogY2F0ZWdvcmllc05hbWVzLFxuICAgIGNhdGVnb3JpZXNSb3dDb3VudHMsXG4gICAgY2F0ZWdvcmllc1Jvd0luZGljZXNcbiAgfTtcbn1cblxuZXhwb3J0IHsgZmlsdGVyRW1vamlzLCBnZW5lcmF0ZUVtb2ppUGlja2VyRGF0YSwgZ2V0RW1vamlEYXRhIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD11dGlscy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/EmojiPicker/utils.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Timestamp.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/Timestamp.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Timestamp: () => (/* binding */ Timestamp)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/capitalize.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/capitalize.mjs\");\n/* harmony import */ var _utils_intl_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/intl.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/intl.mjs\");\n/* harmony import */ var _utils_use_interval_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/use-interval.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-interval.mjs\");\n/* harmony import */ var _utils_use_rerender_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/use-rerender.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-rerender.mjs\");\n/* __next_internal_client_entry_do_not_use__ Timestamp auto */ \n\n\n\n\n\nconst DYNAMIC_DATE_THRESHOLD = 3 * 24 * 60 * 60 * 1e3;\nconst RENDER_INTERVAL = 30 * 1e3;\nconst TIMESTAMP_NAME = \"Timestamp\";\nconst relativeUnits = {\n    seconds: 60,\n    minutes: 60,\n    hours: 24,\n    days: 7,\n    weeks: 4.34524,\n    months: 12\n};\nfunction formatVerboseDate(date, locale) {\n    const formatter = (0,_utils_intl_mjs__WEBPACK_IMPORTED_MODULE_1__.dateTimeFormat)(locale, {\n        year: \"numeric\",\n        month: \"numeric\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"numeric\"\n    });\n    return (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_2__.capitalize)(formatter.format(date));\n}\nfunction formatShortDate(date, locale) {\n    const formatter = (0,_utils_intl_mjs__WEBPACK_IMPORTED_MODULE_1__.dateTimeFormat)(locale, {\n        month: \"short\",\n        day: \"numeric\"\n    });\n    return (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_2__.capitalize)(formatter.format(date));\n}\nconst localesWithBrokenNarrowRelativeFormatting = [\n    \"br\",\n    \"fr\",\n    \"nb\",\n    \"nn\",\n    \"no\",\n    \"ro\",\n    \"sv\"\n];\nfunction formatRelativeDate(date, locale) {\n    let resolvedLocale;\n    if (locale) {\n        resolvedLocale = locale;\n    } else {\n        const formatter2 = (0,_utils_intl_mjs__WEBPACK_IMPORTED_MODULE_1__.relativeTimeFormat)();\n        resolvedLocale = formatter2.resolvedOptions().locale;\n    }\n    const isBrokenWhenNarrow = localesWithBrokenNarrowRelativeFormatting.some((locale2)=>resolvedLocale === locale2 || resolvedLocale.startsWith(`${locale2}-`));\n    const formatter = (0,_utils_intl_mjs__WEBPACK_IMPORTED_MODULE_1__.relativeTimeFormat)(resolvedLocale, {\n        style: isBrokenWhenNarrow ? \"short\" : \"narrow\",\n        numeric: \"auto\"\n    });\n    let difference = (date.getTime() - Date.now()) / 1e3;\n    if (difference > -relativeUnits.seconds && difference < relativeUnits.seconds) {\n        return formatter.format(0, \"seconds\");\n    }\n    for (const [unit, length] of Object.entries(relativeUnits)){\n        if (Math.abs(difference) < length) {\n            return formatter.format(Math.round(difference), unit);\n        }\n        difference /= length;\n    }\n    return (0,_utils_capitalize_mjs__WEBPACK_IMPORTED_MODULE_2__.capitalize)(formatter.format(Math.round(difference), \"years\"));\n}\nfunction formatDynamicDate(date, locale) {\n    return date.getTime() > Date.now() - DYNAMIC_DATE_THRESHOLD ? formatRelativeDate(date, locale) : formatShortDate(date, locale);\n}\nconst Timestamp = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ date, locale, children: renderChildren = formatDynamicDate, title: renderTitle = formatVerboseDate, dateTime, interval = RENDER_INTERVAL, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_3__.Slot : \"time\";\n    const [rerender, key] = (0,_utils_use_rerender_mjs__WEBPACK_IMPORTED_MODULE_4__.useRerender)();\n    const parsedDate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>new Date(date), [\n        date\n    ]);\n    const normalizedDate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>parsedDate.toISOString(), [\n        parsedDate\n    ]);\n    const title = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>typeof renderTitle === \"function\" ? renderTitle(parsedDate, locale) : renderTitle, [\n        renderTitle,\n        parsedDate,\n        key\n    ]);\n    const children = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>typeof renderChildren === \"function\" ? renderChildren(parsedDate, locale) : renderChildren, [\n        renderChildren,\n        parsedDate,\n        key\n    ]);\n    (0,_utils_use_interval_mjs__WEBPACK_IMPORTED_MODULE_5__.useInterval)(rerender, interval);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        ...props,\n        ref: forwardedRef,\n        dateTime: dateTime ?? normalizedDate,\n        title\n    }, children);\n});\nif (true) {\n    Timestamp.displayName = TIMESTAMP_NAME;\n}\n //# sourceMappingURL=Timestamp.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL1RpbWVzdGFtcC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQVlBLE1BQUFBLHlCQUFBO0FBQ0EsTUFBQUMsa0JBQUE7QUFFQSxNQUFBQyxpQkFBQTtBQStCQSxNQUFBQyxnQkFBQTtJQUFzQkMsU0FBQTtJQUNYQyxTQUFBO0lBQ0FDLE9BQUE7SUFDRkMsTUFBQTtJQUNEQyxPQUFBO0lBQ0NDLFFBQUE7QUFFVDtBQUtBLFNBQUFDLGtCQUFBQyxJQUFBLEVBQUFDLE1BQUE7SUFDRSxNQUFBQyxZQUFBQywrREFBQUEsQ0FBQUYsUUFBQTtRQUF5Q0csTUFBQTtRQUNqQ0MsT0FBQTtRQUNDQyxLQUFBO1FBQ0ZDLE1BQUE7UUFDQ0MsUUFBQTtJQUNFO0lBR1YsT0FBQUMsaUVBQUFBLENBQUFQLFVBQUFRLE1BQUEsQ0FBQVY7QUFDRjtBQUtBLFNBQUFXLGdCQUFBWCxJQUFBLEVBQUFDLE1BQUE7SUFDRSxNQUFBQyxZQUFBQywrREFBQUEsQ0FBQUYsUUFBQTtRQUF5Q0ksT0FBQTtRQUNoQ0MsS0FBQTtJQUNGO0lBR1AsT0FBQUcsaUVBQUFBLENBQUFQLFVBQUFRLE1BQUEsQ0FBQVY7QUFDRjtBQUdBLE1BQUFZLDRDQUFBO0lBQWtEO0lBQ2hEO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUVGO0FBS0EsU0FBQUMsbUJBQUFiLElBQUEsRUFBQUMsTUFBQTtJQUNFLElBQUFhO0lBRUEsSUFBQWIsUUFBQTtRQUNFYSxpQkFBQWI7SUFBaUI7UUFFakIsTUFBQWMsYUFBQUMsbUVBQUFBO1FBRUFGLGlCQUFBQyxXQUFBRSxlQUFBLEdBQUFoQixNQUFBO0lBQTZDO0lBRy9DLE1BQUFpQixxQkFBQU4sMENBQUFPLElBQUEsQ0FBcUUsQ0FBQUMsVUFBQU4sbUJBQUFNLFdBQUFOLGVBQUFPLFVBQUEsSUFBQUQsUUFBQTtJQUtyRSxNQUFBbEIsWUFBQWMsbUVBQUFBLENBQUFGLGdCQUFBO1FBQXFEUSxPQUFBSixxQkFBQTtRQUNiSyxTQUFBO0lBQzdCO0lBR1gsSUFBQUMsYUFBQSxDQUFBeEIsS0FBQXlCLE9BQUEsS0FBQUMsS0FBQUMsR0FBQTtJQUVBLElBQUFILGFBQUEsQ0FBQWhDLGNBQUFDLE9BQUEsSUFBQStCLGFBQUFoQyxjQUFBQyxPQUFBO1FBSUUsT0FBQVMsVUFBQVEsTUFBQTtJQUFvQztJQUd0QyxZQUFBa0IsTUFBQUMsT0FBQSxJQUFBQyxPQUFBQyxPQUFBLENBQUF2QyxlQUFBO1FBQ0UsSUFBQXdDLEtBQUFDLEdBQUEsQ0FBQVQsY0FBQUssUUFBQTtZQUNFLE9BQUEzQixVQUFBUSxNQUFBLENBQWlCc0IsS0FBQUUsS0FBQSxDQUFBVixhQUNNSTtRQUV2QjtRQUdGSixjQUFBSztJQUFjO0lBR2hCLE9BQUFwQixpRUFBQUEsQ0FBQVAsVUFBQVEsTUFBQSxDQUFBc0IsS0FBQUUsS0FBQSxDQUFBVixhQUFBO0FBQ0Y7QUFNQSxTQUFBVyxrQkFBQW5DLElBQUEsRUFBQUMsTUFBQTtJQUNFLE9BQUFELEtBQUF5QixPQUFBLEtBQUFDLEtBQUFDLEdBQUEsS0FBQXRDLHlCQUFBd0IsbUJBQUFiLE1BQUFDLFVBQUFVLGdCQUFBWCxNQUFBQztBQUdGO0FBZU8sTUFBQW1DLDBCQUFBQyxpREFBQUEsQ0FBa0IsR0FFckJyQyxJQUFBLEVBQ0VDLE1BQUEsRUFDQXFDLFVBQUFDLGlCQUFBSixpQkFBQSxFQUMyQkssT0FBQUMsY0FBQTFDLGlCQUFBLEVBQ04yQyxRQUFBLEVBQ3JCQyxXQUFBckQsZUFBQSxFQUNXc0QsT0FBQSxFQUNYLEdBQUFDLE9BQ0csRUFBQUM7SUFJTCxNQUFBQyxZQUFBSCxVQUFBSSxzREFBQUEsR0FBQTtJQUNBLE9BQUFDLFVBQUFDLElBQUEsR0FBQUMsb0VBQUFBO0lBQ0EsTUFBQUMsYUFBQUMsOENBQUFBLENBQUEsUUFBQTNCLEtBQUExQixPQUFBO1FBQUFBO0tBQUE7SUFDQSxNQUFBc0QsaUJBQUFELDhDQUFBQSxDQUF1QixJQUFBRCxXQUFBRyxXQUFBLElBQ1E7UUFBQUg7S0FBQTtJQUcvQixNQUFBWixRQUFBYSw4Q0FBQUEsQ0FBYyxXQUFBWixnQkFBQSxhQUFBQSxZQUFBVyxZQUFBbkQsVUFBQXdDLGFBSU47UUFBQUE7UUFBQVc7UUFBQUY7S0FBQTtJQUlSLE1BQUFaLFdBQUFlLDhDQUFBQSxDQUFpQixXQUFBZCxtQkFBQSxhQUFBQSxlQUFBYSxZQUFBbkQsVUFBQXNDLGdCQUlUO1FBQUFBO1FBQUFhO1FBQUFGO0tBQUE7SUFLUk0sb0VBQVdBLENBQVhQLFVBQUFOO0lBRUEscUNBQUFjLGdEQUFBLENBQUFWLFdBQUE7UUFDRyxHQUFBRixLQUFBO1FBQ0tjLEtBQUFiO1FBQ0NKLFVBQUFBLFlBQUFZO1FBQ2lCZDtJQUN0QixHQUFBRjtBQUdGO0FBS04sSUFBQXNCLElBQUE7SUFDRXhCLFVBQUF5QixXQUFBLEdBQUF0RTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi4vLi4vc3JjL3ByaW1pdGl2ZXMvVGltZXN0YW1wLnRzeD9kODI1Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgeyBTbG90IH0gZnJvbSBcIkByYWRpeC11aS9yZWFjdC1zbG90XCI7XG5pbXBvcnQgdHlwZSB7IFJlYWN0Tm9kZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IFJlYWN0LCB7IGZvcndhcmRSZWYsIHVzZU1lbW8gfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHR5cGUgeyBDb21wb25lbnRQcm9wc1dpdGhTbG90IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBjYXBpdGFsaXplIH0gZnJvbSBcIi4uL3V0aWxzL2NhcGl0YWxpemVcIjtcbmltcG9ydCB7IGRhdGVUaW1lRm9ybWF0LCByZWxhdGl2ZVRpbWVGb3JtYXQgfSBmcm9tIFwiLi4vdXRpbHMvaW50bFwiO1xuaW1wb3J0IHsgdXNlSW50ZXJ2YWwgfSBmcm9tIFwiLi4vdXRpbHMvdXNlLWludGVydmFsXCI7XG5pbXBvcnQgeyB1c2VSZXJlbmRlciB9IGZyb20gXCIuLi91dGlscy91c2UtcmVyZW5kZXJcIjtcblxuY29uc3QgRFlOQU1JQ19EQVRFX1RIUkVTSE9MRCA9IDMgKiAyNCAqIDYwICogNjAgKiAxMDAwOyAvLyAzIGRheXNcbmNvbnN0IFJFTkRFUl9JTlRFUlZBTCA9IDMwICogMTAwMDsgLy8gMzAgc2Vjb25kc1xuXG5jb25zdCBUSU1FU1RBTVBfTkFNRSA9IFwiVGltZXN0YW1wXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZXN0YW1wUHJvcHNcbiAgZXh0ZW5kcyBPbWl0PENvbXBvbmVudFByb3BzV2l0aFNsb3Q8XCJ0aW1lXCI+LCBcImNoaWxkcmVuXCIgfCBcInRpdGxlXCI+IHtcbiAgLyoqXG4gICAqIFRoZSBkYXRlIHRvIGRpc3BsYXkuXG4gICAqL1xuICBkYXRlOiBEYXRlIHwgc3RyaW5nIHwgbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBBIGZ1bmN0aW9uIHRvIGZvcm1hdCB0aGUgZGlzcGxheWVkIGRhdGUuXG4gICAqL1xuICBjaGlsZHJlbj86IChkYXRlOiBEYXRlLCBsb2NhbGU/OiBzdHJpbmcpID0+IFJlYWN0Tm9kZTtcblxuICAvKipcbiAgICogVGhlIGB0aXRsZWAgYXR0cmlidXRlJ3MgdmFsdWUgb3IgYSBmdW5jdGlvbiB0byBmb3JtYXQgaXQuXG4gICAqL1xuICB0aXRsZT86IHN0cmluZyB8ICgoZGF0ZTogRGF0ZSwgbG9jYWxlPzogc3RyaW5nKSA9PiBzdHJpbmcpO1xuXG4gIC8qKlxuICAgKiBUaGUgaW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzIGF0IHdoaWNoIHRoZSBjb21wb25lbnQgd2lsbCByZS1yZW5kZXIuXG4gICAqIENhbiBiZSBzZXQgdG8gYGZhbHNlYCB0byBkaXNhYmxlIHJlLXJlbmRlcmluZy5cbiAgICovXG4gIGludGVydmFsPzogbnVtYmVyIHwgZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBsb2NhbGUgdXNlZCB3aGVuIGZvcm1hdHRpbmcgdGhlIGRhdGUuXG4gICAqL1xuICBsb2NhbGU/OiBzdHJpbmc7XG59XG5cbmNvbnN0IHJlbGF0aXZlVW5pdHMgPSB7XG4gIHNlY29uZHM6IDYwLFxuICBtaW51dGVzOiA2MCxcbiAgaG91cnM6IDI0LFxuICBkYXlzOiA3LFxuICB3ZWVrczogNC4zNDUyNCxcbiAgbW9udGhzOiAxMixcbn07XG5cbi8qKlxuICogRm9ybWF0cyBhIGRhdGUgYWJzb2x1dGVseS5cbiAqL1xuZnVuY3Rpb24gZm9ybWF0VmVyYm9zZURhdGUoZGF0ZTogRGF0ZSwgbG9jYWxlPzogc3RyaW5nKSB7XG4gIGNvbnN0IGZvcm1hdHRlciA9IGRhdGVUaW1lRm9ybWF0KGxvY2FsZSwge1xuICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgIG1vbnRoOiBcIm51bWVyaWNcIixcbiAgICBkYXk6IFwibnVtZXJpY1wiLFxuICAgIGhvdXI6IFwibnVtZXJpY1wiLFxuICAgIG1pbnV0ZTogXCJudW1lcmljXCIsXG4gIH0pO1xuXG4gIHJldHVybiBjYXBpdGFsaXplKGZvcm1hdHRlci5mb3JtYXQoZGF0ZSkpO1xufVxuXG4vKipcbiAqIEZvcm1hdHMgYSBkYXRlIGFic29sdXRlbHkgd2l0aCBvbmx5IHRoZSBkYXkgYW5kIG1vbnRoLlxuICovXG5mdW5jdGlvbiBmb3JtYXRTaG9ydERhdGUoZGF0ZTogRGF0ZSwgbG9jYWxlPzogc3RyaW5nKSB7XG4gIGNvbnN0IGZvcm1hdHRlciA9IGRhdGVUaW1lRm9ybWF0KGxvY2FsZSwge1xuICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgZGF5OiBcIm51bWVyaWNcIixcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcGl0YWxpemUoZm9ybWF0dGVyLmZvcm1hdChkYXRlKSk7XG59XG5cbi8vIFNvbWUgbG9jYWxlcycgcmVsYXRpdmUgZm9ybWF0dGluZyBjYW4gYmUgYnJva2VuIChlLmcuIFwiLTFoXCIpIHdoZW4gdXNpbmcgdGhlIG5hcnJvdyBzdHlsZS5cbmNvbnN0IGxvY2FsZXNXaXRoQnJva2VuTmFycm93UmVsYXRpdmVGb3JtYXR0aW5nID0gW1xuICBcImJyXCIsXG4gIFwiZnJcIixcbiAgXCJuYlwiLFxuICBcIm5uXCIsXG4gIFwibm9cIixcbiAgXCJyb1wiLFxuICBcInN2XCIsXG5dO1xuXG4vKipcbiAqIEZvcm1hdHMgYSBkYXRlIHJlbGF0aXZlbHkuXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdFJlbGF0aXZlRGF0ZShkYXRlOiBEYXRlLCBsb2NhbGU/OiBzdHJpbmcpIHtcbiAgbGV0IHJlc29sdmVkTG9jYWxlOiBzdHJpbmc7XG5cbiAgaWYgKGxvY2FsZSkge1xuICAgIHJlc29sdmVkTG9jYWxlID0gbG9jYWxlO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGZvcm1hdHRlciA9IHJlbGF0aXZlVGltZUZvcm1hdCgpO1xuXG4gICAgcmVzb2x2ZWRMb2NhbGUgPSBmb3JtYXR0ZXIucmVzb2x2ZWRPcHRpb25zKCkubG9jYWxlO1xuICB9XG5cbiAgY29uc3QgaXNCcm9rZW5XaGVuTmFycm93ID0gbG9jYWxlc1dpdGhCcm9rZW5OYXJyb3dSZWxhdGl2ZUZvcm1hdHRpbmcuc29tZShcbiAgICAobG9jYWxlKSA9PlxuICAgICAgcmVzb2x2ZWRMb2NhbGUgPT09IGxvY2FsZSB8fCByZXNvbHZlZExvY2FsZS5zdGFydHNXaXRoKGAke2xvY2FsZX0tYClcbiAgKTtcblxuICBjb25zdCBmb3JtYXR0ZXIgPSByZWxhdGl2ZVRpbWVGb3JtYXQocmVzb2x2ZWRMb2NhbGUsIHtcbiAgICBzdHlsZTogaXNCcm9rZW5XaGVuTmFycm93ID8gXCJzaG9ydFwiIDogXCJuYXJyb3dcIixcbiAgICBudW1lcmljOiBcImF1dG9cIixcbiAgfSk7XG5cbiAgbGV0IGRpZmZlcmVuY2UgPSAoZGF0ZS5nZXRUaW1lKCkgLSBEYXRlLm5vdygpKSAvIDEwMDA7XG5cbiAgaWYgKFxuICAgIGRpZmZlcmVuY2UgPiAtcmVsYXRpdmVVbml0cy5zZWNvbmRzICYmXG4gICAgZGlmZmVyZW5jZSA8IHJlbGF0aXZlVW5pdHMuc2Vjb25kc1xuICApIHtcbiAgICByZXR1cm4gZm9ybWF0dGVyLmZvcm1hdCgwLCBcInNlY29uZHNcIik7XG4gIH1cblxuICBmb3IgKGNvbnN0IFt1bml0LCBsZW5ndGhdIG9mIE9iamVjdC5lbnRyaWVzKHJlbGF0aXZlVW5pdHMpKSB7XG4gICAgaWYgKE1hdGguYWJzKGRpZmZlcmVuY2UpIDwgbGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZm9ybWF0dGVyLmZvcm1hdChcbiAgICAgICAgTWF0aC5yb3VuZChkaWZmZXJlbmNlKSxcbiAgICAgICAgdW5pdCBhcyBJbnRsLlJlbGF0aXZlVGltZUZvcm1hdFVuaXRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgZGlmZmVyZW5jZSAvPSBsZW5ndGg7XG4gIH1cblxuICByZXR1cm4gY2FwaXRhbGl6ZShmb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQoZGlmZmVyZW5jZSksIFwieWVhcnNcIikpO1xufVxuXG4vKipcbiAqIEZvcm1hdHMgYSBkYXRlIHJlbGF0aXZlbHkgaWYgaXQncyByZWNlbnQsXG4gKiBvdGhlcndpc2UgYWJzb2x1dGVseSB3aXRoIG9ubHkgdGhlIGRheSBhbmQgbW9udGguXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdER5bmFtaWNEYXRlKGRhdGU6IERhdGUsIGxvY2FsZT86IHN0cmluZykge1xuICByZXR1cm4gZGF0ZS5nZXRUaW1lKCkgPiBEYXRlLm5vdygpIC0gRFlOQU1JQ19EQVRFX1RIUkVTSE9MRFxuICAgID8gZm9ybWF0UmVsYXRpdmVEYXRlKGRhdGUsIGxvY2FsZSlcbiAgICA6IGZvcm1hdFNob3J0RGF0ZShkYXRlLCBsb2NhbGUpO1xufVxuXG4vKipcbiAqIERpc3BsYXlzIGEgZm9ybWF0dGVkIGRhdGUsIGFuZCBhdXRvbWF0aWNhbGx5IHJlLXJlbmRlcnMgdG8gc3VwcG9ydCByZWxhdGl2ZVxuICogZm9ybWF0dGluZy4gRGVmYXVsdHMgdG8gcmVsYXRpdmUgZm9ybWF0dGluZyBmb3IgcmVjZW50IGRhdGVzIGFuZCBhIHNob3J0XG4gKiBhYnNvbHV0ZSBmb3JtYXR0aW5nIGZvciBvbGRlciBvbmVzLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8VGltZXN0YW1wIGRhdGU9e25ldyBEYXRlKCl9IC8+XG4gKlxuICogQGV4YW1wbGVcbiAqIDxUaW1lc3RhbXAgZGF0ZT17bmV3IERhdGUoKX0gdGl0bGU9eyhkYXRlKSA9PiBkYXRlLnRvSVNPU3RyaW5nKCl9IGludGVydmFsPXtmYWxzZX0+XG4gKiAgIHsoZGF0ZSkgPT4gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKX1cbiAqIDwvVGltZXN0YW1wPlxuICovXG5leHBvcnQgY29uc3QgVGltZXN0YW1wID0gZm9yd2FyZFJlZjxIVE1MVGltZUVsZW1lbnQsIFRpbWVzdGFtcFByb3BzPihcbiAgKFxuICAgIHtcbiAgICAgIGRhdGUsXG4gICAgICBsb2NhbGUsXG4gICAgICBjaGlsZHJlbjogcmVuZGVyQ2hpbGRyZW4gPSBmb3JtYXREeW5hbWljRGF0ZSxcbiAgICAgIHRpdGxlOiByZW5kZXJUaXRsZSA9IGZvcm1hdFZlcmJvc2VEYXRlLFxuICAgICAgZGF0ZVRpbWUsXG4gICAgICBpbnRlcnZhbCA9IFJFTkRFUl9JTlRFUlZBTCxcbiAgICAgIGFzQ2hpbGQsXG4gICAgICAuLi5wcm9wc1xuICAgIH0sXG4gICAgZm9yd2FyZGVkUmVmXG4gICkgPT4ge1xuICAgIGNvbnN0IENvbXBvbmVudCA9IGFzQ2hpbGQgPyBTbG90IDogXCJ0aW1lXCI7XG4gICAgY29uc3QgW3JlcmVuZGVyLCBrZXldID0gdXNlUmVyZW5kZXIoKTtcbiAgICBjb25zdCBwYXJzZWREYXRlID0gdXNlTWVtbygoKSA9PiBuZXcgRGF0ZShkYXRlKSwgW2RhdGVdKTtcbiAgICBjb25zdCBub3JtYWxpemVkRGF0ZSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBwYXJzZWREYXRlLnRvSVNPU3RyaW5nKCksXG4gICAgICBbcGFyc2VkRGF0ZV1cbiAgICApO1xuICAgIGNvbnN0IHRpdGxlID0gdXNlTWVtbyhcbiAgICAgICgpID0+XG4gICAgICAgIHR5cGVvZiByZW5kZXJUaXRsZSA9PT0gXCJmdW5jdGlvblwiXG4gICAgICAgICAgPyByZW5kZXJUaXRsZShwYXJzZWREYXRlLCBsb2NhbGUpXG4gICAgICAgICAgOiByZW5kZXJUaXRsZSxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgICAgIFtyZW5kZXJUaXRsZSwgcGFyc2VkRGF0ZSwga2V5XVxuICAgICk7XG4gICAgY29uc3QgY2hpbGRyZW4gPSB1c2VNZW1vKFxuICAgICAgKCkgPT5cbiAgICAgICAgdHlwZW9mIHJlbmRlckNoaWxkcmVuID09PSBcImZ1bmN0aW9uXCJcbiAgICAgICAgICA/IHJlbmRlckNoaWxkcmVuKHBhcnNlZERhdGUsIGxvY2FsZSlcbiAgICAgICAgICA6IHJlbmRlckNoaWxkcmVuLFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICAgICAgW3JlbmRlckNoaWxkcmVuLCBwYXJzZWREYXRlLCBrZXldXG4gICAgKTtcblxuICAgIHVzZUludGVydmFsKHJlcmVuZGVyLCBpbnRlcnZhbCk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbXBvbmVudFxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgICBkYXRlVGltZT17ZGF0ZVRpbWUgPz8gbm9ybWFsaXplZERhdGV9XG4gICAgICAgIHRpdGxlPXt0aXRsZX1cbiAgICAgID5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9Db21wb25lbnQ+XG4gICAgKTtcbiAgfVxuKTtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICBUaW1lc3RhbXAuZGlzcGxheU5hbWUgPSBUSU1FU1RBTVBfTkFNRTtcbn1cbiJdLCJuYW1lcyI6WyJEWU5BTUlDX0RBVEVfVEhSRVNIT0xEIiwiUkVOREVSX0lOVEVSVkFMIiwiVElNRVNUQU1QX05BTUUiLCJyZWxhdGl2ZVVuaXRzIiwic2Vjb25kcyIsIm1pbnV0ZXMiLCJob3VycyIsImRheXMiLCJ3ZWVrcyIsIm1vbnRocyIsImZvcm1hdFZlcmJvc2VEYXRlIiwiZGF0ZSIsImxvY2FsZSIsImZvcm1hdHRlciIsImRhdGVUaW1lRm9ybWF0IiwieWVhciIsIm1vbnRoIiwiZGF5IiwiaG91ciIsIm1pbnV0ZSIsImNhcGl0YWxpemUiLCJmb3JtYXQiLCJmb3JtYXRTaG9ydERhdGUiLCJsb2NhbGVzV2l0aEJyb2tlbk5hcnJvd1JlbGF0aXZlRm9ybWF0dGluZyIsImZvcm1hdFJlbGF0aXZlRGF0ZSIsInJlc29sdmVkTG9jYWxlIiwiZm9ybWF0dGVyMiIsInJlbGF0aXZlVGltZUZvcm1hdCIsInJlc29sdmVkT3B0aW9ucyIsImlzQnJva2VuV2hlbk5hcnJvdyIsInNvbWUiLCJsb2NhbGUyIiwic3RhcnRzV2l0aCIsInN0eWxlIiwibnVtZXJpYyIsImRpZmZlcmVuY2UiLCJnZXRUaW1lIiwiRGF0ZSIsIm5vdyIsInVuaXQiLCJsZW5ndGgiLCJPYmplY3QiLCJlbnRyaWVzIiwiTWF0aCIsImFicyIsInJvdW5kIiwiZm9ybWF0RHluYW1pY0RhdGUiLCJUaW1lc3RhbXAiLCJmb3J3YXJkUmVmIiwiY2hpbGRyZW4iLCJyZW5kZXJDaGlsZHJlbiIsInRpdGxlIiwicmVuZGVyVGl0bGUiLCJkYXRlVGltZSIsImludGVydmFsIiwiYXNDaGlsZCIsInByb3BzIiwiZm9yd2FyZGVkUmVmIiwiQ29tcG9uZW50IiwiU2xvdCIsInJlcmVuZGVyIiwia2V5IiwidXNlUmVyZW5kZXIiLCJwYXJzZWREYXRlIiwidXNlTWVtbyIsIm5vcm1hbGl6ZWREYXRlIiwidG9JU09TdHJpbmciLCJ1c2VJbnRlcnZhbCIsIlJlYWN0X19kZWZhdWx0IiwiY3JlYXRlRWxlbWVudCIsInJlZiIsInByb2Nlc3MiLCJkaXNwbGF5TmFtZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/Timestamp.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/internal/Emoji.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/primitives/internal/Emoji.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Emoji: () => (/* binding */ Emoji)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../constants.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/constants.mjs\");\n\n\n\n\nconst Emoji = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(\n  ({ emoji, style, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_1__.Slot : \"span\";\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n      role: \"img\",\n      \"aria-label\": emoji,\n      \"data-emoji\": emoji,\n      style: {\n        ...style,\n        fontFamily: _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.EMOJI_FONT_FAMILY,\n        display: \"inline-flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        width: \"1em\",\n        whiteSpace: \"nowrap\"\n      },\n      ...props,\n      ref: forwardedRef\n    }, emoji);\n  }\n);\n\n\n//# sourceMappingURL=Emoji.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9wcmltaXRpdmVzL2ludGVybmFsL0Vtb2ppLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTRDO0FBQ087QUFDSzs7QUFFeEQsY0FBYyxpREFBVTtBQUN4QixLQUFLLGlDQUFpQztBQUN0QyxnQ0FBZ0Msc0RBQUk7QUFDcEMsMkJBQTJCLGdEQUE0QjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDZEQUFpQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFaUI7QUFDakIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3ByaW1pdGl2ZXMvaW50ZXJuYWwvRW1vamkubWpzPzAzNjMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2xvdCB9IGZyb20gJ0ByYWRpeC11aS9yZWFjdC1zbG90JztcbmltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyBmb3J3YXJkUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRU1PSklfRk9OVF9GQU1JTFkgfSBmcm9tICcuLi8uLi9jb25zdGFudHMubWpzJztcblxuY29uc3QgRW1vamkgPSBmb3J3YXJkUmVmKFxuICAoeyBlbW9qaSwgc3R5bGUsIGFzQ2hpbGQsIC4uLnByb3BzIH0sIGZvcndhcmRlZFJlZikgPT4ge1xuICAgIGNvbnN0IENvbXBvbmVudCA9IGFzQ2hpbGQgPyBTbG90IDogXCJzcGFuXCI7XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdF9fZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbXBvbmVudCwge1xuICAgICAgcm9sZTogXCJpbWdcIixcbiAgICAgIFwiYXJpYS1sYWJlbFwiOiBlbW9qaSxcbiAgICAgIFwiZGF0YS1lbW9qaVwiOiBlbW9qaSxcbiAgICAgIHN0eWxlOiB7XG4gICAgICAgIC4uLnN0eWxlLFxuICAgICAgICBmb250RmFtaWx5OiBFTU9KSV9GT05UX0ZBTUlMWSxcbiAgICAgICAgZGlzcGxheTogXCJpbmxpbmUtZmxleFwiLFxuICAgICAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgICAgd2lkdGg6IFwiMWVtXCIsXG4gICAgICAgIHdoaXRlU3BhY2U6IFwibm93cmFwXCJcbiAgICAgIH0sXG4gICAgICAuLi5wcm9wcyxcbiAgICAgIHJlZjogZm9yd2FyZGVkUmVmXG4gICAgfSwgZW1vamkpO1xuICB9XG4pO1xuXG5leHBvcnQgeyBFbW9qaSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RW1vamkubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/primitives/internal/Emoji.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs":
/*!***********************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/shared.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useCurrentUserId: () => (/* binding */ useCurrentUserId),\n/* harmony export */   useMentionSuggestions: () => (/* binding */ useMentionSuggestions)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _liveblocks_react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @liveblocks/react */ \"(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! use-sync-external-store/shim/index.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/index.js\");\n\n\n\n\n\nconst MENTION_SUGGESTIONS_DEBOUNCE = 500;\nconst _cachesByClient = /* @__PURE__ */ new WeakMap();\nfunction getMentionSuggestionsCacheForClient(client) {\n  let cache = _cachesByClient.get(client);\n  if (!cache) {\n    cache = /* @__PURE__ */ new Map();\n    _cachesByClient.set(client, cache);\n  }\n  return cache;\n}\nfunction useMentionSuggestions(search) {\n  const client = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__.useClient)();\n  const room = (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__._useRoom)();\n  const [mentionSuggestions, setMentionSuggestions] = react__WEBPACK_IMPORTED_MODULE_0__.useState();\n  const lastInvokedAt = react__WEBPACK_IMPORTED_MODULE_0__.useRef();\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const resolveMentionSuggestions = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].resolveMentionSuggestions;\n    if (search === void 0 || !resolveMentionSuggestions) {\n      return;\n    }\n    const resolveMentionSuggestionsArgs = { text: search, roomId: room.id };\n    const mentionSuggestionsCacheKey = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.stringify)(resolveMentionSuggestionsArgs);\n    let debounceTimeout;\n    let isCanceled = false;\n    const mentionSuggestionsCache = getMentionSuggestionsCacheForClient(client);\n    const getMentionSuggestions = async () => {\n      try {\n        lastInvokedAt.current = performance.now();\n        const mentionSuggestions2 = await resolveMentionSuggestions(\n          resolveMentionSuggestionsArgs\n        );\n        if (!isCanceled) {\n          setMentionSuggestions(mentionSuggestions2);\n          mentionSuggestionsCache.set(\n            mentionSuggestionsCacheKey,\n            mentionSuggestions2\n          );\n        }\n      } catch (error) {\n        console.error(error?.message);\n      }\n    };\n    if (mentionSuggestionsCache.has(mentionSuggestionsCacheKey)) {\n      setMentionSuggestions(\n        mentionSuggestionsCache.get(mentionSuggestionsCacheKey)\n      );\n    } else if (!lastInvokedAt.current || Math.abs(performance.now() - lastInvokedAt.current) > MENTION_SUGGESTIONS_DEBOUNCE) {\n      void getMentionSuggestions();\n    } else {\n      debounceTimeout = window.setTimeout(() => {\n        void getMentionSuggestions();\n      }, MENTION_SUGGESTIONS_DEBOUNCE);\n    }\n    return () => {\n      isCanceled = true;\n      window.clearTimeout(debounceTimeout);\n    };\n  }, [client, room.id, search]);\n  return mentionSuggestions;\n}\nfunction useCurrentUserIdFromRoom() {\n  return (0,_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__._useSelf)((user) => typeof user.id === \"string\" ? user.id : null);\n}\nfunction useCurrentUserIdFromClient_withClient(client) {\n  const currentUserIdStore = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].currentUserIdStore;\n  return (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStore)(\n    currentUserIdStore.subscribe,\n    currentUserIdStore.get,\n    currentUserIdStore.get\n  );\n}\nfunction useCurrentUserId() {\n  const client = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__.ClientContext);\n  const room = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_liveblocks_react__WEBPACK_IMPORTED_MODULE_2__.RoomContext);\n  if (room !== null) {\n    return useCurrentUserIdFromRoom();\n  } else if (client !== null) {\n    return useCurrentUserIdFromClient_withClient(client);\n  } else {\n    (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.raise)(\n      \"LiveblocksProvider or RoomProvider are missing from the React tree.\"\n    );\n  }\n}\n\n\n//# sourceMappingURL=shared.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zaGFyZWQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUErRDtBQUM2QjtBQUN6QztBQUMwQjs7QUFFN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiw0REFBUztBQUMxQixlQUFlLDJEQUFPO0FBQ3RCLHNEQUFzRCwyQ0FBdUI7QUFDN0Usd0JBQXdCLHlDQUFxQjtBQUM3QyxFQUFFLDRDQUF3QjtBQUMxQiw2Q0FBNkMsdURBQVM7QUFDdEQ7QUFDQTtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDLHVDQUF1QywyREFBUztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsU0FBUywyREFBTztBQUNoQjtBQUNBO0FBQ0Esb0NBQW9DLHVEQUFTO0FBQzdDLFNBQVMsMkZBQW9CO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixpREFBVSxDQUFDLDREQUFhO0FBQ3pDLGVBQWUsaURBQVUsQ0FBQywwREFBVztBQUNyQztBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKLElBQUksdURBQUs7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFbUQ7QUFDbkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3NoYXJlZC5tanM/ZWQ1ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBrSW50ZXJuYWwsIHN0cmluZ2lmeSwgcmFpc2UgfSBmcm9tICdAbGl2ZWJsb2Nrcy9jb3JlJztcbmltcG9ydCB7IHVzZUNsaWVudCwgdXNlUm9vbSwgQ2xpZW50Q29udGV4dCwgUm9vbUNvbnRleHQsIHVzZVNlbGYgfSBmcm9tICdAbGl2ZWJsb2Nrcy9yZWFjdCc7XG5pbXBvcnQgUmVhY3RfX2RlZmF1bHQsIHsgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVN5bmNFeHRlcm5hbFN0b3JlIH0gZnJvbSAndXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS9pbmRleC5qcyc7XG5cbmNvbnN0IE1FTlRJT05fU1VHR0VTVElPTlNfREVCT1VOQ0UgPSA1MDA7XG5jb25zdCBfY2FjaGVzQnlDbGllbnQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTtcbmZ1bmN0aW9uIGdldE1lbnRpb25TdWdnZXN0aW9uc0NhY2hlRm9yQ2xpZW50KGNsaWVudCkge1xuICBsZXQgY2FjaGUgPSBfY2FjaGVzQnlDbGllbnQuZ2V0KGNsaWVudCk7XG4gIGlmICghY2FjaGUpIHtcbiAgICBjYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgX2NhY2hlc0J5Q2xpZW50LnNldChjbGllbnQsIGNhY2hlKTtcbiAgfVxuICByZXR1cm4gY2FjaGU7XG59XG5mdW5jdGlvbiB1c2VNZW50aW9uU3VnZ2VzdGlvbnMoc2VhcmNoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBbbWVudGlvblN1Z2dlc3Rpb25zLCBzZXRNZW50aW9uU3VnZ2VzdGlvbnNdID0gUmVhY3RfX2RlZmF1bHQudXNlU3RhdGUoKTtcbiAgY29uc3QgbGFzdEludm9rZWRBdCA9IFJlYWN0X19kZWZhdWx0LnVzZVJlZigpO1xuICBSZWFjdF9fZGVmYXVsdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMgPSBjbGllbnRba0ludGVybmFsXS5yZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zO1xuICAgIGlmIChzZWFyY2ggPT09IHZvaWQgMCB8fCAhcmVzb2x2ZU1lbnRpb25TdWdnZXN0aW9ucykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCByZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zQXJncyA9IHsgdGV4dDogc2VhcmNoLCByb29tSWQ6IHJvb20uaWQgfTtcbiAgICBjb25zdCBtZW50aW9uU3VnZ2VzdGlvbnNDYWNoZUtleSA9IHN0cmluZ2lmeShyZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zQXJncyk7XG4gICAgbGV0IGRlYm91bmNlVGltZW91dDtcbiAgICBsZXQgaXNDYW5jZWxlZCA9IGZhbHNlO1xuICAgIGNvbnN0IG1lbnRpb25TdWdnZXN0aW9uc0NhY2hlID0gZ2V0TWVudGlvblN1Z2dlc3Rpb25zQ2FjaGVGb3JDbGllbnQoY2xpZW50KTtcbiAgICBjb25zdCBnZXRNZW50aW9uU3VnZ2VzdGlvbnMgPSBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBsYXN0SW52b2tlZEF0LmN1cnJlbnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgY29uc3QgbWVudGlvblN1Z2dlc3Rpb25zMiA9IGF3YWl0IHJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMoXG4gICAgICAgICAgcmVzb2x2ZU1lbnRpb25TdWdnZXN0aW9uc0FyZ3NcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFpc0NhbmNlbGVkKSB7XG4gICAgICAgICAgc2V0TWVudGlvblN1Z2dlc3Rpb25zKG1lbnRpb25TdWdnZXN0aW9uczIpO1xuICAgICAgICAgIG1lbnRpb25TdWdnZXN0aW9uc0NhY2hlLnNldChcbiAgICAgICAgICAgIG1lbnRpb25TdWdnZXN0aW9uc0NhY2hlS2V5LFxuICAgICAgICAgICAgbWVudGlvblN1Z2dlc3Rpb25zMlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3I/Lm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKG1lbnRpb25TdWdnZXN0aW9uc0NhY2hlLmhhcyhtZW50aW9uU3VnZ2VzdGlvbnNDYWNoZUtleSkpIHtcbiAgICAgIHNldE1lbnRpb25TdWdnZXN0aW9ucyhcbiAgICAgICAgbWVudGlvblN1Z2dlc3Rpb25zQ2FjaGUuZ2V0KG1lbnRpb25TdWdnZXN0aW9uc0NhY2hlS2V5KVxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKCFsYXN0SW52b2tlZEF0LmN1cnJlbnQgfHwgTWF0aC5hYnMocGVyZm9ybWFuY2Uubm93KCkgLSBsYXN0SW52b2tlZEF0LmN1cnJlbnQpID4gTUVOVElPTl9TVUdHRVNUSU9OU19ERUJPVU5DRSkge1xuICAgICAgdm9pZCBnZXRNZW50aW9uU3VnZ2VzdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVib3VuY2VUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB2b2lkIGdldE1lbnRpb25TdWdnZXN0aW9ucygpO1xuICAgICAgfSwgTUVOVElPTl9TVUdHRVNUSU9OU19ERUJPVU5DRSk7XG4gICAgfVxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpc0NhbmNlbGVkID0gdHJ1ZTtcbiAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoZGVib3VuY2VUaW1lb3V0KTtcbiAgICB9O1xuICB9LCBbY2xpZW50LCByb29tLmlkLCBzZWFyY2hdKTtcbiAgcmV0dXJuIG1lbnRpb25TdWdnZXN0aW9ucztcbn1cbmZ1bmN0aW9uIHVzZUN1cnJlbnRVc2VySWRGcm9tUm9vbSgpIHtcbiAgcmV0dXJuIHVzZVNlbGYoKHVzZXIpID0+IHR5cGVvZiB1c2VyLmlkID09PSBcInN0cmluZ1wiID8gdXNlci5pZCA6IG51bGwpO1xufVxuZnVuY3Rpb24gdXNlQ3VycmVudFVzZXJJZEZyb21DbGllbnRfd2l0aENsaWVudChjbGllbnQpIHtcbiAgY29uc3QgY3VycmVudFVzZXJJZFN0b3JlID0gY2xpZW50W2tJbnRlcm5hbF0uY3VycmVudFVzZXJJZFN0b3JlO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmUoXG4gICAgY3VycmVudFVzZXJJZFN0b3JlLnN1YnNjcmliZSxcbiAgICBjdXJyZW50VXNlcklkU3RvcmUuZ2V0LFxuICAgIGN1cnJlbnRVc2VySWRTdG9yZS5nZXRcbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZUN1cnJlbnRVc2VySWQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNvbnRleHQoQ2xpZW50Q29udGV4dCk7XG4gIGNvbnN0IHJvb20gPSB1c2VDb250ZXh0KFJvb21Db250ZXh0KTtcbiAgaWYgKHJvb20gIT09IG51bGwpIHtcbiAgICByZXR1cm4gdXNlQ3VycmVudFVzZXJJZEZyb21Sb29tKCk7XG4gIH0gZWxzZSBpZiAoY2xpZW50ICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIHVzZUN1cnJlbnRVc2VySWRGcm9tQ2xpZW50X3dpdGhDbGllbnQoY2xpZW50KTtcbiAgfSBlbHNlIHtcbiAgICByYWlzZShcbiAgICAgIFwiTGl2ZWJsb2Nrc1Byb3ZpZGVyIG9yIFJvb21Qcm92aWRlciBhcmUgbWlzc2luZyBmcm9tIHRoZSBSZWFjdCB0cmVlLlwiXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgeyB1c2VDdXJyZW50VXNlcklkLCB1c2VNZW50aW9uU3VnZ2VzdGlvbnMgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNoYXJlZC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/shared.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-formatting.mjs":
/*!**********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-formatting.mjs ***!
  \**********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withAutoFormatting: () => (/* binding */ withAutoFormatting)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var _utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/get-character.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-character.mjs\");\n/* harmony import */ var _utils_get_match_range_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/get-match-range.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-match-range.mjs\");\n/* harmony import */ var _utils_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/is-empty-string.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty-string.mjs\");\n/* harmony import */ var _utils_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/is-selection-collapsed.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-selection-collapsed.mjs\");\n\n\n\n\n\n\nconst formatters = [\n  {\n    type: \"mark\",\n    mark: \"bold\",\n    character: \"*\"\n  },\n  {\n    type: \"mark\",\n    mark: \"italic\",\n    character: \"_\"\n  },\n  {\n    type: \"mark\",\n    mark: \"strikethrough\",\n    character: \"~\"\n  },\n  {\n    type: \"mark\",\n    mark: \"code\",\n    character: \"`\"\n  }\n];\nconst markFormattingCharacters = formatters.filter((formatter) => formatter.type === \"mark\").map((formatter) => formatter.character);\nfunction formatMark(editor, text, formatter) {\n  if (text !== formatter.character) {\n    return false;\n  }\n  const match = (0,_utils_get_match_range_mjs__WEBPACK_IMPORTED_MODULE_0__.getMatchRange)(editor, editor.selection, [formatter.character]);\n  if (!match || slate__WEBPACK_IMPORTED_MODULE_1__.Range.isCollapsed(match)) {\n    return false;\n  }\n  const formattingCharacter = (0,_utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_2__.getCharacterBefore)(editor, match);\n  if (!formattingCharacter || formattingCharacter.text !== formatter.character) {\n    return false;\n  }\n  const beforeCharacter = (0,_utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_2__.getCharacterBefore)(editor, formattingCharacter.range);\n  if (beforeCharacter && !markFormattingCharacters.includes(beforeCharacter.text) && !(0,_utils_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_3__.isEmptyString)(beforeCharacter.text)) {\n    return false;\n  }\n  const matchText = slate__WEBPACK_IMPORTED_MODULE_1__.Editor.string(editor, match);\n  if (matchText.trim() !== matchText) {\n    return false;\n  }\n  slate__WEBPACK_IMPORTED_MODULE_1__.Transforms.select(editor, match);\n  editor.addMark(formatter.mark, true);\n  slate__WEBPACK_IMPORTED_MODULE_1__.Transforms.collapse(editor, { edge: \"end\" });\n  editor.removeMark(formatter.mark);\n  slate__WEBPACK_IMPORTED_MODULE_1__.Transforms.delete(editor, {\n    at: formattingCharacter.range\n  });\n  return true;\n}\nfunction withAutoFormatting(editor) {\n  const { insertText } = editor;\n  editor.insertText = (text, options) => {\n    if (!(0,_utils_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_4__.isSelectionCollapsed)(editor.selection)) {\n      return insertText(text, options);\n    }\n    let shouldInsertText = true;\n    for (const formatter of formatters) {\n      if (formatter.type === \"mark\") {\n        if (formatMark(editor, text, formatter)) {\n          shouldInsertText = false;\n        }\n      }\n    }\n    if (shouldInsertText) {\n      insertText(text, options);\n    }\n  };\n  return editor;\n}\n\n\n//# sourceMappingURL=auto-formatting.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL2F1dG8tZm9ybWF0dGluZy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQWtEO0FBQ2M7QUFDSDtBQUNBO0FBQ2M7O0FBRTNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5RUFBYTtBQUM3QixnQkFBZ0Isd0NBQUs7QUFDckI7QUFDQTtBQUNBLDhCQUE4Qiw0RUFBa0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDRFQUFrQjtBQUM1QyxzRkFBc0YseUVBQWE7QUFDbkc7QUFDQTtBQUNBLG9CQUFvQix5Q0FBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQSxFQUFFLDZDQUFVO0FBQ1o7QUFDQSxFQUFFLDZDQUFVLG9CQUFvQixhQUFhO0FBQzdDO0FBQ0EsRUFBRSw2Q0FBVTtBQUNaO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFVBQVUsYUFBYTtBQUN2QjtBQUNBLFNBQVMsdUZBQW9CO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU4QjtBQUM5QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3Qvc2xhdGUvcGx1Z2lucy9hdXRvLWZvcm1hdHRpbmcubWpzPzdhOTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmFuZ2UsIEVkaXRvciwgVHJhbnNmb3JtcyB9IGZyb20gJ3NsYXRlJztcbmltcG9ydCB7IGdldENoYXJhY3RlckJlZm9yZSB9IGZyb20gJy4uL3V0aWxzL2dldC1jaGFyYWN0ZXIubWpzJztcbmltcG9ydCB7IGdldE1hdGNoUmFuZ2UgfSBmcm9tICcuLi91dGlscy9nZXQtbWF0Y2gtcmFuZ2UubWpzJztcbmltcG9ydCB7IGlzRW1wdHlTdHJpbmcgfSBmcm9tICcuLi91dGlscy9pcy1lbXB0eS1zdHJpbmcubWpzJztcbmltcG9ydCB7IGlzU2VsZWN0aW9uQ29sbGFwc2VkIH0gZnJvbSAnLi4vdXRpbHMvaXMtc2VsZWN0aW9uLWNvbGxhcHNlZC5tanMnO1xuXG5jb25zdCBmb3JtYXR0ZXJzID0gW1xuICB7XG4gICAgdHlwZTogXCJtYXJrXCIsXG4gICAgbWFyazogXCJib2xkXCIsXG4gICAgY2hhcmFjdGVyOiBcIipcIlxuICB9LFxuICB7XG4gICAgdHlwZTogXCJtYXJrXCIsXG4gICAgbWFyazogXCJpdGFsaWNcIixcbiAgICBjaGFyYWN0ZXI6IFwiX1wiXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIm1hcmtcIixcbiAgICBtYXJrOiBcInN0cmlrZXRocm91Z2hcIixcbiAgICBjaGFyYWN0ZXI6IFwiflwiXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIm1hcmtcIixcbiAgICBtYXJrOiBcImNvZGVcIixcbiAgICBjaGFyYWN0ZXI6IFwiYFwiXG4gIH1cbl07XG5jb25zdCBtYXJrRm9ybWF0dGluZ0NoYXJhY3RlcnMgPSBmb3JtYXR0ZXJzLmZpbHRlcigoZm9ybWF0dGVyKSA9PiBmb3JtYXR0ZXIudHlwZSA9PT0gXCJtYXJrXCIpLm1hcCgoZm9ybWF0dGVyKSA9PiBmb3JtYXR0ZXIuY2hhcmFjdGVyKTtcbmZ1bmN0aW9uIGZvcm1hdE1hcmsoZWRpdG9yLCB0ZXh0LCBmb3JtYXR0ZXIpIHtcbiAgaWYgKHRleHQgIT09IGZvcm1hdHRlci5jaGFyYWN0ZXIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBnZXRNYXRjaFJhbmdlKGVkaXRvciwgZWRpdG9yLnNlbGVjdGlvbiwgW2Zvcm1hdHRlci5jaGFyYWN0ZXJdKTtcbiAgaWYgKCFtYXRjaCB8fCBSYW5nZS5pc0NvbGxhcHNlZChtYXRjaCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgZm9ybWF0dGluZ0NoYXJhY3RlciA9IGdldENoYXJhY3RlckJlZm9yZShlZGl0b3IsIG1hdGNoKTtcbiAgaWYgKCFmb3JtYXR0aW5nQ2hhcmFjdGVyIHx8IGZvcm1hdHRpbmdDaGFyYWN0ZXIudGV4dCAhPT0gZm9ybWF0dGVyLmNoYXJhY3Rlcikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBiZWZvcmVDaGFyYWN0ZXIgPSBnZXRDaGFyYWN0ZXJCZWZvcmUoZWRpdG9yLCBmb3JtYXR0aW5nQ2hhcmFjdGVyLnJhbmdlKTtcbiAgaWYgKGJlZm9yZUNoYXJhY3RlciAmJiAhbWFya0Zvcm1hdHRpbmdDaGFyYWN0ZXJzLmluY2x1ZGVzKGJlZm9yZUNoYXJhY3Rlci50ZXh0KSAmJiAhaXNFbXB0eVN0cmluZyhiZWZvcmVDaGFyYWN0ZXIudGV4dCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgbWF0Y2hUZXh0ID0gRWRpdG9yLnN0cmluZyhlZGl0b3IsIG1hdGNoKTtcbiAgaWYgKG1hdGNoVGV4dC50cmltKCkgIT09IG1hdGNoVGV4dCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIG1hdGNoKTtcbiAgZWRpdG9yLmFkZE1hcmsoZm9ybWF0dGVyLm1hcmssIHRydWUpO1xuICBUcmFuc2Zvcm1zLmNvbGxhcHNlKGVkaXRvciwgeyBlZGdlOiBcImVuZFwiIH0pO1xuICBlZGl0b3IucmVtb3ZlTWFyayhmb3JtYXR0ZXIubWFyayk7XG4gIFRyYW5zZm9ybXMuZGVsZXRlKGVkaXRvciwge1xuICAgIGF0OiBmb3JtYXR0aW5nQ2hhcmFjdGVyLnJhbmdlXG4gIH0pO1xuICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIHdpdGhBdXRvRm9ybWF0dGluZyhlZGl0b3IpIHtcbiAgY29uc3QgeyBpbnNlcnRUZXh0IH0gPSBlZGl0b3I7XG4gIGVkaXRvci5pbnNlcnRUZXh0ID0gKHRleHQsIG9wdGlvbnMpID0+IHtcbiAgICBpZiAoIWlzU2VsZWN0aW9uQ29sbGFwc2VkKGVkaXRvci5zZWxlY3Rpb24pKSB7XG4gICAgICByZXR1cm4gaW5zZXJ0VGV4dCh0ZXh0LCBvcHRpb25zKTtcbiAgICB9XG4gICAgbGV0IHNob3VsZEluc2VydFRleHQgPSB0cnVlO1xuICAgIGZvciAoY29uc3QgZm9ybWF0dGVyIG9mIGZvcm1hdHRlcnMpIHtcbiAgICAgIGlmIChmb3JtYXR0ZXIudHlwZSA9PT0gXCJtYXJrXCIpIHtcbiAgICAgICAgaWYgKGZvcm1hdE1hcmsoZWRpdG9yLCB0ZXh0LCBmb3JtYXR0ZXIpKSB7XG4gICAgICAgICAgc2hvdWxkSW5zZXJ0VGV4dCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzaG91bGRJbnNlcnRUZXh0KSB7XG4gICAgICBpbnNlcnRUZXh0KHRleHQsIG9wdGlvbnMpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGVkaXRvcjtcbn1cblxuZXhwb3J0IHsgd2l0aEF1dG9Gb3JtYXR0aW5nIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXRvLWZvcm1hdHRpbmcubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-formatting.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-links.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-links.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isComposerBodyAutoLink: () => (/* binding */ isComposerBodyAutoLink),\n/* harmony export */   withAutoLinks: () => (/* binding */ withAutoLinks)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var _utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/is-text.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs\");\n/* harmony import */ var _custom_links_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./custom-links.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/custom-links.mjs\");\n\n\n\n\nfunction withAutoLinks(editor) {\n  const { isInline, normalizeNode, deleteBackward } = editor;\n  editor.isInline = (element) => {\n    return element.type === \"auto-link\" ? true : isInline(element);\n  };\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n    if ((0,_custom_links_mjs__WEBPACK_IMPORTED_MODULE_0__.isComposerBodyCustomLink)(node)) {\n      return;\n    }\n    if ((0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_1__.isText)(node)) {\n      const parentNode = slate__WEBPACK_IMPORTED_MODULE_2__.Node.parent(editor, path);\n      if ((0,_custom_links_mjs__WEBPACK_IMPORTED_MODULE_0__.isComposerBodyCustomLink)(parentNode)) {\n        return;\n      } else if (isComposerBodyAutoLink(parentNode)) {\n        const parentPath = slate__WEBPACK_IMPORTED_MODULE_2__.Path.parent(path);\n        handleLinkEdit(editor, [parentNode, parentPath]);\n        if (!(0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_1__.isPlainText)(node)) {\n          const marks = Object.keys(node).filter((key) => key !== \"text\");\n          slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unsetNodes(editor, marks, { at: path });\n        }\n      } else {\n        handleLinkCreate(editor, [node, path]);\n        handleNeighbours(editor, [node, path]);\n      }\n    }\n    normalizeNode(entry);\n  };\n  editor.deleteBackward = (unit) => {\n    deleteBackward(unit);\n    const { selection } = editor;\n    if (!selection)\n      return;\n    if (!slate__WEBPACK_IMPORTED_MODULE_2__.Range.isCollapsed(selection))\n      return;\n    const [match] = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.nodes(editor, {\n      at: selection,\n      match: isComposerBodyAutoLink,\n      mode: \"lowest\"\n    });\n    if (!match)\n      return;\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, {\n      match: isComposerBodyAutoLink\n    });\n  };\n  return editor;\n}\nfunction isComposerBodyAutoLink(node) {\n  return slate__WEBPACK_IMPORTED_MODULE_2__.Element.isElement(node) && node.type === \"auto-link\";\n}\nconst URL_REGEX = /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9().@:%_+~#?&//=]*)/;\nconst PUNCTUATION_OR_SPACE = /[.,;!?\\s()]/;\nconst PERIOD_OR_QUESTION_MARK_FOLLOWED_BY_ALPHANUMERIC = /^[.?][a-zA-Z0-9]+/;\nconst PARENTHESES = /[()]/;\nfunction isSeparator(char) {\n  return PUNCTUATION_OR_SPACE.test(char);\n}\nfunction endsWithSeparator(textContent) {\n  return isSeparator(textContent[textContent.length - 1]);\n}\nfunction startsWithSeparator(textContent) {\n  return isSeparator(textContent[0]);\n}\nfunction endsWithPeriodOrQuestionMark(textContent) {\n  return textContent[textContent.length - 1] === \".\" || textContent[textContent.length - 1] === \"?\";\n}\nfunction getUrlLogicalLength(url) {\n  if (!PARENTHESES.test(url)) {\n    return url.length;\n  }\n  let logicalLength = 0;\n  let parenthesesCount = 0;\n  for (const character of url) {\n    if (character === \"(\") {\n      parenthesesCount++;\n    }\n    if (character === \")\") {\n      parenthesesCount--;\n      if (parenthesesCount < 0) {\n        break;\n      }\n    }\n    logicalLength++;\n  }\n  return logicalLength;\n}\nfunction isPreviousNodeValid(editor, path) {\n  const entry = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.previous(editor, { at: path });\n  if (!entry)\n    return true;\n  return (0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_1__.isText)(entry[0]) && (endsWithSeparator(entry[0].text) || entry[0].text === \"\");\n}\nfunction isNextNodeValid(editor, path) {\n  const entry = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.next(editor, { at: path });\n  if (!entry)\n    return true;\n  return (0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_1__.isText)(entry[0]) && (startsWithSeparator(entry[0].text) || entry[0].text === \"\");\n}\nfunction isContentAroundValid(editor, entry, start, end) {\n  const [node, path] = entry;\n  const text = node.text;\n  const contentBeforeIsValid = start > 0 ? isSeparator(text[start - 1]) : isPreviousNodeValid(editor, path);\n  const contentAfterIsValid = end < text.length ? isSeparator(text[end]) : isNextNodeValid(editor, path);\n  return contentBeforeIsValid && contentAfterIsValid;\n}\nconst handleLinkEdit = (editor, entry) => {\n  const [node, path] = entry;\n  const children = slate__WEBPACK_IMPORTED_MODULE_2__.Node.children(editor, path);\n  for (const [child] of children) {\n    if ((0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_1__.isText)(child))\n      continue;\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: path });\n    return;\n  }\n  const text = slate__WEBPACK_IMPORTED_MODULE_2__.Node.string(node);\n  const match = URL_REGEX.exec(text);\n  if (!match || match[0] !== text) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: path });\n    return;\n  }\n  if (endsWithPeriodOrQuestionMark(text)) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: path });\n    const textBeforePeriod = text.slice(0, text.length - 1);\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.wrapNodes(\n      editor,\n      {\n        type: \"auto-link\",\n        url: textBeforePeriod,\n        children: []\n      },\n      {\n        at: {\n          anchor: { path, offset: 0 },\n          focus: { path, offset: textBeforePeriod.length }\n        },\n        split: true\n      }\n    );\n    return;\n  }\n  const logicalLength = getUrlLogicalLength(text);\n  if (logicalLength < text.length) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: path });\n    const logicalText = text.slice(0, logicalLength);\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.wrapNodes(\n      editor,\n      {\n        type: \"auto-link\",\n        url: logicalText,\n        children: []\n      },\n      {\n        at: {\n          anchor: { path, offset: 0 },\n          focus: { path, offset: logicalText.length }\n        },\n        split: true\n      }\n    );\n    return;\n  }\n  if (!isPreviousNodeValid(editor, path) || !isNextNodeValid(editor, path)) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: path });\n    return;\n  }\n  if (node.url !== text) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.setNodes(editor, { url: match[0] }, { at: path });\n    return;\n  }\n};\nconst handleLinkCreate = (editor, entry) => {\n  const [node, path] = entry;\n  const match = URL_REGEX.exec(node.text);\n  if (!match)\n    return;\n  const start = match.index;\n  const end = start + match[0].length;\n  if (!isContentAroundValid(editor, entry, start, end))\n    return;\n  slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.wrapNodes(\n    editor,\n    {\n      type: \"auto-link\",\n      url: match[0],\n      children: []\n    },\n    {\n      at: {\n        anchor: { path, offset: start },\n        focus: { path, offset: end }\n      },\n      split: true\n    }\n  );\n  return;\n};\nconst handleNeighbours = (editor, entry) => {\n  const [node, path] = entry;\n  const text = node.text;\n  const previousSibling = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.previous(editor, { at: path });\n  if (previousSibling && isComposerBodyAutoLink(previousSibling[0])) {\n    if (PERIOD_OR_QUESTION_MARK_FOLLOWED_BY_ALPHANUMERIC.test(text)) {\n      slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: previousSibling[1] });\n      slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.mergeNodes(editor, { at: path });\n      return;\n    }\n    if (!startsWithSeparator(text)) {\n      slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: previousSibling[1] });\n      return;\n    }\n  }\n  const nextSibling = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.next(editor, { at: path });\n  if (nextSibling && isComposerBodyAutoLink(nextSibling[0]) && !endsWithSeparator(text)) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.unwrapNodes(editor, { at: nextSibling[1] });\n    return;\n  }\n};\n\n\n//# sourceMappingURL=auto-links.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL2F1dG8tbGlua3MubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXVFO0FBQ1o7QUFDRzs7QUFFOUQ7QUFDQSxVQUFVLDBDQUEwQztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwyRUFBd0I7QUFDaEM7QUFDQTtBQUNBLFFBQVEsMERBQU07QUFDZCx5QkFBeUIsdUNBQUk7QUFDN0IsVUFBVSwyRUFBd0I7QUFDbEM7QUFDQSxRQUFRO0FBQ1IsMkJBQTJCLHVDQUFJO0FBQy9CO0FBQ0EsYUFBYSwrREFBVztBQUN4QjtBQUNBLFVBQVUsNkNBQVUsNkJBQTZCLFVBQVU7QUFDM0Q7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksWUFBWTtBQUN4QjtBQUNBO0FBQ0EsU0FBUyx3Q0FBSztBQUNkO0FBQ0Esb0JBQW9CLHlDQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSSw2Q0FBVTtBQUNkO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywwQ0FBTztBQUNoQjtBQUNBLHdFQUF3RSxNQUFNLGdCQUFnQixJQUFJO0FBQ2xHLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlDQUFNLG9CQUFvQixVQUFVO0FBQ3BEO0FBQ0E7QUFDQSxTQUFTLDBEQUFNO0FBQ2Y7QUFDQTtBQUNBLGdCQUFnQix5Q0FBTSxnQkFBZ0IsVUFBVTtBQUNoRDtBQUNBO0FBQ0EsU0FBUywwREFBTTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHVDQUFJO0FBQ3ZCO0FBQ0EsUUFBUSwwREFBTTtBQUNkO0FBQ0EsSUFBSSw2Q0FBVSx1QkFBdUIsVUFBVTtBQUMvQztBQUNBO0FBQ0EsZUFBZSx1Q0FBSTtBQUNuQjtBQUNBO0FBQ0EsSUFBSSw2Q0FBVSx1QkFBdUIsVUFBVTtBQUMvQztBQUNBO0FBQ0E7QUFDQSxJQUFJLDZDQUFVLHVCQUF1QixVQUFVO0FBQy9DO0FBQ0EsSUFBSSw2Q0FBVTtBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckMsbUJBQW1CO0FBQ25CLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksNkNBQVUsdUJBQXVCLFVBQVU7QUFDL0M7QUFDQSxJQUFJLDZDQUFVO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQyxtQkFBbUI7QUFDbkIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksNkNBQVUsdUJBQXVCLFVBQVU7QUFDL0M7QUFDQTtBQUNBO0FBQ0EsSUFBSSw2Q0FBVSxvQkFBb0IsZUFBZSxJQUFJLFVBQVU7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSw2Q0FBVTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGtCQUFrQixxQkFBcUI7QUFDdkMsaUJBQWlCO0FBQ2pCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHlDQUFNLG9CQUFvQixVQUFVO0FBQzlEO0FBQ0E7QUFDQSxNQUFNLDZDQUFVLHVCQUF1Qix3QkFBd0I7QUFDL0QsTUFBTSw2Q0FBVSxzQkFBc0IsVUFBVTtBQUNoRDtBQUNBO0FBQ0E7QUFDQSxNQUFNLDZDQUFVLHVCQUF1Qix3QkFBd0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLHlDQUFNLGdCQUFnQixVQUFVO0FBQ3REO0FBQ0EsSUFBSSw2Q0FBVSx1QkFBdUIsb0JBQW9CO0FBQ3pEO0FBQ0E7QUFDQTs7QUFFaUQ7QUFDakQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3NsYXRlL3BsdWdpbnMvYXV0by1saW5rcy5tanM/ZTBjMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50LCBOb2RlLCBQYXRoLCBUcmFuc2Zvcm1zLCBSYW5nZSwgRWRpdG9yIH0gZnJvbSAnc2xhdGUnO1xuaW1wb3J0IHsgaXNUZXh0LCBpc1BsYWluVGV4dCB9IGZyb20gJy4uL3V0aWxzL2lzLXRleHQubWpzJztcbmltcG9ydCB7IGlzQ29tcG9zZXJCb2R5Q3VzdG9tTGluayB9IGZyb20gJy4vY3VzdG9tLWxpbmtzLm1qcyc7XG5cbmZ1bmN0aW9uIHdpdGhBdXRvTGlua3MoZWRpdG9yKSB7XG4gIGNvbnN0IHsgaXNJbmxpbmUsIG5vcm1hbGl6ZU5vZGUsIGRlbGV0ZUJhY2t3YXJkIH0gPSBlZGl0b3I7XG4gIGVkaXRvci5pc0lubGluZSA9IChlbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuIGVsZW1lbnQudHlwZSA9PT0gXCJhdXRvLWxpbmtcIiA/IHRydWUgOiBpc0lubGluZShlbGVtZW50KTtcbiAgfTtcbiAgZWRpdG9yLm5vcm1hbGl6ZU5vZGUgPSAoZW50cnkpID0+IHtcbiAgICBjb25zdCBbbm9kZSwgcGF0aF0gPSBlbnRyeTtcbiAgICBpZiAoaXNDb21wb3NlckJvZHlDdXN0b21MaW5rKG5vZGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChpc1RleHQobm9kZSkpIHtcbiAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBOb2RlLnBhcmVudChlZGl0b3IsIHBhdGgpO1xuICAgICAgaWYgKGlzQ29tcG9zZXJCb2R5Q3VzdG9tTGluayhwYXJlbnROb2RlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKGlzQ29tcG9zZXJCb2R5QXV0b0xpbmsocGFyZW50Tm9kZSkpIHtcbiAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IFBhdGgucGFyZW50KHBhdGgpO1xuICAgICAgICBoYW5kbGVMaW5rRWRpdChlZGl0b3IsIFtwYXJlbnROb2RlLCBwYXJlbnRQYXRoXSk7XG4gICAgICAgIGlmICghaXNQbGFpblRleHQobm9kZSkpIHtcbiAgICAgICAgICBjb25zdCBtYXJrcyA9IE9iamVjdC5rZXlzKG5vZGUpLmZpbHRlcigoa2V5KSA9PiBrZXkgIT09IFwidGV4dFwiKTtcbiAgICAgICAgICBUcmFuc2Zvcm1zLnVuc2V0Tm9kZXMoZWRpdG9yLCBtYXJrcywgeyBhdDogcGF0aCB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlTGlua0NyZWF0ZShlZGl0b3IsIFtub2RlLCBwYXRoXSk7XG4gICAgICAgIGhhbmRsZU5laWdoYm91cnMoZWRpdG9yLCBbbm9kZSwgcGF0aF0pO1xuICAgICAgfVxuICAgIH1cbiAgICBub3JtYWxpemVOb2RlKGVudHJ5KTtcbiAgfTtcbiAgZWRpdG9yLmRlbGV0ZUJhY2t3YXJkID0gKHVuaXQpID0+IHtcbiAgICBkZWxldGVCYWNrd2FyZCh1bml0KTtcbiAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gZWRpdG9yO1xuICAgIGlmICghc2VsZWN0aW9uKVxuICAgICAgcmV0dXJuO1xuICAgIGlmICghUmFuZ2UuaXNDb2xsYXBzZWQoc2VsZWN0aW9uKSlcbiAgICAgIHJldHVybjtcbiAgICBjb25zdCBbbWF0Y2hdID0gRWRpdG9yLm5vZGVzKGVkaXRvciwge1xuICAgICAgYXQ6IHNlbGVjdGlvbixcbiAgICAgIG1hdGNoOiBpc0NvbXBvc2VyQm9keUF1dG9MaW5rLFxuICAgICAgbW9kZTogXCJsb3dlc3RcIlxuICAgIH0pO1xuICAgIGlmICghbWF0Y2gpXG4gICAgICByZXR1cm47XG4gICAgVHJhbnNmb3Jtcy51bndyYXBOb2RlcyhlZGl0b3IsIHtcbiAgICAgIG1hdGNoOiBpc0NvbXBvc2VyQm9keUF1dG9MaW5rXG4gICAgfSk7XG4gIH07XG4gIHJldHVybiBlZGl0b3I7XG59XG5mdW5jdGlvbiBpc0NvbXBvc2VyQm9keUF1dG9MaW5rKG5vZGUpIHtcbiAgcmV0dXJuIEVsZW1lbnQuaXNFbGVtZW50KG5vZGUpICYmIG5vZGUudHlwZSA9PT0gXCJhdXRvLWxpbmtcIjtcbn1cbmNvbnN0IFVSTF9SRUdFWCA9IC8oKGh0dHBzPzpcXC9cXC8od3d3XFwuKT8pfCh3d3dcXC4pKVstYS16QS1aMC05QDolLl8rfiM9XXsxLDI1Nn1cXC5bYS16QS1aMC05KCldezEsNn1cXGIoWy1hLXpBLVowLTkoKS5AOiVfK34jPyYvLz1dKikvO1xuY29uc3QgUFVOQ1RVQVRJT05fT1JfU1BBQ0UgPSAvWy4sOyE/XFxzKCldLztcbmNvbnN0IFBFUklPRF9PUl9RVUVTVElPTl9NQVJLX0ZPTExPV0VEX0JZX0FMUEhBTlVNRVJJQyA9IC9eWy4/XVthLXpBLVowLTldKy87XG5jb25zdCBQQVJFTlRIRVNFUyA9IC9bKCldLztcbmZ1bmN0aW9uIGlzU2VwYXJhdG9yKGNoYXIpIHtcbiAgcmV0dXJuIFBVTkNUVUFUSU9OX09SX1NQQUNFLnRlc3QoY2hhcik7XG59XG5mdW5jdGlvbiBlbmRzV2l0aFNlcGFyYXRvcih0ZXh0Q29udGVudCkge1xuICByZXR1cm4gaXNTZXBhcmF0b3IodGV4dENvbnRlbnRbdGV4dENvbnRlbnQubGVuZ3RoIC0gMV0pO1xufVxuZnVuY3Rpb24gc3RhcnRzV2l0aFNlcGFyYXRvcih0ZXh0Q29udGVudCkge1xuICByZXR1cm4gaXNTZXBhcmF0b3IodGV4dENvbnRlbnRbMF0pO1xufVxuZnVuY3Rpb24gZW5kc1dpdGhQZXJpb2RPclF1ZXN0aW9uTWFyayh0ZXh0Q29udGVudCkge1xuICByZXR1cm4gdGV4dENvbnRlbnRbdGV4dENvbnRlbnQubGVuZ3RoIC0gMV0gPT09IFwiLlwiIHx8IHRleHRDb250ZW50W3RleHRDb250ZW50Lmxlbmd0aCAtIDFdID09PSBcIj9cIjtcbn1cbmZ1bmN0aW9uIGdldFVybExvZ2ljYWxMZW5ndGgodXJsKSB7XG4gIGlmICghUEFSRU5USEVTRVMudGVzdCh1cmwpKSB7XG4gICAgcmV0dXJuIHVybC5sZW5ndGg7XG4gIH1cbiAgbGV0IGxvZ2ljYWxMZW5ndGggPSAwO1xuICBsZXQgcGFyZW50aGVzZXNDb3VudCA9IDA7XG4gIGZvciAoY29uc3QgY2hhcmFjdGVyIG9mIHVybCkge1xuICAgIGlmIChjaGFyYWN0ZXIgPT09IFwiKFwiKSB7XG4gICAgICBwYXJlbnRoZXNlc0NvdW50Kys7XG4gICAgfVxuICAgIGlmIChjaGFyYWN0ZXIgPT09IFwiKVwiKSB7XG4gICAgICBwYXJlbnRoZXNlc0NvdW50LS07XG4gICAgICBpZiAocGFyZW50aGVzZXNDb3VudCA8IDApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGxvZ2ljYWxMZW5ndGgrKztcbiAgfVxuICByZXR1cm4gbG9naWNhbExlbmd0aDtcbn1cbmZ1bmN0aW9uIGlzUHJldmlvdXNOb2RlVmFsaWQoZWRpdG9yLCBwYXRoKSB7XG4gIGNvbnN0IGVudHJ5ID0gRWRpdG9yLnByZXZpb3VzKGVkaXRvciwgeyBhdDogcGF0aCB9KTtcbiAgaWYgKCFlbnRyeSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGlzVGV4dChlbnRyeVswXSkgJiYgKGVuZHNXaXRoU2VwYXJhdG9yKGVudHJ5WzBdLnRleHQpIHx8IGVudHJ5WzBdLnRleHQgPT09IFwiXCIpO1xufVxuZnVuY3Rpb24gaXNOZXh0Tm9kZVZhbGlkKGVkaXRvciwgcGF0aCkge1xuICBjb25zdCBlbnRyeSA9IEVkaXRvci5uZXh0KGVkaXRvciwgeyBhdDogcGF0aCB9KTtcbiAgaWYgKCFlbnRyeSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGlzVGV4dChlbnRyeVswXSkgJiYgKHN0YXJ0c1dpdGhTZXBhcmF0b3IoZW50cnlbMF0udGV4dCkgfHwgZW50cnlbMF0udGV4dCA9PT0gXCJcIik7XG59XG5mdW5jdGlvbiBpc0NvbnRlbnRBcm91bmRWYWxpZChlZGl0b3IsIGVudHJ5LCBzdGFydCwgZW5kKSB7XG4gIGNvbnN0IFtub2RlLCBwYXRoXSA9IGVudHJ5O1xuICBjb25zdCB0ZXh0ID0gbm9kZS50ZXh0O1xuICBjb25zdCBjb250ZW50QmVmb3JlSXNWYWxpZCA9IHN0YXJ0ID4gMCA/IGlzU2VwYXJhdG9yKHRleHRbc3RhcnQgLSAxXSkgOiBpc1ByZXZpb3VzTm9kZVZhbGlkKGVkaXRvciwgcGF0aCk7XG4gIGNvbnN0IGNvbnRlbnRBZnRlcklzVmFsaWQgPSBlbmQgPCB0ZXh0Lmxlbmd0aCA/IGlzU2VwYXJhdG9yKHRleHRbZW5kXSkgOiBpc05leHROb2RlVmFsaWQoZWRpdG9yLCBwYXRoKTtcbiAgcmV0dXJuIGNvbnRlbnRCZWZvcmVJc1ZhbGlkICYmIGNvbnRlbnRBZnRlcklzVmFsaWQ7XG59XG5jb25zdCBoYW5kbGVMaW5rRWRpdCA9IChlZGl0b3IsIGVudHJ5KSA9PiB7XG4gIGNvbnN0IFtub2RlLCBwYXRoXSA9IGVudHJ5O1xuICBjb25zdCBjaGlsZHJlbiA9IE5vZGUuY2hpbGRyZW4oZWRpdG9yLCBwYXRoKTtcbiAgZm9yIChjb25zdCBbY2hpbGRdIG9mIGNoaWxkcmVuKSB7XG4gICAgaWYgKGlzVGV4dChjaGlsZCkpXG4gICAgICBjb250aW51ZTtcbiAgICBUcmFuc2Zvcm1zLnVud3JhcE5vZGVzKGVkaXRvciwgeyBhdDogcGF0aCB9KTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdGV4dCA9IE5vZGUuc3RyaW5nKG5vZGUpO1xuICBjb25zdCBtYXRjaCA9IFVSTF9SRUdFWC5leGVjKHRleHQpO1xuICBpZiAoIW1hdGNoIHx8IG1hdGNoWzBdICE9PSB0ZXh0KSB7XG4gICAgVHJhbnNmb3Jtcy51bndyYXBOb2RlcyhlZGl0b3IsIHsgYXQ6IHBhdGggfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChlbmRzV2l0aFBlcmlvZE9yUXVlc3Rpb25NYXJrKHRleHQpKSB7XG4gICAgVHJhbnNmb3Jtcy51bndyYXBOb2RlcyhlZGl0b3IsIHsgYXQ6IHBhdGggfSk7XG4gICAgY29uc3QgdGV4dEJlZm9yZVBlcmlvZCA9IHRleHQuc2xpY2UoMCwgdGV4dC5sZW5ndGggLSAxKTtcbiAgICBUcmFuc2Zvcm1zLndyYXBOb2RlcyhcbiAgICAgIGVkaXRvcixcbiAgICAgIHtcbiAgICAgICAgdHlwZTogXCJhdXRvLWxpbmtcIixcbiAgICAgICAgdXJsOiB0ZXh0QmVmb3JlUGVyaW9kLFxuICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGF0OiB7XG4gICAgICAgICAgYW5jaG9yOiB7IHBhdGgsIG9mZnNldDogMCB9LFxuICAgICAgICAgIGZvY3VzOiB7IHBhdGgsIG9mZnNldDogdGV4dEJlZm9yZVBlcmlvZC5sZW5ndGggfVxuICAgICAgICB9LFxuICAgICAgICBzcGxpdDogdHJ1ZVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGxvZ2ljYWxMZW5ndGggPSBnZXRVcmxMb2dpY2FsTGVuZ3RoKHRleHQpO1xuICBpZiAobG9naWNhbExlbmd0aCA8IHRleHQubGVuZ3RoKSB7XG4gICAgVHJhbnNmb3Jtcy51bndyYXBOb2RlcyhlZGl0b3IsIHsgYXQ6IHBhdGggfSk7XG4gICAgY29uc3QgbG9naWNhbFRleHQgPSB0ZXh0LnNsaWNlKDAsIGxvZ2ljYWxMZW5ndGgpO1xuICAgIFRyYW5zZm9ybXMud3JhcE5vZGVzKFxuICAgICAgZWRpdG9yLFxuICAgICAge1xuICAgICAgICB0eXBlOiBcImF1dG8tbGlua1wiLFxuICAgICAgICB1cmw6IGxvZ2ljYWxUZXh0LFxuICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGF0OiB7XG4gICAgICAgICAgYW5jaG9yOiB7IHBhdGgsIG9mZnNldDogMCB9LFxuICAgICAgICAgIGZvY3VzOiB7IHBhdGgsIG9mZnNldDogbG9naWNhbFRleHQubGVuZ3RoIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3BsaXQ6IHRydWVcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIWlzUHJldmlvdXNOb2RlVmFsaWQoZWRpdG9yLCBwYXRoKSB8fCAhaXNOZXh0Tm9kZVZhbGlkKGVkaXRvciwgcGF0aCkpIHtcbiAgICBUcmFuc2Zvcm1zLnVud3JhcE5vZGVzKGVkaXRvciwgeyBhdDogcGF0aCB9KTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKG5vZGUudXJsICE9PSB0ZXh0KSB7XG4gICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHsgdXJsOiBtYXRjaFswXSB9LCB7IGF0OiBwYXRoIH0pO1xuICAgIHJldHVybjtcbiAgfVxufTtcbmNvbnN0IGhhbmRsZUxpbmtDcmVhdGUgPSAoZWRpdG9yLCBlbnRyeSkgPT4ge1xuICBjb25zdCBbbm9kZSwgcGF0aF0gPSBlbnRyeTtcbiAgY29uc3QgbWF0Y2ggPSBVUkxfUkVHRVguZXhlYyhub2RlLnRleHQpO1xuICBpZiAoIW1hdGNoKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc3RhcnQgPSBtYXRjaC5pbmRleDtcbiAgY29uc3QgZW5kID0gc3RhcnQgKyBtYXRjaFswXS5sZW5ndGg7XG4gIGlmICghaXNDb250ZW50QXJvdW5kVmFsaWQoZWRpdG9yLCBlbnRyeSwgc3RhcnQsIGVuZCkpXG4gICAgcmV0dXJuO1xuICBUcmFuc2Zvcm1zLndyYXBOb2RlcyhcbiAgICBlZGl0b3IsXG4gICAge1xuICAgICAgdHlwZTogXCJhdXRvLWxpbmtcIixcbiAgICAgIHVybDogbWF0Y2hbMF0sXG4gICAgICBjaGlsZHJlbjogW11cbiAgICB9LFxuICAgIHtcbiAgICAgIGF0OiB7XG4gICAgICAgIGFuY2hvcjogeyBwYXRoLCBvZmZzZXQ6IHN0YXJ0IH0sXG4gICAgICAgIGZvY3VzOiB7IHBhdGgsIG9mZnNldDogZW5kIH1cbiAgICAgIH0sXG4gICAgICBzcGxpdDogdHJ1ZVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuO1xufTtcbmNvbnN0IGhhbmRsZU5laWdoYm91cnMgPSAoZWRpdG9yLCBlbnRyeSkgPT4ge1xuICBjb25zdCBbbm9kZSwgcGF0aF0gPSBlbnRyeTtcbiAgY29uc3QgdGV4dCA9IG5vZGUudGV4dDtcbiAgY29uc3QgcHJldmlvdXNTaWJsaW5nID0gRWRpdG9yLnByZXZpb3VzKGVkaXRvciwgeyBhdDogcGF0aCB9KTtcbiAgaWYgKHByZXZpb3VzU2libGluZyAmJiBpc0NvbXBvc2VyQm9keUF1dG9MaW5rKHByZXZpb3VzU2libGluZ1swXSkpIHtcbiAgICBpZiAoUEVSSU9EX09SX1FVRVNUSU9OX01BUktfRk9MTE9XRURfQllfQUxQSEFOVU1FUklDLnRlc3QodGV4dCkpIHtcbiAgICAgIFRyYW5zZm9ybXMudW53cmFwTm9kZXMoZWRpdG9yLCB7IGF0OiBwcmV2aW91c1NpYmxpbmdbMV0gfSk7XG4gICAgICBUcmFuc2Zvcm1zLm1lcmdlTm9kZXMoZWRpdG9yLCB7IGF0OiBwYXRoIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIXN0YXJ0c1dpdGhTZXBhcmF0b3IodGV4dCkpIHtcbiAgICAgIFRyYW5zZm9ybXMudW53cmFwTm9kZXMoZWRpdG9yLCB7IGF0OiBwcmV2aW91c1NpYmxpbmdbMV0gfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGNvbnN0IG5leHRTaWJsaW5nID0gRWRpdG9yLm5leHQoZWRpdG9yLCB7IGF0OiBwYXRoIH0pO1xuICBpZiAobmV4dFNpYmxpbmcgJiYgaXNDb21wb3NlckJvZHlBdXRvTGluayhuZXh0U2libGluZ1swXSkgJiYgIWVuZHNXaXRoU2VwYXJhdG9yKHRleHQpKSB7XG4gICAgVHJhbnNmb3Jtcy51bndyYXBOb2RlcyhlZGl0b3IsIHsgYXQ6IG5leHRTaWJsaW5nWzFdIH0pO1xuICAgIHJldHVybjtcbiAgfVxufTtcblxuZXhwb3J0IHsgaXNDb21wb3NlckJvZHlBdXRvTGluaywgd2l0aEF1dG9MaW5rcyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXV0by1saW5rcy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/auto-links.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/custom-links.mjs":
/*!*******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/plugins/custom-links.mjs ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isComposerBodyCustomLink: () => (/* binding */ isComposerBodyCustomLink),\n/* harmony export */   withCustomLinks: () => (/* binding */ withCustomLinks)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var _utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/is-text.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs\");\n/* harmony import */ var _utils_selection_contains_inlines_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/selection-contains-inlines.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/selection-contains-inlines.mjs\");\n\n\n\n\nfunction isUrl(string) {\n  try {\n    new URL(string);\n    return true;\n  } catch (_) {\n    return false;\n  }\n}\nfunction withCustomLinks(editor) {\n  const { isInline, normalizeNode, insertData } = editor;\n  editor.isInline = (element) => {\n    return element.type === \"custom-link\" ? true : isInline(element);\n  };\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n    if ((0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__.isText)(node)) {\n      const parentNode = slate__WEBPACK_IMPORTED_MODULE_1__.Node.parent(editor, path);\n      if (isComposerBodyCustomLink(parentNode)) {\n        if (!(0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__.isPlainText)(node)) {\n          const marks = Object.keys(node).filter((key) => key !== \"text\");\n          slate__WEBPACK_IMPORTED_MODULE_1__.Transforms.unsetNodes(editor, marks, { at: path });\n        }\n      }\n    }\n    normalizeNode(entry);\n  };\n  editor.insertData = (data) => {\n    const { selection } = editor;\n    const pastedText = data.getData(\"text/plain\");\n    let shouldInvokeDefaultBehavior = true;\n    if (selection && !slate__WEBPACK_IMPORTED_MODULE_1__.Range.isCollapsed(selection)) {\n      if (selection.anchor.path[0] === selection.focus.path[0]) {\n        if (isUrl(pastedText)) {\n          if (!(0,_utils_selection_contains_inlines_mjs__WEBPACK_IMPORTED_MODULE_2__.selectionContainsInlines)(editor, (node) => !(0,_utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__.isText)(node))) {\n            slate__WEBPACK_IMPORTED_MODULE_1__.Transforms.wrapNodes(\n              editor,\n              {\n                type: \"custom-link\",\n                url: pastedText,\n                children: []\n              },\n              {\n                at: selection,\n                split: true,\n                match: _utils_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__.isPlainText\n              }\n            );\n            shouldInvokeDefaultBehavior = false;\n          }\n        }\n      }\n    }\n    if (shouldInvokeDefaultBehavior) {\n      insertData(data);\n    }\n  };\n  return editor;\n}\nfunction isComposerBodyCustomLink(node) {\n  return slate__WEBPACK_IMPORTED_MODULE_1__.Element.isElement(node) && node.type === \"custom-link\";\n}\n\n\n//# sourceMappingURL=custom-links.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL2N1c3RvbS1saW5rcy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBeUQ7QUFDRTtBQUN3Qjs7QUFFbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHNDQUFzQztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwwREFBTTtBQUNkLHlCQUF5Qix1Q0FBSTtBQUM3QjtBQUNBLGFBQWEsK0RBQVc7QUFDeEI7QUFDQSxVQUFVLDZDQUFVLDZCQUE2QixVQUFVO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksWUFBWTtBQUN4QjtBQUNBO0FBQ0Esc0JBQXNCLHdDQUFLO0FBQzNCO0FBQ0E7QUFDQSxlQUFlLCtGQUF3QixvQkFBb0IsMERBQU07QUFDakUsWUFBWSw2Q0FBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QiwyREFBVztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywwQ0FBTztBQUNoQjs7QUFFcUQ7QUFDckQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3NsYXRlL3BsdWdpbnMvY3VzdG9tLWxpbmtzLm1qcz8zMTc5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnQsIE5vZGUsIFRyYW5zZm9ybXMsIFJhbmdlIH0gZnJvbSAnc2xhdGUnO1xuaW1wb3J0IHsgaXNUZXh0LCBpc1BsYWluVGV4dCB9IGZyb20gJy4uL3V0aWxzL2lzLXRleHQubWpzJztcbmltcG9ydCB7IHNlbGVjdGlvbkNvbnRhaW5zSW5saW5lcyB9IGZyb20gJy4uL3V0aWxzL3NlbGVjdGlvbi1jb250YWlucy1pbmxpbmVzLm1qcyc7XG5cbmZ1bmN0aW9uIGlzVXJsKHN0cmluZykge1xuICB0cnkge1xuICAgIG5ldyBVUkwoc3RyaW5nKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoXykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuZnVuY3Rpb24gd2l0aEN1c3RvbUxpbmtzKGVkaXRvcikge1xuICBjb25zdCB7IGlzSW5saW5lLCBub3JtYWxpemVOb2RlLCBpbnNlcnREYXRhIH0gPSBlZGl0b3I7XG4gIGVkaXRvci5pc0lubGluZSA9IChlbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuIGVsZW1lbnQudHlwZSA9PT0gXCJjdXN0b20tbGlua1wiID8gdHJ1ZSA6IGlzSW5saW5lKGVsZW1lbnQpO1xuICB9O1xuICBlZGl0b3Iubm9ybWFsaXplTm9kZSA9IChlbnRyeSkgPT4ge1xuICAgIGNvbnN0IFtub2RlLCBwYXRoXSA9IGVudHJ5O1xuICAgIGlmIChpc1RleHQobm9kZSkpIHtcbiAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBOb2RlLnBhcmVudChlZGl0b3IsIHBhdGgpO1xuICAgICAgaWYgKGlzQ29tcG9zZXJCb2R5Q3VzdG9tTGluayhwYXJlbnROb2RlKSkge1xuICAgICAgICBpZiAoIWlzUGxhaW5UZXh0KG5vZGUpKSB7XG4gICAgICAgICAgY29uc3QgbWFya3MgPSBPYmplY3Qua2V5cyhub2RlKS5maWx0ZXIoKGtleSkgPT4ga2V5ICE9PSBcInRleHRcIik7XG4gICAgICAgICAgVHJhbnNmb3Jtcy51bnNldE5vZGVzKGVkaXRvciwgbWFya3MsIHsgYXQ6IHBhdGggfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgbm9ybWFsaXplTm9kZShlbnRyeSk7XG4gIH07XG4gIGVkaXRvci5pbnNlcnREYXRhID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gZWRpdG9yO1xuICAgIGNvbnN0IHBhc3RlZFRleHQgPSBkYXRhLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xuICAgIGxldCBzaG91bGRJbnZva2VEZWZhdWx0QmVoYXZpb3IgPSB0cnVlO1xuICAgIGlmIChzZWxlY3Rpb24gJiYgIVJhbmdlLmlzQ29sbGFwc2VkKHNlbGVjdGlvbikpIHtcbiAgICAgIGlmIChzZWxlY3Rpb24uYW5jaG9yLnBhdGhbMF0gPT09IHNlbGVjdGlvbi5mb2N1cy5wYXRoWzBdKSB7XG4gICAgICAgIGlmIChpc1VybChwYXN0ZWRUZXh0KSkge1xuICAgICAgICAgIGlmICghc2VsZWN0aW9uQ29udGFpbnNJbmxpbmVzKGVkaXRvciwgKG5vZGUpID0+ICFpc1RleHQobm9kZSkpKSB7XG4gICAgICAgICAgICBUcmFuc2Zvcm1zLndyYXBOb2RlcyhcbiAgICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJjdXN0b20tbGlua1wiLFxuICAgICAgICAgICAgICAgIHVybDogcGFzdGVkVGV4dCxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF0OiBzZWxlY3Rpb24sXG4gICAgICAgICAgICAgICAgc3BsaXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgbWF0Y2g6IGlzUGxhaW5UZXh0XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzaG91bGRJbnZva2VEZWZhdWx0QmVoYXZpb3IgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNob3VsZEludm9rZURlZmF1bHRCZWhhdmlvcikge1xuICAgICAgaW5zZXJ0RGF0YShkYXRhKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBlZGl0b3I7XG59XG5mdW5jdGlvbiBpc0NvbXBvc2VyQm9keUN1c3RvbUxpbmsobm9kZSkge1xuICByZXR1cm4gRWxlbWVudC5pc0VsZW1lbnQobm9kZSkgJiYgbm9kZS50eXBlID09PSBcImN1c3RvbS1saW5rXCI7XG59XG5cbmV4cG9ydCB7IGlzQ29tcG9zZXJCb2R5Q3VzdG9tTGluaywgd2l0aEN1c3RvbUxpbmtzIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jdXN0b20tbGlua3MubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/custom-links.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/empty-clear-formatting.mjs":
/*!*****************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/plugins/empty-clear-formatting.mjs ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withEmptyClearFormatting: () => (/* binding */ withEmptyClearFormatting)\n/* harmony export */ });\n/* harmony import */ var _utils_is_empty_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/is-empty.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty.mjs\");\n/* harmony import */ var _utils_marks_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/marks.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/marks.mjs\");\n\n\n\nfunction withEmptyClearFormatting(editor) {\n  const { onChange } = editor;\n  editor.onChange = (options) => {\n    if ((0,_utils_is_empty_mjs__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(editor, editor.children)) {\n      (0,_utils_marks_mjs__WEBPACK_IMPORTED_MODULE_1__.removeMarks)(editor);\n    }\n    onChange(options);\n  };\n  return editor;\n}\n\n\n//# sourceMappingURL=empty-clear-formatting.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL2VtcHR5LWNsZWFyLWZvcm1hdHRpbmcubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFnRDtBQUNDOztBQUVqRDtBQUNBLFVBQVUsV0FBVztBQUNyQjtBQUNBLFFBQVEsNERBQU87QUFDZixNQUFNLDZEQUFXO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRW9DO0FBQ3BDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL2VtcHR5LWNsZWFyLWZvcm1hdHRpbmcubWpzP2YyOTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gJy4uL3V0aWxzL2lzLWVtcHR5Lm1qcyc7XG5pbXBvcnQgeyByZW1vdmVNYXJrcyB9IGZyb20gJy4uL3V0aWxzL21hcmtzLm1qcyc7XG5cbmZ1bmN0aW9uIHdpdGhFbXB0eUNsZWFyRm9ybWF0dGluZyhlZGl0b3IpIHtcbiAgY29uc3QgeyBvbkNoYW5nZSB9ID0gZWRpdG9yO1xuICBlZGl0b3Iub25DaGFuZ2UgPSAob3B0aW9ucykgPT4ge1xuICAgIGlmIChpc0VtcHR5KGVkaXRvciwgZWRpdG9yLmNoaWxkcmVuKSkge1xuICAgICAgcmVtb3ZlTWFya3MoZWRpdG9yKTtcbiAgICB9XG4gICAgb25DaGFuZ2Uob3B0aW9ucyk7XG4gIH07XG4gIHJldHVybiBlZGl0b3I7XG59XG5cbmV4cG9ydCB7IHdpdGhFbXB0eUNsZWFyRm9ybWF0dGluZyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZW1wdHktY2xlYXItZm9ybWF0dGluZy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/empty-clear-formatting.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs":
/*!***************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MENTION_CHARACTER: () => (/* binding */ MENTION_CHARACTER),\n/* harmony export */   getMentionDraftAtSelection: () => (/* binding */ getMentionDraftAtSelection),\n/* harmony export */   insertMention: () => (/* binding */ insertMention),\n/* harmony export */   insertMentionCharacter: () => (/* binding */ insertMentionCharacter),\n/* harmony export */   isComposerBodyMention: () => (/* binding */ isComposerBodyMention),\n/* harmony export */   withMentions: () => (/* binding */ withMentions)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var _utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/get-character.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-character.mjs\");\n/* harmony import */ var _utils_get_match_range_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/get-match-range.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-match-range.mjs\");\n/* harmony import */ var _utils_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/is-empty-string.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty-string.mjs\");\n/* harmony import */ var _utils_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/is-selection-collapsed.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-selection-collapsed.mjs\");\n\n\n\n\n\n\nconst MENTION_CHARACTER = \"@\";\nfunction getMentionDraftAtSelection(editor) {\n  const { selection } = editor;\n  if (!(0,_utils_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_0__.isSelectionCollapsed)(selection)) {\n    return;\n  }\n  const match = (0,_utils_get_match_range_mjs__WEBPACK_IMPORTED_MODULE_1__.getMatchRange)(editor, selection);\n  if (!match) {\n    return;\n  }\n  const matchText = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.string(editor, match);\n  if (!matchText.startsWith(MENTION_CHARACTER)) {\n    return;\n  }\n  return {\n    range: match,\n    text: matchText.substring(1)\n  };\n}\nfunction isComposerBodyMention(node) {\n  return slate__WEBPACK_IMPORTED_MODULE_2__.Element.isElement(node) && node.type === \"mention\";\n}\nfunction insertMention(editor, userId) {\n  const mention = {\n    type: \"mention\",\n    id: userId,\n    children: [{ text: \"\" }]\n  };\n  slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.insertNodes(editor, mention);\n  slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.move(editor);\n  const afterCharacter = editor.selection ? (0,_utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_3__.getCharacterAfter)(editor, editor.selection) : void 0;\n  if (!afterCharacter || afterCharacter.void) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.insertText(editor, \" \");\n  } else if ((0,_utils_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_4__.isEmptyString)(afterCharacter.text)) {\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.move(editor);\n  }\n}\nfunction insertMentionCharacter(editor) {\n  if (!editor.selection) {\n    return;\n  }\n  const beforeCharacter = (0,_utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_3__.getCharacterBefore)(editor, editor.selection, {\n    filterVoids: true\n  });\n  const afterCharacter = (0,_utils_get_character_mjs__WEBPACK_IMPORTED_MODULE_3__.getCharacterAfter)(editor, editor.selection, {\n    filterVoids: true\n  });\n  const shouldInsertSpaceBefore = beforeCharacter && !(0,_utils_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_4__.isEmptyString)(beforeCharacter.text);\n  const shouldInsertSpaceAfter = afterCharacter && !(0,_utils_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_4__.isEmptyString)(afterCharacter.text);\n  if ((0,_utils_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_0__.isSelectionCollapsed)(editor.selection)) {\n    const text = (shouldInsertSpaceBefore ? \" \" : \"\") + MENTION_CHARACTER + (shouldInsertSpaceAfter ? \" \" : \"\");\n    editor.insertText(text);\n    if (shouldInsertSpaceAfter) {\n      slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.move(editor, {\n        distance: 1,\n        unit: \"character\",\n        reverse: true\n      });\n    }\n  } else {\n    const beforeText = (shouldInsertSpaceBefore ? \" \" : \"\") + MENTION_CHARACTER;\n    editor.insertText(beforeText, { at: slate__WEBPACK_IMPORTED_MODULE_2__.Range.start(editor.selection) });\n    if (shouldInsertSpaceAfter) {\n      editor.insertText(\" \", { at: slate__WEBPACK_IMPORTED_MODULE_2__.Range.end(editor.selection) });\n    }\n    slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.collapse(editor, { edge: \"end\" });\n  }\n}\nfunction withMentions(editor) {\n  const { isInline, isVoid, markableVoid, deleteBackward } = editor;\n  editor.isInline = (element) => {\n    return isComposerBodyMention(element) || isInline(element);\n  };\n  editor.isVoid = (element) => {\n    return isComposerBodyMention(element) || isVoid(element);\n  };\n  editor.markableVoid = (element) => {\n    return isComposerBodyMention(element) || markableVoid(element);\n  };\n  editor.deleteBackward = (unit) => {\n    const { selection } = editor;\n    if ((0,_utils_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_0__.isSelectionCollapsed)(selection)) {\n      const [mention] = slate__WEBPACK_IMPORTED_MODULE_2__.Editor.nodes(editor, {\n        at: unit === \"character\" ? slate__WEBPACK_IMPORTED_MODULE_2__.Editor.before(editor, selection, { unit: \"character\" }) : selection,\n        match: isComposerBodyMention\n      });\n      deleteBackward(unit);\n      if (mention) {\n        slate__WEBPACK_IMPORTED_MODULE_2__.Transforms.insertText(editor, MENTION_CHARACTER);\n      }\n    } else {\n      deleteBackward(unit);\n    }\n  };\n  return editor;\n}\n\n\n//# sourceMappingURL=mentions.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL21lbnRpb25zLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUEyRDtBQUN3QjtBQUN0QjtBQUNBO0FBQ2M7O0FBRTNFO0FBQ0E7QUFDQSxVQUFVLFlBQVk7QUFDdEIsT0FBTyx1RkFBb0I7QUFDM0I7QUFDQTtBQUNBLGdCQUFnQix5RUFBYTtBQUM3QjtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IseUNBQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywwQ0FBTztBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFVBQVU7QUFDM0I7QUFDQSxFQUFFLDZDQUFVO0FBQ1osRUFBRSw2Q0FBVTtBQUNaLDRDQUE0QywyRUFBaUI7QUFDN0Q7QUFDQSxJQUFJLDZDQUFVO0FBQ2QsSUFBSSxTQUFTLHlFQUFhO0FBQzFCLElBQUksNkNBQVU7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsNEVBQWtCO0FBQzVDO0FBQ0EsR0FBRztBQUNILHlCQUF5QiwyRUFBaUI7QUFDMUM7QUFDQSxHQUFHO0FBQ0gsc0RBQXNELHlFQUFhO0FBQ25FLG9EQUFvRCx5RUFBYTtBQUNqRSxNQUFNLHVGQUFvQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQSxNQUFNLDZDQUFVO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLElBQUk7QUFDSjtBQUNBLG9DQUFvQyxJQUFJLHdDQUFLLDBCQUEwQjtBQUN2RTtBQUNBLCtCQUErQixJQUFJLHdDQUFLLHdCQUF3QjtBQUNoRTtBQUNBLElBQUksNkNBQVUsb0JBQW9CLGFBQWE7QUFDL0M7QUFDQTtBQUNBO0FBQ0EsVUFBVSxpREFBaUQ7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVk7QUFDeEIsUUFBUSx1RkFBb0I7QUFDNUIsd0JBQXdCLHlDQUFNO0FBQzlCLG1DQUFtQyx5Q0FBTSw2QkFBNkIsbUJBQW1CO0FBQ3pGO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxRQUFRLDZDQUFVO0FBQ2xCO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFJO0FBQ3JJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL21lbnRpb25zLm1qcz9lZDNhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvciwgVHJhbnNmb3JtcywgUmFuZ2UsIEVsZW1lbnQgfSBmcm9tICdzbGF0ZSc7XG5pbXBvcnQgeyBnZXRDaGFyYWN0ZXJBZnRlciwgZ2V0Q2hhcmFjdGVyQmVmb3JlIH0gZnJvbSAnLi4vdXRpbHMvZ2V0LWNoYXJhY3Rlci5tanMnO1xuaW1wb3J0IHsgZ2V0TWF0Y2hSYW5nZSB9IGZyb20gJy4uL3V0aWxzL2dldC1tYXRjaC1yYW5nZS5tanMnO1xuaW1wb3J0IHsgaXNFbXB0eVN0cmluZyB9IGZyb20gJy4uL3V0aWxzL2lzLWVtcHR5LXN0cmluZy5tanMnO1xuaW1wb3J0IHsgaXNTZWxlY3Rpb25Db2xsYXBzZWQgfSBmcm9tICcuLi91dGlscy9pcy1zZWxlY3Rpb24tY29sbGFwc2VkLm1qcyc7XG5cbmNvbnN0IE1FTlRJT05fQ0hBUkFDVEVSID0gXCJAXCI7XG5mdW5jdGlvbiBnZXRNZW50aW9uRHJhZnRBdFNlbGVjdGlvbihlZGl0b3IpIHtcbiAgY29uc3QgeyBzZWxlY3Rpb24gfSA9IGVkaXRvcjtcbiAgaWYgKCFpc1NlbGVjdGlvbkNvbGxhcHNlZChzZWxlY3Rpb24pKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gZ2V0TWF0Y2hSYW5nZShlZGl0b3IsIHNlbGVjdGlvbik7XG4gIGlmICghbWF0Y2gpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgbWF0Y2hUZXh0ID0gRWRpdG9yLnN0cmluZyhlZGl0b3IsIG1hdGNoKTtcbiAgaWYgKCFtYXRjaFRleHQuc3RhcnRzV2l0aChNRU5USU9OX0NIQVJBQ1RFUikpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgcmV0dXJuIHtcbiAgICByYW5nZTogbWF0Y2gsXG4gICAgdGV4dDogbWF0Y2hUZXh0LnN1YnN0cmluZygxKVxuICB9O1xufVxuZnVuY3Rpb24gaXNDb21wb3NlckJvZHlNZW50aW9uKG5vZGUpIHtcbiAgcmV0dXJuIEVsZW1lbnQuaXNFbGVtZW50KG5vZGUpICYmIG5vZGUudHlwZSA9PT0gXCJtZW50aW9uXCI7XG59XG5mdW5jdGlvbiBpbnNlcnRNZW50aW9uKGVkaXRvciwgdXNlcklkKSB7XG4gIGNvbnN0IG1lbnRpb24gPSB7XG4gICAgdHlwZTogXCJtZW50aW9uXCIsXG4gICAgaWQ6IHVzZXJJZCxcbiAgICBjaGlsZHJlbjogW3sgdGV4dDogXCJcIiB9XVxuICB9O1xuICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgbWVudGlvbik7XG4gIFRyYW5zZm9ybXMubW92ZShlZGl0b3IpO1xuICBjb25zdCBhZnRlckNoYXJhY3RlciA9IGVkaXRvci5zZWxlY3Rpb24gPyBnZXRDaGFyYWN0ZXJBZnRlcihlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24pIDogdm9pZCAwO1xuICBpZiAoIWFmdGVyQ2hhcmFjdGVyIHx8IGFmdGVyQ2hhcmFjdGVyLnZvaWQpIHtcbiAgICBUcmFuc2Zvcm1zLmluc2VydFRleHQoZWRpdG9yLCBcIiBcIik7XG4gIH0gZWxzZSBpZiAoaXNFbXB0eVN0cmluZyhhZnRlckNoYXJhY3Rlci50ZXh0KSkge1xuICAgIFRyYW5zZm9ybXMubW92ZShlZGl0b3IpO1xuICB9XG59XG5mdW5jdGlvbiBpbnNlcnRNZW50aW9uQ2hhcmFjdGVyKGVkaXRvcikge1xuICBpZiAoIWVkaXRvci5zZWxlY3Rpb24pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgYmVmb3JlQ2hhcmFjdGVyID0gZ2V0Q2hhcmFjdGVyQmVmb3JlKGVkaXRvciwgZWRpdG9yLnNlbGVjdGlvbiwge1xuICAgIGZpbHRlclZvaWRzOiB0cnVlXG4gIH0pO1xuICBjb25zdCBhZnRlckNoYXJhY3RlciA9IGdldENoYXJhY3RlckFmdGVyKGVkaXRvciwgZWRpdG9yLnNlbGVjdGlvbiwge1xuICAgIGZpbHRlclZvaWRzOiB0cnVlXG4gIH0pO1xuICBjb25zdCBzaG91bGRJbnNlcnRTcGFjZUJlZm9yZSA9IGJlZm9yZUNoYXJhY3RlciAmJiAhaXNFbXB0eVN0cmluZyhiZWZvcmVDaGFyYWN0ZXIudGV4dCk7XG4gIGNvbnN0IHNob3VsZEluc2VydFNwYWNlQWZ0ZXIgPSBhZnRlckNoYXJhY3RlciAmJiAhaXNFbXB0eVN0cmluZyhhZnRlckNoYXJhY3Rlci50ZXh0KTtcbiAgaWYgKGlzU2VsZWN0aW9uQ29sbGFwc2VkKGVkaXRvci5zZWxlY3Rpb24pKSB7XG4gICAgY29uc3QgdGV4dCA9IChzaG91bGRJbnNlcnRTcGFjZUJlZm9yZSA/IFwiIFwiIDogXCJcIikgKyBNRU5USU9OX0NIQVJBQ1RFUiArIChzaG91bGRJbnNlcnRTcGFjZUFmdGVyID8gXCIgXCIgOiBcIlwiKTtcbiAgICBlZGl0b3IuaW5zZXJ0VGV4dCh0ZXh0KTtcbiAgICBpZiAoc2hvdWxkSW5zZXJ0U3BhY2VBZnRlcikge1xuICAgICAgVHJhbnNmb3Jtcy5tb3ZlKGVkaXRvciwge1xuICAgICAgICBkaXN0YW5jZTogMSxcbiAgICAgICAgdW5pdDogXCJjaGFyYWN0ZXJcIixcbiAgICAgICAgcmV2ZXJzZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IGJlZm9yZVRleHQgPSAoc2hvdWxkSW5zZXJ0U3BhY2VCZWZvcmUgPyBcIiBcIiA6IFwiXCIpICsgTUVOVElPTl9DSEFSQUNURVI7XG4gICAgZWRpdG9yLmluc2VydFRleHQoYmVmb3JlVGV4dCwgeyBhdDogUmFuZ2Uuc3RhcnQoZWRpdG9yLnNlbGVjdGlvbikgfSk7XG4gICAgaWYgKHNob3VsZEluc2VydFNwYWNlQWZ0ZXIpIHtcbiAgICAgIGVkaXRvci5pbnNlcnRUZXh0KFwiIFwiLCB7IGF0OiBSYW5nZS5lbmQoZWRpdG9yLnNlbGVjdGlvbikgfSk7XG4gICAgfVxuICAgIFRyYW5zZm9ybXMuY29sbGFwc2UoZWRpdG9yLCB7IGVkZ2U6IFwiZW5kXCIgfSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHdpdGhNZW50aW9ucyhlZGl0b3IpIHtcbiAgY29uc3QgeyBpc0lubGluZSwgaXNWb2lkLCBtYXJrYWJsZVZvaWQsIGRlbGV0ZUJhY2t3YXJkIH0gPSBlZGl0b3I7XG4gIGVkaXRvci5pc0lubGluZSA9IChlbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuIGlzQ29tcG9zZXJCb2R5TWVudGlvbihlbGVtZW50KSB8fCBpc0lubGluZShlbGVtZW50KTtcbiAgfTtcbiAgZWRpdG9yLmlzVm9pZCA9IChlbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuIGlzQ29tcG9zZXJCb2R5TWVudGlvbihlbGVtZW50KSB8fCBpc1ZvaWQoZWxlbWVudCk7XG4gIH07XG4gIGVkaXRvci5tYXJrYWJsZVZvaWQgPSAoZWxlbWVudCkgPT4ge1xuICAgIHJldHVybiBpc0NvbXBvc2VyQm9keU1lbnRpb24oZWxlbWVudCkgfHwgbWFya2FibGVWb2lkKGVsZW1lbnQpO1xuICB9O1xuICBlZGl0b3IuZGVsZXRlQmFja3dhcmQgPSAodW5pdCkgPT4ge1xuICAgIGNvbnN0IHsgc2VsZWN0aW9uIH0gPSBlZGl0b3I7XG4gICAgaWYgKGlzU2VsZWN0aW9uQ29sbGFwc2VkKHNlbGVjdGlvbikpIHtcbiAgICAgIGNvbnN0IFttZW50aW9uXSA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICAgICAgYXQ6IHVuaXQgPT09IFwiY2hhcmFjdGVyXCIgPyBFZGl0b3IuYmVmb3JlKGVkaXRvciwgc2VsZWN0aW9uLCB7IHVuaXQ6IFwiY2hhcmFjdGVyXCIgfSkgOiBzZWxlY3Rpb24sXG4gICAgICAgIG1hdGNoOiBpc0NvbXBvc2VyQm9keU1lbnRpb25cbiAgICAgIH0pO1xuICAgICAgZGVsZXRlQmFja3dhcmQodW5pdCk7XG4gICAgICBpZiAobWVudGlvbikge1xuICAgICAgICBUcmFuc2Zvcm1zLmluc2VydFRleHQoZWRpdG9yLCBNRU5USU9OX0NIQVJBQ1RFUik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZUJhY2t3YXJkKHVuaXQpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGVkaXRvcjtcbn1cblxuZXhwb3J0IHsgTUVOVElPTl9DSEFSQUNURVIsIGdldE1lbnRpb25EcmFmdEF0U2VsZWN0aW9uLCBpbnNlcnRNZW50aW9uLCBpbnNlcnRNZW50aW9uQ2hhcmFjdGVyLCBpc0NvbXBvc2VyQm9keU1lbnRpb24sIHdpdGhNZW50aW9ucyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWVudGlvbnMubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/mentions.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/paste-html.mjs":
/*!*****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/plugins/paste-html.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withPasteHtml: () => (/* binding */ withPasteHtml)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var slate_hyperscript__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate-hyperscript */ \"(ssr)/./node_modules/slate-hyperscript/dist/index.es.js\");\n\n\n\nfunction areUrlsEqual(a, b) {\n  try {\n    const urlA = new URL(a);\n    const urlB = new URL(b);\n    return urlA.origin === urlB.origin && urlA.pathname === urlB.pathname;\n  } catch {\n    return false;\n  }\n}\nconst createParagraphElement = () => ({\n  type: \"paragraph\"\n});\nconst ELEMENT_TAGS = {\n  A: (element) => {\n    const href = element.getAttribute(\"href\");\n    const innerText = element.innerText;\n    return {\n      type: href && areUrlsEqual(href, innerText) ? \"auto-link\" : \"custom-link\",\n      url: href ?? \"\"\n    };\n  },\n  P: createParagraphElement,\n  BLOCKQUOTE: createParagraphElement,\n  H1: createParagraphElement,\n  H2: createParagraphElement,\n  H3: createParagraphElement,\n  H4: createParagraphElement,\n  H5: createParagraphElement,\n  H6: createParagraphElement,\n  LI: createParagraphElement\n};\nconst TEXT_TAGS = {\n  CODE: () => ({ code: true }),\n  DEL: () => ({ strikethrough: true }),\n  EM: () => ({ italic: true }),\n  I: () => ({ italic: true }),\n  S: () => ({ strikethrough: true }),\n  STRONG: () => ({ bold: true })\n};\nfunction flattenListItems(node) {\n  const listItems = [];\n  if (node.nodeName === \"LI\") {\n    listItems.push(node);\n  }\n  node.childNodes.forEach((child) => {\n    if (child.nodeType === 1) {\n      listItems.push(...flattenListItems(child));\n    }\n  });\n  return listItems;\n}\nfunction deserialize(node) {\n  if (node.nodeType === 3) {\n    return node.textContent;\n  } else if (node.nodeType !== 1) {\n    return null;\n  } else if (node.nodeName === \"BR\") {\n    return \"\\n\";\n  }\n  const childNodes = Array.from(node.childNodes);\n  let children = childNodes.map(deserialize).flat();\n  if (node.nodeName === \"UL\" || node.nodeName === \"OL\") {\n    const listItems = flattenListItems(node);\n    children = listItems.map((li) => deserialize(li)).flat();\n  }\n  if (children.length === 0) {\n    children = [{ text: \"\" }];\n  }\n  if (node.nodeName === \"BODY\") {\n    return (0,slate_hyperscript__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"fragment\", {}, children);\n  }\n  if (ELEMENT_TAGS[node.nodeName]) {\n    const attrs = ELEMENT_TAGS[node.nodeName](node);\n    return (0,slate_hyperscript__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"element\", attrs, children);\n  }\n  if (TEXT_TAGS[node.nodeName]) {\n    const attrs = TEXT_TAGS[node.nodeName](node);\n    return children.map((child) => (0,slate_hyperscript__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"text\", attrs, child));\n  }\n  return children;\n}\nfunction withPasteHtml(editor) {\n  const { insertData } = editor;\n  editor.insertData = (data) => {\n    const html = data.getData(\"text/html\");\n    if (html) {\n      const parsed = new DOMParser().parseFromString(html, \"text/html\");\n      const fragment = deserialize(parsed.body);\n      if (fragment !== null && Array.isArray(fragment)) {\n        slate__WEBPACK_IMPORTED_MODULE_1__.Transforms.insertFragment(editor, fragment);\n        return;\n      }\n    }\n    insertData(data);\n  };\n  return editor;\n}\n\n\n//# sourceMappingURL=paste-html.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL3Bhc3RlLWh0bWwubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtQztBQUNLOztBQUV4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVk7QUFDN0IsZ0JBQWdCLHFCQUFxQjtBQUNyQyxlQUFlLGNBQWM7QUFDN0IsY0FBYyxjQUFjO0FBQzVCLGNBQWMscUJBQXFCO0FBQ25DLG1CQUFtQixZQUFZO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLFVBQVU7QUFDNUI7QUFDQTtBQUNBLFdBQVcsc0RBQUcsZUFBZTtBQUM3QjtBQUNBO0FBQ0E7QUFDQSxXQUFXLHNEQUFHO0FBQ2Q7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHNEQUFHO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxhQUFhO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsNkNBQVU7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXlCO0FBQ3pCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS9wbHVnaW5zL3Bhc3RlLWh0bWwubWpzPzU1OWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHJhbnNmb3JtcyB9IGZyb20gJ3NsYXRlJztcbmltcG9ydCB7IGpzeCB9IGZyb20gJ3NsYXRlLWh5cGVyc2NyaXB0JztcblxuZnVuY3Rpb24gYXJlVXJsc0VxdWFsKGEsIGIpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cmxBID0gbmV3IFVSTChhKTtcbiAgICBjb25zdCB1cmxCID0gbmV3IFVSTChiKTtcbiAgICByZXR1cm4gdXJsQS5vcmlnaW4gPT09IHVybEIub3JpZ2luICYmIHVybEEucGF0aG5hbWUgPT09IHVybEIucGF0aG5hbWU7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuY29uc3QgY3JlYXRlUGFyYWdyYXBoRWxlbWVudCA9ICgpID0+ICh7XG4gIHR5cGU6IFwicGFyYWdyYXBoXCJcbn0pO1xuY29uc3QgRUxFTUVOVF9UQUdTID0ge1xuICBBOiAoZWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IGhyZWYgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcImhyZWZcIik7XG4gICAgY29uc3QgaW5uZXJUZXh0ID0gZWxlbWVudC5pbm5lclRleHQ7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IGhyZWYgJiYgYXJlVXJsc0VxdWFsKGhyZWYsIGlubmVyVGV4dCkgPyBcImF1dG8tbGlua1wiIDogXCJjdXN0b20tbGlua1wiLFxuICAgICAgdXJsOiBocmVmID8/IFwiXCJcbiAgICB9O1xuICB9LFxuICBQOiBjcmVhdGVQYXJhZ3JhcGhFbGVtZW50LFxuICBCTE9DS1FVT1RFOiBjcmVhdGVQYXJhZ3JhcGhFbGVtZW50LFxuICBIMTogY3JlYXRlUGFyYWdyYXBoRWxlbWVudCxcbiAgSDI6IGNyZWF0ZVBhcmFncmFwaEVsZW1lbnQsXG4gIEgzOiBjcmVhdGVQYXJhZ3JhcGhFbGVtZW50LFxuICBINDogY3JlYXRlUGFyYWdyYXBoRWxlbWVudCxcbiAgSDU6IGNyZWF0ZVBhcmFncmFwaEVsZW1lbnQsXG4gIEg2OiBjcmVhdGVQYXJhZ3JhcGhFbGVtZW50LFxuICBMSTogY3JlYXRlUGFyYWdyYXBoRWxlbWVudFxufTtcbmNvbnN0IFRFWFRfVEFHUyA9IHtcbiAgQ09ERTogKCkgPT4gKHsgY29kZTogdHJ1ZSB9KSxcbiAgREVMOiAoKSA9PiAoeyBzdHJpa2V0aHJvdWdoOiB0cnVlIH0pLFxuICBFTTogKCkgPT4gKHsgaXRhbGljOiB0cnVlIH0pLFxuICBJOiAoKSA9PiAoeyBpdGFsaWM6IHRydWUgfSksXG4gIFM6ICgpID0+ICh7IHN0cmlrZXRocm91Z2g6IHRydWUgfSksXG4gIFNUUk9ORzogKCkgPT4gKHsgYm9sZDogdHJ1ZSB9KVxufTtcbmZ1bmN0aW9uIGZsYXR0ZW5MaXN0SXRlbXMobm9kZSkge1xuICBjb25zdCBsaXN0SXRlbXMgPSBbXTtcbiAgaWYgKG5vZGUubm9kZU5hbWUgPT09IFwiTElcIikge1xuICAgIGxpc3RJdGVtcy5wdXNoKG5vZGUpO1xuICB9XG4gIG5vZGUuY2hpbGROb2Rlcy5mb3JFYWNoKChjaGlsZCkgPT4ge1xuICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgbGlzdEl0ZW1zLnB1c2goLi4uZmxhdHRlbkxpc3RJdGVtcyhjaGlsZCkpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBsaXN0SXRlbXM7XG59XG5mdW5jdGlvbiBkZXNlcmlhbGl6ZShub2RlKSB7XG4gIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgcmV0dXJuIG5vZGUudGV4dENvbnRlbnQ7XG4gIH0gZWxzZSBpZiAobm9kZS5ub2RlVHlwZSAhPT0gMSkge1xuICAgIHJldHVybiBudWxsO1xuICB9IGVsc2UgaWYgKG5vZGUubm9kZU5hbWUgPT09IFwiQlJcIikge1xuICAgIHJldHVybiBcIlxcblwiO1xuICB9XG4gIGNvbnN0IGNoaWxkTm9kZXMgPSBBcnJheS5mcm9tKG5vZGUuY2hpbGROb2Rlcyk7XG4gIGxldCBjaGlsZHJlbiA9IGNoaWxkTm9kZXMubWFwKGRlc2VyaWFsaXplKS5mbGF0KCk7XG4gIGlmIChub2RlLm5vZGVOYW1lID09PSBcIlVMXCIgfHwgbm9kZS5ub2RlTmFtZSA9PT0gXCJPTFwiKSB7XG4gICAgY29uc3QgbGlzdEl0ZW1zID0gZmxhdHRlbkxpc3RJdGVtcyhub2RlKTtcbiAgICBjaGlsZHJlbiA9IGxpc3RJdGVtcy5tYXAoKGxpKSA9PiBkZXNlcmlhbGl6ZShsaSkpLmZsYXQoKTtcbiAgfVxuICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgY2hpbGRyZW4gPSBbeyB0ZXh0OiBcIlwiIH1dO1xuICB9XG4gIGlmIChub2RlLm5vZGVOYW1lID09PSBcIkJPRFlcIikge1xuICAgIHJldHVybiBqc3goXCJmcmFnbWVudFwiLCB7fSwgY2hpbGRyZW4pO1xuICB9XG4gIGlmIChFTEVNRU5UX1RBR1Nbbm9kZS5ub2RlTmFtZV0pIHtcbiAgICBjb25zdCBhdHRycyA9IEVMRU1FTlRfVEFHU1tub2RlLm5vZGVOYW1lXShub2RlKTtcbiAgICByZXR1cm4ganN4KFwiZWxlbWVudFwiLCBhdHRycywgY2hpbGRyZW4pO1xuICB9XG4gIGlmIChURVhUX1RBR1Nbbm9kZS5ub2RlTmFtZV0pIHtcbiAgICBjb25zdCBhdHRycyA9IFRFWFRfVEFHU1tub2RlLm5vZGVOYW1lXShub2RlKTtcbiAgICByZXR1cm4gY2hpbGRyZW4ubWFwKChjaGlsZCkgPT4ganN4KFwidGV4dFwiLCBhdHRycywgY2hpbGQpKTtcbiAgfVxuICByZXR1cm4gY2hpbGRyZW47XG59XG5mdW5jdGlvbiB3aXRoUGFzdGVIdG1sKGVkaXRvcikge1xuICBjb25zdCB7IGluc2VydERhdGEgfSA9IGVkaXRvcjtcbiAgZWRpdG9yLmluc2VydERhdGEgPSAoZGF0YSkgPT4ge1xuICAgIGNvbnN0IGh0bWwgPSBkYXRhLmdldERhdGEoXCJ0ZXh0L2h0bWxcIik7XG4gICAgaWYgKGh0bWwpIHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgXCJ0ZXh0L2h0bWxcIik7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGRlc2VyaWFsaXplKHBhcnNlZC5ib2R5KTtcbiAgICAgIGlmIChmcmFnbWVudCAhPT0gbnVsbCAmJiBBcnJheS5pc0FycmF5KGZyYWdtZW50KSkge1xuICAgICAgICBUcmFuc2Zvcm1zLmluc2VydEZyYWdtZW50KGVkaXRvciwgZnJhZ21lbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGluc2VydERhdGEoZGF0YSk7XG4gIH07XG4gIHJldHVybiBlZGl0b3I7XG59XG5cbmV4cG9ydCB7IHdpdGhQYXN0ZUh0bWwgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhc3RlLWh0bWwubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/plugins/paste-html.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-character.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/get-character.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCharacterAfter: () => (/* binding */ getCharacterAfter),\n/* harmony export */   getCharacterBefore: () => (/* binding */ getCharacterBefore)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n\n\nfunction getCharacterBefore(editor, at, options = {}) {\n  const { filterVoids } = options;\n  const before = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.before(editor, at, {\n    unit: \"character\",\n    voids: filterVoids\n  });\n  if (before) {\n    const range = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.range(\n      editor,\n      before,\n      slate__WEBPACK_IMPORTED_MODULE_0__.Range.isRange(at) ? slate__WEBPACK_IMPORTED_MODULE_0__.Range.start(at) : at\n    );\n    const text = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.string(editor, range);\n    return {\n      range,\n      text,\n      void: text.length === 0\n    };\n  }\n  return;\n}\nfunction getCharacterAfter(editor, at, options = {}) {\n  const { filterVoids } = options;\n  const after = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.after(editor, at, {\n    unit: \"character\",\n    voids: filterVoids\n  });\n  if (after) {\n    const range = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.range(\n      editor,\n      after,\n      slate__WEBPACK_IMPORTED_MODULE_0__.Range.isRange(at) ? slate__WEBPACK_IMPORTED_MODULE_0__.Range.end(at) : at\n    );\n    const text = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.string(editor, range);\n    return {\n      range,\n      text,\n      void: text.length === 0\n    };\n  }\n  return;\n}\n\n\n//# sourceMappingURL=get-character.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9nZXQtY2hhcmFjdGVyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0M7O0FBRXRDLG9EQUFvRDtBQUNwRCxVQUFVLGNBQWM7QUFDeEIsaUJBQWlCLHlDQUFNO0FBQ3ZCO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxrQkFBa0IseUNBQU07QUFDeEI7QUFDQTtBQUNBLE1BQU0sd0NBQUssZUFBZSx3Q0FBSztBQUMvQjtBQUNBLGlCQUFpQix5Q0FBTTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1EO0FBQ25ELFVBQVUsY0FBYztBQUN4QixnQkFBZ0IseUNBQU07QUFDdEI7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLGtCQUFrQix5Q0FBTTtBQUN4QjtBQUNBO0FBQ0EsTUFBTSx3Q0FBSyxlQUFlLHdDQUFLO0FBQy9CO0FBQ0EsaUJBQWlCLHlDQUFNO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWlEO0FBQ2pEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9nZXQtY2hhcmFjdGVyLm1qcz8wZjI5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvciwgUmFuZ2UgfSBmcm9tICdzbGF0ZSc7XG5cbmZ1bmN0aW9uIGdldENoYXJhY3RlckJlZm9yZShlZGl0b3IsIGF0LCBvcHRpb25zID0ge30pIHtcbiAgY29uc3QgeyBmaWx0ZXJWb2lkcyB9ID0gb3B0aW9ucztcbiAgY29uc3QgYmVmb3JlID0gRWRpdG9yLmJlZm9yZShlZGl0b3IsIGF0LCB7XG4gICAgdW5pdDogXCJjaGFyYWN0ZXJcIixcbiAgICB2b2lkczogZmlsdGVyVm9pZHNcbiAgfSk7XG4gIGlmIChiZWZvcmUpIHtcbiAgICBjb25zdCByYW5nZSA9IEVkaXRvci5yYW5nZShcbiAgICAgIGVkaXRvcixcbiAgICAgIGJlZm9yZSxcbiAgICAgIFJhbmdlLmlzUmFuZ2UoYXQpID8gUmFuZ2Uuc3RhcnQoYXQpIDogYXRcbiAgICApO1xuICAgIGNvbnN0IHRleHQgPSBFZGl0b3Iuc3RyaW5nKGVkaXRvciwgcmFuZ2UpO1xuICAgIHJldHVybiB7XG4gICAgICByYW5nZSxcbiAgICAgIHRleHQsXG4gICAgICB2b2lkOiB0ZXh0Lmxlbmd0aCA9PT0gMFxuICAgIH07XG4gIH1cbiAgcmV0dXJuO1xufVxuZnVuY3Rpb24gZ2V0Q2hhcmFjdGVyQWZ0ZXIoZWRpdG9yLCBhdCwgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IHsgZmlsdGVyVm9pZHMgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGFmdGVyID0gRWRpdG9yLmFmdGVyKGVkaXRvciwgYXQsIHtcbiAgICB1bml0OiBcImNoYXJhY3RlclwiLFxuICAgIHZvaWRzOiBmaWx0ZXJWb2lkc1xuICB9KTtcbiAgaWYgKGFmdGVyKSB7XG4gICAgY29uc3QgcmFuZ2UgPSBFZGl0b3IucmFuZ2UoXG4gICAgICBlZGl0b3IsXG4gICAgICBhZnRlcixcbiAgICAgIFJhbmdlLmlzUmFuZ2UoYXQpID8gUmFuZ2UuZW5kKGF0KSA6IGF0XG4gICAgKTtcbiAgICBjb25zdCB0ZXh0ID0gRWRpdG9yLnN0cmluZyhlZGl0b3IsIHJhbmdlKTtcbiAgICByZXR1cm4ge1xuICAgICAgcmFuZ2UsXG4gICAgICB0ZXh0LFxuICAgICAgdm9pZDogdGV4dC5sZW5ndGggPT09IDBcbiAgICB9O1xuICB9XG4gIHJldHVybjtcbn1cblxuZXhwb3J0IHsgZ2V0Q2hhcmFjdGVyQWZ0ZXIsIGdldENoYXJhY3RlckJlZm9yZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2V0LWNoYXJhY3Rlci5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-character.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-dom-range.mjs":
/*!******************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/get-dom-range.mjs ***!
  \******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDOMRange: () => (/* binding */ getDOMRange)\n/* harmony export */ });\n/* harmony import */ var slate_react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate-react */ \"(ssr)/./node_modules/slate-react/dist/index.es.js\");\n\n\nfunction getDOMRange(editor, range) {\n  try {\n    return slate_react__WEBPACK_IMPORTED_MODULE_0__.ReactEditor.toDOMRange(editor, range);\n  } catch (error) {\n    return getDOMRange(editor, {\n      anchor: range.anchor,\n      focus: range.anchor\n    });\n  }\n}\n\n\n//# sourceMappingURL=get-dom-range.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9nZXQtZG9tLXJhbmdlLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUEwQzs7QUFFMUM7QUFDQTtBQUNBLFdBQVcsb0RBQVc7QUFDdEIsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUV1QjtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3Qvc2xhdGUvdXRpbHMvZ2V0LWRvbS1yYW5nZS5tanM/NGQyNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZWFjdEVkaXRvciB9IGZyb20gJ3NsYXRlLXJlYWN0JztcblxuZnVuY3Rpb24gZ2V0RE9NUmFuZ2UoZWRpdG9yLCByYW5nZSkge1xuICB0cnkge1xuICAgIHJldHVybiBSZWFjdEVkaXRvci50b0RPTVJhbmdlKGVkaXRvciwgcmFuZ2UpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBnZXRET01SYW5nZShlZGl0b3IsIHtcbiAgICAgIGFuY2hvcjogcmFuZ2UuYW5jaG9yLFxuICAgICAgZm9jdXM6IHJhbmdlLmFuY2hvclxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCB7IGdldERPTVJhbmdlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1nZXQtZG9tLXJhbmdlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-dom-range.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-match-range.mjs":
/*!********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/get-match-range.mjs ***!
  \********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getMatchRange: () => (/* binding */ getMatchRange)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n\n\nconst defaultOptions = {\n  direction: \"before\"\n};\nfunction getMatchRange(editor, at, terminators = [\" \"], options = defaultOptions) {\n  const { include, direction } = { ...defaultOptions, ...options };\n  let [start, end] = slate__WEBPACK_IMPORTED_MODULE_0__.Range.edges(at);\n  let point = start;\n  function move(direction2) {\n    const next = direction2 === \"after\" ? slate__WEBPACK_IMPORTED_MODULE_0__.Editor.after(editor, point, {\n      unit: \"character\"\n    }) : slate__WEBPACK_IMPORTED_MODULE_0__.Editor.before(editor, point, { unit: \"character\" });\n    const nextWord = next && slate__WEBPACK_IMPORTED_MODULE_0__.Editor.string(\n      editor,\n      direction2 === \"after\" ? { anchor: point, focus: next } : { anchor: next, focus: point }\n    );\n    const lastWord = nextWord && nextWord[direction2 === \"after\" ? 0 : nextWord.length - 1];\n    if (next && lastWord && !terminators.includes(lastWord)) {\n      point = next;\n      if (point.offset === 0) {\n        return false;\n      }\n    } else {\n      return false;\n    }\n    return true;\n  }\n  if (direction !== \"before\") {\n    point = end;\n    while (move(\"after\"))\n      ;\n    end = point;\n  }\n  if (direction !== \"after\") {\n    point = start;\n    while (move(\"before\"))\n      ;\n    start = point;\n  }\n  if (include) {\n    return {\n      anchor: slate__WEBPACK_IMPORTED_MODULE_0__.Editor.before(editor, start, { unit: \"offset\" }) ?? start,\n      focus: slate__WEBPACK_IMPORTED_MODULE_0__.Editor.after(editor, end, { unit: \"offset\" }) ?? end\n    };\n  }\n  return { anchor: start, focus: end };\n}\n\n\n//# sourceMappingURL=get-match-range.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9nZXQtbWF0Y2gtcmFuZ2UubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXNDOztBQUV0QztBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUscUJBQXFCLElBQUk7QUFDbkMscUJBQXFCLHdDQUFLO0FBQzFCO0FBQ0E7QUFDQSwwQ0FBMEMseUNBQU07QUFDaEQ7QUFDQSxLQUFLLElBQUkseUNBQU0seUJBQXlCLG1CQUFtQjtBQUMzRCw2QkFBNkIseUNBQU07QUFDbkM7QUFDQSxpQ0FBaUMsNkJBQTZCLElBQUk7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx5Q0FBTSx5QkFBeUIsZ0JBQWdCO0FBQzdELGFBQWEseUNBQU0sc0JBQXNCLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0EsV0FBVztBQUNYOztBQUV5QjtBQUN6QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3Qvc2xhdGUvdXRpbHMvZ2V0LW1hdGNoLXJhbmdlLm1qcz81NjE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJhbmdlLCBFZGl0b3IgfSBmcm9tICdzbGF0ZSc7XG5cbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICBkaXJlY3Rpb246IFwiYmVmb3JlXCJcbn07XG5mdW5jdGlvbiBnZXRNYXRjaFJhbmdlKGVkaXRvciwgYXQsIHRlcm1pbmF0b3JzID0gW1wiIFwiXSwgb3B0aW9ucyA9IGRlZmF1bHRPcHRpb25zKSB7XG4gIGNvbnN0IHsgaW5jbHVkZSwgZGlyZWN0aW9uIH0gPSB7IC4uLmRlZmF1bHRPcHRpb25zLCAuLi5vcHRpb25zIH07XG4gIGxldCBbc3RhcnQsIGVuZF0gPSBSYW5nZS5lZGdlcyhhdCk7XG4gIGxldCBwb2ludCA9IHN0YXJ0O1xuICBmdW5jdGlvbiBtb3ZlKGRpcmVjdGlvbjIpIHtcbiAgICBjb25zdCBuZXh0ID0gZGlyZWN0aW9uMiA9PT0gXCJhZnRlclwiID8gRWRpdG9yLmFmdGVyKGVkaXRvciwgcG9pbnQsIHtcbiAgICAgIHVuaXQ6IFwiY2hhcmFjdGVyXCJcbiAgICB9KSA6IEVkaXRvci5iZWZvcmUoZWRpdG9yLCBwb2ludCwgeyB1bml0OiBcImNoYXJhY3RlclwiIH0pO1xuICAgIGNvbnN0IG5leHRXb3JkID0gbmV4dCAmJiBFZGl0b3Iuc3RyaW5nKFxuICAgICAgZWRpdG9yLFxuICAgICAgZGlyZWN0aW9uMiA9PT0gXCJhZnRlclwiID8geyBhbmNob3I6IHBvaW50LCBmb2N1czogbmV4dCB9IDogeyBhbmNob3I6IG5leHQsIGZvY3VzOiBwb2ludCB9XG4gICAgKTtcbiAgICBjb25zdCBsYXN0V29yZCA9IG5leHRXb3JkICYmIG5leHRXb3JkW2RpcmVjdGlvbjIgPT09IFwiYWZ0ZXJcIiA/IDAgOiBuZXh0V29yZC5sZW5ndGggLSAxXTtcbiAgICBpZiAobmV4dCAmJiBsYXN0V29yZCAmJiAhdGVybWluYXRvcnMuaW5jbHVkZXMobGFzdFdvcmQpKSB7XG4gICAgICBwb2ludCA9IG5leHQ7XG4gICAgICBpZiAocG9pbnQub2Zmc2V0ID09PSAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoZGlyZWN0aW9uICE9PSBcImJlZm9yZVwiKSB7XG4gICAgcG9pbnQgPSBlbmQ7XG4gICAgd2hpbGUgKG1vdmUoXCJhZnRlclwiKSlcbiAgICAgIDtcbiAgICBlbmQgPSBwb2ludDtcbiAgfVxuICBpZiAoZGlyZWN0aW9uICE9PSBcImFmdGVyXCIpIHtcbiAgICBwb2ludCA9IHN0YXJ0O1xuICAgIHdoaWxlIChtb3ZlKFwiYmVmb3JlXCIpKVxuICAgICAgO1xuICAgIHN0YXJ0ID0gcG9pbnQ7XG4gIH1cbiAgaWYgKGluY2x1ZGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYW5jaG9yOiBFZGl0b3IuYmVmb3JlKGVkaXRvciwgc3RhcnQsIHsgdW5pdDogXCJvZmZzZXRcIiB9KSA/PyBzdGFydCxcbiAgICAgIGZvY3VzOiBFZGl0b3IuYWZ0ZXIoZWRpdG9yLCBlbmQsIHsgdW5pdDogXCJvZmZzZXRcIiB9KSA/PyBlbmRcbiAgICB9O1xuICB9XG4gIHJldHVybiB7IGFuY2hvcjogc3RhcnQsIGZvY3VzOiBlbmQgfTtcbn1cblxuZXhwb3J0IHsgZ2V0TWF0Y2hSYW5nZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2V0LW1hdGNoLXJhbmdlLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-match-range.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty-string.mjs":
/*!********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty-string.mjs ***!
  \********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isEmptyString: () => (/* binding */ isEmptyString)\n/* harmony export */ });\nfunction isEmptyString(string) {\n  return !string.trim();\n}\n\n\n//# sourceMappingURL=is-empty-string.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy1lbXB0eS1zdHJpbmcubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRXlCO0FBQ3pCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy1lbXB0eS1zdHJpbmcubWpzPzU4NTEiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gaXNFbXB0eVN0cmluZyhzdHJpbmcpIHtcbiAgcmV0dXJuICFzdHJpbmcudHJpbSgpO1xufVxuXG5leHBvcnQgeyBpc0VtcHR5U3RyaW5nIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pcy1lbXB0eS1zdHJpbmcubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty-string.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isEmpty: () => (/* binding */ isEmpty)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var _is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./is-empty-string.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty-string.mjs\");\n/* harmony import */ var _is_text_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./is-text.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs\");\n\n\n\n\nfunction isEmpty(editor, children) {\n  for (const child of children) {\n    if ((0,_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__.isText)(child)) {\n      if (!(0,_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_1__.isEmptyString)(child.text)) {\n        return false;\n      }\n    } else if (child.type === \"paragraph\") {\n      if (child.children.length > 1 || !((0,_is_text_mjs__WEBPACK_IMPORTED_MODULE_0__.isText)(child.children[0]) && (0,_is_empty_string_mjs__WEBPACK_IMPORTED_MODULE_1__.isEmptyString)(child.children[0].text))) {\n        return false;\n      }\n    } else {\n      if (!slate__WEBPACK_IMPORTED_MODULE_2__.Editor.isEmpty(editor, child)) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\n\n//# sourceMappingURL=is-empty.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy1lbXB0eS5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUErQjtBQUN1QjtBQUNmOztBQUV2QztBQUNBO0FBQ0EsUUFBUSxvREFBTTtBQUNkLFdBQVcsbUVBQWE7QUFDeEI7QUFDQTtBQUNBLE1BQU07QUFDTix5Q0FBeUMsb0RBQU0sdUJBQXVCLG1FQUFhO0FBQ25GO0FBQ0E7QUFDQSxNQUFNO0FBQ04sV0FBVyx5Q0FBTTtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRW1CO0FBQ25CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy1lbXB0eS5tanM/ZGZiNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZGl0b3IgfSBmcm9tICdzbGF0ZSc7XG5pbXBvcnQgeyBpc0VtcHR5U3RyaW5nIH0gZnJvbSAnLi9pcy1lbXB0eS1zdHJpbmcubWpzJztcbmltcG9ydCB7IGlzVGV4dCB9IGZyb20gJy4vaXMtdGV4dC5tanMnO1xuXG5mdW5jdGlvbiBpc0VtcHR5KGVkaXRvciwgY2hpbGRyZW4pIHtcbiAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgIGlmIChpc1RleHQoY2hpbGQpKSB7XG4gICAgICBpZiAoIWlzRW1wdHlTdHJpbmcoY2hpbGQudGV4dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2hpbGQudHlwZSA9PT0gXCJwYXJhZ3JhcGhcIikge1xuICAgICAgaWYgKGNoaWxkLmNoaWxkcmVuLmxlbmd0aCA+IDEgfHwgIShpc1RleHQoY2hpbGQuY2hpbGRyZW5bMF0pICYmIGlzRW1wdHlTdHJpbmcoY2hpbGQuY2hpbGRyZW5bMF0udGV4dCkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFFZGl0b3IuaXNFbXB0eShlZGl0b3IsIGNoaWxkKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgeyBpc0VtcHR5IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pcy1lbXB0eS5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-empty.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-selection-collapsed.mjs":
/*!***************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/is-selection-collapsed.mjs ***!
  \***************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isSelectionCollapsed: () => (/* binding */ isSelectionCollapsed)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n\n\nfunction isSelectionCollapsed(selection) {\n  return selection !== null && slate__WEBPACK_IMPORTED_MODULE_0__.Range.isCollapsed(selection);\n}\n\n\n//# sourceMappingURL=is-selection-collapsed.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy1zZWxlY3Rpb24tY29sbGFwc2VkLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUE4Qjs7QUFFOUI7QUFDQSwrQkFBK0Isd0NBQUs7QUFDcEM7O0FBRWdDO0FBQ2hDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy1zZWxlY3Rpb24tY29sbGFwc2VkLm1qcz80ZGRjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJhbmdlIH0gZnJvbSAnc2xhdGUnO1xuXG5mdW5jdGlvbiBpc1NlbGVjdGlvbkNvbGxhcHNlZChzZWxlY3Rpb24pIHtcbiAgcmV0dXJuIHNlbGVjdGlvbiAhPT0gbnVsbCAmJiBSYW5nZS5pc0NvbGxhcHNlZChzZWxlY3Rpb24pO1xufVxuXG5leHBvcnQgeyBpc1NlbGVjdGlvbkNvbGxhcHNlZCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXMtc2VsZWN0aW9uLWNvbGxhcHNlZC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-selection-collapsed.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs":
/*!************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs ***!
  \************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isPlainText: () => (/* binding */ isPlainText),\n/* harmony export */   isText: () => (/* binding */ isText)\n/* harmony export */ });\nfunction isText(element) {\n  return !(\"type\" in element) && \"text\" in element && typeof element.text === \"string\";\n}\nfunction isPlainText(node) {\n  return isText(node) && Object.keys(node).length === 1;\n}\n\n\n//# sourceMappingURL=is-text.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9pcy10ZXh0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFK0I7QUFDL0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3NsYXRlL3V0aWxzL2lzLXRleHQubWpzP2FhNGUiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gaXNUZXh0KGVsZW1lbnQpIHtcbiAgcmV0dXJuICEoXCJ0eXBlXCIgaW4gZWxlbWVudCkgJiYgXCJ0ZXh0XCIgaW4gZWxlbWVudCAmJiB0eXBlb2YgZWxlbWVudC50ZXh0ID09PSBcInN0cmluZ1wiO1xufVxuZnVuY3Rpb24gaXNQbGFpblRleHQobm9kZSkge1xuICByZXR1cm4gaXNUZXh0KG5vZGUpICYmIE9iamVjdC5rZXlzKG5vZGUpLmxlbmd0aCA9PT0gMTtcbn1cblxuZXhwb3J0IHsgaXNQbGFpblRleHQsIGlzVGV4dCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXMtdGV4dC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-text.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/marks.mjs":
/*!**********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/marks.mjs ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isMarkActive: () => (/* binding */ isMarkActive),\n/* harmony export */   leaveMarkEdge: () => (/* binding */ leaveMarkEdge),\n/* harmony export */   removeMarks: () => (/* binding */ removeMarks),\n/* harmony export */   toggleMark: () => (/* binding */ toggleMark)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var _get_character_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./get-character.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/get-character.mjs\");\n/* harmony import */ var _is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./is-selection-collapsed.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/is-selection-collapsed.mjs\");\n\n\n\n\nfunction isMarkActive(editor, format) {\n  const marks = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.marks(editor);\n  return marks ? marks[format] === true : false;\n}\nfunction toggleMark(editor, format) {\n  const isActive = isMarkActive(editor, format);\n  if (isActive) {\n    slate__WEBPACK_IMPORTED_MODULE_0__.Editor.removeMark(editor, format);\n  } else {\n    slate__WEBPACK_IMPORTED_MODULE_0__.Editor.addMark(editor, format, true);\n  }\n}\nfunction removeMarks(editor) {\n  const marks = slate__WEBPACK_IMPORTED_MODULE_0__.Editor.marks(editor);\n  if (marks) {\n    for (const mark in marks) {\n      slate__WEBPACK_IMPORTED_MODULE_0__.Editor.removeMark(editor, mark);\n    }\n  }\n}\nfunction leaveMarkEdge(editor, edge) {\n  if ((0,_is_selection_collapsed_mjs__WEBPACK_IMPORTED_MODULE_1__.isSelectionCollapsed)(editor.selection)) {\n    const marks = Object.keys(slate__WEBPACK_IMPORTED_MODULE_0__.Editor.marks(editor) ?? {});\n    if (marks.length > 0) {\n      const sibling = edge === \"start\" ? (0,_get_character_mjs__WEBPACK_IMPORTED_MODULE_2__.getCharacterBefore)(editor, editor.selection) : (0,_get_character_mjs__WEBPACK_IMPORTED_MODULE_2__.getCharacterAfter)(editor, editor.selection);\n      if (!sibling) {\n        removeMarks(editor);\n      }\n    }\n  }\n}\n\n\n//# sourceMappingURL=marks.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9tYXJrcy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUErQjtBQUM2QztBQUNSOztBQUVwRTtBQUNBLGdCQUFnQix5Q0FBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSx5Q0FBTTtBQUNWLElBQUk7QUFDSixJQUFJLHlDQUFNO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlDQUFNO0FBQ3RCO0FBQ0E7QUFDQSxNQUFNLHlDQUFNO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLGlGQUFvQjtBQUMxQiw4QkFBOEIseUNBQU0sb0JBQW9CO0FBQ3hEO0FBQ0EseUNBQXlDLHNFQUFrQiw2QkFBNkIscUVBQWlCO0FBQ3pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFZ0U7QUFDaEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3NsYXRlL3V0aWxzL21hcmtzLm1qcz8zNjA0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvciB9IGZyb20gJ3NsYXRlJztcbmltcG9ydCB7IGdldENoYXJhY3RlckJlZm9yZSwgZ2V0Q2hhcmFjdGVyQWZ0ZXIgfSBmcm9tICcuL2dldC1jaGFyYWN0ZXIubWpzJztcbmltcG9ydCB7IGlzU2VsZWN0aW9uQ29sbGFwc2VkIH0gZnJvbSAnLi9pcy1zZWxlY3Rpb24tY29sbGFwc2VkLm1qcyc7XG5cbmZ1bmN0aW9uIGlzTWFya0FjdGl2ZShlZGl0b3IsIGZvcm1hdCkge1xuICBjb25zdCBtYXJrcyA9IEVkaXRvci5tYXJrcyhlZGl0b3IpO1xuICByZXR1cm4gbWFya3MgPyBtYXJrc1tmb3JtYXRdID09PSB0cnVlIDogZmFsc2U7XG59XG5mdW5jdGlvbiB0b2dnbGVNYXJrKGVkaXRvciwgZm9ybWF0KSB7XG4gIGNvbnN0IGlzQWN0aXZlID0gaXNNYXJrQWN0aXZlKGVkaXRvciwgZm9ybWF0KTtcbiAgaWYgKGlzQWN0aXZlKSB7XG4gICAgRWRpdG9yLnJlbW92ZU1hcmsoZWRpdG9yLCBmb3JtYXQpO1xuICB9IGVsc2Uge1xuICAgIEVkaXRvci5hZGRNYXJrKGVkaXRvciwgZm9ybWF0LCB0cnVlKTtcbiAgfVxufVxuZnVuY3Rpb24gcmVtb3ZlTWFya3MoZWRpdG9yKSB7XG4gIGNvbnN0IG1hcmtzID0gRWRpdG9yLm1hcmtzKGVkaXRvcik7XG4gIGlmIChtYXJrcykge1xuICAgIGZvciAoY29uc3QgbWFyayBpbiBtYXJrcykge1xuICAgICAgRWRpdG9yLnJlbW92ZU1hcmsoZWRpdG9yLCBtYXJrKTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGxlYXZlTWFya0VkZ2UoZWRpdG9yLCBlZGdlKSB7XG4gIGlmIChpc1NlbGVjdGlvbkNvbGxhcHNlZChlZGl0b3Iuc2VsZWN0aW9uKSkge1xuICAgIGNvbnN0IG1hcmtzID0gT2JqZWN0LmtleXMoRWRpdG9yLm1hcmtzKGVkaXRvcikgPz8ge30pO1xuICAgIGlmIChtYXJrcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBzaWJsaW5nID0gZWRnZSA9PT0gXCJzdGFydFwiID8gZ2V0Q2hhcmFjdGVyQmVmb3JlKGVkaXRvciwgZWRpdG9yLnNlbGVjdGlvbikgOiBnZXRDaGFyYWN0ZXJBZnRlcihlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24pO1xuICAgICAgaWYgKCFzaWJsaW5nKSB7XG4gICAgICAgIHJlbW92ZU1hcmtzKGVkaXRvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IGlzTWFya0FjdGl2ZSwgbGVhdmVNYXJrRWRnZSwgcmVtb3ZlTWFya3MsIHRvZ2dsZU1hcmsgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1hcmtzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/marks.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/selection-contains-inlines.mjs":
/*!*******************************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/slate/utils/selection-contains-inlines.mjs ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   selectionContainsInlines: () => (/* binding */ selectionContainsInlines)\n/* harmony export */ });\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n\n\nfunction selectionContainsInlines(editor, match) {\n  const { selection } = editor;\n  if (!selection) {\n    return false;\n  }\n  const roots = Array.from(\n    slate__WEBPACK_IMPORTED_MODULE_0__.Editor.nodes(editor, {\n      at: selection,\n      match: (node) => slate__WEBPACK_IMPORTED_MODULE_0__.Element.isElement(node) && slate__WEBPACK_IMPORTED_MODULE_0__.Editor.isBlock(editor, node),\n      mode: \"lowest\"\n    })\n  );\n  for (const [, rootPath] of roots) {\n    const intersectingSelection = slate__WEBPACK_IMPORTED_MODULE_0__.Range.isRange(selection) ? slate__WEBPACK_IMPORTED_MODULE_0__.Range.intersection(selection, slate__WEBPACK_IMPORTED_MODULE_0__.Editor.range(editor, rootPath)) : selection;\n    if (!intersectingSelection) {\n      continue;\n    }\n    const matches = Array.from(\n      slate__WEBPACK_IMPORTED_MODULE_0__.Editor.nodes(editor, {\n        at: intersectingSelection,\n        match: (node) => slate__WEBPACK_IMPORTED_MODULE_0__.Editor.isInline(editor, node) && match(node)\n      })\n    );\n    if (matches.length > 0) {\n      return true;\n    }\n  }\n  return false;\n}\n\n\n//# sourceMappingURL=selection-contains-inlines.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC9zbGF0ZS91dGlscy9zZWxlY3Rpb24tY29udGFpbnMtaW5saW5lcy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBK0M7O0FBRS9DO0FBQ0EsVUFBVSxZQUFZO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSx5Q0FBTTtBQUNWO0FBQ0EsdUJBQXVCLDBDQUFPLG9CQUFvQix5Q0FBTTtBQUN4RDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esa0NBQWtDLHdDQUFLLHNCQUFzQix3Q0FBSyx5QkFBeUIseUNBQU07QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHlDQUFNO0FBQ1o7QUFDQSx5QkFBeUIseUNBQU07QUFDL0IsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVvQztBQUNwQyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3Qvc2xhdGUvdXRpbHMvc2VsZWN0aW9uLWNvbnRhaW5zLWlubGluZXMubWpzP2ZhNjgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWRpdG9yLCBFbGVtZW50LCBSYW5nZSB9IGZyb20gJ3NsYXRlJztcblxuZnVuY3Rpb24gc2VsZWN0aW9uQ29udGFpbnNJbmxpbmVzKGVkaXRvciwgbWF0Y2gpIHtcbiAgY29uc3QgeyBzZWxlY3Rpb24gfSA9IGVkaXRvcjtcbiAgaWYgKCFzZWxlY3Rpb24pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3Qgcm9vdHMgPSBBcnJheS5mcm9tKFxuICAgIEVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICAgIGF0OiBzZWxlY3Rpb24sXG4gICAgICBtYXRjaDogKG5vZGUpID0+IEVsZW1lbnQuaXNFbGVtZW50KG5vZGUpICYmIEVkaXRvci5pc0Jsb2NrKGVkaXRvciwgbm9kZSksXG4gICAgICBtb2RlOiBcImxvd2VzdFwiXG4gICAgfSlcbiAgKTtcbiAgZm9yIChjb25zdCBbLCByb290UGF0aF0gb2Ygcm9vdHMpIHtcbiAgICBjb25zdCBpbnRlcnNlY3RpbmdTZWxlY3Rpb24gPSBSYW5nZS5pc1JhbmdlKHNlbGVjdGlvbikgPyBSYW5nZS5pbnRlcnNlY3Rpb24oc2VsZWN0aW9uLCBFZGl0b3IucmFuZ2UoZWRpdG9yLCByb290UGF0aCkpIDogc2VsZWN0aW9uO1xuICAgIGlmICghaW50ZXJzZWN0aW5nU2VsZWN0aW9uKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgbWF0Y2hlcyA9IEFycmF5LmZyb20oXG4gICAgICBFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgICAgIGF0OiBpbnRlcnNlY3RpbmdTZWxlY3Rpb24sXG4gICAgICAgIG1hdGNoOiAobm9kZSkgPT4gRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbm9kZSkgJiYgbWF0Y2gobm9kZSlcbiAgICAgIH0pXG4gICAgKTtcbiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgeyBzZWxlY3Rpb25Db250YWluc0lubGluZXMgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlbGVjdGlvbi1jb250YWlucy1pbmxpbmVzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/slate/utils/selection-contains-inlines.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/Persist.mjs":
/*!******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/Persist.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Persist: () => (/* binding */ Persist),\n/* harmony export */   useAnimationPersist: () => (/* binding */ useAnimationPersist),\n/* harmony export */   usePersist: () => (/* binding */ usePersist)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _flush_sync_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./flush-sync.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/flush-sync.mjs\");\n/* harmony import */ var _use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./use-layout-effect.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs\");\n/* __next_internal_client_entry_do_not_use__ Persist,useAnimationPersist,usePersist auto */ \n\n\n\nconst PERSIST_NAME = \"Persist\";\nconst PersistContext = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nfunction usePersist() {\n    const persistContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(PersistContext);\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_1__.nn)(persistContext, \"Persist is missing from the React tree.\");\n}\nfunction getChild(children) {\n    const child = Array.isArray(children) ? react__WEBPACK_IMPORTED_MODULE_0__.Children.only(children) : children;\n    return /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.isValidElement)(child) ? child : void 0;\n}\nfunction useAnimationPersist(ref) {\n    const [isPresent, unmount] = usePersist();\n    const previousAnimationName = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const unmountAnimationName = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    (0,_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_2__.useLayoutEffect)(()=>{\n        const element = ref.current;\n        if (!element) {\n            return;\n        }\n        const handleAnimationEnd = (event)=>{\n            if (event.animationName === unmountAnimationName.current) {\n                unmount();\n            }\n            previousAnimationName.current = event.animationName;\n        };\n        element.addEventListener(\"animationcancel\", handleAnimationEnd);\n        element.addEventListener(\"animationend\", handleAnimationEnd);\n        return ()=>{\n            element.removeEventListener(\"animationcancel\", handleAnimationEnd);\n            element.removeEventListener(\"animationend\", handleAnimationEnd);\n        };\n    }, [\n        ref,\n        unmount\n    ]);\n    (0,_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_2__.useLayoutEffect)(()=>{\n        const element = ref.current;\n        let animationFrameId;\n        if (!element) {\n            return;\n        }\n        if (!isPresent) {\n            animationFrameId = requestAnimationFrame(()=>{\n                const styles = getComputedStyle(element);\n                unmountAnimationName.current = styles.animationName;\n                if (styles.animationName === \"none\" || styles.animationName === previousAnimationName.current || styles.display === \"none\") {\n                    unmount();\n                }\n            });\n        }\n        return ()=>{\n            cancelAnimationFrame(animationFrameId);\n        };\n    }, [\n        isPresent,\n        ref,\n        unmount\n    ]);\n}\nfunction Persist({ children }) {\n    const [isPersisting, setPersisting] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(true);\n    const lastPresentChild = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const child = getChild(children);\n    const unmount = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        (0,_flush_sync_mjs__WEBPACK_IMPORTED_MODULE_3__.flushSync)(()=>setPersisting(false));\n    }, []);\n    (0,_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_2__.useLayoutEffect)(()=>{\n        if (child) {\n            setPersisting(true);\n            lastPresentChild.current = child;\n        }\n    }, [\n        child\n    ]);\n    return /* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(PersistContext.Provider, {\n        value: [\n            Boolean(child),\n            unmount\n        ]\n    }, child ?? (isPersisting ? lastPresentChild.current : null));\n}\nif (true) {\n    Persist.displayName = PERSIST_NAME;\n}\n //# sourceMappingURL=Persist.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9QZXJzaXN0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQW9CQSxNQUFBQSxlQUFBO0FBUUEsTUFBQUMsK0JBQUFDLG9EQUFBQSxDQUFBO0FBRU8sU0FBQUM7SUFDTCxNQUFBQyxpQkFBQUMsaURBQUFBLENBQUFKO0lBRUEsT0FBQUssb0RBQUFBLENBQUFGLGdCQUFBO0FBQ0Y7QUFFQSxTQUFBRyxTQUFBQyxRQUFBO0lBQ0UsTUFBQUMsUUFBQUMsTUFBQUMsT0FBQSxDQUFBSCxZQUFBSSwyQ0FBQUEsQ0FBQUMsSUFBQSxDQUFBTCxZQUFBQTtJQUlBLHFCQUFBTSxxREFBQUEsQ0FBQUwsU0FBQUEsUUFBQTtBQUNGO0FBRU8sU0FBQU0sb0JBQUFDLEdBQUE7SUFDTCxPQUFBQyxXQUFBQyxRQUFBLEdBQUFmO0lBQ0EsTUFBQWdCLHdCQUFBQyw2Q0FBQUEsQ0FBQTtJQUNBLE1BQUFDLHVCQUFBRCw2Q0FBQUEsQ0FBQTtJQUVBRSx1RUFBZUEsQ0FBZjtRQUNFLE1BQUFDLFVBQUFQLElBQUFRLE9BQUE7UUFFQSxLQUFBRCxTQUFBO1lBQ0U7UUFBQTtRQVdGLE1BQUFFLHFCQUFBLENBQUFDO1lBQ0UsSUFBQUEsTUFBQUMsYUFBQSxLQUFBTixxQkFBQUcsT0FBQTtnQkFDRU47WUFBUTtZQUdWQyxzQkFBQUssT0FBQSxHQUFBRSxNQUFBQyxhQUFBO1FBQXNDO1FBR3hDSixRQUFBSyxnQkFBQSxvQkFBQUg7UUFDQUYsUUFBQUssZ0JBQUEsaUJBQUFIO1FBRUE7WUFDRUYsUUFBQU0sbUJBQUEsb0JBQUFKO1lBQ0FGLFFBQUFNLG1CQUFBLGlCQUFBSjtRQUE4RDtJQUNoRTtRQUFBVDtRQUFBRTtLQUFBO0lBR0ZJLHVFQUFlQSxDQUFmO1FBQ0UsTUFBQUMsVUFBQVAsSUFBQVEsT0FBQTtRQUNBLElBQUFNO1FBRUEsS0FBQVAsU0FBQTtZQUNFO1FBQUE7UUFHRixLQUFBTixXQUFBO1lBR0VhLG1CQUFBQyxzQkFBQTtnQkFDRSxNQUFBQyxTQUFBQyxpQkFBQVY7Z0JBQ0FGLHFCQUFBRyxPQUFBLEdBQUFRLE9BQUFMLGFBQUE7Z0JBRUEsSUFBQUssT0FBQUwsYUFBQSxlQUFBSyxPQUFBTCxhQUFBLEtBQUFSLHNCQUFBSyxPQUFBLElBQUFRLE9BQUFFLE9BQUE7b0JBS0VoQjtnQkFBUTtZQUNWO1FBQ0Q7UUFHSDtZQUNFaUIscUJBQUFMO1FBQXFDO0lBQ3ZDO1FBQUFiO1FBQUFEO1FBQUFFO0tBQUE7QUFFSjtBQU1nQixTQUFBa0IsUUFBQSxFQUFBNUIsUUFBQTtJQUNkLE9BQUE2QixjQUFBQyxjQUFBLEdBQUFDLCtDQUFBQSxDQUFBO0lBQ0EsTUFBQUMsbUJBQUFwQiw2Q0FBQUEsQ0FBQTtJQUNBLE1BQUFYLFFBQUFGLFNBQUFDO0lBRUEsTUFBQVUsVUFBQXVCLGtEQUFBQSxDQUFBO1FBQ0VDLDBEQUFTQSxDQUFULElBQUFKLGNBQUE7SUFBb0M7SUFHdENoQix1RUFBZUEsQ0FBZjtRQUNFLElBQUFiLE9BQUE7WUFDRTZCLGNBQUE7WUFDQUUsaUJBQUFoQixPQUFBLEdBQUFmO1FBQTJCO0lBQzdCO1FBQUFBO0tBQUE7SUFHRixxQ0FBQWtDLGdEQUFBLENBQUExQyxlQUFBNEMsUUFBQTtRQUNHQyxPQUFBO1lBQUFDLFFBQUF0QztZQUFBUztTQUFBO0lBQXVELEdBQUFULFNBQUE0QixDQUFBQSxlQUFBRyxpQkFBQWhCLE9BQUE7QUFJNUQ7QUFFQSxJQUFBd0IsSUFBQTtJQUNFWixRQUFBYSxXQUFBLEdBQUFqRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi4vLi4vc3JjL3V0aWxzL1BlcnNpc3QudHN4P2FjNzEiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB7IG5uIH0gZnJvbSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcbmltcG9ydCB0eXBlIHsgUmVhY3ROb2RlLCBSZWZPYmplY3QgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdCwge1xuICBDaGlsZHJlbixcbiAgY3JlYXRlQ29udGV4dCxcbiAgaXNWYWxpZEVsZW1lbnQsXG4gIHVzZUNhbGxiYWNrLFxuICB1c2VDb250ZXh0LFxuICB1c2VSZWYsXG4gIHVzZVN0YXRlLFxufSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgZmx1c2hTeW5jIH0gZnJvbSBcIi4vZmx1c2gtc3luY1wiO1xuaW1wb3J0IHsgdXNlTGF5b3V0RWZmZWN0IH0gZnJvbSBcIi4vdXNlLWxheW91dC1lZmZlY3RcIjtcblxuLy8gUGVyc2lzdCBpcyBhbiBvdmVybHkgc2ltcGxpZmllZCB2ZXJzaW9uIG9mIEZyYW1lciBNb3Rpb24ncyBBbmltYXRlUHJlc2VuY2UsXG4vLyBtb3N0bHkgbWltaWNraW5nIGl0cyB1c2VQcmVzZW5jZSBBUEk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mcmFtZXIvbW90aW9uL2Jsb2IvbWFpbi9wYWNrYWdlcy9mcmFtZXItbW90aW9uL3NyYy9jb21wb25lbnRzL0FuaW1hdGVQcmVzZW5jZS91c2UtcHJlc2VuY2UudHNcblxuY29uc3QgUEVSU0lTVF9OQU1FID0gXCJQZXJzaXN0XCI7XG5cbmludGVyZmFjZSBQZXJzaXN0UHJvcHMge1xuICBjaGlsZHJlbjogRXhjbHVkZTxSZWFjdE5vZGUsIEl0ZXJhYmxlPFJlYWN0Tm9kZT4+O1xufVxuXG50eXBlIFBlcnNpc3RDb250ZXh0ID0gW2Jvb2xlYW4sICgpID0+IHZvaWRdO1xuXG5jb25zdCBQZXJzaXN0Q29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8UGVyc2lzdENvbnRleHQgfCBudWxsPihudWxsKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHVzZVBlcnNpc3QoKSB7XG4gIGNvbnN0IHBlcnNpc3RDb250ZXh0ID0gdXNlQ29udGV4dChQZXJzaXN0Q29udGV4dCk7XG5cbiAgcmV0dXJuIG5uKHBlcnNpc3RDb250ZXh0LCBcIlBlcnNpc3QgaXMgbWlzc2luZyBmcm9tIHRoZSBSZWFjdCB0cmVlLlwiKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2hpbGQoY2hpbGRyZW46IFJlYWN0Tm9kZSkge1xuICBjb25zdCBjaGlsZDogUmVhY3ROb2RlID0gQXJyYXkuaXNBcnJheShjaGlsZHJlbilcbiAgICA/IENoaWxkcmVuLm9ubHkoY2hpbGRyZW4pXG4gICAgOiBjaGlsZHJlbjtcblxuICByZXR1cm4gaXNWYWxpZEVsZW1lbnQoY2hpbGQpID8gY2hpbGQgOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VBbmltYXRpb25QZXJzaXN0KHJlZjogUmVmT2JqZWN0PEhUTUxFbGVtZW50Pikge1xuICBjb25zdCBbaXNQcmVzZW50LCB1bm1vdW50XSA9IHVzZVBlcnNpc3QoKTtcbiAgY29uc3QgcHJldmlvdXNBbmltYXRpb25OYW1lID0gdXNlUmVmPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBjb25zdCB1bm1vdW50QW5pbWF0aW9uTmFtZSA9IHVzZVJlZjxzdHJpbmcgfCBudWxsPihudWxsKTtcblxuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGVsZW1lbnQgPSByZWYuY3VycmVudDtcblxuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0b3AgcGVyc2lzdGluZyBhdCB0aGUgZW5kIG9mIHRoZSBsYXN0IGFuaW1hdGlvbi5cbiAgICAgKlxuICAgICAqIFdlIGtlZXAgdHJhY2sgb2YgYWxsIGVuZGluZyBhbmltYXRpb25zIGJlY2F1c2UgYW5pbWF0aW9ucyBzdGF5XG4gICAgICogb24gZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5hbmltYXRpb25OYW1lIGV2ZW4gaWYgdGhleSdyZSBvdmVyLFxuICAgICAqIHNvIHdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiBwcmV2aW91cyBhbmltYXRpb25zIHRvIHRydWx5IGtub3cgaWZcbiAgICAgKiBhbiBhbmltYXRpb24gc2hvdWxkIGJlIHdhaXRlZCBvbi5cbiAgICAgKi9cbiAgICBjb25zdCBoYW5kbGVBbmltYXRpb25FbmQgPSAoZXZlbnQ6IEFuaW1hdGlvbkV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQuYW5pbWF0aW9uTmFtZSA9PT0gdW5tb3VudEFuaW1hdGlvbk5hbWUuY3VycmVudCkge1xuICAgICAgICB1bm1vdW50KCk7XG4gICAgICB9XG5cbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uTmFtZS5jdXJyZW50ID0gZXZlbnQuYW5pbWF0aW9uTmFtZTtcbiAgICB9O1xuXG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uY2FuY2VsXCIsIGhhbmRsZUFuaW1hdGlvbkVuZCk7XG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIsIGhhbmRsZUFuaW1hdGlvbkVuZCk7XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uY2FuY2VsXCIsIGhhbmRsZUFuaW1hdGlvbkVuZCk7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhbmltYXRpb25lbmRcIiwgaGFuZGxlQW5pbWF0aW9uRW5kKTtcbiAgICB9O1xuICB9LCBbcmVmLCB1bm1vdW50XSk7XG5cbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBlbGVtZW50ID0gcmVmLmN1cnJlbnQ7XG4gICAgbGV0IGFuaW1hdGlvbkZyYW1lSWQ6IG51bWJlcjtcblxuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghaXNQcmVzZW50KSB7XG4gICAgICAvLyBJZiB0aGUgZWxlbWVudCBzaG91bGQgYmUgdW5tb3VudGluZywgd2FpdCBmb3IgYSByZXBhaW50IGFuZCBjaGVja1xuICAgICAgLy8gaWYgaXQgaXMgdmlzaWJsZSBhbmQgaGFzIGFuIGFuaW1hdGlvbi4gSWYgbm90LCB1bm1vdW50IGltbWVkaWF0ZWx5LlxuICAgICAgYW5pbWF0aW9uRnJhbWVJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0eWxlcyA9IGdldENvbXB1dGVkU3R5bGUoZWxlbWVudCk7XG4gICAgICAgIHVubW91bnRBbmltYXRpb25OYW1lLmN1cnJlbnQgPSBzdHlsZXMuYW5pbWF0aW9uTmFtZTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgc3R5bGVzLmFuaW1hdGlvbk5hbWUgPT09IFwibm9uZVwiIHx8XG4gICAgICAgICAgc3R5bGVzLmFuaW1hdGlvbk5hbWUgPT09IHByZXZpb3VzQW5pbWF0aW9uTmFtZS5jdXJyZW50IHx8XG4gICAgICAgICAgc3R5bGVzLmRpc3BsYXkgPT09IFwibm9uZVwiXG4gICAgICAgICkge1xuICAgICAgICAgIHVubW91bnQoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbkZyYW1lSWQpO1xuICAgIH07XG4gIH0sIFtpc1ByZXNlbnQsIHJlZiwgdW5tb3VudF0pO1xufVxuXG4vKipcbiAqIFBlcnNpc3QgYSBjb21wb25lbnQgdW50aWwgaXQgZGVjaWRlcyB0byB1bm1vdW50IGJ5XG4gKiBpdHNlbGYgKGluc3RlYWQgb2Ygb3JjaGVzdHJhdGluZyB0aGUgdW5tb3VudCBmcm9tIHRoZSBwYXJlbnQpLlxuICovXG5leHBvcnQgZnVuY3Rpb24gUGVyc2lzdCh7IGNoaWxkcmVuIH06IFBlcnNpc3RQcm9wcykge1xuICBjb25zdCBbaXNQZXJzaXN0aW5nLCBzZXRQZXJzaXN0aW5nXSA9IHVzZVN0YXRlKHRydWUpO1xuICBjb25zdCBsYXN0UHJlc2VudENoaWxkID0gdXNlUmVmPFJlYWN0Tm9kZT4obnVsbCk7XG4gIGNvbnN0IGNoaWxkID0gZ2V0Q2hpbGQoY2hpbGRyZW4pO1xuXG4gIGNvbnN0IHVubW91bnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgZmx1c2hTeW5jKCgpID0+IHNldFBlcnNpc3RpbmcoZmFsc2UpKTtcbiAgfSwgW10pO1xuXG4gIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGNoaWxkKSB7XG4gICAgICBzZXRQZXJzaXN0aW5nKHRydWUpO1xuICAgICAgbGFzdFByZXNlbnRDaGlsZC5jdXJyZW50ID0gY2hpbGQ7XG4gICAgfVxuICB9LCBbY2hpbGRdKTtcblxuICByZXR1cm4gKFxuICAgIDxQZXJzaXN0Q29udGV4dC5Qcm92aWRlciB2YWx1ZT17W0Jvb2xlYW4oY2hpbGQpLCB1bm1vdW50XX0+XG4gICAgICB7Y2hpbGQgPz8gKGlzUGVyc2lzdGluZyA/IGxhc3RQcmVzZW50Q2hpbGQuY3VycmVudCA6IG51bGwpfVxuICAgIDwvUGVyc2lzdENvbnRleHQuUHJvdmlkZXI+XG4gICk7XG59XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgUGVyc2lzdC5kaXNwbGF5TmFtZSA9IFBFUlNJU1RfTkFNRTtcbn1cbiJdLCJuYW1lcyI6WyJQRVJTSVNUX05BTUUiLCJQZXJzaXN0Q29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJ1c2VQZXJzaXN0IiwicGVyc2lzdENvbnRleHQiLCJ1c2VDb250ZXh0Iiwibm4iLCJnZXRDaGlsZCIsImNoaWxkcmVuIiwiY2hpbGQiLCJBcnJheSIsImlzQXJyYXkiLCJDaGlsZHJlbiIsIm9ubHkiLCJpc1ZhbGlkRWxlbWVudCIsInVzZUFuaW1hdGlvblBlcnNpc3QiLCJyZWYiLCJpc1ByZXNlbnQiLCJ1bm1vdW50IiwicHJldmlvdXNBbmltYXRpb25OYW1lIiwidXNlUmVmIiwidW5tb3VudEFuaW1hdGlvbk5hbWUiLCJ1c2VMYXlvdXRFZmZlY3QiLCJlbGVtZW50IiwiY3VycmVudCIsImhhbmRsZUFuaW1hdGlvbkVuZCIsImV2ZW50IiwiYW5pbWF0aW9uTmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYW5pbWF0aW9uRnJhbWVJZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInN0eWxlcyIsImdldENvbXB1dGVkU3R5bGUiLCJkaXNwbGF5IiwiY2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJQZXJzaXN0IiwiaXNQZXJzaXN0aW5nIiwic2V0UGVyc2lzdGluZyIsInVzZVN0YXRlIiwibGFzdFByZXNlbnRDaGlsZCIsInVzZUNhbGxiYWNrIiwiZmx1c2hTeW5jIiwiUmVhY3RfX2RlZmF1bHQiLCJjcmVhdGVFbGVtZW50IiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIkJvb2xlYW4iLCJwcm9jZXNzIiwiZGlzcGxheU5hbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/Persist.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/Portal.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/Portal.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Portal: () => (/* binding */ Portal)\n/* harmony export */ });\n/* harmony import */ var _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @radix-ui/react-slot */ \"(ssr)/./node_modules/@radix-ui/react-slot/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-dom.js\");\n/* __next_internal_client_entry_do_not_use__ Portal auto */ \n\n\nconst PORTAL_NAME = \"Portal\";\nconst Portal = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({ container = document?.body, asChild, ...props }, forwardedRef)=>{\n    const Component = asChild ? _radix_ui_react_slot__WEBPACK_IMPORTED_MODULE_2__.Slot : \"div\";\n    return container ? /*#__PURE__*/ (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(/* @__PURE__ */ /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component, {\n        \"data-liveblocks-portal\": \"\",\n        ...props,\n        ref: forwardedRef\n    }), container) : null;\n});\nif (true) {\n    Portal.displayName = PORTAL_NAME;\n}\n //# sourceMappingURL=Portal.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9Qb3J0YWwubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFRQSxNQUFBQSxjQUFBO0FBU0EsTUFBQUMsdUJBQUFDLGlEQUFBQSxDQUFlLEdBQUFDLFlBQUFDLFVBQUFDLElBQUEsRUFBQUMsT0FBQSxLQUFBQyxPQUFBLEVBQUFDO0lBRVgsTUFBQUMsWUFBQUgsVUFBQUksc0RBQUFBLEdBQUE7SUFFQSxPQUFBUCwwQkFBQVEsdURBQUFBLENBQ0ksOEJBQUFDLGdEQUFBLENBQUFILFdBQUE7UUFDRztRQUFpQyxHQUFBRixLQUFBO1FBQU9PLEtBQUFOO0lBQVksSUFBY0wsYUFDbkU7QUFFRjtBQUlSLElBQUFZLElBQUE7SUFDRWQsT0FBQWUsV0FBQSxHQUFBaEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4uLy4uL3NyYy91dGlscy9Qb3J0YWwudHN4P2IwMGQiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCB7IFNsb3QgfSBmcm9tIFwiQHJhZGl4LXVpL3JlYWN0LXNsb3RcIjtcbmltcG9ydCBSZWFjdCwgeyBmb3J3YXJkUmVmIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBjcmVhdGVQb3J0YWwgfSBmcm9tIFwicmVhY3QtZG9tXCI7XG5cbmltcG9ydCB0eXBlIHsgQ29tcG9uZW50UHJvcHNXaXRoU2xvdCB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5jb25zdCBQT1JUQUxfTkFNRSA9IFwiUG9ydGFsXCI7XG5cbmludGVyZmFjZSBQb3J0YWxQcm9wcyBleHRlbmRzIENvbXBvbmVudFByb3BzV2l0aFNsb3Q8XCJkaXZcIj4ge1xuICAvKipcbiAgICogVGhlIGNvbnRhaW5lciB0byByZW5kZXIgdGhlIHBvcnRhbCBpbnRvLlxuICAgKi9cbiAgY29udGFpbmVyPzogSFRNTEVsZW1lbnQgfCBudWxsO1xufVxuXG5jb25zdCBQb3J0YWwgPSBmb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBQb3J0YWxQcm9wcz4oXG4gICh7IGNvbnRhaW5lciA9IGRvY3VtZW50Py5ib2R5LCBhc0NoaWxkLCAuLi5wcm9wcyB9LCBmb3J3YXJkZWRSZWYpID0+IHtcbiAgICBjb25zdCBDb21wb25lbnQgPSBhc0NoaWxkID8gU2xvdCA6IFwiZGl2XCI7XG5cbiAgICByZXR1cm4gY29udGFpbmVyXG4gICAgICA/IGNyZWF0ZVBvcnRhbChcbiAgICAgICAgICA8Q29tcG9uZW50IGRhdGEtbGl2ZWJsb2Nrcy1wb3J0YWw9XCJcIiB7Li4ucHJvcHN9IHJlZj17Zm9yd2FyZGVkUmVmfSAvPixcbiAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgKVxuICAgICAgOiBudWxsO1xuICB9XG4pO1xuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gIFBvcnRhbC5kaXNwbGF5TmFtZSA9IFBPUlRBTF9OQU1FO1xufVxuXG5leHBvcnQgeyBQb3J0YWwgfTtcbiJdLCJuYW1lcyI6WyJQT1JUQUxfTkFNRSIsIlBvcnRhbCIsImZvcndhcmRSZWYiLCJjb250YWluZXIiLCJkb2N1bWVudCIsImJvZHkiLCJhc0NoaWxkIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJDb21wb25lbnQiLCJTbG90IiwiY3JlYXRlUG9ydGFsIiwiUmVhY3RfX2RlZmF1bHQiLCJjcmVhdGVFbGVtZW50IiwicmVmIiwicHJvY2VzcyIsImRpc3BsYXlOYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/Portal.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/capitalize.mjs":
/*!*********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/capitalize.mjs ***!
  \*********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   capitalize: () => (/* binding */ capitalize)\n/* harmony export */ });\nfunction capitalize(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\n\n//# sourceMappingURL=capitalize.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9jYXBpdGFsaXplLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBOztBQUVzQjtBQUN0QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvY2FwaXRhbGl6ZS5tanM/NWMyMiJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpO1xufVxuXG5leHBvcnQgeyBjYXBpdGFsaXplIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYXBpdGFsaXplLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/capitalize.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/chunk.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/chunk.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chunk: () => (/* binding */ chunk)\n/* harmony export */ });\nfunction chunk(array, size) {\n  const chunks = [];\n  for (let i = 0, j = array.length; i < j; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n  return chunks;\n}\n\n\n//# sourceMappingURL=chunk.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9jaHVuay5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQSxvQ0FBb0MsT0FBTztBQUMzQztBQUNBO0FBQ0E7QUFDQTs7QUFFaUI7QUFDakIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL2NodW5rLm1qcz9kNTExIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGNodW5rKGFycmF5LCBzaXplKSB7XG4gIGNvbnN0IGNodW5rcyA9IFtdO1xuICBmb3IgKGxldCBpID0gMCwgaiA9IGFycmF5Lmxlbmd0aDsgaSA8IGo7IGkgKz0gc2l6ZSkge1xuICAgIGNodW5rcy5wdXNoKGFycmF5LnNsaWNlKGksIGkgKyBzaXplKSk7XG4gIH1cbiAgcmV0dXJuIGNodW5rcztcbn1cblxuZXhwb3J0IHsgY2h1bmsgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNodW5rLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/chunk.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/clamp.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/clamp.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clamp: () => (/* binding */ clamp)\n/* harmony export */ });\nfunction clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\n\n//# sourceMappingURL=clamp.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9jbGFtcC5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTs7QUFFaUI7QUFDakIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL2NsYW1wLm1qcz9hNDFmIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGNsYW1wKHZhbHVlLCBtaW4sIG1heCkge1xuICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodmFsdWUsIG1pbiksIG1heCk7XG59XG5cbmV4cG9ydCB7IGNsYW1wIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jbGFtcC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/clamp.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs":
/*!**********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   classNames: () => (/* binding */ classNames)\n/* harmony export */ });\nfunction classNames(...args) {\n  return args.filter((arg) => typeof arg === \"string\" || typeof arg === \"number\").join(\" \");\n}\n\n\n//# sourceMappingURL=class-names.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9jbGFzcy1uYW1lcy5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTs7QUFFc0I7QUFDdEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL2NsYXNzLW5hbWVzLm1qcz85NTg2Il0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGNsYXNzTmFtZXMoLi4uYXJncykge1xuICByZXR1cm4gYXJncy5maWx0ZXIoKGFyZykgPT4gdHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgYXJnID09PSBcIm51bWJlclwiKS5qb2luKFwiIFwiKTtcbn1cblxuZXhwb3J0IHsgY2xhc3NOYW1lcyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2xhc3MtbmFtZXMubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/class-names.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/exists.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/exists.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   exists: () => (/* binding */ exists)\n/* harmony export */ });\nfunction exists(input) {\n  return input !== null && input !== void 0;\n}\n\n\n//# sourceMappingURL=exists.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9leGlzdHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRWtCO0FBQ2xCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9leGlzdHMubWpzPzc1ZjkiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZXhpc3RzKGlucHV0KSB7XG4gIHJldHVybiBpbnB1dCAhPT0gbnVsbCAmJiBpbnB1dCAhPT0gdm9pZCAwO1xufVxuXG5leHBvcnQgeyBleGlzdHMgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV4aXN0cy5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/exists.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/find-last-index.mjs":
/*!**************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/find-last-index.mjs ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLastIndex: () => (/* binding */ findLastIndex)\n/* harmony export */ });\nfunction findLastIndex(array, predicate) {\n  let index = array.length - 1;\n  while (index >= 0) {\n    if (predicate(array[index])) {\n      return index;\n    }\n    index--;\n  }\n  return -1;\n}\n\n\n//# sourceMappingURL=find-last-index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9maW5kLWxhc3QtaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFeUI7QUFDekIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL2ZpbmQtbGFzdC1pbmRleC5tanM/NTQ3NCJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBmaW5kTGFzdEluZGV4KGFycmF5LCBwcmVkaWNhdGUpIHtcbiAgbGV0IGluZGV4ID0gYXJyYXkubGVuZ3RoIC0gMTtcbiAgd2hpbGUgKGluZGV4ID49IDApIHtcbiAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSkpIHtcbiAgICAgIHJldHVybiBpbmRleDtcbiAgICB9XG4gICAgaW5kZXgtLTtcbiAgfVxuICByZXR1cm4gLTE7XG59XG5cbmV4cG9ydCB7IGZpbmRMYXN0SW5kZXggfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZpbmQtbGFzdC1pbmRleC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/find-last-index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/flush-sync.mjs":
/*!*********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/flush-sync.mjs ***!
  \*********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   flushSync: () => (/* binding */ flushSync)\n/* harmony export */ });\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react-dom */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-dom.js\");\n\n\nconst useReactFlushSync = react_dom__WEBPACK_IMPORTED_MODULE_0__[\"flushSync\".toString()];\nfunction flushSyncFallback(fn) {\n  return fn();\n}\nconst flushSync = useReactFlushSync ?? flushSyncFallback;\n\n\n//# sourceMappingURL=flush-sync.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9mbHVzaC1zeW5jLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFpQzs7QUFFakMsMEJBQTBCLHNDQUFRO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBOztBQUVxQjtBQUNyQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvZmx1c2gtc3luYy5tanM/ZGMwZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcblxuY29uc3QgdXNlUmVhY3RGbHVzaFN5bmMgPSBSZWFjdERPTVtcImZsdXNoU3luY1wiLnRvU3RyaW5nKCldO1xuZnVuY3Rpb24gZmx1c2hTeW5jRmFsbGJhY2soZm4pIHtcbiAgcmV0dXJuIGZuKCk7XG59XG5jb25zdCBmbHVzaFN5bmMgPSB1c2VSZWFjdEZsdXNoU3luYyA/PyBmbHVzaFN5bmNGYWxsYmFjaztcblxuZXhwb3J0IHsgZmx1c2hTeW5jIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1mbHVzaC1zeW5jLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/flush-sync.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/get-initials.mjs":
/*!***********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/get-initials.mjs ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getInitials: () => (/* binding */ getInitials)\n/* harmony export */ });\nfunction getInitials(name) {\n  return name.trim().split(\" \").reduce((initials, name2, index, array) => {\n    if (index === 0 || index === array.length - 1) {\n      initials += name2.charAt(0).toLocaleUpperCase();\n    }\n    return initials;\n  }, \"\");\n}\n\n\n//# sourceMappingURL=get-initials.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9nZXQtaW5pdGlhbHMubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRXVCO0FBQ3ZCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9nZXQtaW5pdGlhbHMubWpzP2ZhYjQiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZ2V0SW5pdGlhbHMobmFtZSkge1xuICByZXR1cm4gbmFtZS50cmltKCkuc3BsaXQoXCIgXCIpLnJlZHVjZSgoaW5pdGlhbHMsIG5hbWUyLCBpbmRleCwgYXJyYXkpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IDAgfHwgaW5kZXggPT09IGFycmF5Lmxlbmd0aCAtIDEpIHtcbiAgICAgIGluaXRpYWxzICs9IG5hbWUyLmNoYXJBdCgwKS50b0xvY2FsZVVwcGVyQ2FzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gaW5pdGlhbHM7XG4gIH0sIFwiXCIpO1xufVxuXG5leHBvcnQgeyBnZXRJbml0aWFscyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2V0LWluaXRpYWxzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/get-initials.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/intl.mjs":
/*!***************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/intl.mjs ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dateTimeFormat: () => (/* binding */ dateTimeFormat),\n/* harmony export */   listFormat: () => (/* binding */ listFormat),\n/* harmony export */   relativeTimeFormat: () => (/* binding */ relativeTimeFormat)\n/* harmony export */ });\n/* harmony import */ var _memoize_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./memoize.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/memoize.mjs\");\n\n\nconst dateTimeFormat = (0,_memoize_mjs__WEBPACK_IMPORTED_MODULE_0__.memoize)(\n  (...args) => {\n    return new Intl.DateTimeFormat(...args);\n  }\n);\nconst relativeTimeFormat = (0,_memoize_mjs__WEBPACK_IMPORTED_MODULE_0__.memoize)(\n  (...args) => {\n    return new Intl.RelativeTimeFormat(...args);\n  }\n);\nconst listFormat = (0,_memoize_mjs__WEBPACK_IMPORTED_MODULE_0__.memoize)(\n  (...args) => {\n    return new Intl.ListFormat(...args);\n  }\n);\n\n\n//# sourceMappingURL=intl.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9pbnRsLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXdDOztBQUV4Qyx1QkFBdUIscURBQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIscURBQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIscURBQU87QUFDMUI7QUFDQTtBQUNBO0FBQ0E7O0FBRTBEO0FBQzFEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9pbnRsLm1qcz8zNTNiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1lbW9pemUgfSBmcm9tICcuL21lbW9pemUubWpzJztcblxuY29uc3QgZGF0ZVRpbWVGb3JtYXQgPSBtZW1vaXplKFxuICAoLi4uYXJncykgPT4ge1xuICAgIHJldHVybiBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCguLi5hcmdzKTtcbiAgfVxuKTtcbmNvbnN0IHJlbGF0aXZlVGltZUZvcm1hdCA9IG1lbW9pemUoXG4gICguLi5hcmdzKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBJbnRsLlJlbGF0aXZlVGltZUZvcm1hdCguLi5hcmdzKTtcbiAgfVxuKTtcbmNvbnN0IGxpc3RGb3JtYXQgPSBtZW1vaXplKFxuICAoLi4uYXJncykgPT4ge1xuICAgIHJldHVybiBuZXcgSW50bC5MaXN0Rm9ybWF0KC4uLmFyZ3MpO1xuICB9XG4pO1xuXG5leHBvcnQgeyBkYXRlVGltZUZvcm1hdCwgbGlzdEZvcm1hdCwgcmVsYXRpdmVUaW1lRm9ybWF0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbnRsLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/intl.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-apple.mjs":
/*!*******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/is-apple.mjs ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isApple: () => (/* binding */ isApple)\n/* harmony export */ });\nconst APPLE_REGEX = /Mac|iPod|iPhone|iPad/;\nfunction isApple() {\n  return typeof window !== \"undefined\" && APPLE_REGEX.test(window.navigator.platform);\n}\n\n\n//# sourceMappingURL=is-apple.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9pcy1hcHBsZS5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVtQjtBQUNuQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvaXMtYXBwbGUubWpzPzRhNzkiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQVBQTEVfUkVHRVggPSAvTWFjfGlQb2R8aVBob25lfGlQYWQvO1xuZnVuY3Rpb24gaXNBcHBsZSgpIHtcbiAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiYgQVBQTEVfUkVHRVgudGVzdCh3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtKTtcbn1cblxuZXhwb3J0IHsgaXNBcHBsZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXMtYXBwbGUubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-apple.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-key.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/is-key.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isKey: () => (/* binding */ isKey)\n/* harmony export */ });\n/* harmony import */ var _is_apple_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./is-apple.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-apple.mjs\");\n\n\nconst MODIFIERS = {\n  alt: () => \"altKey\",\n  ctrl: () => \"ctrlKey\",\n  meta: () => \"metaKey\",\n  mod: () => (0,_is_apple_mjs__WEBPACK_IMPORTED_MODULE_0__.isApple)() ? \"metaKey\" : \"ctrlKey\",\n  shift: () => \"shiftKey\"\n};\nfunction isKey(event, key, modifiers = {}) {\n  if (event.key !== key) {\n    return false;\n  }\n  const explicitModifiers = Object.entries(modifiers).filter(\n    ([, value]) => typeof value === \"boolean\"\n  );\n  return explicitModifiers.every(([modifier, value]) => {\n    const property = MODIFIERS[modifier]();\n    return event[property] === value;\n  });\n}\n\n\n//# sourceMappingURL=is-key.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9pcy1rZXkubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXlDOztBQUV6QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsc0RBQU87QUFDcEI7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRWlCO0FBQ2pCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9pcy1rZXkubWpzP2RjM2YiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNBcHBsZSB9IGZyb20gJy4vaXMtYXBwbGUubWpzJztcblxuY29uc3QgTU9ESUZJRVJTID0ge1xuICBhbHQ6ICgpID0+IFwiYWx0S2V5XCIsXG4gIGN0cmw6ICgpID0+IFwiY3RybEtleVwiLFxuICBtZXRhOiAoKSA9PiBcIm1ldGFLZXlcIixcbiAgbW9kOiAoKSA9PiBpc0FwcGxlKCkgPyBcIm1ldGFLZXlcIiA6IFwiY3RybEtleVwiLFxuICBzaGlmdDogKCkgPT4gXCJzaGlmdEtleVwiXG59O1xuZnVuY3Rpb24gaXNLZXkoZXZlbnQsIGtleSwgbW9kaWZpZXJzID0ge30pIHtcbiAgaWYgKGV2ZW50LmtleSAhPT0ga2V5KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IGV4cGxpY2l0TW9kaWZpZXJzID0gT2JqZWN0LmVudHJpZXMobW9kaWZpZXJzKS5maWx0ZXIoXG4gICAgKFssIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIlxuICApO1xuICByZXR1cm4gZXhwbGljaXRNb2RpZmllcnMuZXZlcnkoKFttb2RpZmllciwgdmFsdWVdKSA9PiB7XG4gICAgY29uc3QgcHJvcGVydHkgPSBNT0RJRklFUlNbbW9kaWZpZXJdKCk7XG4gICAgcmV0dXJuIGV2ZW50W3Byb3BlcnR5XSA9PT0gdmFsdWU7XG4gIH0pO1xufVxuXG5leHBvcnQgeyBpc0tleSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXMta2V5Lm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/is-key.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/memoize.mjs":
/*!******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/memoize.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   memoize: () => (/* binding */ memoize)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n\n\nfunction memoize(fn) {\n  const cache = /* @__PURE__ */ new Map();\n  return (...args) => {\n    const key = JSON.stringify(args.map((arg) => (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.stringify)(arg)));\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    const result = fn(...args);\n    cache.set(key, result);\n    return result;\n  };\n}\n\n\n//# sourceMappingURL=memoize.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9tZW1vaXplLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUE2Qzs7QUFFN0M7QUFDQTtBQUNBO0FBQ0EsaURBQWlELDJEQUFTO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRW1CO0FBQ25CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9tZW1vaXplLm1qcz84Yjc1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN0cmluZ2lmeSB9IGZyb20gJ0BsaXZlYmxvY2tzL2NvcmUnO1xuXG5mdW5jdGlvbiBtZW1vaXplKGZuKSB7XG4gIGNvbnN0IGNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gSlNPTi5zdHJpbmdpZnkoYXJncy5tYXAoKGFyZykgPT4gc3RyaW5naWZ5KGFyZykpKTtcbiAgICBpZiAoY2FjaGUuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQoa2V5KTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gZm4oLi4uYXJncyk7XG4gICAgY2FjaGUuc2V0KGtleSwgcmVzdWx0KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xufVxuXG5leHBvcnQgeyBtZW1vaXplIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZW1vaXplLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/memoize.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/pluralize.mjs":
/*!********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/pluralize.mjs ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pluralize: () => (/* binding */ pluralize)\n/* harmony export */ });\nfunction pluralize(count, singular, plural) {\n  return count === 1 ? singular : plural ?? `${singular}s`;\n}\n\n\n//# sourceMappingURL=pluralize.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9wbHVyYWxpemUubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBLCtDQUErQyxTQUFTO0FBQ3hEOztBQUVxQjtBQUNyQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvcGx1cmFsaXplLm1qcz8wMzBkIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHBsdXJhbGl6ZShjb3VudCwgc2luZ3VsYXIsIHBsdXJhbCkge1xuICByZXR1cm4gY291bnQgPT09IDEgPyBzaW5ndWxhciA6IHBsdXJhbCA/PyBgJHtzaW5ndWxhcn1zYDtcbn1cblxuZXhwb3J0IHsgcGx1cmFsaXplIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wbHVyYWxpemUubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/pluralize.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/request-idle-callback.mjs":
/*!********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/request-idle-callback.mjs ***!
  \********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cancelIdleCallback: () => (/* binding */ cancelIdleCallback),\n/* harmony export */   requestIdleCallback: () => (/* binding */ requestIdleCallback)\n/* harmony export */ });\nconst IDLE_CALLBACK_FALLBACK_TIMEOUT = 100;\nfunction requestIdleCallbackFallback(callback, options) {\n  return setTimeout(\n    callback,\n    Math.min(options?.timeout ?? Infinity, IDLE_CALLBACK_FALLBACK_TIMEOUT)\n  );\n}\nconst requestIdleCallback = (typeof window !== \"undefined\" ? window.requestIdleCallback : null) ?? requestIdleCallbackFallback;\nconst cancelIdleCallback = (typeof window !== \"undefined\" ? window.cancelIdleCallback : null) ?? clearTimeout;\n\n\n//# sourceMappingURL=request-idle-callback.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9yZXF1ZXN0LWlkbGUtY2FsbGJhY2subWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVtRDtBQUNuRCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvcmVxdWVzdC1pZGxlLWNhbGxiYWNrLm1qcz8zNDNkIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IElETEVfQ0FMTEJBQ0tfRkFMTEJBQ0tfVElNRU9VVCA9IDEwMDtcbmZ1bmN0aW9uIHJlcXVlc3RJZGxlQ2FsbGJhY2tGYWxsYmFjayhjYWxsYmFjaywgb3B0aW9ucykge1xuICByZXR1cm4gc2V0VGltZW91dChcbiAgICBjYWxsYmFjayxcbiAgICBNYXRoLm1pbihvcHRpb25zPy50aW1lb3V0ID8/IEluZmluaXR5LCBJRExFX0NBTExCQUNLX0ZBTExCQUNLX1RJTUVPVVQpXG4gICk7XG59XG5jb25zdCByZXF1ZXN0SWRsZUNhbGxiYWNrID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cucmVxdWVzdElkbGVDYWxsYmFjayA6IG51bGwpID8/IHJlcXVlc3RJZGxlQ2FsbGJhY2tGYWxsYmFjaztcbmNvbnN0IGNhbmNlbElkbGVDYWxsYmFjayA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93LmNhbmNlbElkbGVDYWxsYmFjayA6IG51bGwpID8/IGNsZWFyVGltZW91dDtcblxuZXhwb3J0IHsgY2FuY2VsSWRsZUNhbGxiYWNrLCByZXF1ZXN0SWRsZUNhbGxiYWNrIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZXF1ZXN0LWlkbGUtY2FsbGJhY2subWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/request-idle-callback.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/request-submit.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/request-submit.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   requestSubmit: () => (/* binding */ requestSubmit)\n/* harmony export */ });\nfunction requestSubmit(form, submitter) {\n  if (typeof form.requestSubmit === \"function\") {\n    return form.requestSubmit(submitter);\n  }\n  if (submitter) {\n    submitter.click();\n  } else {\n    submitter = document.createElement(\"input\");\n    submitter.type = \"submit\";\n    submitter.hidden = true;\n    form.appendChild(submitter);\n    submitter.click();\n    form.removeChild(submitter);\n  }\n}\n\n\n//# sourceMappingURL=request-submit.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy9yZXF1ZXN0LXN1Ym1pdC5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV5QjtBQUN6QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvcmVxdWVzdC1zdWJtaXQubWpzPzJhY2MiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gcmVxdWVzdFN1Ym1pdChmb3JtLCBzdWJtaXR0ZXIpIHtcbiAgaWYgKHR5cGVvZiBmb3JtLnJlcXVlc3RTdWJtaXQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiBmb3JtLnJlcXVlc3RTdWJtaXQoc3VibWl0dGVyKTtcbiAgfVxuICBpZiAoc3VibWl0dGVyKSB7XG4gICAgc3VibWl0dGVyLmNsaWNrKCk7XG4gIH0gZWxzZSB7XG4gICAgc3VibWl0dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgIHN1Ym1pdHRlci50eXBlID0gXCJzdWJtaXRcIjtcbiAgICBzdWJtaXR0ZXIuaGlkZGVuID0gdHJ1ZTtcbiAgICBmb3JtLmFwcGVuZENoaWxkKHN1Ym1pdHRlcik7XG4gICAgc3VibWl0dGVyLmNsaWNrKCk7XG4gICAgZm9ybS5yZW1vdmVDaGlsZChzdWJtaXR0ZXIpO1xuICB9XG59XG5cbmV4cG9ydCB7IHJlcXVlc3RTdWJtaXQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlcXVlc3Qtc3VibWl0Lm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/request-submit.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/url.mjs":
/*!**************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/url.mjs ***!
  \**************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateURL: () => (/* binding */ generateURL)\n/* harmony export */ });\nconst PLACEHOLDER_BASE_URL = \"https://localhost:9999\";\nconst ABSOLUTE_URL_REGEX = /^[a-zA-Z][a-zA-Z\\d+\\-.]*?:/;\nfunction generateURL(url, params, hash) {\n  const isAbsolute = ABSOLUTE_URL_REGEX.test(url);\n  const urlObject = new URL(url, isAbsolute ? void 0 : PLACEHOLDER_BASE_URL);\n  if (params !== void 0) {\n    for (const [param, value] of Object.entries(params)) {\n      if (value) {\n        urlObject.searchParams.set(param, String(value));\n      }\n    }\n  }\n  if (!urlObject.hash && hash !== void 0) {\n    urlObject.hash = `#${hash}`;\n  }\n  return isAbsolute ? urlObject.href : urlObject.href.replace(PLACEHOLDER_BASE_URL, \"\");\n}\n\n\n//# sourceMappingURL=url.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91cmwubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixLQUFLO0FBQzlCO0FBQ0E7QUFDQTs7QUFFdUI7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL3VybC5tanM/Njg5NSJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBQTEFDRUhPTERFUl9CQVNFX1VSTCA9IFwiaHR0cHM6Ly9sb2NhbGhvc3Q6OTk5OVwiO1xuY29uc3QgQUJTT0xVVEVfVVJMX1JFR0VYID0gL15bYS16QS1aXVthLXpBLVpcXGQrXFwtLl0qPzovO1xuZnVuY3Rpb24gZ2VuZXJhdGVVUkwodXJsLCBwYXJhbXMsIGhhc2gpIHtcbiAgY29uc3QgaXNBYnNvbHV0ZSA9IEFCU09MVVRFX1VSTF9SRUdFWC50ZXN0KHVybCk7XG4gIGNvbnN0IHVybE9iamVjdCA9IG5ldyBVUkwodXJsLCBpc0Fic29sdXRlID8gdm9pZCAwIDogUExBQ0VIT0xERVJfQkFTRV9VUkwpO1xuICBpZiAocGFyYW1zICE9PSB2b2lkIDApIHtcbiAgICBmb3IgKGNvbnN0IFtwYXJhbSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHBhcmFtcykpIHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB1cmxPYmplY3Quc2VhcmNoUGFyYW1zLnNldChwYXJhbSwgU3RyaW5nKHZhbHVlKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmICghdXJsT2JqZWN0Lmhhc2ggJiYgaGFzaCAhPT0gdm9pZCAwKSB7XG4gICAgdXJsT2JqZWN0Lmhhc2ggPSBgIyR7aGFzaH1gO1xuICB9XG4gIHJldHVybiBpc0Fic29sdXRlID8gdXJsT2JqZWN0LmhyZWYgOiB1cmxPYmplY3QuaHJlZi5yZXBsYWNlKFBMQUNFSE9MREVSX0JBU0VfVVJMLCBcIlwiKTtcbn1cblxuZXhwb3J0IHsgZ2VuZXJhdGVVUkwgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVybC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/url.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-controllable-state.mjs":
/*!*********************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-controllable-state.mjs ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useControllableState: () => (/* binding */ useControllableState)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\n\nfunction useControllableState(value, onChange, defaultValue) {\n  const [uncontrolledValue, setUncontrolledValue] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultValue);\n  const isControlled = value !== void 0;\n  const wasControlled = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(isControlled);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if ( true && wasControlled.current !== isControlled) {\n      _liveblocks_core__WEBPACK_IMPORTED_MODULE_1__.console.warn(\n        `A component is changing from ${wasControlled ? \"controlled\" : \"uncontrolled\"} to ${isControlled ? \"controlled\" : \"uncontrolled\"}.`\n      );\n    }\n    wasControlled.current = isControlled;\n  }, [isControlled]);\n  const currentValue = isControlled ? value : uncontrolledValue;\n  const setValue = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (value2) => {\n      if (isControlled) {\n        return onChange?.(value2);\n      } else {\n        setUncontrolledValue(value2);\n        return onChange?.(value2);\n      }\n    },\n    [isControlled, onChange]\n  );\n  return [currentValue, setValue];\n}\n\n\n//# sourceMappingURL=use-controllable-state.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtY29udHJvbGxhYmxlLXN0YXRlLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBMkM7QUFDc0I7O0FBRWpFO0FBQ0Esb0RBQW9ELCtDQUFRO0FBQzVEO0FBQ0Esd0JBQXdCLDZDQUFNO0FBQzlCLEVBQUUsZ0RBQVM7QUFDWCxRQUFRLEtBQXFDO0FBQzdDLE1BQU0scURBQU87QUFDYix3Q0FBd0MsK0NBQStDLEtBQUssNkNBQTZDO0FBQ3pJO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLG1CQUFtQixrREFBVztBQUM5QjtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVnQztBQUNoQyIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLWNvbnRyb2xsYWJsZS1zdGF0ZS5tanM/ZDVjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25zb2xlIH0gZnJvbSAnQGxpdmVibG9ja3MvY29yZSc7XG5pbXBvcnQgeyB1c2VTdGF0ZSwgdXNlUmVmLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG5mdW5jdGlvbiB1c2VDb250cm9sbGFibGVTdGF0ZSh2YWx1ZSwgb25DaGFuZ2UsIGRlZmF1bHRWYWx1ZSkge1xuICBjb25zdCBbdW5jb250cm9sbGVkVmFsdWUsIHNldFVuY29udHJvbGxlZFZhbHVlXSA9IHVzZVN0YXRlKGRlZmF1bHRWYWx1ZSk7XG4gIGNvbnN0IGlzQ29udHJvbGxlZCA9IHZhbHVlICE9PSB2b2lkIDA7XG4gIGNvbnN0IHdhc0NvbnRyb2xsZWQgPSB1c2VSZWYoaXNDb250cm9sbGVkKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiICYmIHdhc0NvbnRyb2xsZWQuY3VycmVudCAhPT0gaXNDb250cm9sbGVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBBIGNvbXBvbmVudCBpcyBjaGFuZ2luZyBmcm9tICR7d2FzQ29udHJvbGxlZCA/IFwiY29udHJvbGxlZFwiIDogXCJ1bmNvbnRyb2xsZWRcIn0gdG8gJHtpc0NvbnRyb2xsZWQgPyBcImNvbnRyb2xsZWRcIiA6IFwidW5jb250cm9sbGVkXCJ9LmBcbiAgICAgICk7XG4gICAgfVxuICAgIHdhc0NvbnRyb2xsZWQuY3VycmVudCA9IGlzQ29udHJvbGxlZDtcbiAgfSwgW2lzQ29udHJvbGxlZF0pO1xuICBjb25zdCBjdXJyZW50VmFsdWUgPSBpc0NvbnRyb2xsZWQgPyB2YWx1ZSA6IHVuY29udHJvbGxlZFZhbHVlO1xuICBjb25zdCBzZXRWYWx1ZSA9IHVzZUNhbGxiYWNrKFxuICAgICh2YWx1ZTIpID0+IHtcbiAgICAgIGlmIChpc0NvbnRyb2xsZWQpIHtcbiAgICAgICAgcmV0dXJuIG9uQ2hhbmdlPy4odmFsdWUyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldFVuY29udHJvbGxlZFZhbHVlKHZhbHVlMik7XG4gICAgICAgIHJldHVybiBvbkNoYW5nZT8uKHZhbHVlMik7XG4gICAgICB9XG4gICAgfSxcbiAgICBbaXNDb250cm9sbGVkLCBvbkNoYW5nZV1cbiAgKTtcbiAgcmV0dXJuIFtjdXJyZW50VmFsdWUsIHNldFZhbHVlXTtcbn1cblxuZXhwb3J0IHsgdXNlQ29udHJvbGxhYmxlU3RhdGUgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZS1jb250cm9sbGFibGUtc3RhdGUubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-controllable-state.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-id.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-id.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useId: () => (/* binding */ useId)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./use-layout-effect.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs\");\n\n\n\nlet isHydrated = false;\nlet id = 0;\nfunction getId() {\n  return ++id;\n}\nconst useReactId = react__WEBPACK_IMPORTED_MODULE_0__[\"useId\".toString()];\nfunction useIncrementalId() {\n  const [id2, setId] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(isHydrated ? getId : null);\n  (0,_use_layout_effect_mjs__WEBPACK_IMPORTED_MODULE_1__.useLayoutEffect)(() => {\n    if (id2 === null) {\n      setId(getId());\n    }\n  }, [id2]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if (!isHydrated) {\n      isHydrated = true;\n    }\n  }, []);\n  return String(id2) ?? void 0;\n}\nconst useId = useReactId ?? useIncrementalId;\n\n\n//# sourceMappingURL=use-id.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtaWQubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE0RDtBQUNGOztBQUUxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtDQUFjO0FBQ2pDO0FBQ0EsdUJBQXVCLCtDQUFRO0FBQy9CLEVBQUUsdUVBQWU7QUFDakI7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVpQjtBQUNqQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLWlkLm1qcz84ZWY1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdF9fZGVmYXVsdCwgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlTGF5b3V0RWZmZWN0IH0gZnJvbSAnLi91c2UtbGF5b3V0LWVmZmVjdC5tanMnO1xuXG5sZXQgaXNIeWRyYXRlZCA9IGZhbHNlO1xubGV0IGlkID0gMDtcbmZ1bmN0aW9uIGdldElkKCkge1xuICByZXR1cm4gKytpZDtcbn1cbmNvbnN0IHVzZVJlYWN0SWQgPSBSZWFjdF9fZGVmYXVsdFtcInVzZUlkXCIudG9TdHJpbmcoKV07XG5mdW5jdGlvbiB1c2VJbmNyZW1lbnRhbElkKCkge1xuICBjb25zdCBbaWQyLCBzZXRJZF0gPSB1c2VTdGF0ZShpc0h5ZHJhdGVkID8gZ2V0SWQgOiBudWxsKTtcbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBpZiAoaWQyID09PSBudWxsKSB7XG4gICAgICBzZXRJZChnZXRJZCgpKTtcbiAgICB9XG4gIH0sIFtpZDJdKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIWlzSHlkcmF0ZWQpIHtcbiAgICAgIGlzSHlkcmF0ZWQgPSB0cnVlO1xuICAgIH1cbiAgfSwgW10pO1xuICByZXR1cm4gU3RyaW5nKGlkMikgPz8gdm9pZCAwO1xufVxuY29uc3QgdXNlSWQgPSB1c2VSZWFjdElkID8/IHVzZUluY3JlbWVudGFsSWQ7XG5cbmV4cG9ydCB7IHVzZUlkIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD11c2UtaWQubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-id.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-index.mjs":
/*!********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-index.mjs ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useIndex: () => (/* binding */ useIndex)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _clamp_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./clamp.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/clamp.mjs\");\n/* harmony import */ var _wrap_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./wrap.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/wrap.mjs\");\n\n\n\n\nconst defaultOptions = {\n  wrap: true\n};\nfunction useIndex(initial, length, options) {\n  const { wrap: shouldWrap } = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {\n    return {\n      ...defaultOptions,\n      ...options\n    };\n  }, [options]);\n  const transform = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => shouldWrap ? _wrap_mjs__WEBPACK_IMPORTED_MODULE_1__.wrap : _clamp_mjs__WEBPACK_IMPORTED_MODULE_2__.clamp, [shouldWrap]);\n  const [index, setIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initial);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    setIndex((index2) => (0,_clamp_mjs__WEBPACK_IMPORTED_MODULE_2__.clamp)(index2, 0, Math.max(length - 1, 0)));\n  }, [length]);\n  const previousIndex = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    setIndex((index2) => transform(index2 - 1, 0, Math.max(length, 0)));\n  }, [length, transform]);\n  const nextIndex = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    setIndex((index2) => transform(index2 + 1, 0, Math.max(length, 0)));\n  }, [length, transform]);\n  return [index, previousIndex, nextIndex, setIndex];\n}\n\n\n//# sourceMappingURL=use-index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBa0U7QUFDOUI7QUFDRjs7QUFFbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLG1CQUFtQixFQUFFLDhDQUFPO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILG9CQUFvQiw4Q0FBTyxvQkFBb0IsMkNBQUksR0FBRyw2Q0FBSztBQUMzRCw0QkFBNEIsK0NBQVE7QUFDcEMsRUFBRSxnREFBUztBQUNYLHlCQUF5QixpREFBSztBQUM5QixHQUFHO0FBQ0gsd0JBQXdCLGtEQUFXO0FBQ25DO0FBQ0EsR0FBRztBQUNILG9CQUFvQixrREFBVztBQUMvQjtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVvQjtBQUNwQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLWluZGV4Lm1qcz8yOGNmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZU1lbW8sIHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgY2xhbXAgfSBmcm9tICcuL2NsYW1wLm1qcyc7XG5pbXBvcnQgeyB3cmFwIH0gZnJvbSAnLi93cmFwLm1qcyc7XG5cbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICB3cmFwOiB0cnVlXG59O1xuZnVuY3Rpb24gdXNlSW5kZXgoaW5pdGlhbCwgbGVuZ3RoLCBvcHRpb25zKSB7XG4gIGNvbnN0IHsgd3JhcDogc2hvdWxkV3JhcCB9ID0gdXNlTWVtbygoKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRlZmF1bHRPcHRpb25zLFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH07XG4gIH0sIFtvcHRpb25zXSk7XG4gIGNvbnN0IHRyYW5zZm9ybSA9IHVzZU1lbW8oKCkgPT4gc2hvdWxkV3JhcCA/IHdyYXAgOiBjbGFtcCwgW3Nob3VsZFdyYXBdKTtcbiAgY29uc3QgW2luZGV4LCBzZXRJbmRleF0gPSB1c2VTdGF0ZShpbml0aWFsKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBzZXRJbmRleCgoaW5kZXgyKSA9PiBjbGFtcChpbmRleDIsIDAsIE1hdGgubWF4KGxlbmd0aCAtIDEsIDApKSk7XG4gIH0sIFtsZW5ndGhdKTtcbiAgY29uc3QgcHJldmlvdXNJbmRleCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRJbmRleCgoaW5kZXgyKSA9PiB0cmFuc2Zvcm0oaW5kZXgyIC0gMSwgMCwgTWF0aC5tYXgobGVuZ3RoLCAwKSkpO1xuICB9LCBbbGVuZ3RoLCB0cmFuc2Zvcm1dKTtcbiAgY29uc3QgbmV4dEluZGV4ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldEluZGV4KChpbmRleDIpID0+IHRyYW5zZm9ybShpbmRleDIgKyAxLCAwLCBNYXRoLm1heChsZW5ndGgsIDApKSk7XG4gIH0sIFtsZW5ndGgsIHRyYW5zZm9ybV0pO1xuICByZXR1cm4gW2luZGV4LCBwcmV2aW91c0luZGV4LCBuZXh0SW5kZXgsIHNldEluZGV4XTtcbn1cblxuZXhwb3J0IHsgdXNlSW5kZXggfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZS1pbmRleC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-initial.mjs":
/*!**********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-initial.mjs ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useInitial: () => (/* binding */ useInitial)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nfunction useInitial(value) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(value instanceof Function ? value() : value).current;\n}\n\n\n//# sourceMappingURL=use-initial.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtaW5pdGlhbC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBK0I7O0FBRS9CO0FBQ0EsU0FBUyw2Q0FBTTtBQUNmOztBQUVzQjtBQUN0QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLWluaXRpYWwubWpzPzE2OGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xuXG5mdW5jdGlvbiB1c2VJbml0aWFsKHZhbHVlKSB7XG4gIHJldHVybiB1c2VSZWYodmFsdWUgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IHZhbHVlKCkgOiB2YWx1ZSkuY3VycmVudDtcbn1cblxuZXhwb3J0IHsgdXNlSW5pdGlhbCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXNlLWluaXRpYWwubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-initial.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-interval.mjs":
/*!***********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-interval.mjs ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useInterval: () => (/* binding */ useInterval)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nfunction useInterval(callback, delay) {\n  const latestCallback = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(callback);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    latestCallback.current = callback;\n  }, [callback]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if (!delay && delay !== 0) {\n      return;\n    }\n    const id = setInterval(() => {\n      if (latestCallback.current() === false) {\n        clearInterval(id);\n      }\n    }, delay);\n    return () => clearInterval(id);\n  }, [delay]);\n}\n\n\n//# sourceMappingURL=use-interval.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtaW50ZXJ2YWwubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTBDOztBQUUxQztBQUNBLHlCQUF5Qiw2Q0FBTTtBQUMvQixFQUFFLGdEQUFTO0FBQ1g7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIOztBQUV1QjtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLWludGVydmFsLm1qcz8zZmY2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVJlZiwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuXG5mdW5jdGlvbiB1c2VJbnRlcnZhbChjYWxsYmFjaywgZGVsYXkpIHtcbiAgY29uc3QgbGF0ZXN0Q2FsbGJhY2sgPSB1c2VSZWYoY2FsbGJhY2spO1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGxhdGVzdENhbGxiYWNrLmN1cnJlbnQgPSBjYWxsYmFjaztcbiAgfSwgW2NhbGxiYWNrXSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFkZWxheSAmJiBkZWxheSAhPT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGlmIChsYXRlc3RDYWxsYmFjay5jdXJyZW50KCkgPT09IGZhbHNlKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaWQpO1xuICAgICAgfVxuICAgIH0sIGRlbGF5KTtcbiAgICByZXR1cm4gKCkgPT4gY2xlYXJJbnRlcnZhbChpZCk7XG4gIH0sIFtkZWxheV0pO1xufVxuXG5leHBvcnQgeyB1c2VJbnRlcnZhbCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXNlLWludGVydmFsLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-interval.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-latest.mjs":
/*!*********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-latest.mjs ***!
  \*********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useLatest: () => (/* binding */ useLatest)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nfunction useLatest(value) {\n  const ref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(value);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    ref.current = value;\n  }, [value]);\n  return ref;\n}\n\n\n//# sourceMappingURL=use-latest.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtbGF0ZXN0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUEwQzs7QUFFMUM7QUFDQSxjQUFjLDZDQUFNO0FBQ3BCLEVBQUUsZ0RBQVM7QUFDWDtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVxQjtBQUNyQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLWxhdGVzdC5tanM/MzU3NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VSZWYsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcblxuZnVuY3Rpb24gdXNlTGF0ZXN0KHZhbHVlKSB7XG4gIGNvbnN0IHJlZiA9IHVzZVJlZih2YWx1ZSk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmVmLmN1cnJlbnQgPSB2YWx1ZTtcbiAgfSwgW3ZhbHVlXSk7XG4gIHJldHVybiByZWY7XG59XG5cbmV4cG9ydCB7IHVzZUxhdGVzdCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXNlLWxhdGVzdC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-latest.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs":
/*!****************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs ***!
  \****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useLayoutEffect: () => (/* binding */ useLayoutEffect)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nconst useLayoutEffect = typeof window !== \"undefined\" ? react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect : react__WEBPACK_IMPORTED_MODULE_0__.useEffect;\n\n\n//# sourceMappingURL=use-layout-effect.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtbGF5b3V0LWVmZmVjdC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBd0U7O0FBRXhFLHdEQUF3RCxrREFBaUIsR0FBRyw0Q0FBUzs7QUFFMUQ7QUFDM0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL3VzZS1sYXlvdXQtZWZmZWN0Lm1qcz8xMGJjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUxheW91dEVmZmVjdCBhcyB1c2VMYXlvdXRFZmZlY3QkMSwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuXG5jb25zdCB1c2VMYXlvdXRFZmZlY3QgPSB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gdXNlTGF5b3V0RWZmZWN0JDEgOiB1c2VFZmZlY3Q7XG5cbmV4cG9ydCB7IHVzZUxheW91dEVmZmVjdCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXNlLWxheW91dC1lZmZlY3QubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-layout-effect.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-refs.mjs":
/*!*******************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-refs.mjs ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useRefs: () => (/* binding */ useRefs)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nfunction applyRef(ref, value) {\n  if (value) {\n    if (typeof ref === \"function\") {\n      ref(value);\n    } else if (ref && \"current\" in ref) {\n      ref.current = value;\n    }\n  }\n}\nfunction mergeRefs(value, ...refs) {\n  for (const ref of refs) {\n    applyRef(ref, value);\n  }\n}\nfunction useRefs(...refs) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((value) => mergeRefs(value, ...refs), [refs]);\n}\n\n\n//# sourceMappingURL=use-refs.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtcmVmcy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0M7O0FBRXBDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxrREFBVztBQUNwQjs7QUFFbUI7QUFDbkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9yZWFjdC11aS9kaXN0L3V0aWxzL3VzZS1yZWZzLm1qcz85MDBkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG5mdW5jdGlvbiBhcHBseVJlZihyZWYsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgcmVmID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJlZih2YWx1ZSk7XG4gICAgfSBlbHNlIGlmIChyZWYgJiYgXCJjdXJyZW50XCIgaW4gcmVmKSB7XG4gICAgICByZWYuY3VycmVudCA9IHZhbHVlO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gbWVyZ2VSZWZzKHZhbHVlLCAuLi5yZWZzKSB7XG4gIGZvciAoY29uc3QgcmVmIG9mIHJlZnMpIHtcbiAgICBhcHBseVJlZihyZWYsIHZhbHVlKTtcbiAgfVxufVxuZnVuY3Rpb24gdXNlUmVmcyguLi5yZWZzKSB7XG4gIHJldHVybiB1c2VDYWxsYmFjaygodmFsdWUpID0+IG1lcmdlUmVmcyh2YWx1ZSwgLi4ucmVmcyksIFtyZWZzXSk7XG59XG5cbmV4cG9ydCB7IHVzZVJlZnMgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZS1yZWZzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-refs.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-rerender.mjs":
/*!***********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-rerender.mjs ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useRerender: () => (/* binding */ useRerender)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nfunction useRerender() {\n  const [key, update] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useReducer)(\n    (key2) => key2 + 1,\n    0\n  );\n  return [update, key];\n}\n\n\n//# sourceMappingURL=use-rerender.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtcmVyZW5kZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQW1DOztBQUVuQztBQUNBLHdCQUF3QixpREFBVTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV1QjtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLXJlcmVuZGVyLm1qcz9lYmY1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVJlZHVjZXIgfSBmcm9tICdyZWFjdCc7XG5cbmZ1bmN0aW9uIHVzZVJlcmVuZGVyKCkge1xuICBjb25zdCBba2V5LCB1cGRhdGVdID0gdXNlUmVkdWNlcihcbiAgICAoa2V5MikgPT4ga2V5MiArIDEsXG4gICAgMFxuICApO1xuICByZXR1cm4gW3VwZGF0ZSwga2V5XTtcbn1cblxuZXhwb3J0IHsgdXNlUmVyZW5kZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZS1yZXJlbmRlci5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-rerender.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-transition.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-transition.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useTransition: () => (/* binding */ useTransition)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\nconst useReactTransition = react__WEBPACK_IMPORTED_MODULE_0__[\"useTransition\".toString()];\nfunction useTransitionFallback() {\n  const startTransition = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (callback) => callback(),\n    []\n  );\n  return [false, startTransition];\n}\nconst useTransition = useReactTransition ?? useTransitionFallback;\n\n\n//# sourceMappingURL=use-transition.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtdHJhbnNpdGlvbi5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7O0FBRXBELDJCQUEyQixrQ0FBYztBQUN6QztBQUNBLDBCQUEwQixrREFBVztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXlCO0FBQ3pCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtdHJhbnNpdGlvbi5tanM/ZjY0ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3RfX2RlZmF1bHQsIHsgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5cbmNvbnN0IHVzZVJlYWN0VHJhbnNpdGlvbiA9IFJlYWN0X19kZWZhdWx0W1widXNlVHJhbnNpdGlvblwiLnRvU3RyaW5nKCldO1xuZnVuY3Rpb24gdXNlVHJhbnNpdGlvbkZhbGxiYWNrKCkge1xuICBjb25zdCBzdGFydFRyYW5zaXRpb24gPSB1c2VDYWxsYmFjayhcbiAgICAoY2FsbGJhY2spID0+IGNhbGxiYWNrKCksXG4gICAgW11cbiAgKTtcbiAgcmV0dXJuIFtmYWxzZSwgc3RhcnRUcmFuc2l0aW9uXTtcbn1cbmNvbnN0IHVzZVRyYW5zaXRpb24gPSB1c2VSZWFjdFRyYW5zaXRpb24gPz8gdXNlVHJhbnNpdGlvbkZhbGxiYWNrO1xuXG5leHBvcnQgeyB1c2VUcmFuc2l0aW9uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD11c2UtdHJhbnNpdGlvbi5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-transition.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-visible.mjs":
/*!**********************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-visible.mjs ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useVisibleCallback: () => (/* binding */ useVisibleCallback)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _use_latest_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./use-latest.mjs */ \"(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-latest.mjs\");\n\n\n\nlet intersectionObserver;\nconst intersectionCallbacks = /* @__PURE__ */ new WeakMap();\nfunction observe(element, callback) {\n  if (!intersectionObserver) {\n    intersectionObserver = new IntersectionObserver((entries) => {\n      for (const entry of entries) {\n        const callback2 = intersectionCallbacks.get(entry.target);\n        callback2?.(entry);\n      }\n    });\n  }\n  intersectionCallbacks.set(element, callback);\n  intersectionObserver.observe(element);\n}\nfunction unobserve(element) {\n  intersectionCallbacks.delete(element);\n  intersectionObserver?.unobserve(element);\n}\nfunction useVisibleCallback(ref, callback, options) {\n  const enabled = options?.enabled ?? true;\n  const latestCallback = (0,_use_latest_mjs__WEBPACK_IMPORTED_MODULE_1__.useLatest)(callback);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    const element = ref.current;\n    if (!element) {\n      return;\n    }\n    if (enabled) {\n      observe(element, (entry) => {\n        if (entry.isIntersecting) {\n          latestCallback.current();\n        }\n      });\n    } else {\n      unobserve(element);\n    }\n    return () => {\n      unobserve(element);\n    };\n  }, [enabled]);\n}\n\n\n//# sourceMappingURL=use-visible.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2UtdmlzaWJsZS5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWtDO0FBQ1c7O0FBRTdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QiwwREFBUztBQUNsQyxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUU4QjtBQUM5QiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdmVkb2NzLy4vbm9kZV9tb2R1bGVzL0BsaXZlYmxvY2tzL3JlYWN0LXVpL2Rpc3QvdXRpbHMvdXNlLXZpc2libGUubWpzP2U5MDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlTGF0ZXN0IH0gZnJvbSAnLi91c2UtbGF0ZXN0Lm1qcyc7XG5cbmxldCBpbnRlcnNlY3Rpb25PYnNlcnZlcjtcbmNvbnN0IGludGVyc2VjdGlvbkNhbGxiYWNrcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpO1xuZnVuY3Rpb24gb2JzZXJ2ZShlbGVtZW50LCBjYWxsYmFjaykge1xuICBpZiAoIWludGVyc2VjdGlvbk9ic2VydmVyKSB7XG4gICAgaW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgICBjb25zdCBjYWxsYmFjazIgPSBpbnRlcnNlY3Rpb25DYWxsYmFja3MuZ2V0KGVudHJ5LnRhcmdldCk7XG4gICAgICAgIGNhbGxiYWNrMj8uKGVudHJ5KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBpbnRlcnNlY3Rpb25DYWxsYmFja3Muc2V0KGVsZW1lbnQsIGNhbGxiYWNrKTtcbiAgaW50ZXJzZWN0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50KTtcbn1cbmZ1bmN0aW9uIHVub2JzZXJ2ZShlbGVtZW50KSB7XG4gIGludGVyc2VjdGlvbkNhbGxiYWNrcy5kZWxldGUoZWxlbWVudCk7XG4gIGludGVyc2VjdGlvbk9ic2VydmVyPy51bm9ic2VydmUoZWxlbWVudCk7XG59XG5mdW5jdGlvbiB1c2VWaXNpYmxlQ2FsbGJhY2socmVmLCBjYWxsYmFjaywgb3B0aW9ucykge1xuICBjb25zdCBlbmFibGVkID0gb3B0aW9ucz8uZW5hYmxlZCA/PyB0cnVlO1xuICBjb25zdCBsYXRlc3RDYWxsYmFjayA9IHVzZUxhdGVzdChjYWxsYmFjayk7XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgZWxlbWVudCA9IHJlZi5jdXJyZW50O1xuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZW5hYmxlZCkge1xuICAgICAgb2JzZXJ2ZShlbGVtZW50LCAoZW50cnkpID0+IHtcbiAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgICAgbGF0ZXN0Q2FsbGJhY2suY3VycmVudCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdW5vYnNlcnZlKGVsZW1lbnQpO1xuICAgIH1cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdW5vYnNlcnZlKGVsZW1lbnQpO1xuICAgIH07XG4gIH0sIFtlbmFibGVkXSk7XG59XG5cbmV4cG9ydCB7IHVzZVZpc2libGVDYWxsYmFjayB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXNlLXZpc2libGUubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-visible.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-window-focus.mjs":
/*!***************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/use-window-focus.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useWindowFocus: () => (/* binding */ useWindowFocus)\n/* harmony export */ });\n/* harmony import */ var use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! use-sync-external-store/shim/index.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/index.js\");\n\n\nfunction subscribe(callback) {\n  window.addEventListener(\"blur\", callback);\n  window.addEventListener(\"focus\", callback);\n  return () => {\n    window.removeEventListener(\"blur\", callback);\n    window.removeEventListener(\"focus\", callback);\n  };\n}\nfunction getSnapshot() {\n  return document.hasFocus();\n}\nfunction getServerSnapshot() {\n  return true;\n}\nfunction useWindowFocus() {\n  return (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_0__.useSyncExternalStore)(subscribe, getSnapshot, getServerSnapshot);\n}\n\n\n//# sourceMappingURL=use-window-focus.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2Utd2luZG93LWZvY3VzLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUE2RTs7QUFFN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywyRkFBb0I7QUFDN0I7O0FBRTBCO0FBQzFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy91c2Utd2luZG93LWZvY3VzLm1qcz8yZDI1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN5bmNFeHRlcm5hbFN0b3JlIH0gZnJvbSAndXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS9pbmRleC5qcyc7XG5cbmZ1bmN0aW9uIHN1YnNjcmliZShjYWxsYmFjaykge1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgY2FsbGJhY2spO1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIGNhbGxiYWNrKTtcbiAgcmV0dXJuICgpID0+IHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgY2FsbGJhY2spO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgY2FsbGJhY2spO1xuICB9O1xufVxuZnVuY3Rpb24gZ2V0U25hcHNob3QoKSB7XG4gIHJldHVybiBkb2N1bWVudC5oYXNGb2N1cygpO1xufVxuZnVuY3Rpb24gZ2V0U2VydmVyU25hcHNob3QoKSB7XG4gIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gdXNlV2luZG93Rm9jdXMoKSB7XG4gIHJldHVybiB1c2VTeW5jRXh0ZXJuYWxTdG9yZShzdWJzY3JpYmUsIGdldFNuYXBzaG90LCBnZXRTZXJ2ZXJTbmFwc2hvdCk7XG59XG5cbmV4cG9ydCB7IHVzZVdpbmRvd0ZvY3VzIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD11c2Utd2luZG93LWZvY3VzLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/use-window-focus.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/visually-hidden.mjs":
/*!**************************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/visually-hidden.mjs ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   visuallyHidden: () => (/* binding */ visuallyHidden)\n/* harmony export */ });\nconst visuallyHidden = {\n  position: \"absolute\",\n  border: 0,\n  width: 1,\n  height: 1,\n  padding: 0,\n  margin: -1,\n  overflow: \"hidden\",\n  clip: \"rect(0, 0, 0, 0)\",\n  whiteSpace: \"nowrap\",\n  wordWrap: \"normal\"\n};\n\n\n//# sourceMappingURL=visually-hidden.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy92aXN1YWxseS1oaWRkZW4ubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTBCO0FBQzFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy92aXN1YWxseS1oaWRkZW4ubWpzPzQxNTIiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgdmlzdWFsbHlIaWRkZW4gPSB7XG4gIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gIGJvcmRlcjogMCxcbiAgd2lkdGg6IDEsXG4gIGhlaWdodDogMSxcbiAgcGFkZGluZzogMCxcbiAgbWFyZ2luOiAtMSxcbiAgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsXG4gIGNsaXA6IFwicmVjdCgwLCAwLCAwLCAwKVwiLFxuICB3aGl0ZVNwYWNlOiBcIm5vd3JhcFwiLFxuICB3b3JkV3JhcDogXCJub3JtYWxcIlxufTtcblxuZXhwb3J0IHsgdmlzdWFsbHlIaWRkZW4gfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXZpc3VhbGx5LWhpZGRlbi5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/visually-hidden.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/wrap.mjs":
/*!***************************************************************!*\
  !*** ./node_modules/@liveblocks/react-ui/dist/utils/wrap.mjs ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   wrap: () => (/* binding */ wrap)\n/* harmony export */ });\nfunction wrap(value, min, max) {\n  const range = max - min;\n  return range > 0 ? ((value - min) % range + range) % range + min : 0;\n}\n\n\n//# sourceMappingURL=wrap.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy93cmFwLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRWdCO0FBQ2hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QtdWkvZGlzdC91dGlscy93cmFwLm1qcz84ZGM1Il0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHdyYXAodmFsdWUsIG1pbiwgbWF4KSB7XG4gIGNvbnN0IHJhbmdlID0gbWF4IC0gbWluO1xuICByZXR1cm4gcmFuZ2UgPiAwID8gKCh2YWx1ZSAtIG1pbikgJSByYW5nZSArIHJhbmdlKSAlIHJhbmdlICsgbWluIDogMDtcbn1cblxuZXhwb3J0IHsgd3JhcCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d3JhcC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react-ui/dist/utils/wrap.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ClientContext: () => (/* binding */ ClientContext),\n/* harmony export */   ClientSideSuspense: () => (/* binding */ ClientSideSuspense),\n/* harmony export */   CreateThreadError: () => (/* binding */ CreateThreadError),\n/* harmony export */   LiveblocksProvider: () => (/* binding */ LiveblocksProvider),\n/* harmony export */   PKG_FORMAT: () => (/* binding */ PKG_FORMAT),\n/* harmony export */   PKG_NAME: () => (/* binding */ PKG_NAME),\n/* harmony export */   PKG_VERSION: () => (/* binding */ PKG_VERSION),\n/* harmony export */   RoomContext: () => (/* binding */ RoomContext),\n/* harmony export */   _RoomProvider: () => (/* binding */ _RoomProvider),\n/* harmony export */   _useAddReaction: () => (/* binding */ _useAddReaction),\n/* harmony export */   _useBroadcastEvent: () => (/* binding */ _useBroadcastEvent),\n/* harmony export */   _useCreateThread: () => (/* binding */ _useCreateThread),\n/* harmony export */   _useDeleteThread: () => (/* binding */ _useDeleteThread),\n/* harmony export */   _useEditThreadMetadata: () => (/* binding */ _useEditThreadMetadata),\n/* harmony export */   _useEventListener: () => (/* binding */ _useEventListener),\n/* harmony export */   _useInboxNotificationThread: () => (/* binding */ _useInboxNotificationThread),\n/* harmony export */   _useMutation: () => (/* binding */ _useMutation),\n/* harmony export */   _useMyPresence: () => (/* binding */ _useMyPresence),\n/* harmony export */   _useOther: () => (/* binding */ _useOther),\n/* harmony export */   _useOtherSuspense: () => (/* binding */ _useOtherSuspense),\n/* harmony export */   _useOthers: () => (/* binding */ _useOthers),\n/* harmony export */   _useOthersListener: () => (/* binding */ _useOthersListener),\n/* harmony export */   _useOthersMapped: () => (/* binding */ _useOthersMapped),\n/* harmony export */   _useOthersMappedSuspense: () => (/* binding */ _useOthersMappedSuspense),\n/* harmony export */   _useOthersSuspense: () => (/* binding */ _useOthersSuspense),\n/* harmony export */   _useRoom: () => (/* binding */ _useRoom),\n/* harmony export */   _useSelf: () => (/* binding */ _useSelf),\n/* harmony export */   _useSelfSuspense: () => (/* binding */ _useSelfSuspense),\n/* harmony export */   _useStorage: () => (/* binding */ _useStorage),\n/* harmony export */   _useStorageRoot: () => (/* binding */ _useStorageRoot),\n/* harmony export */   _useStorageSuspense: () => (/* binding */ _useStorageSuspense),\n/* harmony export */   _useThreads: () => (/* binding */ _useThreads),\n/* harmony export */   _useThreadsSuspense: () => (/* binding */ _useThreadsSuspense),\n/* harmony export */   _useUpdateMyPresence: () => (/* binding */ _useUpdateMyPresence),\n/* harmony export */   _useUser: () => (/* binding */ _useUser),\n/* harmony export */   _useUserSuspense: () => (/* binding */ _useUserSuspense),\n/* harmony export */   createLiveblocksContext: () => (/* binding */ createLiveblocksContext),\n/* harmony export */   createRoomContext: () => (/* binding */ createRoomContext),\n/* harmony export */   selectedThreads: () => (/* binding */ selectedThreads),\n/* harmony export */   useBatch: () => (/* binding */ useBatch),\n/* harmony export */   useCanRedo: () => (/* binding */ useCanRedo),\n/* harmony export */   useCanUndo: () => (/* binding */ useCanUndo),\n/* harmony export */   useClient: () => (/* binding */ useClient),\n/* harmony export */   useCommentsErrorListener: () => (/* binding */ useCommentsErrorListener),\n/* harmony export */   useCreateComment: () => (/* binding */ useCreateComment),\n/* harmony export */   useDeleteAllInboxNotifications: () => (/* binding */ useDeleteAllInboxNotifications),\n/* harmony export */   useDeleteComment: () => (/* binding */ useDeleteComment),\n/* harmony export */   useDeleteInboxNotification: () => (/* binding */ useDeleteInboxNotification),\n/* harmony export */   useEditComment: () => (/* binding */ useEditComment),\n/* harmony export */   useErrorListener: () => (/* binding */ useErrorListener),\n/* harmony export */   useHistory: () => (/* binding */ useHistory),\n/* harmony export */   useInboxNotifications: () => (/* binding */ useInboxNotifications),\n/* harmony export */   useInboxNotificationsSuspense: () => (/* binding */ useInboxNotificationsSuspense),\n/* harmony export */   useLostConnectionListener: () => (/* binding */ useLostConnectionListener),\n/* harmony export */   useMarkAllInboxNotificationsAsRead: () => (/* binding */ useMarkAllInboxNotificationsAsRead),\n/* harmony export */   useMarkInboxNotificationAsRead: () => (/* binding */ useMarkInboxNotificationAsRead),\n/* harmony export */   useMarkThreadAsRead: () => (/* binding */ useMarkThreadAsRead),\n/* harmony export */   useMarkThreadAsResolved: () => (/* binding */ useMarkThreadAsResolved),\n/* harmony export */   useMarkThreadAsUnresolved: () => (/* binding */ useMarkThreadAsUnresolved),\n/* harmony export */   useOthersConnectionIds: () => (/* binding */ useOthersConnectionIds),\n/* harmony export */   useOthersConnectionIdsSuspense: () => (/* binding */ useOthersConnectionIdsSuspense),\n/* harmony export */   useRedo: () => (/* binding */ useRedo),\n/* harmony export */   useRemoveReaction: () => (/* binding */ useRemoveReaction),\n/* harmony export */   useRoomInfo: () => (/* binding */ useRoomInfo),\n/* harmony export */   useRoomInfoSuspense: () => (/* binding */ useRoomInfoSuspense),\n/* harmony export */   useRoomNotificationSettings: () => (/* binding */ useRoomNotificationSettings),\n/* harmony export */   useStatus: () => (/* binding */ useStatus),\n/* harmony export */   useStorageStatus: () => (/* binding */ useStorageStatus),\n/* harmony export */   useStorageStatusSuspense: () => (/* binding */ useStorageStatusSuspense),\n/* harmony export */   useThreadSubscription: () => (/* binding */ useThreadSubscription),\n/* harmony export */   useUndo: () => (/* binding */ useUndo),\n/* harmony export */   useUnreadInboxNotificationsCount: () => (/* binding */ useUnreadInboxNotificationsCount),\n/* harmony export */   useUnreadInboxNotificationsCountSuspense: () => (/* binding */ useUnreadInboxNotificationsCountSuspense),\n/* harmony export */   useUpdateRoomNotificationSettings: () => (/* binding */ useUpdateRoomNotificationSettings)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! use-sync-external-store/shim/index.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/index.js\");\n/* harmony import */ var use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! use-sync-external-store/shim/with-selector.js */ \"(ssr)/./node_modules/use-sync-external-store/shim/with-selector.js\");\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/react\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/ClientSideSuspense.tsx\n\nfunction ClientSideSuspense(props) {\n  const [mounted, setMounted] = react__WEBPACK_IMPORTED_MODULE_0__.useState(false);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    setMounted(true);\n  }, []);\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Suspense, { fallback: props.fallback }, mounted ? typeof props.children === \"function\" ? props.children() : props.children : props.fallback);\n}\n\n// src/liveblocks.tsx\n\n\n\n\n\n// src/comments/lib/selected-inbox-notifications.ts\n\nfunction selectedInboxNotifications(state) {\n  const result = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.applyOptimisticUpdates)(state);\n  return Object.values(result.inboxNotifications).sort(\n    // Sort so that the most recent notifications are first\n    (a, b) => b.notifiedAt.getTime() - a.notifiedAt.getTime()\n  );\n}\n\n// src/lib/retry-error.ts\n\nvar MAX_ERROR_RETRY_COUNT = 5;\nvar ERROR_RETRY_INTERVAL = 5e3;\nfunction retryError(action, retryCount) {\n  if (retryCount >= MAX_ERROR_RETRY_COUNT) return;\n  const timeout = Math.pow(2, retryCount) * ERROR_RETRY_INTERVAL;\n  setTimeout(() => {\n    void action();\n  }, timeout);\n}\nasync function autoRetry(promiseFn, maxTries, backoff) {\n  const fallbackBackoff = backoff.length > 0 ? backoff[backoff.length - 1] : 0;\n  let attempt = 0;\n  while (true) {\n    attempt++;\n    const promise = promiseFn();\n    try {\n      return await promise;\n    } catch (err) {\n      if (attempt >= maxTries) {\n        throw new Error(`Failed after ${maxTries} attempts: ${String(err)}`);\n      }\n    }\n    const delay = backoff[attempt - 1] ?? fallbackBackoff;\n    await (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.wait)(delay);\n  }\n}\n\n// src/lib/use-initial.ts\n\n\n// src/lib/use-latest.ts\n\nfunction useLatest(value) {\n  const ref = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(value);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    ref.current = value;\n  }, [value]);\n  return ref;\n}\n\n// src/lib/use-initial.ts\nvar noop = (state) => state;\nfunction useInitial(value) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useReducer)(noop, value)[0];\n}\nfunction useInitialUnlessFunction(latestValue) {\n  const frozenValue = useInitial(latestValue);\n  if (typeof frozenValue === \"function\") {\n    const ref = useLatest(latestValue);\n    return (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((...args) => ref.current(...args), [\n      ref\n    ]);\n  } else {\n    return frozenValue;\n  }\n}\n\n// src/lib/use-polyfill.ts\nvar use = (\n  // React.use ||\n  (promise) => {\n    if (promise.status === \"pending\") {\n      throw promise;\n    } else if (promise.status === \"fulfilled\") {\n      return promise.value;\n    } else if (promise.status === \"rejected\") {\n      throw promise.reason;\n    } else {\n      promise.status = \"pending\";\n      promise.then(\n        (v) => {\n          promise.status = \"fulfilled\";\n          promise.value = v;\n        },\n        (e) => {\n          promise.status = \"rejected\";\n          promise.reason = e;\n        }\n      );\n      throw promise;\n    }\n  }\n);\n\n// src/liveblocks.tsx\nvar ClientContext = (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nfunction missingUserError(userId) {\n  return new Error(`resolveUsers didn't return anything for user '${userId}'`);\n}\nfunction missingRoomInfoError(roomId) {\n  return new Error(\n    `resolveRoomsInfo didn't return anything for room '${roomId}'`\n  );\n}\nvar _extras = /* @__PURE__ */ new WeakMap();\nvar _bundles = /* @__PURE__ */ new WeakMap();\nvar POLLING_INTERVAL = 60 * 1e3;\nvar INBOX_NOTIFICATIONS_QUERY = \"INBOX_NOTIFICATIONS\";\nfunction selectorFor_useInboxNotifications(state) {\n  const query = state.queries[INBOX_NOTIFICATIONS_QUERY];\n  if (query === void 0 || query.isLoading) {\n    return {\n      isLoading: true\n    };\n  }\n  if (query.error !== void 0) {\n    return {\n      error: query.error,\n      isLoading: false\n    };\n  }\n  return {\n    inboxNotifications: selectedInboxNotifications(state),\n    isLoading: false\n  };\n}\nfunction selectUnreadInboxNotificationsCount(state) {\n  let count = 0;\n  for (const notification of selectedInboxNotifications(state)) {\n    if (notification.readAt === null || notification.readAt < notification.notifiedAt) {\n      count++;\n    }\n  }\n  return count;\n}\nfunction selectorFor_useUnreadInboxNotificationsCount(state) {\n  const query = state.queries[INBOX_NOTIFICATIONS_QUERY];\n  if (query === void 0 || query.isLoading) {\n    return {\n      isLoading: true\n    };\n  }\n  if (query.error !== void 0) {\n    return {\n      error: query.error,\n      isLoading: false\n    };\n  }\n  return {\n    isLoading: false,\n    count: selectUnreadInboxNotificationsCount(state)\n  };\n}\nfunction selectorFor_useUser(state, userId) {\n  if (state === void 0 || state?.isLoading) {\n    return state ?? { isLoading: true };\n  }\n  if (state.error) {\n    return state;\n  }\n  if (!state.data) {\n    return {\n      isLoading: false,\n      error: missingUserError(userId)\n    };\n  }\n  return {\n    isLoading: false,\n    user: state.data\n  };\n}\nfunction selectorFor_useRoomInfo(state, roomId) {\n  if (state === void 0 || state?.isLoading) {\n    return state ?? { isLoading: true };\n  }\n  if (state.error) {\n    return state;\n  }\n  if (!state.data) {\n    return {\n      isLoading: false,\n      error: missingRoomInfoError(roomId)\n    };\n  }\n  return {\n    isLoading: false,\n    info: state.data\n  };\n}\nfunction getOrCreateContextBundle(client) {\n  let bundle = _bundles.get(client);\n  if (!bundle) {\n    bundle = makeLiveblocksContextBundle(client);\n    _bundles.set(client, bundle);\n  }\n  return bundle;\n}\nfunction getExtrasForClient(client) {\n  let extras = _extras.get(client);\n  if (!extras) {\n    extras = makeExtrasForClient(client);\n    _extras.set(client, extras);\n  }\n  return extras;\n}\nfunction makeExtrasForClient(client) {\n  const internals = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal];\n  const store = internals.cacheStore;\n  let lastRequestedAt;\n  async function fetchInboxNotifications() {\n    if (lastRequestedAt === void 0) {\n      const result = await client.getInboxNotifications();\n      store.updateThreadsAndNotifications(\n        result.threads,\n        result.inboxNotifications,\n        [],\n        [],\n        INBOX_NOTIFICATIONS_QUERY\n      );\n      lastRequestedAt = result.requestedAt;\n    } else {\n      const result = await client.getInboxNotificationsSince({\n        since: lastRequestedAt\n      });\n      store.updateThreadsAndNotifications(\n        result.threads.updated,\n        result.inboxNotifications.updated,\n        result.threads.deleted,\n        result.inboxNotifications.deleted,\n        INBOX_NOTIFICATIONS_QUERY\n      );\n      if (lastRequestedAt < result.requestedAt) {\n        lastRequestedAt = result.requestedAt;\n      }\n    }\n  }\n  let pollerSubscribers = 0;\n  const poller = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.makePoller)(async () => {\n    try {\n      await waitUntilInboxNotificationsLoaded();\n      await fetchInboxNotifications();\n    } catch (err) {\n      console.warn(`Polling new inbox notifications failed: ${String(err)}`);\n    }\n  });\n  const waitUntilInboxNotificationsLoaded = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.memoizeOnSuccess)(async () => {\n    store.setQueryState(INBOX_NOTIFICATIONS_QUERY, {\n      isLoading: true\n    });\n    try {\n      await autoRetry(\n        () => fetchInboxNotifications(),\n        5,\n        [5e3, 5e3, 1e4, 15e3]\n      );\n    } catch (err) {\n      store.setQueryState(INBOX_NOTIFICATIONS_QUERY, {\n        isLoading: false,\n        error: err\n      });\n      throw err;\n    }\n  });\n  function loadInboxNotifications() {\n    void waitUntilInboxNotificationsLoaded().catch(() => {\n    });\n  }\n  function useEnableInboxNotificationsPolling() {\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n      pollerSubscribers++;\n      poller.start(POLLING_INTERVAL);\n      return () => {\n        if (pollerSubscribers <= 0) {\n          console.warn(\n            `Internal unexpected behavior. Cannot decrease subscriber count for query \"${INBOX_NOTIFICATIONS_QUERY}\"`\n          );\n          return;\n        }\n        pollerSubscribers--;\n        if (pollerSubscribers <= 0) {\n          poller.stop();\n        }\n      };\n    }, []);\n  }\n  return {\n    store,\n    useEnableInboxNotificationsPolling,\n    waitUntilInboxNotificationsLoaded,\n    loadInboxNotifications\n  };\n}\nfunction makeLiveblocksContextBundle(client) {\n  const useInboxNotificationThread2 = (inboxNotificationId) => useInboxNotificationThread_withClient(client, inboxNotificationId);\n  const useMarkInboxNotificationAsRead2 = () => useMarkInboxNotificationAsRead_withClient(client);\n  const useMarkAllInboxNotificationsAsRead2 = () => useMarkAllInboxNotificationsAsRead_withClient(client);\n  const useDeleteInboxNotification2 = () => useDeleteInboxNotification_withClient(client);\n  const useDeleteAllInboxNotifications2 = () => useDeleteAllInboxNotifications_withClient(client);\n  function LiveblocksProvider2(props) {\n    useEnsureNoLiveblocksProvider();\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ClientContext.Provider, { value: client }, props.children);\n  }\n  const shared = createSharedContext(client);\n  const bundle = {\n    LiveblocksProvider: LiveblocksProvider2,\n    useInboxNotifications: () => useInboxNotifications_withClient(client),\n    useUnreadInboxNotificationsCount: () => useUnreadInboxNotificationsCount_withClient(client),\n    useMarkInboxNotificationAsRead: useMarkInboxNotificationAsRead2,\n    useMarkAllInboxNotificationsAsRead: useMarkAllInboxNotificationsAsRead2,\n    useDeleteInboxNotification: useDeleteInboxNotification2,\n    useDeleteAllInboxNotifications: useDeleteAllInboxNotifications2,\n    useInboxNotificationThread: useInboxNotificationThread2,\n    ...shared.classic,\n    suspense: {\n      LiveblocksProvider: LiveblocksProvider2,\n      useInboxNotifications: () => useInboxNotificationsSuspense_withClient(client),\n      useUnreadInboxNotificationsCount: () => useUnreadInboxNotificationsCountSuspense_withClient(client),\n      useMarkInboxNotificationAsRead: useMarkInboxNotificationAsRead2,\n      useMarkAllInboxNotificationsAsRead: useMarkAllInboxNotificationsAsRead2,\n      useDeleteInboxNotification: useDeleteInboxNotification2,\n      useDeleteAllInboxNotifications: useDeleteAllInboxNotifications2,\n      useInboxNotificationThread: useInboxNotificationThread2,\n      ...shared.suspense\n    }\n  };\n  return bundle;\n}\nfunction useInboxNotifications_withClient(client) {\n  const { loadInboxNotifications, store, useEnableInboxNotificationsPolling } = getExtrasForClient(client);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    loadInboxNotifications();\n  }, [loadInboxNotifications]);\n  useEnableInboxNotificationsPolling();\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selectorFor_useInboxNotifications,\n    _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.shallow\n  );\n}\nfunction useInboxNotificationsSuspense_withClient(client) {\n  const { waitUntilInboxNotificationsLoaded } = getExtrasForClient(client);\n  use(waitUntilInboxNotificationsLoaded());\n  const result = useInboxNotifications_withClient(client);\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!result.error, \"Did not expect error\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!result.isLoading, \"Did not expect loading\");\n  return result;\n}\nfunction useUnreadInboxNotificationsCount_withClient(client) {\n  const { store, loadInboxNotifications, useEnableInboxNotificationsPolling } = getExtrasForClient(client);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    loadInboxNotifications();\n  }, [loadInboxNotifications]);\n  useEnableInboxNotificationsPolling();\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selectorFor_useUnreadInboxNotificationsCount,\n    _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.shallow\n  );\n}\nfunction useUnreadInboxNotificationsCountSuspense_withClient(client) {\n  const { waitUntilInboxNotificationsLoaded } = getExtrasForClient(client);\n  use(waitUntilInboxNotificationsLoaded());\n  const result = useUnreadInboxNotificationsCount_withClient(client);\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!result.isLoading, \"Did not expect loading\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!result.error, \"Did not expect error\");\n  return result;\n}\nfunction useMarkInboxNotificationAsRead_withClient(client) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (inboxNotificationId) => {\n      const { store } = getExtrasForClient(client);\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const readAt = /* @__PURE__ */ new Date();\n      store.pushOptimisticUpdate({\n        type: \"mark-inbox-notification-as-read\",\n        id: optimisticUpdateId,\n        inboxNotificationId,\n        readAt\n      });\n      client.markInboxNotificationAsRead(inboxNotificationId).then(\n        () => {\n          store.set((state) => {\n            const existingNotification = state.inboxNotifications[inboxNotificationId];\n            if (existingNotification === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: state.optimisticUpdates.filter(\n                  (update) => update.id !== optimisticUpdateId\n                )\n              };\n            }\n            return {\n              ...state,\n              inboxNotifications: {\n                ...state.inboxNotifications,\n                [inboxNotificationId]: {\n                  ...existingNotification,\n                  readAt\n                }\n              },\n              optimisticUpdates: state.optimisticUpdates.filter(\n                (update) => update.id !== optimisticUpdateId\n              )\n            };\n          });\n        },\n        () => {\n          store.set((state) => ({\n            ...state,\n            optimisticUpdates: state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            )\n          }));\n        }\n      );\n    },\n    [client]\n  );\n}\nfunction useMarkAllInboxNotificationsAsRead_withClient(client) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    const { store } = getExtrasForClient(client);\n    const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n    const readAt = /* @__PURE__ */ new Date();\n    store.pushOptimisticUpdate({\n      type: \"mark-all-inbox-notifications-as-read\",\n      id: optimisticUpdateId,\n      readAt\n    });\n    client.markAllInboxNotificationsAsRead().then(\n      () => {\n        store.set((state) => ({\n          ...state,\n          inboxNotifications: Object.fromEntries(\n            Array.from(Object.entries(state.inboxNotifications)).map(\n              ([id, inboxNotification]) => [\n                id,\n                { ...inboxNotification, readAt }\n              ]\n            )\n          ),\n          optimisticUpdates: state.optimisticUpdates.filter(\n            (update) => update.id !== optimisticUpdateId\n          )\n        }));\n      },\n      () => {\n        store.set((state) => ({\n          ...state,\n          optimisticUpdates: state.optimisticUpdates.filter(\n            (update) => update.id !== optimisticUpdateId\n          )\n        }));\n      }\n    );\n  }, [client]);\n}\nfunction useDeleteInboxNotification_withClient(client) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (inboxNotificationId) => {\n      const { store } = getExtrasForClient(client);\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const deletedAt = /* @__PURE__ */ new Date();\n      store.pushOptimisticUpdate({\n        type: \"delete-inbox-notification\",\n        id: optimisticUpdateId,\n        inboxNotificationId,\n        deletedAt\n      });\n      client.deleteInboxNotification(inboxNotificationId).then(\n        () => {\n          store.set((state) => {\n            const existingNotification = state.inboxNotifications[inboxNotificationId];\n            if (existingNotification === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: state.optimisticUpdates.filter(\n                  (update) => update.id !== optimisticUpdateId\n                )\n              };\n            }\n            const { [inboxNotificationId]: _, ...inboxNotifications } = state.inboxNotifications;\n            return {\n              ...state,\n              inboxNotifications,\n              optimisticUpdates: state.optimisticUpdates.filter(\n                (update) => update.id !== optimisticUpdateId\n              )\n            };\n          });\n        },\n        () => {\n          store.set((state) => ({\n            ...state,\n            optimisticUpdates: state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            )\n          }));\n        }\n      );\n    },\n    [client]\n  );\n}\nfunction useDeleteAllInboxNotifications_withClient(client) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n    const { store } = getExtrasForClient(client);\n    const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n    const deletedAt = /* @__PURE__ */ new Date();\n    store.pushOptimisticUpdate({\n      type: \"delete-all-inbox-notifications\",\n      id: optimisticUpdateId,\n      deletedAt\n    });\n    client.deleteAllInboxNotifications().then(\n      () => {\n        store.set((state) => ({\n          ...state,\n          inboxNotifications: {},\n          optimisticUpdates: state.optimisticUpdates.filter(\n            (update) => update.id !== optimisticUpdateId\n          )\n        }));\n      },\n      () => {\n        store.set((state) => ({\n          ...state,\n          optimisticUpdates: state.optimisticUpdates.filter(\n            (update) => update.id !== optimisticUpdateId\n          )\n        }));\n      }\n    );\n  }, [client]);\n}\nfunction useInboxNotificationThread_withClient(client, inboxNotificationId) {\n  const { store } = getExtrasForClient(client);\n  const selector = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (state) => {\n      const inboxNotification = state.inboxNotifications[inboxNotificationId] ?? (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.raise)(`Inbox notification with ID \"${inboxNotificationId}\" not found`);\n      if (inboxNotification.kind !== \"thread\") {\n        (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.raise)(\n          `Inbox notification with ID \"${inboxNotificationId}\" is not of kind \"thread\"`\n        );\n      }\n      const thread = state.threads[inboxNotification.threadId] ?? (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.raise)(\n        `Thread with ID \"${inboxNotification.threadId}\" not found, this inbox notification might not be of kind \"thread\"`\n      );\n      return thread;\n    },\n    [inboxNotificationId]\n  );\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selector\n  );\n}\nfunction useUser_withClient(client, userId) {\n  const usersStore = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].usersStore;\n  const getUserState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    () => usersStore.getState(userId),\n    [usersStore, userId]\n  );\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    void usersStore.get(userId);\n  }, [usersStore, userId]);\n  const selector = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (state) => selectorFor_useUser(state, userId),\n    [userId]\n  );\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    usersStore.subscribe,\n    getUserState,\n    getUserState,\n    selector,\n    _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.shallow\n  );\n}\nfunction useUserSuspense_withClient(client, userId) {\n  const usersStore = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].usersStore;\n  const getUserState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    () => usersStore.getState(userId),\n    [usersStore, userId]\n  );\n  const userState = getUserState();\n  if (!userState || userState.isLoading) {\n    throw usersStore.get(userId);\n  }\n  if (userState.error) {\n    throw userState.error;\n  }\n  if (!userState.data) {\n    throw missingUserError(userId);\n  }\n  const state = (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStore)(\n    usersStore.subscribe,\n    getUserState,\n    getUserState\n  );\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(state !== void 0, \"Unexpected missing state\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!state.isLoading, \"Unexpected loading state\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!state.error, \"Unexpected error state\");\n  return {\n    isLoading: false,\n    user: state.data,\n    error: void 0\n  };\n}\nfunction useRoomInfo_withClient(client, roomId) {\n  const roomsInfoStore = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].roomsInfoStore;\n  const getRoomInfoState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    () => roomsInfoStore.getState(roomId),\n    [roomsInfoStore, roomId]\n  );\n  const selector = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    (state) => selectorFor_useRoomInfo(state, roomId),\n    [roomId]\n  );\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    void roomsInfoStore.get(roomId);\n  }, [roomsInfoStore, roomId]);\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    roomsInfoStore.subscribe,\n    getRoomInfoState,\n    getRoomInfoState,\n    selector,\n    _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.shallow\n  );\n}\nfunction useRoomInfoSuspense_withClient(client, roomId) {\n  const roomsInfoStore = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].roomsInfoStore;\n  const getRoomInfoState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(\n    () => roomsInfoStore.getState(roomId),\n    [roomsInfoStore, roomId]\n  );\n  const roomInfoState = getRoomInfoState();\n  if (!roomInfoState || roomInfoState.isLoading) {\n    throw roomsInfoStore.get(roomId);\n  }\n  if (roomInfoState.error) {\n    throw roomInfoState.error;\n  }\n  if (!roomInfoState.data) {\n    throw missingRoomInfoError(roomId);\n  }\n  const state = (0,use_sync_external_store_shim_index_js__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStore)(\n    roomsInfoStore.subscribe,\n    getRoomInfoState,\n    getRoomInfoState\n  );\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(state !== void 0, \"Unexpected missing state\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!state.isLoading, \"Unexpected loading state\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(!state.error, \"Unexpected error state\");\n  (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.assert)(state.data !== void 0, \"Unexpected missing room info data\");\n  return {\n    isLoading: false,\n    info: state.data,\n    error: void 0\n  };\n}\nfunction createSharedContext(client) {\n  const useClient2 = () => client;\n  return {\n    classic: {\n      useClient: useClient2,\n      useUser: (userId) => useUser_withClient(client, userId),\n      useRoomInfo: (roomId) => useRoomInfo_withClient(client, roomId)\n    },\n    suspense: {\n      useClient: useClient2,\n      useUser: (userId) => useUserSuspense_withClient(client, userId),\n      useRoomInfo: (roomId) => useRoomInfoSuspense_withClient(client, roomId)\n    }\n  };\n}\nfunction useEnsureNoLiveblocksProvider(options) {\n  const existing = useClientOrNull();\n  if (!options?.allowNesting && existing !== null) {\n    throw new Error(\n      \"You cannot nest multiple LiveblocksProvider instances in the same React tree.\"\n    );\n  }\n}\nfunction useClientOrNull() {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(ClientContext);\n}\nfunction useClient() {\n  return useClientOrNull() ?? (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.raise)(\"LiveblocksProvider is missing from the React tree.\");\n}\nfunction LiveblocksProviderWithClient(props) {\n  useEnsureNoLiveblocksProvider(props);\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(ClientContext.Provider, { value: props.client }, props.children);\n}\nfunction LiveblocksProvider(props) {\n  const { children, ...o } = props;\n  const options = {\n    publicApiKey: useInitial(o.publicApiKey),\n    throttle: useInitial(o.throttle),\n    lostConnectionTimeout: useInitial(o.lostConnectionTimeout),\n    backgroundKeepAliveTimeout: useInitial(o.backgroundKeepAliveTimeout),\n    polyfills: useInitial(o.polyfills),\n    unstable_fallbackToHTTP: useInitial(o.unstable_fallbackToHTTP),\n    unstable_streamData: useInitial(o.unstable_streamData),\n    authEndpoint: useInitialUnlessFunction(o.authEndpoint),\n    resolveMentionSuggestions: useInitialUnlessFunction(\n      o.resolveMentionSuggestions\n    ),\n    resolveUsers: useInitialUnlessFunction(o.resolveUsers),\n    resolveRoomsInfo: useInitialUnlessFunction(o.resolveRoomsInfo),\n    baseUrl: useInitial(\n      // @ts-expect-error - Hidden config options\n      o.baseUrl\n    ),\n    enableDebugLogging: useInitial(\n      // @ts-expect-error - Hidden config options\n      o.enableDebugLogging\n    )\n  };\n  const client = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.createClient)(options), []);\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(LiveblocksProviderWithClient, { client }, children);\n}\nfunction createLiveblocksContext(client) {\n  return getOrCreateContextBundle(client);\n}\nfunction useInboxNotifications() {\n  return useInboxNotifications_withClient(useClient());\n}\nfunction useInboxNotificationsSuspense() {\n  return useInboxNotificationsSuspense_withClient(useClient());\n}\nfunction useInboxNotificationThread(inboxNotificationId) {\n  return useInboxNotificationThread_withClient(\n    useClient(),\n    inboxNotificationId\n  );\n}\nfunction useMarkAllInboxNotificationsAsRead() {\n  return useMarkAllInboxNotificationsAsRead_withClient(useClient());\n}\nfunction useMarkInboxNotificationAsRead() {\n  return useMarkInboxNotificationAsRead_withClient(useClient());\n}\nfunction useDeleteAllInboxNotifications() {\n  return useDeleteAllInboxNotifications_withClient(useClient());\n}\nfunction useDeleteInboxNotification() {\n  return useDeleteInboxNotification_withClient(useClient());\n}\nfunction useUnreadInboxNotificationsCount() {\n  return useUnreadInboxNotificationsCount_withClient(useClient());\n}\nfunction useUnreadInboxNotificationsCountSuspense() {\n  return useUnreadInboxNotificationsCountSuspense_withClient(useClient());\n}\nfunction useUser(userId) {\n  const client = useClient();\n  return useUser_withClient(client, userId);\n}\nfunction useUserSuspense(userId) {\n  const client = useClient();\n  return useUserSuspense_withClient(client, userId);\n}\nfunction useRoomInfo(roomId) {\n  return useRoomInfo_withClient(useClient(), roomId);\n}\nfunction useRoomInfoSuspense(roomId) {\n  return useRoomInfoSuspense_withClient(useClient(), roomId);\n}\nvar _useInboxNotificationThread = useInboxNotificationThread;\nvar _useUser = useUser;\nvar _useUserSuspense = useUserSuspense;\n\n// src/comments/errors.ts\nvar CreateThreadError = class extends Error {\n  constructor(cause, context) {\n    super(\"Create thread failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"CreateThreadError\";\n  }\n};\nvar DeleteThreadError = class extends Error {\n  constructor(cause, context) {\n    super(\"Delete thread failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"DeleteThreadError\";\n  }\n};\nvar EditThreadMetadataError = class extends Error {\n  constructor(cause, context) {\n    super(\"Edit thread metadata failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"EditThreadMetadataError\";\n  }\n};\nvar MarkThreadAsResolvedError = class extends Error {\n  constructor(cause, context) {\n    super(\"Mark thread as resolved failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"MarkThreadAsResolvedError\";\n  }\n};\nvar MarkThreadAsUnresolvedError = class extends Error {\n  constructor(cause, context) {\n    super(\"Mark thread as unresolved failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"MarkThreadAsUnresolvedError\";\n  }\n};\nvar CreateCommentError = class extends Error {\n  constructor(cause, context) {\n    super(\"Create comment failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"CreateCommentError\";\n  }\n};\nvar EditCommentError = class extends Error {\n  constructor(cause, context) {\n    super(\"Edit comment failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"EditCommentError\";\n  }\n};\nvar DeleteCommentError = class extends Error {\n  constructor(cause, context) {\n    super(\"Delete comment failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"DeleteCommentError\";\n  }\n};\nvar AddReactionError = class extends Error {\n  constructor(cause, context) {\n    super(\"Add reaction failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"AddReactionError\";\n  }\n};\nvar RemoveReactionError = class extends Error {\n  constructor(cause, context) {\n    super(\"Remove reaction failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"RemoveReactionError\";\n  }\n};\nvar MarkInboxNotificationAsReadError = class extends Error {\n  constructor(cause, context) {\n    super(\"Mark inbox notification as read failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"MarkInboxNotificationAsReadError\";\n  }\n};\nvar UpdateNotificationSettingsError = class extends Error {\n  constructor(cause, context) {\n    super(\"Update notification settings failed.\");\n    this.cause = cause;\n    this.context = context;\n    this.name = \"UpdateNotificationSettingsError\";\n  }\n};\n\n// src/comments/lib/selected-threads.ts\n\nfunction selectedThreads(roomId, state, options) {\n  const result = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.applyOptimisticUpdates)(state);\n  const threads = Object.values(result.threads).filter(\n    (thread) => {\n      if (thread.roomId !== roomId) return false;\n      if (thread.deletedAt !== void 0) {\n        return false;\n      }\n      const query = options.query;\n      if (!query) return true;\n      if (query.resolved !== void 0 && thread.resolved !== query.resolved) {\n        return false;\n      }\n      for (const key in query.metadata) {\n        const metadataValue = thread.metadata[key];\n        const filterValue = query.metadata[key];\n        if (assertFilterIsStartsWithOperator(filterValue) && assertMetadataValueIsString(metadataValue)) {\n          if (metadataValue.startsWith(filterValue.startsWith)) {\n            return true;\n          }\n        }\n        if (metadataValue !== filterValue) {\n          return false;\n        }\n      }\n      return true;\n    }\n  );\n  return threads.sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\n}\nvar assertFilterIsStartsWithOperator = (filter) => {\n  if (typeof filter === \"object\" && typeof filter.startsWith === \"string\") {\n    return true;\n  } else {\n    return false;\n  }\n};\nvar assertMetadataValueIsString = (value) => {\n  return typeof value === \"string\";\n};\n\n// src/room.tsx\n\n\n\n\n\n// src/comments/lib/select-notification-settings.ts\n\nfunction selectNotificationSettings(roomId, state) {\n  const { notificationSettings } = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.applyOptimisticUpdates)(state);\n  return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nn)(notificationSettings[roomId]);\n}\n\n// src/use-scroll-to-comment-on-load-effect.ts\n\nfunction handleScrollToCommentOnLoad(shouldScrollOnLoad, state) {\n  if (shouldScrollOnLoad === false) return;\n  if (state.isLoading) return;\n  const isWindowDefined = typeof window !== \"undefined\";\n  if (!isWindowDefined) return;\n  const hash = window.location.hash;\n  const commentId = hash.slice(1);\n  if (!commentId.startsWith(\"cm_\")) return;\n  const comment = document.getElementById(commentId);\n  if (comment === null) return;\n  const comments = state.threads.flatMap((thread) => thread.comments);\n  const isCommentInThreads = comments.some(\n    (comment2) => comment2.id === commentId\n  );\n  if (!isCommentInThreads) return;\n  comment.scrollIntoView();\n}\nfunction useScrollToCommentOnLoadEffect(shouldScrollOnLoad, state) {\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(\n    () => {\n      handleScrollToCommentOnLoad(shouldScrollOnLoad, state);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- We only want to run this effect once\n    [state.isLoading]\n  );\n}\n\n// src/room.tsx\nvar SMOOTH_DELAY = 1e3;\nvar noop2 = () => {\n};\nvar identity = (x) => x;\nvar missing_unstable_batchedUpdates = (reactVersion, roomId) => `We noticed you\\u2019re using React ${reactVersion}. Please pass unstable_batchedUpdates at the RoomProvider level until you\\u2019re ready to upgrade to React 18:\n\n    import { unstable_batchedUpdates } from \"react-dom\";  // or \"react-native\"\n\n    <RoomProvider id=${JSON.stringify(\n  roomId\n)} ... unstable_batchedUpdates={unstable_batchedUpdates}>\n      ...\n    </RoomProvider>\n\nWhy? Please see https://liveblocks.io/docs/platform/troubleshooting#stale-props-zombie-child for more information`;\nvar superfluous_unstable_batchedUpdates = \"You don\\u2019t need to pass unstable_batchedUpdates to RoomProvider anymore, since you\\u2019re on React 18+ already.\";\nfunction useSyncExternalStore2(s, gs, gss) {\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(s, gs, gss, identity);\n}\nvar STABLE_EMPTY_LIST = Object.freeze([]);\nvar POLLING_INTERVAL2 = 5 * 60 * 1e3;\nfunction makeNotificationSettingsQueryKey(roomId) {\n  return `${roomId}:NOTIFICATION_SETTINGS`;\n}\nfunction alwaysEmptyList() {\n  return STABLE_EMPTY_LIST;\n}\nfunction alwaysNull() {\n  return null;\n}\nfunction selectorFor_useOthersConnectionIds(others) {\n  return others.map((user) => user.connectionId);\n}\nfunction makeMutationContext(room) {\n  const cannotUseUntil = \"This mutation cannot be used until\";\n  const needsPresence = `${cannotUseUntil} connected to the Liveblocks room`;\n  const needsStorage = `${cannotUseUntil} storage has been loaded`;\n  return {\n    get storage() {\n      const mutableRoot = room.getStorageSnapshot();\n      if (mutableRoot === null) {\n        throw new Error(needsStorage);\n      }\n      return mutableRoot;\n    },\n    get self() {\n      const self = room.getSelf();\n      if (self === null) {\n        throw new Error(needsPresence);\n      }\n      return self;\n    },\n    get others() {\n      const others = room.getOthers();\n      if (room.getSelf() === null) {\n        throw new Error(needsPresence);\n      }\n      return others;\n    },\n    setMyPresence: room.updatePresence\n  };\n}\nfunction getCurrentUserId(room) {\n  const self = room.getSelf();\n  if (self === null || self.id === void 0) {\n    return \"anonymous\";\n  } else {\n    return self.id;\n  }\n}\nfunction handleApiError(err) {\n  const message = `Request failed with status ${err.status}: ${err.message}`;\n  if (err.details?.error === \"FORBIDDEN\") {\n    const detailedMessage = [message, err.details.suggestion, err.details.docs].filter(Boolean).join(\"\\n\");\n    _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.console.error(detailedMessage);\n  }\n  return new Error(message);\n}\nvar _extras2 = /* @__PURE__ */ new WeakMap();\nvar _bundles2 = /* @__PURE__ */ new WeakMap();\nfunction getOrCreateRoomContextBundle(client) {\n  let bundle = _bundles2.get(client);\n  if (!bundle) {\n    bundle = makeRoomContextBundle(client);\n    _bundles2.set(client, bundle);\n  }\n  return bundle;\n}\nfunction getExtrasForClient2(client) {\n  let extras = _extras2.get(client);\n  if (!extras) {\n    extras = makeExtrasForClient2(client);\n    _extras2.set(client, extras);\n  }\n  return extras;\n}\nfunction makeExtrasForClient2(client) {\n  const store = client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].cacheStore;\n  const DEFAULT_DEDUPING_INTERVAL = 2e3;\n  const lastRequestedAtByRoom = /* @__PURE__ */ new Map();\n  const requestsByQuery = /* @__PURE__ */ new Map();\n  const requestStatusByRoom = /* @__PURE__ */ new Map();\n  const subscribersByQuery = /* @__PURE__ */ new Map();\n  const poller = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.makePoller)(refreshThreadsAndNotifications);\n  async function refreshThreadsAndNotifications() {\n    const requests = [];\n    client[_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal].getRoomIds().map((roomId) => {\n      const room = client.getRoom(roomId);\n      if (room === null) return;\n      requests.push(getThreadsUpdates(room.id));\n    });\n    await Promise.allSettled(requests);\n  }\n  function incrementQuerySubscribers(queryKey) {\n    const subscribers = subscribersByQuery.get(queryKey) ?? 0;\n    subscribersByQuery.set(queryKey, subscribers + 1);\n    poller.start(POLLING_INTERVAL2);\n    return () => {\n      const subscribers2 = subscribersByQuery.get(queryKey);\n      if (subscribers2 === void 0 || subscribers2 <= 0) {\n        _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.console.warn(\n          `Internal unexpected behavior. Cannot decrease subscriber count for query \"${queryKey}\"`\n        );\n        return;\n      }\n      subscribersByQuery.set(queryKey, subscribers2 - 1);\n      let totalSubscribers = 0;\n      for (const subscribers3 of subscribersByQuery.values()) {\n        totalSubscribers += subscribers3;\n      }\n      if (totalSubscribers <= 0) {\n        poller.stop();\n      }\n    };\n  }\n  async function getThreadsUpdates(roomId) {\n    const room = client.getRoom(roomId);\n    if (room === null) return;\n    const since = lastRequestedAtByRoom.get(room.id);\n    if (since === void 0) return;\n    const isFetchingThreadsUpdates = requestStatusByRoom.get(room.id) ?? false;\n    if (isFetchingThreadsUpdates === true) return;\n    try {\n      requestStatusByRoom.set(room.id, true);\n      const updates = await room.getThreadsSince({ since });\n      setTimeout(() => {\n        requestStatusByRoom.set(room.id, false);\n      }, DEFAULT_DEDUPING_INTERVAL);\n      store.updateThreadsAndNotifications(\n        updates.threads.updated,\n        updates.inboxNotifications.updated,\n        updates.threads.deleted,\n        updates.inboxNotifications.deleted\n      );\n      lastRequestedAtByRoom.set(room.id, updates.requestedAt);\n    } catch (err) {\n      requestStatusByRoom.set(room.id, false);\n      return;\n    }\n  }\n  async function getThreadsAndInboxNotifications(room, queryKey, options, { retryCount } = { retryCount: 0 }) {\n    const existingRequest = requestsByQuery.get(queryKey);\n    if (existingRequest !== void 0) return existingRequest;\n    const request = room.getThreads(options);\n    requestsByQuery.set(queryKey, request);\n    store.setQueryState(queryKey, {\n      isLoading: true\n    });\n    try {\n      const result = await request;\n      store.updateThreadsAndNotifications(\n        result.threads,\n        // TODO: Figure out how to remove this casting\n        result.inboxNotifications,\n        [],\n        [],\n        queryKey\n      );\n      const lastRequestedAt = lastRequestedAtByRoom.get(room.id);\n      if (lastRequestedAt === void 0 || lastRequestedAt > result.requestedAt) {\n        lastRequestedAtByRoom.set(room.id, result.requestedAt);\n      }\n      poller.start(POLLING_INTERVAL2);\n    } catch (err) {\n      requestsByQuery.delete(queryKey);\n      retryError(() => {\n        void getThreadsAndInboxNotifications(room, queryKey, options, {\n          retryCount: retryCount + 1\n        });\n      }, retryCount);\n      store.setQueryState(queryKey, {\n        isLoading: false,\n        error: err\n      });\n    }\n    return;\n  }\n  async function getInboxNotificationSettings(room, queryKey, { retryCount } = { retryCount: 0 }) {\n    const existingRequest = requestsByQuery.get(queryKey);\n    if (existingRequest !== void 0) return existingRequest;\n    try {\n      const request = room.getNotificationSettings();\n      requestsByQuery.set(queryKey, request);\n      store.setQueryState(queryKey, {\n        isLoading: true\n      });\n      const settings = await request;\n      store.updateRoomInboxNotificationSettings(room.id, settings, queryKey);\n    } catch (err) {\n      requestsByQuery.delete(queryKey);\n      retryError(() => {\n        void getInboxNotificationSettings(room, queryKey, {\n          retryCount: retryCount + 1\n        });\n      }, retryCount);\n      store.setQueryState(queryKey, {\n        isLoading: false,\n        error: err\n      });\n    }\n    return;\n  }\n  const commentsErrorEventSource = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.makeEventSource)();\n  function onMutationFailure(innerError, optimisticUpdateId, createPublicError) {\n    store.set((state) => ({\n      ...state,\n      optimisticUpdates: state.optimisticUpdates.filter(\n        (update) => update.id !== optimisticUpdateId\n      )\n    }));\n    if (innerError instanceof _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.CommentsApiError) {\n      const error = handleApiError(innerError);\n      commentsErrorEventSource.notify(createPublicError(error));\n      return;\n    }\n    if (innerError instanceof _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.NotificationsApiError) {\n      handleApiError(innerError);\n      return;\n    }\n    throw innerError;\n  }\n  return {\n    store,\n    incrementQuerySubscribers,\n    commentsErrorEventSource,\n    getThreadsUpdates,\n    getThreadsAndInboxNotifications,\n    getInboxNotificationSettings,\n    onMutationFailure\n  };\n}\nvar RoomContext = react__WEBPACK_IMPORTED_MODULE_0__.createContext(null);\nfunction makeRoomContextBundle(client) {\n  function RoomProvider_withImplicitLiveblocksProvider(props) {\n    return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(LiveblocksProviderWithClient, { client, allowNesting: true }, /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(RoomProvider, { ...props }));\n  }\n  const shared = createSharedContext(client);\n  const bundle = {\n    RoomContext,\n    RoomProvider: RoomProvider_withImplicitLiveblocksProvider,\n    useRoom,\n    useStatus,\n    useStorageStatus,\n    useBatch,\n    useBroadcastEvent,\n    useOthersListener,\n    useLostConnectionListener,\n    useErrorListener,\n    useEventListener,\n    useHistory,\n    useUndo,\n    useRedo,\n    useCanRedo,\n    useCanUndo,\n    useStorageRoot,\n    useStorage,\n    useSelf,\n    useMyPresence,\n    useUpdateMyPresence,\n    useOthers,\n    useOthersMapped,\n    useOthersConnectionIds,\n    useOther,\n    useMutation,\n    useThreads,\n    useCreateThread,\n    useDeleteThread,\n    useEditThreadMetadata,\n    useMarkThreadAsResolved,\n    useMarkThreadAsUnresolved,\n    useCreateComment,\n    useEditComment,\n    useDeleteComment,\n    useAddReaction,\n    useRemoveReaction,\n    useMarkThreadAsRead,\n    useThreadSubscription,\n    useRoomNotificationSettings,\n    useUpdateRoomNotificationSettings,\n    ...shared.classic,\n    suspense: {\n      RoomContext,\n      RoomProvider: RoomProvider_withImplicitLiveblocksProvider,\n      useRoom,\n      useStatus,\n      useStorageStatus: useStorageStatusSuspense,\n      useBatch,\n      useBroadcastEvent,\n      useOthersListener,\n      useLostConnectionListener,\n      useErrorListener,\n      useEventListener,\n      useHistory,\n      useUndo,\n      useRedo,\n      useCanRedo,\n      useCanUndo,\n      useStorageRoot,\n      useStorage: useStorageSuspense,\n      useSelf: useSelfSuspense,\n      useMyPresence,\n      useUpdateMyPresence,\n      useOthers: useOthersSuspense,\n      useOthersMapped: useOthersMappedSuspense,\n      useOthersConnectionIds: useOthersConnectionIdsSuspense,\n      useOther: useOtherSuspense,\n      useMutation,\n      useThreads: useThreadsSuspense,\n      useCreateThread,\n      useDeleteThread,\n      useEditThreadMetadata,\n      useMarkThreadAsResolved,\n      useMarkThreadAsUnresolved,\n      useCreateComment,\n      useEditComment,\n      useDeleteComment,\n      useAddReaction,\n      useRemoveReaction,\n      useMarkThreadAsRead,\n      useThreadSubscription,\n      useRoomNotificationSettings: useRoomNotificationSettingsSuspense,\n      useUpdateRoomNotificationSettings,\n      ...shared.suspense\n    },\n    useCommentsErrorListener\n  };\n  return Object.defineProperty(bundle, _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.kInternal, {\n    enumerable: false\n  });\n}\nfunction RoomProvider(props) {\n  const client = useClient();\n  const [cache] = react__WEBPACK_IMPORTED_MODULE_0__.useState(\n    () => /* @__PURE__ */ new Map()\n  );\n  const stableEnterRoom = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (roomId, options) => {\n      const cached = cache.get(roomId);\n      if (cached) return cached;\n      const rv = client.enterRoom(roomId, options);\n      const origLeave = rv.leave;\n      rv.leave = () => {\n        origLeave();\n        cache.delete(roomId);\n      };\n      cache.set(roomId, rv);\n      return rv;\n    },\n    [client, cache]\n  );\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(\n    RoomProviderInner,\n    {\n      ...props,\n      stableEnterRoom\n    }\n  );\n}\nfunction RoomProviderInner(props) {\n  const client = useClient();\n  const { id: roomId, stableEnterRoom } = props;\n  if (true) {\n    if (!roomId) {\n      throw new Error(\n        \"RoomProvider id property is required. For more information: https://liveblocks.io/docs/errors/liveblocks-react/RoomProvider-id-property-is-required\"\n      );\n    }\n    if (typeof roomId !== \"string\") {\n      throw new Error(\"RoomProvider id property should be a string.\");\n    }\n    const majorReactVersion = parseInt(react__WEBPACK_IMPORTED_MODULE_0__.version) || 1;\n    const oldReactVersion = majorReactVersion < 18;\n    (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.errorIf)(\n      oldReactVersion && props.unstable_batchedUpdates === void 0,\n      missing_unstable_batchedUpdates(majorReactVersion, roomId)\n    );\n    (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.deprecateIf)(\n      !oldReactVersion && props.unstable_batchedUpdates !== void 0,\n      superfluous_unstable_batchedUpdates\n    );\n  }\n  const frozenProps = useInitial({\n    initialPresence: props.initialPresence,\n    initialStorage: props.initialStorage,\n    unstable_batchedUpdates: props.unstable_batchedUpdates,\n    autoConnect: props.autoConnect ?? typeof window !== \"undefined\"\n  });\n  const [{ room }, setRoomLeavePair] = react__WEBPACK_IMPORTED_MODULE_0__.useState(\n    () => stableEnterRoom(roomId, {\n      ...frozenProps,\n      autoConnect: false\n      // Deliberately using false here on the first render, see below\n    })\n  );\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const { store } = getExtrasForClient2(client);\n    async function handleCommentEvent(message) {\n      if (message.type === _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.THREAD_DELETED) {\n        store.deleteThread(message.threadId);\n        return;\n      }\n      const info = await room.getThread(message.threadId);\n      if (!info.thread) {\n        store.deleteThread(message.threadId);\n        return;\n      }\n      const { thread, inboxNotification } = info;\n      const existingThread = store.get().threads[message.threadId];\n      switch (message.type) {\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.COMMENT_EDITED:\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.THREAD_METADATA_UPDATED:\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.THREAD_UPDATED:\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.COMMENT_REACTION_ADDED:\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.COMMENT_REACTION_REMOVED:\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.COMMENT_DELETED:\n          if (!existingThread) break;\n          store.updateThreadAndNotification(thread, inboxNotification);\n          break;\n        case _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.ServerMsgCode.COMMENT_CREATED:\n          store.updateThreadAndNotification(thread, inboxNotification);\n          break;\n        default:\n          break;\n      }\n    }\n    return room.events.comments.subscribe(\n      (message) => void handleCommentEvent(message)\n    );\n  }, [client, room]);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const { getThreadsUpdates } = getExtrasForClient2(client);\n    void getThreadsUpdates(room.id);\n  }, [client, room.id]);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    function handleIsOnline() {\n      const { getThreadsUpdates } = getExtrasForClient2(client);\n      void getThreadsUpdates(room.id);\n    }\n    window.addEventListener(\"online\", handleIsOnline);\n    return () => {\n      window.removeEventListener(\"online\", handleIsOnline);\n    };\n  }, [client, room.id]);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const pair = stableEnterRoom(roomId, frozenProps);\n    setRoomLeavePair(pair);\n    const { room: room2, leave } = pair;\n    if (frozenProps.autoConnect) {\n      room2.connect();\n    }\n    return () => {\n      leave();\n    };\n  }, [roomId, frozenProps, stableEnterRoom]);\n  return /* @__PURE__ */ react__WEBPACK_IMPORTED_MODULE_0__.createElement(RoomContext.Provider, { value: room }, props.children);\n}\nfunction useRoom() {\n  const room = useRoomOrNull();\n  if (room === null) {\n    throw new Error(\"RoomProvider is missing from the React tree.\");\n  }\n  return room;\n}\nfunction useStatus() {\n  const room = useRoom();\n  const subscribe = room.events.status.subscribe;\n  const getSnapshot = room.getStatus;\n  const getServerSnapshot = room.getStatus;\n  return useSyncExternalStore2(subscribe, getSnapshot, getServerSnapshot);\n}\nfunction useStorageStatus(options) {\n  const smooth = useInitial(options?.smooth ?? false);\n  if (smooth) {\n    return useStorageStatusSmooth();\n  } else {\n    return useStorageStatusImmediate();\n  }\n}\nfunction useStorageStatusImmediate() {\n  const room = useRoom();\n  const subscribe = room.events.storageStatus.subscribe;\n  const getSnapshot = room.getStorageStatus;\n  const getServerSnapshot = room.getStorageStatus;\n  return useSyncExternalStore2(subscribe, getSnapshot, getServerSnapshot);\n}\nfunction useStorageStatusSmooth() {\n  const room = useRoom();\n  const [status, setStatus] = react__WEBPACK_IMPORTED_MODULE_0__.useState(room.getStorageStatus);\n  const oldStatus = useLatest(room.getStorageStatus());\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    let timeoutId;\n    const unsub = room.events.storageStatus.subscribe((newStatus) => {\n      if (oldStatus.current === \"synchronizing\" && newStatus === \"synchronized\") {\n        timeoutId = setTimeout(() => setStatus(newStatus), SMOOTH_DELAY);\n      } else {\n        clearTimeout(timeoutId);\n        setStatus(newStatus);\n      }\n    });\n    return () => {\n      clearTimeout(timeoutId);\n      unsub();\n    };\n  }, [room, oldStatus]);\n  return status;\n}\nfunction useBatch() {\n  return useRoom().batch;\n}\nfunction useBroadcastEvent() {\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (event, options = { shouldQueueEventIfNotReady: false }) => {\n      room.broadcastEvent(event, options);\n    },\n    [room]\n  );\n}\nfunction useOthersListener(callback) {\n  const room = useRoom();\n  const savedCallback = useLatest(callback);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(\n    () => room.events.others.subscribe((event) => savedCallback.current(event)),\n    [room, savedCallback]\n  );\n}\nfunction useLostConnectionListener(callback) {\n  const room = useRoom();\n  const savedCallback = useLatest(callback);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(\n    () => room.events.lostConnection.subscribe(\n      (event) => savedCallback.current(event)\n    ),\n    [room, savedCallback]\n  );\n}\nfunction useErrorListener(callback) {\n  const room = useRoom();\n  const savedCallback = useLatest(callback);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(\n    () => room.events.error.subscribe((e) => savedCallback.current(e)),\n    [room, savedCallback]\n  );\n}\nfunction useEventListener(callback) {\n  const room = useRoom();\n  const savedCallback = useLatest(callback);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const listener = (eventData) => {\n      savedCallback.current(eventData);\n    };\n    return room.events.customEvent.subscribe(listener);\n  }, [room, savedCallback]);\n}\nfunction useHistory() {\n  return useRoom().history;\n}\nfunction useUndo() {\n  return useHistory().undo;\n}\nfunction useRedo() {\n  return useHistory().redo;\n}\nfunction useCanUndo() {\n  const room = useRoom();\n  const subscribe = room.events.history.subscribe;\n  const canUndo = room.history.canUndo;\n  return useSyncExternalStore2(subscribe, canUndo, canUndo);\n}\nfunction useCanRedo() {\n  const room = useRoom();\n  const subscribe = room.events.history.subscribe;\n  const canRedo = room.history.canRedo;\n  return useSyncExternalStore2(subscribe, canRedo, canRedo);\n}\nfunction useSelf(maybeSelector, isEqual) {\n  const room = useRoom();\n  const subscribe = room.events.self.subscribe;\n  const getSnapshot = room.getSelf;\n  const selector = maybeSelector ?? identity;\n  const wrappedSelector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (me) => me !== null ? selector(me) : null,\n    [selector]\n  );\n  const getServerSnapshot = alwaysNull;\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    subscribe,\n    getSnapshot,\n    getServerSnapshot,\n    wrappedSelector,\n    isEqual\n  );\n}\nfunction useMyPresence() {\n  const room = useRoom();\n  const subscribe = room.events.myPresence.subscribe;\n  const getSnapshot = room.getPresence;\n  const presence = useSyncExternalStore2(subscribe, getSnapshot, getSnapshot);\n  const setPresence = room.updatePresence;\n  return [presence, setPresence];\n}\nfunction useUpdateMyPresence() {\n  return useRoom().updatePresence;\n}\nfunction useOthers(selector, isEqual) {\n  const room = useRoom();\n  const subscribe = room.events.others.subscribe;\n  const getSnapshot = room.getOthers;\n  const getServerSnapshot = alwaysEmptyList;\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    subscribe,\n    getSnapshot,\n    getServerSnapshot,\n    selector ?? identity,\n    isEqual\n  );\n}\nfunction useOthersMapped(itemSelector, itemIsEqual) {\n  const wrappedSelector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (others) => others.map((other) => [other.connectionId, itemSelector(other)]),\n    [itemSelector]\n  );\n  const wrappedIsEqual = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (a, b) => {\n      const eq = itemIsEqual ?? Object.is;\n      return a.length === b.length && a.every((atuple, index) => {\n        const btuple = b[index];\n        return atuple[0] === btuple[0] && eq(atuple[1], btuple[1]);\n      });\n    },\n    [itemIsEqual]\n  );\n  return useOthers(wrappedSelector, wrappedIsEqual);\n}\nfunction useOthersConnectionIds() {\n  return useOthers(selectorFor_useOthersConnectionIds, _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.shallow);\n}\nvar NOT_FOUND = Symbol();\nfunction useOther(connectionId, selector, isEqual) {\n  const wrappedSelector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (others) => {\n      const other2 = others.find((other3) => other3.connectionId === connectionId);\n      return other2 !== void 0 ? selector(other2) : NOT_FOUND;\n    },\n    [connectionId, selector]\n  );\n  const wrappedIsEqual = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (prev, curr) => {\n      if (prev === NOT_FOUND || curr === NOT_FOUND) {\n        return prev === curr;\n      }\n      const eq = isEqual ?? Object.is;\n      return eq(prev, curr);\n    },\n    [isEqual]\n  );\n  const other = useOthers(wrappedSelector, wrappedIsEqual);\n  if (other === NOT_FOUND) {\n    throw new Error(\n      `No such other user with connection id ${connectionId} exists`\n    );\n  }\n  return other;\n}\nfunction useMutableStorageRoot() {\n  const room = useRoom();\n  const subscribe = room.events.storageDidLoad.subscribeOnce;\n  const getSnapshot = room.getStorageSnapshot;\n  const getServerSnapshot = alwaysNull;\n  return useSyncExternalStore2(subscribe, getSnapshot, getServerSnapshot);\n}\nfunction useStorageRoot() {\n  return [useMutableStorageRoot()];\n}\nfunction useStorage(selector, isEqual) {\n  const room = useRoom();\n  const rootOrNull = useMutableStorageRoot();\n  const wrappedSelector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (rootOrNull2) => rootOrNull2 !== null ? selector(rootOrNull2) : null,\n    [selector]\n  );\n  const subscribe = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (onStoreChange) => rootOrNull !== null ? room.subscribe(rootOrNull, onStoreChange, { isDeep: true }) : noop2,\n    [room, rootOrNull]\n  );\n  const getSnapshot = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(() => {\n    if (rootOrNull === null) {\n      return null;\n    } else {\n      const root = rootOrNull;\n      const imm = root.toImmutable();\n      return imm;\n    }\n  }, [rootOrNull]);\n  const getServerSnapshot = alwaysNull;\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    subscribe,\n    getSnapshot,\n    getServerSnapshot,\n    wrappedSelector,\n    isEqual\n  );\n}\nfunction useMutation(callback, deps) {\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useMemo(\n    () => {\n      return (...args) => (\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        room.batch(\n          () => (\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n            callback(\n              makeMutationContext(room),\n              ...args\n            )\n          )\n        )\n      );\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [room, ...deps]\n  );\n}\nfunction useThreads(options = {\n  query: { metadata: {} }\n}) {\n  const { scrollOnLoad = true } = options;\n  const client = useClient();\n  const room = useRoom();\n  const queryKey = react__WEBPACK_IMPORTED_MODULE_0__.useMemo(\n    () => generateQueryKey(room.id, options.query),\n    [room, options]\n  );\n  const { store, getThreadsAndInboxNotifications, incrementQuerySubscribers } = getExtrasForClient2(client);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    void getThreadsAndInboxNotifications(room, queryKey, options);\n    return incrementQuerySubscribers(queryKey);\n  }, [room, queryKey]);\n  const selector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (state2) => {\n      const query = state2.queries[queryKey];\n      if (query === void 0 || query.isLoading) {\n        return {\n          isLoading: true\n        };\n      }\n      return {\n        threads: selectedThreads(room.id, state2, options),\n        isLoading: false,\n        error: query.error\n      };\n    },\n    [room, queryKey]\n    // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  const state = (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selector\n  );\n  useScrollToCommentOnLoadEffect(scrollOnLoad, state);\n  return state;\n}\nfunction useCommentsErrorListener(callback) {\n  const client = useClient();\n  const savedCallback = useLatest(callback);\n  const { commentsErrorEventSource } = getExtrasForClient2(client);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    return commentsErrorEventSource.subscribe(savedCallback.current);\n  }, [savedCallback, commentsErrorEventSource]);\n}\nfunction useCreateThread() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (options) => {\n      const body = options.body;\n      const metadata = options.metadata ?? {};\n      const threadId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.createThreadId)();\n      const commentId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.createCommentId)();\n      const createdAt = /* @__PURE__ */ new Date();\n      const newComment = {\n        id: commentId,\n        threadId,\n        roomId: room.id,\n        createdAt,\n        type: \"comment\",\n        userId: getCurrentUserId(room),\n        body,\n        reactions: []\n      };\n      const newThread = {\n        id: threadId,\n        type: \"thread\",\n        createdAt,\n        updatedAt: createdAt,\n        roomId: room.id,\n        metadata,\n        comments: [newComment],\n        resolved: false\n      };\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"create-thread\",\n        thread: newThread,\n        id: optimisticUpdateId,\n        roomId: room.id\n      });\n      room.createThread({ threadId, commentId, body, metadata }).then(\n        (thread) => {\n          store.set((state) => ({\n            ...state,\n            threads: {\n              ...state.threads,\n              [threadId]: thread\n            },\n            optimisticUpdates: state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            )\n          }));\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (err2) => new CreateThreadError(err2, {\n            roomId: room.id,\n            threadId,\n            commentId,\n            body,\n            metadata\n          })\n        )\n      );\n      return newThread;\n    },\n    [client, room]\n  );\n}\nfunction useDeleteThread() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (threadId) => {\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      const thread = store.get().threads[threadId];\n      const userId = getCurrentUserId(room);\n      if (thread?.comments?.[0]?.userId !== userId) {\n        throw new Error(\"Only the thread creator can delete the thread\");\n      }\n      store.pushOptimisticUpdate({\n        type: \"delete-thread\",\n        id: optimisticUpdateId,\n        roomId: room.id,\n        threadId,\n        deletedAt: /* @__PURE__ */ new Date()\n      });\n      room.deleteThread(threadId).then(\n        () => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            if (existingThread === void 0) {\n              return state;\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: {\n                  ...existingThread,\n                  updatedAt: /* @__PURE__ */ new Date(),\n                  deletedAt: /* @__PURE__ */ new Date()\n                }\n              },\n              optimisticUpdates: state.optimisticUpdates.filter(\n                (update) => update.id !== optimisticUpdateId\n              )\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (err2) => new DeleteThreadError(err2, { roomId: room.id, threadId })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useEditThreadMetadata() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (options) => {\n      if (!options.metadata) {\n        return;\n      }\n      const threadId = options.threadId;\n      const metadata = options.metadata;\n      const updatedAt = /* @__PURE__ */ new Date();\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"edit-thread-metadata\",\n        metadata,\n        id: optimisticUpdateId,\n        threadId,\n        updatedAt\n      });\n      room.editThreadMetadata({ metadata, threadId }).then(\n        (metadata2) => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            if (existingThread.deletedAt !== void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            if (existingThread.updatedAt && existingThread.updatedAt > updatedAt) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: {\n                  ...existingThread,\n                  metadata: metadata2\n                }\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new EditThreadMetadataError(error, {\n            roomId: room.id,\n            threadId,\n            metadata\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useCreateComment() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    ({ threadId, body }) => {\n      const commentId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.createCommentId)();\n      const createdAt = /* @__PURE__ */ new Date();\n      const comment = {\n        id: commentId,\n        threadId,\n        roomId: room.id,\n        type: \"comment\",\n        createdAt,\n        userId: getCurrentUserId(room),\n        body,\n        reactions: []\n      };\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"create-comment\",\n        comment,\n        id: optimisticUpdateId\n      });\n      room.createComment({ threadId, commentId, body }).then(\n        (newComment) => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            const inboxNotification = Object.values(\n              state.inboxNotifications\n            ).find(\n              (notification) => notification.kind === \"thread\" && notification.threadId === threadId\n            );\n            const updatedInboxNotifications = inboxNotification !== void 0 ? {\n              ...state.inboxNotifications,\n              [inboxNotification.id]: {\n                ...inboxNotification,\n                notifiedAt: newComment.createdAt,\n                readAt: newComment.createdAt\n              }\n            } : state.inboxNotifications;\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.upsertComment)(existingThread, newComment)\n                // Upsert the new comment into the thread comments list (if applicable)\n              },\n              inboxNotifications: updatedInboxNotifications,\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (err2) => new CreateCommentError(err2, {\n            roomId: room.id,\n            threadId,\n            commentId,\n            body\n          })\n        )\n      );\n      return comment;\n    },\n    [client, room]\n  );\n}\nfunction useEditComment() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    ({ threadId, commentId, body }) => {\n      const editedAt = /* @__PURE__ */ new Date();\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      const thread = store.get().threads[threadId];\n      if (thread === void 0) {\n        _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.console.warn(\n          `Internal unexpected behavior. Cannot edit comment in thread \"${threadId}\" because the thread does not exist in the cache.`\n        );\n        return;\n      }\n      const comment = thread.comments.find(\n        (comment2) => comment2.id === commentId\n      );\n      if (comment === void 0 || comment.deletedAt !== void 0) {\n        _liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.console.warn(\n          `Internal unexpected behavior. Cannot edit comment \"${commentId}\" in thread \"${threadId}\" because the comment does not exist in the cache.`\n        );\n        return;\n      }\n      store.pushOptimisticUpdate({\n        type: \"edit-comment\",\n        comment: {\n          ...comment,\n          editedAt,\n          body\n        },\n        id: optimisticUpdateId\n      });\n      room.editComment({ threadId, commentId, body }).then(\n        (editedComment) => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.upsertComment)(existingThread, editedComment)\n                // Upsert the edited comment into the thread comments list (if applicable)\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new EditCommentError(error, {\n            roomId: room.id,\n            threadId,\n            commentId,\n            body\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useDeleteComment() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    ({ threadId, commentId }) => {\n      const deletedAt = /* @__PURE__ */ new Date();\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"delete-comment\",\n        threadId,\n        commentId,\n        deletedAt,\n        id: optimisticUpdateId,\n        roomId: room.id\n      });\n      room.deleteComment({ threadId, commentId }).then(\n        () => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.deleteComment)(existingThread, commentId, deletedAt)\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new DeleteCommentError(error, {\n            roomId: room.id,\n            threadId,\n            commentId\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useAddReaction() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    ({ threadId, commentId, emoji }) => {\n      const createdAt = /* @__PURE__ */ new Date();\n      const userId = getCurrentUserId(room);\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"add-reaction\",\n        threadId,\n        commentId,\n        reaction: {\n          emoji,\n          userId,\n          createdAt\n        },\n        id: optimisticUpdateId\n      });\n      room.addReaction({ threadId, commentId, emoji }).then(\n        (addedReaction) => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.addReaction)(\n                  existingThread,\n                  commentId,\n                  addedReaction\n                )\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new AddReactionError(error, {\n            roomId: room.id,\n            threadId,\n            commentId,\n            emoji\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useRemoveReaction() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    ({ threadId, commentId, emoji }) => {\n      const userId = getCurrentUserId(room);\n      const removedAt = /* @__PURE__ */ new Date();\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"remove-reaction\",\n        threadId,\n        commentId,\n        emoji,\n        userId,\n        removedAt,\n        id: optimisticUpdateId\n      });\n      room.removeReaction({ threadId, commentId, emoji }).then(\n        () => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.removeReaction)(\n                  existingThread,\n                  commentId,\n                  emoji,\n                  userId,\n                  removedAt\n                )\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new RemoveReactionError(error, {\n            roomId: room.id,\n            threadId,\n            commentId,\n            emoji\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useMarkThreadAsRead() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (threadId) => {\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      const inboxNotification = Object.values(\n        store.get().inboxNotifications\n      ).find(\n        (inboxNotification2) => inboxNotification2.kind === \"thread\" && inboxNotification2.threadId === threadId\n      );\n      if (!inboxNotification) return;\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const now = /* @__PURE__ */ new Date();\n      store.pushOptimisticUpdate({\n        type: \"mark-inbox-notification-as-read\",\n        id: optimisticUpdateId,\n        inboxNotificationId: inboxNotification.id,\n        readAt: now\n      });\n      room.markInboxNotificationAsRead(inboxNotification.id).then(\n        () => {\n          store.set((state) => ({\n            ...state,\n            inboxNotifications: {\n              ...state.inboxNotifications,\n              [inboxNotification.id]: {\n                ...inboxNotification,\n                readAt: now\n              }\n            },\n            optimisticUpdates: state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            )\n          }));\n        },\n        (err) => {\n          onMutationFailure(\n            err,\n            optimisticUpdateId,\n            (error) => new MarkInboxNotificationAsReadError(error, {\n              inboxNotificationId: inboxNotification.id\n            })\n          );\n          return;\n        }\n      );\n    },\n    [client, room]\n  );\n}\nfunction useMarkThreadAsResolved() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (threadId) => {\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const updatedAt = /* @__PURE__ */ new Date();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"mark-thread-as-resolved\",\n        id: optimisticUpdateId,\n        threadId,\n        updatedAt\n      });\n      room.markThreadAsResolved(threadId).then(\n        () => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            if (existingThread.deletedAt !== void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            if (existingThread.updatedAt && existingThread.updatedAt > updatedAt) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: {\n                  ...existingThread,\n                  resolved: true\n                }\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new MarkThreadAsResolvedError(error, {\n            roomId: room.id,\n            threadId\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useMarkThreadAsUnresolved() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (threadId) => {\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const updatedAt = /* @__PURE__ */ new Date();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        type: \"mark-thread-as-unresolved\",\n        id: optimisticUpdateId,\n        threadId,\n        updatedAt\n      });\n      room.markThreadAsUnresolved(threadId).then(\n        () => {\n          store.set((state) => {\n            const existingThread = state.threads[threadId];\n            const updatedOptimisticUpdates = state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            );\n            if (existingThread === void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            if (existingThread.deletedAt !== void 0) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            if (existingThread.updatedAt && existingThread.updatedAt > updatedAt) {\n              return {\n                ...state,\n                optimisticUpdates: updatedOptimisticUpdates\n              };\n            }\n            return {\n              ...state,\n              threads: {\n                ...state.threads,\n                [threadId]: {\n                  ...existingThread,\n                  resolved: false\n                }\n              },\n              optimisticUpdates: updatedOptimisticUpdates\n            };\n          });\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new MarkThreadAsUnresolvedError(error, {\n            roomId: room.id,\n            threadId\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction useThreadSubscription(threadId) {\n  const client = useClient();\n  const { store } = getExtrasForClient2(client);\n  const selector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (state) => {\n      const inboxNotification = selectedInboxNotifications(state).find(\n        (inboxNotification2) => inboxNotification2.kind === \"thread\" && inboxNotification2.threadId === threadId\n      );\n      const thread = state.threads[threadId];\n      if (inboxNotification === void 0 || thread === void 0) {\n        return {\n          status: \"not-subscribed\"\n        };\n      }\n      return {\n        status: \"subscribed\",\n        unreadSince: inboxNotification.readAt\n      };\n    },\n    [threadId]\n  );\n  return (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selector\n  );\n}\nfunction useRoomNotificationSettings() {\n  const client = useClient();\n  const room = useRoom();\n  const { store } = getExtrasForClient2(client);\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const { getInboxNotificationSettings } = getExtrasForClient2(client);\n    const queryKey = makeNotificationSettingsQueryKey(room.id);\n    void getInboxNotificationSettings(room, queryKey);\n  }, [client, room]);\n  const updateRoomNotificationSettings = useUpdateRoomNotificationSettings();\n  const selector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (state) => {\n      const query = state.queries[makeNotificationSettingsQueryKey(room.id)];\n      if (query === void 0 || query.isLoading) {\n        return { isLoading: true };\n      }\n      if (query.error !== void 0) {\n        return { isLoading: false, error: query.error };\n      }\n      return {\n        isLoading: false,\n        settings: selectNotificationSettings(room.id, state)\n      };\n    },\n    [room]\n  );\n  const settings = (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selector\n  );\n  return react__WEBPACK_IMPORTED_MODULE_0__.useMemo(() => {\n    return [settings, updateRoomNotificationSettings];\n  }, [settings, updateRoomNotificationSettings]);\n}\nfunction useUpdateRoomNotificationSettings() {\n  const client = useClient();\n  const room = useRoom();\n  return react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (settings) => {\n      const optimisticUpdateId = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.nanoid)();\n      const { store, onMutationFailure } = getExtrasForClient2(client);\n      store.pushOptimisticUpdate({\n        id: optimisticUpdateId,\n        type: \"update-notification-settings\",\n        roomId: room.id,\n        settings\n      });\n      room.updateNotificationSettings(settings).then(\n        (settings2) => {\n          store.set((state) => ({\n            ...state,\n            notificationSettings: {\n              [room.id]: settings2\n            },\n            optimisticUpdates: state.optimisticUpdates.filter(\n              (update) => update.id !== optimisticUpdateId\n            )\n          }));\n        },\n        (err) => onMutationFailure(\n          err,\n          optimisticUpdateId,\n          (error) => new UpdateNotificationSettingsError(error, {\n            roomId: room.id\n          })\n        )\n      );\n    },\n    [client, room]\n  );\n}\nfunction ensureNotServerSide() {\n  if (typeof window === \"undefined\") {\n    throw new Error(\n      \"You cannot use the Suspense version of this hook on the server side. Make sure to only call them on the client side.\\nFor tips, see https://liveblocks.io/docs/api-reference/liveblocks-react#suspense-avoid-ssr\"\n    );\n  }\n}\nfunction useSuspendUntilPresenceReady() {\n  ensureNotServerSide();\n  const room = useRoom();\n  use(room.waitUntilPresenceReady());\n}\nfunction useSelfSuspense(selector, isEqual) {\n  useSuspendUntilPresenceReady();\n  return useSelf(\n    selector,\n    isEqual\n  );\n}\nfunction useOthersSuspense(selector, isEqual) {\n  useSuspendUntilPresenceReady();\n  return useOthers(\n    selector,\n    isEqual\n  );\n}\nfunction useOthersConnectionIdsSuspense() {\n  useSuspendUntilPresenceReady();\n  return useOthersConnectionIds();\n}\nfunction useOthersMappedSuspense(itemSelector, itemIsEqual) {\n  useSuspendUntilPresenceReady();\n  return useOthersMapped(itemSelector, itemIsEqual);\n}\nfunction useOtherSuspense(connectionId, selector, isEqual) {\n  useSuspendUntilPresenceReady();\n  return useOther(connectionId, selector, isEqual);\n}\nfunction useSuspendUntilStorageReady() {\n  ensureNotServerSide();\n  const room = useRoom();\n  use(room.waitUntilStorageReady());\n}\nfunction useStorageSuspense(selector, isEqual) {\n  useSuspendUntilStorageReady();\n  return useStorage(\n    selector,\n    isEqual\n  );\n}\nfunction useStorageStatusSuspense(options) {\n  useSuspendUntilStorageReady();\n  return useStorageStatus(options);\n}\nfunction useThreadsSuspense(options = {\n  query: { metadata: {} }\n}) {\n  const { scrollOnLoad = true } = options;\n  const client = useClient();\n  const room = useRoom();\n  const queryKey = react__WEBPACK_IMPORTED_MODULE_0__.useMemo(\n    () => generateQueryKey(room.id, options.query),\n    [room, options]\n  );\n  const { store, getThreadsAndInboxNotifications } = getExtrasForClient2(client);\n  const query = store.get().queries[queryKey];\n  if (query === void 0 || query.isLoading) {\n    throw getThreadsAndInboxNotifications(room, queryKey, options);\n  }\n  if (query.error) {\n    throw query.error;\n  }\n  const selector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (state2) => {\n      return {\n        threads: selectedThreads(room.id, state2, options),\n        isLoading: false\n      };\n    },\n    [room, queryKey]\n    // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  react__WEBPACK_IMPORTED_MODULE_0__.useEffect(() => {\n    const { incrementQuerySubscribers } = getExtrasForClient2(client);\n    return incrementQuerySubscribers(queryKey);\n  }, [client, queryKey]);\n  const state = (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selector\n  );\n  useScrollToCommentOnLoadEffect(scrollOnLoad, state);\n  return state;\n}\nfunction useRoomNotificationSettingsSuspense() {\n  const updateRoomNotificationSettings = useUpdateRoomNotificationSettings();\n  const client = useClient();\n  const room = useRoom();\n  const queryKey = makeNotificationSettingsQueryKey(room.id);\n  const { store, getInboxNotificationSettings } = getExtrasForClient2(client);\n  const query = store.get().queries[queryKey];\n  if (query === void 0 || query.isLoading) {\n    throw getInboxNotificationSettings(room, queryKey);\n  }\n  if (query.error) {\n    throw query.error;\n  }\n  const selector = react__WEBPACK_IMPORTED_MODULE_0__.useCallback(\n    (state) => {\n      return {\n        isLoading: false,\n        settings: selectNotificationSettings(room.id, state)\n      };\n    },\n    [room]\n  );\n  const settings = (0,use_sync_external_store_shim_with_selector_js__WEBPACK_IMPORTED_MODULE_2__.useSyncExternalStoreWithSelector)(\n    store.subscribe,\n    store.get,\n    store.get,\n    selector\n  );\n  return react__WEBPACK_IMPORTED_MODULE_0__.useMemo(() => {\n    return [settings, updateRoomNotificationSettings];\n  }, [settings, updateRoomNotificationSettings]);\n}\nfunction useRoomOrNull() {\n  return react__WEBPACK_IMPORTED_MODULE_0__.useContext(RoomContext);\n}\nfunction createRoomContext(client) {\n  return getOrCreateRoomContextBundle(client);\n}\nfunction generateQueryKey(roomId, options) {\n  return `${roomId}-${(0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_3__.stringify)(options ?? {})}`;\n}\nvar _RoomProvider = RoomProvider;\nvar _useBroadcastEvent = useBroadcastEvent;\nvar _useOthersListener = useOthersListener;\nvar _useRoom = useRoom;\nvar _useAddReaction = useAddReaction;\nvar _useMutation = useMutation;\nvar _useCreateThread = useCreateThread;\nvar _useDeleteThread = useDeleteThread;\nvar _useEditThreadMetadata = useEditThreadMetadata;\nvar _useEventListener = useEventListener;\nvar _useMyPresence = useMyPresence;\nvar _useOthersMapped = useOthersMapped;\nvar _useOthersMappedSuspense = useOthersMappedSuspense;\nvar _useThreads = useThreads;\nvar _useThreadsSuspense = useThreadsSuspense;\nvar _useOther = useOther;\nfunction _useOthers(...args) {\n  return useOthers(...args);\n}\nvar _useOtherSuspense = useOtherSuspense;\nfunction _useOthersSuspense(...args) {\n  return useOthersSuspense(...args);\n}\nvar _useStorage = useStorage;\nvar _useStorageSuspense = useStorageSuspense;\nfunction _useSelf(...args) {\n  return useSelf(...args);\n}\nfunction _useSelfSuspense(...args) {\n  return useSelfSuspense(...args);\n}\nvar _useStorageRoot = useStorageRoot;\nvar _useUpdateMyPresence = useUpdateMyPresence;\n\n\n//# sourceMappingURL=chunk-7KAWYNVI.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QvZGlzdC9jaHVuay03S0FXWU5WSS5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDK0I7QUFDL0I7QUFDQSxnQ0FBZ0MsMkNBQWM7QUFDOUMsRUFBRSw0Q0FBZTtBQUNqQjtBQUNBLEdBQUc7QUFDSCx5QkFBeUIsZ0RBQW1CLENBQUMsMkNBQWMsSUFBSSwwQkFBMEI7QUFDekY7O0FBRUE7QUFVMEI7QUFPWDtBQUM4RDtBQUNvQjs7QUFFakc7QUFDMEQ7QUFDMUQ7QUFDQSxpQkFBaUIsd0VBQXNCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0Esd0NBQXdDLFVBQVUsWUFBWSxZQUFZO0FBQzFFO0FBQ0E7QUFDQTtBQUNBLFVBQVUsc0RBQUk7QUFDZDtBQUNBOztBQUVBO0FBQ2dEOztBQUVoRDtBQUN3RDtBQUN4RDtBQUNBLGNBQWMsNkNBQU07QUFDcEIsRUFBRSxnREFBVTtBQUNaO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUyxpREFBVTtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxrREFBVztBQUN0QjtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRzBCO0FBQzFCO0FBQ0EsaUJBQWlCLHdFQUF1QjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElB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QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDhDQUFrQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxtQkFBbUIsK0dBQWlDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDBDQUFjO0FBQ3ZCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxTQUFTLDZDQUFpQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxPQUFPLEdBQUcsMkRBQVMsY0FBYyxFQUFFO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQTZFRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvcmVhY3QvZGlzdC9jaHVuay03S0FXWU5WSS5tanM/MWZmOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvdmVyc2lvbi50c1xudmFyIFBLR19OQU1FID0gXCJAbGl2ZWJsb2Nrcy9yZWFjdFwiO1xudmFyIFBLR19WRVJTSU9OID0gXCIyLjQuMFwiO1xudmFyIFBLR19GT1JNQVQgPSBcImVzbVwiO1xuXG4vLyBzcmMvQ2xpZW50U2lkZVN1c3BlbnNlLnRzeFxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5mdW5jdGlvbiBDbGllbnRTaWRlU3VzcGVuc2UocHJvcHMpIHtcbiAgY29uc3QgW21vdW50ZWQsIHNldE1vdW50ZWRdID0gUmVhY3QudXNlU3RhdGUoZmFsc2UpO1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldE1vdW50ZWQodHJ1ZSk7XG4gIH0sIFtdKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LlN1c3BlbnNlLCB7IGZhbGxiYWNrOiBwcm9wcy5mYWxsYmFjayB9LCBtb3VudGVkID8gdHlwZW9mIHByb3BzLmNoaWxkcmVuID09PSBcImZ1bmN0aW9uXCIgPyBwcm9wcy5jaGlsZHJlbigpIDogcHJvcHMuY2hpbGRyZW4gOiBwcm9wcy5mYWxsYmFjayk7XG59XG5cbi8vIHNyYy9saXZlYmxvY2tzLnRzeFxuaW1wb3J0IHtcbiAgYXNzZXJ0LFxuICBjcmVhdGVDbGllbnQsXG4gIGtJbnRlcm5hbCxcbiAgbWFrZVBvbGxlcixcbiAgbWVtb2l6ZU9uU3VjY2VzcyxcbiAgbmFub2lkLFxuICByYWlzZSxcbiAgc2hhbGxvd1xufSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuaW1wb3J0IFJlYWN0Miwge1xuICBjcmVhdGVDb250ZXh0LFxuICB1c2VDYWxsYmFjayBhcyB1c2VDYWxsYmFjazIsXG4gIHVzZUNvbnRleHQsXG4gIHVzZUVmZmVjdCBhcyB1c2VFZmZlY3QzLFxuICB1c2VNZW1vXG59IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlU3luY0V4dGVybmFsU3RvcmUgfSBmcm9tIFwidXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS9pbmRleC5qc1wiO1xuaW1wb3J0IHsgdXNlU3luY0V4dGVybmFsU3RvcmVXaXRoU2VsZWN0b3IgfSBmcm9tIFwidXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS93aXRoLXNlbGVjdG9yLmpzXCI7XG5cbi8vIHNyYy9jb21tZW50cy9saWIvc2VsZWN0ZWQtaW5ib3gtbm90aWZpY2F0aW9ucy50c1xuaW1wb3J0IHsgYXBwbHlPcHRpbWlzdGljVXBkYXRlcyB9IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5mdW5jdGlvbiBzZWxlY3RlZEluYm94Tm90aWZpY2F0aW9ucyhzdGF0ZSkge1xuICBjb25zdCByZXN1bHQgPSBhcHBseU9wdGltaXN0aWNVcGRhdGVzKHN0YXRlKTtcbiAgcmV0dXJuIE9iamVjdC52YWx1ZXMocmVzdWx0LmluYm94Tm90aWZpY2F0aW9ucykuc29ydChcbiAgICAvLyBTb3J0IHNvIHRoYXQgdGhlIG1vc3QgcmVjZW50IG5vdGlmaWNhdGlvbnMgYXJlIGZpcnN0XG4gICAgKGEsIGIpID0+IGIubm90aWZpZWRBdC5nZXRUaW1lKCkgLSBhLm5vdGlmaWVkQXQuZ2V0VGltZSgpXG4gICk7XG59XG5cbi8vIHNyYy9saWIvcmV0cnktZXJyb3IudHNcbmltcG9ydCB7IHdhaXQgfSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xudmFyIE1BWF9FUlJPUl9SRVRSWV9DT1VOVCA9IDU7XG52YXIgRVJST1JfUkVUUllfSU5URVJWQUwgPSA1ZTM7XG5mdW5jdGlvbiByZXRyeUVycm9yKGFjdGlvbiwgcmV0cnlDb3VudCkge1xuICBpZiAocmV0cnlDb3VudCA+PSBNQVhfRVJST1JfUkVUUllfQ09VTlQpIHJldHVybjtcbiAgY29uc3QgdGltZW91dCA9IE1hdGgucG93KDIsIHJldHJ5Q291bnQpICogRVJST1JfUkVUUllfSU5URVJWQUw7XG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIHZvaWQgYWN0aW9uKCk7XG4gIH0sIHRpbWVvdXQpO1xufVxuYXN5bmMgZnVuY3Rpb24gYXV0b1JldHJ5KHByb21pc2VGbiwgbWF4VHJpZXMsIGJhY2tvZmYpIHtcbiAgY29uc3QgZmFsbGJhY2tCYWNrb2ZmID0gYmFja29mZi5sZW5ndGggPiAwID8gYmFja29mZltiYWNrb2ZmLmxlbmd0aCAtIDFdIDogMDtcbiAgbGV0IGF0dGVtcHQgPSAwO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGF0dGVtcHQrKztcbiAgICBjb25zdCBwcm9taXNlID0gcHJvbWlzZUZuKCk7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBwcm9taXNlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGF0dGVtcHQgPj0gbWF4VHJpZXMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgYWZ0ZXIgJHttYXhUcmllc30gYXR0ZW1wdHM6ICR7U3RyaW5nKGVycil9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGRlbGF5ID0gYmFja29mZlthdHRlbXB0IC0gMV0gPz8gZmFsbGJhY2tCYWNrb2ZmO1xuICAgIGF3YWl0IHdhaXQoZGVsYXkpO1xuICB9XG59XG5cbi8vIHNyYy9saWIvdXNlLWluaXRpYWwudHNcbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VSZWR1Y2VyIH0gZnJvbSBcInJlYWN0XCI7XG5cbi8vIHNyYy9saWIvdXNlLWxhdGVzdC50c1xuaW1wb3J0IHsgdXNlRWZmZWN0IGFzIHVzZUVmZmVjdDIsIHVzZVJlZiB9IGZyb20gXCJyZWFjdFwiO1xuZnVuY3Rpb24gdXNlTGF0ZXN0KHZhbHVlKSB7XG4gIGNvbnN0IHJlZiA9IHVzZVJlZih2YWx1ZSk7XG4gIHVzZUVmZmVjdDIoKCkgPT4ge1xuICAgIHJlZi5jdXJyZW50ID0gdmFsdWU7XG4gIH0sIFt2YWx1ZV0pO1xuICByZXR1cm4gcmVmO1xufVxuXG4vLyBzcmMvbGliL3VzZS1pbml0aWFsLnRzXG52YXIgbm9vcCA9IChzdGF0ZSkgPT4gc3RhdGU7XG5mdW5jdGlvbiB1c2VJbml0aWFsKHZhbHVlKSB7XG4gIHJldHVybiB1c2VSZWR1Y2VyKG5vb3AsIHZhbHVlKVswXTtcbn1cbmZ1bmN0aW9uIHVzZUluaXRpYWxVbmxlc3NGdW5jdGlvbihsYXRlc3RWYWx1ZSkge1xuICBjb25zdCBmcm96ZW5WYWx1ZSA9IHVzZUluaXRpYWwobGF0ZXN0VmFsdWUpO1xuICBpZiAodHlwZW9mIGZyb3plblZhbHVlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBjb25zdCByZWYgPSB1c2VMYXRlc3QobGF0ZXN0VmFsdWUpO1xuICAgIHJldHVybiB1c2VDYWxsYmFjaygoLi4uYXJncykgPT4gcmVmLmN1cnJlbnQoLi4uYXJncyksIFtcbiAgICAgIHJlZlxuICAgIF0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmcm96ZW5WYWx1ZTtcbiAgfVxufVxuXG4vLyBzcmMvbGliL3VzZS1wb2x5ZmlsbC50c1xudmFyIHVzZSA9IChcbiAgLy8gUmVhY3QudXNlIHx8XG4gIChwcm9taXNlKSA9PiB7XG4gICAgaWYgKHByb21pc2Uuc3RhdHVzID09PSBcInBlbmRpbmdcIikge1xuICAgICAgdGhyb3cgcHJvbWlzZTtcbiAgICB9IGVsc2UgaWYgKHByb21pc2Uuc3RhdHVzID09PSBcImZ1bGZpbGxlZFwiKSB7XG4gICAgICByZXR1cm4gcHJvbWlzZS52YWx1ZTtcbiAgICB9IGVsc2UgaWYgKHByb21pc2Uuc3RhdHVzID09PSBcInJlamVjdGVkXCIpIHtcbiAgICAgIHRocm93IHByb21pc2UucmVhc29uO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcm9taXNlLnN0YXR1cyA9IFwicGVuZGluZ1wiO1xuICAgICAgcHJvbWlzZS50aGVuKFxuICAgICAgICAodikgPT4ge1xuICAgICAgICAgIHByb21pc2Uuc3RhdHVzID0gXCJmdWxmaWxsZWRcIjtcbiAgICAgICAgICBwcm9taXNlLnZhbHVlID0gdjtcbiAgICAgICAgfSxcbiAgICAgICAgKGUpID0+IHtcbiAgICAgICAgICBwcm9taXNlLnN0YXR1cyA9IFwicmVqZWN0ZWRcIjtcbiAgICAgICAgICBwcm9taXNlLnJlYXNvbiA9IGU7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aHJvdyBwcm9taXNlO1xuICAgIH1cbiAgfVxuKTtcblxuLy8gc3JjL2xpdmVibG9ja3MudHN4XG52YXIgQ2xpZW50Q29udGV4dCA9IGNyZWF0ZUNvbnRleHQobnVsbCk7XG5mdW5jdGlvbiBtaXNzaW5nVXNlckVycm9yKHVzZXJJZCkge1xuICByZXR1cm4gbmV3IEVycm9yKGByZXNvbHZlVXNlcnMgZGlkbid0IHJldHVybiBhbnl0aGluZyBmb3IgdXNlciAnJHt1c2VySWR9J2ApO1xufVxuZnVuY3Rpb24gbWlzc2luZ1Jvb21JbmZvRXJyb3Iocm9vbUlkKSB7XG4gIHJldHVybiBuZXcgRXJyb3IoXG4gICAgYHJlc29sdmVSb29tc0luZm8gZGlkbid0IHJldHVybiBhbnl0aGluZyBmb3Igcm9vbSAnJHtyb29tSWR9J2BcbiAgKTtcbn1cbnZhciBfZXh0cmFzID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7XG52YXIgX2J1bmRsZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBQT0xMSU5HX0lOVEVSVkFMID0gNjAgKiAxZTM7XG52YXIgSU5CT1hfTk9USUZJQ0FUSU9OU19RVUVSWSA9IFwiSU5CT1hfTk9USUZJQ0FUSU9OU1wiO1xuZnVuY3Rpb24gc2VsZWN0b3JGb3JfdXNlSW5ib3hOb3RpZmljYXRpb25zKHN0YXRlKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gc3RhdGUucXVlcmllc1tJTkJPWF9OT1RJRklDQVRJT05TX1FVRVJZXTtcbiAgaWYgKHF1ZXJ5ID09PSB2b2lkIDAgfHwgcXVlcnkuaXNMb2FkaW5nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzTG9hZGluZzogdHJ1ZVxuICAgIH07XG4gIH1cbiAgaWYgKHF1ZXJ5LmVycm9yICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3I6IHF1ZXJ5LmVycm9yLFxuICAgICAgaXNMb2FkaW5nOiBmYWxzZVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHNlbGVjdGVkSW5ib3hOb3RpZmljYXRpb25zKHN0YXRlKSxcbiAgICBpc0xvYWRpbmc6IGZhbHNlXG4gIH07XG59XG5mdW5jdGlvbiBzZWxlY3RVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudChzdGF0ZSkge1xuICBsZXQgY291bnQgPSAwO1xuICBmb3IgKGNvbnN0IG5vdGlmaWNhdGlvbiBvZiBzZWxlY3RlZEluYm94Tm90aWZpY2F0aW9ucyhzdGF0ZSkpIHtcbiAgICBpZiAobm90aWZpY2F0aW9uLnJlYWRBdCA9PT0gbnVsbCB8fCBub3RpZmljYXRpb24ucmVhZEF0IDwgbm90aWZpY2F0aW9uLm5vdGlmaWVkQXQpIHtcbiAgICAgIGNvdW50Kys7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb3VudDtcbn1cbmZ1bmN0aW9uIHNlbGVjdG9yRm9yX3VzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50KHN0YXRlKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gc3RhdGUucXVlcmllc1tJTkJPWF9OT1RJRklDQVRJT05TX1FVRVJZXTtcbiAgaWYgKHF1ZXJ5ID09PSB2b2lkIDAgfHwgcXVlcnkuaXNMb2FkaW5nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzTG9hZGluZzogdHJ1ZVxuICAgIH07XG4gIH1cbiAgaWYgKHF1ZXJ5LmVycm9yICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3I6IHF1ZXJ5LmVycm9yLFxuICAgICAgaXNMb2FkaW5nOiBmYWxzZVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgIGNvdW50OiBzZWxlY3RVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudChzdGF0ZSlcbiAgfTtcbn1cbmZ1bmN0aW9uIHNlbGVjdG9yRm9yX3VzZVVzZXIoc3RhdGUsIHVzZXJJZCkge1xuICBpZiAoc3RhdGUgPT09IHZvaWQgMCB8fCBzdGF0ZT8uaXNMb2FkaW5nKSB7XG4gICAgcmV0dXJuIHN0YXRlID8/IHsgaXNMb2FkaW5nOiB0cnVlIH07XG4gIH1cbiAgaWYgKHN0YXRlLmVycm9yKSB7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG4gIGlmICghc3RhdGUuZGF0YSkge1xuICAgIHJldHVybiB7XG4gICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgZXJyb3I6IG1pc3NpbmdVc2VyRXJyb3IodXNlcklkKVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgIHVzZXI6IHN0YXRlLmRhdGFcbiAgfTtcbn1cbmZ1bmN0aW9uIHNlbGVjdG9yRm9yX3VzZVJvb21JbmZvKHN0YXRlLCByb29tSWQpIHtcbiAgaWYgKHN0YXRlID09PSB2b2lkIDAgfHwgc3RhdGU/LmlzTG9hZGluZykge1xuICAgIHJldHVybiBzdGF0ZSA/PyB7IGlzTG9hZGluZzogdHJ1ZSB9O1xuICB9XG4gIGlmIChzdGF0ZS5lcnJvcikge1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuICBpZiAoIXN0YXRlLmRhdGEpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgIGVycm9yOiBtaXNzaW5nUm9vbUluZm9FcnJvcihyb29tSWQpXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgaW5mbzogc3RhdGUuZGF0YVxuICB9O1xufVxuZnVuY3Rpb24gZ2V0T3JDcmVhdGVDb250ZXh0QnVuZGxlKGNsaWVudCkge1xuICBsZXQgYnVuZGxlID0gX2J1bmRsZXMuZ2V0KGNsaWVudCk7XG4gIGlmICghYnVuZGxlKSB7XG4gICAgYnVuZGxlID0gbWFrZUxpdmVibG9ja3NDb250ZXh0QnVuZGxlKGNsaWVudCk7XG4gICAgX2J1bmRsZXMuc2V0KGNsaWVudCwgYnVuZGxlKTtcbiAgfVxuICByZXR1cm4gYnVuZGxlO1xufVxuZnVuY3Rpb24gZ2V0RXh0cmFzRm9yQ2xpZW50KGNsaWVudCkge1xuICBsZXQgZXh0cmFzID0gX2V4dHJhcy5nZXQoY2xpZW50KTtcbiAgaWYgKCFleHRyYXMpIHtcbiAgICBleHRyYXMgPSBtYWtlRXh0cmFzRm9yQ2xpZW50KGNsaWVudCk7XG4gICAgX2V4dHJhcy5zZXQoY2xpZW50LCBleHRyYXMpO1xuICB9XG4gIHJldHVybiBleHRyYXM7XG59XG5mdW5jdGlvbiBtYWtlRXh0cmFzRm9yQ2xpZW50KGNsaWVudCkge1xuICBjb25zdCBpbnRlcm5hbHMgPSBjbGllbnRba0ludGVybmFsXTtcbiAgY29uc3Qgc3RvcmUgPSBpbnRlcm5hbHMuY2FjaGVTdG9yZTtcbiAgbGV0IGxhc3RSZXF1ZXN0ZWRBdDtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hJbmJveE5vdGlmaWNhdGlvbnMoKSB7XG4gICAgaWYgKGxhc3RSZXF1ZXN0ZWRBdCA9PT0gdm9pZCAwKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQuZ2V0SW5ib3hOb3RpZmljYXRpb25zKCk7XG4gICAgICBzdG9yZS51cGRhdGVUaHJlYWRzQW5kTm90aWZpY2F0aW9ucyhcbiAgICAgICAgcmVzdWx0LnRocmVhZHMsXG4gICAgICAgIHJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgIFtdLFxuICAgICAgICBbXSxcbiAgICAgICAgSU5CT1hfTk9USUZJQ0FUSU9OU19RVUVSWVxuICAgICAgKTtcbiAgICAgIGxhc3RSZXF1ZXN0ZWRBdCA9IHJlc3VsdC5yZXF1ZXN0ZWRBdDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50LmdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlKHtcbiAgICAgICAgc2luY2U6IGxhc3RSZXF1ZXN0ZWRBdFxuICAgICAgfSk7XG4gICAgICBzdG9yZS51cGRhdGVUaHJlYWRzQW5kTm90aWZpY2F0aW9ucyhcbiAgICAgICAgcmVzdWx0LnRocmVhZHMudXBkYXRlZCxcbiAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9ucy51cGRhdGVkLFxuICAgICAgICByZXN1bHQudGhyZWFkcy5kZWxldGVkLFxuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zLmRlbGV0ZWQsXG4gICAgICAgIElOQk9YX05PVElGSUNBVElPTlNfUVVFUllcbiAgICAgICk7XG4gICAgICBpZiAobGFzdFJlcXVlc3RlZEF0IDwgcmVzdWx0LnJlcXVlc3RlZEF0KSB7XG4gICAgICAgIGxhc3RSZXF1ZXN0ZWRBdCA9IHJlc3VsdC5yZXF1ZXN0ZWRBdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgbGV0IHBvbGxlclN1YnNjcmliZXJzID0gMDtcbiAgY29uc3QgcG9sbGVyID0gbWFrZVBvbGxlcihhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRVbnRpbEluYm94Tm90aWZpY2F0aW9uc0xvYWRlZCgpO1xuICAgICAgYXdhaXQgZmV0Y2hJbmJveE5vdGlmaWNhdGlvbnMoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUud2FybihgUG9sbGluZyBuZXcgaW5ib3ggbm90aWZpY2F0aW9ucyBmYWlsZWQ6ICR7U3RyaW5nKGVycil9YCk7XG4gICAgfVxuICB9KTtcbiAgY29uc3Qgd2FpdFVudGlsSW5ib3hOb3RpZmljYXRpb25zTG9hZGVkID0gbWVtb2l6ZU9uU3VjY2Vzcyhhc3luYyAoKSA9PiB7XG4gICAgc3RvcmUuc2V0UXVlcnlTdGF0ZShJTkJPWF9OT1RJRklDQVRJT05TX1FVRVJZLCB7XG4gICAgICBpc0xvYWRpbmc6IHRydWVcbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgYXV0b1JldHJ5KFxuICAgICAgICAoKSA9PiBmZXRjaEluYm94Tm90aWZpY2F0aW9ucygpLFxuICAgICAgICA1LFxuICAgICAgICBbNWUzLCA1ZTMsIDFlNCwgMTVlM11cbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBzdG9yZS5zZXRRdWVyeVN0YXRlKElOQk9YX05PVElGSUNBVElPTlNfUVVFUlksIHtcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVyclxuICAgICAgfSk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9KTtcbiAgZnVuY3Rpb24gbG9hZEluYm94Tm90aWZpY2F0aW9ucygpIHtcbiAgICB2b2lkIHdhaXRVbnRpbEluYm94Tm90aWZpY2F0aW9uc0xvYWRlZCgpLmNhdGNoKCgpID0+IHtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiB1c2VFbmFibGVJbmJveE5vdGlmaWNhdGlvbnNQb2xsaW5nKCkge1xuICAgIHVzZUVmZmVjdDMoKCkgPT4ge1xuICAgICAgcG9sbGVyU3Vic2NyaWJlcnMrKztcbiAgICAgIHBvbGxlci5zdGFydChQT0xMSU5HX0lOVEVSVkFMKTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGlmIChwb2xsZXJTdWJzY3JpYmVycyA8PSAwKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgYEludGVybmFsIHVuZXhwZWN0ZWQgYmVoYXZpb3IuIENhbm5vdCBkZWNyZWFzZSBzdWJzY3JpYmVyIGNvdW50IGZvciBxdWVyeSBcIiR7SU5CT1hfTk9USUZJQ0FUSU9OU19RVUVSWX1cImBcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBwb2xsZXJTdWJzY3JpYmVycy0tO1xuICAgICAgICBpZiAocG9sbGVyU3Vic2NyaWJlcnMgPD0gMCkge1xuICAgICAgICAgIHBvbGxlci5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSwgW10pO1xuICB9XG4gIHJldHVybiB7XG4gICAgc3RvcmUsXG4gICAgdXNlRW5hYmxlSW5ib3hOb3RpZmljYXRpb25zUG9sbGluZyxcbiAgICB3YWl0VW50aWxJbmJveE5vdGlmaWNhdGlvbnNMb2FkZWQsXG4gICAgbG9hZEluYm94Tm90aWZpY2F0aW9uc1xuICB9O1xufVxuZnVuY3Rpb24gbWFrZUxpdmVibG9ja3NDb250ZXh0QnVuZGxlKGNsaWVudCkge1xuICBjb25zdCB1c2VJbmJveE5vdGlmaWNhdGlvblRocmVhZDIgPSAoaW5ib3hOb3RpZmljYXRpb25JZCkgPT4gdXNlSW5ib3hOb3RpZmljYXRpb25UaHJlYWRfd2l0aENsaWVudChjbGllbnQsIGluYm94Tm90aWZpY2F0aW9uSWQpO1xuICBjb25zdCB1c2VNYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQyID0gKCkgPT4gdXNlTWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkX3dpdGhDbGllbnQoY2xpZW50KTtcbiAgY29uc3QgdXNlTWFya0FsbEluYm94Tm90aWZpY2F0aW9uc0FzUmVhZDIgPSAoKSA9PiB1c2VNYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkX3dpdGhDbGllbnQoY2xpZW50KTtcbiAgY29uc3QgdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb24yID0gKCkgPT4gdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb25fd2l0aENsaWVudChjbGllbnQpO1xuICBjb25zdCB1c2VEZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnMyID0gKCkgPT4gdXNlRGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zX3dpdGhDbGllbnQoY2xpZW50KTtcbiAgZnVuY3Rpb24gTGl2ZWJsb2Nrc1Byb3ZpZGVyMihwcm9wcykge1xuICAgIHVzZUVuc3VyZU5vTGl2ZWJsb2Nrc1Byb3ZpZGVyKCk7XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdDIuY3JlYXRlRWxlbWVudChDbGllbnRDb250ZXh0LlByb3ZpZGVyLCB7IHZhbHVlOiBjbGllbnQgfSwgcHJvcHMuY2hpbGRyZW4pO1xuICB9XG4gIGNvbnN0IHNoYXJlZCA9IGNyZWF0ZVNoYXJlZENvbnRleHQoY2xpZW50KTtcbiAgY29uc3QgYnVuZGxlID0ge1xuICAgIExpdmVibG9ja3NQcm92aWRlcjogTGl2ZWJsb2Nrc1Byb3ZpZGVyMixcbiAgICB1c2VJbmJveE5vdGlmaWNhdGlvbnM6ICgpID0+IHVzZUluYm94Tm90aWZpY2F0aW9uc193aXRoQ2xpZW50KGNsaWVudCksXG4gICAgdXNlVW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQ6ICgpID0+IHVzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50X3dpdGhDbGllbnQoY2xpZW50KSxcbiAgICB1c2VNYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQ6IHVzZU1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZDIsXG4gICAgdXNlTWFya0FsbEluYm94Tm90aWZpY2F0aW9uc0FzUmVhZDogdXNlTWFya0FsbEluYm94Tm90aWZpY2F0aW9uc0FzUmVhZDIsXG4gICAgdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb246IHVzZURlbGV0ZUluYm94Tm90aWZpY2F0aW9uMixcbiAgICB1c2VEZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnM6IHVzZURlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9uczIsXG4gICAgdXNlSW5ib3hOb3RpZmljYXRpb25UaHJlYWQ6IHVzZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkMixcbiAgICAuLi5zaGFyZWQuY2xhc3NpYyxcbiAgICBzdXNwZW5zZToge1xuICAgICAgTGl2ZWJsb2Nrc1Byb3ZpZGVyOiBMaXZlYmxvY2tzUHJvdmlkZXIyLFxuICAgICAgdXNlSW5ib3hOb3RpZmljYXRpb25zOiAoKSA9PiB1c2VJbmJveE5vdGlmaWNhdGlvbnNTdXNwZW5zZV93aXRoQ2xpZW50KGNsaWVudCksXG4gICAgICB1c2VVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudDogKCkgPT4gdXNlVW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnRTdXNwZW5zZV93aXRoQ2xpZW50KGNsaWVudCksXG4gICAgICB1c2VNYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQ6IHVzZU1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZDIsXG4gICAgICB1c2VNYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkOiB1c2VNYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkMixcbiAgICAgIHVzZURlbGV0ZUluYm94Tm90aWZpY2F0aW9uOiB1c2VEZWxldGVJbmJveE5vdGlmaWNhdGlvbjIsXG4gICAgICB1c2VEZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnM6IHVzZURlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9uczIsXG4gICAgICB1c2VJbmJveE5vdGlmaWNhdGlvblRocmVhZDogdXNlSW5ib3hOb3RpZmljYXRpb25UaHJlYWQyLFxuICAgICAgLi4uc2hhcmVkLnN1c3BlbnNlXG4gICAgfVxuICB9O1xuICByZXR1cm4gYnVuZGxlO1xufVxuZnVuY3Rpb24gdXNlSW5ib3hOb3RpZmljYXRpb25zX3dpdGhDbGllbnQoY2xpZW50KSB7XG4gIGNvbnN0IHsgbG9hZEluYm94Tm90aWZpY2F0aW9ucywgc3RvcmUsIHVzZUVuYWJsZUluYm94Tm90aWZpY2F0aW9uc1BvbGxpbmcgfSA9IGdldEV4dHJhc0ZvckNsaWVudChjbGllbnQpO1xuICB1c2VFZmZlY3QzKCgpID0+IHtcbiAgICBsb2FkSW5ib3hOb3RpZmljYXRpb25zKCk7XG4gIH0sIFtsb2FkSW5ib3hOb3RpZmljYXRpb25zXSk7XG4gIHVzZUVuYWJsZUluYm94Tm90aWZpY2F0aW9uc1BvbGxpbmcoKTtcbiAgcmV0dXJuIHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yKFxuICAgIHN0b3JlLnN1YnNjcmliZSxcbiAgICBzdG9yZS5nZXQsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHNlbGVjdG9yRm9yX3VzZUluYm94Tm90aWZpY2F0aW9ucyxcbiAgICBzaGFsbG93XG4gICk7XG59XG5mdW5jdGlvbiB1c2VJbmJveE5vdGlmaWNhdGlvbnNTdXNwZW5zZV93aXRoQ2xpZW50KGNsaWVudCkge1xuICBjb25zdCB7IHdhaXRVbnRpbEluYm94Tm90aWZpY2F0aW9uc0xvYWRlZCB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50KGNsaWVudCk7XG4gIHVzZSh3YWl0VW50aWxJbmJveE5vdGlmaWNhdGlvbnNMb2FkZWQoKSk7XG4gIGNvbnN0IHJlc3VsdCA9IHVzZUluYm94Tm90aWZpY2F0aW9uc193aXRoQ2xpZW50KGNsaWVudCk7XG4gIGFzc2VydCghcmVzdWx0LmVycm9yLCBcIkRpZCBub3QgZXhwZWN0IGVycm9yXCIpO1xuICBhc3NlcnQoIXJlc3VsdC5pc0xvYWRpbmcsIFwiRGlkIG5vdCBleHBlY3QgbG9hZGluZ1wiKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIHVzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50X3dpdGhDbGllbnQoY2xpZW50KSB7XG4gIGNvbnN0IHsgc3RvcmUsIGxvYWRJbmJveE5vdGlmaWNhdGlvbnMsIHVzZUVuYWJsZUluYm94Tm90aWZpY2F0aW9uc1BvbGxpbmcgfSA9IGdldEV4dHJhc0ZvckNsaWVudChjbGllbnQpO1xuICB1c2VFZmZlY3QzKCgpID0+IHtcbiAgICBsb2FkSW5ib3hOb3RpZmljYXRpb25zKCk7XG4gIH0sIFtsb2FkSW5ib3hOb3RpZmljYXRpb25zXSk7XG4gIHVzZUVuYWJsZUluYm94Tm90aWZpY2F0aW9uc1BvbGxpbmcoKTtcbiAgcmV0dXJuIHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yKFxuICAgIHN0b3JlLnN1YnNjcmliZSxcbiAgICBzdG9yZS5nZXQsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHNlbGVjdG9yRm9yX3VzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50LFxuICAgIHNoYWxsb3dcbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50U3VzcGVuc2Vfd2l0aENsaWVudChjbGllbnQpIHtcbiAgY29uc3QgeyB3YWl0VW50aWxJbmJveE5vdGlmaWNhdGlvbnNMb2FkZWQgfSA9IGdldEV4dHJhc0ZvckNsaWVudChjbGllbnQpO1xuICB1c2Uod2FpdFVudGlsSW5ib3hOb3RpZmljYXRpb25zTG9hZGVkKCkpO1xuICBjb25zdCByZXN1bHQgPSB1c2VVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudF93aXRoQ2xpZW50KGNsaWVudCk7XG4gIGFzc2VydCghcmVzdWx0LmlzTG9hZGluZywgXCJEaWQgbm90IGV4cGVjdCBsb2FkaW5nXCIpO1xuICBhc3NlcnQoIXJlc3VsdC5lcnJvciwgXCJEaWQgbm90IGV4cGVjdCBlcnJvclwiKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIHVzZU1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZF93aXRoQ2xpZW50KGNsaWVudCkge1xuICByZXR1cm4gdXNlQ2FsbGJhY2syKFxuICAgIChpbmJveE5vdGlmaWNhdGlvbklkKSA9PiB7XG4gICAgICBjb25zdCB7IHN0b3JlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQoY2xpZW50KTtcbiAgICAgIGNvbnN0IG9wdGltaXN0aWNVcGRhdGVJZCA9IG5hbm9pZCgpO1xuICAgICAgY29uc3QgcmVhZEF0ID0gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCk7XG4gICAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICAgIHR5cGU6IFwibWFyay1pbmJveC1ub3RpZmljYXRpb24tYXMtcmVhZFwiLFxuICAgICAgICBpZDogb3B0aW1pc3RpY1VwZGF0ZUlkLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbklkLFxuICAgICAgICByZWFkQXRcbiAgICAgIH0pO1xuICAgICAgY2xpZW50Lm1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZChpbmJveE5vdGlmaWNhdGlvbklkKS50aGVuKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdOb3RpZmljYXRpb24gPSBzdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnNbaW5ib3hOb3RpZmljYXRpb25JZF07XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdOb3RpZmljYXRpb24gPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgICAgICAgW2luYm94Tm90aWZpY2F0aW9uSWRdOiB7XG4gICAgICAgICAgICAgICAgICAuLi5leGlzdGluZ05vdGlmaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgIHJlYWRBdFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzLmZpbHRlcihcbiAgICAgICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzLmZpbHRlcihcbiAgICAgICAgICAgICAgKHVwZGF0ZSkgPT4gdXBkYXRlLmlkICE9PSBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcbiAgICBbY2xpZW50XVxuICApO1xufVxuZnVuY3Rpb24gdXNlTWFya0FsbEluYm94Tm90aWZpY2F0aW9uc0FzUmVhZF93aXRoQ2xpZW50KGNsaWVudCkge1xuICByZXR1cm4gdXNlQ2FsbGJhY2syKCgpID0+IHtcbiAgICBjb25zdCB7IHN0b3JlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQoY2xpZW50KTtcbiAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQoKTtcbiAgICBjb25zdCByZWFkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICB0eXBlOiBcIm1hcmstYWxsLWluYm94LW5vdGlmaWNhdGlvbnMtYXMtcmVhZFwiLFxuICAgICAgaWQ6IG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgIHJlYWRBdFxuICAgIH0pO1xuICAgIGNsaWVudC5tYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkKCkudGhlbihcbiAgICAgICgpID0+IHtcbiAgICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgICAgIEFycmF5LmZyb20oT2JqZWN0LmVudHJpZXMoc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zKSkubWFwKFxuICAgICAgICAgICAgICAoW2lkLCBpbmJveE5vdGlmaWNhdGlvbl0pID0+IFtcbiAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgICB7IC4uLmluYm94Tm90aWZpY2F0aW9uLCByZWFkQXQgfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogc3RhdGUub3B0aW1pc3RpY1VwZGF0ZXMuZmlsdGVyKFxuICAgICAgICAgICAgKHVwZGF0ZSkgPT4gdXBkYXRlLmlkICE9PSBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgICAgICApXG4gICAgICAgIH0pKTtcbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzLmZpbHRlcihcbiAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgKVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgKTtcbiAgfSwgW2NsaWVudF0pO1xufVxuZnVuY3Rpb24gdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb25fd2l0aENsaWVudChjbGllbnQpIHtcbiAgcmV0dXJuIHVzZUNhbGxiYWNrMihcbiAgICAoaW5ib3hOb3RpZmljYXRpb25JZCkgPT4ge1xuICAgICAgY29uc3QgeyBzdG9yZSB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50KGNsaWVudCk7XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQoKTtcbiAgICAgIGNvbnN0IGRlbGV0ZWRBdCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgICAgc3RvcmUucHVzaE9wdGltaXN0aWNVcGRhdGUoe1xuICAgICAgICB0eXBlOiBcImRlbGV0ZS1pbmJveC1ub3RpZmljYXRpb25cIixcbiAgICAgICAgaWQ6IG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25JZCxcbiAgICAgICAgZGVsZXRlZEF0XG4gICAgICB9KTtcbiAgICAgIGNsaWVudC5kZWxldGVJbmJveE5vdGlmaWNhdGlvbihpbmJveE5vdGlmaWNhdGlvbklkKS50aGVuKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdOb3RpZmljYXRpb24gPSBzdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnNbaW5ib3hOb3RpZmljYXRpb25JZF07XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdOb3RpZmljYXRpb24gPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgW2luYm94Tm90aWZpY2F0aW9uSWRdOiBfLCAuLi5pbmJveE5vdGlmaWNhdGlvbnMgfSA9IHN0YXRlLmluYm94Tm90aWZpY2F0aW9ucztcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgKHVwZGF0ZSkgPT4gdXBkYXRlLmlkICE9PSBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApXG4gICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudF1cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZURlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9uc193aXRoQ2xpZW50KGNsaWVudCkge1xuICByZXR1cm4gdXNlQ2FsbGJhY2syKCgpID0+IHtcbiAgICBjb25zdCB7IHN0b3JlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQoY2xpZW50KTtcbiAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQoKTtcbiAgICBjb25zdCBkZWxldGVkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZS1hbGwtaW5ib3gtbm90aWZpY2F0aW9uc1wiLFxuICAgICAgaWQ6IG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgIGRlbGV0ZWRBdFxuICAgIH0pO1xuICAgIGNsaWVudC5kZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnMoKS50aGVuKFxuICAgICAgKCkgPT4ge1xuICAgICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIGluYm94Tm90aWZpY2F0aW9uczoge30sXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzLmZpbHRlcihcbiAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgKVxuICAgICAgICB9KSk7XG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgIClcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICk7XG4gIH0sIFtjbGllbnRdKTtcbn1cbmZ1bmN0aW9uIHVzZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkX3dpdGhDbGllbnQoY2xpZW50LCBpbmJveE5vdGlmaWNhdGlvbklkKSB7XG4gIGNvbnN0IHsgc3RvcmUgfSA9IGdldEV4dHJhc0ZvckNsaWVudChjbGllbnQpO1xuICBjb25zdCBzZWxlY3RvciA9IHVzZUNhbGxiYWNrMihcbiAgICAoc3RhdGUpID0+IHtcbiAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uID0gc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zW2luYm94Tm90aWZpY2F0aW9uSWRdID8/IHJhaXNlKGBJbmJveCBub3RpZmljYXRpb24gd2l0aCBJRCBcIiR7aW5ib3hOb3RpZmljYXRpb25JZH1cIiBub3QgZm91bmRgKTtcbiAgICAgIGlmIChpbmJveE5vdGlmaWNhdGlvbi5raW5kICE9PSBcInRocmVhZFwiKSB7XG4gICAgICAgIHJhaXNlKFxuICAgICAgICAgIGBJbmJveCBub3RpZmljYXRpb24gd2l0aCBJRCBcIiR7aW5ib3hOb3RpZmljYXRpb25JZH1cIiBpcyBub3Qgb2Yga2luZCBcInRocmVhZFwiYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgdGhyZWFkID0gc3RhdGUudGhyZWFkc1tpbmJveE5vdGlmaWNhdGlvbi50aHJlYWRJZF0gPz8gcmFpc2UoXG4gICAgICAgIGBUaHJlYWQgd2l0aCBJRCBcIiR7aW5ib3hOb3RpZmljYXRpb24udGhyZWFkSWR9XCIgbm90IGZvdW5kLCB0aGlzIGluYm94IG5vdGlmaWNhdGlvbiBtaWdodCBub3QgYmUgb2Yga2luZCBcInRocmVhZFwiYFxuICAgICAgKTtcbiAgICAgIHJldHVybiB0aHJlYWQ7XG4gICAgfSxcbiAgICBbaW5ib3hOb3RpZmljYXRpb25JZF1cbiAgKTtcbiAgcmV0dXJuIHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yKFxuICAgIHN0b3JlLnN1YnNjcmliZSxcbiAgICBzdG9yZS5nZXQsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHNlbGVjdG9yXG4gICk7XG59XG5mdW5jdGlvbiB1c2VVc2VyX3dpdGhDbGllbnQoY2xpZW50LCB1c2VySWQpIHtcbiAgY29uc3QgdXNlcnNTdG9yZSA9IGNsaWVudFtrSW50ZXJuYWxdLnVzZXJzU3RvcmU7XG4gIGNvbnN0IGdldFVzZXJTdGF0ZSA9IHVzZUNhbGxiYWNrMihcbiAgICAoKSA9PiB1c2Vyc1N0b3JlLmdldFN0YXRlKHVzZXJJZCksXG4gICAgW3VzZXJzU3RvcmUsIHVzZXJJZF1cbiAgKTtcbiAgdXNlRWZmZWN0MygoKSA9PiB7XG4gICAgdm9pZCB1c2Vyc1N0b3JlLmdldCh1c2VySWQpO1xuICB9LCBbdXNlcnNTdG9yZSwgdXNlcklkXSk7XG4gIGNvbnN0IHNlbGVjdG9yID0gdXNlQ2FsbGJhY2syKFxuICAgIChzdGF0ZSkgPT4gc2VsZWN0b3JGb3JfdXNlVXNlcihzdGF0ZSwgdXNlcklkKSxcbiAgICBbdXNlcklkXVxuICApO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmVXaXRoU2VsZWN0b3IoXG4gICAgdXNlcnNTdG9yZS5zdWJzY3JpYmUsXG4gICAgZ2V0VXNlclN0YXRlLFxuICAgIGdldFVzZXJTdGF0ZSxcbiAgICBzZWxlY3RvcixcbiAgICBzaGFsbG93XG4gICk7XG59XG5mdW5jdGlvbiB1c2VVc2VyU3VzcGVuc2Vfd2l0aENsaWVudChjbGllbnQsIHVzZXJJZCkge1xuICBjb25zdCB1c2Vyc1N0b3JlID0gY2xpZW50W2tJbnRlcm5hbF0udXNlcnNTdG9yZTtcbiAgY29uc3QgZ2V0VXNlclN0YXRlID0gdXNlQ2FsbGJhY2syKFxuICAgICgpID0+IHVzZXJzU3RvcmUuZ2V0U3RhdGUodXNlcklkKSxcbiAgICBbdXNlcnNTdG9yZSwgdXNlcklkXVxuICApO1xuICBjb25zdCB1c2VyU3RhdGUgPSBnZXRVc2VyU3RhdGUoKTtcbiAgaWYgKCF1c2VyU3RhdGUgfHwgdXNlclN0YXRlLmlzTG9hZGluZykge1xuICAgIHRocm93IHVzZXJzU3RvcmUuZ2V0KHVzZXJJZCk7XG4gIH1cbiAgaWYgKHVzZXJTdGF0ZS5lcnJvcikge1xuICAgIHRocm93IHVzZXJTdGF0ZS5lcnJvcjtcbiAgfVxuICBpZiAoIXVzZXJTdGF0ZS5kYXRhKSB7XG4gICAgdGhyb3cgbWlzc2luZ1VzZXJFcnJvcih1c2VySWQpO1xuICB9XG4gIGNvbnN0IHN0YXRlID0gdXNlU3luY0V4dGVybmFsU3RvcmUoXG4gICAgdXNlcnNTdG9yZS5zdWJzY3JpYmUsXG4gICAgZ2V0VXNlclN0YXRlLFxuICAgIGdldFVzZXJTdGF0ZVxuICApO1xuICBhc3NlcnQoc3RhdGUgIT09IHZvaWQgMCwgXCJVbmV4cGVjdGVkIG1pc3Npbmcgc3RhdGVcIik7XG4gIGFzc2VydCghc3RhdGUuaXNMb2FkaW5nLCBcIlVuZXhwZWN0ZWQgbG9hZGluZyBzdGF0ZVwiKTtcbiAgYXNzZXJ0KCFzdGF0ZS5lcnJvciwgXCJVbmV4cGVjdGVkIGVycm9yIHN0YXRlXCIpO1xuICByZXR1cm4ge1xuICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgdXNlcjogc3RhdGUuZGF0YSxcbiAgICBlcnJvcjogdm9pZCAwXG4gIH07XG59XG5mdW5jdGlvbiB1c2VSb29tSW5mb193aXRoQ2xpZW50KGNsaWVudCwgcm9vbUlkKSB7XG4gIGNvbnN0IHJvb21zSW5mb1N0b3JlID0gY2xpZW50W2tJbnRlcm5hbF0ucm9vbXNJbmZvU3RvcmU7XG4gIGNvbnN0IGdldFJvb21JbmZvU3RhdGUgPSB1c2VDYWxsYmFjazIoXG4gICAgKCkgPT4gcm9vbXNJbmZvU3RvcmUuZ2V0U3RhdGUocm9vbUlkKSxcbiAgICBbcm9vbXNJbmZvU3RvcmUsIHJvb21JZF1cbiAgKTtcbiAgY29uc3Qgc2VsZWN0b3IgPSB1c2VDYWxsYmFjazIoXG4gICAgKHN0YXRlKSA9PiBzZWxlY3RvckZvcl91c2VSb29tSW5mbyhzdGF0ZSwgcm9vbUlkKSxcbiAgICBbcm9vbUlkXVxuICApO1xuICB1c2VFZmZlY3QzKCgpID0+IHtcbiAgICB2b2lkIHJvb21zSW5mb1N0b3JlLmdldChyb29tSWQpO1xuICB9LCBbcm9vbXNJbmZvU3RvcmUsIHJvb21JZF0pO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmVXaXRoU2VsZWN0b3IoXG4gICAgcm9vbXNJbmZvU3RvcmUuc3Vic2NyaWJlLFxuICAgIGdldFJvb21JbmZvU3RhdGUsXG4gICAgZ2V0Um9vbUluZm9TdGF0ZSxcbiAgICBzZWxlY3RvcixcbiAgICBzaGFsbG93XG4gICk7XG59XG5mdW5jdGlvbiB1c2VSb29tSW5mb1N1c3BlbnNlX3dpdGhDbGllbnQoY2xpZW50LCByb29tSWQpIHtcbiAgY29uc3Qgcm9vbXNJbmZvU3RvcmUgPSBjbGllbnRba0ludGVybmFsXS5yb29tc0luZm9TdG9yZTtcbiAgY29uc3QgZ2V0Um9vbUluZm9TdGF0ZSA9IHVzZUNhbGxiYWNrMihcbiAgICAoKSA9PiByb29tc0luZm9TdG9yZS5nZXRTdGF0ZShyb29tSWQpLFxuICAgIFtyb29tc0luZm9TdG9yZSwgcm9vbUlkXVxuICApO1xuICBjb25zdCByb29tSW5mb1N0YXRlID0gZ2V0Um9vbUluZm9TdGF0ZSgpO1xuICBpZiAoIXJvb21JbmZvU3RhdGUgfHwgcm9vbUluZm9TdGF0ZS5pc0xvYWRpbmcpIHtcbiAgICB0aHJvdyByb29tc0luZm9TdG9yZS5nZXQocm9vbUlkKTtcbiAgfVxuICBpZiAocm9vbUluZm9TdGF0ZS5lcnJvcikge1xuICAgIHRocm93IHJvb21JbmZvU3RhdGUuZXJyb3I7XG4gIH1cbiAgaWYgKCFyb29tSW5mb1N0YXRlLmRhdGEpIHtcbiAgICB0aHJvdyBtaXNzaW5nUm9vbUluZm9FcnJvcihyb29tSWQpO1xuICB9XG4gIGNvbnN0IHN0YXRlID0gdXNlU3luY0V4dGVybmFsU3RvcmUoXG4gICAgcm9vbXNJbmZvU3RvcmUuc3Vic2NyaWJlLFxuICAgIGdldFJvb21JbmZvU3RhdGUsXG4gICAgZ2V0Um9vbUluZm9TdGF0ZVxuICApO1xuICBhc3NlcnQoc3RhdGUgIT09IHZvaWQgMCwgXCJVbmV4cGVjdGVkIG1pc3Npbmcgc3RhdGVcIik7XG4gIGFzc2VydCghc3RhdGUuaXNMb2FkaW5nLCBcIlVuZXhwZWN0ZWQgbG9hZGluZyBzdGF0ZVwiKTtcbiAgYXNzZXJ0KCFzdGF0ZS5lcnJvciwgXCJVbmV4cGVjdGVkIGVycm9yIHN0YXRlXCIpO1xuICBhc3NlcnQoc3RhdGUuZGF0YSAhPT0gdm9pZCAwLCBcIlVuZXhwZWN0ZWQgbWlzc2luZyByb29tIGluZm8gZGF0YVwiKTtcbiAgcmV0dXJuIHtcbiAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgIGluZm86IHN0YXRlLmRhdGEsXG4gICAgZXJyb3I6IHZvaWQgMFxuICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlU2hhcmVkQ29udGV4dChjbGllbnQpIHtcbiAgY29uc3QgdXNlQ2xpZW50MiA9ICgpID0+IGNsaWVudDtcbiAgcmV0dXJuIHtcbiAgICBjbGFzc2ljOiB7XG4gICAgICB1c2VDbGllbnQ6IHVzZUNsaWVudDIsXG4gICAgICB1c2VVc2VyOiAodXNlcklkKSA9PiB1c2VVc2VyX3dpdGhDbGllbnQoY2xpZW50LCB1c2VySWQpLFxuICAgICAgdXNlUm9vbUluZm86IChyb29tSWQpID0+IHVzZVJvb21JbmZvX3dpdGhDbGllbnQoY2xpZW50LCByb29tSWQpXG4gICAgfSxcbiAgICBzdXNwZW5zZToge1xuICAgICAgdXNlQ2xpZW50OiB1c2VDbGllbnQyLFxuICAgICAgdXNlVXNlcjogKHVzZXJJZCkgPT4gdXNlVXNlclN1c3BlbnNlX3dpdGhDbGllbnQoY2xpZW50LCB1c2VySWQpLFxuICAgICAgdXNlUm9vbUluZm86IChyb29tSWQpID0+IHVzZVJvb21JbmZvU3VzcGVuc2Vfd2l0aENsaWVudChjbGllbnQsIHJvb21JZClcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiB1c2VFbnN1cmVOb0xpdmVibG9ja3NQcm92aWRlcihvcHRpb25zKSB7XG4gIGNvbnN0IGV4aXN0aW5nID0gdXNlQ2xpZW50T3JOdWxsKCk7XG4gIGlmICghb3B0aW9ucz8uYWxsb3dOZXN0aW5nICYmIGV4aXN0aW5nICE9PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJZb3UgY2Fubm90IG5lc3QgbXVsdGlwbGUgTGl2ZWJsb2Nrc1Byb3ZpZGVyIGluc3RhbmNlcyBpbiB0aGUgc2FtZSBSZWFjdCB0cmVlLlwiXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gdXNlQ2xpZW50T3JOdWxsKCkge1xuICByZXR1cm4gdXNlQ29udGV4dChDbGllbnRDb250ZXh0KTtcbn1cbmZ1bmN0aW9uIHVzZUNsaWVudCgpIHtcbiAgcmV0dXJuIHVzZUNsaWVudE9yTnVsbCgpID8/IHJhaXNlKFwiTGl2ZWJsb2Nrc1Byb3ZpZGVyIGlzIG1pc3NpbmcgZnJvbSB0aGUgUmVhY3QgdHJlZS5cIik7XG59XG5mdW5jdGlvbiBMaXZlYmxvY2tzUHJvdmlkZXJXaXRoQ2xpZW50KHByb3BzKSB7XG4gIHVzZUVuc3VyZU5vTGl2ZWJsb2Nrc1Byb3ZpZGVyKHByb3BzKTtcbiAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBSZWFjdDIuY3JlYXRlRWxlbWVudChDbGllbnRDb250ZXh0LlByb3ZpZGVyLCB7IHZhbHVlOiBwcm9wcy5jbGllbnQgfSwgcHJvcHMuY2hpbGRyZW4pO1xufVxuZnVuY3Rpb24gTGl2ZWJsb2Nrc1Byb3ZpZGVyKHByb3BzKSB7XG4gIGNvbnN0IHsgY2hpbGRyZW4sIC4uLm8gfSA9IHByb3BzO1xuICBjb25zdCBvcHRpb25zID0ge1xuICAgIHB1YmxpY0FwaUtleTogdXNlSW5pdGlhbChvLnB1YmxpY0FwaUtleSksXG4gICAgdGhyb3R0bGU6IHVzZUluaXRpYWwoby50aHJvdHRsZSksXG4gICAgbG9zdENvbm5lY3Rpb25UaW1lb3V0OiB1c2VJbml0aWFsKG8ubG9zdENvbm5lY3Rpb25UaW1lb3V0KSxcbiAgICBiYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dDogdXNlSW5pdGlhbChvLmJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0KSxcbiAgICBwb2x5ZmlsbHM6IHVzZUluaXRpYWwoby5wb2x5ZmlsbHMpLFxuICAgIHVuc3RhYmxlX2ZhbGxiYWNrVG9IVFRQOiB1c2VJbml0aWFsKG8udW5zdGFibGVfZmFsbGJhY2tUb0hUVFApLFxuICAgIHVuc3RhYmxlX3N0cmVhbURhdGE6IHVzZUluaXRpYWwoby51bnN0YWJsZV9zdHJlYW1EYXRhKSxcbiAgICBhdXRoRW5kcG9pbnQ6IHVzZUluaXRpYWxVbmxlc3NGdW5jdGlvbihvLmF1dGhFbmRwb2ludCksXG4gICAgcmVzb2x2ZU1lbnRpb25TdWdnZXN0aW9uczogdXNlSW5pdGlhbFVubGVzc0Z1bmN0aW9uKFxuICAgICAgby5yZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zXG4gICAgKSxcbiAgICByZXNvbHZlVXNlcnM6IHVzZUluaXRpYWxVbmxlc3NGdW5jdGlvbihvLnJlc29sdmVVc2VycyksXG4gICAgcmVzb2x2ZVJvb21zSW5mbzogdXNlSW5pdGlhbFVubGVzc0Z1bmN0aW9uKG8ucmVzb2x2ZVJvb21zSW5mbyksXG4gICAgYmFzZVVybDogdXNlSW5pdGlhbChcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBIaWRkZW4gY29uZmlnIG9wdGlvbnNcbiAgICAgIG8uYmFzZVVybFxuICAgICksXG4gICAgZW5hYmxlRGVidWdMb2dnaW5nOiB1c2VJbml0aWFsKFxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIEhpZGRlbiBjb25maWcgb3B0aW9uc1xuICAgICAgby5lbmFibGVEZWJ1Z0xvZ2dpbmdcbiAgICApXG4gIH07XG4gIGNvbnN0IGNsaWVudCA9IHVzZU1lbW8oKCkgPT4gY3JlYXRlQ2xpZW50KG9wdGlvbnMpLCBbXSk7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3QyLmNyZWF0ZUVsZW1lbnQoTGl2ZWJsb2Nrc1Byb3ZpZGVyV2l0aENsaWVudCwgeyBjbGllbnQgfSwgY2hpbGRyZW4pO1xufVxuZnVuY3Rpb24gY3JlYXRlTGl2ZWJsb2Nrc0NvbnRleHQoY2xpZW50KSB7XG4gIHJldHVybiBnZXRPckNyZWF0ZUNvbnRleHRCdW5kbGUoY2xpZW50KTtcbn1cbmZ1bmN0aW9uIHVzZUluYm94Tm90aWZpY2F0aW9ucygpIHtcbiAgcmV0dXJuIHVzZUluYm94Tm90aWZpY2F0aW9uc193aXRoQ2xpZW50KHVzZUNsaWVudCgpKTtcbn1cbmZ1bmN0aW9uIHVzZUluYm94Tm90aWZpY2F0aW9uc1N1c3BlbnNlKCkge1xuICByZXR1cm4gdXNlSW5ib3hOb3RpZmljYXRpb25zU3VzcGVuc2Vfd2l0aENsaWVudCh1c2VDbGllbnQoKSk7XG59XG5mdW5jdGlvbiB1c2VJbmJveE5vdGlmaWNhdGlvblRocmVhZChpbmJveE5vdGlmaWNhdGlvbklkKSB7XG4gIHJldHVybiB1c2VJbmJveE5vdGlmaWNhdGlvblRocmVhZF93aXRoQ2xpZW50KFxuICAgIHVzZUNsaWVudCgpLFxuICAgIGluYm94Tm90aWZpY2F0aW9uSWRcbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZU1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoKSB7XG4gIHJldHVybiB1c2VNYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkX3dpdGhDbGllbnQodXNlQ2xpZW50KCkpO1xufVxuZnVuY3Rpb24gdXNlTWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkKCkge1xuICByZXR1cm4gdXNlTWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkX3dpdGhDbGllbnQodXNlQ2xpZW50KCkpO1xufVxuZnVuY3Rpb24gdXNlRGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zKCkge1xuICByZXR1cm4gdXNlRGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zX3dpdGhDbGllbnQodXNlQ2xpZW50KCkpO1xufVxuZnVuY3Rpb24gdXNlRGVsZXRlSW5ib3hOb3RpZmljYXRpb24oKSB7XG4gIHJldHVybiB1c2VEZWxldGVJbmJveE5vdGlmaWNhdGlvbl93aXRoQ2xpZW50KHVzZUNsaWVudCgpKTtcbn1cbmZ1bmN0aW9uIHVzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50KCkge1xuICByZXR1cm4gdXNlVW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnRfd2l0aENsaWVudCh1c2VDbGllbnQoKSk7XG59XG5mdW5jdGlvbiB1c2VVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudFN1c3BlbnNlKCkge1xuICByZXR1cm4gdXNlVW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnRTdXNwZW5zZV93aXRoQ2xpZW50KHVzZUNsaWVudCgpKTtcbn1cbmZ1bmN0aW9uIHVzZVVzZXIodXNlcklkKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICByZXR1cm4gdXNlVXNlcl93aXRoQ2xpZW50KGNsaWVudCwgdXNlcklkKTtcbn1cbmZ1bmN0aW9uIHVzZVVzZXJTdXNwZW5zZSh1c2VySWQpIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIHJldHVybiB1c2VVc2VyU3VzcGVuc2Vfd2l0aENsaWVudChjbGllbnQsIHVzZXJJZCk7XG59XG5mdW5jdGlvbiB1c2VSb29tSW5mbyhyb29tSWQpIHtcbiAgcmV0dXJuIHVzZVJvb21JbmZvX3dpdGhDbGllbnQodXNlQ2xpZW50KCksIHJvb21JZCk7XG59XG5mdW5jdGlvbiB1c2VSb29tSW5mb1N1c3BlbnNlKHJvb21JZCkge1xuICByZXR1cm4gdXNlUm9vbUluZm9TdXNwZW5zZV93aXRoQ2xpZW50KHVzZUNsaWVudCgpLCByb29tSWQpO1xufVxudmFyIF91c2VJbmJveE5vdGlmaWNhdGlvblRocmVhZCA9IHVzZUluYm94Tm90aWZpY2F0aW9uVGhyZWFkO1xudmFyIF91c2VVc2VyID0gdXNlVXNlcjtcbnZhciBfdXNlVXNlclN1c3BlbnNlID0gdXNlVXNlclN1c3BlbnNlO1xuXG4vLyBzcmMvY29tbWVudHMvZXJyb3JzLnRzXG52YXIgQ3JlYXRlVGhyZWFkRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY2F1c2UsIGNvbnRleHQpIHtcbiAgICBzdXBlcihcIkNyZWF0ZSB0aHJlYWQgZmFpbGVkLlwiKTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLm5hbWUgPSBcIkNyZWF0ZVRocmVhZEVycm9yXCI7XG4gIH1cbn07XG52YXIgRGVsZXRlVGhyZWFkRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY2F1c2UsIGNvbnRleHQpIHtcbiAgICBzdXBlcihcIkRlbGV0ZSB0aHJlYWQgZmFpbGVkLlwiKTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLm5hbWUgPSBcIkRlbGV0ZVRocmVhZEVycm9yXCI7XG4gIH1cbn07XG52YXIgRWRpdFRocmVhZE1ldGFkYXRhRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY2F1c2UsIGNvbnRleHQpIHtcbiAgICBzdXBlcihcIkVkaXQgdGhyZWFkIG1ldGFkYXRhIGZhaWxlZC5cIik7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lID0gXCJFZGl0VGhyZWFkTWV0YWRhdGFFcnJvclwiO1xuICB9XG59O1xudmFyIE1hcmtUaHJlYWRBc1Jlc29sdmVkRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY2F1c2UsIGNvbnRleHQpIHtcbiAgICBzdXBlcihcIk1hcmsgdGhyZWFkIGFzIHJlc29sdmVkIGZhaWxlZC5cIik7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lID0gXCJNYXJrVGhyZWFkQXNSZXNvbHZlZEVycm9yXCI7XG4gIH1cbn07XG52YXIgTWFya1RocmVhZEFzVW5yZXNvbHZlZEVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlLCBjb250ZXh0KSB7XG4gICAgc3VwZXIoXCJNYXJrIHRocmVhZCBhcyB1bnJlc29sdmVkIGZhaWxlZC5cIik7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lID0gXCJNYXJrVGhyZWFkQXNVbnJlc29sdmVkRXJyb3JcIjtcbiAgfVxufTtcbnZhciBDcmVhdGVDb21tZW50RXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY2F1c2UsIGNvbnRleHQpIHtcbiAgICBzdXBlcihcIkNyZWF0ZSBjb21tZW50IGZhaWxlZC5cIik7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lID0gXCJDcmVhdGVDb21tZW50RXJyb3JcIjtcbiAgfVxufTtcbnZhciBFZGl0Q29tbWVudEVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlLCBjb250ZXh0KSB7XG4gICAgc3VwZXIoXCJFZGl0IGNvbW1lbnQgZmFpbGVkLlwiKTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLm5hbWUgPSBcIkVkaXRDb21tZW50RXJyb3JcIjtcbiAgfVxufTtcbnZhciBEZWxldGVDb21tZW50RXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY2F1c2UsIGNvbnRleHQpIHtcbiAgICBzdXBlcihcIkRlbGV0ZSBjb21tZW50IGZhaWxlZC5cIik7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lID0gXCJEZWxldGVDb21tZW50RXJyb3JcIjtcbiAgfVxufTtcbnZhciBBZGRSZWFjdGlvbkVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlLCBjb250ZXh0KSB7XG4gICAgc3VwZXIoXCJBZGQgcmVhY3Rpb24gZmFpbGVkLlwiKTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLm5hbWUgPSBcIkFkZFJlYWN0aW9uRXJyb3JcIjtcbiAgfVxufTtcbnZhciBSZW1vdmVSZWFjdGlvbkVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlLCBjb250ZXh0KSB7XG4gICAgc3VwZXIoXCJSZW1vdmUgcmVhY3Rpb24gZmFpbGVkLlwiKTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLm5hbWUgPSBcIlJlbW92ZVJlYWN0aW9uRXJyb3JcIjtcbiAgfVxufTtcbnZhciBNYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWRFcnJvciA9IGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihjYXVzZSwgY29udGV4dCkge1xuICAgIHN1cGVyKFwiTWFyayBpbmJveCBub3RpZmljYXRpb24gYXMgcmVhZCBmYWlsZWQuXCIpO1xuICAgIHRoaXMuY2F1c2UgPSBjYXVzZTtcbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIHRoaXMubmFtZSA9IFwiTWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkRXJyb3JcIjtcbiAgfVxufTtcbnZhciBVcGRhdGVOb3RpZmljYXRpb25TZXR0aW5nc0Vycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlLCBjb250ZXh0KSB7XG4gICAgc3VwZXIoXCJVcGRhdGUgbm90aWZpY2F0aW9uIHNldHRpbmdzIGZhaWxlZC5cIik7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lID0gXCJVcGRhdGVOb3RpZmljYXRpb25TZXR0aW5nc0Vycm9yXCI7XG4gIH1cbn07XG5cbi8vIHNyYy9jb21tZW50cy9saWIvc2VsZWN0ZWQtdGhyZWFkcy50c1xuaW1wb3J0IHtcbiAgYXBwbHlPcHRpbWlzdGljVXBkYXRlcyBhcyBhcHBseU9wdGltaXN0aWNVcGRhdGVzMlxufSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuZnVuY3Rpb24gc2VsZWN0ZWRUaHJlYWRzKHJvb21JZCwgc3RhdGUsIG9wdGlvbnMpIHtcbiAgY29uc3QgcmVzdWx0ID0gYXBwbHlPcHRpbWlzdGljVXBkYXRlczIoc3RhdGUpO1xuICBjb25zdCB0aHJlYWRzID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQudGhyZWFkcykuZmlsdGVyKFxuICAgICh0aHJlYWQpID0+IHtcbiAgICAgIGlmICh0aHJlYWQucm9vbUlkICE9PSByb29tSWQpIHJldHVybiBmYWxzZTtcbiAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgcXVlcnkgPSBvcHRpb25zLnF1ZXJ5O1xuICAgICAgaWYgKCFxdWVyeSkgcmV0dXJuIHRydWU7XG4gICAgICBpZiAocXVlcnkucmVzb2x2ZWQgIT09IHZvaWQgMCAmJiB0aHJlYWQucmVzb2x2ZWQgIT09IHF1ZXJ5LnJlc29sdmVkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IGluIHF1ZXJ5Lm1ldGFkYXRhKSB7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhVmFsdWUgPSB0aHJlYWQubWV0YWRhdGFba2V5XTtcbiAgICAgICAgY29uc3QgZmlsdGVyVmFsdWUgPSBxdWVyeS5tZXRhZGF0YVtrZXldO1xuICAgICAgICBpZiAoYXNzZXJ0RmlsdGVySXNTdGFydHNXaXRoT3BlcmF0b3IoZmlsdGVyVmFsdWUpICYmIGFzc2VydE1ldGFkYXRhVmFsdWVJc1N0cmluZyhtZXRhZGF0YVZhbHVlKSkge1xuICAgICAgICAgIGlmIChtZXRhZGF0YVZhbHVlLnN0YXJ0c1dpdGgoZmlsdGVyVmFsdWUuc3RhcnRzV2l0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobWV0YWRhdGFWYWx1ZSAhPT0gZmlsdGVyVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIHRocmVhZHMuc29ydCgoYSwgYikgPT4gYS5jcmVhdGVkQXQuZ2V0VGltZSgpIC0gYi5jcmVhdGVkQXQuZ2V0VGltZSgpKTtcbn1cbnZhciBhc3NlcnRGaWx0ZXJJc1N0YXJ0c1dpdGhPcGVyYXRvciA9IChmaWx0ZXIpID0+IHtcbiAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIGZpbHRlci5zdGFydHNXaXRoID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xudmFyIGFzc2VydE1ldGFkYXRhVmFsdWVJc1N0cmluZyA9ICh2YWx1ZSkgPT4ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiO1xufTtcblxuLy8gc3JjL3Jvb20udHN4XG5pbXBvcnQgeyBzaGFsbG93IGFzIHNoYWxsb3cyIH0gZnJvbSBcIkBsaXZlYmxvY2tzL2NsaWVudFwiO1xuaW1wb3J0IHtcbiAgYWRkUmVhY3Rpb24sXG4gIENvbW1lbnRzQXBpRXJyb3IsXG4gIGNvbnNvbGUgYXMgY29uc29sZTIsXG4gIGNyZWF0ZUNvbW1lbnRJZCxcbiAgY3JlYXRlVGhyZWFkSWQsXG4gIGRlbGV0ZUNvbW1lbnQsXG4gIGRlcHJlY2F0ZUlmLFxuICBlcnJvcklmLFxuICBrSW50ZXJuYWwgYXMga0ludGVybmFsMixcbiAgbWFrZUV2ZW50U291cmNlLFxuICBtYWtlUG9sbGVyIGFzIG1ha2VQb2xsZXIyLFxuICBuYW5vaWQgYXMgbmFub2lkMixcbiAgTm90aWZpY2F0aW9uc0FwaUVycm9yLFxuICByZW1vdmVSZWFjdGlvbixcbiAgU2VydmVyTXNnQ29kZSxcbiAgc3RyaW5naWZ5LFxuICB1cHNlcnRDb21tZW50XG59IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5pbXBvcnQgKiBhcyBSZWFjdDQgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyB1c2VTeW5jRXh0ZXJuYWxTdG9yZVdpdGhTZWxlY3RvciBhcyB1c2VTeW5jRXh0ZXJuYWxTdG9yZVdpdGhTZWxlY3RvcjIgfSBmcm9tIFwidXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUvc2hpbS93aXRoLXNlbGVjdG9yLmpzXCI7XG5cbi8vIHNyYy9jb21tZW50cy9saWIvc2VsZWN0LW5vdGlmaWNhdGlvbi1zZXR0aW5ncy50c1xuaW1wb3J0IHtcbiAgYXBwbHlPcHRpbWlzdGljVXBkYXRlcyBhcyBhcHBseU9wdGltaXN0aWNVcGRhdGVzMyxcbiAgbm5cbn0gZnJvbSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcbmZ1bmN0aW9uIHNlbGVjdE5vdGlmaWNhdGlvblNldHRpbmdzKHJvb21JZCwgc3RhdGUpIHtcbiAgY29uc3QgeyBub3RpZmljYXRpb25TZXR0aW5ncyB9ID0gYXBwbHlPcHRpbWlzdGljVXBkYXRlczMoc3RhdGUpO1xuICByZXR1cm4gbm4obm90aWZpY2F0aW9uU2V0dGluZ3Nbcm9vbUlkXSk7XG59XG5cbi8vIHNyYy91c2Utc2Nyb2xsLXRvLWNvbW1lbnQtb24tbG9hZC1lZmZlY3QudHNcbmltcG9ydCAqIGFzIFJlYWN0MyBmcm9tIFwicmVhY3RcIjtcbmZ1bmN0aW9uIGhhbmRsZVNjcm9sbFRvQ29tbWVudE9uTG9hZChzaG91bGRTY3JvbGxPbkxvYWQsIHN0YXRlKSB7XG4gIGlmIChzaG91bGRTY3JvbGxPbkxvYWQgPT09IGZhbHNlKSByZXR1cm47XG4gIGlmIChzdGF0ZS5pc0xvYWRpbmcpIHJldHVybjtcbiAgY29uc3QgaXNXaW5kb3dEZWZpbmVkID0gdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIjtcbiAgaWYgKCFpc1dpbmRvd0RlZmluZWQpIHJldHVybjtcbiAgY29uc3QgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICBjb25zdCBjb21tZW50SWQgPSBoYXNoLnNsaWNlKDEpO1xuICBpZiAoIWNvbW1lbnRJZC5zdGFydHNXaXRoKFwiY21fXCIpKSByZXR1cm47XG4gIGNvbnN0IGNvbW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb21tZW50SWQpO1xuICBpZiAoY29tbWVudCA9PT0gbnVsbCkgcmV0dXJuO1xuICBjb25zdCBjb21tZW50cyA9IHN0YXRlLnRocmVhZHMuZmxhdE1hcCgodGhyZWFkKSA9PiB0aHJlYWQuY29tbWVudHMpO1xuICBjb25zdCBpc0NvbW1lbnRJblRocmVhZHMgPSBjb21tZW50cy5zb21lKFxuICAgIChjb21tZW50MikgPT4gY29tbWVudDIuaWQgPT09IGNvbW1lbnRJZFxuICApO1xuICBpZiAoIWlzQ29tbWVudEluVGhyZWFkcykgcmV0dXJuO1xuICBjb21tZW50LnNjcm9sbEludG9WaWV3KCk7XG59XG5mdW5jdGlvbiB1c2VTY3JvbGxUb0NvbW1lbnRPbkxvYWRFZmZlY3Qoc2hvdWxkU2Nyb2xsT25Mb2FkLCBzdGF0ZSkge1xuICBSZWFjdDMudXNlRWZmZWN0KFxuICAgICgpID0+IHtcbiAgICAgIGhhbmRsZVNjcm9sbFRvQ29tbWVudE9uTG9hZChzaG91bGRTY3JvbGxPbkxvYWQsIHN0YXRlKTtcbiAgICB9LFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMgLS0gV2Ugb25seSB3YW50IHRvIHJ1biB0aGlzIGVmZmVjdCBvbmNlXG4gICAgW3N0YXRlLmlzTG9hZGluZ11cbiAgKTtcbn1cblxuLy8gc3JjL3Jvb20udHN4XG52YXIgU01PT1RIX0RFTEFZID0gMWUzO1xudmFyIG5vb3AyID0gKCkgPT4ge1xufTtcbnZhciBpZGVudGl0eSA9ICh4KSA9PiB4O1xudmFyIG1pc3NpbmdfdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMgPSAocmVhY3RWZXJzaW9uLCByb29tSWQpID0+IGBXZSBub3RpY2VkIHlvdVxcdTIwMTlyZSB1c2luZyBSZWFjdCAke3JlYWN0VmVyc2lvbn0uIFBsZWFzZSBwYXNzIHVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzIGF0IHRoZSBSb29tUHJvdmlkZXIgbGV2ZWwgdW50aWwgeW91XFx1MjAxOXJlIHJlYWR5IHRvIHVwZ3JhZGUgdG8gUmVhY3QgMTg6XG5cbiAgICBpbXBvcnQgeyB1bnN0YWJsZV9iYXRjaGVkVXBkYXRlcyB9IGZyb20gXCJyZWFjdC1kb21cIjsgIC8vIG9yIFwicmVhY3QtbmF0aXZlXCJcblxuICAgIDxSb29tUHJvdmlkZXIgaWQ9JHtKU09OLnN0cmluZ2lmeShcbiAgcm9vbUlkXG4pfSAuLi4gdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXM9e3Vuc3RhYmxlX2JhdGNoZWRVcGRhdGVzfT5cbiAgICAgIC4uLlxuICAgIDwvUm9vbVByb3ZpZGVyPlxuXG5XaHk/IFBsZWFzZSBzZWUgaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvcGxhdGZvcm0vdHJvdWJsZXNob290aW5nI3N0YWxlLXByb3BzLXpvbWJpZS1jaGlsZCBmb3IgbW9yZSBpbmZvcm1hdGlvbmA7XG52YXIgc3VwZXJmbHVvdXNfdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMgPSBcIllvdSBkb25cXHUyMDE5dCBuZWVkIHRvIHBhc3MgdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMgdG8gUm9vbVByb3ZpZGVyIGFueW1vcmUsIHNpbmNlIHlvdVxcdTIwMTlyZSBvbiBSZWFjdCAxOCsgYWxyZWFkeS5cIjtcbmZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlMihzLCBncywgZ3NzKSB7XG4gIHJldHVybiB1c2VTeW5jRXh0ZXJuYWxTdG9yZVdpdGhTZWxlY3RvcjIocywgZ3MsIGdzcywgaWRlbnRpdHkpO1xufVxudmFyIFNUQUJMRV9FTVBUWV9MSVNUID0gT2JqZWN0LmZyZWV6ZShbXSk7XG52YXIgUE9MTElOR19JTlRFUlZBTDIgPSA1ICogNjAgKiAxZTM7XG5mdW5jdGlvbiBtYWtlTm90aWZpY2F0aW9uU2V0dGluZ3NRdWVyeUtleShyb29tSWQpIHtcbiAgcmV0dXJuIGAke3Jvb21JZH06Tk9USUZJQ0FUSU9OX1NFVFRJTkdTYDtcbn1cbmZ1bmN0aW9uIGFsd2F5c0VtcHR5TGlzdCgpIHtcbiAgcmV0dXJuIFNUQUJMRV9FTVBUWV9MSVNUO1xufVxuZnVuY3Rpb24gYWx3YXlzTnVsbCgpIHtcbiAgcmV0dXJuIG51bGw7XG59XG5mdW5jdGlvbiBzZWxlY3RvckZvcl91c2VPdGhlcnNDb25uZWN0aW9uSWRzKG90aGVycykge1xuICByZXR1cm4gb3RoZXJzLm1hcCgodXNlcikgPT4gdXNlci5jb25uZWN0aW9uSWQpO1xufVxuZnVuY3Rpb24gbWFrZU11dGF0aW9uQ29udGV4dChyb29tKSB7XG4gIGNvbnN0IGNhbm5vdFVzZVVudGlsID0gXCJUaGlzIG11dGF0aW9uIGNhbm5vdCBiZSB1c2VkIHVudGlsXCI7XG4gIGNvbnN0IG5lZWRzUHJlc2VuY2UgPSBgJHtjYW5ub3RVc2VVbnRpbH0gY29ubmVjdGVkIHRvIHRoZSBMaXZlYmxvY2tzIHJvb21gO1xuICBjb25zdCBuZWVkc1N0b3JhZ2UgPSBgJHtjYW5ub3RVc2VVbnRpbH0gc3RvcmFnZSBoYXMgYmVlbiBsb2FkZWRgO1xuICByZXR1cm4ge1xuICAgIGdldCBzdG9yYWdlKCkge1xuICAgICAgY29uc3QgbXV0YWJsZVJvb3QgPSByb29tLmdldFN0b3JhZ2VTbmFwc2hvdCgpO1xuICAgICAgaWYgKG11dGFibGVSb290ID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihuZWVkc1N0b3JhZ2UpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG11dGFibGVSb290O1xuICAgIH0sXG4gICAgZ2V0IHNlbGYoKSB7XG4gICAgICBjb25zdCBzZWxmID0gcm9vbS5nZXRTZWxmKCk7XG4gICAgICBpZiAoc2VsZiA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobmVlZHNQcmVzZW5jZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2VsZjtcbiAgICB9LFxuICAgIGdldCBvdGhlcnMoKSB7XG4gICAgICBjb25zdCBvdGhlcnMgPSByb29tLmdldE90aGVycygpO1xuICAgICAgaWYgKHJvb20uZ2V0U2VsZigpID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihuZWVkc1ByZXNlbmNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdGhlcnM7XG4gICAgfSxcbiAgICBzZXRNeVByZXNlbmNlOiByb29tLnVwZGF0ZVByZXNlbmNlXG4gIH07XG59XG5mdW5jdGlvbiBnZXRDdXJyZW50VXNlcklkKHJvb20pIHtcbiAgY29uc3Qgc2VsZiA9IHJvb20uZ2V0U2VsZigpO1xuICBpZiAoc2VsZiA9PT0gbnVsbCB8fCBzZWxmLmlkID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gXCJhbm9ueW1vdXNcIjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc2VsZi5pZDtcbiAgfVxufVxuZnVuY3Rpb24gaGFuZGxlQXBpRXJyb3IoZXJyKSB7XG4gIGNvbnN0IG1lc3NhZ2UgPSBgUmVxdWVzdCBmYWlsZWQgd2l0aCBzdGF0dXMgJHtlcnIuc3RhdHVzfTogJHtlcnIubWVzc2FnZX1gO1xuICBpZiAoZXJyLmRldGFpbHM/LmVycm9yID09PSBcIkZPUkJJRERFTlwiKSB7XG4gICAgY29uc3QgZGV0YWlsZWRNZXNzYWdlID0gW21lc3NhZ2UsIGVyci5kZXRhaWxzLnN1Z2dlc3Rpb24sIGVyci5kZXRhaWxzLmRvY3NdLmZpbHRlcihCb29sZWFuKS5qb2luKFwiXFxuXCIpO1xuICAgIGNvbnNvbGUyLmVycm9yKGRldGFpbGVkTWVzc2FnZSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBFcnJvcihtZXNzYWdlKTtcbn1cbnZhciBfZXh0cmFzMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpO1xudmFyIF9idW5kbGVzMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpO1xuZnVuY3Rpb24gZ2V0T3JDcmVhdGVSb29tQ29udGV4dEJ1bmRsZShjbGllbnQpIHtcbiAgbGV0IGJ1bmRsZSA9IF9idW5kbGVzMi5nZXQoY2xpZW50KTtcbiAgaWYgKCFidW5kbGUpIHtcbiAgICBidW5kbGUgPSBtYWtlUm9vbUNvbnRleHRCdW5kbGUoY2xpZW50KTtcbiAgICBfYnVuZGxlczIuc2V0KGNsaWVudCwgYnVuZGxlKTtcbiAgfVxuICByZXR1cm4gYnVuZGxlO1xufVxuZnVuY3Rpb24gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpIHtcbiAgbGV0IGV4dHJhcyA9IF9leHRyYXMyLmdldChjbGllbnQpO1xuICBpZiAoIWV4dHJhcykge1xuICAgIGV4dHJhcyA9IG1ha2VFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgX2V4dHJhczIuc2V0KGNsaWVudCwgZXh0cmFzKTtcbiAgfVxuICByZXR1cm4gZXh0cmFzO1xufVxuZnVuY3Rpb24gbWFrZUV4dHJhc0ZvckNsaWVudDIoY2xpZW50KSB7XG4gIGNvbnN0IHN0b3JlID0gY2xpZW50W2tJbnRlcm5hbDJdLmNhY2hlU3RvcmU7XG4gIGNvbnN0IERFRkFVTFRfREVEVVBJTkdfSU5URVJWQUwgPSAyZTM7XG4gIGNvbnN0IGxhc3RSZXF1ZXN0ZWRBdEJ5Um9vbSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IHJlcXVlc3RzQnlRdWVyeSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IHJlcXVlc3RTdGF0dXNCeVJvb20gPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBjb25zdCBzdWJzY3JpYmVyc0J5UXVlcnkgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBjb25zdCBwb2xsZXIgPSBtYWtlUG9sbGVyMihyZWZyZXNoVGhyZWFkc0FuZE5vdGlmaWNhdGlvbnMpO1xuICBhc3luYyBmdW5jdGlvbiByZWZyZXNoVGhyZWFkc0FuZE5vdGlmaWNhdGlvbnMoKSB7XG4gICAgY29uc3QgcmVxdWVzdHMgPSBbXTtcbiAgICBjbGllbnRba0ludGVybmFsMl0uZ2V0Um9vbUlkcygpLm1hcCgocm9vbUlkKSA9PiB7XG4gICAgICBjb25zdCByb29tID0gY2xpZW50LmdldFJvb20ocm9vbUlkKTtcbiAgICAgIGlmIChyb29tID09PSBudWxsKSByZXR1cm47XG4gICAgICByZXF1ZXN0cy5wdXNoKGdldFRocmVhZHNVcGRhdGVzKHJvb20uaWQpKTtcbiAgICB9KTtcbiAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQocmVxdWVzdHMpO1xuICB9XG4gIGZ1bmN0aW9uIGluY3JlbWVudFF1ZXJ5U3Vic2NyaWJlcnMocXVlcnlLZXkpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVycyA9IHN1YnNjcmliZXJzQnlRdWVyeS5nZXQocXVlcnlLZXkpID8/IDA7XG4gICAgc3Vic2NyaWJlcnNCeVF1ZXJ5LnNldChxdWVyeUtleSwgc3Vic2NyaWJlcnMgKyAxKTtcbiAgICBwb2xsZXIuc3RhcnQoUE9MTElOR19JTlRFUlZBTDIpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25zdCBzdWJzY3JpYmVyczIgPSBzdWJzY3JpYmVyc0J5UXVlcnkuZ2V0KHF1ZXJ5S2V5KTtcbiAgICAgIGlmIChzdWJzY3JpYmVyczIgPT09IHZvaWQgMCB8fCBzdWJzY3JpYmVyczIgPD0gMCkge1xuICAgICAgICBjb25zb2xlMi53YXJuKFxuICAgICAgICAgIGBJbnRlcm5hbCB1bmV4cGVjdGVkIGJlaGF2aW9yLiBDYW5ub3QgZGVjcmVhc2Ugc3Vic2NyaWJlciBjb3VudCBmb3IgcXVlcnkgXCIke3F1ZXJ5S2V5fVwiYFxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBzdWJzY3JpYmVyc0J5UXVlcnkuc2V0KHF1ZXJ5S2V5LCBzdWJzY3JpYmVyczIgLSAxKTtcbiAgICAgIGxldCB0b3RhbFN1YnNjcmliZXJzID0gMDtcbiAgICAgIGZvciAoY29uc3Qgc3Vic2NyaWJlcnMzIG9mIHN1YnNjcmliZXJzQnlRdWVyeS52YWx1ZXMoKSkge1xuICAgICAgICB0b3RhbFN1YnNjcmliZXJzICs9IHN1YnNjcmliZXJzMztcbiAgICAgIH1cbiAgICAgIGlmICh0b3RhbFN1YnNjcmliZXJzIDw9IDApIHtcbiAgICAgICAgcG9sbGVyLnN0b3AoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldFRocmVhZHNVcGRhdGVzKHJvb21JZCkge1xuICAgIGNvbnN0IHJvb20gPSBjbGllbnQuZ2V0Um9vbShyb29tSWQpO1xuICAgIGlmIChyb29tID09PSBudWxsKSByZXR1cm47XG4gICAgY29uc3Qgc2luY2UgPSBsYXN0UmVxdWVzdGVkQXRCeVJvb20uZ2V0KHJvb20uaWQpO1xuICAgIGlmIChzaW5jZSA9PT0gdm9pZCAwKSByZXR1cm47XG4gICAgY29uc3QgaXNGZXRjaGluZ1RocmVhZHNVcGRhdGVzID0gcmVxdWVzdFN0YXR1c0J5Um9vbS5nZXQocm9vbS5pZCkgPz8gZmFsc2U7XG4gICAgaWYgKGlzRmV0Y2hpbmdUaHJlYWRzVXBkYXRlcyA9PT0gdHJ1ZSkgcmV0dXJuO1xuICAgIHRyeSB7XG4gICAgICByZXF1ZXN0U3RhdHVzQnlSb29tLnNldChyb29tLmlkLCB0cnVlKTtcbiAgICAgIGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCByb29tLmdldFRocmVhZHNTaW5jZSh7IHNpbmNlIH0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHJlcXVlc3RTdGF0dXNCeVJvb20uc2V0KHJvb20uaWQsIGZhbHNlKTtcbiAgICAgIH0sIERFRkFVTFRfREVEVVBJTkdfSU5URVJWQUwpO1xuICAgICAgc3RvcmUudXBkYXRlVGhyZWFkc0FuZE5vdGlmaWNhdGlvbnMoXG4gICAgICAgIHVwZGF0ZXMudGhyZWFkcy51cGRhdGVkLFxuICAgICAgICB1cGRhdGVzLmluYm94Tm90aWZpY2F0aW9ucy51cGRhdGVkLFxuICAgICAgICB1cGRhdGVzLnRocmVhZHMuZGVsZXRlZCxcbiAgICAgICAgdXBkYXRlcy5pbmJveE5vdGlmaWNhdGlvbnMuZGVsZXRlZFxuICAgICAgKTtcbiAgICAgIGxhc3RSZXF1ZXN0ZWRBdEJ5Um9vbS5zZXQocm9vbS5pZCwgdXBkYXRlcy5yZXF1ZXN0ZWRBdCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZXF1ZXN0U3RhdHVzQnlSb29tLnNldChyb29tLmlkLCBmYWxzZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldFRocmVhZHNBbmRJbmJveE5vdGlmaWNhdGlvbnMocm9vbSwgcXVlcnlLZXksIG9wdGlvbnMsIHsgcmV0cnlDb3VudCB9ID0geyByZXRyeUNvdW50OiAwIH0pIHtcbiAgICBjb25zdCBleGlzdGluZ1JlcXVlc3QgPSByZXF1ZXN0c0J5UXVlcnkuZ2V0KHF1ZXJ5S2V5KTtcbiAgICBpZiAoZXhpc3RpbmdSZXF1ZXN0ICE9PSB2b2lkIDApIHJldHVybiBleGlzdGluZ1JlcXVlc3Q7XG4gICAgY29uc3QgcmVxdWVzdCA9IHJvb20uZ2V0VGhyZWFkcyhvcHRpb25zKTtcbiAgICByZXF1ZXN0c0J5UXVlcnkuc2V0KHF1ZXJ5S2V5LCByZXF1ZXN0KTtcbiAgICBzdG9yZS5zZXRRdWVyeVN0YXRlKHF1ZXJ5S2V5LCB7XG4gICAgICBpc0xvYWRpbmc6IHRydWVcbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVxdWVzdDtcbiAgICAgIHN0b3JlLnVwZGF0ZVRocmVhZHNBbmROb3RpZmljYXRpb25zKFxuICAgICAgICByZXN1bHQudGhyZWFkcyxcbiAgICAgICAgLy8gVE9ETzogRmlndXJlIG91dCBob3cgdG8gcmVtb3ZlIHRoaXMgY2FzdGluZ1xuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICBbXSxcbiAgICAgICAgW10sXG4gICAgICAgIHF1ZXJ5S2V5XG4gICAgICApO1xuICAgICAgY29uc3QgbGFzdFJlcXVlc3RlZEF0ID0gbGFzdFJlcXVlc3RlZEF0QnlSb29tLmdldChyb29tLmlkKTtcbiAgICAgIGlmIChsYXN0UmVxdWVzdGVkQXQgPT09IHZvaWQgMCB8fCBsYXN0UmVxdWVzdGVkQXQgPiByZXN1bHQucmVxdWVzdGVkQXQpIHtcbiAgICAgICAgbGFzdFJlcXVlc3RlZEF0QnlSb29tLnNldChyb29tLmlkLCByZXN1bHQucmVxdWVzdGVkQXQpO1xuICAgICAgfVxuICAgICAgcG9sbGVyLnN0YXJ0KFBPTExJTkdfSU5URVJWQUwyKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJlcXVlc3RzQnlRdWVyeS5kZWxldGUocXVlcnlLZXkpO1xuICAgICAgcmV0cnlFcnJvcigoKSA9PiB7XG4gICAgICAgIHZvaWQgZ2V0VGhyZWFkc0FuZEluYm94Tm90aWZpY2F0aW9ucyhyb29tLCBxdWVyeUtleSwgb3B0aW9ucywge1xuICAgICAgICAgIHJldHJ5Q291bnQ6IHJldHJ5Q291bnQgKyAxXG4gICAgICAgIH0pO1xuICAgICAgfSwgcmV0cnlDb3VudCk7XG4gICAgICBzdG9yZS5zZXRRdWVyeVN0YXRlKHF1ZXJ5S2V5LCB7XG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0SW5ib3hOb3RpZmljYXRpb25TZXR0aW5ncyhyb29tLCBxdWVyeUtleSwgeyByZXRyeUNvdW50IH0gPSB7IHJldHJ5Q291bnQ6IDAgfSkge1xuICAgIGNvbnN0IGV4aXN0aW5nUmVxdWVzdCA9IHJlcXVlc3RzQnlRdWVyeS5nZXQocXVlcnlLZXkpO1xuICAgIGlmIChleGlzdGluZ1JlcXVlc3QgIT09IHZvaWQgMCkgcmV0dXJuIGV4aXN0aW5nUmVxdWVzdDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHJvb20uZ2V0Tm90aWZpY2F0aW9uU2V0dGluZ3MoKTtcbiAgICAgIHJlcXVlc3RzQnlRdWVyeS5zZXQocXVlcnlLZXksIHJlcXVlc3QpO1xuICAgICAgc3RvcmUuc2V0UXVlcnlTdGF0ZShxdWVyeUtleSwge1xuICAgICAgICBpc0xvYWRpbmc6IHRydWVcbiAgICAgIH0pO1xuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCByZXF1ZXN0O1xuICAgICAgc3RvcmUudXBkYXRlUm9vbUluYm94Tm90aWZpY2F0aW9uU2V0dGluZ3Mocm9vbS5pZCwgc2V0dGluZ3MsIHF1ZXJ5S2V5KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJlcXVlc3RzQnlRdWVyeS5kZWxldGUocXVlcnlLZXkpO1xuICAgICAgcmV0cnlFcnJvcigoKSA9PiB7XG4gICAgICAgIHZvaWQgZ2V0SW5ib3hOb3RpZmljYXRpb25TZXR0aW5ncyhyb29tLCBxdWVyeUtleSwge1xuICAgICAgICAgIHJldHJ5Q291bnQ6IHJldHJ5Q291bnQgKyAxXG4gICAgICAgIH0pO1xuICAgICAgfSwgcmV0cnlDb3VudCk7XG4gICAgICBzdG9yZS5zZXRRdWVyeVN0YXRlKHF1ZXJ5S2V5LCB7XG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgY29tbWVudHNFcnJvckV2ZW50U291cmNlID0gbWFrZUV2ZW50U291cmNlKCk7XG4gIGZ1bmN0aW9uIG9uTXV0YXRpb25GYWlsdXJlKGlubmVyRXJyb3IsIG9wdGltaXN0aWNVcGRhdGVJZCwgY3JlYXRlUHVibGljRXJyb3IpIHtcbiAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBvcHRpbWlzdGljVXBkYXRlczogc3RhdGUub3B0aW1pc3RpY1VwZGF0ZXMuZmlsdGVyKFxuICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgKVxuICAgIH0pKTtcbiAgICBpZiAoaW5uZXJFcnJvciBpbnN0YW5jZW9mIENvbW1lbnRzQXBpRXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yID0gaGFuZGxlQXBpRXJyb3IoaW5uZXJFcnJvcik7XG4gICAgICBjb21tZW50c0Vycm9yRXZlbnRTb3VyY2Uubm90aWZ5KGNyZWF0ZVB1YmxpY0Vycm9yKGVycm9yKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChpbm5lckVycm9yIGluc3RhbmNlb2YgTm90aWZpY2F0aW9uc0FwaUVycm9yKSB7XG4gICAgICBoYW5kbGVBcGlFcnJvcihpbm5lckVycm9yKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhyb3cgaW5uZXJFcnJvcjtcbiAgfVxuICByZXR1cm4ge1xuICAgIHN0b3JlLFxuICAgIGluY3JlbWVudFF1ZXJ5U3Vic2NyaWJlcnMsXG4gICAgY29tbWVudHNFcnJvckV2ZW50U291cmNlLFxuICAgIGdldFRocmVhZHNVcGRhdGVzLFxuICAgIGdldFRocmVhZHNBbmRJbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgZ2V0SW5ib3hOb3RpZmljYXRpb25TZXR0aW5ncyxcbiAgICBvbk11dGF0aW9uRmFpbHVyZVxuICB9O1xufVxudmFyIFJvb21Db250ZXh0ID0gUmVhY3Q0LmNyZWF0ZUNvbnRleHQobnVsbCk7XG5mdW5jdGlvbiBtYWtlUm9vbUNvbnRleHRCdW5kbGUoY2xpZW50KSB7XG4gIGZ1bmN0aW9uIFJvb21Qcm92aWRlcl93aXRoSW1wbGljaXRMaXZlYmxvY2tzUHJvdmlkZXIocHJvcHMpIHtcbiAgICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0NC5jcmVhdGVFbGVtZW50KExpdmVibG9ja3NQcm92aWRlcldpdGhDbGllbnQsIHsgY2xpZW50LCBhbGxvd05lc3Rpbmc6IHRydWUgfSwgLyogQF9fUFVSRV9fICovIFJlYWN0NC5jcmVhdGVFbGVtZW50KFJvb21Qcm92aWRlciwgeyAuLi5wcm9wcyB9KSk7XG4gIH1cbiAgY29uc3Qgc2hhcmVkID0gY3JlYXRlU2hhcmVkQ29udGV4dChjbGllbnQpO1xuICBjb25zdCBidW5kbGUgPSB7XG4gICAgUm9vbUNvbnRleHQsXG4gICAgUm9vbVByb3ZpZGVyOiBSb29tUHJvdmlkZXJfd2l0aEltcGxpY2l0TGl2ZWJsb2Nrc1Byb3ZpZGVyLFxuICAgIHVzZVJvb20sXG4gICAgdXNlU3RhdHVzLFxuICAgIHVzZVN0b3JhZ2VTdGF0dXMsXG4gICAgdXNlQmF0Y2gsXG4gICAgdXNlQnJvYWRjYXN0RXZlbnQsXG4gICAgdXNlT3RoZXJzTGlzdGVuZXIsXG4gICAgdXNlTG9zdENvbm5lY3Rpb25MaXN0ZW5lcixcbiAgICB1c2VFcnJvckxpc3RlbmVyLFxuICAgIHVzZUV2ZW50TGlzdGVuZXIsXG4gICAgdXNlSGlzdG9yeSxcbiAgICB1c2VVbmRvLFxuICAgIHVzZVJlZG8sXG4gICAgdXNlQ2FuUmVkbyxcbiAgICB1c2VDYW5VbmRvLFxuICAgIHVzZVN0b3JhZ2VSb290LFxuICAgIHVzZVN0b3JhZ2UsXG4gICAgdXNlU2VsZixcbiAgICB1c2VNeVByZXNlbmNlLFxuICAgIHVzZVVwZGF0ZU15UHJlc2VuY2UsXG4gICAgdXNlT3RoZXJzLFxuICAgIHVzZU90aGVyc01hcHBlZCxcbiAgICB1c2VPdGhlcnNDb25uZWN0aW9uSWRzLFxuICAgIHVzZU90aGVyLFxuICAgIHVzZU11dGF0aW9uLFxuICAgIHVzZVRocmVhZHMsXG4gICAgdXNlQ3JlYXRlVGhyZWFkLFxuICAgIHVzZURlbGV0ZVRocmVhZCxcbiAgICB1c2VFZGl0VGhyZWFkTWV0YWRhdGEsXG4gICAgdXNlTWFya1RocmVhZEFzUmVzb2x2ZWQsXG4gICAgdXNlTWFya1RocmVhZEFzVW5yZXNvbHZlZCxcbiAgICB1c2VDcmVhdGVDb21tZW50LFxuICAgIHVzZUVkaXRDb21tZW50LFxuICAgIHVzZURlbGV0ZUNvbW1lbnQsXG4gICAgdXNlQWRkUmVhY3Rpb24sXG4gICAgdXNlUmVtb3ZlUmVhY3Rpb24sXG4gICAgdXNlTWFya1RocmVhZEFzUmVhZCxcbiAgICB1c2VUaHJlYWRTdWJzY3JpcHRpb24sXG4gICAgdXNlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzLFxuICAgIHVzZVVwZGF0ZVJvb21Ob3RpZmljYXRpb25TZXR0aW5ncyxcbiAgICAuLi5zaGFyZWQuY2xhc3NpYyxcbiAgICBzdXNwZW5zZToge1xuICAgICAgUm9vbUNvbnRleHQsXG4gICAgICBSb29tUHJvdmlkZXI6IFJvb21Qcm92aWRlcl93aXRoSW1wbGljaXRMaXZlYmxvY2tzUHJvdmlkZXIsXG4gICAgICB1c2VSb29tLFxuICAgICAgdXNlU3RhdHVzLFxuICAgICAgdXNlU3RvcmFnZVN0YXR1czogdXNlU3RvcmFnZVN0YXR1c1N1c3BlbnNlLFxuICAgICAgdXNlQmF0Y2gsXG4gICAgICB1c2VCcm9hZGNhc3RFdmVudCxcbiAgICAgIHVzZU90aGVyc0xpc3RlbmVyLFxuICAgICAgdXNlTG9zdENvbm5lY3Rpb25MaXN0ZW5lcixcbiAgICAgIHVzZUVycm9yTGlzdGVuZXIsXG4gICAgICB1c2VFdmVudExpc3RlbmVyLFxuICAgICAgdXNlSGlzdG9yeSxcbiAgICAgIHVzZVVuZG8sXG4gICAgICB1c2VSZWRvLFxuICAgICAgdXNlQ2FuUmVkbyxcbiAgICAgIHVzZUNhblVuZG8sXG4gICAgICB1c2VTdG9yYWdlUm9vdCxcbiAgICAgIHVzZVN0b3JhZ2U6IHVzZVN0b3JhZ2VTdXNwZW5zZSxcbiAgICAgIHVzZVNlbGY6IHVzZVNlbGZTdXNwZW5zZSxcbiAgICAgIHVzZU15UHJlc2VuY2UsXG4gICAgICB1c2VVcGRhdGVNeVByZXNlbmNlLFxuICAgICAgdXNlT3RoZXJzOiB1c2VPdGhlcnNTdXNwZW5zZSxcbiAgICAgIHVzZU90aGVyc01hcHBlZDogdXNlT3RoZXJzTWFwcGVkU3VzcGVuc2UsXG4gICAgICB1c2VPdGhlcnNDb25uZWN0aW9uSWRzOiB1c2VPdGhlcnNDb25uZWN0aW9uSWRzU3VzcGVuc2UsXG4gICAgICB1c2VPdGhlcjogdXNlT3RoZXJTdXNwZW5zZSxcbiAgICAgIHVzZU11dGF0aW9uLFxuICAgICAgdXNlVGhyZWFkczogdXNlVGhyZWFkc1N1c3BlbnNlLFxuICAgICAgdXNlQ3JlYXRlVGhyZWFkLFxuICAgICAgdXNlRGVsZXRlVGhyZWFkLFxuICAgICAgdXNlRWRpdFRocmVhZE1ldGFkYXRhLFxuICAgICAgdXNlTWFya1RocmVhZEFzUmVzb2x2ZWQsXG4gICAgICB1c2VNYXJrVGhyZWFkQXNVbnJlc29sdmVkLFxuICAgICAgdXNlQ3JlYXRlQ29tbWVudCxcbiAgICAgIHVzZUVkaXRDb21tZW50LFxuICAgICAgdXNlRGVsZXRlQ29tbWVudCxcbiAgICAgIHVzZUFkZFJlYWN0aW9uLFxuICAgICAgdXNlUmVtb3ZlUmVhY3Rpb24sXG4gICAgICB1c2VNYXJrVGhyZWFkQXNSZWFkLFxuICAgICAgdXNlVGhyZWFkU3Vic2NyaXB0aW9uLFxuICAgICAgdXNlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzOiB1c2VSb29tTm90aWZpY2F0aW9uU2V0dGluZ3NTdXNwZW5zZSxcbiAgICAgIHVzZVVwZGF0ZVJvb21Ob3RpZmljYXRpb25TZXR0aW5ncyxcbiAgICAgIC4uLnNoYXJlZC5zdXNwZW5zZVxuICAgIH0sXG4gICAgdXNlQ29tbWVudHNFcnJvckxpc3RlbmVyXG4gIH07XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoYnVuZGxlLCBrSW50ZXJuYWwyLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2VcbiAgfSk7XG59XG5mdW5jdGlvbiBSb29tUHJvdmlkZXIocHJvcHMpIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIGNvbnN0IFtjYWNoZV0gPSBSZWFjdDQudXNlU3RhdGUoXG4gICAgKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKVxuICApO1xuICBjb25zdCBzdGFibGVFbnRlclJvb20gPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHJvb21JZCwgb3B0aW9ucykgPT4ge1xuICAgICAgY29uc3QgY2FjaGVkID0gY2FjaGUuZ2V0KHJvb21JZCk7XG4gICAgICBpZiAoY2FjaGVkKSByZXR1cm4gY2FjaGVkO1xuICAgICAgY29uc3QgcnYgPSBjbGllbnQuZW50ZXJSb29tKHJvb21JZCwgb3B0aW9ucyk7XG4gICAgICBjb25zdCBvcmlnTGVhdmUgPSBydi5sZWF2ZTtcbiAgICAgIHJ2LmxlYXZlID0gKCkgPT4ge1xuICAgICAgICBvcmlnTGVhdmUoKTtcbiAgICAgICAgY2FjaGUuZGVsZXRlKHJvb21JZCk7XG4gICAgICB9O1xuICAgICAgY2FjaGUuc2V0KHJvb21JZCwgcnYpO1xuICAgICAgcmV0dXJuIHJ2O1xuICAgIH0sXG4gICAgW2NsaWVudCwgY2FjaGVdXG4gICk7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8gUmVhY3Q0LmNyZWF0ZUVsZW1lbnQoXG4gICAgUm9vbVByb3ZpZGVySW5uZXIsXG4gICAge1xuICAgICAgLi4ucHJvcHMsXG4gICAgICBzdGFibGVFbnRlclJvb21cbiAgICB9XG4gICk7XG59XG5mdW5jdGlvbiBSb29tUHJvdmlkZXJJbm5lcihwcm9wcykge1xuICBjb25zdCBjbGllbnQgPSB1c2VDbGllbnQoKTtcbiAgY29uc3QgeyBpZDogcm9vbUlkLCBzdGFibGVFbnRlclJvb20gfSA9IHByb3BzO1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKCFyb29tSWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJSb29tUHJvdmlkZXIgaWQgcHJvcGVydHkgaXMgcmVxdWlyZWQuIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvbGl2ZWJsb2Nrcy1yZWFjdC9Sb29tUHJvdmlkZXItaWQtcHJvcGVydHktaXMtcmVxdWlyZWRcIlxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiByb29tSWQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJvb21Qcm92aWRlciBpZCBwcm9wZXJ0eSBzaG91bGQgYmUgYSBzdHJpbmcuXCIpO1xuICAgIH1cbiAgICBjb25zdCBtYWpvclJlYWN0VmVyc2lvbiA9IHBhcnNlSW50KFJlYWN0NC52ZXJzaW9uKSB8fCAxO1xuICAgIGNvbnN0IG9sZFJlYWN0VmVyc2lvbiA9IG1ham9yUmVhY3RWZXJzaW9uIDwgMTg7XG4gICAgZXJyb3JJZihcbiAgICAgIG9sZFJlYWN0VmVyc2lvbiAmJiBwcm9wcy51bnN0YWJsZV9iYXRjaGVkVXBkYXRlcyA9PT0gdm9pZCAwLFxuICAgICAgbWlzc2luZ191bnN0YWJsZV9iYXRjaGVkVXBkYXRlcyhtYWpvclJlYWN0VmVyc2lvbiwgcm9vbUlkKVxuICAgICk7XG4gICAgZGVwcmVjYXRlSWYoXG4gICAgICAhb2xkUmVhY3RWZXJzaW9uICYmIHByb3BzLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzICE9PSB2b2lkIDAsXG4gICAgICBzdXBlcmZsdW91c191bnN0YWJsZV9iYXRjaGVkVXBkYXRlc1xuICAgICk7XG4gIH1cbiAgY29uc3QgZnJvemVuUHJvcHMgPSB1c2VJbml0aWFsKHtcbiAgICBpbml0aWFsUHJlc2VuY2U6IHByb3BzLmluaXRpYWxQcmVzZW5jZSxcbiAgICBpbml0aWFsU3RvcmFnZTogcHJvcHMuaW5pdGlhbFN0b3JhZ2UsXG4gICAgdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXM6IHByb3BzLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzLFxuICAgIGF1dG9Db25uZWN0OiBwcm9wcy5hdXRvQ29ubmVjdCA/PyB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiXG4gIH0pO1xuICBjb25zdCBbeyByb29tIH0sIHNldFJvb21MZWF2ZVBhaXJdID0gUmVhY3Q0LnVzZVN0YXRlKFxuICAgICgpID0+IHN0YWJsZUVudGVyUm9vbShyb29tSWQsIHtcbiAgICAgIC4uLmZyb3plblByb3BzLFxuICAgICAgYXV0b0Nvbm5lY3Q6IGZhbHNlXG4gICAgICAvLyBEZWxpYmVyYXRlbHkgdXNpbmcgZmFsc2UgaGVyZSBvbiB0aGUgZmlyc3QgcmVuZGVyLCBzZWUgYmVsb3dcbiAgICB9KVxuICApO1xuICBSZWFjdDQudXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCB7IHN0b3JlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ29tbWVudEV2ZW50KG1lc3NhZ2UpIHtcbiAgICAgIGlmIChtZXNzYWdlLnR5cGUgPT09IFNlcnZlck1zZ0NvZGUuVEhSRUFEX0RFTEVURUQpIHtcbiAgICAgICAgc3RvcmUuZGVsZXRlVGhyZWFkKG1lc3NhZ2UudGhyZWFkSWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBpbmZvID0gYXdhaXQgcm9vbS5nZXRUaHJlYWQobWVzc2FnZS50aHJlYWRJZCk7XG4gICAgICBpZiAoIWluZm8udGhyZWFkKSB7XG4gICAgICAgIHN0b3JlLmRlbGV0ZVRocmVhZChtZXNzYWdlLnRocmVhZElkKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgeyB0aHJlYWQsIGluYm94Tm90aWZpY2F0aW9uIH0gPSBpbmZvO1xuICAgICAgY29uc3QgZXhpc3RpbmdUaHJlYWQgPSBzdG9yZS5nZXQoKS50aHJlYWRzW21lc3NhZ2UudGhyZWFkSWRdO1xuICAgICAgc3dpdGNoIChtZXNzYWdlLnR5cGUpIHtcbiAgICAgICAgY2FzZSBTZXJ2ZXJNc2dDb2RlLkNPTU1FTlRfRURJVEVEOlxuICAgICAgICBjYXNlIFNlcnZlck1zZ0NvZGUuVEhSRUFEX01FVEFEQVRBX1VQREFURUQ6XG4gICAgICAgIGNhc2UgU2VydmVyTXNnQ29kZS5USFJFQURfVVBEQVRFRDpcbiAgICAgICAgY2FzZSBTZXJ2ZXJNc2dDb2RlLkNPTU1FTlRfUkVBQ1RJT05fQURERUQ6XG4gICAgICAgIGNhc2UgU2VydmVyTXNnQ29kZS5DT01NRU5UX1JFQUNUSU9OX1JFTU9WRUQ6XG4gICAgICAgIGNhc2UgU2VydmVyTXNnQ29kZS5DT01NRU5UX0RFTEVURUQ6XG4gICAgICAgICAgaWYgKCFleGlzdGluZ1RocmVhZCkgYnJlYWs7XG4gICAgICAgICAgc3RvcmUudXBkYXRlVGhyZWFkQW5kTm90aWZpY2F0aW9uKHRocmVhZCwgaW5ib3hOb3RpZmljYXRpb24pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFNlcnZlck1zZ0NvZGUuQ09NTUVOVF9DUkVBVEVEOlxuICAgICAgICAgIHN0b3JlLnVwZGF0ZVRocmVhZEFuZE5vdGlmaWNhdGlvbih0aHJlYWQsIGluYm94Tm90aWZpY2F0aW9uKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJvb20uZXZlbnRzLmNvbW1lbnRzLnN1YnNjcmliZShcbiAgICAgIChtZXNzYWdlKSA9PiB2b2lkIGhhbmRsZUNvbW1lbnRFdmVudChtZXNzYWdlKVxuICAgICk7XG4gIH0sIFtjbGllbnQsIHJvb21dKTtcbiAgUmVhY3Q0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgeyBnZXRUaHJlYWRzVXBkYXRlcyB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgIHZvaWQgZ2V0VGhyZWFkc1VwZGF0ZXMocm9vbS5pZCk7XG4gIH0sIFtjbGllbnQsIHJvb20uaWRdKTtcbiAgUmVhY3Q0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZnVuY3Rpb24gaGFuZGxlSXNPbmxpbmUoKSB7XG4gICAgICBjb25zdCB7IGdldFRocmVhZHNVcGRhdGVzIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgICB2b2lkIGdldFRocmVhZHNVcGRhdGVzKHJvb20uaWQpO1xuICAgIH1cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCBoYW5kbGVJc09ubGluZSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwib25saW5lXCIsIGhhbmRsZUlzT25saW5lKTtcbiAgICB9O1xuICB9LCBbY2xpZW50LCByb29tLmlkXSk7XG4gIFJlYWN0NC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHBhaXIgPSBzdGFibGVFbnRlclJvb20ocm9vbUlkLCBmcm96ZW5Qcm9wcyk7XG4gICAgc2V0Um9vbUxlYXZlUGFpcihwYWlyKTtcbiAgICBjb25zdCB7IHJvb206IHJvb20yLCBsZWF2ZSB9ID0gcGFpcjtcbiAgICBpZiAoZnJvemVuUHJvcHMuYXV0b0Nvbm5lY3QpIHtcbiAgICAgIHJvb20yLmNvbm5lY3QoKTtcbiAgICB9XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGxlYXZlKCk7XG4gICAgfTtcbiAgfSwgW3Jvb21JZCwgZnJvemVuUHJvcHMsIHN0YWJsZUVudGVyUm9vbV0pO1xuICByZXR1cm4gLyogQF9fUFVSRV9fICovIFJlYWN0NC5jcmVhdGVFbGVtZW50KFJvb21Db250ZXh0LlByb3ZpZGVyLCB7IHZhbHVlOiByb29tIH0sIHByb3BzLmNoaWxkcmVuKTtcbn1cbmZ1bmN0aW9uIHVzZVJvb20oKSB7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tT3JOdWxsKCk7XG4gIGlmIChyb29tID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUm9vbVByb3ZpZGVyIGlzIG1pc3NpbmcgZnJvbSB0aGUgUmVhY3QgdHJlZS5cIik7XG4gIH1cbiAgcmV0dXJuIHJvb207XG59XG5mdW5jdGlvbiB1c2VTdGF0dXMoKSB7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHJvb20uZXZlbnRzLnN0YXR1cy5zdWJzY3JpYmU7XG4gIGNvbnN0IGdldFNuYXBzaG90ID0gcm9vbS5nZXRTdGF0dXM7XG4gIGNvbnN0IGdldFNlcnZlclNuYXBzaG90ID0gcm9vbS5nZXRTdGF0dXM7XG4gIHJldHVybiB1c2VTeW5jRXh0ZXJuYWxTdG9yZTIoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgZ2V0U2VydmVyU25hcHNob3QpO1xufVxuZnVuY3Rpb24gdXNlU3RvcmFnZVN0YXR1cyhvcHRpb25zKSB7XG4gIGNvbnN0IHNtb290aCA9IHVzZUluaXRpYWwob3B0aW9ucz8uc21vb3RoID8/IGZhbHNlKTtcbiAgaWYgKHNtb290aCkge1xuICAgIHJldHVybiB1c2VTdG9yYWdlU3RhdHVzU21vb3RoKCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHVzZVN0b3JhZ2VTdGF0dXNJbW1lZGlhdGUoKTtcbiAgfVxufVxuZnVuY3Rpb24gdXNlU3RvcmFnZVN0YXR1c0ltbWVkaWF0ZSgpIHtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgY29uc3Qgc3Vic2NyaWJlID0gcm9vbS5ldmVudHMuc3RvcmFnZVN0YXR1cy5zdWJzY3JpYmU7XG4gIGNvbnN0IGdldFNuYXBzaG90ID0gcm9vbS5nZXRTdG9yYWdlU3RhdHVzO1xuICBjb25zdCBnZXRTZXJ2ZXJTbmFwc2hvdCA9IHJvb20uZ2V0U3RvcmFnZVN0YXR1cztcbiAgcmV0dXJuIHVzZVN5bmNFeHRlcm5hbFN0b3JlMihzdWJzY3JpYmUsIGdldFNuYXBzaG90LCBnZXRTZXJ2ZXJTbmFwc2hvdCk7XG59XG5mdW5jdGlvbiB1c2VTdG9yYWdlU3RhdHVzU21vb3RoKCkge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBbc3RhdHVzLCBzZXRTdGF0dXNdID0gUmVhY3Q0LnVzZVN0YXRlKHJvb20uZ2V0U3RvcmFnZVN0YXR1cyk7XG4gIGNvbnN0IG9sZFN0YXR1cyA9IHVzZUxhdGVzdChyb29tLmdldFN0b3JhZ2VTdGF0dXMoKSk7XG4gIFJlYWN0NC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGxldCB0aW1lb3V0SWQ7XG4gICAgY29uc3QgdW5zdWIgPSByb29tLmV2ZW50cy5zdG9yYWdlU3RhdHVzLnN1YnNjcmliZSgobmV3U3RhdHVzKSA9PiB7XG4gICAgICBpZiAob2xkU3RhdHVzLmN1cnJlbnQgPT09IFwic3luY2hyb25pemluZ1wiICYmIG5ld1N0YXR1cyA9PT0gXCJzeW5jaHJvbml6ZWRcIikge1xuICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHNldFN0YXR1cyhuZXdTdGF0dXMpLCBTTU9PVEhfREVMQVkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgIHNldFN0YXR1cyhuZXdTdGF0dXMpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIHVuc3ViKCk7XG4gICAgfTtcbiAgfSwgW3Jvb20sIG9sZFN0YXR1c10pO1xuICByZXR1cm4gc3RhdHVzO1xufVxuZnVuY3Rpb24gdXNlQmF0Y2goKSB7XG4gIHJldHVybiB1c2VSb29tKCkuYmF0Y2g7XG59XG5mdW5jdGlvbiB1c2VCcm9hZGNhc3RFdmVudCgpIHtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgcmV0dXJuIFJlYWN0NC51c2VDYWxsYmFjayhcbiAgICAoZXZlbnQsIG9wdGlvbnMgPSB7IHNob3VsZFF1ZXVlRXZlbnRJZk5vdFJlYWR5OiBmYWxzZSB9KSA9PiB7XG4gICAgICByb29tLmJyb2FkY2FzdEV2ZW50KGV2ZW50LCBvcHRpb25zKTtcbiAgICB9LFxuICAgIFtyb29tXVxuICApO1xufVxuZnVuY3Rpb24gdXNlT3RoZXJzTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgY29uc3Qgc2F2ZWRDYWxsYmFjayA9IHVzZUxhdGVzdChjYWxsYmFjayk7XG4gIFJlYWN0NC51c2VFZmZlY3QoXG4gICAgKCkgPT4gcm9vbS5ldmVudHMub3RoZXJzLnN1YnNjcmliZSgoZXZlbnQpID0+IHNhdmVkQ2FsbGJhY2suY3VycmVudChldmVudCkpLFxuICAgIFtyb29tLCBzYXZlZENhbGxiYWNrXVxuICApO1xufVxuZnVuY3Rpb24gdXNlTG9zdENvbm5lY3Rpb25MaXN0ZW5lcihjYWxsYmFjaykge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBzYXZlZENhbGxiYWNrID0gdXNlTGF0ZXN0KGNhbGxiYWNrKTtcbiAgUmVhY3Q0LnVzZUVmZmVjdChcbiAgICAoKSA9PiByb29tLmV2ZW50cy5sb3N0Q29ubmVjdGlvbi5zdWJzY3JpYmUoXG4gICAgICAoZXZlbnQpID0+IHNhdmVkQ2FsbGJhY2suY3VycmVudChldmVudClcbiAgICApLFxuICAgIFtyb29tLCBzYXZlZENhbGxiYWNrXVxuICApO1xufVxuZnVuY3Rpb24gdXNlRXJyb3JMaXN0ZW5lcihjYWxsYmFjaykge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBzYXZlZENhbGxiYWNrID0gdXNlTGF0ZXN0KGNhbGxiYWNrKTtcbiAgUmVhY3Q0LnVzZUVmZmVjdChcbiAgICAoKSA9PiByb29tLmV2ZW50cy5lcnJvci5zdWJzY3JpYmUoKGUpID0+IHNhdmVkQ2FsbGJhY2suY3VycmVudChlKSksXG4gICAgW3Jvb20sIHNhdmVkQ2FsbGJhY2tdXG4gICk7XG59XG5mdW5jdGlvbiB1c2VFdmVudExpc3RlbmVyKGNhbGxiYWNrKSB7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIGNvbnN0IHNhdmVkQ2FsbGJhY2sgPSB1c2VMYXRlc3QoY2FsbGJhY2spO1xuICBSZWFjdDQudXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBsaXN0ZW5lciA9IChldmVudERhdGEpID0+IHtcbiAgICAgIHNhdmVkQ2FsbGJhY2suY3VycmVudChldmVudERhdGEpO1xuICAgIH07XG4gICAgcmV0dXJuIHJvb20uZXZlbnRzLmN1c3RvbUV2ZW50LnN1YnNjcmliZShsaXN0ZW5lcik7XG4gIH0sIFtyb29tLCBzYXZlZENhbGxiYWNrXSk7XG59XG5mdW5jdGlvbiB1c2VIaXN0b3J5KCkge1xuICByZXR1cm4gdXNlUm9vbSgpLmhpc3Rvcnk7XG59XG5mdW5jdGlvbiB1c2VVbmRvKCkge1xuICByZXR1cm4gdXNlSGlzdG9yeSgpLnVuZG87XG59XG5mdW5jdGlvbiB1c2VSZWRvKCkge1xuICByZXR1cm4gdXNlSGlzdG9yeSgpLnJlZG87XG59XG5mdW5jdGlvbiB1c2VDYW5VbmRvKCkge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBzdWJzY3JpYmUgPSByb29tLmV2ZW50cy5oaXN0b3J5LnN1YnNjcmliZTtcbiAgY29uc3QgY2FuVW5kbyA9IHJvb20uaGlzdG9yeS5jYW5VbmRvO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmUyKHN1YnNjcmliZSwgY2FuVW5kbywgY2FuVW5kbyk7XG59XG5mdW5jdGlvbiB1c2VDYW5SZWRvKCkge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBzdWJzY3JpYmUgPSByb29tLmV2ZW50cy5oaXN0b3J5LnN1YnNjcmliZTtcbiAgY29uc3QgY2FuUmVkbyA9IHJvb20uaGlzdG9yeS5jYW5SZWRvO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmUyKHN1YnNjcmliZSwgY2FuUmVkbywgY2FuUmVkbyk7XG59XG5mdW5jdGlvbiB1c2VTZWxmKG1heWJlU2VsZWN0b3IsIGlzRXF1YWwpIHtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgY29uc3Qgc3Vic2NyaWJlID0gcm9vbS5ldmVudHMuc2VsZi5zdWJzY3JpYmU7XG4gIGNvbnN0IGdldFNuYXBzaG90ID0gcm9vbS5nZXRTZWxmO1xuICBjb25zdCBzZWxlY3RvciA9IG1heWJlU2VsZWN0b3IgPz8gaWRlbnRpdHk7XG4gIGNvbnN0IHdyYXBwZWRTZWxlY3RvciA9IFJlYWN0NC51c2VDYWxsYmFjayhcbiAgICAobWUpID0+IG1lICE9PSBudWxsID8gc2VsZWN0b3IobWUpIDogbnVsbCxcbiAgICBbc2VsZWN0b3JdXG4gICk7XG4gIGNvbnN0IGdldFNlcnZlclNuYXBzaG90ID0gYWx3YXlzTnVsbDtcbiAgcmV0dXJuIHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yMihcbiAgICBzdWJzY3JpYmUsXG4gICAgZ2V0U25hcHNob3QsXG4gICAgZ2V0U2VydmVyU25hcHNob3QsXG4gICAgd3JhcHBlZFNlbGVjdG9yLFxuICAgIGlzRXF1YWxcbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZU15UHJlc2VuY2UoKSB7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHJvb20uZXZlbnRzLm15UHJlc2VuY2Uuc3Vic2NyaWJlO1xuICBjb25zdCBnZXRTbmFwc2hvdCA9IHJvb20uZ2V0UHJlc2VuY2U7XG4gIGNvbnN0IHByZXNlbmNlID0gdXNlU3luY0V4dGVybmFsU3RvcmUyKHN1YnNjcmliZSwgZ2V0U25hcHNob3QsIGdldFNuYXBzaG90KTtcbiAgY29uc3Qgc2V0UHJlc2VuY2UgPSByb29tLnVwZGF0ZVByZXNlbmNlO1xuICByZXR1cm4gW3ByZXNlbmNlLCBzZXRQcmVzZW5jZV07XG59XG5mdW5jdGlvbiB1c2VVcGRhdGVNeVByZXNlbmNlKCkge1xuICByZXR1cm4gdXNlUm9vbSgpLnVwZGF0ZVByZXNlbmNlO1xufVxuZnVuY3Rpb24gdXNlT3RoZXJzKHNlbGVjdG9yLCBpc0VxdWFsKSB7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHJvb20uZXZlbnRzLm90aGVycy5zdWJzY3JpYmU7XG4gIGNvbnN0IGdldFNuYXBzaG90ID0gcm9vbS5nZXRPdGhlcnM7XG4gIGNvbnN0IGdldFNlcnZlclNuYXBzaG90ID0gYWx3YXlzRW1wdHlMaXN0O1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmVXaXRoU2VsZWN0b3IyKFxuICAgIHN1YnNjcmliZSxcbiAgICBnZXRTbmFwc2hvdCxcbiAgICBnZXRTZXJ2ZXJTbmFwc2hvdCxcbiAgICBzZWxlY3RvciA/PyBpZGVudGl0eSxcbiAgICBpc0VxdWFsXG4gICk7XG59XG5mdW5jdGlvbiB1c2VPdGhlcnNNYXBwZWQoaXRlbVNlbGVjdG9yLCBpdGVtSXNFcXVhbCkge1xuICBjb25zdCB3cmFwcGVkU2VsZWN0b3IgPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKG90aGVycykgPT4gb3RoZXJzLm1hcCgob3RoZXIpID0+IFtvdGhlci5jb25uZWN0aW9uSWQsIGl0ZW1TZWxlY3RvcihvdGhlcildKSxcbiAgICBbaXRlbVNlbGVjdG9yXVxuICApO1xuICBjb25zdCB3cmFwcGVkSXNFcXVhbCA9IFJlYWN0NC51c2VDYWxsYmFjayhcbiAgICAoYSwgYikgPT4ge1xuICAgICAgY29uc3QgZXEgPSBpdGVtSXNFcXVhbCA/PyBPYmplY3QuaXM7XG4gICAgICByZXR1cm4gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuZXZlcnkoKGF0dXBsZSwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgYnR1cGxlID0gYltpbmRleF07XG4gICAgICAgIHJldHVybiBhdHVwbGVbMF0gPT09IGJ0dXBsZVswXSAmJiBlcShhdHVwbGVbMV0sIGJ0dXBsZVsxXSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFtpdGVtSXNFcXVhbF1cbiAgKTtcbiAgcmV0dXJuIHVzZU90aGVycyh3cmFwcGVkU2VsZWN0b3IsIHdyYXBwZWRJc0VxdWFsKTtcbn1cbmZ1bmN0aW9uIHVzZU90aGVyc0Nvbm5lY3Rpb25JZHMoKSB7XG4gIHJldHVybiB1c2VPdGhlcnMoc2VsZWN0b3JGb3JfdXNlT3RoZXJzQ29ubmVjdGlvbklkcywgc2hhbGxvdzIpO1xufVxudmFyIE5PVF9GT1VORCA9IFN5bWJvbCgpO1xuZnVuY3Rpb24gdXNlT3RoZXIoY29ubmVjdGlvbklkLCBzZWxlY3RvciwgaXNFcXVhbCkge1xuICBjb25zdCB3cmFwcGVkU2VsZWN0b3IgPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKG90aGVycykgPT4ge1xuICAgICAgY29uc3Qgb3RoZXIyID0gb3RoZXJzLmZpbmQoKG90aGVyMykgPT4gb3RoZXIzLmNvbm5lY3Rpb25JZCA9PT0gY29ubmVjdGlvbklkKTtcbiAgICAgIHJldHVybiBvdGhlcjIgIT09IHZvaWQgMCA/IHNlbGVjdG9yKG90aGVyMikgOiBOT1RfRk9VTkQ7XG4gICAgfSxcbiAgICBbY29ubmVjdGlvbklkLCBzZWxlY3Rvcl1cbiAgKTtcbiAgY29uc3Qgd3JhcHBlZElzRXF1YWwgPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHByZXYsIGN1cnIpID0+IHtcbiAgICAgIGlmIChwcmV2ID09PSBOT1RfRk9VTkQgfHwgY3VyciA9PT0gTk9UX0ZPVU5EKSB7XG4gICAgICAgIHJldHVybiBwcmV2ID09PSBjdXJyO1xuICAgICAgfVxuICAgICAgY29uc3QgZXEgPSBpc0VxdWFsID8/IE9iamVjdC5pcztcbiAgICAgIHJldHVybiBlcShwcmV2LCBjdXJyKTtcbiAgICB9LFxuICAgIFtpc0VxdWFsXVxuICApO1xuICBjb25zdCBvdGhlciA9IHVzZU90aGVycyh3cmFwcGVkU2VsZWN0b3IsIHdyYXBwZWRJc0VxdWFsKTtcbiAgaWYgKG90aGVyID09PSBOT1RfRk9VTkQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgTm8gc3VjaCBvdGhlciB1c2VyIHdpdGggY29ubmVjdGlvbiBpZCAke2Nvbm5lY3Rpb25JZH0gZXhpc3RzYFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIG90aGVyO1xufVxuZnVuY3Rpb24gdXNlTXV0YWJsZVN0b3JhZ2VSb290KCkge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBzdWJzY3JpYmUgPSByb29tLmV2ZW50cy5zdG9yYWdlRGlkTG9hZC5zdWJzY3JpYmVPbmNlO1xuICBjb25zdCBnZXRTbmFwc2hvdCA9IHJvb20uZ2V0U3RvcmFnZVNuYXBzaG90O1xuICBjb25zdCBnZXRTZXJ2ZXJTbmFwc2hvdCA9IGFsd2F5c051bGw7XG4gIHJldHVybiB1c2VTeW5jRXh0ZXJuYWxTdG9yZTIoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgZ2V0U2VydmVyU25hcHNob3QpO1xufVxuZnVuY3Rpb24gdXNlU3RvcmFnZVJvb3QoKSB7XG4gIHJldHVybiBbdXNlTXV0YWJsZVN0b3JhZ2VSb290KCldO1xufVxuZnVuY3Rpb24gdXNlU3RvcmFnZShzZWxlY3RvciwgaXNFcXVhbCkge1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCByb290T3JOdWxsID0gdXNlTXV0YWJsZVN0b3JhZ2VSb290KCk7XG4gIGNvbnN0IHdyYXBwZWRTZWxlY3RvciA9IFJlYWN0NC51c2VDYWxsYmFjayhcbiAgICAocm9vdE9yTnVsbDIpID0+IHJvb3RPck51bGwyICE9PSBudWxsID8gc2VsZWN0b3Iocm9vdE9yTnVsbDIpIDogbnVsbCxcbiAgICBbc2VsZWN0b3JdXG4gICk7XG4gIGNvbnN0IHN1YnNjcmliZSA9IFJlYWN0NC51c2VDYWxsYmFjayhcbiAgICAob25TdG9yZUNoYW5nZSkgPT4gcm9vdE9yTnVsbCAhPT0gbnVsbCA/IHJvb20uc3Vic2NyaWJlKHJvb3RPck51bGwsIG9uU3RvcmVDaGFuZ2UsIHsgaXNEZWVwOiB0cnVlIH0pIDogbm9vcDIsXG4gICAgW3Jvb20sIHJvb3RPck51bGxdXG4gICk7XG4gIGNvbnN0IGdldFNuYXBzaG90ID0gUmVhY3Q0LnVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAocm9vdE9yTnVsbCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHJvb3QgPSByb290T3JOdWxsO1xuICAgICAgY29uc3QgaW1tID0gcm9vdC50b0ltbXV0YWJsZSgpO1xuICAgICAgcmV0dXJuIGltbTtcbiAgICB9XG4gIH0sIFtyb290T3JOdWxsXSk7XG4gIGNvbnN0IGdldFNlcnZlclNuYXBzaG90ID0gYWx3YXlzTnVsbDtcbiAgcmV0dXJuIHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yMihcbiAgICBzdWJzY3JpYmUsXG4gICAgZ2V0U25hcHNob3QsXG4gICAgZ2V0U2VydmVyU25hcHNob3QsXG4gICAgd3JhcHBlZFNlbGVjdG9yLFxuICAgIGlzRXF1YWxcbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZU11dGF0aW9uKGNhbGxiYWNrLCBkZXBzKSB7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIHJldHVybiBSZWFjdDQudXNlTWVtbyhcbiAgICAoKSA9PiB7XG4gICAgICByZXR1cm4gKC4uLmFyZ3MpID0+IChcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtcmV0dXJuXG4gICAgICAgIHJvb20uYmF0Y2goXG4gICAgICAgICAgKCkgPT4gKFxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtcmV0dXJuXG4gICAgICAgICAgICBjYWxsYmFjayhcbiAgICAgICAgICAgICAgbWFrZU11dGF0aW9uQ29udGV4dChyb29tKSxcbiAgICAgICAgICAgICAgLi4uYXJnc1xuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9LFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgICBbcm9vbSwgLi4uZGVwc11cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZVRocmVhZHMob3B0aW9ucyA9IHtcbiAgcXVlcnk6IHsgbWV0YWRhdGE6IHt9IH1cbn0pIHtcbiAgY29uc3QgeyBzY3JvbGxPbkxvYWQgPSB0cnVlIH0gPSBvcHRpb25zO1xuICBjb25zdCBjbGllbnQgPSB1c2VDbGllbnQoKTtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgY29uc3QgcXVlcnlLZXkgPSBSZWFjdDQudXNlTWVtbyhcbiAgICAoKSA9PiBnZW5lcmF0ZVF1ZXJ5S2V5KHJvb20uaWQsIG9wdGlvbnMucXVlcnkpLFxuICAgIFtyb29tLCBvcHRpb25zXVxuICApO1xuICBjb25zdCB7IHN0b3JlLCBnZXRUaHJlYWRzQW5kSW5ib3hOb3RpZmljYXRpb25zLCBpbmNyZW1lbnRRdWVyeVN1YnNjcmliZXJzIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gIFJlYWN0NC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHZvaWQgZ2V0VGhyZWFkc0FuZEluYm94Tm90aWZpY2F0aW9ucyhyb29tLCBxdWVyeUtleSwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIGluY3JlbWVudFF1ZXJ5U3Vic2NyaWJlcnMocXVlcnlLZXkpO1xuICB9LCBbcm9vbSwgcXVlcnlLZXldKTtcbiAgY29uc3Qgc2VsZWN0b3IgPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHN0YXRlMikgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSBzdGF0ZTIucXVlcmllc1txdWVyeUtleV07XG4gICAgICBpZiAocXVlcnkgPT09IHZvaWQgMCB8fCBxdWVyeS5pc0xvYWRpbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpc0xvYWRpbmc6IHRydWVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZHM6IHNlbGVjdGVkVGhyZWFkcyhyb29tLmlkLCBzdGF0ZTIsIG9wdGlvbnMpLFxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICBlcnJvcjogcXVlcnkuZXJyb3JcbiAgICAgIH07XG4gICAgfSxcbiAgICBbcm9vbSwgcXVlcnlLZXldXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgKTtcbiAgY29uc3Qgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZVdpdGhTZWxlY3RvcjIoXG4gICAgc3RvcmUuc3Vic2NyaWJlLFxuICAgIHN0b3JlLmdldCxcbiAgICBzdG9yZS5nZXQsXG4gICAgc2VsZWN0b3JcbiAgKTtcbiAgdXNlU2Nyb2xsVG9Db21tZW50T25Mb2FkRWZmZWN0KHNjcm9sbE9uTG9hZCwgc3RhdGUpO1xuICByZXR1cm4gc3RhdGU7XG59XG5mdW5jdGlvbiB1c2VDb21tZW50c0Vycm9yTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIGNvbnN0IHNhdmVkQ2FsbGJhY2sgPSB1c2VMYXRlc3QoY2FsbGJhY2spO1xuICBjb25zdCB7IGNvbW1lbnRzRXJyb3JFdmVudFNvdXJjZSB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICBSZWFjdDQudXNlRWZmZWN0KCgpID0+IHtcbiAgICByZXR1cm4gY29tbWVudHNFcnJvckV2ZW50U291cmNlLnN1YnNjcmliZShzYXZlZENhbGxiYWNrLmN1cnJlbnQpO1xuICB9LCBbc2F2ZWRDYWxsYmFjaywgY29tbWVudHNFcnJvckV2ZW50U291cmNlXSk7XG59XG5mdW5jdGlvbiB1c2VDcmVhdGVUaHJlYWQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgIChvcHRpb25zKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gb3B0aW9ucy5ib2R5O1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSBvcHRpb25zLm1ldGFkYXRhID8/IHt9O1xuICAgICAgY29uc3QgdGhyZWFkSWQgPSBjcmVhdGVUaHJlYWRJZCgpO1xuICAgICAgY29uc3QgY29tbWVudElkID0gY3JlYXRlQ29tbWVudElkKCk7XG4gICAgICBjb25zdCBjcmVhdGVkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IG5ld0NvbW1lbnQgPSB7XG4gICAgICAgIGlkOiBjb21tZW50SWQsXG4gICAgICAgIHRocmVhZElkLFxuICAgICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICAgIGNyZWF0ZWRBdCxcbiAgICAgICAgdHlwZTogXCJjb21tZW50XCIsXG4gICAgICAgIHVzZXJJZDogZ2V0Q3VycmVudFVzZXJJZChyb29tKSxcbiAgICAgICAgYm9keSxcbiAgICAgICAgcmVhY3Rpb25zOiBbXVxuICAgICAgfTtcbiAgICAgIGNvbnN0IG5ld1RocmVhZCA9IHtcbiAgICAgICAgaWQ6IHRocmVhZElkLFxuICAgICAgICB0eXBlOiBcInRocmVhZFwiLFxuICAgICAgICBjcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogY3JlYXRlZEF0LFxuICAgICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICAgIG1ldGFkYXRhLFxuICAgICAgICBjb21tZW50czogW25ld0NvbW1lbnRdLFxuICAgICAgICByZXNvbHZlZDogZmFsc2VcbiAgICAgIH07XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQyKCk7XG4gICAgICBjb25zdCB7IHN0b3JlLCBvbk11dGF0aW9uRmFpbHVyZSB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgICAgc3RvcmUucHVzaE9wdGltaXN0aWNVcGRhdGUoe1xuICAgICAgICB0eXBlOiBcImNyZWF0ZS10aHJlYWRcIixcbiAgICAgICAgdGhyZWFkOiBuZXdUaHJlYWQsXG4gICAgICAgIGlkOiBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgIHJvb21JZDogcm9vbS5pZFxuICAgICAgfSk7XG4gICAgICByb29tLmNyZWF0ZVRocmVhZCh7IHRocmVhZElkLCBjb21tZW50SWQsIGJvZHksIG1ldGFkYXRhIH0pLnRoZW4oXG4gICAgICAgICh0aHJlYWQpID0+IHtcbiAgICAgICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICB0aHJlYWRzOiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgICAgIFt0aHJlYWRJZF06IHRocmVhZFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApXG4gICAgICAgICAgfSkpO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyKSA9PiBvbk11dGF0aW9uRmFpbHVyZShcbiAgICAgICAgICBlcnIsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZUlkLFxuICAgICAgICAgIChlcnIyKSA9PiBuZXcgQ3JlYXRlVGhyZWFkRXJyb3IoZXJyMiwge1xuICAgICAgICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgICAgICAgdGhyZWFkSWQsXG4gICAgICAgICAgICBjb21tZW50SWQsXG4gICAgICAgICAgICBib2R5LFxuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgcmV0dXJuIG5ld1RocmVhZDtcbiAgICB9LFxuICAgIFtjbGllbnQsIHJvb21dXG4gICk7XG59XG5mdW5jdGlvbiB1c2VEZWxldGVUaHJlYWQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh0aHJlYWRJZCkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW1pc3RpY1VwZGF0ZUlkID0gbmFub2lkMigpO1xuICAgICAgY29uc3QgeyBzdG9yZSwgb25NdXRhdGlvbkZhaWx1cmUgfSA9IGdldEV4dHJhc0ZvckNsaWVudDIoY2xpZW50KTtcbiAgICAgIGNvbnN0IHRocmVhZCA9IHN0b3JlLmdldCgpLnRocmVhZHNbdGhyZWFkSWRdO1xuICAgICAgY29uc3QgdXNlcklkID0gZ2V0Q3VycmVudFVzZXJJZChyb29tKTtcbiAgICAgIGlmICh0aHJlYWQ/LmNvbW1lbnRzPy5bMF0/LnVzZXJJZCAhPT0gdXNlcklkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9ubHkgdGhlIHRocmVhZCBjcmVhdG9yIGNhbiBkZWxldGUgdGhlIHRocmVhZFwiKTtcbiAgICAgIH1cbiAgICAgIHN0b3JlLnB1c2hPcHRpbWlzdGljVXBkYXRlKHtcbiAgICAgICAgdHlwZTogXCJkZWxldGUtdGhyZWFkXCIsXG4gICAgICAgIGlkOiBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICAgICAgdGhyZWFkSWQsXG4gICAgICAgIGRlbGV0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKClcbiAgICAgIH0pO1xuICAgICAgcm9vbS5kZWxldGVUaHJlYWQodGhyZWFkSWQpLnRoZW4oXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHN0YXRlLnRocmVhZHNbdGhyZWFkSWRdO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgIHRocmVhZHM6IHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS50aHJlYWRzLFxuICAgICAgICAgICAgICAgIFt0aHJlYWRJZF06IHtcbiAgICAgICAgICAgICAgICAgIC4uLmV4aXN0aW5nVGhyZWFkLFxuICAgICAgICAgICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICAgIGRlbGV0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgKHVwZGF0ZSkgPT4gdXBkYXRlLmlkICE9PSBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycikgPT4gb25NdXRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAoZXJyMikgPT4gbmV3IERlbGV0ZVRocmVhZEVycm9yKGVycjIsIHsgcm9vbUlkOiByb29tLmlkLCB0aHJlYWRJZCB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudCwgcm9vbV1cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZUVkaXRUaHJlYWRNZXRhZGF0YSgpIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIHJldHVybiBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKG9wdGlvbnMpID0+IHtcbiAgICAgIGlmICghb3B0aW9ucy5tZXRhZGF0YSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB0aHJlYWRJZCA9IG9wdGlvbnMudGhyZWFkSWQ7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IG9wdGlvbnMubWV0YWRhdGE7XG4gICAgICBjb25zdCB1cGRhdGVkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IG9wdGltaXN0aWNVcGRhdGVJZCA9IG5hbm9pZDIoKTtcbiAgICAgIGNvbnN0IHsgc3RvcmUsIG9uTXV0YXRpb25GYWlsdXJlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICAgIHR5cGU6IFwiZWRpdC10aHJlYWQtbWV0YWRhdGFcIixcbiAgICAgICAgbWV0YWRhdGEsXG4gICAgICAgIGlkOiBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgIHRocmVhZElkLFxuICAgICAgICB1cGRhdGVkQXRcbiAgICAgIH0pO1xuICAgICAgcm9vbS5lZGl0VGhyZWFkTWV0YWRhdGEoeyBtZXRhZGF0YSwgdGhyZWFkSWQgfSkudGhlbihcbiAgICAgICAgKG1ldGFkYXRhMikgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXMgPSBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdUaHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdUaHJlYWQudXBkYXRlZEF0ICYmIGV4aXN0aW5nVGhyZWFkLnVwZGF0ZWRBdCA+IHVwZGF0ZWRBdCkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXNcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICB0aHJlYWRzOiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUudGhyZWFkcyxcbiAgICAgICAgICAgICAgICBbdGhyZWFkSWRdOiB7XG4gICAgICAgICAgICAgICAgICAuLi5leGlzdGluZ1RocmVhZCxcbiAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YTJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnIpID0+IG9uTXV0YXRpb25GYWlsdXJlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgICAgKGVycm9yKSA9PiBuZXcgRWRpdFRocmVhZE1ldGFkYXRhRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICAgICAgICAgIHRocmVhZElkLFxuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudCwgcm9vbV1cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZUNyZWF0ZUNvbW1lbnQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh7IHRocmVhZElkLCBib2R5IH0pID0+IHtcbiAgICAgIGNvbnN0IGNvbW1lbnRJZCA9IGNyZWF0ZUNvbW1lbnRJZCgpO1xuICAgICAgY29uc3QgY3JlYXRlZEF0ID0gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBjb21tZW50ID0ge1xuICAgICAgICBpZDogY29tbWVudElkLFxuICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgICB0eXBlOiBcImNvbW1lbnRcIixcbiAgICAgICAgY3JlYXRlZEF0LFxuICAgICAgICB1c2VySWQ6IGdldEN1cnJlbnRVc2VySWQocm9vbSksXG4gICAgICAgIGJvZHksXG4gICAgICAgIHJlYWN0aW9uczogW11cbiAgICAgIH07XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQyKCk7XG4gICAgICBjb25zdCB7IHN0b3JlLCBvbk11dGF0aW9uRmFpbHVyZSB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgICAgc3RvcmUucHVzaE9wdGltaXN0aWNVcGRhdGUoe1xuICAgICAgICB0eXBlOiBcImNyZWF0ZS1jb21tZW50XCIsXG4gICAgICAgIGNvbW1lbnQsXG4gICAgICAgIGlkOiBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgIH0pO1xuICAgICAgcm9vbS5jcmVhdGVDb21tZW50KHsgdGhyZWFkSWQsIGNvbW1lbnRJZCwgYm9keSB9KS50aGVuKFxuICAgICAgICAobmV3Q29tbWVudCkgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXMgPSBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbmJveE5vdGlmaWNhdGlvbiA9IE9iamVjdC52YWx1ZXMoXG4gICAgICAgICAgICAgIHN0YXRlLmluYm94Tm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgKS5maW5kKFxuICAgICAgICAgICAgICAobm90aWZpY2F0aW9uKSA9PiBub3RpZmljYXRpb24ua2luZCA9PT0gXCJ0aHJlYWRcIiAmJiBub3RpZmljYXRpb24udGhyZWFkSWQgPT09IHRocmVhZElkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEluYm94Tm90aWZpY2F0aW9ucyA9IGluYm94Tm90aWZpY2F0aW9uICE9PSB2b2lkIDAgPyB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLmluYm94Tm90aWZpY2F0aW9ucyxcbiAgICAgICAgICAgICAgW2luYm94Tm90aWZpY2F0aW9uLmlkXToge1xuICAgICAgICAgICAgICAgIC4uLmluYm94Tm90aWZpY2F0aW9uLFxuICAgICAgICAgICAgICAgIG5vdGlmaWVkQXQ6IG5ld0NvbW1lbnQuY3JlYXRlZEF0LFxuICAgICAgICAgICAgICAgIHJlYWRBdDogbmV3Q29tbWVudC5jcmVhdGVkQXRcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSA6IHN0YXRlLmluYm94Tm90aWZpY2F0aW9ucztcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICB0aHJlYWRzOiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUudGhyZWFkcyxcbiAgICAgICAgICAgICAgICBbdGhyZWFkSWRdOiB1cHNlcnRDb21tZW50KGV4aXN0aW5nVGhyZWFkLCBuZXdDb21tZW50KVxuICAgICAgICAgICAgICAgIC8vIFVwc2VydCB0aGUgbmV3IGNvbW1lbnQgaW50byB0aGUgdGhyZWFkIGNvbW1lbnRzIGxpc3QgKGlmIGFwcGxpY2FibGUpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGluYm94Tm90aWZpY2F0aW9uczogdXBkYXRlZEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycikgPT4gb25NdXRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAoZXJyMikgPT4gbmV3IENyZWF0ZUNvbW1lbnRFcnJvcihlcnIyLCB7XG4gICAgICAgICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgICAgIGNvbW1lbnRJZCxcbiAgICAgICAgICAgIGJvZHlcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgcmV0dXJuIGNvbW1lbnQ7XG4gICAgfSxcbiAgICBbY2xpZW50LCByb29tXVxuICApO1xufVxuZnVuY3Rpb24gdXNlRWRpdENvbW1lbnQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh7IHRocmVhZElkLCBjb21tZW50SWQsIGJvZHkgfSkgPT4ge1xuICAgICAgY29uc3QgZWRpdGVkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IG9wdGltaXN0aWNVcGRhdGVJZCA9IG5hbm9pZDIoKTtcbiAgICAgIGNvbnN0IHsgc3RvcmUsIG9uTXV0YXRpb25GYWlsdXJlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgICBjb25zdCB0aHJlYWQgPSBzdG9yZS5nZXQoKS50aHJlYWRzW3RocmVhZElkXTtcbiAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICBjb25zb2xlMi53YXJuKFxuICAgICAgICAgIGBJbnRlcm5hbCB1bmV4cGVjdGVkIGJlaGF2aW9yLiBDYW5ub3QgZWRpdCBjb21tZW50IGluIHRocmVhZCBcIiR7dGhyZWFkSWR9XCIgYmVjYXVzZSB0aGUgdGhyZWFkIGRvZXMgbm90IGV4aXN0IGluIHRoZSBjYWNoZS5gXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbW1lbnQgPSB0aHJlYWQuY29tbWVudHMuZmluZChcbiAgICAgICAgKGNvbW1lbnQyKSA9PiBjb21tZW50Mi5pZCA9PT0gY29tbWVudElkXG4gICAgICApO1xuICAgICAgaWYgKGNvbW1lbnQgPT09IHZvaWQgMCB8fCBjb21tZW50LmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnNvbGUyLndhcm4oXG4gICAgICAgICAgYEludGVybmFsIHVuZXhwZWN0ZWQgYmVoYXZpb3IuIENhbm5vdCBlZGl0IGNvbW1lbnQgXCIke2NvbW1lbnRJZH1cIiBpbiB0aHJlYWQgXCIke3RocmVhZElkfVwiIGJlY2F1c2UgdGhlIGNvbW1lbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGNhY2hlLmBcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgc3RvcmUucHVzaE9wdGltaXN0aWNVcGRhdGUoe1xuICAgICAgICB0eXBlOiBcImVkaXQtY29tbWVudFwiLFxuICAgICAgICBjb21tZW50OiB7XG4gICAgICAgICAgLi4uY29tbWVudCxcbiAgICAgICAgICBlZGl0ZWRBdCxcbiAgICAgICAgICBib2R5XG4gICAgICAgIH0sXG4gICAgICAgIGlkOiBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgIH0pO1xuICAgICAgcm9vbS5lZGl0Q29tbWVudCh7IHRocmVhZElkLCBjb21tZW50SWQsIGJvZHkgfSkudGhlbihcbiAgICAgICAgKGVkaXRlZENvbW1lbnQpID0+IHtcbiAgICAgICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHN0YXRlLnRocmVhZHNbdGhyZWFkSWRdO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzID0gc3RhdGUub3B0aW1pc3RpY1VwZGF0ZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ1RocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgIHRocmVhZHM6IHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS50aHJlYWRzLFxuICAgICAgICAgICAgICAgIFt0aHJlYWRJZF06IHVwc2VydENvbW1lbnQoZXhpc3RpbmdUaHJlYWQsIGVkaXRlZENvbW1lbnQpXG4gICAgICAgICAgICAgICAgLy8gVXBzZXJ0IHRoZSBlZGl0ZWQgY29tbWVudCBpbnRvIHRoZSB0aHJlYWQgY29tbWVudHMgbGlzdCAoaWYgYXBwbGljYWJsZSlcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycikgPT4gb25NdXRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAoZXJyb3IpID0+IG5ldyBFZGl0Q29tbWVudEVycm9yKGVycm9yLCB7XG4gICAgICAgICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgICAgIGNvbW1lbnRJZCxcbiAgICAgICAgICAgIGJvZHlcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudCwgcm9vbV1cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZURlbGV0ZUNvbW1lbnQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh7IHRocmVhZElkLCBjb21tZW50SWQgfSkgPT4ge1xuICAgICAgY29uc3QgZGVsZXRlZEF0ID0gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQyKCk7XG4gICAgICBjb25zdCB7IHN0b3JlLCBvbk11dGF0aW9uRmFpbHVyZSB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgICAgc3RvcmUucHVzaE9wdGltaXN0aWNVcGRhdGUoe1xuICAgICAgICB0eXBlOiBcImRlbGV0ZS1jb21tZW50XCIsXG4gICAgICAgIHRocmVhZElkLFxuICAgICAgICBjb21tZW50SWQsXG4gICAgICAgIGRlbGV0ZWRBdCxcbiAgICAgICAgaWQ6IG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgcm9vbUlkOiByb29tLmlkXG4gICAgICB9KTtcbiAgICAgIHJvb20uZGVsZXRlQ29tbWVudCh7IHRocmVhZElkLCBjb21tZW50SWQgfSkudGhlbihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXMgPSBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgICAgICAgW3RocmVhZElkXTogZGVsZXRlQ29tbWVudChleGlzdGluZ1RocmVhZCwgY29tbWVudElkLCBkZWxldGVkQXQpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnIpID0+IG9uTXV0YXRpb25GYWlsdXJlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgICAgKGVycm9yKSA9PiBuZXcgRGVsZXRlQ29tbWVudEVycm9yKGVycm9yLCB7XG4gICAgICAgICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgICAgIGNvbW1lbnRJZFxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcbiAgICBbY2xpZW50LCByb29tXVxuICApO1xufVxuZnVuY3Rpb24gdXNlQWRkUmVhY3Rpb24oKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh7IHRocmVhZElkLCBjb21tZW50SWQsIGVtb2ppIH0pID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZWRBdCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgdXNlcklkID0gZ2V0Q3VycmVudFVzZXJJZChyb29tKTtcbiAgICAgIGNvbnN0IG9wdGltaXN0aWNVcGRhdGVJZCA9IG5hbm9pZDIoKTtcbiAgICAgIGNvbnN0IHsgc3RvcmUsIG9uTXV0YXRpb25GYWlsdXJlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICAgIHR5cGU6IFwiYWRkLXJlYWN0aW9uXCIsXG4gICAgICAgIHRocmVhZElkLFxuICAgICAgICBjb21tZW50SWQsXG4gICAgICAgIHJlYWN0aW9uOiB7XG4gICAgICAgICAgZW1vamksXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICB9LFxuICAgICAgICBpZDogb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICB9KTtcbiAgICAgIHJvb20uYWRkUmVhY3Rpb24oeyB0aHJlYWRJZCwgY29tbWVudElkLCBlbW9qaSB9KS50aGVuKFxuICAgICAgICAoYWRkZWRSZWFjdGlvbikgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXMgPSBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgICAgICAgW3RocmVhZElkXTogYWRkUmVhY3Rpb24oXG4gICAgICAgICAgICAgICAgICBleGlzdGluZ1RocmVhZCxcbiAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZCxcbiAgICAgICAgICAgICAgICAgIGFkZGVkUmVhY3Rpb25cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnIpID0+IG9uTXV0YXRpb25GYWlsdXJlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgICAgKGVycm9yKSA9PiBuZXcgQWRkUmVhY3Rpb25FcnJvcihlcnJvciwge1xuICAgICAgICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgICAgICAgdGhyZWFkSWQsXG4gICAgICAgICAgICBjb21tZW50SWQsXG4gICAgICAgICAgICBlbW9qaVxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcbiAgICBbY2xpZW50LCByb29tXVxuICApO1xufVxuZnVuY3Rpb24gdXNlUmVtb3ZlUmVhY3Rpb24oKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh7IHRocmVhZElkLCBjb21tZW50SWQsIGVtb2ppIH0pID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGdldEN1cnJlbnRVc2VySWQocm9vbSk7XG4gICAgICBjb25zdCByZW1vdmVkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IG9wdGltaXN0aWNVcGRhdGVJZCA9IG5hbm9pZDIoKTtcbiAgICAgIGNvbnN0IHsgc3RvcmUsIG9uTXV0YXRpb25GYWlsdXJlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICAgIHR5cGU6IFwicmVtb3ZlLXJlYWN0aW9uXCIsXG4gICAgICAgIHRocmVhZElkLFxuICAgICAgICBjb21tZW50SWQsXG4gICAgICAgIGVtb2ppLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHJlbW92ZWRBdCxcbiAgICAgICAgaWQ6IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgfSk7XG4gICAgICByb29tLnJlbW92ZVJlYWN0aW9uKHsgdGhyZWFkSWQsIGNvbW1lbnRJZCwgZW1vamkgfSkudGhlbihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXMgPSBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgICAgICAgW3RocmVhZElkXTogcmVtb3ZlUmVhY3Rpb24oXG4gICAgICAgICAgICAgICAgICBleGlzdGluZ1RocmVhZCxcbiAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZCxcbiAgICAgICAgICAgICAgICAgIGVtb2ppLFxuICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgcmVtb3ZlZEF0XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyKSA9PiBvbk11dGF0aW9uRmFpbHVyZShcbiAgICAgICAgICBlcnIsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZUlkLFxuICAgICAgICAgIChlcnJvcikgPT4gbmV3IFJlbW92ZVJlYWN0aW9uRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICAgICAgICAgIHRocmVhZElkLFxuICAgICAgICAgICAgY29tbWVudElkLFxuICAgICAgICAgICAgZW1vamlcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudCwgcm9vbV1cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZU1hcmtUaHJlYWRBc1JlYWQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICByZXR1cm4gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgICh0aHJlYWRJZCkgPT4ge1xuICAgICAgY29uc3QgeyBzdG9yZSwgb25NdXRhdGlvbkZhaWx1cmUgfSA9IGdldEV4dHJhc0ZvckNsaWVudDIoY2xpZW50KTtcbiAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uID0gT2JqZWN0LnZhbHVlcyhcbiAgICAgICAgc3RvcmUuZ2V0KCkuaW5ib3hOb3RpZmljYXRpb25zXG4gICAgICApLmZpbmQoXG4gICAgICAgIChpbmJveE5vdGlmaWNhdGlvbjIpID0+IGluYm94Tm90aWZpY2F0aW9uMi5raW5kID09PSBcInRocmVhZFwiICYmIGluYm94Tm90aWZpY2F0aW9uMi50aHJlYWRJZCA9PT0gdGhyZWFkSWRcbiAgICAgICk7XG4gICAgICBpZiAoIWluYm94Tm90aWZpY2F0aW9uKSByZXR1cm47XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQyKCk7XG4gICAgICBjb25zdCBub3cgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIHN0b3JlLnB1c2hPcHRpbWlzdGljVXBkYXRlKHtcbiAgICAgICAgdHlwZTogXCJtYXJrLWluYm94LW5vdGlmaWNhdGlvbi1hcy1yZWFkXCIsXG4gICAgICAgIGlkOiBvcHRpbWlzdGljVXBkYXRlSWQsXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uSWQ6IGluYm94Tm90aWZpY2F0aW9uLmlkLFxuICAgICAgICByZWFkQXQ6IG5vd1xuICAgICAgfSk7XG4gICAgICByb29tLm1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZChpbmJveE5vdGlmaWNhdGlvbi5pZCkudGhlbihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgIGluYm94Tm90aWZpY2F0aW9uczoge1xuICAgICAgICAgICAgICAuLi5zdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgICAgIFtpbmJveE5vdGlmaWNhdGlvbi5pZF06IHtcbiAgICAgICAgICAgICAgICAuLi5pbmJveE5vdGlmaWNhdGlvbixcbiAgICAgICAgICAgICAgICByZWFkQXQ6IG5vd1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzLmZpbHRlcihcbiAgICAgICAgICAgICAgKHVwZGF0ZSkgPT4gdXBkYXRlLmlkICE9PSBvcHRpbWlzdGljVXBkYXRlSWRcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9KSk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICBvbk11dGF0aW9uRmFpbHVyZShcbiAgICAgICAgICAgIGVycixcbiAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAgIChlcnJvcikgPT4gbmV3IE1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZEVycm9yKGVycm9yLCB7XG4gICAgICAgICAgICAgIGluYm94Tm90aWZpY2F0aW9uSWQ6IGluYm94Tm90aWZpY2F0aW9uLmlkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudCwgcm9vbV1cbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZU1hcmtUaHJlYWRBc1Jlc29sdmVkKCkge1xuICBjb25zdCBjbGllbnQgPSB1c2VDbGllbnQoKTtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgcmV0dXJuIFJlYWN0NC51c2VDYWxsYmFjayhcbiAgICAodGhyZWFkSWQpID0+IHtcbiAgICAgIGNvbnN0IG9wdGltaXN0aWNVcGRhdGVJZCA9IG5hbm9pZDIoKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWRBdCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgeyBzdG9yZSwgb25NdXRhdGlvbkZhaWx1cmUgfSA9IGdldEV4dHJhc0ZvckNsaWVudDIoY2xpZW50KTtcbiAgICAgIHN0b3JlLnB1c2hPcHRpbWlzdGljVXBkYXRlKHtcbiAgICAgICAgdHlwZTogXCJtYXJrLXRocmVhZC1hcy1yZXNvbHZlZFwiLFxuICAgICAgICBpZDogb3B0aW1pc3RpY1VwZGF0ZUlkLFxuICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgdXBkYXRlZEF0XG4gICAgICB9KTtcbiAgICAgIHJvb20ubWFya1RocmVhZEFzUmVzb2x2ZWQodGhyZWFkSWQpLnRoZW4oXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHN0YXRlLnRocmVhZHNbdGhyZWFkSWRdO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzID0gc3RhdGUub3B0aW1pc3RpY1VwZGF0ZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ1RocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkLmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkLnVwZGF0ZWRBdCAmJiBleGlzdGluZ1RocmVhZC51cGRhdGVkQXQgPiB1cGRhdGVkQXQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgICAgICAgW3RocmVhZElkXToge1xuICAgICAgICAgICAgICAgICAgLi4uZXhpc3RpbmdUaHJlYWQsXG4gICAgICAgICAgICAgICAgICByZXNvbHZlZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycikgPT4gb25NdXRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAoZXJyb3IpID0+IG5ldyBNYXJrVGhyZWFkQXNSZXNvbHZlZEVycm9yKGVycm9yLCB7XG4gICAgICAgICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICAgICAgICB0aHJlYWRJZFxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcbiAgICBbY2xpZW50LCByb29tXVxuICApO1xufVxuZnVuY3Rpb24gdXNlTWFya1RocmVhZEFzVW5yZXNvbHZlZCgpIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIHJldHVybiBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHRocmVhZElkKSA9PiB7XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQyKCk7XG4gICAgICBjb25zdCB1cGRhdGVkQXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IHsgc3RvcmUsIG9uTXV0YXRpb25GYWlsdXJlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gICAgICBzdG9yZS5wdXNoT3B0aW1pc3RpY1VwZGF0ZSh7XG4gICAgICAgIHR5cGU6IFwibWFyay10aHJlYWQtYXMtdW5yZXNvbHZlZFwiLFxuICAgICAgICBpZDogb3B0aW1pc3RpY1VwZGF0ZUlkLFxuICAgICAgICB0aHJlYWRJZCxcbiAgICAgICAgdXBkYXRlZEF0XG4gICAgICB9KTtcbiAgICAgIHJvb20ubWFya1RocmVhZEFzVW5yZXNvbHZlZCh0aHJlYWRJZCkudGhlbihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXMgPSBzdGF0ZS5vcHRpbWlzdGljVXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICh1cGRhdGUpID0+IHVwZGF0ZS5pZCAhPT0gb3B0aW1pc3RpY1VwZGF0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdUaHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogdXBkYXRlZE9wdGltaXN0aWNVcGRhdGVzXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdUaHJlYWQudXBkYXRlZEF0ICYmIGV4aXN0aW5nVGhyZWFkLnVwZGF0ZWRBdCA+IHVwZGF0ZWRBdCkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVzOiB1cGRhdGVkT3B0aW1pc3RpY1VwZGF0ZXNcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICB0aHJlYWRzOiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUudGhyZWFkcyxcbiAgICAgICAgICAgICAgICBbdGhyZWFkSWRdOiB7XG4gICAgICAgICAgICAgICAgICAuLi5leGlzdGluZ1RocmVhZCxcbiAgICAgICAgICAgICAgICAgIHJlc29sdmVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IHVwZGF0ZWRPcHRpbWlzdGljVXBkYXRlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycikgPT4gb25NdXRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAoZXJyb3IpID0+IG5ldyBNYXJrVGhyZWFkQXNVbnJlc29sdmVkRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICAgICAgICAgIHRocmVhZElkXG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9LFxuICAgIFtjbGllbnQsIHJvb21dXG4gICk7XG59XG5mdW5jdGlvbiB1c2VUaHJlYWRTdWJzY3JpcHRpb24odGhyZWFkSWQpIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIGNvbnN0IHsgc3RvcmUgfSA9IGdldEV4dHJhc0ZvckNsaWVudDIoY2xpZW50KTtcbiAgY29uc3Qgc2VsZWN0b3IgPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHN0YXRlKSA9PiB7XG4gICAgICBjb25zdCBpbmJveE5vdGlmaWNhdGlvbiA9IHNlbGVjdGVkSW5ib3hOb3RpZmljYXRpb25zKHN0YXRlKS5maW5kKFxuICAgICAgICAoaW5ib3hOb3RpZmljYXRpb24yKSA9PiBpbmJveE5vdGlmaWNhdGlvbjIua2luZCA9PT0gXCJ0aHJlYWRcIiAmJiBpbmJveE5vdGlmaWNhdGlvbjIudGhyZWFkSWQgPT09IHRocmVhZElkXG4gICAgICApO1xuICAgICAgY29uc3QgdGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07XG4gICAgICBpZiAoaW5ib3hOb3RpZmljYXRpb24gPT09IHZvaWQgMCB8fCB0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXR1czogXCJub3Qtc3Vic2NyaWJlZFwiXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IFwic3Vic2NyaWJlZFwiLFxuICAgICAgICB1bnJlYWRTaW5jZTogaW5ib3hOb3RpZmljYXRpb24ucmVhZEF0XG4gICAgICB9O1xuICAgIH0sXG4gICAgW3RocmVhZElkXVxuICApO1xuICByZXR1cm4gdXNlU3luY0V4dGVybmFsU3RvcmVXaXRoU2VsZWN0b3IyKFxuICAgIHN0b3JlLnN1YnNjcmliZSxcbiAgICBzdG9yZS5nZXQsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHNlbGVjdG9yXG4gICk7XG59XG5mdW5jdGlvbiB1c2VSb29tTm90aWZpY2F0aW9uU2V0dGluZ3MoKSB7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCB7IHN0b3JlIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gIFJlYWN0NC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHsgZ2V0SW5ib3hOb3RpZmljYXRpb25TZXR0aW5ncyB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgIGNvbnN0IHF1ZXJ5S2V5ID0gbWFrZU5vdGlmaWNhdGlvblNldHRpbmdzUXVlcnlLZXkocm9vbS5pZCk7XG4gICAgdm9pZCBnZXRJbmJveE5vdGlmaWNhdGlvblNldHRpbmdzKHJvb20sIHF1ZXJ5S2V5KTtcbiAgfSwgW2NsaWVudCwgcm9vbV0pO1xuICBjb25zdCB1cGRhdGVSb29tTm90aWZpY2F0aW9uU2V0dGluZ3MgPSB1c2VVcGRhdGVSb29tTm90aWZpY2F0aW9uU2V0dGluZ3MoKTtcbiAgY29uc3Qgc2VsZWN0b3IgPSBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHN0YXRlKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHN0YXRlLnF1ZXJpZXNbbWFrZU5vdGlmaWNhdGlvblNldHRpbmdzUXVlcnlLZXkocm9vbS5pZCldO1xuICAgICAgaWYgKHF1ZXJ5ID09PSB2b2lkIDAgfHwgcXVlcnkuaXNMb2FkaW5nKSB7XG4gICAgICAgIHJldHVybiB7IGlzTG9hZGluZzogdHJ1ZSB9O1xuICAgICAgfVxuICAgICAgaWYgKHF1ZXJ5LmVycm9yICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIHsgaXNMb2FkaW5nOiBmYWxzZSwgZXJyb3I6IHF1ZXJ5LmVycm9yIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICBzZXR0aW5nczogc2VsZWN0Tm90aWZpY2F0aW9uU2V0dGluZ3Mocm9vbS5pZCwgc3RhdGUpXG4gICAgICB9O1xuICAgIH0sXG4gICAgW3Jvb21dXG4gICk7XG4gIGNvbnN0IHNldHRpbmdzID0gdXNlU3luY0V4dGVybmFsU3RvcmVXaXRoU2VsZWN0b3IyKFxuICAgIHN0b3JlLnN1YnNjcmliZSxcbiAgICBzdG9yZS5nZXQsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHNlbGVjdG9yXG4gICk7XG4gIHJldHVybiBSZWFjdDQudXNlTWVtbygoKSA9PiB7XG4gICAgcmV0dXJuIFtzZXR0aW5ncywgdXBkYXRlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzXTtcbiAgfSwgW3NldHRpbmdzLCB1cGRhdGVSb29tTm90aWZpY2F0aW9uU2V0dGluZ3NdKTtcbn1cbmZ1bmN0aW9uIHVzZVVwZGF0ZVJvb21Ob3RpZmljYXRpb25TZXR0aW5ncygpIHtcbiAgY29uc3QgY2xpZW50ID0gdXNlQ2xpZW50KCk7XG4gIGNvbnN0IHJvb20gPSB1c2VSb29tKCk7XG4gIHJldHVybiBSZWFjdDQudXNlQ2FsbGJhY2soXG4gICAgKHNldHRpbmdzKSA9PiB7XG4gICAgICBjb25zdCBvcHRpbWlzdGljVXBkYXRlSWQgPSBuYW5vaWQyKCk7XG4gICAgICBjb25zdCB7IHN0b3JlLCBvbk11dGF0aW9uRmFpbHVyZSB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgICAgc3RvcmUucHVzaE9wdGltaXN0aWNVcGRhdGUoe1xuICAgICAgICBpZDogb3B0aW1pc3RpY1VwZGF0ZUlkLFxuICAgICAgICB0eXBlOiBcInVwZGF0ZS1ub3RpZmljYXRpb24tc2V0dGluZ3NcIixcbiAgICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgICBzZXR0aW5nc1xuICAgICAgfSk7XG4gICAgICByb29tLnVwZGF0ZU5vdGlmaWNhdGlvblNldHRpbmdzKHNldHRpbmdzKS50aGVuKFxuICAgICAgICAoc2V0dGluZ3MyKSA9PiB7XG4gICAgICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgW3Jvb20uaWRdOiBzZXR0aW5nczJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogc3RhdGUub3B0aW1pc3RpY1VwZGF0ZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAodXBkYXRlKSA9PiB1cGRhdGUuaWQgIT09IG9wdGltaXN0aWNVcGRhdGVJZFxuICAgICAgICAgICAgKVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycikgPT4gb25NdXRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGVJZCxcbiAgICAgICAgICAoZXJyb3IpID0+IG5ldyBVcGRhdGVOb3RpZmljYXRpb25TZXR0aW5nc0Vycm9yKGVycm9yLCB7XG4gICAgICAgICAgICByb29tSWQ6IHJvb20uaWRcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgW2NsaWVudCwgcm9vbV1cbiAgKTtcbn1cbmZ1bmN0aW9uIGVuc3VyZU5vdFNlcnZlclNpZGUoKSB7XG4gIGlmICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJZb3UgY2Fubm90IHVzZSB0aGUgU3VzcGVuc2UgdmVyc2lvbiBvZiB0aGlzIGhvb2sgb24gdGhlIHNlcnZlciBzaWRlLiBNYWtlIHN1cmUgdG8gb25seSBjYWxsIHRoZW0gb24gdGhlIGNsaWVudCBzaWRlLlxcbkZvciB0aXBzLCBzZWUgaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLXJlYWN0I3N1c3BlbnNlLWF2b2lkLXNzclwiXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gdXNlU3VzcGVuZFVudGlsUHJlc2VuY2VSZWFkeSgpIHtcbiAgZW5zdXJlTm90U2VydmVyU2lkZSgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICB1c2Uocm9vbS53YWl0VW50aWxQcmVzZW5jZVJlYWR5KCkpO1xufVxuZnVuY3Rpb24gdXNlU2VsZlN1c3BlbnNlKHNlbGVjdG9yLCBpc0VxdWFsKSB7XG4gIHVzZVN1c3BlbmRVbnRpbFByZXNlbmNlUmVhZHkoKTtcbiAgcmV0dXJuIHVzZVNlbGYoXG4gICAgc2VsZWN0b3IsXG4gICAgaXNFcXVhbFxuICApO1xufVxuZnVuY3Rpb24gdXNlT3RoZXJzU3VzcGVuc2Uoc2VsZWN0b3IsIGlzRXF1YWwpIHtcbiAgdXNlU3VzcGVuZFVudGlsUHJlc2VuY2VSZWFkeSgpO1xuICByZXR1cm4gdXNlT3RoZXJzKFxuICAgIHNlbGVjdG9yLFxuICAgIGlzRXF1YWxcbiAgKTtcbn1cbmZ1bmN0aW9uIHVzZU90aGVyc0Nvbm5lY3Rpb25JZHNTdXNwZW5zZSgpIHtcbiAgdXNlU3VzcGVuZFVudGlsUHJlc2VuY2VSZWFkeSgpO1xuICByZXR1cm4gdXNlT3RoZXJzQ29ubmVjdGlvbklkcygpO1xufVxuZnVuY3Rpb24gdXNlT3RoZXJzTWFwcGVkU3VzcGVuc2UoaXRlbVNlbGVjdG9yLCBpdGVtSXNFcXVhbCkge1xuICB1c2VTdXNwZW5kVW50aWxQcmVzZW5jZVJlYWR5KCk7XG4gIHJldHVybiB1c2VPdGhlcnNNYXBwZWQoaXRlbVNlbGVjdG9yLCBpdGVtSXNFcXVhbCk7XG59XG5mdW5jdGlvbiB1c2VPdGhlclN1c3BlbnNlKGNvbm5lY3Rpb25JZCwgc2VsZWN0b3IsIGlzRXF1YWwpIHtcbiAgdXNlU3VzcGVuZFVudGlsUHJlc2VuY2VSZWFkeSgpO1xuICByZXR1cm4gdXNlT3RoZXIoY29ubmVjdGlvbklkLCBzZWxlY3RvciwgaXNFcXVhbCk7XG59XG5mdW5jdGlvbiB1c2VTdXNwZW5kVW50aWxTdG9yYWdlUmVhZHkoKSB7XG4gIGVuc3VyZU5vdFNlcnZlclNpZGUoKTtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgdXNlKHJvb20ud2FpdFVudGlsU3RvcmFnZVJlYWR5KCkpO1xufVxuZnVuY3Rpb24gdXNlU3RvcmFnZVN1c3BlbnNlKHNlbGVjdG9yLCBpc0VxdWFsKSB7XG4gIHVzZVN1c3BlbmRVbnRpbFN0b3JhZ2VSZWFkeSgpO1xuICByZXR1cm4gdXNlU3RvcmFnZShcbiAgICBzZWxlY3RvcixcbiAgICBpc0VxdWFsXG4gICk7XG59XG5mdW5jdGlvbiB1c2VTdG9yYWdlU3RhdHVzU3VzcGVuc2Uob3B0aW9ucykge1xuICB1c2VTdXNwZW5kVW50aWxTdG9yYWdlUmVhZHkoKTtcbiAgcmV0dXJuIHVzZVN0b3JhZ2VTdGF0dXMob3B0aW9ucyk7XG59XG5mdW5jdGlvbiB1c2VUaHJlYWRzU3VzcGVuc2Uob3B0aW9ucyA9IHtcbiAgcXVlcnk6IHsgbWV0YWRhdGE6IHt9IH1cbn0pIHtcbiAgY29uc3QgeyBzY3JvbGxPbkxvYWQgPSB0cnVlIH0gPSBvcHRpb25zO1xuICBjb25zdCBjbGllbnQgPSB1c2VDbGllbnQoKTtcbiAgY29uc3Qgcm9vbSA9IHVzZVJvb20oKTtcbiAgY29uc3QgcXVlcnlLZXkgPSBSZWFjdDQudXNlTWVtbyhcbiAgICAoKSA9PiBnZW5lcmF0ZVF1ZXJ5S2V5KHJvb20uaWQsIG9wdGlvbnMucXVlcnkpLFxuICAgIFtyb29tLCBvcHRpb25zXVxuICApO1xuICBjb25zdCB7IHN0b3JlLCBnZXRUaHJlYWRzQW5kSW5ib3hOb3RpZmljYXRpb25zIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gIGNvbnN0IHF1ZXJ5ID0gc3RvcmUuZ2V0KCkucXVlcmllc1txdWVyeUtleV07XG4gIGlmIChxdWVyeSA9PT0gdm9pZCAwIHx8IHF1ZXJ5LmlzTG9hZGluZykge1xuICAgIHRocm93IGdldFRocmVhZHNBbmRJbmJveE5vdGlmaWNhdGlvbnMocm9vbSwgcXVlcnlLZXksIG9wdGlvbnMpO1xuICB9XG4gIGlmIChxdWVyeS5lcnJvcikge1xuICAgIHRocm93IHF1ZXJ5LmVycm9yO1xuICB9XG4gIGNvbnN0IHNlbGVjdG9yID0gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgIChzdGF0ZTIpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZHM6IHNlbGVjdGVkVGhyZWFkcyhyb29tLmlkLCBzdGF0ZTIsIG9wdGlvbnMpLFxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlXG4gICAgICB9O1xuICAgIH0sXG4gICAgW3Jvb20sIHF1ZXJ5S2V5XVxuICAgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICk7XG4gIFJlYWN0NC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHsgaW5jcmVtZW50UXVlcnlTdWJzY3JpYmVycyB9ID0gZ2V0RXh0cmFzRm9yQ2xpZW50MihjbGllbnQpO1xuICAgIHJldHVybiBpbmNyZW1lbnRRdWVyeVN1YnNjcmliZXJzKHF1ZXJ5S2V5KTtcbiAgfSwgW2NsaWVudCwgcXVlcnlLZXldKTtcbiAgY29uc3Qgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZVdpdGhTZWxlY3RvcjIoXG4gICAgc3RvcmUuc3Vic2NyaWJlLFxuICAgIHN0b3JlLmdldCxcbiAgICBzdG9yZS5nZXQsXG4gICAgc2VsZWN0b3JcbiAgKTtcbiAgdXNlU2Nyb2xsVG9Db21tZW50T25Mb2FkRWZmZWN0KHNjcm9sbE9uTG9hZCwgc3RhdGUpO1xuICByZXR1cm4gc3RhdGU7XG59XG5mdW5jdGlvbiB1c2VSb29tTm90aWZpY2F0aW9uU2V0dGluZ3NTdXNwZW5zZSgpIHtcbiAgY29uc3QgdXBkYXRlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzID0gdXNlVXBkYXRlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzKCk7XG4gIGNvbnN0IGNsaWVudCA9IHVzZUNsaWVudCgpO1xuICBjb25zdCByb29tID0gdXNlUm9vbSgpO1xuICBjb25zdCBxdWVyeUtleSA9IG1ha2VOb3RpZmljYXRpb25TZXR0aW5nc1F1ZXJ5S2V5KHJvb20uaWQpO1xuICBjb25zdCB7IHN0b3JlLCBnZXRJbmJveE5vdGlmaWNhdGlvblNldHRpbmdzIH0gPSBnZXRFeHRyYXNGb3JDbGllbnQyKGNsaWVudCk7XG4gIGNvbnN0IHF1ZXJ5ID0gc3RvcmUuZ2V0KCkucXVlcmllc1txdWVyeUtleV07XG4gIGlmIChxdWVyeSA9PT0gdm9pZCAwIHx8IHF1ZXJ5LmlzTG9hZGluZykge1xuICAgIHRocm93IGdldEluYm94Tm90aWZpY2F0aW9uU2V0dGluZ3Mocm9vbSwgcXVlcnlLZXkpO1xuICB9XG4gIGlmIChxdWVyeS5lcnJvcikge1xuICAgIHRocm93IHF1ZXJ5LmVycm9yO1xuICB9XG4gIGNvbnN0IHNlbGVjdG9yID0gUmVhY3Q0LnVzZUNhbGxiYWNrKFxuICAgIChzdGF0ZSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgc2V0dGluZ3M6IHNlbGVjdE5vdGlmaWNhdGlvblNldHRpbmdzKHJvb20uaWQsIHN0YXRlKVxuICAgICAgfTtcbiAgICB9LFxuICAgIFtyb29tXVxuICApO1xuICBjb25zdCBzZXR0aW5ncyA9IHVzZVN5bmNFeHRlcm5hbFN0b3JlV2l0aFNlbGVjdG9yMihcbiAgICBzdG9yZS5zdWJzY3JpYmUsXG4gICAgc3RvcmUuZ2V0LFxuICAgIHN0b3JlLmdldCxcbiAgICBzZWxlY3RvclxuICApO1xuICByZXR1cm4gUmVhY3Q0LnVzZU1lbW8oKCkgPT4ge1xuICAgIHJldHVybiBbc2V0dGluZ3MsIHVwZGF0ZVJvb21Ob3RpZmljYXRpb25TZXR0aW5nc107XG4gIH0sIFtzZXR0aW5ncywgdXBkYXRlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzXSk7XG59XG5mdW5jdGlvbiB1c2VSb29tT3JOdWxsKCkge1xuICByZXR1cm4gUmVhY3Q0LnVzZUNvbnRleHQoUm9vbUNvbnRleHQpO1xufVxuZnVuY3Rpb24gY3JlYXRlUm9vbUNvbnRleHQoY2xpZW50KSB7XG4gIHJldHVybiBnZXRPckNyZWF0ZVJvb21Db250ZXh0QnVuZGxlKGNsaWVudCk7XG59XG5mdW5jdGlvbiBnZW5lcmF0ZVF1ZXJ5S2V5KHJvb21JZCwgb3B0aW9ucykge1xuICByZXR1cm4gYCR7cm9vbUlkfS0ke3N0cmluZ2lmeShvcHRpb25zID8/IHt9KX1gO1xufVxudmFyIF9Sb29tUHJvdmlkZXIgPSBSb29tUHJvdmlkZXI7XG52YXIgX3VzZUJyb2FkY2FzdEV2ZW50ID0gdXNlQnJvYWRjYXN0RXZlbnQ7XG52YXIgX3VzZU90aGVyc0xpc3RlbmVyID0gdXNlT3RoZXJzTGlzdGVuZXI7XG52YXIgX3VzZVJvb20gPSB1c2VSb29tO1xudmFyIF91c2VBZGRSZWFjdGlvbiA9IHVzZUFkZFJlYWN0aW9uO1xudmFyIF91c2VNdXRhdGlvbiA9IHVzZU11dGF0aW9uO1xudmFyIF91c2VDcmVhdGVUaHJlYWQgPSB1c2VDcmVhdGVUaHJlYWQ7XG52YXIgX3VzZURlbGV0ZVRocmVhZCA9IHVzZURlbGV0ZVRocmVhZDtcbnZhciBfdXNlRWRpdFRocmVhZE1ldGFkYXRhID0gdXNlRWRpdFRocmVhZE1ldGFkYXRhO1xudmFyIF91c2VFdmVudExpc3RlbmVyID0gdXNlRXZlbnRMaXN0ZW5lcjtcbnZhciBfdXNlTXlQcmVzZW5jZSA9IHVzZU15UHJlc2VuY2U7XG52YXIgX3VzZU90aGVyc01hcHBlZCA9IHVzZU90aGVyc01hcHBlZDtcbnZhciBfdXNlT3RoZXJzTWFwcGVkU3VzcGVuc2UgPSB1c2VPdGhlcnNNYXBwZWRTdXNwZW5zZTtcbnZhciBfdXNlVGhyZWFkcyA9IHVzZVRocmVhZHM7XG52YXIgX3VzZVRocmVhZHNTdXNwZW5zZSA9IHVzZVRocmVhZHNTdXNwZW5zZTtcbnZhciBfdXNlT3RoZXIgPSB1c2VPdGhlcjtcbmZ1bmN0aW9uIF91c2VPdGhlcnMoLi4uYXJncykge1xuICByZXR1cm4gdXNlT3RoZXJzKC4uLmFyZ3MpO1xufVxudmFyIF91c2VPdGhlclN1c3BlbnNlID0gdXNlT3RoZXJTdXNwZW5zZTtcbmZ1bmN0aW9uIF91c2VPdGhlcnNTdXNwZW5zZSguLi5hcmdzKSB7XG4gIHJldHVybiB1c2VPdGhlcnNTdXNwZW5zZSguLi5hcmdzKTtcbn1cbnZhciBfdXNlU3RvcmFnZSA9IHVzZVN0b3JhZ2U7XG52YXIgX3VzZVN0b3JhZ2VTdXNwZW5zZSA9IHVzZVN0b3JhZ2VTdXNwZW5zZTtcbmZ1bmN0aW9uIF91c2VTZWxmKC4uLmFyZ3MpIHtcbiAgcmV0dXJuIHVzZVNlbGYoLi4uYXJncyk7XG59XG5mdW5jdGlvbiBfdXNlU2VsZlN1c3BlbnNlKC4uLmFyZ3MpIHtcbiAgcmV0dXJuIHVzZVNlbGZTdXNwZW5zZSguLi5hcmdzKTtcbn1cbnZhciBfdXNlU3RvcmFnZVJvb3QgPSB1c2VTdG9yYWdlUm9vdDtcbnZhciBfdXNlVXBkYXRlTXlQcmVzZW5jZSA9IHVzZVVwZGF0ZU15UHJlc2VuY2U7XG5cbmV4cG9ydCB7XG4gIFBLR19OQU1FLFxuICBQS0dfVkVSU0lPTixcbiAgUEtHX0ZPUk1BVCxcbiAgQ2xpZW50U2lkZVN1c3BlbnNlLFxuICBDbGllbnRDb250ZXh0LFxuICB1c2VDbGllbnQsXG4gIExpdmVibG9ja3NQcm92aWRlcixcbiAgY3JlYXRlTGl2ZWJsb2Nrc0NvbnRleHQsXG4gIHVzZUluYm94Tm90aWZpY2F0aW9ucyxcbiAgdXNlSW5ib3hOb3RpZmljYXRpb25zU3VzcGVuc2UsXG4gIHVzZU1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQsXG4gIHVzZU1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZCxcbiAgdXNlRGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zLFxuICB1c2VEZWxldGVJbmJveE5vdGlmaWNhdGlvbixcbiAgdXNlVW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQsXG4gIHVzZVVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50U3VzcGVuc2UsXG4gIHVzZVJvb21JbmZvLFxuICB1c2VSb29tSW5mb1N1c3BlbnNlLFxuICBfdXNlSW5ib3hOb3RpZmljYXRpb25UaHJlYWQsXG4gIF91c2VVc2VyLFxuICBfdXNlVXNlclN1c3BlbnNlLFxuICBDcmVhdGVUaHJlYWRFcnJvcixcbiAgc2VsZWN0ZWRUaHJlYWRzLFxuICBSb29tQ29udGV4dCxcbiAgdXNlU3RhdHVzLFxuICB1c2VTdG9yYWdlU3RhdHVzLFxuICB1c2VCYXRjaCxcbiAgdXNlTG9zdENvbm5lY3Rpb25MaXN0ZW5lcixcbiAgdXNlRXJyb3JMaXN0ZW5lcixcbiAgdXNlSGlzdG9yeSxcbiAgdXNlVW5kbyxcbiAgdXNlUmVkbyxcbiAgdXNlQ2FuVW5kbyxcbiAgdXNlQ2FuUmVkbyxcbiAgdXNlT3RoZXJzQ29ubmVjdGlvbklkcyxcbiAgdXNlQ29tbWVudHNFcnJvckxpc3RlbmVyLFxuICB1c2VDcmVhdGVDb21tZW50LFxuICB1c2VFZGl0Q29tbWVudCxcbiAgdXNlRGVsZXRlQ29tbWVudCxcbiAgdXNlUmVtb3ZlUmVhY3Rpb24sXG4gIHVzZU1hcmtUaHJlYWRBc1JlYWQsXG4gIHVzZU1hcmtUaHJlYWRBc1Jlc29sdmVkLFxuICB1c2VNYXJrVGhyZWFkQXNVbnJlc29sdmVkLFxuICB1c2VUaHJlYWRTdWJzY3JpcHRpb24sXG4gIHVzZVJvb21Ob3RpZmljYXRpb25TZXR0aW5ncyxcbiAgdXNlVXBkYXRlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzLFxuICB1c2VPdGhlcnNDb25uZWN0aW9uSWRzU3VzcGVuc2UsXG4gIHVzZVN0b3JhZ2VTdGF0dXNTdXNwZW5zZSxcbiAgY3JlYXRlUm9vbUNvbnRleHQsXG4gIF9Sb29tUHJvdmlkZXIsXG4gIF91c2VCcm9hZGNhc3RFdmVudCxcbiAgX3VzZU90aGVyc0xpc3RlbmVyLFxuICBfdXNlUm9vbSxcbiAgX3VzZUFkZFJlYWN0aW9uLFxuICBfdXNlTXV0YXRpb24sXG4gIF91c2VDcmVhdGVUaHJlYWQsXG4gIF91c2VEZWxldGVUaHJlYWQsXG4gIF91c2VFZGl0VGhyZWFkTWV0YWRhdGEsXG4gIF91c2VFdmVudExpc3RlbmVyLFxuICBfdXNlTXlQcmVzZW5jZSxcbiAgX3VzZU90aGVyc01hcHBlZCxcbiAgX3VzZU90aGVyc01hcHBlZFN1c3BlbnNlLFxuICBfdXNlVGhyZWFkcyxcbiAgX3VzZVRocmVhZHNTdXNwZW5zZSxcbiAgX3VzZU90aGVyLFxuICBfdXNlT3RoZXJzLFxuICBfdXNlT3RoZXJTdXNwZW5zZSxcbiAgX3VzZU90aGVyc1N1c3BlbnNlLFxuICBfdXNlU3RvcmFnZSxcbiAgX3VzZVN0b3JhZ2VTdXNwZW5zZSxcbiAgX3VzZVNlbGYsXG4gIF91c2VTZWxmU3VzcGVuc2UsXG4gIF91c2VTdG9yYWdlUm9vdCxcbiAgX3VzZVVwZGF0ZU15UHJlc2VuY2Vcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jaHVuay03S0FXWU5WSS5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/react/dist/chunk-7KAWYNVI.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@liveblocks/yjs/dist/index.mjs":
/*!*****************************************************!*\
  !*** ./node_modules/@liveblocks/yjs/dist/index.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LiveblocksYjsProvider: () => (/* binding */ LiveblocksYjsProvider)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @liveblocks/core */ \"(ssr)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var js_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! js-base64 */ \"(ssr)/./node_modules/js-base64/base64.mjs\");\n/* harmony import */ var yjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! yjs */ \"(ssr)/./node_modules/yjs/dist/yjs.mjs\");\n// src/index.ts\n\n\n// ../../node_modules/lib0/map.js\nvar create = () => /* @__PURE__ */ new Map();\nvar setIfUndefined = (map, key, createT) => {\n  let set = map.get(key);\n  if (set === void 0) {\n    map.set(key, set = createT());\n  }\n  return set;\n};\n\n// ../../node_modules/lib0/set.js\nvar create2 = () => /* @__PURE__ */ new Set();\n\n// ../../node_modules/lib0/array.js\nvar from = Array.from;\nvar isArray = Array.isArray;\n\n// ../../node_modules/lib0/observable.js\nvar Observable = class {\n  constructor() {\n    this._observers = create();\n  }\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  on(name, f) {\n    setIfUndefined(this._observers, name, create2).add(f);\n  }\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  once(name, f) {\n    const _f = (...args) => {\n      this.off(name, _f);\n      f(...args);\n    };\n    this.on(name, _f);\n  }\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  off(name, f) {\n    const observers = this._observers.get(name);\n    if (observers !== void 0) {\n      observers.delete(f);\n      if (observers.size === 0) {\n        this._observers.delete(name);\n      }\n    }\n  }\n  /**\n   * Emit a named event. All registered event listeners that listen to the\n   * specified name will receive the event.\n   *\n   * @todo This should catch exceptions\n   *\n   * @param {N} name The event name.\n   * @param {Array<any>} args The arguments that are applied to the event listener.\n   */\n  emit(name, args) {\n    return from((this._observers.get(name) || create()).values()).forEach((f) => f(...args));\n  }\n  destroy() {\n    this._observers = create();\n  }\n};\n\n// src/awareness.ts\nvar Y_PRESENCE_KEY = \"__yjs\";\nvar Y_PRESENCE_ID_KEY = \"__yjs_clientid\";\nvar Awareness = class extends Observable {\n  constructor(doc, room) {\n    super();\n    this.states = /* @__PURE__ */ new Map();\n    // used to map liveblock's ActorId to Yjs ClientID, both unique numbers representing a client\n    this.actorToClientMap = /* @__PURE__ */ new Map();\n    // Meta is used to keep track and timeout users who disconnect. Liveblocks provides this for us, so we don't need to\n    // manage it here. Unfortunately, it's expected to exist by various integrations, so it's an empty map.\n    this.meta = /* @__PURE__ */ new Map();\n    // _checkInterval this would hold a timer to remove users, but Liveblock's presence already handles this\n    // unfortunately it's typed by various integrations\n    this._checkInterval = 0;\n    this.doc = doc;\n    this.room = room;\n    this.room.updatePresence({\n      [Y_PRESENCE_ID_KEY]: this.doc.clientID\n    });\n    this.othersUnsub = this.room.events.others.subscribe((event) => {\n      let updates;\n      this.rebuildActorToClientMap(event.others);\n      if (event.type === \"leave\") {\n        const targetClientId = this.actorToClientMap.get(\n          event.user.connectionId\n        );\n        if (targetClientId !== void 0) {\n          updates = { added: [], updated: [], removed: [targetClientId] };\n        }\n        this.rebuildActorToClientMap(event.others);\n      }\n      if (event.type === \"enter\" || event.type === \"update\") {\n        this.rebuildActorToClientMap(event.others);\n        const targetClientId = this.actorToClientMap.get(\n          event.user.connectionId\n        );\n        if (targetClientId !== void 0) {\n          updates = {\n            added: event.type === \"enter\" ? [targetClientId] : [],\n            updated: event.type === \"update\" ? [targetClientId] : [],\n            removed: []\n          };\n        }\n      }\n      if (updates !== void 0) {\n        this.emit(\"change\", [updates, \"presence\"]);\n        this.emit(\"update\", [updates, \"presence\"]);\n      }\n    });\n  }\n  rebuildActorToClientMap(others) {\n    this.actorToClientMap.clear();\n    others.forEach((user) => {\n      if (user.presence[Y_PRESENCE_ID_KEY] !== void 0) {\n        this.actorToClientMap.set(\n          user.connectionId,\n          user.presence[Y_PRESENCE_ID_KEY]\n        );\n      }\n    });\n  }\n  destroy() {\n    this.emit(\"destroy\", [this]);\n    this.othersUnsub();\n    this.setLocalState(null);\n    super.destroy();\n  }\n  getLocalState() {\n    const presence = this.room.getPresence();\n    if (Object.keys(presence).length === 0 || typeof presence[Y_PRESENCE_KEY] === \"undefined\") {\n      return null;\n    }\n    return presence[Y_PRESENCE_KEY];\n  }\n  setLocalState(state) {\n    const presence = this.room.getSelf()?.presence;\n    if (state === null) {\n      if (presence === void 0) {\n        return;\n      }\n      this.room.updatePresence({ ...presence, [Y_PRESENCE_KEY]: null });\n      this.emit(\"update\", [\n        { added: [], updated: [], removed: [this.doc.clientID] },\n        \"local\"\n      ]);\n      return;\n    }\n    const yPresence = presence?.[Y_PRESENCE_KEY];\n    const added = yPresence === void 0 ? [this.doc.clientID] : [];\n    const updated = yPresence === void 0 ? [] : [this.doc.clientID];\n    this.room.updatePresence({\n      [Y_PRESENCE_KEY]: {\n        ...yPresence || {},\n        ...state || {}\n      }\n    });\n    this.emit(\"update\", [{ added, updated, removed: [] }, \"local\"]);\n  }\n  setLocalStateField(field, value) {\n    const presence = this.room.getSelf()?.presence[Y_PRESENCE_KEY];\n    const update = { [field]: value };\n    this.room.updatePresence({\n      [Y_PRESENCE_KEY]: { ...presence || {}, ...update }\n    });\n  }\n  // Translate liveblocks presence to yjs awareness\n  getStates() {\n    const others = this.room.getOthers();\n    const states = others.reduce((acc, otherUser) => {\n      const otherPresence = otherUser.presence[Y_PRESENCE_KEY];\n      const otherClientId = otherUser.presence[Y_PRESENCE_ID_KEY];\n      if (otherPresence !== void 0 && otherClientId !== void 0) {\n        acc.set(otherClientId, otherPresence || {});\n      }\n      return acc;\n    }, /* @__PURE__ */ new Map());\n    const localPresence = this.room.getSelf()?.presence[Y_PRESENCE_KEY];\n    if (localPresence !== void 0) {\n      states.set(this.doc.clientID, localPresence);\n    }\n    return states;\n  }\n};\n\n// src/doc.ts\n\n\nvar yDocHandler = class extends Observable {\n  constructor({\n    doc,\n    isRoot,\n    updateDoc,\n    fetchDoc\n  }) {\n    super();\n    this.unsubscribers = [];\n    this._synced = false;\n    this.handleServerUpdate = ({\n      update,\n      stateVector,\n      readOnly\n    }) => {\n      yjs__WEBPACK_IMPORTED_MODULE_0__.applyUpdate(this.doc, js_base64__WEBPACK_IMPORTED_MODULE_1__.Base64.toUint8Array(update), \"backend\");\n      if (stateVector) {\n        if (!readOnly) {\n          try {\n            const localUpdate = yjs__WEBPACK_IMPORTED_MODULE_0__.encodeStateAsUpdate(\n              this.doc,\n              js_base64__WEBPACK_IMPORTED_MODULE_1__.Base64.toUint8Array(stateVector)\n            );\n            this.updateRoomDoc(js_base64__WEBPACK_IMPORTED_MODULE_1__.Base64.fromUint8Array(localUpdate));\n          } catch (e) {\n            console.warn(e);\n          }\n        }\n        this.synced = true;\n      }\n    };\n    this.syncDoc = () => {\n      this.synced = false;\n      const encodedVector = js_base64__WEBPACK_IMPORTED_MODULE_1__.Base64.fromUint8Array(yjs__WEBPACK_IMPORTED_MODULE_0__.encodeStateVector(this.doc));\n      this.fetchRoomDoc(encodedVector);\n    };\n    this.updateHandler = (update, origin) => {\n      if (origin !== \"backend\") {\n        const encodedUpdate = js_base64__WEBPACK_IMPORTED_MODULE_1__.Base64.fromUint8Array(update);\n        this.updateRoomDoc(encodedUpdate);\n      }\n    };\n    this.doc = doc;\n    this.doc.on(\"update\", this.updateHandler);\n    this.updateRoomDoc = (update) => {\n      updateDoc(update, isRoot ? void 0 : this.doc.guid);\n    };\n    this.fetchRoomDoc = (vector) => {\n      fetchDoc(vector, isRoot ? void 0 : this.doc.guid);\n    };\n    this.syncDoc();\n  }\n  // The sync'd property is required by some provider implementations\n  get synced() {\n    return this._synced;\n  }\n  set synced(state) {\n    if (this._synced !== state) {\n      this._synced = state;\n      this.emit(\"synced\", [state]);\n      this.emit(\"sync\", [state]);\n    }\n  }\n  destroy() {\n    this.doc.off(\"update\", this.updateHandler);\n    this.unsubscribers.forEach((unsub) => unsub());\n    this._observers = /* @__PURE__ */ new Map();\n    this.doc.destroy();\n  }\n};\n\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/yjs\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/index.ts\n(0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_2__.detectDupes)(PKG_NAME, PKG_VERSION, PKG_FORMAT);\nvar LiveblocksYjsProvider = class extends Observable {\n  constructor(room, doc, options = {}) {\n    super();\n    this.unsubscribers = [];\n    this.subdocHandlers = /* @__PURE__ */ new Map();\n    this.handleSubdocs = ({\n      loaded,\n      removed,\n      added\n    }) => {\n      loaded.forEach(this.createSubdocHandler);\n      if (this.options.autoloadSubdocs) {\n        for (const subdoc of added) {\n          if (!this.subdocHandlers.has(subdoc.guid)) {\n            subdoc.load();\n          }\n        }\n      }\n      for (const subdoc of removed) {\n        if (this.subdocHandlers.has(subdoc.guid)) {\n          this.subdocHandlers.get(subdoc.guid)?.destroy();\n          this.subdocHandlers.delete(subdoc.guid);\n        }\n      }\n    };\n    this.updateDoc = (update, guid) => {\n      const canWrite = this.room.getSelf()?.canWrite ?? true;\n      if (canWrite) {\n        this.room.updateYDoc(update, guid);\n      }\n    };\n    this.fetchDoc = (vector, guid) => {\n      this.room.fetchYDoc(vector, guid);\n    };\n    this.createSubdocHandler = (subdoc) => {\n      if (this.subdocHandlers.has(subdoc.guid)) {\n        this.subdocHandlers.get(subdoc.guid)?.syncDoc();\n        return;\n      }\n      const handler = new yDocHandler({\n        doc: subdoc,\n        isRoot: false,\n        updateDoc: this.updateDoc,\n        fetchDoc: this.fetchDoc\n      });\n      this.subdocHandlers.set(subdoc.guid, handler);\n    };\n    // attempt to load a subdoc of a given guid\n    this.loadSubdoc = (guid) => {\n      for (const subdoc of this.rootDoc.subdocs) {\n        if (subdoc.guid === guid) {\n          subdoc.load();\n          return true;\n        }\n      }\n      return false;\n    };\n    this.syncDoc = () => {\n      this.rootDocHandler.syncDoc();\n      for (const [_, handler] of this.subdocHandlers) {\n        handler.syncDoc();\n      }\n    };\n    this.rootDoc = doc;\n    this.room = room;\n    this.options = options;\n    this.rootDocHandler = new yDocHandler({\n      doc,\n      isRoot: true,\n      updateDoc: this.updateDoc,\n      fetchDoc: this.fetchDoc\n    });\n    this.awareness = new Awareness(this.rootDoc, this.room);\n    this.unsubscribers.push(\n      this.room.events.status.subscribe((status) => {\n        if (status === \"connected\") {\n          this.rootDocHandler.syncDoc();\n        } else {\n          this.rootDocHandler.synced = false;\n        }\n      })\n    );\n    this.unsubscribers.push(\n      this.room.events.ydoc.subscribe((message) => {\n        const { type } = message;\n        if (type === _liveblocks_core__WEBPACK_IMPORTED_MODULE_2__.ClientMsgCode.UPDATE_YDOC) {\n          return;\n        }\n        const { stateVector, update, guid } = message;\n        const canWrite = this.room.getSelf()?.canWrite ?? true;\n        if (guid !== void 0) {\n          this.subdocHandlers.get(guid)?.handleServerUpdate({\n            update,\n            stateVector,\n            readOnly: !canWrite\n          });\n        } else {\n          this.rootDocHandler.handleServerUpdate({\n            update,\n            stateVector,\n            readOnly: !canWrite\n          });\n        }\n      })\n    );\n    this.rootDocHandler.on(\"synced\", () => {\n      const state = this.rootDocHandler.synced;\n      for (const [_, handler] of this.subdocHandlers) {\n        handler.syncDoc();\n      }\n      this.emit(\"synced\", [state]);\n      this.emit(\"sync\", [state]);\n    });\n    this.rootDoc.on(\"subdocs\", this.handleSubdocs);\n    this.syncDoc();\n  }\n  // The sync'd property is required by some provider implementations\n  get synced() {\n    return this.rootDocHandler.synced;\n  }\n  destroy() {\n    this.unsubscribers.forEach((unsub) => unsub());\n    this.awareness.destroy();\n    this.rootDocHandler.destroy();\n    this._observers = /* @__PURE__ */ new Map();\n    for (const [_, handler] of this.subdocHandlers) {\n      handler.destroy();\n    }\n    this.subdocHandlers.clear();\n    super.destroy();\n  }\n  // Some provider implementations expect to be able to call connect/disconnect, implement as noop\n  disconnect() {\n  }\n  connect() {\n  }\n};\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MveWpzL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUM4RDs7QUFFOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsR0FBRztBQUNoQixhQUFhLFVBQVU7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsR0FBRztBQUNoQixhQUFhLFVBQVU7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxHQUFHO0FBQ2hCLGFBQWEsVUFBVTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsR0FBRztBQUNoQixhQUFhLFlBQVk7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxxQ0FBcUM7QUFDdEU7QUFDQSxVQUFVLHNEQUFzRDtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBLEtBQUs7QUFDTCwyQkFBMkIsNkJBQTZCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLDBCQUEwQixpQkFBaUI7QUFDM0MsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNtQztBQUNWO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxNQUFNLDRDQUFhLFdBQVcsNkNBQU07QUFDcEM7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLG9EQUFxQjtBQUNyRDtBQUNBLGNBQWMsNkNBQU07QUFDcEI7QUFDQSwrQkFBK0IsNkNBQU07QUFDckMsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsNkNBQU0sZ0JBQWdCLGtEQUFtQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw2Q0FBTTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZEQUFXO0FBQ1g7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE9BQU87QUFDdkIscUJBQXFCLDJEQUFhO0FBQ2xDO0FBQ0E7QUFDQSxnQkFBZ0IsNEJBQTRCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MveWpzL2Rpc3QvaW5kZXgubWpzPzgxNTkiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2luZGV4LnRzXG5pbXBvcnQgeyBDbGllbnRNc2dDb2RlLCBkZXRlY3REdXBlcyB9IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5cbi8vIC4uLy4uL25vZGVfbW9kdWxlcy9saWIwL21hcC5qc1xudmFyIGNyZWF0ZSA9ICgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG52YXIgc2V0SWZVbmRlZmluZWQgPSAobWFwLCBrZXksIGNyZWF0ZVQpID0+IHtcbiAgbGV0IHNldCA9IG1hcC5nZXQoa2V5KTtcbiAgaWYgKHNldCA9PT0gdm9pZCAwKSB7XG4gICAgbWFwLnNldChrZXksIHNldCA9IGNyZWF0ZVQoKSk7XG4gIH1cbiAgcmV0dXJuIHNldDtcbn07XG5cbi8vIC4uLy4uL25vZGVfbW9kdWxlcy9saWIwL3NldC5qc1xudmFyIGNyZWF0ZTIgPSAoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuXG4vLyAuLi8uLi9ub2RlX21vZHVsZXMvbGliMC9hcnJheS5qc1xudmFyIGZyb20gPSBBcnJheS5mcm9tO1xudmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xuXG4vLyAuLi8uLi9ub2RlX21vZHVsZXMvbGliMC9vYnNlcnZhYmxlLmpzXG52YXIgT2JzZXJ2YWJsZSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fb2JzZXJ2ZXJzID0gY3JlYXRlKCk7XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7Tn0gbmFtZVxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmXG4gICAqL1xuICBvbihuYW1lLCBmKSB7XG4gICAgc2V0SWZVbmRlZmluZWQodGhpcy5fb2JzZXJ2ZXJzLCBuYW1lLCBjcmVhdGUyKS5hZGQoZik7XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7Tn0gbmFtZVxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmXG4gICAqL1xuICBvbmNlKG5hbWUsIGYpIHtcbiAgICBjb25zdCBfZiA9ICguLi5hcmdzKSA9PiB7XG4gICAgICB0aGlzLm9mZihuYW1lLCBfZik7XG4gICAgICBmKC4uLmFyZ3MpO1xuICAgIH07XG4gICAgdGhpcy5vbihuYW1lLCBfZik7XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7Tn0gbmFtZVxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmXG4gICAqL1xuICBvZmYobmFtZSwgZikge1xuICAgIGNvbnN0IG9ic2VydmVycyA9IHRoaXMuX29ic2VydmVycy5nZXQobmFtZSk7XG4gICAgaWYgKG9ic2VydmVycyAhPT0gdm9pZCAwKSB7XG4gICAgICBvYnNlcnZlcnMuZGVsZXRlKGYpO1xuICAgICAgaWYgKG9ic2VydmVycy5zaXplID09PSAwKSB7XG4gICAgICAgIHRoaXMuX29ic2VydmVycy5kZWxldGUobmFtZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBFbWl0IGEgbmFtZWQgZXZlbnQuIEFsbCByZWdpc3RlcmVkIGV2ZW50IGxpc3RlbmVycyB0aGF0IGxpc3RlbiB0byB0aGVcbiAgICogc3BlY2lmaWVkIG5hbWUgd2lsbCByZWNlaXZlIHRoZSBldmVudC5cbiAgICpcbiAgICogQHRvZG8gVGhpcyBzaG91bGQgY2F0Y2ggZXhjZXB0aW9uc1xuICAgKlxuICAgKiBAcGFyYW0ge059IG5hbWUgVGhlIGV2ZW50IG5hbWUuXG4gICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYXJncyBUaGUgYXJndW1lbnRzIHRoYXQgYXJlIGFwcGxpZWQgdG8gdGhlIGV2ZW50IGxpc3RlbmVyLlxuICAgKi9cbiAgZW1pdChuYW1lLCBhcmdzKSB7XG4gICAgcmV0dXJuIGZyb20oKHRoaXMuX29ic2VydmVycy5nZXQobmFtZSkgfHwgY3JlYXRlKCkpLnZhbHVlcygpKS5mb3JFYWNoKChmKSA9PiBmKC4uLmFyZ3MpKTtcbiAgfVxuICBkZXN0cm95KCkge1xuICAgIHRoaXMuX29ic2VydmVycyA9IGNyZWF0ZSgpO1xuICB9XG59O1xuXG4vLyBzcmMvYXdhcmVuZXNzLnRzXG52YXIgWV9QUkVTRU5DRV9LRVkgPSBcIl9feWpzXCI7XG52YXIgWV9QUkVTRU5DRV9JRF9LRVkgPSBcIl9feWpzX2NsaWVudGlkXCI7XG52YXIgQXdhcmVuZXNzID0gY2xhc3MgZXh0ZW5kcyBPYnNlcnZhYmxlIHtcbiAgY29uc3RydWN0b3IoZG9jLCByb29tKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnN0YXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgLy8gdXNlZCB0byBtYXAgbGl2ZWJsb2NrJ3MgQWN0b3JJZCB0byBZanMgQ2xpZW50SUQsIGJvdGggdW5pcXVlIG51bWJlcnMgcmVwcmVzZW50aW5nIGEgY2xpZW50XG4gICAgdGhpcy5hY3RvclRvQ2xpZW50TWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAvLyBNZXRhIGlzIHVzZWQgdG8ga2VlcCB0cmFjayBhbmQgdGltZW91dCB1c2VycyB3aG8gZGlzY29ubmVjdC4gTGl2ZWJsb2NrcyBwcm92aWRlcyB0aGlzIGZvciB1cywgc28gd2UgZG9uJ3QgbmVlZCB0b1xuICAgIC8vIG1hbmFnZSBpdCBoZXJlLiBVbmZvcnR1bmF0ZWx5LCBpdCdzIGV4cGVjdGVkIHRvIGV4aXN0IGJ5IHZhcmlvdXMgaW50ZWdyYXRpb25zLCBzbyBpdCdzIGFuIGVtcHR5IG1hcC5cbiAgICB0aGlzLm1ldGEgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIC8vIF9jaGVja0ludGVydmFsIHRoaXMgd291bGQgaG9sZCBhIHRpbWVyIHRvIHJlbW92ZSB1c2VycywgYnV0IExpdmVibG9jaydzIHByZXNlbmNlIGFscmVhZHkgaGFuZGxlcyB0aGlzXG4gICAgLy8gdW5mb3J0dW5hdGVseSBpdCdzIHR5cGVkIGJ5IHZhcmlvdXMgaW50ZWdyYXRpb25zXG4gICAgdGhpcy5fY2hlY2tJbnRlcnZhbCA9IDA7XG4gICAgdGhpcy5kb2MgPSBkb2M7XG4gICAgdGhpcy5yb29tID0gcm9vbTtcbiAgICB0aGlzLnJvb20udXBkYXRlUHJlc2VuY2Uoe1xuICAgICAgW1lfUFJFU0VOQ0VfSURfS0VZXTogdGhpcy5kb2MuY2xpZW50SURcbiAgICB9KTtcbiAgICB0aGlzLm90aGVyc1Vuc3ViID0gdGhpcy5yb29tLmV2ZW50cy5vdGhlcnMuc3Vic2NyaWJlKChldmVudCkgPT4ge1xuICAgICAgbGV0IHVwZGF0ZXM7XG4gICAgICB0aGlzLnJlYnVpbGRBY3RvclRvQ2xpZW50TWFwKGV2ZW50Lm90aGVycyk7XG4gICAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJsZWF2ZVwiKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldENsaWVudElkID0gdGhpcy5hY3RvclRvQ2xpZW50TWFwLmdldChcbiAgICAgICAgICBldmVudC51c2VyLmNvbm5lY3Rpb25JZFxuICAgICAgICApO1xuICAgICAgICBpZiAodGFyZ2V0Q2xpZW50SWQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHVwZGF0ZXMgPSB7IGFkZGVkOiBbXSwgdXBkYXRlZDogW10sIHJlbW92ZWQ6IFt0YXJnZXRDbGllbnRJZF0gfTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlYnVpbGRBY3RvclRvQ2xpZW50TWFwKGV2ZW50Lm90aGVycyk7XG4gICAgICB9XG4gICAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJlbnRlclwiIHx8IGV2ZW50LnR5cGUgPT09IFwidXBkYXRlXCIpIHtcbiAgICAgICAgdGhpcy5yZWJ1aWxkQWN0b3JUb0NsaWVudE1hcChldmVudC5vdGhlcnMpO1xuICAgICAgICBjb25zdCB0YXJnZXRDbGllbnRJZCA9IHRoaXMuYWN0b3JUb0NsaWVudE1hcC5nZXQoXG4gICAgICAgICAgZXZlbnQudXNlci5jb25uZWN0aW9uSWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHRhcmdldENsaWVudElkICE9PSB2b2lkIDApIHtcbiAgICAgICAgICB1cGRhdGVzID0ge1xuICAgICAgICAgICAgYWRkZWQ6IGV2ZW50LnR5cGUgPT09IFwiZW50ZXJcIiA/IFt0YXJnZXRDbGllbnRJZF0gOiBbXSxcbiAgICAgICAgICAgIHVwZGF0ZWQ6IGV2ZW50LnR5cGUgPT09IFwidXBkYXRlXCIgPyBbdGFyZ2V0Q2xpZW50SWRdIDogW10sXG4gICAgICAgICAgICByZW1vdmVkOiBbXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh1cGRhdGVzICE9PSB2b2lkIDApIHtcbiAgICAgICAgdGhpcy5lbWl0KFwiY2hhbmdlXCIsIFt1cGRhdGVzLCBcInByZXNlbmNlXCJdKTtcbiAgICAgICAgdGhpcy5lbWl0KFwidXBkYXRlXCIsIFt1cGRhdGVzLCBcInByZXNlbmNlXCJdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICByZWJ1aWxkQWN0b3JUb0NsaWVudE1hcChvdGhlcnMpIHtcbiAgICB0aGlzLmFjdG9yVG9DbGllbnRNYXAuY2xlYXIoKTtcbiAgICBvdGhlcnMuZm9yRWFjaCgodXNlcikgPT4ge1xuICAgICAgaWYgKHVzZXIucHJlc2VuY2VbWV9QUkVTRU5DRV9JRF9LRVldICE9PSB2b2lkIDApIHtcbiAgICAgICAgdGhpcy5hY3RvclRvQ2xpZW50TWFwLnNldChcbiAgICAgICAgICB1c2VyLmNvbm5lY3Rpb25JZCxcbiAgICAgICAgICB1c2VyLnByZXNlbmNlW1lfUFJFU0VOQ0VfSURfS0VZXVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5lbWl0KFwiZGVzdHJveVwiLCBbdGhpc10pO1xuICAgIHRoaXMub3RoZXJzVW5zdWIoKTtcbiAgICB0aGlzLnNldExvY2FsU3RhdGUobnVsbCk7XG4gICAgc3VwZXIuZGVzdHJveSgpO1xuICB9XG4gIGdldExvY2FsU3RhdGUoKSB7XG4gICAgY29uc3QgcHJlc2VuY2UgPSB0aGlzLnJvb20uZ2V0UHJlc2VuY2UoKTtcbiAgICBpZiAoT2JqZWN0LmtleXMocHJlc2VuY2UpLmxlbmd0aCA9PT0gMCB8fCB0eXBlb2YgcHJlc2VuY2VbWV9QUkVTRU5DRV9LRVldID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHByZXNlbmNlW1lfUFJFU0VOQ0VfS0VZXTtcbiAgfVxuICBzZXRMb2NhbFN0YXRlKHN0YXRlKSB7XG4gICAgY29uc3QgcHJlc2VuY2UgPSB0aGlzLnJvb20uZ2V0U2VsZigpPy5wcmVzZW5jZTtcbiAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcbiAgICAgIGlmIChwcmVzZW5jZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMucm9vbS51cGRhdGVQcmVzZW5jZSh7IC4uLnByZXNlbmNlLCBbWV9QUkVTRU5DRV9LRVldOiBudWxsIH0pO1xuICAgICAgdGhpcy5lbWl0KFwidXBkYXRlXCIsIFtcbiAgICAgICAgeyBhZGRlZDogW10sIHVwZGF0ZWQ6IFtdLCByZW1vdmVkOiBbdGhpcy5kb2MuY2xpZW50SURdIH0sXG4gICAgICAgIFwibG9jYWxcIlxuICAgICAgXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHlQcmVzZW5jZSA9IHByZXNlbmNlPy5bWV9QUkVTRU5DRV9LRVldO1xuICAgIGNvbnN0IGFkZGVkID0geVByZXNlbmNlID09PSB2b2lkIDAgPyBbdGhpcy5kb2MuY2xpZW50SURdIDogW107XG4gICAgY29uc3QgdXBkYXRlZCA9IHlQcmVzZW5jZSA9PT0gdm9pZCAwID8gW10gOiBbdGhpcy5kb2MuY2xpZW50SURdO1xuICAgIHRoaXMucm9vbS51cGRhdGVQcmVzZW5jZSh7XG4gICAgICBbWV9QUkVTRU5DRV9LRVldOiB7XG4gICAgICAgIC4uLnlQcmVzZW5jZSB8fCB7fSxcbiAgICAgICAgLi4uc3RhdGUgfHwge31cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmVtaXQoXCJ1cGRhdGVcIiwgW3sgYWRkZWQsIHVwZGF0ZWQsIHJlbW92ZWQ6IFtdIH0sIFwibG9jYWxcIl0pO1xuICB9XG4gIHNldExvY2FsU3RhdGVGaWVsZChmaWVsZCwgdmFsdWUpIHtcbiAgICBjb25zdCBwcmVzZW5jZSA9IHRoaXMucm9vbS5nZXRTZWxmKCk/LnByZXNlbmNlW1lfUFJFU0VOQ0VfS0VZXTtcbiAgICBjb25zdCB1cGRhdGUgPSB7IFtmaWVsZF06IHZhbHVlIH07XG4gICAgdGhpcy5yb29tLnVwZGF0ZVByZXNlbmNlKHtcbiAgICAgIFtZX1BSRVNFTkNFX0tFWV06IHsgLi4ucHJlc2VuY2UgfHwge30sIC4uLnVwZGF0ZSB9XG4gICAgfSk7XG4gIH1cbiAgLy8gVHJhbnNsYXRlIGxpdmVibG9ja3MgcHJlc2VuY2UgdG8geWpzIGF3YXJlbmVzc1xuICBnZXRTdGF0ZXMoKSB7XG4gICAgY29uc3Qgb3RoZXJzID0gdGhpcy5yb29tLmdldE90aGVycygpO1xuICAgIGNvbnN0IHN0YXRlcyA9IG90aGVycy5yZWR1Y2UoKGFjYywgb3RoZXJVc2VyKSA9PiB7XG4gICAgICBjb25zdCBvdGhlclByZXNlbmNlID0gb3RoZXJVc2VyLnByZXNlbmNlW1lfUFJFU0VOQ0VfS0VZXTtcbiAgICAgIGNvbnN0IG90aGVyQ2xpZW50SWQgPSBvdGhlclVzZXIucHJlc2VuY2VbWV9QUkVTRU5DRV9JRF9LRVldO1xuICAgICAgaWYgKG90aGVyUHJlc2VuY2UgIT09IHZvaWQgMCAmJiBvdGhlckNsaWVudElkICE9PSB2b2lkIDApIHtcbiAgICAgICAgYWNjLnNldChvdGhlckNsaWVudElkLCBvdGhlclByZXNlbmNlIHx8IHt9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSk7XG4gICAgY29uc3QgbG9jYWxQcmVzZW5jZSA9IHRoaXMucm9vbS5nZXRTZWxmKCk/LnByZXNlbmNlW1lfUFJFU0VOQ0VfS0VZXTtcbiAgICBpZiAobG9jYWxQcmVzZW5jZSAhPT0gdm9pZCAwKSB7XG4gICAgICBzdGF0ZXMuc2V0KHRoaXMuZG9jLmNsaWVudElELCBsb2NhbFByZXNlbmNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlcztcbiAgfVxufTtcblxuLy8gc3JjL2RvYy50c1xuaW1wb3J0IHsgQmFzZTY0IH0gZnJvbSBcImpzLWJhc2U2NFwiO1xuaW1wb3J0ICogYXMgWSBmcm9tIFwieWpzXCI7XG52YXIgeURvY0hhbmRsZXIgPSBjbGFzcyBleHRlbmRzIE9ic2VydmFibGUge1xuICBjb25zdHJ1Y3Rvcih7XG4gICAgZG9jLFxuICAgIGlzUm9vdCxcbiAgICB1cGRhdGVEb2MsXG4gICAgZmV0Y2hEb2NcbiAgfSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy51bnN1YnNjcmliZXJzID0gW107XG4gICAgdGhpcy5fc3luY2VkID0gZmFsc2U7XG4gICAgdGhpcy5oYW5kbGVTZXJ2ZXJVcGRhdGUgPSAoe1xuICAgICAgdXBkYXRlLFxuICAgICAgc3RhdGVWZWN0b3IsXG4gICAgICByZWFkT25seVxuICAgIH0pID0+IHtcbiAgICAgIFkuYXBwbHlVcGRhdGUodGhpcy5kb2MsIEJhc2U2NC50b1VpbnQ4QXJyYXkodXBkYXRlKSwgXCJiYWNrZW5kXCIpO1xuICAgICAgaWYgKHN0YXRlVmVjdG9yKSB7XG4gICAgICAgIGlmICghcmVhZE9ubHkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbG9jYWxVcGRhdGUgPSBZLmVuY29kZVN0YXRlQXNVcGRhdGUoXG4gICAgICAgICAgICAgIHRoaXMuZG9jLFxuICAgICAgICAgICAgICBCYXNlNjQudG9VaW50OEFycmF5KHN0YXRlVmVjdG9yKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUm9vbURvYyhCYXNlNjQuZnJvbVVpbnQ4QXJyYXkobG9jYWxVcGRhdGUpKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3luY2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuc3luY0RvYyA9ICgpID0+IHtcbiAgICAgIHRoaXMuc3luY2VkID0gZmFsc2U7XG4gICAgICBjb25zdCBlbmNvZGVkVmVjdG9yID0gQmFzZTY0LmZyb21VaW50OEFycmF5KFkuZW5jb2RlU3RhdGVWZWN0b3IodGhpcy5kb2MpKTtcbiAgICAgIHRoaXMuZmV0Y2hSb29tRG9jKGVuY29kZWRWZWN0b3IpO1xuICAgIH07XG4gICAgdGhpcy51cGRhdGVIYW5kbGVyID0gKHVwZGF0ZSwgb3JpZ2luKSA9PiB7XG4gICAgICBpZiAob3JpZ2luICE9PSBcImJhY2tlbmRcIikge1xuICAgICAgICBjb25zdCBlbmNvZGVkVXBkYXRlID0gQmFzZTY0LmZyb21VaW50OEFycmF5KHVwZGF0ZSk7XG4gICAgICAgIHRoaXMudXBkYXRlUm9vbURvYyhlbmNvZGVkVXBkYXRlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuZG9jID0gZG9jO1xuICAgIHRoaXMuZG9jLm9uKFwidXBkYXRlXCIsIHRoaXMudXBkYXRlSGFuZGxlcik7XG4gICAgdGhpcy51cGRhdGVSb29tRG9jID0gKHVwZGF0ZSkgPT4ge1xuICAgICAgdXBkYXRlRG9jKHVwZGF0ZSwgaXNSb290ID8gdm9pZCAwIDogdGhpcy5kb2MuZ3VpZCk7XG4gICAgfTtcbiAgICB0aGlzLmZldGNoUm9vbURvYyA9ICh2ZWN0b3IpID0+IHtcbiAgICAgIGZldGNoRG9jKHZlY3RvciwgaXNSb290ID8gdm9pZCAwIDogdGhpcy5kb2MuZ3VpZCk7XG4gICAgfTtcbiAgICB0aGlzLnN5bmNEb2MoKTtcbiAgfVxuICAvLyBUaGUgc3luYydkIHByb3BlcnR5IGlzIHJlcXVpcmVkIGJ5IHNvbWUgcHJvdmlkZXIgaW1wbGVtZW50YXRpb25zXG4gIGdldCBzeW5jZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3N5bmNlZDtcbiAgfVxuICBzZXQgc3luY2VkKHN0YXRlKSB7XG4gICAgaWYgKHRoaXMuX3N5bmNlZCAhPT0gc3RhdGUpIHtcbiAgICAgIHRoaXMuX3N5bmNlZCA9IHN0YXRlO1xuICAgICAgdGhpcy5lbWl0KFwic3luY2VkXCIsIFtzdGF0ZV0pO1xuICAgICAgdGhpcy5lbWl0KFwic3luY1wiLCBbc3RhdGVdKTtcbiAgICB9XG4gIH1cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLmRvYy5vZmYoXCJ1cGRhdGVcIiwgdGhpcy51cGRhdGVIYW5kbGVyKTtcbiAgICB0aGlzLnVuc3Vic2NyaWJlcnMuZm9yRWFjaCgodW5zdWIpID0+IHVuc3ViKCkpO1xuICAgIHRoaXMuX29ic2VydmVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5kb2MuZGVzdHJveSgpO1xuICB9XG59O1xuXG4vLyBzcmMvdmVyc2lvbi50c1xudmFyIFBLR19OQU1FID0gXCJAbGl2ZWJsb2Nrcy95anNcIjtcbnZhciBQS0dfVkVSU0lPTiA9IFwiMi40LjBcIjtcbnZhciBQS0dfRk9STUFUID0gXCJlc21cIjtcblxuLy8gc3JjL2luZGV4LnRzXG5kZXRlY3REdXBlcyhQS0dfTkFNRSwgUEtHX1ZFUlNJT04sIFBLR19GT1JNQVQpO1xudmFyIExpdmVibG9ja3NZanNQcm92aWRlciA9IGNsYXNzIGV4dGVuZHMgT2JzZXJ2YWJsZSB7XG4gIGNvbnN0cnVjdG9yKHJvb20sIGRvYywgb3B0aW9ucyA9IHt9KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnVuc3Vic2NyaWJlcnMgPSBbXTtcbiAgICB0aGlzLnN1YmRvY0hhbmRsZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICB0aGlzLmhhbmRsZVN1YmRvY3MgPSAoe1xuICAgICAgbG9hZGVkLFxuICAgICAgcmVtb3ZlZCxcbiAgICAgIGFkZGVkXG4gICAgfSkgPT4ge1xuICAgICAgbG9hZGVkLmZvckVhY2godGhpcy5jcmVhdGVTdWJkb2NIYW5kbGVyKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b2xvYWRTdWJkb2NzKSB7XG4gICAgICAgIGZvciAoY29uc3Qgc3ViZG9jIG9mIGFkZGVkKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnN1YmRvY0hhbmRsZXJzLmhhcyhzdWJkb2MuZ3VpZCkpIHtcbiAgICAgICAgICAgIHN1YmRvYy5sb2FkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IHN1YmRvYyBvZiByZW1vdmVkKSB7XG4gICAgICAgIGlmICh0aGlzLnN1YmRvY0hhbmRsZXJzLmhhcyhzdWJkb2MuZ3VpZCkpIHtcbiAgICAgICAgICB0aGlzLnN1YmRvY0hhbmRsZXJzLmdldChzdWJkb2MuZ3VpZCk/LmRlc3Ryb3koKTtcbiAgICAgICAgICB0aGlzLnN1YmRvY0hhbmRsZXJzLmRlbGV0ZShzdWJkb2MuZ3VpZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMudXBkYXRlRG9jID0gKHVwZGF0ZSwgZ3VpZCkgPT4ge1xuICAgICAgY29uc3QgY2FuV3JpdGUgPSB0aGlzLnJvb20uZ2V0U2VsZigpPy5jYW5Xcml0ZSA/PyB0cnVlO1xuICAgICAgaWYgKGNhbldyaXRlKSB7XG4gICAgICAgIHRoaXMucm9vbS51cGRhdGVZRG9jKHVwZGF0ZSwgZ3VpZCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmZldGNoRG9jID0gKHZlY3RvciwgZ3VpZCkgPT4ge1xuICAgICAgdGhpcy5yb29tLmZldGNoWURvYyh2ZWN0b3IsIGd1aWQpO1xuICAgIH07XG4gICAgdGhpcy5jcmVhdGVTdWJkb2NIYW5kbGVyID0gKHN1YmRvYykgPT4ge1xuICAgICAgaWYgKHRoaXMuc3ViZG9jSGFuZGxlcnMuaGFzKHN1YmRvYy5ndWlkKSkge1xuICAgICAgICB0aGlzLnN1YmRvY0hhbmRsZXJzLmdldChzdWJkb2MuZ3VpZCk/LnN5bmNEb2MoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgaGFuZGxlciA9IG5ldyB5RG9jSGFuZGxlcih7XG4gICAgICAgIGRvYzogc3ViZG9jLFxuICAgICAgICBpc1Jvb3Q6IGZhbHNlLFxuICAgICAgICB1cGRhdGVEb2M6IHRoaXMudXBkYXRlRG9jLFxuICAgICAgICBmZXRjaERvYzogdGhpcy5mZXRjaERvY1xuICAgICAgfSk7XG4gICAgICB0aGlzLnN1YmRvY0hhbmRsZXJzLnNldChzdWJkb2MuZ3VpZCwgaGFuZGxlcik7XG4gICAgfTtcbiAgICAvLyBhdHRlbXB0IHRvIGxvYWQgYSBzdWJkb2Mgb2YgYSBnaXZlbiBndWlkXG4gICAgdGhpcy5sb2FkU3ViZG9jID0gKGd1aWQpID0+IHtcbiAgICAgIGZvciAoY29uc3Qgc3ViZG9jIG9mIHRoaXMucm9vdERvYy5zdWJkb2NzKSB7XG4gICAgICAgIGlmIChzdWJkb2MuZ3VpZCA9PT0gZ3VpZCkge1xuICAgICAgICAgIHN1YmRvYy5sb2FkKCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHRoaXMuc3luY0RvYyA9ICgpID0+IHtcbiAgICAgIHRoaXMucm9vdERvY0hhbmRsZXIuc3luY0RvYygpO1xuICAgICAgZm9yIChjb25zdCBbXywgaGFuZGxlcl0gb2YgdGhpcy5zdWJkb2NIYW5kbGVycykge1xuICAgICAgICBoYW5kbGVyLnN5bmNEb2MoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMucm9vdERvYyA9IGRvYztcbiAgICB0aGlzLnJvb20gPSByb29tO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgdGhpcy5yb290RG9jSGFuZGxlciA9IG5ldyB5RG9jSGFuZGxlcih7XG4gICAgICBkb2MsXG4gICAgICBpc1Jvb3Q6IHRydWUsXG4gICAgICB1cGRhdGVEb2M6IHRoaXMudXBkYXRlRG9jLFxuICAgICAgZmV0Y2hEb2M6IHRoaXMuZmV0Y2hEb2NcbiAgICB9KTtcbiAgICB0aGlzLmF3YXJlbmVzcyA9IG5ldyBBd2FyZW5lc3ModGhpcy5yb290RG9jLCB0aGlzLnJvb20pO1xuICAgIHRoaXMudW5zdWJzY3JpYmVycy5wdXNoKFxuICAgICAgdGhpcy5yb29tLmV2ZW50cy5zdGF0dXMuc3Vic2NyaWJlKChzdGF0dXMpID0+IHtcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgICAgIHRoaXMucm9vdERvY0hhbmRsZXIuc3luY0RvYygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucm9vdERvY0hhbmRsZXIuc3luY2VkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLnVuc3Vic2NyaWJlcnMucHVzaChcbiAgICAgIHRoaXMucm9vbS5ldmVudHMueWRvYy5zdWJzY3JpYmUoKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgY29uc3QgeyB0eXBlIH0gPSBtZXNzYWdlO1xuICAgICAgICBpZiAodHlwZSA9PT0gQ2xpZW50TXNnQ29kZS5VUERBVEVfWURPQykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHN0YXRlVmVjdG9yLCB1cGRhdGUsIGd1aWQgfSA9IG1lc3NhZ2U7XG4gICAgICAgIGNvbnN0IGNhbldyaXRlID0gdGhpcy5yb29tLmdldFNlbGYoKT8uY2FuV3JpdGUgPz8gdHJ1ZTtcbiAgICAgICAgaWYgKGd1aWQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHRoaXMuc3ViZG9jSGFuZGxlcnMuZ2V0KGd1aWQpPy5oYW5kbGVTZXJ2ZXJVcGRhdGUoe1xuICAgICAgICAgICAgdXBkYXRlLFxuICAgICAgICAgICAgc3RhdGVWZWN0b3IsXG4gICAgICAgICAgICByZWFkT25seTogIWNhbldyaXRlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5yb290RG9jSGFuZGxlci5oYW5kbGVTZXJ2ZXJVcGRhdGUoe1xuICAgICAgICAgICAgdXBkYXRlLFxuICAgICAgICAgICAgc3RhdGVWZWN0b3IsXG4gICAgICAgICAgICByZWFkT25seTogIWNhbldyaXRlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLnJvb3REb2NIYW5kbGVyLm9uKFwic3luY2VkXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5yb290RG9jSGFuZGxlci5zeW5jZWQ7XG4gICAgICBmb3IgKGNvbnN0IFtfLCBoYW5kbGVyXSBvZiB0aGlzLnN1YmRvY0hhbmRsZXJzKSB7XG4gICAgICAgIGhhbmRsZXIuc3luY0RvYygpO1xuICAgICAgfVxuICAgICAgdGhpcy5lbWl0KFwic3luY2VkXCIsIFtzdGF0ZV0pO1xuICAgICAgdGhpcy5lbWl0KFwic3luY1wiLCBbc3RhdGVdKTtcbiAgICB9KTtcbiAgICB0aGlzLnJvb3REb2Mub24oXCJzdWJkb2NzXCIsIHRoaXMuaGFuZGxlU3ViZG9jcyk7XG4gICAgdGhpcy5zeW5jRG9jKCk7XG4gIH1cbiAgLy8gVGhlIHN5bmMnZCBwcm9wZXJ0eSBpcyByZXF1aXJlZCBieSBzb21lIHByb3ZpZGVyIGltcGxlbWVudGF0aW9uc1xuICBnZXQgc3luY2VkKCkge1xuICAgIHJldHVybiB0aGlzLnJvb3REb2NIYW5kbGVyLnN5bmNlZDtcbiAgfVxuICBkZXN0cm95KCkge1xuICAgIHRoaXMudW5zdWJzY3JpYmVycy5mb3JFYWNoKCh1bnN1YikgPT4gdW5zdWIoKSk7XG4gICAgdGhpcy5hd2FyZW5lc3MuZGVzdHJveSgpO1xuICAgIHRoaXMucm9vdERvY0hhbmRsZXIuZGVzdHJveSgpO1xuICAgIHRoaXMuX29ic2VydmVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgZm9yIChjb25zdCBbXywgaGFuZGxlcl0gb2YgdGhpcy5zdWJkb2NIYW5kbGVycykge1xuICAgICAgaGFuZGxlci5kZXN0cm95KCk7XG4gICAgfVxuICAgIHRoaXMuc3ViZG9jSGFuZGxlcnMuY2xlYXIoKTtcbiAgICBzdXBlci5kZXN0cm95KCk7XG4gIH1cbiAgLy8gU29tZSBwcm92aWRlciBpbXBsZW1lbnRhdGlvbnMgZXhwZWN0IHRvIGJlIGFibGUgdG8gY2FsbCBjb25uZWN0L2Rpc2Nvbm5lY3QsIGltcGxlbWVudCBhcyBub29wXG4gIGRpc2Nvbm5lY3QoKSB7XG4gIH1cbiAgY29ubmVjdCgpIHtcbiAgfVxufTtcbmV4cG9ydCB7XG4gIExpdmVibG9ja3NZanNQcm92aWRlclxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4Lm1qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@liveblocks/yjs/dist/index.mjs\n");

/***/ }),

/***/ "(action-browser)/./node_modules/@liveblocks/core/dist/index.mjs":
/*!******************************************************!*\
  !*** ./node_modules/@liveblocks/core/dist/index.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ClientMsgCode: () => (/* binding */ ClientMsgCode),\n/* harmony export */   CommentsApiError: () => (/* binding */ CommentsApiError),\n/* harmony export */   CrdtType: () => (/* binding */ CrdtType),\n/* harmony export */   LiveList: () => (/* binding */ LiveList),\n/* harmony export */   LiveMap: () => (/* binding */ LiveMap),\n/* harmony export */   LiveObject: () => (/* binding */ LiveObject),\n/* harmony export */   NotificationsApiError: () => (/* binding */ NotificationsApiError),\n/* harmony export */   OpCode: () => (/* binding */ OpCode),\n/* harmony export */   ServerMsgCode: () => (/* binding */ ServerMsgCode),\n/* harmony export */   WebsocketCloseCodes: () => (/* binding */ WebsocketCloseCodes),\n/* harmony export */   ackOp: () => (/* binding */ ackOp),\n/* harmony export */   addReaction: () => (/* binding */ addReaction),\n/* harmony export */   applyOptimisticUpdates: () => (/* binding */ applyOptimisticUpdates),\n/* harmony export */   asPos: () => (/* binding */ asPos),\n/* harmony export */   assert: () => (/* binding */ assert),\n/* harmony export */   assertNever: () => (/* binding */ assertNever),\n/* harmony export */   b64decode: () => (/* binding */ b64decode),\n/* harmony export */   cloneLson: () => (/* binding */ cloneLson),\n/* harmony export */   console: () => (/* binding */ fancy_console_exports),\n/* harmony export */   convertToCommentData: () => (/* binding */ convertToCommentData),\n/* harmony export */   convertToCommentUserReaction: () => (/* binding */ convertToCommentUserReaction),\n/* harmony export */   convertToInboxNotificationData: () => (/* binding */ convertToInboxNotificationData),\n/* harmony export */   convertToThreadData: () => (/* binding */ convertToThreadData),\n/* harmony export */   createClient: () => (/* binding */ createClient),\n/* harmony export */   createCommentId: () => (/* binding */ createCommentId),\n/* harmony export */   createInboxNotificationId: () => (/* binding */ createInboxNotificationId),\n/* harmony export */   createThreadId: () => (/* binding */ createThreadId),\n/* harmony export */   deleteComment: () => (/* binding */ deleteComment),\n/* harmony export */   deprecate: () => (/* binding */ deprecate),\n/* harmony export */   deprecateIf: () => (/* binding */ deprecateIf),\n/* harmony export */   detectDupes: () => (/* binding */ detectDupes),\n/* harmony export */   errorIf: () => (/* binding */ errorIf),\n/* harmony export */   freeze: () => (/* binding */ freeze),\n/* harmony export */   getMentionedIdsFromCommentBody: () => (/* binding */ getMentionedIdsFromCommentBody),\n/* harmony export */   isChildCrdt: () => (/* binding */ isChildCrdt),\n/* harmony export */   isJsonArray: () => (/* binding */ isJsonArray),\n/* harmony export */   isJsonObject: () => (/* binding */ isJsonObject),\n/* harmony export */   isJsonScalar: () => (/* binding */ isJsonScalar),\n/* harmony export */   isLiveNode: () => (/* binding */ isLiveNode),\n/* harmony export */   isPlainObject: () => (/* binding */ isPlainObject),\n/* harmony export */   isRootCrdt: () => (/* binding */ isRootCrdt),\n/* harmony export */   kInternal: () => (/* binding */ kInternal),\n/* harmony export */   legacy_patchImmutableObject: () => (/* binding */ legacy_patchImmutableObject),\n/* harmony export */   lsonToJson: () => (/* binding */ lsonToJson),\n/* harmony export */   makeEventSource: () => (/* binding */ makeEventSource),\n/* harmony export */   makePoller: () => (/* binding */ makePoller),\n/* harmony export */   makePosition: () => (/* binding */ makePosition),\n/* harmony export */   memoizeOnSuccess: () => (/* binding */ memoizeOnSuccess),\n/* harmony export */   nanoid: () => (/* binding */ nanoid),\n/* harmony export */   nn: () => (/* binding */ nn),\n/* harmony export */   objectToQuery: () => (/* binding */ objectToQuery),\n/* harmony export */   patchLiveObjectKey: () => (/* binding */ patchLiveObjectKey),\n/* harmony export */   raise: () => (/* binding */ raise),\n/* harmony export */   removeReaction: () => (/* binding */ removeReaction),\n/* harmony export */   shallow: () => (/* binding */ shallow),\n/* harmony export */   stringify: () => (/* binding */ stringify),\n/* harmony export */   stringifyCommentBody: () => (/* binding */ stringifyCommentBody),\n/* harmony export */   throwUsageError: () => (/* binding */ throwUsageError),\n/* harmony export */   toPlainLson: () => (/* binding */ toPlainLson),\n/* harmony export */   tryParseJson: () => (/* binding */ tryParseJson),\n/* harmony export */   upsertComment: () => (/* binding */ upsertComment),\n/* harmony export */   wait: () => (/* binding */ wait),\n/* harmony export */   withTimeout: () => (/* binding */ withTimeout)\n/* harmony export */ });\nvar __defProp = Object.defineProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\n\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/core\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/dupe-detection.ts\nvar g = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : {};\nvar crossLinkedDocs = \"https://liveblocks.io/docs/errors/cross-linked\";\nvar dupesDocs = \"https://liveblocks.io/docs/errors/dupes\";\nvar SPACE = \" \";\nfunction error(msg) {\n  if (false) {} else {\n    throw new Error(msg);\n  }\n}\nfunction detectDupes(pkgName, pkgVersion, pkgFormat) {\n  const pkgId = Symbol.for(pkgName);\n  const pkgBuildInfo = pkgFormat ? `${pkgVersion || \"dev\"} (${pkgFormat})` : pkgVersion || \"dev\";\n  if (!g[pkgId]) {\n    g[pkgId] = pkgBuildInfo;\n  } else if (g[pkgId] === pkgBuildInfo) {\n  } else {\n    const msg = [\n      `Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See ${dupesDocs + SPACE}`,\n      \"\",\n      \"Conflicts:\",\n      `- ${pkgName} ${g[pkgId]} (already loaded)`,\n      `- ${pkgName} ${pkgBuildInfo} (trying to load this now)`\n    ].join(\"\\n\");\n    error(msg);\n  }\n  if (pkgVersion && PKG_VERSION && pkgVersion !== PKG_VERSION) {\n    error(\n      [\n        `Cross-linked versions of Liveblocks found, which will cause issues! See ${crossLinkedDocs + SPACE}`,\n        \"\",\n        \"Conflicts:\",\n        `- ${PKG_NAME} is at ${PKG_VERSION}`,\n        `- ${pkgName} is at ${pkgVersion}`,\n        \"\",\n        \"Always upgrade all Liveblocks packages to the same version number.\"\n      ].join(\"\\n\")\n    );\n  }\n}\n\n// src/lib/assert.ts\nfunction assertNever(_value, errmsg) {\n  throw new Error(errmsg);\n}\nfunction assert(condition, errmsg) {\n  if (true) {\n    if (!condition) {\n      const err = new Error(errmsg);\n      err.name = \"Assertion failure\";\n      throw err;\n    }\n  }\n}\nfunction nn(value, errmsg = \"Expected value to be non-nullable\") {\n  assert(value !== null && value !== void 0, errmsg);\n  return value;\n}\n\n// src/lib/controlledPromise.ts\nfunction controlledPromise() {\n  let resolve;\n  let reject;\n  const promise = new Promise((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  return [promise, resolve, reject];\n}\nfunction Promise_withResolvers() {\n  const [promise, resolve, reject] = controlledPromise();\n  return { promise, resolve, reject };\n}\n\n// src/lib/EventSource.ts\nfunction makeEventSource() {\n  const _onetimeObservers = /* @__PURE__ */ new Set();\n  const _observers = /* @__PURE__ */ new Set();\n  let _buffer = null;\n  function pause() {\n    _buffer = [];\n  }\n  function unpause() {\n    if (_buffer === null) {\n      return;\n    }\n    for (const event of _buffer) {\n      notify(event);\n    }\n    _buffer = null;\n  }\n  function subscribe(callback) {\n    _observers.add(callback);\n    return () => _observers.delete(callback);\n  }\n  function subscribeOnce(callback) {\n    _onetimeObservers.add(callback);\n    return () => _onetimeObservers.delete(callback);\n  }\n  async function waitUntil(predicate) {\n    let unsub;\n    return new Promise((res) => {\n      unsub = subscribe((event) => {\n        if (predicate === void 0 || predicate(event)) {\n          res(event);\n        }\n      });\n    }).finally(() => unsub?.());\n  }\n  function notifyOrBuffer(event) {\n    if (_buffer !== null) {\n      _buffer.push(event);\n    } else {\n      notify(event);\n    }\n  }\n  function notify(event) {\n    _onetimeObservers.forEach((callback) => callback(event));\n    _onetimeObservers.clear();\n    _observers.forEach((callback) => callback(event));\n  }\n  function clear() {\n    _onetimeObservers.clear();\n    _observers.clear();\n  }\n  function count() {\n    return _onetimeObservers.size + _observers.size;\n  }\n  return {\n    // Private/internal control over event emission\n    notify: notifyOrBuffer,\n    subscribe,\n    subscribeOnce,\n    clear,\n    count,\n    waitUntil,\n    pause,\n    unpause,\n    // Publicly exposable subscription API\n    observable: {\n      subscribe,\n      subscribeOnce,\n      waitUntil\n    }\n  };\n}\n\n// src/lib/fancy-console.ts\nvar fancy_console_exports = {};\n__export(fancy_console_exports, {\n  error: () => error2,\n  errorWithTitle: () => errorWithTitle,\n  warn: () => warn,\n  warnWithTitle: () => warnWithTitle\n});\nvar badge = \"background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;\";\nvar bold = \"font-weight:600\";\nfunction wrap(method) {\n  return typeof window === \"undefined\" || \"development\" === \"test\" ? console[method] : (\n    /* istanbul ignore next */\n    (message, ...args) => console[method](\"%cLiveblocks\", badge, message, ...args)\n  );\n}\nvar warn = wrap(\"warn\");\nvar error2 = wrap(\"error\");\nfunction wrapWithTitle(method) {\n  return typeof window === \"undefined\" || \"development\" === \"test\" ? console[method] : (\n    /* istanbul ignore next */\n    (title, message, ...args) => console[method](\n      `%cLiveblocks%c ${title}`,\n      badge,\n      bold,\n      message,\n      ...args\n    )\n  );\n}\nvar warnWithTitle = wrapWithTitle(\"warn\");\nvar errorWithTitle = wrapWithTitle(\"error\");\n\n// src/lib/fsm.ts\nfunction distance(state1, state2) {\n  if (state1 === state2) {\n    return [0, 0];\n  }\n  const chunks1 = state1.split(\".\");\n  const chunks2 = state2.split(\".\");\n  const minLen = Math.min(chunks1.length, chunks2.length);\n  let shared = 0;\n  for (; shared < minLen; shared++) {\n    if (chunks1[shared] !== chunks2[shared]) {\n      break;\n    }\n  }\n  const up = chunks1.length - shared;\n  const down = chunks2.length - shared;\n  return [up, down];\n}\nfunction patterns(targetState, levels) {\n  const parts = targetState.split(\".\");\n  if (levels < 1 || levels > parts.length + 1) {\n    throw new Error(\"Invalid number of levels\");\n  }\n  const result = [];\n  if (levels > parts.length) {\n    result.push(\"*\");\n  }\n  for (let i = parts.length - levels + 1; i < parts.length; i++) {\n    const slice = parts.slice(0, i);\n    if (slice.length > 0) {\n      result.push(slice.join(\".\") + \".*\");\n    }\n  }\n  result.push(targetState);\n  return result;\n}\nvar SafeContext = class {\n  constructor(initialContext) {\n    this.curr = initialContext;\n  }\n  get current() {\n    return this.curr;\n  }\n  /**\n   * Call a callback function that allows patching of the context, by\n   * calling `context.patch()`. Patching is only allowed for the duration\n   * of this window.\n   */\n  allowPatching(callback) {\n    const self = this;\n    let allowed = true;\n    const patchableContext = {\n      ...this.curr,\n      patch(patch) {\n        if (allowed) {\n          self.curr = Object.assign({}, self.curr, patch);\n          for (const pair of Object.entries(patch)) {\n            const [key, value] = pair;\n            if (key !== \"patch\") {\n              this[key] = value;\n            }\n          }\n        } else {\n          throw new Error(\"Can no longer patch stale context\");\n        }\n      }\n    };\n    callback(patchableContext);\n    allowed = false;\n    return;\n  }\n};\nvar nextId = 1;\nvar FSM = class {\n  /**\n   * Returns the initial state, which is defined by the first call made to\n   * .addState().\n   */\n  get initialState() {\n    const result = this.states.values()[Symbol.iterator]().next();\n    if (result.done) {\n      throw new Error(\"No states defined yet\");\n    } else {\n      return result.value;\n    }\n  }\n  get currentState() {\n    if (this.currentStateOrNull === null) {\n      if (this.runningState === 0 /* NOT_STARTED_YET */) {\n        throw new Error(\"Not started yet\");\n      } else {\n        throw new Error(\"Already stopped\");\n      }\n    }\n    return this.currentStateOrNull;\n  }\n  /**\n   * Starts the machine by entering the initial state.\n   */\n  start() {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"State machine has already started\");\n    }\n    this.runningState = 1 /* STARTED */;\n    this.currentStateOrNull = this.initialState;\n    this.enter(null);\n    return this;\n  }\n  /**\n   * Stops the state machine. Stopping the state machine will call exit\n   * handlers for the current state, but not enter a new state.\n   */\n  stop() {\n    if (this.runningState !== 1 /* STARTED */) {\n      throw new Error(\"Cannot stop a state machine that hasn't started yet\");\n    }\n    this.exit(null);\n    this.runningState = 2 /* STOPPED */;\n    this.currentStateOrNull = null;\n  }\n  constructor(initialContext) {\n    this.id = nextId++;\n    this.runningState = 0 /* NOT_STARTED_YET */;\n    this.currentStateOrNull = null;\n    this.states = /* @__PURE__ */ new Set();\n    this.enterFns = /* @__PURE__ */ new Map();\n    this.cleanupStack = [];\n    this.knownEventTypes = /* @__PURE__ */ new Set();\n    this.allowedTransitions = /* @__PURE__ */ new Map();\n    this.currentContext = new SafeContext(initialContext);\n    this.eventHub = {\n      didReceiveEvent: makeEventSource(),\n      willTransition: makeEventSource(),\n      didIgnoreEvent: makeEventSource(),\n      willExitState: makeEventSource(),\n      didEnterState: makeEventSource()\n    };\n    this.events = {\n      didReceiveEvent: this.eventHub.didReceiveEvent.observable,\n      willTransition: this.eventHub.willTransition.observable,\n      didIgnoreEvent: this.eventHub.didIgnoreEvent.observable,\n      willExitState: this.eventHub.willExitState.observable,\n      didEnterState: this.eventHub.didEnterState.observable\n    };\n  }\n  get context() {\n    return this.currentContext.current;\n  }\n  /**\n   * Define an explicit finite state in the state machine.\n   */\n  addState(state) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    }\n    this.states.add(state);\n    return this;\n  }\n  onEnter(nameOrPattern, enterFn) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    } else if (this.enterFns.has(nameOrPattern)) {\n      throw new Error(\n        // TODO We _currently_ don't support multiple .onEnters() for the same\n        // state, but this is not a fundamental limitation. Just not\n        // implemented yet. If we wanted to, we could make this an array.\n        `enter/exit function for ${nameOrPattern} already exists`\n      );\n    }\n    this.enterFns.set(nameOrPattern, enterFn);\n    return this;\n  }\n  onEnterAsync(nameOrPattern, promiseFn, onOK, onError) {\n    return this.onEnter(nameOrPattern, () => {\n      const abortController = new AbortController();\n      const signal = abortController.signal;\n      let done = false;\n      void promiseFn(this.currentContext.current, signal).then(\n        // On OK\n        (data) => {\n          if (!signal.aborted) {\n            done = true;\n            this.transition({ type: \"ASYNC_OK\", data }, onOK);\n          }\n        },\n        // On Error\n        (reason) => {\n          if (!signal.aborted) {\n            done = true;\n            this.transition({ type: \"ASYNC_ERROR\", reason }, onError);\n          }\n        }\n      );\n      return () => {\n        if (!done) {\n          abortController.abort();\n        }\n      };\n    });\n  }\n  getStatesMatching(nameOrPattern) {\n    const matches = [];\n    if (nameOrPattern === \"*\") {\n      for (const state of this.states) {\n        matches.push(state);\n      }\n    } else if (nameOrPattern.endsWith(\".*\")) {\n      const prefix = nameOrPattern.slice(0, -1);\n      for (const state of this.states) {\n        if (state.startsWith(prefix)) {\n          matches.push(state);\n        }\n      }\n    } else {\n      const name = nameOrPattern;\n      if (this.states.has(name)) {\n        matches.push(name);\n      }\n    }\n    if (matches.length === 0) {\n      throw new Error(`No states match ${JSON.stringify(nameOrPattern)}`);\n    }\n    return matches;\n  }\n  /**\n   * Define all allowed outgoing transitions for a state.\n   *\n   * The targets for each event can be defined as a function which returns the\n   * next state to transition to. These functions can look at the `event` or\n   * `context` params to conditionally decide which next state to transition\n   * to.\n   *\n   * If you set it to `null`, then the transition will be explicitly forbidden\n   * and throw an error. If you don't define a target for a transition, then\n   * such events will get ignored.\n   */\n  addTransitions(nameOrPattern, mapping) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    }\n    for (const srcState of this.getStatesMatching(nameOrPattern)) {\n      let map = this.allowedTransitions.get(srcState);\n      if (map === void 0) {\n        map = /* @__PURE__ */ new Map();\n        this.allowedTransitions.set(srcState, map);\n      }\n      for (const [type, target_] of Object.entries(mapping)) {\n        if (map.has(type)) {\n          throw new Error(\n            `Trying to set transition \"${type}\" on \"${srcState}\" (via \"${nameOrPattern}\"), but a transition already exists there.`\n          );\n        }\n        const target = target_;\n        this.knownEventTypes.add(type);\n        if (target !== void 0) {\n          const targetFn = typeof target === \"function\" ? target : () => target;\n          map.set(type, targetFn);\n        }\n      }\n    }\n    return this;\n  }\n  /**\n   * Like `.addTransition()`, but takes an (anonymous) transition whenever the\n   * timer fires.\n   *\n   * @param stateOrPattern The state name, or state group pattern name.\n   * @param after          Number of milliseconds after which to take the\n   *                       transition. If in the mean time, another transition\n   *                       is taken, the timer will get cancelled.\n   * @param target     The target state to go to.\n   */\n  addTimedTransition(stateOrPattern, after2, target) {\n    return this.onEnter(stateOrPattern, () => {\n      const ms = typeof after2 === \"function\" ? after2(this.currentContext.current) : after2;\n      const timeoutID = setTimeout(() => {\n        this.transition({ type: \"TIMER\" }, target);\n      }, ms);\n      return () => {\n        clearTimeout(timeoutID);\n      };\n    });\n  }\n  getTargetFn(eventName) {\n    return this.allowedTransitions.get(this.currentState)?.get(eventName);\n  }\n  /**\n   * Exits the current state, and executes any necessary cleanup functions.\n   * Call this before changing the current state to the next state.\n   *\n   * @param levels Defines how many \"levels\" of nesting will be\n   * exited. For example, if you transition from `foo.bar.qux` to\n   * `foo.bar.baz`, then the level is 1. But if you transition from\n   * `foo.bar.qux` to `bla.bla`, then the level is 3.\n   * If `null`, it will exit all levels.\n   */\n  exit(levels) {\n    this.eventHub.willExitState.notify(this.currentState);\n    this.currentContext.allowPatching((patchableContext) => {\n      levels = levels ?? this.cleanupStack.length;\n      for (let i = 0; i < levels; i++) {\n        this.cleanupStack.pop()?.(patchableContext);\n      }\n    });\n  }\n  /**\n   * Enters the current state, and executes any necessary onEnter handlers.\n   * Call this directly _after_ setting the current state to the next state.\n   */\n  enter(levels) {\n    const enterPatterns = patterns(\n      this.currentState,\n      levels ?? this.currentState.split(\".\").length + 1\n    );\n    this.currentContext.allowPatching((patchableContext) => {\n      for (const pattern of enterPatterns) {\n        const enterFn = this.enterFns.get(pattern);\n        const cleanupFn = enterFn?.(patchableContext);\n        if (typeof cleanupFn === \"function\") {\n          this.cleanupStack.push(cleanupFn);\n        } else {\n          this.cleanupStack.push(null);\n        }\n      }\n    });\n    this.eventHub.didEnterState.notify(this.currentState);\n  }\n  /**\n   * Sends an event to the machine, which may cause an internal state\n   * transition to happen. When that happens, will trigger side effects.\n   */\n  send(event) {\n    if (!this.knownEventTypes.has(event.type)) {\n      throw new Error(`Invalid event ${JSON.stringify(event.type)}`);\n    }\n    if (this.runningState === 2 /* STOPPED */) {\n      return;\n    }\n    const targetFn = this.getTargetFn(event.type);\n    if (targetFn !== void 0) {\n      return this.transition(event, targetFn);\n    } else {\n      this.eventHub.didIgnoreEvent.notify(event);\n    }\n  }\n  transition(event, target) {\n    this.eventHub.didReceiveEvent.notify(event);\n    const oldState = this.currentState;\n    const targetFn = typeof target === \"function\" ? target : () => target;\n    const nextTarget = targetFn(event, this.currentContext.current);\n    let nextState;\n    let effects = void 0;\n    if (nextTarget === null) {\n      this.eventHub.didIgnoreEvent.notify(event);\n      return;\n    }\n    if (typeof nextTarget === \"string\") {\n      nextState = nextTarget;\n    } else {\n      nextState = nextTarget.target;\n      effects = Array.isArray(nextTarget.effect) ? nextTarget.effect : [nextTarget.effect];\n    }\n    if (!this.states.has(nextState)) {\n      throw new Error(`Invalid next state name: ${JSON.stringify(nextState)}`);\n    }\n    this.eventHub.willTransition.notify({ from: oldState, to: nextState });\n    const [up, down] = distance(this.currentState, nextState);\n    if (up > 0) {\n      this.exit(up);\n    }\n    this.currentStateOrNull = nextState;\n    if (effects !== void 0) {\n      const effectsToRun = effects;\n      this.currentContext.allowPatching((patchableContext) => {\n        for (const effect of effectsToRun) {\n          if (typeof effect === \"function\") {\n            effect(patchableContext, event);\n          } else {\n            patchableContext.patch(effect);\n          }\n        }\n      });\n    }\n    if (down > 0) {\n      this.enter(down);\n    }\n  }\n};\n\n// src/lib/utils.ts\nfunction raise(msg) {\n  throw new Error(msg);\n}\nfunction isPlainObject(blob) {\n  return blob !== null && typeof blob === \"object\" && Object.prototype.toString.call(blob) === \"[object Object]\";\n}\nfunction entries(obj) {\n  return Object.entries(obj);\n}\nfunction tryParseJson(rawMessage) {\n  try {\n    return JSON.parse(rawMessage);\n  } catch (e) {\n    return void 0;\n  }\n}\nfunction deepClone(value) {\n  return JSON.parse(JSON.stringify(value));\n}\nfunction b64decode(b64value) {\n  try {\n    const formattedValue = b64value.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const decodedValue = decodeURIComponent(\n      atob(formattedValue).split(\"\").map(function(c) {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(\"\")\n    );\n    return decodedValue;\n  } catch (err) {\n    return atob(b64value);\n  }\n}\nfunction compact(items) {\n  return items.filter(\n    (item) => item !== null && item !== void 0\n  );\n}\nfunction compactObject(obj) {\n  const newObj = { ...obj };\n  Object.keys(obj).forEach((k) => {\n    const key = k;\n    if (newObj[key] === void 0) {\n      delete newObj[key];\n    }\n  });\n  return newObj;\n}\nfunction wait(millis) {\n  return new Promise((res) => setTimeout(res, millis));\n}\nasync function withTimeout(promise, millis, errmsg) {\n  let timerID;\n  const timer$ = new Promise((_, reject) => {\n    timerID = setTimeout(() => {\n      reject(new Error(errmsg));\n    }, millis);\n  });\n  return Promise.race([promise, timer$]).finally(() => clearTimeout(timerID));\n}\nfunction memoizeOnSuccess(factoryFn) {\n  let cached = null;\n  return () => {\n    if (cached === null) {\n      cached = factoryFn().catch((err) => {\n        setTimeout(() => {\n          cached = null;\n        }, 5e3);\n        throw err;\n      });\n    }\n    return cached;\n  };\n}\n\n// src/protocol/ServerMsg.ts\nvar ServerMsgCode = /* @__PURE__ */ ((ServerMsgCode2) => {\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_PRESENCE\"] = 100] = \"UPDATE_PRESENCE\";\n  ServerMsgCode2[ServerMsgCode2[\"USER_JOINED\"] = 101] = \"USER_JOINED\";\n  ServerMsgCode2[ServerMsgCode2[\"USER_LEFT\"] = 102] = \"USER_LEFT\";\n  ServerMsgCode2[ServerMsgCode2[\"BROADCASTED_EVENT\"] = 103] = \"BROADCASTED_EVENT\";\n  ServerMsgCode2[ServerMsgCode2[\"ROOM_STATE\"] = 104] = \"ROOM_STATE\";\n  ServerMsgCode2[ServerMsgCode2[\"INITIAL_STORAGE_STATE\"] = 200] = \"INITIAL_STORAGE_STATE\";\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_STORAGE\"] = 201] = \"UPDATE_STORAGE\";\n  ServerMsgCode2[ServerMsgCode2[\"REJECT_STORAGE_OP\"] = 299] = \"REJECT_STORAGE_OP\";\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_YDOC\"] = 300] = \"UPDATE_YDOC\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_CREATED\"] = 400] = \"THREAD_CREATED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_DELETED\"] = 407] = \"THREAD_DELETED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_METADATA_UPDATED\"] = 401] = \"THREAD_METADATA_UPDATED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_UPDATED\"] = 408] = \"THREAD_UPDATED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_CREATED\"] = 402] = \"COMMENT_CREATED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_EDITED\"] = 403] = \"COMMENT_EDITED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_DELETED\"] = 404] = \"COMMENT_DELETED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_REACTION_ADDED\"] = 405] = \"COMMENT_REACTION_ADDED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_REACTION_REMOVED\"] = 406] = \"COMMENT_REACTION_REMOVED\";\n  return ServerMsgCode2;\n})(ServerMsgCode || {});\n\n// src/types/IWebSocket.ts\nvar WebsocketCloseCodes = /* @__PURE__ */ ((WebsocketCloseCodes2) => {\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_NORMAL\"] = 1e3] = \"CLOSE_NORMAL\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_ABNORMAL\"] = 1006] = \"CLOSE_ABNORMAL\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"UNEXPECTED_CONDITION\"] = 1011] = \"UNEXPECTED_CONDITION\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"TRY_AGAIN_LATER\"] = 1013] = \"TRY_AGAIN_LATER\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"INVALID_MESSAGE_FORMAT\"] = 4e3] = \"INVALID_MESSAGE_FORMAT\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"NOT_ALLOWED\"] = 4001] = \"NOT_ALLOWED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_MESSAGES_PER_SECONDS\"] = 4002] = \"MAX_NUMBER_OF_MESSAGES_PER_SECONDS\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS\"] = 4003] = \"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP\"] = 4004] = \"MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM\"] = 4005] = \"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"ROOM_ID_UPDATED\"] = 4006] = \"ROOM_ID_UPDATED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"KICKED\"] = 4100] = \"KICKED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"TOKEN_EXPIRED\"] = 4109] = \"TOKEN_EXPIRED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_WITHOUT_RETRY\"] = 4999] = \"CLOSE_WITHOUT_RETRY\";\n  return WebsocketCloseCodes2;\n})(WebsocketCloseCodes || {});\nfunction shouldDisconnect(code) {\n  return code === 4999 /* CLOSE_WITHOUT_RETRY */ || code >= 4e3 && code < 4100;\n}\nfunction shouldReauth(code) {\n  return code >= 4100 && code < 4200;\n}\nfunction shouldRetryWithoutReauth(code) {\n  return code === 1013 /* TRY_AGAIN_LATER */ || code >= 4200 && code < 4300;\n}\n\n// src/connection.ts\nfunction isIdle(status) {\n  return status === \"initial\" || status === \"disconnected\";\n}\nfunction toNewConnectionStatus(machine) {\n  const state = machine.currentState;\n  switch (state) {\n    case \"@ok.connected\":\n    case \"@ok.awaiting-pong\":\n      return \"connected\";\n    case \"@idle.initial\":\n      return \"initial\";\n    case \"@auth.busy\":\n    case \"@auth.backoff\":\n    case \"@connecting.busy\":\n    case \"@connecting.backoff\":\n    case \"@idle.zombie\":\n      return machine.context.successCount > 0 ? \"reconnecting\" : \"connecting\";\n    case \"@idle.failed\":\n      return \"disconnected\";\n    default:\n      return assertNever(state, \"Unknown state\");\n  }\n}\nvar BACKOFF_DELAYS = [250, 500, 1e3, 2e3, 4e3, 8e3, 1e4];\nvar RESET_DELAY = BACKOFF_DELAYS[0] - 1;\nvar BACKOFF_DELAYS_SLOW = [2e3, 3e4, 6e4, 3e5];\nvar HEARTBEAT_INTERVAL = 3e4;\nvar PONG_TIMEOUT = 2e3;\nvar AUTH_TIMEOUT = 1e4;\nvar SOCKET_CONNECT_TIMEOUT = 1e4;\nvar StopRetrying = class extends Error {\n  constructor(reason) {\n    super(reason);\n  }\n};\nvar LiveblocksError = class extends Error {\n  /** @internal */\n  constructor(message, code) {\n    super(message);\n    this.code = code;\n  }\n};\nfunction nextBackoffDelay(currentDelay, delays) {\n  return delays.find((delay) => delay > currentDelay) ?? delays[delays.length - 1];\n}\nfunction increaseBackoffDelay(context) {\n  context.patch({\n    backoffDelay: nextBackoffDelay(context.backoffDelay, BACKOFF_DELAYS)\n  });\n}\nfunction increaseBackoffDelayAggressively(context) {\n  context.patch({\n    backoffDelay: nextBackoffDelay(context.backoffDelay, BACKOFF_DELAYS_SLOW)\n  });\n}\nfunction resetSuccessCount(context) {\n  context.patch({ successCount: 0 });\n}\nfunction log(level, message) {\n  const logger = level === 2 /* ERROR */ ? error2 : level === 1 /* WARN */ ? warn : (\n    /* black hole */\n    () => {\n    }\n  );\n  return () => {\n    logger(message);\n  };\n}\nfunction logPrematureErrorOrCloseEvent(e) {\n  const conn = \"Connection to Liveblocks websocket server\";\n  return (ctx) => {\n    if (e instanceof Error) {\n      warn(`${conn} could not be established. ${String(e)}`);\n    } else {\n      warn(\n        isCloseEvent(e) ? `${conn} closed prematurely (code: ${e.code}). Retrying in ${ctx.backoffDelay}ms.` : `${conn} could not be established.`\n      );\n    }\n  };\n}\nfunction logCloseEvent(event) {\n  const details = [`code: ${event.code}`];\n  if (event.reason) {\n    details.push(`reason: ${event.reason}`);\n  }\n  return (ctx) => {\n    warn(\n      `Connection to Liveblocks websocket server closed (${details.join(\", \")}). Retrying in ${ctx.backoffDelay}ms.`\n    );\n  };\n}\nvar logPermanentClose = log(\n  1 /* WARN */,\n  \"Connection to WebSocket closed permanently. Won't retry.\"\n);\nfunction isCloseEvent(error3) {\n  return !(error3 instanceof Error) && error3.type === \"close\";\n}\nfunction enableTracing(machine) {\n  const start = (/* @__PURE__ */ new Date()).getTime();\n  function log2(...args) {\n    warn(\n      `${(((/* @__PURE__ */ new Date()).getTime() - start) / 1e3).toFixed(2)} [FSM #${machine.id}]`,\n      ...args\n    );\n  }\n  const unsubs = [\n    machine.events.didReceiveEvent.subscribe((e) => log2(`Event ${e.type}`)),\n    machine.events.willTransition.subscribe(\n      ({ from, to }) => log2(\"Transitioning\", from, \"\\u2192\", to)\n    ),\n    machine.events.didIgnoreEvent.subscribe(\n      (e) => log2(\"Ignored event\", e.type, e, \"(current state won't handle it)\")\n    )\n    // machine.events.willExitState.subscribe((s) => log(\"Exiting state\", s)),\n    // machine.events.didEnterState.subscribe((s) => log(\"Entering state\", s)),\n  ];\n  return () => {\n    for (const unsub of unsubs) {\n      unsub();\n    }\n  };\n}\nfunction defineConnectivityEvents(machine) {\n  const statusDidChange = makeEventSource();\n  const didConnect = makeEventSource();\n  const didDisconnect = makeEventSource();\n  let lastStatus = null;\n  const unsubscribe = machine.events.didEnterState.subscribe(() => {\n    const currStatus = toNewConnectionStatus(machine);\n    if (currStatus !== lastStatus) {\n      statusDidChange.notify(currStatus);\n    }\n    if (lastStatus === \"connected\" && currStatus !== \"connected\") {\n      didDisconnect.notify();\n    } else if (lastStatus !== \"connected\" && currStatus === \"connected\") {\n      didConnect.notify();\n    }\n    lastStatus = currStatus;\n  });\n  return {\n    statusDidChange: statusDidChange.observable,\n    didConnect: didConnect.observable,\n    didDisconnect: didDisconnect.observable,\n    unsubscribe\n  };\n}\nvar assign = (patch) => (ctx) => ctx.patch(patch);\nfunction createConnectionStateMachine(delegates, options) {\n  const onMessage = makeEventSource();\n  onMessage.pause();\n  const onLiveblocksError = makeEventSource();\n  function fireErrorEvent(errmsg, errcode) {\n    return () => {\n      const err = new LiveblocksError(errmsg, errcode);\n      onLiveblocksError.notify(err);\n    };\n  }\n  const initialContext = {\n    successCount: 0,\n    authValue: null,\n    socket: null,\n    backoffDelay: RESET_DELAY\n  };\n  const machine = new FSM(initialContext).addState(\"@idle.initial\").addState(\"@idle.failed\").addState(\"@idle.zombie\").addState(\"@auth.busy\").addState(\"@auth.backoff\").addState(\"@connecting.busy\").addState(\"@connecting.backoff\").addState(\"@ok.connected\").addState(\"@ok.awaiting-pong\");\n  machine.addTransitions(\"*\", {\n    RECONNECT: {\n      target: \"@auth.backoff\",\n      effect: [increaseBackoffDelay, resetSuccessCount]\n    },\n    DISCONNECT: \"@idle.initial\"\n  });\n  machine.onEnter(\"@idle.*\", resetSuccessCount).addTransitions(\"@idle.*\", {\n    CONNECT: (_, ctx) => (\n      // If we still have a known authValue, try to reconnect to the socket directly,\n      // otherwise, try to obtain a new authValue\n      ctx.authValue !== null ? \"@connecting.busy\" : \"@auth.busy\"\n    )\n  });\n  machine.addTransitions(\"@auth.backoff\", {\n    NAVIGATOR_ONLINE: {\n      target: \"@auth.busy\",\n      effect: assign({ backoffDelay: RESET_DELAY })\n    }\n  }).addTimedTransition(\n    \"@auth.backoff\",\n    (ctx) => ctx.backoffDelay,\n    \"@auth.busy\"\n  ).onEnterAsync(\n    \"@auth.busy\",\n    () => withTimeout(\n      delegates.authenticate(),\n      AUTH_TIMEOUT,\n      \"Timed out during auth\"\n    ),\n    // On successful authentication\n    (okEvent) => ({\n      target: \"@connecting.busy\",\n      effect: assign({\n        authValue: okEvent.data\n      })\n    }),\n    // Auth failed\n    (failedEvent) => {\n      if (failedEvent.reason instanceof StopRetrying) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            log(2 /* ERROR */, failedEvent.reason.message),\n            fireErrorEvent(failedEvent.reason.message, -1)\n          ]\n        };\n      }\n      return {\n        target: \"@auth.backoff\",\n        effect: [\n          increaseBackoffDelay,\n          log(\n            2 /* ERROR */,\n            `Authentication failed: ${failedEvent.reason instanceof Error ? failedEvent.reason.message : String(failedEvent.reason)}`\n          )\n        ]\n      };\n    }\n  );\n  const onSocketError = (event) => machine.send({ type: \"EXPLICIT_SOCKET_ERROR\", event });\n  const onSocketClose = (event) => machine.send({ type: \"EXPLICIT_SOCKET_CLOSE\", event });\n  const onSocketMessage = (event) => event.data === \"pong\" ? machine.send({ type: \"PONG\" }) : onMessage.notify(event);\n  function teardownSocket(socket) {\n    if (socket) {\n      socket.removeEventListener(\"error\", onSocketError);\n      socket.removeEventListener(\"close\", onSocketClose);\n      socket.removeEventListener(\"message\", onSocketMessage);\n      socket.close();\n    }\n  }\n  machine.addTransitions(\"@connecting.backoff\", {\n    NAVIGATOR_ONLINE: {\n      target: \"@connecting.busy\",\n      effect: assign({ backoffDelay: RESET_DELAY })\n    }\n  }).addTimedTransition(\n    \"@connecting.backoff\",\n    (ctx) => ctx.backoffDelay,\n    \"@connecting.busy\"\n  ).onEnterAsync(\n    \"@connecting.busy\",\n    //\n    // Use the \"createSocket\" delegate function (provided to the\n    // ManagedSocket) to create the actual WebSocket connection instance.\n    // Then, set up all the necessary event listeners, and wait for the\n    // \"open\" event to occur.\n    //\n    // When the \"open\" event happens, we're ready to transition to the\n    // OK state. This is done by resolving the Promise.\n    //\n    async (ctx, signal) => {\n      let capturedPrematureEvent = null;\n      let unconfirmedSocket = null;\n      const connect$ = new Promise(\n        (resolve, rej) => {\n          if (ctx.authValue === null) {\n            throw new Error(\"No auth authValue\");\n          }\n          const socket = delegates.createSocket(ctx.authValue);\n          unconfirmedSocket = socket;\n          function reject(event) {\n            capturedPrematureEvent = event;\n            socket.removeEventListener(\"message\", onSocketMessage);\n            rej(event);\n          }\n          const [actor$, didReceiveActor] = controlledPromise();\n          if (!options.waitForActorId) {\n            didReceiveActor();\n          }\n          function waitForActorId(event) {\n            const serverMsg = tryParseJson(event.data);\n            if (serverMsg?.type === 104 /* ROOM_STATE */) {\n              didReceiveActor();\n            }\n          }\n          socket.addEventListener(\"message\", onSocketMessage);\n          if (options.waitForActorId) {\n            socket.addEventListener(\"message\", waitForActorId);\n          }\n          socket.addEventListener(\"error\", reject);\n          socket.addEventListener(\"close\", reject);\n          socket.addEventListener(\"open\", () => {\n            socket.addEventListener(\"error\", onSocketError);\n            socket.addEventListener(\"close\", onSocketClose);\n            const unsub = () => {\n              socket.removeEventListener(\"error\", reject);\n              socket.removeEventListener(\"close\", reject);\n              socket.removeEventListener(\"message\", waitForActorId);\n            };\n            void actor$.then(() => {\n              resolve([socket, unsub]);\n            });\n          });\n        }\n      );\n      return withTimeout(\n        connect$,\n        SOCKET_CONNECT_TIMEOUT,\n        \"Timed out during websocket connection\"\n      ).then(\n        //\n        // Part 3:\n        // By now, our \"open\" event has fired, and the promise has been\n        // resolved. Two possible scenarios:\n        //\n        // 1. The happy path. Most likely.\n        // 2. Uh-oh. A premature close/error event has been observed. Let's\n        //    reject the promise after all.\n        //\n        // Any close/error event that will get scheduled after this point\n        // onwards, will be caught in the OK state, and dealt with\n        // accordingly.\n        //\n        ([socket, unsub]) => {\n          unsub();\n          if (signal.aborted) {\n            throw new Error(\"Aborted\");\n          }\n          if (capturedPrematureEvent) {\n            throw capturedPrematureEvent;\n          }\n          return socket;\n        }\n      ).catch((e) => {\n        teardownSocket(unconfirmedSocket);\n        throw e;\n      });\n    },\n    // Only transition to OK state after a successfully opened WebSocket connection\n    (okEvent) => ({\n      target: \"@ok.connected\",\n      effect: assign({\n        socket: okEvent.data,\n        backoffDelay: RESET_DELAY\n      })\n    }),\n    // If the WebSocket connection cannot be established\n    (failure) => {\n      const err = failure.reason;\n      if (err instanceof StopRetrying) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            log(2 /* ERROR */, err.message),\n            fireErrorEvent(err.message, -1)\n          ]\n        };\n      }\n      if (isCloseEvent(err)) {\n        if (err.code === 4109 /* TOKEN_EXPIRED */) {\n          return \"@auth.busy\";\n        }\n        if (shouldRetryWithoutReauth(err.code)) {\n          return {\n            target: \"@connecting.backoff\",\n            effect: [\n              increaseBackoffDelayAggressively,\n              logPrematureErrorOrCloseEvent(err)\n            ]\n          };\n        }\n        if (shouldDisconnect(err.code)) {\n          return {\n            target: \"@idle.failed\",\n            effect: [\n              log(2 /* ERROR */, err.reason),\n              fireErrorEvent(err.reason, err.code)\n            ]\n          };\n        }\n      }\n      return {\n        target: \"@auth.backoff\",\n        effect: [increaseBackoffDelay, logPrematureErrorOrCloseEvent(err)]\n      };\n    }\n  );\n  const sendHeartbeat = {\n    target: \"@ok.awaiting-pong\",\n    effect: (ctx) => {\n      ctx.socket?.send(\"ping\");\n    }\n  };\n  const maybeHeartbeat = () => {\n    const doc = typeof document !== \"undefined\" ? document : void 0;\n    const canZombie = doc?.visibilityState === \"hidden\" && delegates.canZombie();\n    return canZombie ? \"@idle.zombie\" : sendHeartbeat;\n  };\n  machine.addTimedTransition(\"@ok.connected\", HEARTBEAT_INTERVAL, maybeHeartbeat).addTransitions(\"@ok.connected\", {\n    NAVIGATOR_OFFLINE: maybeHeartbeat,\n    // Don't take the browser's word for it when it says it's offline. Do a ping/pong to make sure.\n    WINDOW_GOT_FOCUS: sendHeartbeat\n  });\n  machine.addTransitions(\"@idle.zombie\", {\n    WINDOW_GOT_FOCUS: \"@connecting.backoff\"\n    // When in zombie state, the client will try to wake up automatically when the window regains focus\n  });\n  machine.onEnter(\"@ok.*\", (ctx) => {\n    ctx.patch({ successCount: ctx.successCount + 1 });\n    const timerID = setTimeout(\n      // On the next tick, start delivering all messages that have already\n      // been received, and continue synchronous delivery of all future\n      // incoming messages.\n      onMessage.unpause,\n      0\n    );\n    return (ctx2) => {\n      teardownSocket(ctx2.socket);\n      ctx2.patch({ socket: null });\n      clearTimeout(timerID);\n      onMessage.pause();\n    };\n  }).addTransitions(\"@ok.awaiting-pong\", { PONG: \"@ok.connected\" }).addTimedTransition(\"@ok.awaiting-pong\", PONG_TIMEOUT, {\n    target: \"@connecting.busy\",\n    // Log implicit connection loss and drop the current open socket\n    effect: log(\n      1 /* WARN */,\n      \"Received no pong from server, assume implicit connection loss.\"\n    )\n  }).addTransitions(\"@ok.*\", {\n    // When a socket receives an error, this can cause the closing of the\n    // socket, or not. So always check to see if the socket is still OPEN or\n    // not. When still OPEN, don't transition.\n    EXPLICIT_SOCKET_ERROR: (_, context) => {\n      if (context.socket?.readyState === 1) {\n        return null;\n      }\n      return {\n        target: \"@connecting.backoff\",\n        effect: increaseBackoffDelay\n      };\n    },\n    EXPLICIT_SOCKET_CLOSE: (e) => {\n      if (shouldDisconnect(e.event.code)) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            logPermanentClose,\n            fireErrorEvent(e.event.reason, e.event.code)\n          ]\n        };\n      }\n      if (shouldReauth(e.event.code)) {\n        if (e.event.code === 4109 /* TOKEN_EXPIRED */) {\n          return \"@auth.busy\";\n        } else {\n          return {\n            target: \"@auth.backoff\",\n            effect: [increaseBackoffDelay, logCloseEvent(e.event)]\n          };\n        }\n      }\n      if (shouldRetryWithoutReauth(e.event.code)) {\n        return {\n          target: \"@connecting.backoff\",\n          effect: [increaseBackoffDelayAggressively, logCloseEvent(e.event)]\n        };\n      }\n      return {\n        target: \"@connecting.backoff\",\n        effect: [increaseBackoffDelay, logCloseEvent(e.event)]\n      };\n    }\n  });\n  if (typeof document !== \"undefined\") {\n    const doc = typeof document !== \"undefined\" ? document : void 0;\n    const win = typeof window !== \"undefined\" ? window : void 0;\n    const root = win ?? doc;\n    machine.onEnter(\"*\", (ctx) => {\n      function onNetworkOffline() {\n        machine.send({ type: \"NAVIGATOR_OFFLINE\" });\n      }\n      function onNetworkBackOnline() {\n        machine.send({ type: \"NAVIGATOR_ONLINE\" });\n      }\n      function onVisibilityChange() {\n        if (doc?.visibilityState === \"visible\") {\n          machine.send({ type: \"WINDOW_GOT_FOCUS\" });\n        }\n      }\n      win?.addEventListener(\"online\", onNetworkBackOnline);\n      win?.addEventListener(\"offline\", onNetworkOffline);\n      root?.addEventListener(\"visibilitychange\", onVisibilityChange);\n      return () => {\n        root?.removeEventListener(\"visibilitychange\", onVisibilityChange);\n        win?.removeEventListener(\"online\", onNetworkBackOnline);\n        win?.removeEventListener(\"offline\", onNetworkOffline);\n        teardownSocket(ctx.socket);\n      };\n    });\n  }\n  const cleanups = [];\n  const { statusDidChange, didConnect, didDisconnect, unsubscribe } = defineConnectivityEvents(machine);\n  cleanups.push(unsubscribe);\n  if (options.enableDebugLogging) {\n    cleanups.push(enableTracing(machine));\n  }\n  machine.start();\n  return {\n    machine,\n    cleanups,\n    // Observable events that will be emitted by this machine\n    events: {\n      statusDidChange,\n      didConnect,\n      didDisconnect,\n      onMessage: onMessage.observable,\n      onLiveblocksError: onLiveblocksError.observable\n    }\n  };\n}\nvar ManagedSocket = class {\n  constructor(delegates, enableDebugLogging = false, waitForActorId = true) {\n    const { machine, events, cleanups } = createConnectionStateMachine(\n      delegates,\n      { waitForActorId, enableDebugLogging }\n    );\n    this.machine = machine;\n    this.events = events;\n    this.cleanups = cleanups;\n  }\n  getStatus() {\n    try {\n      return toNewConnectionStatus(this.machine);\n    } catch {\n      return \"initial\";\n    }\n  }\n  /**\n   * Returns the current auth authValue.\n   */\n  get authValue() {\n    return this.machine.context.authValue;\n  }\n  /**\n   * Call this method to try to connect to a WebSocket. This only has an effect\n   * if the machine is idle at the moment, otherwise this is a no-op.\n   */\n  connect() {\n    this.machine.send({ type: \"CONNECT\" });\n  }\n  /**\n   * If idle, will try to connect. Otherwise, it will attempt to reconnect to\n   * the socket, potentially obtaining a new authValue first, if needed.\n   */\n  reconnect() {\n    this.machine.send({ type: \"RECONNECT\" });\n  }\n  /**\n   * Call this method to disconnect from the current WebSocket. Is going to be\n   * a no-op if there is no active connection.\n   */\n  disconnect() {\n    this.machine.send({ type: \"DISCONNECT\" });\n  }\n  /**\n   * Call this to stop the machine and run necessary cleanup functions. After\n   * calling destroy(), you can no longer use this instance. Call this before\n   * letting the instance get garbage collected.\n   */\n  destroy() {\n    this.machine.stop();\n    let cleanup;\n    while (cleanup = this.cleanups.pop()) {\n      cleanup();\n    }\n  }\n  /**\n   * Safely send a message to the current WebSocket connection. Will emit a log\n   * message if this is somehow impossible.\n   */\n  send(data) {\n    const socket = this.machine.context?.socket;\n    if (socket === null) {\n      warn(\"Cannot send: not connected yet\", data);\n    } else if (socket.readyState !== 1) {\n      warn(\"Cannot send: WebSocket no longer open\", data);\n    } else {\n      socket.send(data);\n    }\n  }\n  /**\n   * NOTE: Used by the E2E app only, to simulate explicit events.\n   * Not ideal to keep exposed :(\n   */\n  _privateSendMachineEvent(event) {\n    this.machine.send(event);\n  }\n};\n\n// src/protocol/AuthToken.ts\nfunction canWriteStorage(scopes) {\n  return scopes.includes(\"room:write\" /* Write */);\n}\nfunction canComment(scopes) {\n  return scopes.includes(\"comments:write\" /* CommentsWrite */) || scopes.includes(\"room:write\" /* Write */);\n}\nfunction isValidAuthTokenPayload(data) {\n  return isPlainObject(data) && (data.k === \"acc\" /* ACCESS_TOKEN */ || data.k === \"id\" /* ID_TOKEN */ || data.k === \"sec-legacy\" /* SECRET_LEGACY */);\n}\nfunction parseAuthToken(rawTokenString) {\n  const tokenParts = rawTokenString.split(\".\");\n  if (tokenParts.length !== 3) {\n    throw new Error(\"Authentication error: invalid JWT token\");\n  }\n  const payload = tryParseJson(b64decode(tokenParts[1]));\n  if (!(payload && isValidAuthTokenPayload(payload))) {\n    throw new Error(\n      \"Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback\"\n    );\n  }\n  return {\n    raw: rawTokenString,\n    parsed: payload\n  };\n}\n\n// src/auth-manager.ts\nfunction createAuthManager(authOptions) {\n  const authentication = prepareAuthentication(authOptions);\n  const seenTokens = /* @__PURE__ */ new Set();\n  const tokens = [];\n  const expiryTimes = [];\n  const requestPromises = /* @__PURE__ */ new Map();\n  function reset() {\n    seenTokens.clear();\n    tokens.length = 0;\n    expiryTimes.length = 0;\n    requestPromises.clear();\n  }\n  function hasCorrespondingScopes(requestedScope, scopes) {\n    if (requestedScope === \"comments:read\") {\n      return scopes.includes(\"comments:read\" /* CommentsRead */) || scopes.includes(\"comments:write\" /* CommentsWrite */) || scopes.includes(\"room:read\" /* Read */) || scopes.includes(\"room:write\" /* Write */);\n    } else if (requestedScope === \"room:read\") {\n      return scopes.includes(\"room:read\" /* Read */) || scopes.includes(\"room:write\" /* Write */);\n    }\n    return false;\n  }\n  function getCachedToken(requestOptions) {\n    const now = Math.ceil(Date.now() / 1e3);\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const token = tokens[i];\n      const expiresAt = expiryTimes[i];\n      if (expiresAt <= now) {\n        tokens.splice(i, 1);\n        expiryTimes.splice(i, 1);\n        continue;\n      }\n      if (token.parsed.k === \"id\" /* ID_TOKEN */) {\n        return token;\n      } else if (token.parsed.k === \"acc\" /* ACCESS_TOKEN */) {\n        if (!requestOptions.roomId && Object.entries(token.parsed.perms).length === 0) {\n          return token;\n        }\n        for (const [resource, scopes] of Object.entries(token.parsed.perms)) {\n          if (!requestOptions.roomId) {\n            if (resource.includes(\"*\") && hasCorrespondingScopes(requestOptions.requestedScope, scopes)) {\n              return token;\n            }\n          } else if (resource.includes(\"*\") && requestOptions.roomId.startsWith(resource.replace(\"*\", \"\")) || requestOptions.roomId === resource && hasCorrespondingScopes(requestOptions.requestedScope, scopes)) {\n            return token;\n          }\n        }\n      }\n    }\n    return void 0;\n  }\n  async function makeAuthRequest(options) {\n    const fetcher = authOptions.polyfills?.fetch ?? (typeof window === \"undefined\" ? void 0 : window.fetch);\n    if (authentication.type === \"private\") {\n      if (fetcher === void 0) {\n        throw new StopRetrying(\n          \"To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.\"\n        );\n      }\n      const response = await fetchAuthEndpoint(fetcher, authentication.url, {\n        room: options.roomId\n      });\n      const parsed = parseAuthToken(response.token);\n      if (seenTokens.has(parsed.raw)) {\n        throw new StopRetrying(\n          \"The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.\"\n        );\n      }\n      return parsed;\n    }\n    if (authentication.type === \"custom\") {\n      const response = await authentication.callback(options.roomId);\n      if (response && typeof response === \"object\") {\n        if (typeof response.token === \"string\") {\n          const parsed = parseAuthToken(response.token);\n          return parsed;\n        } else if (typeof response.error === \"string\") {\n          const reason = `Authentication failed: ${\"reason\" in response && typeof response.reason === \"string\" ? response.reason : \"Forbidden\"}`;\n          if (response.error === \"forbidden\") {\n            throw new StopRetrying(reason);\n          } else {\n            throw new Error(reason);\n          }\n        }\n      }\n      throw new Error(\n        'Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: \"...\" }'\n      );\n    }\n    throw new Error(\n      \"Unexpected authentication type. Must be private or custom.\"\n    );\n  }\n  async function getAuthValue(requestOptions) {\n    if (authentication.type === \"public\") {\n      return { type: \"public\", publicApiKey: authentication.publicApiKey };\n    }\n    const cachedToken = getCachedToken(requestOptions);\n    if (cachedToken !== void 0) {\n      return { type: \"secret\", token: cachedToken };\n    }\n    let currentPromise;\n    if (requestOptions.roomId) {\n      currentPromise = requestPromises.get(requestOptions.roomId);\n      if (currentPromise === void 0) {\n        currentPromise = makeAuthRequest(requestOptions);\n        requestPromises.set(requestOptions.roomId, currentPromise);\n      }\n    } else {\n      currentPromise = requestPromises.get(\"liveblocks-user-token\");\n      if (currentPromise === void 0) {\n        currentPromise = makeAuthRequest(requestOptions);\n        requestPromises.set(\"liveblocks-user-token\", currentPromise);\n      }\n    }\n    try {\n      const token = await currentPromise;\n      const BUFFER = 30;\n      const expiresAt = Math.floor(Date.now() / 1e3) + (token.parsed.exp - token.parsed.iat) - BUFFER;\n      seenTokens.add(token.raw);\n      if (token.parsed.k !== \"sec-legacy\" /* SECRET_LEGACY */) {\n        tokens.push(token);\n        expiryTimes.push(expiresAt);\n      }\n      return { type: \"secret\", token };\n    } finally {\n      if (requestOptions.roomId) {\n        requestPromises.delete(requestOptions.roomId);\n      } else {\n        requestPromises.delete(\"liveblocks-user-token\");\n      }\n    }\n  }\n  return {\n    reset,\n    getAuthValue\n  };\n}\nfunction prepareAuthentication(authOptions) {\n  const { publicApiKey, authEndpoint } = authOptions;\n  if (authEndpoint !== void 0 && publicApiKey !== void 0) {\n    throw new Error(\n      \"You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient\"\n    );\n  }\n  if (typeof publicApiKey === \"string\") {\n    if (publicApiKey.startsWith(\"sk_\")) {\n      throw new Error(\n        \"Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey\"\n      );\n    } else if (!publicApiKey.startsWith(\"pk_\")) {\n      throw new Error(\n        \"Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey\"\n      );\n    }\n    return {\n      type: \"public\",\n      publicApiKey\n    };\n  }\n  if (typeof authEndpoint === \"string\") {\n    return {\n      type: \"private\",\n      url: authEndpoint\n    };\n  } else if (typeof authEndpoint === \"function\") {\n    return {\n      type: \"custom\",\n      callback: authEndpoint\n    };\n  } else if (authEndpoint !== void 0) {\n    throw new Error(\n      \"The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint\"\n    );\n  }\n  throw new Error(\n    \"Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient\"\n  );\n}\nasync function fetchAuthEndpoint(fetch2, endpoint, body) {\n  const res = await fetch2(endpoint, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(body)\n  });\n  if (!res.ok) {\n    const reason = `${(await res.text()).trim() || \"reason not provided in auth response\"} (${res.status} returned by POST ${endpoint})`;\n    if (res.status === 401 || res.status === 403) {\n      throw new StopRetrying(`Unauthorized: ${reason}`);\n    } else {\n      throw new Error(`Failed to authenticate: ${reason}`);\n    }\n  }\n  let data;\n  try {\n    data = await res.json();\n  } catch (er) {\n    throw new Error(\n      `Expected a JSON response when doing a POST request on \"${endpoint}\". ${String(\n        er\n      )}`\n    );\n  }\n  if (!isPlainObject(data) || typeof data.token !== \"string\") {\n    throw new Error(\n      `Expected a JSON response of the form \\`{ token: \"...\" }\\` when doing a POST request on \"${endpoint}\", but got ${JSON.stringify(\n        data\n      )}`\n    );\n  }\n  const { token } = data;\n  return { token };\n}\n\n// src/constants.ts\nvar DEFAULT_BASE_URL = \"https://api.liveblocks.io\";\n\n// src/internal.ts\nvar kInternal = Symbol();\n\n// src/devtools/bridge.ts\nvar _bridgeActive = false;\nfunction activateBridge(allowed) {\n  _bridgeActive = allowed;\n}\nfunction sendToPanel(message, options) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  const fullMsg = {\n    ...message,\n    source: \"liveblocks-devtools-client\"\n  };\n  if (!(options?.force || _bridgeActive)) {\n    return;\n  }\n  window.postMessage(fullMsg, \"*\");\n}\nvar eventSource = makeEventSource();\nif ( true && typeof window !== \"undefined\") {\n  window.addEventListener(\"message\", (event) => {\n    if (event.source === window && event.data?.source === \"liveblocks-devtools-panel\") {\n      eventSource.notify(event.data);\n    } else {\n    }\n  });\n}\nvar onMessageFromPanel = eventSource.observable;\n\n// src/devtools/index.ts\nvar VERSION = PKG_VERSION || \"dev\";\nvar _devtoolsSetupHasRun = false;\nfunction setupDevTools(getAllRooms) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  if (_devtoolsSetupHasRun) {\n    return;\n  }\n  _devtoolsSetupHasRun = true;\n  onMessageFromPanel.subscribe((msg) => {\n    switch (msg.msg) {\n      case \"connect\": {\n        activateBridge(true);\n        for (const roomId of getAllRooms()) {\n          sendToPanel({\n            msg: \"room::available\",\n            roomId,\n            clientVersion: VERSION\n          });\n        }\n        break;\n      }\n    }\n  });\n  sendToPanel({ msg: \"wake-up-devtools\" }, { force: true });\n}\nvar unsubsByRoomId = /* @__PURE__ */ new Map();\nfunction stopSyncStream(roomId) {\n  const unsubs = unsubsByRoomId.get(roomId) ?? [];\n  unsubsByRoomId.delete(roomId);\n  for (const unsub of unsubs) {\n    unsub();\n  }\n}\nfunction startSyncStream(room) {\n  stopSyncStream(room.id);\n  fullSync(room);\n  unsubsByRoomId.set(room.id, [\n    // When the connection status changes\n    room.events.status.subscribe(() => partialSyncConnection(room)),\n    // When storage initializes, send the update\n    room.events.storageDidLoad.subscribeOnce(() => partialSyncStorage(room)),\n    // Any time storage updates, send the new storage root\n    room.events.storageBatch.subscribe(() => partialSyncStorage(room)),\n    // Any time \"me\" or \"others\" updates, send the new values accordingly\n    room.events.self.subscribe(() => partialSyncMe(room)),\n    room.events.others.subscribe(() => partialSyncOthers(room)),\n    // Any time ydoc is updated, forward the update\n    room.events.ydoc.subscribe((update) => syncYdocUpdate(room, update)),\n    // Any time a custom room event is received, forward it\n    room.events.customEvent.subscribe(\n      (eventData) => forwardEvent(room, eventData)\n    )\n  ]);\n}\nfunction syncYdocUpdate(room, update) {\n  sendToPanel({\n    msg: \"room::sync::ydoc\",\n    roomId: room.id,\n    update\n  });\n}\nvar loadedAt = Date.now();\nvar eventCounter = 0;\nfunction nextEventId() {\n  return `event-${loadedAt}-${eventCounter++}`;\n}\nfunction forwardEvent(room, eventData) {\n  sendToPanel({\n    msg: \"room::events::custom-event\",\n    roomId: room.id,\n    event: {\n      type: \"CustomEvent\",\n      id: nextEventId(),\n      key: \"Event\",\n      connectionId: eventData.connectionId,\n      payload: eventData.event\n    }\n  });\n}\nfunction partialSyncConnection(room) {\n  sendToPanel({\n    msg: \"room::sync::partial\",\n    roomId: room.id,\n    status: room.getStatus()\n  });\n}\nfunction partialSyncStorage(room) {\n  const root = room.getStorageSnapshot();\n  if (root) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      storage: root.toTreeNode(\"root\").payload\n    });\n  }\n}\nfunction partialSyncMe(room) {\n  const me = room[kInternal].getSelf_forDevTools();\n  if (me) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      me\n    });\n  }\n}\nfunction partialSyncOthers(room) {\n  const others = room[kInternal].getOthers_forDevTools();\n  if (others) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      others\n    });\n  }\n}\nfunction fullSync(room) {\n  const root = room.getStorageSnapshot();\n  const me = room[kInternal].getSelf_forDevTools();\n  const others = room[kInternal].getOthers_forDevTools();\n  room.fetchYDoc(\"\");\n  sendToPanel({\n    msg: \"room::sync::full\",\n    roomId: room.id,\n    status: room.getStatus(),\n    storage: root?.toTreeNode(\"root\").payload ?? null,\n    me,\n    others\n  });\n}\nvar roomChannelListeners = /* @__PURE__ */ new Map();\nfunction stopRoomChannelListener(roomId) {\n  const listener = roomChannelListeners.get(roomId);\n  roomChannelListeners.delete(roomId);\n  if (listener) {\n    listener();\n  }\n}\nfunction linkDevTools(roomId, room) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  sendToPanel({ msg: \"room::available\", roomId, clientVersion: VERSION });\n  stopRoomChannelListener(roomId);\n  roomChannelListeners.set(\n    roomId,\n    // Returns the unsubscribe callback, that we store in the\n    // roomChannelListeners registry\n    onMessageFromPanel.subscribe((msg) => {\n      switch (msg.msg) {\n        case \"room::subscribe\": {\n          if (msg.roomId === roomId) {\n            startSyncStream(room);\n          }\n          break;\n        }\n        case \"room::unsubscribe\": {\n          if (msg.roomId === roomId) {\n            stopSyncStream(roomId);\n          }\n          break;\n        }\n      }\n    })\n  );\n}\nfunction unlinkDevTools(roomId) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  stopSyncStream(roomId);\n  stopRoomChannelListener(roomId);\n  sendToPanel({\n    msg: \"room::unavailable\",\n    roomId\n  });\n}\n\n// src/lib/stringify.ts\nfunction stringify(object, ...args) {\n  if (typeof object !== \"object\" || object === null || Array.isArray(object)) {\n    return JSON.stringify(object, ...args);\n  }\n  const sortedObject = Object.keys(object).sort().reduce(\n    (sortedObject2, key) => {\n      sortedObject2[key] = object[key];\n      return sortedObject2;\n    },\n    {}\n  );\n  return JSON.stringify(sortedObject, ...args);\n}\n\n// src/lib/batch.ts\nvar DEFAULT_SIZE = 50;\nvar BatchCall = class {\n  constructor(input) {\n    this.input = input;\n    const { promise, resolve, reject } = Promise_withResolvers();\n    this.promise = promise;\n    this.resolve = resolve;\n    this.reject = reject;\n  }\n};\nvar Batch = class {\n  constructor(callback, options) {\n    this.queue = [];\n    this.error = false;\n    this.callback = callback;\n    this.size = options.size ?? DEFAULT_SIZE;\n    this.delay = options.delay;\n  }\n  clearDelayTimeout() {\n    if (this.delayTimeoutId !== void 0) {\n      clearTimeout(this.delayTimeoutId);\n      this.delayTimeoutId = void 0;\n    }\n  }\n  schedule() {\n    if (this.queue.length === this.size) {\n      void this.flush();\n    } else if (this.queue.length === 1) {\n      this.clearDelayTimeout();\n      this.delayTimeoutId = setTimeout(() => void this.flush(), this.delay);\n    }\n  }\n  async flush() {\n    if (this.queue.length === 0) {\n      return;\n    }\n    const calls = this.queue.splice(0);\n    const inputs = calls.map((call) => call.input);\n    try {\n      const results = await this.callback(inputs);\n      this.error = false;\n      calls.forEach((call, index) => {\n        const result = results?.[index];\n        if (!Array.isArray(results)) {\n          call.reject(new Error(\"Callback must return an array.\"));\n        } else if (calls.length !== results.length) {\n          call.reject(\n            new Error(\n              `Callback must return an array of the same length as the number of provided items. Expected ${calls.length}, but got ${results.length}.`\n            )\n          );\n        } else if (result instanceof Error) {\n          call.reject(result);\n        } else {\n          call.resolve(result);\n        }\n      });\n    } catch (error3) {\n      this.error = true;\n      calls.forEach((call) => {\n        call.reject(error3);\n      });\n    }\n  }\n  get(input) {\n    const existingCall = this.queue.find(\n      (call2) => stringify(call2.input) === stringify(input)\n    );\n    if (existingCall) {\n      return existingCall.promise;\n    }\n    const call = new BatchCall(input);\n    this.queue.push(call);\n    this.schedule();\n    return call.promise;\n  }\n  clear() {\n    this.queue = [];\n    this.error = false;\n    this.clearDelayTimeout();\n  }\n};\nfunction createBatchStore(callback, options) {\n  const batch = new Batch(callback, options);\n  const cache = /* @__PURE__ */ new Map();\n  const eventSource2 = makeEventSource();\n  function getCacheKey(args) {\n    return stringify(args);\n  }\n  function setStateAndNotify(cacheKey, state) {\n    cache.set(cacheKey, state);\n    eventSource2.notify();\n  }\n  async function get(input) {\n    const cacheKey = getCacheKey(input);\n    if (cache.has(cacheKey)) {\n      return;\n    }\n    try {\n      setStateAndNotify(cacheKey, { isLoading: true });\n      const result = await batch.get(input);\n      setStateAndNotify(cacheKey, { isLoading: false, data: result });\n    } catch (error3) {\n      setStateAndNotify(cacheKey, {\n        isLoading: false,\n        error: error3\n      });\n    }\n  }\n  function getState(input) {\n    const cacheKey = getCacheKey(input);\n    return cache.get(cacheKey);\n  }\n  return {\n    ...eventSource2.observable,\n    get,\n    getState\n  };\n}\n\n// src/lib/create-store.ts\nfunction createStore(initialState) {\n  let state = initialState;\n  const subscribers = /* @__PURE__ */ new Set();\n  function get() {\n    return state;\n  }\n  function set(callback) {\n    const newState = callback(state);\n    if (state === newState) {\n      return;\n    }\n    state = newState;\n    for (const subscriber of subscribers) {\n      subscriber(state);\n    }\n  }\n  function subscribe(callback) {\n    subscribers.add(callback);\n    callback(state);\n    return () => {\n      subscribers.delete(callback);\n    };\n  }\n  return {\n    get,\n    set,\n    subscribe\n  };\n}\n\n// src/convert-plain-data.ts\nfunction convertToCommentData(data) {\n  const editedAt = data.editedAt ? new Date(data.editedAt) : void 0;\n  const createdAt = new Date(data.createdAt);\n  const reactions = data.reactions.map((reaction) => ({\n    ...reaction,\n    createdAt: new Date(reaction.createdAt)\n  }));\n  if (data.body) {\n    return {\n      ...data,\n      reactions,\n      createdAt,\n      editedAt\n    };\n  } else {\n    const deletedAt = new Date(data.deletedAt);\n    return {\n      ...data,\n      reactions,\n      createdAt,\n      editedAt,\n      deletedAt\n    };\n  }\n}\nfunction convertToThreadData(data) {\n  const updatedAt = data.updatedAt ? new Date(data.updatedAt) : void 0;\n  const createdAt = new Date(data.createdAt);\n  const comments = data.comments.map(\n    (comment) => convertToCommentData(comment)\n  );\n  return {\n    ...data,\n    createdAt,\n    updatedAt,\n    comments\n  };\n}\nfunction convertToCommentUserReaction(data) {\n  return {\n    ...data,\n    createdAt: new Date(data.createdAt)\n  };\n}\nfunction convertToInboxNotificationData(data) {\n  const notifiedAt = new Date(data.notifiedAt);\n  const readAt = data.readAt ? new Date(data.readAt) : null;\n  if (\"activities\" in data) {\n    const activities = data.activities.map((activity) => ({\n      ...activity,\n      createdAt: new Date(activity.createdAt)\n    }));\n    return {\n      ...data,\n      notifiedAt,\n      readAt,\n      activities\n    };\n  }\n  return {\n    ...data,\n    notifiedAt,\n    readAt\n  };\n}\nfunction convertToThreadDeleteInfo(data) {\n  const deletedAt = new Date(data.deletedAt);\n  return {\n    ...data,\n    deletedAt\n  };\n}\nfunction convertToInboxNotificationDeleteInfo(data) {\n  const deletedAt = new Date(data.deletedAt);\n  return {\n    ...data,\n    deletedAt\n  };\n}\n\n// src/lib/url.ts\nfunction toURLSearchParams(params) {\n  const result = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== void 0 && value !== null) {\n      result.set(key, value.toString());\n    }\n  }\n  return result;\n}\nfunction urljoin(baseUrl, path, params) {\n  const url = new URL(path, baseUrl);\n  if (params !== void 0) {\n    url.search = (params instanceof URLSearchParams ? params : toURLSearchParams(params)).toString();\n  }\n  return url.toString();\n}\n\n// src/notifications.ts\nvar MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY = 50;\nfunction createNotificationsApi({\n  baseUrl,\n  authManager,\n  currentUserIdStore,\n  fetcher\n}) {\n  async function fetchJson(endpoint, options, params) {\n    const authValue = await authManager.getAuthValue({\n      requestedScope: \"comments:read\"\n    });\n    if (authValue.type === \"secret\" && authValue.token.parsed.k === \"acc\" /* ACCESS_TOKEN */) {\n      const userId = authValue.token.parsed.uid;\n      currentUserIdStore.set(() => userId);\n    }\n    const url = urljoin(baseUrl, `/v2/c${endpoint}`, params);\n    const response = await fetcher(url.toString(), {\n      ...options,\n      headers: {\n        ...options?.headers,\n        Authorization: `Bearer ${getAuthBearerHeaderFromAuthValue(authValue)}`\n      }\n    });\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new NotificationsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new NotificationsApiError(\n            response.statusText,\n            response.status\n          );\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  async function getInboxNotifications() {\n    const json = await fetchJson(\"/inbox-notifications\", void 0, {});\n    return {\n      threads: json.threads.map(convertToThreadData),\n      inboxNotifications: json.inboxNotifications.map(\n        convertToInboxNotificationData\n      ),\n      requestedAt: new Date(json.meta.requestedAt)\n    };\n  }\n  async function getInboxNotificationsSince(options) {\n    const json = await fetchJson(\"/inbox-notifications\", void 0, {\n      since: options.since.toISOString()\n    });\n    return {\n      threads: {\n        updated: json.threads.map(convertToThreadData),\n        deleted: json.deletedThreads.map(convertToThreadDeleteInfo)\n      },\n      inboxNotifications: {\n        updated: json.inboxNotifications.map(convertToInboxNotificationData),\n        deleted: json.deletedInboxNotifications.map(\n          convertToInboxNotificationDeleteInfo\n        )\n      },\n      requestedAt: new Date(json.meta.requestedAt)\n    };\n  }\n  async function getUnreadInboxNotificationsCount() {\n    const { count } = await fetchJson(\"/inbox-notifications/count\");\n    return count;\n  }\n  async function markAllInboxNotificationsAsRead() {\n    await fetchJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds: \"all\" })\n    });\n  }\n  async function markInboxNotificationsAsRead(inboxNotificationIds) {\n    await fetchJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds })\n    });\n  }\n  const batchedMarkInboxNotificationsAsRead = new Batch(\n    async (batchedInboxNotificationIds) => {\n      const inboxNotificationIds = batchedInboxNotificationIds.flat();\n      await markInboxNotificationsAsRead(inboxNotificationIds);\n      return inboxNotificationIds;\n    },\n    { delay: MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY }\n  );\n  async function markInboxNotificationAsRead(inboxNotificationId) {\n    await batchedMarkInboxNotificationsAsRead.get(inboxNotificationId);\n  }\n  async function deleteAllInboxNotifications() {\n    await fetchJson(\"/inbox-notifications\", {\n      method: \"DELETE\"\n    });\n  }\n  async function deleteInboxNotification(inboxNotificationId) {\n    await fetchJson(\n      `/inbox-notifications/${encodeURIComponent(inboxNotificationId)}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  return {\n    getInboxNotifications,\n    getInboxNotificationsSince,\n    getUnreadInboxNotificationsCount,\n    markAllInboxNotificationsAsRead,\n    markInboxNotificationAsRead,\n    deleteAllInboxNotifications,\n    deleteInboxNotification\n  };\n}\n\n// src/lib/position.ts\nvar MIN_CODE = 32;\nvar MAX_CODE = 126;\nvar NUM_DIGITS = MAX_CODE - MIN_CODE + 1;\nvar ZERO = nthDigit(0);\nvar ONE = nthDigit(1);\nvar ZERO_NINE = ZERO + nthDigit(-1);\nfunction nthDigit(n) {\n  const code = MIN_CODE + (n < 0 ? NUM_DIGITS + n : n);\n  if (code < MIN_CODE || code > MAX_CODE) {\n    throw new Error(`Invalid n value: ${n}`);\n  }\n  return String.fromCharCode(code);\n}\nfunction makePosition(x, y) {\n  if (x !== void 0 && y !== void 0) {\n    return between(x, y);\n  } else if (x !== void 0) {\n    return after(x);\n  } else if (y !== void 0) {\n    return before(y);\n  } else {\n    return ONE;\n  }\n}\nfunction before(pos) {\n  const lastIndex = pos.length - 1;\n  for (let i = 0; i <= lastIndex; i++) {\n    const code = pos.charCodeAt(i);\n    if (code <= MIN_CODE) {\n      continue;\n    }\n    if (i === lastIndex) {\n      if (code === MIN_CODE + 1) {\n        return pos.substring(0, i) + ZERO_NINE;\n      } else {\n        return pos.substring(0, i) + String.fromCharCode(code - 1);\n      }\n    } else {\n      return pos.substring(0, i + 1);\n    }\n  }\n  return ONE;\n}\nfunction after(pos) {\n  for (let i = 0; i <= pos.length - 1; i++) {\n    const code = pos.charCodeAt(i);\n    if (code >= MAX_CODE) {\n      continue;\n    }\n    return pos.substring(0, i) + String.fromCharCode(code + 1);\n  }\n  return pos + ONE;\n}\nfunction between(lo, hi) {\n  if (lo < hi) {\n    return _between(lo, hi);\n  } else if (lo > hi) {\n    return _between(hi, lo);\n  } else {\n    throw new Error(\"Cannot compute value between two equal positions\");\n  }\n}\nfunction _between(lo, hi) {\n  let index = 0;\n  const loLen = lo.length;\n  const hiLen = hi.length;\n  while (true) {\n    const loCode = index < loLen ? lo.charCodeAt(index) : MIN_CODE;\n    const hiCode = index < hiLen ? hi.charCodeAt(index) : MAX_CODE;\n    if (loCode === hiCode) {\n      index++;\n      continue;\n    }\n    if (hiCode - loCode === 1) {\n      const size = index + 1;\n      let prefix = lo.substring(0, size);\n      if (prefix.length < size) {\n        prefix += ZERO.repeat(size - prefix.length);\n      }\n      const suffix = lo.substring(size);\n      const nines = \"\";\n      return prefix + _between(suffix, nines);\n    } else {\n      return takeN(lo, index) + String.fromCharCode(hiCode + loCode >> 1);\n    }\n  }\n}\nfunction takeN(pos, n) {\n  return n < pos.length ? pos.substring(0, n) : pos + ZERO.repeat(n - pos.length);\n}\nvar MIN_NON_ZERO_CODE = MIN_CODE + 1;\nfunction isPos(str) {\n  if (str === \"\") {\n    return false;\n  }\n  const lastIdx = str.length - 1;\n  const last = str.charCodeAt(lastIdx);\n  if (last < MIN_NON_ZERO_CODE || last > MAX_CODE) {\n    return false;\n  }\n  for (let i = 0; i < lastIdx; i++) {\n    const code = str.charCodeAt(i);\n    if (code < MIN_CODE || code > MAX_CODE) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction convertToPos(str) {\n  const codes = [];\n  for (let i = 0; i < str.length; i++) {\n    const code = str.charCodeAt(i);\n    codes.push(code < MIN_CODE ? MIN_CODE : code > MAX_CODE ? MAX_CODE : code);\n  }\n  while (codes.length > 0 && codes[codes.length - 1] === MIN_CODE) {\n    codes.length--;\n  }\n  return codes.length > 0 ? String.fromCharCode(...codes) : (\n    // Edge case: the str was a 0-only string, which is invalid. Default back to .1\n    ONE\n  );\n}\nfunction asPos(str) {\n  return isPos(str) ? str : convertToPos(str);\n}\n\n// src/protocol/Op.ts\nvar OpCode = /* @__PURE__ */ ((OpCode2) => {\n  OpCode2[OpCode2[\"INIT\"] = 0] = \"INIT\";\n  OpCode2[OpCode2[\"SET_PARENT_KEY\"] = 1] = \"SET_PARENT_KEY\";\n  OpCode2[OpCode2[\"CREATE_LIST\"] = 2] = \"CREATE_LIST\";\n  OpCode2[OpCode2[\"UPDATE_OBJECT\"] = 3] = \"UPDATE_OBJECT\";\n  OpCode2[OpCode2[\"CREATE_OBJECT\"] = 4] = \"CREATE_OBJECT\";\n  OpCode2[OpCode2[\"DELETE_CRDT\"] = 5] = \"DELETE_CRDT\";\n  OpCode2[OpCode2[\"DELETE_OBJECT_KEY\"] = 6] = \"DELETE_OBJECT_KEY\";\n  OpCode2[OpCode2[\"CREATE_MAP\"] = 7] = \"CREATE_MAP\";\n  OpCode2[OpCode2[\"CREATE_REGISTER\"] = 8] = \"CREATE_REGISTER\";\n  return OpCode2;\n})(OpCode || {});\nfunction ackOp(opId) {\n  return {\n    type: 5 /* DELETE_CRDT */,\n    id: \"ACK\",\n    // (H)ACK\n    opId\n  };\n}\nfunction isAckOp(op) {\n  return op.type === 5 /* DELETE_CRDT */ && op.id === \"ACK\";\n}\n\n// src/crdts/AbstractCrdt.ts\nfunction crdtAsLiveNode(value) {\n  return value;\n}\nfunction HasParent(node, key, pos = asPos(key)) {\n  return Object.freeze({ type: \"HasParent\", node, key, pos });\n}\nvar NoParent = Object.freeze({ type: \"NoParent\" });\nfunction Orphaned(oldKey, oldPos = asPos(oldKey)) {\n  return Object.freeze({ type: \"Orphaned\", oldKey, oldPos });\n}\nvar AbstractCrdt = class {\n  constructor() {\n    /** @internal */\n    this._parent = NoParent;\n  }\n  /** @internal */\n  _getParentKeyOrThrow() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.key;\n      case \"NoParent\":\n        throw new Error(\"Parent key is missing\");\n      case \"Orphaned\":\n        return this.parent.oldKey;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  get _parentPos() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.pos;\n      case \"NoParent\":\n        throw new Error(\"Parent key is missing\");\n      case \"Orphaned\":\n        return this.parent.oldPos;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  get _pool() {\n    return this.__pool;\n  }\n  get roomId() {\n    return this.__pool ? this.__pool.roomId : null;\n  }\n  /** @internal */\n  get _id() {\n    return this.__id;\n  }\n  /** @internal */\n  get parent() {\n    return this._parent;\n  }\n  /** @internal */\n  get _parentKey() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.key;\n      case \"NoParent\":\n        return null;\n      case \"Orphaned\":\n        return this.parent.oldKey;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  _apply(op, _isLocal) {\n    switch (op.type) {\n      case 5 /* DELETE_CRDT */: {\n        if (this.parent.type === \"HasParent\") {\n          return this.parent.node._detachChild(crdtAsLiveNode(this));\n        }\n        return { modified: false };\n      }\n    }\n    return { modified: false };\n  }\n  /** @internal */\n  _setParentLink(newParentNode, newParentKey) {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        if (this.parent.node !== newParentNode) {\n          throw new Error(\"Cannot set parent: node already has a parent\");\n        } else {\n          this._parent = HasParent(newParentNode, newParentKey);\n          return;\n        }\n      case \"Orphaned\":\n      case \"NoParent\": {\n        this._parent = HasParent(newParentNode, newParentKey);\n        return;\n      }\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  _attach(id, pool) {\n    if (this.__id || this.__pool) {\n      throw new Error(\"Cannot attach node: already attached\");\n    }\n    pool.addNode(id, crdtAsLiveNode(this));\n    this.__id = id;\n    this.__pool = pool;\n  }\n  /** @internal */\n  _detach() {\n    if (this.__pool && this.__id) {\n      this.__pool.deleteNode(this.__id);\n    }\n    switch (this.parent.type) {\n      case \"HasParent\": {\n        this._parent = Orphaned(this.parent.key, this.parent.pos);\n        break;\n      }\n      case \"NoParent\": {\n        this._parent = NoParent;\n        break;\n      }\n      case \"Orphaned\": {\n        break;\n      }\n      default:\n        assertNever(this.parent, \"Unknown state\");\n    }\n    this.__pool = void 0;\n  }\n  /**\n   * @internal\n   *\n   * Clear the Immutable cache, so that the next call to `.toImmutable()` will\n   * recompute the equivalent Immutable value again.  Call this after every\n   * mutation to the Live node.\n   */\n  invalidate() {\n    if (this._cachedImmutable !== void 0 || this._cachedTreeNode !== void 0) {\n      this._cachedImmutable = void 0;\n      this._cachedTreeNode = void 0;\n      if (this.parent.type === \"HasParent\") {\n        this.parent.node.invalidate();\n      }\n    }\n  }\n  /**\n   * @internal\n   *\n   * Return an snapshot of this Live tree for use in DevTools.\n   */\n  toTreeNode(key) {\n    if (this._cachedTreeNode === void 0 || this._cachedTreeNodeKey !== key) {\n      this._cachedTreeNodeKey = key;\n      this._cachedTreeNode = this._toTreeNode(key);\n    }\n    return this._cachedTreeNode;\n  }\n  /**\n   * Return an immutable snapshot of this Live node and its children.\n   */\n  toImmutable() {\n    if (this._cachedImmutable === void 0) {\n      this._cachedImmutable = this._toImmutable();\n    }\n    return this._cachedImmutable;\n  }\n};\n\n// src/protocol/SerializedCrdt.ts\nvar CrdtType = /* @__PURE__ */ ((CrdtType2) => {\n  CrdtType2[CrdtType2[\"OBJECT\"] = 0] = \"OBJECT\";\n  CrdtType2[CrdtType2[\"LIST\"] = 1] = \"LIST\";\n  CrdtType2[CrdtType2[\"MAP\"] = 2] = \"MAP\";\n  CrdtType2[CrdtType2[\"REGISTER\"] = 3] = \"REGISTER\";\n  return CrdtType2;\n})(CrdtType || {});\nfunction isRootCrdt(crdt) {\n  return crdt.type === 0 /* OBJECT */ && !isChildCrdt(crdt);\n}\nfunction isChildCrdt(crdt) {\n  return crdt.parentId !== void 0 && crdt.parentKey !== void 0;\n}\n\n// src/lib/nanoid.ts\nvar nanoid = (t = 21) => crypto.getRandomValues(new Uint8Array(t)).reduce(\n  (t2, e) => t2 += (e &= 63) < 36 ? e.toString(36) : e < 62 ? (e - 26).toString(36).toUpperCase() : e < 63 ? \"_\" : \"-\",\n  \"\"\n);\n\n// src/crdts/LiveRegister.ts\nvar LiveRegister = class _LiveRegister extends AbstractCrdt {\n  constructor(data) {\n    super();\n    this._data = data;\n  }\n  get data() {\n    return this._data;\n  }\n  /** @internal */\n  static _deserialize([id, item], _parentToChildren, pool) {\n    const register = new _LiveRegister(item.data);\n    register._attach(id, pool);\n    return register;\n  }\n  /** @internal */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\n        \"Cannot serialize register if parentId or parentKey is undefined\"\n      );\n    }\n    return [\n      {\n        type: 8 /* CREATE_REGISTER */,\n        opId: pool?.generateOpId(),\n        id: this._id,\n        parentId,\n        parentKey,\n        data: this.data\n      }\n    ];\n  }\n  /** @internal */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveRegister if parent is missing\");\n    }\n    return {\n      type: 3 /* REGISTER */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key,\n      data: this.data\n    };\n  }\n  /** @internal */\n  _attachChild(_op) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /** @internal */\n  _detachChild(_crdt) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    return super._apply(op, isLocal);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"Json\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: this._data\n    };\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._data;\n  }\n  clone() {\n    return deepClone(this.data);\n  }\n};\n\n// src/crdts/LiveList.ts\nfunction compareNodePosition(itemA, itemB) {\n  const posA = itemA._parentPos;\n  const posB = itemB._parentPos;\n  return posA === posB ? 0 : posA < posB ? -1 : 1;\n}\nvar LiveList = class _LiveList extends AbstractCrdt {\n  constructor(items) {\n    super();\n    this._items = [];\n    this._implicitlyDeletedItems = /* @__PURE__ */ new WeakSet();\n    this._unacknowledgedSets = /* @__PURE__ */ new Map();\n    let position = void 0;\n    for (const item of items) {\n      const newPosition = makePosition(position);\n      const node = lsonToLiveNode(item);\n      node._setParentLink(this, newPosition);\n      this._items.push(node);\n      position = newPosition;\n    }\n  }\n  /** @internal */\n  static _deserialize([id], parentToChildren, pool) {\n    const list = new _LiveList([]);\n    list._attach(id, pool);\n    const children = parentToChildren.get(id);\n    if (children === void 0) {\n      return list;\n    }\n    for (const [id2, crdt] of children) {\n      const child = deserialize([id2, crdt], parentToChildren, pool);\n      child._setParentLink(list, crdt.parentKey);\n      list._insertAndSort(child);\n    }\n    return list;\n  }\n  /**\n   * @internal\n   * This function assumes that the resulting ops will be sent to the server if they have an 'opId'\n   * so we mutate _unacknowledgedSets to avoid potential flickering\n   * https://github.com/liveblocks/liveblocks/pull/1177\n   *\n   * This is quite unintuitive and should disappear as soon as\n   * we introduce an explicit LiveList.Set operation\n   */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const ops = [];\n    const op = {\n      id: this._id,\n      opId: pool?.generateOpId(),\n      type: 2 /* CREATE_LIST */,\n      parentId,\n      parentKey\n    };\n    ops.push(op);\n    for (const item of this._items) {\n      const parentKey2 = item._getParentKeyOrThrow();\n      const childOps = HACK_addIntentAndDeletedIdToOperation(\n        item._toOps(this._id, parentKey2, pool),\n        void 0\n      );\n      const childOpId = childOps[0].opId;\n      if (childOpId !== void 0) {\n        this._unacknowledgedSets.set(parentKey2, childOpId);\n      }\n      ops.push(...childOps);\n    }\n    return ops;\n  }\n  /**\n   * @internal\n   *\n   * Adds a new item into the sorted list, in the correct position.\n   */\n  _insertAndSort(item) {\n    this._items.push(item);\n    this._sortItems();\n  }\n  /** @internal */\n  _sortItems() {\n    this._items.sort(compareNodePosition);\n    this.invalidate();\n  }\n  /** @internal */\n  _indexOfPosition(position) {\n    return this._items.findIndex(\n      (item) => item._getParentKeyOrThrow() === position\n    );\n  }\n  /** @internal */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const item of this._items) {\n      item._attach(pool.generateId(), pool);\n    }\n  }\n  /** @internal */\n  _detach() {\n    super._detach();\n    for (const item of this._items) {\n      item._detach();\n    }\n  }\n  /** @internal */\n  _applySetRemote(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    child._attach(id, this._pool);\n    child._setParentLink(this, key);\n    const deletedId = op.deletedId;\n    const indexOfItemWithSamePosition = this._indexOfPosition(key);\n    if (indexOfItemWithSamePosition !== -1) {\n      const itemWithSamePosition = this._items[indexOfItemWithSamePosition];\n      if (itemWithSamePosition._id === deletedId) {\n        itemWithSamePosition._detach();\n        this._items[indexOfItemWithSamePosition] = child;\n        return {\n          modified: makeUpdate(this, [\n            setDelta(indexOfItemWithSamePosition, child)\n          ]),\n          reverse: []\n        };\n      } else {\n        this._implicitlyDeletedItems.add(itemWithSamePosition);\n        this._items[indexOfItemWithSamePosition] = child;\n        const delta = [\n          setDelta(indexOfItemWithSamePosition, child)\n        ];\n        const deleteDelta2 = this._detachItemAssociatedToSetOperation(\n          op.deletedId\n        );\n        if (deleteDelta2) {\n          delta.push(deleteDelta2);\n        }\n        return {\n          modified: makeUpdate(this, delta),\n          reverse: []\n        };\n      }\n    } else {\n      const updates = [];\n      const deleteDelta2 = this._detachItemAssociatedToSetOperation(\n        op.deletedId\n      );\n      if (deleteDelta2) {\n        updates.push(deleteDelta2);\n      }\n      this._insertAndSort(child);\n      updates.push(insertDelta(this._indexOfPosition(key), child));\n      return {\n        reverse: [],\n        modified: makeUpdate(this, updates)\n      };\n    }\n  }\n  /** @internal */\n  _applySetAck(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const delta = [];\n    const deletedDelta = this._detachItemAssociatedToSetOperation(op.deletedId);\n    if (deletedDelta) {\n      delta.push(deletedDelta);\n    }\n    const unacknowledgedOpId = this._unacknowledgedSets.get(op.parentKey);\n    if (unacknowledgedOpId !== void 0) {\n      if (unacknowledgedOpId !== op.opId) {\n        return delta.length === 0 ? { modified: false } : { modified: makeUpdate(this, delta), reverse: [] };\n      } else {\n        this._unacknowledgedSets.delete(op.parentKey);\n      }\n    }\n    const indexOfItemWithSamePosition = this._indexOfPosition(op.parentKey);\n    const existingItem = this._items.find((item) => item._id === op.id);\n    if (existingItem !== void 0) {\n      if (existingItem._parentKey === op.parentKey) {\n        return {\n          modified: delta.length > 0 ? makeUpdate(this, delta) : false,\n          reverse: []\n        };\n      }\n      if (indexOfItemWithSamePosition !== -1) {\n        this._implicitlyDeletedItems.add(\n          this._items[indexOfItemWithSamePosition]\n        );\n        this._items.splice(indexOfItemWithSamePosition, 1);\n        delta.push(deleteDelta(indexOfItemWithSamePosition));\n      }\n      const previousIndex = this._items.indexOf(existingItem);\n      existingItem._setParentLink(this, op.parentKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(existingItem);\n      if (newIndex !== previousIndex) {\n        delta.push(moveDelta(previousIndex, newIndex, existingItem));\n      }\n      return {\n        modified: delta.length > 0 ? makeUpdate(this, delta) : false,\n        reverse: []\n      };\n    } else {\n      const orphan = this._pool.getNode(op.id);\n      if (orphan && this._implicitlyDeletedItems.has(orphan)) {\n        orphan._setParentLink(this, op.parentKey);\n        this._implicitlyDeletedItems.delete(orphan);\n        this._insertAndSort(orphan);\n        const recreatedItemIndex = this._items.indexOf(orphan);\n        return {\n          modified: makeUpdate(this, [\n            // If there is an item at this position, update is a set, else it's an insert\n            indexOfItemWithSamePosition === -1 ? insertDelta(recreatedItemIndex, orphan) : setDelta(recreatedItemIndex, orphan),\n            ...delta\n          ]),\n          reverse: []\n        };\n      } else {\n        if (indexOfItemWithSamePosition !== -1) {\n          this._items.splice(indexOfItemWithSamePosition, 1);\n        }\n        const { newItem, newIndex } = this._createAttachItemAndSort(\n          op,\n          op.parentKey\n        );\n        return {\n          modified: makeUpdate(this, [\n            // If there is an item at this position, update is a set, else it's an insert\n            indexOfItemWithSamePosition === -1 ? insertDelta(newIndex, newItem) : setDelta(newIndex, newItem),\n            ...delta\n          ]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /**\n   * Returns the update delta of the deletion or null\n   * @internal\n   */\n  _detachItemAssociatedToSetOperation(deletedId) {\n    if (deletedId === void 0 || this._pool === void 0) {\n      return null;\n    }\n    const deletedItem = this._pool.getNode(deletedId);\n    if (deletedItem === void 0) {\n      return null;\n    }\n    const result = this._detachChild(deletedItem);\n    if (result.modified === false) {\n      return null;\n    }\n    return result.modified.updates[0];\n  }\n  /** @internal */\n  _applyRemoteInsert(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const key = asPos(op.parentKey);\n    const existingItemIndex = this._indexOfPosition(key);\n    if (existingItemIndex !== -1) {\n      this._shiftItemPosition(existingItemIndex, key);\n    }\n    const { newItem, newIndex } = this._createAttachItemAndSort(op, key);\n    return {\n      modified: makeUpdate(this, [insertDelta(newIndex, newItem)]),\n      reverse: []\n    };\n  }\n  /** @internal */\n  _applyInsertAck(op) {\n    const existingItem = this._items.find((item) => item._id === op.id);\n    const key = asPos(op.parentKey);\n    const itemIndexAtPosition = this._indexOfPosition(key);\n    if (existingItem) {\n      if (existingItem._parentKey === key) {\n        return {\n          modified: false\n        };\n      } else {\n        const oldPositionIndex = this._items.indexOf(existingItem);\n        if (itemIndexAtPosition !== -1) {\n          this._shiftItemPosition(itemIndexAtPosition, key);\n        }\n        existingItem._setParentLink(this, key);\n        this._sortItems();\n        const newIndex = this._indexOfPosition(key);\n        if (newIndex === oldPositionIndex) {\n          return { modified: false };\n        }\n        return {\n          modified: makeUpdate(this, [\n            moveDelta(oldPositionIndex, newIndex, existingItem)\n          ]),\n          reverse: []\n        };\n      }\n    } else {\n      const orphan = nn(this._pool).getNode(op.id);\n      if (orphan && this._implicitlyDeletedItems.has(orphan)) {\n        orphan._setParentLink(this, key);\n        this._implicitlyDeletedItems.delete(orphan);\n        this._insertAndSort(orphan);\n        const newIndex = this._indexOfPosition(key);\n        return {\n          modified: makeUpdate(this, [insertDelta(newIndex, orphan)]),\n          reverse: []\n        };\n      } else {\n        if (itemIndexAtPosition !== -1) {\n          this._shiftItemPosition(itemIndexAtPosition, key);\n        }\n        const { newItem, newIndex } = this._createAttachItemAndSort(op, key);\n        return {\n          modified: makeUpdate(this, [insertDelta(newIndex, newItem)]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /** @internal */\n  _applyInsertUndoRedo(op) {\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    if (this._pool?.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    child._attach(id, nn(this._pool));\n    child._setParentLink(this, key);\n    const existingItemIndex = this._indexOfPosition(key);\n    let newKey = key;\n    if (existingItemIndex !== -1) {\n      const before2 = this._items[existingItemIndex]?._parentPos;\n      const after2 = this._items[existingItemIndex + 1]?._parentPos;\n      newKey = makePosition(before2, after2);\n      child._setParentLink(this, newKey);\n    }\n    this._insertAndSort(child);\n    const newIndex = this._indexOfPosition(newKey);\n    return {\n      modified: makeUpdate(this, [insertDelta(newIndex, child)]),\n      reverse: [{ type: 5 /* DELETE_CRDT */, id }]\n    };\n  }\n  /** @internal */\n  _applySetUndoRedo(op) {\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    if (this._pool?.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    this._unacknowledgedSets.set(key, nn(op.opId));\n    const indexOfItemWithSameKey = this._indexOfPosition(key);\n    child._attach(id, nn(this._pool));\n    child._setParentLink(this, key);\n    const newKey = key;\n    if (indexOfItemWithSameKey !== -1) {\n      const existingItem = this._items[indexOfItemWithSameKey];\n      existingItem._detach();\n      this._items[indexOfItemWithSameKey] = child;\n      const reverse = HACK_addIntentAndDeletedIdToOperation(\n        existingItem._toOps(nn(this._id), key, this._pool),\n        op.id\n      );\n      const delta = [setDelta(indexOfItemWithSameKey, child)];\n      const deletedDelta = this._detachItemAssociatedToSetOperation(\n        op.deletedId\n      );\n      if (deletedDelta) {\n        delta.push(deletedDelta);\n      }\n      return {\n        modified: makeUpdate(this, delta),\n        reverse\n      };\n    } else {\n      this._insertAndSort(child);\n      this._detachItemAssociatedToSetOperation(op.deletedId);\n      const newIndex = this._indexOfPosition(newKey);\n      return {\n        reverse: [{ type: 5 /* DELETE_CRDT */, id }],\n        modified: makeUpdate(this, [insertDelta(newIndex, child)])\n      };\n    }\n  }\n  /** @internal */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    let result;\n    if (op.intent === \"set\") {\n      if (source === 1 /* REMOTE */) {\n        result = this._applySetRemote(op);\n      } else if (source === 2 /* ACK */) {\n        result = this._applySetAck(op);\n      } else {\n        result = this._applySetUndoRedo(op);\n      }\n    } else {\n      if (source === 1 /* REMOTE */) {\n        result = this._applyRemoteInsert(op);\n      } else if (source === 2 /* ACK */) {\n        result = this._applyInsertAck(op);\n      } else {\n        result = this._applyInsertUndoRedo(op);\n      }\n    }\n    if (result.modified !== false) {\n      this.invalidate();\n    }\n    return result;\n  }\n  /** @internal */\n  _detachChild(child) {\n    if (child) {\n      const parentKey = nn(child._parentKey);\n      const reverse = child._toOps(nn(this._id), parentKey, this._pool);\n      const indexToDelete = this._items.indexOf(child);\n      if (indexToDelete === -1) {\n        return {\n          modified: false\n        };\n      }\n      this._items.splice(indexToDelete, 1);\n      this.invalidate();\n      child._detach();\n      return {\n        modified: makeUpdate(this, [deleteDelta(indexToDelete)]),\n        reverse\n      };\n    }\n    return { modified: false };\n  }\n  /** @internal */\n  _applySetChildKeyRemote(newKey, child) {\n    if (this._implicitlyDeletedItems.has(child)) {\n      this._implicitlyDeletedItems.delete(child);\n      child._setParentLink(this, newKey);\n      this._insertAndSort(child);\n      const newIndex = this._items.indexOf(child);\n      return {\n        modified: makeUpdate(this, [insertDelta(newIndex, child)]),\n        reverse: []\n      };\n    }\n    const previousKey = child._parentKey;\n    if (newKey === previousKey) {\n      return {\n        modified: false\n      };\n    }\n    const existingItemIndex = this._indexOfPosition(newKey);\n    if (existingItemIndex === -1) {\n      const previousIndex = this._items.indexOf(child);\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (newIndex === previousIndex) {\n        return {\n          modified: false\n        };\n      }\n      return {\n        modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n        reverse: []\n      };\n    } else {\n      this._items[existingItemIndex]._setParentLink(\n        this,\n        makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n      );\n      const previousIndex = this._items.indexOf(child);\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (newIndex === previousIndex) {\n        return {\n          modified: false\n        };\n      }\n      return {\n        modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n        reverse: []\n      };\n    }\n  }\n  /** @internal */\n  _applySetChildKeyAck(newKey, child) {\n    const previousKey = nn(child._parentKey);\n    if (this._implicitlyDeletedItems.has(child)) {\n      const existingItemIndex = this._indexOfPosition(newKey);\n      this._implicitlyDeletedItems.delete(child);\n      if (existingItemIndex !== -1) {\n        this._items[existingItemIndex]._setParentLink(\n          this,\n          makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n        );\n      }\n      child._setParentLink(this, newKey);\n      this._insertAndSort(child);\n      return {\n        modified: false\n      };\n    } else {\n      if (newKey === previousKey) {\n        return {\n          modified: false\n        };\n      }\n      const previousIndex = this._items.indexOf(child);\n      const existingItemIndex = this._indexOfPosition(newKey);\n      if (existingItemIndex !== -1) {\n        this._items[existingItemIndex]._setParentLink(\n          this,\n          makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n        );\n      }\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (previousIndex === newIndex) {\n        return {\n          modified: false\n        };\n      } else {\n        return {\n          modified: makeUpdate(this, [\n            moveDelta(previousIndex, newIndex, child)\n          ]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /** @internal */\n  _applySetChildKeyUndoRedo(newKey, child) {\n    const previousKey = nn(child._parentKey);\n    const previousIndex = this._items.indexOf(child);\n    const existingItemIndex = this._indexOfPosition(newKey);\n    if (existingItemIndex !== -1) {\n      this._items[existingItemIndex]._setParentLink(\n        this,\n        makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n      );\n    }\n    child._setParentLink(this, newKey);\n    this._sortItems();\n    const newIndex = this._items.indexOf(child);\n    if (previousIndex === newIndex) {\n      return {\n        modified: false\n      };\n    }\n    return {\n      modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n      reverse: [\n        {\n          type: 1 /* SET_PARENT_KEY */,\n          id: nn(child._id),\n          parentKey: previousKey\n        }\n      ]\n    };\n  }\n  /** @internal */\n  _setChildKey(newKey, child, source) {\n    if (source === 1 /* REMOTE */) {\n      return this._applySetChildKeyRemote(newKey, child);\n    } else if (source === 2 /* ACK */) {\n      return this._applySetChildKeyAck(newKey, child);\n    } else {\n      return this._applySetChildKeyUndoRedo(newKey, child);\n    }\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    return super._apply(op, isLocal);\n  }\n  /** @internal */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveList if parent is missing\");\n    }\n    return {\n      type: 1 /* LIST */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key\n    };\n  }\n  /**\n   * Returns the number of elements.\n   */\n  get length() {\n    return this._items.length;\n  }\n  /**\n   * Adds one element to the end of the LiveList.\n   * @param element The element to add to the end of the LiveList.\n   */\n  push(element) {\n    this._pool?.assertStorageIsWritable();\n    return this.insert(element, this.length);\n  }\n  /**\n   * Inserts one element at a specified index.\n   * @param element The element to insert.\n   * @param index The index at which you want to insert the element.\n   */\n  insert(element, index) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index > this._items.length) {\n      throw new Error(\n        `Cannot insert list item at index \"\u001d${index}\". index should be between 0 and ${this._items.length}`\n      );\n    }\n    const before2 = this._items[index - 1] ? this._items[index - 1]._parentPos : void 0;\n    const after2 = this._items[index] ? this._items[index]._parentPos : void 0;\n    const position = makePosition(before2, after2);\n    const value = lsonToLiveNode(element);\n    value._setParentLink(this, position);\n    this._insertAndSort(value);\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      value._attach(id, this._pool);\n      this._pool.dispatch(\n        value._toOps(this._id, position, this._pool),\n        [{ type: 5 /* DELETE_CRDT */, id }],\n        /* @__PURE__ */ new Map([\n          [this._id, makeUpdate(this, [insertDelta(index, value)])]\n        ])\n      );\n    }\n  }\n  /**\n   * Move one element from one index to another.\n   * @param index The index of the element to move\n   * @param targetIndex The index where the element should be after moving.\n   */\n  move(index, targetIndex) {\n    this._pool?.assertStorageIsWritable();\n    if (targetIndex < 0) {\n      throw new Error(\"targetIndex cannot be less than 0\");\n    }\n    if (targetIndex >= this._items.length) {\n      throw new Error(\n        \"targetIndex cannot be greater or equal than the list length\"\n      );\n    }\n    if (index < 0) {\n      throw new Error(\"index cannot be less than 0\");\n    }\n    if (index >= this._items.length) {\n      throw new Error(\"index cannot be greater or equal than the list length\");\n    }\n    let beforePosition = null;\n    let afterPosition = null;\n    if (index < targetIndex) {\n      afterPosition = targetIndex === this._items.length - 1 ? void 0 : this._items[targetIndex + 1]._parentPos;\n      beforePosition = this._items[targetIndex]._parentPos;\n    } else {\n      afterPosition = this._items[targetIndex]._parentPos;\n      beforePosition = targetIndex === 0 ? void 0 : this._items[targetIndex - 1]._parentPos;\n    }\n    const position = makePosition(beforePosition, afterPosition);\n    const item = this._items[index];\n    const previousPosition = item._getParentKeyOrThrow();\n    item._setParentLink(this, position);\n    this._sortItems();\n    if (this._pool && this._id) {\n      const storageUpdates = /* @__PURE__ */ new Map([\n        [this._id, makeUpdate(this, [moveDelta(index, targetIndex, item)])]\n      ]);\n      this._pool.dispatch(\n        [\n          {\n            type: 1 /* SET_PARENT_KEY */,\n            id: nn(item._id),\n            opId: this._pool.generateOpId(),\n            parentKey: position\n          }\n        ],\n        [\n          {\n            type: 1 /* SET_PARENT_KEY */,\n            id: nn(item._id),\n            parentKey: previousPosition\n          }\n        ],\n        storageUpdates\n      );\n    }\n  }\n  /**\n   * Deletes an element at the specified index\n   * @param index The index of the element to delete\n   */\n  delete(index) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index >= this._items.length) {\n      throw new Error(\n        `Cannot delete list item at index \"${index}\". index should be between 0 and ${this._items.length - 1}`\n      );\n    }\n    const item = this._items[index];\n    item._detach();\n    this._items.splice(index, 1);\n    this.invalidate();\n    if (this._pool) {\n      const childRecordId = item._id;\n      if (childRecordId) {\n        const storageUpdates = /* @__PURE__ */ new Map();\n        storageUpdates.set(\n          nn(this._id),\n          makeUpdate(this, [deleteDelta(index)])\n        );\n        this._pool.dispatch(\n          [\n            {\n              id: childRecordId,\n              opId: this._pool.generateOpId(),\n              type: 5 /* DELETE_CRDT */\n            }\n          ],\n          item._toOps(nn(this._id), item._getParentKeyOrThrow()),\n          storageUpdates\n        );\n      }\n    }\n  }\n  clear() {\n    this._pool?.assertStorageIsWritable();\n    if (this._pool) {\n      const ops = [];\n      const reverseOps = [];\n      const updateDelta = [];\n      for (const item of this._items) {\n        item._detach();\n        const childId = item._id;\n        if (childId) {\n          ops.push({\n            type: 5 /* DELETE_CRDT */,\n            id: childId,\n            opId: this._pool.generateOpId()\n          });\n          reverseOps.push(\n            ...item._toOps(nn(this._id), item._getParentKeyOrThrow())\n          );\n          updateDelta.push(deleteDelta(0));\n        }\n      }\n      this._items = [];\n      this.invalidate();\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(nn(this._id), makeUpdate(this, updateDelta));\n      this._pool.dispatch(ops, reverseOps, storageUpdates);\n    } else {\n      for (const item of this._items) {\n        item._detach();\n      }\n      this._items = [];\n      this.invalidate();\n    }\n  }\n  set(index, item) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index >= this._items.length) {\n      throw new Error(\n        `Cannot set list item at index \"\u001d${index}\". index should be between 0 and ${this._items.length - 1}`\n      );\n    }\n    const existingItem = this._items[index];\n    const position = existingItem._getParentKeyOrThrow();\n    const existingId = existingItem._id;\n    existingItem._detach();\n    const value = lsonToLiveNode(item);\n    value._setParentLink(this, position);\n    this._items[index] = value;\n    this.invalidate();\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      value._attach(id, this._pool);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(this._id, makeUpdate(this, [setDelta(index, value)]));\n      const ops = HACK_addIntentAndDeletedIdToOperation(\n        value._toOps(this._id, position, this._pool),\n        existingId\n      );\n      this._unacknowledgedSets.set(position, nn(ops[0].opId));\n      const reverseOps = HACK_addIntentAndDeletedIdToOperation(\n        existingItem._toOps(this._id, position, void 0),\n        id\n      );\n      this._pool.dispatch(ops, reverseOps, storageUpdates);\n    }\n  }\n  /**\n   * Returns an Array of all the elements in the LiveList.\n   */\n  toArray() {\n    return this._items.map(\n      (entry) => liveNodeToLson(entry)\n      //                               ^^^^^^^^\n      //                               FIXME! This isn't safe.\n    );\n  }\n  /**\n   * Tests whether all elements pass the test implemented by the provided function.\n   * @param predicate Function to test for each element, taking two arguments (the element and its index).\n   * @returns true if the predicate function returns a truthy value for every element. Otherwise, false.\n   */\n  every(predicate) {\n    return this.toArray().every(predicate);\n  }\n  /**\n   * Creates an array with all elements that pass the test implemented by the provided function.\n   * @param predicate Function to test each element of the LiveList. Return a value that coerces to true to keep the element, or to false otherwise.\n   * @returns An array with the elements that pass the test.\n   */\n  filter(predicate) {\n    return this.toArray().filter(predicate);\n  }\n  /**\n   * Returns the first element that satisfies the provided testing function.\n   * @param predicate Function to execute on each value.\n   * @returns The value of the first element in the LiveList that satisfies the provided testing function. Otherwise, undefined is returned.\n   */\n  find(predicate) {\n    return this.toArray().find(predicate);\n  }\n  /**\n   * Returns the index of the first element in the LiveList that satisfies the provided testing function.\n   * @param predicate Function to execute on each value until the function returns true, indicating that the satisfying element was found.\n   * @returns The index of the first element in the LiveList that passes the test. Otherwise, -1.\n   */\n  findIndex(predicate) {\n    return this.toArray().findIndex(predicate);\n  }\n  /**\n   * Executes a provided function once for each element.\n   * @param callbackfn Function to execute on each element.\n   */\n  forEach(callbackfn) {\n    return this.toArray().forEach(callbackfn);\n  }\n  /**\n   * Get the element at the specified index.\n   * @param index The index on the element to get.\n   * @returns The element at the specified index or undefined.\n   */\n  get(index) {\n    if (index < 0 || index >= this._items.length) {\n      return void 0;\n    }\n    return liveNodeToLson(this._items[index]);\n  }\n  /**\n   * Returns the first index at which a given element can be found in the LiveList, or -1 if it is not present.\n   * @param searchElement Element to locate.\n   * @param fromIndex The index to start the search at.\n   * @returns The first index of the element in the LiveList; -1 if not found.\n   */\n  indexOf(searchElement, fromIndex) {\n    return this.toArray().indexOf(searchElement, fromIndex);\n  }\n  /**\n   * Returns the last index at which a given element can be found in the LiveList, or -1 if it is not present. The LiveLsit is searched backwards, starting at fromIndex.\n   * @param searchElement Element to locate.\n   * @param fromIndex The index at which to start searching backwards.\n   * @returns\n   */\n  lastIndexOf(searchElement, fromIndex) {\n    return this.toArray().lastIndexOf(searchElement, fromIndex);\n  }\n  /**\n   * Creates an array populated with the results of calling a provided function on every element.\n   * @param callback Function that is called for every element.\n   * @returns An array with each element being the result of the callback function.\n   */\n  map(callback) {\n    return this._items.map(\n      (entry, i) => callback(\n        liveNodeToLson(entry),\n        //                    ^^^^^^^^\n        //                    FIXME! This isn't safe.\n        i\n      )\n    );\n  }\n  /**\n   * Tests whether at least one element in the LiveList passes the test implemented by the provided function.\n   * @param predicate Function to test for each element.\n   * @returns true if the callback function returns a truthy value for at least one element. Otherwise, false.\n   */\n  some(predicate) {\n    return this.toArray().some(predicate);\n  }\n  [Symbol.iterator]() {\n    return new LiveListIterator(this._items);\n  }\n  /** @internal */\n  _createAttachItemAndSort(op, key) {\n    const newItem = creationOpToLiveNode(op);\n    newItem._attach(op.id, nn(this._pool));\n    newItem._setParentLink(this, key);\n    this._insertAndSort(newItem);\n    const newIndex = this._indexOfPosition(key);\n    return { newItem, newIndex };\n  }\n  /** @internal */\n  _shiftItemPosition(index, key) {\n    const shiftedPosition = makePosition(\n      key,\n      this._items.length > index + 1 ? this._items[index + 1]?._parentPos : void 0\n    );\n    this._items[index]._setParentLink(this, shiftedPosition);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"LiveList\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: this._items.map(\n        (item, index) => item.toTreeNode(index.toString())\n      )\n    };\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = this._items.map((node) => node.toImmutable());\n    return  false ? 0 : Object.freeze(result);\n  }\n  clone() {\n    return new _LiveList(this._items.map((item) => item.clone()));\n  }\n};\nvar LiveListIterator = class {\n  constructor(items) {\n    this._innerIterator = items[Symbol.iterator]();\n  }\n  [Symbol.iterator]() {\n    return this;\n  }\n  next() {\n    const result = this._innerIterator.next();\n    if (result.done) {\n      return {\n        done: true,\n        value: void 0\n      };\n    }\n    const value = liveNodeToLson(result.value);\n    return { value };\n  }\n};\nfunction makeUpdate(liveList, deltaUpdates) {\n  return {\n    node: liveList,\n    type: \"LiveList\",\n    updates: deltaUpdates\n  };\n}\nfunction setDelta(index, item) {\n  return {\n    index,\n    type: \"set\",\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction deleteDelta(index) {\n  return {\n    index,\n    type: \"delete\"\n  };\n}\nfunction insertDelta(index, item) {\n  return {\n    index,\n    type: \"insert\",\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction moveDelta(previousIndex, index, item) {\n  return {\n    index,\n    type: \"move\",\n    previousIndex,\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction HACK_addIntentAndDeletedIdToOperation(ops, deletedId) {\n  return ops.map((op, index) => {\n    if (index === 0) {\n      const firstOp = op;\n      return {\n        ...firstOp,\n        intent: \"set\",\n        deletedId\n      };\n    } else {\n      return op;\n    }\n  });\n}\n\n// src/lib/freeze.ts\nvar freeze =  false ? (\n  /* istanbul ignore next */\n  0\n) : Object.freeze;\n\n// src/crdts/LiveMap.ts\nvar LiveMap = class _LiveMap extends AbstractCrdt {\n  constructor(entries2) {\n    super();\n    this.unacknowledgedSet = /* @__PURE__ */ new Map();\n    if (entries2) {\n      const mappedEntries = [];\n      for (const [key, value] of entries2) {\n        const node = lsonToLiveNode(value);\n        node._setParentLink(this, key);\n        mappedEntries.push([key, node]);\n      }\n      this._map = new Map(mappedEntries);\n    } else {\n      this._map = /* @__PURE__ */ new Map();\n    }\n  }\n  /**\n   * @internal\n   */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const ops = [];\n    const op = {\n      id: this._id,\n      opId: pool?.generateOpId(),\n      type: 7 /* CREATE_MAP */,\n      parentId,\n      parentKey\n    };\n    ops.push(op);\n    for (const [key, value] of this._map) {\n      ops.push(...value._toOps(this._id, key, pool));\n    }\n    return ops;\n  }\n  /**\n   * @internal\n   */\n  static _deserialize([id, _item], parentToChildren, pool) {\n    const map = new _LiveMap();\n    map._attach(id, pool);\n    const children = parentToChildren.get(id);\n    if (children === void 0) {\n      return map;\n    }\n    for (const [id2, crdt] of children) {\n      const child = deserialize([id2, crdt], parentToChildren, pool);\n      child._setParentLink(map, crdt.parentKey);\n      map._map.set(crdt.parentKey, child);\n      map.invalidate();\n    }\n    return map;\n  }\n  /**\n   * @internal\n   */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const [_key, value] of this._map) {\n      if (isLiveNode(value)) {\n        value._attach(pool.generateId(), pool);\n      }\n    }\n  }\n  /**\n   * @internal\n   */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, parentKey, opId } = op;\n    const key = parentKey;\n    const child = creationOpToLiveNode(op);\n    if (this._pool.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    if (source === 2 /* ACK */) {\n      const lastUpdateOpId = this.unacknowledgedSet.get(key);\n      if (lastUpdateOpId === opId) {\n        this.unacknowledgedSet.delete(key);\n        return { modified: false };\n      } else if (lastUpdateOpId !== void 0) {\n        return { modified: false };\n      }\n    } else if (source === 1 /* REMOTE */) {\n      this.unacknowledgedSet.delete(key);\n    }\n    const previousValue = this._map.get(key);\n    let reverse;\n    if (previousValue) {\n      const thisId = nn(this._id);\n      reverse = previousValue._toOps(thisId, key);\n      previousValue._detach();\n    } else {\n      reverse = [{ type: 5 /* DELETE_CRDT */, id }];\n    }\n    child._setParentLink(this, key);\n    child._attach(id, this._pool);\n    this._map.set(key, child);\n    this.invalidate();\n    return {\n      modified: {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"update\" } }\n      },\n      reverse\n    };\n  }\n  /**\n   * @internal\n   */\n  _detach() {\n    super._detach();\n    for (const item of this._map.values()) {\n      item._detach();\n    }\n  }\n  /**\n   * @internal\n   */\n  _detachChild(child) {\n    const id = nn(this._id);\n    const parentKey = nn(child._parentKey);\n    const reverse = child._toOps(id, parentKey, this._pool);\n    for (const [key, value] of this._map) {\n      if (value === child) {\n        this._map.delete(key);\n        this.invalidate();\n      }\n    }\n    child._detach();\n    const storageUpdate = {\n      node: this,\n      type: \"LiveMap\",\n      updates: { [parentKey]: { type: \"delete\" } }\n    };\n    return { modified: storageUpdate, reverse };\n  }\n  /**\n   * @internal\n   */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveMap if parent is missing\");\n    }\n    return {\n      type: 2 /* MAP */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key\n    };\n  }\n  /**\n   * Returns a specified element from the LiveMap.\n   * @param key The key of the element to return.\n   * @returns The element associated with the specified key, or undefined if the key can't be found in the LiveMap.\n   */\n  get(key) {\n    const value = this._map.get(key);\n    if (value === void 0) {\n      return void 0;\n    }\n    return liveNodeToLson(value);\n  }\n  /**\n   * Adds or updates an element with a specified key and a value.\n   * @param key The key of the element to add. Should be a string.\n   * @param value The value of the element to add. Should be serializable to JSON.\n   */\n  set(key, value) {\n    this._pool?.assertStorageIsWritable();\n    const oldValue = this._map.get(key);\n    if (oldValue) {\n      oldValue._detach();\n    }\n    const item = lsonToLiveNode(value);\n    item._setParentLink(this, key);\n    this._map.set(key, item);\n    this.invalidate();\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      item._attach(id, this._pool);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(this._id, {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"update\" } }\n      });\n      const ops = item._toOps(this._id, key, this._pool);\n      this.unacknowledgedSet.set(key, nn(ops[0].opId));\n      this._pool.dispatch(\n        item._toOps(this._id, key, this._pool),\n        oldValue ? oldValue._toOps(this._id, key) : [{ type: 5 /* DELETE_CRDT */, id }],\n        storageUpdates\n      );\n    }\n  }\n  /**\n   * Returns the number of elements in the LiveMap.\n   */\n  get size() {\n    return this._map.size;\n  }\n  /**\n   * Returns a boolean indicating whether an element with the specified key exists or not.\n   * @param key The key of the element to test for presence.\n   */\n  has(key) {\n    return this._map.has(key);\n  }\n  /**\n   * Removes the specified element by key.\n   * @param key The key of the element to remove.\n   * @returns true if an element existed and has been removed, or false if the element does not exist.\n   */\n  delete(key) {\n    this._pool?.assertStorageIsWritable();\n    const item = this._map.get(key);\n    if (item === void 0) {\n      return false;\n    }\n    item._detach();\n    this._map.delete(key);\n    this.invalidate();\n    if (this._pool && item._id) {\n      const thisId = nn(this._id);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(thisId, {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"delete\" } }\n      });\n      this._pool.dispatch(\n        [\n          {\n            type: 5 /* DELETE_CRDT */,\n            id: item._id,\n            opId: this._pool.generateOpId()\n          }\n        ],\n        item._toOps(thisId, key),\n        storageUpdates\n      );\n    }\n    return true;\n  }\n  /**\n   * Returns a new Iterator object that contains the [key, value] pairs for each element.\n   */\n  entries() {\n    const innerIterator = this._map.entries();\n    return {\n      [Symbol.iterator]() {\n        return this;\n      },\n      next() {\n        const iteratorValue = innerIterator.next();\n        if (iteratorValue.done) {\n          return {\n            done: true,\n            value: void 0\n          };\n        }\n        const entry = iteratorValue.value;\n        const key = entry[0];\n        const value = liveNodeToLson(iteratorValue.value[1]);\n        return {\n          value: [key, value]\n        };\n      }\n    };\n  }\n  /**\n   * Same function object as the initial value of the entries method.\n   */\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  /**\n   * Returns a new Iterator object that contains the keys for each element.\n   */\n  keys() {\n    return this._map.keys();\n  }\n  /**\n   * Returns a new Iterator object that contains the values for each element.\n   */\n  values() {\n    const innerIterator = this._map.values();\n    return {\n      [Symbol.iterator]() {\n        return this;\n      },\n      next() {\n        const iteratorValue = innerIterator.next();\n        if (iteratorValue.done) {\n          return {\n            done: true,\n            value: void 0\n          };\n        }\n        const value = liveNodeToLson(iteratorValue.value);\n        return { value };\n      }\n    };\n  }\n  /**\n   * Executes a provided function once per each key/value pair in the Map object, in insertion order.\n   * @param callback Function to execute for each entry in the map.\n   */\n  forEach(callback) {\n    for (const entry of this) {\n      callback(entry[1], entry[0], this);\n    }\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"LiveMap\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: Array.from(this._map.entries()).map(\n        ([key2, val]) => val.toTreeNode(key2)\n      )\n    };\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = /* @__PURE__ */ new Map();\n    for (const [key, value] of this._map) {\n      result.set(key, value.toImmutable());\n    }\n    return freeze(result);\n  }\n  clone() {\n    return new _LiveMap(\n      Array.from(this._map).map(([key, node]) => [key, node.clone()])\n    );\n  }\n};\n\n// src/crdts/LiveObject.ts\nvar LiveObject = class _LiveObject extends AbstractCrdt {\n  /** @internal */\n  static _buildRootAndParentToChildren(items) {\n    const parentToChildren = /* @__PURE__ */ new Map();\n    let root = null;\n    for (const [id, crdt] of items) {\n      if (isRootCrdt(crdt)) {\n        root = [id, crdt];\n      } else {\n        const tuple = [id, crdt];\n        const children = parentToChildren.get(crdt.parentId);\n        if (children !== void 0) {\n          children.push(tuple);\n        } else {\n          parentToChildren.set(crdt.parentId, [tuple]);\n        }\n      }\n    }\n    if (root === null) {\n      throw new Error(\"Root can't be null\");\n    }\n    return [root, parentToChildren];\n  }\n  /** @internal */\n  static _fromItems(items, pool) {\n    const [root, parentToChildren] = _LiveObject._buildRootAndParentToChildren(items);\n    return _LiveObject._deserialize(\n      root,\n      parentToChildren,\n      pool\n    );\n  }\n  constructor(obj = {}) {\n    super();\n    this._propToLastUpdate = /* @__PURE__ */ new Map();\n    const o = compactObject(obj);\n    for (const key of Object.keys(o)) {\n      const value = o[key];\n      if (isLiveNode(value)) {\n        value._setParentLink(this, key);\n      }\n    }\n    this._map = new Map(Object.entries(o));\n  }\n  /** @internal */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const opId = pool?.generateOpId();\n    const ops = [];\n    const op = {\n      type: 4 /* CREATE_OBJECT */,\n      id: this._id,\n      opId,\n      parentId,\n      parentKey,\n      data: {}\n    };\n    ops.push(op);\n    for (const [key, value] of this._map) {\n      if (isLiveNode(value)) {\n        ops.push(...value._toOps(this._id, key, pool));\n      } else {\n        op.data[key] = value;\n      }\n    }\n    return ops;\n  }\n  /** @internal */\n  static _deserialize([id, item], parentToChildren, pool) {\n    const liveObj = new _LiveObject(item.data);\n    liveObj._attach(id, pool);\n    return this._deserializeChildren(liveObj, parentToChildren, pool);\n  }\n  /** @internal */\n  static _deserializeChildren(liveObj, parentToChildren, pool) {\n    const children = parentToChildren.get(nn(liveObj._id));\n    if (children === void 0) {\n      return liveObj;\n    }\n    for (const [id, crdt] of children) {\n      const child = deserializeToLson([id, crdt], parentToChildren, pool);\n      if (isLiveStructure(child)) {\n        child._setParentLink(liveObj, crdt.parentKey);\n      }\n      liveObj._map.set(crdt.parentKey, child);\n      liveObj.invalidate();\n    }\n    return liveObj;\n  }\n  /** @internal */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const [_key, value] of this._map) {\n      if (isLiveNode(value)) {\n        value._attach(pool.generateId(), pool);\n      }\n    }\n  }\n  /** @internal */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, opId, parentKey: key } = op;\n    const child = creationOpToLson(op);\n    if (this._pool.getNode(id) !== void 0) {\n      if (this._propToLastUpdate.get(key) === opId) {\n        this._propToLastUpdate.delete(key);\n      }\n      return { modified: false };\n    }\n    if (source === 0 /* UNDOREDO_RECONNECT */) {\n      this._propToLastUpdate.set(key, nn(opId));\n    } else if (this._propToLastUpdate.get(key) === void 0) {\n    } else if (this._propToLastUpdate.get(key) === opId) {\n      this._propToLastUpdate.delete(key);\n      return { modified: false };\n    } else {\n      return { modified: false };\n    }\n    const thisId = nn(this._id);\n    const previousValue = this._map.get(key);\n    let reverse;\n    if (isLiveNode(previousValue)) {\n      reverse = previousValue._toOps(thisId, key);\n      previousValue._detach();\n    } else if (previousValue === void 0) {\n      reverse = [{ type: 6 /* DELETE_OBJECT_KEY */, id: thisId, key }];\n    } else {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          id: thisId,\n          data: { [key]: previousValue }\n        }\n      ];\n    }\n    this._map.set(key, child);\n    this.invalidate();\n    if (isLiveStructure(child)) {\n      child._setParentLink(this, key);\n      child._attach(id, this._pool);\n    }\n    return {\n      reverse,\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: { [key]: { type: \"update\" } }\n      }\n    };\n  }\n  /** @internal */\n  _detachChild(child) {\n    if (child) {\n      const id = nn(this._id);\n      const parentKey = nn(child._parentKey);\n      const reverse = child._toOps(id, parentKey, this._pool);\n      for (const [key, value] of this._map) {\n        if (value === child) {\n          this._map.delete(key);\n          this.invalidate();\n        }\n      }\n      child._detach();\n      const storageUpdate = {\n        node: this,\n        type: \"LiveObject\",\n        updates: {\n          [parentKey]: { type: \"delete\" }\n        }\n      };\n      return { modified: storageUpdate, reverse };\n    }\n    return { modified: false };\n  }\n  /**\n   * @internal\n   */\n  _detach() {\n    super._detach();\n    for (const value of this._map.values()) {\n      if (isLiveNode(value)) {\n        value._detach();\n      }\n    }\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    if (op.type === 3 /* UPDATE_OBJECT */) {\n      return this._applyUpdate(op, isLocal);\n    } else if (op.type === 6 /* DELETE_OBJECT_KEY */) {\n      return this._applyDeleteObjectKey(op, isLocal);\n    }\n    return super._apply(op, isLocal);\n  }\n  /**\n   * @internal\n   */\n  _serialize() {\n    const data = {};\n    for (const [key, value] of this._map) {\n      if (!isLiveNode(value)) {\n        data[key] = value;\n      }\n    }\n    if (this.parent.type === \"HasParent\" && this.parent.node._id) {\n      return {\n        type: 0 /* OBJECT */,\n        parentId: this.parent.node._id,\n        parentKey: this.parent.key,\n        data\n      };\n    } else {\n      return {\n        type: 0 /* OBJECT */,\n        data\n      };\n    }\n  }\n  /** @internal */\n  _applyUpdate(op, isLocal) {\n    let isModified = false;\n    const id = nn(this._id);\n    const reverse = [];\n    const reverseUpdate = {\n      type: 3 /* UPDATE_OBJECT */,\n      id,\n      data: {}\n    };\n    for (const key in op.data) {\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        reverse.push(...oldValue._toOps(id, key));\n        oldValue._detach();\n      } else if (oldValue !== void 0) {\n        reverseUpdate.data[key] = oldValue;\n      } else if (oldValue === void 0) {\n        reverse.push({ type: 6 /* DELETE_OBJECT_KEY */, id, key });\n      }\n    }\n    const updateDelta = {};\n    for (const key in op.data) {\n      const value = op.data[key];\n      if (value === void 0) {\n        continue;\n      }\n      if (isLocal) {\n        this._propToLastUpdate.set(key, nn(op.opId));\n      } else if (this._propToLastUpdate.get(key) === void 0) {\n        isModified = true;\n      } else if (this._propToLastUpdate.get(key) === op.opId) {\n        this._propToLastUpdate.delete(key);\n        continue;\n      } else {\n        continue;\n      }\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        oldValue._detach();\n      }\n      isModified = true;\n      updateDelta[key] = { type: \"update\" };\n      this._map.set(key, value);\n      this.invalidate();\n    }\n    if (Object.keys(reverseUpdate.data).length !== 0) {\n      reverse.unshift(reverseUpdate);\n    }\n    return isModified ? {\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: updateDelta\n      },\n      reverse\n    } : { modified: false };\n  }\n  /** @internal */\n  _applyDeleteObjectKey(op, isLocal) {\n    const key = op.key;\n    if (this._map.has(key) === false) {\n      return { modified: false };\n    }\n    if (!isLocal && this._propToLastUpdate.get(key) !== void 0) {\n      return { modified: false };\n    }\n    const oldValue = this._map.get(key);\n    const id = nn(this._id);\n    let reverse = [];\n    if (isLiveNode(oldValue)) {\n      reverse = oldValue._toOps(id, op.key);\n      oldValue._detach();\n    } else if (oldValue !== void 0) {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          id,\n          data: { [key]: oldValue }\n        }\n      ];\n    }\n    this._map.delete(key);\n    this.invalidate();\n    return {\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: { [op.key]: { type: \"delete\" } }\n      },\n      reverse\n    };\n  }\n  /**\n   * Transform the LiveObject into a javascript object\n   */\n  toObject() {\n    return Object.fromEntries(this._map);\n  }\n  /**\n   * Adds or updates a property with a specified key and a value.\n   * @param key The key of the property to add\n   * @param value The value of the property to add\n   */\n  set(key, value) {\n    this._pool?.assertStorageIsWritable();\n    this.update({ [key]: value });\n  }\n  /**\n   * Returns a specified property from the LiveObject.\n   * @param key The key of the property to get\n   */\n  get(key) {\n    return this._map.get(key);\n  }\n  /**\n   * Deletes a key from the LiveObject\n   * @param key The key of the property to delete\n   */\n  delete(key) {\n    this._pool?.assertStorageIsWritable();\n    const keyAsString = key;\n    const oldValue = this._map.get(keyAsString);\n    if (oldValue === void 0) {\n      return;\n    }\n    if (this._pool === void 0 || this._id === void 0) {\n      if (isLiveNode(oldValue)) {\n        oldValue._detach();\n      }\n      this._map.delete(keyAsString);\n      this.invalidate();\n      return;\n    }\n    let reverse;\n    if (isLiveNode(oldValue)) {\n      oldValue._detach();\n      reverse = oldValue._toOps(this._id, keyAsString);\n    } else {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          data: { [keyAsString]: oldValue },\n          id: this._id\n        }\n      ];\n    }\n    this._map.delete(keyAsString);\n    this.invalidate();\n    const storageUpdates = /* @__PURE__ */ new Map();\n    storageUpdates.set(this._id, {\n      node: this,\n      type: \"LiveObject\",\n      updates: { [key]: { type: \"delete\" } }\n    });\n    this._pool.dispatch(\n      [\n        {\n          type: 6 /* DELETE_OBJECT_KEY */,\n          key: keyAsString,\n          id: this._id,\n          opId: this._pool.generateOpId()\n        }\n      ],\n      reverse,\n      storageUpdates\n    );\n  }\n  /**\n   * Adds or updates multiple properties at once with an object.\n   * @param patch The object used to overrides properties\n   */\n  update(patch) {\n    this._pool?.assertStorageIsWritable();\n    if (this._pool === void 0 || this._id === void 0) {\n      for (const key in patch) {\n        const newValue = patch[key];\n        if (newValue === void 0) {\n          continue;\n        }\n        const oldValue = this._map.get(key);\n        if (isLiveNode(oldValue)) {\n          oldValue._detach();\n        }\n        if (isLiveNode(newValue)) {\n          newValue._setParentLink(this, key);\n        }\n        this._map.set(key, newValue);\n        this.invalidate();\n      }\n      return;\n    }\n    const ops = [];\n    const reverseOps = [];\n    const opId = this._pool.generateOpId();\n    const updatedProps = {};\n    const reverseUpdateOp = {\n      id: this._id,\n      type: 3 /* UPDATE_OBJECT */,\n      data: {}\n    };\n    const updateDelta = {};\n    for (const key in patch) {\n      const newValue = patch[key];\n      if (newValue === void 0) {\n        continue;\n      }\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        reverseOps.push(...oldValue._toOps(this._id, key));\n        oldValue._detach();\n      } else if (oldValue === void 0) {\n        reverseOps.push({ type: 6 /* DELETE_OBJECT_KEY */, id: this._id, key });\n      } else {\n        reverseUpdateOp.data[key] = oldValue;\n      }\n      if (isLiveNode(newValue)) {\n        newValue._setParentLink(this, key);\n        newValue._attach(this._pool.generateId(), this._pool);\n        const newAttachChildOps = newValue._toOps(this._id, key, this._pool);\n        const createCrdtOp = newAttachChildOps.find(\n          (op) => op.parentId === this._id\n        );\n        if (createCrdtOp) {\n          this._propToLastUpdate.set(key, nn(createCrdtOp.opId));\n        }\n        ops.push(...newAttachChildOps);\n      } else {\n        updatedProps[key] = newValue;\n        this._propToLastUpdate.set(key, opId);\n      }\n      this._map.set(key, newValue);\n      this.invalidate();\n      updateDelta[key] = { type: \"update\" };\n    }\n    if (Object.keys(reverseUpdateOp.data).length !== 0) {\n      reverseOps.unshift(reverseUpdateOp);\n    }\n    if (Object.keys(updatedProps).length !== 0) {\n      ops.unshift({\n        opId,\n        id: this._id,\n        type: 3 /* UPDATE_OBJECT */,\n        data: updatedProps\n      });\n    }\n    const storageUpdates = /* @__PURE__ */ new Map();\n    storageUpdates.set(this._id, {\n      node: this,\n      type: \"LiveObject\",\n      updates: updateDelta\n    });\n    this._pool.dispatch(ops, reverseOps, storageUpdates);\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  toTreeNode(key) {\n    return super.toTreeNode(key);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    const nodeId = this._id ?? nanoid();\n    return {\n      type: \"LiveObject\",\n      id: nodeId,\n      key,\n      payload: Array.from(this._map.entries()).map(\n        ([key2, value]) => isLiveNode(value) ? value.toTreeNode(key2) : { type: \"Json\", id: `${nodeId}:${key2}`, key: key2, payload: value }\n      )\n    };\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = {};\n    for (const [key, val] of this._map) {\n      result[key] = isLiveStructure(val) ? val.toImmutable() : val;\n    }\n    return  false ? 0 : Object.freeze(result);\n  }\n  clone() {\n    return new _LiveObject(\n      Object.fromEntries(\n        Array.from(this._map).map(([key, value]) => [\n          key,\n          isLiveStructure(value) ? value.clone() : deepClone(value)\n        ])\n      )\n    );\n  }\n};\n\n// src/crdts/liveblocks-helpers.ts\nfunction creationOpToLiveNode(op) {\n  return lsonToLiveNode(creationOpToLson(op));\n}\nfunction creationOpToLson(op) {\n  switch (op.type) {\n    case 8 /* CREATE_REGISTER */:\n      return op.data;\n    case 4 /* CREATE_OBJECT */:\n      return new LiveObject(op.data);\n    case 7 /* CREATE_MAP */:\n      return new LiveMap();\n    case 2 /* CREATE_LIST */:\n      return new LiveList([]);\n    default:\n      return assertNever(op, \"Unknown creation Op\");\n  }\n}\nfunction isSameNodeOrChildOf(node, parent) {\n  if (node === parent) {\n    return true;\n  }\n  if (node.parent.type === \"HasParent\") {\n    return isSameNodeOrChildOf(node.parent.node, parent);\n  }\n  return false;\n}\nfunction deserialize([id, crdt], parentToChildren, pool) {\n  switch (crdt.type) {\n    case 0 /* OBJECT */: {\n      return LiveObject._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 1 /* LIST */: {\n      return LiveList._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 2 /* MAP */: {\n      return LiveMap._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 3 /* REGISTER */: {\n      return LiveRegister._deserialize([id, crdt], parentToChildren, pool);\n    }\n    default: {\n      throw new Error(\"Unexpected CRDT type\");\n    }\n  }\n}\nfunction deserializeToLson([id, crdt], parentToChildren, pool) {\n  switch (crdt.type) {\n    case 0 /* OBJECT */: {\n      return LiveObject._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 1 /* LIST */: {\n      return LiveList._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 2 /* MAP */: {\n      return LiveMap._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 3 /* REGISTER */: {\n      return crdt.data;\n    }\n    default: {\n      throw new Error(\"Unexpected CRDT type\");\n    }\n  }\n}\nfunction isLiveStructure(value) {\n  return isLiveList(value) || isLiveMap(value) || isLiveObject(value);\n}\nfunction isLiveNode(value) {\n  return isLiveStructure(value) || isLiveRegister(value);\n}\nfunction isLiveList(value) {\n  return value instanceof LiveList;\n}\nfunction isLiveMap(value) {\n  return value instanceof LiveMap;\n}\nfunction isLiveObject(value) {\n  return value instanceof LiveObject;\n}\nfunction isLiveRegister(value) {\n  return value instanceof LiveRegister;\n}\nfunction cloneLson(value) {\n  return value === void 0 ? void 0 : isLiveStructure(value) ? value.clone() : deepClone(value);\n}\nfunction liveNodeToLson(obj) {\n  if (obj instanceof LiveRegister) {\n    return obj.data;\n  } else if (obj instanceof LiveList || obj instanceof LiveMap || obj instanceof LiveObject) {\n    return obj;\n  } else {\n    return assertNever(obj, \"Unknown AbstractCrdt\");\n  }\n}\nfunction lsonToLiveNode(value) {\n  if (value instanceof LiveObject || value instanceof LiveMap || value instanceof LiveList) {\n    return value;\n  } else {\n    return new LiveRegister(value);\n  }\n}\nfunction getTreesDiffOperations(currentItems, newItems) {\n  const ops = [];\n  currentItems.forEach((_, id) => {\n    if (!newItems.get(id)) {\n      ops.push({\n        type: 5 /* DELETE_CRDT */,\n        id\n      });\n    }\n  });\n  newItems.forEach((crdt, id) => {\n    const currentCrdt = currentItems.get(id);\n    if (currentCrdt) {\n      if (crdt.type === 0 /* OBJECT */) {\n        if (currentCrdt.type !== 0 /* OBJECT */ || JSON.stringify(crdt.data) !== JSON.stringify(currentCrdt.data)) {\n          ops.push({\n            type: 3 /* UPDATE_OBJECT */,\n            id,\n            data: crdt.data\n          });\n        }\n      }\n      if (crdt.parentKey !== currentCrdt.parentKey) {\n        ops.push({\n          type: 1 /* SET_PARENT_KEY */,\n          id,\n          parentKey: nn(crdt.parentKey, \"Parent key must not be missing\")\n        });\n      }\n    } else {\n      switch (crdt.type) {\n        case 3 /* REGISTER */:\n          ops.push({\n            type: 8 /* CREATE_REGISTER */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey,\n            data: crdt.data\n          });\n          break;\n        case 1 /* LIST */:\n          ops.push({\n            type: 2 /* CREATE_LIST */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey\n          });\n          break;\n        case 0 /* OBJECT */:\n          if (crdt.parentId === void 0 || crdt.parentKey === void 0) {\n            throw new Error(\n              \"Internal error. Cannot serialize storage root into an operation\"\n            );\n          }\n          ops.push({\n            type: 4 /* CREATE_OBJECT */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey,\n            data: crdt.data\n          });\n          break;\n        case 2 /* MAP */:\n          ops.push({\n            type: 7 /* CREATE_MAP */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey\n          });\n          break;\n      }\n    }\n  });\n  return ops;\n}\nfunction mergeObjectStorageUpdates(first, second) {\n  const updates = first.updates;\n  for (const [key, value] of entries(second.updates)) {\n    updates[key] = value;\n  }\n  return {\n    ...second,\n    updates\n  };\n}\nfunction mergeMapStorageUpdates(first, second) {\n  const updates = first.updates;\n  for (const [key, value] of entries(second.updates)) {\n    updates[key] = value;\n  }\n  return {\n    ...second,\n    updates\n  };\n}\nfunction mergeListStorageUpdates(first, second) {\n  const updates = first.updates;\n  return {\n    ...second,\n    updates: updates.concat(second.updates)\n  };\n}\nfunction mergeStorageUpdates(first, second) {\n  if (first === void 0) {\n    return second;\n  }\n  if (first.type === \"LiveObject\" && second.type === \"LiveObject\") {\n    return mergeObjectStorageUpdates(first, second);\n  } else if (first.type === \"LiveMap\" && second.type === \"LiveMap\") {\n    return mergeMapStorageUpdates(first, second);\n  } else if (first.type === \"LiveList\" && second.type === \"LiveList\") {\n    return mergeListStorageUpdates(first, second);\n  } else {\n  }\n  return second;\n}\nfunction isPlain(value) {\n  const type = typeof value;\n  return value === void 0 || value === null || type === \"string\" || type === \"boolean\" || type === \"number\" || Array.isArray(value) || isPlainObject(value);\n}\nfunction findNonSerializableValue(value, path = \"\") {\n  if (!isPlain) {\n    return {\n      path: path || \"root\",\n      value\n    };\n  }\n  if (typeof value !== \"object\" || value === null) {\n    return false;\n  }\n  for (const [key, nestedValue] of Object.entries(value)) {\n    const nestedPath = path ? path + \".\" + key : key;\n    if (!isPlain(nestedValue)) {\n      return {\n        path: nestedPath,\n        value: nestedValue\n      };\n    }\n    if (typeof nestedValue === \"object\") {\n      const nonSerializableNestedValue = findNonSerializableValue(\n        nestedValue,\n        nestedPath\n      );\n      if (nonSerializableNestedValue) {\n        return nonSerializableNestedValue;\n      }\n    }\n  }\n  return false;\n}\n\n// src/lib/createIds.ts\nvar THREAD_ID_PREFIX = \"th\";\nvar COMMENT_ID_PREFIX = \"cm\";\nvar INBOX_NOTIFICATION_ID_PREFIX = \"in\";\nfunction createOptimisticId(prefix) {\n  return `${prefix}_${nanoid()}`;\n}\nfunction createThreadId() {\n  return createOptimisticId(THREAD_ID_PREFIX);\n}\nfunction createCommentId() {\n  return createOptimisticId(COMMENT_ID_PREFIX);\n}\nfunction createInboxNotificationId() {\n  return createOptimisticId(INBOX_NOTIFICATION_ID_PREFIX);\n}\n\n// src/lib/debug.ts\nfunction captureStackTrace(msg, traceRoot) {\n  const errorLike = { name: msg };\n  if (typeof Error.captureStackTrace !== \"function\") {\n    return void 0;\n  }\n  Error.captureStackTrace(errorLike, traceRoot);\n  return errorLike.stack;\n}\n\n// src/lib/Json.ts\nfunction isJsonScalar(data) {\n  return data === null || typeof data === \"string\" || typeof data === \"number\" || typeof data === \"boolean\";\n}\nfunction isJsonArray(data) {\n  return Array.isArray(data);\n}\nfunction isJsonObject(data) {\n  return !isJsonScalar(data) && !isJsonArray(data);\n}\n\n// src/lib/objectToQuery.ts\nvar identifierRegex = /^[a-zA-Z_][a-zA-Z0-9_]*$/;\nfunction objectToQuery(obj) {\n  let filterList = [];\n  const entries2 = Object.entries(obj);\n  const keyValuePairs = [];\n  const keyValuePairsWithOperator = [];\n  const indexedKeys = [];\n  entries2.forEach(([key, value]) => {\n    if (!identifierRegex.test(key)) {\n      throw new Error(\"Key must only contain letters, numbers, _\");\n    }\n    if (isSimpleValue(value)) {\n      keyValuePairs.push([key, value]);\n    } else if (isValueWithOperator(value)) {\n      keyValuePairsWithOperator.push([key, value]);\n    } else if (typeof value === \"object\" && !(\"startsWith\" in value)) {\n      indexedKeys.push([key, value]);\n    }\n  });\n  filterList = [\n    ...getFiltersFromKeyValuePairs(keyValuePairs),\n    ...getFiltersFromKeyValuePairsWithOperator(keyValuePairsWithOperator)\n  ];\n  indexedKeys.forEach(([key, value]) => {\n    const nestedEntries = Object.entries(value);\n    const nKeyValuePairs = [];\n    const nKeyValuePairsWithOperator = [];\n    nestedEntries.forEach(([nestedKey, nestedValue]) => {\n      if (isStringEmpty(nestedKey)) {\n        throw new Error(\"Key cannot be empty\");\n      }\n      if (isSimpleValue(nestedValue)) {\n        nKeyValuePairs.push([formatFilterKey(key, nestedKey), nestedValue]);\n      } else if (isValueWithOperator(nestedValue)) {\n        nKeyValuePairsWithOperator.push([\n          formatFilterKey(key, nestedKey),\n          nestedValue\n        ]);\n      }\n    });\n    filterList = [\n      ...filterList,\n      ...getFiltersFromKeyValuePairs(nKeyValuePairs),\n      ...getFiltersFromKeyValuePairsWithOperator(nKeyValuePairsWithOperator)\n    ];\n  });\n  return filterList.map(\n    ({ key, operator, value }) => formatFilter(key, operator, formatFilterValue(value))\n  ).join(\" AND \");\n}\nvar getFiltersFromKeyValuePairs = (keyValuePairs) => {\n  const filters = [];\n  keyValuePairs.forEach(([key, value]) => {\n    filters.push({\n      key,\n      operator: \":\",\n      value\n    });\n  });\n  return filters;\n};\nvar getFiltersFromKeyValuePairsWithOperator = (keyValuePairsWithOperator) => {\n  const filters = [];\n  keyValuePairsWithOperator.forEach(([key, value]) => {\n    if (\"startsWith\" in value && typeof value.startsWith === \"string\") {\n      filters.push({\n        key,\n        operator: \"^\",\n        value: value.startsWith\n      });\n    }\n  });\n  return filters;\n};\nvar isSimpleValue = (value) => {\n  if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\n    return true;\n  }\n  return false;\n};\nvar isValueWithOperator = (value) => {\n  if (typeof value === \"object\" && value !== null && \"startsWith\" in value) {\n    return true;\n  }\n  return false;\n};\nvar formatFilter = (key, operator, value) => {\n  return `${key}${operator}${value}`;\n};\nvar formatFilterKey = (key, nestedKey) => {\n  if (nestedKey) {\n    return `${key}[${JSON.stringify(nestedKey)}]`;\n  }\n  return key;\n};\nvar formatFilterValue = (value) => {\n  if (typeof value === \"string\") {\n    if (isStringEmpty(value)) {\n      throw new Error(\"Value cannot be empty\");\n    }\n    return JSON.stringify(value);\n  }\n  return value.toString();\n};\nvar isStringEmpty = (value) => {\n  return !value || value.toString().trim() === \"\";\n};\n\n// src/protocol/ClientMsg.ts\nvar ClientMsgCode = /* @__PURE__ */ ((ClientMsgCode2) => {\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_PRESENCE\"] = 100] = \"UPDATE_PRESENCE\";\n  ClientMsgCode2[ClientMsgCode2[\"BROADCAST_EVENT\"] = 103] = \"BROADCAST_EVENT\";\n  ClientMsgCode2[ClientMsgCode2[\"FETCH_STORAGE\"] = 200] = \"FETCH_STORAGE\";\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_STORAGE\"] = 201] = \"UPDATE_STORAGE\";\n  ClientMsgCode2[ClientMsgCode2[\"FETCH_YDOC\"] = 300] = \"FETCH_YDOC\";\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_YDOC\"] = 301] = \"UPDATE_YDOC\";\n  return ClientMsgCode2;\n})(ClientMsgCode || {});\n\n// src/refs/ImmutableRef.ts\nfunction merge(target, patch) {\n  let updated = false;\n  const newValue = { ...target };\n  Object.keys(patch).forEach((k) => {\n    const key = k;\n    const val = patch[key];\n    if (newValue[key] !== val) {\n      if (val === void 0) {\n        delete newValue[key];\n      } else {\n        newValue[key] = val;\n      }\n      updated = true;\n    }\n  });\n  return updated ? newValue : target;\n}\nvar ImmutableRef = class {\n  constructor() {\n    this._ev = makeEventSource();\n  }\n  get didInvalidate() {\n    return this._ev.observable;\n  }\n  invalidate() {\n    if (this._cache !== void 0) {\n      this._cache = void 0;\n      this._ev.notify();\n    }\n  }\n  get current() {\n    return this._cache ?? (this._cache = this._toImmutable());\n  }\n};\n\n// src/refs/OthersRef.ts\nfunction makeUser(conn, presence) {\n  const { connectionId, id, info } = conn;\n  const canWrite = canWriteStorage(conn.scopes);\n  return freeze(\n    compactObject({\n      connectionId,\n      id,\n      info,\n      canWrite,\n      canComment: canComment(conn.scopes),\n      isReadOnly: !canWrite,\n      // Deprecated, kept for backward-compatibility\n      presence\n    })\n  );\n}\nvar OthersRef = class extends ImmutableRef {\n  //\n  // --------------------------------------------------------------\n  //\n  constructor() {\n    super();\n    this._connections = /* @__PURE__ */ new Map();\n    this._presences = /* @__PURE__ */ new Map();\n    this._users = /* @__PURE__ */ new Map();\n  }\n  connectionIds() {\n    return this._connections.keys();\n  }\n  /** @internal */\n  _toImmutable() {\n    const users = compact(\n      Array.from(this._presences.keys()).map(\n        (connectionId) => this.getUser(Number(connectionId))\n      )\n    );\n    return users;\n  }\n  clearOthers() {\n    this._connections = /* @__PURE__ */ new Map();\n    this._presences = /* @__PURE__ */ new Map();\n    this._users = /* @__PURE__ */ new Map();\n    this.invalidate();\n  }\n  /** @internal */\n  _getUser(connectionId) {\n    const conn = this._connections.get(connectionId);\n    const presence = this._presences.get(connectionId);\n    if (conn !== void 0 && presence !== void 0) {\n      return makeUser(conn, presence);\n    }\n    return void 0;\n  }\n  getUser(connectionId) {\n    const cachedUser = this._users.get(connectionId);\n    if (cachedUser) {\n      return cachedUser;\n    }\n    const computedUser = this._getUser(connectionId);\n    if (computedUser) {\n      this._users.set(connectionId, computedUser);\n      return computedUser;\n    }\n    return void 0;\n  }\n  /** @internal */\n  _invalidateUser(connectionId) {\n    if (this._users.has(connectionId)) {\n      this._users.delete(connectionId);\n    }\n    this.invalidate();\n  }\n  /**\n   * Records a known connection. This records the connection ID and the\n   * associated metadata.\n   */\n  setConnection(connectionId, metaUserId, metaUserInfo, scopes) {\n    this._connections.set(\n      connectionId,\n      freeze({\n        connectionId,\n        id: metaUserId,\n        info: metaUserInfo,\n        scopes\n      })\n    );\n    if (this._presences.has(connectionId)) {\n      this._invalidateUser(connectionId);\n    }\n  }\n  /**\n   * Removes a known connectionId. Removes both the connection's metadata and\n   * the presence information.\n   */\n  removeConnection(connectionId) {\n    this._connections.delete(connectionId);\n    this._presences.delete(connectionId);\n    this._invalidateUser(connectionId);\n  }\n  /**\n   * Stores a new user from a full presence update. If the user already exists,\n   * its known presence data is overwritten.\n   */\n  setOther(connectionId, presence) {\n    this._presences.set(connectionId, freeze(compactObject(presence)));\n    if (this._connections.has(connectionId)) {\n      this._invalidateUser(connectionId);\n    }\n  }\n  /**\n   * Patches the presence data for an existing \"other\". If we don't know the\n   * initial presence data for this user yet, discard this patch and await the\n   * full .setOther() call first.\n   */\n  patchOther(connectionId, patch) {\n    const oldPresence = this._presences.get(connectionId);\n    if (oldPresence === void 0) {\n      return;\n    }\n    const newPresence = merge(oldPresence, patch);\n    if (oldPresence !== newPresence) {\n      this._presences.set(connectionId, freeze(newPresence));\n      this._invalidateUser(connectionId);\n    }\n  }\n};\n\n// src/refs/PatchableRef.ts\nvar PatchableRef = class extends ImmutableRef {\n  constructor(data) {\n    super();\n    this._data = freeze(compactObject(data));\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._data;\n  }\n  /**\n   * Patches the current object.\n   */\n  patch(patch) {\n    const oldData = this._data;\n    const newData = merge(oldData, patch);\n    if (oldData !== newData) {\n      this._data = freeze(newData);\n      this.invalidate();\n    }\n  }\n};\n\n// src/refs/ValueRef.ts\nvar ValueRef = class extends ImmutableRef {\n  constructor(initialValue) {\n    super();\n    this._value = freeze(initialValue);\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._value;\n  }\n  set(newValue) {\n    this._value = freeze(newValue);\n    this.invalidate();\n  }\n};\nvar DerivedRef = class extends ImmutableRef {\n  constructor(...args) {\n    super();\n    const transformFn = args.pop();\n    const otherRefs = args;\n    this._refs = otherRefs;\n    this._refs.forEach((ref) => {\n      ref.didInvalidate.subscribe(() => this.invalidate());\n    });\n    this._transform = transformFn;\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._transform(\n      ...this._refs.map((ref) => ref.current)\n    );\n  }\n};\n\n// src/room.ts\nvar MAX_SOCKET_MESSAGE_SIZE = 1024 * 1024 - 1024;\nfunction makeIdFactory(connectionId) {\n  let count = 0;\n  return () => `${connectionId}:${count++}`;\n}\nfunction userToTreeNode(key, user) {\n  return {\n    type: \"User\",\n    id: `${user.connectionId}`,\n    key,\n    payload: {\n      connectionId: user.connectionId,\n      id: user.id,\n      info: user.info,\n      presence: user.presence,\n      isReadOnly: !user.canWrite\n    }\n  };\n}\nfunction installBackgroundTabSpy() {\n  const doc = typeof document !== \"undefined\" ? document : void 0;\n  const inBackgroundSince = { current: null };\n  function onVisibilityChange() {\n    if (doc?.visibilityState === \"hidden\") {\n      inBackgroundSince.current = inBackgroundSince.current ?? Date.now();\n    } else {\n      inBackgroundSince.current = null;\n    }\n  }\n  doc?.addEventListener(\"visibilitychange\", onVisibilityChange);\n  const unsub = () => {\n    doc?.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  };\n  return [inBackgroundSince, unsub];\n}\nvar CommentsApiError = class extends Error {\n  constructor(message, status, details) {\n    super(message);\n    this.message = message;\n    this.status = status;\n    this.details = details;\n  }\n};\nfunction createCommentsApi(roomId, getAuthValue, fetchClientApi) {\n  async function fetchCommentsApi(endpoint, params, options) {\n    const authValue = await getAuthValue();\n    return fetchClientApi(roomId, endpoint, authValue, options, params);\n  }\n  async function fetchJson(endpoint, options, params) {\n    const response = await fetchCommentsApi(endpoint, params, options);\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new CommentsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new CommentsApiError(response.statusText, response.status);\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  async function getThreadsSince(options) {\n    const response = await fetchCommentsApi(\n      \"/threads\",\n      {\n        since: options?.since?.toISOString()\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        threads: {\n          updated: json.data.map(convertToThreadData),\n          deleted: json.deletedThreads.map(convertToThreadDeleteInfo)\n        },\n        inboxNotifications: {\n          updated: json.inboxNotifications.map(convertToInboxNotificationData),\n          deleted: json.deletedInboxNotifications.map(\n            convertToInboxNotificationDeleteInfo\n          )\n        },\n        requestedAt: new Date(json.meta.requestedAt)\n      };\n    } else if (response.status === 404) {\n      return {\n        threads: {\n          updated: [],\n          deleted: []\n        },\n        inboxNotifications: {\n          updated: [],\n          deleted: []\n        },\n        requestedAt: /* @__PURE__ */ new Date()\n      };\n    } else {\n      throw new Error(\"There was an error while getting threads.\");\n    }\n  }\n  async function getThreads(options) {\n    let query;\n    if (options?.query) {\n      query = objectToQuery(options.query);\n    }\n    const response = await fetchCommentsApi(\n      \"/threads\",\n      {\n        query\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        threads: json.data.map(convertToThreadData),\n        inboxNotifications: json.inboxNotifications.map(\n          convertToInboxNotificationData\n        ),\n        requestedAt: new Date(json.meta.requestedAt)\n      };\n    } else if (response.status === 404) {\n      return {\n        threads: [],\n        inboxNotifications: [],\n        deletedThreads: [],\n        deletedInboxNotifications: [],\n        requestedAt: /* @__PURE__ */ new Date()\n      };\n    } else {\n      throw new Error(\"There was an error while getting threads.\");\n    }\n  }\n  async function getThread(threadId) {\n    const response = await fetchCommentsApi(\n      `/thread-with-notification/${threadId}`\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        thread: convertToThreadData(json.thread),\n        inboxNotification: json.inboxNotification ? convertToInboxNotificationData(json.inboxNotification) : void 0\n      };\n    } else if (response.status === 404) {\n      return {\n        thread: void 0,\n        inboxNotification: void 0\n      };\n    } else {\n      throw new Error(`There was an error while getting thread ${threadId}.`);\n    }\n  }\n  async function createThread({\n    metadata,\n    body,\n    commentId = createCommentId(),\n    threadId = createThreadId()\n  }) {\n    const thread = await fetchJson(\"/threads\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: threadId,\n        comment: {\n          id: commentId,\n          body\n        },\n        metadata\n      })\n    });\n    return convertToThreadData(thread);\n  }\n  async function deleteThread(threadId) {\n    await fetchJson(`/threads/${encodeURIComponent(threadId)}`, {\n      method: \"DELETE\"\n    });\n  }\n  async function editThreadMetadata({\n    metadata,\n    threadId\n  }) {\n    return await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/metadata`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(metadata)\n      }\n    );\n  }\n  async function markThreadAsResolved(threadId) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/mark-as-resolved`,\n      {\n        method: \"POST\"\n      }\n    );\n  }\n  async function markThreadAsUnresolved(threadId) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/mark-as-unresolved`,\n      {\n        method: \"POST\"\n      }\n    );\n  }\n  async function createComment({\n    threadId,\n    commentId = createCommentId(),\n    body\n  }) {\n    const comment = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          id: commentId,\n          body\n        })\n      }\n    );\n    return convertToCommentData(comment);\n  }\n  async function editComment({\n    threadId,\n    commentId,\n    body\n  }) {\n    const comment = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          body\n        })\n      }\n    );\n    return convertToCommentData(comment);\n  }\n  async function deleteComment2({\n    threadId,\n    commentId\n  }) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  async function addReaction2({\n    threadId,\n    commentId,\n    emoji\n  }) {\n    const reaction = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}/reactions`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({ emoji })\n      }\n    );\n    return convertToCommentUserReaction(reaction);\n  }\n  async function removeReaction2({\n    threadId,\n    commentId,\n    emoji\n  }) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}/reactions/${encodeURIComponent(emoji)}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  return {\n    getThreads,\n    getThreadsSince,\n    getThread,\n    createThread,\n    deleteThread,\n    editThreadMetadata,\n    markThreadAsResolved,\n    markThreadAsUnresolved,\n    createComment,\n    editComment,\n    deleteComment: deleteComment2,\n    addReaction: addReaction2,\n    removeReaction: removeReaction2\n  };\n}\nvar MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY2 = 50;\nfunction createRoom(options, config) {\n  const initialPresence = options.initialPresence;\n  const initialStorage = options.initialStorage;\n  const [inBackgroundSince, uninstallBgTabSpy] = installBackgroundTabSpy();\n  const delegates = {\n    ...config.delegates,\n    // A connection is allowed to go into \"zombie state\" only if all of the\n    // following conditions apply:\n    //\n    // - The `backgroundKeepAliveTimeout` client option is configured\n    // - The browser window has been in the background for at least\n    //   `backgroundKeepAliveTimeout` milliseconds\n    // - There are no pending changes\n    //\n    canZombie() {\n      return config.backgroundKeepAliveTimeout !== void 0 && inBackgroundSince.current !== null && Date.now() > inBackgroundSince.current + config.backgroundKeepAliveTimeout && getStorageStatus() !== \"synchronizing\";\n    }\n  };\n  const managedSocket = new ManagedSocket(\n    delegates,\n    config.enableDebugLogging\n  );\n  const context = {\n    buffer: {\n      flushTimerID: void 0,\n      lastFlushedAt: 0,\n      presenceUpdates: (\n        // Queue up the initial presence message as a Full Presence update\n        {\n          type: \"full\",\n          data: initialPresence\n        }\n      ),\n      messages: [],\n      storageOperations: []\n    },\n    staticSessionInfo: new ValueRef(null),\n    dynamicSessionInfo: new ValueRef(null),\n    myPresence: new PatchableRef(initialPresence),\n    others: new OthersRef(),\n    initialStorage,\n    idFactory: null,\n    // Storage\n    clock: 0,\n    opClock: 0,\n    nodes: /* @__PURE__ */ new Map(),\n    root: void 0,\n    undoStack: [],\n    redoStack: [],\n    pausedHistory: null,\n    activeBatch: null,\n    unacknowledgedOps: /* @__PURE__ */ new Map(),\n    // Debug\n    opStackTraces:  true ? /* @__PURE__ */ new Map() : 0\n  };\n  const doNotBatchUpdates = (cb) => cb();\n  const batchUpdates = config.unstable_batchedUpdates ?? doNotBatchUpdates;\n  let lastTokenKey;\n  function onStatusDidChange(newStatus) {\n    const authValue = managedSocket.authValue;\n    if (authValue !== null) {\n      const tokenKey = getAuthBearerHeaderFromAuthValue(authValue);\n      if (tokenKey !== lastTokenKey) {\n        lastTokenKey = tokenKey;\n        if (authValue.type === \"secret\") {\n          const token = authValue.token.parsed;\n          context.staticSessionInfo.set({\n            userId: token.k === \"sec-legacy\" /* SECRET_LEGACY */ ? token.id : token.uid,\n            userInfo: token.k === \"sec-legacy\" /* SECRET_LEGACY */ ? token.info : token.ui\n          });\n        } else {\n          context.staticSessionInfo.set({\n            userId: void 0,\n            userInfo: void 0\n          });\n        }\n      }\n    }\n    batchUpdates(() => {\n      eventHub.status.notify(newStatus);\n      notifySelfChanged(doNotBatchUpdates);\n    });\n  }\n  let _connectionLossTimerId;\n  let _hasLostConnection = false;\n  function handleConnectionLossEvent(newStatus) {\n    if (newStatus === \"reconnecting\") {\n      _connectionLossTimerId = setTimeout(() => {\n        batchUpdates(() => {\n          eventHub.lostConnection.notify(\"lost\");\n          _hasLostConnection = true;\n          context.others.clearOthers();\n          notify({ others: [{ type: \"reset\" }] }, doNotBatchUpdates);\n        });\n      }, config.lostConnectionTimeout);\n    } else {\n      clearTimeout(_connectionLossTimerId);\n      if (_hasLostConnection) {\n        if (newStatus === \"disconnected\") {\n          batchUpdates(() => {\n            eventHub.lostConnection.notify(\"failed\");\n          });\n        } else {\n          batchUpdates(() => {\n            eventHub.lostConnection.notify(\"restored\");\n          });\n        }\n        _hasLostConnection = false;\n      }\n    }\n  }\n  function onDidConnect() {\n    context.buffer.presenceUpdates = {\n      type: \"full\",\n      data: (\n        // Because context.me.current is a readonly object, we'll have to\n        // make a copy here. Otherwise, type errors happen later when\n        // \"patching\" my presence.\n        { ...context.myPresence.current }\n      )\n    };\n    if (_getStorage$ !== null) {\n      refreshStorage({ flush: false });\n    }\n    flushNowOrSoon();\n  }\n  function onDidDisconnect() {\n    clearTimeout(context.buffer.flushTimerID);\n  }\n  managedSocket.events.onMessage.subscribe(handleServerMessage);\n  managedSocket.events.statusDidChange.subscribe(onStatusDidChange);\n  managedSocket.events.statusDidChange.subscribe(handleConnectionLossEvent);\n  managedSocket.events.didConnect.subscribe(onDidConnect);\n  managedSocket.events.didDisconnect.subscribe(onDidDisconnect);\n  managedSocket.events.onLiveblocksError.subscribe((err) => {\n    batchUpdates(() => {\n      if (true) {\n        error2(\n          `Connection to websocket server closed. Reason: ${err.message} (code: ${err.code}).`\n        );\n      }\n      eventHub.error.notify(err);\n    });\n  });\n  const pool = {\n    roomId: config.roomId,\n    getNode: (id) => context.nodes.get(id),\n    addNode: (id, node) => void context.nodes.set(id, node),\n    deleteNode: (id) => void context.nodes.delete(id),\n    generateId: () => `${getConnectionId()}:${context.clock++}`,\n    generateOpId: () => `${getConnectionId()}:${context.opClock++}`,\n    dispatch(ops, reverse, storageUpdates) {\n      const activeBatch = context.activeBatch;\n      if (true) {\n        const stackTrace = captureStackTrace(\"Storage mutation\", this.dispatch);\n        if (stackTrace) {\n          for (const op of ops) {\n            if (op.opId) {\n              nn(context.opStackTraces).set(op.opId, stackTrace);\n            }\n          }\n        }\n      }\n      if (activeBatch) {\n        for (const op of ops) {\n          activeBatch.ops.push(op);\n        }\n        for (const [key, value] of storageUpdates) {\n          activeBatch.updates.storageUpdates.set(\n            key,\n            mergeStorageUpdates(\n              activeBatch.updates.storageUpdates.get(key),\n              value\n            )\n          );\n        }\n        activeBatch.reverseOps.unshift(...reverse);\n      } else {\n        batchUpdates(() => {\n          addToUndoStack(reverse, doNotBatchUpdates);\n          context.redoStack.length = 0;\n          dispatchOps(ops);\n          notify({ storageUpdates }, doNotBatchUpdates);\n        });\n      }\n    },\n    assertStorageIsWritable: () => {\n      const scopes = context.dynamicSessionInfo.current?.scopes;\n      if (scopes === void 0) {\n        return;\n      }\n      const canWrite = canWriteStorage(scopes);\n      if (!canWrite) {\n        throw new Error(\n          \"Cannot write to storage with a read only user, please ensure the user has write permissions\"\n        );\n      }\n    }\n  };\n  const eventHub = {\n    status: makeEventSource(),\n    // New/recommended API\n    lostConnection: makeEventSource(),\n    customEvent: makeEventSource(),\n    self: makeEventSource(),\n    myPresence: makeEventSource(),\n    others: makeEventSource(),\n    error: makeEventSource(),\n    storageBatch: makeEventSource(),\n    history: makeEventSource(),\n    storageDidLoad: makeEventSource(),\n    storageStatus: makeEventSource(),\n    ydoc: makeEventSource(),\n    comments: makeEventSource()\n  };\n  async function fetchClientApi(roomId, endpoint, authValue, options2, params) {\n    const url = urljoin(\n      config.baseUrl,\n      `/v2/c/rooms/${encodeURIComponent(roomId)}${endpoint}`,\n      params\n    );\n    const fetcher = config.polyfills?.fetch || /* istanbul ignore next */\n    fetch;\n    return await fetcher(url, {\n      ...options2,\n      headers: {\n        ...options2?.headers,\n        Authorization: `Bearer ${getAuthBearerHeaderFromAuthValue(authValue)}`\n      }\n    });\n  }\n  async function streamFetch(authValue, roomId) {\n    return fetchClientApi(roomId, \"/storage\", authValue, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  }\n  async function httpPostToRoom(endpoint, body) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(config.roomId, endpoint, managedSocket.authValue, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    });\n  }\n  async function createTextMention(userId, mentionId) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(\n      config.roomId,\n      \"/text-mentions\",\n      managedSocket.authValue,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          userId,\n          mentionId\n        })\n      }\n    );\n  }\n  async function deleteTextMention(mentionId) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(\n      config.roomId,\n      `/text-mentions/${mentionId}`,\n      managedSocket.authValue,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  async function reportTextEditor(type, rootKey) {\n    const authValue = await delegates.authenticate();\n    return fetchClientApi(config.roomId, \"/text-metadata\", authValue, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        type,\n        rootKey\n      })\n    });\n  }\n  function sendMessages(messages) {\n    const serializedPayload = JSON.stringify(messages);\n    const nonce = context.dynamicSessionInfo.current?.nonce;\n    if (config.unstable_fallbackToHTTP && nonce) {\n      const size = new TextEncoder().encode(serializedPayload).length;\n      if (size > MAX_SOCKET_MESSAGE_SIZE) {\n        void httpPostToRoom(\"/send-message\", { nonce, messages }).then(\n          (resp) => {\n            if (!resp.ok && resp.status === 403) {\n              managedSocket.reconnect();\n            }\n          }\n        );\n        warn(\n          \"Message was too large for websockets and sent over HTTP instead\"\n        );\n        return;\n      }\n    }\n    managedSocket.send(serializedPayload);\n  }\n  const self = new DerivedRef(\n    context.staticSessionInfo,\n    context.dynamicSessionInfo,\n    context.myPresence,\n    (staticSession, dynamicSession, myPresence) => {\n      if (staticSession === null || dynamicSession === null) {\n        return null;\n      } else {\n        const canWrite = canWriteStorage(dynamicSession.scopes);\n        return {\n          connectionId: dynamicSession.actor,\n          id: staticSession.userId,\n          info: staticSession.userInfo,\n          presence: myPresence,\n          canWrite,\n          canComment: canComment(dynamicSession.scopes)\n        };\n      }\n    }\n  );\n  let _lastSelf;\n  function notifySelfChanged(batchedUpdatesWrapper) {\n    const currSelf = self.current;\n    if (currSelf !== null && currSelf !== _lastSelf) {\n      batchedUpdatesWrapper(() => {\n        eventHub.self.notify(currSelf);\n      });\n      _lastSelf = currSelf;\n    }\n  }\n  const selfAsTreeNode = new DerivedRef(\n    self,\n    (me) => me !== null ? userToTreeNode(\"Me\", me) : null\n  );\n  function createOrUpdateRootFromMessage(message, batchedUpdatesWrapper) {\n    if (message.items.length === 0) {\n      throw new Error(\"Internal error: cannot load storage without items\");\n    }\n    if (context.root !== void 0) {\n      updateRoot(message.items, batchedUpdatesWrapper);\n    } else {\n      context.root = LiveObject._fromItems(message.items, pool);\n    }\n    const canWrite = self.current?.canWrite ?? true;\n    const stackSizeBefore = context.undoStack.length;\n    for (const key in context.initialStorage) {\n      if (context.root.get(key) === void 0) {\n        if (canWrite) {\n          context.root.set(key, cloneLson(context.initialStorage[key]));\n        } else {\n          warn(\n            `Attempted to populate missing storage key '${key}', but current user has no write access`\n          );\n        }\n      }\n    }\n    context.undoStack.length = stackSizeBefore;\n  }\n  function updateRoot(items, batchedUpdatesWrapper) {\n    if (context.root === void 0) {\n      return;\n    }\n    const currentItems = /* @__PURE__ */ new Map();\n    for (const [id, node] of context.nodes) {\n      currentItems.set(id, node._serialize());\n    }\n    const ops = getTreesDiffOperations(currentItems, new Map(items));\n    const result = applyOps(ops, false);\n    notify(result.updates, batchedUpdatesWrapper);\n  }\n  function _addToRealUndoStack(historyOps, batchedUpdatesWrapper) {\n    if (context.undoStack.length >= 50) {\n      context.undoStack.shift();\n    }\n    context.undoStack.push(historyOps);\n    onHistoryChange(batchedUpdatesWrapper);\n  }\n  function addToUndoStack(historyOps, batchedUpdatesWrapper) {\n    if (context.pausedHistory !== null) {\n      context.pausedHistory.unshift(...historyOps);\n    } else {\n      _addToRealUndoStack(historyOps, batchedUpdatesWrapper);\n    }\n  }\n  function notify(updates, batchedUpdatesWrapper) {\n    const storageUpdates = updates.storageUpdates;\n    const othersUpdates = updates.others;\n    batchedUpdatesWrapper(() => {\n      if (othersUpdates !== void 0 && othersUpdates.length > 0) {\n        const others = context.others.current;\n        for (const event of othersUpdates) {\n          eventHub.others.notify({ ...event, others });\n        }\n      }\n      if (updates.presence ?? false) {\n        notifySelfChanged(doNotBatchUpdates);\n        eventHub.myPresence.notify(context.myPresence.current);\n      }\n      if (storageUpdates !== void 0 && storageUpdates.size > 0) {\n        const updates2 = Array.from(storageUpdates.values());\n        eventHub.storageBatch.notify(updates2);\n      }\n      notifyStorageStatus();\n    });\n  }\n  function getConnectionId() {\n    const info = context.dynamicSessionInfo.current;\n    if (info) {\n      return info.actor;\n    }\n    throw new Error(\n      \"Internal. Tried to get connection id but connection was never open\"\n    );\n  }\n  function applyOps(rawOps, isLocal) {\n    const output = {\n      reverse: [],\n      storageUpdates: /* @__PURE__ */ new Map(),\n      presence: false\n    };\n    const createdNodeIds = /* @__PURE__ */ new Set();\n    const ops = rawOps.map((op) => {\n      if (op.type !== \"presence\" && !op.opId) {\n        return { ...op, opId: pool.generateOpId() };\n      } else {\n        return op;\n      }\n    });\n    for (const op of ops) {\n      if (op.type === \"presence\") {\n        const reverse = {\n          type: \"presence\",\n          data: {}\n        };\n        for (const key in op.data) {\n          reverse.data[key] = context.myPresence.current[key];\n        }\n        context.myPresence.patch(op.data);\n        if (context.buffer.presenceUpdates === null) {\n          context.buffer.presenceUpdates = { type: \"partial\", data: op.data };\n        } else {\n          for (const key in op.data) {\n            context.buffer.presenceUpdates.data[key] = op.data[key];\n          }\n        }\n        output.reverse.unshift(reverse);\n        output.presence = true;\n      } else {\n        let source;\n        if (isLocal) {\n          source = 0 /* UNDOREDO_RECONNECT */;\n        } else {\n          const opId = nn(op.opId);\n          if (true) {\n            nn(context.opStackTraces).delete(opId);\n          }\n          const deleted = context.unacknowledgedOps.delete(opId);\n          source = deleted ? 2 /* ACK */ : 1 /* REMOTE */;\n        }\n        const applyOpResult = applyOp(op, source);\n        if (applyOpResult.modified) {\n          const nodeId = applyOpResult.modified.node._id;\n          if (!(nodeId && createdNodeIds.has(nodeId))) {\n            output.storageUpdates.set(\n              nn(applyOpResult.modified.node._id),\n              mergeStorageUpdates(\n                output.storageUpdates.get(nn(applyOpResult.modified.node._id)),\n                applyOpResult.modified\n              )\n            );\n            output.reverse.unshift(...applyOpResult.reverse);\n          }\n          if (op.type === 2 /* CREATE_LIST */ || op.type === 7 /* CREATE_MAP */ || op.type === 4 /* CREATE_OBJECT */) {\n            createdNodeIds.add(nn(op.id));\n          }\n        }\n      }\n    }\n    return {\n      ops,\n      reverse: output.reverse,\n      updates: {\n        storageUpdates: output.storageUpdates,\n        presence: output.presence\n      }\n    };\n  }\n  function applyOp(op, source) {\n    if (isAckOp(op)) {\n      return { modified: false };\n    }\n    switch (op.type) {\n      case 6 /* DELETE_OBJECT_KEY */:\n      case 3 /* UPDATE_OBJECT */:\n      case 5 /* DELETE_CRDT */: {\n        const node = context.nodes.get(op.id);\n        if (node === void 0) {\n          return { modified: false };\n        }\n        return node._apply(op, source === 0 /* UNDOREDO_RECONNECT */);\n      }\n      case 1 /* SET_PARENT_KEY */: {\n        const node = context.nodes.get(op.id);\n        if (node === void 0) {\n          return { modified: false };\n        }\n        if (node.parent.type === \"HasParent\" && isLiveList(node.parent.node)) {\n          return node.parent.node._setChildKey(\n            asPos(op.parentKey),\n            node,\n            source\n          );\n        }\n        return { modified: false };\n      }\n      case 4 /* CREATE_OBJECT */:\n      case 2 /* CREATE_LIST */:\n      case 7 /* CREATE_MAP */:\n      case 8 /* CREATE_REGISTER */: {\n        if (op.parentId === void 0) {\n          return { modified: false };\n        }\n        const parentNode = context.nodes.get(op.parentId);\n        if (parentNode === void 0) {\n          return { modified: false };\n        }\n        return parentNode._attachChild(op, source);\n      }\n    }\n  }\n  function updatePresence(patch, options2) {\n    const oldValues = {};\n    if (context.buffer.presenceUpdates === null) {\n      context.buffer.presenceUpdates = {\n        type: \"partial\",\n        data: {}\n      };\n    }\n    for (const key in patch) {\n      const overrideValue = patch[key];\n      if (overrideValue === void 0) {\n        continue;\n      }\n      context.buffer.presenceUpdates.data[key] = overrideValue;\n      oldValues[key] = context.myPresence.current[key];\n    }\n    context.myPresence.patch(patch);\n    if (context.activeBatch) {\n      if (options2?.addToHistory) {\n        context.activeBatch.reverseOps.unshift({\n          type: \"presence\",\n          data: oldValues\n        });\n      }\n      context.activeBatch.updates.presence = true;\n    } else {\n      flushNowOrSoon();\n      batchUpdates(() => {\n        if (options2?.addToHistory) {\n          addToUndoStack(\n            [{ type: \"presence\", data: oldValues }],\n            doNotBatchUpdates\n          );\n        }\n        notify({ presence: true }, doNotBatchUpdates);\n      });\n    }\n  }\n  function onUpdatePresenceMessage(message) {\n    if (message.targetActor !== void 0) {\n      const oldUser = context.others.getUser(message.actor);\n      context.others.setOther(message.actor, message.data);\n      const newUser = context.others.getUser(message.actor);\n      if (oldUser === void 0 && newUser !== void 0) {\n        return { type: \"enter\", user: newUser };\n      }\n    } else {\n      context.others.patchOther(message.actor, message.data), message;\n    }\n    const user = context.others.getUser(message.actor);\n    if (user) {\n      return {\n        type: \"update\",\n        updates: message.data,\n        user\n      };\n    } else {\n      return void 0;\n    }\n  }\n  function onUserLeftMessage(message) {\n    const user = context.others.getUser(message.actor);\n    if (user) {\n      context.others.removeConnection(message.actor);\n      return { type: \"leave\", user };\n    }\n    return null;\n  }\n  function onRoomStateMessage(message, batchedUpdatesWrapper) {\n    context.dynamicSessionInfo.set({\n      actor: message.actor,\n      nonce: message.nonce,\n      scopes: message.scopes\n    });\n    context.idFactory = makeIdFactory(message.actor);\n    notifySelfChanged(batchedUpdatesWrapper);\n    for (const connectionId of context.others.connectionIds()) {\n      const user = message.users[connectionId];\n      if (user === void 0) {\n        context.others.removeConnection(connectionId);\n      }\n    }\n    for (const key in message.users) {\n      const user = message.users[key];\n      const connectionId = Number(key);\n      context.others.setConnection(\n        connectionId,\n        user.id,\n        user.info,\n        user.scopes\n      );\n    }\n    return { type: \"reset\" };\n  }\n  function canUndo() {\n    return context.undoStack.length > 0;\n  }\n  function canRedo() {\n    return context.redoStack.length > 0;\n  }\n  function onHistoryChange(batchedUpdatesWrapper) {\n    batchedUpdatesWrapper(() => {\n      eventHub.history.notify({ canUndo: canUndo(), canRedo: canRedo() });\n    });\n  }\n  function onUserJoinedMessage(message) {\n    context.others.setConnection(\n      message.actor,\n      message.id,\n      message.info,\n      message.scopes\n    );\n    context.buffer.messages.push({\n      type: 100 /* UPDATE_PRESENCE */,\n      data: context.myPresence.current,\n      targetActor: message.actor\n    });\n    flushNowOrSoon();\n    const user = context.others.getUser(message.actor);\n    return user ? { type: \"enter\", user } : void 0;\n  }\n  function parseServerMessage(data) {\n    if (!isJsonObject(data)) {\n      return null;\n    }\n    return data;\n  }\n  function parseServerMessages(text) {\n    const data = tryParseJson(text);\n    if (data === void 0) {\n      return null;\n    } else if (isJsonArray(data)) {\n      return compact(data.map((item) => parseServerMessage(item)));\n    } else {\n      return compact([parseServerMessage(data)]);\n    }\n  }\n  function applyAndSendOps(offlineOps, batchedUpdatesWrapper) {\n    if (offlineOps.size === 0) {\n      return;\n    }\n    const messages = [];\n    const ops = Array.from(offlineOps.values());\n    const result = applyOps(ops, true);\n    messages.push({\n      type: 201 /* UPDATE_STORAGE */,\n      ops: result.ops\n    });\n    notify(result.updates, batchedUpdatesWrapper);\n    sendMessages(messages);\n  }\n  function handleServerMessage(event) {\n    if (typeof event.data !== \"string\") {\n      return;\n    }\n    const messages = parseServerMessages(event.data);\n    if (messages === null || messages.length === 0) {\n      return;\n    }\n    const updates = {\n      storageUpdates: /* @__PURE__ */ new Map(),\n      others: []\n    };\n    batchUpdates(() => {\n      for (const message of messages) {\n        switch (message.type) {\n          case 101 /* USER_JOINED */: {\n            const userJoinedUpdate = onUserJoinedMessage(message);\n            if (userJoinedUpdate) {\n              updates.others.push(userJoinedUpdate);\n            }\n            break;\n          }\n          case 100 /* UPDATE_PRESENCE */: {\n            const othersPresenceUpdate = onUpdatePresenceMessage(message);\n            if (othersPresenceUpdate) {\n              updates.others.push(othersPresenceUpdate);\n            }\n            break;\n          }\n          case 103 /* BROADCASTED_EVENT */: {\n            const others = context.others.current;\n            eventHub.customEvent.notify({\n              connectionId: message.actor,\n              user: message.actor < 0 ? null : others.find((u) => u.connectionId === message.actor) ?? null,\n              event: message.event\n            });\n            break;\n          }\n          case 102 /* USER_LEFT */: {\n            const event2 = onUserLeftMessage(message);\n            if (event2) {\n              updates.others.push(event2);\n            }\n            break;\n          }\n          case 300 /* UPDATE_YDOC */: {\n            eventHub.ydoc.notify(message);\n            break;\n          }\n          case 104 /* ROOM_STATE */: {\n            updates.others.push(onRoomStateMessage(message, doNotBatchUpdates));\n            break;\n          }\n          case 200 /* INITIAL_STORAGE_STATE */: {\n            processInitialStorage(message);\n            break;\n          }\n          case 201 /* UPDATE_STORAGE */: {\n            const applyResult = applyOps(message.ops, false);\n            for (const [key, value] of applyResult.updates.storageUpdates) {\n              updates.storageUpdates.set(\n                key,\n                mergeStorageUpdates(updates.storageUpdates.get(key), value)\n              );\n            }\n            break;\n          }\n          case 299 /* REJECT_STORAGE_OP */: {\n            errorWithTitle(\n              \"Storage mutation rejection error\",\n              message.reason\n            );\n            if (true) {\n              const traces = /* @__PURE__ */ new Set();\n              for (const opId of message.opIds) {\n                const trace = context.opStackTraces?.get(opId);\n                if (trace) {\n                  traces.add(trace);\n                }\n              }\n              if (traces.size > 0) {\n                warnWithTitle(\n                  \"The following function calls caused the rejected storage mutations:\",\n                  `\n\n${Array.from(traces).join(\"\\n\\n\")}`\n                );\n              }\n              throw new Error(\n                `Storage mutations rejected by server: ${message.reason}`\n              );\n            }\n            break;\n          }\n          case 400 /* THREAD_CREATED */:\n          case 407 /* THREAD_DELETED */:\n          case 401 /* THREAD_METADATA_UPDATED */:\n          case 408 /* THREAD_UPDATED */:\n          case 405 /* COMMENT_REACTION_ADDED */:\n          case 406 /* COMMENT_REACTION_REMOVED */:\n          case 402 /* COMMENT_CREATED */:\n          case 403 /* COMMENT_EDITED */:\n          case 404 /* COMMENT_DELETED */: {\n            eventHub.comments.notify(message);\n            break;\n          }\n        }\n      }\n      notify(updates, doNotBatchUpdates);\n    });\n  }\n  function flushNowOrSoon() {\n    const storageOps = context.buffer.storageOperations;\n    if (storageOps.length > 0) {\n      for (const op of storageOps) {\n        context.unacknowledgedOps.set(nn(op.opId), op);\n      }\n      notifyStorageStatus();\n    }\n    if (managedSocket.getStatus() !== \"connected\") {\n      context.buffer.storageOperations = [];\n      return;\n    }\n    const now = Date.now();\n    const elapsedMillis = now - context.buffer.lastFlushedAt;\n    if (elapsedMillis >= config.throttleDelay) {\n      const messagesToFlush = serializeBuffer();\n      if (messagesToFlush.length === 0) {\n        return;\n      }\n      sendMessages(messagesToFlush);\n      context.buffer = {\n        flushTimerID: void 0,\n        lastFlushedAt: now,\n        messages: [],\n        storageOperations: [],\n        presenceUpdates: null\n      };\n    } else {\n      clearTimeout(context.buffer.flushTimerID);\n      context.buffer.flushTimerID = setTimeout(\n        flushNowOrSoon,\n        config.throttleDelay - elapsedMillis\n      );\n    }\n  }\n  function serializeBuffer() {\n    const messages = [];\n    if (context.buffer.presenceUpdates) {\n      messages.push(\n        context.buffer.presenceUpdates.type === \"full\" ? {\n          type: 100 /* UPDATE_PRESENCE */,\n          // Populating the `targetActor` field turns this message into\n          // a Full Presence update message (not a patch), which will get\n          // interpreted by other clients as such.\n          targetActor: -1,\n          data: context.buffer.presenceUpdates.data\n        } : {\n          type: 100 /* UPDATE_PRESENCE */,\n          data: context.buffer.presenceUpdates.data\n        }\n      );\n    }\n    for (const event of context.buffer.messages) {\n      messages.push(event);\n    }\n    if (context.buffer.storageOperations.length > 0) {\n      messages.push({\n        type: 201 /* UPDATE_STORAGE */,\n        ops: context.buffer.storageOperations\n      });\n    }\n    return messages;\n  }\n  function updateYDoc(update, guid) {\n    const clientMsg = {\n      type: 301 /* UPDATE_YDOC */,\n      update,\n      guid\n    };\n    context.buffer.messages.push(clientMsg);\n    eventHub.ydoc.notify(clientMsg);\n    flushNowOrSoon();\n  }\n  function broadcastEvent(event, options2 = {\n    shouldQueueEventIfNotReady: false\n  }) {\n    if (managedSocket.getStatus() !== \"connected\" && !options2.shouldQueueEventIfNotReady) {\n      return;\n    }\n    context.buffer.messages.push({\n      type: 103 /* BROADCAST_EVENT */,\n      event\n    });\n    flushNowOrSoon();\n  }\n  function dispatchOps(ops) {\n    const { storageOperations } = context.buffer;\n    for (const op of ops) {\n      storageOperations.push(op);\n    }\n    flushNowOrSoon();\n  }\n  let _getStorage$ = null;\n  let _resolveStoragePromise = null;\n  function processInitialStorage(message) {\n    const unacknowledgedOps = new Map(context.unacknowledgedOps);\n    createOrUpdateRootFromMessage(message, doNotBatchUpdates);\n    applyAndSendOps(unacknowledgedOps, doNotBatchUpdates);\n    _resolveStoragePromise?.();\n    notifyStorageStatus();\n    eventHub.storageDidLoad.notify();\n  }\n  async function streamStorage() {\n    if (!managedSocket.authValue) {\n      return;\n    }\n    const result = await streamFetch(managedSocket.authValue, config.roomId);\n    const items = await result.json();\n    processInitialStorage({ type: 200 /* INITIAL_STORAGE_STATE */, items });\n  }\n  function refreshStorage(options2) {\n    const messages = context.buffer.messages;\n    if (config.unstable_streamData) {\n      void streamStorage();\n    } else if (!messages.some((msg) => msg.type === 200 /* FETCH_STORAGE */)) {\n      messages.push({ type: 200 /* FETCH_STORAGE */ });\n    }\n    if (options2.flush) {\n      flushNowOrSoon();\n    }\n  }\n  function startLoadingStorage() {\n    if (_getStorage$ === null) {\n      refreshStorage({ flush: true });\n      _getStorage$ = new Promise((resolve) => {\n        _resolveStoragePromise = resolve;\n      });\n      notifyStorageStatus();\n    }\n    return _getStorage$;\n  }\n  function getStorageSnapshot() {\n    const root = context.root;\n    if (root !== void 0) {\n      return root;\n    } else {\n      void startLoadingStorage();\n      return null;\n    }\n  }\n  async function getStorage() {\n    if (context.root !== void 0) {\n      return Promise.resolve({\n        root: context.root\n      });\n    }\n    await startLoadingStorage();\n    return {\n      root: nn(context.root)\n    };\n  }\n  function fetchYDoc(vector, guid) {\n    if (!context.buffer.messages.find((m) => {\n      return m.type === 300 /* FETCH_YDOC */ && m.vector === vector && m.guid === guid;\n    })) {\n      context.buffer.messages.push({\n        type: 300 /* FETCH_YDOC */,\n        vector,\n        guid\n      });\n    }\n    flushNowOrSoon();\n  }\n  function undo() {\n    if (context.activeBatch) {\n      throw new Error(\"undo is not allowed during a batch\");\n    }\n    const historyOps = context.undoStack.pop();\n    if (historyOps === void 0) {\n      return;\n    }\n    context.pausedHistory = null;\n    const result = applyOps(historyOps, true);\n    batchUpdates(() => {\n      notify(result.updates, doNotBatchUpdates);\n      context.redoStack.push(result.reverse);\n      onHistoryChange(doNotBatchUpdates);\n    });\n    for (const op of result.ops) {\n      if (op.type !== \"presence\") {\n        context.buffer.storageOperations.push(op);\n      }\n    }\n    flushNowOrSoon();\n  }\n  function redo() {\n    if (context.activeBatch) {\n      throw new Error(\"redo is not allowed during a batch\");\n    }\n    const historyOps = context.redoStack.pop();\n    if (historyOps === void 0) {\n      return;\n    }\n    context.pausedHistory = null;\n    const result = applyOps(historyOps, true);\n    batchUpdates(() => {\n      notify(result.updates, doNotBatchUpdates);\n      context.undoStack.push(result.reverse);\n      onHistoryChange(doNotBatchUpdates);\n    });\n    for (const op of result.ops) {\n      if (op.type !== \"presence\") {\n        context.buffer.storageOperations.push(op);\n      }\n    }\n    flushNowOrSoon();\n  }\n  function clear() {\n    context.undoStack.length = 0;\n    context.redoStack.length = 0;\n  }\n  function batch(callback) {\n    if (context.activeBatch) {\n      return callback();\n    }\n    let returnValue = void 0;\n    batchUpdates(() => {\n      context.activeBatch = {\n        ops: [],\n        updates: {\n          storageUpdates: /* @__PURE__ */ new Map(),\n          presence: false,\n          others: []\n        },\n        reverseOps: []\n      };\n      try {\n        returnValue = callback();\n      } finally {\n        const currentBatch = context.activeBatch;\n        context.activeBatch = null;\n        if (currentBatch.reverseOps.length > 0) {\n          addToUndoStack(currentBatch.reverseOps, doNotBatchUpdates);\n        }\n        if (currentBatch.ops.length > 0) {\n          context.redoStack.length = 0;\n        }\n        if (currentBatch.ops.length > 0) {\n          dispatchOps(currentBatch.ops);\n        }\n        notify(currentBatch.updates, doNotBatchUpdates);\n        flushNowOrSoon();\n      }\n    });\n    return returnValue;\n  }\n  function pauseHistory() {\n    if (context.pausedHistory === null) {\n      context.pausedHistory = [];\n    }\n  }\n  function resumeHistory() {\n    const historyOps = context.pausedHistory;\n    context.pausedHistory = null;\n    if (historyOps !== null && historyOps.length > 0) {\n      _addToRealUndoStack(historyOps, batchUpdates);\n    }\n  }\n  function getStorageStatus() {\n    if (context.root === void 0) {\n      return _getStorage$ === null ? \"not-loaded\" : \"loading\";\n    } else {\n      return context.unacknowledgedOps.size === 0 ? \"synchronized\" : \"synchronizing\";\n    }\n  }\n  let _lastStorageStatus = getStorageStatus();\n  function notifyStorageStatus() {\n    const storageStatus = getStorageStatus();\n    if (_lastStorageStatus !== storageStatus) {\n      _lastStorageStatus = storageStatus;\n      eventHub.storageStatus.notify(storageStatus);\n    }\n  }\n  function isPresenceReady() {\n    return self.current !== null;\n  }\n  async function waitUntilPresenceReady() {\n    while (!isPresenceReady()) {\n      const { promise, resolve } = Promise_withResolvers();\n      const unsub1 = events.self.subscribeOnce(resolve);\n      const unsub2 = events.status.subscribeOnce(resolve);\n      await promise;\n      unsub1();\n      unsub2();\n    }\n  }\n  function isStorageReady() {\n    return getStorageSnapshot() !== null;\n  }\n  async function waitUntilStorageReady() {\n    while (!isStorageReady()) {\n      await getStorage();\n    }\n  }\n  const others_forDevTools = new DerivedRef(\n    context.others,\n    (others) => others.map((other, index) => userToTreeNode(`Other ${index}`, other))\n  );\n  const events = {\n    status: eventHub.status.observable,\n    lostConnection: eventHub.lostConnection.observable,\n    customEvent: eventHub.customEvent.observable,\n    others: eventHub.others.observable,\n    self: eventHub.self.observable,\n    myPresence: eventHub.myPresence.observable,\n    error: eventHub.error.observable,\n    /** @deprecated */\n    storage: eventHub.storageBatch.observable,\n    storageBatch: eventHub.storageBatch.observable,\n    history: eventHub.history.observable,\n    storageDidLoad: eventHub.storageDidLoad.observable,\n    storageStatus: eventHub.storageStatus.observable,\n    ydoc: eventHub.ydoc.observable,\n    comments: eventHub.comments.observable\n  };\n  const commentsApi = createCommentsApi(\n    config.roomId,\n    delegates.authenticate,\n    fetchClientApi\n  );\n  async function fetchNotificationsJson(endpoint, options2) {\n    const authValue = await delegates.authenticate();\n    const response = await fetchClientApi(\n      config.roomId,\n      endpoint,\n      authValue,\n      options2\n    );\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new NotificationsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new NotificationsApiError(\n            response.statusText,\n            response.status\n          );\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  function getNotificationSettings() {\n    return fetchNotificationsJson(\n      \"/notification-settings\"\n    );\n  }\n  function updateNotificationSettings(settings) {\n    return fetchNotificationsJson(\n      \"/notification-settings\",\n      {\n        method: \"POST\",\n        body: JSON.stringify(settings),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n  }\n  async function markInboxNotificationsAsRead(inboxNotificationIds) {\n    await fetchNotificationsJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds })\n    });\n  }\n  const batchedMarkInboxNotificationsAsRead = new Batch(\n    async (batchedInboxNotificationIds) => {\n      const inboxNotificationIds = batchedInboxNotificationIds.flat();\n      await markInboxNotificationsAsRead(inboxNotificationIds);\n      return inboxNotificationIds;\n    },\n    { delay: MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY2 }\n  );\n  async function markInboxNotificationAsRead(inboxNotificationId) {\n    await batchedMarkInboxNotificationsAsRead.get(inboxNotificationId);\n  }\n  return Object.defineProperty(\n    {\n      [kInternal]: {\n        get presenceBuffer() {\n          return deepClone(context.buffer.presenceUpdates?.data ?? null);\n        },\n        // prettier-ignore\n        get undoStack() {\n          return deepClone(context.undoStack);\n        },\n        // prettier-ignore\n        get nodeCount() {\n          return context.nodes.size;\n        },\n        // prettier-ignore\n        // send metadata when using a text editor\n        reportTextEditor,\n        // create a text mention when using a text editor\n        createTextMention,\n        // delete a text mention when using a text editor\n        deleteTextMention,\n        // Support for the Liveblocks browser extension\n        getSelf_forDevTools: () => selfAsTreeNode.current,\n        getOthers_forDevTools: () => others_forDevTools.current,\n        // prettier-ignore\n        simulate: {\n          // These exist only for our E2E testing app\n          explicitClose: (event) => managedSocket._privateSendMachineEvent({ type: \"EXPLICIT_SOCKET_CLOSE\", event }),\n          rawSend: (data) => managedSocket.send(data)\n        }\n      },\n      id: config.roomId,\n      subscribe: makeClassicSubscribeFn(events),\n      connect: () => managedSocket.connect(),\n      reconnect: () => managedSocket.reconnect(),\n      disconnect: () => managedSocket.disconnect(),\n      destroy: () => {\n        uninstallBgTabSpy();\n        managedSocket.destroy();\n      },\n      // Presence\n      updatePresence,\n      updateYDoc,\n      broadcastEvent,\n      // Storage\n      batch,\n      history: {\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        clear,\n        pause: pauseHistory,\n        resume: resumeHistory\n      },\n      fetchYDoc,\n      getStorage,\n      getStorageSnapshot,\n      getStorageStatus,\n      isPresenceReady,\n      isStorageReady,\n      waitUntilPresenceReady: memoizeOnSuccess(waitUntilPresenceReady),\n      waitUntilStorageReady: memoizeOnSuccess(waitUntilStorageReady),\n      events,\n      // Core\n      getStatus: () => managedSocket.getStatus(),\n      getSelf: () => self.current,\n      // Presence\n      getPresence: () => context.myPresence.current,\n      getOthers: () => context.others.current,\n      getNotificationSettings,\n      updateNotificationSettings,\n      markInboxNotificationAsRead,\n      ...commentsApi\n    },\n    // Explictly make the internal field non-enumerable, to avoid aggressive\n    // freezing when used with Immer\n    kInternal,\n    { enumerable: false }\n  );\n}\nfunction makeClassicSubscribeFn(events) {\n  function subscribeToLiveStructureDeeply(node, callback) {\n    return events.storageBatch.subscribe((updates) => {\n      const relatedUpdates = updates.filter(\n        (update) => isSameNodeOrChildOf(update.node, node)\n      );\n      if (relatedUpdates.length > 0) {\n        callback(relatedUpdates);\n      }\n    });\n  }\n  function subscribeToLiveStructureShallowly(node, callback) {\n    return events.storageBatch.subscribe((updates) => {\n      for (const update of updates) {\n        if (update.node._id === node._id) {\n          callback(update.node);\n        }\n      }\n    });\n  }\n  function subscribe(first, second, options) {\n    if (typeof first === \"string\" && isRoomEventName(first)) {\n      if (typeof second !== \"function\") {\n        throw new Error(\"Second argument must be a callback function\");\n      }\n      const callback = second;\n      switch (first) {\n        case \"event\":\n          return events.customEvent.subscribe(\n            callback\n          );\n        case \"my-presence\":\n          return events.myPresence.subscribe(callback);\n        case \"others\": {\n          const cb = callback;\n          return events.others.subscribe((event) => {\n            const { others, ...internalEvent } = event;\n            return cb(others, internalEvent);\n          });\n        }\n        case \"error\":\n          return events.error.subscribe(callback);\n        case \"status\":\n          return events.status.subscribe(callback);\n        case \"lost-connection\":\n          return events.lostConnection.subscribe(\n            callback\n          );\n        case \"history\":\n          return events.history.subscribe(callback);\n        case \"storage-status\":\n          return events.storageStatus.subscribe(\n            callback\n          );\n        case \"comments\":\n          return events.comments.subscribe(\n            callback\n          );\n        default:\n          return assertNever(\n            first,\n            `\"${String(first)}\" is not a valid event name`\n          );\n      }\n    }\n    if (second === void 0 || typeof first === \"function\") {\n      if (typeof first === \"function\") {\n        const storageCallback = first;\n        return events.storageBatch.subscribe(storageCallback);\n      } else {\n        throw new Error(\"Please specify a listener callback\");\n      }\n    }\n    if (isLiveNode(first)) {\n      const node = first;\n      if (options?.isDeep) {\n        const storageCallback = second;\n        return subscribeToLiveStructureDeeply(node, storageCallback);\n      } else {\n        const nodeCallback = second;\n        return subscribeToLiveStructureShallowly(node, nodeCallback);\n      }\n    }\n    throw new Error(\n      `${String(first)} is not a value that can be subscribed to.`\n    );\n  }\n  return subscribe;\n}\nfunction isRoomEventName(value) {\n  return value === \"my-presence\" || value === \"others\" || value === \"event\" || value === \"error\" || value === \"history\" || value === \"status\" || value === \"storage-status\" || value === \"lost-connection\" || value === \"connection\" || value === \"comments\";\n}\nfunction makeAuthDelegateForRoom(roomId, authManager) {\n  return async () => {\n    return authManager.getAuthValue({ requestedScope: \"room:read\", roomId });\n  };\n}\nfunction makeCreateSocketDelegateForRoom(roomId, baseUrl, WebSocketPolyfill) {\n  return (authValue) => {\n    const ws = WebSocketPolyfill ?? (typeof WebSocket === \"undefined\" ? void 0 : WebSocket);\n    if (ws === void 0) {\n      throw new StopRetrying(\n        \"To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.\"\n      );\n    }\n    const url = new URL(baseUrl);\n    url.protocol = url.protocol === \"http:\" ? \"ws\" : \"wss\";\n    url.pathname = \"/v7\";\n    url.searchParams.set(\"roomId\", roomId);\n    if (authValue.type === \"secret\") {\n      url.searchParams.set(\"tok\", authValue.token.raw);\n    } else if (authValue.type === \"public\") {\n      url.searchParams.set(\"pubkey\", authValue.publicApiKey);\n    } else {\n      return assertNever(authValue, \"Unhandled case\");\n    }\n    url.searchParams.set(\"version\", PKG_VERSION || \"dev\");\n    return new ws(url.toString());\n  };\n}\n\n// src/store.ts\nfunction createClientStore() {\n  const store = createStore({\n    threads: {},\n    queries: {},\n    optimisticUpdates: [],\n    inboxNotifications: {},\n    notificationSettings: {}\n  });\n  const optimisticUpdatesEventSource = makeEventSource();\n  return {\n    ...store,\n    deleteThread(threadId) {\n      store.set((state) => {\n        return {\n          ...state,\n          threads: deleteKeyImmutable(state.threads, threadId),\n          inboxNotifications: Object.fromEntries(\n            Object.entries(state.inboxNotifications).filter(\n              ([_id, notification]) => notification.kind === \"thread\" && notification.threadId === threadId\n            )\n          )\n        };\n      });\n    },\n    updateThreadAndNotification(thread, inboxNotification) {\n      store.set((state) => {\n        const existingThread = state.threads[thread.id];\n        return {\n          ...state,\n          threads: existingThread === void 0 || compareThreads(thread, existingThread) === 1 ? { ...state.threads, [thread.id]: thread } : state.threads,\n          inboxNotifications: inboxNotification === void 0 ? state.inboxNotifications : {\n            ...state.inboxNotifications,\n            [inboxNotification.id]: inboxNotification\n          }\n        };\n      });\n    },\n    updateThreadsAndNotifications(threads, inboxNotifications, deletedThreads, deletedInboxNotifications, queryKey) {\n      store.set((state) => ({\n        ...state,\n        threads: applyThreadUpdates(state.threads, {\n          newThreads: threads,\n          deletedThreads\n        }),\n        inboxNotifications: applyNotificationsUpdates(\n          state.inboxNotifications,\n          {\n            newInboxNotifications: inboxNotifications,\n            deletedNotifications: deletedInboxNotifications\n          }\n        ),\n        queries: queryKey !== void 0 ? {\n          ...state.queries,\n          [queryKey]: { isLoading: false, data: void 0 }\n        } : state.queries\n      }));\n    },\n    updateRoomInboxNotificationSettings(roomId, settings, queryKey) {\n      store.set((state) => ({\n        ...state,\n        notificationSettings: {\n          ...state.notificationSettings,\n          [roomId]: settings\n        },\n        queries: {\n          ...state.queries,\n          [queryKey]: { isLoading: false, data: void 0 }\n        }\n      }));\n    },\n    pushOptimisticUpdate(optimisticUpdate) {\n      optimisticUpdatesEventSource.notify(optimisticUpdate);\n      store.set((state) => ({\n        ...state,\n        optimisticUpdates: [...state.optimisticUpdates, optimisticUpdate]\n      }));\n    },\n    setQueryState(queryKey, queryState) {\n      store.set((state) => ({\n        ...state,\n        queries: {\n          ...state.queries,\n          [queryKey]: queryState\n        }\n      }));\n    },\n    optimisticUpdatesEventSource\n  };\n}\nfunction deleteKeyImmutable(record, key) {\n  if (Object.prototype.hasOwnProperty.call(record, key)) {\n    const { [key]: _toDelete, ...rest } = record;\n    return rest;\n  }\n  return record;\n}\nfunction compareThreads(thread1, thread2) {\n  if (thread1.updatedAt && thread2.updatedAt) {\n    return thread1.updatedAt > thread2.updatedAt ? 1 : thread1.updatedAt < thread2.updatedAt ? -1 : 0;\n  } else if (thread1.updatedAt || thread2.updatedAt) {\n    return thread1.updatedAt ? 1 : -1;\n  }\n  if (thread1.createdAt > thread2.createdAt) {\n    return 1;\n  } else if (thread1.createdAt < thread2.createdAt) {\n    return -1;\n  }\n  return 0;\n}\nfunction applyOptimisticUpdates(state) {\n  const result = {\n    threads: {\n      ...state.threads\n    },\n    inboxNotifications: {\n      ...state.inboxNotifications\n    },\n    notificationSettings: {\n      ...state.notificationSettings\n    }\n  };\n  for (const optimisticUpdate of state.optimisticUpdates) {\n    switch (optimisticUpdate.type) {\n      case \"create-thread\": {\n        result.threads[optimisticUpdate.thread.id] = optimisticUpdate.thread;\n        break;\n      }\n      case \"edit-thread-metadata\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        if (thread.updatedAt !== void 0 && thread.updatedAt > optimisticUpdate.updatedAt) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          updatedAt: optimisticUpdate.updatedAt,\n          metadata: {\n            ...thread.metadata,\n            ...optimisticUpdate.metadata\n          }\n        };\n        break;\n      }\n      case \"mark-thread-as-resolved\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          resolved: true\n        };\n        break;\n      }\n      case \"mark-thread-as-unresolved\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          resolved: false\n        };\n        break;\n      }\n      case \"create-comment\": {\n        const thread = result.threads[optimisticUpdate.comment.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = upsertComment(\n          thread,\n          optimisticUpdate.comment\n        );\n        const inboxNotification = Object.values(result.inboxNotifications).find(\n          (notification) => notification.kind === \"thread\" && notification.threadId === thread.id\n        );\n        if (inboxNotification === void 0) {\n          break;\n        }\n        result.inboxNotifications[inboxNotification.id] = {\n          ...inboxNotification,\n          notifiedAt: optimisticUpdate.comment.createdAt,\n          readAt: optimisticUpdate.comment.createdAt\n        };\n        break;\n      }\n      case \"edit-comment\": {\n        const thread = result.threads[optimisticUpdate.comment.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = upsertComment(\n          thread,\n          optimisticUpdate.comment\n        );\n        break;\n      }\n      case \"delete-comment\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = deleteComment(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.deletedAt\n        );\n        break;\n      }\n      case \"delete-thread\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[optimisticUpdate.threadId] = {\n          ...result.threads[optimisticUpdate.threadId],\n          deletedAt: optimisticUpdate.deletedAt,\n          updatedAt: optimisticUpdate.deletedAt,\n          comments: []\n        };\n        break;\n      }\n      case \"add-reaction\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = addReaction(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.reaction\n        );\n        break;\n      }\n      case \"remove-reaction\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = removeReaction(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.emoji,\n          optimisticUpdate.userId,\n          optimisticUpdate.removedAt\n        );\n        break;\n      }\n      case \"mark-inbox-notification-as-read\": {\n        result.inboxNotifications[optimisticUpdate.inboxNotificationId] = {\n          ...state.inboxNotifications[optimisticUpdate.inboxNotificationId],\n          readAt: optimisticUpdate.readAt\n        };\n        break;\n      }\n      case \"mark-all-inbox-notifications-as-read\": {\n        for (const id in result.inboxNotifications) {\n          result.inboxNotifications[id] = {\n            ...result.inboxNotifications[id],\n            readAt: optimisticUpdate.readAt\n          };\n        }\n        break;\n      }\n      case \"delete-inbox-notification\": {\n        const {\n          [optimisticUpdate.inboxNotificationId]: _,\n          ...inboxNotifications\n        } = result.inboxNotifications;\n        result.inboxNotifications = inboxNotifications;\n        break;\n      }\n      case \"delete-all-inbox-notifications\": {\n        result.inboxNotifications = {};\n        break;\n      }\n      case \"update-notification-settings\": {\n        result.notificationSettings[optimisticUpdate.roomId] = {\n          ...result.notificationSettings[optimisticUpdate.roomId],\n          ...optimisticUpdate.settings\n        };\n      }\n    }\n  }\n  return result;\n}\nfunction applyThreadUpdates(existingThreads, updates) {\n  const updatedThreads = { ...existingThreads };\n  updates.newThreads.forEach((thread) => {\n    const existingThread = updatedThreads[thread.id];\n    if (existingThread) {\n      const result = compareThreads(existingThread, thread);\n      if (result === 1) return;\n    }\n    updatedThreads[thread.id] = thread;\n  });\n  updates.deletedThreads.forEach(({ id, deletedAt }) => {\n    const existingThread = updatedThreads[id];\n    if (existingThread === void 0) return;\n    existingThread.deletedAt = deletedAt;\n    existingThread.updatedAt = deletedAt;\n    existingThread.comments = [];\n  });\n  return updatedThreads;\n}\nfunction applyNotificationsUpdates(existingInboxNotifications, updates) {\n  const updatedInboxNotifications = { ...existingInboxNotifications };\n  updates.newInboxNotifications.forEach((notification) => {\n    const existingNotification = updatedInboxNotifications[notification.id];\n    if (existingNotification) {\n      const result = compareInboxNotifications(\n        existingNotification,\n        notification\n      );\n      if (result === 1) return;\n    }\n    updatedInboxNotifications[notification.id] = notification;\n  });\n  updates.deletedNotifications.forEach(\n    ({ id }) => delete updatedInboxNotifications[id]\n  );\n  return updatedInboxNotifications;\n}\nfunction compareInboxNotifications(inboxNotificationA, inboxNotificationB) {\n  if (inboxNotificationA.notifiedAt > inboxNotificationB.notifiedAt) {\n    return 1;\n  } else if (inboxNotificationA.notifiedAt < inboxNotificationB.notifiedAt) {\n    return -1;\n  }\n  if (inboxNotificationA.readAt && inboxNotificationB.readAt) {\n    return inboxNotificationA.readAt > inboxNotificationB.readAt ? 1 : inboxNotificationA.readAt < inboxNotificationB.readAt ? -1 : 0;\n  } else if (inboxNotificationA.readAt || inboxNotificationB.readAt) {\n    return inboxNotificationA.readAt ? 1 : -1;\n  }\n  return 0;\n}\nfunction upsertComment(thread, comment) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  if (comment.threadId !== thread.id) {\n    warn(\n      `Comment ${comment.id} does not belong to thread ${thread.id}`\n    );\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (existingComment2) => existingComment2.id === comment.id\n  );\n  if (existingComment === void 0) {\n    const updatedAt = new Date(\n      Math.max(thread.updatedAt?.getTime() || 0, comment.createdAt.getTime())\n    );\n    const updatedThread = {\n      ...thread,\n      updatedAt,\n      comments: [...thread.comments, comment]\n    };\n    return updatedThread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  if (existingComment.editedAt === void 0 || comment.editedAt === void 0 || existingComment.editedAt <= comment.editedAt) {\n    const updatedComments = thread.comments.map(\n      (existingComment2) => existingComment2.id === comment.id ? comment : existingComment2\n    );\n    const updatedThread = {\n      ...thread,\n      updatedAt: new Date(\n        Math.max(\n          thread.updatedAt?.getTime() || 0,\n          comment.editedAt?.getTime() || comment.createdAt.getTime()\n        )\n      ),\n      comments: updatedComments\n    };\n    return updatedThread;\n  }\n  return thread;\n}\nfunction deleteComment(thread, commentId, deletedAt) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      deletedAt,\n      body: void 0\n    } : comment\n  );\n  if (!updatedComments.some((comment) => comment.deletedAt === void 0)) {\n    return {\n      ...thread,\n      deletedAt,\n      updatedAt: deletedAt,\n      comments: []\n    };\n  }\n  return {\n    ...thread,\n    updatedAt: deletedAt,\n    comments: updatedComments\n  };\n}\nfunction addReaction(thread, commentId, reaction) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      reactions: upsertReaction(comment.reactions, reaction)\n    } : comment\n  );\n  return {\n    ...thread,\n    updatedAt: new Date(\n      Math.max(reaction.createdAt.getTime(), thread.updatedAt?.getTime() || 0)\n    ),\n    comments: updatedComments\n  };\n}\nfunction removeReaction(thread, commentId, emoji, userId, removedAt) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      reactions: comment.reactions.map(\n        (reaction) => reaction.emoji === emoji ? {\n          ...reaction,\n          users: reaction.users.filter((user) => user.id !== userId)\n        } : reaction\n      ).filter((reaction) => reaction.users.length > 0)\n      // Remove reactions with no users left\n    } : comment\n  );\n  return {\n    ...thread,\n    updatedAt: new Date(\n      Math.max(removedAt.getTime(), thread.updatedAt?.getTime() || 0)\n    ),\n    comments: updatedComments\n  };\n}\nfunction upsertReaction(reactions, reaction) {\n  const existingReaction = reactions.find(\n    (existingReaction2) => existingReaction2.emoji === reaction.emoji\n  );\n  if (existingReaction === void 0) {\n    return [\n      ...reactions,\n      {\n        emoji: reaction.emoji,\n        createdAt: reaction.createdAt,\n        users: [{ id: reaction.userId }]\n      }\n    ];\n  }\n  if (existingReaction.users.some((user) => user.id === reaction.userId) === false) {\n    return reactions.map(\n      (existingReaction2) => existingReaction2.emoji === reaction.emoji ? {\n        ...existingReaction2,\n        users: [...existingReaction2.users, { id: reaction.userId }]\n      } : existingReaction2\n    );\n  }\n  return reactions;\n}\n\n// src/client.ts\nvar MIN_THROTTLE = 16;\nvar MAX_THROTTLE = 1e3;\nvar DEFAULT_THROTTLE = 100;\nvar MIN_BACKGROUND_KEEP_ALIVE_TIMEOUT = 15e3;\nvar MIN_LOST_CONNECTION_TIMEOUT = 200;\nvar RECOMMENDED_MIN_LOST_CONNECTION_TIMEOUT = 1e3;\nvar MAX_LOST_CONNECTION_TIMEOUT = 3e4;\nvar DEFAULT_LOST_CONNECTION_TIMEOUT = 5e3;\nvar RESOLVE_USERS_BATCH_DELAY = 50;\nvar RESOLVE_ROOMS_INFO_BATCH_DELAY = 50;\nfunction getBaseUrl(baseUrl) {\n  if (typeof baseUrl === \"string\" && baseUrl.startsWith(\"http\")) {\n    return baseUrl;\n  } else {\n    return DEFAULT_BASE_URL;\n  }\n}\nfunction getAuthBearerHeaderFromAuthValue(authValue) {\n  if (authValue.type === \"public\") {\n    return authValue.publicApiKey;\n  } else {\n    return authValue.token.raw;\n  }\n}\nfunction createClient(options) {\n  const clientOptions = options;\n  const throttleDelay = getThrottle(clientOptions.throttle ?? DEFAULT_THROTTLE);\n  const lostConnectionTimeout = getLostConnectionTimeout(\n    clientOptions.lostConnectionTimeout ?? DEFAULT_LOST_CONNECTION_TIMEOUT\n  );\n  const backgroundKeepAliveTimeout = getBackgroundKeepAliveTimeout(\n    clientOptions.backgroundKeepAliveTimeout\n  );\n  const baseUrl = getBaseUrl(clientOptions.baseUrl);\n  const authManager = createAuthManager(options);\n  const roomsById = /* @__PURE__ */ new Map();\n  function teardownRoom(room) {\n    unlinkDevTools(room.id);\n    roomsById.delete(room.id);\n    room.destroy();\n  }\n  function leaseRoom(details) {\n    const leave = () => {\n      const self = leave;\n      if (!details.unsubs.delete(self)) {\n        warn(\n          \"This leave function was already called. Calling it more than once has no effect.\"\n        );\n      } else {\n        if (details.unsubs.size === 0) {\n          teardownRoom(details.room);\n        }\n      }\n    };\n    details.unsubs.add(leave);\n    return {\n      room: details.room,\n      leave\n    };\n  }\n  function enterRoom(roomId, ...args) {\n    const existing = roomsById.get(roomId);\n    if (existing !== void 0) {\n      return leaseRoom(existing);\n    }\n    const options2 = args[0] ?? {};\n    const initialPresence = (typeof options2.initialPresence === \"function\" ? options2.initialPresence(roomId) : options2.initialPresence) ?? {};\n    const initialStorage = (typeof options2.initialStorage === \"function\" ? options2.initialStorage(roomId) : options2.initialStorage) ?? {};\n    const newRoom = createRoom(\n      { initialPresence, initialStorage },\n      {\n        roomId,\n        throttleDelay,\n        lostConnectionTimeout,\n        backgroundKeepAliveTimeout,\n        polyfills: clientOptions.polyfills,\n        delegates: clientOptions.mockedDelegates ?? {\n          createSocket: makeCreateSocketDelegateForRoom(\n            roomId,\n            baseUrl,\n            clientOptions.polyfills?.WebSocket\n          ),\n          authenticate: makeAuthDelegateForRoom(roomId, authManager)\n        },\n        enableDebugLogging: clientOptions.enableDebugLogging,\n        unstable_batchedUpdates: options2?.unstable_batchedUpdates,\n        baseUrl,\n        unstable_fallbackToHTTP: !!clientOptions.unstable_fallbackToHTTP,\n        unstable_streamData: !!clientOptions.unstable_streamData\n      }\n    );\n    const newRoomDetails = {\n      room: newRoom,\n      unsubs: /* @__PURE__ */ new Set()\n    };\n    roomsById.set(roomId, newRoomDetails);\n    setupDevTools(() => Array.from(roomsById.keys()));\n    linkDevTools(roomId, newRoom);\n    const shouldConnect = options2.autoConnect ?? true;\n    if (shouldConnect) {\n      if (typeof atob === \"undefined\") {\n        if (clientOptions.polyfills?.atob === void 0) {\n          throw new Error(\n            \"You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill\"\n          );\n        }\n        global.atob = clientOptions.polyfills.atob;\n      }\n      newRoom.connect();\n    }\n    return leaseRoom(newRoomDetails);\n  }\n  function getRoom(roomId) {\n    const room = roomsById.get(roomId)?.room;\n    return room ? room : null;\n  }\n  function logout() {\n    authManager.reset();\n    for (const { room } of roomsById.values()) {\n      if (!isIdle(room.getStatus())) {\n        room.reconnect();\n      }\n    }\n  }\n  const currentUserIdStore = createStore(null);\n  const {\n    getInboxNotifications,\n    getInboxNotificationsSince,\n    getUnreadInboxNotificationsCount,\n    markAllInboxNotificationsAsRead,\n    markInboxNotificationAsRead,\n    deleteAllInboxNotifications,\n    deleteInboxNotification\n  } = createNotificationsApi({\n    baseUrl,\n    fetcher: clientOptions.polyfills?.fetch || /* istanbul ignore next */\n    fetch,\n    authManager,\n    currentUserIdStore\n  });\n  const cacheStore = createClientStore();\n  const resolveUsers = clientOptions.resolveUsers;\n  const warnIfNoResolveUsers = createDevelopmentWarning(\n    () => !resolveUsers,\n    \"Set the resolveUsers option in createClient to specify user info.\"\n  );\n  const usersStore = createBatchStore(\n    async (batchedUserIds) => {\n      const userIds = batchedUserIds.flat();\n      const users = await resolveUsers?.({ userIds });\n      warnIfNoResolveUsers();\n      return users ?? userIds.map(() => void 0);\n    },\n    { delay: RESOLVE_USERS_BATCH_DELAY }\n  );\n  const resolveRoomsInfo = clientOptions.resolveRoomsInfo;\n  const warnIfNoResolveRoomsInfo = createDevelopmentWarning(\n    () => !resolveRoomsInfo,\n    \"Set the resolveRoomsInfo option in createClient to specify room info.\"\n  );\n  const roomsInfoStore = createBatchStore(\n    async (batchedRoomIds) => {\n      const roomIds = batchedRoomIds.flat();\n      const roomsInfo = await resolveRoomsInfo?.({ roomIds });\n      warnIfNoResolveRoomsInfo();\n      return roomsInfo ?? roomIds.map(() => void 0);\n    },\n    { delay: RESOLVE_ROOMS_INFO_BATCH_DELAY }\n  );\n  return Object.defineProperty(\n    {\n      enterRoom,\n      getRoom,\n      logout,\n      getInboxNotifications,\n      getInboxNotificationsSince,\n      getUnreadInboxNotificationsCount,\n      markAllInboxNotificationsAsRead,\n      markInboxNotificationAsRead,\n      deleteAllInboxNotifications,\n      deleteInboxNotification,\n      // Internal\n      [kInternal]: {\n        currentUserIdStore,\n        resolveMentionSuggestions: clientOptions.resolveMentionSuggestions,\n        cacheStore,\n        usersStore,\n        roomsInfoStore,\n        getRoomIds() {\n          return Array.from(roomsById.keys());\n        }\n      }\n    },\n    kInternal,\n    {\n      enumerable: false\n    }\n  );\n}\nvar NotificationsApiError = class extends Error {\n  constructor(message, status, details) {\n    super(message);\n    this.message = message;\n    this.status = status;\n    this.details = details;\n  }\n};\nfunction checkBounds(option, value, min, max, recommendedMin) {\n  if (typeof value !== \"number\" || value < min || max !== void 0 && value > max) {\n    throw new Error(\n      max !== void 0 ? `${option} should be between ${recommendedMin ?? min} and ${max}.` : `${option} should be at least ${recommendedMin ?? min}.`\n    );\n  }\n  return value;\n}\nfunction getBackgroundKeepAliveTimeout(value) {\n  if (value === void 0) return void 0;\n  return checkBounds(\n    \"backgroundKeepAliveTimeout\",\n    value,\n    MIN_BACKGROUND_KEEP_ALIVE_TIMEOUT\n  );\n}\nfunction getThrottle(value) {\n  return checkBounds(\"throttle\", value, MIN_THROTTLE, MAX_THROTTLE);\n}\nfunction getLostConnectionTimeout(value) {\n  return checkBounds(\n    \"lostConnectionTimeout\",\n    value,\n    MIN_LOST_CONNECTION_TIMEOUT,\n    MAX_LOST_CONNECTION_TIMEOUT,\n    RECOMMENDED_MIN_LOST_CONNECTION_TIMEOUT\n  );\n}\nfunction createDevelopmentWarning(condition, ...args) {\n  let hasWarned = false;\n  if (true) {\n    return () => {\n      if (!hasWarned && (typeof condition === \"function\" ? condition() : condition)) {\n        warn(...args);\n        hasWarned = true;\n      }\n    };\n  } else {}\n}\n\n// src/comments/comment-body.ts\nfunction isCommentBodyParagraph(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyText(element) {\n  return !(\"type\" in element) && \"text\" in element && typeof element.text === \"string\";\n}\nfunction isCommentBodyMention(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyLink(element) {\n  return \"type\" in element && element.type === \"link\";\n}\nvar commentBodyElementsGuards = {\n  paragraph: isCommentBodyParagraph,\n  text: isCommentBodyText,\n  link: isCommentBodyLink,\n  mention: isCommentBodyMention\n};\nvar commentBodyElementsTypes = {\n  paragraph: \"block\",\n  text: \"inline\",\n  link: \"inline\",\n  mention: \"inline\"\n};\nfunction traverseCommentBody(body, elementOrVisitor, possiblyVisitor) {\n  if (!body || !body?.content) {\n    return;\n  }\n  const element = typeof elementOrVisitor === \"string\" ? elementOrVisitor : void 0;\n  const type = element ? commentBodyElementsTypes[element] : \"all\";\n  const guard = element ? commentBodyElementsGuards[element] : () => true;\n  const visitor = typeof elementOrVisitor === \"function\" ? elementOrVisitor : possiblyVisitor;\n  for (const block of body.content) {\n    if (type === \"all\" || type === \"block\") {\n      if (guard(block)) {\n        visitor?.(block);\n      }\n    }\n    if (type === \"all\" || type === \"inline\") {\n      for (const inline of block.children) {\n        if (guard(inline)) {\n          visitor?.(inline);\n        }\n      }\n    }\n  }\n}\nfunction getMentionedIdsFromCommentBody(body) {\n  const mentionedIds = /* @__PURE__ */ new Set();\n  traverseCommentBody(\n    body,\n    \"mention\",\n    (mention) => mentionedIds.add(mention.id)\n  );\n  return Array.from(mentionedIds);\n}\nasync function resolveUsersInCommentBody(body, resolveUsers) {\n  const resolvedUsers = /* @__PURE__ */ new Map();\n  if (!resolveUsers) {\n    return resolvedUsers;\n  }\n  const userIds = getMentionedIdsFromCommentBody(body);\n  const users = await resolveUsers({\n    userIds\n  });\n  for (const [index, userId] of userIds.entries()) {\n    const user = users?.[index];\n    if (user) {\n      resolvedUsers.set(userId, user);\n    }\n  }\n  return resolvedUsers;\n}\nvar htmlEscapables = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&#39;\"\n};\nvar htmlEscapablesRegex = new RegExp(\n  Object.keys(htmlEscapables).map((entity) => `\\\\${entity}`).join(\"|\"),\n  \"g\"\n);\nfunction htmlSafe(value) {\n  return new HtmlSafeString([String(value)], []);\n}\nfunction joinHtml(strings) {\n  if (strings.length <= 0) {\n    return new HtmlSafeString([\"\"], []);\n  }\n  return new HtmlSafeString(\n    [\"\", ...Array(strings.length - 1).fill(\"\"), \"\"],\n    strings\n  );\n}\nfunction escapeHtml(value) {\n  if (value instanceof HtmlSafeString) {\n    return value.toString();\n  }\n  if (Array.isArray(value)) {\n    return joinHtml(value).toString();\n  }\n  return String(value).replace(\n    htmlEscapablesRegex,\n    (character) => htmlEscapables[character]\n  );\n}\nvar HtmlSafeString = class {\n  constructor(strings, values) {\n    this._strings = strings;\n    this._values = values;\n  }\n  toString() {\n    return this._strings.reduce((result, str, i) => {\n      return result + escapeHtml(nn(this._values[i - 1])) + str;\n    });\n  }\n};\nfunction html(strings, ...values) {\n  return new HtmlSafeString(strings, values);\n}\nvar markdownEscapables = {\n  _: \"\\\\_\",\n  \"*\": \"\\\\*\",\n  \"#\": \"\\\\#\",\n  \"`\": \"\\\\`\",\n  \"~\": \"\\\\~\",\n  \"!\": \"\\\\!\",\n  \"|\": \"\\\\|\",\n  \"(\": \"\\\\(\",\n  \")\": \"\\\\)\",\n  \"{\": \"\\\\{\",\n  \"}\": \"\\\\}\",\n  \"[\": \"\\\\[\",\n  \"]\": \"\\\\]\"\n};\nvar markdownEscapablesRegex = new RegExp(\n  Object.keys(markdownEscapables).map((entity) => `\\\\${entity}`).join(\"|\"),\n  \"g\"\n);\nfunction joinMarkdown(strings) {\n  if (strings.length <= 0) {\n    return new MarkdownSafeString([\"\"], []);\n  }\n  return new MarkdownSafeString(\n    [\"\", ...Array(strings.length - 1).fill(\"\"), \"\"],\n    strings\n  );\n}\nfunction escapeMarkdown(value) {\n  if (value instanceof MarkdownSafeString) {\n    return value.toString();\n  }\n  if (Array.isArray(value)) {\n    return joinMarkdown(value).toString();\n  }\n  return String(value).replace(\n    markdownEscapablesRegex,\n    (character) => markdownEscapables[character]\n  );\n}\nvar MarkdownSafeString = class {\n  constructor(strings, values) {\n    this._strings = strings;\n    this._values = values;\n  }\n  toString() {\n    return this._strings.reduce((result, str, i) => {\n      return result + escapeMarkdown(nn(this._values[i - 1])) + str;\n    });\n  }\n};\nfunction markdown(strings, ...values) {\n  return new MarkdownSafeString(strings, values);\n}\nfunction toAbsoluteUrl(url) {\n  if (url.startsWith(\"http://\") || url.startsWith(\"https://\")) {\n    return url;\n  } else if (url.startsWith(\"www.\")) {\n    return \"https://\" + url;\n  }\n  return;\n}\nvar stringifyCommentBodyPlainElements = {\n  paragraph: ({ children }) => children,\n  text: ({ element }) => element.text,\n  link: ({ element }) => element.text ?? element.url,\n  mention: ({ element, user }) => {\n    return `@${user?.name ?? element.id}`;\n  }\n};\nvar stringifyCommentBodyHtmlElements = {\n  paragraph: ({ children }) => {\n    return children ? html`<p>${htmlSafe(children)}</p>` : children;\n  },\n  text: ({ element }) => {\n    let children = element.text;\n    if (!children) {\n      return children;\n    }\n    if (element.bold) {\n      children = html`<strong>${children}</strong>`;\n    }\n    if (element.italic) {\n      children = html`<em>${children}</em>`;\n    }\n    if (element.strikethrough) {\n      children = html`<s>${children}</s>`;\n    }\n    if (element.code) {\n      children = html`<code>${children}</code>`;\n    }\n    return children;\n  },\n  link: ({ element, href }) => {\n    return html`<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${element.text ?? element.url}</a>`;\n  },\n  mention: ({ element, user }) => {\n    return html`<span data-mention>@${user?.name ?? element.id}</span>`;\n  }\n};\nvar stringifyCommentBodyMarkdownElements = {\n  paragraph: ({ children }) => {\n    return children;\n  },\n  text: ({ element }) => {\n    let children = element.text;\n    if (!children) {\n      return children;\n    }\n    if (element.bold) {\n      children = markdown`**${children}**`;\n    }\n    if (element.italic) {\n      children = markdown`_${children}_`;\n    }\n    if (element.strikethrough) {\n      children = markdown`~~${children}~~`;\n    }\n    if (element.code) {\n      children = markdown`\\`${children}\\``;\n    }\n    return children;\n  },\n  link: ({ element, href }) => {\n    return markdown`[${element.text ?? element.url}](${href})`;\n  },\n  mention: ({ element, user }) => {\n    return markdown`@${user?.name ?? element.id}`;\n  }\n};\nasync function stringifyCommentBody(body, options) {\n  const format = options?.format ?? \"plain\";\n  const separator = options?.separator ?? (format === \"markdown\" ? \"\\n\\n\" : \"\\n\");\n  const elements = {\n    ...format === \"html\" ? stringifyCommentBodyHtmlElements : format === \"markdown\" ? stringifyCommentBodyMarkdownElements : stringifyCommentBodyPlainElements,\n    ...options?.elements\n  };\n  const resolvedUsers = await resolveUsersInCommentBody(\n    body,\n    options?.resolveUsers\n  );\n  const blocks = body.content.flatMap((block, blockIndex) => {\n    switch (block.type) {\n      case \"paragraph\": {\n        const inlines = block.children.flatMap((inline, inlineIndex) => {\n          if (isCommentBodyMention(inline)) {\n            return inline.id ? [\n              elements.mention(\n                {\n                  element: inline,\n                  user: resolvedUsers.get(inline.id)\n                },\n                inlineIndex\n              )\n            ] : [];\n          }\n          if (isCommentBodyLink(inline)) {\n            return [\n              elements.link(\n                {\n                  element: inline,\n                  href: toAbsoluteUrl(inline.url) ?? inline.url\n                },\n                inlineIndex\n              )\n            ];\n          }\n          if (isCommentBodyText(inline)) {\n            return [elements.text({ element: inline }, inlineIndex)];\n          }\n          return [];\n        });\n        return [\n          elements.paragraph(\n            { element: block, children: inlines.join(\"\") },\n            blockIndex\n          )\n        ];\n      }\n      default:\n        return [];\n    }\n  });\n  return blocks.join(separator);\n}\n\n// src/crdts/utils.ts\nfunction toPlainLson(lson) {\n  if (lson instanceof LiveObject) {\n    return {\n      liveblocksType: \"LiveObject\",\n      data: Object.fromEntries(\n        Object.entries(lson.toObject()).flatMap(\n          ([key, value]) => value !== void 0 ? [[key, toPlainLson(value)]] : []\n        )\n      )\n    };\n  } else if (lson instanceof LiveMap) {\n    return {\n      liveblocksType: \"LiveMap\",\n      data: Object.fromEntries(\n        [...lson].map(([key, value]) => [key, toPlainLson(value)])\n      )\n    };\n  } else if (lson instanceof LiveList) {\n    return {\n      liveblocksType: \"LiveList\",\n      data: [...lson].map((item) => toPlainLson(item))\n    };\n  } else {\n    return lson;\n  }\n}\n\n// src/immutable.ts\nfunction lsonObjectToJson(obj) {\n  const result = {};\n  for (const key in obj) {\n    const val = obj[key];\n    if (val !== void 0) {\n      result[key] = lsonToJson(val);\n    }\n  }\n  return result;\n}\nfunction liveObjectToJson(liveObject) {\n  return lsonObjectToJson(liveObject.toObject());\n}\nfunction liveMapToJson(map) {\n  const result = {};\n  for (const [key, value] of map.entries()) {\n    result[key] = lsonToJson(value);\n  }\n  return result;\n}\nfunction lsonListToJson(value) {\n  return value.map(lsonToJson);\n}\nfunction liveListToJson(value) {\n  return lsonListToJson(value.toArray());\n}\nfunction lsonToJson(value) {\n  if (value instanceof LiveObject) {\n    return liveObjectToJson(value);\n  } else if (value instanceof LiveList) {\n    return liveListToJson(value);\n  } else if (value instanceof LiveMap) {\n    return liveMapToJson(value);\n  } else if (value instanceof LiveRegister) {\n    return value.data;\n  }\n  if (Array.isArray(value)) {\n    return lsonListToJson(value);\n  } else if (isPlainObject(value)) {\n    return lsonObjectToJson(value);\n  }\n  return value;\n}\nfunction deepLiveify(value) {\n  if (Array.isArray(value)) {\n    return new LiveList(value.map(deepLiveify));\n  } else if (isPlainObject(value)) {\n    const init = {};\n    for (const key in value) {\n      const val = value[key];\n      if (val === void 0) {\n        continue;\n      }\n      init[key] = deepLiveify(val);\n    }\n    return new LiveObject(init);\n  } else {\n    return value;\n  }\n}\nfunction patchLiveList(liveList, prev, next) {\n  let i = 0;\n  let prevEnd = prev.length - 1;\n  let nextEnd = next.length - 1;\n  let prevNode = prev[0];\n  let nextNode = next[0];\n  outer: {\n    while (prevNode === nextNode) {\n      ++i;\n      if (i > prevEnd || i > nextEnd) {\n        break outer;\n      }\n      prevNode = prev[i];\n      nextNode = next[i];\n    }\n    prevNode = prev[prevEnd];\n    nextNode = next[nextEnd];\n    while (prevNode === nextNode) {\n      prevEnd--;\n      nextEnd--;\n      if (i > prevEnd || i > nextEnd) {\n        break outer;\n      }\n      prevNode = prev[prevEnd];\n      nextNode = next[nextEnd];\n    }\n  }\n  if (i > prevEnd) {\n    if (i <= nextEnd) {\n      while (i <= nextEnd) {\n        liveList.insert(deepLiveify(next[i]), i);\n        i++;\n      }\n    }\n  } else if (i > nextEnd) {\n    let localI = i;\n    while (localI <= prevEnd) {\n      liveList.delete(i);\n      localI++;\n    }\n  } else {\n    while (i <= prevEnd && i <= nextEnd) {\n      prevNode = prev[i];\n      nextNode = next[i];\n      const liveListNode = liveList.get(i);\n      if (isLiveObject(liveListNode) && isPlainObject(prevNode) && isPlainObject(nextNode)) {\n        patchLiveObject(liveListNode, prevNode, nextNode);\n      } else {\n        liveList.set(i, deepLiveify(nextNode));\n      }\n      i++;\n    }\n    while (i <= nextEnd) {\n      liveList.insert(deepLiveify(next[i]), i);\n      i++;\n    }\n    let localI = i;\n    while (localI <= prevEnd) {\n      liveList.delete(i);\n      localI++;\n    }\n  }\n}\nfunction patchLiveObjectKey(liveObject, key, prev, next) {\n  if (true) {\n    const nonSerializableValue = findNonSerializableValue(next);\n    if (nonSerializableValue) {\n      error2(\n        `New state path: '${nonSerializableValue.path}' value: '${String(\n          nonSerializableValue.value\n        )}' is not serializable.\nOnly serializable value can be synced with Liveblocks.`\n      );\n      return;\n    }\n  }\n  const value = liveObject.get(key);\n  if (next === void 0) {\n    liveObject.delete(key);\n  } else if (value === void 0) {\n    liveObject.set(key, deepLiveify(next));\n  } else if (prev === next) {\n    return;\n  } else if (isLiveList(value) && Array.isArray(prev) && Array.isArray(next)) {\n    patchLiveList(value, prev, next);\n  } else if (isLiveObject(value) && isPlainObject(prev) && isPlainObject(next)) {\n    patchLiveObject(value, prev, next);\n  } else {\n    liveObject.set(key, deepLiveify(next));\n  }\n}\nfunction patchLiveObject(root, prev, next) {\n  const updates = {};\n  for (const key in next) {\n    patchLiveObjectKey(root, key, prev[key], next[key]);\n  }\n  for (const key in prev) {\n    if (next[key] === void 0) {\n      root.delete(key);\n    }\n  }\n  if (Object.keys(updates).length > 0) {\n    root.update(updates);\n  }\n}\nfunction getParentsPath(node) {\n  const path = [];\n  while (node.parent.type === \"HasParent\") {\n    if (isLiveList(node.parent.node)) {\n      path.push(node.parent.node._indexOfPosition(node.parent.key));\n    } else {\n      path.push(node.parent.key);\n    }\n    node = node.parent.node;\n  }\n  return path;\n}\nfunction legacy_patchImmutableObject(state, updates) {\n  return updates.reduce(\n    (state2, update) => legacy_patchImmutableObjectWithUpdate(state2, update),\n    state\n  );\n}\nfunction legacy_patchImmutableObjectWithUpdate(state, update) {\n  const path = getParentsPath(update.node);\n  return legacy_patchImmutableNode(state, path, update);\n}\nfunction legacy_patchImmutableNode(state, path, update) {\n  const pathItem = path.pop();\n  if (pathItem === void 0) {\n    switch (update.type) {\n      case \"LiveObject\": {\n        if (!isJsonObject(state)) {\n          throw new Error(\n            \"Internal: received update on LiveObject but state was not an object\"\n          );\n        }\n        const newState = Object.assign({}, state);\n        for (const key in update.updates) {\n          if (update.updates[key]?.type === \"update\") {\n            const val = update.node.get(key);\n            if (val !== void 0) {\n              newState[key] = lsonToJson(val);\n            }\n          } else if (update.updates[key]?.type === \"delete\") {\n            delete newState[key];\n          }\n        }\n        return newState;\n      }\n      case \"LiveList\": {\n        if (!Array.isArray(state)) {\n          throw new Error(\n            \"Internal: received update on LiveList but state was not an array\"\n          );\n        }\n        let newState = state.map((x) => x);\n        for (const listUpdate of update.updates) {\n          if (listUpdate.type === \"set\") {\n            newState = newState.map(\n              (item, index) => index === listUpdate.index ? lsonToJson(listUpdate.item) : item\n            );\n          } else if (listUpdate.type === \"insert\") {\n            if (listUpdate.index === newState.length) {\n              newState.push(lsonToJson(listUpdate.item));\n            } else {\n              newState = [\n                ...newState.slice(0, listUpdate.index),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index)\n              ];\n            }\n          } else if (listUpdate.type === \"delete\") {\n            newState.splice(listUpdate.index, 1);\n          } else if (listUpdate.type === \"move\") {\n            if (listUpdate.previousIndex > listUpdate.index) {\n              newState = [\n                ...newState.slice(0, listUpdate.index),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index, listUpdate.previousIndex),\n                ...newState.slice(listUpdate.previousIndex + 1)\n              ];\n            } else {\n              newState = [\n                ...newState.slice(0, listUpdate.previousIndex),\n                ...newState.slice(\n                  listUpdate.previousIndex + 1,\n                  listUpdate.index + 1\n                ),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index + 1)\n              ];\n            }\n          }\n        }\n        return newState;\n      }\n      case \"LiveMap\": {\n        if (!isJsonObject(state)) {\n          throw new Error(\n            \"Internal: received update on LiveMap but state was not an object\"\n          );\n        }\n        const newState = Object.assign({}, state);\n        for (const key in update.updates) {\n          if (update.updates[key]?.type === \"update\") {\n            const value = update.node.get(key);\n            if (value !== void 0) {\n              newState[key] = lsonToJson(value);\n            }\n          } else if (update.updates[key]?.type === \"delete\") {\n            delete newState[key];\n          }\n        }\n        return newState;\n      }\n    }\n  }\n  if (Array.isArray(state)) {\n    const newArray = [...state];\n    newArray[pathItem] = legacy_patchImmutableNode(\n      state[pathItem],\n      path,\n      update\n    );\n    return newArray;\n  } else if (isJsonObject(state)) {\n    const node = state[pathItem];\n    if (node === void 0) {\n      return state;\n    } else {\n      const stateAsObj = state;\n      return {\n        ...stateAsObj,\n        [pathItem]: legacy_patchImmutableNode(node, path, update)\n      };\n    }\n  } else {\n    return state;\n  }\n}\n\n// src/lib/deprecation.ts\nvar _emittedDeprecationWarnings = /* @__PURE__ */ new Set();\nfunction deprecate(message, key = message) {\n  if (true) {\n    if (!_emittedDeprecationWarnings.has(key)) {\n      _emittedDeprecationWarnings.add(key);\n      errorWithTitle(\"Deprecation warning\", message);\n    }\n  }\n}\nfunction deprecateIf(condition, message, key = message) {\n  if (true) {\n    if (condition) {\n      deprecate(message, key);\n    }\n  }\n}\nfunction throwUsageError(message) {\n  if (true) {\n    const usageError = new Error(message);\n    usageError.name = \"Usage error\";\n    errorWithTitle(\"Usage error\", message);\n    throw usageError;\n  }\n}\nfunction errorIf(condition, message) {\n  if (true) {\n    if (condition) {\n      throwUsageError(message);\n    }\n  }\n}\n\n// src/lib/Poller.ts\nfunction makePoller(callback) {\n  let context = {\n    state: \"stopped\",\n    timeoutHandle: null,\n    interval: null,\n    lastScheduledAt: null,\n    remainingInterval: null\n  };\n  function poll() {\n    if (context.state === \"running\") {\n      schedule(context.interval);\n    }\n    void callback();\n  }\n  function schedule(interval) {\n    context = {\n      state: \"running\",\n      interval: context.state !== \"stopped\" ? context.interval : interval,\n      lastScheduledAt: performance.now(),\n      timeoutHandle: setTimeout(poll, interval),\n      remainingInterval: null\n    };\n  }\n  function scheduleRemaining(remaining) {\n    if (context.state !== \"paused\") {\n      return;\n    }\n    context = {\n      state: \"running\",\n      interval: context.interval,\n      lastScheduledAt: context.lastScheduledAt,\n      timeoutHandle: setTimeout(poll, remaining),\n      remainingInterval: null\n    };\n  }\n  function start(interval) {\n    if (context.state === \"running\") {\n      return;\n    }\n    schedule(interval);\n  }\n  function restart(interval) {\n    stop();\n    start(interval);\n  }\n  function pause() {\n    if (context.state !== \"running\") {\n      return;\n    }\n    clearTimeout(context.timeoutHandle);\n    context = {\n      state: \"paused\",\n      interval: context.interval,\n      lastScheduledAt: context.lastScheduledAt,\n      timeoutHandle: null,\n      remainingInterval: context.interval - (performance.now() - context.lastScheduledAt)\n    };\n  }\n  function resume() {\n    if (context.state !== \"paused\") {\n      return;\n    }\n    scheduleRemaining(context.remainingInterval);\n  }\n  function stop() {\n    if (context.state === \"stopped\") {\n      return;\n    }\n    if (context.timeoutHandle) {\n      clearTimeout(context.timeoutHandle);\n    }\n    context = {\n      state: \"stopped\",\n      interval: null,\n      lastScheduledAt: null,\n      timeoutHandle: null,\n      remainingInterval: null\n    };\n  }\n  return {\n    start,\n    restart,\n    pause,\n    resume,\n    stop\n  };\n}\n\n// src/lib/shallow.ts\nfunction shallowArray(xs, ys) {\n  if (xs.length !== ys.length) {\n    return false;\n  }\n  for (let i = 0; i < xs.length; i++) {\n    if (!Object.is(xs[i], ys[i])) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction shallowObj(objA, objB) {\n  if (typeof objA !== \"object\" || objA === null || typeof objB !== \"object\" || objB === null || Object.prototype.toString.call(objA) !== \"[object Object]\" || Object.prototype.toString.call(objB) !== \"[object Object]\") {\n    return false;\n  }\n  const keysA = Object.keys(objA);\n  if (keysA.length !== Object.keys(objB).length) {\n    return false;\n  }\n  return keysA.every(\n    (key) => Object.prototype.hasOwnProperty.call(objB, key) && Object.is(objA[key], objB[key])\n  );\n}\nfunction shallow(a, b) {\n  if (Object.is(a, b)) {\n    return true;\n  }\n  const isArrayA = Array.isArray(a);\n  const isArrayB = Array.isArray(b);\n  if (isArrayA || isArrayB) {\n    if (!isArrayA || !isArrayB) {\n      return false;\n    }\n    return shallowArray(a, b);\n  }\n  return shallowObj(a, b);\n}\n\n// src/index.ts\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9jb3JlL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixrQ0FBa0M7QUFDaEU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxLQUFxQyxFQUFFLEVBRTFDLENBQUM7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLHFCQUFxQixHQUFHLFVBQVU7QUFDeEU7QUFDQTtBQUNBLElBQUk7QUFDSixJQUFJO0FBQ0o7QUFDQSxxR0FBcUcsa0JBQWtCO0FBQ3ZIO0FBQ0E7QUFDQSxXQUFXLFNBQVMsRUFBRSxVQUFVO0FBQ2hDLFdBQVcsU0FBUyxFQUFFLGNBQWM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLHdCQUF3QjtBQUMzRztBQUNBO0FBQ0EsYUFBYSxVQUFVLFFBQVEsWUFBWTtBQUMzQyxhQUFhLFNBQVMsUUFBUSxXQUFXO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxJQUFxQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxnQ0FBZ0MscUJBQXFCLFdBQVcsZ0JBQWdCLHVCQUF1QixnQkFBZ0I7QUFDdkg7QUFDQTtBQUNBLDBDQUEwQyxhQUFvQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxhQUFvQjtBQUM5RDtBQUNBO0FBQ0Esd0JBQXdCLE1BQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsaUJBQWlCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsa0JBQWtCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsZUFBZTtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsd0JBQXdCO0FBQ3REO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLDZCQUE2QjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsOEJBQThCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLEtBQUssUUFBUSxTQUFTLFVBQVUsY0FBYztBQUN2RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLGVBQWU7QUFDekMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsWUFBWTtBQUNsQztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLDJCQUEyQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCwwQkFBMEI7QUFDNUU7QUFDQSwwQ0FBMEMsK0JBQStCO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMscUJBQXFCOztBQUV0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQywyQkFBMkI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLFNBQVMsR0FBRyxlQUFlO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLE1BQXFDO0FBQzNDO0FBQ0E7QUFDQSxnQkFBZ0Isd0RBQXdEO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsTUFBTSxNQUFxQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMkJBQTJCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLDRHQUE0RyxhQUFhLFlBQVksZUFBZTtBQUNwSjtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxpQkFBaUI7QUFDckQ7QUFDQSxvQ0FBb0MsZ0NBQWdDO0FBQ3BFLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLFNBQVM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsNENBQTRDO0FBQzdFO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1FQUFtRTtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFFBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsNkJBQTZCLDZCQUE2QjtBQUMxRCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLDZCQUE2QixzQkFBc0I7QUFDbkQsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLHdDQUF3QztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsRUFBRTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IscUJBQXFCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGFBQWE7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGdCQUFnQjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsY0FBYztBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixtQ0FBbUM7QUFDNUQ7QUFDQSwrQkFBK0Isa0JBQWtCO0FBQ2pEO0FBQ0EseUJBQXlCLGtDQUFrQztBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsZ0JBQWdCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxQkFBcUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0Msa0JBQWtCLElBQUk7QUFDNUQsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixvQkFBb0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxvQkFBb0I7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isb0JBQW9CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscUJBQXFCO0FBQ2pDO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLCtCQUErQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscUJBQXFCO0FBQ2pDO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsK0JBQStCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxNQUFNLG1DQUFtQyxtQkFBbUI7QUFDMUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLCtCQUErQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE1BQU0sbUNBQW1DLHVCQUF1QjtBQUM3RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLE1BQU0sbUNBQW1DLHVCQUF1QjtBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxNQUFxQyxHQUFHLENBQU07QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQSxhQUFhLE1BQXFDO0FBQ2xEO0FBQ0EsRUFBRSxDQUFRO0FBQ1Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxzQkFBc0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsUUFBUTtBQUNSLGlCQUFpQjtBQUNqQjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLG1CQUFtQiwrQkFBK0I7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFNBQVM7QUFDNUIsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsZUFBZTtBQUNoQztBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsU0FBUztBQUM1QixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsK0JBQStCO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFNBQVM7QUFDNUIsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwyQkFBMkI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sTUFBTTtBQUNOO0FBQ0EsZUFBZTtBQUNmLE1BQU07QUFDTixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sbUJBQW1CLGtEQUFrRDtBQUNyRSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSLHVCQUF1QiwwQ0FBMEM7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsTUFBTSxJQUFJO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixZQUFZO0FBQy9CLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixjQUFjO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQix5QkFBeUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsU0FBUztBQUMxQixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUiwwQkFBMEIsb0RBQW9EO0FBQzlFLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEVBQTBFLHFCQUFxQixPQUFPLEdBQUcsS0FBSztBQUM5RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE1BQXFDLEdBQUcsQ0FBTTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTyxHQUFHLFNBQVM7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsT0FBTyxzQkFBc0I7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTTtBQUNuQztBQUNBO0FBQ0E7QUFDQSxjQUFjLElBQUksR0FBRywwQkFBMEI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMscUJBQXFCOztBQUV0QjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxVQUFVLHlCQUF5QjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsYUFBYSxHQUFHLFFBQVE7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGtCQUFrQjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLDBEQUEwRCxJQUFJO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLFFBQVE7QUFDUjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0MsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxjQUFjLElBQXFDO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsbUNBQW1DO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixnQkFBZ0I7QUFDakMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx3Q0FBd0M7QUFDeEUsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLHNCQUFzQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLElBQXFDO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsRUFBRSxnQ0FBZ0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0EseURBQXlELGVBQWU7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw4Q0FBOEM7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixzQkFBc0IsK0JBQStCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGFBQWE7QUFDcEM7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxtQkFBbUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFFQUFxRSxNQUFNO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFD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QVM7QUFDVDtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNEJBQTRCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsb0NBQW9DLGVBQWU7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxPQUFPLElBQUk7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsWUFBWSw0QkFBNEIsVUFBVTtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHFCQUFxQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxxQkFBcUI7QUFDbkUsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpQ0FBaUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLFNBQVM7QUFDcEQ7QUFDQTtBQUNBLEtBQUs7QUFDTCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELFNBQVM7QUFDNUQ7QUFDQTtBQUNBLEtBQUs7QUFDTCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsUUFBUSxvQkFBb0IsdUJBQXVCLE1BQU0sSUFBSSxRQUFRLFFBQVEscUJBQXFCLHNCQUFzQjtBQUNsSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxJQUFxQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLEtBQUssRUFHTjtBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFlBQVk7QUFDWixZQUFZO0FBQ1osY0FBYztBQUNkLGFBQWE7QUFDYjtBQUNBO0FBQ0EsbURBQW1ELE9BQU87QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxPQUFPO0FBQ1gsSUFBSSxPQUFPO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsT0FBTztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQixXQUFXLFNBQVM7QUFDcEIsV0FBVyxTQUFTO0FBQ3BCLGNBQWMsZUFBZTtBQUM3QixlQUFlLHlCQUF5QjtBQUN4QztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQixnQ0FBZ0MsbUJBQW1CO0FBQ25ELEdBQUc7QUFDSCxXQUFXLFNBQVM7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxTQUFTO0FBQ3pDO0FBQ0E7QUFDQSw0QkFBNEIsU0FBUztBQUNyQztBQUNBO0FBQ0EsMkJBQTJCLFNBQVM7QUFDcEM7QUFDQTtBQUNBLDhCQUE4QixTQUFTO0FBQ3ZDO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsV0FBVyxlQUFlO0FBQzFCLDJCQUEyQixLQUFLLDhDQUE4Qyw0QkFBNEI7QUFDMUcsR0FBRztBQUNILGNBQWMsZUFBZTtBQUM3QixzQ0FBc0MseUJBQXlCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0EsR0FBRztBQUNILFdBQVcsU0FBUztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFNBQVM7QUFDdkM7QUFDQTtBQUNBLDZCQUE2QixTQUFTO0FBQ3RDO0FBQ0E7QUFDQSw4QkFBOEIsU0FBUztBQUN2QztBQUNBO0FBQ0EsOEJBQThCLFNBQVM7QUFDdkM7QUFDQTtBQUNBLEdBQUc7QUFDSCxXQUFXLGVBQWU7QUFDMUIsdUJBQXVCLDRCQUE0QixJQUFJLEtBQUs7QUFDNUQsR0FBRztBQUNILGNBQWMsZUFBZTtBQUM3Qix1QkFBdUIseUJBQXlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxpQkFBaUI7QUFDckQ7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsY0FBYyw0Q0FBNEM7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLDBCQUEwQixZQUFZO0FBQ2xFO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTSxJQUFxQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxJQUFxQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGVBQWU7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBaUVFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9jb3JlL2Rpc3QvaW5kZXgubWpzP2ZhZGUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIF9fZGVmUHJvcCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTtcbnZhciBfX2V4cG9ydCA9ICh0YXJnZXQsIGFsbCkgPT4ge1xuICBmb3IgKHZhciBuYW1lIGluIGFsbClcbiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xufTtcblxuLy8gc3JjL3ZlcnNpb24udHNcbnZhciBQS0dfTkFNRSA9IFwiQGxpdmVibG9ja3MvY29yZVwiO1xudmFyIFBLR19WRVJTSU9OID0gXCIyLjQuMFwiO1xudmFyIFBLR19GT1JNQVQgPSBcImVzbVwiO1xuXG4vLyBzcmMvZHVwZS1kZXRlY3Rpb24udHNcbnZhciBnID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB7fTtcbnZhciBjcm9zc0xpbmtlZERvY3MgPSBcImh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2Vycm9ycy9jcm9zcy1saW5rZWRcIjtcbnZhciBkdXBlc0RvY3MgPSBcImh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2Vycm9ycy9kdXBlc1wiO1xudmFyIFNQQUNFID0gXCIgXCI7XG5mdW5jdGlvbiBlcnJvcihtc2cpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIikge1xuICAgIGNvbnNvbGUuZXJyb3IobXNnKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgfVxufVxuZnVuY3Rpb24gZGV0ZWN0RHVwZXMocGtnTmFtZSwgcGtnVmVyc2lvbiwgcGtnRm9ybWF0KSB7XG4gIGNvbnN0IHBrZ0lkID0gU3ltYm9sLmZvcihwa2dOYW1lKTtcbiAgY29uc3QgcGtnQnVpbGRJbmZvID0gcGtnRm9ybWF0ID8gYCR7cGtnVmVyc2lvbiB8fCBcImRldlwifSAoJHtwa2dGb3JtYXR9KWAgOiBwa2dWZXJzaW9uIHx8IFwiZGV2XCI7XG4gIGlmICghZ1twa2dJZF0pIHtcbiAgICBnW3BrZ0lkXSA9IHBrZ0J1aWxkSW5mbztcbiAgfSBlbHNlIGlmIChnW3BrZ0lkXSA9PT0gcGtnQnVpbGRJbmZvKSB7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgbXNnID0gW1xuICAgICAgYE11bHRpcGxlIGNvcGllcyBvZiBMaXZlYmxvY2tzIGFyZSBiZWluZyBsb2FkZWQgaW4geW91ciBwcm9qZWN0LiBUaGlzIHdpbGwgY2F1c2UgaXNzdWVzISBTZWUgJHtkdXBlc0RvY3MgKyBTUEFDRX1gLFxuICAgICAgXCJcIixcbiAgICAgIFwiQ29uZmxpY3RzOlwiLFxuICAgICAgYC0gJHtwa2dOYW1lfSAke2dbcGtnSWRdfSAoYWxyZWFkeSBsb2FkZWQpYCxcbiAgICAgIGAtICR7cGtnTmFtZX0gJHtwa2dCdWlsZEluZm99ICh0cnlpbmcgdG8gbG9hZCB0aGlzIG5vdylgXG4gICAgXS5qb2luKFwiXFxuXCIpO1xuICAgIGVycm9yKG1zZyk7XG4gIH1cbiAgaWYgKHBrZ1ZlcnNpb24gJiYgUEtHX1ZFUlNJT04gJiYgcGtnVmVyc2lvbiAhPT0gUEtHX1ZFUlNJT04pIHtcbiAgICBlcnJvcihcbiAgICAgIFtcbiAgICAgICAgYENyb3NzLWxpbmtlZCB2ZXJzaW9ucyBvZiBMaXZlYmxvY2tzIGZvdW5kLCB3aGljaCB3aWxsIGNhdXNlIGlzc3VlcyEgU2VlICR7Y3Jvc3NMaW5rZWREb2NzICsgU1BBQ0V9YCxcbiAgICAgICAgXCJcIixcbiAgICAgICAgXCJDb25mbGljdHM6XCIsXG4gICAgICAgIGAtICR7UEtHX05BTUV9IGlzIGF0ICR7UEtHX1ZFUlNJT059YCxcbiAgICAgICAgYC0gJHtwa2dOYW1lfSBpcyBhdCAke3BrZ1ZlcnNpb259YCxcbiAgICAgICAgXCJcIixcbiAgICAgICAgXCJBbHdheXMgdXBncmFkZSBhbGwgTGl2ZWJsb2NrcyBwYWNrYWdlcyB0byB0aGUgc2FtZSB2ZXJzaW9uIG51bWJlci5cIlxuICAgICAgXS5qb2luKFwiXFxuXCIpXG4gICAgKTtcbiAgfVxufVxuXG4vLyBzcmMvbGliL2Fzc2VydC50c1xuZnVuY3Rpb24gYXNzZXJ0TmV2ZXIoX3ZhbHVlLCBlcnJtc2cpIHtcbiAgdGhyb3cgbmV3IEVycm9yKGVycm1zZyk7XG59XG5mdW5jdGlvbiBhc3NlcnQoY29uZGl0aW9uLCBlcnJtc2cpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgIGlmICghY29uZGl0aW9uKSB7XG4gICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoZXJybXNnKTtcbiAgICAgIGVyci5uYW1lID0gXCJBc3NlcnRpb24gZmFpbHVyZVwiO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gbm4odmFsdWUsIGVycm1zZyA9IFwiRXhwZWN0ZWQgdmFsdWUgdG8gYmUgbm9uLW51bGxhYmxlXCIpIHtcbiAgYXNzZXJ0KHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDAsIGVycm1zZyk7XG4gIHJldHVybiB2YWx1ZTtcbn1cblxuLy8gc3JjL2xpYi9jb250cm9sbGVkUHJvbWlzZS50c1xuZnVuY3Rpb24gY29udHJvbGxlZFByb21pc2UoKSB7XG4gIGxldCByZXNvbHZlO1xuICBsZXQgcmVqZWN0O1xuICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgcmVzb2x2ZSA9IHJlcztcbiAgICByZWplY3QgPSByZWo7XG4gIH0pO1xuICByZXR1cm4gW3Byb21pc2UsIHJlc29sdmUsIHJlamVjdF07XG59XG5mdW5jdGlvbiBQcm9taXNlX3dpdGhSZXNvbHZlcnMoKSB7XG4gIGNvbnN0IFtwcm9taXNlLCByZXNvbHZlLCByZWplY3RdID0gY29udHJvbGxlZFByb21pc2UoKTtcbiAgcmV0dXJuIHsgcHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0IH07XG59XG5cbi8vIHNyYy9saWIvRXZlbnRTb3VyY2UudHNcbmZ1bmN0aW9uIG1ha2VFdmVudFNvdXJjZSgpIHtcbiAgY29uc3QgX29uZXRpbWVPYnNlcnZlcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICBjb25zdCBfb2JzZXJ2ZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgbGV0IF9idWZmZXIgPSBudWxsO1xuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBfYnVmZmVyID0gW107XG4gIH1cbiAgZnVuY3Rpb24gdW5wYXVzZSgpIHtcbiAgICBpZiAoX2J1ZmZlciA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIF9idWZmZXIpIHtcbiAgICAgIG5vdGlmeShldmVudCk7XG4gICAgfVxuICAgIF9idWZmZXIgPSBudWxsO1xuICB9XG4gIGZ1bmN0aW9uIHN1YnNjcmliZShjYWxsYmFjaykge1xuICAgIF9vYnNlcnZlcnMuYWRkKGNhbGxiYWNrKTtcbiAgICByZXR1cm4gKCkgPT4gX29ic2VydmVycy5kZWxldGUoY2FsbGJhY2spO1xuICB9XG4gIGZ1bmN0aW9uIHN1YnNjcmliZU9uY2UoY2FsbGJhY2spIHtcbiAgICBfb25ldGltZU9ic2VydmVycy5hZGQoY2FsbGJhY2spO1xuICAgIHJldHVybiAoKSA9PiBfb25ldGltZU9ic2VydmVycy5kZWxldGUoY2FsbGJhY2spO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHdhaXRVbnRpbChwcmVkaWNhdGUpIHtcbiAgICBsZXQgdW5zdWI7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMpID0+IHtcbiAgICAgIHVuc3ViID0gc3Vic2NyaWJlKChldmVudCkgPT4ge1xuICAgICAgICBpZiAocHJlZGljYXRlID09PSB2b2lkIDAgfHwgcHJlZGljYXRlKGV2ZW50KSkge1xuICAgICAgICAgIHJlcyhldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pLmZpbmFsbHkoKCkgPT4gdW5zdWI/LigpKTtcbiAgfVxuICBmdW5jdGlvbiBub3RpZnlPckJ1ZmZlcihldmVudCkge1xuICAgIGlmIChfYnVmZmVyICE9PSBudWxsKSB7XG4gICAgICBfYnVmZmVyLnB1c2goZXZlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub3RpZnkoZXZlbnQpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBub3RpZnkoZXZlbnQpIHtcbiAgICBfb25ldGltZU9ic2VydmVycy5mb3JFYWNoKChjYWxsYmFjaykgPT4gY2FsbGJhY2soZXZlbnQpKTtcbiAgICBfb25ldGltZU9ic2VydmVycy5jbGVhcigpO1xuICAgIF9vYnNlcnZlcnMuZm9yRWFjaCgoY2FsbGJhY2spID0+IGNhbGxiYWNrKGV2ZW50KSk7XG4gIH1cbiAgZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuY2xlYXIoKTtcbiAgICBfb2JzZXJ2ZXJzLmNsZWFyKCk7XG4gIH1cbiAgZnVuY3Rpb24gY291bnQoKSB7XG4gICAgcmV0dXJuIF9vbmV0aW1lT2JzZXJ2ZXJzLnNpemUgKyBfb2JzZXJ2ZXJzLnNpemU7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAvLyBQcml2YXRlL2ludGVybmFsIGNvbnRyb2wgb3ZlciBldmVudCBlbWlzc2lvblxuICAgIG5vdGlmeTogbm90aWZ5T3JCdWZmZXIsXG4gICAgc3Vic2NyaWJlLFxuICAgIHN1YnNjcmliZU9uY2UsXG4gICAgY2xlYXIsXG4gICAgY291bnQsXG4gICAgd2FpdFVudGlsLFxuICAgIHBhdXNlLFxuICAgIHVucGF1c2UsXG4gICAgLy8gUHVibGljbHkgZXhwb3NhYmxlIHN1YnNjcmlwdGlvbiBBUElcbiAgICBvYnNlcnZhYmxlOiB7XG4gICAgICBzdWJzY3JpYmUsXG4gICAgICBzdWJzY3JpYmVPbmNlLFxuICAgICAgd2FpdFVudGlsXG4gICAgfVxuICB9O1xufVxuXG4vLyBzcmMvbGliL2ZhbmN5LWNvbnNvbGUudHNcbnZhciBmYW5jeV9jb25zb2xlX2V4cG9ydHMgPSB7fTtcbl9fZXhwb3J0KGZhbmN5X2NvbnNvbGVfZXhwb3J0cywge1xuICBlcnJvcjogKCkgPT4gZXJyb3IyLFxuICBlcnJvcldpdGhUaXRsZTogKCkgPT4gZXJyb3JXaXRoVGl0bGUsXG4gIHdhcm46ICgpID0+IHdhcm4sXG4gIHdhcm5XaXRoVGl0bGU6ICgpID0+IHdhcm5XaXRoVGl0bGVcbn0pO1xudmFyIGJhZGdlID0gXCJiYWNrZ3JvdW5kOiMwZTBkMTI7Ym9yZGVyLXJhZGl1czo5OTk5cHg7Y29sb3I6I2ZmZjtwYWRkaW5nOjNweCA3cHg7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtmb250LXdlaWdodDo2MDA7XCI7XG52YXIgYm9sZCA9IFwiZm9udC13ZWlnaHQ6NjAwXCI7XG5mdW5jdGlvbiB3cmFwKG1ldGhvZCkge1xuICByZXR1cm4gdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIiB8fCBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJ0ZXN0XCIgPyBjb25zb2xlW21ldGhvZF0gOiAoXG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAobWVzc2FnZSwgLi4uYXJncykgPT4gY29uc29sZVttZXRob2RdKFwiJWNMaXZlYmxvY2tzXCIsIGJhZGdlLCBtZXNzYWdlLCAuLi5hcmdzKVxuICApO1xufVxudmFyIHdhcm4gPSB3cmFwKFwid2FyblwiKTtcbnZhciBlcnJvcjIgPSB3cmFwKFwiZXJyb3JcIik7XG5mdW5jdGlvbiB3cmFwV2l0aFRpdGxlKG1ldGhvZCkge1xuICByZXR1cm4gdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIiB8fCBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJ0ZXN0XCIgPyBjb25zb2xlW21ldGhvZF0gOiAoXG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAodGl0bGUsIG1lc3NhZ2UsIC4uLmFyZ3MpID0+IGNvbnNvbGVbbWV0aG9kXShcbiAgICAgIGAlY0xpdmVibG9ja3MlYyAke3RpdGxlfWAsXG4gICAgICBiYWRnZSxcbiAgICAgIGJvbGQsXG4gICAgICBtZXNzYWdlLFxuICAgICAgLi4uYXJnc1xuICAgIClcbiAgKTtcbn1cbnZhciB3YXJuV2l0aFRpdGxlID0gd3JhcFdpdGhUaXRsZShcIndhcm5cIik7XG52YXIgZXJyb3JXaXRoVGl0bGUgPSB3cmFwV2l0aFRpdGxlKFwiZXJyb3JcIik7XG5cbi8vIHNyYy9saWIvZnNtLnRzXG5mdW5jdGlvbiBkaXN0YW5jZShzdGF0ZTEsIHN0YXRlMikge1xuICBpZiAoc3RhdGUxID09PSBzdGF0ZTIpIHtcbiAgICByZXR1cm4gWzAsIDBdO1xuICB9XG4gIGNvbnN0IGNodW5rczEgPSBzdGF0ZTEuc3BsaXQoXCIuXCIpO1xuICBjb25zdCBjaHVua3MyID0gc3RhdGUyLnNwbGl0KFwiLlwiKTtcbiAgY29uc3QgbWluTGVuID0gTWF0aC5taW4oY2h1bmtzMS5sZW5ndGgsIGNodW5rczIubGVuZ3RoKTtcbiAgbGV0IHNoYXJlZCA9IDA7XG4gIGZvciAoOyBzaGFyZWQgPCBtaW5MZW47IHNoYXJlZCsrKSB7XG4gICAgaWYgKGNodW5rczFbc2hhcmVkXSAhPT0gY2h1bmtzMltzaGFyZWRdKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgY29uc3QgdXAgPSBjaHVua3MxLmxlbmd0aCAtIHNoYXJlZDtcbiAgY29uc3QgZG93biA9IGNodW5rczIubGVuZ3RoIC0gc2hhcmVkO1xuICByZXR1cm4gW3VwLCBkb3duXTtcbn1cbmZ1bmN0aW9uIHBhdHRlcm5zKHRhcmdldFN0YXRlLCBsZXZlbHMpIHtcbiAgY29uc3QgcGFydHMgPSB0YXJnZXRTdGF0ZS5zcGxpdChcIi5cIik7XG4gIGlmIChsZXZlbHMgPCAxIHx8IGxldmVscyA+IHBhcnRzLmxlbmd0aCArIDEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIG51bWJlciBvZiBsZXZlbHNcIik7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGlmIChsZXZlbHMgPiBwYXJ0cy5sZW5ndGgpIHtcbiAgICByZXN1bHQucHVzaChcIipcIik7XG4gIH1cbiAgZm9yIChsZXQgaSA9IHBhcnRzLmxlbmd0aCAtIGxldmVscyArIDE7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHNsaWNlID0gcGFydHMuc2xpY2UoMCwgaSk7XG4gICAgaWYgKHNsaWNlLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlc3VsdC5wdXNoKHNsaWNlLmpvaW4oXCIuXCIpICsgXCIuKlwiKTtcbiAgICB9XG4gIH1cbiAgcmVzdWx0LnB1c2godGFyZ2V0U3RhdGUpO1xuICByZXR1cm4gcmVzdWx0O1xufVxudmFyIFNhZmVDb250ZXh0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihpbml0aWFsQ29udGV4dCkge1xuICAgIHRoaXMuY3VyciA9IGluaXRpYWxDb250ZXh0O1xuICB9XG4gIGdldCBjdXJyZW50KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnI7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgYSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGFsbG93cyBwYXRjaGluZyBvZiB0aGUgY29udGV4dCwgYnlcbiAgICogY2FsbGluZyBgY29udGV4dC5wYXRjaCgpYC4gUGF0Y2hpbmcgaXMgb25seSBhbGxvd2VkIGZvciB0aGUgZHVyYXRpb25cbiAgICogb2YgdGhpcyB3aW5kb3cuXG4gICAqL1xuICBhbGxvd1BhdGNoaW5nKGNhbGxiYWNrKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGFsbG93ZWQgPSB0cnVlO1xuICAgIGNvbnN0IHBhdGNoYWJsZUNvbnRleHQgPSB7XG4gICAgICAuLi50aGlzLmN1cnIsXG4gICAgICBwYXRjaChwYXRjaCkge1xuICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgIHNlbGYuY3VyciA9IE9iamVjdC5hc3NpZ24oe30sIHNlbGYuY3VyciwgcGF0Y2gpO1xuICAgICAgICAgIGZvciAoY29uc3QgcGFpciBvZiBPYmplY3QuZW50cmllcyhwYXRjaCkpIHtcbiAgICAgICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHBhaXI7XG4gICAgICAgICAgICBpZiAoa2V5ICE9PSBcInBhdGNoXCIpIHtcbiAgICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbiBubyBsb25nZXIgcGF0Y2ggc3RhbGUgY29udGV4dFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgY2FsbGJhY2socGF0Y2hhYmxlQ29udGV4dCk7XG4gICAgYWxsb3dlZCA9IGZhbHNlO1xuICAgIHJldHVybjtcbiAgfVxufTtcbnZhciBuZXh0SWQgPSAxO1xudmFyIEZTTSA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGluaXRpYWwgc3RhdGUsIHdoaWNoIGlzIGRlZmluZWQgYnkgdGhlIGZpcnN0IGNhbGwgbWFkZSB0b1xuICAgKiAuYWRkU3RhdGUoKS5cbiAgICovXG4gIGdldCBpbml0aWFsU3RhdGUoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5zdGF0ZXMudmFsdWVzKClbU3ltYm9sLml0ZXJhdG9yXSgpLm5leHQoKTtcbiAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHN0YXRlcyBkZWZpbmVkIHlldFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbiAgICB9XG4gIH1cbiAgZ2V0IGN1cnJlbnRTdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5jdXJyZW50U3RhdGVPck51bGwgPT09IG51bGwpIHtcbiAgICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSA9PT0gMCAvKiBOT1RfU1RBUlRFRF9ZRVQgKi8pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm90IHN0YXJ0ZWQgeWV0XCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSBzdG9wcGVkXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jdXJyZW50U3RhdGVPck51bGw7XG4gIH1cbiAgLyoqXG4gICAqIFN0YXJ0cyB0aGUgbWFjaGluZSBieSBlbnRlcmluZyB0aGUgaW5pdGlhbCBzdGF0ZS5cbiAgICovXG4gIHN0YXJ0KCkge1xuICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSAhPT0gMCAvKiBOT1RfU1RBUlRFRF9ZRVQgKi8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0YXRlIG1hY2hpbmUgaGFzIGFscmVhZHkgc3RhcnRlZFwiKTtcbiAgICB9XG4gICAgdGhpcy5ydW5uaW5nU3RhdGUgPSAxIC8qIFNUQVJURUQgKi87XG4gICAgdGhpcy5jdXJyZW50U3RhdGVPck51bGwgPSB0aGlzLmluaXRpYWxTdGF0ZTtcbiAgICB0aGlzLmVudGVyKG51bGwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIC8qKlxuICAgKiBTdG9wcyB0aGUgc3RhdGUgbWFjaGluZS4gU3RvcHBpbmcgdGhlIHN0YXRlIG1hY2hpbmUgd2lsbCBjYWxsIGV4aXRcbiAgICogaGFuZGxlcnMgZm9yIHRoZSBjdXJyZW50IHN0YXRlLCBidXQgbm90IGVudGVyIGEgbmV3IHN0YXRlLlxuICAgKi9cbiAgc3RvcCgpIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgIT09IDEgLyogU1RBUlRFRCAqLykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHN0b3AgYSBzdGF0ZSBtYWNoaW5lIHRoYXQgaGFzbid0IHN0YXJ0ZWQgeWV0XCIpO1xuICAgIH1cbiAgICB0aGlzLmV4aXQobnVsbCk7XG4gICAgdGhpcy5ydW5uaW5nU3RhdGUgPSAyIC8qIFNUT1BQRUQgKi87XG4gICAgdGhpcy5jdXJyZW50U3RhdGVPck51bGwgPSBudWxsO1xuICB9XG4gIGNvbnN0cnVjdG9yKGluaXRpYWxDb250ZXh0KSB7XG4gICAgdGhpcy5pZCA9IG5leHRJZCsrO1xuICAgIHRoaXMucnVubmluZ1N0YXRlID0gMCAvKiBOT1RfU1RBUlRFRF9ZRVQgKi87XG4gICAgdGhpcy5jdXJyZW50U3RhdGVPck51bGwgPSBudWxsO1xuICAgIHRoaXMuc3RhdGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgICB0aGlzLmVudGVyRm5zID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICB0aGlzLmNsZWFudXBTdGFjayA9IFtdO1xuICAgIHRoaXMua25vd25FdmVudFR5cGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgICB0aGlzLmFsbG93ZWRUcmFuc2l0aW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5jdXJyZW50Q29udGV4dCA9IG5ldyBTYWZlQ29udGV4dChpbml0aWFsQ29udGV4dCk7XG4gICAgdGhpcy5ldmVudEh1YiA9IHtcbiAgICAgIGRpZFJlY2VpdmVFdmVudDogbWFrZUV2ZW50U291cmNlKCksXG4gICAgICB3aWxsVHJhbnNpdGlvbjogbWFrZUV2ZW50U291cmNlKCksXG4gICAgICBkaWRJZ25vcmVFdmVudDogbWFrZUV2ZW50U291cmNlKCksXG4gICAgICB3aWxsRXhpdFN0YXRlOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICAgIGRpZEVudGVyU3RhdGU6IG1ha2VFdmVudFNvdXJjZSgpXG4gICAgfTtcbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgIGRpZFJlY2VpdmVFdmVudDogdGhpcy5ldmVudEh1Yi5kaWRSZWNlaXZlRXZlbnQub2JzZXJ2YWJsZSxcbiAgICAgIHdpbGxUcmFuc2l0aW9uOiB0aGlzLmV2ZW50SHViLndpbGxUcmFuc2l0aW9uLm9ic2VydmFibGUsXG4gICAgICBkaWRJZ25vcmVFdmVudDogdGhpcy5ldmVudEh1Yi5kaWRJZ25vcmVFdmVudC5vYnNlcnZhYmxlLFxuICAgICAgd2lsbEV4aXRTdGF0ZTogdGhpcy5ldmVudEh1Yi53aWxsRXhpdFN0YXRlLm9ic2VydmFibGUsXG4gICAgICBkaWRFbnRlclN0YXRlOiB0aGlzLmV2ZW50SHViLmRpZEVudGVyU3RhdGUub2JzZXJ2YWJsZVxuICAgIH07XG4gIH1cbiAgZ2V0IGNvbnRleHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudENvbnRleHQuY3VycmVudDtcbiAgfVxuICAvKipcbiAgICogRGVmaW5lIGFuIGV4cGxpY2l0IGZpbml0ZSBzdGF0ZSBpbiB0aGUgc3RhdGUgbWFjaGluZS5cbiAgICovXG4gIGFkZFN0YXRlKHN0YXRlKSB7XG4gICAgaWYgKHRoaXMucnVubmluZ1N0YXRlICE9PSAwIC8qIE5PVF9TVEFSVEVEX1lFVCAqLykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSBzdGFydGVkXCIpO1xuICAgIH1cbiAgICB0aGlzLnN0YXRlcy5hZGQoc3RhdGUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIG9uRW50ZXIobmFtZU9yUGF0dGVybiwgZW50ZXJGbikge1xuICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSAhPT0gMCAvKiBOT1RfU1RBUlRFRF9ZRVQgKi8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgc3RhcnRlZFwiKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZW50ZXJGbnMuaGFzKG5hbWVPclBhdHRlcm4pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIC8vIFRPRE8gV2UgX2N1cnJlbnRseV8gZG9uJ3Qgc3VwcG9ydCBtdWx0aXBsZSAub25FbnRlcnMoKSBmb3IgdGhlIHNhbWVcbiAgICAgICAgLy8gc3RhdGUsIGJ1dCB0aGlzIGlzIG5vdCBhIGZ1bmRhbWVudGFsIGxpbWl0YXRpb24uIEp1c3Qgbm90XG4gICAgICAgIC8vIGltcGxlbWVudGVkIHlldC4gSWYgd2Ugd2FudGVkIHRvLCB3ZSBjb3VsZCBtYWtlIHRoaXMgYW4gYXJyYXkuXG4gICAgICAgIGBlbnRlci9leGl0IGZ1bmN0aW9uIGZvciAke25hbWVPclBhdHRlcm59IGFscmVhZHkgZXhpc3RzYFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5lbnRlckZucy5zZXQobmFtZU9yUGF0dGVybiwgZW50ZXJGbik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgb25FbnRlckFzeW5jKG5hbWVPclBhdHRlcm4sIHByb21pc2VGbiwgb25PSywgb25FcnJvcikge1xuICAgIHJldHVybiB0aGlzLm9uRW50ZXIobmFtZU9yUGF0dGVybiwgKCkgPT4ge1xuICAgICAgY29uc3QgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgY29uc3Qgc2lnbmFsID0gYWJvcnRDb250cm9sbGVyLnNpZ25hbDtcbiAgICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgICB2b2lkIHByb21pc2VGbih0aGlzLmN1cnJlbnRDb250ZXh0LmN1cnJlbnQsIHNpZ25hbCkudGhlbihcbiAgICAgICAgLy8gT24gT0tcbiAgICAgICAgKGRhdGEpID0+IHtcbiAgICAgICAgICBpZiAoIXNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbih7IHR5cGU6IFwiQVNZTkNfT0tcIiwgZGF0YSB9LCBvbk9LKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIE9uIEVycm9yXG4gICAgICAgIChyZWFzb24pID0+IHtcbiAgICAgICAgICBpZiAoIXNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbih7IHR5cGU6IFwiQVNZTkNfRVJST1JcIiwgcmVhc29uIH0sIG9uRXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGlmICghZG9uZSkge1xuICAgICAgICAgIGFib3J0Q29udHJvbGxlci5hYm9ydCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG4gIGdldFN0YXRlc01hdGNoaW5nKG5hbWVPclBhdHRlcm4pIHtcbiAgICBjb25zdCBtYXRjaGVzID0gW107XG4gICAgaWYgKG5hbWVPclBhdHRlcm4gPT09IFwiKlwiKSB7XG4gICAgICBmb3IgKGNvbnN0IHN0YXRlIG9mIHRoaXMuc3RhdGVzKSB7XG4gICAgICAgIG1hdGNoZXMucHVzaChzdGF0ZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChuYW1lT3JQYXR0ZXJuLmVuZHNXaXRoKFwiLipcIikpIHtcbiAgICAgIGNvbnN0IHByZWZpeCA9IG5hbWVPclBhdHRlcm4uc2xpY2UoMCwgLTEpO1xuICAgICAgZm9yIChjb25zdCBzdGF0ZSBvZiB0aGlzLnN0YXRlcykge1xuICAgICAgICBpZiAoc3RhdGUuc3RhcnRzV2l0aChwcmVmaXgpKSB7XG4gICAgICAgICAgbWF0Y2hlcy5wdXNoKHN0YXRlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBuYW1lID0gbmFtZU9yUGF0dGVybjtcbiAgICAgIGlmICh0aGlzLnN0YXRlcy5oYXMobmFtZSkpIHtcbiAgICAgICAgbWF0Y2hlcy5wdXNoKG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gc3RhdGVzIG1hdGNoICR7SlNPTi5zdHJpbmdpZnkobmFtZU9yUGF0dGVybil9YCk7XG4gICAgfVxuICAgIHJldHVybiBtYXRjaGVzO1xuICB9XG4gIC8qKlxuICAgKiBEZWZpbmUgYWxsIGFsbG93ZWQgb3V0Z29pbmcgdHJhbnNpdGlvbnMgZm9yIGEgc3RhdGUuXG4gICAqXG4gICAqIFRoZSB0YXJnZXRzIGZvciBlYWNoIGV2ZW50IGNhbiBiZSBkZWZpbmVkIGFzIGEgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyB0aGVcbiAgICogbmV4dCBzdGF0ZSB0byB0cmFuc2l0aW9uIHRvLiBUaGVzZSBmdW5jdGlvbnMgY2FuIGxvb2sgYXQgdGhlIGBldmVudGAgb3JcbiAgICogYGNvbnRleHRgIHBhcmFtcyB0byBjb25kaXRpb25hbGx5IGRlY2lkZSB3aGljaCBuZXh0IHN0YXRlIHRvIHRyYW5zaXRpb25cbiAgICogdG8uXG4gICAqXG4gICAqIElmIHlvdSBzZXQgaXQgdG8gYG51bGxgLCB0aGVuIHRoZSB0cmFuc2l0aW9uIHdpbGwgYmUgZXhwbGljaXRseSBmb3JiaWRkZW5cbiAgICogYW5kIHRocm93IGFuIGVycm9yLiBJZiB5b3UgZG9uJ3QgZGVmaW5lIGEgdGFyZ2V0IGZvciBhIHRyYW5zaXRpb24sIHRoZW5cbiAgICogc3VjaCBldmVudHMgd2lsbCBnZXQgaWdub3JlZC5cbiAgICovXG4gIGFkZFRyYW5zaXRpb25zKG5hbWVPclBhdHRlcm4sIG1hcHBpbmcpIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgIT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbHJlYWR5IHN0YXJ0ZWRcIik7XG4gICAgfVxuICAgIGZvciAoY29uc3Qgc3JjU3RhdGUgb2YgdGhpcy5nZXRTdGF0ZXNNYXRjaGluZyhuYW1lT3JQYXR0ZXJuKSkge1xuICAgICAgbGV0IG1hcCA9IHRoaXMuYWxsb3dlZFRyYW5zaXRpb25zLmdldChzcmNTdGF0ZSk7XG4gICAgICBpZiAobWFwID09PSB2b2lkIDApIHtcbiAgICAgICAgbWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5hbGxvd2VkVHJhbnNpdGlvbnMuc2V0KHNyY1N0YXRlLCBtYXApO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBbdHlwZSwgdGFyZ2V0X10gb2YgT2JqZWN0LmVudHJpZXMobWFwcGluZykpIHtcbiAgICAgICAgaWYgKG1hcC5oYXModHlwZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgVHJ5aW5nIHRvIHNldCB0cmFuc2l0aW9uIFwiJHt0eXBlfVwiIG9uIFwiJHtzcmNTdGF0ZX1cIiAodmlhIFwiJHtuYW1lT3JQYXR0ZXJufVwiKSwgYnV0IGEgdHJhbnNpdGlvbiBhbHJlYWR5IGV4aXN0cyB0aGVyZS5gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YXJnZXQgPSB0YXJnZXRfO1xuICAgICAgICB0aGlzLmtub3duRXZlbnRUeXBlcy5hZGQodHlwZSk7XG4gICAgICAgIGlmICh0YXJnZXQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIGNvbnN0IHRhcmdldEZuID0gdHlwZW9mIHRhcmdldCA9PT0gXCJmdW5jdGlvblwiID8gdGFyZ2V0IDogKCkgPT4gdGFyZ2V0O1xuICAgICAgICAgIG1hcC5zZXQodHlwZSwgdGFyZ2V0Rm4pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIC8qKlxuICAgKiBMaWtlIGAuYWRkVHJhbnNpdGlvbigpYCwgYnV0IHRha2VzIGFuIChhbm9ueW1vdXMpIHRyYW5zaXRpb24gd2hlbmV2ZXIgdGhlXG4gICAqIHRpbWVyIGZpcmVzLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdGVPclBhdHRlcm4gVGhlIHN0YXRlIG5hbWUsIG9yIHN0YXRlIGdyb3VwIHBhdHRlcm4gbmFtZS5cbiAgICogQHBhcmFtIGFmdGVyICAgICAgICAgIE51bWJlciBvZiBtaWxsaXNlY29uZHMgYWZ0ZXIgd2hpY2ggdG8gdGFrZSB0aGVcbiAgICogICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24uIElmIGluIHRoZSBtZWFuIHRpbWUsIGFub3RoZXIgdHJhbnNpdGlvblxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgaXMgdGFrZW4sIHRoZSB0aW1lciB3aWxsIGdldCBjYW5jZWxsZWQuXG4gICAqIEBwYXJhbSB0YXJnZXQgICAgIFRoZSB0YXJnZXQgc3RhdGUgdG8gZ28gdG8uXG4gICAqL1xuICBhZGRUaW1lZFRyYW5zaXRpb24oc3RhdGVPclBhdHRlcm4sIGFmdGVyMiwgdGFyZ2V0KSB7XG4gICAgcmV0dXJuIHRoaXMub25FbnRlcihzdGF0ZU9yUGF0dGVybiwgKCkgPT4ge1xuICAgICAgY29uc3QgbXMgPSB0eXBlb2YgYWZ0ZXIyID09PSBcImZ1bmN0aW9uXCIgPyBhZnRlcjIodGhpcy5jdXJyZW50Q29udGV4dC5jdXJyZW50KSA6IGFmdGVyMjtcbiAgICAgIGNvbnN0IHRpbWVvdXRJRCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnRyYW5zaXRpb24oeyB0eXBlOiBcIlRJTUVSXCIgfSwgdGFyZ2V0KTtcbiAgICAgIH0sIG1zKTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SUQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuICBnZXRUYXJnZXRGbihldmVudE5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5hbGxvd2VkVHJhbnNpdGlvbnMuZ2V0KHRoaXMuY3VycmVudFN0YXRlKT8uZ2V0KGV2ZW50TmFtZSk7XG4gIH1cbiAgLyoqXG4gICAqIEV4aXRzIHRoZSBjdXJyZW50IHN0YXRlLCBhbmQgZXhlY3V0ZXMgYW55IG5lY2Vzc2FyeSBjbGVhbnVwIGZ1bmN0aW9ucy5cbiAgICogQ2FsbCB0aGlzIGJlZm9yZSBjaGFuZ2luZyB0aGUgY3VycmVudCBzdGF0ZSB0byB0aGUgbmV4dCBzdGF0ZS5cbiAgICpcbiAgICogQHBhcmFtIGxldmVscyBEZWZpbmVzIGhvdyBtYW55IFwibGV2ZWxzXCIgb2YgbmVzdGluZyB3aWxsIGJlXG4gICAqIGV4aXRlZC4gRm9yIGV4YW1wbGUsIGlmIHlvdSB0cmFuc2l0aW9uIGZyb20gYGZvby5iYXIucXV4YCB0b1xuICAgKiBgZm9vLmJhci5iYXpgLCB0aGVuIHRoZSBsZXZlbCBpcyAxLiBCdXQgaWYgeW91IHRyYW5zaXRpb24gZnJvbVxuICAgKiBgZm9vLmJhci5xdXhgIHRvIGBibGEuYmxhYCwgdGhlbiB0aGUgbGV2ZWwgaXMgMy5cbiAgICogSWYgYG51bGxgLCBpdCB3aWxsIGV4aXQgYWxsIGxldmVscy5cbiAgICovXG4gIGV4aXQobGV2ZWxzKSB7XG4gICAgdGhpcy5ldmVudEh1Yi53aWxsRXhpdFN0YXRlLm5vdGlmeSh0aGlzLmN1cnJlbnRTdGF0ZSk7XG4gICAgdGhpcy5jdXJyZW50Q29udGV4dC5hbGxvd1BhdGNoaW5nKChwYXRjaGFibGVDb250ZXh0KSA9PiB7XG4gICAgICBsZXZlbHMgPSBsZXZlbHMgPz8gdGhpcy5jbGVhbnVwU3RhY2subGVuZ3RoO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZXZlbHM7IGkrKykge1xuICAgICAgICB0aGlzLmNsZWFudXBTdGFjay5wb3AoKT8uKHBhdGNoYWJsZUNvbnRleHQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBFbnRlcnMgdGhlIGN1cnJlbnQgc3RhdGUsIGFuZCBleGVjdXRlcyBhbnkgbmVjZXNzYXJ5IG9uRW50ZXIgaGFuZGxlcnMuXG4gICAqIENhbGwgdGhpcyBkaXJlY3RseSBfYWZ0ZXJfIHNldHRpbmcgdGhlIGN1cnJlbnQgc3RhdGUgdG8gdGhlIG5leHQgc3RhdGUuXG4gICAqL1xuICBlbnRlcihsZXZlbHMpIHtcbiAgICBjb25zdCBlbnRlclBhdHRlcm5zID0gcGF0dGVybnMoXG4gICAgICB0aGlzLmN1cnJlbnRTdGF0ZSxcbiAgICAgIGxldmVscyA/PyB0aGlzLmN1cnJlbnRTdGF0ZS5zcGxpdChcIi5cIikubGVuZ3RoICsgMVxuICAgICk7XG4gICAgdGhpcy5jdXJyZW50Q29udGV4dC5hbGxvd1BhdGNoaW5nKChwYXRjaGFibGVDb250ZXh0KSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgZW50ZXJQYXR0ZXJucykge1xuICAgICAgICBjb25zdCBlbnRlckZuID0gdGhpcy5lbnRlckZucy5nZXQocGF0dGVybik7XG4gICAgICAgIGNvbnN0IGNsZWFudXBGbiA9IGVudGVyRm4/LihwYXRjaGFibGVDb250ZXh0KTtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGVhbnVwRm4gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIHRoaXMuY2xlYW51cFN0YWNrLnB1c2goY2xlYW51cEZuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNsZWFudXBTdGFjay5wdXNoKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5ldmVudEh1Yi5kaWRFbnRlclN0YXRlLm5vdGlmeSh0aGlzLmN1cnJlbnRTdGF0ZSk7XG4gIH1cbiAgLyoqXG4gICAqIFNlbmRzIGFuIGV2ZW50IHRvIHRoZSBtYWNoaW5lLCB3aGljaCBtYXkgY2F1c2UgYW4gaW50ZXJuYWwgc3RhdGVcbiAgICogdHJhbnNpdGlvbiB0byBoYXBwZW4uIFdoZW4gdGhhdCBoYXBwZW5zLCB3aWxsIHRyaWdnZXIgc2lkZSBlZmZlY3RzLlxuICAgKi9cbiAgc2VuZChldmVudCkge1xuICAgIGlmICghdGhpcy5rbm93bkV2ZW50VHlwZXMuaGFzKGV2ZW50LnR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZXZlbnQgJHtKU09OLnN0cmluZ2lmeShldmVudC50eXBlKX1gKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucnVubmluZ1N0YXRlID09PSAyIC8qIFNUT1BQRUQgKi8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0Rm4gPSB0aGlzLmdldFRhcmdldEZuKGV2ZW50LnR5cGUpO1xuICAgIGlmICh0YXJnZXRGbiAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFuc2l0aW9uKGV2ZW50LCB0YXJnZXRGbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXZlbnRIdWIuZGlkSWdub3JlRXZlbnQubm90aWZ5KGV2ZW50KTtcbiAgICB9XG4gIH1cbiAgdHJhbnNpdGlvbihldmVudCwgdGFyZ2V0KSB7XG4gICAgdGhpcy5ldmVudEh1Yi5kaWRSZWNlaXZlRXZlbnQubm90aWZ5KGV2ZW50KTtcbiAgICBjb25zdCBvbGRTdGF0ZSA9IHRoaXMuY3VycmVudFN0YXRlO1xuICAgIGNvbnN0IHRhcmdldEZuID0gdHlwZW9mIHRhcmdldCA9PT0gXCJmdW5jdGlvblwiID8gdGFyZ2V0IDogKCkgPT4gdGFyZ2V0O1xuICAgIGNvbnN0IG5leHRUYXJnZXQgPSB0YXJnZXRGbihldmVudCwgdGhpcy5jdXJyZW50Q29udGV4dC5jdXJyZW50KTtcbiAgICBsZXQgbmV4dFN0YXRlO1xuICAgIGxldCBlZmZlY3RzID0gdm9pZCAwO1xuICAgIGlmIChuZXh0VGFyZ2V0ID09PSBudWxsKSB7XG4gICAgICB0aGlzLmV2ZW50SHViLmRpZElnbm9yZUV2ZW50Lm5vdGlmeShldmVudCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0eXBlb2YgbmV4dFRhcmdldCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgbmV4dFN0YXRlID0gbmV4dFRhcmdldDtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV4dFN0YXRlID0gbmV4dFRhcmdldC50YXJnZXQ7XG4gICAgICBlZmZlY3RzID0gQXJyYXkuaXNBcnJheShuZXh0VGFyZ2V0LmVmZmVjdCkgPyBuZXh0VGFyZ2V0LmVmZmVjdCA6IFtuZXh0VGFyZ2V0LmVmZmVjdF07XG4gICAgfVxuICAgIGlmICghdGhpcy5zdGF0ZXMuaGFzKG5leHRTdGF0ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBuZXh0IHN0YXRlIG5hbWU6ICR7SlNPTi5zdHJpbmdpZnkobmV4dFN0YXRlKX1gKTtcbiAgICB9XG4gICAgdGhpcy5ldmVudEh1Yi53aWxsVHJhbnNpdGlvbi5ub3RpZnkoeyBmcm9tOiBvbGRTdGF0ZSwgdG86IG5leHRTdGF0ZSB9KTtcbiAgICBjb25zdCBbdXAsIGRvd25dID0gZGlzdGFuY2UodGhpcy5jdXJyZW50U3RhdGUsIG5leHRTdGF0ZSk7XG4gICAgaWYgKHVwID4gMCkge1xuICAgICAgdGhpcy5leGl0KHVwKTtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50U3RhdGVPck51bGwgPSBuZXh0U3RhdGU7XG4gICAgaWYgKGVmZmVjdHMgIT09IHZvaWQgMCkge1xuICAgICAgY29uc3QgZWZmZWN0c1RvUnVuID0gZWZmZWN0cztcbiAgICAgIHRoaXMuY3VycmVudENvbnRleHQuYWxsb3dQYXRjaGluZygocGF0Y2hhYmxlQ29udGV4dCkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IGVmZmVjdCBvZiBlZmZlY3RzVG9SdW4pIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGVmZmVjdCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBlZmZlY3QocGF0Y2hhYmxlQ29udGV4dCwgZXZlbnQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwYXRjaGFibGVDb250ZXh0LnBhdGNoKGVmZmVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGRvd24gPiAwKSB7XG4gICAgICB0aGlzLmVudGVyKGRvd24pO1xuICAgIH1cbiAgfVxufTtcblxuLy8gc3JjL2xpYi91dGlscy50c1xuZnVuY3Rpb24gcmFpc2UobXNnKSB7XG4gIHRocm93IG5ldyBFcnJvcihtc2cpO1xufVxuZnVuY3Rpb24gaXNQbGFpbk9iamVjdChibG9iKSB7XG4gIHJldHVybiBibG9iICE9PSBudWxsICYmIHR5cGVvZiBibG9iID09PSBcIm9iamVjdFwiICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChibG9iKSA9PT0gXCJbb2JqZWN0IE9iamVjdF1cIjtcbn1cbmZ1bmN0aW9uIGVudHJpZXMob2JqKSB7XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhvYmopO1xufVxuZnVuY3Rpb24gdHJ5UGFyc2VKc29uKHJhd01lc3NhZ2UpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShyYXdNZXNzYWdlKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbn1cbmZ1bmN0aW9uIGRlZXBDbG9uZSh2YWx1ZSkge1xuICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xufVxuZnVuY3Rpb24gYjY0ZGVjb2RlKGI2NHZhbHVlKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSBiNjR2YWx1ZS5yZXBsYWNlKC8tL2csIFwiK1wiKS5yZXBsYWNlKC9fL2csIFwiL1wiKTtcbiAgICBjb25zdCBkZWNvZGVkVmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQoXG4gICAgICBhdG9iKGZvcm1hdHRlZFZhbHVlKS5zcGxpdChcIlwiKS5tYXAoZnVuY3Rpb24oYykge1xuICAgICAgICByZXR1cm4gXCIlXCIgKyAoXCIwMFwiICsgYy5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgICAgfSkuam9pbihcIlwiKVxuICAgICk7XG4gICAgcmV0dXJuIGRlY29kZWRWYWx1ZTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIGF0b2IoYjY0dmFsdWUpO1xuICB9XG59XG5mdW5jdGlvbiBjb21wYWN0KGl0ZW1zKSB7XG4gIHJldHVybiBpdGVtcy5maWx0ZXIoXG4gICAgKGl0ZW0pID0+IGl0ZW0gIT09IG51bGwgJiYgaXRlbSAhPT0gdm9pZCAwXG4gICk7XG59XG5mdW5jdGlvbiBjb21wYWN0T2JqZWN0KG9iaikge1xuICBjb25zdCBuZXdPYmogPSB7IC4uLm9iaiB9O1xuICBPYmplY3Qua2V5cyhvYmopLmZvckVhY2goKGspID0+IHtcbiAgICBjb25zdCBrZXkgPSBrO1xuICAgIGlmIChuZXdPYmpba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICBkZWxldGUgbmV3T2JqW2tleV07XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG5ld09iajtcbn1cbmZ1bmN0aW9uIHdhaXQobWlsbGlzKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzKSA9PiBzZXRUaW1lb3V0KHJlcywgbWlsbGlzKSk7XG59XG5hc3luYyBmdW5jdGlvbiB3aXRoVGltZW91dChwcm9taXNlLCBtaWxsaXMsIGVycm1zZykge1xuICBsZXQgdGltZXJJRDtcbiAgY29uc3QgdGltZXIkID0gbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4ge1xuICAgIHRpbWVySUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHJlamVjdChuZXcgRXJyb3IoZXJybXNnKSk7XG4gICAgfSwgbWlsbGlzKTtcbiAgfSk7XG4gIHJldHVybiBQcm9taXNlLnJhY2UoW3Byb21pc2UsIHRpbWVyJF0pLmZpbmFsbHkoKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVySUQpKTtcbn1cbmZ1bmN0aW9uIG1lbW9pemVPblN1Y2Nlc3MoZmFjdG9yeUZuKSB7XG4gIGxldCBjYWNoZWQgPSBudWxsO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGlmIChjYWNoZWQgPT09IG51bGwpIHtcbiAgICAgIGNhY2hlZCA9IGZhY3RvcnlGbigpLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgY2FjaGVkID0gbnVsbDtcbiAgICAgICAgfSwgNWUzKTtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZWQ7XG4gIH07XG59XG5cbi8vIHNyYy9wcm90b2NvbC9TZXJ2ZXJNc2cudHNcbnZhciBTZXJ2ZXJNc2dDb2RlID0gLyogQF9fUFVSRV9fICovICgoU2VydmVyTXNnQ29kZTIpID0+IHtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJVUERBVEVfUFJFU0VOQ0VcIl0gPSAxMDBdID0gXCJVUERBVEVfUFJFU0VOQ0VcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJVU0VSX0pPSU5FRFwiXSA9IDEwMV0gPSBcIlVTRVJfSk9JTkVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVNFUl9MRUZUXCJdID0gMTAyXSA9IFwiVVNFUl9MRUZUXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiQlJPQURDQVNURURfRVZFTlRcIl0gPSAxMDNdID0gXCJCUk9BRENBU1RFRF9FVkVOVFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlJPT01fU1RBVEVcIl0gPSAxMDRdID0gXCJST09NX1NUQVRFXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiSU5JVElBTF9TVE9SQUdFX1NUQVRFXCJdID0gMjAwXSA9IFwiSU5JVElBTF9TVE9SQUdFX1NUQVRFXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVBEQVRFX1NUT1JBR0VcIl0gPSAyMDFdID0gXCJVUERBVEVfU1RPUkFHRVwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlJFSkVDVF9TVE9SQUdFX09QXCJdID0gMjk5XSA9IFwiUkVKRUNUX1NUT1JBR0VfT1BcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJVUERBVEVfWURPQ1wiXSA9IDMwMF0gPSBcIlVQREFURV9ZRE9DXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVEhSRUFEX0NSRUFURURcIl0gPSA0MDBdID0gXCJUSFJFQURfQ1JFQVRFRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlRIUkVBRF9ERUxFVEVEXCJdID0gNDA3XSA9IFwiVEhSRUFEX0RFTEVURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJUSFJFQURfTUVUQURBVEFfVVBEQVRFRFwiXSA9IDQwMV0gPSBcIlRIUkVBRF9NRVRBREFUQV9VUERBVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVEhSRUFEX1VQREFURURcIl0gPSA0MDhdID0gXCJUSFJFQURfVVBEQVRFRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIkNPTU1FTlRfQ1JFQVRFRFwiXSA9IDQwMl0gPSBcIkNPTU1FTlRfQ1JFQVRFRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIkNPTU1FTlRfRURJVEVEXCJdID0gNDAzXSA9IFwiQ09NTUVOVF9FRElURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX0RFTEVURURcIl0gPSA0MDRdID0gXCJDT01NRU5UX0RFTEVURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX1JFQUNUSU9OX0FEREVEXCJdID0gNDA1XSA9IFwiQ09NTUVOVF9SRUFDVElPTl9BRERFRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIkNPTU1FTlRfUkVBQ1RJT05fUkVNT1ZFRFwiXSA9IDQwNl0gPSBcIkNPTU1FTlRfUkVBQ1RJT05fUkVNT1ZFRFwiO1xuICByZXR1cm4gU2VydmVyTXNnQ29kZTI7XG59KShTZXJ2ZXJNc2dDb2RlIHx8IHt9KTtcblxuLy8gc3JjL3R5cGVzL0lXZWJTb2NrZXQudHNcbnZhciBXZWJzb2NrZXRDbG9zZUNvZGVzID0gLyogQF9fUFVSRV9fICovICgoV2Vic29ja2V0Q2xvc2VDb2RlczIpID0+IHtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJDTE9TRV9OT1JNQUxcIl0gPSAxZTNdID0gXCJDTE9TRV9OT1JNQUxcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJDTE9TRV9BQk5PUk1BTFwiXSA9IDEwMDZdID0gXCJDTE9TRV9BQk5PUk1BTFwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIlVORVhQRUNURURfQ09ORElUSU9OXCJdID0gMTAxMV0gPSBcIlVORVhQRUNURURfQ09ORElUSU9OXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiVFJZX0FHQUlOX0xBVEVSXCJdID0gMTAxM10gPSBcIlRSWV9BR0FJTl9MQVRFUlwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIklOVkFMSURfTUVTU0FHRV9GT1JNQVRcIl0gPSA0ZTNdID0gXCJJTlZBTElEX01FU1NBR0VfRk9STUFUXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTk9UX0FMTE9XRURcIl0gPSA0MDAxXSA9IFwiTk9UX0FMTE9XRURcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJNQVhfTlVNQkVSX09GX01FU1NBR0VTX1BFUl9TRUNPTkRTXCJdID0gNDAwMl0gPSBcIk1BWF9OVU1CRVJfT0ZfTUVTU0FHRVNfUEVSX1NFQ09ORFNcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJNQVhfTlVNQkVSX09GX0NPTkNVUlJFTlRfQ09OTkVDVElPTlNcIl0gPSA0MDAzXSA9IFwiTUFYX05VTUJFUl9PRl9DT05DVVJSRU5UX0NPTk5FQ1RJT05TXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9NRVNTQUdFU19QRVJfREFZX1BFUl9BUFBcIl0gPSA0MDA0XSA9IFwiTUFYX05VTUJFUl9PRl9NRVNTQUdFU19QRVJfREFZX1BFUl9BUFBcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJNQVhfTlVNQkVSX09GX0NPTkNVUlJFTlRfQ09OTkVDVElPTlNfUEVSX1JPT01cIl0gPSA0MDA1XSA9IFwiTUFYX05VTUJFUl9PRl9DT05DVVJSRU5UX0NPTk5FQ1RJT05TX1BFUl9ST09NXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiUk9PTV9JRF9VUERBVEVEXCJdID0gNDAwNl0gPSBcIlJPT01fSURfVVBEQVRFRFwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIktJQ0tFRFwiXSA9IDQxMDBdID0gXCJLSUNLRURcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJUT0tFTl9FWFBJUkVEXCJdID0gNDEwOV0gPSBcIlRPS0VOX0VYUElSRURcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJDTE9TRV9XSVRIT1VUX1JFVFJZXCJdID0gNDk5OV0gPSBcIkNMT1NFX1dJVEhPVVRfUkVUUllcIjtcbiAgcmV0dXJuIFdlYnNvY2tldENsb3NlQ29kZXMyO1xufSkoV2Vic29ja2V0Q2xvc2VDb2RlcyB8fCB7fSk7XG5mdW5jdGlvbiBzaG91bGREaXNjb25uZWN0KGNvZGUpIHtcbiAgcmV0dXJuIGNvZGUgPT09IDQ5OTkgLyogQ0xPU0VfV0lUSE9VVF9SRVRSWSAqLyB8fCBjb2RlID49IDRlMyAmJiBjb2RlIDwgNDEwMDtcbn1cbmZ1bmN0aW9uIHNob3VsZFJlYXV0aChjb2RlKSB7XG4gIHJldHVybiBjb2RlID49IDQxMDAgJiYgY29kZSA8IDQyMDA7XG59XG5mdW5jdGlvbiBzaG91bGRSZXRyeVdpdGhvdXRSZWF1dGgoY29kZSkge1xuICByZXR1cm4gY29kZSA9PT0gMTAxMyAvKiBUUllfQUdBSU5fTEFURVIgKi8gfHwgY29kZSA+PSA0MjAwICYmIGNvZGUgPCA0MzAwO1xufVxuXG4vLyBzcmMvY29ubmVjdGlvbi50c1xuZnVuY3Rpb24gaXNJZGxlKHN0YXR1cykge1xuICByZXR1cm4gc3RhdHVzID09PSBcImluaXRpYWxcIiB8fCBzdGF0dXMgPT09IFwiZGlzY29ubmVjdGVkXCI7XG59XG5mdW5jdGlvbiB0b05ld0Nvbm5lY3Rpb25TdGF0dXMobWFjaGluZSkge1xuICBjb25zdCBzdGF0ZSA9IG1hY2hpbmUuY3VycmVudFN0YXRlO1xuICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgY2FzZSBcIkBvay5jb25uZWN0ZWRcIjpcbiAgICBjYXNlIFwiQG9rLmF3YWl0aW5nLXBvbmdcIjpcbiAgICAgIHJldHVybiBcImNvbm5lY3RlZFwiO1xuICAgIGNhc2UgXCJAaWRsZS5pbml0aWFsXCI6XG4gICAgICByZXR1cm4gXCJpbml0aWFsXCI7XG4gICAgY2FzZSBcIkBhdXRoLmJ1c3lcIjpcbiAgICBjYXNlIFwiQGF1dGguYmFja29mZlwiOlxuICAgIGNhc2UgXCJAY29ubmVjdGluZy5idXN5XCI6XG4gICAgY2FzZSBcIkBjb25uZWN0aW5nLmJhY2tvZmZcIjpcbiAgICBjYXNlIFwiQGlkbGUuem9tYmllXCI6XG4gICAgICByZXR1cm4gbWFjaGluZS5jb250ZXh0LnN1Y2Nlc3NDb3VudCA+IDAgPyBcInJlY29ubmVjdGluZ1wiIDogXCJjb25uZWN0aW5nXCI7XG4gICAgY2FzZSBcIkBpZGxlLmZhaWxlZFwiOlxuICAgICAgcmV0dXJuIFwiZGlzY29ubmVjdGVkXCI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBhc3NlcnROZXZlcihzdGF0ZSwgXCJVbmtub3duIHN0YXRlXCIpO1xuICB9XG59XG52YXIgQkFDS09GRl9ERUxBWVMgPSBbMjUwLCA1MDAsIDFlMywgMmUzLCA0ZTMsIDhlMywgMWU0XTtcbnZhciBSRVNFVF9ERUxBWSA9IEJBQ0tPRkZfREVMQVlTWzBdIC0gMTtcbnZhciBCQUNLT0ZGX0RFTEFZU19TTE9XID0gWzJlMywgM2U0LCA2ZTQsIDNlNV07XG52YXIgSEVBUlRCRUFUX0lOVEVSVkFMID0gM2U0O1xudmFyIFBPTkdfVElNRU9VVCA9IDJlMztcbnZhciBBVVRIX1RJTUVPVVQgPSAxZTQ7XG52YXIgU09DS0VUX0NPTk5FQ1RfVElNRU9VVCA9IDFlNDtcbnZhciBTdG9wUmV0cnlpbmcgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IocmVhc29uKSB7XG4gICAgc3VwZXIocmVhc29uKTtcbiAgfVxufTtcbnZhciBMaXZlYmxvY2tzRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBjb2RlKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5jb2RlID0gY29kZTtcbiAgfVxufTtcbmZ1bmN0aW9uIG5leHRCYWNrb2ZmRGVsYXkoY3VycmVudERlbGF5LCBkZWxheXMpIHtcbiAgcmV0dXJuIGRlbGF5cy5maW5kKChkZWxheSkgPT4gZGVsYXkgPiBjdXJyZW50RGVsYXkpID8/IGRlbGF5c1tkZWxheXMubGVuZ3RoIC0gMV07XG59XG5mdW5jdGlvbiBpbmNyZWFzZUJhY2tvZmZEZWxheShjb250ZXh0KSB7XG4gIGNvbnRleHQucGF0Y2goe1xuICAgIGJhY2tvZmZEZWxheTogbmV4dEJhY2tvZmZEZWxheShjb250ZXh0LmJhY2tvZmZEZWxheSwgQkFDS09GRl9ERUxBWVMpXG4gIH0pO1xufVxuZnVuY3Rpb24gaW5jcmVhc2VCYWNrb2ZmRGVsYXlBZ2dyZXNzaXZlbHkoY29udGV4dCkge1xuICBjb250ZXh0LnBhdGNoKHtcbiAgICBiYWNrb2ZmRGVsYXk6IG5leHRCYWNrb2ZmRGVsYXkoY29udGV4dC5iYWNrb2ZmRGVsYXksIEJBQ0tPRkZfREVMQVlTX1NMT1cpXG4gIH0pO1xufVxuZnVuY3Rpb24gcmVzZXRTdWNjZXNzQ291bnQoY29udGV4dCkge1xuICBjb250ZXh0LnBhdGNoKHsgc3VjY2Vzc0NvdW50OiAwIH0pO1xufVxuZnVuY3Rpb24gbG9nKGxldmVsLCBtZXNzYWdlKSB7XG4gIGNvbnN0IGxvZ2dlciA9IGxldmVsID09PSAyIC8qIEVSUk9SICovID8gZXJyb3IyIDogbGV2ZWwgPT09IDEgLyogV0FSTiAqLyA/IHdhcm4gOiAoXG4gICAgLyogYmxhY2sgaG9sZSAqL1xuICAgICgpID0+IHtcbiAgICB9XG4gICk7XG4gIHJldHVybiAoKSA9PiB7XG4gICAgbG9nZ2VyKG1lc3NhZ2UpO1xuICB9O1xufVxuZnVuY3Rpb24gbG9nUHJlbWF0dXJlRXJyb3JPckNsb3NlRXZlbnQoZSkge1xuICBjb25zdCBjb25uID0gXCJDb25uZWN0aW9uIHRvIExpdmVibG9ja3Mgd2Vic29ja2V0IHNlcnZlclwiO1xuICByZXR1cm4gKGN0eCkgPT4ge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIHdhcm4oYCR7Y29ubn0gY291bGQgbm90IGJlIGVzdGFibGlzaGVkLiAke1N0cmluZyhlKX1gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2FybihcbiAgICAgICAgaXNDbG9zZUV2ZW50KGUpID8gYCR7Y29ubn0gY2xvc2VkIHByZW1hdHVyZWx5IChjb2RlOiAke2UuY29kZX0pLiBSZXRyeWluZyBpbiAke2N0eC5iYWNrb2ZmRGVsYXl9bXMuYCA6IGAke2Nvbm59IGNvdWxkIG5vdCBiZSBlc3RhYmxpc2hlZC5gXG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cbmZ1bmN0aW9uIGxvZ0Nsb3NlRXZlbnQoZXZlbnQpIHtcbiAgY29uc3QgZGV0YWlscyA9IFtgY29kZTogJHtldmVudC5jb2RlfWBdO1xuICBpZiAoZXZlbnQucmVhc29uKSB7XG4gICAgZGV0YWlscy5wdXNoKGByZWFzb246ICR7ZXZlbnQucmVhc29ufWApO1xuICB9XG4gIHJldHVybiAoY3R4KSA9PiB7XG4gICAgd2FybihcbiAgICAgIGBDb25uZWN0aW9uIHRvIExpdmVibG9ja3Mgd2Vic29ja2V0IHNlcnZlciBjbG9zZWQgKCR7ZGV0YWlscy5qb2luKFwiLCBcIil9KS4gUmV0cnlpbmcgaW4gJHtjdHguYmFja29mZkRlbGF5fW1zLmBcbiAgICApO1xuICB9O1xufVxudmFyIGxvZ1Blcm1hbmVudENsb3NlID0gbG9nKFxuICAxIC8qIFdBUk4gKi8sXG4gIFwiQ29ubmVjdGlvbiB0byBXZWJTb2NrZXQgY2xvc2VkIHBlcm1hbmVudGx5LiBXb24ndCByZXRyeS5cIlxuKTtcbmZ1bmN0aW9uIGlzQ2xvc2VFdmVudChlcnJvcjMpIHtcbiAgcmV0dXJuICEoZXJyb3IzIGluc3RhbmNlb2YgRXJyb3IpICYmIGVycm9yMy50eXBlID09PSBcImNsb3NlXCI7XG59XG5mdW5jdGlvbiBlbmFibGVUcmFjaW5nKG1hY2hpbmUpIHtcbiAgY29uc3Qgc3RhcnQgPSAoLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcbiAgZnVuY3Rpb24gbG9nMiguLi5hcmdzKSB7XG4gICAgd2FybihcbiAgICAgIGAkeygoKC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLSBzdGFydCkgLyAxZTMpLnRvRml4ZWQoMil9IFtGU00gIyR7bWFjaGluZS5pZH1dYCxcbiAgICAgIC4uLmFyZ3NcbiAgICApO1xuICB9XG4gIGNvbnN0IHVuc3VicyA9IFtcbiAgICBtYWNoaW5lLmV2ZW50cy5kaWRSZWNlaXZlRXZlbnQuc3Vic2NyaWJlKChlKSA9PiBsb2cyKGBFdmVudCAke2UudHlwZX1gKSksXG4gICAgbWFjaGluZS5ldmVudHMud2lsbFRyYW5zaXRpb24uc3Vic2NyaWJlKFxuICAgICAgKHsgZnJvbSwgdG8gfSkgPT4gbG9nMihcIlRyYW5zaXRpb25pbmdcIiwgZnJvbSwgXCJcXHUyMTkyXCIsIHRvKVxuICAgICksXG4gICAgbWFjaGluZS5ldmVudHMuZGlkSWdub3JlRXZlbnQuc3Vic2NyaWJlKFxuICAgICAgKGUpID0+IGxvZzIoXCJJZ25vcmVkIGV2ZW50XCIsIGUudHlwZSwgZSwgXCIoY3VycmVudCBzdGF0ZSB3b24ndCBoYW5kbGUgaXQpXCIpXG4gICAgKVxuICAgIC8vIG1hY2hpbmUuZXZlbnRzLndpbGxFeGl0U3RhdGUuc3Vic2NyaWJlKChzKSA9PiBsb2coXCJFeGl0aW5nIHN0YXRlXCIsIHMpKSxcbiAgICAvLyBtYWNoaW5lLmV2ZW50cy5kaWRFbnRlclN0YXRlLnN1YnNjcmliZSgocykgPT4gbG9nKFwiRW50ZXJpbmcgc3RhdGVcIiwgcykpLFxuICBdO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGZvciAoY29uc3QgdW5zdWIgb2YgdW5zdWJzKSB7XG4gICAgICB1bnN1YigpO1xuICAgIH1cbiAgfTtcbn1cbmZ1bmN0aW9uIGRlZmluZUNvbm5lY3Rpdml0eUV2ZW50cyhtYWNoaW5lKSB7XG4gIGNvbnN0IHN0YXR1c0RpZENoYW5nZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBjb25zdCBkaWRDb25uZWN0ID0gbWFrZUV2ZW50U291cmNlKCk7XG4gIGNvbnN0IGRpZERpc2Nvbm5lY3QgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgbGV0IGxhc3RTdGF0dXMgPSBudWxsO1xuICBjb25zdCB1bnN1YnNjcmliZSA9IG1hY2hpbmUuZXZlbnRzLmRpZEVudGVyU3RhdGUuc3Vic2NyaWJlKCgpID0+IHtcbiAgICBjb25zdCBjdXJyU3RhdHVzID0gdG9OZXdDb25uZWN0aW9uU3RhdHVzKG1hY2hpbmUpO1xuICAgIGlmIChjdXJyU3RhdHVzICE9PSBsYXN0U3RhdHVzKSB7XG4gICAgICBzdGF0dXNEaWRDaGFuZ2Uubm90aWZ5KGN1cnJTdGF0dXMpO1xuICAgIH1cbiAgICBpZiAobGFzdFN0YXR1cyA9PT0gXCJjb25uZWN0ZWRcIiAmJiBjdXJyU3RhdHVzICE9PSBcImNvbm5lY3RlZFwiKSB7XG4gICAgICBkaWREaXNjb25uZWN0Lm5vdGlmeSgpO1xuICAgIH0gZWxzZSBpZiAobGFzdFN0YXR1cyAhPT0gXCJjb25uZWN0ZWRcIiAmJiBjdXJyU3RhdHVzID09PSBcImNvbm5lY3RlZFwiKSB7XG4gICAgICBkaWRDb25uZWN0Lm5vdGlmeSgpO1xuICAgIH1cbiAgICBsYXN0U3RhdHVzID0gY3VyclN0YXR1cztcbiAgfSk7XG4gIHJldHVybiB7XG4gICAgc3RhdHVzRGlkQ2hhbmdlOiBzdGF0dXNEaWRDaGFuZ2Uub2JzZXJ2YWJsZSxcbiAgICBkaWRDb25uZWN0OiBkaWRDb25uZWN0Lm9ic2VydmFibGUsXG4gICAgZGlkRGlzY29ubmVjdDogZGlkRGlzY29ubmVjdC5vYnNlcnZhYmxlLFxuICAgIHVuc3Vic2NyaWJlXG4gIH07XG59XG52YXIgYXNzaWduID0gKHBhdGNoKSA9PiAoY3R4KSA9PiBjdHgucGF0Y2gocGF0Y2gpO1xuZnVuY3Rpb24gY3JlYXRlQ29ubmVjdGlvblN0YXRlTWFjaGluZShkZWxlZ2F0ZXMsIG9wdGlvbnMpIHtcbiAgY29uc3Qgb25NZXNzYWdlID0gbWFrZUV2ZW50U291cmNlKCk7XG4gIG9uTWVzc2FnZS5wYXVzZSgpO1xuICBjb25zdCBvbkxpdmVibG9ja3NFcnJvciA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBmdW5jdGlvbiBmaXJlRXJyb3JFdmVudChlcnJtc2csIGVycmNvZGUpIHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgZXJyID0gbmV3IExpdmVibG9ja3NFcnJvcihlcnJtc2csIGVycmNvZGUpO1xuICAgICAgb25MaXZlYmxvY2tzRXJyb3Iubm90aWZ5KGVycik7XG4gICAgfTtcbiAgfVxuICBjb25zdCBpbml0aWFsQ29udGV4dCA9IHtcbiAgICBzdWNjZXNzQ291bnQ6IDAsXG4gICAgYXV0aFZhbHVlOiBudWxsLFxuICAgIHNvY2tldDogbnVsbCxcbiAgICBiYWNrb2ZmRGVsYXk6IFJFU0VUX0RFTEFZXG4gIH07XG4gIGNvbnN0IG1hY2hpbmUgPSBuZXcgRlNNKGluaXRpYWxDb250ZXh0KS5hZGRTdGF0ZShcIkBpZGxlLmluaXRpYWxcIikuYWRkU3RhdGUoXCJAaWRsZS5mYWlsZWRcIikuYWRkU3RhdGUoXCJAaWRsZS56b21iaWVcIikuYWRkU3RhdGUoXCJAYXV0aC5idXN5XCIpLmFkZFN0YXRlKFwiQGF1dGguYmFja29mZlwiKS5hZGRTdGF0ZShcIkBjb25uZWN0aW5nLmJ1c3lcIikuYWRkU3RhdGUoXCJAY29ubmVjdGluZy5iYWNrb2ZmXCIpLmFkZFN0YXRlKFwiQG9rLmNvbm5lY3RlZFwiKS5hZGRTdGF0ZShcIkBvay5hd2FpdGluZy1wb25nXCIpO1xuICBtYWNoaW5lLmFkZFRyYW5zaXRpb25zKFwiKlwiLCB7XG4gICAgUkVDT05ORUNUOiB7XG4gICAgICB0YXJnZXQ6IFwiQGF1dGguYmFja29mZlwiLFxuICAgICAgZWZmZWN0OiBbaW5jcmVhc2VCYWNrb2ZmRGVsYXksIHJlc2V0U3VjY2Vzc0NvdW50XVxuICAgIH0sXG4gICAgRElTQ09OTkVDVDogXCJAaWRsZS5pbml0aWFsXCJcbiAgfSk7XG4gIG1hY2hpbmUub25FbnRlcihcIkBpZGxlLipcIiwgcmVzZXRTdWNjZXNzQ291bnQpLmFkZFRyYW5zaXRpb25zKFwiQGlkbGUuKlwiLCB7XG4gICAgQ09OTkVDVDogKF8sIGN0eCkgPT4gKFxuICAgICAgLy8gSWYgd2Ugc3RpbGwgaGF2ZSBhIGtub3duIGF1dGhWYWx1ZSwgdHJ5IHRvIHJlY29ubmVjdCB0byB0aGUgc29ja2V0IGRpcmVjdGx5LFxuICAgICAgLy8gb3RoZXJ3aXNlLCB0cnkgdG8gb2J0YWluIGEgbmV3IGF1dGhWYWx1ZVxuICAgICAgY3R4LmF1dGhWYWx1ZSAhPT0gbnVsbCA/IFwiQGNvbm5lY3RpbmcuYnVzeVwiIDogXCJAYXV0aC5idXN5XCJcbiAgICApXG4gIH0pO1xuICBtYWNoaW5lLmFkZFRyYW5zaXRpb25zKFwiQGF1dGguYmFja29mZlwiLCB7XG4gICAgTkFWSUdBVE9SX09OTElORToge1xuICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJ1c3lcIixcbiAgICAgIGVmZmVjdDogYXNzaWduKHsgYmFja29mZkRlbGF5OiBSRVNFVF9ERUxBWSB9KVxuICAgIH1cbiAgfSkuYWRkVGltZWRUcmFuc2l0aW9uKFxuICAgIFwiQGF1dGguYmFja29mZlwiLFxuICAgIChjdHgpID0+IGN0eC5iYWNrb2ZmRGVsYXksXG4gICAgXCJAYXV0aC5idXN5XCJcbiAgKS5vbkVudGVyQXN5bmMoXG4gICAgXCJAYXV0aC5idXN5XCIsXG4gICAgKCkgPT4gd2l0aFRpbWVvdXQoXG4gICAgICBkZWxlZ2F0ZXMuYXV0aGVudGljYXRlKCksXG4gICAgICBBVVRIX1RJTUVPVVQsXG4gICAgICBcIlRpbWVkIG91dCBkdXJpbmcgYXV0aFwiXG4gICAgKSxcbiAgICAvLyBPbiBzdWNjZXNzZnVsIGF1dGhlbnRpY2F0aW9uXG4gICAgKG9rRXZlbnQpID0+ICh7XG4gICAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYnVzeVwiLFxuICAgICAgZWZmZWN0OiBhc3NpZ24oe1xuICAgICAgICBhdXRoVmFsdWU6IG9rRXZlbnQuZGF0YVxuICAgICAgfSlcbiAgICB9KSxcbiAgICAvLyBBdXRoIGZhaWxlZFxuICAgIChmYWlsZWRFdmVudCkgPT4ge1xuICAgICAgaWYgKGZhaWxlZEV2ZW50LnJlYXNvbiBpbnN0YW5jZW9mIFN0b3BSZXRyeWluZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRhcmdldDogXCJAaWRsZS5mYWlsZWRcIixcbiAgICAgICAgICBlZmZlY3Q6IFtcbiAgICAgICAgICAgIGxvZygyIC8qIEVSUk9SICovLCBmYWlsZWRFdmVudC5yZWFzb24ubWVzc2FnZSksXG4gICAgICAgICAgICBmaXJlRXJyb3JFdmVudChmYWlsZWRFdmVudC5yZWFzb24ubWVzc2FnZSwgLTEpXG4gICAgICAgICAgXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgaW5jcmVhc2VCYWNrb2ZmRGVsYXksXG4gICAgICAgICAgbG9nKFxuICAgICAgICAgICAgMiAvKiBFUlJPUiAqLyxcbiAgICAgICAgICAgIGBBdXRoZW50aWNhdGlvbiBmYWlsZWQ6ICR7ZmFpbGVkRXZlbnQucmVhc29uIGluc3RhbmNlb2YgRXJyb3IgPyBmYWlsZWRFdmVudC5yZWFzb24ubWVzc2FnZSA6IFN0cmluZyhmYWlsZWRFdmVudC5yZWFzb24pfWBcbiAgICAgICAgICApXG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgfVxuICApO1xuICBjb25zdCBvblNvY2tldEVycm9yID0gKGV2ZW50KSA9PiBtYWNoaW5lLnNlbmQoeyB0eXBlOiBcIkVYUExJQ0lUX1NPQ0tFVF9FUlJPUlwiLCBldmVudCB9KTtcbiAgY29uc3Qgb25Tb2NrZXRDbG9zZSA9IChldmVudCkgPT4gbWFjaGluZS5zZW5kKHsgdHlwZTogXCJFWFBMSUNJVF9TT0NLRVRfQ0xPU0VcIiwgZXZlbnQgfSk7XG4gIGNvbnN0IG9uU29ja2V0TWVzc2FnZSA9IChldmVudCkgPT4gZXZlbnQuZGF0YSA9PT0gXCJwb25nXCIgPyBtYWNoaW5lLnNlbmQoeyB0eXBlOiBcIlBPTkdcIiB9KSA6IG9uTWVzc2FnZS5ub3RpZnkoZXZlbnQpO1xuICBmdW5jdGlvbiB0ZWFyZG93blNvY2tldChzb2NrZXQpIHtcbiAgICBpZiAoc29ja2V0KSB7XG4gICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIG9uU29ja2V0RXJyb3IpO1xuICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCBvblNvY2tldENsb3NlKTtcbiAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBvblNvY2tldE1lc3NhZ2UpO1xuICAgICAgc29ja2V0LmNsb3NlKCk7XG4gICAgfVxuICB9XG4gIG1hY2hpbmUuYWRkVHJhbnNpdGlvbnMoXCJAY29ubmVjdGluZy5iYWNrb2ZmXCIsIHtcbiAgICBOQVZJR0FUT1JfT05MSU5FOiB7XG4gICAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYnVzeVwiLFxuICAgICAgZWZmZWN0OiBhc3NpZ24oeyBiYWNrb2ZmRGVsYXk6IFJFU0VUX0RFTEFZIH0pXG4gICAgfVxuICB9KS5hZGRUaW1lZFRyYW5zaXRpb24oXG4gICAgXCJAY29ubmVjdGluZy5iYWNrb2ZmXCIsXG4gICAgKGN0eCkgPT4gY3R4LmJhY2tvZmZEZWxheSxcbiAgICBcIkBjb25uZWN0aW5nLmJ1c3lcIlxuICApLm9uRW50ZXJBc3luYyhcbiAgICBcIkBjb25uZWN0aW5nLmJ1c3lcIixcbiAgICAvL1xuICAgIC8vIFVzZSB0aGUgXCJjcmVhdGVTb2NrZXRcIiBkZWxlZ2F0ZSBmdW5jdGlvbiAocHJvdmlkZWQgdG8gdGhlXG4gICAgLy8gTWFuYWdlZFNvY2tldCkgdG8gY3JlYXRlIHRoZSBhY3R1YWwgV2ViU29ja2V0IGNvbm5lY3Rpb24gaW5zdGFuY2UuXG4gICAgLy8gVGhlbiwgc2V0IHVwIGFsbCB0aGUgbmVjZXNzYXJ5IGV2ZW50IGxpc3RlbmVycywgYW5kIHdhaXQgZm9yIHRoZVxuICAgIC8vIFwib3BlblwiIGV2ZW50IHRvIG9jY3VyLlxuICAgIC8vXG4gICAgLy8gV2hlbiB0aGUgXCJvcGVuXCIgZXZlbnQgaGFwcGVucywgd2UncmUgcmVhZHkgdG8gdHJhbnNpdGlvbiB0byB0aGVcbiAgICAvLyBPSyBzdGF0ZS4gVGhpcyBpcyBkb25lIGJ5IHJlc29sdmluZyB0aGUgUHJvbWlzZS5cbiAgICAvL1xuICAgIGFzeW5jIChjdHgsIHNpZ25hbCkgPT4ge1xuICAgICAgbGV0IGNhcHR1cmVkUHJlbWF0dXJlRXZlbnQgPSBudWxsO1xuICAgICAgbGV0IHVuY29uZmlybWVkU29ja2V0ID0gbnVsbDtcbiAgICAgIGNvbnN0IGNvbm5lY3QkID0gbmV3IFByb21pc2UoXG4gICAgICAgIChyZXNvbHZlLCByZWopID0+IHtcbiAgICAgICAgICBpZiAoY3R4LmF1dGhWYWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gYXV0aCBhdXRoVmFsdWVcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHNvY2tldCA9IGRlbGVnYXRlcy5jcmVhdGVTb2NrZXQoY3R4LmF1dGhWYWx1ZSk7XG4gICAgICAgICAgdW5jb25maXJtZWRTb2NrZXQgPSBzb2NrZXQ7XG4gICAgICAgICAgZnVuY3Rpb24gcmVqZWN0KGV2ZW50KSB7XG4gICAgICAgICAgICBjYXB0dXJlZFByZW1hdHVyZUV2ZW50ID0gZXZlbnQ7XG4gICAgICAgICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgb25Tb2NrZXRNZXNzYWdlKTtcbiAgICAgICAgICAgIHJlaihldmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IFthY3RvciQsIGRpZFJlY2VpdmVBY3Rvcl0gPSBjb250cm9sbGVkUHJvbWlzZSgpO1xuICAgICAgICAgIGlmICghb3B0aW9ucy53YWl0Rm9yQWN0b3JJZCkge1xuICAgICAgICAgICAgZGlkUmVjZWl2ZUFjdG9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZ1bmN0aW9uIHdhaXRGb3JBY3RvcklkKGV2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXJNc2cgPSB0cnlQYXJzZUpzb24oZXZlbnQuZGF0YSk7XG4gICAgICAgICAgICBpZiAoc2VydmVyTXNnPy50eXBlID09PSAxMDQgLyogUk9PTV9TVEFURSAqLykge1xuICAgICAgICAgICAgICBkaWRSZWNlaXZlQWN0b3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG9uU29ja2V0TWVzc2FnZSk7XG4gICAgICAgICAgaWYgKG9wdGlvbnMud2FpdEZvckFjdG9ySWQpIHtcbiAgICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCB3YWl0Rm9yQWN0b3JJZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgcmVqZWN0KTtcbiAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsb3NlXCIsIHJlamVjdCk7XG4gICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJvcGVuXCIsICgpID0+IHtcbiAgICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgb25Tb2NrZXRFcnJvcik7XG4gICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsb3NlXCIsIG9uU29ja2V0Q2xvc2UpO1xuICAgICAgICAgICAgY29uc3QgdW5zdWIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCByZWplY3QpO1xuICAgICAgICAgICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgd2FpdEZvckFjdG9ySWQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZvaWQgYWN0b3IkLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKFtzb2NrZXQsIHVuc3ViXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB3aXRoVGltZW91dChcbiAgICAgICAgY29ubmVjdCQsXG4gICAgICAgIFNPQ0tFVF9DT05ORUNUX1RJTUVPVVQsXG4gICAgICAgIFwiVGltZWQgb3V0IGR1cmluZyB3ZWJzb2NrZXQgY29ubmVjdGlvblwiXG4gICAgICApLnRoZW4oXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFBhcnQgMzpcbiAgICAgICAgLy8gQnkgbm93LCBvdXIgXCJvcGVuXCIgZXZlbnQgaGFzIGZpcmVkLCBhbmQgdGhlIHByb21pc2UgaGFzIGJlZW5cbiAgICAgICAgLy8gcmVzb2x2ZWQuIFR3byBwb3NzaWJsZSBzY2VuYXJpb3M6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIDEuIFRoZSBoYXBweSBwYXRoLiBNb3N0IGxpa2VseS5cbiAgICAgICAgLy8gMi4gVWgtb2guIEEgcHJlbWF0dXJlIGNsb3NlL2Vycm9yIGV2ZW50IGhhcyBiZWVuIG9ic2VydmVkLiBMZXQnc1xuICAgICAgICAvLyAgICByZWplY3QgdGhlIHByb21pc2UgYWZ0ZXIgYWxsLlxuICAgICAgICAvL1xuICAgICAgICAvLyBBbnkgY2xvc2UvZXJyb3IgZXZlbnQgdGhhdCB3aWxsIGdldCBzY2hlZHVsZWQgYWZ0ZXIgdGhpcyBwb2ludFxuICAgICAgICAvLyBvbndhcmRzLCB3aWxsIGJlIGNhdWdodCBpbiB0aGUgT0sgc3RhdGUsIGFuZCBkZWFsdCB3aXRoXG4gICAgICAgIC8vIGFjY29yZGluZ2x5LlxuICAgICAgICAvL1xuICAgICAgICAoW3NvY2tldCwgdW5zdWJdKSA9PiB7XG4gICAgICAgICAgdW5zdWIoKTtcbiAgICAgICAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFib3J0ZWRcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXB0dXJlZFByZW1hdHVyZUV2ZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBjYXB0dXJlZFByZW1hdHVyZUV2ZW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gc29ja2V0O1xuICAgICAgICB9XG4gICAgICApLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIHRlYXJkb3duU29ja2V0KHVuY29uZmlybWVkU29ja2V0KTtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgLy8gT25seSB0cmFuc2l0aW9uIHRvIE9LIHN0YXRlIGFmdGVyIGEgc3VjY2Vzc2Z1bGx5IG9wZW5lZCBXZWJTb2NrZXQgY29ubmVjdGlvblxuICAgIChva0V2ZW50KSA9PiAoe1xuICAgICAgdGFyZ2V0OiBcIkBvay5jb25uZWN0ZWRcIixcbiAgICAgIGVmZmVjdDogYXNzaWduKHtcbiAgICAgICAgc29ja2V0OiBva0V2ZW50LmRhdGEsXG4gICAgICAgIGJhY2tvZmZEZWxheTogUkVTRVRfREVMQVlcbiAgICAgIH0pXG4gICAgfSksXG4gICAgLy8gSWYgdGhlIFdlYlNvY2tldCBjb25uZWN0aW9uIGNhbm5vdCBiZSBlc3RhYmxpc2hlZFxuICAgIChmYWlsdXJlKSA9PiB7XG4gICAgICBjb25zdCBlcnIgPSBmYWlsdXJlLnJlYXNvbjtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBTdG9wUmV0cnlpbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0YXJnZXQ6IFwiQGlkbGUuZmFpbGVkXCIsXG4gICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICBsb2coMiAvKiBFUlJPUiAqLywgZXJyLm1lc3NhZ2UpLFxuICAgICAgICAgICAgZmlyZUVycm9yRXZlbnQoZXJyLm1lc3NhZ2UsIC0xKVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0Nsb3NlRXZlbnQoZXJyKSkge1xuICAgICAgICBpZiAoZXJyLmNvZGUgPT09IDQxMDkgLyogVE9LRU5fRVhQSVJFRCAqLykge1xuICAgICAgICAgIHJldHVybiBcIkBhdXRoLmJ1c3lcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvdWxkUmV0cnlXaXRob3V0UmVhdXRoKGVyci5jb2RlKSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLFxuICAgICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICAgIGluY3JlYXNlQmFja29mZkRlbGF5QWdncmVzc2l2ZWx5LFxuICAgICAgICAgICAgICBsb2dQcmVtYXR1cmVFcnJvck9yQ2xvc2VFdmVudChlcnIpXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvdWxkRGlzY29ubmVjdChlcnIuY29kZSkpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFyZ2V0OiBcIkBpZGxlLmZhaWxlZFwiLFxuICAgICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICAgIGxvZygyIC8qIEVSUk9SICovLCBlcnIucmVhc29uKSxcbiAgICAgICAgICAgICAgZmlyZUVycm9yRXZlbnQoZXJyLnJlYXNvbiwgZXJyLmNvZGUpXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAgICAgZWZmZWN0OiBbaW5jcmVhc2VCYWNrb2ZmRGVsYXksIGxvZ1ByZW1hdHVyZUVycm9yT3JDbG9zZUV2ZW50KGVycildXG4gICAgICB9O1xuICAgIH1cbiAgKTtcbiAgY29uc3Qgc2VuZEhlYXJ0YmVhdCA9IHtcbiAgICB0YXJnZXQ6IFwiQG9rLmF3YWl0aW5nLXBvbmdcIixcbiAgICBlZmZlY3Q6IChjdHgpID0+IHtcbiAgICAgIGN0eC5zb2NrZXQ/LnNlbmQoXCJwaW5nXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWF5YmVIZWFydGJlYXQgPSAoKSA9PiB7XG4gICAgY29uc3QgZG9jID0gdHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiID8gZG9jdW1lbnQgOiB2b2lkIDA7XG4gICAgY29uc3QgY2FuWm9tYmllID0gZG9jPy52aXNpYmlsaXR5U3RhdGUgPT09IFwiaGlkZGVuXCIgJiYgZGVsZWdhdGVzLmNhblpvbWJpZSgpO1xuICAgIHJldHVybiBjYW5ab21iaWUgPyBcIkBpZGxlLnpvbWJpZVwiIDogc2VuZEhlYXJ0YmVhdDtcbiAgfTtcbiAgbWFjaGluZS5hZGRUaW1lZFRyYW5zaXRpb24oXCJAb2suY29ubmVjdGVkXCIsIEhFQVJUQkVBVF9JTlRFUlZBTCwgbWF5YmVIZWFydGJlYXQpLmFkZFRyYW5zaXRpb25zKFwiQG9rLmNvbm5lY3RlZFwiLCB7XG4gICAgTkFWSUdBVE9SX09GRkxJTkU6IG1heWJlSGVhcnRiZWF0LFxuICAgIC8vIERvbid0IHRha2UgdGhlIGJyb3dzZXIncyB3b3JkIGZvciBpdCB3aGVuIGl0IHNheXMgaXQncyBvZmZsaW5lLiBEbyBhIHBpbmcvcG9uZyB0byBtYWtlIHN1cmUuXG4gICAgV0lORE9XX0dPVF9GT0NVUzogc2VuZEhlYXJ0YmVhdFxuICB9KTtcbiAgbWFjaGluZS5hZGRUcmFuc2l0aW9ucyhcIkBpZGxlLnpvbWJpZVwiLCB7XG4gICAgV0lORE9XX0dPVF9GT0NVUzogXCJAY29ubmVjdGluZy5iYWNrb2ZmXCJcbiAgICAvLyBXaGVuIGluIHpvbWJpZSBzdGF0ZSwgdGhlIGNsaWVudCB3aWxsIHRyeSB0byB3YWtlIHVwIGF1dG9tYXRpY2FsbHkgd2hlbiB0aGUgd2luZG93IHJlZ2FpbnMgZm9jdXNcbiAgfSk7XG4gIG1hY2hpbmUub25FbnRlcihcIkBvay4qXCIsIChjdHgpID0+IHtcbiAgICBjdHgucGF0Y2goeyBzdWNjZXNzQ291bnQ6IGN0eC5zdWNjZXNzQ291bnQgKyAxIH0pO1xuICAgIGNvbnN0IHRpbWVySUQgPSBzZXRUaW1lb3V0KFxuICAgICAgLy8gT24gdGhlIG5leHQgdGljaywgc3RhcnQgZGVsaXZlcmluZyBhbGwgbWVzc2FnZXMgdGhhdCBoYXZlIGFscmVhZHlcbiAgICAgIC8vIGJlZW4gcmVjZWl2ZWQsIGFuZCBjb250aW51ZSBzeW5jaHJvbm91cyBkZWxpdmVyeSBvZiBhbGwgZnV0dXJlXG4gICAgICAvLyBpbmNvbWluZyBtZXNzYWdlcy5cbiAgICAgIG9uTWVzc2FnZS51bnBhdXNlLFxuICAgICAgMFxuICAgICk7XG4gICAgcmV0dXJuIChjdHgyKSA9PiB7XG4gICAgICB0ZWFyZG93blNvY2tldChjdHgyLnNvY2tldCk7XG4gICAgICBjdHgyLnBhdGNoKHsgc29ja2V0OiBudWxsIH0pO1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVySUQpO1xuICAgICAgb25NZXNzYWdlLnBhdXNlKCk7XG4gICAgfTtcbiAgfSkuYWRkVHJhbnNpdGlvbnMoXCJAb2suYXdhaXRpbmctcG9uZ1wiLCB7IFBPTkc6IFwiQG9rLmNvbm5lY3RlZFwiIH0pLmFkZFRpbWVkVHJhbnNpdGlvbihcIkBvay5hd2FpdGluZy1wb25nXCIsIFBPTkdfVElNRU9VVCwge1xuICAgIHRhcmdldDogXCJAY29ubmVjdGluZy5idXN5XCIsXG4gICAgLy8gTG9nIGltcGxpY2l0IGNvbm5lY3Rpb24gbG9zcyBhbmQgZHJvcCB0aGUgY3VycmVudCBvcGVuIHNvY2tldFxuICAgIGVmZmVjdDogbG9nKFxuICAgICAgMSAvKiBXQVJOICovLFxuICAgICAgXCJSZWNlaXZlZCBubyBwb25nIGZyb20gc2VydmVyLCBhc3N1bWUgaW1wbGljaXQgY29ubmVjdGlvbiBsb3NzLlwiXG4gICAgKVxuICB9KS5hZGRUcmFuc2l0aW9ucyhcIkBvay4qXCIsIHtcbiAgICAvLyBXaGVuIGEgc29ja2V0IHJlY2VpdmVzIGFuIGVycm9yLCB0aGlzIGNhbiBjYXVzZSB0aGUgY2xvc2luZyBvZiB0aGVcbiAgICAvLyBzb2NrZXQsIG9yIG5vdC4gU28gYWx3YXlzIGNoZWNrIHRvIHNlZSBpZiB0aGUgc29ja2V0IGlzIHN0aWxsIE9QRU4gb3JcbiAgICAvLyBub3QuIFdoZW4gc3RpbGwgT1BFTiwgZG9uJ3QgdHJhbnNpdGlvbi5cbiAgICBFWFBMSUNJVF9TT0NLRVRfRVJST1I6IChfLCBjb250ZXh0KSA9PiB7XG4gICAgICBpZiAoY29udGV4dC5zb2NrZXQ/LnJlYWR5U3RhdGUgPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLFxuICAgICAgICBlZmZlY3Q6IGluY3JlYXNlQmFja29mZkRlbGF5XG4gICAgICB9O1xuICAgIH0sXG4gICAgRVhQTElDSVRfU09DS0VUX0NMT1NFOiAoZSkgPT4ge1xuICAgICAgaWYgKHNob3VsZERpc2Nvbm5lY3QoZS5ldmVudC5jb2RlKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRhcmdldDogXCJAaWRsZS5mYWlsZWRcIixcbiAgICAgICAgICBlZmZlY3Q6IFtcbiAgICAgICAgICAgIGxvZ1Blcm1hbmVudENsb3NlLFxuICAgICAgICAgICAgZmlyZUVycm9yRXZlbnQoZS5ldmVudC5yZWFzb24sIGUuZXZlbnQuY29kZSlcbiAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoc2hvdWxkUmVhdXRoKGUuZXZlbnQuY29kZSkpIHtcbiAgICAgICAgaWYgKGUuZXZlbnQuY29kZSA9PT0gNDEwOSAvKiBUT0tFTl9FWFBJUkVEICovKSB7XG4gICAgICAgICAgcmV0dXJuIFwiQGF1dGguYnVzeVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0YXJnZXQ6IFwiQGF1dGguYmFja29mZlwiLFxuICAgICAgICAgICAgZWZmZWN0OiBbaW5jcmVhc2VCYWNrb2ZmRGVsYXksIGxvZ0Nsb3NlRXZlbnQoZS5ldmVudCldXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHNob3VsZFJldHJ5V2l0aG91dFJlYXV0aChlLmV2ZW50LmNvZGUpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJhY2tvZmZcIixcbiAgICAgICAgICBlZmZlY3Q6IFtpbmNyZWFzZUJhY2tvZmZEZWxheUFnZ3Jlc3NpdmVseSwgbG9nQ2xvc2VFdmVudChlLmV2ZW50KV1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldDogXCJAY29ubmVjdGluZy5iYWNrb2ZmXCIsXG4gICAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCBsb2dDbG9zZUV2ZW50KGUuZXZlbnQpXVxuICAgICAgfTtcbiAgICB9XG4gIH0pO1xuICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgY29uc3QgZG9jID0gdHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiID8gZG9jdW1lbnQgOiB2b2lkIDA7XG4gICAgY29uc3Qgd2luID0gdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHZvaWQgMDtcbiAgICBjb25zdCByb290ID0gd2luID8/IGRvYztcbiAgICBtYWNoaW5lLm9uRW50ZXIoXCIqXCIsIChjdHgpID0+IHtcbiAgICAgIGZ1bmN0aW9uIG9uTmV0d29ya09mZmxpbmUoKSB7XG4gICAgICAgIG1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiTkFWSUdBVE9SX09GRkxJTkVcIiB9KTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIG9uTmV0d29ya0JhY2tPbmxpbmUoKSB7XG4gICAgICAgIG1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiTkFWSUdBVE9SX09OTElORVwiIH0pO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gb25WaXNpYmlsaXR5Q2hhbmdlKCkge1xuICAgICAgICBpZiAoZG9jPy52aXNpYmlsaXR5U3RhdGUgPT09IFwidmlzaWJsZVwiKSB7XG4gICAgICAgICAgbWFjaGluZS5zZW5kKHsgdHlwZTogXCJXSU5ET1dfR09UX0ZPQ1VTXCIgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHdpbj8uYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCBvbk5ldHdvcmtCYWNrT25saW5lKTtcbiAgICAgIHdpbj8uYWRkRXZlbnRMaXN0ZW5lcihcIm9mZmxpbmVcIiwgb25OZXR3b3JrT2ZmbGluZSk7XG4gICAgICByb290Py5hZGRFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCBvblZpc2liaWxpdHlDaGFuZ2UpO1xuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgcm9vdD8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgb25WaXNpYmlsaXR5Q2hhbmdlKTtcbiAgICAgICAgd2luPy5yZW1vdmVFdmVudExpc3RlbmVyKFwib25saW5lXCIsIG9uTmV0d29ya0JhY2tPbmxpbmUpO1xuICAgICAgICB3aW4/LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIG9uTmV0d29ya09mZmxpbmUpO1xuICAgICAgICB0ZWFyZG93blNvY2tldChjdHguc29ja2V0KTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbiAgY29uc3QgY2xlYW51cHMgPSBbXTtcbiAgY29uc3QgeyBzdGF0dXNEaWRDaGFuZ2UsIGRpZENvbm5lY3QsIGRpZERpc2Nvbm5lY3QsIHVuc3Vic2NyaWJlIH0gPSBkZWZpbmVDb25uZWN0aXZpdHlFdmVudHMobWFjaGluZSk7XG4gIGNsZWFudXBzLnB1c2godW5zdWJzY3JpYmUpO1xuICBpZiAob3B0aW9ucy5lbmFibGVEZWJ1Z0xvZ2dpbmcpIHtcbiAgICBjbGVhbnVwcy5wdXNoKGVuYWJsZVRyYWNpbmcobWFjaGluZSkpO1xuICB9XG4gIG1hY2hpbmUuc3RhcnQoKTtcbiAgcmV0dXJuIHtcbiAgICBtYWNoaW5lLFxuICAgIGNsZWFudXBzLFxuICAgIC8vIE9ic2VydmFibGUgZXZlbnRzIHRoYXQgd2lsbCBiZSBlbWl0dGVkIGJ5IHRoaXMgbWFjaGluZVxuICAgIGV2ZW50czoge1xuICAgICAgc3RhdHVzRGlkQ2hhbmdlLFxuICAgICAgZGlkQ29ubmVjdCxcbiAgICAgIGRpZERpc2Nvbm5lY3QsXG4gICAgICBvbk1lc3NhZ2U6IG9uTWVzc2FnZS5vYnNlcnZhYmxlLFxuICAgICAgb25MaXZlYmxvY2tzRXJyb3I6IG9uTGl2ZWJsb2Nrc0Vycm9yLm9ic2VydmFibGVcbiAgICB9XG4gIH07XG59XG52YXIgTWFuYWdlZFNvY2tldCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoZGVsZWdhdGVzLCBlbmFibGVEZWJ1Z0xvZ2dpbmcgPSBmYWxzZSwgd2FpdEZvckFjdG9ySWQgPSB0cnVlKSB7XG4gICAgY29uc3QgeyBtYWNoaW5lLCBldmVudHMsIGNsZWFudXBzIH0gPSBjcmVhdGVDb25uZWN0aW9uU3RhdGVNYWNoaW5lKFxuICAgICAgZGVsZWdhdGVzLFxuICAgICAgeyB3YWl0Rm9yQWN0b3JJZCwgZW5hYmxlRGVidWdMb2dnaW5nIH1cbiAgICApO1xuICAgIHRoaXMubWFjaGluZSA9IG1hY2hpbmU7XG4gICAgdGhpcy5ldmVudHMgPSBldmVudHM7XG4gICAgdGhpcy5jbGVhbnVwcyA9IGNsZWFudXBzO1xuICB9XG4gIGdldFN0YXR1cygpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHRvTmV3Q29ubmVjdGlvblN0YXR1cyh0aGlzLm1hY2hpbmUpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIFwiaW5pdGlhbFwiO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCBhdXRoIGF1dGhWYWx1ZS5cbiAgICovXG4gIGdldCBhdXRoVmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMubWFjaGluZS5jb250ZXh0LmF1dGhWYWx1ZTtcbiAgfVxuICAvKipcbiAgICogQ2FsbCB0aGlzIG1ldGhvZCB0byB0cnkgdG8gY29ubmVjdCB0byBhIFdlYlNvY2tldC4gVGhpcyBvbmx5IGhhcyBhbiBlZmZlY3RcbiAgICogaWYgdGhlIG1hY2hpbmUgaXMgaWRsZSBhdCB0aGUgbW9tZW50LCBvdGhlcndpc2UgdGhpcyBpcyBhIG5vLW9wLlxuICAgKi9cbiAgY29ubmVjdCgpIHtcbiAgICB0aGlzLm1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiQ09OTkVDVFwiIH0pO1xuICB9XG4gIC8qKlxuICAgKiBJZiBpZGxlLCB3aWxsIHRyeSB0byBjb25uZWN0LiBPdGhlcndpc2UsIGl0IHdpbGwgYXR0ZW1wdCB0byByZWNvbm5lY3QgdG9cbiAgICogdGhlIHNvY2tldCwgcG90ZW50aWFsbHkgb2J0YWluaW5nIGEgbmV3IGF1dGhWYWx1ZSBmaXJzdCwgaWYgbmVlZGVkLlxuICAgKi9cbiAgcmVjb25uZWN0KCkge1xuICAgIHRoaXMubWFjaGluZS5zZW5kKHsgdHlwZTogXCJSRUNPTk5FQ1RcIiB9KTtcbiAgfVxuICAvKipcbiAgICogQ2FsbCB0aGlzIG1ldGhvZCB0byBkaXNjb25uZWN0IGZyb20gdGhlIGN1cnJlbnQgV2ViU29ja2V0LiBJcyBnb2luZyB0byBiZVxuICAgKiBhIG5vLW9wIGlmIHRoZXJlIGlzIG5vIGFjdGl2ZSBjb25uZWN0aW9uLlxuICAgKi9cbiAgZGlzY29ubmVjdCgpIHtcbiAgICB0aGlzLm1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiRElTQ09OTkVDVFwiIH0pO1xuICB9XG4gIC8qKlxuICAgKiBDYWxsIHRoaXMgdG8gc3RvcCB0aGUgbWFjaGluZSBhbmQgcnVuIG5lY2Vzc2FyeSBjbGVhbnVwIGZ1bmN0aW9ucy4gQWZ0ZXJcbiAgICogY2FsbGluZyBkZXN0cm95KCksIHlvdSBjYW4gbm8gbG9uZ2VyIHVzZSB0aGlzIGluc3RhbmNlLiBDYWxsIHRoaXMgYmVmb3JlXG4gICAqIGxldHRpbmcgdGhlIGluc3RhbmNlIGdldCBnYXJiYWdlIGNvbGxlY3RlZC5cbiAgICovXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5tYWNoaW5lLnN0b3AoKTtcbiAgICBsZXQgY2xlYW51cDtcbiAgICB3aGlsZSAoY2xlYW51cCA9IHRoaXMuY2xlYW51cHMucG9wKCkpIHtcbiAgICAgIGNsZWFudXAoKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFNhZmVseSBzZW5kIGEgbWVzc2FnZSB0byB0aGUgY3VycmVudCBXZWJTb2NrZXQgY29ubmVjdGlvbi4gV2lsbCBlbWl0IGEgbG9nXG4gICAqIG1lc3NhZ2UgaWYgdGhpcyBpcyBzb21laG93IGltcG9zc2libGUuXG4gICAqL1xuICBzZW5kKGRhdGEpIHtcbiAgICBjb25zdCBzb2NrZXQgPSB0aGlzLm1hY2hpbmUuY29udGV4dD8uc29ja2V0O1xuICAgIGlmIChzb2NrZXQgPT09IG51bGwpIHtcbiAgICAgIHdhcm4oXCJDYW5ub3Qgc2VuZDogbm90IGNvbm5lY3RlZCB5ZXRcIiwgZGF0YSk7XG4gICAgfSBlbHNlIGlmIChzb2NrZXQucmVhZHlTdGF0ZSAhPT0gMSkge1xuICAgICAgd2FybihcIkNhbm5vdCBzZW5kOiBXZWJTb2NrZXQgbm8gbG9uZ2VyIG9wZW5cIiwgZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNvY2tldC5zZW5kKGRhdGEpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogTk9URTogVXNlZCBieSB0aGUgRTJFIGFwcCBvbmx5LCB0byBzaW11bGF0ZSBleHBsaWNpdCBldmVudHMuXG4gICAqIE5vdCBpZGVhbCB0byBrZWVwIGV4cG9zZWQgOihcbiAgICovXG4gIF9wcml2YXRlU2VuZE1hY2hpbmVFdmVudChldmVudCkge1xuICAgIHRoaXMubWFjaGluZS5zZW5kKGV2ZW50KTtcbiAgfVxufTtcblxuLy8gc3JjL3Byb3RvY29sL0F1dGhUb2tlbi50c1xuZnVuY3Rpb24gY2FuV3JpdGVTdG9yYWdlKHNjb3Blcykge1xuICByZXR1cm4gc2NvcGVzLmluY2x1ZGVzKFwicm9vbTp3cml0ZVwiIC8qIFdyaXRlICovKTtcbn1cbmZ1bmN0aW9uIGNhbkNvbW1lbnQoc2NvcGVzKSB7XG4gIHJldHVybiBzY29wZXMuaW5jbHVkZXMoXCJjb21tZW50czp3cml0ZVwiIC8qIENvbW1lbnRzV3JpdGUgKi8pIHx8IHNjb3Blcy5pbmNsdWRlcyhcInJvb206d3JpdGVcIiAvKiBXcml0ZSAqLyk7XG59XG5mdW5jdGlvbiBpc1ZhbGlkQXV0aFRva2VuUGF5bG9hZChkYXRhKSB7XG4gIHJldHVybiBpc1BsYWluT2JqZWN0KGRhdGEpICYmIChkYXRhLmsgPT09IFwiYWNjXCIgLyogQUNDRVNTX1RPS0VOICovIHx8IGRhdGEuayA9PT0gXCJpZFwiIC8qIElEX1RPS0VOICovIHx8IGRhdGEuayA9PT0gXCJzZWMtbGVnYWN5XCIgLyogU0VDUkVUX0xFR0FDWSAqLyk7XG59XG5mdW5jdGlvbiBwYXJzZUF1dGhUb2tlbihyYXdUb2tlblN0cmluZykge1xuICBjb25zdCB0b2tlblBhcnRzID0gcmF3VG9rZW5TdHJpbmcuc3BsaXQoXCIuXCIpO1xuICBpZiAodG9rZW5QYXJ0cy5sZW5ndGggIT09IDMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJBdXRoZW50aWNhdGlvbiBlcnJvcjogaW52YWxpZCBKV1QgdG9rZW5cIik7XG4gIH1cbiAgY29uc3QgcGF5bG9hZCA9IHRyeVBhcnNlSnNvbihiNjRkZWNvZGUodG9rZW5QYXJ0c1sxXSkpO1xuICBpZiAoIShwYXlsb2FkICYmIGlzVmFsaWRBdXRoVG9rZW5QYXlsb2FkKHBheWxvYWQpKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiQXV0aGVudGljYXRpb24gZXJyb3I6IGV4cGVjdGVkIGEgdmFsaWQgdG9rZW4gYnV0IGRpZCBub3QgZ2V0IG9uZS4gSGludDogaWYgeW91IGFyZSB1c2luZyBhIGNhbGxiYWNrLCBlbnN1cmUgdGhlIHJvb20gaXMgcGFzc2VkIHdoZW4gY3JlYXRpbmcgdGhlIHRva2VuLiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRDYWxsYmFja1wiXG4gICAgKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHJhdzogcmF3VG9rZW5TdHJpbmcsXG4gICAgcGFyc2VkOiBwYXlsb2FkXG4gIH07XG59XG5cbi8vIHNyYy9hdXRoLW1hbmFnZXIudHNcbmZ1bmN0aW9uIGNyZWF0ZUF1dGhNYW5hZ2VyKGF1dGhPcHRpb25zKSB7XG4gIGNvbnN0IGF1dGhlbnRpY2F0aW9uID0gcHJlcGFyZUF1dGhlbnRpY2F0aW9uKGF1dGhPcHRpb25zKTtcbiAgY29uc3Qgc2VlblRva2VucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gIGNvbnN0IHRva2VucyA9IFtdO1xuICBjb25zdCBleHBpcnlUaW1lcyA9IFtdO1xuICBjb25zdCByZXF1ZXN0UHJvbWlzZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICBzZWVuVG9rZW5zLmNsZWFyKCk7XG4gICAgdG9rZW5zLmxlbmd0aCA9IDA7XG4gICAgZXhwaXJ5VGltZXMubGVuZ3RoID0gMDtcbiAgICByZXF1ZXN0UHJvbWlzZXMuY2xlYXIoKTtcbiAgfVxuICBmdW5jdGlvbiBoYXNDb3JyZXNwb25kaW5nU2NvcGVzKHJlcXVlc3RlZFNjb3BlLCBzY29wZXMpIHtcbiAgICBpZiAocmVxdWVzdGVkU2NvcGUgPT09IFwiY29tbWVudHM6cmVhZFwiKSB7XG4gICAgICByZXR1cm4gc2NvcGVzLmluY2x1ZGVzKFwiY29tbWVudHM6cmVhZFwiIC8qIENvbW1lbnRzUmVhZCAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwiY29tbWVudHM6d3JpdGVcIiAvKiBDb21tZW50c1dyaXRlICovKSB8fCBzY29wZXMuaW5jbHVkZXMoXCJyb29tOnJlYWRcIiAvKiBSZWFkICovKSB8fCBzY29wZXMuaW5jbHVkZXMoXCJyb29tOndyaXRlXCIgLyogV3JpdGUgKi8pO1xuICAgIH0gZWxzZSBpZiAocmVxdWVzdGVkU2NvcGUgPT09IFwicm9vbTpyZWFkXCIpIHtcbiAgICAgIHJldHVybiBzY29wZXMuaW5jbHVkZXMoXCJyb29tOnJlYWRcIiAvKiBSZWFkICovKSB8fCBzY29wZXMuaW5jbHVkZXMoXCJyb29tOndyaXRlXCIgLyogV3JpdGUgKi8pO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0Q2FjaGVkVG9rZW4ocmVxdWVzdE9wdGlvbnMpIHtcbiAgICBjb25zdCBub3cgPSBNYXRoLmNlaWwoRGF0ZS5ub3coKSAvIDFlMyk7XG4gICAgZm9yIChsZXQgaSA9IHRva2Vucy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgdG9rZW4gPSB0b2tlbnNbaV07XG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBleHBpcnlUaW1lc1tpXTtcbiAgICAgIGlmIChleHBpcmVzQXQgPD0gbm93KSB7XG4gICAgICAgIHRva2Vucy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGV4cGlyeVRpbWVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW4ucGFyc2VkLmsgPT09IFwiaWRcIiAvKiBJRF9UT0tFTiAqLykge1xuICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICB9IGVsc2UgaWYgKHRva2VuLnBhcnNlZC5rID09PSBcImFjY1wiIC8qIEFDQ0VTU19UT0tFTiAqLykge1xuICAgICAgICBpZiAoIXJlcXVlc3RPcHRpb25zLnJvb21JZCAmJiBPYmplY3QuZW50cmllcyh0b2tlbi5wYXJzZWQucGVybXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IFtyZXNvdXJjZSwgc2NvcGVzXSBvZiBPYmplY3QuZW50cmllcyh0b2tlbi5wYXJzZWQucGVybXMpKSB7XG4gICAgICAgICAgaWYgKCFyZXF1ZXN0T3B0aW9ucy5yb29tSWQpIHtcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZS5pbmNsdWRlcyhcIipcIikgJiYgaGFzQ29ycmVzcG9uZGluZ1Njb3BlcyhyZXF1ZXN0T3B0aW9ucy5yZXF1ZXN0ZWRTY29wZSwgc2NvcGVzKSkge1xuICAgICAgICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChyZXNvdXJjZS5pbmNsdWRlcyhcIipcIikgJiYgcmVxdWVzdE9wdGlvbnMucm9vbUlkLnN0YXJ0c1dpdGgocmVzb3VyY2UucmVwbGFjZShcIipcIiwgXCJcIikpIHx8IHJlcXVlc3RPcHRpb25zLnJvb21JZCA9PT0gcmVzb3VyY2UgJiYgaGFzQ29ycmVzcG9uZGluZ1Njb3BlcyhyZXF1ZXN0T3B0aW9ucy5yZXF1ZXN0ZWRTY29wZSwgc2NvcGVzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIG1ha2VBdXRoUmVxdWVzdChvcHRpb25zKSB7XG4gICAgY29uc3QgZmV0Y2hlciA9IGF1dGhPcHRpb25zLnBvbHlmaWxscz8uZmV0Y2ggPz8gKHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyB2b2lkIDAgOiB3aW5kb3cuZmV0Y2gpO1xuICAgIGlmIChhdXRoZW50aWNhdGlvbi50eXBlID09PSBcInByaXZhdGVcIikge1xuICAgICAgaWYgKGZldGNoZXIgPT09IHZvaWQgMCkge1xuICAgICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKFxuICAgICAgICAgIFwiVG8gdXNlIExpdmVibG9ja3MgY2xpZW50IGluIGEgbm9uLURPTSBlbnZpcm9ubWVudCB3aXRoIGEgdXJsIGFzIGF1dGggZW5kcG9pbnQsIHlvdSBuZWVkIHRvIHByb3ZpZGUgYSBmZXRjaCBwb2x5ZmlsbC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaEF1dGhFbmRwb2ludChmZXRjaGVyLCBhdXRoZW50aWNhdGlvbi51cmwsIHtcbiAgICAgICAgcm9vbTogb3B0aW9ucy5yb29tSWRcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcGFyc2VkID0gcGFyc2VBdXRoVG9rZW4ocmVzcG9uc2UudG9rZW4pO1xuICAgICAgaWYgKHNlZW5Ub2tlbnMuaGFzKHBhcnNlZC5yYXcpKSB7XG4gICAgICAgIHRocm93IG5ldyBTdG9wUmV0cnlpbmcoXG4gICAgICAgICAgXCJUaGUgc2FtZSBMaXZlYmxvY2tzIGF1dGggdG9rZW4gd2FzIGlzc3VlZCBmcm9tIHRoZSBiYWNrZW5kIGJlZm9yZS4gQ2FjaGluZyBMaXZlYmxvY2tzIHRva2VucyBpcyBub3Qgc3VwcG9ydGVkLlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFyc2VkO1xuICAgIH1cbiAgICBpZiAoYXV0aGVudGljYXRpb24udHlwZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhdXRoZW50aWNhdGlvbi5jYWxsYmFjayhvcHRpb25zLnJvb21JZCk7XG4gICAgICBpZiAocmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2UudG9rZW4gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZUF1dGhUb2tlbihyZXNwb25zZS50b2tlbik7XG4gICAgICAgICAgcmV0dXJuIHBhcnNlZDtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzcG9uc2UuZXJyb3IgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBjb25zdCByZWFzb24gPSBgQXV0aGVudGljYXRpb24gZmFpbGVkOiAke1wicmVhc29uXCIgaW4gcmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlLnJlYXNvbiA9PT0gXCJzdHJpbmdcIiA/IHJlc3BvbnNlLnJlYXNvbiA6IFwiRm9yYmlkZGVuXCJ9YDtcbiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IgPT09IFwiZm9yYmlkZGVuXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBTdG9wUmV0cnlpbmcocmVhc29uKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlYXNvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdZb3VyIGF1dGhlbnRpY2F0aW9uIGNhbGxiYWNrIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSB0b2tlbiwgYnV0IGl0IGRpZCBub3QuIEhpbnQ6IHRoZSByZXR1cm4gdmFsdWUgc2hvdWxkIGxvb2sgbGlrZTogeyB0b2tlbjogXCIuLi5cIiB9J1xuICAgICAgKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJVbmV4cGVjdGVkIGF1dGhlbnRpY2F0aW9uIHR5cGUuIE11c3QgYmUgcHJpdmF0ZSBvciBjdXN0b20uXCJcbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhWYWx1ZShyZXF1ZXN0T3B0aW9ucykge1xuICAgIGlmIChhdXRoZW50aWNhdGlvbi50eXBlID09PSBcInB1YmxpY1wiKSB7XG4gICAgICByZXR1cm4geyB0eXBlOiBcInB1YmxpY1wiLCBwdWJsaWNBcGlLZXk6IGF1dGhlbnRpY2F0aW9uLnB1YmxpY0FwaUtleSB9O1xuICAgIH1cbiAgICBjb25zdCBjYWNoZWRUb2tlbiA9IGdldENhY2hlZFRva2VuKHJlcXVlc3RPcHRpb25zKTtcbiAgICBpZiAoY2FjaGVkVG9rZW4gIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJzZWNyZXRcIiwgdG9rZW46IGNhY2hlZFRva2VuIH07XG4gICAgfVxuICAgIGxldCBjdXJyZW50UHJvbWlzZTtcbiAgICBpZiAocmVxdWVzdE9wdGlvbnMucm9vbUlkKSB7XG4gICAgICBjdXJyZW50UHJvbWlzZSA9IHJlcXVlc3RQcm9taXNlcy5nZXQocmVxdWVzdE9wdGlvbnMucm9vbUlkKTtcbiAgICAgIGlmIChjdXJyZW50UHJvbWlzZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGN1cnJlbnRQcm9taXNlID0gbWFrZUF1dGhSZXF1ZXN0KHJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgcmVxdWVzdFByb21pc2VzLnNldChyZXF1ZXN0T3B0aW9ucy5yb29tSWQsIGN1cnJlbnRQcm9taXNlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY3VycmVudFByb21pc2UgPSByZXF1ZXN0UHJvbWlzZXMuZ2V0KFwibGl2ZWJsb2Nrcy11c2VyLXRva2VuXCIpO1xuICAgICAgaWYgKGN1cnJlbnRQcm9taXNlID09PSB2b2lkIDApIHtcbiAgICAgICAgY3VycmVudFByb21pc2UgPSBtYWtlQXV0aFJlcXVlc3QocmVxdWVzdE9wdGlvbnMpO1xuICAgICAgICByZXF1ZXN0UHJvbWlzZXMuc2V0KFwibGl2ZWJsb2Nrcy11c2VyLXRva2VuXCIsIGN1cnJlbnRQcm9taXNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgY3VycmVudFByb21pc2U7XG4gICAgICBjb25zdCBCVUZGRVIgPSAzMDtcbiAgICAgIGNvbnN0IGV4cGlyZXNBdCA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDFlMykgKyAodG9rZW4ucGFyc2VkLmV4cCAtIHRva2VuLnBhcnNlZC5pYXQpIC0gQlVGRkVSO1xuICAgICAgc2VlblRva2Vucy5hZGQodG9rZW4ucmF3KTtcbiAgICAgIGlmICh0b2tlbi5wYXJzZWQuayAhPT0gXCJzZWMtbGVnYWN5XCIgLyogU0VDUkVUX0xFR0FDWSAqLykge1xuICAgICAgICB0b2tlbnMucHVzaCh0b2tlbik7XG4gICAgICAgIGV4cGlyeVRpbWVzLnB1c2goZXhwaXJlc0F0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHR5cGU6IFwic2VjcmV0XCIsIHRva2VuIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChyZXF1ZXN0T3B0aW9ucy5yb29tSWQpIHtcbiAgICAgICAgcmVxdWVzdFByb21pc2VzLmRlbGV0ZShyZXF1ZXN0T3B0aW9ucy5yb29tSWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxdWVzdFByb21pc2VzLmRlbGV0ZShcImxpdmVibG9ja3MtdXNlci10b2tlblwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICByZXNldCxcbiAgICBnZXRBdXRoVmFsdWVcbiAgfTtcbn1cbmZ1bmN0aW9uIHByZXBhcmVBdXRoZW50aWNhdGlvbihhdXRoT3B0aW9ucykge1xuICBjb25zdCB7IHB1YmxpY0FwaUtleSwgYXV0aEVuZHBvaW50IH0gPSBhdXRoT3B0aW9ucztcbiAgaWYgKGF1dGhFbmRwb2ludCAhPT0gdm9pZCAwICYmIHB1YmxpY0FwaUtleSAhPT0gdm9pZCAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJZb3UgY2Fubm90IHNpbXVsdGFuZW91c2x5IHVzZSBgcHVibGljQXBpS2V5YCBhbmQgYGF1dGhFbmRwb2ludGAgb3B0aW9ucy4gUGxlYXNlIHBpY2sgb25lIGFuZCBsZWF2ZSB0aGUgb3RoZXIgb3B0aW9uIHVuc3BlY2lmaWVkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRcIlxuICAgICk7XG4gIH1cbiAgaWYgKHR5cGVvZiBwdWJsaWNBcGlLZXkgPT09IFwic3RyaW5nXCIpIHtcbiAgICBpZiAocHVibGljQXBpS2V5LnN0YXJ0c1dpdGgoXCJza19cIikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJJbnZhbGlkIGBwdWJsaWNBcGlLZXlgIG9wdGlvbi4gVGhlIHZhbHVlIHlvdSBwYXNzZWQgaXMgYSBzZWNyZXQga2V5LCB3aGljaCBzaG91bGQgbm90IGJlIHVzZWQgZnJvbSB0aGUgY2xpZW50LiBQbGVhc2Ugb25seSBldmVyIHBhc3MgYSBwdWJsaWMga2V5IGhlcmUuIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3MtY2xpZW50I2NyZWF0ZUNsaWVudFB1YmxpY0tleVwiXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAoIXB1YmxpY0FwaUtleS5zdGFydHNXaXRoKFwicGtfXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiSW52YWxpZCBrZXkuIFBsZWFzZSB1c2UgdGhlIHB1YmxpYyBrZXkgZm9ybWF0OiBwa188cHVibGljIGtleT4uIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3MtY2xpZW50I2NyZWF0ZUNsaWVudFB1YmxpY0tleVwiXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJwdWJsaWNcIixcbiAgICAgIHB1YmxpY0FwaUtleVxuICAgIH07XG4gIH1cbiAgaWYgKHR5cGVvZiBhdXRoRW5kcG9pbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJwcml2YXRlXCIsXG4gICAgICB1cmw6IGF1dGhFbmRwb2ludFxuICAgIH07XG4gIH0gZWxzZSBpZiAodHlwZW9mIGF1dGhFbmRwb2ludCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiY3VzdG9tXCIsXG4gICAgICBjYWxsYmFjazogYXV0aEVuZHBvaW50XG4gICAgfTtcbiAgfSBlbHNlIGlmIChhdXRoRW5kcG9pbnQgIT09IHZvaWQgMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiVGhlIGBhdXRoRW5kcG9pbnRgIG9wdGlvbiBtdXN0IGJlIGEgc3RyaW5nIG9yIGEgZnVuY3Rpb24uIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3MtY2xpZW50I2NyZWF0ZUNsaWVudEF1dGhFbmRwb2ludFwiXG4gICAgKTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgXCJJbnZhbGlkIExpdmVibG9ja3MgY2xpZW50IG9wdGlvbnMuIFBsZWFzZSBwcm92aWRlIGVpdGhlciBhIGBwdWJsaWNBcGlLZXlgIG9yIGBhdXRoRW5kcG9pbnRgIG9wdGlvbi4gVGhleSBjYW5ub3QgYm90aCBiZSBlbXB0eS4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1jbGllbnQjY3JlYXRlQ2xpZW50XCJcbiAgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQXV0aEVuZHBvaW50KGZldGNoMiwgZW5kcG9pbnQsIGJvZHkpIHtcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2gyKGVuZHBvaW50LCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSlcbiAgfSk7XG4gIGlmICghcmVzLm9rKSB7XG4gICAgY29uc3QgcmVhc29uID0gYCR7KGF3YWl0IHJlcy50ZXh0KCkpLnRyaW0oKSB8fCBcInJlYXNvbiBub3QgcHJvdmlkZWQgaW4gYXV0aCByZXNwb25zZVwifSAoJHtyZXMuc3RhdHVzfSByZXR1cm5lZCBieSBQT1NUICR7ZW5kcG9pbnR9KWA7XG4gICAgaWYgKHJlcy5zdGF0dXMgPT09IDQwMSB8fCByZXMuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgIHRocm93IG5ldyBTdG9wUmV0cnlpbmcoYFVuYXV0aG9yaXplZDogJHtyZWFzb259YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZTogJHtyZWFzb259YCk7XG4gICAgfVxuICB9XG4gIGxldCBkYXRhO1xuICB0cnkge1xuICAgIGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICB9IGNhdGNoIChlcikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBFeHBlY3RlZCBhIEpTT04gcmVzcG9uc2Ugd2hlbiBkb2luZyBhIFBPU1QgcmVxdWVzdCBvbiBcIiR7ZW5kcG9pbnR9XCIuICR7U3RyaW5nKFxuICAgICAgICBlclxuICAgICAgKX1gXG4gICAgKTtcbiAgfVxuICBpZiAoIWlzUGxhaW5PYmplY3QoZGF0YSkgfHwgdHlwZW9mIGRhdGEudG9rZW4gIT09IFwic3RyaW5nXCIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgRXhwZWN0ZWQgYSBKU09OIHJlc3BvbnNlIG9mIHRoZSBmb3JtIFxcYHsgdG9rZW46IFwiLi4uXCIgfVxcYCB3aGVuIGRvaW5nIGEgUE9TVCByZXF1ZXN0IG9uIFwiJHtlbmRwb2ludH1cIiwgYnV0IGdvdCAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICBkYXRhXG4gICAgICApfWBcbiAgICApO1xuICB9XG4gIGNvbnN0IHsgdG9rZW4gfSA9IGRhdGE7XG4gIHJldHVybiB7IHRva2VuIH07XG59XG5cbi8vIHNyYy9jb25zdGFudHMudHNcbnZhciBERUZBVUxUX0JBU0VfVVJMID0gXCJodHRwczovL2FwaS5saXZlYmxvY2tzLmlvXCI7XG5cbi8vIHNyYy9pbnRlcm5hbC50c1xudmFyIGtJbnRlcm5hbCA9IFN5bWJvbCgpO1xuXG4vLyBzcmMvZGV2dG9vbHMvYnJpZGdlLnRzXG52YXIgX2JyaWRnZUFjdGl2ZSA9IGZhbHNlO1xuZnVuY3Rpb24gYWN0aXZhdGVCcmlkZ2UoYWxsb3dlZCkge1xuICBfYnJpZGdlQWN0aXZlID0gYWxsb3dlZDtcbn1cbmZ1bmN0aW9uIHNlbmRUb1BhbmVsKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIiB8fCB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGZ1bGxNc2cgPSB7XG4gICAgLi4ubWVzc2FnZSxcbiAgICBzb3VyY2U6IFwibGl2ZWJsb2Nrcy1kZXZ0b29scy1jbGllbnRcIlxuICB9O1xuICBpZiAoIShvcHRpb25zPy5mb3JjZSB8fCBfYnJpZGdlQWN0aXZlKSkge1xuICAgIHJldHVybjtcbiAgfVxuICB3aW5kb3cucG9zdE1lc3NhZ2UoZnVsbE1zZywgXCIqXCIpO1xufVxudmFyIGV2ZW50U291cmNlID0gbWFrZUV2ZW50U291cmNlKCk7XG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiICYmIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5zb3VyY2UgPT09IHdpbmRvdyAmJiBldmVudC5kYXRhPy5zb3VyY2UgPT09IFwibGl2ZWJsb2Nrcy1kZXZ0b29scy1wYW5lbFwiKSB7XG4gICAgICBldmVudFNvdXJjZS5ub3RpZnkoZXZlbnQuZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICB9XG4gIH0pO1xufVxudmFyIG9uTWVzc2FnZUZyb21QYW5lbCA9IGV2ZW50U291cmNlLm9ic2VydmFibGU7XG5cbi8vIHNyYy9kZXZ0b29scy9pbmRleC50c1xudmFyIFZFUlNJT04gPSBQS0dfVkVSU0lPTiB8fCBcImRldlwiO1xudmFyIF9kZXZ0b29sc1NldHVwSGFzUnVuID0gZmFsc2U7XG5mdW5jdGlvbiBzZXR1cERldlRvb2xzKGdldEFsbFJvb21zKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgfHwgdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoX2RldnRvb2xzU2V0dXBIYXNSdW4pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgX2RldnRvb2xzU2V0dXBIYXNSdW4gPSB0cnVlO1xuICBvbk1lc3NhZ2VGcm9tUGFuZWwuc3Vic2NyaWJlKChtc2cpID0+IHtcbiAgICBzd2l0Y2ggKG1zZy5tc2cpIHtcbiAgICAgIGNhc2UgXCJjb25uZWN0XCI6IHtcbiAgICAgICAgYWN0aXZhdGVCcmlkZ2UodHJ1ZSk7XG4gICAgICAgIGZvciAoY29uc3Qgcm9vbUlkIG9mIGdldEFsbFJvb21zKCkpIHtcbiAgICAgICAgICBzZW5kVG9QYW5lbCh7XG4gICAgICAgICAgICBtc2c6IFwicm9vbTo6YXZhaWxhYmxlXCIsXG4gICAgICAgICAgICByb29tSWQsXG4gICAgICAgICAgICBjbGllbnRWZXJzaW9uOiBWRVJTSU9OXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgc2VuZFRvUGFuZWwoeyBtc2c6IFwid2FrZS11cC1kZXZ0b29sc1wiIH0sIHsgZm9yY2U6IHRydWUgfSk7XG59XG52YXIgdW5zdWJzQnlSb29tSWQgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuZnVuY3Rpb24gc3RvcFN5bmNTdHJlYW0ocm9vbUlkKSB7XG4gIGNvbnN0IHVuc3VicyA9IHVuc3Vic0J5Um9vbUlkLmdldChyb29tSWQpID8/IFtdO1xuICB1bnN1YnNCeVJvb21JZC5kZWxldGUocm9vbUlkKTtcbiAgZm9yIChjb25zdCB1bnN1YiBvZiB1bnN1YnMpIHtcbiAgICB1bnN1YigpO1xuICB9XG59XG5mdW5jdGlvbiBzdGFydFN5bmNTdHJlYW0ocm9vbSkge1xuICBzdG9wU3luY1N0cmVhbShyb29tLmlkKTtcbiAgZnVsbFN5bmMocm9vbSk7XG4gIHVuc3Vic0J5Um9vbUlkLnNldChyb29tLmlkLCBbXG4gICAgLy8gV2hlbiB0aGUgY29ubmVjdGlvbiBzdGF0dXMgY2hhbmdlc1xuICAgIHJvb20uZXZlbnRzLnN0YXR1cy5zdWJzY3JpYmUoKCkgPT4gcGFydGlhbFN5bmNDb25uZWN0aW9uKHJvb20pKSxcbiAgICAvLyBXaGVuIHN0b3JhZ2UgaW5pdGlhbGl6ZXMsIHNlbmQgdGhlIHVwZGF0ZVxuICAgIHJvb20uZXZlbnRzLnN0b3JhZ2VEaWRMb2FkLnN1YnNjcmliZU9uY2UoKCkgPT4gcGFydGlhbFN5bmNTdG9yYWdlKHJvb20pKSxcbiAgICAvLyBBbnkgdGltZSBzdG9yYWdlIHVwZGF0ZXMsIHNlbmQgdGhlIG5ldyBzdG9yYWdlIHJvb3RcbiAgICByb29tLmV2ZW50cy5zdG9yYWdlQmF0Y2guc3Vic2NyaWJlKCgpID0+IHBhcnRpYWxTeW5jU3RvcmFnZShyb29tKSksXG4gICAgLy8gQW55IHRpbWUgXCJtZVwiIG9yIFwib3RoZXJzXCIgdXBkYXRlcywgc2VuZCB0aGUgbmV3IHZhbHVlcyBhY2NvcmRpbmdseVxuICAgIHJvb20uZXZlbnRzLnNlbGYuc3Vic2NyaWJlKCgpID0+IHBhcnRpYWxTeW5jTWUocm9vbSkpLFxuICAgIHJvb20uZXZlbnRzLm90aGVycy5zdWJzY3JpYmUoKCkgPT4gcGFydGlhbFN5bmNPdGhlcnMocm9vbSkpLFxuICAgIC8vIEFueSB0aW1lIHlkb2MgaXMgdXBkYXRlZCwgZm9yd2FyZCB0aGUgdXBkYXRlXG4gICAgcm9vbS5ldmVudHMueWRvYy5zdWJzY3JpYmUoKHVwZGF0ZSkgPT4gc3luY1lkb2NVcGRhdGUocm9vbSwgdXBkYXRlKSksXG4gICAgLy8gQW55IHRpbWUgYSBjdXN0b20gcm9vbSBldmVudCBpcyByZWNlaXZlZCwgZm9yd2FyZCBpdFxuICAgIHJvb20uZXZlbnRzLmN1c3RvbUV2ZW50LnN1YnNjcmliZShcbiAgICAgIChldmVudERhdGEpID0+IGZvcndhcmRFdmVudChyb29tLCBldmVudERhdGEpXG4gICAgKVxuICBdKTtcbn1cbmZ1bmN0aW9uIHN5bmNZZG9jVXBkYXRlKHJvb20sIHVwZGF0ZSkge1xuICBzZW5kVG9QYW5lbCh7XG4gICAgbXNnOiBcInJvb206OnN5bmM6Onlkb2NcIixcbiAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgdXBkYXRlXG4gIH0pO1xufVxudmFyIGxvYWRlZEF0ID0gRGF0ZS5ub3coKTtcbnZhciBldmVudENvdW50ZXIgPSAwO1xuZnVuY3Rpb24gbmV4dEV2ZW50SWQoKSB7XG4gIHJldHVybiBgZXZlbnQtJHtsb2FkZWRBdH0tJHtldmVudENvdW50ZXIrK31gO1xufVxuZnVuY3Rpb24gZm9yd2FyZEV2ZW50KHJvb20sIGV2ZW50RGF0YSkge1xuICBzZW5kVG9QYW5lbCh7XG4gICAgbXNnOiBcInJvb206OmV2ZW50czo6Y3VzdG9tLWV2ZW50XCIsXG4gICAgcm9vbUlkOiByb29tLmlkLFxuICAgIGV2ZW50OiB7XG4gICAgICB0eXBlOiBcIkN1c3RvbUV2ZW50XCIsXG4gICAgICBpZDogbmV4dEV2ZW50SWQoKSxcbiAgICAgIGtleTogXCJFdmVudFwiLFxuICAgICAgY29ubmVjdGlvbklkOiBldmVudERhdGEuY29ubmVjdGlvbklkLFxuICAgICAgcGF5bG9hZDogZXZlbnREYXRhLmV2ZW50XG4gICAgfVxuICB9KTtcbn1cbmZ1bmN0aW9uIHBhcnRpYWxTeW5jQ29ubmVjdGlvbihyb29tKSB7XG4gIHNlbmRUb1BhbmVsKHtcbiAgICBtc2c6IFwicm9vbTo6c3luYzo6cGFydGlhbFwiLFxuICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICBzdGF0dXM6IHJvb20uZ2V0U3RhdHVzKClcbiAgfSk7XG59XG5mdW5jdGlvbiBwYXJ0aWFsU3luY1N0b3JhZ2Uocm9vbSkge1xuICBjb25zdCByb290ID0gcm9vbS5nZXRTdG9yYWdlU25hcHNob3QoKTtcbiAgaWYgKHJvb3QpIHtcbiAgICBzZW5kVG9QYW5lbCh7XG4gICAgICBtc2c6IFwicm9vbTo6c3luYzo6cGFydGlhbFwiLFxuICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgc3RvcmFnZTogcm9vdC50b1RyZWVOb2RlKFwicm9vdFwiKS5wYXlsb2FkXG4gICAgfSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHBhcnRpYWxTeW5jTWUocm9vbSkge1xuICBjb25zdCBtZSA9IHJvb21ba0ludGVybmFsXS5nZXRTZWxmX2ZvckRldlRvb2xzKCk7XG4gIGlmIChtZSkge1xuICAgIHNlbmRUb1BhbmVsKHtcbiAgICAgIG1zZzogXCJyb29tOjpzeW5jOjpwYXJ0aWFsXCIsXG4gICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICBtZVxuICAgIH0pO1xuICB9XG59XG5mdW5jdGlvbiBwYXJ0aWFsU3luY090aGVycyhyb29tKSB7XG4gIGNvbnN0IG90aGVycyA9IHJvb21ba0ludGVybmFsXS5nZXRPdGhlcnNfZm9yRGV2VG9vbHMoKTtcbiAgaWYgKG90aGVycykge1xuICAgIHNlbmRUb1BhbmVsKHtcbiAgICAgIG1zZzogXCJyb29tOjpzeW5jOjpwYXJ0aWFsXCIsXG4gICAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgICBvdGhlcnNcbiAgICB9KTtcbiAgfVxufVxuZnVuY3Rpb24gZnVsbFN5bmMocm9vbSkge1xuICBjb25zdCByb290ID0gcm9vbS5nZXRTdG9yYWdlU25hcHNob3QoKTtcbiAgY29uc3QgbWUgPSByb29tW2tJbnRlcm5hbF0uZ2V0U2VsZl9mb3JEZXZUb29scygpO1xuICBjb25zdCBvdGhlcnMgPSByb29tW2tJbnRlcm5hbF0uZ2V0T3RoZXJzX2ZvckRldlRvb2xzKCk7XG4gIHJvb20uZmV0Y2hZRG9jKFwiXCIpO1xuICBzZW5kVG9QYW5lbCh7XG4gICAgbXNnOiBcInJvb206OnN5bmM6OmZ1bGxcIixcbiAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgc3RhdHVzOiByb29tLmdldFN0YXR1cygpLFxuICAgIHN0b3JhZ2U6IHJvb3Q/LnRvVHJlZU5vZGUoXCJyb290XCIpLnBheWxvYWQgPz8gbnVsbCxcbiAgICBtZSxcbiAgICBvdGhlcnNcbiAgfSk7XG59XG52YXIgcm9vbUNoYW5uZWxMaXN0ZW5lcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuZnVuY3Rpb24gc3RvcFJvb21DaGFubmVsTGlzdGVuZXIocm9vbUlkKSB7XG4gIGNvbnN0IGxpc3RlbmVyID0gcm9vbUNoYW5uZWxMaXN0ZW5lcnMuZ2V0KHJvb21JZCk7XG4gIHJvb21DaGFubmVsTGlzdGVuZXJzLmRlbGV0ZShyb29tSWQpO1xuICBpZiAobGlzdGVuZXIpIHtcbiAgICBsaXN0ZW5lcigpO1xuICB9XG59XG5mdW5jdGlvbiBsaW5rRGV2VG9vbHMocm9vbUlkLCByb29tKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgfHwgdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybjtcbiAgfVxuICBzZW5kVG9QYW5lbCh7IG1zZzogXCJyb29tOjphdmFpbGFibGVcIiwgcm9vbUlkLCBjbGllbnRWZXJzaW9uOiBWRVJTSU9OIH0pO1xuICBzdG9wUm9vbUNoYW5uZWxMaXN0ZW5lcihyb29tSWQpO1xuICByb29tQ2hhbm5lbExpc3RlbmVycy5zZXQoXG4gICAgcm9vbUlkLFxuICAgIC8vIFJldHVybnMgdGhlIHVuc3Vic2NyaWJlIGNhbGxiYWNrLCB0aGF0IHdlIHN0b3JlIGluIHRoZVxuICAgIC8vIHJvb21DaGFubmVsTGlzdGVuZXJzIHJlZ2lzdHJ5XG4gICAgb25NZXNzYWdlRnJvbVBhbmVsLnN1YnNjcmliZSgobXNnKSA9PiB7XG4gICAgICBzd2l0Y2ggKG1zZy5tc2cpIHtcbiAgICAgICAgY2FzZSBcInJvb206OnN1YnNjcmliZVwiOiB7XG4gICAgICAgICAgaWYgKG1zZy5yb29tSWQgPT09IHJvb21JZCkge1xuICAgICAgICAgICAgc3RhcnRTeW5jU3RyZWFtKHJvb20pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwicm9vbTo6dW5zdWJzY3JpYmVcIjoge1xuICAgICAgICAgIGlmIChtc2cucm9vbUlkID09PSByb29tSWQpIHtcbiAgICAgICAgICAgIHN0b3BTeW5jU3RyZWFtKHJvb21JZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgKTtcbn1cbmZ1bmN0aW9uIHVubGlua0RldlRvb2xzKHJvb21JZCkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiIHx8IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgc3RvcFN5bmNTdHJlYW0ocm9vbUlkKTtcbiAgc3RvcFJvb21DaGFubmVsTGlzdGVuZXIocm9vbUlkKTtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjp1bmF2YWlsYWJsZVwiLFxuICAgIHJvb21JZFxuICB9KTtcbn1cblxuLy8gc3JjL2xpYi9zdHJpbmdpZnkudHNcbmZ1bmN0aW9uIHN0cmluZ2lmeShvYmplY3QsIC4uLmFyZ3MpIHtcbiAgaWYgKHR5cGVvZiBvYmplY3QgIT09IFwib2JqZWN0XCIgfHwgb2JqZWN0ID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqZWN0KSkge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmplY3QsIC4uLmFyZ3MpO1xuICB9XG4gIGNvbnN0IHNvcnRlZE9iamVjdCA9IE9iamVjdC5rZXlzKG9iamVjdCkuc29ydCgpLnJlZHVjZShcbiAgICAoc29ydGVkT2JqZWN0Miwga2V5KSA9PiB7XG4gICAgICBzb3J0ZWRPYmplY3QyW2tleV0gPSBvYmplY3Rba2V5XTtcbiAgICAgIHJldHVybiBzb3J0ZWRPYmplY3QyO1xuICAgIH0sXG4gICAge31cbiAgKTtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHNvcnRlZE9iamVjdCwgLi4uYXJncyk7XG59XG5cbi8vIHNyYy9saWIvYmF0Y2gudHNcbnZhciBERUZBVUxUX1NJWkUgPSA1MDtcbnZhciBCYXRjaENhbGwgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGlucHV0KSB7XG4gICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgIGNvbnN0IHsgcHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0IH0gPSBQcm9taXNlX3dpdGhSZXNvbHZlcnMoKTtcbiAgICB0aGlzLnByb21pc2UgPSBwcm9taXNlO1xuICAgIHRoaXMucmVzb2x2ZSA9IHJlc29sdmU7XG4gICAgdGhpcy5yZWplY3QgPSByZWplY3Q7XG4gIH1cbn07XG52YXIgQmF0Y2ggPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xuICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgdGhpcy5zaXplID0gb3B0aW9ucy5zaXplID8/IERFRkFVTFRfU0laRTtcbiAgICB0aGlzLmRlbGF5ID0gb3B0aW9ucy5kZWxheTtcbiAgfVxuICBjbGVhckRlbGF5VGltZW91dCgpIHtcbiAgICBpZiAodGhpcy5kZWxheVRpbWVvdXRJZCAhPT0gdm9pZCAwKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVvdXRJZCk7XG4gICAgICB0aGlzLmRlbGF5VGltZW91dElkID0gdm9pZCAwO1xuICAgIH1cbiAgfVxuICBzY2hlZHVsZSgpIHtcbiAgICBpZiAodGhpcy5xdWV1ZS5sZW5ndGggPT09IHRoaXMuc2l6ZSkge1xuICAgICAgdm9pZCB0aGlzLmZsdXNoKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnF1ZXVlLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5jbGVhckRlbGF5VGltZW91dCgpO1xuICAgICAgdGhpcy5kZWxheVRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gdm9pZCB0aGlzLmZsdXNoKCksIHRoaXMuZGVsYXkpO1xuICAgIH1cbiAgfVxuICBhc3luYyBmbHVzaCgpIHtcbiAgICBpZiAodGhpcy5xdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY2FsbHMgPSB0aGlzLnF1ZXVlLnNwbGljZSgwKTtcbiAgICBjb25zdCBpbnB1dHMgPSBjYWxscy5tYXAoKGNhbGwpID0+IGNhbGwuaW5wdXQpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5jYWxsYmFjayhpbnB1dHMpO1xuICAgICAgdGhpcy5lcnJvciA9IGZhbHNlO1xuICAgICAgY2FsbHMuZm9yRWFjaCgoY2FsbCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVzdWx0cz8uW2luZGV4XTtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlc3VsdHMpKSB7XG4gICAgICAgICAgY2FsbC5yZWplY3QobmV3IEVycm9yKFwiQ2FsbGJhY2sgbXVzdCByZXR1cm4gYW4gYXJyYXkuXCIpKTtcbiAgICAgICAgfSBlbHNlIGlmIChjYWxscy5sZW5ndGggIT09IHJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICAgY2FsbC5yZWplY3QoXG4gICAgICAgICAgICBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIGBDYWxsYmFjayBtdXN0IHJldHVybiBhbiBhcnJheSBvZiB0aGUgc2FtZSBsZW5ndGggYXMgdGhlIG51bWJlciBvZiBwcm92aWRlZCBpdGVtcy4gRXhwZWN0ZWQgJHtjYWxscy5sZW5ndGh9LCBidXQgZ290ICR7cmVzdWx0cy5sZW5ndGh9LmBcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgY2FsbC5yZWplY3QocmVzdWx0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYWxsLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IzKSB7XG4gICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgIGNhbGxzLmZvckVhY2goKGNhbGwpID0+IHtcbiAgICAgICAgY2FsbC5yZWplY3QoZXJyb3IzKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBnZXQoaW5wdXQpIHtcbiAgICBjb25zdCBleGlzdGluZ0NhbGwgPSB0aGlzLnF1ZXVlLmZpbmQoXG4gICAgICAoY2FsbDIpID0+IHN0cmluZ2lmeShjYWxsMi5pbnB1dCkgPT09IHN0cmluZ2lmeShpbnB1dClcbiAgICApO1xuICAgIGlmIChleGlzdGluZ0NhbGwpIHtcbiAgICAgIHJldHVybiBleGlzdGluZ0NhbGwucHJvbWlzZTtcbiAgICB9XG4gICAgY29uc3QgY2FsbCA9IG5ldyBCYXRjaENhbGwoaW5wdXQpO1xuICAgIHRoaXMucXVldWUucHVzaChjYWxsKTtcbiAgICB0aGlzLnNjaGVkdWxlKCk7XG4gICAgcmV0dXJuIGNhbGwucHJvbWlzZTtcbiAgfVxuICBjbGVhcigpIHtcbiAgICB0aGlzLnF1ZXVlID0gW107XG4gICAgdGhpcy5lcnJvciA9IGZhbHNlO1xuICAgIHRoaXMuY2xlYXJEZWxheVRpbWVvdXQoKTtcbiAgfVxufTtcbmZ1bmN0aW9uIGNyZWF0ZUJhdGNoU3RvcmUoY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgY29uc3QgYmF0Y2ggPSBuZXcgQmF0Y2goY2FsbGJhY2ssIG9wdGlvbnMpO1xuICBjb25zdCBjYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGV2ZW50U291cmNlMiA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBmdW5jdGlvbiBnZXRDYWNoZUtleShhcmdzKSB7XG4gICAgcmV0dXJuIHN0cmluZ2lmeShhcmdzKTtcbiAgfVxuICBmdW5jdGlvbiBzZXRTdGF0ZUFuZE5vdGlmeShjYWNoZUtleSwgc3RhdGUpIHtcbiAgICBjYWNoZS5zZXQoY2FjaGVLZXksIHN0YXRlKTtcbiAgICBldmVudFNvdXJjZTIubm90aWZ5KCk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0KGlucHV0KSB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBnZXRDYWNoZUtleShpbnB1dCk7XG4gICAgaWYgKGNhY2hlLmhhcyhjYWNoZUtleSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHNldFN0YXRlQW5kTm90aWZ5KGNhY2hlS2V5LCB7IGlzTG9hZGluZzogdHJ1ZSB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJhdGNoLmdldChpbnB1dCk7XG4gICAgICBzZXRTdGF0ZUFuZE5vdGlmeShjYWNoZUtleSwgeyBpc0xvYWRpbmc6IGZhbHNlLCBkYXRhOiByZXN1bHQgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IzKSB7XG4gICAgICBzZXRTdGF0ZUFuZE5vdGlmeShjYWNoZUtleSwge1xuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IzXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gZ2V0U3RhdGUoaW5wdXQpIHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGdldENhY2hlS2V5KGlucHV0KTtcbiAgICByZXR1cm4gY2FjaGUuZ2V0KGNhY2hlS2V5KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIC4uLmV2ZW50U291cmNlMi5vYnNlcnZhYmxlLFxuICAgIGdldCxcbiAgICBnZXRTdGF0ZVxuICB9O1xufVxuXG4vLyBzcmMvbGliL2NyZWF0ZS1zdG9yZS50c1xuZnVuY3Rpb24gY3JlYXRlU3RvcmUoaW5pdGlhbFN0YXRlKSB7XG4gIGxldCBzdGF0ZSA9IGluaXRpYWxTdGF0ZTtcbiAgY29uc3Qgc3Vic2NyaWJlcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG4gIGZ1bmN0aW9uIHNldChjYWxsYmFjaykge1xuICAgIGNvbnN0IG5ld1N0YXRlID0gY2FsbGJhY2soc3RhdGUpO1xuICAgIGlmIChzdGF0ZSA9PT0gbmV3U3RhdGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3RhdGUgPSBuZXdTdGF0ZTtcbiAgICBmb3IgKGNvbnN0IHN1YnNjcmliZXIgb2Ygc3Vic2NyaWJlcnMpIHtcbiAgICAgIHN1YnNjcmliZXIoc3RhdGUpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBzdWJzY3JpYmUoY2FsbGJhY2spIHtcbiAgICBzdWJzY3JpYmVycy5hZGQoY2FsbGJhY2spO1xuICAgIGNhbGxiYWNrKHN0YXRlKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgc3Vic2NyaWJlcnMuZGVsZXRlKGNhbGxiYWNrKTtcbiAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgZ2V0LFxuICAgIHNldCxcbiAgICBzdWJzY3JpYmVcbiAgfTtcbn1cblxuLy8gc3JjL2NvbnZlcnQtcGxhaW4tZGF0YS50c1xuZnVuY3Rpb24gY29udmVydFRvQ29tbWVudERhdGEoZGF0YSkge1xuICBjb25zdCBlZGl0ZWRBdCA9IGRhdGEuZWRpdGVkQXQgPyBuZXcgRGF0ZShkYXRhLmVkaXRlZEF0KSA6IHZvaWQgMDtcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICBjb25zdCByZWFjdGlvbnMgPSBkYXRhLnJlYWN0aW9ucy5tYXAoKHJlYWN0aW9uKSA9PiAoe1xuICAgIC4uLnJlYWN0aW9uLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUocmVhY3Rpb24uY3JlYXRlZEF0KVxuICB9KSk7XG4gIGlmIChkYXRhLmJvZHkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIHJlYWN0aW9ucyxcbiAgICAgIGNyZWF0ZWRBdCxcbiAgICAgIGVkaXRlZEF0XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBkZWxldGVkQXQgPSBuZXcgRGF0ZShkYXRhLmRlbGV0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICByZWFjdGlvbnMsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICBlZGl0ZWRBdCxcbiAgICAgIGRlbGV0ZWRBdFxuICAgIH07XG4gIH1cbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb1RocmVhZERhdGEoZGF0YSkge1xuICBjb25zdCB1cGRhdGVkQXQgPSBkYXRhLnVwZGF0ZWRBdCA/IG5ldyBEYXRlKGRhdGEudXBkYXRlZEF0KSA6IHZvaWQgMDtcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICBjb25zdCBjb21tZW50cyA9IGRhdGEuY29tbWVudHMubWFwKFxuICAgIChjb21tZW50KSA9PiBjb252ZXJ0VG9Db21tZW50RGF0YShjb21tZW50KVxuICApO1xuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdCxcbiAgICBjb21tZW50c1xuICB9O1xufVxuZnVuY3Rpb24gY29udmVydFRvQ29tbWVudFVzZXJSZWFjdGlvbihkYXRhKSB7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KVxuICB9O1xufVxuZnVuY3Rpb24gY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhKGRhdGEpIHtcbiAgY29uc3Qgbm90aWZpZWRBdCA9IG5ldyBEYXRlKGRhdGEubm90aWZpZWRBdCk7XG4gIGNvbnN0IHJlYWRBdCA9IGRhdGEucmVhZEF0ID8gbmV3IERhdGUoZGF0YS5yZWFkQXQpIDogbnVsbDtcbiAgaWYgKFwiYWN0aXZpdGllc1wiIGluIGRhdGEpIHtcbiAgICBjb25zdCBhY3Rpdml0aWVzID0gZGF0YS5hY3Rpdml0aWVzLm1hcCgoYWN0aXZpdHkpID0+ICh7XG4gICAgICAuLi5hY3Rpdml0eSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoYWN0aXZpdHkuY3JlYXRlZEF0KVxuICAgIH0pKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIG5vdGlmaWVkQXQsXG4gICAgICByZWFkQXQsXG4gICAgICBhY3Rpdml0aWVzXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgbm90aWZpZWRBdCxcbiAgICByZWFkQXRcbiAgfTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb1RocmVhZERlbGV0ZUluZm8oZGF0YSkge1xuICBjb25zdCBkZWxldGVkQXQgPSBuZXcgRGF0ZShkYXRhLmRlbGV0ZWRBdCk7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBkZWxldGVkQXRcbiAgfTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGVsZXRlSW5mbyhkYXRhKSB7XG4gIGNvbnN0IGRlbGV0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuZGVsZXRlZEF0KTtcbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIGRlbGV0ZWRBdFxuICB9O1xufVxuXG4vLyBzcmMvbGliL3VybC50c1xuZnVuY3Rpb24gdG9VUkxTZWFyY2hQYXJhbXMocGFyYW1zKSB7XG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocGFyYW1zKSkge1xuICAgIGlmICh2YWx1ZSAhPT0gdm9pZCAwICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgICByZXN1bHQuc2V0KGtleSwgdmFsdWUudG9TdHJpbmcoKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiB1cmxqb2luKGJhc2VVcmwsIHBhdGgsIHBhcmFtcykge1xuICBjb25zdCB1cmwgPSBuZXcgVVJMKHBhdGgsIGJhc2VVcmwpO1xuICBpZiAocGFyYW1zICE9PSB2b2lkIDApIHtcbiAgICB1cmwuc2VhcmNoID0gKHBhcmFtcyBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcyA/IHBhcmFtcyA6IHRvVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykpLnRvU3RyaW5nKCk7XG4gIH1cbiAgcmV0dXJuIHVybC50b1N0cmluZygpO1xufVxuXG4vLyBzcmMvbm90aWZpY2F0aW9ucy50c1xudmFyIE1BUktfSU5CT1hfTk9USUZJQ0FUSU9OU19BU19SRUFEX0JBVENIX0RFTEFZID0gNTA7XG5mdW5jdGlvbiBjcmVhdGVOb3RpZmljYXRpb25zQXBpKHtcbiAgYmFzZVVybCxcbiAgYXV0aE1hbmFnZXIsXG4gIGN1cnJlbnRVc2VySWRTdG9yZSxcbiAgZmV0Y2hlclxufSkge1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaEpzb24oZW5kcG9pbnQsIG9wdGlvbnMsIHBhcmFtcykge1xuICAgIGNvbnN0IGF1dGhWYWx1ZSA9IGF3YWl0IGF1dGhNYW5hZ2VyLmdldEF1dGhWYWx1ZSh7XG4gICAgICByZXF1ZXN0ZWRTY29wZTogXCJjb21tZW50czpyZWFkXCJcbiAgICB9KTtcbiAgICBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwic2VjcmV0XCIgJiYgYXV0aFZhbHVlLnRva2VuLnBhcnNlZC5rID09PSBcImFjY1wiIC8qIEFDQ0VTU19UT0tFTiAqLykge1xuICAgICAgY29uc3QgdXNlcklkID0gYXV0aFZhbHVlLnRva2VuLnBhcnNlZC51aWQ7XG4gICAgICBjdXJyZW50VXNlcklkU3RvcmUuc2V0KCgpID0+IHVzZXJJZCk7XG4gICAgfVxuICAgIGNvbnN0IHVybCA9IHVybGpvaW4oYmFzZVVybCwgYC92Mi9jJHtlbmRwb2ludH1gLCBwYXJhbXMpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hlcih1cmwudG9TdHJpbmcoKSwge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgLi4ub3B0aW9ucz8uaGVhZGVycyxcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2dldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSl9YFxuICAgICAgfVxuICAgIH0pO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gNDAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDYwMCkge1xuICAgICAgICBsZXQgZXJyb3IzO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGVycm9yQm9keSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgTm90aWZpY2F0aW9uc0FwaUVycm9yKFxuICAgICAgICAgICAgZXJyb3JCb2R5Lm1lc3NhZ2UsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBlcnJvckJvZHlcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgTm90aWZpY2F0aW9uc0FwaUVycm9yKFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3IzO1xuICAgICAgfVxuICAgIH1cbiAgICBsZXQgYm9keTtcbiAgICB0cnkge1xuICAgICAgYm9keSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIGJvZHkgPSB7fTtcbiAgICB9XG4gICAgcmV0dXJuIGJvZHk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0SW5ib3hOb3RpZmljYXRpb25zKCkge1xuICAgIGNvbnN0IGpzb24gPSBhd2FpdCBmZXRjaEpzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9uc1wiLCB2b2lkIDAsIHt9KTtcbiAgICByZXR1cm4ge1xuICAgICAgdGhyZWFkczoganNvbi50aHJlYWRzLm1hcChjb252ZXJ0VG9UaHJlYWREYXRhKSxcbiAgICAgIGluYm94Tm90aWZpY2F0aW9uczoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKFxuICAgICAgICBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRhdGFcbiAgICAgICksXG4gICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoanNvbi5tZXRhLnJlcXVlc3RlZEF0KVxuICAgIH07XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0SW5ib3hOb3RpZmljYXRpb25zU2luY2Uob3B0aW9ucykge1xuICAgIGNvbnN0IGpzb24gPSBhd2FpdCBmZXRjaEpzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9uc1wiLCB2b2lkIDAsIHtcbiAgICAgIHNpbmNlOiBvcHRpb25zLnNpbmNlLnRvSVNPU3RyaW5nKClcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgdGhyZWFkczoge1xuICAgICAgICB1cGRhdGVkOiBqc29uLnRocmVhZHMubWFwKGNvbnZlcnRUb1RocmVhZERhdGEpLFxuICAgICAgICBkZWxldGVkOiBqc29uLmRlbGV0ZWRUaHJlYWRzLm1hcChjb252ZXJ0VG9UaHJlYWREZWxldGVJbmZvKVxuICAgICAgfSxcbiAgICAgIGluYm94Tm90aWZpY2F0aW9uczoge1xuICAgICAgICB1cGRhdGVkOiBqc29uLmluYm94Tm90aWZpY2F0aW9ucy5tYXAoY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhKSxcbiAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkSW5ib3hOb3RpZmljYXRpb25zLm1hcChcbiAgICAgICAgICBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRlbGV0ZUluZm9cbiAgICAgICAgKVxuICAgICAgfSxcbiAgICAgIHJlcXVlc3RlZEF0OiBuZXcgRGF0ZShqc29uLm1ldGEucmVxdWVzdGVkQXQpXG4gICAgfTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudCgpIHtcbiAgICBjb25zdCB7IGNvdW50IH0gPSBhd2FpdCBmZXRjaEpzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9ucy9jb3VudFwiKTtcbiAgICByZXR1cm4gY291bnQ7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gbWFya0FsbEluYm94Tm90aWZpY2F0aW9uc0FzUmVhZCgpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9ucy9yZWFkXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBpbmJveE5vdGlmaWNhdGlvbklkczogXCJhbGxcIiB9KVxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIG1hcmtJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoaW5ib3hOb3RpZmljYXRpb25JZHMpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9ucy9yZWFkXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBpbmJveE5vdGlmaWNhdGlvbklkcyB9KVxuICAgIH0pO1xuICB9XG4gIGNvbnN0IGJhdGNoZWRNYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkID0gbmV3IEJhdGNoKFxuICAgIGFzeW5jIChiYXRjaGVkSW5ib3hOb3RpZmljYXRpb25JZHMpID0+IHtcbiAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uSWRzID0gYmF0Y2hlZEluYm94Tm90aWZpY2F0aW9uSWRzLmZsYXQoKTtcbiAgICAgIGF3YWl0IG1hcmtJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoaW5ib3hOb3RpZmljYXRpb25JZHMpO1xuICAgICAgcmV0dXJuIGluYm94Tm90aWZpY2F0aW9uSWRzO1xuICAgIH0sXG4gICAgeyBkZWxheTogTUFSS19JTkJPWF9OT1RJRklDQVRJT05TX0FTX1JFQURfQkFUQ0hfREVMQVkgfVxuICApO1xuICBhc3luYyBmdW5jdGlvbiBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQoaW5ib3hOb3RpZmljYXRpb25JZCkge1xuICAgIGF3YWl0IGJhdGNoZWRNYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkLmdldChpbmJveE5vdGlmaWNhdGlvbklkKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBkZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnMoKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnNcIiwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlSW5ib3hOb3RpZmljYXRpb24oaW5ib3hOb3RpZmljYXRpb25JZCkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvaW5ib3gtbm90aWZpY2F0aW9ucy8ke2VuY29kZVVSSUNvbXBvbmVudChpbmJveE5vdGlmaWNhdGlvbklkKX1gLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCJcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIHJldHVybiB7XG4gICAgZ2V0SW5ib3hOb3RpZmljYXRpb25zLFxuICAgIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlLFxuICAgIGdldFVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50LFxuICAgIG1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQsXG4gICAgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkLFxuICAgIGRlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICBkZWxldGVJbmJveE5vdGlmaWNhdGlvblxuICB9O1xufVxuXG4vLyBzcmMvbGliL3Bvc2l0aW9uLnRzXG52YXIgTUlOX0NPREUgPSAzMjtcbnZhciBNQVhfQ09ERSA9IDEyNjtcbnZhciBOVU1fRElHSVRTID0gTUFYX0NPREUgLSBNSU5fQ09ERSArIDE7XG52YXIgWkVSTyA9IG50aERpZ2l0KDApO1xudmFyIE9ORSA9IG50aERpZ2l0KDEpO1xudmFyIFpFUk9fTklORSA9IFpFUk8gKyBudGhEaWdpdCgtMSk7XG5mdW5jdGlvbiBudGhEaWdpdChuKSB7XG4gIGNvbnN0IGNvZGUgPSBNSU5fQ09ERSArIChuIDwgMCA/IE5VTV9ESUdJVFMgKyBuIDogbik7XG4gIGlmIChjb2RlIDwgTUlOX0NPREUgfHwgY29kZSA+IE1BWF9DT0RFKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG4gdmFsdWU6ICR7bn1gKTtcbiAgfVxuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTtcbn1cbmZ1bmN0aW9uIG1ha2VQb3NpdGlvbih4LCB5KSB7XG4gIGlmICh4ICE9PSB2b2lkIDAgJiYgeSAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGJldHdlZW4oeCwgeSk7XG4gIH0gZWxzZSBpZiAoeCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGFmdGVyKHgpO1xuICB9IGVsc2UgaWYgKHkgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBiZWZvcmUoeSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIE9ORTtcbiAgfVxufVxuZnVuY3Rpb24gYmVmb3JlKHBvcykge1xuICBjb25zdCBsYXN0SW5kZXggPSBwb3MubGVuZ3RoIC0gMTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbGFzdEluZGV4OyBpKyspIHtcbiAgICBjb25zdCBjb2RlID0gcG9zLmNoYXJDb2RlQXQoaSk7XG4gICAgaWYgKGNvZGUgPD0gTUlOX0NPREUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoaSA9PT0gbGFzdEluZGV4KSB7XG4gICAgICBpZiAoY29kZSA9PT0gTUlOX0NPREUgKyAxKSB7XG4gICAgICAgIHJldHVybiBwb3Muc3Vic3RyaW5nKDAsIGkpICsgWkVST19OSU5FO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHBvcy5zdWJzdHJpbmcoMCwgaSkgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUgLSAxKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHBvcy5zdWJzdHJpbmcoMCwgaSArIDEpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gT05FO1xufVxuZnVuY3Rpb24gYWZ0ZXIocG9zKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IHBvcy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICBjb25zdCBjb2RlID0gcG9zLmNoYXJDb2RlQXQoaSk7XG4gICAgaWYgKGNvZGUgPj0gTUFYX0NPREUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICByZXR1cm4gcG9zLnN1YnN0cmluZygwLCBpKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSArIDEpO1xuICB9XG4gIHJldHVybiBwb3MgKyBPTkU7XG59XG5mdW5jdGlvbiBiZXR3ZWVuKGxvLCBoaSkge1xuICBpZiAobG8gPCBoaSkge1xuICAgIHJldHVybiBfYmV0d2VlbihsbywgaGkpO1xuICB9IGVsc2UgaWYgKGxvID4gaGkpIHtcbiAgICByZXR1cm4gX2JldHdlZW4oaGksIGxvKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgY29tcHV0ZSB2YWx1ZSBiZXR3ZWVuIHR3byBlcXVhbCBwb3NpdGlvbnNcIik7XG4gIH1cbn1cbmZ1bmN0aW9uIF9iZXR3ZWVuKGxvLCBoaSkge1xuICBsZXQgaW5kZXggPSAwO1xuICBjb25zdCBsb0xlbiA9IGxvLmxlbmd0aDtcbiAgY29uc3QgaGlMZW4gPSBoaS5sZW5ndGg7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgY29uc3QgbG9Db2RlID0gaW5kZXggPCBsb0xlbiA/IGxvLmNoYXJDb2RlQXQoaW5kZXgpIDogTUlOX0NPREU7XG4gICAgY29uc3QgaGlDb2RlID0gaW5kZXggPCBoaUxlbiA/IGhpLmNoYXJDb2RlQXQoaW5kZXgpIDogTUFYX0NPREU7XG4gICAgaWYgKGxvQ29kZSA9PT0gaGlDb2RlKSB7XG4gICAgICBpbmRleCsrO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChoaUNvZGUgLSBsb0NvZGUgPT09IDEpIHtcbiAgICAgIGNvbnN0IHNpemUgPSBpbmRleCArIDE7XG4gICAgICBsZXQgcHJlZml4ID0gbG8uc3Vic3RyaW5nKDAsIHNpemUpO1xuICAgICAgaWYgKHByZWZpeC5sZW5ndGggPCBzaXplKSB7XG4gICAgICAgIHByZWZpeCArPSBaRVJPLnJlcGVhdChzaXplIC0gcHJlZml4Lmxlbmd0aCk7XG4gICAgICB9XG4gICAgICBjb25zdCBzdWZmaXggPSBsby5zdWJzdHJpbmcoc2l6ZSk7XG4gICAgICBjb25zdCBuaW5lcyA9IFwiXCI7XG4gICAgICByZXR1cm4gcHJlZml4ICsgX2JldHdlZW4oc3VmZml4LCBuaW5lcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0YWtlTihsbywgaW5kZXgpICsgU3RyaW5nLmZyb21DaGFyQ29kZShoaUNvZGUgKyBsb0NvZGUgPj4gMSk7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiB0YWtlTihwb3MsIG4pIHtcbiAgcmV0dXJuIG4gPCBwb3MubGVuZ3RoID8gcG9zLnN1YnN0cmluZygwLCBuKSA6IHBvcyArIFpFUk8ucmVwZWF0KG4gLSBwb3MubGVuZ3RoKTtcbn1cbnZhciBNSU5fTk9OX1pFUk9fQ09ERSA9IE1JTl9DT0RFICsgMTtcbmZ1bmN0aW9uIGlzUG9zKHN0cikge1xuICBpZiAoc3RyID09PSBcIlwiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IGxhc3RJZHggPSBzdHIubGVuZ3RoIC0gMTtcbiAgY29uc3QgbGFzdCA9IHN0ci5jaGFyQ29kZUF0KGxhc3RJZHgpO1xuICBpZiAobGFzdCA8IE1JTl9OT05fWkVST19DT0RFIHx8IGxhc3QgPiBNQVhfQ09ERSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IGxhc3RJZHg7IGkrKykge1xuICAgIGNvbnN0IGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgICBpZiAoY29kZSA8IE1JTl9DT0RFIHx8IGNvZGUgPiBNQVhfQ09ERSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb1BvcyhzdHIpIHtcbiAgY29uc3QgY29kZXMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgY29kZXMucHVzaChjb2RlIDwgTUlOX0NPREUgPyBNSU5fQ09ERSA6IGNvZGUgPiBNQVhfQ09ERSA/IE1BWF9DT0RFIDogY29kZSk7XG4gIH1cbiAgd2hpbGUgKGNvZGVzLmxlbmd0aCA+IDAgJiYgY29kZXNbY29kZXMubGVuZ3RoIC0gMV0gPT09IE1JTl9DT0RFKSB7XG4gICAgY29kZXMubGVuZ3RoLS07XG4gIH1cbiAgcmV0dXJuIGNvZGVzLmxlbmd0aCA+IDAgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmNvZGVzKSA6IChcbiAgICAvLyBFZGdlIGNhc2U6IHRoZSBzdHIgd2FzIGEgMC1vbmx5IHN0cmluZywgd2hpY2ggaXMgaW52YWxpZC4gRGVmYXVsdCBiYWNrIHRvIC4xXG4gICAgT05FXG4gICk7XG59XG5mdW5jdGlvbiBhc1BvcyhzdHIpIHtcbiAgcmV0dXJuIGlzUG9zKHN0cikgPyBzdHIgOiBjb252ZXJ0VG9Qb3Moc3RyKTtcbn1cblxuLy8gc3JjL3Byb3RvY29sL09wLnRzXG52YXIgT3BDb2RlID0gLyogQF9fUFVSRV9fICovICgoT3BDb2RlMikgPT4ge1xuICBPcENvZGUyW09wQ29kZTJbXCJJTklUXCJdID0gMF0gPSBcIklOSVRcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiU0VUX1BBUkVOVF9LRVlcIl0gPSAxXSA9IFwiU0VUX1BBUkVOVF9LRVlcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiQ1JFQVRFX0xJU1RcIl0gPSAyXSA9IFwiQ1JFQVRFX0xJU1RcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiVVBEQVRFX09CSkVDVFwiXSA9IDNdID0gXCJVUERBVEVfT0JKRUNUXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIkNSRUFURV9PQkpFQ1RcIl0gPSA0XSA9IFwiQ1JFQVRFX09CSkVDVFwiO1xuICBPcENvZGUyW09wQ29kZTJbXCJERUxFVEVfQ1JEVFwiXSA9IDVdID0gXCJERUxFVEVfQ1JEVFwiO1xuICBPcENvZGUyW09wQ29kZTJbXCJERUxFVEVfT0JKRUNUX0tFWVwiXSA9IDZdID0gXCJERUxFVEVfT0JKRUNUX0tFWVwiO1xuICBPcENvZGUyW09wQ29kZTJbXCJDUkVBVEVfTUFQXCJdID0gN10gPSBcIkNSRUFURV9NQVBcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiQ1JFQVRFX1JFR0lTVEVSXCJdID0gOF0gPSBcIkNSRUFURV9SRUdJU1RFUlwiO1xuICByZXR1cm4gT3BDb2RlMjtcbn0pKE9wQ29kZSB8fCB7fSk7XG5mdW5jdGlvbiBhY2tPcChvcElkKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLyxcbiAgICBpZDogXCJBQ0tcIixcbiAgICAvLyAoSClBQ0tcbiAgICBvcElkXG4gIH07XG59XG5mdW5jdGlvbiBpc0Fja09wKG9wKSB7XG4gIHJldHVybiBvcC50eXBlID09PSA1IC8qIERFTEVURV9DUkRUICovICYmIG9wLmlkID09PSBcIkFDS1wiO1xufVxuXG4vLyBzcmMvY3JkdHMvQWJzdHJhY3RDcmR0LnRzXG5mdW5jdGlvbiBjcmR0QXNMaXZlTm9kZSh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBIYXNQYXJlbnQobm9kZSwga2V5LCBwb3MgPSBhc1BvcyhrZXkpKSB7XG4gIHJldHVybiBPYmplY3QuZnJlZXplKHsgdHlwZTogXCJIYXNQYXJlbnRcIiwgbm9kZSwga2V5LCBwb3MgfSk7XG59XG52YXIgTm9QYXJlbnQgPSBPYmplY3QuZnJlZXplKHsgdHlwZTogXCJOb1BhcmVudFwiIH0pO1xuZnVuY3Rpb24gT3JwaGFuZWQob2xkS2V5LCBvbGRQb3MgPSBhc1BvcyhvbGRLZXkpKSB7XG4gIHJldHVybiBPYmplY3QuZnJlZXplKHsgdHlwZTogXCJPcnBoYW5lZFwiLCBvbGRLZXksIG9sZFBvcyB9KTtcbn1cbnZhciBBYnN0cmFjdENyZHQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICB0aGlzLl9wYXJlbnQgPSBOb1BhcmVudDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9nZXRQYXJlbnRLZXlPclRocm93KCkge1xuICAgIHN3aXRjaCAodGhpcy5wYXJlbnQudHlwZSkge1xuICAgICAgY2FzZSBcIkhhc1BhcmVudFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQua2V5O1xuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhcmVudCBrZXkgaXMgbWlzc2luZ1wiKTtcbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQub2xkS2V5O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgZ2V0IF9wYXJlbnRQb3MoKSB7XG4gICAgc3dpdGNoICh0aGlzLnBhcmVudC50eXBlKSB7XG4gICAgICBjYXNlIFwiSGFzUGFyZW50XCI6XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5wb3M7XG4gICAgICBjYXNlIFwiTm9QYXJlbnRcIjpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGFyZW50IGtleSBpcyBtaXNzaW5nXCIpO1xuICAgICAgY2FzZSBcIk9ycGhhbmVkXCI6XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5vbGRQb3M7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIodGhpcy5wYXJlbnQsIFwiVW5rbm93biBzdGF0ZVwiKTtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgX3Bvb2woKSB7XG4gICAgcmV0dXJuIHRoaXMuX19wb29sO1xuICB9XG4gIGdldCByb29tSWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX19wb29sID8gdGhpcy5fX3Bvb2wucm9vbUlkIDogbnVsbDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGdldCBfaWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX19pZDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGdldCBwYXJlbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BhcmVudDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGdldCBfcGFyZW50S2V5KCkge1xuICAgIHN3aXRjaCAodGhpcy5wYXJlbnQudHlwZSkge1xuICAgICAgY2FzZSBcIkhhc1BhcmVudFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQua2V5O1xuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgY2FzZSBcIk9ycGhhbmVkXCI6XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5vbGRLZXk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIodGhpcy5wYXJlbnQsIFwiVW5rbm93biBzdGF0ZVwiKTtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHkob3AsIF9pc0xvY2FsKSB7XG4gICAgc3dpdGNoIChvcC50eXBlKSB7XG4gICAgICBjYXNlIDUgLyogREVMRVRFX0NSRFQgKi86IHtcbiAgICAgICAgaWYgKHRoaXMucGFyZW50LnR5cGUgPT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQubm9kZS5fZGV0YWNoQ2hpbGQoY3JkdEFzTGl2ZU5vZGUodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9zZXRQYXJlbnRMaW5rKG5ld1BhcmVudE5vZGUsIG5ld1BhcmVudEtleSkge1xuICAgIHN3aXRjaCAodGhpcy5wYXJlbnQudHlwZSkge1xuICAgICAgY2FzZSBcIkhhc1BhcmVudFwiOlxuICAgICAgICBpZiAodGhpcy5wYXJlbnQubm9kZSAhPT0gbmV3UGFyZW50Tm9kZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgcGFyZW50OiBub2RlIGFscmVhZHkgaGFzIGEgcGFyZW50XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3BhcmVudCA9IEhhc1BhcmVudChuZXdQYXJlbnROb2RlLCBuZXdQYXJlbnRLZXkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgY2FzZSBcIk9ycGhhbmVkXCI6XG4gICAgICBjYXNlIFwiTm9QYXJlbnRcIjoge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBIYXNQYXJlbnQobmV3UGFyZW50Tm9kZSwgbmV3UGFyZW50S2V5KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2F0dGFjaChpZCwgcG9vbCkge1xuICAgIGlmICh0aGlzLl9faWQgfHwgdGhpcy5fX3Bvb2wpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBhdHRhY2ggbm9kZTogYWxyZWFkeSBhdHRhY2hlZFwiKTtcbiAgICB9XG4gICAgcG9vbC5hZGROb2RlKGlkLCBjcmR0QXNMaXZlTm9kZSh0aGlzKSk7XG4gICAgdGhpcy5fX2lkID0gaWQ7XG4gICAgdGhpcy5fX3Bvb2wgPSBwb29sO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2RldGFjaCgpIHtcbiAgICBpZiAodGhpcy5fX3Bvb2wgJiYgdGhpcy5fX2lkKSB7XG4gICAgICB0aGlzLl9fcG9vbC5kZWxldGVOb2RlKHRoaXMuX19pZCk7XG4gICAgfVxuICAgIHN3aXRjaCAodGhpcy5wYXJlbnQudHlwZSkge1xuICAgICAgY2FzZSBcIkhhc1BhcmVudFwiOiB7XG4gICAgICAgIHRoaXMuX3BhcmVudCA9IE9ycGhhbmVkKHRoaXMucGFyZW50LmtleSwgdGhpcy5wYXJlbnQucG9zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiTm9QYXJlbnRcIjoge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBOb1BhcmVudDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiT3JwaGFuZWRcIjoge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICAgIHRoaXMuX19wb29sID0gdm9pZCAwO1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICpcbiAgICogQ2xlYXIgdGhlIEltbXV0YWJsZSBjYWNoZSwgc28gdGhhdCB0aGUgbmV4dCBjYWxsIHRvIGAudG9JbW11dGFibGUoKWAgd2lsbFxuICAgKiByZWNvbXB1dGUgdGhlIGVxdWl2YWxlbnQgSW1tdXRhYmxlIHZhbHVlIGFnYWluLiAgQ2FsbCB0aGlzIGFmdGVyIGV2ZXJ5XG4gICAqIG11dGF0aW9uIHRvIHRoZSBMaXZlIG5vZGUuXG4gICAqL1xuICBpbnZhbGlkYXRlKCkge1xuICAgIGlmICh0aGlzLl9jYWNoZWRJbW11dGFibGUgIT09IHZvaWQgMCB8fCB0aGlzLl9jYWNoZWRUcmVlTm9kZSAhPT0gdm9pZCAwKSB7XG4gICAgICB0aGlzLl9jYWNoZWRJbW11dGFibGUgPSB2b2lkIDA7XG4gICAgICB0aGlzLl9jYWNoZWRUcmVlTm9kZSA9IHZvaWQgMDtcbiAgICAgIGlmICh0aGlzLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICAgIHRoaXMucGFyZW50Lm5vZGUuaW52YWxpZGF0ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqXG4gICAqIFJldHVybiBhbiBzbmFwc2hvdCBvZiB0aGlzIExpdmUgdHJlZSBmb3IgdXNlIGluIERldlRvb2xzLlxuICAgKi9cbiAgdG9UcmVlTm9kZShrZXkpIHtcbiAgICBpZiAodGhpcy5fY2FjaGVkVHJlZU5vZGUgPT09IHZvaWQgMCB8fCB0aGlzLl9jYWNoZWRUcmVlTm9kZUtleSAhPT0ga2V5KSB7XG4gICAgICB0aGlzLl9jYWNoZWRUcmVlTm9kZUtleSA9IGtleTtcbiAgICAgIHRoaXMuX2NhY2hlZFRyZWVOb2RlID0gdGhpcy5fdG9UcmVlTm9kZShrZXkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fY2FjaGVkVHJlZU5vZGU7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybiBhbiBpbW11dGFibGUgc25hcHNob3Qgb2YgdGhpcyBMaXZlIG5vZGUgYW5kIGl0cyBjaGlsZHJlbi5cbiAgICovXG4gIHRvSW1tdXRhYmxlKCkge1xuICAgIGlmICh0aGlzLl9jYWNoZWRJbW11dGFibGUgPT09IHZvaWQgMCkge1xuICAgICAgdGhpcy5fY2FjaGVkSW1tdXRhYmxlID0gdGhpcy5fdG9JbW11dGFibGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NhY2hlZEltbXV0YWJsZTtcbiAgfVxufTtcblxuLy8gc3JjL3Byb3RvY29sL1NlcmlhbGl6ZWRDcmR0LnRzXG52YXIgQ3JkdFR5cGUgPSAvKiBAX19QVVJFX18gKi8gKChDcmR0VHlwZTIpID0+IHtcbiAgQ3JkdFR5cGUyW0NyZHRUeXBlMltcIk9CSkVDVFwiXSA9IDBdID0gXCJPQkpFQ1RcIjtcbiAgQ3JkdFR5cGUyW0NyZHRUeXBlMltcIkxJU1RcIl0gPSAxXSA9IFwiTElTVFwiO1xuICBDcmR0VHlwZTJbQ3JkdFR5cGUyW1wiTUFQXCJdID0gMl0gPSBcIk1BUFwiO1xuICBDcmR0VHlwZTJbQ3JkdFR5cGUyW1wiUkVHSVNURVJcIl0gPSAzXSA9IFwiUkVHSVNURVJcIjtcbiAgcmV0dXJuIENyZHRUeXBlMjtcbn0pKENyZHRUeXBlIHx8IHt9KTtcbmZ1bmN0aW9uIGlzUm9vdENyZHQoY3JkdCkge1xuICByZXR1cm4gY3JkdC50eXBlID09PSAwIC8qIE9CSkVDVCAqLyAmJiAhaXNDaGlsZENyZHQoY3JkdCk7XG59XG5mdW5jdGlvbiBpc0NoaWxkQ3JkdChjcmR0KSB7XG4gIHJldHVybiBjcmR0LnBhcmVudElkICE9PSB2b2lkIDAgJiYgY3JkdC5wYXJlbnRLZXkgIT09IHZvaWQgMDtcbn1cblxuLy8gc3JjL2xpYi9uYW5vaWQudHNcbnZhciBuYW5vaWQgPSAodCA9IDIxKSA9PiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50OEFycmF5KHQpKS5yZWR1Y2UoXG4gICh0MiwgZSkgPT4gdDIgKz0gKGUgJj0gNjMpIDwgMzYgPyBlLnRvU3RyaW5nKDM2KSA6IGUgPCA2MiA/IChlIC0gMjYpLnRvU3RyaW5nKDM2KS50b1VwcGVyQ2FzZSgpIDogZSA8IDYzID8gXCJfXCIgOiBcIi1cIixcbiAgXCJcIlxuKTtcblxuLy8gc3JjL2NyZHRzL0xpdmVSZWdpc3Rlci50c1xudmFyIExpdmVSZWdpc3RlciA9IGNsYXNzIF9MaXZlUmVnaXN0ZXIgZXh0ZW5kcyBBYnN0cmFjdENyZHQge1xuICBjb25zdHJ1Y3RvcihkYXRhKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgfVxuICBnZXQgZGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBfZGVzZXJpYWxpemUoW2lkLCBpdGVtXSwgX3BhcmVudFRvQ2hpbGRyZW4sIHBvb2wpIHtcbiAgICBjb25zdCByZWdpc3RlciA9IG5ldyBfTGl2ZVJlZ2lzdGVyKGl0ZW0uZGF0YSk7XG4gICAgcmVnaXN0ZXIuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgcmV0dXJuIHJlZ2lzdGVyO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvT3BzKHBhcmVudElkLCBwYXJlbnRLZXksIHBvb2wpIHtcbiAgICBpZiAodGhpcy5faWQgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbm5vdCBzZXJpYWxpemUgcmVnaXN0ZXIgaWYgcGFyZW50SWQgb3IgcGFyZW50S2V5IGlzIHVuZGVmaW5lZFwiXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICB0eXBlOiA4IC8qIENSRUFURV9SRUdJU1RFUiAqLyxcbiAgICAgICAgb3BJZDogcG9vbD8uZ2VuZXJhdGVPcElkKCksXG4gICAgICAgIGlkOiB0aGlzLl9pZCxcbiAgICAgICAgcGFyZW50SWQsXG4gICAgICAgIHBhcmVudEtleSxcbiAgICAgICAgZGF0YTogdGhpcy5kYXRhXG4gICAgICB9XG4gICAgXTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9zZXJpYWxpemUoKSB7XG4gICAgaWYgKHRoaXMucGFyZW50LnR5cGUgIT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXJpYWxpemUgTGl2ZVJlZ2lzdGVyIGlmIHBhcmVudCBpcyBtaXNzaW5nXCIpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogMyAvKiBSRUdJU1RFUiAqLyxcbiAgICAgIHBhcmVudElkOiBubih0aGlzLnBhcmVudC5ub2RlLl9pZCwgXCJQYXJlbnQgbm9kZSBleHBlY3RlZCB0byBoYXZlIElEXCIpLFxuICAgICAgcGFyZW50S2V5OiB0aGlzLnBhcmVudC5rZXksXG4gICAgICBkYXRhOiB0aGlzLmRhdGFcbiAgICB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2F0dGFjaENoaWxkKF9vcCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2RldGFjaENoaWxkKF9jcmR0KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHkob3AsIGlzTG9jYWwpIHtcbiAgICByZXR1cm4gc3VwZXIuX2FwcGx5KG9wLCBpc0xvY2FsKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b1RyZWVOb2RlKGtleSkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkpzb25cIixcbiAgICAgIGlkOiB0aGlzLl9pZCA/PyBuYW5vaWQoKSxcbiAgICAgIGtleSxcbiAgICAgIHBheWxvYWQ6IHRoaXMuX2RhdGFcbiAgICB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICB9XG4gIGNsb25lKCkge1xuICAgIHJldHVybiBkZWVwQ2xvbmUodGhpcy5kYXRhKTtcbiAgfVxufTtcblxuLy8gc3JjL2NyZHRzL0xpdmVMaXN0LnRzXG5mdW5jdGlvbiBjb21wYXJlTm9kZVBvc2l0aW9uKGl0ZW1BLCBpdGVtQikge1xuICBjb25zdCBwb3NBID0gaXRlbUEuX3BhcmVudFBvcztcbiAgY29uc3QgcG9zQiA9IGl0ZW1CLl9wYXJlbnRQb3M7XG4gIHJldHVybiBwb3NBID09PSBwb3NCID8gMCA6IHBvc0EgPCBwb3NCID8gLTEgOiAxO1xufVxudmFyIExpdmVMaXN0ID0gY2xhc3MgX0xpdmVMaXN0IGV4dGVuZHMgQWJzdHJhY3RDcmR0IHtcbiAgY29uc3RydWN0b3IoaXRlbXMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha1NldCgpO1xuICAgIHRoaXMuX3VuYWNrbm93bGVkZ2VkU2V0cyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgbGV0IHBvc2l0aW9uID0gdm9pZCAwO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgY29uc3QgbmV3UG9zaXRpb24gPSBtYWtlUG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgY29uc3Qgbm9kZSA9IGxzb25Ub0xpdmVOb2RlKGl0ZW0pO1xuICAgICAgbm9kZS5fc2V0UGFyZW50TGluayh0aGlzLCBuZXdQb3NpdGlvbik7XG4gICAgICB0aGlzLl9pdGVtcy5wdXNoKG5vZGUpO1xuICAgICAgcG9zaXRpb24gPSBuZXdQb3NpdGlvbjtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2Rlc2VyaWFsaXplKFtpZF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpIHtcbiAgICBjb25zdCBsaXN0ID0gbmV3IF9MaXZlTGlzdChbXSk7XG4gICAgbGlzdC5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICBjb25zdCBjaGlsZHJlbiA9IHBhcmVudFRvQ2hpbGRyZW4uZ2V0KGlkKTtcbiAgICBpZiAoY2hpbGRyZW4gPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2lkMiwgY3JkdF0gb2YgY2hpbGRyZW4pIHtcbiAgICAgIGNvbnN0IGNoaWxkID0gZGVzZXJpYWxpemUoW2lkMiwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsobGlzdCwgY3JkdC5wYXJlbnRLZXkpO1xuICAgICAgbGlzdC5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgfVxuICAgIHJldHVybiBsaXN0O1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICogVGhpcyBmdW5jdGlvbiBhc3N1bWVzIHRoYXQgdGhlIHJlc3VsdGluZyBvcHMgd2lsbCBiZSBzZW50IHRvIHRoZSBzZXJ2ZXIgaWYgdGhleSBoYXZlIGFuICdvcElkJ1xuICAgKiBzbyB3ZSBtdXRhdGUgX3VuYWNrbm93bGVkZ2VkU2V0cyB0byBhdm9pZCBwb3RlbnRpYWwgZmxpY2tlcmluZ1xuICAgKiBodHRwczovL2dpdGh1Yi5jb20vbGl2ZWJsb2Nrcy9saXZlYmxvY2tzL3B1bGwvMTE3N1xuICAgKlxuICAgKiBUaGlzIGlzIHF1aXRlIHVuaW50dWl0aXZlIGFuZCBzaG91bGQgZGlzYXBwZWFyIGFzIHNvb24gYXNcbiAgICogd2UgaW50cm9kdWNlIGFuIGV4cGxpY2l0IExpdmVMaXN0LlNldCBvcGVyYXRpb25cbiAgICovXG4gIF90b09wcyhwYXJlbnRJZCwgcGFyZW50S2V5LCBwb29sKSB7XG4gICAgaWYgKHRoaXMuX2lkID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXJpYWxpemUgaXRlbSBpcyBub3QgYXR0YWNoZWRcIik7XG4gICAgfVxuICAgIGNvbnN0IG9wcyA9IFtdO1xuICAgIGNvbnN0IG9wID0ge1xuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgb3BJZDogcG9vbD8uZ2VuZXJhdGVPcElkKCksXG4gICAgICB0eXBlOiAyIC8qIENSRUFURV9MSVNUICovLFxuICAgICAgcGFyZW50SWQsXG4gICAgICBwYXJlbnRLZXlcbiAgICB9O1xuICAgIG9wcy5wdXNoKG9wKTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5faXRlbXMpIHtcbiAgICAgIGNvbnN0IHBhcmVudEtleTIgPSBpdGVtLl9nZXRQYXJlbnRLZXlPclRocm93KCk7XG4gICAgICBjb25zdCBjaGlsZE9wcyA9IEhBQ0tfYWRkSW50ZW50QW5kRGVsZXRlZElkVG9PcGVyYXRpb24oXG4gICAgICAgIGl0ZW0uX3RvT3BzKHRoaXMuX2lkLCBwYXJlbnRLZXkyLCBwb29sKSxcbiAgICAgICAgdm9pZCAwXG4gICAgICApO1xuICAgICAgY29uc3QgY2hpbGRPcElkID0gY2hpbGRPcHNbMF0ub3BJZDtcbiAgICAgIGlmIChjaGlsZE9wSWQgIT09IHZvaWQgMCkge1xuICAgICAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMuc2V0KHBhcmVudEtleTIsIGNoaWxkT3BJZCk7XG4gICAgICB9XG4gICAgICBvcHMucHVzaCguLi5jaGlsZE9wcyk7XG4gICAgfVxuICAgIHJldHVybiBvcHM7XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKlxuICAgKiBBZGRzIGEgbmV3IGl0ZW0gaW50byB0aGUgc29ydGVkIGxpc3QsIGluIHRoZSBjb3JyZWN0IHBvc2l0aW9uLlxuICAgKi9cbiAgX2luc2VydEFuZFNvcnQoaXRlbSkge1xuICAgIHRoaXMuX2l0ZW1zLnB1c2goaXRlbSk7XG4gICAgdGhpcy5fc29ydEl0ZW1zKCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc29ydEl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLnNvcnQoY29tcGFyZU5vZGVQb3NpdGlvbik7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfaW5kZXhPZlBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmZpbmRJbmRleChcbiAgICAgIChpdGVtKSA9PiBpdGVtLl9nZXRQYXJlbnRLZXlPclRocm93KCkgPT09IHBvc2l0aW9uXG4gICAgKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2goaWQsIHBvb2wpIHtcbiAgICBzdXBlci5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5faXRlbXMpIHtcbiAgICAgIGl0ZW0uX2F0dGFjaChwb29sLmdlbmVyYXRlSWQoKSwgcG9vbCk7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2RldGFjaCgpIHtcbiAgICBzdXBlci5fZGV0YWNoKCk7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlTZXRSZW1vdGUob3ApIHtcbiAgICBpZiAodGhpcy5fcG9vbCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBhdHRhY2ggY2hpbGQgaWYgbWFuYWdlZCBwb29sIGlzIG5vdCBwcmVzZW50XCIpO1xuICAgIH1cbiAgICBjb25zdCB7IGlkLCBwYXJlbnRLZXk6IGtleSB9ID0gb3A7XG4gICAgY29uc3QgY2hpbGQgPSBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCk7XG4gICAgY2hpbGQuX2F0dGFjaChpZCwgdGhpcy5fcG9vbCk7XG4gICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICBjb25zdCBkZWxldGVkSWQgPSBvcC5kZWxldGVkSWQ7XG4gICAgY29uc3QgaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgaWYgKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICAgIGNvbnN0IGl0ZW1XaXRoU2FtZVBvc2l0aW9uID0gdGhpcy5faXRlbXNbaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uXTtcbiAgICAgIGlmIChpdGVtV2l0aFNhbWVQb3NpdGlvbi5faWQgPT09IGRlbGV0ZWRJZCkge1xuICAgICAgICBpdGVtV2l0aFNhbWVQb3NpdGlvbi5fZGV0YWNoKCk7XG4gICAgICAgIHRoaXMuX2l0ZW1zW2luZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbl0gPSBjaGlsZDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbXG4gICAgICAgICAgICBzZXREZWx0YShpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24sIGNoaWxkKVxuICAgICAgICAgIF0pLFxuICAgICAgICAgIHJldmVyc2U6IFtdXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9pbXBsaWNpdGx5RGVsZXRlZEl0ZW1zLmFkZChpdGVtV2l0aFNhbWVQb3NpdGlvbik7XG4gICAgICAgIHRoaXMuX2l0ZW1zW2luZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbl0gPSBjaGlsZDtcbiAgICAgICAgY29uc3QgZGVsdGEgPSBbXG4gICAgICAgICAgc2V0RGVsdGEoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uLCBjaGlsZClcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgZGVsZXRlRGVsdGEyID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihcbiAgICAgICAgICBvcC5kZWxldGVkSWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGRlbGV0ZURlbHRhMikge1xuICAgICAgICAgIGRlbHRhLnB1c2goZGVsZXRlRGVsdGEyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIGRlbHRhKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB1cGRhdGVzID0gW107XG4gICAgICBjb25zdCBkZWxldGVEZWx0YTIgPSB0aGlzLl9kZXRhY2hJdGVtQXNzb2NpYXRlZFRvU2V0T3BlcmF0aW9uKFxuICAgICAgICBvcC5kZWxldGVkSWRcbiAgICAgICk7XG4gICAgICBpZiAoZGVsZXRlRGVsdGEyKSB7XG4gICAgICAgIHVwZGF0ZXMucHVzaChkZWxldGVEZWx0YTIpO1xuICAgICAgfVxuICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgICB1cGRhdGVzLnB1c2goaW5zZXJ0RGVsdGEodGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSksIGNoaWxkKSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXZlcnNlOiBbXSxcbiAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgdXBkYXRlcylcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5U2V0QWNrKG9wKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3QgZGVsdGEgPSBbXTtcbiAgICBjb25zdCBkZWxldGVkRGVsdGEgPSB0aGlzLl9kZXRhY2hJdGVtQXNzb2NpYXRlZFRvU2V0T3BlcmF0aW9uKG9wLmRlbGV0ZWRJZCk7XG4gICAgaWYgKGRlbGV0ZWREZWx0YSkge1xuICAgICAgZGVsdGEucHVzaChkZWxldGVkRGVsdGEpO1xuICAgIH1cbiAgICBjb25zdCB1bmFja25vd2xlZGdlZE9wSWQgPSB0aGlzLl91bmFja25vd2xlZGdlZFNldHMuZ2V0KG9wLnBhcmVudEtleSk7XG4gICAgaWYgKHVuYWNrbm93bGVkZ2VkT3BJZCAhPT0gdm9pZCAwKSB7XG4gICAgICBpZiAodW5hY2tub3dsZWRnZWRPcElkICE9PSBvcC5vcElkKSB7XG4gICAgICAgIHJldHVybiBkZWx0YS5sZW5ndGggPT09IDAgPyB7IG1vZGlmaWVkOiBmYWxzZSB9IDogeyBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSksIHJldmVyc2U6IFtdIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMuZGVsZXRlKG9wLnBhcmVudEtleSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihvcC5wYXJlbnRLZXkpO1xuICAgIGNvbnN0IGV4aXN0aW5nSXRlbSA9IHRoaXMuX2l0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0uX2lkID09PSBvcC5pZCk7XG4gICAgaWYgKGV4aXN0aW5nSXRlbSAhPT0gdm9pZCAwKSB7XG4gICAgICBpZiAoZXhpc3RpbmdJdGVtLl9wYXJlbnRLZXkgPT09IG9wLnBhcmVudEtleSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBkZWx0YS5sZW5ndGggPiAwID8gbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSkgOiBmYWxzZSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5hZGQoXG4gICAgICAgICAgdGhpcy5faXRlbXNbaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uXVxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uLCAxKTtcbiAgICAgICAgZGVsdGEucHVzaChkZWxldGVEZWx0YShpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24pKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGV4aXN0aW5nSXRlbSk7XG4gICAgICBleGlzdGluZ0l0ZW0uX3NldFBhcmVudExpbmsodGhpcywgb3AucGFyZW50S2V5KTtcbiAgICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGV4aXN0aW5nSXRlbSk7XG4gICAgICBpZiAobmV3SW5kZXggIT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICAgICAgZGVsdGEucHVzaChtb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgbmV3SW5kZXgsIGV4aXN0aW5nSXRlbSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGRlbHRhLmxlbmd0aCA+IDAgPyBtYWtlVXBkYXRlKHRoaXMsIGRlbHRhKSA6IGZhbHNlLFxuICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgb3JwaGFuID0gdGhpcy5fcG9vbC5nZXROb2RlKG9wLmlkKTtcbiAgICAgIGlmIChvcnBoYW4gJiYgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5oYXMob3JwaGFuKSkge1xuICAgICAgICBvcnBoYW4uX3NldFBhcmVudExpbmsodGhpcywgb3AucGFyZW50S2V5KTtcbiAgICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5kZWxldGUob3JwaGFuKTtcbiAgICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChvcnBoYW4pO1xuICAgICAgICBjb25zdCByZWNyZWF0ZWRJdGVtSW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKG9ycGhhbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYW4gaXRlbSBhdCB0aGlzIHBvc2l0aW9uLCB1cGRhdGUgaXMgYSBzZXQsIGVsc2UgaXQncyBhbiBpbnNlcnRcbiAgICAgICAgICAgIGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiA9PT0gLTEgPyBpbnNlcnREZWx0YShyZWNyZWF0ZWRJdGVtSW5kZXgsIG9ycGhhbikgOiBzZXREZWx0YShyZWNyZWF0ZWRJdGVtSW5kZXgsIG9ycGhhbiksXG4gICAgICAgICAgICAuLi5kZWx0YVxuICAgICAgICAgIF0pLFxuICAgICAgICAgIHJldmVyc2U6IFtdXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uICE9PSAtMSkge1xuICAgICAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24sIDEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbmV3SXRlbSwgbmV3SW5kZXggfSA9IHRoaXMuX2NyZWF0ZUF0dGFjaEl0ZW1BbmRTb3J0KFxuICAgICAgICAgIG9wLFxuICAgICAgICAgIG9wLnBhcmVudEtleVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGl0ZW0gYXQgdGhpcyBwb3NpdGlvbiwgdXBkYXRlIGlzIGEgc2V0LCBlbHNlIGl0J3MgYW4gaW5zZXJ0XG4gICAgICAgICAgICBpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gPT09IC0xID8gaW5zZXJ0RGVsdGEobmV3SW5kZXgsIG5ld0l0ZW0pIDogc2V0RGVsdGEobmV3SW5kZXgsIG5ld0l0ZW0pLFxuICAgICAgICAgICAgLi4uZGVsdGFcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdXBkYXRlIGRlbHRhIG9mIHRoZSBkZWxldGlvbiBvciBudWxsXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgX2RldGFjaEl0ZW1Bc3NvY2lhdGVkVG9TZXRPcGVyYXRpb24oZGVsZXRlZElkKSB7XG4gICAgaWYgKGRlbGV0ZWRJZCA9PT0gdm9pZCAwIHx8IHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGRlbGV0ZWRJdGVtID0gdGhpcy5fcG9vbC5nZXROb2RlKGRlbGV0ZWRJZCk7XG4gICAgaWYgKGRlbGV0ZWRJdGVtID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9kZXRhY2hDaGlsZChkZWxldGVkSXRlbSk7XG4gICAgaWYgKHJlc3VsdC5tb2RpZmllZCA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0Lm1vZGlmaWVkLnVwZGF0ZXNbMF07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlSZW1vdGVJbnNlcnQob3ApIHtcbiAgICBpZiAodGhpcy5fcG9vbCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBhdHRhY2ggY2hpbGQgaWYgbWFuYWdlZCBwb29sIGlzIG5vdCBwcmVzZW50XCIpO1xuICAgIH1cbiAgICBjb25zdCBrZXkgPSBhc1BvcyhvcC5wYXJlbnRLZXkpO1xuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ICE9PSAtMSkge1xuICAgICAgdGhpcy5fc2hpZnRJdGVtUG9zaXRpb24oZXhpc3RpbmdJdGVtSW5kZXgsIGtleSk7XG4gICAgfVxuICAgIGNvbnN0IHsgbmV3SXRlbSwgbmV3SW5kZXggfSA9IHRoaXMuX2NyZWF0ZUF0dGFjaEl0ZW1BbmRTb3J0KG9wLCBrZXkpO1xuICAgIHJldHVybiB7XG4gICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIG5ld0l0ZW0pXSksXG4gICAgICByZXZlcnNlOiBbXVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlJbnNlcnRBY2sob3ApIHtcbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLl9pdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLl9pZCA9PT0gb3AuaWQpO1xuICAgIGNvbnN0IGtleSA9IGFzUG9zKG9wLnBhcmVudEtleSk7XG4gICAgY29uc3QgaXRlbUluZGV4QXRQb3NpdGlvbiA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgIGlmIChleGlzdGluZ0l0ZW0pIHtcbiAgICAgIGlmIChleGlzdGluZ0l0ZW0uX3BhcmVudEtleSA9PT0ga2V5KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBvbGRQb3NpdGlvbkluZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihleGlzdGluZ0l0ZW0pO1xuICAgICAgICBpZiAoaXRlbUluZGV4QXRQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLl9zaGlmdEl0ZW1Qb3NpdGlvbihpdGVtSW5kZXhBdFBvc2l0aW9uLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIGV4aXN0aW5nSXRlbS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICAgICAgaWYgKG5ld0luZGV4ID09PSBvbGRQb3NpdGlvbkluZGV4KSB7XG4gICAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbXG4gICAgICAgICAgICBtb3ZlRGVsdGEob2xkUG9zaXRpb25JbmRleCwgbmV3SW5kZXgsIGV4aXN0aW5nSXRlbSlcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBvcnBoYW4gPSBubih0aGlzLl9wb29sKS5nZXROb2RlKG9wLmlkKTtcbiAgICAgIGlmIChvcnBoYW4gJiYgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5oYXMob3JwaGFuKSkge1xuICAgICAgICBvcnBoYW4uX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5kZWxldGUob3JwaGFuKTtcbiAgICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChvcnBoYW4pO1xuICAgICAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtpbnNlcnREZWx0YShuZXdJbmRleCwgb3JwaGFuKV0pLFxuICAgICAgICAgIHJldmVyc2U6IFtdXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXRlbUluZGV4QXRQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLl9zaGlmdEl0ZW1Qb3NpdGlvbihpdGVtSW5kZXhBdFBvc2l0aW9uLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbmV3SXRlbSwgbmV3SW5kZXggfSA9IHRoaXMuX2NyZWF0ZUF0dGFjaEl0ZW1BbmRTb3J0KG9wLCBrZXkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtpbnNlcnREZWx0YShuZXdJbmRleCwgbmV3SXRlbSldKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseUluc2VydFVuZG9SZWRvKG9wKSB7XG4gICAgY29uc3QgeyBpZCwgcGFyZW50S2V5OiBrZXkgfSA9IG9wO1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGlmICh0aGlzLl9wb29sPy5nZXROb2RlKGlkKSAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgY2hpbGQuX2F0dGFjaChpZCwgbm4odGhpcy5fcG9vbCkpO1xuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICBsZXQgbmV3S2V5ID0ga2V5O1xuICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCAhPT0gLTEpIHtcbiAgICAgIGNvbnN0IGJlZm9yZTIgPSB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0/Ll9wYXJlbnRQb3M7XG4gICAgICBjb25zdCBhZnRlcjIgPSB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zO1xuICAgICAgbmV3S2V5ID0gbWFrZVBvc2l0aW9uKGJlZm9yZTIsIGFmdGVyMik7XG4gICAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBuZXdLZXkpO1xuICAgIH1cbiAgICB0aGlzLl9pbnNlcnRBbmRTb3J0KGNoaWxkKTtcbiAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgIHJldHVybiB7XG4gICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIGNoaWxkKV0pLFxuICAgICAgcmV2ZXJzZTogW3sgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLywgaWQgfV1cbiAgICB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5U2V0VW5kb1JlZG8ob3ApIHtcbiAgICBjb25zdCB7IGlkLCBwYXJlbnRLZXk6IGtleSB9ID0gb3A7XG4gICAgY29uc3QgY2hpbGQgPSBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCk7XG4gICAgaWYgKHRoaXMuX3Bvb2w/LmdldE5vZGUoaWQpICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMuc2V0KGtleSwgbm4ob3Aub3BJZCkpO1xuICAgIGNvbnN0IGluZGV4T2ZJdGVtV2l0aFNhbWVLZXkgPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICBjaGlsZC5fYXR0YWNoKGlkLCBubih0aGlzLl9wb29sKSk7XG4gICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICBjb25zdCBuZXdLZXkgPSBrZXk7XG4gICAgaWYgKGluZGV4T2ZJdGVtV2l0aFNhbWVLZXkgIT09IC0xKSB7XG4gICAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleE9mSXRlbVdpdGhTYW1lS2V5XTtcbiAgICAgIGV4aXN0aW5nSXRlbS5fZGV0YWNoKCk7XG4gICAgICB0aGlzLl9pdGVtc1tpbmRleE9mSXRlbVdpdGhTYW1lS2V5XSA9IGNoaWxkO1xuICAgICAgY29uc3QgcmV2ZXJzZSA9IEhBQ0tfYWRkSW50ZW50QW5kRGVsZXRlZElkVG9PcGVyYXRpb24oXG4gICAgICAgIGV4aXN0aW5nSXRlbS5fdG9PcHMobm4odGhpcy5faWQpLCBrZXksIHRoaXMuX3Bvb2wpLFxuICAgICAgICBvcC5pZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGRlbHRhID0gW3NldERlbHRhKGluZGV4T2ZJdGVtV2l0aFNhbWVLZXksIGNoaWxkKV07XG4gICAgICBjb25zdCBkZWxldGVkRGVsdGEgPSB0aGlzLl9kZXRhY2hJdGVtQXNzb2NpYXRlZFRvU2V0T3BlcmF0aW9uKFxuICAgICAgICBvcC5kZWxldGVkSWRcbiAgICAgICk7XG4gICAgICBpZiAoZGVsZXRlZERlbHRhKSB7XG4gICAgICAgIGRlbHRhLnB1c2goZGVsZXRlZERlbHRhKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIGRlbHRhKSxcbiAgICAgICAgcmV2ZXJzZVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgICB0aGlzLl9kZXRhY2hJdGVtQXNzb2NpYXRlZFRvU2V0T3BlcmF0aW9uKG9wLmRlbGV0ZWRJZCk7XG4gICAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmV2ZXJzZTogW3sgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLywgaWQgfV0sXG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtpbnNlcnREZWx0YShuZXdJbmRleCwgY2hpbGQpXSlcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2F0dGFjaENoaWxkKG9wLCBzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5fcG9vbCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBhdHRhY2ggY2hpbGQgaWYgbWFuYWdlZCBwb29sIGlzIG5vdCBwcmVzZW50XCIpO1xuICAgIH1cbiAgICBsZXQgcmVzdWx0O1xuICAgIGlmIChvcC5pbnRlbnQgPT09IFwic2V0XCIpIHtcbiAgICAgIGlmIChzb3VyY2UgPT09IDEgLyogUkVNT1RFICovKSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuX2FwcGx5U2V0UmVtb3RlKG9wKTtcbiAgICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseVNldEFjayhvcCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseVNldFVuZG9SZWRvKG9wKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNvdXJjZSA9PT0gMSAvKiBSRU1PVEUgKi8pIHtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5fYXBwbHlSZW1vdGVJbnNlcnQob3ApO1xuICAgICAgfSBlbHNlIGlmIChzb3VyY2UgPT09IDIgLyogQUNLICovKSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuX2FwcGx5SW5zZXJ0QWNrKG9wKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuX2FwcGx5SW5zZXJ0VW5kb1JlZG8ob3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocmVzdWx0Lm1vZGlmaWVkICE9PSBmYWxzZSkge1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfZGV0YWNoQ2hpbGQoY2hpbGQpIHtcbiAgICBpZiAoY2hpbGQpIHtcbiAgICAgIGNvbnN0IHBhcmVudEtleSA9IG5uKGNoaWxkLl9wYXJlbnRLZXkpO1xuICAgICAgY29uc3QgcmV2ZXJzZSA9IGNoaWxkLl90b09wcyhubih0aGlzLl9pZCksIHBhcmVudEtleSwgdGhpcy5fcG9vbCk7XG4gICAgICBjb25zdCBpbmRleFRvRGVsZXRlID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAoaW5kZXhUb0RlbGV0ZSA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleFRvRGVsZXRlLCAxKTtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgY2hpbGQuX2RldGFjaCgpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2RlbGV0ZURlbHRhKGluZGV4VG9EZWxldGUpXSksXG4gICAgICAgIHJldmVyc2VcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5U2V0Q2hpbGRLZXlSZW1vdGUobmV3S2V5LCBjaGlsZCkge1xuICAgIGlmICh0aGlzLl9pbXBsaWNpdGx5RGVsZXRlZEl0ZW1zLmhhcyhjaGlsZCkpIHtcbiAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuZGVsZXRlKGNoaWxkKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9pbnNlcnRBbmRTb3J0KGNoaWxkKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIGNoaWxkKV0pLFxuICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcHJldmlvdXNLZXkgPSBjaGlsZC5fcGFyZW50S2V5O1xuICAgIGlmIChuZXdLZXkgPT09IHByZXZpb3VzS2V5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKG5ld0tleSk7XG4gICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ID09PSAtMSkge1xuICAgICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGlmIChuZXdJbmRleCA9PT0gcHJldmlvdXNJbmRleCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW21vdmVEZWx0YShwcmV2aW91c0luZGV4LCBuZXdJbmRleCwgY2hpbGQpXSksXG4gICAgICAgIHJldmVyc2U6IFtdXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uX3NldFBhcmVudExpbmsoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIG1ha2VQb3NpdGlvbihuZXdLZXksIHRoaXMuX2l0ZW1zW2V4aXN0aW5nSXRlbUluZGV4ICsgMV0/Ll9wYXJlbnRQb3MpXG4gICAgICApO1xuICAgICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGlmIChuZXdJbmRleCA9PT0gcHJldmlvdXNJbmRleCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW21vdmVEZWx0YShwcmV2aW91c0luZGV4LCBuZXdJbmRleCwgY2hpbGQpXSksXG4gICAgICAgIHJldmVyc2U6IFtdXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldENoaWxkS2V5QWNrKG5ld0tleSwgY2hpbGQpIHtcbiAgICBjb25zdCBwcmV2aW91c0tleSA9IG5uKGNoaWxkLl9wYXJlbnRLZXkpO1xuICAgIGlmICh0aGlzLl9pbXBsaWNpdGx5RGVsZXRlZEl0ZW1zLmhhcyhjaGlsZCkpIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKG5ld0tleSk7XG4gICAgICB0aGlzLl9pbXBsaWNpdGx5RGVsZXRlZEl0ZW1zLmRlbGV0ZShjaGlsZCk7XG4gICAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggIT09IC0xKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5fc2V0UGFyZW50TGluayhcbiAgICAgICAgICB0aGlzLFxuICAgICAgICAgIG1ha2VQb3NpdGlvbihuZXdLZXksIHRoaXMuX2l0ZW1zW2V4aXN0aW5nSXRlbUluZGV4ICsgMV0/Ll9wYXJlbnRQb3MpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBuZXdLZXkpO1xuICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChuZXdLZXkgPT09IHByZXZpb3VzS2V5KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjb25zdCBwcmV2aW91c0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ICE9PSAtMSkge1xuICAgICAgICB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uX3NldFBhcmVudExpbmsoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGlmIChwcmV2aW91c0luZGV4ID09PSBuZXdJbmRleCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbXG4gICAgICAgICAgICBtb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgbmV3SW5kZXgsIGNoaWxkKVxuICAgICAgICAgIF0pLFxuICAgICAgICAgIHJldmVyc2U6IFtdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5U2V0Q2hpbGRLZXlVbmRvUmVkbyhuZXdLZXksIGNoaWxkKSB7XG4gICAgY29uc3QgcHJldmlvdXNLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICBjb25zdCBwcmV2aW91c0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggIT09IC0xKSB7XG4gICAgICB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uX3NldFBhcmVudExpbmsoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIG1ha2VQb3NpdGlvbihuZXdLZXksIHRoaXMuX2l0ZW1zW2V4aXN0aW5nSXRlbUluZGV4ICsgMV0/Ll9wYXJlbnRQb3MpXG4gICAgICApO1xuICAgIH1cbiAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBuZXdLZXkpO1xuICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgaWYgKHByZXZpb3VzSW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbbW92ZURlbHRhKHByZXZpb3VzSW5kZXgsIG5ld0luZGV4LCBjaGlsZCldKSxcbiAgICAgIHJldmVyc2U6IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IDEgLyogU0VUX1BBUkVOVF9LRVkgKi8sXG4gICAgICAgICAgaWQ6IG5uKGNoaWxkLl9pZCksXG4gICAgICAgICAgcGFyZW50S2V5OiBwcmV2aW91c0tleVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9zZXRDaGlsZEtleShuZXdLZXksIGNoaWxkLCBzb3VyY2UpIHtcbiAgICBpZiAoc291cmNlID09PSAxIC8qIFJFTU9URSAqLykge1xuICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5U2V0Q2hpbGRLZXlSZW1vdGUobmV3S2V5LCBjaGlsZCk7XG4gICAgfSBlbHNlIGlmIChzb3VyY2UgPT09IDIgLyogQUNLICovKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXBwbHlTZXRDaGlsZEtleUFjayhuZXdLZXksIGNoaWxkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5U2V0Q2hpbGRLZXlVbmRvUmVkbyhuZXdLZXksIGNoaWxkKTtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHkob3AsIGlzTG9jYWwpIHtcbiAgICByZXR1cm4gc3VwZXIuX2FwcGx5KG9wLCBpc0xvY2FsKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9zZXJpYWxpemUoKSB7XG4gICAgaWYgKHRoaXMucGFyZW50LnR5cGUgIT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXJpYWxpemUgTGl2ZUxpc3QgaWYgcGFyZW50IGlzIG1pc3NpbmdcIik7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAxIC8qIExJU1QgKi8sXG4gICAgICBwYXJlbnRJZDogbm4odGhpcy5wYXJlbnQubm9kZS5faWQsIFwiUGFyZW50IG5vZGUgZXhwZWN0ZWQgdG8gaGF2ZSBJRFwiKSxcbiAgICAgIHBhcmVudEtleTogdGhpcy5wYXJlbnQua2V5XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzLlxuICAgKi9cbiAgZ2V0IGxlbmd0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXMubGVuZ3RoO1xuICB9XG4gIC8qKlxuICAgKiBBZGRzIG9uZSBlbGVtZW50IHRvIHRoZSBlbmQgb2YgdGhlIExpdmVMaXN0LlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byBhZGQgdG8gdGhlIGVuZCBvZiB0aGUgTGl2ZUxpc3QuXG4gICAqL1xuICBwdXNoKGVsZW1lbnQpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIHJldHVybiB0aGlzLmluc2VydChlbGVtZW50LCB0aGlzLmxlbmd0aCk7XG4gIH1cbiAgLyoqXG4gICAqIEluc2VydHMgb25lIGVsZW1lbnQgYXQgYSBzcGVjaWZpZWQgaW5kZXguXG4gICAqIEBwYXJhbSBlbGVtZW50IFRoZSBlbGVtZW50IHRvIGluc2VydC5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCBhdCB3aGljaCB5b3Ugd2FudCB0byBpbnNlcnQgdGhlIGVsZW1lbnQuXG4gICAqL1xuICBpbnNlcnQoZWxlbWVudCwgaW5kZXgpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPiB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYENhbm5vdCBpbnNlcnQgbGlzdCBpdGVtIGF0IGluZGV4IFwiXHUwMDFkJHtpbmRleH1cIi4gaW5kZXggc2hvdWxkIGJlIGJldHdlZW4gMCBhbmQgJHt0aGlzLl9pdGVtcy5sZW5ndGh9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgYmVmb3JlMiA9IHRoaXMuX2l0ZW1zW2luZGV4IC0gMV0gPyB0aGlzLl9pdGVtc1tpbmRleCAtIDFdLl9wYXJlbnRQb3MgOiB2b2lkIDA7XG4gICAgY29uc3QgYWZ0ZXIyID0gdGhpcy5faXRlbXNbaW5kZXhdID8gdGhpcy5faXRlbXNbaW5kZXhdLl9wYXJlbnRQb3MgOiB2b2lkIDA7XG4gICAgY29uc3QgcG9zaXRpb24gPSBtYWtlUG9zaXRpb24oYmVmb3JlMiwgYWZ0ZXIyKTtcbiAgICBjb25zdCB2YWx1ZSA9IGxzb25Ub0xpdmVOb2RlKGVsZW1lbnQpO1xuICAgIHZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIHBvc2l0aW9uKTtcbiAgICB0aGlzLl9pbnNlcnRBbmRTb3J0KHZhbHVlKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiB0aGlzLl9pZCkge1xuICAgICAgY29uc3QgaWQgPSB0aGlzLl9wb29sLmdlbmVyYXRlSWQoKTtcbiAgICAgIHZhbHVlLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgdmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBwb3NpdGlvbiwgdGhpcy5fcG9vbCksXG4gICAgICAgIFt7IHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sIGlkIH1dLFxuICAgICAgICAvKiBAX19QVVJFX18gKi8gbmV3IE1hcChbXG4gICAgICAgICAgW3RoaXMuX2lkLCBtYWtlVXBkYXRlKHRoaXMsIFtpbnNlcnREZWx0YShpbmRleCwgdmFsdWUpXSldXG4gICAgICAgIF0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogTW92ZSBvbmUgZWxlbWVudCBmcm9tIG9uZSBpbmRleCB0byBhbm90aGVyLlxuICAgKiBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHRvIG1vdmVcbiAgICogQHBhcmFtIHRhcmdldEluZGV4IFRoZSBpbmRleCB3aGVyZSB0aGUgZWxlbWVudCBzaG91bGQgYmUgYWZ0ZXIgbW92aW5nLlxuICAgKi9cbiAgbW92ZShpbmRleCwgdGFyZ2V0SW5kZXgpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGlmICh0YXJnZXRJbmRleCA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInRhcmdldEluZGV4IGNhbm5vdCBiZSBsZXNzIHRoYW4gMFwiKTtcbiAgICB9XG4gICAgaWYgKHRhcmdldEluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcInRhcmdldEluZGV4IGNhbm5vdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRoYW4gdGhlIGxpc3QgbGVuZ3RoXCJcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImluZGV4IGNhbm5vdCBiZSBsZXNzIHRoYW4gMFwiKTtcbiAgICB9XG4gICAgaWYgKGluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW5kZXggY2Fubm90IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdGhhbiB0aGUgbGlzdCBsZW5ndGhcIik7XG4gICAgfVxuICAgIGxldCBiZWZvcmVQb3NpdGlvbiA9IG51bGw7XG4gICAgbGV0IGFmdGVyUG9zaXRpb24gPSBudWxsO1xuICAgIGlmIChpbmRleCA8IHRhcmdldEluZGV4KSB7XG4gICAgICBhZnRlclBvc2l0aW9uID0gdGFyZ2V0SW5kZXggPT09IHRoaXMuX2l0ZW1zLmxlbmd0aCAtIDEgPyB2b2lkIDAgOiB0aGlzLl9pdGVtc1t0YXJnZXRJbmRleCArIDFdLl9wYXJlbnRQb3M7XG4gICAgICBiZWZvcmVQb3NpdGlvbiA9IHRoaXMuX2l0ZW1zW3RhcmdldEluZGV4XS5fcGFyZW50UG9zO1xuICAgIH0gZWxzZSB7XG4gICAgICBhZnRlclBvc2l0aW9uID0gdGhpcy5faXRlbXNbdGFyZ2V0SW5kZXhdLl9wYXJlbnRQb3M7XG4gICAgICBiZWZvcmVQb3NpdGlvbiA9IHRhcmdldEluZGV4ID09PSAwID8gdm9pZCAwIDogdGhpcy5faXRlbXNbdGFyZ2V0SW5kZXggLSAxXS5fcGFyZW50UG9zO1xuICAgIH1cbiAgICBjb25zdCBwb3NpdGlvbiA9IG1ha2VQb3NpdGlvbihiZWZvcmVQb3NpdGlvbiwgYWZ0ZXJQb3NpdGlvbik7XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuX2l0ZW1zW2luZGV4XTtcbiAgICBjb25zdCBwcmV2aW91c1Bvc2l0aW9uID0gaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpO1xuICAgIGl0ZW0uX3NldFBhcmVudExpbmsodGhpcywgcG9zaXRpb24pO1xuICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICAgIGlmICh0aGlzLl9wb29sICYmIHRoaXMuX2lkKSB7XG4gICAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKFtcbiAgICAgICAgW3RoaXMuX2lkLCBtYWtlVXBkYXRlKHRoaXMsIFttb3ZlRGVsdGEoaW5kZXgsIHRhcmdldEluZGV4LCBpdGVtKV0pXVxuICAgICAgXSk7XG4gICAgICB0aGlzLl9wb29sLmRpc3BhdGNoKFxuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogMSAvKiBTRVRfUEFSRU5UX0tFWSAqLyxcbiAgICAgICAgICAgIGlkOiBubihpdGVtLl9pZCksXG4gICAgICAgICAgICBvcElkOiB0aGlzLl9wb29sLmdlbmVyYXRlT3BJZCgpLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBwb3NpdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IDEgLyogU0VUX1BBUkVOVF9LRVkgKi8sXG4gICAgICAgICAgICBpZDogbm4oaXRlbS5faWQpLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBwcmV2aW91c1Bvc2l0aW9uXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzdG9yYWdlVXBkYXRlc1xuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYW4gZWxlbWVudCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4XG4gICAqIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIGVsZW1lbnQgdG8gZGVsZXRlXG4gICAqL1xuICBkZWxldGUoaW5kZXgpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDYW5ub3QgZGVsZXRlIGxpc3QgaXRlbSBhdCBpbmRleCBcIiR7aW5kZXh9XCIuIGluZGV4IHNob3VsZCBiZSBiZXR3ZWVuIDAgYW5kICR7dGhpcy5faXRlbXMubGVuZ3RoIC0gMX1gXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBpdGVtID0gdGhpcy5faXRlbXNbaW5kZXhdO1xuICAgIGl0ZW0uX2RldGFjaCgpO1xuICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleCwgMSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wpIHtcbiAgICAgIGNvbnN0IGNoaWxkUmVjb3JkSWQgPSBpdGVtLl9pZDtcbiAgICAgIGlmIChjaGlsZFJlY29yZElkKSB7XG4gICAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KFxuICAgICAgICAgIG5uKHRoaXMuX2lkKSxcbiAgICAgICAgICBtYWtlVXBkYXRlKHRoaXMsIFtkZWxldGVEZWx0YShpbmRleCldKVxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9wb29sLmRpc3BhdGNoKFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IGNoaWxkUmVjb3JkSWQsXG4gICAgICAgICAgICAgIG9wSWQ6IHRoaXMuX3Bvb2wuZ2VuZXJhdGVPcElkKCksXG4gICAgICAgICAgICAgIHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi9cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIGl0ZW0uX3RvT3BzKG5uKHRoaXMuX2lkKSwgaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpKSxcbiAgICAgICAgICBzdG9yYWdlVXBkYXRlc1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBjbGVhcigpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGlmICh0aGlzLl9wb29sKSB7XG4gICAgICBjb25zdCBvcHMgPSBbXTtcbiAgICAgIGNvbnN0IHJldmVyc2VPcHMgPSBbXTtcbiAgICAgIGNvbnN0IHVwZGF0ZURlbHRhID0gW107XG4gICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5faXRlbXMpIHtcbiAgICAgICAgaXRlbS5fZGV0YWNoKCk7XG4gICAgICAgIGNvbnN0IGNoaWxkSWQgPSBpdGVtLl9pZDtcbiAgICAgICAgaWYgKGNoaWxkSWQpIHtcbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovLFxuICAgICAgICAgICAgaWQ6IGNoaWxkSWQsXG4gICAgICAgICAgICBvcElkOiB0aGlzLl9wb29sLmdlbmVyYXRlT3BJZCgpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV2ZXJzZU9wcy5wdXNoKFxuICAgICAgICAgICAgLi4uaXRlbS5fdG9PcHMobm4odGhpcy5faWQpLCBpdGVtLl9nZXRQYXJlbnRLZXlPclRocm93KCkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICB1cGRhdGVEZWx0YS5wdXNoKGRlbGV0ZURlbHRhKDApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5faXRlbXMgPSBbXTtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KG5uKHRoaXMuX2lkKSwgbWFrZVVwZGF0ZSh0aGlzLCB1cGRhdGVEZWx0YSkpO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChvcHMsIHJldmVyc2VPcHMsIHN0b3JhZ2VVcGRhdGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICAgIGl0ZW0uX2RldGFjaCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5faXRlbXMgPSBbXTtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIH1cbiAgfVxuICBzZXQoaW5kZXgsIGl0ZW0pIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDYW5ub3Qgc2V0IGxpc3QgaXRlbSBhdCBpbmRleCBcIlx1MDAxZCR7aW5kZXh9XCIuIGluZGV4IHNob3VsZCBiZSBiZXR3ZWVuIDAgYW5kICR7dGhpcy5faXRlbXMubGVuZ3RoIC0gMX1gXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07XG4gICAgY29uc3QgcG9zaXRpb24gPSBleGlzdGluZ0l0ZW0uX2dldFBhcmVudEtleU9yVGhyb3coKTtcbiAgICBjb25zdCBleGlzdGluZ0lkID0gZXhpc3RpbmdJdGVtLl9pZDtcbiAgICBleGlzdGluZ0l0ZW0uX2RldGFjaCgpO1xuICAgIGNvbnN0IHZhbHVlID0gbHNvblRvTGl2ZU5vZGUoaXRlbSk7XG4gICAgdmFsdWUuX3NldFBhcmVudExpbmsodGhpcywgcG9zaXRpb24pO1xuICAgIHRoaXMuX2l0ZW1zW2luZGV4XSA9IHZhbHVlO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIGlmICh0aGlzLl9wb29sICYmIHRoaXMuX2lkKSB7XG4gICAgICBjb25zdCBpZCA9IHRoaXMuX3Bvb2wuZ2VuZXJhdGVJZCgpO1xuICAgICAgdmFsdWUuX2F0dGFjaChpZCwgdGhpcy5fcG9vbCk7XG4gICAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgICBzdG9yYWdlVXBkYXRlcy5zZXQodGhpcy5faWQsIG1ha2VVcGRhdGUodGhpcywgW3NldERlbHRhKGluZGV4LCB2YWx1ZSldKSk7XG4gICAgICBjb25zdCBvcHMgPSBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKFxuICAgICAgICB2YWx1ZS5fdG9PcHModGhpcy5faWQsIHBvc2l0aW9uLCB0aGlzLl9wb29sKSxcbiAgICAgICAgZXhpc3RpbmdJZFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3VuYWNrbm93bGVkZ2VkU2V0cy5zZXQocG9zaXRpb24sIG5uKG9wc1swXS5vcElkKSk7XG4gICAgICBjb25zdCByZXZlcnNlT3BzID0gSEFDS19hZGRJbnRlbnRBbmREZWxldGVkSWRUb09wZXJhdGlvbihcbiAgICAgICAgZXhpc3RpbmdJdGVtLl90b09wcyh0aGlzLl9pZCwgcG9zaXRpb24sIHZvaWQgMCksXG4gICAgICAgIGlkXG4gICAgICApO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChvcHMsIHJldmVyc2VPcHMsIHN0b3JhZ2VVcGRhdGVzKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gQXJyYXkgb2YgYWxsIHRoZSBlbGVtZW50cyBpbiB0aGUgTGl2ZUxpc3QuXG4gICAqL1xuICB0b0FycmF5KCkge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcy5tYXAoXG4gICAgICAoZW50cnkpID0+IGxpdmVOb2RlVG9Mc29uKGVudHJ5KVxuICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXl5eXl5cbiAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZJWE1FISBUaGlzIGlzbid0IHNhZmUuXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogVGVzdHMgd2hldGhlciBhbGwgZWxlbWVudHMgcGFzcyB0aGUgdGVzdCBpbXBsZW1lbnRlZCBieSB0aGUgcHJvdmlkZWQgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUgRnVuY3Rpb24gdG8gdGVzdCBmb3IgZWFjaCBlbGVtZW50LCB0YWtpbmcgdHdvIGFyZ3VtZW50cyAodGhlIGVsZW1lbnQgYW5kIGl0cyBpbmRleCkuXG4gICAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHByZWRpY2F0ZSBmdW5jdGlvbiByZXR1cm5zIGEgdHJ1dGh5IHZhbHVlIGZvciBldmVyeSBlbGVtZW50LiBPdGhlcndpc2UsIGZhbHNlLlxuICAgKi9cbiAgZXZlcnkocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmV2ZXJ5KHByZWRpY2F0ZSk7XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgZWxlbWVudHMgdGhhdCBwYXNzIHRoZSB0ZXN0IGltcGxlbWVudGVkIGJ5IHRoZSBwcm92aWRlZCBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHByZWRpY2F0ZSBGdW5jdGlvbiB0byB0ZXN0IGVhY2ggZWxlbWVudCBvZiB0aGUgTGl2ZUxpc3QuIFJldHVybiBhIHZhbHVlIHRoYXQgY29lcmNlcyB0byB0cnVlIHRvIGtlZXAgdGhlIGVsZW1lbnQsIG9yIHRvIGZhbHNlIG90aGVyd2lzZS5cbiAgICogQHJldHVybnMgQW4gYXJyYXkgd2l0aCB0aGUgZWxlbWVudHMgdGhhdCBwYXNzIHRoZSB0ZXN0LlxuICAgKi9cbiAgZmlsdGVyKHByZWRpY2F0ZSkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5maWx0ZXIocHJlZGljYXRlKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IHNhdGlzZmllcyB0aGUgcHJvdmlkZWQgdGVzdGluZyBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHByZWRpY2F0ZSBGdW5jdGlvbiB0byBleGVjdXRlIG9uIGVhY2ggdmFsdWUuXG4gICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgTGl2ZUxpc3QgdGhhdCBzYXRpc2ZpZXMgdGhlIHByb3ZpZGVkIHRlc3RpbmcgZnVuY3Rpb24uIE90aGVyd2lzZSwgdW5kZWZpbmVkIGlzIHJldHVybmVkLlxuICAgKi9cbiAgZmluZChwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuZmluZChwcmVkaWNhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgTGl2ZUxpc3QgdGhhdCBzYXRpc2ZpZXMgdGhlIHByb3ZpZGVkIHRlc3RpbmcgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUgRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIHZhbHVlIHVudGlsIHRoZSBmdW5jdGlvbiByZXR1cm5zIHRydWUsIGluZGljYXRpbmcgdGhhdCB0aGUgc2F0aXNmeWluZyBlbGVtZW50IHdhcyBmb3VuZC5cbiAgICogQHJldHVybnMgVGhlIGluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBMaXZlTGlzdCB0aGF0IHBhc3NlcyB0aGUgdGVzdC4gT3RoZXJ3aXNlLCAtMS5cbiAgICovXG4gIGZpbmRJbmRleChwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuZmluZEluZGV4KHByZWRpY2F0ZSk7XG4gIH1cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIGEgcHJvdmlkZWQgZnVuY3Rpb24gb25jZSBmb3IgZWFjaCBlbGVtZW50LlxuICAgKiBAcGFyYW0gY2FsbGJhY2tmbiBGdW5jdGlvbiB0byBleGVjdXRlIG9uIGVhY2ggZWxlbWVudC5cbiAgICovXG4gIGZvckVhY2goY2FsbGJhY2tmbikge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5mb3JFYWNoKGNhbGxiYWNrZm4pO1xuICB9XG4gIC8qKlxuICAgKiBHZXQgdGhlIGVsZW1lbnQgYXQgdGhlIHNwZWNpZmllZCBpbmRleC5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvbiB0aGUgZWxlbWVudCB0byBnZXQuXG4gICAqIEByZXR1cm5zIFRoZSBlbGVtZW50IGF0IHRoZSBzcGVjaWZpZWQgaW5kZXggb3IgdW5kZWZpbmVkLlxuICAgKi9cbiAgZ2V0KGluZGV4KSB7XG4gICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuICAgIHJldHVybiBsaXZlTm9kZVRvTHNvbih0aGlzLl9pdGVtc1tpbmRleF0pO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBmaXJzdCBpbmRleCBhdCB3aGljaCBhIGdpdmVuIGVsZW1lbnQgY2FuIGJlIGZvdW5kIGluIHRoZSBMaXZlTGlzdCwgb3IgLTEgaWYgaXQgaXMgbm90IHByZXNlbnQuXG4gICAqIEBwYXJhbSBzZWFyY2hFbGVtZW50IEVsZW1lbnQgdG8gbG9jYXRlLlxuICAgKiBAcGFyYW0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzdGFydCB0aGUgc2VhcmNoIGF0LlxuICAgKiBAcmV0dXJucyBUaGUgZmlyc3QgaW5kZXggb2YgdGhlIGVsZW1lbnQgaW4gdGhlIExpdmVMaXN0OyAtMSBpZiBub3QgZm91bmQuXG4gICAqL1xuICBpbmRleE9mKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5pbmRleE9mKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGxhc3QgaW5kZXggYXQgd2hpY2ggYSBnaXZlbiBlbGVtZW50IGNhbiBiZSBmb3VuZCBpbiB0aGUgTGl2ZUxpc3QsIG9yIC0xIGlmIGl0IGlzIG5vdCBwcmVzZW50LiBUaGUgTGl2ZUxzaXQgaXMgc2VhcmNoZWQgYmFja3dhcmRzLCBzdGFydGluZyBhdCBmcm9tSW5kZXguXG4gICAqIEBwYXJhbSBzZWFyY2hFbGVtZW50IEVsZW1lbnQgdG8gbG9jYXRlLlxuICAgKiBAcGFyYW0gZnJvbUluZGV4IFRoZSBpbmRleCBhdCB3aGljaCB0byBzdGFydCBzZWFyY2hpbmcgYmFja3dhcmRzLlxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgbGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmxhc3RJbmRleE9mKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCk7XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gYXJyYXkgcG9wdWxhdGVkIHdpdGggdGhlIHJlc3VsdHMgb2YgY2FsbGluZyBhIHByb3ZpZGVkIGZ1bmN0aW9uIG9uIGV2ZXJ5IGVsZW1lbnQuXG4gICAqIEBwYXJhbSBjYWxsYmFjayBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBmb3IgZXZlcnkgZWxlbWVudC5cbiAgICogQHJldHVybnMgQW4gYXJyYXkgd2l0aCBlYWNoIGVsZW1lbnQgYmVpbmcgdGhlIHJlc3VsdCBvZiB0aGUgY2FsbGJhY2sgZnVuY3Rpb24uXG4gICAqL1xuICBtYXAoY2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXMubWFwKFxuICAgICAgKGVudHJ5LCBpKSA9PiBjYWxsYmFjayhcbiAgICAgICAgbGl2ZU5vZGVUb0xzb24oZW50cnkpLFxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgXl5eXl5eXl5cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIEZJWE1FISBUaGlzIGlzbid0IHNhZmUuXG4gICAgICAgIGlcbiAgICAgIClcbiAgICApO1xuICB9XG4gIC8qKlxuICAgKiBUZXN0cyB3aGV0aGVyIGF0IGxlYXN0IG9uZSBlbGVtZW50IGluIHRoZSBMaXZlTGlzdCBwYXNzZXMgdGhlIHRlc3QgaW1wbGVtZW50ZWQgYnkgdGhlIHByb3ZpZGVkIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0gcHJlZGljYXRlIEZ1bmN0aW9uIHRvIHRlc3QgZm9yIGVhY2ggZWxlbWVudC5cbiAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gcmV0dXJucyBhIHRydXRoeSB2YWx1ZSBmb3IgYXQgbGVhc3Qgb25lIGVsZW1lbnQuIE90aGVyd2lzZSwgZmFsc2UuXG4gICAqL1xuICBzb21lKHByZWRpY2F0ZSkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5zb21lKHByZWRpY2F0ZSk7XG4gIH1cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgcmV0dXJuIG5ldyBMaXZlTGlzdEl0ZXJhdG9yKHRoaXMuX2l0ZW1zKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChvcCwga2V5KSB7XG4gICAgY29uc3QgbmV3SXRlbSA9IGNyZWF0aW9uT3BUb0xpdmVOb2RlKG9wKTtcbiAgICBuZXdJdGVtLl9hdHRhY2gob3AuaWQsIG5uKHRoaXMuX3Bvb2wpKTtcbiAgICBuZXdJdGVtLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgdGhpcy5faW5zZXJ0QW5kU29ydChuZXdJdGVtKTtcbiAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgIHJldHVybiB7IG5ld0l0ZW0sIG5ld0luZGV4IH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2hpZnRJdGVtUG9zaXRpb24oaW5kZXgsIGtleSkge1xuICAgIGNvbnN0IHNoaWZ0ZWRQb3NpdGlvbiA9IG1ha2VQb3NpdGlvbihcbiAgICAgIGtleSxcbiAgICAgIHRoaXMuX2l0ZW1zLmxlbmd0aCA+IGluZGV4ICsgMSA/IHRoaXMuX2l0ZW1zW2luZGV4ICsgMV0/Ll9wYXJlbnRQb3MgOiB2b2lkIDBcbiAgICApO1xuICAgIHRoaXMuX2l0ZW1zW2luZGV4XS5fc2V0UGFyZW50TGluayh0aGlzLCBzaGlmdGVkUG9zaXRpb24pO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvVHJlZU5vZGUoa2V5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiTGl2ZUxpc3RcIixcbiAgICAgIGlkOiB0aGlzLl9pZCA/PyBuYW5vaWQoKSxcbiAgICAgIGtleSxcbiAgICAgIHBheWxvYWQ6IHRoaXMuX2l0ZW1zLm1hcChcbiAgICAgICAgKGl0ZW0sIGluZGV4KSA9PiBpdGVtLnRvVHJlZU5vZGUoaW5kZXgudG9TdHJpbmcoKSlcbiAgICAgIClcbiAgICB9O1xuICB9XG4gIHRvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiBzdXBlci50b0ltbXV0YWJsZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2l0ZW1zLm1hcCgobm9kZSkgPT4gbm9kZS50b0ltbXV0YWJsZSgpKTtcbiAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiID8gcmVzdWx0IDogT2JqZWN0LmZyZWV6ZShyZXN1bHQpO1xuICB9XG4gIGNsb25lKCkge1xuICAgIHJldHVybiBuZXcgX0xpdmVMaXN0KHRoaXMuX2l0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS5jbG9uZSgpKSk7XG4gIH1cbn07XG52YXIgTGl2ZUxpc3RJdGVyYXRvciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaXRlbXMpIHtcbiAgICB0aGlzLl9pbm5lckl0ZXJhdG9yID0gaXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICB9XG4gIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIG5leHQoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5faW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb25lOiB0cnVlLFxuICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCB2YWx1ZSA9IGxpdmVOb2RlVG9Mc29uKHJlc3VsdC52YWx1ZSk7XG4gICAgcmV0dXJuIHsgdmFsdWUgfTtcbiAgfVxufTtcbmZ1bmN0aW9uIG1ha2VVcGRhdGUobGl2ZUxpc3QsIGRlbHRhVXBkYXRlcykge1xuICByZXR1cm4ge1xuICAgIG5vZGU6IGxpdmVMaXN0LFxuICAgIHR5cGU6IFwiTGl2ZUxpc3RcIixcbiAgICB1cGRhdGVzOiBkZWx0YVVwZGF0ZXNcbiAgfTtcbn1cbmZ1bmN0aW9uIHNldERlbHRhKGluZGV4LCBpdGVtKSB7XG4gIHJldHVybiB7XG4gICAgaW5kZXgsXG4gICAgdHlwZTogXCJzZXRcIixcbiAgICBpdGVtOiBpdGVtIGluc3RhbmNlb2YgTGl2ZVJlZ2lzdGVyID8gaXRlbS5kYXRhIDogaXRlbVxuICB9O1xufVxuZnVuY3Rpb24gZGVsZXRlRGVsdGEoaW5kZXgpIHtcbiAgcmV0dXJuIHtcbiAgICBpbmRleCxcbiAgICB0eXBlOiBcImRlbGV0ZVwiXG4gIH07XG59XG5mdW5jdGlvbiBpbnNlcnREZWx0YShpbmRleCwgaXRlbSkge1xuICByZXR1cm4ge1xuICAgIGluZGV4LFxuICAgIHR5cGU6IFwiaW5zZXJ0XCIsXG4gICAgaXRlbTogaXRlbSBpbnN0YW5jZW9mIExpdmVSZWdpc3RlciA/IGl0ZW0uZGF0YSA6IGl0ZW1cbiAgfTtcbn1cbmZ1bmN0aW9uIG1vdmVEZWx0YShwcmV2aW91c0luZGV4LCBpbmRleCwgaXRlbSkge1xuICByZXR1cm4ge1xuICAgIGluZGV4LFxuICAgIHR5cGU6IFwibW92ZVwiLFxuICAgIHByZXZpb3VzSW5kZXgsXG4gICAgaXRlbTogaXRlbSBpbnN0YW5jZW9mIExpdmVSZWdpc3RlciA/IGl0ZW0uZGF0YSA6IGl0ZW1cbiAgfTtcbn1cbmZ1bmN0aW9uIEhBQ0tfYWRkSW50ZW50QW5kRGVsZXRlZElkVG9PcGVyYXRpb24ob3BzLCBkZWxldGVkSWQpIHtcbiAgcmV0dXJuIG9wcy5tYXAoKG9wLCBpbmRleCkgPT4ge1xuICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgY29uc3QgZmlyc3RPcCA9IG9wO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uZmlyc3RPcCxcbiAgICAgICAgaW50ZW50OiBcInNldFwiLFxuICAgICAgICBkZWxldGVkSWRcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBvcDtcbiAgICB9XG4gIH0pO1xufVxuXG4vLyBzcmMvbGliL2ZyZWV6ZS50c1xudmFyIGZyZWV6ZSA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIiA/IChcbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgKHgpID0+IHhcbikgOiBPYmplY3QuZnJlZXplO1xuXG4vLyBzcmMvY3JkdHMvTGl2ZU1hcC50c1xudmFyIExpdmVNYXAgPSBjbGFzcyBfTGl2ZU1hcCBleHRlbmRzIEFic3RyYWN0Q3JkdCB7XG4gIGNvbnN0cnVjdG9yKGVudHJpZXMyKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnVuYWNrbm93bGVkZ2VkU2V0ID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICBpZiAoZW50cmllczIpIHtcbiAgICAgIGNvbnN0IG1hcHBlZEVudHJpZXMgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMyKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBsc29uVG9MaXZlTm9kZSh2YWx1ZSk7XG4gICAgICAgIG5vZGUuX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICAgICAgbWFwcGVkRW50cmllcy5wdXNoKFtrZXksIG5vZGVdKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX21hcCA9IG5ldyBNYXAobWFwcGVkRW50cmllcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX21hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF90b09wcyhwYXJlbnRJZCwgcGFyZW50S2V5LCBwb29sKSB7XG4gICAgaWYgKHRoaXMuX2lkID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXJpYWxpemUgaXRlbSBpcyBub3QgYXR0YWNoZWRcIik7XG4gICAgfVxuICAgIGNvbnN0IG9wcyA9IFtdO1xuICAgIGNvbnN0IG9wID0ge1xuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgb3BJZDogcG9vbD8uZ2VuZXJhdGVPcElkKCksXG4gICAgICB0eXBlOiA3IC8qIENSRUFURV9NQVAgKi8sXG4gICAgICBwYXJlbnRJZCxcbiAgICAgIHBhcmVudEtleVxuICAgIH07XG4gICAgb3BzLnB1c2gob3ApO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgb3BzLnB1c2goLi4udmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBrZXksIHBvb2wpKTtcbiAgICB9XG4gICAgcmV0dXJuIG9wcztcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgX2Rlc2VyaWFsaXplKFtpZCwgX2l0ZW1dLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgbWFwID0gbmV3IF9MaXZlTWFwKCk7XG4gICAgbWFwLl9hdHRhY2goaWQsIHBvb2wpO1xuICAgIGNvbnN0IGNoaWxkcmVuID0gcGFyZW50VG9DaGlsZHJlbi5nZXQoaWQpO1xuICAgIGlmIChjaGlsZHJlbiA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbWFwO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtpZDIsIGNyZHRdIG9mIGNoaWxkcmVuKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGRlc2VyaWFsaXplKFtpZDIsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKG1hcCwgY3JkdC5wYXJlbnRLZXkpO1xuICAgICAgbWFwLl9tYXAuc2V0KGNyZHQucGFyZW50S2V5LCBjaGlsZCk7XG4gICAgICBtYXAuaW52YWxpZGF0ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gbWFwO1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9hdHRhY2goaWQsIHBvb2wpIHtcbiAgICBzdXBlci5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICBmb3IgKGNvbnN0IFtfa2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICBpZiAoaXNMaXZlTm9kZSh2YWx1ZSkpIHtcbiAgICAgICAgdmFsdWUuX2F0dGFjaChwb29sLmdlbmVyYXRlSWQoKSwgcG9vbCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9hdHRhY2hDaGlsZChvcCwgc291cmNlKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3QgeyBpZCwgcGFyZW50S2V5LCBvcElkIH0gPSBvcDtcbiAgICBjb25zdCBrZXkgPSBwYXJlbnRLZXk7XG4gICAgY29uc3QgY2hpbGQgPSBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wuZ2V0Tm9kZShpZCkgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGlmIChzb3VyY2UgPT09IDIgLyogQUNLICovKSB7XG4gICAgICBjb25zdCBsYXN0VXBkYXRlT3BJZCA9IHRoaXMudW5hY2tub3dsZWRnZWRTZXQuZ2V0KGtleSk7XG4gICAgICBpZiAobGFzdFVwZGF0ZU9wSWQgPT09IG9wSWQpIHtcbiAgICAgICAgdGhpcy51bmFja25vd2xlZGdlZFNldC5kZWxldGUoa2V5KTtcbiAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICB9IGVsc2UgaWYgKGxhc3RVcGRhdGVPcElkICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzb3VyY2UgPT09IDEgLyogUkVNT1RFICovKSB7XG4gICAgICB0aGlzLnVuYWNrbm93bGVkZ2VkU2V0LmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgICBjb25zdCBwcmV2aW91c1ZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGxldCByZXZlcnNlO1xuICAgIGlmIChwcmV2aW91c1ZhbHVlKSB7XG4gICAgICBjb25zdCB0aGlzSWQgPSBubih0aGlzLl9pZCk7XG4gICAgICByZXZlcnNlID0gcHJldmlvdXNWYWx1ZS5fdG9PcHModGhpc0lkLCBrZXkpO1xuICAgICAgcHJldmlvdXNWYWx1ZS5fZGV0YWNoKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldmVyc2UgPSBbeyB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovLCBpZCB9XTtcbiAgICB9XG4gICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICBjaGlsZC5fYXR0YWNoKGlkLCB0aGlzLl9wb29sKTtcbiAgICB0aGlzLl9tYXAuc2V0KGtleSwgY2hpbGQpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIHJldHVybiB7XG4gICAgICBtb2RpZmllZDoge1xuICAgICAgICBub2RlOiB0aGlzLFxuICAgICAgICB0eXBlOiBcIkxpdmVNYXBcIixcbiAgICAgICAgdXBkYXRlczogeyBba2V5XTogeyB0eXBlOiBcInVwZGF0ZVwiIH0gfVxuICAgICAgfSxcbiAgICAgIHJldmVyc2VcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9kZXRhY2goKSB7XG4gICAgc3VwZXIuX2RldGFjaCgpO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLl9tYXAudmFsdWVzKCkpIHtcbiAgICAgIGl0ZW0uX2RldGFjaCgpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfZGV0YWNoQ2hpbGQoY2hpbGQpIHtcbiAgICBjb25zdCBpZCA9IG5uKHRoaXMuX2lkKTtcbiAgICBjb25zdCBwYXJlbnRLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICBjb25zdCByZXZlcnNlID0gY2hpbGQuX3RvT3BzKGlkLCBwYXJlbnRLZXksIHRoaXMuX3Bvb2wpO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgaWYgKHZhbHVlID09PSBjaGlsZCkge1xuICAgICAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBjaGlsZC5fZGV0YWNoKCk7XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZSA9IHtcbiAgICAgIG5vZGU6IHRoaXMsXG4gICAgICB0eXBlOiBcIkxpdmVNYXBcIixcbiAgICAgIHVwZGF0ZXM6IHsgW3BhcmVudEtleV06IHsgdHlwZTogXCJkZWxldGVcIiB9IH1cbiAgICB9O1xuICAgIHJldHVybiB7IG1vZGlmaWVkOiBzdG9yYWdlVXBkYXRlLCByZXZlcnNlIH07XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgX3NlcmlhbGl6ZSgpIHtcbiAgICBpZiAodGhpcy5wYXJlbnQudHlwZSAhPT0gXCJIYXNQYXJlbnRcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNlcmlhbGl6ZSBMaXZlTWFwIGlmIHBhcmVudCBpcyBtaXNzaW5nXCIpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogMiAvKiBNQVAgKi8sXG4gICAgICBwYXJlbnRJZDogbm4odGhpcy5wYXJlbnQubm9kZS5faWQsIFwiUGFyZW50IG5vZGUgZXhwZWN0ZWQgdG8gaGF2ZSBJRFwiKSxcbiAgICAgIHBhcmVudEtleTogdGhpcy5wYXJlbnQua2V5XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIHNwZWNpZmllZCBlbGVtZW50IGZyb20gdGhlIExpdmVNYXAuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgZWxlbWVudCB0byByZXR1cm4uXG4gICAqIEByZXR1cm5zIFRoZSBlbGVtZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSwgb3IgdW5kZWZpbmVkIGlmIHRoZSBrZXkgY2FuJ3QgYmUgZm91bmQgaW4gdGhlIExpdmVNYXAuXG4gICAqL1xuICBnZXQoa2V5KSB7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuICAgIHJldHVybiBsaXZlTm9kZVRvTHNvbih2YWx1ZSk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZHMgb3IgdXBkYXRlcyBhbiBlbGVtZW50IHdpdGggYSBzcGVjaWZpZWQga2V5IGFuZCBhIHZhbHVlLlxuICAgKiBAcGFyYW0ga2V5IFRoZSBrZXkgb2YgdGhlIGVsZW1lbnQgdG8gYWRkLiBTaG91bGQgYmUgYSBzdHJpbmcuXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIGVsZW1lbnQgdG8gYWRkLiBTaG91bGQgYmUgc2VyaWFsaXphYmxlIHRvIEpTT04uXG4gICAqL1xuICBzZXQoa2V5LCB2YWx1ZSkge1xuICAgIHRoaXMuX3Bvb2w/LmFzc2VydFN0b3JhZ2VJc1dyaXRhYmxlKCk7XG4gICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgaWYgKG9sZFZhbHVlKSB7XG4gICAgICBvbGRWYWx1ZS5fZGV0YWNoKCk7XG4gICAgfVxuICAgIGNvbnN0IGl0ZW0gPSBsc29uVG9MaXZlTm9kZSh2YWx1ZSk7XG4gICAgaXRlbS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgIHRoaXMuX21hcC5zZXQoa2V5LCBpdGVtKTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiB0aGlzLl9pZCkge1xuICAgICAgY29uc3QgaWQgPSB0aGlzLl9wb29sLmdlbmVyYXRlSWQoKTtcbiAgICAgIGl0ZW0uX2F0dGFjaChpZCwgdGhpcy5fcG9vbCk7XG4gICAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgICBzdG9yYWdlVXBkYXRlcy5zZXQodGhpcy5faWQsIHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICAgIHVwZGF0ZXM6IHsgW2tleV06IHsgdHlwZTogXCJ1cGRhdGVcIiB9IH1cbiAgICAgIH0pO1xuICAgICAgY29uc3Qgb3BzID0gaXRlbS5fdG9PcHModGhpcy5faWQsIGtleSwgdGhpcy5fcG9vbCk7XG4gICAgICB0aGlzLnVuYWNrbm93bGVkZ2VkU2V0LnNldChrZXksIG5uKG9wc1swXS5vcElkKSk7XG4gICAgICB0aGlzLl9wb29sLmRpc3BhdGNoKFxuICAgICAgICBpdGVtLl90b09wcyh0aGlzLl9pZCwga2V5LCB0aGlzLl9wb29sKSxcbiAgICAgICAgb2xkVmFsdWUgPyBvbGRWYWx1ZS5fdG9PcHModGhpcy5faWQsIGtleSkgOiBbeyB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovLCBpZCB9XSxcbiAgICAgICAgc3RvcmFnZVVwZGF0ZXNcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhlIExpdmVNYXAuXG4gICAqL1xuICBnZXQgc2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWFwLnNpemU7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciBhbiBlbGVtZW50IHdpdGggdGhlIHNwZWNpZmllZCBrZXkgZXhpc3RzIG9yIG5vdC5cbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBlbGVtZW50IHRvIHRlc3QgZm9yIHByZXNlbmNlLlxuICAgKi9cbiAgaGFzKGtleSkge1xuICAgIHJldHVybiB0aGlzLl9tYXAuaGFzKGtleSk7XG4gIH1cbiAgLyoqXG4gICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBlbGVtZW50IGJ5IGtleS5cbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBlbGVtZW50IHRvIHJlbW92ZS5cbiAgICogQHJldHVybnMgdHJ1ZSBpZiBhbiBlbGVtZW50IGV4aXN0ZWQgYW5kIGhhcyBiZWVuIHJlbW92ZWQsIG9yIGZhbHNlIGlmIHRoZSBlbGVtZW50IGRvZXMgbm90IGV4aXN0LlxuICAgKi9cbiAgZGVsZXRlKGtleSkge1xuICAgIHRoaXMuX3Bvb2w/LmFzc2VydFN0b3JhZ2VJc1dyaXRhYmxlKCk7XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBpZiAoaXRlbSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGl0ZW0uX2RldGFjaCgpO1xuICAgIHRoaXMuX21hcC5kZWxldGUoa2V5KTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiBpdGVtLl9pZCkge1xuICAgICAgY29uc3QgdGhpc0lkID0gbm4odGhpcy5faWQpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXNJZCwge1xuICAgICAgICBub2RlOiB0aGlzLFxuICAgICAgICB0eXBlOiBcIkxpdmVNYXBcIixcbiAgICAgICAgdXBkYXRlczogeyBba2V5XTogeyB0eXBlOiBcImRlbGV0ZVwiIH0gfVxuICAgICAgfSk7XG4gICAgICB0aGlzLl9wb29sLmRpc3BhdGNoKFxuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLyxcbiAgICAgICAgICAgIGlkOiBpdGVtLl9pZCxcbiAgICAgICAgICAgIG9wSWQ6IHRoaXMuX3Bvb2wuZ2VuZXJhdGVPcElkKClcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIGl0ZW0uX3RvT3BzKHRoaXNJZCwga2V5KSxcbiAgICAgICAgc3RvcmFnZVVwZGF0ZXNcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbmV3IEl0ZXJhdG9yIG9iamVjdCB0aGF0IGNvbnRhaW5zIHRoZSBba2V5LCB2YWx1ZV0gcGFpcnMgZm9yIGVhY2ggZWxlbWVudC5cbiAgICovXG4gIGVudHJpZXMoKSB7XG4gICAgY29uc3QgaW5uZXJJdGVyYXRvciA9IHRoaXMuX21hcC5lbnRyaWVzKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBuZXh0KCkge1xuICAgICAgICBjb25zdCBpdGVyYXRvclZhbHVlID0gaW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIGlmIChpdGVyYXRvclZhbHVlLmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gaXRlcmF0b3JWYWx1ZS52YWx1ZTtcbiAgICAgICAgY29uc3Qga2V5ID0gZW50cnlbMF07XG4gICAgICAgIGNvbnN0IHZhbHVlID0gbGl2ZU5vZGVUb0xzb24oaXRlcmF0b3JWYWx1ZS52YWx1ZVsxXSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsdWU6IFtrZXksIHZhbHVlXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFNhbWUgZnVuY3Rpb24gb2JqZWN0IGFzIHRoZSBpbml0aWFsIHZhbHVlIG9mIHRoZSBlbnRyaWVzIG1ldGhvZC5cbiAgICovXG4gIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgIHJldHVybiB0aGlzLmVudHJpZXMoKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBJdGVyYXRvciBvYmplY3QgdGhhdCBjb250YWlucyB0aGUga2V5cyBmb3IgZWFjaCBlbGVtZW50LlxuICAgKi9cbiAga2V5cygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWFwLmtleXMoKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBJdGVyYXRvciBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgdmFsdWVzIGZvciBlYWNoIGVsZW1lbnQuXG4gICAqL1xuICB2YWx1ZXMoKSB7XG4gICAgY29uc3QgaW5uZXJJdGVyYXRvciA9IHRoaXMuX21hcC52YWx1ZXMoKTtcbiAgICByZXR1cm4ge1xuICAgICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIG5leHQoKSB7XG4gICAgICAgIGNvbnN0IGl0ZXJhdG9yVmFsdWUgPSBpbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgaWYgKGl0ZXJhdG9yVmFsdWUuZG9uZSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkb25lOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWUgPSBsaXZlTm9kZVRvTHNvbihpdGVyYXRvclZhbHVlLnZhbHVlKTtcbiAgICAgICAgcmV0dXJuIHsgdmFsdWUgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBFeGVjdXRlcyBhIHByb3ZpZGVkIGZ1bmN0aW9uIG9uY2UgcGVyIGVhY2gga2V5L3ZhbHVlIHBhaXIgaW4gdGhlIE1hcCBvYmplY3QsIGluIGluc2VydGlvbiBvcmRlci5cbiAgICogQHBhcmFtIGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgZm9yIGVhY2ggZW50cnkgaW4gdGhlIG1hcC5cbiAgICovXG4gIGZvckVhY2goY2FsbGJhY2spIHtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHRoaXMpIHtcbiAgICAgIGNhbGxiYWNrKGVudHJ5WzFdLCBlbnRyeVswXSwgdGhpcyk7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvVHJlZU5vZGUoa2V5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiTGl2ZU1hcFwiLFxuICAgICAgaWQ6IHRoaXMuX2lkID8/IG5hbm9pZCgpLFxuICAgICAga2V5LFxuICAgICAgcGF5bG9hZDogQXJyYXkuZnJvbSh0aGlzLl9tYXAuZW50cmllcygpKS5tYXAoXG4gICAgICAgIChba2V5MiwgdmFsXSkgPT4gdmFsLnRvVHJlZU5vZGUoa2V5MilcbiAgICAgIClcbiAgICB9O1xuICB9XG4gIHRvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiBzdXBlci50b0ltbXV0YWJsZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICByZXN1bHQuc2V0KGtleSwgdmFsdWUudG9JbW11dGFibGUoKSk7XG4gICAgfVxuICAgIHJldHVybiBmcmVlemUocmVzdWx0KTtcbiAgfVxuICBjbG9uZSgpIHtcbiAgICByZXR1cm4gbmV3IF9MaXZlTWFwKFxuICAgICAgQXJyYXkuZnJvbSh0aGlzLl9tYXApLm1hcCgoW2tleSwgbm9kZV0pID0+IFtrZXksIG5vZGUuY2xvbmUoKV0pXG4gICAgKTtcbiAgfVxufTtcblxuLy8gc3JjL2NyZHRzL0xpdmVPYmplY3QudHNcbnZhciBMaXZlT2JqZWN0ID0gY2xhc3MgX0xpdmVPYmplY3QgZXh0ZW5kcyBBYnN0cmFjdENyZHQge1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBfYnVpbGRSb290QW5kUGFyZW50VG9DaGlsZHJlbihpdGVtcykge1xuICAgIGNvbnN0IHBhcmVudFRvQ2hpbGRyZW4gPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGxldCByb290ID0gbnVsbDtcbiAgICBmb3IgKGNvbnN0IFtpZCwgY3JkdF0gb2YgaXRlbXMpIHtcbiAgICAgIGlmIChpc1Jvb3RDcmR0KGNyZHQpKSB7XG4gICAgICAgIHJvb3QgPSBbaWQsIGNyZHRdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgdHVwbGUgPSBbaWQsIGNyZHRdO1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHBhcmVudFRvQ2hpbGRyZW4uZ2V0KGNyZHQucGFyZW50SWQpO1xuICAgICAgICBpZiAoY2hpbGRyZW4gIT09IHZvaWQgMCkge1xuICAgICAgICAgIGNoaWxkcmVuLnB1c2godHVwbGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhcmVudFRvQ2hpbGRyZW4uc2V0KGNyZHQucGFyZW50SWQsIFt0dXBsZV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChyb290ID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSb290IGNhbid0IGJlIG51bGxcIik7XG4gICAgfVxuICAgIHJldHVybiBbcm9vdCwgcGFyZW50VG9DaGlsZHJlbl07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2Zyb21JdGVtcyhpdGVtcywgcG9vbCkge1xuICAgIGNvbnN0IFtyb290LCBwYXJlbnRUb0NoaWxkcmVuXSA9IF9MaXZlT2JqZWN0Ll9idWlsZFJvb3RBbmRQYXJlbnRUb0NoaWxkcmVuKGl0ZW1zKTtcbiAgICByZXR1cm4gX0xpdmVPYmplY3QuX2Rlc2VyaWFsaXplKFxuICAgICAgcm9vdCxcbiAgICAgIHBhcmVudFRvQ2hpbGRyZW4sXG4gICAgICBwb29sXG4gICAgKTtcbiAgfVxuICBjb25zdHJ1Y3RvcihvYmogPSB7fSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fcHJvcFRvTGFzdFVwZGF0ZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgY29uc3QgbyA9IGNvbXBhY3RPYmplY3Qob2JqKTtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhvKSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBvW2tleV07XG4gICAgICBpZiAoaXNMaXZlTm9kZSh2YWx1ZSkpIHtcbiAgICAgICAgdmFsdWUuX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5fbWFwID0gbmV3IE1hcChPYmplY3QuZW50cmllcyhvKSk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9PcHMocGFyZW50SWQsIHBhcmVudEtleSwgcG9vbCkge1xuICAgIGlmICh0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIGl0ZW0gaXMgbm90IGF0dGFjaGVkXCIpO1xuICAgIH1cbiAgICBjb25zdCBvcElkID0gcG9vbD8uZ2VuZXJhdGVPcElkKCk7XG4gICAgY29uc3Qgb3BzID0gW107XG4gICAgY29uc3Qgb3AgPSB7XG4gICAgICB0eXBlOiA0IC8qIENSRUFURV9PQkpFQ1QgKi8sXG4gICAgICBpZDogdGhpcy5faWQsXG4gICAgICBvcElkLFxuICAgICAgcGFyZW50SWQsXG4gICAgICBwYXJlbnRLZXksXG4gICAgICBkYXRhOiB7fVxuICAgIH07XG4gICAgb3BzLnB1c2gob3ApO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIG9wcy5wdXNoKC4uLnZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5LCBwb29sKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcC5kYXRhW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9wcztcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBfZGVzZXJpYWxpemUoW2lkLCBpdGVtXSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCkge1xuICAgIGNvbnN0IGxpdmVPYmogPSBuZXcgX0xpdmVPYmplY3QoaXRlbS5kYXRhKTtcbiAgICBsaXZlT2JqLl9hdHRhY2goaWQsIHBvb2wpO1xuICAgIHJldHVybiB0aGlzLl9kZXNlcmlhbGl6ZUNoaWxkcmVuKGxpdmVPYmosIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIF9kZXNlcmlhbGl6ZUNoaWxkcmVuKGxpdmVPYmosIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpIHtcbiAgICBjb25zdCBjaGlsZHJlbiA9IHBhcmVudFRvQ2hpbGRyZW4uZ2V0KG5uKGxpdmVPYmouX2lkKSk7XG4gICAgaWYgKGNoaWxkcmVuID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBsaXZlT2JqO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtpZCwgY3JkdF0gb2YgY2hpbGRyZW4pIHtcbiAgICAgIGNvbnN0IGNoaWxkID0gZGVzZXJpYWxpemVUb0xzb24oW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgICBpZiAoaXNMaXZlU3RydWN0dXJlKGNoaWxkKSkge1xuICAgICAgICBjaGlsZC5fc2V0UGFyZW50TGluayhsaXZlT2JqLCBjcmR0LnBhcmVudEtleSk7XG4gICAgICB9XG4gICAgICBsaXZlT2JqLl9tYXAuc2V0KGNyZHQucGFyZW50S2V5LCBjaGlsZCk7XG4gICAgICBsaXZlT2JqLmludmFsaWRhdGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIGxpdmVPYmo7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXR0YWNoKGlkLCBwb29sKSB7XG4gICAgc3VwZXIuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgZm9yIChjb25zdCBbX2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9hdHRhY2gocG9vbC5nZW5lcmF0ZUlkKCksIHBvb2wpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2hDaGlsZChvcCwgc291cmNlKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3QgeyBpZCwgb3BJZCwgcGFyZW50S2V5OiBrZXkgfSA9IG9wO1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTHNvbihvcCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wuZ2V0Tm9kZShpZCkgIT09IHZvaWQgMCkge1xuICAgICAgaWYgKHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZ2V0KGtleSkgPT09IG9wSWQpIHtcbiAgICAgICAgdGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBpZiAoc291cmNlID09PSAwIC8qIFVORE9SRURPX1JFQ09OTkVDVCAqLykge1xuICAgICAgdGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5zZXQoa2V5LCBubihvcElkKSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpID09PSB2b2lkIDApIHtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZ2V0KGtleSkgPT09IG9wSWQpIHtcbiAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZGVsZXRlKGtleSk7XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGNvbnN0IHRoaXNJZCA9IG5uKHRoaXMuX2lkKTtcbiAgICBjb25zdCBwcmV2aW91c1ZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGxldCByZXZlcnNlO1xuICAgIGlmIChpc0xpdmVOb2RlKHByZXZpb3VzVmFsdWUpKSB7XG4gICAgICByZXZlcnNlID0gcHJldmlvdXNWYWx1ZS5fdG9PcHModGhpc0lkLCBrZXkpO1xuICAgICAgcHJldmlvdXNWYWx1ZS5fZGV0YWNoKCk7XG4gICAgfSBlbHNlIGlmIChwcmV2aW91c1ZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgIHJldmVyc2UgPSBbeyB0eXBlOiA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovLCBpZDogdGhpc0lkLCBrZXkgfV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldmVyc2UgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICAgICAgaWQ6IHRoaXNJZCxcbiAgICAgICAgICBkYXRhOiB7IFtrZXldOiBwcmV2aW91c1ZhbHVlIH1cbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gICAgdGhpcy5fbWFwLnNldChrZXksIGNoaWxkKTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICBpZiAoaXNMaXZlU3RydWN0dXJlKGNoaWxkKSkge1xuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICAgIGNoaWxkLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgcmV2ZXJzZSxcbiAgICAgIG1vZGlmaWVkOiB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB7IFtrZXldOiB7IHR5cGU6IFwidXBkYXRlXCIgfSB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2hDaGlsZChjaGlsZCkge1xuICAgIGlmIChjaGlsZCkge1xuICAgICAgY29uc3QgaWQgPSBubih0aGlzLl9pZCk7XG4gICAgICBjb25zdCBwYXJlbnRLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICAgIGNvbnN0IHJldmVyc2UgPSBjaGlsZC5fdG9PcHMoaWQsIHBhcmVudEtleSwgdGhpcy5fcG9vbCk7XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSBjaGlsZCkge1xuICAgICAgICAgIHRoaXMuX21hcC5kZWxldGUoa2V5KTtcbiAgICAgICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2hpbGQuX2RldGFjaCgpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZSA9IHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlT2JqZWN0XCIsXG4gICAgICAgIHVwZGF0ZXM6IHtcbiAgICAgICAgICBbcGFyZW50S2V5XTogeyB0eXBlOiBcImRlbGV0ZVwiIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBzdG9yYWdlVXBkYXRlLCByZXZlcnNlIH07XG4gICAgfVxuICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9kZXRhY2goKSB7XG4gICAgc3VwZXIuX2RldGFjaCgpO1xuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdGhpcy5fbWFwLnZhbHVlcygpKSB7XG4gICAgICBpZiAoaXNMaXZlTm9kZSh2YWx1ZSkpIHtcbiAgICAgICAgdmFsdWUuX2RldGFjaCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseShvcCwgaXNMb2NhbCkge1xuICAgIGlmIChvcC50eXBlID09PSAzIC8qIFVQREFURV9PQkpFQ1QgKi8pIHtcbiAgICAgIHJldHVybiB0aGlzLl9hcHBseVVwZGF0ZShvcCwgaXNMb2NhbCk7XG4gICAgfSBlbHNlIGlmIChvcC50eXBlID09PSA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXBwbHlEZWxldGVPYmplY3RLZXkob3AsIGlzTG9jYWwpO1xuICAgIH1cbiAgICByZXR1cm4gc3VwZXIuX2FwcGx5KG9wLCBpc0xvY2FsKTtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfc2VyaWFsaXplKCkge1xuICAgIGNvbnN0IGRhdGEgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmICghaXNMaXZlTm9kZSh2YWx1ZSkpIHtcbiAgICAgICAgZGF0YVtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiICYmIHRoaXMucGFyZW50Lm5vZGUuX2lkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAwIC8qIE9CSkVDVCAqLyxcbiAgICAgICAgcGFyZW50SWQ6IHRoaXMucGFyZW50Lm5vZGUuX2lkLFxuICAgICAgICBwYXJlbnRLZXk6IHRoaXMucGFyZW50LmtleSxcbiAgICAgICAgZGF0YVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogMCAvKiBPQkpFQ1QgKi8sXG4gICAgICAgIGRhdGFcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5VXBkYXRlKG9wLCBpc0xvY2FsKSB7XG4gICAgbGV0IGlzTW9kaWZpZWQgPSBmYWxzZTtcbiAgICBjb25zdCBpZCA9IG5uKHRoaXMuX2lkKTtcbiAgICBjb25zdCByZXZlcnNlID0gW107XG4gICAgY29uc3QgcmV2ZXJzZVVwZGF0ZSA9IHtcbiAgICAgIHR5cGU6IDMgLyogVVBEQVRFX09CSkVDVCAqLyxcbiAgICAgIGlkLFxuICAgICAgZGF0YToge31cbiAgICB9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9wLmRhdGEpIHtcbiAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgICAgaWYgKGlzTGl2ZU5vZGUob2xkVmFsdWUpKSB7XG4gICAgICAgIHJldmVyc2UucHVzaCguLi5vbGRWYWx1ZS5fdG9PcHMoaWQsIGtleSkpO1xuICAgICAgICBvbGRWYWx1ZS5fZGV0YWNoKCk7XG4gICAgICB9IGVsc2UgaWYgKG9sZFZhbHVlICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV2ZXJzZVVwZGF0ZS5kYXRhW2tleV0gPSBvbGRWYWx1ZTtcbiAgICAgIH0gZWxzZSBpZiAob2xkVmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgICByZXZlcnNlLnB1c2goeyB0eXBlOiA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovLCBpZCwga2V5IH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB1cGRhdGVEZWx0YSA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9wLmRhdGEpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gb3AuZGF0YVtrZXldO1xuICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoaXNMb2NhbCkge1xuICAgICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLnNldChrZXksIG5uKG9wLm9wSWQpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5nZXQoa2V5KSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGlzTW9kaWZpZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpID09PSBvcC5vcElkKSB7XG4gICAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZGVsZXRlKGtleSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgICBvbGRWYWx1ZS5fZGV0YWNoKCk7XG4gICAgICB9XG4gICAgICBpc01vZGlmaWVkID0gdHJ1ZTtcbiAgICAgIHVwZGF0ZURlbHRhW2tleV0gPSB7IHR5cGU6IFwidXBkYXRlXCIgfTtcbiAgICAgIHRoaXMuX21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICB9XG4gICAgaWYgKE9iamVjdC5rZXlzKHJldmVyc2VVcGRhdGUuZGF0YSkubGVuZ3RoICE9PSAwKSB7XG4gICAgICByZXZlcnNlLnVuc2hpZnQocmV2ZXJzZVVwZGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiBpc01vZGlmaWVkID8ge1xuICAgICAgbW9kaWZpZWQ6IHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlT2JqZWN0XCIsXG4gICAgICAgIHVwZGF0ZXM6IHVwZGF0ZURlbHRhXG4gICAgICB9LFxuICAgICAgcmV2ZXJzZVxuICAgIH0gOiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5RGVsZXRlT2JqZWN0S2V5KG9wLCBpc0xvY2FsKSB7XG4gICAgY29uc3Qga2V5ID0gb3Aua2V5O1xuICAgIGlmICh0aGlzLl9tYXAuaGFzKGtleSkgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgaWYgKCFpc0xvY2FsICYmIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZ2V0KGtleSkgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGNvbnN0IGlkID0gbm4odGhpcy5faWQpO1xuICAgIGxldCByZXZlcnNlID0gW107XG4gICAgaWYgKGlzTGl2ZU5vZGUob2xkVmFsdWUpKSB7XG4gICAgICByZXZlcnNlID0gb2xkVmFsdWUuX3RvT3BzKGlkLCBvcC5rZXkpO1xuICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgIH0gZWxzZSBpZiAob2xkVmFsdWUgIT09IHZvaWQgMCkge1xuICAgICAgcmV2ZXJzZSA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IDMgLyogVVBEQVRFX09CSkVDVCAqLyxcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBkYXRhOiB7IFtrZXldOiBvbGRWYWx1ZSB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICAgIHRoaXMuX21hcC5kZWxldGUoa2V5KTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlT2JqZWN0XCIsXG4gICAgICAgIHVwZGF0ZXM6IHsgW29wLmtleV06IHsgdHlwZTogXCJkZWxldGVcIiB9IH1cbiAgICAgIH0sXG4gICAgICByZXZlcnNlXG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogVHJhbnNmb3JtIHRoZSBMaXZlT2JqZWN0IGludG8gYSBqYXZhc2NyaXB0IG9iamVjdFxuICAgKi9cbiAgdG9PYmplY3QoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyh0aGlzLl9tYXApO1xuICB9XG4gIC8qKlxuICAgKiBBZGRzIG9yIHVwZGF0ZXMgYSBwcm9wZXJ0eSB3aXRoIGEgc3BlY2lmaWVkIGtleSBhbmQgYSB2YWx1ZS5cbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBhZGRcbiAgICogQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgdG8gYWRkXG4gICAqL1xuICBzZXQoa2V5LCB2YWx1ZSkge1xuICAgIHRoaXMuX3Bvb2w/LmFzc2VydFN0b3JhZ2VJc1dyaXRhYmxlKCk7XG4gICAgdGhpcy51cGRhdGUoeyBba2V5XTogdmFsdWUgfSk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzcGVjaWZpZWQgcHJvcGVydHkgZnJvbSB0aGUgTGl2ZU9iamVjdC5cbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBnZXRcbiAgICovXG4gIGdldChrZXkpIHtcbiAgICByZXR1cm4gdGhpcy5fbWFwLmdldChrZXkpO1xuICB9XG4gIC8qKlxuICAgKiBEZWxldGVzIGEga2V5IGZyb20gdGhlIExpdmVPYmplY3RcbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBkZWxldGVcbiAgICovXG4gIGRlbGV0ZShrZXkpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGNvbnN0IGtleUFzU3RyaW5nID0ga2V5O1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5fbWFwLmdldChrZXlBc1N0cmluZyk7XG4gICAgaWYgKG9sZFZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCB8fCB0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICBpZiAoaXNMaXZlTm9kZShvbGRWYWx1ZSkpIHtcbiAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5fbWFwLmRlbGV0ZShrZXlBc1N0cmluZyk7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHJldmVyc2U7XG4gICAgaWYgKGlzTGl2ZU5vZGUob2xkVmFsdWUpKSB7XG4gICAgICBvbGRWYWx1ZS5fZGV0YWNoKCk7XG4gICAgICByZXZlcnNlID0gb2xkVmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBrZXlBc1N0cmluZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldmVyc2UgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICAgICAgZGF0YTogeyBba2V5QXNTdHJpbmddOiBvbGRWYWx1ZSB9LFxuICAgICAgICAgIGlkOiB0aGlzLl9pZFxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgICB0aGlzLl9tYXAuZGVsZXRlKGtleUFzU3RyaW5nKTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXMuX2lkLCB7XG4gICAgICBub2RlOiB0aGlzLFxuICAgICAgdHlwZTogXCJMaXZlT2JqZWN0XCIsXG4gICAgICB1cGRhdGVzOiB7IFtrZXldOiB7IHR5cGU6IFwiZGVsZXRlXCIgfSB9XG4gICAgfSk7XG4gICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgIFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IDYgLyogREVMRVRFX09CSkVDVF9LRVkgKi8sXG4gICAgICAgICAga2V5OiBrZXlBc1N0cmluZyxcbiAgICAgICAgICBpZDogdGhpcy5faWQsXG4gICAgICAgICAgb3BJZDogdGhpcy5fcG9vbC5nZW5lcmF0ZU9wSWQoKVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgcmV2ZXJzZSxcbiAgICAgIHN0b3JhZ2VVcGRhdGVzXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogQWRkcyBvciB1cGRhdGVzIG11bHRpcGxlIHByb3BlcnRpZXMgYXQgb25jZSB3aXRoIGFuIG9iamVjdC5cbiAgICogQHBhcmFtIHBhdGNoIFRoZSBvYmplY3QgdXNlZCB0byBvdmVycmlkZXMgcHJvcGVydGllc1xuICAgKi9cbiAgdXBkYXRlKHBhdGNoKSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCA9PT0gdm9pZCAwIHx8IHRoaXMuX2lkID09PSB2b2lkIDApIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIHBhdGNoKSB7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGF0Y2hba2V5XTtcbiAgICAgICAgaWYgKG5ld1ZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICAgICAgaWYgKGlzTGl2ZU5vZGUob2xkVmFsdWUpKSB7XG4gICAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0xpdmVOb2RlKG5ld1ZhbHVlKSkge1xuICAgICAgICAgIG5ld1ZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbWFwLnNldChrZXksIG5ld1ZhbHVlKTtcbiAgICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG9wcyA9IFtdO1xuICAgIGNvbnN0IHJldmVyc2VPcHMgPSBbXTtcbiAgICBjb25zdCBvcElkID0gdGhpcy5fcG9vbC5nZW5lcmF0ZU9wSWQoKTtcbiAgICBjb25zdCB1cGRhdGVkUHJvcHMgPSB7fTtcbiAgICBjb25zdCByZXZlcnNlVXBkYXRlT3AgPSB7XG4gICAgICBpZDogdGhpcy5faWQsXG4gICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICBkYXRhOiB7fVxuICAgIH07XG4gICAgY29uc3QgdXBkYXRlRGVsdGEgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRjaCkge1xuICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXRjaFtrZXldO1xuICAgICAgaWYgKG5ld1ZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgICByZXZlcnNlT3BzLnB1c2goLi4ub2xkVmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBrZXkpKTtcbiAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgfSBlbHNlIGlmIChvbGRWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldmVyc2VPcHMucHVzaCh7IHR5cGU6IDYgLyogREVMRVRFX09CSkVDVF9LRVkgKi8sIGlkOiB0aGlzLl9pZCwga2V5IH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV2ZXJzZVVwZGF0ZU9wLmRhdGFba2V5XSA9IG9sZFZhbHVlO1xuICAgICAgfVxuICAgICAgaWYgKGlzTGl2ZU5vZGUobmV3VmFsdWUpKSB7XG4gICAgICAgIG5ld1ZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICAgIG5ld1ZhbHVlLl9hdHRhY2godGhpcy5fcG9vbC5nZW5lcmF0ZUlkKCksIHRoaXMuX3Bvb2wpO1xuICAgICAgICBjb25zdCBuZXdBdHRhY2hDaGlsZE9wcyA9IG5ld1ZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5LCB0aGlzLl9wb29sKTtcbiAgICAgICAgY29uc3QgY3JlYXRlQ3JkdE9wID0gbmV3QXR0YWNoQ2hpbGRPcHMuZmluZChcbiAgICAgICAgICAob3ApID0+IG9wLnBhcmVudElkID09PSB0aGlzLl9pZFxuICAgICAgICApO1xuICAgICAgICBpZiAoY3JlYXRlQ3JkdE9wKSB7XG4gICAgICAgICAgdGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5zZXQoa2V5LCBubihjcmVhdGVDcmR0T3Aub3BJZCkpO1xuICAgICAgICB9XG4gICAgICAgIG9wcy5wdXNoKC4uLm5ld0F0dGFjaENoaWxkT3BzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVwZGF0ZWRQcm9wc1trZXldID0gbmV3VmFsdWU7XG4gICAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuc2V0KGtleSwgb3BJZCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9tYXAuc2V0KGtleSwgbmV3VmFsdWUpO1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgICB1cGRhdGVEZWx0YVtrZXldID0geyB0eXBlOiBcInVwZGF0ZVwiIH07XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyhyZXZlcnNlVXBkYXRlT3AuZGF0YSkubGVuZ3RoICE9PSAwKSB7XG4gICAgICByZXZlcnNlT3BzLnVuc2hpZnQocmV2ZXJzZVVwZGF0ZU9wKTtcbiAgICB9XG4gICAgaWYgKE9iamVjdC5rZXlzKHVwZGF0ZWRQcm9wcykubGVuZ3RoICE9PSAwKSB7XG4gICAgICBvcHMudW5zaGlmdCh7XG4gICAgICAgIG9wSWQsXG4gICAgICAgIGlkOiB0aGlzLl9pZCxcbiAgICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgICBkYXRhOiB1cGRhdGVkUHJvcHNcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXMuX2lkLCB7XG4gICAgICBub2RlOiB0aGlzLFxuICAgICAgdHlwZTogXCJMaXZlT2JqZWN0XCIsXG4gICAgICB1cGRhdGVzOiB1cGRhdGVEZWx0YVxuICAgIH0pO1xuICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2gob3BzLCByZXZlcnNlT3BzLCBzdG9yYWdlVXBkYXRlcyk7XG4gIH1cbiAgdG9JbW11dGFibGUoKSB7XG4gICAgcmV0dXJuIHN1cGVyLnRvSW1tdXRhYmxlKCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICB0b1RyZWVOb2RlKGtleSkge1xuICAgIHJldHVybiBzdXBlci50b1RyZWVOb2RlKGtleSk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9UcmVlTm9kZShrZXkpIHtcbiAgICBjb25zdCBub2RlSWQgPSB0aGlzLl9pZCA/PyBuYW5vaWQoKTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJMaXZlT2JqZWN0XCIsXG4gICAgICBpZDogbm9kZUlkLFxuICAgICAga2V5LFxuICAgICAgcGF5bG9hZDogQXJyYXkuZnJvbSh0aGlzLl9tYXAuZW50cmllcygpKS5tYXAoXG4gICAgICAgIChba2V5MiwgdmFsdWVdKSA9PiBpc0xpdmVOb2RlKHZhbHVlKSA/IHZhbHVlLnRvVHJlZU5vZGUoa2V5MikgOiB7IHR5cGU6IFwiSnNvblwiLCBpZDogYCR7bm9kZUlkfToke2tleTJ9YCwga2V5OiBrZXkyLCBwYXlsb2FkOiB2YWx1ZSB9XG4gICAgICApXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICByZXN1bHRba2V5XSA9IGlzTGl2ZVN0cnVjdHVyZSh2YWwpID8gdmFsLnRvSW1tdXRhYmxlKCkgOiB2YWw7XG4gICAgfVxuICAgIHJldHVybiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgPyByZXN1bHQgOiBPYmplY3QuZnJlZXplKHJlc3VsdCk7XG4gIH1cbiAgY2xvbmUoKSB7XG4gICAgcmV0dXJuIG5ldyBfTGl2ZU9iamVjdChcbiAgICAgIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgQXJyYXkuZnJvbSh0aGlzLl9tYXApLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBbXG4gICAgICAgICAga2V5LFxuICAgICAgICAgIGlzTGl2ZVN0cnVjdHVyZSh2YWx1ZSkgPyB2YWx1ZS5jbG9uZSgpIDogZGVlcENsb25lKHZhbHVlKVxuICAgICAgICBdKVxuICAgICAgKVxuICAgICk7XG4gIH1cbn07XG5cbi8vIHNyYy9jcmR0cy9saXZlYmxvY2tzLWhlbHBlcnMudHNcbmZ1bmN0aW9uIGNyZWF0aW9uT3BUb0xpdmVOb2RlKG9wKSB7XG4gIHJldHVybiBsc29uVG9MaXZlTm9kZShjcmVhdGlvbk9wVG9Mc29uKG9wKSk7XG59XG5mdW5jdGlvbiBjcmVhdGlvbk9wVG9Mc29uKG9wKSB7XG4gIHN3aXRjaCAob3AudHlwZSkge1xuICAgIGNhc2UgOCAvKiBDUkVBVEVfUkVHSVNURVIgKi86XG4gICAgICByZXR1cm4gb3AuZGF0YTtcbiAgICBjYXNlIDQgLyogQ1JFQVRFX09CSkVDVCAqLzpcbiAgICAgIHJldHVybiBuZXcgTGl2ZU9iamVjdChvcC5kYXRhKTtcbiAgICBjYXNlIDcgLyogQ1JFQVRFX01BUCAqLzpcbiAgICAgIHJldHVybiBuZXcgTGl2ZU1hcCgpO1xuICAgIGNhc2UgMiAvKiBDUkVBVEVfTElTVCAqLzpcbiAgICAgIHJldHVybiBuZXcgTGl2ZUxpc3QoW10pO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIob3AsIFwiVW5rbm93biBjcmVhdGlvbiBPcFwiKTtcbiAgfVxufVxuZnVuY3Rpb24gaXNTYW1lTm9kZU9yQ2hpbGRPZihub2RlLCBwYXJlbnQpIHtcbiAgaWYgKG5vZGUgPT09IHBhcmVudCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChub2RlLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgcmV0dXJuIGlzU2FtZU5vZGVPckNoaWxkT2Yobm9kZS5wYXJlbnQubm9kZSwgcGFyZW50KTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5mdW5jdGlvbiBkZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gIHN3aXRjaCAoY3JkdC50eXBlKSB7XG4gICAgY2FzZSAwIC8qIE9CSkVDVCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVPYmplY3QuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDEgLyogTElTVCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVMaXN0Ll9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAyIC8qIE1BUCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVNYXAuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDMgLyogUkVHSVNURVIgKi86IHtcbiAgICAgIHJldHVybiBMaXZlUmVnaXN0ZXIuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmV4cGVjdGVkIENSRFQgdHlwZVwiKTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGRlc2VyaWFsaXplVG9Mc29uKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpIHtcbiAgc3dpdGNoIChjcmR0LnR5cGUpIHtcbiAgICBjYXNlIDAgLyogT0JKRUNUICovOiB7XG4gICAgICByZXR1cm4gTGl2ZU9iamVjdC5fZGVzZXJpYWxpemUoW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgfVxuICAgIGNhc2UgMSAvKiBMSVNUICovOiB7XG4gICAgICByZXR1cm4gTGl2ZUxpc3QuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDIgLyogTUFQICovOiB7XG4gICAgICByZXR1cm4gTGl2ZU1hcC5fZGVzZXJpYWxpemUoW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgfVxuICAgIGNhc2UgMyAvKiBSRUdJU1RFUiAqLzoge1xuICAgICAgcmV0dXJuIGNyZHQuZGF0YTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBDUkRUIHR5cGVcIik7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBpc0xpdmVTdHJ1Y3R1cmUodmFsdWUpIHtcbiAgcmV0dXJuIGlzTGl2ZUxpc3QodmFsdWUpIHx8IGlzTGl2ZU1hcCh2YWx1ZSkgfHwgaXNMaXZlT2JqZWN0KHZhbHVlKTtcbn1cbmZ1bmN0aW9uIGlzTGl2ZU5vZGUodmFsdWUpIHtcbiAgcmV0dXJuIGlzTGl2ZVN0cnVjdHVyZSh2YWx1ZSkgfHwgaXNMaXZlUmVnaXN0ZXIodmFsdWUpO1xufVxuZnVuY3Rpb24gaXNMaXZlTGlzdCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBMaXZlTGlzdDtcbn1cbmZ1bmN0aW9uIGlzTGl2ZU1hcCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBMaXZlTWFwO1xufVxuZnVuY3Rpb24gaXNMaXZlT2JqZWN0KHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIExpdmVPYmplY3Q7XG59XG5mdW5jdGlvbiBpc0xpdmVSZWdpc3Rlcih2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXI7XG59XG5mdW5jdGlvbiBjbG9uZUxzb24odmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpc0xpdmVTdHJ1Y3R1cmUodmFsdWUpID8gdmFsdWUuY2xvbmUoKSA6IGRlZXBDbG9uZSh2YWx1ZSk7XG59XG5mdW5jdGlvbiBsaXZlTm9kZVRvTHNvbihvYmopIHtcbiAgaWYgKG9iaiBpbnN0YW5jZW9mIExpdmVSZWdpc3Rlcikge1xuICAgIHJldHVybiBvYmouZGF0YTtcbiAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBMaXZlTGlzdCB8fCBvYmogaW5zdGFuY2VvZiBMaXZlTWFwIHx8IG9iaiBpbnN0YW5jZW9mIExpdmVPYmplY3QpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhc3NlcnROZXZlcihvYmosIFwiVW5rbm93biBBYnN0cmFjdENyZHRcIik7XG4gIH1cbn1cbmZ1bmN0aW9uIGxzb25Ub0xpdmVOb2RlKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdmVPYmplY3QgfHwgdmFsdWUgaW5zdGFuY2VvZiBMaXZlTWFwIHx8IHZhbHVlIGluc3RhbmNlb2YgTGl2ZUxpc3QpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG5ldyBMaXZlUmVnaXN0ZXIodmFsdWUpO1xuICB9XG59XG5mdW5jdGlvbiBnZXRUcmVlc0RpZmZPcGVyYXRpb25zKGN1cnJlbnRJdGVtcywgbmV3SXRlbXMpIHtcbiAgY29uc3Qgb3BzID0gW107XG4gIGN1cnJlbnRJdGVtcy5mb3JFYWNoKChfLCBpZCkgPT4ge1xuICAgIGlmICghbmV3SXRlbXMuZ2V0KGlkKSkge1xuICAgICAgb3BzLnB1c2goe1xuICAgICAgICB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovLFxuICAgICAgICBpZFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgbmV3SXRlbXMuZm9yRWFjaCgoY3JkdCwgaWQpID0+IHtcbiAgICBjb25zdCBjdXJyZW50Q3JkdCA9IGN1cnJlbnRJdGVtcy5nZXQoaWQpO1xuICAgIGlmIChjdXJyZW50Q3JkdCkge1xuICAgICAgaWYgKGNyZHQudHlwZSA9PT0gMCAvKiBPQkpFQ1QgKi8pIHtcbiAgICAgICAgaWYgKGN1cnJlbnRDcmR0LnR5cGUgIT09IDAgLyogT0JKRUNUICovIHx8IEpTT04uc3RyaW5naWZ5KGNyZHQuZGF0YSkgIT09IEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDcmR0LmRhdGEpKSB7XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBkYXRhOiBjcmR0LmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGNyZHQucGFyZW50S2V5ICE9PSBjdXJyZW50Q3JkdC5wYXJlbnRLZXkpIHtcbiAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgIHR5cGU6IDEgLyogU0VUX1BBUkVOVF9LRVkgKi8sXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgcGFyZW50S2V5OiBubihjcmR0LnBhcmVudEtleSwgXCJQYXJlbnQga2V5IG11c3Qgbm90IGJlIG1pc3NpbmdcIilcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN3aXRjaCAoY3JkdC50eXBlKSB7XG4gICAgICAgIGNhc2UgMyAvKiBSRUdJU1RFUiAqLzpcbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiA4IC8qIENSRUFURV9SRUdJU1RFUiAqLyxcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgcGFyZW50SWQ6IGNyZHQucGFyZW50SWQsXG4gICAgICAgICAgICBwYXJlbnRLZXk6IGNyZHQucGFyZW50S2V5LFxuICAgICAgICAgICAgZGF0YTogY3JkdC5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMSAvKiBMSVNUICovOlxuICAgICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6IDIgLyogQ1JFQVRFX0xJU1QgKi8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHBhcmVudElkOiBjcmR0LnBhcmVudElkLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBjcmR0LnBhcmVudEtleVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDAgLyogT0JKRUNUICovOlxuICAgICAgICAgIGlmIChjcmR0LnBhcmVudElkID09PSB2b2lkIDAgfHwgY3JkdC5wYXJlbnRLZXkgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICBcIkludGVybmFsIGVycm9yLiBDYW5ub3Qgc2VyaWFsaXplIHN0b3JhZ2Ugcm9vdCBpbnRvIGFuIG9wZXJhdGlvblwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiA0IC8qIENSRUFURV9PQkpFQ1QgKi8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHBhcmVudElkOiBjcmR0LnBhcmVudElkLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBjcmR0LnBhcmVudEtleSxcbiAgICAgICAgICAgIGRhdGE6IGNyZHQuZGF0YVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDIgLyogTUFQICovOlxuICAgICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6IDcgLyogQ1JFQVRFX01BUCAqLyxcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgcGFyZW50SWQ6IGNyZHQucGFyZW50SWQsXG4gICAgICAgICAgICBwYXJlbnRLZXk6IGNyZHQucGFyZW50S2V5XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG9wcztcbn1cbmZ1bmN0aW9uIG1lcmdlT2JqZWN0U3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCkge1xuICBjb25zdCB1cGRhdGVzID0gZmlyc3QudXBkYXRlcztcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZW50cmllcyhzZWNvbmQudXBkYXRlcykpIHtcbiAgICB1cGRhdGVzW2tleV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4ge1xuICAgIC4uLnNlY29uZCxcbiAgICB1cGRhdGVzXG4gIH07XG59XG5mdW5jdGlvbiBtZXJnZU1hcFN0b3JhZ2VVcGRhdGVzKGZpcnN0LCBzZWNvbmQpIHtcbiAgY29uc3QgdXBkYXRlcyA9IGZpcnN0LnVwZGF0ZXM7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMoc2Vjb25kLnVwZGF0ZXMpKSB7XG4gICAgdXBkYXRlc1trZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5zZWNvbmQsXG4gICAgdXBkYXRlc1xuICB9O1xufVxuZnVuY3Rpb24gbWVyZ2VMaXN0U3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCkge1xuICBjb25zdCB1cGRhdGVzID0gZmlyc3QudXBkYXRlcztcbiAgcmV0dXJuIHtcbiAgICAuLi5zZWNvbmQsXG4gICAgdXBkYXRlczogdXBkYXRlcy5jb25jYXQoc2Vjb25kLnVwZGF0ZXMpXG4gIH07XG59XG5mdW5jdGlvbiBtZXJnZVN0b3JhZ2VVcGRhdGVzKGZpcnN0LCBzZWNvbmQpIHtcbiAgaWYgKGZpcnN0ID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gc2Vjb25kO1xuICB9XG4gIGlmIChmaXJzdC50eXBlID09PSBcIkxpdmVPYmplY3RcIiAmJiBzZWNvbmQudHlwZSA9PT0gXCJMaXZlT2JqZWN0XCIpIHtcbiAgICByZXR1cm4gbWVyZ2VPYmplY3RTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKTtcbiAgfSBlbHNlIGlmIChmaXJzdC50eXBlID09PSBcIkxpdmVNYXBcIiAmJiBzZWNvbmQudHlwZSA9PT0gXCJMaXZlTWFwXCIpIHtcbiAgICByZXR1cm4gbWVyZ2VNYXBTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKTtcbiAgfSBlbHNlIGlmIChmaXJzdC50eXBlID09PSBcIkxpdmVMaXN0XCIgJiYgc2Vjb25kLnR5cGUgPT09IFwiTGl2ZUxpc3RcIikge1xuICAgIHJldHVybiBtZXJnZUxpc3RTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKTtcbiAgfSBlbHNlIHtcbiAgfVxuICByZXR1cm4gc2Vjb25kO1xufVxuZnVuY3Rpb24gaXNQbGFpbih2YWx1ZSkge1xuICBjb25zdCB0eXBlID0gdHlwZW9mIHZhbHVlO1xuICByZXR1cm4gdmFsdWUgPT09IHZvaWQgMCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlID09PSBcInN0cmluZ1wiIHx8IHR5cGUgPT09IFwiYm9vbGVhblwiIHx8IHR5cGUgPT09IFwibnVtYmVyXCIgfHwgQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgaXNQbGFpbk9iamVjdCh2YWx1ZSk7XG59XG5mdW5jdGlvbiBmaW5kTm9uU2VyaWFsaXphYmxlVmFsdWUodmFsdWUsIHBhdGggPSBcIlwiKSB7XG4gIGlmICghaXNQbGFpbikge1xuICAgIHJldHVybiB7XG4gICAgICBwYXRoOiBwYXRoIHx8IFwicm9vdFwiLFxuICAgICAgdmFsdWVcbiAgICB9O1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChjb25zdCBba2V5LCBuZXN0ZWRWYWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModmFsdWUpKSB7XG4gICAgY29uc3QgbmVzdGVkUGF0aCA9IHBhdGggPyBwYXRoICsgXCIuXCIgKyBrZXkgOiBrZXk7XG4gICAgaWYgKCFpc1BsYWluKG5lc3RlZFZhbHVlKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGF0aDogbmVzdGVkUGF0aCxcbiAgICAgICAgdmFsdWU6IG5lc3RlZFZhbHVlXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG5lc3RlZFZhbHVlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBjb25zdCBub25TZXJpYWxpemFibGVOZXN0ZWRWYWx1ZSA9IGZpbmROb25TZXJpYWxpemFibGVWYWx1ZShcbiAgICAgICAgbmVzdGVkVmFsdWUsXG4gICAgICAgIG5lc3RlZFBhdGhcbiAgICAgICk7XG4gICAgICBpZiAobm9uU2VyaWFsaXphYmxlTmVzdGVkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5vblNlcmlhbGl6YWJsZU5lc3RlZFZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbi8vIHNyYy9saWIvY3JlYXRlSWRzLnRzXG52YXIgVEhSRUFEX0lEX1BSRUZJWCA9IFwidGhcIjtcbnZhciBDT01NRU5UX0lEX1BSRUZJWCA9IFwiY21cIjtcbnZhciBJTkJPWF9OT1RJRklDQVRJT05fSURfUFJFRklYID0gXCJpblwiO1xuZnVuY3Rpb24gY3JlYXRlT3B0aW1pc3RpY0lkKHByZWZpeCkge1xuICByZXR1cm4gYCR7cHJlZml4fV8ke25hbm9pZCgpfWA7XG59XG5mdW5jdGlvbiBjcmVhdGVUaHJlYWRJZCgpIHtcbiAgcmV0dXJuIGNyZWF0ZU9wdGltaXN0aWNJZChUSFJFQURfSURfUFJFRklYKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnRJZCgpIHtcbiAgcmV0dXJuIGNyZWF0ZU9wdGltaXN0aWNJZChDT01NRU5UX0lEX1BSRUZJWCk7XG59XG5mdW5jdGlvbiBjcmVhdGVJbmJveE5vdGlmaWNhdGlvbklkKCkge1xuICByZXR1cm4gY3JlYXRlT3B0aW1pc3RpY0lkKElOQk9YX05PVElGSUNBVElPTl9JRF9QUkVGSVgpO1xufVxuXG4vLyBzcmMvbGliL2RlYnVnLnRzXG5mdW5jdGlvbiBjYXB0dXJlU3RhY2tUcmFjZShtc2csIHRyYWNlUm9vdCkge1xuICBjb25zdCBlcnJvckxpa2UgPSB7IG5hbWU6IG1zZyB9O1xuICBpZiAodHlwZW9mIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKGVycm9yTGlrZSwgdHJhY2VSb290KTtcbiAgcmV0dXJuIGVycm9yTGlrZS5zdGFjaztcbn1cblxuLy8gc3JjL2xpYi9Kc29uLnRzXG5mdW5jdGlvbiBpc0pzb25TY2FsYXIoZGF0YSkge1xuICByZXR1cm4gZGF0YSA9PT0gbnVsbCB8fCB0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgZGF0YSA9PT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgZGF0YSA9PT0gXCJib29sZWFuXCI7XG59XG5mdW5jdGlvbiBpc0pzb25BcnJheShkYXRhKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KGRhdGEpO1xufVxuZnVuY3Rpb24gaXNKc29uT2JqZWN0KGRhdGEpIHtcbiAgcmV0dXJuICFpc0pzb25TY2FsYXIoZGF0YSkgJiYgIWlzSnNvbkFycmF5KGRhdGEpO1xufVxuXG4vLyBzcmMvbGliL29iamVjdFRvUXVlcnkudHNcbnZhciBpZGVudGlmaWVyUmVnZXggPSAvXlthLXpBLVpfXVthLXpBLVowLTlfXSokLztcbmZ1bmN0aW9uIG9iamVjdFRvUXVlcnkob2JqKSB7XG4gIGxldCBmaWx0ZXJMaXN0ID0gW107XG4gIGNvbnN0IGVudHJpZXMyID0gT2JqZWN0LmVudHJpZXMob2JqKTtcbiAgY29uc3Qga2V5VmFsdWVQYWlycyA9IFtdO1xuICBjb25zdCBrZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yID0gW107XG4gIGNvbnN0IGluZGV4ZWRLZXlzID0gW107XG4gIGVudHJpZXMyLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGlmICghaWRlbnRpZmllclJlZ2V4LnRlc3Qoa2V5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiS2V5IG11c3Qgb25seSBjb250YWluIGxldHRlcnMsIG51bWJlcnMsIF9cIik7XG4gICAgfVxuICAgIGlmIChpc1NpbXBsZVZhbHVlKHZhbHVlKSkge1xuICAgICAga2V5VmFsdWVQYWlycy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfSBlbHNlIGlmIChpc1ZhbHVlV2l0aE9wZXJhdG9yKHZhbHVlKSkge1xuICAgICAga2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvci5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgIShcInN0YXJ0c1dpdGhcIiBpbiB2YWx1ZSkpIHtcbiAgICAgIGluZGV4ZWRLZXlzLnB1c2goW2tleSwgdmFsdWVdKTtcbiAgICB9XG4gIH0pO1xuICBmaWx0ZXJMaXN0ID0gW1xuICAgIC4uLmdldEZpbHRlcnNGcm9tS2V5VmFsdWVQYWlycyhrZXlWYWx1ZVBhaXJzKSxcbiAgICAuLi5nZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3Ioa2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvcilcbiAgXTtcbiAgaW5kZXhlZEtleXMuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgY29uc3QgbmVzdGVkRW50cmllcyA9IE9iamVjdC5lbnRyaWVzKHZhbHVlKTtcbiAgICBjb25zdCBuS2V5VmFsdWVQYWlycyA9IFtdO1xuICAgIGNvbnN0IG5LZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yID0gW107XG4gICAgbmVzdGVkRW50cmllcy5mb3JFYWNoKChbbmVzdGVkS2V5LCBuZXN0ZWRWYWx1ZV0pID0+IHtcbiAgICAgIGlmIChpc1N0cmluZ0VtcHR5KG5lc3RlZEtleSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiS2V5IGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1NpbXBsZVZhbHVlKG5lc3RlZFZhbHVlKSkge1xuICAgICAgICBuS2V5VmFsdWVQYWlycy5wdXNoKFtmb3JtYXRGaWx0ZXJLZXkoa2V5LCBuZXN0ZWRLZXkpLCBuZXN0ZWRWYWx1ZV0pO1xuICAgICAgfSBlbHNlIGlmIChpc1ZhbHVlV2l0aE9wZXJhdG9yKG5lc3RlZFZhbHVlKSkge1xuICAgICAgICBuS2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvci5wdXNoKFtcbiAgICAgICAgICBmb3JtYXRGaWx0ZXJLZXkoa2V5LCBuZXN0ZWRLZXkpLFxuICAgICAgICAgIG5lc3RlZFZhbHVlXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGZpbHRlckxpc3QgPSBbXG4gICAgICAuLi5maWx0ZXJMaXN0LFxuICAgICAgLi4uZ2V0RmlsdGVyc0Zyb21LZXlWYWx1ZVBhaXJzKG5LZXlWYWx1ZVBhaXJzKSxcbiAgICAgIC4uLmdldEZpbHRlcnNGcm9tS2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvcihuS2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvcilcbiAgICBdO1xuICB9KTtcbiAgcmV0dXJuIGZpbHRlckxpc3QubWFwKFxuICAgICh7IGtleSwgb3BlcmF0b3IsIHZhbHVlIH0pID0+IGZvcm1hdEZpbHRlcihrZXksIG9wZXJhdG9yLCBmb3JtYXRGaWx0ZXJWYWx1ZSh2YWx1ZSkpXG4gICkuam9pbihcIiBBTkQgXCIpO1xufVxudmFyIGdldEZpbHRlcnNGcm9tS2V5VmFsdWVQYWlycyA9IChrZXlWYWx1ZVBhaXJzKSA9PiB7XG4gIGNvbnN0IGZpbHRlcnMgPSBbXTtcbiAga2V5VmFsdWVQYWlycy5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICBmaWx0ZXJzLnB1c2goe1xuICAgICAga2V5LFxuICAgICAgb3BlcmF0b3I6IFwiOlwiLFxuICAgICAgdmFsdWVcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBmaWx0ZXJzO1xufTtcbnZhciBnZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IgPSAoa2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvcikgPT4ge1xuICBjb25zdCBmaWx0ZXJzID0gW107XG4gIGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgaWYgKFwic3RhcnRzV2l0aFwiIGluIHZhbHVlICYmIHR5cGVvZiB2YWx1ZS5zdGFydHNXaXRoID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBmaWx0ZXJzLnB1c2goe1xuICAgICAgICBrZXksXG4gICAgICAgIG9wZXJhdG9yOiBcIl5cIixcbiAgICAgICAgdmFsdWU6IHZhbHVlLnN0YXJ0c1dpdGhcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmaWx0ZXJzO1xufTtcbnZhciBpc1NpbXBsZVZhbHVlID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xudmFyIGlzVmFsdWVXaXRoT3BlcmF0b3IgPSAodmFsdWUpID0+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiBcInN0YXJ0c1dpdGhcIiBpbiB2YWx1ZSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG52YXIgZm9ybWF0RmlsdGVyID0gKGtleSwgb3BlcmF0b3IsIHZhbHVlKSA9PiB7XG4gIHJldHVybiBgJHtrZXl9JHtvcGVyYXRvcn0ke3ZhbHVlfWA7XG59O1xudmFyIGZvcm1hdEZpbHRlcktleSA9IChrZXksIG5lc3RlZEtleSkgPT4ge1xuICBpZiAobmVzdGVkS2V5KSB7XG4gICAgcmV0dXJuIGAke2tleX1bJHtKU09OLnN0cmluZ2lmeShuZXN0ZWRLZXkpfV1gO1xuICB9XG4gIHJldHVybiBrZXk7XG59O1xudmFyIGZvcm1hdEZpbHRlclZhbHVlID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICBpZiAoaXNTdHJpbmdFbXB0eSh2YWx1ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICB9XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbn07XG52YXIgaXNTdHJpbmdFbXB0eSA9ICh2YWx1ZSkgPT4ge1xuICByZXR1cm4gIXZhbHVlIHx8IHZhbHVlLnRvU3RyaW5nKCkudHJpbSgpID09PSBcIlwiO1xufTtcblxuLy8gc3JjL3Byb3RvY29sL0NsaWVudE1zZy50c1xudmFyIENsaWVudE1zZ0NvZGUgPSAvKiBAX19QVVJFX18gKi8gKChDbGllbnRNc2dDb2RlMikgPT4ge1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIlVQREFURV9QUkVTRU5DRVwiXSA9IDEwMF0gPSBcIlVQREFURV9QUkVTRU5DRVwiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIkJST0FEQ0FTVF9FVkVOVFwiXSA9IDEwM10gPSBcIkJST0FEQ0FTVF9FVkVOVFwiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIkZFVENIX1NUT1JBR0VcIl0gPSAyMDBdID0gXCJGRVRDSF9TVE9SQUdFXCI7XG4gIENsaWVudE1zZ0NvZGUyW0NsaWVudE1zZ0NvZGUyW1wiVVBEQVRFX1NUT1JBR0VcIl0gPSAyMDFdID0gXCJVUERBVEVfU1RPUkFHRVwiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIkZFVENIX1lET0NcIl0gPSAzMDBdID0gXCJGRVRDSF9ZRE9DXCI7XG4gIENsaWVudE1zZ0NvZGUyW0NsaWVudE1zZ0NvZGUyW1wiVVBEQVRFX1lET0NcIl0gPSAzMDFdID0gXCJVUERBVEVfWURPQ1wiO1xuICByZXR1cm4gQ2xpZW50TXNnQ29kZTI7XG59KShDbGllbnRNc2dDb2RlIHx8IHt9KTtcblxuLy8gc3JjL3JlZnMvSW1tdXRhYmxlUmVmLnRzXG5mdW5jdGlvbiBtZXJnZSh0YXJnZXQsIHBhdGNoKSB7XG4gIGxldCB1cGRhdGVkID0gZmFsc2U7XG4gIGNvbnN0IG5ld1ZhbHVlID0geyAuLi50YXJnZXQgfTtcbiAgT2JqZWN0LmtleXMocGF0Y2gpLmZvckVhY2goKGspID0+IHtcbiAgICBjb25zdCBrZXkgPSBrO1xuICAgIGNvbnN0IHZhbCA9IHBhdGNoW2tleV07XG4gICAgaWYgKG5ld1ZhbHVlW2tleV0gIT09IHZhbCkge1xuICAgICAgaWYgKHZhbCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGRlbGV0ZSBuZXdWYWx1ZVtrZXldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3VmFsdWVba2V5XSA9IHZhbDtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZWQgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB1cGRhdGVkID8gbmV3VmFsdWUgOiB0YXJnZXQ7XG59XG52YXIgSW1tdXRhYmxlUmVmID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9ldiA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICB9XG4gIGdldCBkaWRJbnZhbGlkYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9ldi5vYnNlcnZhYmxlO1xuICB9XG4gIGludmFsaWRhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2NhY2hlICE9PSB2b2lkIDApIHtcbiAgICAgIHRoaXMuX2NhY2hlID0gdm9pZCAwO1xuICAgICAgdGhpcy5fZXYubm90aWZ5KCk7XG4gICAgfVxuICB9XG4gIGdldCBjdXJyZW50KCkge1xuICAgIHJldHVybiB0aGlzLl9jYWNoZSA/PyAodGhpcy5fY2FjaGUgPSB0aGlzLl90b0ltbXV0YWJsZSgpKTtcbiAgfVxufTtcblxuLy8gc3JjL3JlZnMvT3RoZXJzUmVmLnRzXG5mdW5jdGlvbiBtYWtlVXNlcihjb25uLCBwcmVzZW5jZSkge1xuICBjb25zdCB7IGNvbm5lY3Rpb25JZCwgaWQsIGluZm8gfSA9IGNvbm47XG4gIGNvbnN0IGNhbldyaXRlID0gY2FuV3JpdGVTdG9yYWdlKGNvbm4uc2NvcGVzKTtcbiAgcmV0dXJuIGZyZWV6ZShcbiAgICBjb21wYWN0T2JqZWN0KHtcbiAgICAgIGNvbm5lY3Rpb25JZCxcbiAgICAgIGlkLFxuICAgICAgaW5mbyxcbiAgICAgIGNhbldyaXRlLFxuICAgICAgY2FuQ29tbWVudDogY2FuQ29tbWVudChjb25uLnNjb3BlcyksXG4gICAgICBpc1JlYWRPbmx5OiAhY2FuV3JpdGUsXG4gICAgICAvLyBEZXByZWNhdGVkLCBrZXB0IGZvciBiYWNrd2FyZC1jb21wYXRpYmlsaXR5XG4gICAgICBwcmVzZW5jZVxuICAgIH0pXG4gICk7XG59XG52YXIgT3RoZXJzUmVmID0gY2xhc3MgZXh0ZW5kcyBJbW11dGFibGVSZWYge1xuICAvL1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2Nvbm5lY3Rpb25zID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICB0aGlzLl9wcmVzZW5jZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuX3VzZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgfVxuICBjb25uZWN0aW9uSWRzKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9ucy5rZXlzKCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9JbW11dGFibGUoKSB7XG4gICAgY29uc3QgdXNlcnMgPSBjb21wYWN0KFxuICAgICAgQXJyYXkuZnJvbSh0aGlzLl9wcmVzZW5jZXMua2V5cygpKS5tYXAoXG4gICAgICAgIChjb25uZWN0aW9uSWQpID0+IHRoaXMuZ2V0VXNlcihOdW1iZXIoY29ubmVjdGlvbklkKSlcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiB1c2VycztcbiAgfVxuICBjbGVhck90aGVycygpIHtcbiAgICB0aGlzLl9jb25uZWN0aW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5fcHJlc2VuY2VzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICB0aGlzLl91c2VycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfZ2V0VXNlcihjb25uZWN0aW9uSWQpIHtcbiAgICBjb25zdCBjb25uID0gdGhpcy5fY29ubmVjdGlvbnMuZ2V0KGNvbm5lY3Rpb25JZCk7XG4gICAgY29uc3QgcHJlc2VuY2UgPSB0aGlzLl9wcmVzZW5jZXMuZ2V0KGNvbm5lY3Rpb25JZCk7XG4gICAgaWYgKGNvbm4gIT09IHZvaWQgMCAmJiBwcmVzZW5jZSAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbWFrZVVzZXIoY29ubiwgcHJlc2VuY2UpO1xuICAgIH1cbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGdldFVzZXIoY29ubmVjdGlvbklkKSB7XG4gICAgY29uc3QgY2FjaGVkVXNlciA9IHRoaXMuX3VzZXJzLmdldChjb25uZWN0aW9uSWQpO1xuICAgIGlmIChjYWNoZWRVc2VyKSB7XG4gICAgICByZXR1cm4gY2FjaGVkVXNlcjtcbiAgICB9XG4gICAgY29uc3QgY29tcHV0ZWRVc2VyID0gdGhpcy5fZ2V0VXNlcihjb25uZWN0aW9uSWQpO1xuICAgIGlmIChjb21wdXRlZFVzZXIpIHtcbiAgICAgIHRoaXMuX3VzZXJzLnNldChjb25uZWN0aW9uSWQsIGNvbXB1dGVkVXNlcik7XG4gICAgICByZXR1cm4gY29tcHV0ZWRVc2VyO1xuICAgIH1cbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2ludmFsaWRhdGVVc2VyKGNvbm5lY3Rpb25JZCkge1xuICAgIGlmICh0aGlzLl91c2Vycy5oYXMoY29ubmVjdGlvbklkKSkge1xuICAgICAgdGhpcy5fdXNlcnMuZGVsZXRlKGNvbm5lY3Rpb25JZCk7XG4gICAgfVxuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG4gIC8qKlxuICAgKiBSZWNvcmRzIGEga25vd24gY29ubmVjdGlvbi4gVGhpcyByZWNvcmRzIHRoZSBjb25uZWN0aW9uIElEIGFuZCB0aGVcbiAgICogYXNzb2NpYXRlZCBtZXRhZGF0YS5cbiAgICovXG4gIHNldENvbm5lY3Rpb24oY29ubmVjdGlvbklkLCBtZXRhVXNlcklkLCBtZXRhVXNlckluZm8sIHNjb3Blcykge1xuICAgIHRoaXMuX2Nvbm5lY3Rpb25zLnNldChcbiAgICAgIGNvbm5lY3Rpb25JZCxcbiAgICAgIGZyZWV6ZSh7XG4gICAgICAgIGNvbm5lY3Rpb25JZCxcbiAgICAgICAgaWQ6IG1ldGFVc2VySWQsXG4gICAgICAgIGluZm86IG1ldGFVc2VySW5mbyxcbiAgICAgICAgc2NvcGVzXG4gICAgICB9KVxuICAgICk7XG4gICAgaWYgKHRoaXMuX3ByZXNlbmNlcy5oYXMoY29ubmVjdGlvbklkKSkge1xuICAgICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBrbm93biBjb25uZWN0aW9uSWQuIFJlbW92ZXMgYm90aCB0aGUgY29ubmVjdGlvbidzIG1ldGFkYXRhIGFuZFxuICAgKiB0aGUgcHJlc2VuY2UgaW5mb3JtYXRpb24uXG4gICAqL1xuICByZW1vdmVDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCkge1xuICAgIHRoaXMuX2Nvbm5lY3Rpb25zLmRlbGV0ZShjb25uZWN0aW9uSWQpO1xuICAgIHRoaXMuX3ByZXNlbmNlcy5kZWxldGUoY29ubmVjdGlvbklkKTtcbiAgICB0aGlzLl9pbnZhbGlkYXRlVXNlcihjb25uZWN0aW9uSWQpO1xuICB9XG4gIC8qKlxuICAgKiBTdG9yZXMgYSBuZXcgdXNlciBmcm9tIGEgZnVsbCBwcmVzZW5jZSB1cGRhdGUuIElmIHRoZSB1c2VyIGFscmVhZHkgZXhpc3RzLFxuICAgKiBpdHMga25vd24gcHJlc2VuY2UgZGF0YSBpcyBvdmVyd3JpdHRlbi5cbiAgICovXG4gIHNldE90aGVyKGNvbm5lY3Rpb25JZCwgcHJlc2VuY2UpIHtcbiAgICB0aGlzLl9wcmVzZW5jZXMuc2V0KGNvbm5lY3Rpb25JZCwgZnJlZXplKGNvbXBhY3RPYmplY3QocHJlc2VuY2UpKSk7XG4gICAgaWYgKHRoaXMuX2Nvbm5lY3Rpb25zLmhhcyhjb25uZWN0aW9uSWQpKSB7XG4gICAgICB0aGlzLl9pbnZhbGlkYXRlVXNlcihjb25uZWN0aW9uSWQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUGF0Y2hlcyB0aGUgcHJlc2VuY2UgZGF0YSBmb3IgYW4gZXhpc3RpbmcgXCJvdGhlclwiLiBJZiB3ZSBkb24ndCBrbm93IHRoZVxuICAgKiBpbml0aWFsIHByZXNlbmNlIGRhdGEgZm9yIHRoaXMgdXNlciB5ZXQsIGRpc2NhcmQgdGhpcyBwYXRjaCBhbmQgYXdhaXQgdGhlXG4gICAqIGZ1bGwgLnNldE90aGVyKCkgY2FsbCBmaXJzdC5cbiAgICovXG4gIHBhdGNoT3RoZXIoY29ubmVjdGlvbklkLCBwYXRjaCkge1xuICAgIGNvbnN0IG9sZFByZXNlbmNlID0gdGhpcy5fcHJlc2VuY2VzLmdldChjb25uZWN0aW9uSWQpO1xuICAgIGlmIChvbGRQcmVzZW5jZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG5ld1ByZXNlbmNlID0gbWVyZ2Uob2xkUHJlc2VuY2UsIHBhdGNoKTtcbiAgICBpZiAob2xkUHJlc2VuY2UgIT09IG5ld1ByZXNlbmNlKSB7XG4gICAgICB0aGlzLl9wcmVzZW5jZXMuc2V0KGNvbm5lY3Rpb25JZCwgZnJlZXplKG5ld1ByZXNlbmNlKSk7XG4gICAgICB0aGlzLl9pbnZhbGlkYXRlVXNlcihjb25uZWN0aW9uSWQpO1xuICAgIH1cbiAgfVxufTtcblxuLy8gc3JjL3JlZnMvUGF0Y2hhYmxlUmVmLnRzXG52YXIgUGF0Y2hhYmxlUmVmID0gY2xhc3MgZXh0ZW5kcyBJbW11dGFibGVSZWYge1xuICBjb25zdHJ1Y3RvcihkYXRhKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9kYXRhID0gZnJlZXplKGNvbXBhY3RPYmplY3QoZGF0YSkpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICB9XG4gIC8qKlxuICAgKiBQYXRjaGVzIHRoZSBjdXJyZW50IG9iamVjdC5cbiAgICovXG4gIHBhdGNoKHBhdGNoKSB7XG4gICAgY29uc3Qgb2xkRGF0YSA9IHRoaXMuX2RhdGE7XG4gICAgY29uc3QgbmV3RGF0YSA9IG1lcmdlKG9sZERhdGEsIHBhdGNoKTtcbiAgICBpZiAob2xkRGF0YSAhPT0gbmV3RGF0YSkge1xuICAgICAgdGhpcy5fZGF0YSA9IGZyZWV6ZShuZXdEYXRhKTtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIH1cbiAgfVxufTtcblxuLy8gc3JjL3JlZnMvVmFsdWVSZWYudHNcbnZhciBWYWx1ZVJlZiA9IGNsYXNzIGV4dGVuZHMgSW1tdXRhYmxlUmVmIHtcbiAgY29uc3RydWN0b3IoaW5pdGlhbFZhbHVlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl92YWx1ZSA9IGZyZWV6ZShpbml0aWFsVmFsdWUpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuICBzZXQobmV3VmFsdWUpIHtcbiAgICB0aGlzLl92YWx1ZSA9IGZyZWV6ZShuZXdWYWx1ZSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gIH1cbn07XG52YXIgRGVyaXZlZFJlZiA9IGNsYXNzIGV4dGVuZHMgSW1tdXRhYmxlUmVmIHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKCk7XG4gICAgY29uc3QgdHJhbnNmb3JtRm4gPSBhcmdzLnBvcCgpO1xuICAgIGNvbnN0IG90aGVyUmVmcyA9IGFyZ3M7XG4gICAgdGhpcy5fcmVmcyA9IG90aGVyUmVmcztcbiAgICB0aGlzLl9yZWZzLmZvckVhY2goKHJlZikgPT4ge1xuICAgICAgcmVmLmRpZEludmFsaWRhdGUuc3Vic2NyaWJlKCgpID0+IHRoaXMuaW52YWxpZGF0ZSgpKTtcbiAgICB9KTtcbiAgICB0aGlzLl90cmFuc2Zvcm0gPSB0cmFuc2Zvcm1GbjtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdHJhbnNmb3JtKFxuICAgICAgLi4udGhpcy5fcmVmcy5tYXAoKHJlZikgPT4gcmVmLmN1cnJlbnQpXG4gICAgKTtcbiAgfVxufTtcblxuLy8gc3JjL3Jvb20udHNcbnZhciBNQVhfU09DS0VUX01FU1NBR0VfU0laRSA9IDEwMjQgKiAxMDI0IC0gMTAyNDtcbmZ1bmN0aW9uIG1ha2VJZEZhY3RvcnkoY29ubmVjdGlvbklkKSB7XG4gIGxldCBjb3VudCA9IDA7XG4gIHJldHVybiAoKSA9PiBgJHtjb25uZWN0aW9uSWR9OiR7Y291bnQrK31gO1xufVxuZnVuY3Rpb24gdXNlclRvVHJlZU5vZGUoa2V5LCB1c2VyKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJVc2VyXCIsXG4gICAgaWQ6IGAke3VzZXIuY29ubmVjdGlvbklkfWAsXG4gICAga2V5LFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIGNvbm5lY3Rpb25JZDogdXNlci5jb25uZWN0aW9uSWQsXG4gICAgICBpZDogdXNlci5pZCxcbiAgICAgIGluZm86IHVzZXIuaW5mbyxcbiAgICAgIHByZXNlbmNlOiB1c2VyLnByZXNlbmNlLFxuICAgICAgaXNSZWFkT25seTogIXVzZXIuY2FuV3JpdGVcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiBpbnN0YWxsQmFja2dyb3VuZFRhYlNweSgpIHtcbiAgY29uc3QgZG9jID0gdHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiID8gZG9jdW1lbnQgOiB2b2lkIDA7XG4gIGNvbnN0IGluQmFja2dyb3VuZFNpbmNlID0geyBjdXJyZW50OiBudWxsIH07XG4gIGZ1bmN0aW9uIG9uVmlzaWJpbGl0eUNoYW5nZSgpIHtcbiAgICBpZiAoZG9jPy52aXNpYmlsaXR5U3RhdGUgPT09IFwiaGlkZGVuXCIpIHtcbiAgICAgIGluQmFja2dyb3VuZFNpbmNlLmN1cnJlbnQgPSBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ID8/IERhdGUubm93KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGluQmFja2dyb3VuZFNpbmNlLmN1cnJlbnQgPSBudWxsO1xuICAgIH1cbiAgfVxuICBkb2M/LmFkZEV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIG9uVmlzaWJpbGl0eUNoYW5nZSk7XG4gIGNvbnN0IHVuc3ViID0gKCkgPT4ge1xuICAgIGRvYz8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgb25WaXNpYmlsaXR5Q2hhbmdlKTtcbiAgfTtcbiAgcmV0dXJuIFtpbkJhY2tncm91bmRTaW5jZSwgdW5zdWJdO1xufVxudmFyIENvbW1lbnRzQXBpRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgc3RhdHVzLCBkZXRhaWxzKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICB0aGlzLmRldGFpbHMgPSBkZXRhaWxzO1xuICB9XG59O1xuZnVuY3Rpb24gY3JlYXRlQ29tbWVudHNBcGkocm9vbUlkLCBnZXRBdXRoVmFsdWUsIGZldGNoQ2xpZW50QXBpKSB7XG4gIGFzeW5jIGZ1bmN0aW9uIGZldGNoQ29tbWVudHNBcGkoZW5kcG9pbnQsIHBhcmFtcywgb3B0aW9ucykge1xuICAgIGNvbnN0IGF1dGhWYWx1ZSA9IGF3YWl0IGdldEF1dGhWYWx1ZSgpO1xuICAgIHJldHVybiBmZXRjaENsaWVudEFwaShyb29tSWQsIGVuZHBvaW50LCBhdXRoVmFsdWUsIG9wdGlvbnMsIHBhcmFtcyk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hKc29uKGVuZHBvaW50LCBvcHRpb25zLCBwYXJhbXMpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoQ29tbWVudHNBcGkoZW5kcG9pbnQsIHBhcmFtcywgb3B0aW9ucyk7XG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA+PSA0MDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgNjAwKSB7XG4gICAgICAgIGxldCBlcnJvcjM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JCb2R5ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGVycm9yMyA9IG5ldyBDb21tZW50c0FwaUVycm9yKFxuICAgICAgICAgICAgZXJyb3JCb2R5Lm1lc3NhZ2UsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBlcnJvckJvZHlcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgQ29tbWVudHNBcGlFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0LCByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yMztcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGJvZHk7XG4gICAgdHJ5IHtcbiAgICAgIGJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBib2R5ID0ge307XG4gICAgfVxuICAgIHJldHVybiBib2R5O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldFRocmVhZHNTaW5jZShvcHRpb25zKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKFxuICAgICAgXCIvdGhyZWFkc1wiLFxuICAgICAge1xuICAgICAgICBzaW5jZTogb3B0aW9ucz8uc2luY2U/LnRvSVNPU3RyaW5nKClcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWRzOiB7XG4gICAgICAgICAgdXBkYXRlZDoganNvbi5kYXRhLm1hcChjb252ZXJ0VG9UaHJlYWREYXRhKSxcbiAgICAgICAgICBkZWxldGVkOiBqc29uLmRlbGV0ZWRUaHJlYWRzLm1hcChjb252ZXJ0VG9UaHJlYWREZWxldGVJbmZvKVxuICAgICAgICB9LFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHtcbiAgICAgICAgICB1cGRhdGVkOiBqc29uLmluYm94Tm90aWZpY2F0aW9ucy5tYXAoY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhKSxcbiAgICAgICAgICBkZWxldGVkOiBqc29uLmRlbGV0ZWRJbmJveE5vdGlmaWNhdGlvbnMubWFwKFxuICAgICAgICAgICAgY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EZWxldGVJbmZvXG4gICAgICAgICAgKVxuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoanNvbi5tZXRhLnJlcXVlc3RlZEF0KVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWRzOiB7XG4gICAgICAgICAgdXBkYXRlZDogW10sXG4gICAgICAgICAgZGVsZXRlZDogW11cbiAgICAgICAgfSxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiB7XG4gICAgICAgICAgdXBkYXRlZDogW10sXG4gICAgICAgICAgZGVsZXRlZDogW11cbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWVzdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aHJlYWRzLlwiKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0VGhyZWFkcyhvcHRpb25zKSB7XG4gICAgbGV0IHF1ZXJ5O1xuICAgIGlmIChvcHRpb25zPy5xdWVyeSkge1xuICAgICAgcXVlcnkgPSBvYmplY3RUb1F1ZXJ5KG9wdGlvbnMucXVlcnkpO1xuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoQ29tbWVudHNBcGkoXG4gICAgICBcIi90aHJlYWRzXCIsXG4gICAgICB7XG4gICAgICAgIHF1ZXJ5XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGhyZWFkczoganNvbi5kYXRhLm1hcChjb252ZXJ0VG9UaHJlYWREYXRhKSxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBqc29uLmluYm94Tm90aWZpY2F0aW9ucy5tYXAoXG4gICAgICAgICAgY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhXG4gICAgICAgICksXG4gICAgICAgIHJlcXVlc3RlZEF0OiBuZXcgRGF0ZShqc29uLm1ldGEucmVxdWVzdGVkQXQpXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZHM6IFtdLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IFtdLFxuICAgICAgICBkZWxldGVkVGhyZWFkczogW10sXG4gICAgICAgIGRlbGV0ZWRJbmJveE5vdGlmaWNhdGlvbnM6IFtdLFxuICAgICAgICByZXF1ZXN0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKClcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRocmVhZHMuXCIpO1xuICAgIH1cbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRUaHJlYWQodGhyZWFkSWQpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoQ29tbWVudHNBcGkoXG4gICAgICBgL3RocmVhZC13aXRoLW5vdGlmaWNhdGlvbi8ke3RocmVhZElkfWBcbiAgICApO1xuICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZDogY29udmVydFRvVGhyZWFkRGF0YShqc29uLnRocmVhZCksXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uOiBqc29uLmluYm94Tm90aWZpY2F0aW9uID8gY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhKGpzb24uaW5ib3hOb3RpZmljYXRpb24pIDogdm9pZCAwXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZDogdm9pZCAwLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbjogdm9pZCAwXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRocmVhZCAke3RocmVhZElkfS5gKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGhyZWFkKHtcbiAgICBtZXRhZGF0YSxcbiAgICBib2R5LFxuICAgIGNvbW1lbnRJZCA9IGNyZWF0ZUNvbW1lbnRJZCgpLFxuICAgIHRocmVhZElkID0gY3JlYXRlVGhyZWFkSWQoKVxuICB9KSB7XG4gICAgY29uc3QgdGhyZWFkID0gYXdhaXQgZmV0Y2hKc29uKFwiL3RocmVhZHNcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGlkOiB0aHJlYWRJZCxcbiAgICAgICAgY29tbWVudDoge1xuICAgICAgICAgIGlkOiBjb21tZW50SWQsXG4gICAgICAgICAgYm9keVxuICAgICAgICB9LFxuICAgICAgICBtZXRhZGF0YVxuICAgICAgfSlcbiAgICB9KTtcbiAgICByZXR1cm4gY29udmVydFRvVGhyZWFkRGF0YSh0aHJlYWQpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRocmVhZCh0aHJlYWRJZCkge1xuICAgIGF3YWl0IGZldGNoSnNvbihgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGVkaXRUaHJlYWRNZXRhZGF0YSh7XG4gICAgbWV0YWRhdGEsXG4gICAgdGhyZWFkSWRcbiAgfSkge1xuICAgIHJldHVybiBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9tZXRhZGF0YWAsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShtZXRhZGF0YSlcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIG1hcmtUaHJlYWRBc1Jlc29sdmVkKHRocmVhZElkKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vbWFyay1hcy1yZXNvbHZlZGAsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCJcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIG1hcmtUaHJlYWRBc1VucmVzb2x2ZWQodGhyZWFkSWQpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9tYXJrLWFzLXVucmVzb2x2ZWRgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb21tZW50KHtcbiAgICB0aHJlYWRJZCxcbiAgICBjb21tZW50SWQgPSBjcmVhdGVDb21tZW50SWQoKSxcbiAgICBib2R5XG4gIH0pIHtcbiAgICBjb25zdCBjb21tZW50ID0gYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vY29tbWVudHNgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGlkOiBjb21tZW50SWQsXG4gICAgICAgICAgYm9keVxuICAgICAgICB9KVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnREYXRhKGNvbW1lbnQpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGVkaXRDb21tZW50KHtcbiAgICB0aHJlYWRJZCxcbiAgICBjb21tZW50SWQsXG4gICAgYm9keVxuICB9KSB7XG4gICAgY29uc3QgY29tbWVudCA9IGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICBjb21tZW50SWRcbiAgICAgICl9YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBib2R5XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gY29udmVydFRvQ29tbWVudERhdGEoY29tbWVudCk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQ29tbWVudDIoe1xuICAgIHRocmVhZElkLFxuICAgIGNvbW1lbnRJZFxuICB9KSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vY29tbWVudHMvJHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgIGNvbW1lbnRJZFxuICAgICAgKX1gLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCJcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGFkZFJlYWN0aW9uMih7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkLFxuICAgIGVtb2ppXG4gIH0pIHtcbiAgICBjb25zdCByZWFjdGlvbiA9IGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICBjb21tZW50SWRcbiAgICAgICl9L3JlYWN0aW9uc2AsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVtb2ppIH0pXG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gY29udmVydFRvQ29tbWVudFVzZXJSZWFjdGlvbihyZWFjdGlvbik7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlUmVhY3Rpb24yKHtcbiAgICB0aHJlYWRJZCxcbiAgICBjb21tZW50SWQsXG4gICAgZW1vamlcbiAgfSkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICBjb21tZW50SWRcbiAgICAgICl9L3JlYWN0aW9ucy8ke2VuY29kZVVSSUNvbXBvbmVudChlbW9qaSl9YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGdldFRocmVhZHMsXG4gICAgZ2V0VGhyZWFkc1NpbmNlLFxuICAgIGdldFRocmVhZCxcbiAgICBjcmVhdGVUaHJlYWQsXG4gICAgZGVsZXRlVGhyZWFkLFxuICAgIGVkaXRUaHJlYWRNZXRhZGF0YSxcbiAgICBtYXJrVGhyZWFkQXNSZXNvbHZlZCxcbiAgICBtYXJrVGhyZWFkQXNVbnJlc29sdmVkLFxuICAgIGNyZWF0ZUNvbW1lbnQsXG4gICAgZWRpdENvbW1lbnQsXG4gICAgZGVsZXRlQ29tbWVudDogZGVsZXRlQ29tbWVudDIsXG4gICAgYWRkUmVhY3Rpb246IGFkZFJlYWN0aW9uMixcbiAgICByZW1vdmVSZWFjdGlvbjogcmVtb3ZlUmVhY3Rpb24yXG4gIH07XG59XG52YXIgTUFSS19JTkJPWF9OT1RJRklDQVRJT05TX0FTX1JFQURfQkFUQ0hfREVMQVkyID0gNTA7XG5mdW5jdGlvbiBjcmVhdGVSb29tKG9wdGlvbnMsIGNvbmZpZykge1xuICBjb25zdCBpbml0aWFsUHJlc2VuY2UgPSBvcHRpb25zLmluaXRpYWxQcmVzZW5jZTtcbiAgY29uc3QgaW5pdGlhbFN0b3JhZ2UgPSBvcHRpb25zLmluaXRpYWxTdG9yYWdlO1xuICBjb25zdCBbaW5CYWNrZ3JvdW5kU2luY2UsIHVuaW5zdGFsbEJnVGFiU3B5XSA9IGluc3RhbGxCYWNrZ3JvdW5kVGFiU3B5KCk7XG4gIGNvbnN0IGRlbGVnYXRlcyA9IHtcbiAgICAuLi5jb25maWcuZGVsZWdhdGVzLFxuICAgIC8vIEEgY29ubmVjdGlvbiBpcyBhbGxvd2VkIHRvIGdvIGludG8gXCJ6b21iaWUgc3RhdGVcIiBvbmx5IGlmIGFsbCBvZiB0aGVcbiAgICAvLyBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcHBseTpcbiAgICAvL1xuICAgIC8vIC0gVGhlIGBiYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dGAgY2xpZW50IG9wdGlvbiBpcyBjb25maWd1cmVkXG4gICAgLy8gLSBUaGUgYnJvd3NlciB3aW5kb3cgaGFzIGJlZW4gaW4gdGhlIGJhY2tncm91bmQgZm9yIGF0IGxlYXN0XG4gICAgLy8gICBgYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXRgIG1pbGxpc2Vjb25kc1xuICAgIC8vIC0gVGhlcmUgYXJlIG5vIHBlbmRpbmcgY2hhbmdlc1xuICAgIC8vXG4gICAgY2FuWm9tYmllKCkge1xuICAgICAgcmV0dXJuIGNvbmZpZy5iYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dCAhPT0gdm9pZCAwICYmIGluQmFja2dyb3VuZFNpbmNlLmN1cnJlbnQgIT09IG51bGwgJiYgRGF0ZS5ub3coKSA+IGluQmFja2dyb3VuZFNpbmNlLmN1cnJlbnQgKyBjb25maWcuYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQgJiYgZ2V0U3RvcmFnZVN0YXR1cygpICE9PSBcInN5bmNocm9uaXppbmdcIjtcbiAgICB9XG4gIH07XG4gIGNvbnN0IG1hbmFnZWRTb2NrZXQgPSBuZXcgTWFuYWdlZFNvY2tldChcbiAgICBkZWxlZ2F0ZXMsXG4gICAgY29uZmlnLmVuYWJsZURlYnVnTG9nZ2luZ1xuICApO1xuICBjb25zdCBjb250ZXh0ID0ge1xuICAgIGJ1ZmZlcjoge1xuICAgICAgZmx1c2hUaW1lcklEOiB2b2lkIDAsXG4gICAgICBsYXN0Rmx1c2hlZEF0OiAwLFxuICAgICAgcHJlc2VuY2VVcGRhdGVzOiAoXG4gICAgICAgIC8vIFF1ZXVlIHVwIHRoZSBpbml0aWFsIHByZXNlbmNlIG1lc3NhZ2UgYXMgYSBGdWxsIFByZXNlbmNl4oSiIHVwZGF0ZVxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJmdWxsXCIsXG4gICAgICAgICAgZGF0YTogaW5pdGlhbFByZXNlbmNlXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICBtZXNzYWdlczogW10sXG4gICAgICBzdG9yYWdlT3BlcmF0aW9uczogW11cbiAgICB9LFxuICAgIHN0YXRpY1Nlc3Npb25JbmZvOiBuZXcgVmFsdWVSZWYobnVsbCksXG4gICAgZHluYW1pY1Nlc3Npb25JbmZvOiBuZXcgVmFsdWVSZWYobnVsbCksXG4gICAgbXlQcmVzZW5jZTogbmV3IFBhdGNoYWJsZVJlZihpbml0aWFsUHJlc2VuY2UpLFxuICAgIG90aGVyczogbmV3IE90aGVyc1JlZigpLFxuICAgIGluaXRpYWxTdG9yYWdlLFxuICAgIGlkRmFjdG9yeTogbnVsbCxcbiAgICAvLyBTdG9yYWdlXG4gICAgY2xvY2s6IDAsXG4gICAgb3BDbG9jazogMCxcbiAgICBub2RlczogLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSxcbiAgICByb290OiB2b2lkIDAsXG4gICAgdW5kb1N0YWNrOiBbXSxcbiAgICByZWRvU3RhY2s6IFtdLFxuICAgIHBhdXNlZEhpc3Rvcnk6IG51bGwsXG4gICAgYWN0aXZlQmF0Y2g6IG51bGwsXG4gICAgdW5hY2tub3dsZWRnZWRPcHM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksXG4gICAgLy8gRGVidWdcbiAgICBvcFN0YWNrVHJhY2VzOiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIgPyAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpIDogdm9pZCAwXG4gIH07XG4gIGNvbnN0IGRvTm90QmF0Y2hVcGRhdGVzID0gKGNiKSA9PiBjYigpO1xuICBjb25zdCBiYXRjaFVwZGF0ZXMgPSBjb25maWcudW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMgPz8gZG9Ob3RCYXRjaFVwZGF0ZXM7XG4gIGxldCBsYXN0VG9rZW5LZXk7XG4gIGZ1bmN0aW9uIG9uU3RhdHVzRGlkQ2hhbmdlKG5ld1N0YXR1cykge1xuICAgIGNvbnN0IGF1dGhWYWx1ZSA9IG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlO1xuICAgIGlmIChhdXRoVmFsdWUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHRva2VuS2V5ID0gZ2V0QXV0aEJlYXJlckhlYWRlckZyb21BdXRoVmFsdWUoYXV0aFZhbHVlKTtcbiAgICAgIGlmICh0b2tlbktleSAhPT0gbGFzdFRva2VuS2V5KSB7XG4gICAgICAgIGxhc3RUb2tlbktleSA9IHRva2VuS2V5O1xuICAgICAgICBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwic2VjcmV0XCIpIHtcbiAgICAgICAgICBjb25zdCB0b2tlbiA9IGF1dGhWYWx1ZS50b2tlbi5wYXJzZWQ7XG4gICAgICAgICAgY29udGV4dC5zdGF0aWNTZXNzaW9uSW5mby5zZXQoe1xuICAgICAgICAgICAgdXNlcklkOiB0b2tlbi5rID09PSBcInNlYy1sZWdhY3lcIiAvKiBTRUNSRVRfTEVHQUNZICovID8gdG9rZW4uaWQgOiB0b2tlbi51aWQsXG4gICAgICAgICAgICB1c2VySW5mbzogdG9rZW4uayA9PT0gXCJzZWMtbGVnYWN5XCIgLyogU0VDUkVUX0xFR0FDWSAqLyA/IHRva2VuLmluZm8gOiB0b2tlbi51aVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnRleHQuc3RhdGljU2Vzc2lvbkluZm8uc2V0KHtcbiAgICAgICAgICAgIHVzZXJJZDogdm9pZCAwLFxuICAgICAgICAgICAgdXNlckluZm86IHZvaWQgMFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICBldmVudEh1Yi5zdGF0dXMubm90aWZ5KG5ld1N0YXR1cyk7XG4gICAgICBub3RpZnlTZWxmQ2hhbmdlZChkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgfSk7XG4gIH1cbiAgbGV0IF9jb25uZWN0aW9uTG9zc1RpbWVySWQ7XG4gIGxldCBfaGFzTG9zdENvbm5lY3Rpb24gPSBmYWxzZTtcbiAgZnVuY3Rpb24gaGFuZGxlQ29ubmVjdGlvbkxvc3NFdmVudChuZXdTdGF0dXMpIHtcbiAgICBpZiAobmV3U3RhdHVzID09PSBcInJlY29ubmVjdGluZ1wiKSB7XG4gICAgICBfY29ubmVjdGlvbkxvc3NUaW1lcklkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICAgICAgZXZlbnRIdWIubG9zdENvbm5lY3Rpb24ubm90aWZ5KFwibG9zdFwiKTtcbiAgICAgICAgICBfaGFzTG9zdENvbm5lY3Rpb24gPSB0cnVlO1xuICAgICAgICAgIGNvbnRleHQub3RoZXJzLmNsZWFyT3RoZXJzKCk7XG4gICAgICAgICAgbm90aWZ5KHsgb3RoZXJzOiBbeyB0eXBlOiBcInJlc2V0XCIgfV0gfSwgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgICAgICB9KTtcbiAgICAgIH0sIGNvbmZpZy5sb3N0Q29ubmVjdGlvblRpbWVvdXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjbGVhclRpbWVvdXQoX2Nvbm5lY3Rpb25Mb3NzVGltZXJJZCk7XG4gICAgICBpZiAoX2hhc0xvc3RDb25uZWN0aW9uKSB7XG4gICAgICAgIGlmIChuZXdTdGF0dXMgPT09IFwiZGlzY29ubmVjdGVkXCIpIHtcbiAgICAgICAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgICAgICAgZXZlbnRIdWIubG9zdENvbm5lY3Rpb24ubm90aWZ5KFwiZmFpbGVkXCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICAgICAgICBldmVudEh1Yi5sb3N0Q29ubmVjdGlvbi5ub3RpZnkoXCJyZXN0b3JlZFwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBfaGFzTG9zdENvbm5lY3Rpb24gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gb25EaWRDb25uZWN0KCkge1xuICAgIGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcyA9IHtcbiAgICAgIHR5cGU6IFwiZnVsbFwiLFxuICAgICAgZGF0YTogKFxuICAgICAgICAvLyBCZWNhdXNlIGNvbnRleHQubWUuY3VycmVudCBpcyBhIHJlYWRvbmx5IG9iamVjdCwgd2UnbGwgaGF2ZSB0b1xuICAgICAgICAvLyBtYWtlIGEgY29weSBoZXJlLiBPdGhlcndpc2UsIHR5cGUgZXJyb3JzIGhhcHBlbiBsYXRlciB3aGVuXG4gICAgICAgIC8vIFwicGF0Y2hpbmdcIiBteSBwcmVzZW5jZS5cbiAgICAgICAgeyAuLi5jb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudCB9XG4gICAgICApXG4gICAgfTtcbiAgICBpZiAoX2dldFN0b3JhZ2UkICE9PSBudWxsKSB7XG4gICAgICByZWZyZXNoU3RvcmFnZSh7IGZsdXNoOiBmYWxzZSB9KTtcbiAgICB9XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgfVxuICBmdW5jdGlvbiBvbkRpZERpc2Nvbm5lY3QoKSB7XG4gICAgY2xlYXJUaW1lb3V0KGNvbnRleHQuYnVmZmVyLmZsdXNoVGltZXJJRCk7XG4gIH1cbiAgbWFuYWdlZFNvY2tldC5ldmVudHMub25NZXNzYWdlLnN1YnNjcmliZShoYW5kbGVTZXJ2ZXJNZXNzYWdlKTtcbiAgbWFuYWdlZFNvY2tldC5ldmVudHMuc3RhdHVzRGlkQ2hhbmdlLnN1YnNjcmliZShvblN0YXR1c0RpZENoYW5nZSk7XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLnN0YXR1c0RpZENoYW5nZS5zdWJzY3JpYmUoaGFuZGxlQ29ubmVjdGlvbkxvc3NFdmVudCk7XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLmRpZENvbm5lY3Quc3Vic2NyaWJlKG9uRGlkQ29ubmVjdCk7XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLmRpZERpc2Nvbm5lY3Quc3Vic2NyaWJlKG9uRGlkRGlzY29ubmVjdCk7XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLm9uTGl2ZWJsb2Nrc0Vycm9yLnN1YnNjcmliZSgoZXJyKSA9PiB7XG4gICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgZXJyb3IyKFxuICAgICAgICAgIGBDb25uZWN0aW9uIHRvIHdlYnNvY2tldCBzZXJ2ZXIgY2xvc2VkLiBSZWFzb246ICR7ZXJyLm1lc3NhZ2V9IChjb2RlOiAke2Vyci5jb2RlfSkuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgZXZlbnRIdWIuZXJyb3Iubm90aWZ5KGVycik7XG4gICAgfSk7XG4gIH0pO1xuICBjb25zdCBwb29sID0ge1xuICAgIHJvb21JZDogY29uZmlnLnJvb21JZCxcbiAgICBnZXROb2RlOiAoaWQpID0+IGNvbnRleHQubm9kZXMuZ2V0KGlkKSxcbiAgICBhZGROb2RlOiAoaWQsIG5vZGUpID0+IHZvaWQgY29udGV4dC5ub2Rlcy5zZXQoaWQsIG5vZGUpLFxuICAgIGRlbGV0ZU5vZGU6IChpZCkgPT4gdm9pZCBjb250ZXh0Lm5vZGVzLmRlbGV0ZShpZCksXG4gICAgZ2VuZXJhdGVJZDogKCkgPT4gYCR7Z2V0Q29ubmVjdGlvbklkKCl9OiR7Y29udGV4dC5jbG9jaysrfWAsXG4gICAgZ2VuZXJhdGVPcElkOiAoKSA9PiBgJHtnZXRDb25uZWN0aW9uSWQoKX06JHtjb250ZXh0Lm9wQ2xvY2srK31gLFxuICAgIGRpc3BhdGNoKG9wcywgcmV2ZXJzZSwgc3RvcmFnZVVwZGF0ZXMpIHtcbiAgICAgIGNvbnN0IGFjdGl2ZUJhdGNoID0gY29udGV4dC5hY3RpdmVCYXRjaDtcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgY29uc3Qgc3RhY2tUcmFjZSA9IGNhcHR1cmVTdGFja1RyYWNlKFwiU3RvcmFnZSBtdXRhdGlvblwiLCB0aGlzLmRpc3BhdGNoKTtcbiAgICAgICAgaWYgKHN0YWNrVHJhY2UpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IG9wIG9mIG9wcykge1xuICAgICAgICAgICAgaWYgKG9wLm9wSWQpIHtcbiAgICAgICAgICAgICAgbm4oY29udGV4dC5vcFN0YWNrVHJhY2VzKS5zZXQob3Aub3BJZCwgc3RhY2tUcmFjZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYWN0aXZlQmF0Y2gpIHtcbiAgICAgICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgICAgICBhY3RpdmVCYXRjaC5vcHMucHVzaChvcCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygc3RvcmFnZVVwZGF0ZXMpIHtcbiAgICAgICAgICBhY3RpdmVCYXRjaC51cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLnNldChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIG1lcmdlU3RvcmFnZVVwZGF0ZXMoXG4gICAgICAgICAgICAgIGFjdGl2ZUJhdGNoLnVwZGF0ZXMuc3RvcmFnZVVwZGF0ZXMuZ2V0KGtleSksXG4gICAgICAgICAgICAgIHZhbHVlXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBhY3RpdmVCYXRjaC5yZXZlcnNlT3BzLnVuc2hpZnQoLi4ucmV2ZXJzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgICAgIGFkZFRvVW5kb1N0YWNrKHJldmVyc2UsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgICBjb250ZXh0LnJlZG9TdGFjay5sZW5ndGggPSAwO1xuICAgICAgICAgIGRpc3BhdGNoT3BzKG9wcyk7XG4gICAgICAgICAgbm90aWZ5KHsgc3RvcmFnZVVwZGF0ZXMgfSwgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGFzc2VydFN0b3JhZ2VJc1dyaXRhYmxlOiAoKSA9PiB7XG4gICAgICBjb25zdCBzY29wZXMgPSBjb250ZXh0LmR5bmFtaWNTZXNzaW9uSW5mby5jdXJyZW50Py5zY29wZXM7XG4gICAgICBpZiAoc2NvcGVzID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgY2FuV3JpdGUgPSBjYW5Xcml0ZVN0b3JhZ2Uoc2NvcGVzKTtcbiAgICAgIGlmICghY2FuV3JpdGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQ2Fubm90IHdyaXRlIHRvIHN0b3JhZ2Ugd2l0aCBhIHJlYWQgb25seSB1c2VyLCBwbGVhc2UgZW5zdXJlIHRoZSB1c2VyIGhhcyB3cml0ZSBwZXJtaXNzaW9uc1wiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBldmVudEh1YiA9IHtcbiAgICBzdGF0dXM6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIC8vIE5ldy9yZWNvbW1lbmRlZCBBUElcbiAgICBsb3N0Q29ubmVjdGlvbjogbWFrZUV2ZW50U291cmNlKCksXG4gICAgY3VzdG9tRXZlbnQ6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIHNlbGY6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIG15UHJlc2VuY2U6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIG90aGVyczogbWFrZUV2ZW50U291cmNlKCksXG4gICAgZXJyb3I6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIHN0b3JhZ2VCYXRjaDogbWFrZUV2ZW50U291cmNlKCksXG4gICAgaGlzdG9yeTogbWFrZUV2ZW50U291cmNlKCksXG4gICAgc3RvcmFnZURpZExvYWQ6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIHN0b3JhZ2VTdGF0dXM6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIHlkb2M6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGNvbW1lbnRzOiBtYWtlRXZlbnRTb3VyY2UoKVxuICB9O1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaENsaWVudEFwaShyb29tSWQsIGVuZHBvaW50LCBhdXRoVmFsdWUsIG9wdGlvbnMyLCBwYXJhbXMpIHtcbiAgICBjb25zdCB1cmwgPSB1cmxqb2luKFxuICAgICAgY29uZmlnLmJhc2VVcmwsXG4gICAgICBgL3YyL2Mvcm9vbXMvJHtlbmNvZGVVUklDb21wb25lbnQocm9vbUlkKX0ke2VuZHBvaW50fWAsXG4gICAgICBwYXJhbXNcbiAgICApO1xuICAgIGNvbnN0IGZldGNoZXIgPSBjb25maWcucG9seWZpbGxzPy5mZXRjaCB8fCAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgIGZldGNoO1xuICAgIHJldHVybiBhd2FpdCBmZXRjaGVyKHVybCwge1xuICAgICAgLi4ub3B0aW9uczIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLm9wdGlvbnMyPy5oZWFkZXJzLFxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7Z2V0QXV0aEJlYXJlckhlYWRlckZyb21BdXRoVmFsdWUoYXV0aFZhbHVlKX1gXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gc3RyZWFtRmV0Y2goYXV0aFZhbHVlLCByb29tSWQpIHtcbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkocm9vbUlkLCBcIi9zdG9yYWdlXCIsIGF1dGhWYWx1ZSwge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGh0dHBQb3N0VG9Sb29tKGVuZHBvaW50LCBib2R5KSB7XG4gICAgaWYgKCFtYW5hZ2VkU29ja2V0LmF1dGhWYWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm90IGF1dGhvcml6ZWRcIik7XG4gICAgfVxuICAgIHJldHVybiBmZXRjaENsaWVudEFwaShjb25maWcucm9vbUlkLCBlbmRwb2ludCwgbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSlcbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBjcmVhdGVUZXh0TWVudGlvbih1c2VySWQsIG1lbnRpb25JZCkge1xuICAgIGlmICghbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhdXRob3JpemVkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkoXG4gICAgICBjb25maWcucm9vbUlkLFxuICAgICAgXCIvdGV4dC1tZW50aW9uc1wiLFxuICAgICAgbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIG1lbnRpb25JZFxuICAgICAgICB9KVxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlVGV4dE1lbnRpb24obWVudGlvbklkKSB7XG4gICAgaWYgKCFtYW5hZ2VkU29ja2V0LmF1dGhWYWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm90IGF1dGhvcml6ZWRcIik7XG4gICAgfVxuICAgIHJldHVybiBmZXRjaENsaWVudEFwaShcbiAgICAgIGNvbmZpZy5yb29tSWQsXG4gICAgICBgL3RleHQtbWVudGlvbnMvJHttZW50aW9uSWR9YCxcbiAgICAgIG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCJcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHJlcG9ydFRleHRFZGl0b3IodHlwZSwgcm9vdEtleSkge1xuICAgIGNvbnN0IGF1dGhWYWx1ZSA9IGF3YWl0IGRlbGVnYXRlcy5hdXRoZW50aWNhdGUoKTtcbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkoY29uZmlnLnJvb21JZCwgXCIvdGV4dC1tZXRhZGF0YVwiLCBhdXRoVmFsdWUsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB0eXBlLFxuICAgICAgICByb290S2V5XG4gICAgICB9KVxuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIHNlbmRNZXNzYWdlcyhtZXNzYWdlcykge1xuICAgIGNvbnN0IHNlcmlhbGl6ZWRQYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZXMpO1xuICAgIGNvbnN0IG5vbmNlID0gY29udGV4dC5keW5hbWljU2Vzc2lvbkluZm8uY3VycmVudD8ubm9uY2U7XG4gICAgaWYgKGNvbmZpZy51bnN0YWJsZV9mYWxsYmFja1RvSFRUUCAmJiBub25jZSkge1xuICAgICAgY29uc3Qgc2l6ZSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzZXJpYWxpemVkUGF5bG9hZCkubGVuZ3RoO1xuICAgICAgaWYgKHNpemUgPiBNQVhfU09DS0VUX01FU1NBR0VfU0laRSkge1xuICAgICAgICB2b2lkIGh0dHBQb3N0VG9Sb29tKFwiL3NlbmQtbWVzc2FnZVwiLCB7IG5vbmNlLCBtZXNzYWdlcyB9KS50aGVuKFxuICAgICAgICAgIChyZXNwKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXJlc3Aub2sgJiYgcmVzcC5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgICAgICBtYW5hZ2VkU29ja2V0LnJlY29ubmVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgd2FybihcbiAgICAgICAgICBcIk1lc3NhZ2Ugd2FzIHRvbyBsYXJnZSBmb3Igd2Vic29ja2V0cyBhbmQgc2VudCBvdmVyIEhUVFAgaW5zdGVhZFwiXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgbWFuYWdlZFNvY2tldC5zZW5kKHNlcmlhbGl6ZWRQYXlsb2FkKTtcbiAgfVxuICBjb25zdCBzZWxmID0gbmV3IERlcml2ZWRSZWYoXG4gICAgY29udGV4dC5zdGF0aWNTZXNzaW9uSW5mbyxcbiAgICBjb250ZXh0LmR5bmFtaWNTZXNzaW9uSW5mbyxcbiAgICBjb250ZXh0Lm15UHJlc2VuY2UsXG4gICAgKHN0YXRpY1Nlc3Npb24sIGR5bmFtaWNTZXNzaW9uLCBteVByZXNlbmNlKSA9PiB7XG4gICAgICBpZiAoc3RhdGljU2Vzc2lvbiA9PT0gbnVsbCB8fCBkeW5hbWljU2Vzc2lvbiA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNhbldyaXRlID0gY2FuV3JpdGVTdG9yYWdlKGR5bmFtaWNTZXNzaW9uLnNjb3Blcyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29ubmVjdGlvbklkOiBkeW5hbWljU2Vzc2lvbi5hY3RvcixcbiAgICAgICAgICBpZDogc3RhdGljU2Vzc2lvbi51c2VySWQsXG4gICAgICAgICAgaW5mbzogc3RhdGljU2Vzc2lvbi51c2VySW5mbyxcbiAgICAgICAgICBwcmVzZW5jZTogbXlQcmVzZW5jZSxcbiAgICAgICAgICBjYW5Xcml0ZSxcbiAgICAgICAgICBjYW5Db21tZW50OiBjYW5Db21tZW50KGR5bmFtaWNTZXNzaW9uLnNjb3BlcylcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGxldCBfbGFzdFNlbGY7XG4gIGZ1bmN0aW9uIG5vdGlmeVNlbGZDaGFuZ2VkKGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGNvbnN0IGN1cnJTZWxmID0gc2VsZi5jdXJyZW50O1xuICAgIGlmIChjdXJyU2VsZiAhPT0gbnVsbCAmJiBjdXJyU2VsZiAhPT0gX2xhc3RTZWxmKSB7XG4gICAgICBiYXRjaGVkVXBkYXRlc1dyYXBwZXIoKCkgPT4ge1xuICAgICAgICBldmVudEh1Yi5zZWxmLm5vdGlmeShjdXJyU2VsZik7XG4gICAgICB9KTtcbiAgICAgIF9sYXN0U2VsZiA9IGN1cnJTZWxmO1xuICAgIH1cbiAgfVxuICBjb25zdCBzZWxmQXNUcmVlTm9kZSA9IG5ldyBEZXJpdmVkUmVmKFxuICAgIHNlbGYsXG4gICAgKG1lKSA9PiBtZSAhPT0gbnVsbCA/IHVzZXJUb1RyZWVOb2RlKFwiTWVcIiwgbWUpIDogbnVsbFxuICApO1xuICBmdW5jdGlvbiBjcmVhdGVPclVwZGF0ZVJvb3RGcm9tTWVzc2FnZShtZXNzYWdlLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBpZiAobWVzc2FnZS5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludGVybmFsIGVycm9yOiBjYW5ub3QgbG9hZCBzdG9yYWdlIHdpdGhvdXQgaXRlbXNcIik7XG4gICAgfVxuICAgIGlmIChjb250ZXh0LnJvb3QgIT09IHZvaWQgMCkge1xuICAgICAgdXBkYXRlUm9vdChtZXNzYWdlLml0ZW1zLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0LnJvb3QgPSBMaXZlT2JqZWN0Ll9mcm9tSXRlbXMobWVzc2FnZS5pdGVtcywgcG9vbCk7XG4gICAgfVxuICAgIGNvbnN0IGNhbldyaXRlID0gc2VsZi5jdXJyZW50Py5jYW5Xcml0ZSA/PyB0cnVlO1xuICAgIGNvbnN0IHN0YWNrU2l6ZUJlZm9yZSA9IGNvbnRleHQudW5kb1N0YWNrLmxlbmd0aDtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBjb250ZXh0LmluaXRpYWxTdG9yYWdlKSB7XG4gICAgICBpZiAoY29udGV4dC5yb290LmdldChrZXkpID09PSB2b2lkIDApIHtcbiAgICAgICAgaWYgKGNhbldyaXRlKSB7XG4gICAgICAgICAgY29udGV4dC5yb290LnNldChrZXksIGNsb25lTHNvbihjb250ZXh0LmluaXRpYWxTdG9yYWdlW2tleV0pKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3YXJuKFxuICAgICAgICAgICAgYEF0dGVtcHRlZCB0byBwb3B1bGF0ZSBtaXNzaW5nIHN0b3JhZ2Uga2V5ICcke2tleX0nLCBidXQgY3VycmVudCB1c2VyIGhhcyBubyB3cml0ZSBhY2Nlc3NgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGggPSBzdGFja1NpemVCZWZvcmU7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlUm9vdChpdGVtcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgaWYgKGNvbnRleHQucm9vdCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRJdGVtcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgZm9yIChjb25zdCBbaWQsIG5vZGVdIG9mIGNvbnRleHQubm9kZXMpIHtcbiAgICAgIGN1cnJlbnRJdGVtcy5zZXQoaWQsIG5vZGUuX3NlcmlhbGl6ZSgpKTtcbiAgICB9XG4gICAgY29uc3Qgb3BzID0gZ2V0VHJlZXNEaWZmT3BlcmF0aW9ucyhjdXJyZW50SXRlbXMsIG5ldyBNYXAoaXRlbXMpKTtcbiAgICBjb25zdCByZXN1bHQgPSBhcHBseU9wcyhvcHMsIGZhbHNlKTtcbiAgICBub3RpZnkocmVzdWx0LnVwZGF0ZXMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcik7XG4gIH1cbiAgZnVuY3Rpb24gX2FkZFRvUmVhbFVuZG9TdGFjayhoaXN0b3J5T3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBpZiAoY29udGV4dC51bmRvU3RhY2subGVuZ3RoID49IDUwKSB7XG4gICAgICBjb250ZXh0LnVuZG9TdGFjay5zaGlmdCgpO1xuICAgIH1cbiAgICBjb250ZXh0LnVuZG9TdGFjay5wdXNoKGhpc3RvcnlPcHMpO1xuICAgIG9uSGlzdG9yeUNoYW5nZShiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICB9XG4gIGZ1bmN0aW9uIGFkZFRvVW5kb1N0YWNrKGhpc3RvcnlPcHMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGlmIChjb250ZXh0LnBhdXNlZEhpc3RvcnkgIT09IG51bGwpIHtcbiAgICAgIGNvbnRleHQucGF1c2VkSGlzdG9yeS51bnNoaWZ0KC4uLmhpc3RvcnlPcHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfYWRkVG9SZWFsVW5kb1N0YWNrKGhpc3RvcnlPcHMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcik7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIG5vdGlmeSh1cGRhdGVzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IHVwZGF0ZXMuc3RvcmFnZVVwZGF0ZXM7XG4gICAgY29uc3Qgb3RoZXJzVXBkYXRlcyA9IHVwZGF0ZXMub3RoZXJzO1xuICAgIGJhdGNoZWRVcGRhdGVzV3JhcHBlcigoKSA9PiB7XG4gICAgICBpZiAob3RoZXJzVXBkYXRlcyAhPT0gdm9pZCAwICYmIG90aGVyc1VwZGF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBvdGhlcnMgPSBjb250ZXh0Lm90aGVycy5jdXJyZW50O1xuICAgICAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIG90aGVyc1VwZGF0ZXMpIHtcbiAgICAgICAgICBldmVudEh1Yi5vdGhlcnMubm90aWZ5KHsgLi4uZXZlbnQsIG90aGVycyB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHVwZGF0ZXMucHJlc2VuY2UgPz8gZmFsc2UpIHtcbiAgICAgICAgbm90aWZ5U2VsZkNoYW5nZWQoZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgICAgICBldmVudEh1Yi5teVByZXNlbmNlLm5vdGlmeShjb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudCk7XG4gICAgICB9XG4gICAgICBpZiAoc3RvcmFnZVVwZGF0ZXMgIT09IHZvaWQgMCAmJiBzdG9yYWdlVXBkYXRlcy5zaXplID4gMCkge1xuICAgICAgICBjb25zdCB1cGRhdGVzMiA9IEFycmF5LmZyb20oc3RvcmFnZVVwZGF0ZXMudmFsdWVzKCkpO1xuICAgICAgICBldmVudEh1Yi5zdG9yYWdlQmF0Y2gubm90aWZ5KHVwZGF0ZXMyKTtcbiAgICAgIH1cbiAgICAgIG5vdGlmeVN0b3JhZ2VTdGF0dXMoKTtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBnZXRDb25uZWN0aW9uSWQoKSB7XG4gICAgY29uc3QgaW5mbyA9IGNvbnRleHQuZHluYW1pY1Nlc3Npb25JbmZvLmN1cnJlbnQ7XG4gICAgaWYgKGluZm8pIHtcbiAgICAgIHJldHVybiBpbmZvLmFjdG9yO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIkludGVybmFsLiBUcmllZCB0byBnZXQgY29ubmVjdGlvbiBpZCBidXQgY29ubmVjdGlvbiB3YXMgbmV2ZXIgb3BlblwiXG4gICAgKTtcbiAgfVxuICBmdW5jdGlvbiBhcHBseU9wcyhyYXdPcHMsIGlzTG9jYWwpIHtcbiAgICBjb25zdCBvdXRwdXQgPSB7XG4gICAgICByZXZlcnNlOiBbXSxcbiAgICAgIHN0b3JhZ2VVcGRhdGVzOiAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLFxuICAgICAgcHJlc2VuY2U6IGZhbHNlXG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVkTm9kZUlkcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgY29uc3Qgb3BzID0gcmF3T3BzLm1hcCgob3ApID0+IHtcbiAgICAgIGlmIChvcC50eXBlICE9PSBcInByZXNlbmNlXCIgJiYgIW9wLm9wSWQpIHtcbiAgICAgICAgcmV0dXJuIHsgLi4ub3AsIG9wSWQ6IHBvb2wuZ2VuZXJhdGVPcElkKCkgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvcDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IG9wIG9mIG9wcykge1xuICAgICAgaWYgKG9wLnR5cGUgPT09IFwicHJlc2VuY2VcIikge1xuICAgICAgICBjb25zdCByZXZlcnNlID0ge1xuICAgICAgICAgIHR5cGU6IFwicHJlc2VuY2VcIixcbiAgICAgICAgICBkYXRhOiB7fVxuICAgICAgICB9O1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBvcC5kYXRhKSB7XG4gICAgICAgICAgcmV2ZXJzZS5kYXRhW2tleV0gPSBjb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudFtrZXldO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRleHQubXlQcmVzZW5jZS5wYXRjaChvcC5kYXRhKTtcbiAgICAgICAgaWYgKGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcyA9PT0gbnVsbCkge1xuICAgICAgICAgIGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcyA9IHsgdHlwZTogXCJwYXJ0aWFsXCIsIGRhdGE6IG9wLmRhdGEgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBvcC5kYXRhKSB7XG4gICAgICAgICAgICBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMuZGF0YVtrZXldID0gb3AuZGF0YVtrZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBvdXRwdXQucmV2ZXJzZS51bnNoaWZ0KHJldmVyc2UpO1xuICAgICAgICBvdXRwdXQucHJlc2VuY2UgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHNvdXJjZTtcbiAgICAgICAgaWYgKGlzTG9jYWwpIHtcbiAgICAgICAgICBzb3VyY2UgPSAwIC8qIFVORE9SRURPX1JFQ09OTkVDVCAqLztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBvcElkID0gbm4ob3Aub3BJZCk7XG4gICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgICAgICAgICAgbm4oY29udGV4dC5vcFN0YWNrVHJhY2VzKS5kZWxldGUob3BJZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGRlbGV0ZWQgPSBjb250ZXh0LnVuYWNrbm93bGVkZ2VkT3BzLmRlbGV0ZShvcElkKTtcbiAgICAgICAgICBzb3VyY2UgPSBkZWxldGVkID8gMiAvKiBBQ0sgKi8gOiAxIC8qIFJFTU9URSAqLztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhcHBseU9wUmVzdWx0ID0gYXBwbHlPcChvcCwgc291cmNlKTtcbiAgICAgICAgaWYgKGFwcGx5T3BSZXN1bHQubW9kaWZpZWQpIHtcbiAgICAgICAgICBjb25zdCBub2RlSWQgPSBhcHBseU9wUmVzdWx0Lm1vZGlmaWVkLm5vZGUuX2lkO1xuICAgICAgICAgIGlmICghKG5vZGVJZCAmJiBjcmVhdGVkTm9kZUlkcy5oYXMobm9kZUlkKSkpIHtcbiAgICAgICAgICAgIG91dHB1dC5zdG9yYWdlVXBkYXRlcy5zZXQoXG4gICAgICAgICAgICAgIG5uKGFwcGx5T3BSZXN1bHQubW9kaWZpZWQubm9kZS5faWQpLFxuICAgICAgICAgICAgICBtZXJnZVN0b3JhZ2VVcGRhdGVzKFxuICAgICAgICAgICAgICAgIG91dHB1dC5zdG9yYWdlVXBkYXRlcy5nZXQobm4oYXBwbHlPcFJlc3VsdC5tb2RpZmllZC5ub2RlLl9pZCkpLFxuICAgICAgICAgICAgICAgIGFwcGx5T3BSZXN1bHQubW9kaWZpZWRcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIG91dHB1dC5yZXZlcnNlLnVuc2hpZnQoLi4uYXBwbHlPcFJlc3VsdC5yZXZlcnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wLnR5cGUgPT09IDIgLyogQ1JFQVRFX0xJU1QgKi8gfHwgb3AudHlwZSA9PT0gNyAvKiBDUkVBVEVfTUFQICovIHx8IG9wLnR5cGUgPT09IDQgLyogQ1JFQVRFX09CSkVDVCAqLykge1xuICAgICAgICAgICAgY3JlYXRlZE5vZGVJZHMuYWRkKG5uKG9wLmlkKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBvcHMsXG4gICAgICByZXZlcnNlOiBvdXRwdXQucmV2ZXJzZSxcbiAgICAgIHVwZGF0ZXM6IHtcbiAgICAgICAgc3RvcmFnZVVwZGF0ZXM6IG91dHB1dC5zdG9yYWdlVXBkYXRlcyxcbiAgICAgICAgcHJlc2VuY2U6IG91dHB1dC5wcmVzZW5jZVxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gYXBwbHlPcChvcCwgc291cmNlKSB7XG4gICAgaWYgKGlzQWNrT3Aob3ApKSB7XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgc3dpdGNoIChvcC50eXBlKSB7XG4gICAgICBjYXNlIDYgLyogREVMRVRFX09CSkVDVF9LRVkgKi86XG4gICAgICBjYXNlIDMgLyogVVBEQVRFX09CSkVDVCAqLzpcbiAgICAgIGNhc2UgNSAvKiBERUxFVEVfQ1JEVCAqLzoge1xuICAgICAgICBjb25zdCBub2RlID0gY29udGV4dC5ub2Rlcy5nZXQob3AuaWQpO1xuICAgICAgICBpZiAobm9kZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vZGUuX2FwcGx5KG9wLCBzb3VyY2UgPT09IDAgLyogVU5ET1JFRE9fUkVDT05ORUNUICovKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgMSAvKiBTRVRfUEFSRU5UX0tFWSAqLzoge1xuICAgICAgICBjb25zdCBub2RlID0gY29udGV4dC5ub2Rlcy5nZXQob3AuaWQpO1xuICAgICAgICBpZiAobm9kZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUucGFyZW50LnR5cGUgPT09IFwiSGFzUGFyZW50XCIgJiYgaXNMaXZlTGlzdChub2RlLnBhcmVudC5ub2RlKSkge1xuICAgICAgICAgIHJldHVybiBub2RlLnBhcmVudC5ub2RlLl9zZXRDaGlsZEtleShcbiAgICAgICAgICAgIGFzUG9zKG9wLnBhcmVudEtleSksXG4gICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgc291cmNlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgNCAvKiBDUkVBVEVfT0JKRUNUICovOlxuICAgICAgY2FzZSAyIC8qIENSRUFURV9MSVNUICovOlxuICAgICAgY2FzZSA3IC8qIENSRUFURV9NQVAgKi86XG4gICAgICBjYXNlIDggLyogQ1JFQVRFX1JFR0lTVEVSICovOiB7XG4gICAgICAgIGlmIChvcC5wYXJlbnRJZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyZW50Tm9kZSA9IGNvbnRleHQubm9kZXMuZ2V0KG9wLnBhcmVudElkKTtcbiAgICAgICAgaWYgKHBhcmVudE5vZGUgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJlbnROb2RlLl9hdHRhY2hDaGlsZChvcCwgc291cmNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlUHJlc2VuY2UocGF0Y2gsIG9wdGlvbnMyKSB7XG4gICAgY29uc3Qgb2xkVmFsdWVzID0ge307XG4gICAgaWYgKGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcyA9PT0gbnVsbCkge1xuICAgICAgY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzID0ge1xuICAgICAgICB0eXBlOiBcInBhcnRpYWxcIixcbiAgICAgICAgZGF0YToge31cbiAgICAgIH07XG4gICAgfVxuICAgIGZvciAoY29uc3Qga2V5IGluIHBhdGNoKSB7XG4gICAgICBjb25zdCBvdmVycmlkZVZhbHVlID0gcGF0Y2hba2V5XTtcbiAgICAgIGlmIChvdmVycmlkZVZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMuZGF0YVtrZXldID0gb3ZlcnJpZGVWYWx1ZTtcbiAgICAgIG9sZFZhbHVlc1trZXldID0gY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnRba2V5XTtcbiAgICB9XG4gICAgY29udGV4dC5teVByZXNlbmNlLnBhdGNoKHBhdGNoKTtcbiAgICBpZiAoY29udGV4dC5hY3RpdmVCYXRjaCkge1xuICAgICAgaWYgKG9wdGlvbnMyPy5hZGRUb0hpc3RvcnkpIHtcbiAgICAgICAgY29udGV4dC5hY3RpdmVCYXRjaC5yZXZlcnNlT3BzLnVuc2hpZnQoe1xuICAgICAgICAgIHR5cGU6IFwicHJlc2VuY2VcIixcbiAgICAgICAgICBkYXRhOiBvbGRWYWx1ZXNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb250ZXh0LmFjdGl2ZUJhdGNoLnVwZGF0ZXMucHJlc2VuY2UgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBmbHVzaE5vd09yU29vbigpO1xuICAgICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgICAgaWYgKG9wdGlvbnMyPy5hZGRUb0hpc3RvcnkpIHtcbiAgICAgICAgICBhZGRUb1VuZG9TdGFjayhcbiAgICAgICAgICAgIFt7IHR5cGU6IFwicHJlc2VuY2VcIiwgZGF0YTogb2xkVmFsdWVzIH1dLFxuICAgICAgICAgICAgZG9Ob3RCYXRjaFVwZGF0ZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIG5vdGlmeSh7IHByZXNlbmNlOiB0cnVlIH0sIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBvblVwZGF0ZVByZXNlbmNlTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgaWYgKG1lc3NhZ2UudGFyZ2V0QWN0b3IgIT09IHZvaWQgMCkge1xuICAgICAgY29uc3Qgb2xkVXNlciA9IGNvbnRleHQub3RoZXJzLmdldFVzZXIobWVzc2FnZS5hY3Rvcik7XG4gICAgICBjb250ZXh0Lm90aGVycy5zZXRPdGhlcihtZXNzYWdlLmFjdG9yLCBtZXNzYWdlLmRhdGEpO1xuICAgICAgY29uc3QgbmV3VXNlciA9IGNvbnRleHQub3RoZXJzLmdldFVzZXIobWVzc2FnZS5hY3Rvcik7XG4gICAgICBpZiAob2xkVXNlciA9PT0gdm9pZCAwICYmIG5ld1VzZXIgIT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4geyB0eXBlOiBcImVudGVyXCIsIHVzZXI6IG5ld1VzZXIgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29udGV4dC5vdGhlcnMucGF0Y2hPdGhlcihtZXNzYWdlLmFjdG9yLCBtZXNzYWdlLmRhdGEpLCBtZXNzYWdlO1xuICAgIH1cbiAgICBjb25zdCB1c2VyID0gY29udGV4dC5vdGhlcnMuZ2V0VXNlcihtZXNzYWdlLmFjdG9yKTtcbiAgICBpZiAodXNlcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJ1cGRhdGVcIixcbiAgICAgICAgdXBkYXRlczogbWVzc2FnZS5kYXRhLFxuICAgICAgICB1c2VyXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBvblVzZXJMZWZ0TWVzc2FnZShtZXNzYWdlKSB7XG4gICAgY29uc3QgdXNlciA9IGNvbnRleHQub3RoZXJzLmdldFVzZXIobWVzc2FnZS5hY3Rvcik7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIGNvbnRleHQub3RoZXJzLnJlbW92ZUNvbm5lY3Rpb24obWVzc2FnZS5hY3Rvcik7XG4gICAgICByZXR1cm4geyB0eXBlOiBcImxlYXZlXCIsIHVzZXIgfTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgZnVuY3Rpb24gb25Sb29tU3RhdGVNZXNzYWdlKG1lc3NhZ2UsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGNvbnRleHQuZHluYW1pY1Nlc3Npb25JbmZvLnNldCh7XG4gICAgICBhY3RvcjogbWVzc2FnZS5hY3RvcixcbiAgICAgIG5vbmNlOiBtZXNzYWdlLm5vbmNlLFxuICAgICAgc2NvcGVzOiBtZXNzYWdlLnNjb3Blc1xuICAgIH0pO1xuICAgIGNvbnRleHQuaWRGYWN0b3J5ID0gbWFrZUlkRmFjdG9yeShtZXNzYWdlLmFjdG9yKTtcbiAgICBub3RpZnlTZWxmQ2hhbmdlZChiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICAgIGZvciAoY29uc3QgY29ubmVjdGlvbklkIG9mIGNvbnRleHQub3RoZXJzLmNvbm5lY3Rpb25JZHMoKSkge1xuICAgICAgY29uc3QgdXNlciA9IG1lc3NhZ2UudXNlcnNbY29ubmVjdGlvbklkXTtcbiAgICAgIGlmICh1c2VyID09PSB2b2lkIDApIHtcbiAgICAgICAgY29udGV4dC5vdGhlcnMucmVtb3ZlQ29ubmVjdGlvbihjb25uZWN0aW9uSWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBtZXNzYWdlLnVzZXJzKSB7XG4gICAgICBjb25zdCB1c2VyID0gbWVzc2FnZS51c2Vyc1trZXldO1xuICAgICAgY29uc3QgY29ubmVjdGlvbklkID0gTnVtYmVyKGtleSk7XG4gICAgICBjb250ZXh0Lm90aGVycy5zZXRDb25uZWN0aW9uKFxuICAgICAgICBjb25uZWN0aW9uSWQsXG4gICAgICAgIHVzZXIuaWQsXG4gICAgICAgIHVzZXIuaW5mbyxcbiAgICAgICAgdXNlci5zY29wZXNcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB7IHR5cGU6IFwicmVzZXRcIiB9O1xuICB9XG4gIGZ1bmN0aW9uIGNhblVuZG8oKSB7XG4gICAgcmV0dXJuIGNvbnRleHQudW5kb1N0YWNrLmxlbmd0aCA+IDA7XG4gIH1cbiAgZnVuY3Rpb24gY2FuUmVkbygpIHtcbiAgICByZXR1cm4gY29udGV4dC5yZWRvU3RhY2subGVuZ3RoID4gMDtcbiAgfVxuICBmdW5jdGlvbiBvbkhpc3RvcnlDaGFuZ2UoYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKCgpID0+IHtcbiAgICAgIGV2ZW50SHViLmhpc3Rvcnkubm90aWZ5KHsgY2FuVW5kbzogY2FuVW5kbygpLCBjYW5SZWRvOiBjYW5SZWRvKCkgfSk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gb25Vc2VySm9pbmVkTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgY29udGV4dC5vdGhlcnMuc2V0Q29ubmVjdGlvbihcbiAgICAgIG1lc3NhZ2UuYWN0b3IsXG4gICAgICBtZXNzYWdlLmlkLFxuICAgICAgbWVzc2FnZS5pbmZvLFxuICAgICAgbWVzc2FnZS5zY29wZXNcbiAgICApO1xuICAgIGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzLnB1c2goe1xuICAgICAgdHlwZTogMTAwIC8qIFVQREFURV9QUkVTRU5DRSAqLyxcbiAgICAgIGRhdGE6IGNvbnRleHQubXlQcmVzZW5jZS5jdXJyZW50LFxuICAgICAgdGFyZ2V0QWN0b3I6IG1lc3NhZ2UuYWN0b3JcbiAgICB9KTtcbiAgICBmbHVzaE5vd09yU29vbigpO1xuICAgIGNvbnN0IHVzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgIHJldHVybiB1c2VyID8geyB0eXBlOiBcImVudGVyXCIsIHVzZXIgfSA6IHZvaWQgMDtcbiAgfVxuICBmdW5jdGlvbiBwYXJzZVNlcnZlck1lc3NhZ2UoZGF0YSkge1xuICAgIGlmICghaXNKc29uT2JqZWN0KGRhdGEpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cbiAgZnVuY3Rpb24gcGFyc2VTZXJ2ZXJNZXNzYWdlcyh0ZXh0KSB7XG4gICAgY29uc3QgZGF0YSA9IHRyeVBhcnNlSnNvbih0ZXh0KTtcbiAgICBpZiAoZGF0YSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2UgaWYgKGlzSnNvbkFycmF5KGRhdGEpKSB7XG4gICAgICByZXR1cm4gY29tcGFjdChkYXRhLm1hcCgoaXRlbSkgPT4gcGFyc2VTZXJ2ZXJNZXNzYWdlKGl0ZW0pKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjb21wYWN0KFtwYXJzZVNlcnZlck1lc3NhZ2UoZGF0YSldKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gYXBwbHlBbmRTZW5kT3BzKG9mZmxpbmVPcHMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGlmIChvZmZsaW5lT3BzLnNpemUgPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbWVzc2FnZXMgPSBbXTtcbiAgICBjb25zdCBvcHMgPSBBcnJheS5mcm9tKG9mZmxpbmVPcHMudmFsdWVzKCkpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGFwcGx5T3BzKG9wcywgdHJ1ZSk7XG4gICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICB0eXBlOiAyMDEgLyogVVBEQVRFX1NUT1JBR0UgKi8sXG4gICAgICBvcHM6IHJlc3VsdC5vcHNcbiAgICB9KTtcbiAgICBub3RpZnkocmVzdWx0LnVwZGF0ZXMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcik7XG4gICAgc2VuZE1lc3NhZ2VzKG1lc3NhZ2VzKTtcbiAgfVxuICBmdW5jdGlvbiBoYW5kbGVTZXJ2ZXJNZXNzYWdlKGV2ZW50KSB7XG4gICAgaWYgKHR5cGVvZiBldmVudC5kYXRhICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2VzID0gcGFyc2VTZXJ2ZXJNZXNzYWdlcyhldmVudC5kYXRhKTtcbiAgICBpZiAobWVzc2FnZXMgPT09IG51bGwgfHwgbWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHVwZGF0ZXMgPSB7XG4gICAgICBzdG9yYWdlVXBkYXRlczogLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSxcbiAgICAgIG90aGVyczogW11cbiAgICB9O1xuICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHtcbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLnR5cGUpIHtcbiAgICAgICAgICBjYXNlIDEwMSAvKiBVU0VSX0pPSU5FRCAqLzoge1xuICAgICAgICAgICAgY29uc3QgdXNlckpvaW5lZFVwZGF0ZSA9IG9uVXNlckpvaW5lZE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAodXNlckpvaW5lZFVwZGF0ZSkge1xuICAgICAgICAgICAgICB1cGRhdGVzLm90aGVycy5wdXNoKHVzZXJKb2luZWRVcGRhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMTAwIC8qIFVQREFURV9QUkVTRU5DRSAqLzoge1xuICAgICAgICAgICAgY29uc3Qgb3RoZXJzUHJlc2VuY2VVcGRhdGUgPSBvblVwZGF0ZVByZXNlbmNlTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIGlmIChvdGhlcnNQcmVzZW5jZVVwZGF0ZSkge1xuICAgICAgICAgICAgICB1cGRhdGVzLm90aGVycy5wdXNoKG90aGVyc1ByZXNlbmNlVXBkYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDEwMyAvKiBCUk9BRENBU1RFRF9FVkVOVCAqLzoge1xuICAgICAgICAgICAgY29uc3Qgb3RoZXJzID0gY29udGV4dC5vdGhlcnMuY3VycmVudDtcbiAgICAgICAgICAgIGV2ZW50SHViLmN1c3RvbUV2ZW50Lm5vdGlmeSh7XG4gICAgICAgICAgICAgIGNvbm5lY3Rpb25JZDogbWVzc2FnZS5hY3RvcixcbiAgICAgICAgICAgICAgdXNlcjogbWVzc2FnZS5hY3RvciA8IDAgPyBudWxsIDogb3RoZXJzLmZpbmQoKHUpID0+IHUuY29ubmVjdGlvbklkID09PSBtZXNzYWdlLmFjdG9yKSA/PyBudWxsLFxuICAgICAgICAgICAgICBldmVudDogbWVzc2FnZS5ldmVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSAxMDIgLyogVVNFUl9MRUZUICovOiB7XG4gICAgICAgICAgICBjb25zdCBldmVudDIgPSBvblVzZXJMZWZ0TWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIGlmIChldmVudDIpIHtcbiAgICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaChldmVudDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMzAwIC8qIFVQREFURV9ZRE9DICovOiB7XG4gICAgICAgICAgICBldmVudEh1Yi55ZG9jLm5vdGlmeShtZXNzYWdlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDEwNCAvKiBST09NX1NUQVRFICovOiB7XG4gICAgICAgICAgICB1cGRhdGVzLm90aGVycy5wdXNoKG9uUm9vbVN0YXRlTWVzc2FnZShtZXNzYWdlLCBkb05vdEJhdGNoVXBkYXRlcykpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMjAwIC8qIElOSVRJQUxfU1RPUkFHRV9TVEFURSAqLzoge1xuICAgICAgICAgICAgcHJvY2Vzc0luaXRpYWxTdG9yYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMjAxIC8qIFVQREFURV9TVE9SQUdFICovOiB7XG4gICAgICAgICAgICBjb25zdCBhcHBseVJlc3VsdCA9IGFwcGx5T3BzKG1lc3NhZ2Uub3BzLCBmYWxzZSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBhcHBseVJlc3VsdC51cGRhdGVzLnN0b3JhZ2VVcGRhdGVzKSB7XG4gICAgICAgICAgICAgIHVwZGF0ZXMuc3RvcmFnZVVwZGF0ZXMuc2V0KFxuICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICBtZXJnZVN0b3JhZ2VVcGRhdGVzKHVwZGF0ZXMuc3RvcmFnZVVwZGF0ZXMuZ2V0KGtleSksIHZhbHVlKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMjk5IC8qIFJFSkVDVF9TVE9SQUdFX09QICovOiB7XG4gICAgICAgICAgICBlcnJvcldpdGhUaXRsZShcbiAgICAgICAgICAgICAgXCJTdG9yYWdlIG11dGF0aW9uIHJlamVjdGlvbiBlcnJvclwiLFxuICAgICAgICAgICAgICBtZXNzYWdlLnJlYXNvblxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgY29uc3QgdHJhY2VzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgZm9yIChjb25zdCBvcElkIG9mIG1lc3NhZ2Uub3BJZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0cmFjZSA9IGNvbnRleHQub3BTdGFja1RyYWNlcz8uZ2V0KG9wSWQpO1xuICAgICAgICAgICAgICAgIGlmICh0cmFjZSkge1xuICAgICAgICAgICAgICAgICAgdHJhY2VzLmFkZCh0cmFjZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICh0cmFjZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgICAgICAgICB3YXJuV2l0aFRpdGxlKFxuICAgICAgICAgICAgICAgICAgXCJUaGUgZm9sbG93aW5nIGZ1bmN0aW9uIGNhbGxzIGNhdXNlZCB0aGUgcmVqZWN0ZWQgc3RvcmFnZSBtdXRhdGlvbnM6XCIsXG4gICAgICAgICAgICAgICAgICBgXG5cbiR7QXJyYXkuZnJvbSh0cmFjZXMpLmpvaW4oXCJcXG5cXG5cIil9YFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgIGBTdG9yYWdlIG11dGF0aW9ucyByZWplY3RlZCBieSBzZXJ2ZXI6ICR7bWVzc2FnZS5yZWFzb259YFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgNDAwIC8qIFRIUkVBRF9DUkVBVEVEICovOlxuICAgICAgICAgIGNhc2UgNDA3IC8qIFRIUkVBRF9ERUxFVEVEICovOlxuICAgICAgICAgIGNhc2UgNDAxIC8qIFRIUkVBRF9NRVRBREFUQV9VUERBVEVEICovOlxuICAgICAgICAgIGNhc2UgNDA4IC8qIFRIUkVBRF9VUERBVEVEICovOlxuICAgICAgICAgIGNhc2UgNDA1IC8qIENPTU1FTlRfUkVBQ1RJT05fQURERUQgKi86XG4gICAgICAgICAgY2FzZSA0MDYgLyogQ09NTUVOVF9SRUFDVElPTl9SRU1PVkVEICovOlxuICAgICAgICAgIGNhc2UgNDAyIC8qIENPTU1FTlRfQ1JFQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwMyAvKiBDT01NRU5UX0VESVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwNCAvKiBDT01NRU5UX0RFTEVURUQgKi86IHtcbiAgICAgICAgICAgIGV2ZW50SHViLmNvbW1lbnRzLm5vdGlmeShtZXNzYWdlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbm90aWZ5KHVwZGF0ZXMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBmbHVzaE5vd09yU29vbigpIHtcbiAgICBjb25zdCBzdG9yYWdlT3BzID0gY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnM7XG4gICAgaWYgKHN0b3JhZ2VPcHMubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChjb25zdCBvcCBvZiBzdG9yYWdlT3BzKSB7XG4gICAgICAgIGNvbnRleHQudW5hY2tub3dsZWRnZWRPcHMuc2V0KG5uKG9wLm9wSWQpLCBvcCk7XG4gICAgICB9XG4gICAgICBub3RpZnlTdG9yYWdlU3RhdHVzKCk7XG4gICAgfVxuICAgIGlmIChtYW5hZ2VkU29ja2V0LmdldFN0YXR1cygpICE9PSBcImNvbm5lY3RlZFwiKSB7XG4gICAgICBjb250ZXh0LmJ1ZmZlci5zdG9yYWdlT3BlcmF0aW9ucyA9IFtdO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGVsYXBzZWRNaWxsaXMgPSBub3cgLSBjb250ZXh0LmJ1ZmZlci5sYXN0Rmx1c2hlZEF0O1xuICAgIGlmIChlbGFwc2VkTWlsbGlzID49IGNvbmZpZy50aHJvdHRsZURlbGF5KSB7XG4gICAgICBjb25zdCBtZXNzYWdlc1RvRmx1c2ggPSBzZXJpYWxpemVCdWZmZXIoKTtcbiAgICAgIGlmIChtZXNzYWdlc1RvRmx1c2gubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNlbmRNZXNzYWdlcyhtZXNzYWdlc1RvRmx1c2gpO1xuICAgICAgY29udGV4dC5idWZmZXIgPSB7XG4gICAgICAgIGZsdXNoVGltZXJJRDogdm9pZCAwLFxuICAgICAgICBsYXN0Rmx1c2hlZEF0OiBub3csXG4gICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgc3RvcmFnZU9wZXJhdGlvbnM6IFtdLFxuICAgICAgICBwcmVzZW5jZVVwZGF0ZXM6IG51bGxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LmJ1ZmZlci5mbHVzaFRpbWVySUQpO1xuICAgICAgY29udGV4dC5idWZmZXIuZmx1c2hUaW1lcklEID0gc2V0VGltZW91dChcbiAgICAgICAgZmx1c2hOb3dPclNvb24sXG4gICAgICAgIGNvbmZpZy50aHJvdHRsZURlbGF5IC0gZWxhcHNlZE1pbGxpc1xuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gc2VyaWFsaXplQnVmZmVyKCkge1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgaWYgKGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcykge1xuICAgICAgbWVzc2FnZXMucHVzaChcbiAgICAgICAgY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzLnR5cGUgPT09IFwiZnVsbFwiID8ge1xuICAgICAgICAgIHR5cGU6IDEwMCAvKiBVUERBVEVfUFJFU0VOQ0UgKi8sXG4gICAgICAgICAgLy8gUG9wdWxhdGluZyB0aGUgYHRhcmdldEFjdG9yYCBmaWVsZCB0dXJucyB0aGlzIG1lc3NhZ2UgaW50b1xuICAgICAgICAgIC8vIGEgRnVsbCBQcmVzZW5jZeKEoiB1cGRhdGUgbWVzc2FnZSAobm90IGEgcGF0Y2gpLCB3aGljaCB3aWxsIGdldFxuICAgICAgICAgIC8vIGludGVycHJldGVkIGJ5IG90aGVyIGNsaWVudHMgYXMgc3VjaC5cbiAgICAgICAgICB0YXJnZXRBY3RvcjogLTEsXG4gICAgICAgICAgZGF0YTogY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzLmRhdGFcbiAgICAgICAgfSA6IHtcbiAgICAgICAgICB0eXBlOiAxMDAgLyogVVBEQVRFX1BSRVNFTkNFICovLFxuICAgICAgICAgIGRhdGE6IGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcy5kYXRhXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgZXZlbnQgb2YgY29udGV4dC5idWZmZXIubWVzc2FnZXMpIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goZXZlbnQpO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgIHR5cGU6IDIwMSAvKiBVUERBVEVfU1RPUkFHRSAqLyxcbiAgICAgICAgb3BzOiBjb250ZXh0LmJ1ZmZlci5zdG9yYWdlT3BlcmF0aW9uc1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBtZXNzYWdlcztcbiAgfVxuICBmdW5jdGlvbiB1cGRhdGVZRG9jKHVwZGF0ZSwgZ3VpZCkge1xuICAgIGNvbnN0IGNsaWVudE1zZyA9IHtcbiAgICAgIHR5cGU6IDMwMSAvKiBVUERBVEVfWURPQyAqLyxcbiAgICAgIHVwZGF0ZSxcbiAgICAgIGd1aWRcbiAgICB9O1xuICAgIGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzLnB1c2goY2xpZW50TXNnKTtcbiAgICBldmVudEh1Yi55ZG9jLm5vdGlmeShjbGllbnRNc2cpO1xuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gYnJvYWRjYXN0RXZlbnQoZXZlbnQsIG9wdGlvbnMyID0ge1xuICAgIHNob3VsZFF1ZXVlRXZlbnRJZk5vdFJlYWR5OiBmYWxzZVxuICB9KSB7XG4gICAgaWYgKG1hbmFnZWRTb2NrZXQuZ2V0U3RhdHVzKCkgIT09IFwiY29ubmVjdGVkXCIgJiYgIW9wdGlvbnMyLnNob3VsZFF1ZXVlRXZlbnRJZk5vdFJlYWR5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzLnB1c2goe1xuICAgICAgdHlwZTogMTAzIC8qIEJST0FEQ0FTVF9FVkVOVCAqLyxcbiAgICAgIGV2ZW50XG4gICAgfSk7XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgfVxuICBmdW5jdGlvbiBkaXNwYXRjaE9wcyhvcHMpIHtcbiAgICBjb25zdCB7IHN0b3JhZ2VPcGVyYXRpb25zIH0gPSBjb250ZXh0LmJ1ZmZlcjtcbiAgICBmb3IgKGNvbnN0IG9wIG9mIG9wcykge1xuICAgICAgc3RvcmFnZU9wZXJhdGlvbnMucHVzaChvcCk7XG4gICAgfVxuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgbGV0IF9nZXRTdG9yYWdlJCA9IG51bGw7XG4gIGxldCBfcmVzb2x2ZVN0b3JhZ2VQcm9taXNlID0gbnVsbDtcbiAgZnVuY3Rpb24gcHJvY2Vzc0luaXRpYWxTdG9yYWdlKG1lc3NhZ2UpIHtcbiAgICBjb25zdCB1bmFja25vd2xlZGdlZE9wcyA9IG5ldyBNYXAoY29udGV4dC51bmFja25vd2xlZGdlZE9wcyk7XG4gICAgY3JlYXRlT3JVcGRhdGVSb290RnJvbU1lc3NhZ2UobWVzc2FnZSwgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgIGFwcGx5QW5kU2VuZE9wcyh1bmFja25vd2xlZGdlZE9wcywgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgIF9yZXNvbHZlU3RvcmFnZVByb21pc2U/LigpO1xuICAgIG5vdGlmeVN0b3JhZ2VTdGF0dXMoKTtcbiAgICBldmVudEh1Yi5zdG9yYWdlRGlkTG9hZC5ub3RpZnkoKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBzdHJlYW1TdG9yYWdlKCkge1xuICAgIGlmICghbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3RyZWFtRmV0Y2gobWFuYWdlZFNvY2tldC5hdXRoVmFsdWUsIGNvbmZpZy5yb29tSWQpO1xuICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgcmVzdWx0Lmpzb24oKTtcbiAgICBwcm9jZXNzSW5pdGlhbFN0b3JhZ2UoeyB0eXBlOiAyMDAgLyogSU5JVElBTF9TVE9SQUdFX1NUQVRFICovLCBpdGVtcyB9KTtcbiAgfVxuICBmdW5jdGlvbiByZWZyZXNoU3RvcmFnZShvcHRpb25zMikge1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gY29udGV4dC5idWZmZXIubWVzc2FnZXM7XG4gICAgaWYgKGNvbmZpZy51bnN0YWJsZV9zdHJlYW1EYXRhKSB7XG4gICAgICB2b2lkIHN0cmVhbVN0b3JhZ2UoKTtcbiAgICB9IGVsc2UgaWYgKCFtZXNzYWdlcy5zb21lKChtc2cpID0+IG1zZy50eXBlID09PSAyMDAgLyogRkVUQ0hfU1RPUkFHRSAqLykpIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goeyB0eXBlOiAyMDAgLyogRkVUQ0hfU1RPUkFHRSAqLyB9KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMyLmZsdXNoKSB7XG4gICAgICBmbHVzaE5vd09yU29vbigpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBzdGFydExvYWRpbmdTdG9yYWdlKCkge1xuICAgIGlmIChfZ2V0U3RvcmFnZSQgPT09IG51bGwpIHtcbiAgICAgIHJlZnJlc2hTdG9yYWdlKHsgZmx1c2g6IHRydWUgfSk7XG4gICAgICBfZ2V0U3RvcmFnZSQgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBfcmVzb2x2ZVN0b3JhZ2VQcm9taXNlID0gcmVzb2x2ZTtcbiAgICAgIH0pO1xuICAgICAgbm90aWZ5U3RvcmFnZVN0YXR1cygpO1xuICAgIH1cbiAgICByZXR1cm4gX2dldFN0b3JhZ2UkO1xuICB9XG4gIGZ1bmN0aW9uIGdldFN0b3JhZ2VTbmFwc2hvdCgpIHtcbiAgICBjb25zdCByb290ID0gY29udGV4dC5yb290O1xuICAgIGlmIChyb290ICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiByb290O1xuICAgIH0gZWxzZSB7XG4gICAgICB2b2lkIHN0YXJ0TG9hZGluZ1N0b3JhZ2UoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRTdG9yYWdlKCkge1xuICAgIGlmIChjb250ZXh0LnJvb3QgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgIHJvb3Q6IGNvbnRleHQucm9vdFxuICAgICAgfSk7XG4gICAgfVxuICAgIGF3YWl0IHN0YXJ0TG9hZGluZ1N0b3JhZ2UoKTtcbiAgICByZXR1cm4ge1xuICAgICAgcm9vdDogbm4oY29udGV4dC5yb290KVxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gZmV0Y2hZRG9jKHZlY3RvciwgZ3VpZCkge1xuICAgIGlmICghY29udGV4dC5idWZmZXIubWVzc2FnZXMuZmluZCgobSkgPT4ge1xuICAgICAgcmV0dXJuIG0udHlwZSA9PT0gMzAwIC8qIEZFVENIX1lET0MgKi8gJiYgbS52ZWN0b3IgPT09IHZlY3RvciAmJiBtLmd1aWQgPT09IGd1aWQ7XG4gICAgfSkpIHtcbiAgICAgIGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzLnB1c2goe1xuICAgICAgICB0eXBlOiAzMDAgLyogRkVUQ0hfWURPQyAqLyxcbiAgICAgICAgdmVjdG9yLFxuICAgICAgICBndWlkXG4gICAgICB9KTtcbiAgICB9XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgfVxuICBmdW5jdGlvbiB1bmRvKCkge1xuICAgIGlmIChjb250ZXh0LmFjdGl2ZUJhdGNoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmRvIGlzIG5vdCBhbGxvd2VkIGR1cmluZyBhIGJhdGNoXCIpO1xuICAgIH1cbiAgICBjb25zdCBoaXN0b3J5T3BzID0gY29udGV4dC51bmRvU3RhY2sucG9wKCk7XG4gICAgaWYgKGhpc3RvcnlPcHMgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb250ZXh0LnBhdXNlZEhpc3RvcnkgPSBudWxsO1xuICAgIGNvbnN0IHJlc3VsdCA9IGFwcGx5T3BzKGhpc3RvcnlPcHMsIHRydWUpO1xuICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICBub3RpZnkocmVzdWx0LnVwZGF0ZXMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgIGNvbnRleHQucmVkb1N0YWNrLnB1c2gocmVzdWx0LnJldmVyc2UpO1xuICAgICAgb25IaXN0b3J5Q2hhbmdlKGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IG9wIG9mIHJlc3VsdC5vcHMpIHtcbiAgICAgIGlmIChvcC50eXBlICE9PSBcInByZXNlbmNlXCIpIHtcbiAgICAgICAgY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnMucHVzaChvcCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gcmVkbygpIHtcbiAgICBpZiAoY29udGV4dC5hY3RpdmVCYXRjaCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwicmVkbyBpcyBub3QgYWxsb3dlZCBkdXJpbmcgYSBiYXRjaFwiKTtcbiAgICB9XG4gICAgY29uc3QgaGlzdG9yeU9wcyA9IGNvbnRleHQucmVkb1N0YWNrLnBvcCgpO1xuICAgIGlmIChoaXN0b3J5T3BzID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29udGV4dC5wYXVzZWRIaXN0b3J5ID0gbnVsbDtcbiAgICBjb25zdCByZXN1bHQgPSBhcHBseU9wcyhoaXN0b3J5T3BzLCB0cnVlKTtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICBjb250ZXh0LnVuZG9TdGFjay5wdXNoKHJlc3VsdC5yZXZlcnNlKTtcbiAgICAgIG9uSGlzdG9yeUNoYW5nZShkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBvcCBvZiByZXN1bHQub3BzKSB7XG4gICAgICBpZiAob3AudHlwZSAhPT0gXCJwcmVzZW5jZVwiKSB7XG4gICAgICAgIGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zLnB1c2gob3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIGNvbnRleHQudW5kb1N0YWNrLmxlbmd0aCA9IDA7XG4gICAgY29udGV4dC5yZWRvU3RhY2subGVuZ3RoID0gMDtcbiAgfVxuICBmdW5jdGlvbiBiYXRjaChjYWxsYmFjaykge1xuICAgIGlmIChjb250ZXh0LmFjdGl2ZUJhdGNoKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9XG4gICAgbGV0IHJldHVyblZhbHVlID0gdm9pZCAwO1xuICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICBjb250ZXh0LmFjdGl2ZUJhdGNoID0ge1xuICAgICAgICBvcHM6IFtdLFxuICAgICAgICB1cGRhdGVzOiB7XG4gICAgICAgICAgc3RvcmFnZVVwZGF0ZXM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksXG4gICAgICAgICAgcHJlc2VuY2U6IGZhbHNlLFxuICAgICAgICAgIG90aGVyczogW11cbiAgICAgICAgfSxcbiAgICAgICAgcmV2ZXJzZU9wczogW11cbiAgICAgIH07XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm5WYWx1ZSA9IGNhbGxiYWNrKCk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBjb25zdCBjdXJyZW50QmF0Y2ggPSBjb250ZXh0LmFjdGl2ZUJhdGNoO1xuICAgICAgICBjb250ZXh0LmFjdGl2ZUJhdGNoID0gbnVsbDtcbiAgICAgICAgaWYgKGN1cnJlbnRCYXRjaC5yZXZlcnNlT3BzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhZGRUb1VuZG9TdGFjayhjdXJyZW50QmF0Y2gucmV2ZXJzZU9wcywgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50QmF0Y2gub3BzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb250ZXh0LnJlZG9TdGFjay5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50QmF0Y2gub3BzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBkaXNwYXRjaE9wcyhjdXJyZW50QmF0Y2gub3BzKTtcbiAgICAgICAgfVxuICAgICAgICBub3RpZnkoY3VycmVudEJhdGNoLnVwZGF0ZXMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgZnVuY3Rpb24gcGF1c2VIaXN0b3J5KCkge1xuICAgIGlmIChjb250ZXh0LnBhdXNlZEhpc3RvcnkgPT09IG51bGwpIHtcbiAgICAgIGNvbnRleHQucGF1c2VkSGlzdG9yeSA9IFtdO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiByZXN1bWVIaXN0b3J5KCkge1xuICAgIGNvbnN0IGhpc3RvcnlPcHMgPSBjb250ZXh0LnBhdXNlZEhpc3Rvcnk7XG4gICAgY29udGV4dC5wYXVzZWRIaXN0b3J5ID0gbnVsbDtcbiAgICBpZiAoaGlzdG9yeU9wcyAhPT0gbnVsbCAmJiBoaXN0b3J5T3BzLmxlbmd0aCA+IDApIHtcbiAgICAgIF9hZGRUb1JlYWxVbmRvU3RhY2soaGlzdG9yeU9wcywgYmF0Y2hVcGRhdGVzKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gZ2V0U3RvcmFnZVN0YXR1cygpIHtcbiAgICBpZiAoY29udGV4dC5yb290ID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBfZ2V0U3RvcmFnZSQgPT09IG51bGwgPyBcIm5vdC1sb2FkZWRcIiA6IFwibG9hZGluZ1wiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29udGV4dC51bmFja25vd2xlZGdlZE9wcy5zaXplID09PSAwID8gXCJzeW5jaHJvbml6ZWRcIiA6IFwic3luY2hyb25pemluZ1wiO1xuICAgIH1cbiAgfVxuICBsZXQgX2xhc3RTdG9yYWdlU3RhdHVzID0gZ2V0U3RvcmFnZVN0YXR1cygpO1xuICBmdW5jdGlvbiBub3RpZnlTdG9yYWdlU3RhdHVzKCkge1xuICAgIGNvbnN0IHN0b3JhZ2VTdGF0dXMgPSBnZXRTdG9yYWdlU3RhdHVzKCk7XG4gICAgaWYgKF9sYXN0U3RvcmFnZVN0YXR1cyAhPT0gc3RvcmFnZVN0YXR1cykge1xuICAgICAgX2xhc3RTdG9yYWdlU3RhdHVzID0gc3RvcmFnZVN0YXR1cztcbiAgICAgIGV2ZW50SHViLnN0b3JhZ2VTdGF0dXMubm90aWZ5KHN0b3JhZ2VTdGF0dXMpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBpc1ByZXNlbmNlUmVhZHkoKSB7XG4gICAgcmV0dXJuIHNlbGYuY3VycmVudCAhPT0gbnVsbDtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiB3YWl0VW50aWxQcmVzZW5jZVJlYWR5KCkge1xuICAgIHdoaWxlICghaXNQcmVzZW5jZVJlYWR5KCkpIHtcbiAgICAgIGNvbnN0IHsgcHJvbWlzZSwgcmVzb2x2ZSB9ID0gUHJvbWlzZV93aXRoUmVzb2x2ZXJzKCk7XG4gICAgICBjb25zdCB1bnN1YjEgPSBldmVudHMuc2VsZi5zdWJzY3JpYmVPbmNlKHJlc29sdmUpO1xuICAgICAgY29uc3QgdW5zdWIyID0gZXZlbnRzLnN0YXR1cy5zdWJzY3JpYmVPbmNlKHJlc29sdmUpO1xuICAgICAgYXdhaXQgcHJvbWlzZTtcbiAgICAgIHVuc3ViMSgpO1xuICAgICAgdW5zdWIyKCk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGlzU3RvcmFnZVJlYWR5KCkge1xuICAgIHJldHVybiBnZXRTdG9yYWdlU25hcHNob3QoKSAhPT0gbnVsbDtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiB3YWl0VW50aWxTdG9yYWdlUmVhZHkoKSB7XG4gICAgd2hpbGUgKCFpc1N0b3JhZ2VSZWFkeSgpKSB7XG4gICAgICBhd2FpdCBnZXRTdG9yYWdlKCk7XG4gICAgfVxuICB9XG4gIGNvbnN0IG90aGVyc19mb3JEZXZUb29scyA9IG5ldyBEZXJpdmVkUmVmKFxuICAgIGNvbnRleHQub3RoZXJzLFxuICAgIChvdGhlcnMpID0+IG90aGVycy5tYXAoKG90aGVyLCBpbmRleCkgPT4gdXNlclRvVHJlZU5vZGUoYE90aGVyICR7aW5kZXh9YCwgb3RoZXIpKVxuICApO1xuICBjb25zdCBldmVudHMgPSB7XG4gICAgc3RhdHVzOiBldmVudEh1Yi5zdGF0dXMub2JzZXJ2YWJsZSxcbiAgICBsb3N0Q29ubmVjdGlvbjogZXZlbnRIdWIubG9zdENvbm5lY3Rpb24ub2JzZXJ2YWJsZSxcbiAgICBjdXN0b21FdmVudDogZXZlbnRIdWIuY3VzdG9tRXZlbnQub2JzZXJ2YWJsZSxcbiAgICBvdGhlcnM6IGV2ZW50SHViLm90aGVycy5vYnNlcnZhYmxlLFxuICAgIHNlbGY6IGV2ZW50SHViLnNlbGYub2JzZXJ2YWJsZSxcbiAgICBteVByZXNlbmNlOiBldmVudEh1Yi5teVByZXNlbmNlLm9ic2VydmFibGUsXG4gICAgZXJyb3I6IGV2ZW50SHViLmVycm9yLm9ic2VydmFibGUsXG4gICAgLyoqIEBkZXByZWNhdGVkICovXG4gICAgc3RvcmFnZTogZXZlbnRIdWIuc3RvcmFnZUJhdGNoLm9ic2VydmFibGUsXG4gICAgc3RvcmFnZUJhdGNoOiBldmVudEh1Yi5zdG9yYWdlQmF0Y2gub2JzZXJ2YWJsZSxcbiAgICBoaXN0b3J5OiBldmVudEh1Yi5oaXN0b3J5Lm9ic2VydmFibGUsXG4gICAgc3RvcmFnZURpZExvYWQ6IGV2ZW50SHViLnN0b3JhZ2VEaWRMb2FkLm9ic2VydmFibGUsXG4gICAgc3RvcmFnZVN0YXR1czogZXZlbnRIdWIuc3RvcmFnZVN0YXR1cy5vYnNlcnZhYmxlLFxuICAgIHlkb2M6IGV2ZW50SHViLnlkb2Mub2JzZXJ2YWJsZSxcbiAgICBjb21tZW50czogZXZlbnRIdWIuY29tbWVudHMub2JzZXJ2YWJsZVxuICB9O1xuICBjb25zdCBjb21tZW50c0FwaSA9IGNyZWF0ZUNvbW1lbnRzQXBpKFxuICAgIGNvbmZpZy5yb29tSWQsXG4gICAgZGVsZWdhdGVzLmF1dGhlbnRpY2F0ZSxcbiAgICBmZXRjaENsaWVudEFwaVxuICApO1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaE5vdGlmaWNhdGlvbnNKc29uKGVuZHBvaW50LCBvcHRpb25zMikge1xuICAgIGNvbnN0IGF1dGhWYWx1ZSA9IGF3YWl0IGRlbGVnYXRlcy5hdXRoZW50aWNhdGUoKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoQ2xpZW50QXBpKFxuICAgICAgY29uZmlnLnJvb21JZCxcbiAgICAgIGVuZHBvaW50LFxuICAgICAgYXV0aFZhbHVlLFxuICAgICAgb3B0aW9uczJcbiAgICApO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gNDAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDYwMCkge1xuICAgICAgICBsZXQgZXJyb3IzO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGVycm9yQm9keSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgTm90aWZpY2F0aW9uc0FwaUVycm9yKFxuICAgICAgICAgICAgZXJyb3JCb2R5Lm1lc3NhZ2UsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICBlcnJvckJvZHlcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgTm90aWZpY2F0aW9uc0FwaUVycm9yKFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3IzO1xuICAgICAgfVxuICAgIH1cbiAgICBsZXQgYm9keTtcbiAgICB0cnkge1xuICAgICAgYm9keSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIGJvZHkgPSB7fTtcbiAgICB9XG4gICAgcmV0dXJuIGJvZHk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0Tm90aWZpY2F0aW9uU2V0dGluZ3MoKSB7XG4gICAgcmV0dXJuIGZldGNoTm90aWZpY2F0aW9uc0pzb24oXG4gICAgICBcIi9ub3RpZmljYXRpb24tc2V0dGluZ3NcIlxuICAgICk7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3Moc2V0dGluZ3MpIHtcbiAgICByZXR1cm4gZmV0Y2hOb3RpZmljYXRpb25zSnNvbihcbiAgICAgIFwiL25vdGlmaWNhdGlvbi1zZXR0aW5nc1wiLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShzZXR0aW5ncyksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWRzKSB7XG4gICAgYXdhaXQgZmV0Y2hOb3RpZmljYXRpb25zSnNvbihcIi9pbmJveC1ub3RpZmljYXRpb25zL3JlYWRcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGluYm94Tm90aWZpY2F0aW9uSWRzIH0pXG4gICAgfSk7XG4gIH1cbiAgY29uc3QgYmF0Y2hlZE1hcmtJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQgPSBuZXcgQmF0Y2goXG4gICAgYXN5bmMgKGJhdGNoZWRJbmJveE5vdGlmaWNhdGlvbklkcykgPT4ge1xuICAgICAgY29uc3QgaW5ib3hOb3RpZmljYXRpb25JZHMgPSBiYXRjaGVkSW5ib3hOb3RpZmljYXRpb25JZHMuZmxhdCgpO1xuICAgICAgYXdhaXQgbWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZChpbmJveE5vdGlmaWNhdGlvbklkcyk7XG4gICAgICByZXR1cm4gaW5ib3hOb3RpZmljYXRpb25JZHM7XG4gICAgfSxcbiAgICB7IGRlbGF5OiBNQVJLX0lOQk9YX05PVElGSUNBVElPTlNfQVNfUkVBRF9CQVRDSF9ERUxBWTIgfVxuICApO1xuICBhc3luYyBmdW5jdGlvbiBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQoaW5ib3hOb3RpZmljYXRpb25JZCkge1xuICAgIGF3YWl0IGJhdGNoZWRNYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkLmdldChpbmJveE5vdGlmaWNhdGlvbklkKTtcbiAgfVxuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KFxuICAgIHtcbiAgICAgIFtrSW50ZXJuYWxdOiB7XG4gICAgICAgIGdldCBwcmVzZW5jZUJ1ZmZlcigpIHtcbiAgICAgICAgICByZXR1cm4gZGVlcENsb25lKGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcz8uZGF0YSA/PyBudWxsKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gcHJldHRpZXItaWdub3JlXG4gICAgICAgIGdldCB1bmRvU3RhY2soKSB7XG4gICAgICAgICAgcmV0dXJuIGRlZXBDbG9uZShjb250ZXh0LnVuZG9TdGFjayk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHByZXR0aWVyLWlnbm9yZVxuICAgICAgICBnZXQgbm9kZUNvdW50KCkge1xuICAgICAgICAgIHJldHVybiBjb250ZXh0Lm5vZGVzLnNpemU7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHByZXR0aWVyLWlnbm9yZVxuICAgICAgICAvLyBzZW5kIG1ldGFkYXRhIHdoZW4gdXNpbmcgYSB0ZXh0IGVkaXRvclxuICAgICAgICByZXBvcnRUZXh0RWRpdG9yLFxuICAgICAgICAvLyBjcmVhdGUgYSB0ZXh0IG1lbnRpb24gd2hlbiB1c2luZyBhIHRleHQgZWRpdG9yXG4gICAgICAgIGNyZWF0ZVRleHRNZW50aW9uLFxuICAgICAgICAvLyBkZWxldGUgYSB0ZXh0IG1lbnRpb24gd2hlbiB1c2luZyBhIHRleHQgZWRpdG9yXG4gICAgICAgIGRlbGV0ZVRleHRNZW50aW9uLFxuICAgICAgICAvLyBTdXBwb3J0IGZvciB0aGUgTGl2ZWJsb2NrcyBicm93c2VyIGV4dGVuc2lvblxuICAgICAgICBnZXRTZWxmX2ZvckRldlRvb2xzOiAoKSA9PiBzZWxmQXNUcmVlTm9kZS5jdXJyZW50LFxuICAgICAgICBnZXRPdGhlcnNfZm9yRGV2VG9vbHM6ICgpID0+IG90aGVyc19mb3JEZXZUb29scy5jdXJyZW50LFxuICAgICAgICAvLyBwcmV0dGllci1pZ25vcmVcbiAgICAgICAgc2ltdWxhdGU6IHtcbiAgICAgICAgICAvLyBUaGVzZSBleGlzdCBvbmx5IGZvciBvdXIgRTJFIHRlc3RpbmcgYXBwXG4gICAgICAgICAgZXhwbGljaXRDbG9zZTogKGV2ZW50KSA9PiBtYW5hZ2VkU29ja2V0Ll9wcml2YXRlU2VuZE1hY2hpbmVFdmVudCh7IHR5cGU6IFwiRVhQTElDSVRfU09DS0VUX0NMT1NFXCIsIGV2ZW50IH0pLFxuICAgICAgICAgIHJhd1NlbmQ6IChkYXRhKSA9PiBtYW5hZ2VkU29ja2V0LnNlbmQoZGF0YSlcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGlkOiBjb25maWcucm9vbUlkLFxuICAgICAgc3Vic2NyaWJlOiBtYWtlQ2xhc3NpY1N1YnNjcmliZUZuKGV2ZW50cyksXG4gICAgICBjb25uZWN0OiAoKSA9PiBtYW5hZ2VkU29ja2V0LmNvbm5lY3QoKSxcbiAgICAgIHJlY29ubmVjdDogKCkgPT4gbWFuYWdlZFNvY2tldC5yZWNvbm5lY3QoKSxcbiAgICAgIGRpc2Nvbm5lY3Q6ICgpID0+IG1hbmFnZWRTb2NrZXQuZGlzY29ubmVjdCgpLFxuICAgICAgZGVzdHJveTogKCkgPT4ge1xuICAgICAgICB1bmluc3RhbGxCZ1RhYlNweSgpO1xuICAgICAgICBtYW5hZ2VkU29ja2V0LmRlc3Ryb3koKTtcbiAgICAgIH0sXG4gICAgICAvLyBQcmVzZW5jZVxuICAgICAgdXBkYXRlUHJlc2VuY2UsXG4gICAgICB1cGRhdGVZRG9jLFxuICAgICAgYnJvYWRjYXN0RXZlbnQsXG4gICAgICAvLyBTdG9yYWdlXG4gICAgICBiYXRjaCxcbiAgICAgIGhpc3Rvcnk6IHtcbiAgICAgICAgdW5kbyxcbiAgICAgICAgcmVkbyxcbiAgICAgICAgY2FuVW5kbyxcbiAgICAgICAgY2FuUmVkbyxcbiAgICAgICAgY2xlYXIsXG4gICAgICAgIHBhdXNlOiBwYXVzZUhpc3RvcnksXG4gICAgICAgIHJlc3VtZTogcmVzdW1lSGlzdG9yeVxuICAgICAgfSxcbiAgICAgIGZldGNoWURvYyxcbiAgICAgIGdldFN0b3JhZ2UsXG4gICAgICBnZXRTdG9yYWdlU25hcHNob3QsXG4gICAgICBnZXRTdG9yYWdlU3RhdHVzLFxuICAgICAgaXNQcmVzZW5jZVJlYWR5LFxuICAgICAgaXNTdG9yYWdlUmVhZHksXG4gICAgICB3YWl0VW50aWxQcmVzZW5jZVJlYWR5OiBtZW1vaXplT25TdWNjZXNzKHdhaXRVbnRpbFByZXNlbmNlUmVhZHkpLFxuICAgICAgd2FpdFVudGlsU3RvcmFnZVJlYWR5OiBtZW1vaXplT25TdWNjZXNzKHdhaXRVbnRpbFN0b3JhZ2VSZWFkeSksXG4gICAgICBldmVudHMsXG4gICAgICAvLyBDb3JlXG4gICAgICBnZXRTdGF0dXM6ICgpID0+IG1hbmFnZWRTb2NrZXQuZ2V0U3RhdHVzKCksXG4gICAgICBnZXRTZWxmOiAoKSA9PiBzZWxmLmN1cnJlbnQsXG4gICAgICAvLyBQcmVzZW5jZVxuICAgICAgZ2V0UHJlc2VuY2U6ICgpID0+IGNvbnRleHQubXlQcmVzZW5jZS5jdXJyZW50LFxuICAgICAgZ2V0T3RoZXJzOiAoKSA9PiBjb250ZXh0Lm90aGVycy5jdXJyZW50LFxuICAgICAgZ2V0Tm90aWZpY2F0aW9uU2V0dGluZ3MsXG4gICAgICB1cGRhdGVOb3RpZmljYXRpb25TZXR0aW5ncyxcbiAgICAgIG1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZCxcbiAgICAgIC4uLmNvbW1lbnRzQXBpXG4gICAgfSxcbiAgICAvLyBFeHBsaWN0bHkgbWFrZSB0aGUgaW50ZXJuYWwgZmllbGQgbm9uLWVudW1lcmFibGUsIHRvIGF2b2lkIGFnZ3Jlc3NpdmVcbiAgICAvLyBmcmVlemluZyB3aGVuIHVzZWQgd2l0aCBJbW1lclxuICAgIGtJbnRlcm5hbCxcbiAgICB7IGVudW1lcmFibGU6IGZhbHNlIH1cbiAgKTtcbn1cbmZ1bmN0aW9uIG1ha2VDbGFzc2ljU3Vic2NyaWJlRm4oZXZlbnRzKSB7XG4gIGZ1bmN0aW9uIHN1YnNjcmliZVRvTGl2ZVN0cnVjdHVyZURlZXBseShub2RlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBldmVudHMuc3RvcmFnZUJhdGNoLnN1YnNjcmliZSgodXBkYXRlcykgPT4ge1xuICAgICAgY29uc3QgcmVsYXRlZFVwZGF0ZXMgPSB1cGRhdGVzLmZpbHRlcihcbiAgICAgICAgKHVwZGF0ZSkgPT4gaXNTYW1lTm9kZU9yQ2hpbGRPZih1cGRhdGUubm9kZSwgbm9kZSlcbiAgICAgICk7XG4gICAgICBpZiAocmVsYXRlZFVwZGF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjYWxsYmFjayhyZWxhdGVkVXBkYXRlcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gc3Vic2NyaWJlVG9MaXZlU3RydWN0dXJlU2hhbGxvd2x5KG5vZGUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGV2ZW50cy5zdG9yYWdlQmF0Y2guc3Vic2NyaWJlKCh1cGRhdGVzKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHVwZGF0ZSBvZiB1cGRhdGVzKSB7XG4gICAgICAgIGlmICh1cGRhdGUubm9kZS5faWQgPT09IG5vZGUuX2lkKSB7XG4gICAgICAgICAgY2FsbGJhY2sodXBkYXRlLm5vZGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gc3Vic2NyaWJlKGZpcnN0LCBzZWNvbmQsIG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIGZpcnN0ID09PSBcInN0cmluZ1wiICYmIGlzUm9vbUV2ZW50TmFtZShmaXJzdCkpIHtcbiAgICAgIGlmICh0eXBlb2Ygc2Vjb25kICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2Vjb25kIGFyZ3VtZW50IG11c3QgYmUgYSBjYWxsYmFjayBmdW5jdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNhbGxiYWNrID0gc2Vjb25kO1xuICAgICAgc3dpdGNoIChmaXJzdCkge1xuICAgICAgICBjYXNlIFwiZXZlbnRcIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLmN1c3RvbUV2ZW50LnN1YnNjcmliZShcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgY2FzZSBcIm15LXByZXNlbmNlXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5teVByZXNlbmNlLnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgIGNhc2UgXCJvdGhlcnNcIjoge1xuICAgICAgICAgIGNvbnN0IGNiID0gY2FsbGJhY2s7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5vdGhlcnMuc3Vic2NyaWJlKChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvdGhlcnMsIC4uLmludGVybmFsRXZlbnQgfSA9IGV2ZW50O1xuICAgICAgICAgICAgcmV0dXJuIGNiKG90aGVycywgaW50ZXJuYWxFdmVudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5lcnJvci5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICBjYXNlIFwic3RhdHVzXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5zdGF0dXMuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgY2FzZSBcImxvc3QtY29ubmVjdGlvblwiOlxuICAgICAgICAgIHJldHVybiBldmVudHMubG9zdENvbm5lY3Rpb24uc3Vic2NyaWJlKFxuICAgICAgICAgICAgY2FsbGJhY2tcbiAgICAgICAgICApO1xuICAgICAgICBjYXNlIFwiaGlzdG9yeVwiOlxuICAgICAgICAgIHJldHVybiBldmVudHMuaGlzdG9yeS5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICBjYXNlIFwic3RvcmFnZS1zdGF0dXNcIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLnN0b3JhZ2VTdGF0dXMuc3Vic2NyaWJlKFxuICAgICAgICAgICAgY2FsbGJhY2tcbiAgICAgICAgICApO1xuICAgICAgICBjYXNlIFwiY29tbWVudHNcIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLmNvbW1lbnRzLnN1YnNjcmliZShcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIoXG4gICAgICAgICAgICBmaXJzdCxcbiAgICAgICAgICAgIGBcIiR7U3RyaW5nKGZpcnN0KX1cIiBpcyBub3QgYSB2YWxpZCBldmVudCBuYW1lYFxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzZWNvbmQgPT09IHZvaWQgMCB8fCB0eXBlb2YgZmlyc3QgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgaWYgKHR5cGVvZiBmaXJzdCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNvbnN0IHN0b3JhZ2VDYWxsYmFjayA9IGZpcnN0O1xuICAgICAgICByZXR1cm4gZXZlbnRzLnN0b3JhZ2VCYXRjaC5zdWJzY3JpYmUoc3RvcmFnZUNhbGxiYWNrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBsZWFzZSBzcGVjaWZ5IGEgbGlzdGVuZXIgY2FsbGJhY2tcIik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpc0xpdmVOb2RlKGZpcnN0KSkge1xuICAgICAgY29uc3Qgbm9kZSA9IGZpcnN0O1xuICAgICAgaWYgKG9wdGlvbnM/LmlzRGVlcCkge1xuICAgICAgICBjb25zdCBzdG9yYWdlQ2FsbGJhY2sgPSBzZWNvbmQ7XG4gICAgICAgIHJldHVybiBzdWJzY3JpYmVUb0xpdmVTdHJ1Y3R1cmVEZWVwbHkobm9kZSwgc3RvcmFnZUNhbGxiYWNrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG5vZGVDYWxsYmFjayA9IHNlY29uZDtcbiAgICAgICAgcmV0dXJuIHN1YnNjcmliZVRvTGl2ZVN0cnVjdHVyZVNoYWxsb3dseShub2RlLCBub2RlQ2FsbGJhY2spO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgJHtTdHJpbmcoZmlyc3QpfSBpcyBub3QgYSB2YWx1ZSB0aGF0IGNhbiBiZSBzdWJzY3JpYmVkIHRvLmBcbiAgICApO1xuICB9XG4gIHJldHVybiBzdWJzY3JpYmU7XG59XG5mdW5jdGlvbiBpc1Jvb21FdmVudE5hbWUodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlID09PSBcIm15LXByZXNlbmNlXCIgfHwgdmFsdWUgPT09IFwib3RoZXJzXCIgfHwgdmFsdWUgPT09IFwiZXZlbnRcIiB8fCB2YWx1ZSA9PT0gXCJlcnJvclwiIHx8IHZhbHVlID09PSBcImhpc3RvcnlcIiB8fCB2YWx1ZSA9PT0gXCJzdGF0dXNcIiB8fCB2YWx1ZSA9PT0gXCJzdG9yYWdlLXN0YXR1c1wiIHx8IHZhbHVlID09PSBcImxvc3QtY29ubmVjdGlvblwiIHx8IHZhbHVlID09PSBcImNvbm5lY3Rpb25cIiB8fCB2YWx1ZSA9PT0gXCJjb21tZW50c1wiO1xufVxuZnVuY3Rpb24gbWFrZUF1dGhEZWxlZ2F0ZUZvclJvb20ocm9vbUlkLCBhdXRoTWFuYWdlcikge1xuICByZXR1cm4gYXN5bmMgKCkgPT4ge1xuICAgIHJldHVybiBhdXRoTWFuYWdlci5nZXRBdXRoVmFsdWUoeyByZXF1ZXN0ZWRTY29wZTogXCJyb29tOnJlYWRcIiwgcm9vbUlkIH0pO1xuICB9O1xufVxuZnVuY3Rpb24gbWFrZUNyZWF0ZVNvY2tldERlbGVnYXRlRm9yUm9vbShyb29tSWQsIGJhc2VVcmwsIFdlYlNvY2tldFBvbHlmaWxsKSB7XG4gIHJldHVybiAoYXV0aFZhbHVlKSA9PiB7XG4gICAgY29uc3Qgd3MgPSBXZWJTb2NrZXRQb2x5ZmlsbCA/PyAodHlwZW9mIFdlYlNvY2tldCA9PT0gXCJ1bmRlZmluZWRcIiA/IHZvaWQgMCA6IFdlYlNvY2tldCk7XG4gICAgaWYgKHdzID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBTdG9wUmV0cnlpbmcoXG4gICAgICAgIFwiVG8gdXNlIExpdmVibG9ja3MgY2xpZW50IGluIGEgbm9uLURPTSBlbnZpcm9ubWVudCwgeW91IG5lZWQgdG8gcHJvdmlkZSBhIFdlYlNvY2tldCBwb2x5ZmlsbC5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChiYXNlVXJsKTtcbiAgICB1cmwucHJvdG9jb2wgPSB1cmwucHJvdG9jb2wgPT09IFwiaHR0cDpcIiA/IFwid3NcIiA6IFwid3NzXCI7XG4gICAgdXJsLnBhdGhuYW1lID0gXCIvdjdcIjtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInJvb21JZFwiLCByb29tSWQpO1xuICAgIGlmIChhdXRoVmFsdWUudHlwZSA9PT0gXCJzZWNyZXRcIikge1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJ0b2tcIiwgYXV0aFZhbHVlLnRva2VuLnJhdyk7XG4gICAgfSBlbHNlIGlmIChhdXRoVmFsdWUudHlwZSA9PT0gXCJwdWJsaWNcIikge1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJwdWJrZXlcIiwgYXV0aFZhbHVlLnB1YmxpY0FwaUtleSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBhc3NlcnROZXZlcihhdXRoVmFsdWUsIFwiVW5oYW5kbGVkIGNhc2VcIik7XG4gICAgfVxuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwidmVyc2lvblwiLCBQS0dfVkVSU0lPTiB8fCBcImRldlwiKTtcbiAgICByZXR1cm4gbmV3IHdzKHVybC50b1N0cmluZygpKTtcbiAgfTtcbn1cblxuLy8gc3JjL3N0b3JlLnRzXG5mdW5jdGlvbiBjcmVhdGVDbGllbnRTdG9yZSgpIHtcbiAgY29uc3Qgc3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gICAgdGhyZWFkczoge30sXG4gICAgcXVlcmllczoge30sXG4gICAgb3B0aW1pc3RpY1VwZGF0ZXM6IFtdLFxuICAgIGluYm94Tm90aWZpY2F0aW9uczoge30sXG4gICAgbm90aWZpY2F0aW9uU2V0dGluZ3M6IHt9XG4gIH0pO1xuICBjb25zdCBvcHRpbWlzdGljVXBkYXRlc0V2ZW50U291cmNlID0gbWFrZUV2ZW50U291cmNlKCk7XG4gIHJldHVybiB7XG4gICAgLi4uc3RvcmUsXG4gICAgZGVsZXRlVGhyZWFkKHRocmVhZElkKSB7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgdGhyZWFkczogZGVsZXRlS2V5SW1tdXRhYmxlKHN0YXRlLnRocmVhZHMsIHRocmVhZElkKSxcbiAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHN0YXRlLmluYm94Tm90aWZpY2F0aW9ucykuZmlsdGVyKFxuICAgICAgICAgICAgICAoW19pZCwgbm90aWZpY2F0aW9uXSkgPT4gbm90aWZpY2F0aW9uLmtpbmQgPT09IFwidGhyZWFkXCIgJiYgbm90aWZpY2F0aW9uLnRocmVhZElkID09PSB0aHJlYWRJZFxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdXBkYXRlVGhyZWFkQW5kTm90aWZpY2F0aW9uKHRocmVhZCwgaW5ib3hOb3RpZmljYXRpb24pIHtcbiAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUaHJlYWQgPSBzdGF0ZS50aHJlYWRzW3RocmVhZC5pZF07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgdGhyZWFkczogZXhpc3RpbmdUaHJlYWQgPT09IHZvaWQgMCB8fCBjb21wYXJlVGhyZWFkcyh0aHJlYWQsIGV4aXN0aW5nVGhyZWFkKSA9PT0gMSA/IHsgLi4uc3RhdGUudGhyZWFkcywgW3RocmVhZC5pZF06IHRocmVhZCB9IDogc3RhdGUudGhyZWFkcyxcbiAgICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IGluYm94Tm90aWZpY2F0aW9uID09PSB2b2lkIDAgPyBzdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMgOiB7XG4gICAgICAgICAgICAuLi5zdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgICBbaW5ib3hOb3RpZmljYXRpb24uaWRdOiBpbmJveE5vdGlmaWNhdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdXBkYXRlVGhyZWFkc0FuZE5vdGlmaWNhdGlvbnModGhyZWFkcywgaW5ib3hOb3RpZmljYXRpb25zLCBkZWxldGVkVGhyZWFkcywgZGVsZXRlZEluYm94Tm90aWZpY2F0aW9ucywgcXVlcnlLZXkpIHtcbiAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICB0aHJlYWRzOiBhcHBseVRocmVhZFVwZGF0ZXMoc3RhdGUudGhyZWFkcywge1xuICAgICAgICAgIG5ld1RocmVhZHM6IHRocmVhZHMsXG4gICAgICAgICAgZGVsZXRlZFRocmVhZHNcbiAgICAgICAgfSksXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uczogYXBwbHlOb3RpZmljYXRpb25zVXBkYXRlcyhcbiAgICAgICAgICBzdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmV3SW5ib3hOb3RpZmljYXRpb25zOiBpbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgICBkZWxldGVkTm90aWZpY2F0aW9uczogZGVsZXRlZEluYm94Tm90aWZpY2F0aW9uc1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgcXVlcmllczogcXVlcnlLZXkgIT09IHZvaWQgMCA/IHtcbiAgICAgICAgICAuLi5zdGF0ZS5xdWVyaWVzLFxuICAgICAgICAgIFtxdWVyeUtleV06IHsgaXNMb2FkaW5nOiBmYWxzZSwgZGF0YTogdm9pZCAwIH1cbiAgICAgICAgfSA6IHN0YXRlLnF1ZXJpZXNcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIHVwZGF0ZVJvb21JbmJveE5vdGlmaWNhdGlvblNldHRpbmdzKHJvb21JZCwgc2V0dGluZ3MsIHF1ZXJ5S2V5KSB7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgbm90aWZpY2F0aW9uU2V0dGluZ3M6IHtcbiAgICAgICAgICAuLi5zdGF0ZS5ub3RpZmljYXRpb25TZXR0aW5ncyxcbiAgICAgICAgICBbcm9vbUlkXTogc2V0dGluZ3NcbiAgICAgICAgfSxcbiAgICAgICAgcXVlcmllczoge1xuICAgICAgICAgIC4uLnN0YXRlLnF1ZXJpZXMsXG4gICAgICAgICAgW3F1ZXJ5S2V5XTogeyBpc0xvYWRpbmc6IGZhbHNlLCBkYXRhOiB2b2lkIDAgfVxuICAgICAgICB9XG4gICAgICB9KSk7XG4gICAgfSxcbiAgICBwdXNoT3B0aW1pc3RpY1VwZGF0ZShvcHRpbWlzdGljVXBkYXRlKSB7XG4gICAgICBvcHRpbWlzdGljVXBkYXRlc0V2ZW50U291cmNlLm5vdGlmeShvcHRpbWlzdGljVXBkYXRlKTtcbiAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBvcHRpbWlzdGljVXBkYXRlczogWy4uLnN0YXRlLm9wdGltaXN0aWNVcGRhdGVzLCBvcHRpbWlzdGljVXBkYXRlXVxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgc2V0UXVlcnlTdGF0ZShxdWVyeUtleSwgcXVlcnlTdGF0ZSkge1xuICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHF1ZXJpZXM6IHtcbiAgICAgICAgICAuLi5zdGF0ZS5xdWVyaWVzLFxuICAgICAgICAgIFtxdWVyeUtleV06IHF1ZXJ5U3RhdGVcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgb3B0aW1pc3RpY1VwZGF0ZXNFdmVudFNvdXJjZVxuICB9O1xufVxuZnVuY3Rpb24gZGVsZXRlS2V5SW1tdXRhYmxlKHJlY29yZCwga2V5KSB7XG4gIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocmVjb3JkLCBrZXkpKSB7XG4gICAgY29uc3QgeyBba2V5XTogX3RvRGVsZXRlLCAuLi5yZXN0IH0gPSByZWNvcmQ7XG4gICAgcmV0dXJuIHJlc3Q7XG4gIH1cbiAgcmV0dXJuIHJlY29yZDtcbn1cbmZ1bmN0aW9uIGNvbXBhcmVUaHJlYWRzKHRocmVhZDEsIHRocmVhZDIpIHtcbiAgaWYgKHRocmVhZDEudXBkYXRlZEF0ICYmIHRocmVhZDIudXBkYXRlZEF0KSB7XG4gICAgcmV0dXJuIHRocmVhZDEudXBkYXRlZEF0ID4gdGhyZWFkMi51cGRhdGVkQXQgPyAxIDogdGhyZWFkMS51cGRhdGVkQXQgPCB0aHJlYWQyLnVwZGF0ZWRBdCA/IC0xIDogMDtcbiAgfSBlbHNlIGlmICh0aHJlYWQxLnVwZGF0ZWRBdCB8fCB0aHJlYWQyLnVwZGF0ZWRBdCkge1xuICAgIHJldHVybiB0aHJlYWQxLnVwZGF0ZWRBdCA/IDEgOiAtMTtcbiAgfVxuICBpZiAodGhyZWFkMS5jcmVhdGVkQXQgPiB0aHJlYWQyLmNyZWF0ZWRBdCkge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2UgaWYgKHRocmVhZDEuY3JlYXRlZEF0IDwgdGhyZWFkMi5jcmVhdGVkQXQpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgcmV0dXJuIDA7XG59XG5mdW5jdGlvbiBhcHBseU9wdGltaXN0aWNVcGRhdGVzKHN0YXRlKSB7XG4gIGNvbnN0IHJlc3VsdCA9IHtcbiAgICB0aHJlYWRzOiB7XG4gICAgICAuLi5zdGF0ZS50aHJlYWRzXG4gICAgfSxcbiAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHtcbiAgICAgIC4uLnN0YXRlLmluYm94Tm90aWZpY2F0aW9uc1xuICAgIH0sXG4gICAgbm90aWZpY2F0aW9uU2V0dGluZ3M6IHtcbiAgICAgIC4uLnN0YXRlLm5vdGlmaWNhdGlvblNldHRpbmdzXG4gICAgfVxuICB9O1xuICBmb3IgKGNvbnN0IG9wdGltaXN0aWNVcGRhdGUgb2Ygc3RhdGUub3B0aW1pc3RpY1VwZGF0ZXMpIHtcbiAgICBzd2l0Y2ggKG9wdGltaXN0aWNVcGRhdGUudHlwZSkge1xuICAgICAgY2FzZSBcImNyZWF0ZS10aHJlYWRcIjoge1xuICAgICAgICByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZC5pZF0gPSBvcHRpbWlzdGljVXBkYXRlLnRocmVhZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZWRpdC10aHJlYWQtbWV0YWRhdGFcIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXTtcbiAgICAgICAgaWYgKHRocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQudXBkYXRlZEF0ICE9PSB2b2lkIDAgJiYgdGhyZWFkLnVwZGF0ZWRBdCA+IG9wdGltaXN0aWNVcGRhdGUudXBkYXRlZEF0KSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnRocmVhZHNbdGhyZWFkLmlkXSA9IHtcbiAgICAgICAgICAuLi50aHJlYWQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBvcHRpbWlzdGljVXBkYXRlLnVwZGF0ZWRBdCxcbiAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgLi4udGhyZWFkLm1ldGFkYXRhLFxuICAgICAgICAgICAgLi4ub3B0aW1pc3RpY1VwZGF0ZS5tZXRhZGF0YVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwibWFyay10aHJlYWQtYXMtcmVzb2x2ZWRcIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXTtcbiAgICAgICAgaWYgKHRocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSB7XG4gICAgICAgICAgLi4udGhyZWFkLFxuICAgICAgICAgIHJlc29sdmVkOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm1hcmstdGhyZWFkLWFzLXVucmVzb2x2ZWRcIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXTtcbiAgICAgICAgaWYgKHRocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSB7XG4gICAgICAgICAgLi4udGhyZWFkLFxuICAgICAgICAgIHJlc29sdmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjcmVhdGUtY29tbWVudFwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUuY29tbWVudC50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSB1cHNlcnRDb21tZW50KFxuICAgICAgICAgIHRocmVhZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnRcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgaW5ib3hOb3RpZmljYXRpb24gPSBPYmplY3QudmFsdWVzKHJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnMpLmZpbmQoXG4gICAgICAgICAgKG5vdGlmaWNhdGlvbikgPT4gbm90aWZpY2F0aW9uLmtpbmQgPT09IFwidGhyZWFkXCIgJiYgbm90aWZpY2F0aW9uLnRocmVhZElkID09PSB0aHJlYWQuaWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGluYm94Tm90aWZpY2F0aW9uID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zW2luYm94Tm90aWZpY2F0aW9uLmlkXSA9IHtcbiAgICAgICAgICAuLi5pbmJveE5vdGlmaWNhdGlvbixcbiAgICAgICAgICBub3RpZmllZEF0OiBvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnQuY3JlYXRlZEF0LFxuICAgICAgICAgIHJlYWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50LmNyZWF0ZWRBdFxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlZGl0LWNvbW1lbnRcIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnQudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gdXBzZXJ0Q29tbWVudChcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50XG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImRlbGV0ZS1jb21tZW50XCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSBkZWxldGVDb21tZW50KFxuICAgICAgICAgIHRocmVhZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnRJZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLmRlbGV0ZWRBdFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJkZWxldGUtdGhyZWFkXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdID0ge1xuICAgICAgICAgIC4uLnJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdLFxuICAgICAgICAgIGRlbGV0ZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5kZWxldGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBvcHRpbWlzdGljVXBkYXRlLmRlbGV0ZWRBdCxcbiAgICAgICAgICBjb21tZW50czogW11cbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYWRkLXJlYWN0aW9uXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSBhZGRSZWFjdGlvbihcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50SWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5yZWFjdGlvblxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdmUtcmVhY3Rpb25cIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXTtcbiAgICAgICAgaWYgKHRocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnRocmVhZHNbdGhyZWFkLmlkXSA9IHJlbW92ZVJlYWN0aW9uKFxuICAgICAgICAgIHRocmVhZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnRJZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLmVtb2ppLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUudXNlcklkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUucmVtb3ZlZEF0XG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm1hcmstaW5ib3gtbm90aWZpY2F0aW9uLWFzLXJlYWRcIjoge1xuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zW29wdGltaXN0aWNVcGRhdGUuaW5ib3hOb3RpZmljYXRpb25JZF0gPSB7XG4gICAgICAgICAgLi4uc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zW29wdGltaXN0aWNVcGRhdGUuaW5ib3hOb3RpZmljYXRpb25JZF0sXG4gICAgICAgICAgcmVhZEF0OiBvcHRpbWlzdGljVXBkYXRlLnJlYWRBdFxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJtYXJrLWFsbC1pbmJveC1ub3RpZmljYXRpb25zLWFzLXJlYWRcIjoge1xuICAgICAgICBmb3IgKGNvbnN0IGlkIGluIHJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnMpIHtcbiAgICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zW2lkXSA9IHtcbiAgICAgICAgICAgIC4uLnJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnNbaWRdLFxuICAgICAgICAgICAgcmVhZEF0OiBvcHRpbWlzdGljVXBkYXRlLnJlYWRBdFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZGVsZXRlLWluYm94LW5vdGlmaWNhdGlvblwiOiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBbb3B0aW1pc3RpY1VwZGF0ZS5pbmJveE5vdGlmaWNhdGlvbklkXTogXyxcbiAgICAgICAgICAuLi5pbmJveE5vdGlmaWNhdGlvbnNcbiAgICAgICAgfSA9IHJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnM7XG4gICAgICAgIHJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnMgPSBpbmJveE5vdGlmaWNhdGlvbnM7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImRlbGV0ZS1hbGwtaW5ib3gtbm90aWZpY2F0aW9uc1wiOiB7XG4gICAgICAgIHJlc3VsdC5pbmJveE5vdGlmaWNhdGlvbnMgPSB7fTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwidXBkYXRlLW5vdGlmaWNhdGlvbi1zZXR0aW5nc1wiOiB7XG4gICAgICAgIHJlc3VsdC5ub3RpZmljYXRpb25TZXR0aW5nc1tvcHRpbWlzdGljVXBkYXRlLnJvb21JZF0gPSB7XG4gICAgICAgICAgLi4ucmVzdWx0Lm5vdGlmaWNhdGlvblNldHRpbmdzW29wdGltaXN0aWNVcGRhdGUucm9vbUlkXSxcbiAgICAgICAgICAuLi5vcHRpbWlzdGljVXBkYXRlLnNldHRpbmdzXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBhcHBseVRocmVhZFVwZGF0ZXMoZXhpc3RpbmdUaHJlYWRzLCB1cGRhdGVzKSB7XG4gIGNvbnN0IHVwZGF0ZWRUaHJlYWRzID0geyAuLi5leGlzdGluZ1RocmVhZHMgfTtcbiAgdXBkYXRlcy5uZXdUaHJlYWRzLmZvckVhY2goKHRocmVhZCkgPT4ge1xuICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gdXBkYXRlZFRocmVhZHNbdGhyZWFkLmlkXTtcbiAgICBpZiAoZXhpc3RpbmdUaHJlYWQpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmVUaHJlYWRzKGV4aXN0aW5nVGhyZWFkLCB0aHJlYWQpO1xuICAgICAgaWYgKHJlc3VsdCA9PT0gMSkgcmV0dXJuO1xuICAgIH1cbiAgICB1cGRhdGVkVGhyZWFkc1t0aHJlYWQuaWRdID0gdGhyZWFkO1xuICB9KTtcbiAgdXBkYXRlcy5kZWxldGVkVGhyZWFkcy5mb3JFYWNoKCh7IGlkLCBkZWxldGVkQXQgfSkgPT4ge1xuICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gdXBkYXRlZFRocmVhZHNbaWRdO1xuICAgIGlmIChleGlzdGluZ1RocmVhZCA9PT0gdm9pZCAwKSByZXR1cm47XG4gICAgZXhpc3RpbmdUaHJlYWQuZGVsZXRlZEF0ID0gZGVsZXRlZEF0O1xuICAgIGV4aXN0aW5nVGhyZWFkLnVwZGF0ZWRBdCA9IGRlbGV0ZWRBdDtcbiAgICBleGlzdGluZ1RocmVhZC5jb21tZW50cyA9IFtdO1xuICB9KTtcbiAgcmV0dXJuIHVwZGF0ZWRUaHJlYWRzO1xufVxuZnVuY3Rpb24gYXBwbHlOb3RpZmljYXRpb25zVXBkYXRlcyhleGlzdGluZ0luYm94Tm90aWZpY2F0aW9ucywgdXBkYXRlcykge1xuICBjb25zdCB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zID0geyAuLi5leGlzdGluZ0luYm94Tm90aWZpY2F0aW9ucyB9O1xuICB1cGRhdGVzLm5ld0luYm94Tm90aWZpY2F0aW9ucy5mb3JFYWNoKChub3RpZmljYXRpb24pID0+IHtcbiAgICBjb25zdCBleGlzdGluZ05vdGlmaWNhdGlvbiA9IHVwZGF0ZWRJbmJveE5vdGlmaWNhdGlvbnNbbm90aWZpY2F0aW9uLmlkXTtcbiAgICBpZiAoZXhpc3RpbmdOb3RpZmljYXRpb24pIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmVJbmJveE5vdGlmaWNhdGlvbnMoXG4gICAgICAgIGV4aXN0aW5nTm90aWZpY2F0aW9uLFxuICAgICAgICBub3RpZmljYXRpb25cbiAgICAgICk7XG4gICAgICBpZiAocmVzdWx0ID09PSAxKSByZXR1cm47XG4gICAgfVxuICAgIHVwZGF0ZWRJbmJveE5vdGlmaWNhdGlvbnNbbm90aWZpY2F0aW9uLmlkXSA9IG5vdGlmaWNhdGlvbjtcbiAgfSk7XG4gIHVwZGF0ZXMuZGVsZXRlZE5vdGlmaWNhdGlvbnMuZm9yRWFjaChcbiAgICAoeyBpZCB9KSA9PiBkZWxldGUgdXBkYXRlZEluYm94Tm90aWZpY2F0aW9uc1tpZF1cbiAgKTtcbiAgcmV0dXJuIHVwZGF0ZWRJbmJveE5vdGlmaWNhdGlvbnM7XG59XG5mdW5jdGlvbiBjb21wYXJlSW5ib3hOb3RpZmljYXRpb25zKGluYm94Tm90aWZpY2F0aW9uQSwgaW5ib3hOb3RpZmljYXRpb25CKSB7XG4gIGlmIChpbmJveE5vdGlmaWNhdGlvbkEubm90aWZpZWRBdCA+IGluYm94Tm90aWZpY2F0aW9uQi5ub3RpZmllZEF0KSB7XG4gICAgcmV0dXJuIDE7XG4gIH0gZWxzZSBpZiAoaW5ib3hOb3RpZmljYXRpb25BLm5vdGlmaWVkQXQgPCBpbmJveE5vdGlmaWNhdGlvbkIubm90aWZpZWRBdCkge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBpZiAoaW5ib3hOb3RpZmljYXRpb25BLnJlYWRBdCAmJiBpbmJveE5vdGlmaWNhdGlvbkIucmVhZEF0KSB7XG4gICAgcmV0dXJuIGluYm94Tm90aWZpY2F0aW9uQS5yZWFkQXQgPiBpbmJveE5vdGlmaWNhdGlvbkIucmVhZEF0ID8gMSA6IGluYm94Tm90aWZpY2F0aW9uQS5yZWFkQXQgPCBpbmJveE5vdGlmaWNhdGlvbkIucmVhZEF0ID8gLTEgOiAwO1xuICB9IGVsc2UgaWYgKGluYm94Tm90aWZpY2F0aW9uQS5yZWFkQXQgfHwgaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCkge1xuICAgIHJldHVybiBpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0ID8gMSA6IC0xO1xuICB9XG4gIHJldHVybiAwO1xufVxuZnVuY3Rpb24gdXBzZXJ0Q29tbWVudCh0aHJlYWQsIGNvbW1lbnQpIHtcbiAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgaWYgKGNvbW1lbnQudGhyZWFkSWQgIT09IHRocmVhZC5pZCkge1xuICAgIHdhcm4oXG4gICAgICBgQ29tbWVudCAke2NvbW1lbnQuaWR9IGRvZXMgbm90IGJlbG9uZyB0byB0aHJlYWQgJHt0aHJlYWQuaWR9YFxuICAgICk7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCBleGlzdGluZ0NvbW1lbnQgPSB0aHJlYWQuY29tbWVudHMuZmluZChcbiAgICAoZXhpc3RpbmdDb21tZW50MikgPT4gZXhpc3RpbmdDb21tZW50Mi5pZCA9PT0gY29tbWVudC5pZFxuICApO1xuICBpZiAoZXhpc3RpbmdDb21tZW50ID09PSB2b2lkIDApIHtcbiAgICBjb25zdCB1cGRhdGVkQXQgPSBuZXcgRGF0ZShcbiAgICAgIE1hdGgubWF4KHRocmVhZC51cGRhdGVkQXQ/LmdldFRpbWUoKSB8fCAwLCBjb21tZW50LmNyZWF0ZWRBdC5nZXRUaW1lKCkpXG4gICAgKTtcbiAgICBjb25zdCB1cGRhdGVkVGhyZWFkID0ge1xuICAgICAgLi4udGhyZWFkLFxuICAgICAgdXBkYXRlZEF0LFxuICAgICAgY29tbWVudHM6IFsuLi50aHJlYWQuY29tbWVudHMsIGNvbW1lbnRdXG4gICAgfTtcbiAgICByZXR1cm4gdXBkYXRlZFRocmVhZDtcbiAgfVxuICBpZiAoZXhpc3RpbmdDb21tZW50LmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBpZiAoZXhpc3RpbmdDb21tZW50LmVkaXRlZEF0ID09PSB2b2lkIDAgfHwgY29tbWVudC5lZGl0ZWRBdCA9PT0gdm9pZCAwIHx8IGV4aXN0aW5nQ29tbWVudC5lZGl0ZWRBdCA8PSBjb21tZW50LmVkaXRlZEF0KSB7XG4gICAgY29uc3QgdXBkYXRlZENvbW1lbnRzID0gdGhyZWFkLmNvbW1lbnRzLm1hcChcbiAgICAgIChleGlzdGluZ0NvbW1lbnQyKSA9PiBleGlzdGluZ0NvbW1lbnQyLmlkID09PSBjb21tZW50LmlkID8gY29tbWVudCA6IGV4aXN0aW5nQ29tbWVudDJcbiAgICApO1xuICAgIGNvbnN0IHVwZGF0ZWRUaHJlYWQgPSB7XG4gICAgICAuLi50aHJlYWQsXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKFxuICAgICAgICBNYXRoLm1heChcbiAgICAgICAgICB0aHJlYWQudXBkYXRlZEF0Py5nZXRUaW1lKCkgfHwgMCxcbiAgICAgICAgICBjb21tZW50LmVkaXRlZEF0Py5nZXRUaW1lKCkgfHwgY29tbWVudC5jcmVhdGVkQXQuZ2V0VGltZSgpXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICBjb21tZW50czogdXBkYXRlZENvbW1lbnRzXG4gICAgfTtcbiAgICByZXR1cm4gdXBkYXRlZFRocmVhZDtcbiAgfVxuICByZXR1cm4gdGhyZWFkO1xufVxuZnVuY3Rpb24gZGVsZXRlQ29tbWVudCh0aHJlYWQsIGNvbW1lbnRJZCwgZGVsZXRlZEF0KSB7XG4gIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGNvbnN0IGV4aXN0aW5nQ29tbWVudCA9IHRocmVhZC5jb21tZW50cy5maW5kKFxuICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSBjb21tZW50SWRcbiAgKTtcbiAgaWYgKGV4aXN0aW5nQ29tbWVudCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBpZiAoZXhpc3RpbmdDb21tZW50LmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCB1cGRhdGVkQ29tbWVudHMgPSB0aHJlYWQuY29tbWVudHMubWFwKFxuICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSBjb21tZW50SWQgPyB7XG4gICAgICAuLi5jb21tZW50LFxuICAgICAgZGVsZXRlZEF0LFxuICAgICAgYm9keTogdm9pZCAwXG4gICAgfSA6IGNvbW1lbnRcbiAgKTtcbiAgaWYgKCF1cGRhdGVkQ29tbWVudHMuc29tZSgoY29tbWVudCkgPT4gY29tbWVudC5kZWxldGVkQXQgPT09IHZvaWQgMCkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4udGhyZWFkLFxuICAgICAgZGVsZXRlZEF0LFxuICAgICAgdXBkYXRlZEF0OiBkZWxldGVkQXQsXG4gICAgICBjb21tZW50czogW11cbiAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgLi4udGhyZWFkLFxuICAgIHVwZGF0ZWRBdDogZGVsZXRlZEF0LFxuICAgIGNvbW1lbnRzOiB1cGRhdGVkQ29tbWVudHNcbiAgfTtcbn1cbmZ1bmN0aW9uIGFkZFJlYWN0aW9uKHRocmVhZCwgY29tbWVudElkLCByZWFjdGlvbikge1xuICBpZiAodGhyZWFkLmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCBleGlzdGluZ0NvbW1lbnQgPSB0aHJlYWQuY29tbWVudHMuZmluZChcbiAgICAoY29tbWVudCkgPT4gY29tbWVudC5pZCA9PT0gY29tbWVudElkXG4gICk7XG4gIGlmIChleGlzdGluZ0NvbW1lbnQgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgdXBkYXRlZENvbW1lbnRzID0gdGhyZWFkLmNvbW1lbnRzLm1hcChcbiAgICAoY29tbWVudCkgPT4gY29tbWVudC5pZCA9PT0gY29tbWVudElkID8ge1xuICAgICAgLi4uY29tbWVudCxcbiAgICAgIHJlYWN0aW9uczogdXBzZXJ0UmVhY3Rpb24oY29tbWVudC5yZWFjdGlvbnMsIHJlYWN0aW9uKVxuICAgIH0gOiBjb21tZW50XG4gICk7XG4gIHJldHVybiB7XG4gICAgLi4udGhyZWFkLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoXG4gICAgICBNYXRoLm1heChyZWFjdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpLCB0aHJlYWQudXBkYXRlZEF0Py5nZXRUaW1lKCkgfHwgMClcbiAgICApLFxuICAgIGNvbW1lbnRzOiB1cGRhdGVkQ29tbWVudHNcbiAgfTtcbn1cbmZ1bmN0aW9uIHJlbW92ZVJlYWN0aW9uKHRocmVhZCwgY29tbWVudElkLCBlbW9qaSwgdXNlcklkLCByZW1vdmVkQXQpIHtcbiAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgZXhpc3RpbmdDb21tZW50ID0gdGhyZWFkLmNvbW1lbnRzLmZpbmQoXG4gICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IGNvbW1lbnRJZFxuICApO1xuICBpZiAoZXhpc3RpbmdDb21tZW50ID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGlmIChleGlzdGluZ0NvbW1lbnQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGNvbnN0IHVwZGF0ZWRDb21tZW50cyA9IHRocmVhZC5jb21tZW50cy5tYXAoXG4gICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IGNvbW1lbnRJZCA/IHtcbiAgICAgIC4uLmNvbW1lbnQsXG4gICAgICByZWFjdGlvbnM6IGNvbW1lbnQucmVhY3Rpb25zLm1hcChcbiAgICAgICAgKHJlYWN0aW9uKSA9PiByZWFjdGlvbi5lbW9qaSA9PT0gZW1vamkgPyB7XG4gICAgICAgICAgLi4ucmVhY3Rpb24sXG4gICAgICAgICAgdXNlcnM6IHJlYWN0aW9uLnVzZXJzLmZpbHRlcigodXNlcikgPT4gdXNlci5pZCAhPT0gdXNlcklkKVxuICAgICAgICB9IDogcmVhY3Rpb25cbiAgICAgICkuZmlsdGVyKChyZWFjdGlvbikgPT4gcmVhY3Rpb24udXNlcnMubGVuZ3RoID4gMClcbiAgICAgIC8vIFJlbW92ZSByZWFjdGlvbnMgd2l0aCBubyB1c2VycyBsZWZ0XG4gICAgfSA6IGNvbW1lbnRcbiAgKTtcbiAgcmV0dXJuIHtcbiAgICAuLi50aHJlYWQsXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShcbiAgICAgIE1hdGgubWF4KHJlbW92ZWRBdC5nZXRUaW1lKCksIHRocmVhZC51cGRhdGVkQXQ/LmdldFRpbWUoKSB8fCAwKVxuICAgICksXG4gICAgY29tbWVudHM6IHVwZGF0ZWRDb21tZW50c1xuICB9O1xufVxuZnVuY3Rpb24gdXBzZXJ0UmVhY3Rpb24ocmVhY3Rpb25zLCByZWFjdGlvbikge1xuICBjb25zdCBleGlzdGluZ1JlYWN0aW9uID0gcmVhY3Rpb25zLmZpbmQoXG4gICAgKGV4aXN0aW5nUmVhY3Rpb24yKSA9PiBleGlzdGluZ1JlYWN0aW9uMi5lbW9qaSA9PT0gcmVhY3Rpb24uZW1vamlcbiAgKTtcbiAgaWYgKGV4aXN0aW5nUmVhY3Rpb24gPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBbXG4gICAgICAuLi5yZWFjdGlvbnMsXG4gICAgICB7XG4gICAgICAgIGVtb2ppOiByZWFjdGlvbi5lbW9qaSxcbiAgICAgICAgY3JlYXRlZEF0OiByZWFjdGlvbi5jcmVhdGVkQXQsXG4gICAgICAgIHVzZXJzOiBbeyBpZDogcmVhY3Rpb24udXNlcklkIH1dXG4gICAgICB9XG4gICAgXTtcbiAgfVxuICBpZiAoZXhpc3RpbmdSZWFjdGlvbi51c2Vycy5zb21lKCh1c2VyKSA9PiB1c2VyLmlkID09PSByZWFjdGlvbi51c2VySWQpID09PSBmYWxzZSkge1xuICAgIHJldHVybiByZWFjdGlvbnMubWFwKFxuICAgICAgKGV4aXN0aW5nUmVhY3Rpb24yKSA9PiBleGlzdGluZ1JlYWN0aW9uMi5lbW9qaSA9PT0gcmVhY3Rpb24uZW1vamkgPyB7XG4gICAgICAgIC4uLmV4aXN0aW5nUmVhY3Rpb24yLFxuICAgICAgICB1c2VyczogWy4uLmV4aXN0aW5nUmVhY3Rpb24yLnVzZXJzLCB7IGlkOiByZWFjdGlvbi51c2VySWQgfV1cbiAgICAgIH0gOiBleGlzdGluZ1JlYWN0aW9uMlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHJlYWN0aW9ucztcbn1cblxuLy8gc3JjL2NsaWVudC50c1xudmFyIE1JTl9USFJPVFRMRSA9IDE2O1xudmFyIE1BWF9USFJPVFRMRSA9IDFlMztcbnZhciBERUZBVUxUX1RIUk9UVExFID0gMTAwO1xudmFyIE1JTl9CQUNLR1JPVU5EX0tFRVBfQUxJVkVfVElNRU9VVCA9IDE1ZTM7XG52YXIgTUlOX0xPU1RfQ09OTkVDVElPTl9USU1FT1VUID0gMjAwO1xudmFyIFJFQ09NTUVOREVEX01JTl9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCA9IDFlMztcbnZhciBNQVhfTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQgPSAzZTQ7XG52YXIgREVGQVVMVF9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCA9IDVlMztcbnZhciBSRVNPTFZFX1VTRVJTX0JBVENIX0RFTEFZID0gNTA7XG52YXIgUkVTT0xWRV9ST09NU19JTkZPX0JBVENIX0RFTEFZID0gNTA7XG5mdW5jdGlvbiBnZXRCYXNlVXJsKGJhc2VVcmwpIHtcbiAgaWYgKHR5cGVvZiBiYXNlVXJsID09PSBcInN0cmluZ1wiICYmIGJhc2VVcmwuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICByZXR1cm4gYmFzZVVybDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gREVGQVVMVF9CQVNFX1VSTDtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0QXV0aEJlYXJlckhlYWRlckZyb21BdXRoVmFsdWUoYXV0aFZhbHVlKSB7XG4gIGlmIChhdXRoVmFsdWUudHlwZSA9PT0gXCJwdWJsaWNcIikge1xuICAgIHJldHVybiBhdXRoVmFsdWUucHVibGljQXBpS2V5O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhdXRoVmFsdWUudG9rZW4ucmF3O1xuICB9XG59XG5mdW5jdGlvbiBjcmVhdGVDbGllbnQob3B0aW9ucykge1xuICBjb25zdCBjbGllbnRPcHRpb25zID0gb3B0aW9ucztcbiAgY29uc3QgdGhyb3R0bGVEZWxheSA9IGdldFRocm90dGxlKGNsaWVudE9wdGlvbnMudGhyb3R0bGUgPz8gREVGQVVMVF9USFJPVFRMRSk7XG4gIGNvbnN0IGxvc3RDb25uZWN0aW9uVGltZW91dCA9IGdldExvc3RDb25uZWN0aW9uVGltZW91dChcbiAgICBjbGllbnRPcHRpb25zLmxvc3RDb25uZWN0aW9uVGltZW91dCA/PyBERUZBVUxUX0xPU1RfQ09OTkVDVElPTl9USU1FT1VUXG4gICk7XG4gIGNvbnN0IGJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0ID0gZ2V0QmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQoXG4gICAgY2xpZW50T3B0aW9ucy5iYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dFxuICApO1xuICBjb25zdCBiYXNlVXJsID0gZ2V0QmFzZVVybChjbGllbnRPcHRpb25zLmJhc2VVcmwpO1xuICBjb25zdCBhdXRoTWFuYWdlciA9IGNyZWF0ZUF1dGhNYW5hZ2VyKG9wdGlvbnMpO1xuICBjb25zdCByb29tc0J5SWQgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBmdW5jdGlvbiB0ZWFyZG93blJvb20ocm9vbSkge1xuICAgIHVubGlua0RldlRvb2xzKHJvb20uaWQpO1xuICAgIHJvb21zQnlJZC5kZWxldGUocm9vbS5pZCk7XG4gICAgcm9vbS5kZXN0cm95KCk7XG4gIH1cbiAgZnVuY3Rpb24gbGVhc2VSb29tKGRldGFpbHMpIHtcbiAgICBjb25zdCBsZWF2ZSA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHNlbGYgPSBsZWF2ZTtcbiAgICAgIGlmICghZGV0YWlscy51bnN1YnMuZGVsZXRlKHNlbGYpKSB7XG4gICAgICAgIHdhcm4oXG4gICAgICAgICAgXCJUaGlzIGxlYXZlIGZ1bmN0aW9uIHdhcyBhbHJlYWR5IGNhbGxlZC4gQ2FsbGluZyBpdCBtb3JlIHRoYW4gb25jZSBoYXMgbm8gZWZmZWN0LlwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZGV0YWlscy51bnN1YnMuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgIHRlYXJkb3duUm9vbShkZXRhaWxzLnJvb20pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBkZXRhaWxzLnVuc3Vicy5hZGQobGVhdmUpO1xuICAgIHJldHVybiB7XG4gICAgICByb29tOiBkZXRhaWxzLnJvb20sXG4gICAgICBsZWF2ZVxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gZW50ZXJSb29tKHJvb21JZCwgLi4uYXJncykge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gcm9vbXNCeUlkLmdldChyb29tSWQpO1xuICAgIGlmIChleGlzdGluZyAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbGVhc2VSb29tKGV4aXN0aW5nKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0aW9uczIgPSBhcmdzWzBdID8/IHt9O1xuICAgIGNvbnN0IGluaXRpYWxQcmVzZW5jZSA9ICh0eXBlb2Ygb3B0aW9uczIuaW5pdGlhbFByZXNlbmNlID09PSBcImZ1bmN0aW9uXCIgPyBvcHRpb25zMi5pbml0aWFsUHJlc2VuY2Uocm9vbUlkKSA6IG9wdGlvbnMyLmluaXRpYWxQcmVzZW5jZSkgPz8ge307XG4gICAgY29uc3QgaW5pdGlhbFN0b3JhZ2UgPSAodHlwZW9mIG9wdGlvbnMyLmluaXRpYWxTdG9yYWdlID09PSBcImZ1bmN0aW9uXCIgPyBvcHRpb25zMi5pbml0aWFsU3RvcmFnZShyb29tSWQpIDogb3B0aW9uczIuaW5pdGlhbFN0b3JhZ2UpID8/IHt9O1xuICAgIGNvbnN0IG5ld1Jvb20gPSBjcmVhdGVSb29tKFxuICAgICAgeyBpbml0aWFsUHJlc2VuY2UsIGluaXRpYWxTdG9yYWdlIH0sXG4gICAgICB7XG4gICAgICAgIHJvb21JZCxcbiAgICAgICAgdGhyb3R0bGVEZWxheSxcbiAgICAgICAgbG9zdENvbm5lY3Rpb25UaW1lb3V0LFxuICAgICAgICBiYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dCxcbiAgICAgICAgcG9seWZpbGxzOiBjbGllbnRPcHRpb25zLnBvbHlmaWxscyxcbiAgICAgICAgZGVsZWdhdGVzOiBjbGllbnRPcHRpb25zLm1vY2tlZERlbGVnYXRlcyA/PyB7XG4gICAgICAgICAgY3JlYXRlU29ja2V0OiBtYWtlQ3JlYXRlU29ja2V0RGVsZWdhdGVGb3JSb29tKFxuICAgICAgICAgICAgcm9vbUlkLFxuICAgICAgICAgICAgYmFzZVVybCxcbiAgICAgICAgICAgIGNsaWVudE9wdGlvbnMucG9seWZpbGxzPy5XZWJTb2NrZXRcbiAgICAgICAgICApLFxuICAgICAgICAgIGF1dGhlbnRpY2F0ZTogbWFrZUF1dGhEZWxlZ2F0ZUZvclJvb20ocm9vbUlkLCBhdXRoTWFuYWdlcilcbiAgICAgICAgfSxcbiAgICAgICAgZW5hYmxlRGVidWdMb2dnaW5nOiBjbGllbnRPcHRpb25zLmVuYWJsZURlYnVnTG9nZ2luZyxcbiAgICAgICAgdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXM6IG9wdGlvbnMyPy51bnN0YWJsZV9iYXRjaGVkVXBkYXRlcyxcbiAgICAgICAgYmFzZVVybCxcbiAgICAgICAgdW5zdGFibGVfZmFsbGJhY2tUb0hUVFA6ICEhY2xpZW50T3B0aW9ucy51bnN0YWJsZV9mYWxsYmFja1RvSFRUUCxcbiAgICAgICAgdW5zdGFibGVfc3RyZWFtRGF0YTogISFjbGllbnRPcHRpb25zLnVuc3RhYmxlX3N0cmVhbURhdGFcbiAgICAgIH1cbiAgICApO1xuICAgIGNvbnN0IG5ld1Jvb21EZXRhaWxzID0ge1xuICAgICAgcm9vbTogbmV3Um9vbSxcbiAgICAgIHVuc3ViczogLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKVxuICAgIH07XG4gICAgcm9vbXNCeUlkLnNldChyb29tSWQsIG5ld1Jvb21EZXRhaWxzKTtcbiAgICBzZXR1cERldlRvb2xzKCgpID0+IEFycmF5LmZyb20ocm9vbXNCeUlkLmtleXMoKSkpO1xuICAgIGxpbmtEZXZUb29scyhyb29tSWQsIG5ld1Jvb20pO1xuICAgIGNvbnN0IHNob3VsZENvbm5lY3QgPSBvcHRpb25zMi5hdXRvQ29ubmVjdCA/PyB0cnVlO1xuICAgIGlmIChzaG91bGRDb25uZWN0KSB7XG4gICAgICBpZiAodHlwZW9mIGF0b2IgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgaWYgKGNsaWVudE9wdGlvbnMucG9seWZpbGxzPy5hdG9iID09PSB2b2lkIDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIllvdSBuZWVkIHRvIHBvbHlmaWxsIGF0b2IgdG8gdXNlIHRoZSBjbGllbnQgaW4geW91ciBlbnZpcm9ubWVudC4gUGxlYXNlIGZvbGxvdyB0aGUgaW5zdHJ1Y3Rpb25zIGF0IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2Vycm9ycy9saXZlYmxvY2tzLWNsaWVudC9hdG9iLXBvbHlmaWxsXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGdsb2JhbC5hdG9iID0gY2xpZW50T3B0aW9ucy5wb2x5ZmlsbHMuYXRvYjtcbiAgICAgIH1cbiAgICAgIG5ld1Jvb20uY29ubmVjdCgpO1xuICAgIH1cbiAgICByZXR1cm4gbGVhc2VSb29tKG5ld1Jvb21EZXRhaWxzKTtcbiAgfVxuICBmdW5jdGlvbiBnZXRSb29tKHJvb21JZCkge1xuICAgIGNvbnN0IHJvb20gPSByb29tc0J5SWQuZ2V0KHJvb21JZCk/LnJvb207XG4gICAgcmV0dXJuIHJvb20gPyByb29tIDogbnVsbDtcbiAgfVxuICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgYXV0aE1hbmFnZXIucmVzZXQoKTtcbiAgICBmb3IgKGNvbnN0IHsgcm9vbSB9IG9mIHJvb21zQnlJZC52YWx1ZXMoKSkge1xuICAgICAgaWYgKCFpc0lkbGUocm9vbS5nZXRTdGF0dXMoKSkpIHtcbiAgICAgICAgcm9vbS5yZWNvbm5lY3QoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgY29uc3QgY3VycmVudFVzZXJJZFN0b3JlID0gY3JlYXRlU3RvcmUobnVsbCk7XG4gIGNvbnN0IHtcbiAgICBnZXRJbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgZ2V0SW5ib3hOb3RpZmljYXRpb25zU2luY2UsXG4gICAgZ2V0VW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQsXG4gICAgbWFya0FsbEluYm94Tm90aWZpY2F0aW9uc0FzUmVhZCxcbiAgICBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQsXG4gICAgZGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zLFxuICAgIGRlbGV0ZUluYm94Tm90aWZpY2F0aW9uXG4gIH0gPSBjcmVhdGVOb3RpZmljYXRpb25zQXBpKHtcbiAgICBiYXNlVXJsLFxuICAgIGZldGNoZXI6IGNsaWVudE9wdGlvbnMucG9seWZpbGxzPy5mZXRjaCB8fCAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgIGZldGNoLFxuICAgIGF1dGhNYW5hZ2VyLFxuICAgIGN1cnJlbnRVc2VySWRTdG9yZVxuICB9KTtcbiAgY29uc3QgY2FjaGVTdG9yZSA9IGNyZWF0ZUNsaWVudFN0b3JlKCk7XG4gIGNvbnN0IHJlc29sdmVVc2VycyA9IGNsaWVudE9wdGlvbnMucmVzb2x2ZVVzZXJzO1xuICBjb25zdCB3YXJuSWZOb1Jlc29sdmVVc2VycyA9IGNyZWF0ZURldmVsb3BtZW50V2FybmluZyhcbiAgICAoKSA9PiAhcmVzb2x2ZVVzZXJzLFxuICAgIFwiU2V0IHRoZSByZXNvbHZlVXNlcnMgb3B0aW9uIGluIGNyZWF0ZUNsaWVudCB0byBzcGVjaWZ5IHVzZXIgaW5mby5cIlxuICApO1xuICBjb25zdCB1c2Vyc1N0b3JlID0gY3JlYXRlQmF0Y2hTdG9yZShcbiAgICBhc3luYyAoYmF0Y2hlZFVzZXJJZHMpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZHMgPSBiYXRjaGVkVXNlcklkcy5mbGF0KCk7XG4gICAgICBjb25zdCB1c2VycyA9IGF3YWl0IHJlc29sdmVVc2Vycz8uKHsgdXNlcklkcyB9KTtcbiAgICAgIHdhcm5JZk5vUmVzb2x2ZVVzZXJzKCk7XG4gICAgICByZXR1cm4gdXNlcnMgPz8gdXNlcklkcy5tYXAoKCkgPT4gdm9pZCAwKTtcbiAgICB9LFxuICAgIHsgZGVsYXk6IFJFU09MVkVfVVNFUlNfQkFUQ0hfREVMQVkgfVxuICApO1xuICBjb25zdCByZXNvbHZlUm9vbXNJbmZvID0gY2xpZW50T3B0aW9ucy5yZXNvbHZlUm9vbXNJbmZvO1xuICBjb25zdCB3YXJuSWZOb1Jlc29sdmVSb29tc0luZm8gPSBjcmVhdGVEZXZlbG9wbWVudFdhcm5pbmcoXG4gICAgKCkgPT4gIXJlc29sdmVSb29tc0luZm8sXG4gICAgXCJTZXQgdGhlIHJlc29sdmVSb29tc0luZm8gb3B0aW9uIGluIGNyZWF0ZUNsaWVudCB0byBzcGVjaWZ5IHJvb20gaW5mby5cIlxuICApO1xuICBjb25zdCByb29tc0luZm9TdG9yZSA9IGNyZWF0ZUJhdGNoU3RvcmUoXG4gICAgYXN5bmMgKGJhdGNoZWRSb29tSWRzKSA9PiB7XG4gICAgICBjb25zdCByb29tSWRzID0gYmF0Y2hlZFJvb21JZHMuZmxhdCgpO1xuICAgICAgY29uc3Qgcm9vbXNJbmZvID0gYXdhaXQgcmVzb2x2ZVJvb21zSW5mbz8uKHsgcm9vbUlkcyB9KTtcbiAgICAgIHdhcm5JZk5vUmVzb2x2ZVJvb21zSW5mbygpO1xuICAgICAgcmV0dXJuIHJvb21zSW5mbyA/PyByb29tSWRzLm1hcCgoKSA9PiB2b2lkIDApO1xuICAgIH0sXG4gICAgeyBkZWxheTogUkVTT0xWRV9ST09NU19JTkZPX0JBVENIX0RFTEFZIH1cbiAgKTtcbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShcbiAgICB7XG4gICAgICBlbnRlclJvb20sXG4gICAgICBnZXRSb29tLFxuICAgICAgbG9nb3V0LFxuICAgICAgZ2V0SW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgZ2V0SW5ib3hOb3RpZmljYXRpb25zU2luY2UsXG4gICAgICBnZXRVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudCxcbiAgICAgIG1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQsXG4gICAgICBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQsXG4gICAgICBkZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgICBkZWxldGVJbmJveE5vdGlmaWNhdGlvbixcbiAgICAgIC8vIEludGVybmFsXG4gICAgICBba0ludGVybmFsXToge1xuICAgICAgICBjdXJyZW50VXNlcklkU3RvcmUsXG4gICAgICAgIHJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnM6IGNsaWVudE9wdGlvbnMucmVzb2x2ZU1lbnRpb25TdWdnZXN0aW9ucyxcbiAgICAgICAgY2FjaGVTdG9yZSxcbiAgICAgICAgdXNlcnNTdG9yZSxcbiAgICAgICAgcm9vbXNJbmZvU3RvcmUsXG4gICAgICAgIGdldFJvb21JZHMoKSB7XG4gICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20ocm9vbXNCeUlkLmtleXMoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGtJbnRlcm5hbCxcbiAgICB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgIH1cbiAgKTtcbn1cbnZhciBOb3RpZmljYXRpb25zQXBpRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgc3RhdHVzLCBkZXRhaWxzKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICB0aGlzLmRldGFpbHMgPSBkZXRhaWxzO1xuICB9XG59O1xuZnVuY3Rpb24gY2hlY2tCb3VuZHMob3B0aW9uLCB2YWx1ZSwgbWluLCBtYXgsIHJlY29tbWVuZGVkTWluKSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09IFwibnVtYmVyXCIgfHwgdmFsdWUgPCBtaW4gfHwgbWF4ICE9PSB2b2lkIDAgJiYgdmFsdWUgPiBtYXgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBtYXggIT09IHZvaWQgMCA/IGAke29wdGlvbn0gc2hvdWxkIGJlIGJldHdlZW4gJHtyZWNvbW1lbmRlZE1pbiA/PyBtaW59IGFuZCAke21heH0uYCA6IGAke29wdGlvbn0gc2hvdWxkIGJlIGF0IGxlYXN0ICR7cmVjb21tZW5kZWRNaW4gPz8gbWlufS5gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBnZXRCYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dCh2YWx1ZSkge1xuICBpZiAodmFsdWUgPT09IHZvaWQgMCkgcmV0dXJuIHZvaWQgMDtcbiAgcmV0dXJuIGNoZWNrQm91bmRzKFxuICAgIFwiYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXRcIixcbiAgICB2YWx1ZSxcbiAgICBNSU5fQkFDS0dST1VORF9LRUVQX0FMSVZFX1RJTUVPVVRcbiAgKTtcbn1cbmZ1bmN0aW9uIGdldFRocm90dGxlKHZhbHVlKSB7XG4gIHJldHVybiBjaGVja0JvdW5kcyhcInRocm90dGxlXCIsIHZhbHVlLCBNSU5fVEhST1RUTEUsIE1BWF9USFJPVFRMRSk7XG59XG5mdW5jdGlvbiBnZXRMb3N0Q29ubmVjdGlvblRpbWVvdXQodmFsdWUpIHtcbiAgcmV0dXJuIGNoZWNrQm91bmRzKFxuICAgIFwibG9zdENvbm5lY3Rpb25UaW1lb3V0XCIsXG4gICAgdmFsdWUsXG4gICAgTUlOX0xPU1RfQ09OTkVDVElPTl9USU1FT1VULFxuICAgIE1BWF9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCxcbiAgICBSRUNPTU1FTkRFRF9NSU5fTE9TVF9DT05ORUNUSU9OX1RJTUVPVVRcbiAgKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURldmVsb3BtZW50V2FybmluZyhjb25kaXRpb24sIC4uLmFyZ3MpIHtcbiAgbGV0IGhhc1dhcm5lZCA9IGZhbHNlO1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmICghaGFzV2FybmVkICYmICh0eXBlb2YgY29uZGl0aW9uID09PSBcImZ1bmN0aW9uXCIgPyBjb25kaXRpb24oKSA6IGNvbmRpdGlvbikpIHtcbiAgICAgICAgd2FybiguLi5hcmdzKTtcbiAgICAgICAgaGFzV2FybmVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgfTtcbiAgfVxufVxuXG4vLyBzcmMvY29tbWVudHMvY29tbWVudC1ib2R5LnRzXG5mdW5jdGlvbiBpc0NvbW1lbnRCb2R5UGFyYWdyYXBoKGVsZW1lbnQpIHtcbiAgcmV0dXJuIFwidHlwZVwiIGluIGVsZW1lbnQgJiYgZWxlbWVudC50eXBlID09PSBcIm1lbnRpb25cIjtcbn1cbmZ1bmN0aW9uIGlzQ29tbWVudEJvZHlUZXh0KGVsZW1lbnQpIHtcbiAgcmV0dXJuICEoXCJ0eXBlXCIgaW4gZWxlbWVudCkgJiYgXCJ0ZXh0XCIgaW4gZWxlbWVudCAmJiB0eXBlb2YgZWxlbWVudC50ZXh0ID09PSBcInN0cmluZ1wiO1xufVxuZnVuY3Rpb24gaXNDb21tZW50Qm9keU1lbnRpb24oZWxlbWVudCkge1xuICByZXR1cm4gXCJ0eXBlXCIgaW4gZWxlbWVudCAmJiBlbGVtZW50LnR5cGUgPT09IFwibWVudGlvblwiO1xufVxuZnVuY3Rpb24gaXNDb21tZW50Qm9keUxpbmsoZWxlbWVudCkge1xuICByZXR1cm4gXCJ0eXBlXCIgaW4gZWxlbWVudCAmJiBlbGVtZW50LnR5cGUgPT09IFwibGlua1wiO1xufVxudmFyIGNvbW1lbnRCb2R5RWxlbWVudHNHdWFyZHMgPSB7XG4gIHBhcmFncmFwaDogaXNDb21tZW50Qm9keVBhcmFncmFwaCxcbiAgdGV4dDogaXNDb21tZW50Qm9keVRleHQsXG4gIGxpbms6IGlzQ29tbWVudEJvZHlMaW5rLFxuICBtZW50aW9uOiBpc0NvbW1lbnRCb2R5TWVudGlvblxufTtcbnZhciBjb21tZW50Qm9keUVsZW1lbnRzVHlwZXMgPSB7XG4gIHBhcmFncmFwaDogXCJibG9ja1wiLFxuICB0ZXh0OiBcImlubGluZVwiLFxuICBsaW5rOiBcImlubGluZVwiLFxuICBtZW50aW9uOiBcImlubGluZVwiXG59O1xuZnVuY3Rpb24gdHJhdmVyc2VDb21tZW50Qm9keShib2R5LCBlbGVtZW50T3JWaXNpdG9yLCBwb3NzaWJseVZpc2l0b3IpIHtcbiAgaWYgKCFib2R5IHx8ICFib2R5Py5jb250ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGVsZW1lbnQgPSB0eXBlb2YgZWxlbWVudE9yVmlzaXRvciA9PT0gXCJzdHJpbmdcIiA/IGVsZW1lbnRPclZpc2l0b3IgOiB2b2lkIDA7XG4gIGNvbnN0IHR5cGUgPSBlbGVtZW50ID8gY29tbWVudEJvZHlFbGVtZW50c1R5cGVzW2VsZW1lbnRdIDogXCJhbGxcIjtcbiAgY29uc3QgZ3VhcmQgPSBlbGVtZW50ID8gY29tbWVudEJvZHlFbGVtZW50c0d1YXJkc1tlbGVtZW50XSA6ICgpID0+IHRydWU7XG4gIGNvbnN0IHZpc2l0b3IgPSB0eXBlb2YgZWxlbWVudE9yVmlzaXRvciA9PT0gXCJmdW5jdGlvblwiID8gZWxlbWVudE9yVmlzaXRvciA6IHBvc3NpYmx5VmlzaXRvcjtcbiAgZm9yIChjb25zdCBibG9jayBvZiBib2R5LmNvbnRlbnQpIHtcbiAgICBpZiAodHlwZSA9PT0gXCJhbGxcIiB8fCB0eXBlID09PSBcImJsb2NrXCIpIHtcbiAgICAgIGlmIChndWFyZChibG9jaykpIHtcbiAgICAgICAgdmlzaXRvcj8uKGJsb2NrKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGUgPT09IFwiYWxsXCIgfHwgdHlwZSA9PT0gXCJpbmxpbmVcIikge1xuICAgICAgZm9yIChjb25zdCBpbmxpbmUgb2YgYmxvY2suY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKGd1YXJkKGlubGluZSkpIHtcbiAgICAgICAgICB2aXNpdG9yPy4oaW5saW5lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZ2V0TWVudGlvbmVkSWRzRnJvbUNvbW1lbnRCb2R5KGJvZHkpIHtcbiAgY29uc3QgbWVudGlvbmVkSWRzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgdHJhdmVyc2VDb21tZW50Qm9keShcbiAgICBib2R5LFxuICAgIFwibWVudGlvblwiLFxuICAgIChtZW50aW9uKSA9PiBtZW50aW9uZWRJZHMuYWRkKG1lbnRpb24uaWQpXG4gICk7XG4gIHJldHVybiBBcnJheS5mcm9tKG1lbnRpb25lZElkcyk7XG59XG5hc3luYyBmdW5jdGlvbiByZXNvbHZlVXNlcnNJbkNvbW1lbnRCb2R5KGJvZHksIHJlc29sdmVVc2Vycykge1xuICBjb25zdCByZXNvbHZlZFVzZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgaWYgKCFyZXNvbHZlVXNlcnMpIHtcbiAgICByZXR1cm4gcmVzb2x2ZWRVc2VycztcbiAgfVxuICBjb25zdCB1c2VySWRzID0gZ2V0TWVudGlvbmVkSWRzRnJvbUNvbW1lbnRCb2R5KGJvZHkpO1xuICBjb25zdCB1c2VycyA9IGF3YWl0IHJlc29sdmVVc2Vycyh7XG4gICAgdXNlcklkc1xuICB9KTtcbiAgZm9yIChjb25zdCBbaW5kZXgsIHVzZXJJZF0gb2YgdXNlcklkcy5lbnRyaWVzKCkpIHtcbiAgICBjb25zdCB1c2VyID0gdXNlcnM/LltpbmRleF07XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIHJlc29sdmVkVXNlcnMuc2V0KHVzZXJJZCwgdXNlcik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXNvbHZlZFVzZXJzO1xufVxudmFyIGh0bWxFc2NhcGFibGVzID0ge1xuICBcIiZcIjogXCImYW1wO1wiLFxuICBcIjxcIjogXCImbHQ7XCIsXG4gIFwiPlwiOiBcIiZndDtcIixcbiAgJ1wiJzogXCImcXVvdDtcIixcbiAgXCInXCI6IFwiJiMzOTtcIlxufTtcbnZhciBodG1sRXNjYXBhYmxlc1JlZ2V4ID0gbmV3IFJlZ0V4cChcbiAgT2JqZWN0LmtleXMoaHRtbEVzY2FwYWJsZXMpLm1hcCgoZW50aXR5KSA9PiBgXFxcXCR7ZW50aXR5fWApLmpvaW4oXCJ8XCIpLFxuICBcImdcIlxuKTtcbmZ1bmN0aW9uIGh0bWxTYWZlKHZhbHVlKSB7XG4gIHJldHVybiBuZXcgSHRtbFNhZmVTdHJpbmcoW1N0cmluZyh2YWx1ZSldLCBbXSk7XG59XG5mdW5jdGlvbiBqb2luSHRtbChzdHJpbmdzKSB7XG4gIGlmIChzdHJpbmdzLmxlbmd0aCA8PSAwKSB7XG4gICAgcmV0dXJuIG5ldyBIdG1sU2FmZVN0cmluZyhbXCJcIl0sIFtdKTtcbiAgfVxuICByZXR1cm4gbmV3IEh0bWxTYWZlU3RyaW5nKFxuICAgIFtcIlwiLCAuLi5BcnJheShzdHJpbmdzLmxlbmd0aCAtIDEpLmZpbGwoXCJcIiksIFwiXCJdLFxuICAgIHN0cmluZ3NcbiAgKTtcbn1cbmZ1bmN0aW9uIGVzY2FwZUh0bWwodmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSHRtbFNhZmVTdHJpbmcpIHtcbiAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgfVxuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gam9pbkh0bWwodmFsdWUpLnRvU3RyaW5nKCk7XG4gIH1cbiAgcmV0dXJuIFN0cmluZyh2YWx1ZSkucmVwbGFjZShcbiAgICBodG1sRXNjYXBhYmxlc1JlZ2V4LFxuICAgIChjaGFyYWN0ZXIpID0+IGh0bWxFc2NhcGFibGVzW2NoYXJhY3Rlcl1cbiAgKTtcbn1cbnZhciBIdG1sU2FmZVN0cmluZyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3Ioc3RyaW5ncywgdmFsdWVzKSB7XG4gICAgdGhpcy5fc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgdGhpcy5fdmFsdWVzID0gdmFsdWVzO1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLl9zdHJpbmdzLnJlZHVjZSgocmVzdWx0LCBzdHIsIGkpID0+IHtcbiAgICAgIHJldHVybiByZXN1bHQgKyBlc2NhcGVIdG1sKG5uKHRoaXMuX3ZhbHVlc1tpIC0gMV0pKSArIHN0cjtcbiAgICB9KTtcbiAgfVxufTtcbmZ1bmN0aW9uIGh0bWwoc3RyaW5ncywgLi4udmFsdWVzKSB7XG4gIHJldHVybiBuZXcgSHRtbFNhZmVTdHJpbmcoc3RyaW5ncywgdmFsdWVzKTtcbn1cbnZhciBtYXJrZG93bkVzY2FwYWJsZXMgPSB7XG4gIF86IFwiXFxcXF9cIixcbiAgXCIqXCI6IFwiXFxcXCpcIixcbiAgXCIjXCI6IFwiXFxcXCNcIixcbiAgXCJgXCI6IFwiXFxcXGBcIixcbiAgXCJ+XCI6IFwiXFxcXH5cIixcbiAgXCIhXCI6IFwiXFxcXCFcIixcbiAgXCJ8XCI6IFwiXFxcXHxcIixcbiAgXCIoXCI6IFwiXFxcXChcIixcbiAgXCIpXCI6IFwiXFxcXClcIixcbiAgXCJ7XCI6IFwiXFxcXHtcIixcbiAgXCJ9XCI6IFwiXFxcXH1cIixcbiAgXCJbXCI6IFwiXFxcXFtcIixcbiAgXCJdXCI6IFwiXFxcXF1cIlxufTtcbnZhciBtYXJrZG93bkVzY2FwYWJsZXNSZWdleCA9IG5ldyBSZWdFeHAoXG4gIE9iamVjdC5rZXlzKG1hcmtkb3duRXNjYXBhYmxlcykubWFwKChlbnRpdHkpID0+IGBcXFxcJHtlbnRpdHl9YCkuam9pbihcInxcIiksXG4gIFwiZ1wiXG4pO1xuZnVuY3Rpb24gam9pbk1hcmtkb3duKHN0cmluZ3MpIHtcbiAgaWYgKHN0cmluZ3MubGVuZ3RoIDw9IDApIHtcbiAgICByZXR1cm4gbmV3IE1hcmtkb3duU2FmZVN0cmluZyhbXCJcIl0sIFtdKTtcbiAgfVxuICByZXR1cm4gbmV3IE1hcmtkb3duU2FmZVN0cmluZyhcbiAgICBbXCJcIiwgLi4uQXJyYXkoc3RyaW5ncy5sZW5ndGggLSAxKS5maWxsKFwiXCIpLCBcIlwiXSxcbiAgICBzdHJpbmdzXG4gICk7XG59XG5mdW5jdGlvbiBlc2NhcGVNYXJrZG93bih2YWx1ZSkge1xuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBNYXJrZG93blNhZmVTdHJpbmcpIHtcbiAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgfVxuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gam9pbk1hcmtkb3duKHZhbHVlKS50b1N0cmluZygpO1xuICB9XG4gIHJldHVybiBTdHJpbmcodmFsdWUpLnJlcGxhY2UoXG4gICAgbWFya2Rvd25Fc2NhcGFibGVzUmVnZXgsXG4gICAgKGNoYXJhY3RlcikgPT4gbWFya2Rvd25Fc2NhcGFibGVzW2NoYXJhY3Rlcl1cbiAgKTtcbn1cbnZhciBNYXJrZG93blNhZmVTdHJpbmcgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKHN0cmluZ3MsIHZhbHVlcykge1xuICAgIHRoaXMuX3N0cmluZ3MgPSBzdHJpbmdzO1xuICAgIHRoaXMuX3ZhbHVlcyA9IHZhbHVlcztcbiAgfVxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5fc3RyaW5ncy5yZWR1Y2UoKHJlc3VsdCwgc3RyLCBpKSA9PiB7XG4gICAgICByZXR1cm4gcmVzdWx0ICsgZXNjYXBlTWFya2Rvd24obm4odGhpcy5fdmFsdWVzW2kgLSAxXSkpICsgc3RyO1xuICAgIH0pO1xuICB9XG59O1xuZnVuY3Rpb24gbWFya2Rvd24oc3RyaW5ncywgLi4udmFsdWVzKSB7XG4gIHJldHVybiBuZXcgTWFya2Rvd25TYWZlU3RyaW5nKHN0cmluZ3MsIHZhbHVlcyk7XG59XG5mdW5jdGlvbiB0b0Fic29sdXRlVXJsKHVybCkge1xuICBpZiAodXJsLnN0YXJ0c1dpdGgoXCJodHRwOi8vXCIpIHx8IHVybC5zdGFydHNXaXRoKFwiaHR0cHM6Ly9cIikpIHtcbiAgICByZXR1cm4gdXJsO1xuICB9IGVsc2UgaWYgKHVybC5zdGFydHNXaXRoKFwid3d3LlwiKSkge1xuICAgIHJldHVybiBcImh0dHBzOi8vXCIgKyB1cmw7XG4gIH1cbiAgcmV0dXJuO1xufVxudmFyIHN0cmluZ2lmeUNvbW1lbnRCb2R5UGxhaW5FbGVtZW50cyA9IHtcbiAgcGFyYWdyYXBoOiAoeyBjaGlsZHJlbiB9KSA9PiBjaGlsZHJlbixcbiAgdGV4dDogKHsgZWxlbWVudCB9KSA9PiBlbGVtZW50LnRleHQsXG4gIGxpbms6ICh7IGVsZW1lbnQgfSkgPT4gZWxlbWVudC50ZXh0ID8/IGVsZW1lbnQudXJsLFxuICBtZW50aW9uOiAoeyBlbGVtZW50LCB1c2VyIH0pID0+IHtcbiAgICByZXR1cm4gYEAke3VzZXI/Lm5hbWUgPz8gZWxlbWVudC5pZH1gO1xuICB9XG59O1xudmFyIHN0cmluZ2lmeUNvbW1lbnRCb2R5SHRtbEVsZW1lbnRzID0ge1xuICBwYXJhZ3JhcGg6ICh7IGNoaWxkcmVuIH0pID0+IHtcbiAgICByZXR1cm4gY2hpbGRyZW4gPyBodG1sYDxwPiR7aHRtbFNhZmUoY2hpbGRyZW4pfTwvcD5gIDogY2hpbGRyZW47XG4gIH0sXG4gIHRleHQ6ICh7IGVsZW1lbnQgfSkgPT4ge1xuICAgIGxldCBjaGlsZHJlbiA9IGVsZW1lbnQudGV4dDtcbiAgICBpZiAoIWNoaWxkcmVuKSB7XG4gICAgICByZXR1cm4gY2hpbGRyZW47XG4gICAgfVxuICAgIGlmIChlbGVtZW50LmJvbGQpIHtcbiAgICAgIGNoaWxkcmVuID0gaHRtbGA8c3Ryb25nPiR7Y2hpbGRyZW59PC9zdHJvbmc+YDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuaXRhbGljKSB7XG4gICAgICBjaGlsZHJlbiA9IGh0bWxgPGVtPiR7Y2hpbGRyZW59PC9lbT5gO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5zdHJpa2V0aHJvdWdoKSB7XG4gICAgICBjaGlsZHJlbiA9IGh0bWxgPHM+JHtjaGlsZHJlbn08L3M+YDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuY29kZSkge1xuICAgICAgY2hpbGRyZW4gPSBodG1sYDxjb2RlPiR7Y2hpbGRyZW59PC9jb2RlPmA7XG4gICAgfVxuICAgIHJldHVybiBjaGlsZHJlbjtcbiAgfSxcbiAgbGluazogKHsgZWxlbWVudCwgaHJlZiB9KSA9PiB7XG4gICAgcmV0dXJuIGh0bWxgPGEgaHJlZj1cIiR7aHJlZn1cIiB0YXJnZXQ9XCJfYmxhbmtcIiByZWw9XCJub29wZW5lciBub3JlZmVycmVyXCI+JHtlbGVtZW50LnRleHQgPz8gZWxlbWVudC51cmx9PC9hPmA7XG4gIH0sXG4gIG1lbnRpb246ICh7IGVsZW1lbnQsIHVzZXIgfSkgPT4ge1xuICAgIHJldHVybiBodG1sYDxzcGFuIGRhdGEtbWVudGlvbj5AJHt1c2VyPy5uYW1lID8/IGVsZW1lbnQuaWR9PC9zcGFuPmA7XG4gIH1cbn07XG52YXIgc3RyaW5naWZ5Q29tbWVudEJvZHlNYXJrZG93bkVsZW1lbnRzID0ge1xuICBwYXJhZ3JhcGg6ICh7IGNoaWxkcmVuIH0pID0+IHtcbiAgICByZXR1cm4gY2hpbGRyZW47XG4gIH0sXG4gIHRleHQ6ICh7IGVsZW1lbnQgfSkgPT4ge1xuICAgIGxldCBjaGlsZHJlbiA9IGVsZW1lbnQudGV4dDtcbiAgICBpZiAoIWNoaWxkcmVuKSB7XG4gICAgICByZXR1cm4gY2hpbGRyZW47XG4gICAgfVxuICAgIGlmIChlbGVtZW50LmJvbGQpIHtcbiAgICAgIGNoaWxkcmVuID0gbWFya2Rvd25gKioke2NoaWxkcmVufSoqYDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuaXRhbGljKSB7XG4gICAgICBjaGlsZHJlbiA9IG1hcmtkb3duYF8ke2NoaWxkcmVufV9gO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5zdHJpa2V0aHJvdWdoKSB7XG4gICAgICBjaGlsZHJlbiA9IG1hcmtkb3duYH5+JHtjaGlsZHJlbn1+fmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50LmNvZGUpIHtcbiAgICAgIGNoaWxkcmVuID0gbWFya2Rvd25gXFxgJHtjaGlsZHJlbn1cXGBgO1xuICAgIH1cbiAgICByZXR1cm4gY2hpbGRyZW47XG4gIH0sXG4gIGxpbms6ICh7IGVsZW1lbnQsIGhyZWYgfSkgPT4ge1xuICAgIHJldHVybiBtYXJrZG93bmBbJHtlbGVtZW50LnRleHQgPz8gZWxlbWVudC51cmx9XSgke2hyZWZ9KWA7XG4gIH0sXG4gIG1lbnRpb246ICh7IGVsZW1lbnQsIHVzZXIgfSkgPT4ge1xuICAgIHJldHVybiBtYXJrZG93bmBAJHt1c2VyPy5uYW1lID8/IGVsZW1lbnQuaWR9YDtcbiAgfVxufTtcbmFzeW5jIGZ1bmN0aW9uIHN0cmluZ2lmeUNvbW1lbnRCb2R5KGJvZHksIG9wdGlvbnMpIHtcbiAgY29uc3QgZm9ybWF0ID0gb3B0aW9ucz8uZm9ybWF0ID8/IFwicGxhaW5cIjtcbiAgY29uc3Qgc2VwYXJhdG9yID0gb3B0aW9ucz8uc2VwYXJhdG9yID8/IChmb3JtYXQgPT09IFwibWFya2Rvd25cIiA/IFwiXFxuXFxuXCIgOiBcIlxcblwiKTtcbiAgY29uc3QgZWxlbWVudHMgPSB7XG4gICAgLi4uZm9ybWF0ID09PSBcImh0bWxcIiA/IHN0cmluZ2lmeUNvbW1lbnRCb2R5SHRtbEVsZW1lbnRzIDogZm9ybWF0ID09PSBcIm1hcmtkb3duXCIgPyBzdHJpbmdpZnlDb21tZW50Qm9keU1hcmtkb3duRWxlbWVudHMgOiBzdHJpbmdpZnlDb21tZW50Qm9keVBsYWluRWxlbWVudHMsXG4gICAgLi4ub3B0aW9ucz8uZWxlbWVudHNcbiAgfTtcbiAgY29uc3QgcmVzb2x2ZWRVc2VycyA9IGF3YWl0IHJlc29sdmVVc2Vyc0luQ29tbWVudEJvZHkoXG4gICAgYm9keSxcbiAgICBvcHRpb25zPy5yZXNvbHZlVXNlcnNcbiAgKTtcbiAgY29uc3QgYmxvY2tzID0gYm9keS5jb250ZW50LmZsYXRNYXAoKGJsb2NrLCBibG9ja0luZGV4KSA9PiB7XG4gICAgc3dpdGNoIChibG9jay50eXBlKSB7XG4gICAgICBjYXNlIFwicGFyYWdyYXBoXCI6IHtcbiAgICAgICAgY29uc3QgaW5saW5lcyA9IGJsb2NrLmNoaWxkcmVuLmZsYXRNYXAoKGlubGluZSwgaW5saW5lSW5kZXgpID0+IHtcbiAgICAgICAgICBpZiAoaXNDb21tZW50Qm9keU1lbnRpb24oaW5saW5lKSkge1xuICAgICAgICAgICAgcmV0dXJuIGlubGluZS5pZCA/IFtcbiAgICAgICAgICAgICAgZWxlbWVudHMubWVudGlvbihcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBlbGVtZW50OiBpbmxpbmUsXG4gICAgICAgICAgICAgICAgICB1c2VyOiByZXNvbHZlZFVzZXJzLmdldChpbmxpbmUuaWQpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbmxpbmVJbmRleFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdIDogW107XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc0NvbW1lbnRCb2R5TGluayhpbmxpbmUpKSB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICBlbGVtZW50cy5saW5rKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGlubGluZSxcbiAgICAgICAgICAgICAgICAgIGhyZWY6IHRvQWJzb2x1dGVVcmwoaW5saW5lLnVybCkgPz8gaW5saW5lLnVybFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5saW5lSW5kZXhcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGlzQ29tbWVudEJvZHlUZXh0KGlubGluZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBbZWxlbWVudHMudGV4dCh7IGVsZW1lbnQ6IGlubGluZSB9LCBpbmxpbmVJbmRleCldO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIGVsZW1lbnRzLnBhcmFncmFwaChcbiAgICAgICAgICAgIHsgZWxlbWVudDogYmxvY2ssIGNoaWxkcmVuOiBpbmxpbmVzLmpvaW4oXCJcIikgfSxcbiAgICAgICAgICAgIGJsb2NrSW5kZXhcbiAgICAgICAgICApXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGJsb2Nrcy5qb2luKHNlcGFyYXRvcik7XG59XG5cbi8vIHNyYy9jcmR0cy91dGlscy50c1xuZnVuY3Rpb24gdG9QbGFpbkxzb24obHNvbikge1xuICBpZiAobHNvbiBpbnN0YW5jZW9mIExpdmVPYmplY3QpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGl2ZWJsb2Nrc1R5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgZGF0YTogT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBPYmplY3QuZW50cmllcyhsc29uLnRvT2JqZWN0KCkpLmZsYXRNYXAoXG4gICAgICAgICAgKFtrZXksIHZhbHVlXSkgPT4gdmFsdWUgIT09IHZvaWQgMCA/IFtba2V5LCB0b1BsYWluTHNvbih2YWx1ZSldXSA6IFtdXG4gICAgICAgIClcbiAgICAgIClcbiAgICB9O1xuICB9IGVsc2UgaWYgKGxzb24gaW5zdGFuY2VvZiBMaXZlTWFwKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpdmVibG9ja3NUeXBlOiBcIkxpdmVNYXBcIixcbiAgICAgIGRhdGE6IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgWy4uLmxzb25dLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCB0b1BsYWluTHNvbih2YWx1ZSldKVxuICAgICAgKVxuICAgIH07XG4gIH0gZWxzZSBpZiAobHNvbiBpbnN0YW5jZW9mIExpdmVMaXN0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpdmVibG9ja3NUeXBlOiBcIkxpdmVMaXN0XCIsXG4gICAgICBkYXRhOiBbLi4ubHNvbl0ubWFwKChpdGVtKSA9PiB0b1BsYWluTHNvbihpdGVtKSlcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBsc29uO1xuICB9XG59XG5cbi8vIHNyYy9pbW11dGFibGUudHNcbmZ1bmN0aW9uIGxzb25PYmplY3RUb0pzb24ob2JqKSB7XG4gIGNvbnN0IHJlc3VsdCA9IHt9O1xuICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICBjb25zdCB2YWwgPSBvYmpba2V5XTtcbiAgICBpZiAodmFsICE9PSB2b2lkIDApIHtcbiAgICAgIHJlc3VsdFtrZXldID0gbHNvblRvSnNvbih2YWwpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gbGl2ZU9iamVjdFRvSnNvbihsaXZlT2JqZWN0KSB7XG4gIHJldHVybiBsc29uT2JqZWN0VG9Kc29uKGxpdmVPYmplY3QudG9PYmplY3QoKSk7XG59XG5mdW5jdGlvbiBsaXZlTWFwVG9Kc29uKG1hcCkge1xuICBjb25zdCByZXN1bHQgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgbWFwLmVudHJpZXMoKSkge1xuICAgIHJlc3VsdFtrZXldID0gbHNvblRvSnNvbih2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGxzb25MaXN0VG9Kc29uKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZS5tYXAobHNvblRvSnNvbik7XG59XG5mdW5jdGlvbiBsaXZlTGlzdFRvSnNvbih2YWx1ZSkge1xuICByZXR1cm4gbHNvbkxpc3RUb0pzb24odmFsdWUudG9BcnJheSgpKTtcbn1cbmZ1bmN0aW9uIGxzb25Ub0pzb24odmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTGl2ZU9iamVjdCkge1xuICAgIHJldHVybiBsaXZlT2JqZWN0VG9Kc29uKHZhbHVlKTtcbiAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdmVMaXN0KSB7XG4gICAgcmV0dXJuIGxpdmVMaXN0VG9Kc29uKHZhbHVlKTtcbiAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdmVNYXApIHtcbiAgICByZXR1cm4gbGl2ZU1hcFRvSnNvbih2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIpIHtcbiAgICByZXR1cm4gdmFsdWUuZGF0YTtcbiAgfVxuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gbHNvbkxpc3RUb0pzb24odmFsdWUpO1xuICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgcmV0dXJuIGxzb25PYmplY3RUb0pzb24odmFsdWUpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIGRlZXBMaXZlaWZ5KHZhbHVlKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHJldHVybiBuZXcgTGl2ZUxpc3QodmFsdWUubWFwKGRlZXBMaXZlaWZ5KSk7XG4gIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICBjb25zdCBpbml0ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gdmFsdWUpIHtcbiAgICAgIGNvbnN0IHZhbCA9IHZhbHVlW2tleV07XG4gICAgICBpZiAodmFsID09PSB2b2lkIDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpbml0W2tleV0gPSBkZWVwTGl2ZWlmeSh2YWwpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IExpdmVPYmplY3QoaW5pdCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59XG5mdW5jdGlvbiBwYXRjaExpdmVMaXN0KGxpdmVMaXN0LCBwcmV2LCBuZXh0KSB7XG4gIGxldCBpID0gMDtcbiAgbGV0IHByZXZFbmQgPSBwcmV2Lmxlbmd0aCAtIDE7XG4gIGxldCBuZXh0RW5kID0gbmV4dC5sZW5ndGggLSAxO1xuICBsZXQgcHJldk5vZGUgPSBwcmV2WzBdO1xuICBsZXQgbmV4dE5vZGUgPSBuZXh0WzBdO1xuICBvdXRlcjoge1xuICAgIHdoaWxlIChwcmV2Tm9kZSA9PT0gbmV4dE5vZGUpIHtcbiAgICAgICsraTtcbiAgICAgIGlmIChpID4gcHJldkVuZCB8fCBpID4gbmV4dEVuZCkge1xuICAgICAgICBicmVhayBvdXRlcjtcbiAgICAgIH1cbiAgICAgIHByZXZOb2RlID0gcHJldltpXTtcbiAgICAgIG5leHROb2RlID0gbmV4dFtpXTtcbiAgICB9XG4gICAgcHJldk5vZGUgPSBwcmV2W3ByZXZFbmRdO1xuICAgIG5leHROb2RlID0gbmV4dFtuZXh0RW5kXTtcbiAgICB3aGlsZSAocHJldk5vZGUgPT09IG5leHROb2RlKSB7XG4gICAgICBwcmV2RW5kLS07XG4gICAgICBuZXh0RW5kLS07XG4gICAgICBpZiAoaSA+IHByZXZFbmQgfHwgaSA+IG5leHRFbmQpIHtcbiAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICB9XG4gICAgICBwcmV2Tm9kZSA9IHByZXZbcHJldkVuZF07XG4gICAgICBuZXh0Tm9kZSA9IG5leHRbbmV4dEVuZF07XG4gICAgfVxuICB9XG4gIGlmIChpID4gcHJldkVuZCkge1xuICAgIGlmIChpIDw9IG5leHRFbmQpIHtcbiAgICAgIHdoaWxlIChpIDw9IG5leHRFbmQpIHtcbiAgICAgICAgbGl2ZUxpc3QuaW5zZXJ0KGRlZXBMaXZlaWZ5KG5leHRbaV0pLCBpKTtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChpID4gbmV4dEVuZCkge1xuICAgIGxldCBsb2NhbEkgPSBpO1xuICAgIHdoaWxlIChsb2NhbEkgPD0gcHJldkVuZCkge1xuICAgICAgbGl2ZUxpc3QuZGVsZXRlKGkpO1xuICAgICAgbG9jYWxJKys7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHdoaWxlIChpIDw9IHByZXZFbmQgJiYgaSA8PSBuZXh0RW5kKSB7XG4gICAgICBwcmV2Tm9kZSA9IHByZXZbaV07XG4gICAgICBuZXh0Tm9kZSA9IG5leHRbaV07XG4gICAgICBjb25zdCBsaXZlTGlzdE5vZGUgPSBsaXZlTGlzdC5nZXQoaSk7XG4gICAgICBpZiAoaXNMaXZlT2JqZWN0KGxpdmVMaXN0Tm9kZSkgJiYgaXNQbGFpbk9iamVjdChwcmV2Tm9kZSkgJiYgaXNQbGFpbk9iamVjdChuZXh0Tm9kZSkpIHtcbiAgICAgICAgcGF0Y2hMaXZlT2JqZWN0KGxpdmVMaXN0Tm9kZSwgcHJldk5vZGUsIG5leHROb2RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpdmVMaXN0LnNldChpLCBkZWVwTGl2ZWlmeShuZXh0Tm9kZSkpO1xuICAgICAgfVxuICAgICAgaSsrO1xuICAgIH1cbiAgICB3aGlsZSAoaSA8PSBuZXh0RW5kKSB7XG4gICAgICBsaXZlTGlzdC5pbnNlcnQoZGVlcExpdmVpZnkobmV4dFtpXSksIGkpO1xuICAgICAgaSsrO1xuICAgIH1cbiAgICBsZXQgbG9jYWxJID0gaTtcbiAgICB3aGlsZSAobG9jYWxJIDw9IHByZXZFbmQpIHtcbiAgICAgIGxpdmVMaXN0LmRlbGV0ZShpKTtcbiAgICAgIGxvY2FsSSsrO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gcGF0Y2hMaXZlT2JqZWN0S2V5KGxpdmVPYmplY3QsIGtleSwgcHJldiwgbmV4dCkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgY29uc3Qgbm9uU2VyaWFsaXphYmxlVmFsdWUgPSBmaW5kTm9uU2VyaWFsaXphYmxlVmFsdWUobmV4dCk7XG4gICAgaWYgKG5vblNlcmlhbGl6YWJsZVZhbHVlKSB7XG4gICAgICBlcnJvcjIoXG4gICAgICAgIGBOZXcgc3RhdGUgcGF0aDogJyR7bm9uU2VyaWFsaXphYmxlVmFsdWUucGF0aH0nIHZhbHVlOiAnJHtTdHJpbmcoXG4gICAgICAgICAgbm9uU2VyaWFsaXphYmxlVmFsdWUudmFsdWVcbiAgICAgICAgKX0nIGlzIG5vdCBzZXJpYWxpemFibGUuXG5Pbmx5IHNlcmlhbGl6YWJsZSB2YWx1ZSBjYW4gYmUgc3luY2VkIHdpdGggTGl2ZWJsb2Nrcy5gXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBjb25zdCB2YWx1ZSA9IGxpdmVPYmplY3QuZ2V0KGtleSk7XG4gIGlmIChuZXh0ID09PSB2b2lkIDApIHtcbiAgICBsaXZlT2JqZWN0LmRlbGV0ZShrZXkpO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSB2b2lkIDApIHtcbiAgICBsaXZlT2JqZWN0LnNldChrZXksIGRlZXBMaXZlaWZ5KG5leHQpKTtcbiAgfSBlbHNlIGlmIChwcmV2ID09PSBuZXh0KSB7XG4gICAgcmV0dXJuO1xuICB9IGVsc2UgaWYgKGlzTGl2ZUxpc3QodmFsdWUpICYmIEFycmF5LmlzQXJyYXkocHJldikgJiYgQXJyYXkuaXNBcnJheShuZXh0KSkge1xuICAgIHBhdGNoTGl2ZUxpc3QodmFsdWUsIHByZXYsIG5leHQpO1xuICB9IGVsc2UgaWYgKGlzTGl2ZU9iamVjdCh2YWx1ZSkgJiYgaXNQbGFpbk9iamVjdChwcmV2KSAmJiBpc1BsYWluT2JqZWN0KG5leHQpKSB7XG4gICAgcGF0Y2hMaXZlT2JqZWN0KHZhbHVlLCBwcmV2LCBuZXh0KTtcbiAgfSBlbHNlIHtcbiAgICBsaXZlT2JqZWN0LnNldChrZXksIGRlZXBMaXZlaWZ5KG5leHQpKTtcbiAgfVxufVxuZnVuY3Rpb24gcGF0Y2hMaXZlT2JqZWN0KHJvb3QsIHByZXYsIG5leHQpIHtcbiAgY29uc3QgdXBkYXRlcyA9IHt9O1xuICBmb3IgKGNvbnN0IGtleSBpbiBuZXh0KSB7XG4gICAgcGF0Y2hMaXZlT2JqZWN0S2V5KHJvb3QsIGtleSwgcHJldltrZXldLCBuZXh0W2tleV0pO1xuICB9XG4gIGZvciAoY29uc3Qga2V5IGluIHByZXYpIHtcbiAgICBpZiAobmV4dFtrZXldID09PSB2b2lkIDApIHtcbiAgICAgIHJvb3QuZGVsZXRlKGtleSk7XG4gICAgfVxuICB9XG4gIGlmIChPYmplY3Qua2V5cyh1cGRhdGVzKS5sZW5ndGggPiAwKSB7XG4gICAgcm9vdC51cGRhdGUodXBkYXRlcyk7XG4gIH1cbn1cbmZ1bmN0aW9uIGdldFBhcmVudHNQYXRoKG5vZGUpIHtcbiAgY29uc3QgcGF0aCA9IFtdO1xuICB3aGlsZSAobm9kZS5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIikge1xuICAgIGlmIChpc0xpdmVMaXN0KG5vZGUucGFyZW50Lm5vZGUpKSB7XG4gICAgICBwYXRoLnB1c2gobm9kZS5wYXJlbnQubm9kZS5faW5kZXhPZlBvc2l0aW9uKG5vZGUucGFyZW50LmtleSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXRoLnB1c2gobm9kZS5wYXJlbnQua2V5KTtcbiAgICB9XG4gICAgbm9kZSA9IG5vZGUucGFyZW50Lm5vZGU7XG4gIH1cbiAgcmV0dXJuIHBhdGg7XG59XG5mdW5jdGlvbiBsZWdhY3lfcGF0Y2hJbW11dGFibGVPYmplY3Qoc3RhdGUsIHVwZGF0ZXMpIHtcbiAgcmV0dXJuIHVwZGF0ZXMucmVkdWNlKFxuICAgIChzdGF0ZTIsIHVwZGF0ZSkgPT4gbGVnYWN5X3BhdGNoSW1tdXRhYmxlT2JqZWN0V2l0aFVwZGF0ZShzdGF0ZTIsIHVwZGF0ZSksXG4gICAgc3RhdGVcbiAgKTtcbn1cbmZ1bmN0aW9uIGxlZ2FjeV9wYXRjaEltbXV0YWJsZU9iamVjdFdpdGhVcGRhdGUoc3RhdGUsIHVwZGF0ZSkge1xuICBjb25zdCBwYXRoID0gZ2V0UGFyZW50c1BhdGgodXBkYXRlLm5vZGUpO1xuICByZXR1cm4gbGVnYWN5X3BhdGNoSW1tdXRhYmxlTm9kZShzdGF0ZSwgcGF0aCwgdXBkYXRlKTtcbn1cbmZ1bmN0aW9uIGxlZ2FjeV9wYXRjaEltbXV0YWJsZU5vZGUoc3RhdGUsIHBhdGgsIHVwZGF0ZSkge1xuICBjb25zdCBwYXRoSXRlbSA9IHBhdGgucG9wKCk7XG4gIGlmIChwYXRoSXRlbSA9PT0gdm9pZCAwKSB7XG4gICAgc3dpdGNoICh1cGRhdGUudHlwZSkge1xuICAgICAgY2FzZSBcIkxpdmVPYmplY3RcIjoge1xuICAgICAgICBpZiAoIWlzSnNvbk9iamVjdChzdGF0ZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIkludGVybmFsOiByZWNlaXZlZCB1cGRhdGUgb24gTGl2ZU9iamVjdCBidXQgc3RhdGUgd2FzIG5vdCBhbiBvYmplY3RcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3U3RhdGUgPSBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZSk7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHVwZGF0ZS51cGRhdGVzKSB7XG4gICAgICAgICAgaWYgKHVwZGF0ZS51cGRhdGVzW2tleV0/LnR5cGUgPT09IFwidXBkYXRlXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IHVwZGF0ZS5ub2RlLmdldChrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlW2tleV0gPSBsc29uVG9Kc29uKHZhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh1cGRhdGUudXBkYXRlc1trZXldPy50eXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICBkZWxldGUgbmV3U3RhdGVba2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld1N0YXRlO1xuICAgICAgfVxuICAgICAgY2FzZSBcIkxpdmVMaXN0XCI6IHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHN0YXRlKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiSW50ZXJuYWw6IHJlY2VpdmVkIHVwZGF0ZSBvbiBMaXZlTGlzdCBidXQgc3RhdGUgd2FzIG5vdCBhbiBhcnJheVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3U3RhdGUgPSBzdGF0ZS5tYXAoKHgpID0+IHgpO1xuICAgICAgICBmb3IgKGNvbnN0IGxpc3RVcGRhdGUgb2YgdXBkYXRlLnVwZGF0ZXMpIHtcbiAgICAgICAgICBpZiAobGlzdFVwZGF0ZS50eXBlID09PSBcInNldFwiKSB7XG4gICAgICAgICAgICBuZXdTdGF0ZSA9IG5ld1N0YXRlLm1hcChcbiAgICAgICAgICAgICAgKGl0ZW0sIGluZGV4KSA9PiBpbmRleCA9PT0gbGlzdFVwZGF0ZS5pbmRleCA/IGxzb25Ub0pzb24obGlzdFVwZGF0ZS5pdGVtKSA6IGl0ZW1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIGlmIChsaXN0VXBkYXRlLnR5cGUgPT09IFwiaW5zZXJ0XCIpIHtcbiAgICAgICAgICAgIGlmIChsaXN0VXBkYXRlLmluZGV4ID09PSBuZXdTdGF0ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgbmV3U3RhdGUucHVzaChsc29uVG9Kc29uKGxpc3RVcGRhdGUuaXRlbSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbmV3U3RhdGUgPSBbXG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUuc2xpY2UoMCwgbGlzdFVwZGF0ZS5pbmRleCksXG4gICAgICAgICAgICAgICAgbHNvblRvSnNvbihsaXN0VXBkYXRlLml0ZW0pLFxuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKGxpc3RVcGRhdGUuaW5kZXgpXG4gICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChsaXN0VXBkYXRlLnR5cGUgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgIG5ld1N0YXRlLnNwbGljZShsaXN0VXBkYXRlLmluZGV4LCAxKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGxpc3RVcGRhdGUudHlwZSA9PT0gXCJtb3ZlXCIpIHtcbiAgICAgICAgICAgIGlmIChsaXN0VXBkYXRlLnByZXZpb3VzSW5kZXggPiBsaXN0VXBkYXRlLmluZGV4KSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlID0gW1xuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKDAsIGxpc3RVcGRhdGUuaW5kZXgpLFxuICAgICAgICAgICAgICAgIGxzb25Ub0pzb24obGlzdFVwZGF0ZS5pdGVtKSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShsaXN0VXBkYXRlLmluZGV4LCBsaXN0VXBkYXRlLnByZXZpb3VzSW5kZXgpLFxuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKGxpc3RVcGRhdGUucHJldmlvdXNJbmRleCArIDEpXG4gICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBuZXdTdGF0ZSA9IFtcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZSgwLCBsaXN0VXBkYXRlLnByZXZpb3VzSW5kZXgpLFxuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKFxuICAgICAgICAgICAgICAgICAgbGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4ICsgMSxcbiAgICAgICAgICAgICAgICAgIGxpc3RVcGRhdGUuaW5kZXggKyAxXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBsc29uVG9Kc29uKGxpc3RVcGRhdGUuaXRlbSksXG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUuc2xpY2UobGlzdFVwZGF0ZS5pbmRleCArIDEpXG4gICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJMaXZlTWFwXCI6IHtcbiAgICAgICAgaWYgKCFpc0pzb25PYmplY3Qoc3RhdGUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJJbnRlcm5hbDogcmVjZWl2ZWQgdXBkYXRlIG9uIExpdmVNYXAgYnV0IHN0YXRlIHdhcyBub3QgYW4gb2JqZWN0XCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB1cGRhdGUudXBkYXRlcykge1xuICAgICAgICAgIGlmICh1cGRhdGUudXBkYXRlc1trZXldPy50eXBlID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHVwZGF0ZS5ub2RlLmdldChrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgbmV3U3RhdGVba2V5XSA9IGxzb25Ub0pzb24odmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAodXBkYXRlLnVwZGF0ZXNba2V5XT8udHlwZSA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgZGVsZXRlIG5ld1N0YXRlW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkoc3RhdGUpKSB7XG4gICAgY29uc3QgbmV3QXJyYXkgPSBbLi4uc3RhdGVdO1xuICAgIG5ld0FycmF5W3BhdGhJdGVtXSA9IGxlZ2FjeV9wYXRjaEltbXV0YWJsZU5vZGUoXG4gICAgICBzdGF0ZVtwYXRoSXRlbV0sXG4gICAgICBwYXRoLFxuICAgICAgdXBkYXRlXG4gICAgKTtcbiAgICByZXR1cm4gbmV3QXJyYXk7XG4gIH0gZWxzZSBpZiAoaXNKc29uT2JqZWN0KHN0YXRlKSkge1xuICAgIGNvbnN0IG5vZGUgPSBzdGF0ZVtwYXRoSXRlbV07XG4gICAgaWYgKG5vZGUgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzdGF0ZUFzT2JqID0gc3RhdGU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zdGF0ZUFzT2JqLFxuICAgICAgICBbcGF0aEl0ZW1dOiBsZWdhY3lfcGF0Y2hJbW11dGFibGVOb2RlKG5vZGUsIHBhdGgsIHVwZGF0ZSlcbiAgICAgIH07XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxufVxuXG4vLyBzcmMvbGliL2RlcHJlY2F0aW9uLnRzXG52YXIgX2VtaXR0ZWREZXByZWNhdGlvbldhcm5pbmdzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbmZ1bmN0aW9uIGRlcHJlY2F0ZShtZXNzYWdlLCBrZXkgPSBtZXNzYWdlKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBpZiAoIV9lbWl0dGVkRGVwcmVjYXRpb25XYXJuaW5ncy5oYXMoa2V5KSkge1xuICAgICAgX2VtaXR0ZWREZXByZWNhdGlvbldhcm5pbmdzLmFkZChrZXkpO1xuICAgICAgZXJyb3JXaXRoVGl0bGUoXCJEZXByZWNhdGlvbiB3YXJuaW5nXCIsIG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZGVwcmVjYXRlSWYoY29uZGl0aW9uLCBtZXNzYWdlLCBrZXkgPSBtZXNzYWdlKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBpZiAoY29uZGl0aW9uKSB7XG4gICAgICBkZXByZWNhdGUobWVzc2FnZSwga2V5KTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHRocm93VXNhZ2VFcnJvcihtZXNzYWdlKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBjb25zdCB1c2FnZUVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIHVzYWdlRXJyb3IubmFtZSA9IFwiVXNhZ2UgZXJyb3JcIjtcbiAgICBlcnJvcldpdGhUaXRsZShcIlVzYWdlIGVycm9yXCIsIG1lc3NhZ2UpO1xuICAgIHRocm93IHVzYWdlRXJyb3I7XG4gIH1cbn1cbmZ1bmN0aW9uIGVycm9ySWYoY29uZGl0aW9uLCBtZXNzYWdlKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBpZiAoY29uZGl0aW9uKSB7XG4gICAgICB0aHJvd1VzYWdlRXJyb3IobWVzc2FnZSk7XG4gICAgfVxuICB9XG59XG5cbi8vIHNyYy9saWIvUG9sbGVyLnRzXG5mdW5jdGlvbiBtYWtlUG9sbGVyKGNhbGxiYWNrKSB7XG4gIGxldCBjb250ZXh0ID0ge1xuICAgIHN0YXRlOiBcInN0b3BwZWRcIixcbiAgICB0aW1lb3V0SGFuZGxlOiBudWxsLFxuICAgIGludGVydmFsOiBudWxsLFxuICAgIGxhc3RTY2hlZHVsZWRBdDogbnVsbCxcbiAgICByZW1haW5pbmdJbnRlcnZhbDogbnVsbFxuICB9O1xuICBmdW5jdGlvbiBwb2xsKCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlID09PSBcInJ1bm5pbmdcIikge1xuICAgICAgc2NoZWR1bGUoY29udGV4dC5pbnRlcnZhbCk7XG4gICAgfVxuICAgIHZvaWQgY2FsbGJhY2soKTtcbiAgfVxuICBmdW5jdGlvbiBzY2hlZHVsZShpbnRlcnZhbCkge1xuICAgIGNvbnRleHQgPSB7XG4gICAgICBzdGF0ZTogXCJydW5uaW5nXCIsXG4gICAgICBpbnRlcnZhbDogY29udGV4dC5zdGF0ZSAhPT0gXCJzdG9wcGVkXCIgPyBjb250ZXh0LmludGVydmFsIDogaW50ZXJ2YWwsXG4gICAgICBsYXN0U2NoZWR1bGVkQXQ6IHBlcmZvcm1hbmNlLm5vdygpLFxuICAgICAgdGltZW91dEhhbmRsZTogc2V0VGltZW91dChwb2xsLCBpbnRlcnZhbCksXG4gICAgICByZW1haW5pbmdJbnRlcnZhbDogbnVsbFxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gc2NoZWR1bGVSZW1haW5pbmcocmVtYWluaW5nKSB7XG4gICAgaWYgKGNvbnRleHQuc3RhdGUgIT09IFwicGF1c2VkXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29udGV4dCA9IHtcbiAgICAgIHN0YXRlOiBcInJ1bm5pbmdcIixcbiAgICAgIGludGVydmFsOiBjb250ZXh0LmludGVydmFsLFxuICAgICAgbGFzdFNjaGVkdWxlZEF0OiBjb250ZXh0Lmxhc3RTY2hlZHVsZWRBdCxcbiAgICAgIHRpbWVvdXRIYW5kbGU6IHNldFRpbWVvdXQocG9sbCwgcmVtYWluaW5nKSxcbiAgICAgIHJlbWFpbmluZ0ludGVydmFsOiBudWxsXG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBzdGFydChpbnRlcnZhbCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlID09PSBcInJ1bm5pbmdcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzY2hlZHVsZShpbnRlcnZhbCk7XG4gIH1cbiAgZnVuY3Rpb24gcmVzdGFydChpbnRlcnZhbCkge1xuICAgIHN0b3AoKTtcbiAgICBzdGFydChpbnRlcnZhbCk7XG4gIH1cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgaWYgKGNvbnRleHQuc3RhdGUgIT09IFwicnVubmluZ1wiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRIYW5kbGUpO1xuICAgIGNvbnRleHQgPSB7XG4gICAgICBzdGF0ZTogXCJwYXVzZWRcIixcbiAgICAgIGludGVydmFsOiBjb250ZXh0LmludGVydmFsLFxuICAgICAgbGFzdFNjaGVkdWxlZEF0OiBjb250ZXh0Lmxhc3RTY2hlZHVsZWRBdCxcbiAgICAgIHRpbWVvdXRIYW5kbGU6IG51bGwsXG4gICAgICByZW1haW5pbmdJbnRlcnZhbDogY29udGV4dC5pbnRlcnZhbCAtIChwZXJmb3JtYW5jZS5ub3coKSAtIGNvbnRleHQubGFzdFNjaGVkdWxlZEF0KVxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gcmVzdW1lKCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlICE9PSBcInBhdXNlZFwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNjaGVkdWxlUmVtYWluaW5nKGNvbnRleHQucmVtYWluaW5nSW50ZXJ2YWwpO1xuICB9XG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgaWYgKGNvbnRleHQuc3RhdGUgPT09IFwic3RvcHBlZFwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0LnRpbWVvdXRIYW5kbGUpIHtcbiAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRIYW5kbGUpO1xuICAgIH1cbiAgICBjb250ZXh0ID0ge1xuICAgICAgc3RhdGU6IFwic3RvcHBlZFwiLFxuICAgICAgaW50ZXJ2YWw6IG51bGwsXG4gICAgICBsYXN0U2NoZWR1bGVkQXQ6IG51bGwsXG4gICAgICB0aW1lb3V0SGFuZGxlOiBudWxsLFxuICAgICAgcmVtYWluaW5nSW50ZXJ2YWw6IG51bGxcbiAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgc3RhcnQsXG4gICAgcmVzdGFydCxcbiAgICBwYXVzZSxcbiAgICByZXN1bWUsXG4gICAgc3RvcFxuICB9O1xufVxuXG4vLyBzcmMvbGliL3NoYWxsb3cudHNcbmZ1bmN0aW9uIHNoYWxsb3dBcnJheSh4cywgeXMpIHtcbiAgaWYgKHhzLmxlbmd0aCAhPT0geXMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeHMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoIU9iamVjdC5pcyh4c1tpXSwgeXNbaV0pKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gc2hhbGxvd09iaihvYmpBLCBvYmpCKSB7XG4gIGlmICh0eXBlb2Ygb2JqQSAhPT0gXCJvYmplY3RcIiB8fCBvYmpBID09PSBudWxsIHx8IHR5cGVvZiBvYmpCICE9PSBcIm9iamVjdFwiIHx8IG9iakIgPT09IG51bGwgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iakEpICE9PSBcIltvYmplY3QgT2JqZWN0XVwiIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmpCKSAhPT0gXCJbb2JqZWN0IE9iamVjdF1cIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBrZXlzQSA9IE9iamVjdC5rZXlzKG9iakEpO1xuICBpZiAoa2V5c0EubGVuZ3RoICE9PSBPYmplY3Qua2V5cyhvYmpCKS5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIGtleXNBLmV2ZXJ5KFxuICAgIChrZXkpID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmpCLCBrZXkpICYmIE9iamVjdC5pcyhvYmpBW2tleV0sIG9iakJba2V5XSlcbiAgKTtcbn1cbmZ1bmN0aW9uIHNoYWxsb3coYSwgYikge1xuICBpZiAoT2JqZWN0LmlzKGEsIGIpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgaXNBcnJheUEgPSBBcnJheS5pc0FycmF5KGEpO1xuICBjb25zdCBpc0FycmF5QiA9IEFycmF5LmlzQXJyYXkoYik7XG4gIGlmIChpc0FycmF5QSB8fCBpc0FycmF5Qikge1xuICAgIGlmICghaXNBcnJheUEgfHwgIWlzQXJyYXlCKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBzaGFsbG93QXJyYXkoYSwgYik7XG4gIH1cbiAgcmV0dXJuIHNoYWxsb3dPYmooYSwgYik7XG59XG5cbi8vIHNyYy9pbmRleC50c1xuZGV0ZWN0RHVwZXMoUEtHX05BTUUsIFBLR19WRVJTSU9OLCBQS0dfRk9STUFUKTtcbmV4cG9ydCB7XG4gIENsaWVudE1zZ0NvZGUsXG4gIENvbW1lbnRzQXBpRXJyb3IsXG4gIENyZHRUeXBlLFxuICBMaXZlTGlzdCxcbiAgTGl2ZU1hcCxcbiAgTGl2ZU9iamVjdCxcbiAgTm90aWZpY2F0aW9uc0FwaUVycm9yLFxuICBPcENvZGUsXG4gIFNlcnZlck1zZ0NvZGUsXG4gIFdlYnNvY2tldENsb3NlQ29kZXMsXG4gIGFja09wLFxuICBhZGRSZWFjdGlvbixcbiAgYXBwbHlPcHRpbWlzdGljVXBkYXRlcyxcbiAgYXNQb3MsXG4gIGFzc2VydCxcbiAgYXNzZXJ0TmV2ZXIsXG4gIGI2NGRlY29kZSxcbiAgY2xvbmVMc29uLFxuICBmYW5jeV9jb25zb2xlX2V4cG9ydHMgYXMgY29uc29sZSxcbiAgY29udmVydFRvQ29tbWVudERhdGEsXG4gIGNvbnZlcnRUb0NvbW1lbnRVc2VyUmVhY3Rpb24sXG4gIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YSxcbiAgY29udmVydFRvVGhyZWFkRGF0YSxcbiAgY3JlYXRlQ2xpZW50LFxuICBjcmVhdGVDb21tZW50SWQsXG4gIGNyZWF0ZUluYm94Tm90aWZpY2F0aW9uSWQsXG4gIGNyZWF0ZVRocmVhZElkLFxuICBkZWxldGVDb21tZW50LFxuICBkZXByZWNhdGUsXG4gIGRlcHJlY2F0ZUlmLFxuICBkZXRlY3REdXBlcyxcbiAgZXJyb3JJZixcbiAgZnJlZXplLFxuICBnZXRNZW50aW9uZWRJZHNGcm9tQ29tbWVudEJvZHksXG4gIGlzQ2hpbGRDcmR0LFxuICBpc0pzb25BcnJheSxcbiAgaXNKc29uT2JqZWN0LFxuICBpc0pzb25TY2FsYXIsXG4gIGlzTGl2ZU5vZGUsXG4gIGlzUGxhaW5PYmplY3QsXG4gIGlzUm9vdENyZHQsXG4gIGtJbnRlcm5hbCxcbiAgbGVnYWN5X3BhdGNoSW1tdXRhYmxlT2JqZWN0LFxuICBsc29uVG9Kc29uLFxuICBtYWtlRXZlbnRTb3VyY2UsXG4gIG1ha2VQb2xsZXIsXG4gIG1ha2VQb3NpdGlvbixcbiAgbWVtb2l6ZU9uU3VjY2VzcyxcbiAgbmFub2lkLFxuICBubixcbiAgb2JqZWN0VG9RdWVyeSxcbiAgcGF0Y2hMaXZlT2JqZWN0S2V5LFxuICByYWlzZSxcbiAgcmVtb3ZlUmVhY3Rpb24sXG4gIHNoYWxsb3csXG4gIHN0cmluZ2lmeSxcbiAgc3RyaW5naWZ5Q29tbWVudEJvZHksXG4gIHRocm93VXNhZ2VFcnJvcixcbiAgdG9QbGFpbkxzb24sXG4gIHRyeVBhcnNlSnNvbixcbiAgdXBzZXJ0Q29tbWVudCxcbiAgd2FpdCxcbiAgd2l0aFRpbWVvdXRcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./node_modules/@liveblocks/core/dist/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@liveblocks/core/dist/index.mjs":
/*!******************************************************!*\
  !*** ./node_modules/@liveblocks/core/dist/index.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ClientMsgCode: () => (/* binding */ ClientMsgCode),\n/* harmony export */   CommentsApiError: () => (/* binding */ CommentsApiError),\n/* harmony export */   CrdtType: () => (/* binding */ CrdtType),\n/* harmony export */   LiveList: () => (/* binding */ LiveList),\n/* harmony export */   LiveMap: () => (/* binding */ LiveMap),\n/* harmony export */   LiveObject: () => (/* binding */ LiveObject),\n/* harmony export */   NotificationsApiError: () => (/* binding */ NotificationsApiError),\n/* harmony export */   OpCode: () => (/* binding */ OpCode),\n/* harmony export */   ServerMsgCode: () => (/* binding */ ServerMsgCode),\n/* harmony export */   WebsocketCloseCodes: () => (/* binding */ WebsocketCloseCodes),\n/* harmony export */   ackOp: () => (/* binding */ ackOp),\n/* harmony export */   addReaction: () => (/* binding */ addReaction),\n/* harmony export */   applyOptimisticUpdates: () => (/* binding */ applyOptimisticUpdates),\n/* harmony export */   asPos: () => (/* binding */ asPos),\n/* harmony export */   assert: () => (/* binding */ assert),\n/* harmony export */   assertNever: () => (/* binding */ assertNever),\n/* harmony export */   b64decode: () => (/* binding */ b64decode),\n/* harmony export */   cloneLson: () => (/* binding */ cloneLson),\n/* harmony export */   console: () => (/* binding */ fancy_console_exports),\n/* harmony export */   convertToCommentData: () => (/* binding */ convertToCommentData),\n/* harmony export */   convertToCommentUserReaction: () => (/* binding */ convertToCommentUserReaction),\n/* harmony export */   convertToInboxNotificationData: () => (/* binding */ convertToInboxNotificationData),\n/* harmony export */   convertToThreadData: () => (/* binding */ convertToThreadData),\n/* harmony export */   createClient: () => (/* binding */ createClient),\n/* harmony export */   createCommentId: () => (/* binding */ createCommentId),\n/* harmony export */   createInboxNotificationId: () => (/* binding */ createInboxNotificationId),\n/* harmony export */   createThreadId: () => (/* binding */ createThreadId),\n/* harmony export */   deleteComment: () => (/* binding */ deleteComment),\n/* harmony export */   deprecate: () => (/* binding */ deprecate),\n/* harmony export */   deprecateIf: () => (/* binding */ deprecateIf),\n/* harmony export */   detectDupes: () => (/* binding */ detectDupes),\n/* harmony export */   errorIf: () => (/* binding */ errorIf),\n/* harmony export */   freeze: () => (/* binding */ freeze),\n/* harmony export */   getMentionedIdsFromCommentBody: () => (/* binding */ getMentionedIdsFromCommentBody),\n/* harmony export */   isChildCrdt: () => (/* binding */ isChildCrdt),\n/* harmony export */   isJsonArray: () => (/* binding */ isJsonArray),\n/* harmony export */   isJsonObject: () => (/* binding */ isJsonObject),\n/* harmony export */   isJsonScalar: () => (/* binding */ isJsonScalar),\n/* harmony export */   isLiveNode: () => (/* binding */ isLiveNode),\n/* harmony export */   isPlainObject: () => (/* binding */ isPlainObject),\n/* harmony export */   isRootCrdt: () => (/* binding */ isRootCrdt),\n/* harmony export */   kInternal: () => (/* binding */ kInternal),\n/* harmony export */   legacy_patchImmutableObject: () => (/* binding */ legacy_patchImmutableObject),\n/* harmony export */   lsonToJson: () => (/* binding */ lsonToJson),\n/* harmony export */   makeEventSource: () => (/* binding */ makeEventSource),\n/* harmony export */   makePoller: () => (/* binding */ makePoller),\n/* harmony export */   makePosition: () => (/* binding */ makePosition),\n/* harmony export */   memoizeOnSuccess: () => (/* binding */ memoizeOnSuccess),\n/* harmony export */   nanoid: () => (/* binding */ nanoid),\n/* harmony export */   nn: () => (/* binding */ nn),\n/* harmony export */   objectToQuery: () => (/* binding */ objectToQuery),\n/* harmony export */   patchLiveObjectKey: () => (/* binding */ patchLiveObjectKey),\n/* harmony export */   raise: () => (/* binding */ raise),\n/* harmony export */   removeReaction: () => (/* binding */ removeReaction),\n/* harmony export */   shallow: () => (/* binding */ shallow),\n/* harmony export */   stringify: () => (/* binding */ stringify),\n/* harmony export */   stringifyCommentBody: () => (/* binding */ stringifyCommentBody),\n/* harmony export */   throwUsageError: () => (/* binding */ throwUsageError),\n/* harmony export */   toPlainLson: () => (/* binding */ toPlainLson),\n/* harmony export */   tryParseJson: () => (/* binding */ tryParseJson),\n/* harmony export */   upsertComment: () => (/* binding */ upsertComment),\n/* harmony export */   wait: () => (/* binding */ wait),\n/* harmony export */   withTimeout: () => (/* binding */ withTimeout)\n/* harmony export */ });\nvar __defProp = Object.defineProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\n\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/core\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/dupe-detection.ts\nvar g = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : {};\nvar crossLinkedDocs = \"https://liveblocks.io/docs/errors/cross-linked\";\nvar dupesDocs = \"https://liveblocks.io/docs/errors/dupes\";\nvar SPACE = \" \";\nfunction error(msg) {\n  if (false) {} else {\n    throw new Error(msg);\n  }\n}\nfunction detectDupes(pkgName, pkgVersion, pkgFormat) {\n  const pkgId = Symbol.for(pkgName);\n  const pkgBuildInfo = pkgFormat ? `${pkgVersion || \"dev\"} (${pkgFormat})` : pkgVersion || \"dev\";\n  if (!g[pkgId]) {\n    g[pkgId] = pkgBuildInfo;\n  } else if (g[pkgId] === pkgBuildInfo) {\n  } else {\n    const msg = [\n      `Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See ${dupesDocs + SPACE}`,\n      \"\",\n      \"Conflicts:\",\n      `- ${pkgName} ${g[pkgId]} (already loaded)`,\n      `- ${pkgName} ${pkgBuildInfo} (trying to load this now)`\n    ].join(\"\\n\");\n    error(msg);\n  }\n  if (pkgVersion && PKG_VERSION && pkgVersion !== PKG_VERSION) {\n    error(\n      [\n        `Cross-linked versions of Liveblocks found, which will cause issues! See ${crossLinkedDocs + SPACE}`,\n        \"\",\n        \"Conflicts:\",\n        `- ${PKG_NAME} is at ${PKG_VERSION}`,\n        `- ${pkgName} is at ${pkgVersion}`,\n        \"\",\n        \"Always upgrade all Liveblocks packages to the same version number.\"\n      ].join(\"\\n\")\n    );\n  }\n}\n\n// src/lib/assert.ts\nfunction assertNever(_value, errmsg) {\n  throw new Error(errmsg);\n}\nfunction assert(condition, errmsg) {\n  if (true) {\n    if (!condition) {\n      const err = new Error(errmsg);\n      err.name = \"Assertion failure\";\n      throw err;\n    }\n  }\n}\nfunction nn(value, errmsg = \"Expected value to be non-nullable\") {\n  assert(value !== null && value !== void 0, errmsg);\n  return value;\n}\n\n// src/lib/controlledPromise.ts\nfunction controlledPromise() {\n  let resolve;\n  let reject;\n  const promise = new Promise((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  return [promise, resolve, reject];\n}\nfunction Promise_withResolvers() {\n  const [promise, resolve, reject] = controlledPromise();\n  return { promise, resolve, reject };\n}\n\n// src/lib/EventSource.ts\nfunction makeEventSource() {\n  const _onetimeObservers = /* @__PURE__ */ new Set();\n  const _observers = /* @__PURE__ */ new Set();\n  let _buffer = null;\n  function pause() {\n    _buffer = [];\n  }\n  function unpause() {\n    if (_buffer === null) {\n      return;\n    }\n    for (const event of _buffer) {\n      notify(event);\n    }\n    _buffer = null;\n  }\n  function subscribe(callback) {\n    _observers.add(callback);\n    return () => _observers.delete(callback);\n  }\n  function subscribeOnce(callback) {\n    _onetimeObservers.add(callback);\n    return () => _onetimeObservers.delete(callback);\n  }\n  async function waitUntil(predicate) {\n    let unsub;\n    return new Promise((res) => {\n      unsub = subscribe((event) => {\n        if (predicate === void 0 || predicate(event)) {\n          res(event);\n        }\n      });\n    }).finally(() => unsub?.());\n  }\n  function notifyOrBuffer(event) {\n    if (_buffer !== null) {\n      _buffer.push(event);\n    } else {\n      notify(event);\n    }\n  }\n  function notify(event) {\n    _onetimeObservers.forEach((callback) => callback(event));\n    _onetimeObservers.clear();\n    _observers.forEach((callback) => callback(event));\n  }\n  function clear() {\n    _onetimeObservers.clear();\n    _observers.clear();\n  }\n  function count() {\n    return _onetimeObservers.size + _observers.size;\n  }\n  return {\n    // Private/internal control over event emission\n    notify: notifyOrBuffer,\n    subscribe,\n    subscribeOnce,\n    clear,\n    count,\n    waitUntil,\n    pause,\n    unpause,\n    // Publicly exposable subscription API\n    observable: {\n      subscribe,\n      subscribeOnce,\n      waitUntil\n    }\n  };\n}\n\n// src/lib/fancy-console.ts\nvar fancy_console_exports = {};\n__export(fancy_console_exports, {\n  error: () => error2,\n  errorWithTitle: () => errorWithTitle,\n  warn: () => warn,\n  warnWithTitle: () => warnWithTitle\n});\nvar badge = \"background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;\";\nvar bold = \"font-weight:600\";\nfunction wrap(method) {\n  return typeof window === \"undefined\" || \"development\" === \"test\" ? console[method] : (\n    /* istanbul ignore next */\n    (message, ...args) => console[method](\"%cLiveblocks\", badge, message, ...args)\n  );\n}\nvar warn = wrap(\"warn\");\nvar error2 = wrap(\"error\");\nfunction wrapWithTitle(method) {\n  return typeof window === \"undefined\" || \"development\" === \"test\" ? console[method] : (\n    /* istanbul ignore next */\n    (title, message, ...args) => console[method](\n      `%cLiveblocks%c ${title}`,\n      badge,\n      bold,\n      message,\n      ...args\n    )\n  );\n}\nvar warnWithTitle = wrapWithTitle(\"warn\");\nvar errorWithTitle = wrapWithTitle(\"error\");\n\n// src/lib/fsm.ts\nfunction distance(state1, state2) {\n  if (state1 === state2) {\n    return [0, 0];\n  }\n  const chunks1 = state1.split(\".\");\n  const chunks2 = state2.split(\".\");\n  const minLen = Math.min(chunks1.length, chunks2.length);\n  let shared = 0;\n  for (; shared < minLen; shared++) {\n    if (chunks1[shared] !== chunks2[shared]) {\n      break;\n    }\n  }\n  const up = chunks1.length - shared;\n  const down = chunks2.length - shared;\n  return [up, down];\n}\nfunction patterns(targetState, levels) {\n  const parts = targetState.split(\".\");\n  if (levels < 1 || levels > parts.length + 1) {\n    throw new Error(\"Invalid number of levels\");\n  }\n  const result = [];\n  if (levels > parts.length) {\n    result.push(\"*\");\n  }\n  for (let i = parts.length - levels + 1; i < parts.length; i++) {\n    const slice = parts.slice(0, i);\n    if (slice.length > 0) {\n      result.push(slice.join(\".\") + \".*\");\n    }\n  }\n  result.push(targetState);\n  return result;\n}\nvar SafeContext = class {\n  constructor(initialContext) {\n    this.curr = initialContext;\n  }\n  get current() {\n    return this.curr;\n  }\n  /**\n   * Call a callback function that allows patching of the context, by\n   * calling `context.patch()`. Patching is only allowed for the duration\n   * of this window.\n   */\n  allowPatching(callback) {\n    const self = this;\n    let allowed = true;\n    const patchableContext = {\n      ...this.curr,\n      patch(patch) {\n        if (allowed) {\n          self.curr = Object.assign({}, self.curr, patch);\n          for (const pair of Object.entries(patch)) {\n            const [key, value] = pair;\n            if (key !== \"patch\") {\n              this[key] = value;\n            }\n          }\n        } else {\n          throw new Error(\"Can no longer patch stale context\");\n        }\n      }\n    };\n    callback(patchableContext);\n    allowed = false;\n    return;\n  }\n};\nvar nextId = 1;\nvar FSM = class {\n  /**\n   * Returns the initial state, which is defined by the first call made to\n   * .addState().\n   */\n  get initialState() {\n    const result = this.states.values()[Symbol.iterator]().next();\n    if (result.done) {\n      throw new Error(\"No states defined yet\");\n    } else {\n      return result.value;\n    }\n  }\n  get currentState() {\n    if (this.currentStateOrNull === null) {\n      if (this.runningState === 0 /* NOT_STARTED_YET */) {\n        throw new Error(\"Not started yet\");\n      } else {\n        throw new Error(\"Already stopped\");\n      }\n    }\n    return this.currentStateOrNull;\n  }\n  /**\n   * Starts the machine by entering the initial state.\n   */\n  start() {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"State machine has already started\");\n    }\n    this.runningState = 1 /* STARTED */;\n    this.currentStateOrNull = this.initialState;\n    this.enter(null);\n    return this;\n  }\n  /**\n   * Stops the state machine. Stopping the state machine will call exit\n   * handlers for the current state, but not enter a new state.\n   */\n  stop() {\n    if (this.runningState !== 1 /* STARTED */) {\n      throw new Error(\"Cannot stop a state machine that hasn't started yet\");\n    }\n    this.exit(null);\n    this.runningState = 2 /* STOPPED */;\n    this.currentStateOrNull = null;\n  }\n  constructor(initialContext) {\n    this.id = nextId++;\n    this.runningState = 0 /* NOT_STARTED_YET */;\n    this.currentStateOrNull = null;\n    this.states = /* @__PURE__ */ new Set();\n    this.enterFns = /* @__PURE__ */ new Map();\n    this.cleanupStack = [];\n    this.knownEventTypes = /* @__PURE__ */ new Set();\n    this.allowedTransitions = /* @__PURE__ */ new Map();\n    this.currentContext = new SafeContext(initialContext);\n    this.eventHub = {\n      didReceiveEvent: makeEventSource(),\n      willTransition: makeEventSource(),\n      didIgnoreEvent: makeEventSource(),\n      willExitState: makeEventSource(),\n      didEnterState: makeEventSource()\n    };\n    this.events = {\n      didReceiveEvent: this.eventHub.didReceiveEvent.observable,\n      willTransition: this.eventHub.willTransition.observable,\n      didIgnoreEvent: this.eventHub.didIgnoreEvent.observable,\n      willExitState: this.eventHub.willExitState.observable,\n      didEnterState: this.eventHub.didEnterState.observable\n    };\n  }\n  get context() {\n    return this.currentContext.current;\n  }\n  /**\n   * Define an explicit finite state in the state machine.\n   */\n  addState(state) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    }\n    this.states.add(state);\n    return this;\n  }\n  onEnter(nameOrPattern, enterFn) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    } else if (this.enterFns.has(nameOrPattern)) {\n      throw new Error(\n        // TODO We _currently_ don't support multiple .onEnters() for the same\n        // state, but this is not a fundamental limitation. Just not\n        // implemented yet. If we wanted to, we could make this an array.\n        `enter/exit function for ${nameOrPattern} already exists`\n      );\n    }\n    this.enterFns.set(nameOrPattern, enterFn);\n    return this;\n  }\n  onEnterAsync(nameOrPattern, promiseFn, onOK, onError) {\n    return this.onEnter(nameOrPattern, () => {\n      const abortController = new AbortController();\n      const signal = abortController.signal;\n      let done = false;\n      void promiseFn(this.currentContext.current, signal).then(\n        // On OK\n        (data) => {\n          if (!signal.aborted) {\n            done = true;\n            this.transition({ type: \"ASYNC_OK\", data }, onOK);\n          }\n        },\n        // On Error\n        (reason) => {\n          if (!signal.aborted) {\n            done = true;\n            this.transition({ type: \"ASYNC_ERROR\", reason }, onError);\n          }\n        }\n      );\n      return () => {\n        if (!done) {\n          abortController.abort();\n        }\n      };\n    });\n  }\n  getStatesMatching(nameOrPattern) {\n    const matches = [];\n    if (nameOrPattern === \"*\") {\n      for (const state of this.states) {\n        matches.push(state);\n      }\n    } else if (nameOrPattern.endsWith(\".*\")) {\n      const prefix = nameOrPattern.slice(0, -1);\n      for (const state of this.states) {\n        if (state.startsWith(prefix)) {\n          matches.push(state);\n        }\n      }\n    } else {\n      const name = nameOrPattern;\n      if (this.states.has(name)) {\n        matches.push(name);\n      }\n    }\n    if (matches.length === 0) {\n      throw new Error(`No states match ${JSON.stringify(nameOrPattern)}`);\n    }\n    return matches;\n  }\n  /**\n   * Define all allowed outgoing transitions for a state.\n   *\n   * The targets for each event can be defined as a function which returns the\n   * next state to transition to. These functions can look at the `event` or\n   * `context` params to conditionally decide which next state to transition\n   * to.\n   *\n   * If you set it to `null`, then the transition will be explicitly forbidden\n   * and throw an error. If you don't define a target for a transition, then\n   * such events will get ignored.\n   */\n  addTransitions(nameOrPattern, mapping) {\n    if (this.runningState !== 0 /* NOT_STARTED_YET */) {\n      throw new Error(\"Already started\");\n    }\n    for (const srcState of this.getStatesMatching(nameOrPattern)) {\n      let map = this.allowedTransitions.get(srcState);\n      if (map === void 0) {\n        map = /* @__PURE__ */ new Map();\n        this.allowedTransitions.set(srcState, map);\n      }\n      for (const [type, target_] of Object.entries(mapping)) {\n        if (map.has(type)) {\n          throw new Error(\n            `Trying to set transition \"${type}\" on \"${srcState}\" (via \"${nameOrPattern}\"), but a transition already exists there.`\n          );\n        }\n        const target = target_;\n        this.knownEventTypes.add(type);\n        if (target !== void 0) {\n          const targetFn = typeof target === \"function\" ? target : () => target;\n          map.set(type, targetFn);\n        }\n      }\n    }\n    return this;\n  }\n  /**\n   * Like `.addTransition()`, but takes an (anonymous) transition whenever the\n   * timer fires.\n   *\n   * @param stateOrPattern The state name, or state group pattern name.\n   * @param after          Number of milliseconds after which to take the\n   *                       transition. If in the mean time, another transition\n   *                       is taken, the timer will get cancelled.\n   * @param target     The target state to go to.\n   */\n  addTimedTransition(stateOrPattern, after2, target) {\n    return this.onEnter(stateOrPattern, () => {\n      const ms = typeof after2 === \"function\" ? after2(this.currentContext.current) : after2;\n      const timeoutID = setTimeout(() => {\n        this.transition({ type: \"TIMER\" }, target);\n      }, ms);\n      return () => {\n        clearTimeout(timeoutID);\n      };\n    });\n  }\n  getTargetFn(eventName) {\n    return this.allowedTransitions.get(this.currentState)?.get(eventName);\n  }\n  /**\n   * Exits the current state, and executes any necessary cleanup functions.\n   * Call this before changing the current state to the next state.\n   *\n   * @param levels Defines how many \"levels\" of nesting will be\n   * exited. For example, if you transition from `foo.bar.qux` to\n   * `foo.bar.baz`, then the level is 1. But if you transition from\n   * `foo.bar.qux` to `bla.bla`, then the level is 3.\n   * If `null`, it will exit all levels.\n   */\n  exit(levels) {\n    this.eventHub.willExitState.notify(this.currentState);\n    this.currentContext.allowPatching((patchableContext) => {\n      levels = levels ?? this.cleanupStack.length;\n      for (let i = 0; i < levels; i++) {\n        this.cleanupStack.pop()?.(patchableContext);\n      }\n    });\n  }\n  /**\n   * Enters the current state, and executes any necessary onEnter handlers.\n   * Call this directly _after_ setting the current state to the next state.\n   */\n  enter(levels) {\n    const enterPatterns = patterns(\n      this.currentState,\n      levels ?? this.currentState.split(\".\").length + 1\n    );\n    this.currentContext.allowPatching((patchableContext) => {\n      for (const pattern of enterPatterns) {\n        const enterFn = this.enterFns.get(pattern);\n        const cleanupFn = enterFn?.(patchableContext);\n        if (typeof cleanupFn === \"function\") {\n          this.cleanupStack.push(cleanupFn);\n        } else {\n          this.cleanupStack.push(null);\n        }\n      }\n    });\n    this.eventHub.didEnterState.notify(this.currentState);\n  }\n  /**\n   * Sends an event to the machine, which may cause an internal state\n   * transition to happen. When that happens, will trigger side effects.\n   */\n  send(event) {\n    if (!this.knownEventTypes.has(event.type)) {\n      throw new Error(`Invalid event ${JSON.stringify(event.type)}`);\n    }\n    if (this.runningState === 2 /* STOPPED */) {\n      return;\n    }\n    const targetFn = this.getTargetFn(event.type);\n    if (targetFn !== void 0) {\n      return this.transition(event, targetFn);\n    } else {\n      this.eventHub.didIgnoreEvent.notify(event);\n    }\n  }\n  transition(event, target) {\n    this.eventHub.didReceiveEvent.notify(event);\n    const oldState = this.currentState;\n    const targetFn = typeof target === \"function\" ? target : () => target;\n    const nextTarget = targetFn(event, this.currentContext.current);\n    let nextState;\n    let effects = void 0;\n    if (nextTarget === null) {\n      this.eventHub.didIgnoreEvent.notify(event);\n      return;\n    }\n    if (typeof nextTarget === \"string\") {\n      nextState = nextTarget;\n    } else {\n      nextState = nextTarget.target;\n      effects = Array.isArray(nextTarget.effect) ? nextTarget.effect : [nextTarget.effect];\n    }\n    if (!this.states.has(nextState)) {\n      throw new Error(`Invalid next state name: ${JSON.stringify(nextState)}`);\n    }\n    this.eventHub.willTransition.notify({ from: oldState, to: nextState });\n    const [up, down] = distance(this.currentState, nextState);\n    if (up > 0) {\n      this.exit(up);\n    }\n    this.currentStateOrNull = nextState;\n    if (effects !== void 0) {\n      const effectsToRun = effects;\n      this.currentContext.allowPatching((patchableContext) => {\n        for (const effect of effectsToRun) {\n          if (typeof effect === \"function\") {\n            effect(patchableContext, event);\n          } else {\n            patchableContext.patch(effect);\n          }\n        }\n      });\n    }\n    if (down > 0) {\n      this.enter(down);\n    }\n  }\n};\n\n// src/lib/utils.ts\nfunction raise(msg) {\n  throw new Error(msg);\n}\nfunction isPlainObject(blob) {\n  return blob !== null && typeof blob === \"object\" && Object.prototype.toString.call(blob) === \"[object Object]\";\n}\nfunction entries(obj) {\n  return Object.entries(obj);\n}\nfunction tryParseJson(rawMessage) {\n  try {\n    return JSON.parse(rawMessage);\n  } catch (e) {\n    return void 0;\n  }\n}\nfunction deepClone(value) {\n  return JSON.parse(JSON.stringify(value));\n}\nfunction b64decode(b64value) {\n  try {\n    const formattedValue = b64value.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const decodedValue = decodeURIComponent(\n      atob(formattedValue).split(\"\").map(function(c) {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(\"\")\n    );\n    return decodedValue;\n  } catch (err) {\n    return atob(b64value);\n  }\n}\nfunction compact(items) {\n  return items.filter(\n    (item) => item !== null && item !== void 0\n  );\n}\nfunction compactObject(obj) {\n  const newObj = { ...obj };\n  Object.keys(obj).forEach((k) => {\n    const key = k;\n    if (newObj[key] === void 0) {\n      delete newObj[key];\n    }\n  });\n  return newObj;\n}\nfunction wait(millis) {\n  return new Promise((res) => setTimeout(res, millis));\n}\nasync function withTimeout(promise, millis, errmsg) {\n  let timerID;\n  const timer$ = new Promise((_, reject) => {\n    timerID = setTimeout(() => {\n      reject(new Error(errmsg));\n    }, millis);\n  });\n  return Promise.race([promise, timer$]).finally(() => clearTimeout(timerID));\n}\nfunction memoizeOnSuccess(factoryFn) {\n  let cached = null;\n  return () => {\n    if (cached === null) {\n      cached = factoryFn().catch((err) => {\n        setTimeout(() => {\n          cached = null;\n        }, 5e3);\n        throw err;\n      });\n    }\n    return cached;\n  };\n}\n\n// src/protocol/ServerMsg.ts\nvar ServerMsgCode = /* @__PURE__ */ ((ServerMsgCode2) => {\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_PRESENCE\"] = 100] = \"UPDATE_PRESENCE\";\n  ServerMsgCode2[ServerMsgCode2[\"USER_JOINED\"] = 101] = \"USER_JOINED\";\n  ServerMsgCode2[ServerMsgCode2[\"USER_LEFT\"] = 102] = \"USER_LEFT\";\n  ServerMsgCode2[ServerMsgCode2[\"BROADCASTED_EVENT\"] = 103] = \"BROADCASTED_EVENT\";\n  ServerMsgCode2[ServerMsgCode2[\"ROOM_STATE\"] = 104] = \"ROOM_STATE\";\n  ServerMsgCode2[ServerMsgCode2[\"INITIAL_STORAGE_STATE\"] = 200] = \"INITIAL_STORAGE_STATE\";\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_STORAGE\"] = 201] = \"UPDATE_STORAGE\";\n  ServerMsgCode2[ServerMsgCode2[\"REJECT_STORAGE_OP\"] = 299] = \"REJECT_STORAGE_OP\";\n  ServerMsgCode2[ServerMsgCode2[\"UPDATE_YDOC\"] = 300] = \"UPDATE_YDOC\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_CREATED\"] = 400] = \"THREAD_CREATED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_DELETED\"] = 407] = \"THREAD_DELETED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_METADATA_UPDATED\"] = 401] = \"THREAD_METADATA_UPDATED\";\n  ServerMsgCode2[ServerMsgCode2[\"THREAD_UPDATED\"] = 408] = \"THREAD_UPDATED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_CREATED\"] = 402] = \"COMMENT_CREATED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_EDITED\"] = 403] = \"COMMENT_EDITED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_DELETED\"] = 404] = \"COMMENT_DELETED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_REACTION_ADDED\"] = 405] = \"COMMENT_REACTION_ADDED\";\n  ServerMsgCode2[ServerMsgCode2[\"COMMENT_REACTION_REMOVED\"] = 406] = \"COMMENT_REACTION_REMOVED\";\n  return ServerMsgCode2;\n})(ServerMsgCode || {});\n\n// src/types/IWebSocket.ts\nvar WebsocketCloseCodes = /* @__PURE__ */ ((WebsocketCloseCodes2) => {\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_NORMAL\"] = 1e3] = \"CLOSE_NORMAL\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_ABNORMAL\"] = 1006] = \"CLOSE_ABNORMAL\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"UNEXPECTED_CONDITION\"] = 1011] = \"UNEXPECTED_CONDITION\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"TRY_AGAIN_LATER\"] = 1013] = \"TRY_AGAIN_LATER\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"INVALID_MESSAGE_FORMAT\"] = 4e3] = \"INVALID_MESSAGE_FORMAT\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"NOT_ALLOWED\"] = 4001] = \"NOT_ALLOWED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_MESSAGES_PER_SECONDS\"] = 4002] = \"MAX_NUMBER_OF_MESSAGES_PER_SECONDS\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS\"] = 4003] = \"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP\"] = 4004] = \"MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM\"] = 4005] = \"MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"ROOM_ID_UPDATED\"] = 4006] = \"ROOM_ID_UPDATED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"KICKED\"] = 4100] = \"KICKED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"TOKEN_EXPIRED\"] = 4109] = \"TOKEN_EXPIRED\";\n  WebsocketCloseCodes2[WebsocketCloseCodes2[\"CLOSE_WITHOUT_RETRY\"] = 4999] = \"CLOSE_WITHOUT_RETRY\";\n  return WebsocketCloseCodes2;\n})(WebsocketCloseCodes || {});\nfunction shouldDisconnect(code) {\n  return code === 4999 /* CLOSE_WITHOUT_RETRY */ || code >= 4e3 && code < 4100;\n}\nfunction shouldReauth(code) {\n  return code >= 4100 && code < 4200;\n}\nfunction shouldRetryWithoutReauth(code) {\n  return code === 1013 /* TRY_AGAIN_LATER */ || code >= 4200 && code < 4300;\n}\n\n// src/connection.ts\nfunction isIdle(status) {\n  return status === \"initial\" || status === \"disconnected\";\n}\nfunction toNewConnectionStatus(machine) {\n  const state = machine.currentState;\n  switch (state) {\n    case \"@ok.connected\":\n    case \"@ok.awaiting-pong\":\n      return \"connected\";\n    case \"@idle.initial\":\n      return \"initial\";\n    case \"@auth.busy\":\n    case \"@auth.backoff\":\n    case \"@connecting.busy\":\n    case \"@connecting.backoff\":\n    case \"@idle.zombie\":\n      return machine.context.successCount > 0 ? \"reconnecting\" : \"connecting\";\n    case \"@idle.failed\":\n      return \"disconnected\";\n    default:\n      return assertNever(state, \"Unknown state\");\n  }\n}\nvar BACKOFF_DELAYS = [250, 500, 1e3, 2e3, 4e3, 8e3, 1e4];\nvar RESET_DELAY = BACKOFF_DELAYS[0] - 1;\nvar BACKOFF_DELAYS_SLOW = [2e3, 3e4, 6e4, 3e5];\nvar HEARTBEAT_INTERVAL = 3e4;\nvar PONG_TIMEOUT = 2e3;\nvar AUTH_TIMEOUT = 1e4;\nvar SOCKET_CONNECT_TIMEOUT = 1e4;\nvar StopRetrying = class extends Error {\n  constructor(reason) {\n    super(reason);\n  }\n};\nvar LiveblocksError = class extends Error {\n  /** @internal */\n  constructor(message, code) {\n    super(message);\n    this.code = code;\n  }\n};\nfunction nextBackoffDelay(currentDelay, delays) {\n  return delays.find((delay) => delay > currentDelay) ?? delays[delays.length - 1];\n}\nfunction increaseBackoffDelay(context) {\n  context.patch({\n    backoffDelay: nextBackoffDelay(context.backoffDelay, BACKOFF_DELAYS)\n  });\n}\nfunction increaseBackoffDelayAggressively(context) {\n  context.patch({\n    backoffDelay: nextBackoffDelay(context.backoffDelay, BACKOFF_DELAYS_SLOW)\n  });\n}\nfunction resetSuccessCount(context) {\n  context.patch({ successCount: 0 });\n}\nfunction log(level, message) {\n  const logger = level === 2 /* ERROR */ ? error2 : level === 1 /* WARN */ ? warn : (\n    /* black hole */\n    () => {\n    }\n  );\n  return () => {\n    logger(message);\n  };\n}\nfunction logPrematureErrorOrCloseEvent(e) {\n  const conn = \"Connection to Liveblocks websocket server\";\n  return (ctx) => {\n    if (e instanceof Error) {\n      warn(`${conn} could not be established. ${String(e)}`);\n    } else {\n      warn(\n        isCloseEvent(e) ? `${conn} closed prematurely (code: ${e.code}). Retrying in ${ctx.backoffDelay}ms.` : `${conn} could not be established.`\n      );\n    }\n  };\n}\nfunction logCloseEvent(event) {\n  const details = [`code: ${event.code}`];\n  if (event.reason) {\n    details.push(`reason: ${event.reason}`);\n  }\n  return (ctx) => {\n    warn(\n      `Connection to Liveblocks websocket server closed (${details.join(\", \")}). Retrying in ${ctx.backoffDelay}ms.`\n    );\n  };\n}\nvar logPermanentClose = log(\n  1 /* WARN */,\n  \"Connection to WebSocket closed permanently. Won't retry.\"\n);\nfunction isCloseEvent(error3) {\n  return !(error3 instanceof Error) && error3.type === \"close\";\n}\nfunction enableTracing(machine) {\n  const start = (/* @__PURE__ */ new Date()).getTime();\n  function log2(...args) {\n    warn(\n      `${(((/* @__PURE__ */ new Date()).getTime() - start) / 1e3).toFixed(2)} [FSM #${machine.id}]`,\n      ...args\n    );\n  }\n  const unsubs = [\n    machine.events.didReceiveEvent.subscribe((e) => log2(`Event ${e.type}`)),\n    machine.events.willTransition.subscribe(\n      ({ from, to }) => log2(\"Transitioning\", from, \"\\u2192\", to)\n    ),\n    machine.events.didIgnoreEvent.subscribe(\n      (e) => log2(\"Ignored event\", e.type, e, \"(current state won't handle it)\")\n    )\n    // machine.events.willExitState.subscribe((s) => log(\"Exiting state\", s)),\n    // machine.events.didEnterState.subscribe((s) => log(\"Entering state\", s)),\n  ];\n  return () => {\n    for (const unsub of unsubs) {\n      unsub();\n    }\n  };\n}\nfunction defineConnectivityEvents(machine) {\n  const statusDidChange = makeEventSource();\n  const didConnect = makeEventSource();\n  const didDisconnect = makeEventSource();\n  let lastStatus = null;\n  const unsubscribe = machine.events.didEnterState.subscribe(() => {\n    const currStatus = toNewConnectionStatus(machine);\n    if (currStatus !== lastStatus) {\n      statusDidChange.notify(currStatus);\n    }\n    if (lastStatus === \"connected\" && currStatus !== \"connected\") {\n      didDisconnect.notify();\n    } else if (lastStatus !== \"connected\" && currStatus === \"connected\") {\n      didConnect.notify();\n    }\n    lastStatus = currStatus;\n  });\n  return {\n    statusDidChange: statusDidChange.observable,\n    didConnect: didConnect.observable,\n    didDisconnect: didDisconnect.observable,\n    unsubscribe\n  };\n}\nvar assign = (patch) => (ctx) => ctx.patch(patch);\nfunction createConnectionStateMachine(delegates, options) {\n  const onMessage = makeEventSource();\n  onMessage.pause();\n  const onLiveblocksError = makeEventSource();\n  function fireErrorEvent(errmsg, errcode) {\n    return () => {\n      const err = new LiveblocksError(errmsg, errcode);\n      onLiveblocksError.notify(err);\n    };\n  }\n  const initialContext = {\n    successCount: 0,\n    authValue: null,\n    socket: null,\n    backoffDelay: RESET_DELAY\n  };\n  const machine = new FSM(initialContext).addState(\"@idle.initial\").addState(\"@idle.failed\").addState(\"@idle.zombie\").addState(\"@auth.busy\").addState(\"@auth.backoff\").addState(\"@connecting.busy\").addState(\"@connecting.backoff\").addState(\"@ok.connected\").addState(\"@ok.awaiting-pong\");\n  machine.addTransitions(\"*\", {\n    RECONNECT: {\n      target: \"@auth.backoff\",\n      effect: [increaseBackoffDelay, resetSuccessCount]\n    },\n    DISCONNECT: \"@idle.initial\"\n  });\n  machine.onEnter(\"@idle.*\", resetSuccessCount).addTransitions(\"@idle.*\", {\n    CONNECT: (_, ctx) => (\n      // If we still have a known authValue, try to reconnect to the socket directly,\n      // otherwise, try to obtain a new authValue\n      ctx.authValue !== null ? \"@connecting.busy\" : \"@auth.busy\"\n    )\n  });\n  machine.addTransitions(\"@auth.backoff\", {\n    NAVIGATOR_ONLINE: {\n      target: \"@auth.busy\",\n      effect: assign({ backoffDelay: RESET_DELAY })\n    }\n  }).addTimedTransition(\n    \"@auth.backoff\",\n    (ctx) => ctx.backoffDelay,\n    \"@auth.busy\"\n  ).onEnterAsync(\n    \"@auth.busy\",\n    () => withTimeout(\n      delegates.authenticate(),\n      AUTH_TIMEOUT,\n      \"Timed out during auth\"\n    ),\n    // On successful authentication\n    (okEvent) => ({\n      target: \"@connecting.busy\",\n      effect: assign({\n        authValue: okEvent.data\n      })\n    }),\n    // Auth failed\n    (failedEvent) => {\n      if (failedEvent.reason instanceof StopRetrying) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            log(2 /* ERROR */, failedEvent.reason.message),\n            fireErrorEvent(failedEvent.reason.message, -1)\n          ]\n        };\n      }\n      return {\n        target: \"@auth.backoff\",\n        effect: [\n          increaseBackoffDelay,\n          log(\n            2 /* ERROR */,\n            `Authentication failed: ${failedEvent.reason instanceof Error ? failedEvent.reason.message : String(failedEvent.reason)}`\n          )\n        ]\n      };\n    }\n  );\n  const onSocketError = (event) => machine.send({ type: \"EXPLICIT_SOCKET_ERROR\", event });\n  const onSocketClose = (event) => machine.send({ type: \"EXPLICIT_SOCKET_CLOSE\", event });\n  const onSocketMessage = (event) => event.data === \"pong\" ? machine.send({ type: \"PONG\" }) : onMessage.notify(event);\n  function teardownSocket(socket) {\n    if (socket) {\n      socket.removeEventListener(\"error\", onSocketError);\n      socket.removeEventListener(\"close\", onSocketClose);\n      socket.removeEventListener(\"message\", onSocketMessage);\n      socket.close();\n    }\n  }\n  machine.addTransitions(\"@connecting.backoff\", {\n    NAVIGATOR_ONLINE: {\n      target: \"@connecting.busy\",\n      effect: assign({ backoffDelay: RESET_DELAY })\n    }\n  }).addTimedTransition(\n    \"@connecting.backoff\",\n    (ctx) => ctx.backoffDelay,\n    \"@connecting.busy\"\n  ).onEnterAsync(\n    \"@connecting.busy\",\n    //\n    // Use the \"createSocket\" delegate function (provided to the\n    // ManagedSocket) to create the actual WebSocket connection instance.\n    // Then, set up all the necessary event listeners, and wait for the\n    // \"open\" event to occur.\n    //\n    // When the \"open\" event happens, we're ready to transition to the\n    // OK state. This is done by resolving the Promise.\n    //\n    async (ctx, signal) => {\n      let capturedPrematureEvent = null;\n      let unconfirmedSocket = null;\n      const connect$ = new Promise(\n        (resolve, rej) => {\n          if (ctx.authValue === null) {\n            throw new Error(\"No auth authValue\");\n          }\n          const socket = delegates.createSocket(ctx.authValue);\n          unconfirmedSocket = socket;\n          function reject(event) {\n            capturedPrematureEvent = event;\n            socket.removeEventListener(\"message\", onSocketMessage);\n            rej(event);\n          }\n          const [actor$, didReceiveActor] = controlledPromise();\n          if (!options.waitForActorId) {\n            didReceiveActor();\n          }\n          function waitForActorId(event) {\n            const serverMsg = tryParseJson(event.data);\n            if (serverMsg?.type === 104 /* ROOM_STATE */) {\n              didReceiveActor();\n            }\n          }\n          socket.addEventListener(\"message\", onSocketMessage);\n          if (options.waitForActorId) {\n            socket.addEventListener(\"message\", waitForActorId);\n          }\n          socket.addEventListener(\"error\", reject);\n          socket.addEventListener(\"close\", reject);\n          socket.addEventListener(\"open\", () => {\n            socket.addEventListener(\"error\", onSocketError);\n            socket.addEventListener(\"close\", onSocketClose);\n            const unsub = () => {\n              socket.removeEventListener(\"error\", reject);\n              socket.removeEventListener(\"close\", reject);\n              socket.removeEventListener(\"message\", waitForActorId);\n            };\n            void actor$.then(() => {\n              resolve([socket, unsub]);\n            });\n          });\n        }\n      );\n      return withTimeout(\n        connect$,\n        SOCKET_CONNECT_TIMEOUT,\n        \"Timed out during websocket connection\"\n      ).then(\n        //\n        // Part 3:\n        // By now, our \"open\" event has fired, and the promise has been\n        // resolved. Two possible scenarios:\n        //\n        // 1. The happy path. Most likely.\n        // 2. Uh-oh. A premature close/error event has been observed. Let's\n        //    reject the promise after all.\n        //\n        // Any close/error event that will get scheduled after this point\n        // onwards, will be caught in the OK state, and dealt with\n        // accordingly.\n        //\n        ([socket, unsub]) => {\n          unsub();\n          if (signal.aborted) {\n            throw new Error(\"Aborted\");\n          }\n          if (capturedPrematureEvent) {\n            throw capturedPrematureEvent;\n          }\n          return socket;\n        }\n      ).catch((e) => {\n        teardownSocket(unconfirmedSocket);\n        throw e;\n      });\n    },\n    // Only transition to OK state after a successfully opened WebSocket connection\n    (okEvent) => ({\n      target: \"@ok.connected\",\n      effect: assign({\n        socket: okEvent.data,\n        backoffDelay: RESET_DELAY\n      })\n    }),\n    // If the WebSocket connection cannot be established\n    (failure) => {\n      const err = failure.reason;\n      if (err instanceof StopRetrying) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            log(2 /* ERROR */, err.message),\n            fireErrorEvent(err.message, -1)\n          ]\n        };\n      }\n      if (isCloseEvent(err)) {\n        if (err.code === 4109 /* TOKEN_EXPIRED */) {\n          return \"@auth.busy\";\n        }\n        if (shouldRetryWithoutReauth(err.code)) {\n          return {\n            target: \"@connecting.backoff\",\n            effect: [\n              increaseBackoffDelayAggressively,\n              logPrematureErrorOrCloseEvent(err)\n            ]\n          };\n        }\n        if (shouldDisconnect(err.code)) {\n          return {\n            target: \"@idle.failed\",\n            effect: [\n              log(2 /* ERROR */, err.reason),\n              fireErrorEvent(err.reason, err.code)\n            ]\n          };\n        }\n      }\n      return {\n        target: \"@auth.backoff\",\n        effect: [increaseBackoffDelay, logPrematureErrorOrCloseEvent(err)]\n      };\n    }\n  );\n  const sendHeartbeat = {\n    target: \"@ok.awaiting-pong\",\n    effect: (ctx) => {\n      ctx.socket?.send(\"ping\");\n    }\n  };\n  const maybeHeartbeat = () => {\n    const doc = typeof document !== \"undefined\" ? document : void 0;\n    const canZombie = doc?.visibilityState === \"hidden\" && delegates.canZombie();\n    return canZombie ? \"@idle.zombie\" : sendHeartbeat;\n  };\n  machine.addTimedTransition(\"@ok.connected\", HEARTBEAT_INTERVAL, maybeHeartbeat).addTransitions(\"@ok.connected\", {\n    NAVIGATOR_OFFLINE: maybeHeartbeat,\n    // Don't take the browser's word for it when it says it's offline. Do a ping/pong to make sure.\n    WINDOW_GOT_FOCUS: sendHeartbeat\n  });\n  machine.addTransitions(\"@idle.zombie\", {\n    WINDOW_GOT_FOCUS: \"@connecting.backoff\"\n    // When in zombie state, the client will try to wake up automatically when the window regains focus\n  });\n  machine.onEnter(\"@ok.*\", (ctx) => {\n    ctx.patch({ successCount: ctx.successCount + 1 });\n    const timerID = setTimeout(\n      // On the next tick, start delivering all messages that have already\n      // been received, and continue synchronous delivery of all future\n      // incoming messages.\n      onMessage.unpause,\n      0\n    );\n    return (ctx2) => {\n      teardownSocket(ctx2.socket);\n      ctx2.patch({ socket: null });\n      clearTimeout(timerID);\n      onMessage.pause();\n    };\n  }).addTransitions(\"@ok.awaiting-pong\", { PONG: \"@ok.connected\" }).addTimedTransition(\"@ok.awaiting-pong\", PONG_TIMEOUT, {\n    target: \"@connecting.busy\",\n    // Log implicit connection loss and drop the current open socket\n    effect: log(\n      1 /* WARN */,\n      \"Received no pong from server, assume implicit connection loss.\"\n    )\n  }).addTransitions(\"@ok.*\", {\n    // When a socket receives an error, this can cause the closing of the\n    // socket, or not. So always check to see if the socket is still OPEN or\n    // not. When still OPEN, don't transition.\n    EXPLICIT_SOCKET_ERROR: (_, context) => {\n      if (context.socket?.readyState === 1) {\n        return null;\n      }\n      return {\n        target: \"@connecting.backoff\",\n        effect: increaseBackoffDelay\n      };\n    },\n    EXPLICIT_SOCKET_CLOSE: (e) => {\n      if (shouldDisconnect(e.event.code)) {\n        return {\n          target: \"@idle.failed\",\n          effect: [\n            logPermanentClose,\n            fireErrorEvent(e.event.reason, e.event.code)\n          ]\n        };\n      }\n      if (shouldReauth(e.event.code)) {\n        if (e.event.code === 4109 /* TOKEN_EXPIRED */) {\n          return \"@auth.busy\";\n        } else {\n          return {\n            target: \"@auth.backoff\",\n            effect: [increaseBackoffDelay, logCloseEvent(e.event)]\n          };\n        }\n      }\n      if (shouldRetryWithoutReauth(e.event.code)) {\n        return {\n          target: \"@connecting.backoff\",\n          effect: [increaseBackoffDelayAggressively, logCloseEvent(e.event)]\n        };\n      }\n      return {\n        target: \"@connecting.backoff\",\n        effect: [increaseBackoffDelay, logCloseEvent(e.event)]\n      };\n    }\n  });\n  if (typeof document !== \"undefined\") {\n    const doc = typeof document !== \"undefined\" ? document : void 0;\n    const win = typeof window !== \"undefined\" ? window : void 0;\n    const root = win ?? doc;\n    machine.onEnter(\"*\", (ctx) => {\n      function onNetworkOffline() {\n        machine.send({ type: \"NAVIGATOR_OFFLINE\" });\n      }\n      function onNetworkBackOnline() {\n        machine.send({ type: \"NAVIGATOR_ONLINE\" });\n      }\n      function onVisibilityChange() {\n        if (doc?.visibilityState === \"visible\") {\n          machine.send({ type: \"WINDOW_GOT_FOCUS\" });\n        }\n      }\n      win?.addEventListener(\"online\", onNetworkBackOnline);\n      win?.addEventListener(\"offline\", onNetworkOffline);\n      root?.addEventListener(\"visibilitychange\", onVisibilityChange);\n      return () => {\n        root?.removeEventListener(\"visibilitychange\", onVisibilityChange);\n        win?.removeEventListener(\"online\", onNetworkBackOnline);\n        win?.removeEventListener(\"offline\", onNetworkOffline);\n        teardownSocket(ctx.socket);\n      };\n    });\n  }\n  const cleanups = [];\n  const { statusDidChange, didConnect, didDisconnect, unsubscribe } = defineConnectivityEvents(machine);\n  cleanups.push(unsubscribe);\n  if (options.enableDebugLogging) {\n    cleanups.push(enableTracing(machine));\n  }\n  machine.start();\n  return {\n    machine,\n    cleanups,\n    // Observable events that will be emitted by this machine\n    events: {\n      statusDidChange,\n      didConnect,\n      didDisconnect,\n      onMessage: onMessage.observable,\n      onLiveblocksError: onLiveblocksError.observable\n    }\n  };\n}\nvar ManagedSocket = class {\n  constructor(delegates, enableDebugLogging = false, waitForActorId = true) {\n    const { machine, events, cleanups } = createConnectionStateMachine(\n      delegates,\n      { waitForActorId, enableDebugLogging }\n    );\n    this.machine = machine;\n    this.events = events;\n    this.cleanups = cleanups;\n  }\n  getStatus() {\n    try {\n      return toNewConnectionStatus(this.machine);\n    } catch {\n      return \"initial\";\n    }\n  }\n  /**\n   * Returns the current auth authValue.\n   */\n  get authValue() {\n    return this.machine.context.authValue;\n  }\n  /**\n   * Call this method to try to connect to a WebSocket. This only has an effect\n   * if the machine is idle at the moment, otherwise this is a no-op.\n   */\n  connect() {\n    this.machine.send({ type: \"CONNECT\" });\n  }\n  /**\n   * If idle, will try to connect. Otherwise, it will attempt to reconnect to\n   * the socket, potentially obtaining a new authValue first, if needed.\n   */\n  reconnect() {\n    this.machine.send({ type: \"RECONNECT\" });\n  }\n  /**\n   * Call this method to disconnect from the current WebSocket. Is going to be\n   * a no-op if there is no active connection.\n   */\n  disconnect() {\n    this.machine.send({ type: \"DISCONNECT\" });\n  }\n  /**\n   * Call this to stop the machine and run necessary cleanup functions. After\n   * calling destroy(), you can no longer use this instance. Call this before\n   * letting the instance get garbage collected.\n   */\n  destroy() {\n    this.machine.stop();\n    let cleanup;\n    while (cleanup = this.cleanups.pop()) {\n      cleanup();\n    }\n  }\n  /**\n   * Safely send a message to the current WebSocket connection. Will emit a log\n   * message if this is somehow impossible.\n   */\n  send(data) {\n    const socket = this.machine.context?.socket;\n    if (socket === null) {\n      warn(\"Cannot send: not connected yet\", data);\n    } else if (socket.readyState !== 1) {\n      warn(\"Cannot send: WebSocket no longer open\", data);\n    } else {\n      socket.send(data);\n    }\n  }\n  /**\n   * NOTE: Used by the E2E app only, to simulate explicit events.\n   * Not ideal to keep exposed :(\n   */\n  _privateSendMachineEvent(event) {\n    this.machine.send(event);\n  }\n};\n\n// src/protocol/AuthToken.ts\nfunction canWriteStorage(scopes) {\n  return scopes.includes(\"room:write\" /* Write */);\n}\nfunction canComment(scopes) {\n  return scopes.includes(\"comments:write\" /* CommentsWrite */) || scopes.includes(\"room:write\" /* Write */);\n}\nfunction isValidAuthTokenPayload(data) {\n  return isPlainObject(data) && (data.k === \"acc\" /* ACCESS_TOKEN */ || data.k === \"id\" /* ID_TOKEN */ || data.k === \"sec-legacy\" /* SECRET_LEGACY */);\n}\nfunction parseAuthToken(rawTokenString) {\n  const tokenParts = rawTokenString.split(\".\");\n  if (tokenParts.length !== 3) {\n    throw new Error(\"Authentication error: invalid JWT token\");\n  }\n  const payload = tryParseJson(b64decode(tokenParts[1]));\n  if (!(payload && isValidAuthTokenPayload(payload))) {\n    throw new Error(\n      \"Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback\"\n    );\n  }\n  return {\n    raw: rawTokenString,\n    parsed: payload\n  };\n}\n\n// src/auth-manager.ts\nfunction createAuthManager(authOptions) {\n  const authentication = prepareAuthentication(authOptions);\n  const seenTokens = /* @__PURE__ */ new Set();\n  const tokens = [];\n  const expiryTimes = [];\n  const requestPromises = /* @__PURE__ */ new Map();\n  function reset() {\n    seenTokens.clear();\n    tokens.length = 0;\n    expiryTimes.length = 0;\n    requestPromises.clear();\n  }\n  function hasCorrespondingScopes(requestedScope, scopes) {\n    if (requestedScope === \"comments:read\") {\n      return scopes.includes(\"comments:read\" /* CommentsRead */) || scopes.includes(\"comments:write\" /* CommentsWrite */) || scopes.includes(\"room:read\" /* Read */) || scopes.includes(\"room:write\" /* Write */);\n    } else if (requestedScope === \"room:read\") {\n      return scopes.includes(\"room:read\" /* Read */) || scopes.includes(\"room:write\" /* Write */);\n    }\n    return false;\n  }\n  function getCachedToken(requestOptions) {\n    const now = Math.ceil(Date.now() / 1e3);\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const token = tokens[i];\n      const expiresAt = expiryTimes[i];\n      if (expiresAt <= now) {\n        tokens.splice(i, 1);\n        expiryTimes.splice(i, 1);\n        continue;\n      }\n      if (token.parsed.k === \"id\" /* ID_TOKEN */) {\n        return token;\n      } else if (token.parsed.k === \"acc\" /* ACCESS_TOKEN */) {\n        if (!requestOptions.roomId && Object.entries(token.parsed.perms).length === 0) {\n          return token;\n        }\n        for (const [resource, scopes] of Object.entries(token.parsed.perms)) {\n          if (!requestOptions.roomId) {\n            if (resource.includes(\"*\") && hasCorrespondingScopes(requestOptions.requestedScope, scopes)) {\n              return token;\n            }\n          } else if (resource.includes(\"*\") && requestOptions.roomId.startsWith(resource.replace(\"*\", \"\")) || requestOptions.roomId === resource && hasCorrespondingScopes(requestOptions.requestedScope, scopes)) {\n            return token;\n          }\n        }\n      }\n    }\n    return void 0;\n  }\n  async function makeAuthRequest(options) {\n    const fetcher = authOptions.polyfills?.fetch ?? (typeof window === \"undefined\" ? void 0 : window.fetch);\n    if (authentication.type === \"private\") {\n      if (fetcher === void 0) {\n        throw new StopRetrying(\n          \"To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.\"\n        );\n      }\n      const response = await fetchAuthEndpoint(fetcher, authentication.url, {\n        room: options.roomId\n      });\n      const parsed = parseAuthToken(response.token);\n      if (seenTokens.has(parsed.raw)) {\n        throw new StopRetrying(\n          \"The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.\"\n        );\n      }\n      return parsed;\n    }\n    if (authentication.type === \"custom\") {\n      const response = await authentication.callback(options.roomId);\n      if (response && typeof response === \"object\") {\n        if (typeof response.token === \"string\") {\n          const parsed = parseAuthToken(response.token);\n          return parsed;\n        } else if (typeof response.error === \"string\") {\n          const reason = `Authentication failed: ${\"reason\" in response && typeof response.reason === \"string\" ? response.reason : \"Forbidden\"}`;\n          if (response.error === \"forbidden\") {\n            throw new StopRetrying(reason);\n          } else {\n            throw new Error(reason);\n          }\n        }\n      }\n      throw new Error(\n        'Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: \"...\" }'\n      );\n    }\n    throw new Error(\n      \"Unexpected authentication type. Must be private or custom.\"\n    );\n  }\n  async function getAuthValue(requestOptions) {\n    if (authentication.type === \"public\") {\n      return { type: \"public\", publicApiKey: authentication.publicApiKey };\n    }\n    const cachedToken = getCachedToken(requestOptions);\n    if (cachedToken !== void 0) {\n      return { type: \"secret\", token: cachedToken };\n    }\n    let currentPromise;\n    if (requestOptions.roomId) {\n      currentPromise = requestPromises.get(requestOptions.roomId);\n      if (currentPromise === void 0) {\n        currentPromise = makeAuthRequest(requestOptions);\n        requestPromises.set(requestOptions.roomId, currentPromise);\n      }\n    } else {\n      currentPromise = requestPromises.get(\"liveblocks-user-token\");\n      if (currentPromise === void 0) {\n        currentPromise = makeAuthRequest(requestOptions);\n        requestPromises.set(\"liveblocks-user-token\", currentPromise);\n      }\n    }\n    try {\n      const token = await currentPromise;\n      const BUFFER = 30;\n      const expiresAt = Math.floor(Date.now() / 1e3) + (token.parsed.exp - token.parsed.iat) - BUFFER;\n      seenTokens.add(token.raw);\n      if (token.parsed.k !== \"sec-legacy\" /* SECRET_LEGACY */) {\n        tokens.push(token);\n        expiryTimes.push(expiresAt);\n      }\n      return { type: \"secret\", token };\n    } finally {\n      if (requestOptions.roomId) {\n        requestPromises.delete(requestOptions.roomId);\n      } else {\n        requestPromises.delete(\"liveblocks-user-token\");\n      }\n    }\n  }\n  return {\n    reset,\n    getAuthValue\n  };\n}\nfunction prepareAuthentication(authOptions) {\n  const { publicApiKey, authEndpoint } = authOptions;\n  if (authEndpoint !== void 0 && publicApiKey !== void 0) {\n    throw new Error(\n      \"You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient\"\n    );\n  }\n  if (typeof publicApiKey === \"string\") {\n    if (publicApiKey.startsWith(\"sk_\")) {\n      throw new Error(\n        \"Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey\"\n      );\n    } else if (!publicApiKey.startsWith(\"pk_\")) {\n      throw new Error(\n        \"Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey\"\n      );\n    }\n    return {\n      type: \"public\",\n      publicApiKey\n    };\n  }\n  if (typeof authEndpoint === \"string\") {\n    return {\n      type: \"private\",\n      url: authEndpoint\n    };\n  } else if (typeof authEndpoint === \"function\") {\n    return {\n      type: \"custom\",\n      callback: authEndpoint\n    };\n  } else if (authEndpoint !== void 0) {\n    throw new Error(\n      \"The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint\"\n    );\n  }\n  throw new Error(\n    \"Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient\"\n  );\n}\nasync function fetchAuthEndpoint(fetch2, endpoint, body) {\n  const res = await fetch2(endpoint, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(body)\n  });\n  if (!res.ok) {\n    const reason = `${(await res.text()).trim() || \"reason not provided in auth response\"} (${res.status} returned by POST ${endpoint})`;\n    if (res.status === 401 || res.status === 403) {\n      throw new StopRetrying(`Unauthorized: ${reason}`);\n    } else {\n      throw new Error(`Failed to authenticate: ${reason}`);\n    }\n  }\n  let data;\n  try {\n    data = await res.json();\n  } catch (er) {\n    throw new Error(\n      `Expected a JSON response when doing a POST request on \"${endpoint}\". ${String(\n        er\n      )}`\n    );\n  }\n  if (!isPlainObject(data) || typeof data.token !== \"string\") {\n    throw new Error(\n      `Expected a JSON response of the form \\`{ token: \"...\" }\\` when doing a POST request on \"${endpoint}\", but got ${JSON.stringify(\n        data\n      )}`\n    );\n  }\n  const { token } = data;\n  return { token };\n}\n\n// src/constants.ts\nvar DEFAULT_BASE_URL = \"https://api.liveblocks.io\";\n\n// src/internal.ts\nvar kInternal = Symbol();\n\n// src/devtools/bridge.ts\nvar _bridgeActive = false;\nfunction activateBridge(allowed) {\n  _bridgeActive = allowed;\n}\nfunction sendToPanel(message, options) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  const fullMsg = {\n    ...message,\n    source: \"liveblocks-devtools-client\"\n  };\n  if (!(options?.force || _bridgeActive)) {\n    return;\n  }\n  window.postMessage(fullMsg, \"*\");\n}\nvar eventSource = makeEventSource();\nif ( true && typeof window !== \"undefined\") {\n  window.addEventListener(\"message\", (event) => {\n    if (event.source === window && event.data?.source === \"liveblocks-devtools-panel\") {\n      eventSource.notify(event.data);\n    } else {\n    }\n  });\n}\nvar onMessageFromPanel = eventSource.observable;\n\n// src/devtools/index.ts\nvar VERSION = PKG_VERSION || \"dev\";\nvar _devtoolsSetupHasRun = false;\nfunction setupDevTools(getAllRooms) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  if (_devtoolsSetupHasRun) {\n    return;\n  }\n  _devtoolsSetupHasRun = true;\n  onMessageFromPanel.subscribe((msg) => {\n    switch (msg.msg) {\n      case \"connect\": {\n        activateBridge(true);\n        for (const roomId of getAllRooms()) {\n          sendToPanel({\n            msg: \"room::available\",\n            roomId,\n            clientVersion: VERSION\n          });\n        }\n        break;\n      }\n    }\n  });\n  sendToPanel({ msg: \"wake-up-devtools\" }, { force: true });\n}\nvar unsubsByRoomId = /* @__PURE__ */ new Map();\nfunction stopSyncStream(roomId) {\n  const unsubs = unsubsByRoomId.get(roomId) ?? [];\n  unsubsByRoomId.delete(roomId);\n  for (const unsub of unsubs) {\n    unsub();\n  }\n}\nfunction startSyncStream(room) {\n  stopSyncStream(room.id);\n  fullSync(room);\n  unsubsByRoomId.set(room.id, [\n    // When the connection status changes\n    room.events.status.subscribe(() => partialSyncConnection(room)),\n    // When storage initializes, send the update\n    room.events.storageDidLoad.subscribeOnce(() => partialSyncStorage(room)),\n    // Any time storage updates, send the new storage root\n    room.events.storageBatch.subscribe(() => partialSyncStorage(room)),\n    // Any time \"me\" or \"others\" updates, send the new values accordingly\n    room.events.self.subscribe(() => partialSyncMe(room)),\n    room.events.others.subscribe(() => partialSyncOthers(room)),\n    // Any time ydoc is updated, forward the update\n    room.events.ydoc.subscribe((update) => syncYdocUpdate(room, update)),\n    // Any time a custom room event is received, forward it\n    room.events.customEvent.subscribe(\n      (eventData) => forwardEvent(room, eventData)\n    )\n  ]);\n}\nfunction syncYdocUpdate(room, update) {\n  sendToPanel({\n    msg: \"room::sync::ydoc\",\n    roomId: room.id,\n    update\n  });\n}\nvar loadedAt = Date.now();\nvar eventCounter = 0;\nfunction nextEventId() {\n  return `event-${loadedAt}-${eventCounter++}`;\n}\nfunction forwardEvent(room, eventData) {\n  sendToPanel({\n    msg: \"room::events::custom-event\",\n    roomId: room.id,\n    event: {\n      type: \"CustomEvent\",\n      id: nextEventId(),\n      key: \"Event\",\n      connectionId: eventData.connectionId,\n      payload: eventData.event\n    }\n  });\n}\nfunction partialSyncConnection(room) {\n  sendToPanel({\n    msg: \"room::sync::partial\",\n    roomId: room.id,\n    status: room.getStatus()\n  });\n}\nfunction partialSyncStorage(room) {\n  const root = room.getStorageSnapshot();\n  if (root) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      storage: root.toTreeNode(\"root\").payload\n    });\n  }\n}\nfunction partialSyncMe(room) {\n  const me = room[kInternal].getSelf_forDevTools();\n  if (me) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      me\n    });\n  }\n}\nfunction partialSyncOthers(room) {\n  const others = room[kInternal].getOthers_forDevTools();\n  if (others) {\n    sendToPanel({\n      msg: \"room::sync::partial\",\n      roomId: room.id,\n      others\n    });\n  }\n}\nfunction fullSync(room) {\n  const root = room.getStorageSnapshot();\n  const me = room[kInternal].getSelf_forDevTools();\n  const others = room[kInternal].getOthers_forDevTools();\n  room.fetchYDoc(\"\");\n  sendToPanel({\n    msg: \"room::sync::full\",\n    roomId: room.id,\n    status: room.getStatus(),\n    storage: root?.toTreeNode(\"root\").payload ?? null,\n    me,\n    others\n  });\n}\nvar roomChannelListeners = /* @__PURE__ */ new Map();\nfunction stopRoomChannelListener(roomId) {\n  const listener = roomChannelListeners.get(roomId);\n  roomChannelListeners.delete(roomId);\n  if (listener) {\n    listener();\n  }\n}\nfunction linkDevTools(roomId, room) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  sendToPanel({ msg: \"room::available\", roomId, clientVersion: VERSION });\n  stopRoomChannelListener(roomId);\n  roomChannelListeners.set(\n    roomId,\n    // Returns the unsubscribe callback, that we store in the\n    // roomChannelListeners registry\n    onMessageFromPanel.subscribe((msg) => {\n      switch (msg.msg) {\n        case \"room::subscribe\": {\n          if (msg.roomId === roomId) {\n            startSyncStream(room);\n          }\n          break;\n        }\n        case \"room::unsubscribe\": {\n          if (msg.roomId === roomId) {\n            stopSyncStream(roomId);\n          }\n          break;\n        }\n      }\n    })\n  );\n}\nfunction unlinkDevTools(roomId) {\n  if ( false || typeof window === \"undefined\") {\n    return;\n  }\n  stopSyncStream(roomId);\n  stopRoomChannelListener(roomId);\n  sendToPanel({\n    msg: \"room::unavailable\",\n    roomId\n  });\n}\n\n// src/lib/stringify.ts\nfunction stringify(object, ...args) {\n  if (typeof object !== \"object\" || object === null || Array.isArray(object)) {\n    return JSON.stringify(object, ...args);\n  }\n  const sortedObject = Object.keys(object).sort().reduce(\n    (sortedObject2, key) => {\n      sortedObject2[key] = object[key];\n      return sortedObject2;\n    },\n    {}\n  );\n  return JSON.stringify(sortedObject, ...args);\n}\n\n// src/lib/batch.ts\nvar DEFAULT_SIZE = 50;\nvar BatchCall = class {\n  constructor(input) {\n    this.input = input;\n    const { promise, resolve, reject } = Promise_withResolvers();\n    this.promise = promise;\n    this.resolve = resolve;\n    this.reject = reject;\n  }\n};\nvar Batch = class {\n  constructor(callback, options) {\n    this.queue = [];\n    this.error = false;\n    this.callback = callback;\n    this.size = options.size ?? DEFAULT_SIZE;\n    this.delay = options.delay;\n  }\n  clearDelayTimeout() {\n    if (this.delayTimeoutId !== void 0) {\n      clearTimeout(this.delayTimeoutId);\n      this.delayTimeoutId = void 0;\n    }\n  }\n  schedule() {\n    if (this.queue.length === this.size) {\n      void this.flush();\n    } else if (this.queue.length === 1) {\n      this.clearDelayTimeout();\n      this.delayTimeoutId = setTimeout(() => void this.flush(), this.delay);\n    }\n  }\n  async flush() {\n    if (this.queue.length === 0) {\n      return;\n    }\n    const calls = this.queue.splice(0);\n    const inputs = calls.map((call) => call.input);\n    try {\n      const results = await this.callback(inputs);\n      this.error = false;\n      calls.forEach((call, index) => {\n        const result = results?.[index];\n        if (!Array.isArray(results)) {\n          call.reject(new Error(\"Callback must return an array.\"));\n        } else if (calls.length !== results.length) {\n          call.reject(\n            new Error(\n              `Callback must return an array of the same length as the number of provided items. Expected ${calls.length}, but got ${results.length}.`\n            )\n          );\n        } else if (result instanceof Error) {\n          call.reject(result);\n        } else {\n          call.resolve(result);\n        }\n      });\n    } catch (error3) {\n      this.error = true;\n      calls.forEach((call) => {\n        call.reject(error3);\n      });\n    }\n  }\n  get(input) {\n    const existingCall = this.queue.find(\n      (call2) => stringify(call2.input) === stringify(input)\n    );\n    if (existingCall) {\n      return existingCall.promise;\n    }\n    const call = new BatchCall(input);\n    this.queue.push(call);\n    this.schedule();\n    return call.promise;\n  }\n  clear() {\n    this.queue = [];\n    this.error = false;\n    this.clearDelayTimeout();\n  }\n};\nfunction createBatchStore(callback, options) {\n  const batch = new Batch(callback, options);\n  const cache = /* @__PURE__ */ new Map();\n  const eventSource2 = makeEventSource();\n  function getCacheKey(args) {\n    return stringify(args);\n  }\n  function setStateAndNotify(cacheKey, state) {\n    cache.set(cacheKey, state);\n    eventSource2.notify();\n  }\n  async function get(input) {\n    const cacheKey = getCacheKey(input);\n    if (cache.has(cacheKey)) {\n      return;\n    }\n    try {\n      setStateAndNotify(cacheKey, { isLoading: true });\n      const result = await batch.get(input);\n      setStateAndNotify(cacheKey, { isLoading: false, data: result });\n    } catch (error3) {\n      setStateAndNotify(cacheKey, {\n        isLoading: false,\n        error: error3\n      });\n    }\n  }\n  function getState(input) {\n    const cacheKey = getCacheKey(input);\n    return cache.get(cacheKey);\n  }\n  return {\n    ...eventSource2.observable,\n    get,\n    getState\n  };\n}\n\n// src/lib/create-store.ts\nfunction createStore(initialState) {\n  let state = initialState;\n  const subscribers = /* @__PURE__ */ new Set();\n  function get() {\n    return state;\n  }\n  function set(callback) {\n    const newState = callback(state);\n    if (state === newState) {\n      return;\n    }\n    state = newState;\n    for (const subscriber of subscribers) {\n      subscriber(state);\n    }\n  }\n  function subscribe(callback) {\n    subscribers.add(callback);\n    callback(state);\n    return () => {\n      subscribers.delete(callback);\n    };\n  }\n  return {\n    get,\n    set,\n    subscribe\n  };\n}\n\n// src/convert-plain-data.ts\nfunction convertToCommentData(data) {\n  const editedAt = data.editedAt ? new Date(data.editedAt) : void 0;\n  const createdAt = new Date(data.createdAt);\n  const reactions = data.reactions.map((reaction) => ({\n    ...reaction,\n    createdAt: new Date(reaction.createdAt)\n  }));\n  if (data.body) {\n    return {\n      ...data,\n      reactions,\n      createdAt,\n      editedAt\n    };\n  } else {\n    const deletedAt = new Date(data.deletedAt);\n    return {\n      ...data,\n      reactions,\n      createdAt,\n      editedAt,\n      deletedAt\n    };\n  }\n}\nfunction convertToThreadData(data) {\n  const updatedAt = data.updatedAt ? new Date(data.updatedAt) : void 0;\n  const createdAt = new Date(data.createdAt);\n  const comments = data.comments.map(\n    (comment) => convertToCommentData(comment)\n  );\n  return {\n    ...data,\n    createdAt,\n    updatedAt,\n    comments\n  };\n}\nfunction convertToCommentUserReaction(data) {\n  return {\n    ...data,\n    createdAt: new Date(data.createdAt)\n  };\n}\nfunction convertToInboxNotificationData(data) {\n  const notifiedAt = new Date(data.notifiedAt);\n  const readAt = data.readAt ? new Date(data.readAt) : null;\n  if (\"activities\" in data) {\n    const activities = data.activities.map((activity) => ({\n      ...activity,\n      createdAt: new Date(activity.createdAt)\n    }));\n    return {\n      ...data,\n      notifiedAt,\n      readAt,\n      activities\n    };\n  }\n  return {\n    ...data,\n    notifiedAt,\n    readAt\n  };\n}\nfunction convertToThreadDeleteInfo(data) {\n  const deletedAt = new Date(data.deletedAt);\n  return {\n    ...data,\n    deletedAt\n  };\n}\nfunction convertToInboxNotificationDeleteInfo(data) {\n  const deletedAt = new Date(data.deletedAt);\n  return {\n    ...data,\n    deletedAt\n  };\n}\n\n// src/lib/url.ts\nfunction toURLSearchParams(params) {\n  const result = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== void 0 && value !== null) {\n      result.set(key, value.toString());\n    }\n  }\n  return result;\n}\nfunction urljoin(baseUrl, path, params) {\n  const url = new URL(path, baseUrl);\n  if (params !== void 0) {\n    url.search = (params instanceof URLSearchParams ? params : toURLSearchParams(params)).toString();\n  }\n  return url.toString();\n}\n\n// src/notifications.ts\nvar MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY = 50;\nfunction createNotificationsApi({\n  baseUrl,\n  authManager,\n  currentUserIdStore,\n  fetcher\n}) {\n  async function fetchJson(endpoint, options, params) {\n    const authValue = await authManager.getAuthValue({\n      requestedScope: \"comments:read\"\n    });\n    if (authValue.type === \"secret\" && authValue.token.parsed.k === \"acc\" /* ACCESS_TOKEN */) {\n      const userId = authValue.token.parsed.uid;\n      currentUserIdStore.set(() => userId);\n    }\n    const url = urljoin(baseUrl, `/v2/c${endpoint}`, params);\n    const response = await fetcher(url.toString(), {\n      ...options,\n      headers: {\n        ...options?.headers,\n        Authorization: `Bearer ${getAuthBearerHeaderFromAuthValue(authValue)}`\n      }\n    });\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new NotificationsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new NotificationsApiError(\n            response.statusText,\n            response.status\n          );\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  async function getInboxNotifications() {\n    const json = await fetchJson(\"/inbox-notifications\", void 0, {});\n    return {\n      threads: json.threads.map(convertToThreadData),\n      inboxNotifications: json.inboxNotifications.map(\n        convertToInboxNotificationData\n      ),\n      requestedAt: new Date(json.meta.requestedAt)\n    };\n  }\n  async function getInboxNotificationsSince(options) {\n    const json = await fetchJson(\"/inbox-notifications\", void 0, {\n      since: options.since.toISOString()\n    });\n    return {\n      threads: {\n        updated: json.threads.map(convertToThreadData),\n        deleted: json.deletedThreads.map(convertToThreadDeleteInfo)\n      },\n      inboxNotifications: {\n        updated: json.inboxNotifications.map(convertToInboxNotificationData),\n        deleted: json.deletedInboxNotifications.map(\n          convertToInboxNotificationDeleteInfo\n        )\n      },\n      requestedAt: new Date(json.meta.requestedAt)\n    };\n  }\n  async function getUnreadInboxNotificationsCount() {\n    const { count } = await fetchJson(\"/inbox-notifications/count\");\n    return count;\n  }\n  async function markAllInboxNotificationsAsRead() {\n    await fetchJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds: \"all\" })\n    });\n  }\n  async function markInboxNotificationsAsRead(inboxNotificationIds) {\n    await fetchJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds })\n    });\n  }\n  const batchedMarkInboxNotificationsAsRead = new Batch(\n    async (batchedInboxNotificationIds) => {\n      const inboxNotificationIds = batchedInboxNotificationIds.flat();\n      await markInboxNotificationsAsRead(inboxNotificationIds);\n      return inboxNotificationIds;\n    },\n    { delay: MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY }\n  );\n  async function markInboxNotificationAsRead(inboxNotificationId) {\n    await batchedMarkInboxNotificationsAsRead.get(inboxNotificationId);\n  }\n  async function deleteAllInboxNotifications() {\n    await fetchJson(\"/inbox-notifications\", {\n      method: \"DELETE\"\n    });\n  }\n  async function deleteInboxNotification(inboxNotificationId) {\n    await fetchJson(\n      `/inbox-notifications/${encodeURIComponent(inboxNotificationId)}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  return {\n    getInboxNotifications,\n    getInboxNotificationsSince,\n    getUnreadInboxNotificationsCount,\n    markAllInboxNotificationsAsRead,\n    markInboxNotificationAsRead,\n    deleteAllInboxNotifications,\n    deleteInboxNotification\n  };\n}\n\n// src/lib/position.ts\nvar MIN_CODE = 32;\nvar MAX_CODE = 126;\nvar NUM_DIGITS = MAX_CODE - MIN_CODE + 1;\nvar ZERO = nthDigit(0);\nvar ONE = nthDigit(1);\nvar ZERO_NINE = ZERO + nthDigit(-1);\nfunction nthDigit(n) {\n  const code = MIN_CODE + (n < 0 ? NUM_DIGITS + n : n);\n  if (code < MIN_CODE || code > MAX_CODE) {\n    throw new Error(`Invalid n value: ${n}`);\n  }\n  return String.fromCharCode(code);\n}\nfunction makePosition(x, y) {\n  if (x !== void 0 && y !== void 0) {\n    return between(x, y);\n  } else if (x !== void 0) {\n    return after(x);\n  } else if (y !== void 0) {\n    return before(y);\n  } else {\n    return ONE;\n  }\n}\nfunction before(pos) {\n  const lastIndex = pos.length - 1;\n  for (let i = 0; i <= lastIndex; i++) {\n    const code = pos.charCodeAt(i);\n    if (code <= MIN_CODE) {\n      continue;\n    }\n    if (i === lastIndex) {\n      if (code === MIN_CODE + 1) {\n        return pos.substring(0, i) + ZERO_NINE;\n      } else {\n        return pos.substring(0, i) + String.fromCharCode(code - 1);\n      }\n    } else {\n      return pos.substring(0, i + 1);\n    }\n  }\n  return ONE;\n}\nfunction after(pos) {\n  for (let i = 0; i <= pos.length - 1; i++) {\n    const code = pos.charCodeAt(i);\n    if (code >= MAX_CODE) {\n      continue;\n    }\n    return pos.substring(0, i) + String.fromCharCode(code + 1);\n  }\n  return pos + ONE;\n}\nfunction between(lo, hi) {\n  if (lo < hi) {\n    return _between(lo, hi);\n  } else if (lo > hi) {\n    return _between(hi, lo);\n  } else {\n    throw new Error(\"Cannot compute value between two equal positions\");\n  }\n}\nfunction _between(lo, hi) {\n  let index = 0;\n  const loLen = lo.length;\n  const hiLen = hi.length;\n  while (true) {\n    const loCode = index < loLen ? lo.charCodeAt(index) : MIN_CODE;\n    const hiCode = index < hiLen ? hi.charCodeAt(index) : MAX_CODE;\n    if (loCode === hiCode) {\n      index++;\n      continue;\n    }\n    if (hiCode - loCode === 1) {\n      const size = index + 1;\n      let prefix = lo.substring(0, size);\n      if (prefix.length < size) {\n        prefix += ZERO.repeat(size - prefix.length);\n      }\n      const suffix = lo.substring(size);\n      const nines = \"\";\n      return prefix + _between(suffix, nines);\n    } else {\n      return takeN(lo, index) + String.fromCharCode(hiCode + loCode >> 1);\n    }\n  }\n}\nfunction takeN(pos, n) {\n  return n < pos.length ? pos.substring(0, n) : pos + ZERO.repeat(n - pos.length);\n}\nvar MIN_NON_ZERO_CODE = MIN_CODE + 1;\nfunction isPos(str) {\n  if (str === \"\") {\n    return false;\n  }\n  const lastIdx = str.length - 1;\n  const last = str.charCodeAt(lastIdx);\n  if (last < MIN_NON_ZERO_CODE || last > MAX_CODE) {\n    return false;\n  }\n  for (let i = 0; i < lastIdx; i++) {\n    const code = str.charCodeAt(i);\n    if (code < MIN_CODE || code > MAX_CODE) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction convertToPos(str) {\n  const codes = [];\n  for (let i = 0; i < str.length; i++) {\n    const code = str.charCodeAt(i);\n    codes.push(code < MIN_CODE ? MIN_CODE : code > MAX_CODE ? MAX_CODE : code);\n  }\n  while (codes.length > 0 && codes[codes.length - 1] === MIN_CODE) {\n    codes.length--;\n  }\n  return codes.length > 0 ? String.fromCharCode(...codes) : (\n    // Edge case: the str was a 0-only string, which is invalid. Default back to .1\n    ONE\n  );\n}\nfunction asPos(str) {\n  return isPos(str) ? str : convertToPos(str);\n}\n\n// src/protocol/Op.ts\nvar OpCode = /* @__PURE__ */ ((OpCode2) => {\n  OpCode2[OpCode2[\"INIT\"] = 0] = \"INIT\";\n  OpCode2[OpCode2[\"SET_PARENT_KEY\"] = 1] = \"SET_PARENT_KEY\";\n  OpCode2[OpCode2[\"CREATE_LIST\"] = 2] = \"CREATE_LIST\";\n  OpCode2[OpCode2[\"UPDATE_OBJECT\"] = 3] = \"UPDATE_OBJECT\";\n  OpCode2[OpCode2[\"CREATE_OBJECT\"] = 4] = \"CREATE_OBJECT\";\n  OpCode2[OpCode2[\"DELETE_CRDT\"] = 5] = \"DELETE_CRDT\";\n  OpCode2[OpCode2[\"DELETE_OBJECT_KEY\"] = 6] = \"DELETE_OBJECT_KEY\";\n  OpCode2[OpCode2[\"CREATE_MAP\"] = 7] = \"CREATE_MAP\";\n  OpCode2[OpCode2[\"CREATE_REGISTER\"] = 8] = \"CREATE_REGISTER\";\n  return OpCode2;\n})(OpCode || {});\nfunction ackOp(opId) {\n  return {\n    type: 5 /* DELETE_CRDT */,\n    id: \"ACK\",\n    // (H)ACK\n    opId\n  };\n}\nfunction isAckOp(op) {\n  return op.type === 5 /* DELETE_CRDT */ && op.id === \"ACK\";\n}\n\n// src/crdts/AbstractCrdt.ts\nfunction crdtAsLiveNode(value) {\n  return value;\n}\nfunction HasParent(node, key, pos = asPos(key)) {\n  return Object.freeze({ type: \"HasParent\", node, key, pos });\n}\nvar NoParent = Object.freeze({ type: \"NoParent\" });\nfunction Orphaned(oldKey, oldPos = asPos(oldKey)) {\n  return Object.freeze({ type: \"Orphaned\", oldKey, oldPos });\n}\nvar AbstractCrdt = class {\n  constructor() {\n    /** @internal */\n    this._parent = NoParent;\n  }\n  /** @internal */\n  _getParentKeyOrThrow() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.key;\n      case \"NoParent\":\n        throw new Error(\"Parent key is missing\");\n      case \"Orphaned\":\n        return this.parent.oldKey;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  get _parentPos() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.pos;\n      case \"NoParent\":\n        throw new Error(\"Parent key is missing\");\n      case \"Orphaned\":\n        return this.parent.oldPos;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  get _pool() {\n    return this.__pool;\n  }\n  get roomId() {\n    return this.__pool ? this.__pool.roomId : null;\n  }\n  /** @internal */\n  get _id() {\n    return this.__id;\n  }\n  /** @internal */\n  get parent() {\n    return this._parent;\n  }\n  /** @internal */\n  get _parentKey() {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        return this.parent.key;\n      case \"NoParent\":\n        return null;\n      case \"Orphaned\":\n        return this.parent.oldKey;\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  _apply(op, _isLocal) {\n    switch (op.type) {\n      case 5 /* DELETE_CRDT */: {\n        if (this.parent.type === \"HasParent\") {\n          return this.parent.node._detachChild(crdtAsLiveNode(this));\n        }\n        return { modified: false };\n      }\n    }\n    return { modified: false };\n  }\n  /** @internal */\n  _setParentLink(newParentNode, newParentKey) {\n    switch (this.parent.type) {\n      case \"HasParent\":\n        if (this.parent.node !== newParentNode) {\n          throw new Error(\"Cannot set parent: node already has a parent\");\n        } else {\n          this._parent = HasParent(newParentNode, newParentKey);\n          return;\n        }\n      case \"Orphaned\":\n      case \"NoParent\": {\n        this._parent = HasParent(newParentNode, newParentKey);\n        return;\n      }\n      default:\n        return assertNever(this.parent, \"Unknown state\");\n    }\n  }\n  /** @internal */\n  _attach(id, pool) {\n    if (this.__id || this.__pool) {\n      throw new Error(\"Cannot attach node: already attached\");\n    }\n    pool.addNode(id, crdtAsLiveNode(this));\n    this.__id = id;\n    this.__pool = pool;\n  }\n  /** @internal */\n  _detach() {\n    if (this.__pool && this.__id) {\n      this.__pool.deleteNode(this.__id);\n    }\n    switch (this.parent.type) {\n      case \"HasParent\": {\n        this._parent = Orphaned(this.parent.key, this.parent.pos);\n        break;\n      }\n      case \"NoParent\": {\n        this._parent = NoParent;\n        break;\n      }\n      case \"Orphaned\": {\n        break;\n      }\n      default:\n        assertNever(this.parent, \"Unknown state\");\n    }\n    this.__pool = void 0;\n  }\n  /**\n   * @internal\n   *\n   * Clear the Immutable cache, so that the next call to `.toImmutable()` will\n   * recompute the equivalent Immutable value again.  Call this after every\n   * mutation to the Live node.\n   */\n  invalidate() {\n    if (this._cachedImmutable !== void 0 || this._cachedTreeNode !== void 0) {\n      this._cachedImmutable = void 0;\n      this._cachedTreeNode = void 0;\n      if (this.parent.type === \"HasParent\") {\n        this.parent.node.invalidate();\n      }\n    }\n  }\n  /**\n   * @internal\n   *\n   * Return an snapshot of this Live tree for use in DevTools.\n   */\n  toTreeNode(key) {\n    if (this._cachedTreeNode === void 0 || this._cachedTreeNodeKey !== key) {\n      this._cachedTreeNodeKey = key;\n      this._cachedTreeNode = this._toTreeNode(key);\n    }\n    return this._cachedTreeNode;\n  }\n  /**\n   * Return an immutable snapshot of this Live node and its children.\n   */\n  toImmutable() {\n    if (this._cachedImmutable === void 0) {\n      this._cachedImmutable = this._toImmutable();\n    }\n    return this._cachedImmutable;\n  }\n};\n\n// src/protocol/SerializedCrdt.ts\nvar CrdtType = /* @__PURE__ */ ((CrdtType2) => {\n  CrdtType2[CrdtType2[\"OBJECT\"] = 0] = \"OBJECT\";\n  CrdtType2[CrdtType2[\"LIST\"] = 1] = \"LIST\";\n  CrdtType2[CrdtType2[\"MAP\"] = 2] = \"MAP\";\n  CrdtType2[CrdtType2[\"REGISTER\"] = 3] = \"REGISTER\";\n  return CrdtType2;\n})(CrdtType || {});\nfunction isRootCrdt(crdt) {\n  return crdt.type === 0 /* OBJECT */ && !isChildCrdt(crdt);\n}\nfunction isChildCrdt(crdt) {\n  return crdt.parentId !== void 0 && crdt.parentKey !== void 0;\n}\n\n// src/lib/nanoid.ts\nvar nanoid = (t = 21) => crypto.getRandomValues(new Uint8Array(t)).reduce(\n  (t2, e) => t2 += (e &= 63) < 36 ? e.toString(36) : e < 62 ? (e - 26).toString(36).toUpperCase() : e < 63 ? \"_\" : \"-\",\n  \"\"\n);\n\n// src/crdts/LiveRegister.ts\nvar LiveRegister = class _LiveRegister extends AbstractCrdt {\n  constructor(data) {\n    super();\n    this._data = data;\n  }\n  get data() {\n    return this._data;\n  }\n  /** @internal */\n  static _deserialize([id, item], _parentToChildren, pool) {\n    const register = new _LiveRegister(item.data);\n    register._attach(id, pool);\n    return register;\n  }\n  /** @internal */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\n        \"Cannot serialize register if parentId or parentKey is undefined\"\n      );\n    }\n    return [\n      {\n        type: 8 /* CREATE_REGISTER */,\n        opId: pool?.generateOpId(),\n        id: this._id,\n        parentId,\n        parentKey,\n        data: this.data\n      }\n    ];\n  }\n  /** @internal */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveRegister if parent is missing\");\n    }\n    return {\n      type: 3 /* REGISTER */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key,\n      data: this.data\n    };\n  }\n  /** @internal */\n  _attachChild(_op) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /** @internal */\n  _detachChild(_crdt) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    return super._apply(op, isLocal);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"Json\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: this._data\n    };\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._data;\n  }\n  clone() {\n    return deepClone(this.data);\n  }\n};\n\n// src/crdts/LiveList.ts\nfunction compareNodePosition(itemA, itemB) {\n  const posA = itemA._parentPos;\n  const posB = itemB._parentPos;\n  return posA === posB ? 0 : posA < posB ? -1 : 1;\n}\nvar LiveList = class _LiveList extends AbstractCrdt {\n  constructor(items) {\n    super();\n    this._items = [];\n    this._implicitlyDeletedItems = /* @__PURE__ */ new WeakSet();\n    this._unacknowledgedSets = /* @__PURE__ */ new Map();\n    let position = void 0;\n    for (const item of items) {\n      const newPosition = makePosition(position);\n      const node = lsonToLiveNode(item);\n      node._setParentLink(this, newPosition);\n      this._items.push(node);\n      position = newPosition;\n    }\n  }\n  /** @internal */\n  static _deserialize([id], parentToChildren, pool) {\n    const list = new _LiveList([]);\n    list._attach(id, pool);\n    const children = parentToChildren.get(id);\n    if (children === void 0) {\n      return list;\n    }\n    for (const [id2, crdt] of children) {\n      const child = deserialize([id2, crdt], parentToChildren, pool);\n      child._setParentLink(list, crdt.parentKey);\n      list._insertAndSort(child);\n    }\n    return list;\n  }\n  /**\n   * @internal\n   * This function assumes that the resulting ops will be sent to the server if they have an 'opId'\n   * so we mutate _unacknowledgedSets to avoid potential flickering\n   * https://github.com/liveblocks/liveblocks/pull/1177\n   *\n   * This is quite unintuitive and should disappear as soon as\n   * we introduce an explicit LiveList.Set operation\n   */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const ops = [];\n    const op = {\n      id: this._id,\n      opId: pool?.generateOpId(),\n      type: 2 /* CREATE_LIST */,\n      parentId,\n      parentKey\n    };\n    ops.push(op);\n    for (const item of this._items) {\n      const parentKey2 = item._getParentKeyOrThrow();\n      const childOps = HACK_addIntentAndDeletedIdToOperation(\n        item._toOps(this._id, parentKey2, pool),\n        void 0\n      );\n      const childOpId = childOps[0].opId;\n      if (childOpId !== void 0) {\n        this._unacknowledgedSets.set(parentKey2, childOpId);\n      }\n      ops.push(...childOps);\n    }\n    return ops;\n  }\n  /**\n   * @internal\n   *\n   * Adds a new item into the sorted list, in the correct position.\n   */\n  _insertAndSort(item) {\n    this._items.push(item);\n    this._sortItems();\n  }\n  /** @internal */\n  _sortItems() {\n    this._items.sort(compareNodePosition);\n    this.invalidate();\n  }\n  /** @internal */\n  _indexOfPosition(position) {\n    return this._items.findIndex(\n      (item) => item._getParentKeyOrThrow() === position\n    );\n  }\n  /** @internal */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const item of this._items) {\n      item._attach(pool.generateId(), pool);\n    }\n  }\n  /** @internal */\n  _detach() {\n    super._detach();\n    for (const item of this._items) {\n      item._detach();\n    }\n  }\n  /** @internal */\n  _applySetRemote(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    child._attach(id, this._pool);\n    child._setParentLink(this, key);\n    const deletedId = op.deletedId;\n    const indexOfItemWithSamePosition = this._indexOfPosition(key);\n    if (indexOfItemWithSamePosition !== -1) {\n      const itemWithSamePosition = this._items[indexOfItemWithSamePosition];\n      if (itemWithSamePosition._id === deletedId) {\n        itemWithSamePosition._detach();\n        this._items[indexOfItemWithSamePosition] = child;\n        return {\n          modified: makeUpdate(this, [\n            setDelta(indexOfItemWithSamePosition, child)\n          ]),\n          reverse: []\n        };\n      } else {\n        this._implicitlyDeletedItems.add(itemWithSamePosition);\n        this._items[indexOfItemWithSamePosition] = child;\n        const delta = [\n          setDelta(indexOfItemWithSamePosition, child)\n        ];\n        const deleteDelta2 = this._detachItemAssociatedToSetOperation(\n          op.deletedId\n        );\n        if (deleteDelta2) {\n          delta.push(deleteDelta2);\n        }\n        return {\n          modified: makeUpdate(this, delta),\n          reverse: []\n        };\n      }\n    } else {\n      const updates = [];\n      const deleteDelta2 = this._detachItemAssociatedToSetOperation(\n        op.deletedId\n      );\n      if (deleteDelta2) {\n        updates.push(deleteDelta2);\n      }\n      this._insertAndSort(child);\n      updates.push(insertDelta(this._indexOfPosition(key), child));\n      return {\n        reverse: [],\n        modified: makeUpdate(this, updates)\n      };\n    }\n  }\n  /** @internal */\n  _applySetAck(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const delta = [];\n    const deletedDelta = this._detachItemAssociatedToSetOperation(op.deletedId);\n    if (deletedDelta) {\n      delta.push(deletedDelta);\n    }\n    const unacknowledgedOpId = this._unacknowledgedSets.get(op.parentKey);\n    if (unacknowledgedOpId !== void 0) {\n      if (unacknowledgedOpId !== op.opId) {\n        return delta.length === 0 ? { modified: false } : { modified: makeUpdate(this, delta), reverse: [] };\n      } else {\n        this._unacknowledgedSets.delete(op.parentKey);\n      }\n    }\n    const indexOfItemWithSamePosition = this._indexOfPosition(op.parentKey);\n    const existingItem = this._items.find((item) => item._id === op.id);\n    if (existingItem !== void 0) {\n      if (existingItem._parentKey === op.parentKey) {\n        return {\n          modified: delta.length > 0 ? makeUpdate(this, delta) : false,\n          reverse: []\n        };\n      }\n      if (indexOfItemWithSamePosition !== -1) {\n        this._implicitlyDeletedItems.add(\n          this._items[indexOfItemWithSamePosition]\n        );\n        this._items.splice(indexOfItemWithSamePosition, 1);\n        delta.push(deleteDelta(indexOfItemWithSamePosition));\n      }\n      const previousIndex = this._items.indexOf(existingItem);\n      existingItem._setParentLink(this, op.parentKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(existingItem);\n      if (newIndex !== previousIndex) {\n        delta.push(moveDelta(previousIndex, newIndex, existingItem));\n      }\n      return {\n        modified: delta.length > 0 ? makeUpdate(this, delta) : false,\n        reverse: []\n      };\n    } else {\n      const orphan = this._pool.getNode(op.id);\n      if (orphan && this._implicitlyDeletedItems.has(orphan)) {\n        orphan._setParentLink(this, op.parentKey);\n        this._implicitlyDeletedItems.delete(orphan);\n        this._insertAndSort(orphan);\n        const recreatedItemIndex = this._items.indexOf(orphan);\n        return {\n          modified: makeUpdate(this, [\n            // If there is an item at this position, update is a set, else it's an insert\n            indexOfItemWithSamePosition === -1 ? insertDelta(recreatedItemIndex, orphan) : setDelta(recreatedItemIndex, orphan),\n            ...delta\n          ]),\n          reverse: []\n        };\n      } else {\n        if (indexOfItemWithSamePosition !== -1) {\n          this._items.splice(indexOfItemWithSamePosition, 1);\n        }\n        const { newItem, newIndex } = this._createAttachItemAndSort(\n          op,\n          op.parentKey\n        );\n        return {\n          modified: makeUpdate(this, [\n            // If there is an item at this position, update is a set, else it's an insert\n            indexOfItemWithSamePosition === -1 ? insertDelta(newIndex, newItem) : setDelta(newIndex, newItem),\n            ...delta\n          ]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /**\n   * Returns the update delta of the deletion or null\n   * @internal\n   */\n  _detachItemAssociatedToSetOperation(deletedId) {\n    if (deletedId === void 0 || this._pool === void 0) {\n      return null;\n    }\n    const deletedItem = this._pool.getNode(deletedId);\n    if (deletedItem === void 0) {\n      return null;\n    }\n    const result = this._detachChild(deletedItem);\n    if (result.modified === false) {\n      return null;\n    }\n    return result.modified.updates[0];\n  }\n  /** @internal */\n  _applyRemoteInsert(op) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const key = asPos(op.parentKey);\n    const existingItemIndex = this._indexOfPosition(key);\n    if (existingItemIndex !== -1) {\n      this._shiftItemPosition(existingItemIndex, key);\n    }\n    const { newItem, newIndex } = this._createAttachItemAndSort(op, key);\n    return {\n      modified: makeUpdate(this, [insertDelta(newIndex, newItem)]),\n      reverse: []\n    };\n  }\n  /** @internal */\n  _applyInsertAck(op) {\n    const existingItem = this._items.find((item) => item._id === op.id);\n    const key = asPos(op.parentKey);\n    const itemIndexAtPosition = this._indexOfPosition(key);\n    if (existingItem) {\n      if (existingItem._parentKey === key) {\n        return {\n          modified: false\n        };\n      } else {\n        const oldPositionIndex = this._items.indexOf(existingItem);\n        if (itemIndexAtPosition !== -1) {\n          this._shiftItemPosition(itemIndexAtPosition, key);\n        }\n        existingItem._setParentLink(this, key);\n        this._sortItems();\n        const newIndex = this._indexOfPosition(key);\n        if (newIndex === oldPositionIndex) {\n          return { modified: false };\n        }\n        return {\n          modified: makeUpdate(this, [\n            moveDelta(oldPositionIndex, newIndex, existingItem)\n          ]),\n          reverse: []\n        };\n      }\n    } else {\n      const orphan = nn(this._pool).getNode(op.id);\n      if (orphan && this._implicitlyDeletedItems.has(orphan)) {\n        orphan._setParentLink(this, key);\n        this._implicitlyDeletedItems.delete(orphan);\n        this._insertAndSort(orphan);\n        const newIndex = this._indexOfPosition(key);\n        return {\n          modified: makeUpdate(this, [insertDelta(newIndex, orphan)]),\n          reverse: []\n        };\n      } else {\n        if (itemIndexAtPosition !== -1) {\n          this._shiftItemPosition(itemIndexAtPosition, key);\n        }\n        const { newItem, newIndex } = this._createAttachItemAndSort(op, key);\n        return {\n          modified: makeUpdate(this, [insertDelta(newIndex, newItem)]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /** @internal */\n  _applyInsertUndoRedo(op) {\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    if (this._pool?.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    child._attach(id, nn(this._pool));\n    child._setParentLink(this, key);\n    const existingItemIndex = this._indexOfPosition(key);\n    let newKey = key;\n    if (existingItemIndex !== -1) {\n      const before2 = this._items[existingItemIndex]?._parentPos;\n      const after2 = this._items[existingItemIndex + 1]?._parentPos;\n      newKey = makePosition(before2, after2);\n      child._setParentLink(this, newKey);\n    }\n    this._insertAndSort(child);\n    const newIndex = this._indexOfPosition(newKey);\n    return {\n      modified: makeUpdate(this, [insertDelta(newIndex, child)]),\n      reverse: [{ type: 5 /* DELETE_CRDT */, id }]\n    };\n  }\n  /** @internal */\n  _applySetUndoRedo(op) {\n    const { id, parentKey: key } = op;\n    const child = creationOpToLiveNode(op);\n    if (this._pool?.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    this._unacknowledgedSets.set(key, nn(op.opId));\n    const indexOfItemWithSameKey = this._indexOfPosition(key);\n    child._attach(id, nn(this._pool));\n    child._setParentLink(this, key);\n    const newKey = key;\n    if (indexOfItemWithSameKey !== -1) {\n      const existingItem = this._items[indexOfItemWithSameKey];\n      existingItem._detach();\n      this._items[indexOfItemWithSameKey] = child;\n      const reverse = HACK_addIntentAndDeletedIdToOperation(\n        existingItem._toOps(nn(this._id), key, this._pool),\n        op.id\n      );\n      const delta = [setDelta(indexOfItemWithSameKey, child)];\n      const deletedDelta = this._detachItemAssociatedToSetOperation(\n        op.deletedId\n      );\n      if (deletedDelta) {\n        delta.push(deletedDelta);\n      }\n      return {\n        modified: makeUpdate(this, delta),\n        reverse\n      };\n    } else {\n      this._insertAndSort(child);\n      this._detachItemAssociatedToSetOperation(op.deletedId);\n      const newIndex = this._indexOfPosition(newKey);\n      return {\n        reverse: [{ type: 5 /* DELETE_CRDT */, id }],\n        modified: makeUpdate(this, [insertDelta(newIndex, child)])\n      };\n    }\n  }\n  /** @internal */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    let result;\n    if (op.intent === \"set\") {\n      if (source === 1 /* REMOTE */) {\n        result = this._applySetRemote(op);\n      } else if (source === 2 /* ACK */) {\n        result = this._applySetAck(op);\n      } else {\n        result = this._applySetUndoRedo(op);\n      }\n    } else {\n      if (source === 1 /* REMOTE */) {\n        result = this._applyRemoteInsert(op);\n      } else if (source === 2 /* ACK */) {\n        result = this._applyInsertAck(op);\n      } else {\n        result = this._applyInsertUndoRedo(op);\n      }\n    }\n    if (result.modified !== false) {\n      this.invalidate();\n    }\n    return result;\n  }\n  /** @internal */\n  _detachChild(child) {\n    if (child) {\n      const parentKey = nn(child._parentKey);\n      const reverse = child._toOps(nn(this._id), parentKey, this._pool);\n      const indexToDelete = this._items.indexOf(child);\n      if (indexToDelete === -1) {\n        return {\n          modified: false\n        };\n      }\n      this._items.splice(indexToDelete, 1);\n      this.invalidate();\n      child._detach();\n      return {\n        modified: makeUpdate(this, [deleteDelta(indexToDelete)]),\n        reverse\n      };\n    }\n    return { modified: false };\n  }\n  /** @internal */\n  _applySetChildKeyRemote(newKey, child) {\n    if (this._implicitlyDeletedItems.has(child)) {\n      this._implicitlyDeletedItems.delete(child);\n      child._setParentLink(this, newKey);\n      this._insertAndSort(child);\n      const newIndex = this._items.indexOf(child);\n      return {\n        modified: makeUpdate(this, [insertDelta(newIndex, child)]),\n        reverse: []\n      };\n    }\n    const previousKey = child._parentKey;\n    if (newKey === previousKey) {\n      return {\n        modified: false\n      };\n    }\n    const existingItemIndex = this._indexOfPosition(newKey);\n    if (existingItemIndex === -1) {\n      const previousIndex = this._items.indexOf(child);\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (newIndex === previousIndex) {\n        return {\n          modified: false\n        };\n      }\n      return {\n        modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n        reverse: []\n      };\n    } else {\n      this._items[existingItemIndex]._setParentLink(\n        this,\n        makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n      );\n      const previousIndex = this._items.indexOf(child);\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (newIndex === previousIndex) {\n        return {\n          modified: false\n        };\n      }\n      return {\n        modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n        reverse: []\n      };\n    }\n  }\n  /** @internal */\n  _applySetChildKeyAck(newKey, child) {\n    const previousKey = nn(child._parentKey);\n    if (this._implicitlyDeletedItems.has(child)) {\n      const existingItemIndex = this._indexOfPosition(newKey);\n      this._implicitlyDeletedItems.delete(child);\n      if (existingItemIndex !== -1) {\n        this._items[existingItemIndex]._setParentLink(\n          this,\n          makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n        );\n      }\n      child._setParentLink(this, newKey);\n      this._insertAndSort(child);\n      return {\n        modified: false\n      };\n    } else {\n      if (newKey === previousKey) {\n        return {\n          modified: false\n        };\n      }\n      const previousIndex = this._items.indexOf(child);\n      const existingItemIndex = this._indexOfPosition(newKey);\n      if (existingItemIndex !== -1) {\n        this._items[existingItemIndex]._setParentLink(\n          this,\n          makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n        );\n      }\n      child._setParentLink(this, newKey);\n      this._sortItems();\n      const newIndex = this._items.indexOf(child);\n      if (previousIndex === newIndex) {\n        return {\n          modified: false\n        };\n      } else {\n        return {\n          modified: makeUpdate(this, [\n            moveDelta(previousIndex, newIndex, child)\n          ]),\n          reverse: []\n        };\n      }\n    }\n  }\n  /** @internal */\n  _applySetChildKeyUndoRedo(newKey, child) {\n    const previousKey = nn(child._parentKey);\n    const previousIndex = this._items.indexOf(child);\n    const existingItemIndex = this._indexOfPosition(newKey);\n    if (existingItemIndex !== -1) {\n      this._items[existingItemIndex]._setParentLink(\n        this,\n        makePosition(newKey, this._items[existingItemIndex + 1]?._parentPos)\n      );\n    }\n    child._setParentLink(this, newKey);\n    this._sortItems();\n    const newIndex = this._items.indexOf(child);\n    if (previousIndex === newIndex) {\n      return {\n        modified: false\n      };\n    }\n    return {\n      modified: makeUpdate(this, [moveDelta(previousIndex, newIndex, child)]),\n      reverse: [\n        {\n          type: 1 /* SET_PARENT_KEY */,\n          id: nn(child._id),\n          parentKey: previousKey\n        }\n      ]\n    };\n  }\n  /** @internal */\n  _setChildKey(newKey, child, source) {\n    if (source === 1 /* REMOTE */) {\n      return this._applySetChildKeyRemote(newKey, child);\n    } else if (source === 2 /* ACK */) {\n      return this._applySetChildKeyAck(newKey, child);\n    } else {\n      return this._applySetChildKeyUndoRedo(newKey, child);\n    }\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    return super._apply(op, isLocal);\n  }\n  /** @internal */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveList if parent is missing\");\n    }\n    return {\n      type: 1 /* LIST */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key\n    };\n  }\n  /**\n   * Returns the number of elements.\n   */\n  get length() {\n    return this._items.length;\n  }\n  /**\n   * Adds one element to the end of the LiveList.\n   * @param element The element to add to the end of the LiveList.\n   */\n  push(element) {\n    this._pool?.assertStorageIsWritable();\n    return this.insert(element, this.length);\n  }\n  /**\n   * Inserts one element at a specified index.\n   * @param element The element to insert.\n   * @param index The index at which you want to insert the element.\n   */\n  insert(element, index) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index > this._items.length) {\n      throw new Error(\n        `Cannot insert list item at index \"\u001d${index}\". index should be between 0 and ${this._items.length}`\n      );\n    }\n    const before2 = this._items[index - 1] ? this._items[index - 1]._parentPos : void 0;\n    const after2 = this._items[index] ? this._items[index]._parentPos : void 0;\n    const position = makePosition(before2, after2);\n    const value = lsonToLiveNode(element);\n    value._setParentLink(this, position);\n    this._insertAndSort(value);\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      value._attach(id, this._pool);\n      this._pool.dispatch(\n        value._toOps(this._id, position, this._pool),\n        [{ type: 5 /* DELETE_CRDT */, id }],\n        /* @__PURE__ */ new Map([\n          [this._id, makeUpdate(this, [insertDelta(index, value)])]\n        ])\n      );\n    }\n  }\n  /**\n   * Move one element from one index to another.\n   * @param index The index of the element to move\n   * @param targetIndex The index where the element should be after moving.\n   */\n  move(index, targetIndex) {\n    this._pool?.assertStorageIsWritable();\n    if (targetIndex < 0) {\n      throw new Error(\"targetIndex cannot be less than 0\");\n    }\n    if (targetIndex >= this._items.length) {\n      throw new Error(\n        \"targetIndex cannot be greater or equal than the list length\"\n      );\n    }\n    if (index < 0) {\n      throw new Error(\"index cannot be less than 0\");\n    }\n    if (index >= this._items.length) {\n      throw new Error(\"index cannot be greater or equal than the list length\");\n    }\n    let beforePosition = null;\n    let afterPosition = null;\n    if (index < targetIndex) {\n      afterPosition = targetIndex === this._items.length - 1 ? void 0 : this._items[targetIndex + 1]._parentPos;\n      beforePosition = this._items[targetIndex]._parentPos;\n    } else {\n      afterPosition = this._items[targetIndex]._parentPos;\n      beforePosition = targetIndex === 0 ? void 0 : this._items[targetIndex - 1]._parentPos;\n    }\n    const position = makePosition(beforePosition, afterPosition);\n    const item = this._items[index];\n    const previousPosition = item._getParentKeyOrThrow();\n    item._setParentLink(this, position);\n    this._sortItems();\n    if (this._pool && this._id) {\n      const storageUpdates = /* @__PURE__ */ new Map([\n        [this._id, makeUpdate(this, [moveDelta(index, targetIndex, item)])]\n      ]);\n      this._pool.dispatch(\n        [\n          {\n            type: 1 /* SET_PARENT_KEY */,\n            id: nn(item._id),\n            opId: this._pool.generateOpId(),\n            parentKey: position\n          }\n        ],\n        [\n          {\n            type: 1 /* SET_PARENT_KEY */,\n            id: nn(item._id),\n            parentKey: previousPosition\n          }\n        ],\n        storageUpdates\n      );\n    }\n  }\n  /**\n   * Deletes an element at the specified index\n   * @param index The index of the element to delete\n   */\n  delete(index) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index >= this._items.length) {\n      throw new Error(\n        `Cannot delete list item at index \"${index}\". index should be between 0 and ${this._items.length - 1}`\n      );\n    }\n    const item = this._items[index];\n    item._detach();\n    this._items.splice(index, 1);\n    this.invalidate();\n    if (this._pool) {\n      const childRecordId = item._id;\n      if (childRecordId) {\n        const storageUpdates = /* @__PURE__ */ new Map();\n        storageUpdates.set(\n          nn(this._id),\n          makeUpdate(this, [deleteDelta(index)])\n        );\n        this._pool.dispatch(\n          [\n            {\n              id: childRecordId,\n              opId: this._pool.generateOpId(),\n              type: 5 /* DELETE_CRDT */\n            }\n          ],\n          item._toOps(nn(this._id), item._getParentKeyOrThrow()),\n          storageUpdates\n        );\n      }\n    }\n  }\n  clear() {\n    this._pool?.assertStorageIsWritable();\n    if (this._pool) {\n      const ops = [];\n      const reverseOps = [];\n      const updateDelta = [];\n      for (const item of this._items) {\n        item._detach();\n        const childId = item._id;\n        if (childId) {\n          ops.push({\n            type: 5 /* DELETE_CRDT */,\n            id: childId,\n            opId: this._pool.generateOpId()\n          });\n          reverseOps.push(\n            ...item._toOps(nn(this._id), item._getParentKeyOrThrow())\n          );\n          updateDelta.push(deleteDelta(0));\n        }\n      }\n      this._items = [];\n      this.invalidate();\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(nn(this._id), makeUpdate(this, updateDelta));\n      this._pool.dispatch(ops, reverseOps, storageUpdates);\n    } else {\n      for (const item of this._items) {\n        item._detach();\n      }\n      this._items = [];\n      this.invalidate();\n    }\n  }\n  set(index, item) {\n    this._pool?.assertStorageIsWritable();\n    if (index < 0 || index >= this._items.length) {\n      throw new Error(\n        `Cannot set list item at index \"\u001d${index}\". index should be between 0 and ${this._items.length - 1}`\n      );\n    }\n    const existingItem = this._items[index];\n    const position = existingItem._getParentKeyOrThrow();\n    const existingId = existingItem._id;\n    existingItem._detach();\n    const value = lsonToLiveNode(item);\n    value._setParentLink(this, position);\n    this._items[index] = value;\n    this.invalidate();\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      value._attach(id, this._pool);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(this._id, makeUpdate(this, [setDelta(index, value)]));\n      const ops = HACK_addIntentAndDeletedIdToOperation(\n        value._toOps(this._id, position, this._pool),\n        existingId\n      );\n      this._unacknowledgedSets.set(position, nn(ops[0].opId));\n      const reverseOps = HACK_addIntentAndDeletedIdToOperation(\n        existingItem._toOps(this._id, position, void 0),\n        id\n      );\n      this._pool.dispatch(ops, reverseOps, storageUpdates);\n    }\n  }\n  /**\n   * Returns an Array of all the elements in the LiveList.\n   */\n  toArray() {\n    return this._items.map(\n      (entry) => liveNodeToLson(entry)\n      //                               ^^^^^^^^\n      //                               FIXME! This isn't safe.\n    );\n  }\n  /**\n   * Tests whether all elements pass the test implemented by the provided function.\n   * @param predicate Function to test for each element, taking two arguments (the element and its index).\n   * @returns true if the predicate function returns a truthy value for every element. Otherwise, false.\n   */\n  every(predicate) {\n    return this.toArray().every(predicate);\n  }\n  /**\n   * Creates an array with all elements that pass the test implemented by the provided function.\n   * @param predicate Function to test each element of the LiveList. Return a value that coerces to true to keep the element, or to false otherwise.\n   * @returns An array with the elements that pass the test.\n   */\n  filter(predicate) {\n    return this.toArray().filter(predicate);\n  }\n  /**\n   * Returns the first element that satisfies the provided testing function.\n   * @param predicate Function to execute on each value.\n   * @returns The value of the first element in the LiveList that satisfies the provided testing function. Otherwise, undefined is returned.\n   */\n  find(predicate) {\n    return this.toArray().find(predicate);\n  }\n  /**\n   * Returns the index of the first element in the LiveList that satisfies the provided testing function.\n   * @param predicate Function to execute on each value until the function returns true, indicating that the satisfying element was found.\n   * @returns The index of the first element in the LiveList that passes the test. Otherwise, -1.\n   */\n  findIndex(predicate) {\n    return this.toArray().findIndex(predicate);\n  }\n  /**\n   * Executes a provided function once for each element.\n   * @param callbackfn Function to execute on each element.\n   */\n  forEach(callbackfn) {\n    return this.toArray().forEach(callbackfn);\n  }\n  /**\n   * Get the element at the specified index.\n   * @param index The index on the element to get.\n   * @returns The element at the specified index or undefined.\n   */\n  get(index) {\n    if (index < 0 || index >= this._items.length) {\n      return void 0;\n    }\n    return liveNodeToLson(this._items[index]);\n  }\n  /**\n   * Returns the first index at which a given element can be found in the LiveList, or -1 if it is not present.\n   * @param searchElement Element to locate.\n   * @param fromIndex The index to start the search at.\n   * @returns The first index of the element in the LiveList; -1 if not found.\n   */\n  indexOf(searchElement, fromIndex) {\n    return this.toArray().indexOf(searchElement, fromIndex);\n  }\n  /**\n   * Returns the last index at which a given element can be found in the LiveList, or -1 if it is not present. The LiveLsit is searched backwards, starting at fromIndex.\n   * @param searchElement Element to locate.\n   * @param fromIndex The index at which to start searching backwards.\n   * @returns\n   */\n  lastIndexOf(searchElement, fromIndex) {\n    return this.toArray().lastIndexOf(searchElement, fromIndex);\n  }\n  /**\n   * Creates an array populated with the results of calling a provided function on every element.\n   * @param callback Function that is called for every element.\n   * @returns An array with each element being the result of the callback function.\n   */\n  map(callback) {\n    return this._items.map(\n      (entry, i) => callback(\n        liveNodeToLson(entry),\n        //                    ^^^^^^^^\n        //                    FIXME! This isn't safe.\n        i\n      )\n    );\n  }\n  /**\n   * Tests whether at least one element in the LiveList passes the test implemented by the provided function.\n   * @param predicate Function to test for each element.\n   * @returns true if the callback function returns a truthy value for at least one element. Otherwise, false.\n   */\n  some(predicate) {\n    return this.toArray().some(predicate);\n  }\n  [Symbol.iterator]() {\n    return new LiveListIterator(this._items);\n  }\n  /** @internal */\n  _createAttachItemAndSort(op, key) {\n    const newItem = creationOpToLiveNode(op);\n    newItem._attach(op.id, nn(this._pool));\n    newItem._setParentLink(this, key);\n    this._insertAndSort(newItem);\n    const newIndex = this._indexOfPosition(key);\n    return { newItem, newIndex };\n  }\n  /** @internal */\n  _shiftItemPosition(index, key) {\n    const shiftedPosition = makePosition(\n      key,\n      this._items.length > index + 1 ? this._items[index + 1]?._parentPos : void 0\n    );\n    this._items[index]._setParentLink(this, shiftedPosition);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"LiveList\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: this._items.map(\n        (item, index) => item.toTreeNode(index.toString())\n      )\n    };\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = this._items.map((node) => node.toImmutable());\n    return  false ? 0 : Object.freeze(result);\n  }\n  clone() {\n    return new _LiveList(this._items.map((item) => item.clone()));\n  }\n};\nvar LiveListIterator = class {\n  constructor(items) {\n    this._innerIterator = items[Symbol.iterator]();\n  }\n  [Symbol.iterator]() {\n    return this;\n  }\n  next() {\n    const result = this._innerIterator.next();\n    if (result.done) {\n      return {\n        done: true,\n        value: void 0\n      };\n    }\n    const value = liveNodeToLson(result.value);\n    return { value };\n  }\n};\nfunction makeUpdate(liveList, deltaUpdates) {\n  return {\n    node: liveList,\n    type: \"LiveList\",\n    updates: deltaUpdates\n  };\n}\nfunction setDelta(index, item) {\n  return {\n    index,\n    type: \"set\",\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction deleteDelta(index) {\n  return {\n    index,\n    type: \"delete\"\n  };\n}\nfunction insertDelta(index, item) {\n  return {\n    index,\n    type: \"insert\",\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction moveDelta(previousIndex, index, item) {\n  return {\n    index,\n    type: \"move\",\n    previousIndex,\n    item: item instanceof LiveRegister ? item.data : item\n  };\n}\nfunction HACK_addIntentAndDeletedIdToOperation(ops, deletedId) {\n  return ops.map((op, index) => {\n    if (index === 0) {\n      const firstOp = op;\n      return {\n        ...firstOp,\n        intent: \"set\",\n        deletedId\n      };\n    } else {\n      return op;\n    }\n  });\n}\n\n// src/lib/freeze.ts\nvar freeze =  false ? (\n  /* istanbul ignore next */\n  0\n) : Object.freeze;\n\n// src/crdts/LiveMap.ts\nvar LiveMap = class _LiveMap extends AbstractCrdt {\n  constructor(entries2) {\n    super();\n    this.unacknowledgedSet = /* @__PURE__ */ new Map();\n    if (entries2) {\n      const mappedEntries = [];\n      for (const [key, value] of entries2) {\n        const node = lsonToLiveNode(value);\n        node._setParentLink(this, key);\n        mappedEntries.push([key, node]);\n      }\n      this._map = new Map(mappedEntries);\n    } else {\n      this._map = /* @__PURE__ */ new Map();\n    }\n  }\n  /**\n   * @internal\n   */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const ops = [];\n    const op = {\n      id: this._id,\n      opId: pool?.generateOpId(),\n      type: 7 /* CREATE_MAP */,\n      parentId,\n      parentKey\n    };\n    ops.push(op);\n    for (const [key, value] of this._map) {\n      ops.push(...value._toOps(this._id, key, pool));\n    }\n    return ops;\n  }\n  /**\n   * @internal\n   */\n  static _deserialize([id, _item], parentToChildren, pool) {\n    const map = new _LiveMap();\n    map._attach(id, pool);\n    const children = parentToChildren.get(id);\n    if (children === void 0) {\n      return map;\n    }\n    for (const [id2, crdt] of children) {\n      const child = deserialize([id2, crdt], parentToChildren, pool);\n      child._setParentLink(map, crdt.parentKey);\n      map._map.set(crdt.parentKey, child);\n      map.invalidate();\n    }\n    return map;\n  }\n  /**\n   * @internal\n   */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const [_key, value] of this._map) {\n      if (isLiveNode(value)) {\n        value._attach(pool.generateId(), pool);\n      }\n    }\n  }\n  /**\n   * @internal\n   */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, parentKey, opId } = op;\n    const key = parentKey;\n    const child = creationOpToLiveNode(op);\n    if (this._pool.getNode(id) !== void 0) {\n      return { modified: false };\n    }\n    if (source === 2 /* ACK */) {\n      const lastUpdateOpId = this.unacknowledgedSet.get(key);\n      if (lastUpdateOpId === opId) {\n        this.unacknowledgedSet.delete(key);\n        return { modified: false };\n      } else if (lastUpdateOpId !== void 0) {\n        return { modified: false };\n      }\n    } else if (source === 1 /* REMOTE */) {\n      this.unacknowledgedSet.delete(key);\n    }\n    const previousValue = this._map.get(key);\n    let reverse;\n    if (previousValue) {\n      const thisId = nn(this._id);\n      reverse = previousValue._toOps(thisId, key);\n      previousValue._detach();\n    } else {\n      reverse = [{ type: 5 /* DELETE_CRDT */, id }];\n    }\n    child._setParentLink(this, key);\n    child._attach(id, this._pool);\n    this._map.set(key, child);\n    this.invalidate();\n    return {\n      modified: {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"update\" } }\n      },\n      reverse\n    };\n  }\n  /**\n   * @internal\n   */\n  _detach() {\n    super._detach();\n    for (const item of this._map.values()) {\n      item._detach();\n    }\n  }\n  /**\n   * @internal\n   */\n  _detachChild(child) {\n    const id = nn(this._id);\n    const parentKey = nn(child._parentKey);\n    const reverse = child._toOps(id, parentKey, this._pool);\n    for (const [key, value] of this._map) {\n      if (value === child) {\n        this._map.delete(key);\n        this.invalidate();\n      }\n    }\n    child._detach();\n    const storageUpdate = {\n      node: this,\n      type: \"LiveMap\",\n      updates: { [parentKey]: { type: \"delete\" } }\n    };\n    return { modified: storageUpdate, reverse };\n  }\n  /**\n   * @internal\n   */\n  _serialize() {\n    if (this.parent.type !== \"HasParent\") {\n      throw new Error(\"Cannot serialize LiveMap if parent is missing\");\n    }\n    return {\n      type: 2 /* MAP */,\n      parentId: nn(this.parent.node._id, \"Parent node expected to have ID\"),\n      parentKey: this.parent.key\n    };\n  }\n  /**\n   * Returns a specified element from the LiveMap.\n   * @param key The key of the element to return.\n   * @returns The element associated with the specified key, or undefined if the key can't be found in the LiveMap.\n   */\n  get(key) {\n    const value = this._map.get(key);\n    if (value === void 0) {\n      return void 0;\n    }\n    return liveNodeToLson(value);\n  }\n  /**\n   * Adds or updates an element with a specified key and a value.\n   * @param key The key of the element to add. Should be a string.\n   * @param value The value of the element to add. Should be serializable to JSON.\n   */\n  set(key, value) {\n    this._pool?.assertStorageIsWritable();\n    const oldValue = this._map.get(key);\n    if (oldValue) {\n      oldValue._detach();\n    }\n    const item = lsonToLiveNode(value);\n    item._setParentLink(this, key);\n    this._map.set(key, item);\n    this.invalidate();\n    if (this._pool && this._id) {\n      const id = this._pool.generateId();\n      item._attach(id, this._pool);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(this._id, {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"update\" } }\n      });\n      const ops = item._toOps(this._id, key, this._pool);\n      this.unacknowledgedSet.set(key, nn(ops[0].opId));\n      this._pool.dispatch(\n        item._toOps(this._id, key, this._pool),\n        oldValue ? oldValue._toOps(this._id, key) : [{ type: 5 /* DELETE_CRDT */, id }],\n        storageUpdates\n      );\n    }\n  }\n  /**\n   * Returns the number of elements in the LiveMap.\n   */\n  get size() {\n    return this._map.size;\n  }\n  /**\n   * Returns a boolean indicating whether an element with the specified key exists or not.\n   * @param key The key of the element to test for presence.\n   */\n  has(key) {\n    return this._map.has(key);\n  }\n  /**\n   * Removes the specified element by key.\n   * @param key The key of the element to remove.\n   * @returns true if an element existed and has been removed, or false if the element does not exist.\n   */\n  delete(key) {\n    this._pool?.assertStorageIsWritable();\n    const item = this._map.get(key);\n    if (item === void 0) {\n      return false;\n    }\n    item._detach();\n    this._map.delete(key);\n    this.invalidate();\n    if (this._pool && item._id) {\n      const thisId = nn(this._id);\n      const storageUpdates = /* @__PURE__ */ new Map();\n      storageUpdates.set(thisId, {\n        node: this,\n        type: \"LiveMap\",\n        updates: { [key]: { type: \"delete\" } }\n      });\n      this._pool.dispatch(\n        [\n          {\n            type: 5 /* DELETE_CRDT */,\n            id: item._id,\n            opId: this._pool.generateOpId()\n          }\n        ],\n        item._toOps(thisId, key),\n        storageUpdates\n      );\n    }\n    return true;\n  }\n  /**\n   * Returns a new Iterator object that contains the [key, value] pairs for each element.\n   */\n  entries() {\n    const innerIterator = this._map.entries();\n    return {\n      [Symbol.iterator]() {\n        return this;\n      },\n      next() {\n        const iteratorValue = innerIterator.next();\n        if (iteratorValue.done) {\n          return {\n            done: true,\n            value: void 0\n          };\n        }\n        const entry = iteratorValue.value;\n        const key = entry[0];\n        const value = liveNodeToLson(iteratorValue.value[1]);\n        return {\n          value: [key, value]\n        };\n      }\n    };\n  }\n  /**\n   * Same function object as the initial value of the entries method.\n   */\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  /**\n   * Returns a new Iterator object that contains the keys for each element.\n   */\n  keys() {\n    return this._map.keys();\n  }\n  /**\n   * Returns a new Iterator object that contains the values for each element.\n   */\n  values() {\n    const innerIterator = this._map.values();\n    return {\n      [Symbol.iterator]() {\n        return this;\n      },\n      next() {\n        const iteratorValue = innerIterator.next();\n        if (iteratorValue.done) {\n          return {\n            done: true,\n            value: void 0\n          };\n        }\n        const value = liveNodeToLson(iteratorValue.value);\n        return { value };\n      }\n    };\n  }\n  /**\n   * Executes a provided function once per each key/value pair in the Map object, in insertion order.\n   * @param callback Function to execute for each entry in the map.\n   */\n  forEach(callback) {\n    for (const entry of this) {\n      callback(entry[1], entry[0], this);\n    }\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    return {\n      type: \"LiveMap\",\n      id: this._id ?? nanoid(),\n      key,\n      payload: Array.from(this._map.entries()).map(\n        ([key2, val]) => val.toTreeNode(key2)\n      )\n    };\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = /* @__PURE__ */ new Map();\n    for (const [key, value] of this._map) {\n      result.set(key, value.toImmutable());\n    }\n    return freeze(result);\n  }\n  clone() {\n    return new _LiveMap(\n      Array.from(this._map).map(([key, node]) => [key, node.clone()])\n    );\n  }\n};\n\n// src/crdts/LiveObject.ts\nvar LiveObject = class _LiveObject extends AbstractCrdt {\n  /** @internal */\n  static _buildRootAndParentToChildren(items) {\n    const parentToChildren = /* @__PURE__ */ new Map();\n    let root = null;\n    for (const [id, crdt] of items) {\n      if (isRootCrdt(crdt)) {\n        root = [id, crdt];\n      } else {\n        const tuple = [id, crdt];\n        const children = parentToChildren.get(crdt.parentId);\n        if (children !== void 0) {\n          children.push(tuple);\n        } else {\n          parentToChildren.set(crdt.parentId, [tuple]);\n        }\n      }\n    }\n    if (root === null) {\n      throw new Error(\"Root can't be null\");\n    }\n    return [root, parentToChildren];\n  }\n  /** @internal */\n  static _fromItems(items, pool) {\n    const [root, parentToChildren] = _LiveObject._buildRootAndParentToChildren(items);\n    return _LiveObject._deserialize(\n      root,\n      parentToChildren,\n      pool\n    );\n  }\n  constructor(obj = {}) {\n    super();\n    this._propToLastUpdate = /* @__PURE__ */ new Map();\n    const o = compactObject(obj);\n    for (const key of Object.keys(o)) {\n      const value = o[key];\n      if (isLiveNode(value)) {\n        value._setParentLink(this, key);\n      }\n    }\n    this._map = new Map(Object.entries(o));\n  }\n  /** @internal */\n  _toOps(parentId, parentKey, pool) {\n    if (this._id === void 0) {\n      throw new Error(\"Cannot serialize item is not attached\");\n    }\n    const opId = pool?.generateOpId();\n    const ops = [];\n    const op = {\n      type: 4 /* CREATE_OBJECT */,\n      id: this._id,\n      opId,\n      parentId,\n      parentKey,\n      data: {}\n    };\n    ops.push(op);\n    for (const [key, value] of this._map) {\n      if (isLiveNode(value)) {\n        ops.push(...value._toOps(this._id, key, pool));\n      } else {\n        op.data[key] = value;\n      }\n    }\n    return ops;\n  }\n  /** @internal */\n  static _deserialize([id, item], parentToChildren, pool) {\n    const liveObj = new _LiveObject(item.data);\n    liveObj._attach(id, pool);\n    return this._deserializeChildren(liveObj, parentToChildren, pool);\n  }\n  /** @internal */\n  static _deserializeChildren(liveObj, parentToChildren, pool) {\n    const children = parentToChildren.get(nn(liveObj._id));\n    if (children === void 0) {\n      return liveObj;\n    }\n    for (const [id, crdt] of children) {\n      const child = deserializeToLson([id, crdt], parentToChildren, pool);\n      if (isLiveStructure(child)) {\n        child._setParentLink(liveObj, crdt.parentKey);\n      }\n      liveObj._map.set(crdt.parentKey, child);\n      liveObj.invalidate();\n    }\n    return liveObj;\n  }\n  /** @internal */\n  _attach(id, pool) {\n    super._attach(id, pool);\n    for (const [_key, value] of this._map) {\n      if (isLiveNode(value)) {\n        value._attach(pool.generateId(), pool);\n      }\n    }\n  }\n  /** @internal */\n  _attachChild(op, source) {\n    if (this._pool === void 0) {\n      throw new Error(\"Can't attach child if managed pool is not present\");\n    }\n    const { id, opId, parentKey: key } = op;\n    const child = creationOpToLson(op);\n    if (this._pool.getNode(id) !== void 0) {\n      if (this._propToLastUpdate.get(key) === opId) {\n        this._propToLastUpdate.delete(key);\n      }\n      return { modified: false };\n    }\n    if (source === 0 /* UNDOREDO_RECONNECT */) {\n      this._propToLastUpdate.set(key, nn(opId));\n    } else if (this._propToLastUpdate.get(key) === void 0) {\n    } else if (this._propToLastUpdate.get(key) === opId) {\n      this._propToLastUpdate.delete(key);\n      return { modified: false };\n    } else {\n      return { modified: false };\n    }\n    const thisId = nn(this._id);\n    const previousValue = this._map.get(key);\n    let reverse;\n    if (isLiveNode(previousValue)) {\n      reverse = previousValue._toOps(thisId, key);\n      previousValue._detach();\n    } else if (previousValue === void 0) {\n      reverse = [{ type: 6 /* DELETE_OBJECT_KEY */, id: thisId, key }];\n    } else {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          id: thisId,\n          data: { [key]: previousValue }\n        }\n      ];\n    }\n    this._map.set(key, child);\n    this.invalidate();\n    if (isLiveStructure(child)) {\n      child._setParentLink(this, key);\n      child._attach(id, this._pool);\n    }\n    return {\n      reverse,\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: { [key]: { type: \"update\" } }\n      }\n    };\n  }\n  /** @internal */\n  _detachChild(child) {\n    if (child) {\n      const id = nn(this._id);\n      const parentKey = nn(child._parentKey);\n      const reverse = child._toOps(id, parentKey, this._pool);\n      for (const [key, value] of this._map) {\n        if (value === child) {\n          this._map.delete(key);\n          this.invalidate();\n        }\n      }\n      child._detach();\n      const storageUpdate = {\n        node: this,\n        type: \"LiveObject\",\n        updates: {\n          [parentKey]: { type: \"delete\" }\n        }\n      };\n      return { modified: storageUpdate, reverse };\n    }\n    return { modified: false };\n  }\n  /**\n   * @internal\n   */\n  _detach() {\n    super._detach();\n    for (const value of this._map.values()) {\n      if (isLiveNode(value)) {\n        value._detach();\n      }\n    }\n  }\n  /** @internal */\n  _apply(op, isLocal) {\n    if (op.type === 3 /* UPDATE_OBJECT */) {\n      return this._applyUpdate(op, isLocal);\n    } else if (op.type === 6 /* DELETE_OBJECT_KEY */) {\n      return this._applyDeleteObjectKey(op, isLocal);\n    }\n    return super._apply(op, isLocal);\n  }\n  /**\n   * @internal\n   */\n  _serialize() {\n    const data = {};\n    for (const [key, value] of this._map) {\n      if (!isLiveNode(value)) {\n        data[key] = value;\n      }\n    }\n    if (this.parent.type === \"HasParent\" && this.parent.node._id) {\n      return {\n        type: 0 /* OBJECT */,\n        parentId: this.parent.node._id,\n        parentKey: this.parent.key,\n        data\n      };\n    } else {\n      return {\n        type: 0 /* OBJECT */,\n        data\n      };\n    }\n  }\n  /** @internal */\n  _applyUpdate(op, isLocal) {\n    let isModified = false;\n    const id = nn(this._id);\n    const reverse = [];\n    const reverseUpdate = {\n      type: 3 /* UPDATE_OBJECT */,\n      id,\n      data: {}\n    };\n    for (const key in op.data) {\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        reverse.push(...oldValue._toOps(id, key));\n        oldValue._detach();\n      } else if (oldValue !== void 0) {\n        reverseUpdate.data[key] = oldValue;\n      } else if (oldValue === void 0) {\n        reverse.push({ type: 6 /* DELETE_OBJECT_KEY */, id, key });\n      }\n    }\n    const updateDelta = {};\n    for (const key in op.data) {\n      const value = op.data[key];\n      if (value === void 0) {\n        continue;\n      }\n      if (isLocal) {\n        this._propToLastUpdate.set(key, nn(op.opId));\n      } else if (this._propToLastUpdate.get(key) === void 0) {\n        isModified = true;\n      } else if (this._propToLastUpdate.get(key) === op.opId) {\n        this._propToLastUpdate.delete(key);\n        continue;\n      } else {\n        continue;\n      }\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        oldValue._detach();\n      }\n      isModified = true;\n      updateDelta[key] = { type: \"update\" };\n      this._map.set(key, value);\n      this.invalidate();\n    }\n    if (Object.keys(reverseUpdate.data).length !== 0) {\n      reverse.unshift(reverseUpdate);\n    }\n    return isModified ? {\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: updateDelta\n      },\n      reverse\n    } : { modified: false };\n  }\n  /** @internal */\n  _applyDeleteObjectKey(op, isLocal) {\n    const key = op.key;\n    if (this._map.has(key) === false) {\n      return { modified: false };\n    }\n    if (!isLocal && this._propToLastUpdate.get(key) !== void 0) {\n      return { modified: false };\n    }\n    const oldValue = this._map.get(key);\n    const id = nn(this._id);\n    let reverse = [];\n    if (isLiveNode(oldValue)) {\n      reverse = oldValue._toOps(id, op.key);\n      oldValue._detach();\n    } else if (oldValue !== void 0) {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          id,\n          data: { [key]: oldValue }\n        }\n      ];\n    }\n    this._map.delete(key);\n    this.invalidate();\n    return {\n      modified: {\n        node: this,\n        type: \"LiveObject\",\n        updates: { [op.key]: { type: \"delete\" } }\n      },\n      reverse\n    };\n  }\n  /**\n   * Transform the LiveObject into a javascript object\n   */\n  toObject() {\n    return Object.fromEntries(this._map);\n  }\n  /**\n   * Adds or updates a property with a specified key and a value.\n   * @param key The key of the property to add\n   * @param value The value of the property to add\n   */\n  set(key, value) {\n    this._pool?.assertStorageIsWritable();\n    this.update({ [key]: value });\n  }\n  /**\n   * Returns a specified property from the LiveObject.\n   * @param key The key of the property to get\n   */\n  get(key) {\n    return this._map.get(key);\n  }\n  /**\n   * Deletes a key from the LiveObject\n   * @param key The key of the property to delete\n   */\n  delete(key) {\n    this._pool?.assertStorageIsWritable();\n    const keyAsString = key;\n    const oldValue = this._map.get(keyAsString);\n    if (oldValue === void 0) {\n      return;\n    }\n    if (this._pool === void 0 || this._id === void 0) {\n      if (isLiveNode(oldValue)) {\n        oldValue._detach();\n      }\n      this._map.delete(keyAsString);\n      this.invalidate();\n      return;\n    }\n    let reverse;\n    if (isLiveNode(oldValue)) {\n      oldValue._detach();\n      reverse = oldValue._toOps(this._id, keyAsString);\n    } else {\n      reverse = [\n        {\n          type: 3 /* UPDATE_OBJECT */,\n          data: { [keyAsString]: oldValue },\n          id: this._id\n        }\n      ];\n    }\n    this._map.delete(keyAsString);\n    this.invalidate();\n    const storageUpdates = /* @__PURE__ */ new Map();\n    storageUpdates.set(this._id, {\n      node: this,\n      type: \"LiveObject\",\n      updates: { [key]: { type: \"delete\" } }\n    });\n    this._pool.dispatch(\n      [\n        {\n          type: 6 /* DELETE_OBJECT_KEY */,\n          key: keyAsString,\n          id: this._id,\n          opId: this._pool.generateOpId()\n        }\n      ],\n      reverse,\n      storageUpdates\n    );\n  }\n  /**\n   * Adds or updates multiple properties at once with an object.\n   * @param patch The object used to overrides properties\n   */\n  update(patch) {\n    this._pool?.assertStorageIsWritable();\n    if (this._pool === void 0 || this._id === void 0) {\n      for (const key in patch) {\n        const newValue = patch[key];\n        if (newValue === void 0) {\n          continue;\n        }\n        const oldValue = this._map.get(key);\n        if (isLiveNode(oldValue)) {\n          oldValue._detach();\n        }\n        if (isLiveNode(newValue)) {\n          newValue._setParentLink(this, key);\n        }\n        this._map.set(key, newValue);\n        this.invalidate();\n      }\n      return;\n    }\n    const ops = [];\n    const reverseOps = [];\n    const opId = this._pool.generateOpId();\n    const updatedProps = {};\n    const reverseUpdateOp = {\n      id: this._id,\n      type: 3 /* UPDATE_OBJECT */,\n      data: {}\n    };\n    const updateDelta = {};\n    for (const key in patch) {\n      const newValue = patch[key];\n      if (newValue === void 0) {\n        continue;\n      }\n      const oldValue = this._map.get(key);\n      if (isLiveNode(oldValue)) {\n        reverseOps.push(...oldValue._toOps(this._id, key));\n        oldValue._detach();\n      } else if (oldValue === void 0) {\n        reverseOps.push({ type: 6 /* DELETE_OBJECT_KEY */, id: this._id, key });\n      } else {\n        reverseUpdateOp.data[key] = oldValue;\n      }\n      if (isLiveNode(newValue)) {\n        newValue._setParentLink(this, key);\n        newValue._attach(this._pool.generateId(), this._pool);\n        const newAttachChildOps = newValue._toOps(this._id, key, this._pool);\n        const createCrdtOp = newAttachChildOps.find(\n          (op) => op.parentId === this._id\n        );\n        if (createCrdtOp) {\n          this._propToLastUpdate.set(key, nn(createCrdtOp.opId));\n        }\n        ops.push(...newAttachChildOps);\n      } else {\n        updatedProps[key] = newValue;\n        this._propToLastUpdate.set(key, opId);\n      }\n      this._map.set(key, newValue);\n      this.invalidate();\n      updateDelta[key] = { type: \"update\" };\n    }\n    if (Object.keys(reverseUpdateOp.data).length !== 0) {\n      reverseOps.unshift(reverseUpdateOp);\n    }\n    if (Object.keys(updatedProps).length !== 0) {\n      ops.unshift({\n        opId,\n        id: this._id,\n        type: 3 /* UPDATE_OBJECT */,\n        data: updatedProps\n      });\n    }\n    const storageUpdates = /* @__PURE__ */ new Map();\n    storageUpdates.set(this._id, {\n      node: this,\n      type: \"LiveObject\",\n      updates: updateDelta\n    });\n    this._pool.dispatch(ops, reverseOps, storageUpdates);\n  }\n  toImmutable() {\n    return super.toImmutable();\n  }\n  /** @internal */\n  toTreeNode(key) {\n    return super.toTreeNode(key);\n  }\n  /** @internal */\n  _toTreeNode(key) {\n    const nodeId = this._id ?? nanoid();\n    return {\n      type: \"LiveObject\",\n      id: nodeId,\n      key,\n      payload: Array.from(this._map.entries()).map(\n        ([key2, value]) => isLiveNode(value) ? value.toTreeNode(key2) : { type: \"Json\", id: `${nodeId}:${key2}`, key: key2, payload: value }\n      )\n    };\n  }\n  /** @internal */\n  _toImmutable() {\n    const result = {};\n    for (const [key, val] of this._map) {\n      result[key] = isLiveStructure(val) ? val.toImmutable() : val;\n    }\n    return  false ? 0 : Object.freeze(result);\n  }\n  clone() {\n    return new _LiveObject(\n      Object.fromEntries(\n        Array.from(this._map).map(([key, value]) => [\n          key,\n          isLiveStructure(value) ? value.clone() : deepClone(value)\n        ])\n      )\n    );\n  }\n};\n\n// src/crdts/liveblocks-helpers.ts\nfunction creationOpToLiveNode(op) {\n  return lsonToLiveNode(creationOpToLson(op));\n}\nfunction creationOpToLson(op) {\n  switch (op.type) {\n    case 8 /* CREATE_REGISTER */:\n      return op.data;\n    case 4 /* CREATE_OBJECT */:\n      return new LiveObject(op.data);\n    case 7 /* CREATE_MAP */:\n      return new LiveMap();\n    case 2 /* CREATE_LIST */:\n      return new LiveList([]);\n    default:\n      return assertNever(op, \"Unknown creation Op\");\n  }\n}\nfunction isSameNodeOrChildOf(node, parent) {\n  if (node === parent) {\n    return true;\n  }\n  if (node.parent.type === \"HasParent\") {\n    return isSameNodeOrChildOf(node.parent.node, parent);\n  }\n  return false;\n}\nfunction deserialize([id, crdt], parentToChildren, pool) {\n  switch (crdt.type) {\n    case 0 /* OBJECT */: {\n      return LiveObject._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 1 /* LIST */: {\n      return LiveList._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 2 /* MAP */: {\n      return LiveMap._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 3 /* REGISTER */: {\n      return LiveRegister._deserialize([id, crdt], parentToChildren, pool);\n    }\n    default: {\n      throw new Error(\"Unexpected CRDT type\");\n    }\n  }\n}\nfunction deserializeToLson([id, crdt], parentToChildren, pool) {\n  switch (crdt.type) {\n    case 0 /* OBJECT */: {\n      return LiveObject._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 1 /* LIST */: {\n      return LiveList._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 2 /* MAP */: {\n      return LiveMap._deserialize([id, crdt], parentToChildren, pool);\n    }\n    case 3 /* REGISTER */: {\n      return crdt.data;\n    }\n    default: {\n      throw new Error(\"Unexpected CRDT type\");\n    }\n  }\n}\nfunction isLiveStructure(value) {\n  return isLiveList(value) || isLiveMap(value) || isLiveObject(value);\n}\nfunction isLiveNode(value) {\n  return isLiveStructure(value) || isLiveRegister(value);\n}\nfunction isLiveList(value) {\n  return value instanceof LiveList;\n}\nfunction isLiveMap(value) {\n  return value instanceof LiveMap;\n}\nfunction isLiveObject(value) {\n  return value instanceof LiveObject;\n}\nfunction isLiveRegister(value) {\n  return value instanceof LiveRegister;\n}\nfunction cloneLson(value) {\n  return value === void 0 ? void 0 : isLiveStructure(value) ? value.clone() : deepClone(value);\n}\nfunction liveNodeToLson(obj) {\n  if (obj instanceof LiveRegister) {\n    return obj.data;\n  } else if (obj instanceof LiveList || obj instanceof LiveMap || obj instanceof LiveObject) {\n    return obj;\n  } else {\n    return assertNever(obj, \"Unknown AbstractCrdt\");\n  }\n}\nfunction lsonToLiveNode(value) {\n  if (value instanceof LiveObject || value instanceof LiveMap || value instanceof LiveList) {\n    return value;\n  } else {\n    return new LiveRegister(value);\n  }\n}\nfunction getTreesDiffOperations(currentItems, newItems) {\n  const ops = [];\n  currentItems.forEach((_, id) => {\n    if (!newItems.get(id)) {\n      ops.push({\n        type: 5 /* DELETE_CRDT */,\n        id\n      });\n    }\n  });\n  newItems.forEach((crdt, id) => {\n    const currentCrdt = currentItems.get(id);\n    if (currentCrdt) {\n      if (crdt.type === 0 /* OBJECT */) {\n        if (currentCrdt.type !== 0 /* OBJECT */ || JSON.stringify(crdt.data) !== JSON.stringify(currentCrdt.data)) {\n          ops.push({\n            type: 3 /* UPDATE_OBJECT */,\n            id,\n            data: crdt.data\n          });\n        }\n      }\n      if (crdt.parentKey !== currentCrdt.parentKey) {\n        ops.push({\n          type: 1 /* SET_PARENT_KEY */,\n          id,\n          parentKey: nn(crdt.parentKey, \"Parent key must not be missing\")\n        });\n      }\n    } else {\n      switch (crdt.type) {\n        case 3 /* REGISTER */:\n          ops.push({\n            type: 8 /* CREATE_REGISTER */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey,\n            data: crdt.data\n          });\n          break;\n        case 1 /* LIST */:\n          ops.push({\n            type: 2 /* CREATE_LIST */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey\n          });\n          break;\n        case 0 /* OBJECT */:\n          if (crdt.parentId === void 0 || crdt.parentKey === void 0) {\n            throw new Error(\n              \"Internal error. Cannot serialize storage root into an operation\"\n            );\n          }\n          ops.push({\n            type: 4 /* CREATE_OBJECT */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey,\n            data: crdt.data\n          });\n          break;\n        case 2 /* MAP */:\n          ops.push({\n            type: 7 /* CREATE_MAP */,\n            id,\n            parentId: crdt.parentId,\n            parentKey: crdt.parentKey\n          });\n          break;\n      }\n    }\n  });\n  return ops;\n}\nfunction mergeObjectStorageUpdates(first, second) {\n  const updates = first.updates;\n  for (const [key, value] of entries(second.updates)) {\n    updates[key] = value;\n  }\n  return {\n    ...second,\n    updates\n  };\n}\nfunction mergeMapStorageUpdates(first, second) {\n  const updates = first.updates;\n  for (const [key, value] of entries(second.updates)) {\n    updates[key] = value;\n  }\n  return {\n    ...second,\n    updates\n  };\n}\nfunction mergeListStorageUpdates(first, second) {\n  const updates = first.updates;\n  return {\n    ...second,\n    updates: updates.concat(second.updates)\n  };\n}\nfunction mergeStorageUpdates(first, second) {\n  if (first === void 0) {\n    return second;\n  }\n  if (first.type === \"LiveObject\" && second.type === \"LiveObject\") {\n    return mergeObjectStorageUpdates(first, second);\n  } else if (first.type === \"LiveMap\" && second.type === \"LiveMap\") {\n    return mergeMapStorageUpdates(first, second);\n  } else if (first.type === \"LiveList\" && second.type === \"LiveList\") {\n    return mergeListStorageUpdates(first, second);\n  } else {\n  }\n  return second;\n}\nfunction isPlain(value) {\n  const type = typeof value;\n  return value === void 0 || value === null || type === \"string\" || type === \"boolean\" || type === \"number\" || Array.isArray(value) || isPlainObject(value);\n}\nfunction findNonSerializableValue(value, path = \"\") {\n  if (!isPlain) {\n    return {\n      path: path || \"root\",\n      value\n    };\n  }\n  if (typeof value !== \"object\" || value === null) {\n    return false;\n  }\n  for (const [key, nestedValue] of Object.entries(value)) {\n    const nestedPath = path ? path + \".\" + key : key;\n    if (!isPlain(nestedValue)) {\n      return {\n        path: nestedPath,\n        value: nestedValue\n      };\n    }\n    if (typeof nestedValue === \"object\") {\n      const nonSerializableNestedValue = findNonSerializableValue(\n        nestedValue,\n        nestedPath\n      );\n      if (nonSerializableNestedValue) {\n        return nonSerializableNestedValue;\n      }\n    }\n  }\n  return false;\n}\n\n// src/lib/createIds.ts\nvar THREAD_ID_PREFIX = \"th\";\nvar COMMENT_ID_PREFIX = \"cm\";\nvar INBOX_NOTIFICATION_ID_PREFIX = \"in\";\nfunction createOptimisticId(prefix) {\n  return `${prefix}_${nanoid()}`;\n}\nfunction createThreadId() {\n  return createOptimisticId(THREAD_ID_PREFIX);\n}\nfunction createCommentId() {\n  return createOptimisticId(COMMENT_ID_PREFIX);\n}\nfunction createInboxNotificationId() {\n  return createOptimisticId(INBOX_NOTIFICATION_ID_PREFIX);\n}\n\n// src/lib/debug.ts\nfunction captureStackTrace(msg, traceRoot) {\n  const errorLike = { name: msg };\n  if (typeof Error.captureStackTrace !== \"function\") {\n    return void 0;\n  }\n  Error.captureStackTrace(errorLike, traceRoot);\n  return errorLike.stack;\n}\n\n// src/lib/Json.ts\nfunction isJsonScalar(data) {\n  return data === null || typeof data === \"string\" || typeof data === \"number\" || typeof data === \"boolean\";\n}\nfunction isJsonArray(data) {\n  return Array.isArray(data);\n}\nfunction isJsonObject(data) {\n  return !isJsonScalar(data) && !isJsonArray(data);\n}\n\n// src/lib/objectToQuery.ts\nvar identifierRegex = /^[a-zA-Z_][a-zA-Z0-9_]*$/;\nfunction objectToQuery(obj) {\n  let filterList = [];\n  const entries2 = Object.entries(obj);\n  const keyValuePairs = [];\n  const keyValuePairsWithOperator = [];\n  const indexedKeys = [];\n  entries2.forEach(([key, value]) => {\n    if (!identifierRegex.test(key)) {\n      throw new Error(\"Key must only contain letters, numbers, _\");\n    }\n    if (isSimpleValue(value)) {\n      keyValuePairs.push([key, value]);\n    } else if (isValueWithOperator(value)) {\n      keyValuePairsWithOperator.push([key, value]);\n    } else if (typeof value === \"object\" && !(\"startsWith\" in value)) {\n      indexedKeys.push([key, value]);\n    }\n  });\n  filterList = [\n    ...getFiltersFromKeyValuePairs(keyValuePairs),\n    ...getFiltersFromKeyValuePairsWithOperator(keyValuePairsWithOperator)\n  ];\n  indexedKeys.forEach(([key, value]) => {\n    const nestedEntries = Object.entries(value);\n    const nKeyValuePairs = [];\n    const nKeyValuePairsWithOperator = [];\n    nestedEntries.forEach(([nestedKey, nestedValue]) => {\n      if (isStringEmpty(nestedKey)) {\n        throw new Error(\"Key cannot be empty\");\n      }\n      if (isSimpleValue(nestedValue)) {\n        nKeyValuePairs.push([formatFilterKey(key, nestedKey), nestedValue]);\n      } else if (isValueWithOperator(nestedValue)) {\n        nKeyValuePairsWithOperator.push([\n          formatFilterKey(key, nestedKey),\n          nestedValue\n        ]);\n      }\n    });\n    filterList = [\n      ...filterList,\n      ...getFiltersFromKeyValuePairs(nKeyValuePairs),\n      ...getFiltersFromKeyValuePairsWithOperator(nKeyValuePairsWithOperator)\n    ];\n  });\n  return filterList.map(\n    ({ key, operator, value }) => formatFilter(key, operator, formatFilterValue(value))\n  ).join(\" AND \");\n}\nvar getFiltersFromKeyValuePairs = (keyValuePairs) => {\n  const filters = [];\n  keyValuePairs.forEach(([key, value]) => {\n    filters.push({\n      key,\n      operator: \":\",\n      value\n    });\n  });\n  return filters;\n};\nvar getFiltersFromKeyValuePairsWithOperator = (keyValuePairsWithOperator) => {\n  const filters = [];\n  keyValuePairsWithOperator.forEach(([key, value]) => {\n    if (\"startsWith\" in value && typeof value.startsWith === \"string\") {\n      filters.push({\n        key,\n        operator: \"^\",\n        value: value.startsWith\n      });\n    }\n  });\n  return filters;\n};\nvar isSimpleValue = (value) => {\n  if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\n    return true;\n  }\n  return false;\n};\nvar isValueWithOperator = (value) => {\n  if (typeof value === \"object\" && value !== null && \"startsWith\" in value) {\n    return true;\n  }\n  return false;\n};\nvar formatFilter = (key, operator, value) => {\n  return `${key}${operator}${value}`;\n};\nvar formatFilterKey = (key, nestedKey) => {\n  if (nestedKey) {\n    return `${key}[${JSON.stringify(nestedKey)}]`;\n  }\n  return key;\n};\nvar formatFilterValue = (value) => {\n  if (typeof value === \"string\") {\n    if (isStringEmpty(value)) {\n      throw new Error(\"Value cannot be empty\");\n    }\n    return JSON.stringify(value);\n  }\n  return value.toString();\n};\nvar isStringEmpty = (value) => {\n  return !value || value.toString().trim() === \"\";\n};\n\n// src/protocol/ClientMsg.ts\nvar ClientMsgCode = /* @__PURE__ */ ((ClientMsgCode2) => {\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_PRESENCE\"] = 100] = \"UPDATE_PRESENCE\";\n  ClientMsgCode2[ClientMsgCode2[\"BROADCAST_EVENT\"] = 103] = \"BROADCAST_EVENT\";\n  ClientMsgCode2[ClientMsgCode2[\"FETCH_STORAGE\"] = 200] = \"FETCH_STORAGE\";\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_STORAGE\"] = 201] = \"UPDATE_STORAGE\";\n  ClientMsgCode2[ClientMsgCode2[\"FETCH_YDOC\"] = 300] = \"FETCH_YDOC\";\n  ClientMsgCode2[ClientMsgCode2[\"UPDATE_YDOC\"] = 301] = \"UPDATE_YDOC\";\n  return ClientMsgCode2;\n})(ClientMsgCode || {});\n\n// src/refs/ImmutableRef.ts\nfunction merge(target, patch) {\n  let updated = false;\n  const newValue = { ...target };\n  Object.keys(patch).forEach((k) => {\n    const key = k;\n    const val = patch[key];\n    if (newValue[key] !== val) {\n      if (val === void 0) {\n        delete newValue[key];\n      } else {\n        newValue[key] = val;\n      }\n      updated = true;\n    }\n  });\n  return updated ? newValue : target;\n}\nvar ImmutableRef = class {\n  constructor() {\n    this._ev = makeEventSource();\n  }\n  get didInvalidate() {\n    return this._ev.observable;\n  }\n  invalidate() {\n    if (this._cache !== void 0) {\n      this._cache = void 0;\n      this._ev.notify();\n    }\n  }\n  get current() {\n    return this._cache ?? (this._cache = this._toImmutable());\n  }\n};\n\n// src/refs/OthersRef.ts\nfunction makeUser(conn, presence) {\n  const { connectionId, id, info } = conn;\n  const canWrite = canWriteStorage(conn.scopes);\n  return freeze(\n    compactObject({\n      connectionId,\n      id,\n      info,\n      canWrite,\n      canComment: canComment(conn.scopes),\n      isReadOnly: !canWrite,\n      // Deprecated, kept for backward-compatibility\n      presence\n    })\n  );\n}\nvar OthersRef = class extends ImmutableRef {\n  //\n  // --------------------------------------------------------------\n  //\n  constructor() {\n    super();\n    this._connections = /* @__PURE__ */ new Map();\n    this._presences = /* @__PURE__ */ new Map();\n    this._users = /* @__PURE__ */ new Map();\n  }\n  connectionIds() {\n    return this._connections.keys();\n  }\n  /** @internal */\n  _toImmutable() {\n    const users = compact(\n      Array.from(this._presences.keys()).map(\n        (connectionId) => this.getUser(Number(connectionId))\n      )\n    );\n    return users;\n  }\n  clearOthers() {\n    this._connections = /* @__PURE__ */ new Map();\n    this._presences = /* @__PURE__ */ new Map();\n    this._users = /* @__PURE__ */ new Map();\n    this.invalidate();\n  }\n  /** @internal */\n  _getUser(connectionId) {\n    const conn = this._connections.get(connectionId);\n    const presence = this._presences.get(connectionId);\n    if (conn !== void 0 && presence !== void 0) {\n      return makeUser(conn, presence);\n    }\n    return void 0;\n  }\n  getUser(connectionId) {\n    const cachedUser = this._users.get(connectionId);\n    if (cachedUser) {\n      return cachedUser;\n    }\n    const computedUser = this._getUser(connectionId);\n    if (computedUser) {\n      this._users.set(connectionId, computedUser);\n      return computedUser;\n    }\n    return void 0;\n  }\n  /** @internal */\n  _invalidateUser(connectionId) {\n    if (this._users.has(connectionId)) {\n      this._users.delete(connectionId);\n    }\n    this.invalidate();\n  }\n  /**\n   * Records a known connection. This records the connection ID and the\n   * associated metadata.\n   */\n  setConnection(connectionId, metaUserId, metaUserInfo, scopes) {\n    this._connections.set(\n      connectionId,\n      freeze({\n        connectionId,\n        id: metaUserId,\n        info: metaUserInfo,\n        scopes\n      })\n    );\n    if (this._presences.has(connectionId)) {\n      this._invalidateUser(connectionId);\n    }\n  }\n  /**\n   * Removes a known connectionId. Removes both the connection's metadata and\n   * the presence information.\n   */\n  removeConnection(connectionId) {\n    this._connections.delete(connectionId);\n    this._presences.delete(connectionId);\n    this._invalidateUser(connectionId);\n  }\n  /**\n   * Stores a new user from a full presence update. If the user already exists,\n   * its known presence data is overwritten.\n   */\n  setOther(connectionId, presence) {\n    this._presences.set(connectionId, freeze(compactObject(presence)));\n    if (this._connections.has(connectionId)) {\n      this._invalidateUser(connectionId);\n    }\n  }\n  /**\n   * Patches the presence data for an existing \"other\". If we don't know the\n   * initial presence data for this user yet, discard this patch and await the\n   * full .setOther() call first.\n   */\n  patchOther(connectionId, patch) {\n    const oldPresence = this._presences.get(connectionId);\n    if (oldPresence === void 0) {\n      return;\n    }\n    const newPresence = merge(oldPresence, patch);\n    if (oldPresence !== newPresence) {\n      this._presences.set(connectionId, freeze(newPresence));\n      this._invalidateUser(connectionId);\n    }\n  }\n};\n\n// src/refs/PatchableRef.ts\nvar PatchableRef = class extends ImmutableRef {\n  constructor(data) {\n    super();\n    this._data = freeze(compactObject(data));\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._data;\n  }\n  /**\n   * Patches the current object.\n   */\n  patch(patch) {\n    const oldData = this._data;\n    const newData = merge(oldData, patch);\n    if (oldData !== newData) {\n      this._data = freeze(newData);\n      this.invalidate();\n    }\n  }\n};\n\n// src/refs/ValueRef.ts\nvar ValueRef = class extends ImmutableRef {\n  constructor(initialValue) {\n    super();\n    this._value = freeze(initialValue);\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._value;\n  }\n  set(newValue) {\n    this._value = freeze(newValue);\n    this.invalidate();\n  }\n};\nvar DerivedRef = class extends ImmutableRef {\n  constructor(...args) {\n    super();\n    const transformFn = args.pop();\n    const otherRefs = args;\n    this._refs = otherRefs;\n    this._refs.forEach((ref) => {\n      ref.didInvalidate.subscribe(() => this.invalidate());\n    });\n    this._transform = transformFn;\n  }\n  /** @internal */\n  _toImmutable() {\n    return this._transform(\n      ...this._refs.map((ref) => ref.current)\n    );\n  }\n};\n\n// src/room.ts\nvar MAX_SOCKET_MESSAGE_SIZE = 1024 * 1024 - 1024;\nfunction makeIdFactory(connectionId) {\n  let count = 0;\n  return () => `${connectionId}:${count++}`;\n}\nfunction userToTreeNode(key, user) {\n  return {\n    type: \"User\",\n    id: `${user.connectionId}`,\n    key,\n    payload: {\n      connectionId: user.connectionId,\n      id: user.id,\n      info: user.info,\n      presence: user.presence,\n      isReadOnly: !user.canWrite\n    }\n  };\n}\nfunction installBackgroundTabSpy() {\n  const doc = typeof document !== \"undefined\" ? document : void 0;\n  const inBackgroundSince = { current: null };\n  function onVisibilityChange() {\n    if (doc?.visibilityState === \"hidden\") {\n      inBackgroundSince.current = inBackgroundSince.current ?? Date.now();\n    } else {\n      inBackgroundSince.current = null;\n    }\n  }\n  doc?.addEventListener(\"visibilitychange\", onVisibilityChange);\n  const unsub = () => {\n    doc?.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  };\n  return [inBackgroundSince, unsub];\n}\nvar CommentsApiError = class extends Error {\n  constructor(message, status, details) {\n    super(message);\n    this.message = message;\n    this.status = status;\n    this.details = details;\n  }\n};\nfunction createCommentsApi(roomId, getAuthValue, fetchClientApi) {\n  async function fetchCommentsApi(endpoint, params, options) {\n    const authValue = await getAuthValue();\n    return fetchClientApi(roomId, endpoint, authValue, options, params);\n  }\n  async function fetchJson(endpoint, options, params) {\n    const response = await fetchCommentsApi(endpoint, params, options);\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new CommentsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new CommentsApiError(response.statusText, response.status);\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  async function getThreadsSince(options) {\n    const response = await fetchCommentsApi(\n      \"/threads\",\n      {\n        since: options?.since?.toISOString()\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        threads: {\n          updated: json.data.map(convertToThreadData),\n          deleted: json.deletedThreads.map(convertToThreadDeleteInfo)\n        },\n        inboxNotifications: {\n          updated: json.inboxNotifications.map(convertToInboxNotificationData),\n          deleted: json.deletedInboxNotifications.map(\n            convertToInboxNotificationDeleteInfo\n          )\n        },\n        requestedAt: new Date(json.meta.requestedAt)\n      };\n    } else if (response.status === 404) {\n      return {\n        threads: {\n          updated: [],\n          deleted: []\n        },\n        inboxNotifications: {\n          updated: [],\n          deleted: []\n        },\n        requestedAt: /* @__PURE__ */ new Date()\n      };\n    } else {\n      throw new Error(\"There was an error while getting threads.\");\n    }\n  }\n  async function getThreads(options) {\n    let query;\n    if (options?.query) {\n      query = objectToQuery(options.query);\n    }\n    const response = await fetchCommentsApi(\n      \"/threads\",\n      {\n        query\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        threads: json.data.map(convertToThreadData),\n        inboxNotifications: json.inboxNotifications.map(\n          convertToInboxNotificationData\n        ),\n        requestedAt: new Date(json.meta.requestedAt)\n      };\n    } else if (response.status === 404) {\n      return {\n        threads: [],\n        inboxNotifications: [],\n        deletedThreads: [],\n        deletedInboxNotifications: [],\n        requestedAt: /* @__PURE__ */ new Date()\n      };\n    } else {\n      throw new Error(\"There was an error while getting threads.\");\n    }\n  }\n  async function getThread(threadId) {\n    const response = await fetchCommentsApi(\n      `/thread-with-notification/${threadId}`\n    );\n    if (response.ok) {\n      const json = await response.json();\n      return {\n        thread: convertToThreadData(json.thread),\n        inboxNotification: json.inboxNotification ? convertToInboxNotificationData(json.inboxNotification) : void 0\n      };\n    } else if (response.status === 404) {\n      return {\n        thread: void 0,\n        inboxNotification: void 0\n      };\n    } else {\n      throw new Error(`There was an error while getting thread ${threadId}.`);\n    }\n  }\n  async function createThread({\n    metadata,\n    body,\n    commentId = createCommentId(),\n    threadId = createThreadId()\n  }) {\n    const thread = await fetchJson(\"/threads\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: threadId,\n        comment: {\n          id: commentId,\n          body\n        },\n        metadata\n      })\n    });\n    return convertToThreadData(thread);\n  }\n  async function deleteThread(threadId) {\n    await fetchJson(`/threads/${encodeURIComponent(threadId)}`, {\n      method: \"DELETE\"\n    });\n  }\n  async function editThreadMetadata({\n    metadata,\n    threadId\n  }) {\n    return await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/metadata`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(metadata)\n      }\n    );\n  }\n  async function markThreadAsResolved(threadId) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/mark-as-resolved`,\n      {\n        method: \"POST\"\n      }\n    );\n  }\n  async function markThreadAsUnresolved(threadId) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/mark-as-unresolved`,\n      {\n        method: \"POST\"\n      }\n    );\n  }\n  async function createComment({\n    threadId,\n    commentId = createCommentId(),\n    body\n  }) {\n    const comment = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          id: commentId,\n          body\n        })\n      }\n    );\n    return convertToCommentData(comment);\n  }\n  async function editComment({\n    threadId,\n    commentId,\n    body\n  }) {\n    const comment = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          body\n        })\n      }\n    );\n    return convertToCommentData(comment);\n  }\n  async function deleteComment2({\n    threadId,\n    commentId\n  }) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  async function addReaction2({\n    threadId,\n    commentId,\n    emoji\n  }) {\n    const reaction = await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}/reactions`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({ emoji })\n      }\n    );\n    return convertToCommentUserReaction(reaction);\n  }\n  async function removeReaction2({\n    threadId,\n    commentId,\n    emoji\n  }) {\n    await fetchJson(\n      `/threads/${encodeURIComponent(threadId)}/comments/${encodeURIComponent(\n        commentId\n      )}/reactions/${encodeURIComponent(emoji)}`,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  return {\n    getThreads,\n    getThreadsSince,\n    getThread,\n    createThread,\n    deleteThread,\n    editThreadMetadata,\n    markThreadAsResolved,\n    markThreadAsUnresolved,\n    createComment,\n    editComment,\n    deleteComment: deleteComment2,\n    addReaction: addReaction2,\n    removeReaction: removeReaction2\n  };\n}\nvar MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY2 = 50;\nfunction createRoom(options, config) {\n  const initialPresence = options.initialPresence;\n  const initialStorage = options.initialStorage;\n  const [inBackgroundSince, uninstallBgTabSpy] = installBackgroundTabSpy();\n  const delegates = {\n    ...config.delegates,\n    // A connection is allowed to go into \"zombie state\" only if all of the\n    // following conditions apply:\n    //\n    // - The `backgroundKeepAliveTimeout` client option is configured\n    // - The browser window has been in the background for at least\n    //   `backgroundKeepAliveTimeout` milliseconds\n    // - There are no pending changes\n    //\n    canZombie() {\n      return config.backgroundKeepAliveTimeout !== void 0 && inBackgroundSince.current !== null && Date.now() > inBackgroundSince.current + config.backgroundKeepAliveTimeout && getStorageStatus() !== \"synchronizing\";\n    }\n  };\n  const managedSocket = new ManagedSocket(\n    delegates,\n    config.enableDebugLogging\n  );\n  const context = {\n    buffer: {\n      flushTimerID: void 0,\n      lastFlushedAt: 0,\n      presenceUpdates: (\n        // Queue up the initial presence message as a Full Presence update\n        {\n          type: \"full\",\n          data: initialPresence\n        }\n      ),\n      messages: [],\n      storageOperations: []\n    },\n    staticSessionInfo: new ValueRef(null),\n    dynamicSessionInfo: new ValueRef(null),\n    myPresence: new PatchableRef(initialPresence),\n    others: new OthersRef(),\n    initialStorage,\n    idFactory: null,\n    // Storage\n    clock: 0,\n    opClock: 0,\n    nodes: /* @__PURE__ */ new Map(),\n    root: void 0,\n    undoStack: [],\n    redoStack: [],\n    pausedHistory: null,\n    activeBatch: null,\n    unacknowledgedOps: /* @__PURE__ */ new Map(),\n    // Debug\n    opStackTraces:  true ? /* @__PURE__ */ new Map() : 0\n  };\n  const doNotBatchUpdates = (cb) => cb();\n  const batchUpdates = config.unstable_batchedUpdates ?? doNotBatchUpdates;\n  let lastTokenKey;\n  function onStatusDidChange(newStatus) {\n    const authValue = managedSocket.authValue;\n    if (authValue !== null) {\n      const tokenKey = getAuthBearerHeaderFromAuthValue(authValue);\n      if (tokenKey !== lastTokenKey) {\n        lastTokenKey = tokenKey;\n        if (authValue.type === \"secret\") {\n          const token = authValue.token.parsed;\n          context.staticSessionInfo.set({\n            userId: token.k === \"sec-legacy\" /* SECRET_LEGACY */ ? token.id : token.uid,\n            userInfo: token.k === \"sec-legacy\" /* SECRET_LEGACY */ ? token.info : token.ui\n          });\n        } else {\n          context.staticSessionInfo.set({\n            userId: void 0,\n            userInfo: void 0\n          });\n        }\n      }\n    }\n    batchUpdates(() => {\n      eventHub.status.notify(newStatus);\n      notifySelfChanged(doNotBatchUpdates);\n    });\n  }\n  let _connectionLossTimerId;\n  let _hasLostConnection = false;\n  function handleConnectionLossEvent(newStatus) {\n    if (newStatus === \"reconnecting\") {\n      _connectionLossTimerId = setTimeout(() => {\n        batchUpdates(() => {\n          eventHub.lostConnection.notify(\"lost\");\n          _hasLostConnection = true;\n          context.others.clearOthers();\n          notify({ others: [{ type: \"reset\" }] }, doNotBatchUpdates);\n        });\n      }, config.lostConnectionTimeout);\n    } else {\n      clearTimeout(_connectionLossTimerId);\n      if (_hasLostConnection) {\n        if (newStatus === \"disconnected\") {\n          batchUpdates(() => {\n            eventHub.lostConnection.notify(\"failed\");\n          });\n        } else {\n          batchUpdates(() => {\n            eventHub.lostConnection.notify(\"restored\");\n          });\n        }\n        _hasLostConnection = false;\n      }\n    }\n  }\n  function onDidConnect() {\n    context.buffer.presenceUpdates = {\n      type: \"full\",\n      data: (\n        // Because context.me.current is a readonly object, we'll have to\n        // make a copy here. Otherwise, type errors happen later when\n        // \"patching\" my presence.\n        { ...context.myPresence.current }\n      )\n    };\n    if (_getStorage$ !== null) {\n      refreshStorage({ flush: false });\n    }\n    flushNowOrSoon();\n  }\n  function onDidDisconnect() {\n    clearTimeout(context.buffer.flushTimerID);\n  }\n  managedSocket.events.onMessage.subscribe(handleServerMessage);\n  managedSocket.events.statusDidChange.subscribe(onStatusDidChange);\n  managedSocket.events.statusDidChange.subscribe(handleConnectionLossEvent);\n  managedSocket.events.didConnect.subscribe(onDidConnect);\n  managedSocket.events.didDisconnect.subscribe(onDidDisconnect);\n  managedSocket.events.onLiveblocksError.subscribe((err) => {\n    batchUpdates(() => {\n      if (true) {\n        error2(\n          `Connection to websocket server closed. Reason: ${err.message} (code: ${err.code}).`\n        );\n      }\n      eventHub.error.notify(err);\n    });\n  });\n  const pool = {\n    roomId: config.roomId,\n    getNode: (id) => context.nodes.get(id),\n    addNode: (id, node) => void context.nodes.set(id, node),\n    deleteNode: (id) => void context.nodes.delete(id),\n    generateId: () => `${getConnectionId()}:${context.clock++}`,\n    generateOpId: () => `${getConnectionId()}:${context.opClock++}`,\n    dispatch(ops, reverse, storageUpdates) {\n      const activeBatch = context.activeBatch;\n      if (true) {\n        const stackTrace = captureStackTrace(\"Storage mutation\", this.dispatch);\n        if (stackTrace) {\n          for (const op of ops) {\n            if (op.opId) {\n              nn(context.opStackTraces).set(op.opId, stackTrace);\n            }\n          }\n        }\n      }\n      if (activeBatch) {\n        for (const op of ops) {\n          activeBatch.ops.push(op);\n        }\n        for (const [key, value] of storageUpdates) {\n          activeBatch.updates.storageUpdates.set(\n            key,\n            mergeStorageUpdates(\n              activeBatch.updates.storageUpdates.get(key),\n              value\n            )\n          );\n        }\n        activeBatch.reverseOps.unshift(...reverse);\n      } else {\n        batchUpdates(() => {\n          addToUndoStack(reverse, doNotBatchUpdates);\n          context.redoStack.length = 0;\n          dispatchOps(ops);\n          notify({ storageUpdates }, doNotBatchUpdates);\n        });\n      }\n    },\n    assertStorageIsWritable: () => {\n      const scopes = context.dynamicSessionInfo.current?.scopes;\n      if (scopes === void 0) {\n        return;\n      }\n      const canWrite = canWriteStorage(scopes);\n      if (!canWrite) {\n        throw new Error(\n          \"Cannot write to storage with a read only user, please ensure the user has write permissions\"\n        );\n      }\n    }\n  };\n  const eventHub = {\n    status: makeEventSource(),\n    // New/recommended API\n    lostConnection: makeEventSource(),\n    customEvent: makeEventSource(),\n    self: makeEventSource(),\n    myPresence: makeEventSource(),\n    others: makeEventSource(),\n    error: makeEventSource(),\n    storageBatch: makeEventSource(),\n    history: makeEventSource(),\n    storageDidLoad: makeEventSource(),\n    storageStatus: makeEventSource(),\n    ydoc: makeEventSource(),\n    comments: makeEventSource()\n  };\n  async function fetchClientApi(roomId, endpoint, authValue, options2, params) {\n    const url = urljoin(\n      config.baseUrl,\n      `/v2/c/rooms/${encodeURIComponent(roomId)}${endpoint}`,\n      params\n    );\n    const fetcher = config.polyfills?.fetch || /* istanbul ignore next */\n    fetch;\n    return await fetcher(url, {\n      ...options2,\n      headers: {\n        ...options2?.headers,\n        Authorization: `Bearer ${getAuthBearerHeaderFromAuthValue(authValue)}`\n      }\n    });\n  }\n  async function streamFetch(authValue, roomId) {\n    return fetchClientApi(roomId, \"/storage\", authValue, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  }\n  async function httpPostToRoom(endpoint, body) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(config.roomId, endpoint, managedSocket.authValue, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    });\n  }\n  async function createTextMention(userId, mentionId) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(\n      config.roomId,\n      \"/text-mentions\",\n      managedSocket.authValue,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          userId,\n          mentionId\n        })\n      }\n    );\n  }\n  async function deleteTextMention(mentionId) {\n    if (!managedSocket.authValue) {\n      throw new Error(\"Not authorized\");\n    }\n    return fetchClientApi(\n      config.roomId,\n      `/text-mentions/${mentionId}`,\n      managedSocket.authValue,\n      {\n        method: \"DELETE\"\n      }\n    );\n  }\n  async function reportTextEditor(type, rootKey) {\n    const authValue = await delegates.authenticate();\n    return fetchClientApi(config.roomId, \"/text-metadata\", authValue, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        type,\n        rootKey\n      })\n    });\n  }\n  function sendMessages(messages) {\n    const serializedPayload = JSON.stringify(messages);\n    const nonce = context.dynamicSessionInfo.current?.nonce;\n    if (config.unstable_fallbackToHTTP && nonce) {\n      const size = new TextEncoder().encode(serializedPayload).length;\n      if (size > MAX_SOCKET_MESSAGE_SIZE) {\n        void httpPostToRoom(\"/send-message\", { nonce, messages }).then(\n          (resp) => {\n            if (!resp.ok && resp.status === 403) {\n              managedSocket.reconnect();\n            }\n          }\n        );\n        warn(\n          \"Message was too large for websockets and sent over HTTP instead\"\n        );\n        return;\n      }\n    }\n    managedSocket.send(serializedPayload);\n  }\n  const self = new DerivedRef(\n    context.staticSessionInfo,\n    context.dynamicSessionInfo,\n    context.myPresence,\n    (staticSession, dynamicSession, myPresence) => {\n      if (staticSession === null || dynamicSession === null) {\n        return null;\n      } else {\n        const canWrite = canWriteStorage(dynamicSession.scopes);\n        return {\n          connectionId: dynamicSession.actor,\n          id: staticSession.userId,\n          info: staticSession.userInfo,\n          presence: myPresence,\n          canWrite,\n          canComment: canComment(dynamicSession.scopes)\n        };\n      }\n    }\n  );\n  let _lastSelf;\n  function notifySelfChanged(batchedUpdatesWrapper) {\n    const currSelf = self.current;\n    if (currSelf !== null && currSelf !== _lastSelf) {\n      batchedUpdatesWrapper(() => {\n        eventHub.self.notify(currSelf);\n      });\n      _lastSelf = currSelf;\n    }\n  }\n  const selfAsTreeNode = new DerivedRef(\n    self,\n    (me) => me !== null ? userToTreeNode(\"Me\", me) : null\n  );\n  function createOrUpdateRootFromMessage(message, batchedUpdatesWrapper) {\n    if (message.items.length === 0) {\n      throw new Error(\"Internal error: cannot load storage without items\");\n    }\n    if (context.root !== void 0) {\n      updateRoot(message.items, batchedUpdatesWrapper);\n    } else {\n      context.root = LiveObject._fromItems(message.items, pool);\n    }\n    const canWrite = self.current?.canWrite ?? true;\n    const stackSizeBefore = context.undoStack.length;\n    for (const key in context.initialStorage) {\n      if (context.root.get(key) === void 0) {\n        if (canWrite) {\n          context.root.set(key, cloneLson(context.initialStorage[key]));\n        } else {\n          warn(\n            `Attempted to populate missing storage key '${key}', but current user has no write access`\n          );\n        }\n      }\n    }\n    context.undoStack.length = stackSizeBefore;\n  }\n  function updateRoot(items, batchedUpdatesWrapper) {\n    if (context.root === void 0) {\n      return;\n    }\n    const currentItems = /* @__PURE__ */ new Map();\n    for (const [id, node] of context.nodes) {\n      currentItems.set(id, node._serialize());\n    }\n    const ops = getTreesDiffOperations(currentItems, new Map(items));\n    const result = applyOps(ops, false);\n    notify(result.updates, batchedUpdatesWrapper);\n  }\n  function _addToRealUndoStack(historyOps, batchedUpdatesWrapper) {\n    if (context.undoStack.length >= 50) {\n      context.undoStack.shift();\n    }\n    context.undoStack.push(historyOps);\n    onHistoryChange(batchedUpdatesWrapper);\n  }\n  function addToUndoStack(historyOps, batchedUpdatesWrapper) {\n    if (context.pausedHistory !== null) {\n      context.pausedHistory.unshift(...historyOps);\n    } else {\n      _addToRealUndoStack(historyOps, batchedUpdatesWrapper);\n    }\n  }\n  function notify(updates, batchedUpdatesWrapper) {\n    const storageUpdates = updates.storageUpdates;\n    const othersUpdates = updates.others;\n    batchedUpdatesWrapper(() => {\n      if (othersUpdates !== void 0 && othersUpdates.length > 0) {\n        const others = context.others.current;\n        for (const event of othersUpdates) {\n          eventHub.others.notify({ ...event, others });\n        }\n      }\n      if (updates.presence ?? false) {\n        notifySelfChanged(doNotBatchUpdates);\n        eventHub.myPresence.notify(context.myPresence.current);\n      }\n      if (storageUpdates !== void 0 && storageUpdates.size > 0) {\n        const updates2 = Array.from(storageUpdates.values());\n        eventHub.storageBatch.notify(updates2);\n      }\n      notifyStorageStatus();\n    });\n  }\n  function getConnectionId() {\n    const info = context.dynamicSessionInfo.current;\n    if (info) {\n      return info.actor;\n    }\n    throw new Error(\n      \"Internal. Tried to get connection id but connection was never open\"\n    );\n  }\n  function applyOps(rawOps, isLocal) {\n    const output = {\n      reverse: [],\n      storageUpdates: /* @__PURE__ */ new Map(),\n      presence: false\n    };\n    const createdNodeIds = /* @__PURE__ */ new Set();\n    const ops = rawOps.map((op) => {\n      if (op.type !== \"presence\" && !op.opId) {\n        return { ...op, opId: pool.generateOpId() };\n      } else {\n        return op;\n      }\n    });\n    for (const op of ops) {\n      if (op.type === \"presence\") {\n        const reverse = {\n          type: \"presence\",\n          data: {}\n        };\n        for (const key in op.data) {\n          reverse.data[key] = context.myPresence.current[key];\n        }\n        context.myPresence.patch(op.data);\n        if (context.buffer.presenceUpdates === null) {\n          context.buffer.presenceUpdates = { type: \"partial\", data: op.data };\n        } else {\n          for (const key in op.data) {\n            context.buffer.presenceUpdates.data[key] = op.data[key];\n          }\n        }\n        output.reverse.unshift(reverse);\n        output.presence = true;\n      } else {\n        let source;\n        if (isLocal) {\n          source = 0 /* UNDOREDO_RECONNECT */;\n        } else {\n          const opId = nn(op.opId);\n          if (true) {\n            nn(context.opStackTraces).delete(opId);\n          }\n          const deleted = context.unacknowledgedOps.delete(opId);\n          source = deleted ? 2 /* ACK */ : 1 /* REMOTE */;\n        }\n        const applyOpResult = applyOp(op, source);\n        if (applyOpResult.modified) {\n          const nodeId = applyOpResult.modified.node._id;\n          if (!(nodeId && createdNodeIds.has(nodeId))) {\n            output.storageUpdates.set(\n              nn(applyOpResult.modified.node._id),\n              mergeStorageUpdates(\n                output.storageUpdates.get(nn(applyOpResult.modified.node._id)),\n                applyOpResult.modified\n              )\n            );\n            output.reverse.unshift(...applyOpResult.reverse);\n          }\n          if (op.type === 2 /* CREATE_LIST */ || op.type === 7 /* CREATE_MAP */ || op.type === 4 /* CREATE_OBJECT */) {\n            createdNodeIds.add(nn(op.id));\n          }\n        }\n      }\n    }\n    return {\n      ops,\n      reverse: output.reverse,\n      updates: {\n        storageUpdates: output.storageUpdates,\n        presence: output.presence\n      }\n    };\n  }\n  function applyOp(op, source) {\n    if (isAckOp(op)) {\n      return { modified: false };\n    }\n    switch (op.type) {\n      case 6 /* DELETE_OBJECT_KEY */:\n      case 3 /* UPDATE_OBJECT */:\n      case 5 /* DELETE_CRDT */: {\n        const node = context.nodes.get(op.id);\n        if (node === void 0) {\n          return { modified: false };\n        }\n        return node._apply(op, source === 0 /* UNDOREDO_RECONNECT */);\n      }\n      case 1 /* SET_PARENT_KEY */: {\n        const node = context.nodes.get(op.id);\n        if (node === void 0) {\n          return { modified: false };\n        }\n        if (node.parent.type === \"HasParent\" && isLiveList(node.parent.node)) {\n          return node.parent.node._setChildKey(\n            asPos(op.parentKey),\n            node,\n            source\n          );\n        }\n        return { modified: false };\n      }\n      case 4 /* CREATE_OBJECT */:\n      case 2 /* CREATE_LIST */:\n      case 7 /* CREATE_MAP */:\n      case 8 /* CREATE_REGISTER */: {\n        if (op.parentId === void 0) {\n          return { modified: false };\n        }\n        const parentNode = context.nodes.get(op.parentId);\n        if (parentNode === void 0) {\n          return { modified: false };\n        }\n        return parentNode._attachChild(op, source);\n      }\n    }\n  }\n  function updatePresence(patch, options2) {\n    const oldValues = {};\n    if (context.buffer.presenceUpdates === null) {\n      context.buffer.presenceUpdates = {\n        type: \"partial\",\n        data: {}\n      };\n    }\n    for (const key in patch) {\n      const overrideValue = patch[key];\n      if (overrideValue === void 0) {\n        continue;\n      }\n      context.buffer.presenceUpdates.data[key] = overrideValue;\n      oldValues[key] = context.myPresence.current[key];\n    }\n    context.myPresence.patch(patch);\n    if (context.activeBatch) {\n      if (options2?.addToHistory) {\n        context.activeBatch.reverseOps.unshift({\n          type: \"presence\",\n          data: oldValues\n        });\n      }\n      context.activeBatch.updates.presence = true;\n    } else {\n      flushNowOrSoon();\n      batchUpdates(() => {\n        if (options2?.addToHistory) {\n          addToUndoStack(\n            [{ type: \"presence\", data: oldValues }],\n            doNotBatchUpdates\n          );\n        }\n        notify({ presence: true }, doNotBatchUpdates);\n      });\n    }\n  }\n  function onUpdatePresenceMessage(message) {\n    if (message.targetActor !== void 0) {\n      const oldUser = context.others.getUser(message.actor);\n      context.others.setOther(message.actor, message.data);\n      const newUser = context.others.getUser(message.actor);\n      if (oldUser === void 0 && newUser !== void 0) {\n        return { type: \"enter\", user: newUser };\n      }\n    } else {\n      context.others.patchOther(message.actor, message.data), message;\n    }\n    const user = context.others.getUser(message.actor);\n    if (user) {\n      return {\n        type: \"update\",\n        updates: message.data,\n        user\n      };\n    } else {\n      return void 0;\n    }\n  }\n  function onUserLeftMessage(message) {\n    const user = context.others.getUser(message.actor);\n    if (user) {\n      context.others.removeConnection(message.actor);\n      return { type: \"leave\", user };\n    }\n    return null;\n  }\n  function onRoomStateMessage(message, batchedUpdatesWrapper) {\n    context.dynamicSessionInfo.set({\n      actor: message.actor,\n      nonce: message.nonce,\n      scopes: message.scopes\n    });\n    context.idFactory = makeIdFactory(message.actor);\n    notifySelfChanged(batchedUpdatesWrapper);\n    for (const connectionId of context.others.connectionIds()) {\n      const user = message.users[connectionId];\n      if (user === void 0) {\n        context.others.removeConnection(connectionId);\n      }\n    }\n    for (const key in message.users) {\n      const user = message.users[key];\n      const connectionId = Number(key);\n      context.others.setConnection(\n        connectionId,\n        user.id,\n        user.info,\n        user.scopes\n      );\n    }\n    return { type: \"reset\" };\n  }\n  function canUndo() {\n    return context.undoStack.length > 0;\n  }\n  function canRedo() {\n    return context.redoStack.length > 0;\n  }\n  function onHistoryChange(batchedUpdatesWrapper) {\n    batchedUpdatesWrapper(() => {\n      eventHub.history.notify({ canUndo: canUndo(), canRedo: canRedo() });\n    });\n  }\n  function onUserJoinedMessage(message) {\n    context.others.setConnection(\n      message.actor,\n      message.id,\n      message.info,\n      message.scopes\n    );\n    context.buffer.messages.push({\n      type: 100 /* UPDATE_PRESENCE */,\n      data: context.myPresence.current,\n      targetActor: message.actor\n    });\n    flushNowOrSoon();\n    const user = context.others.getUser(message.actor);\n    return user ? { type: \"enter\", user } : void 0;\n  }\n  function parseServerMessage(data) {\n    if (!isJsonObject(data)) {\n      return null;\n    }\n    return data;\n  }\n  function parseServerMessages(text) {\n    const data = tryParseJson(text);\n    if (data === void 0) {\n      return null;\n    } else if (isJsonArray(data)) {\n      return compact(data.map((item) => parseServerMessage(item)));\n    } else {\n      return compact([parseServerMessage(data)]);\n    }\n  }\n  function applyAndSendOps(offlineOps, batchedUpdatesWrapper) {\n    if (offlineOps.size === 0) {\n      return;\n    }\n    const messages = [];\n    const ops = Array.from(offlineOps.values());\n    const result = applyOps(ops, true);\n    messages.push({\n      type: 201 /* UPDATE_STORAGE */,\n      ops: result.ops\n    });\n    notify(result.updates, batchedUpdatesWrapper);\n    sendMessages(messages);\n  }\n  function handleServerMessage(event) {\n    if (typeof event.data !== \"string\") {\n      return;\n    }\n    const messages = parseServerMessages(event.data);\n    if (messages === null || messages.length === 0) {\n      return;\n    }\n    const updates = {\n      storageUpdates: /* @__PURE__ */ new Map(),\n      others: []\n    };\n    batchUpdates(() => {\n      for (const message of messages) {\n        switch (message.type) {\n          case 101 /* USER_JOINED */: {\n            const userJoinedUpdate = onUserJoinedMessage(message);\n            if (userJoinedUpdate) {\n              updates.others.push(userJoinedUpdate);\n            }\n            break;\n          }\n          case 100 /* UPDATE_PRESENCE */: {\n            const othersPresenceUpdate = onUpdatePresenceMessage(message);\n            if (othersPresenceUpdate) {\n              updates.others.push(othersPresenceUpdate);\n            }\n            break;\n          }\n          case 103 /* BROADCASTED_EVENT */: {\n            const others = context.others.current;\n            eventHub.customEvent.notify({\n              connectionId: message.actor,\n              user: message.actor < 0 ? null : others.find((u) => u.connectionId === message.actor) ?? null,\n              event: message.event\n            });\n            break;\n          }\n          case 102 /* USER_LEFT */: {\n            const event2 = onUserLeftMessage(message);\n            if (event2) {\n              updates.others.push(event2);\n            }\n            break;\n          }\n          case 300 /* UPDATE_YDOC */: {\n            eventHub.ydoc.notify(message);\n            break;\n          }\n          case 104 /* ROOM_STATE */: {\n            updates.others.push(onRoomStateMessage(message, doNotBatchUpdates));\n            break;\n          }\n          case 200 /* INITIAL_STORAGE_STATE */: {\n            processInitialStorage(message);\n            break;\n          }\n          case 201 /* UPDATE_STORAGE */: {\n            const applyResult = applyOps(message.ops, false);\n            for (const [key, value] of applyResult.updates.storageUpdates) {\n              updates.storageUpdates.set(\n                key,\n                mergeStorageUpdates(updates.storageUpdates.get(key), value)\n              );\n            }\n            break;\n          }\n          case 299 /* REJECT_STORAGE_OP */: {\n            errorWithTitle(\n              \"Storage mutation rejection error\",\n              message.reason\n            );\n            if (true) {\n              const traces = /* @__PURE__ */ new Set();\n              for (const opId of message.opIds) {\n                const trace = context.opStackTraces?.get(opId);\n                if (trace) {\n                  traces.add(trace);\n                }\n              }\n              if (traces.size > 0) {\n                warnWithTitle(\n                  \"The following function calls caused the rejected storage mutations:\",\n                  `\n\n${Array.from(traces).join(\"\\n\\n\")}`\n                );\n              }\n              throw new Error(\n                `Storage mutations rejected by server: ${message.reason}`\n              );\n            }\n            break;\n          }\n          case 400 /* THREAD_CREATED */:\n          case 407 /* THREAD_DELETED */:\n          case 401 /* THREAD_METADATA_UPDATED */:\n          case 408 /* THREAD_UPDATED */:\n          case 405 /* COMMENT_REACTION_ADDED */:\n          case 406 /* COMMENT_REACTION_REMOVED */:\n          case 402 /* COMMENT_CREATED */:\n          case 403 /* COMMENT_EDITED */:\n          case 404 /* COMMENT_DELETED */: {\n            eventHub.comments.notify(message);\n            break;\n          }\n        }\n      }\n      notify(updates, doNotBatchUpdates);\n    });\n  }\n  function flushNowOrSoon() {\n    const storageOps = context.buffer.storageOperations;\n    if (storageOps.length > 0) {\n      for (const op of storageOps) {\n        context.unacknowledgedOps.set(nn(op.opId), op);\n      }\n      notifyStorageStatus();\n    }\n    if (managedSocket.getStatus() !== \"connected\") {\n      context.buffer.storageOperations = [];\n      return;\n    }\n    const now = Date.now();\n    const elapsedMillis = now - context.buffer.lastFlushedAt;\n    if (elapsedMillis >= config.throttleDelay) {\n      const messagesToFlush = serializeBuffer();\n      if (messagesToFlush.length === 0) {\n        return;\n      }\n      sendMessages(messagesToFlush);\n      context.buffer = {\n        flushTimerID: void 0,\n        lastFlushedAt: now,\n        messages: [],\n        storageOperations: [],\n        presenceUpdates: null\n      };\n    } else {\n      clearTimeout(context.buffer.flushTimerID);\n      context.buffer.flushTimerID = setTimeout(\n        flushNowOrSoon,\n        config.throttleDelay - elapsedMillis\n      );\n    }\n  }\n  function serializeBuffer() {\n    const messages = [];\n    if (context.buffer.presenceUpdates) {\n      messages.push(\n        context.buffer.presenceUpdates.type === \"full\" ? {\n          type: 100 /* UPDATE_PRESENCE */,\n          // Populating the `targetActor` field turns this message into\n          // a Full Presence update message (not a patch), which will get\n          // interpreted by other clients as such.\n          targetActor: -1,\n          data: context.buffer.presenceUpdates.data\n        } : {\n          type: 100 /* UPDATE_PRESENCE */,\n          data: context.buffer.presenceUpdates.data\n        }\n      );\n    }\n    for (const event of context.buffer.messages) {\n      messages.push(event);\n    }\n    if (context.buffer.storageOperations.length > 0) {\n      messages.push({\n        type: 201 /* UPDATE_STORAGE */,\n        ops: context.buffer.storageOperations\n      });\n    }\n    return messages;\n  }\n  function updateYDoc(update, guid) {\n    const clientMsg = {\n      type: 301 /* UPDATE_YDOC */,\n      update,\n      guid\n    };\n    context.buffer.messages.push(clientMsg);\n    eventHub.ydoc.notify(clientMsg);\n    flushNowOrSoon();\n  }\n  function broadcastEvent(event, options2 = {\n    shouldQueueEventIfNotReady: false\n  }) {\n    if (managedSocket.getStatus() !== \"connected\" && !options2.shouldQueueEventIfNotReady) {\n      return;\n    }\n    context.buffer.messages.push({\n      type: 103 /* BROADCAST_EVENT */,\n      event\n    });\n    flushNowOrSoon();\n  }\n  function dispatchOps(ops) {\n    const { storageOperations } = context.buffer;\n    for (const op of ops) {\n      storageOperations.push(op);\n    }\n    flushNowOrSoon();\n  }\n  let _getStorage$ = null;\n  let _resolveStoragePromise = null;\n  function processInitialStorage(message) {\n    const unacknowledgedOps = new Map(context.unacknowledgedOps);\n    createOrUpdateRootFromMessage(message, doNotBatchUpdates);\n    applyAndSendOps(unacknowledgedOps, doNotBatchUpdates);\n    _resolveStoragePromise?.();\n    notifyStorageStatus();\n    eventHub.storageDidLoad.notify();\n  }\n  async function streamStorage() {\n    if (!managedSocket.authValue) {\n      return;\n    }\n    const result = await streamFetch(managedSocket.authValue, config.roomId);\n    const items = await result.json();\n    processInitialStorage({ type: 200 /* INITIAL_STORAGE_STATE */, items });\n  }\n  function refreshStorage(options2) {\n    const messages = context.buffer.messages;\n    if (config.unstable_streamData) {\n      void streamStorage();\n    } else if (!messages.some((msg) => msg.type === 200 /* FETCH_STORAGE */)) {\n      messages.push({ type: 200 /* FETCH_STORAGE */ });\n    }\n    if (options2.flush) {\n      flushNowOrSoon();\n    }\n  }\n  function startLoadingStorage() {\n    if (_getStorage$ === null) {\n      refreshStorage({ flush: true });\n      _getStorage$ = new Promise((resolve) => {\n        _resolveStoragePromise = resolve;\n      });\n      notifyStorageStatus();\n    }\n    return _getStorage$;\n  }\n  function getStorageSnapshot() {\n    const root = context.root;\n    if (root !== void 0) {\n      return root;\n    } else {\n      void startLoadingStorage();\n      return null;\n    }\n  }\n  async function getStorage() {\n    if (context.root !== void 0) {\n      return Promise.resolve({\n        root: context.root\n      });\n    }\n    await startLoadingStorage();\n    return {\n      root: nn(context.root)\n    };\n  }\n  function fetchYDoc(vector, guid) {\n    if (!context.buffer.messages.find((m) => {\n      return m.type === 300 /* FETCH_YDOC */ && m.vector === vector && m.guid === guid;\n    })) {\n      context.buffer.messages.push({\n        type: 300 /* FETCH_YDOC */,\n        vector,\n        guid\n      });\n    }\n    flushNowOrSoon();\n  }\n  function undo() {\n    if (context.activeBatch) {\n      throw new Error(\"undo is not allowed during a batch\");\n    }\n    const historyOps = context.undoStack.pop();\n    if (historyOps === void 0) {\n      return;\n    }\n    context.pausedHistory = null;\n    const result = applyOps(historyOps, true);\n    batchUpdates(() => {\n      notify(result.updates, doNotBatchUpdates);\n      context.redoStack.push(result.reverse);\n      onHistoryChange(doNotBatchUpdates);\n    });\n    for (const op of result.ops) {\n      if (op.type !== \"presence\") {\n        context.buffer.storageOperations.push(op);\n      }\n    }\n    flushNowOrSoon();\n  }\n  function redo() {\n    if (context.activeBatch) {\n      throw new Error(\"redo is not allowed during a batch\");\n    }\n    const historyOps = context.redoStack.pop();\n    if (historyOps === void 0) {\n      return;\n    }\n    context.pausedHistory = null;\n    const result = applyOps(historyOps, true);\n    batchUpdates(() => {\n      notify(result.updates, doNotBatchUpdates);\n      context.undoStack.push(result.reverse);\n      onHistoryChange(doNotBatchUpdates);\n    });\n    for (const op of result.ops) {\n      if (op.type !== \"presence\") {\n        context.buffer.storageOperations.push(op);\n      }\n    }\n    flushNowOrSoon();\n  }\n  function clear() {\n    context.undoStack.length = 0;\n    context.redoStack.length = 0;\n  }\n  function batch(callback) {\n    if (context.activeBatch) {\n      return callback();\n    }\n    let returnValue = void 0;\n    batchUpdates(() => {\n      context.activeBatch = {\n        ops: [],\n        updates: {\n          storageUpdates: /* @__PURE__ */ new Map(),\n          presence: false,\n          others: []\n        },\n        reverseOps: []\n      };\n      try {\n        returnValue = callback();\n      } finally {\n        const currentBatch = context.activeBatch;\n        context.activeBatch = null;\n        if (currentBatch.reverseOps.length > 0) {\n          addToUndoStack(currentBatch.reverseOps, doNotBatchUpdates);\n        }\n        if (currentBatch.ops.length > 0) {\n          context.redoStack.length = 0;\n        }\n        if (currentBatch.ops.length > 0) {\n          dispatchOps(currentBatch.ops);\n        }\n        notify(currentBatch.updates, doNotBatchUpdates);\n        flushNowOrSoon();\n      }\n    });\n    return returnValue;\n  }\n  function pauseHistory() {\n    if (context.pausedHistory === null) {\n      context.pausedHistory = [];\n    }\n  }\n  function resumeHistory() {\n    const historyOps = context.pausedHistory;\n    context.pausedHistory = null;\n    if (historyOps !== null && historyOps.length > 0) {\n      _addToRealUndoStack(historyOps, batchUpdates);\n    }\n  }\n  function getStorageStatus() {\n    if (context.root === void 0) {\n      return _getStorage$ === null ? \"not-loaded\" : \"loading\";\n    } else {\n      return context.unacknowledgedOps.size === 0 ? \"synchronized\" : \"synchronizing\";\n    }\n  }\n  let _lastStorageStatus = getStorageStatus();\n  function notifyStorageStatus() {\n    const storageStatus = getStorageStatus();\n    if (_lastStorageStatus !== storageStatus) {\n      _lastStorageStatus = storageStatus;\n      eventHub.storageStatus.notify(storageStatus);\n    }\n  }\n  function isPresenceReady() {\n    return self.current !== null;\n  }\n  async function waitUntilPresenceReady() {\n    while (!isPresenceReady()) {\n      const { promise, resolve } = Promise_withResolvers();\n      const unsub1 = events.self.subscribeOnce(resolve);\n      const unsub2 = events.status.subscribeOnce(resolve);\n      await promise;\n      unsub1();\n      unsub2();\n    }\n  }\n  function isStorageReady() {\n    return getStorageSnapshot() !== null;\n  }\n  async function waitUntilStorageReady() {\n    while (!isStorageReady()) {\n      await getStorage();\n    }\n  }\n  const others_forDevTools = new DerivedRef(\n    context.others,\n    (others) => others.map((other, index) => userToTreeNode(`Other ${index}`, other))\n  );\n  const events = {\n    status: eventHub.status.observable,\n    lostConnection: eventHub.lostConnection.observable,\n    customEvent: eventHub.customEvent.observable,\n    others: eventHub.others.observable,\n    self: eventHub.self.observable,\n    myPresence: eventHub.myPresence.observable,\n    error: eventHub.error.observable,\n    /** @deprecated */\n    storage: eventHub.storageBatch.observable,\n    storageBatch: eventHub.storageBatch.observable,\n    history: eventHub.history.observable,\n    storageDidLoad: eventHub.storageDidLoad.observable,\n    storageStatus: eventHub.storageStatus.observable,\n    ydoc: eventHub.ydoc.observable,\n    comments: eventHub.comments.observable\n  };\n  const commentsApi = createCommentsApi(\n    config.roomId,\n    delegates.authenticate,\n    fetchClientApi\n  );\n  async function fetchNotificationsJson(endpoint, options2) {\n    const authValue = await delegates.authenticate();\n    const response = await fetchClientApi(\n      config.roomId,\n      endpoint,\n      authValue,\n      options2\n    );\n    if (!response.ok) {\n      if (response.status >= 400 && response.status < 600) {\n        let error3;\n        try {\n          const errorBody = await response.json();\n          error3 = new NotificationsApiError(\n            errorBody.message,\n            response.status,\n            errorBody\n          );\n        } catch {\n          error3 = new NotificationsApiError(\n            response.statusText,\n            response.status\n          );\n        }\n        throw error3;\n      }\n    }\n    let body;\n    try {\n      body = await response.json();\n    } catch {\n      body = {};\n    }\n    return body;\n  }\n  function getNotificationSettings() {\n    return fetchNotificationsJson(\n      \"/notification-settings\"\n    );\n  }\n  function updateNotificationSettings(settings) {\n    return fetchNotificationsJson(\n      \"/notification-settings\",\n      {\n        method: \"POST\",\n        body: JSON.stringify(settings),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n  }\n  async function markInboxNotificationsAsRead(inboxNotificationIds) {\n    await fetchNotificationsJson(\"/inbox-notifications/read\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ inboxNotificationIds })\n    });\n  }\n  const batchedMarkInboxNotificationsAsRead = new Batch(\n    async (batchedInboxNotificationIds) => {\n      const inboxNotificationIds = batchedInboxNotificationIds.flat();\n      await markInboxNotificationsAsRead(inboxNotificationIds);\n      return inboxNotificationIds;\n    },\n    { delay: MARK_INBOX_NOTIFICATIONS_AS_READ_BATCH_DELAY2 }\n  );\n  async function markInboxNotificationAsRead(inboxNotificationId) {\n    await batchedMarkInboxNotificationsAsRead.get(inboxNotificationId);\n  }\n  return Object.defineProperty(\n    {\n      [kInternal]: {\n        get presenceBuffer() {\n          return deepClone(context.buffer.presenceUpdates?.data ?? null);\n        },\n        // prettier-ignore\n        get undoStack() {\n          return deepClone(context.undoStack);\n        },\n        // prettier-ignore\n        get nodeCount() {\n          return context.nodes.size;\n        },\n        // prettier-ignore\n        // send metadata when using a text editor\n        reportTextEditor,\n        // create a text mention when using a text editor\n        createTextMention,\n        // delete a text mention when using a text editor\n        deleteTextMention,\n        // Support for the Liveblocks browser extension\n        getSelf_forDevTools: () => selfAsTreeNode.current,\n        getOthers_forDevTools: () => others_forDevTools.current,\n        // prettier-ignore\n        simulate: {\n          // These exist only for our E2E testing app\n          explicitClose: (event) => managedSocket._privateSendMachineEvent({ type: \"EXPLICIT_SOCKET_CLOSE\", event }),\n          rawSend: (data) => managedSocket.send(data)\n        }\n      },\n      id: config.roomId,\n      subscribe: makeClassicSubscribeFn(events),\n      connect: () => managedSocket.connect(),\n      reconnect: () => managedSocket.reconnect(),\n      disconnect: () => managedSocket.disconnect(),\n      destroy: () => {\n        uninstallBgTabSpy();\n        managedSocket.destroy();\n      },\n      // Presence\n      updatePresence,\n      updateYDoc,\n      broadcastEvent,\n      // Storage\n      batch,\n      history: {\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        clear,\n        pause: pauseHistory,\n        resume: resumeHistory\n      },\n      fetchYDoc,\n      getStorage,\n      getStorageSnapshot,\n      getStorageStatus,\n      isPresenceReady,\n      isStorageReady,\n      waitUntilPresenceReady: memoizeOnSuccess(waitUntilPresenceReady),\n      waitUntilStorageReady: memoizeOnSuccess(waitUntilStorageReady),\n      events,\n      // Core\n      getStatus: () => managedSocket.getStatus(),\n      getSelf: () => self.current,\n      // Presence\n      getPresence: () => context.myPresence.current,\n      getOthers: () => context.others.current,\n      getNotificationSettings,\n      updateNotificationSettings,\n      markInboxNotificationAsRead,\n      ...commentsApi\n    },\n    // Explictly make the internal field non-enumerable, to avoid aggressive\n    // freezing when used with Immer\n    kInternal,\n    { enumerable: false }\n  );\n}\nfunction makeClassicSubscribeFn(events) {\n  function subscribeToLiveStructureDeeply(node, callback) {\n    return events.storageBatch.subscribe((updates) => {\n      const relatedUpdates = updates.filter(\n        (update) => isSameNodeOrChildOf(update.node, node)\n      );\n      if (relatedUpdates.length > 0) {\n        callback(relatedUpdates);\n      }\n    });\n  }\n  function subscribeToLiveStructureShallowly(node, callback) {\n    return events.storageBatch.subscribe((updates) => {\n      for (const update of updates) {\n        if (update.node._id === node._id) {\n          callback(update.node);\n        }\n      }\n    });\n  }\n  function subscribe(first, second, options) {\n    if (typeof first === \"string\" && isRoomEventName(first)) {\n      if (typeof second !== \"function\") {\n        throw new Error(\"Second argument must be a callback function\");\n      }\n      const callback = second;\n      switch (first) {\n        case \"event\":\n          return events.customEvent.subscribe(\n            callback\n          );\n        case \"my-presence\":\n          return events.myPresence.subscribe(callback);\n        case \"others\": {\n          const cb = callback;\n          return events.others.subscribe((event) => {\n            const { others, ...internalEvent } = event;\n            return cb(others, internalEvent);\n          });\n        }\n        case \"error\":\n          return events.error.subscribe(callback);\n        case \"status\":\n          return events.status.subscribe(callback);\n        case \"lost-connection\":\n          return events.lostConnection.subscribe(\n            callback\n          );\n        case \"history\":\n          return events.history.subscribe(callback);\n        case \"storage-status\":\n          return events.storageStatus.subscribe(\n            callback\n          );\n        case \"comments\":\n          return events.comments.subscribe(\n            callback\n          );\n        default:\n          return assertNever(\n            first,\n            `\"${String(first)}\" is not a valid event name`\n          );\n      }\n    }\n    if (second === void 0 || typeof first === \"function\") {\n      if (typeof first === \"function\") {\n        const storageCallback = first;\n        return events.storageBatch.subscribe(storageCallback);\n      } else {\n        throw new Error(\"Please specify a listener callback\");\n      }\n    }\n    if (isLiveNode(first)) {\n      const node = first;\n      if (options?.isDeep) {\n        const storageCallback = second;\n        return subscribeToLiveStructureDeeply(node, storageCallback);\n      } else {\n        const nodeCallback = second;\n        return subscribeToLiveStructureShallowly(node, nodeCallback);\n      }\n    }\n    throw new Error(\n      `${String(first)} is not a value that can be subscribed to.`\n    );\n  }\n  return subscribe;\n}\nfunction isRoomEventName(value) {\n  return value === \"my-presence\" || value === \"others\" || value === \"event\" || value === \"error\" || value === \"history\" || value === \"status\" || value === \"storage-status\" || value === \"lost-connection\" || value === \"connection\" || value === \"comments\";\n}\nfunction makeAuthDelegateForRoom(roomId, authManager) {\n  return async () => {\n    return authManager.getAuthValue({ requestedScope: \"room:read\", roomId });\n  };\n}\nfunction makeCreateSocketDelegateForRoom(roomId, baseUrl, WebSocketPolyfill) {\n  return (authValue) => {\n    const ws = WebSocketPolyfill ?? (typeof WebSocket === \"undefined\" ? void 0 : WebSocket);\n    if (ws === void 0) {\n      throw new StopRetrying(\n        \"To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.\"\n      );\n    }\n    const url = new URL(baseUrl);\n    url.protocol = url.protocol === \"http:\" ? \"ws\" : \"wss\";\n    url.pathname = \"/v7\";\n    url.searchParams.set(\"roomId\", roomId);\n    if (authValue.type === \"secret\") {\n      url.searchParams.set(\"tok\", authValue.token.raw);\n    } else if (authValue.type === \"public\") {\n      url.searchParams.set(\"pubkey\", authValue.publicApiKey);\n    } else {\n      return assertNever(authValue, \"Unhandled case\");\n    }\n    url.searchParams.set(\"version\", PKG_VERSION || \"dev\");\n    return new ws(url.toString());\n  };\n}\n\n// src/store.ts\nfunction createClientStore() {\n  const store = createStore({\n    threads: {},\n    queries: {},\n    optimisticUpdates: [],\n    inboxNotifications: {},\n    notificationSettings: {}\n  });\n  const optimisticUpdatesEventSource = makeEventSource();\n  return {\n    ...store,\n    deleteThread(threadId) {\n      store.set((state) => {\n        return {\n          ...state,\n          threads: deleteKeyImmutable(state.threads, threadId),\n          inboxNotifications: Object.fromEntries(\n            Object.entries(state.inboxNotifications).filter(\n              ([_id, notification]) => notification.kind === \"thread\" && notification.threadId === threadId\n            )\n          )\n        };\n      });\n    },\n    updateThreadAndNotification(thread, inboxNotification) {\n      store.set((state) => {\n        const existingThread = state.threads[thread.id];\n        return {\n          ...state,\n          threads: existingThread === void 0 || compareThreads(thread, existingThread) === 1 ? { ...state.threads, [thread.id]: thread } : state.threads,\n          inboxNotifications: inboxNotification === void 0 ? state.inboxNotifications : {\n            ...state.inboxNotifications,\n            [inboxNotification.id]: inboxNotification\n          }\n        };\n      });\n    },\n    updateThreadsAndNotifications(threads, inboxNotifications, deletedThreads, deletedInboxNotifications, queryKey) {\n      store.set((state) => ({\n        ...state,\n        threads: applyThreadUpdates(state.threads, {\n          newThreads: threads,\n          deletedThreads\n        }),\n        inboxNotifications: applyNotificationsUpdates(\n          state.inboxNotifications,\n          {\n            newInboxNotifications: inboxNotifications,\n            deletedNotifications: deletedInboxNotifications\n          }\n        ),\n        queries: queryKey !== void 0 ? {\n          ...state.queries,\n          [queryKey]: { isLoading: false, data: void 0 }\n        } : state.queries\n      }));\n    },\n    updateRoomInboxNotificationSettings(roomId, settings, queryKey) {\n      store.set((state) => ({\n        ...state,\n        notificationSettings: {\n          ...state.notificationSettings,\n          [roomId]: settings\n        },\n        queries: {\n          ...state.queries,\n          [queryKey]: { isLoading: false, data: void 0 }\n        }\n      }));\n    },\n    pushOptimisticUpdate(optimisticUpdate) {\n      optimisticUpdatesEventSource.notify(optimisticUpdate);\n      store.set((state) => ({\n        ...state,\n        optimisticUpdates: [...state.optimisticUpdates, optimisticUpdate]\n      }));\n    },\n    setQueryState(queryKey, queryState) {\n      store.set((state) => ({\n        ...state,\n        queries: {\n          ...state.queries,\n          [queryKey]: queryState\n        }\n      }));\n    },\n    optimisticUpdatesEventSource\n  };\n}\nfunction deleteKeyImmutable(record, key) {\n  if (Object.prototype.hasOwnProperty.call(record, key)) {\n    const { [key]: _toDelete, ...rest } = record;\n    return rest;\n  }\n  return record;\n}\nfunction compareThreads(thread1, thread2) {\n  if (thread1.updatedAt && thread2.updatedAt) {\n    return thread1.updatedAt > thread2.updatedAt ? 1 : thread1.updatedAt < thread2.updatedAt ? -1 : 0;\n  } else if (thread1.updatedAt || thread2.updatedAt) {\n    return thread1.updatedAt ? 1 : -1;\n  }\n  if (thread1.createdAt > thread2.createdAt) {\n    return 1;\n  } else if (thread1.createdAt < thread2.createdAt) {\n    return -1;\n  }\n  return 0;\n}\nfunction applyOptimisticUpdates(state) {\n  const result = {\n    threads: {\n      ...state.threads\n    },\n    inboxNotifications: {\n      ...state.inboxNotifications\n    },\n    notificationSettings: {\n      ...state.notificationSettings\n    }\n  };\n  for (const optimisticUpdate of state.optimisticUpdates) {\n    switch (optimisticUpdate.type) {\n      case \"create-thread\": {\n        result.threads[optimisticUpdate.thread.id] = optimisticUpdate.thread;\n        break;\n      }\n      case \"edit-thread-metadata\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        if (thread.updatedAt !== void 0 && thread.updatedAt > optimisticUpdate.updatedAt) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          updatedAt: optimisticUpdate.updatedAt,\n          metadata: {\n            ...thread.metadata,\n            ...optimisticUpdate.metadata\n          }\n        };\n        break;\n      }\n      case \"mark-thread-as-resolved\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          resolved: true\n        };\n        break;\n      }\n      case \"mark-thread-as-unresolved\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        if (thread.deletedAt !== void 0) {\n          break;\n        }\n        result.threads[thread.id] = {\n          ...thread,\n          resolved: false\n        };\n        break;\n      }\n      case \"create-comment\": {\n        const thread = result.threads[optimisticUpdate.comment.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = upsertComment(\n          thread,\n          optimisticUpdate.comment\n        );\n        const inboxNotification = Object.values(result.inboxNotifications).find(\n          (notification) => notification.kind === \"thread\" && notification.threadId === thread.id\n        );\n        if (inboxNotification === void 0) {\n          break;\n        }\n        result.inboxNotifications[inboxNotification.id] = {\n          ...inboxNotification,\n          notifiedAt: optimisticUpdate.comment.createdAt,\n          readAt: optimisticUpdate.comment.createdAt\n        };\n        break;\n      }\n      case \"edit-comment\": {\n        const thread = result.threads[optimisticUpdate.comment.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = upsertComment(\n          thread,\n          optimisticUpdate.comment\n        );\n        break;\n      }\n      case \"delete-comment\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = deleteComment(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.deletedAt\n        );\n        break;\n      }\n      case \"delete-thread\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[optimisticUpdate.threadId] = {\n          ...result.threads[optimisticUpdate.threadId],\n          deletedAt: optimisticUpdate.deletedAt,\n          updatedAt: optimisticUpdate.deletedAt,\n          comments: []\n        };\n        break;\n      }\n      case \"add-reaction\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = addReaction(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.reaction\n        );\n        break;\n      }\n      case \"remove-reaction\": {\n        const thread = result.threads[optimisticUpdate.threadId];\n        if (thread === void 0) {\n          break;\n        }\n        result.threads[thread.id] = removeReaction(\n          thread,\n          optimisticUpdate.commentId,\n          optimisticUpdate.emoji,\n          optimisticUpdate.userId,\n          optimisticUpdate.removedAt\n        );\n        break;\n      }\n      case \"mark-inbox-notification-as-read\": {\n        result.inboxNotifications[optimisticUpdate.inboxNotificationId] = {\n          ...state.inboxNotifications[optimisticUpdate.inboxNotificationId],\n          readAt: optimisticUpdate.readAt\n        };\n        break;\n      }\n      case \"mark-all-inbox-notifications-as-read\": {\n        for (const id in result.inboxNotifications) {\n          result.inboxNotifications[id] = {\n            ...result.inboxNotifications[id],\n            readAt: optimisticUpdate.readAt\n          };\n        }\n        break;\n      }\n      case \"delete-inbox-notification\": {\n        const {\n          [optimisticUpdate.inboxNotificationId]: _,\n          ...inboxNotifications\n        } = result.inboxNotifications;\n        result.inboxNotifications = inboxNotifications;\n        break;\n      }\n      case \"delete-all-inbox-notifications\": {\n        result.inboxNotifications = {};\n        break;\n      }\n      case \"update-notification-settings\": {\n        result.notificationSettings[optimisticUpdate.roomId] = {\n          ...result.notificationSettings[optimisticUpdate.roomId],\n          ...optimisticUpdate.settings\n        };\n      }\n    }\n  }\n  return result;\n}\nfunction applyThreadUpdates(existingThreads, updates) {\n  const updatedThreads = { ...existingThreads };\n  updates.newThreads.forEach((thread) => {\n    const existingThread = updatedThreads[thread.id];\n    if (existingThread) {\n      const result = compareThreads(existingThread, thread);\n      if (result === 1) return;\n    }\n    updatedThreads[thread.id] = thread;\n  });\n  updates.deletedThreads.forEach(({ id, deletedAt }) => {\n    const existingThread = updatedThreads[id];\n    if (existingThread === void 0) return;\n    existingThread.deletedAt = deletedAt;\n    existingThread.updatedAt = deletedAt;\n    existingThread.comments = [];\n  });\n  return updatedThreads;\n}\nfunction applyNotificationsUpdates(existingInboxNotifications, updates) {\n  const updatedInboxNotifications = { ...existingInboxNotifications };\n  updates.newInboxNotifications.forEach((notification) => {\n    const existingNotification = updatedInboxNotifications[notification.id];\n    if (existingNotification) {\n      const result = compareInboxNotifications(\n        existingNotification,\n        notification\n      );\n      if (result === 1) return;\n    }\n    updatedInboxNotifications[notification.id] = notification;\n  });\n  updates.deletedNotifications.forEach(\n    ({ id }) => delete updatedInboxNotifications[id]\n  );\n  return updatedInboxNotifications;\n}\nfunction compareInboxNotifications(inboxNotificationA, inboxNotificationB) {\n  if (inboxNotificationA.notifiedAt > inboxNotificationB.notifiedAt) {\n    return 1;\n  } else if (inboxNotificationA.notifiedAt < inboxNotificationB.notifiedAt) {\n    return -1;\n  }\n  if (inboxNotificationA.readAt && inboxNotificationB.readAt) {\n    return inboxNotificationA.readAt > inboxNotificationB.readAt ? 1 : inboxNotificationA.readAt < inboxNotificationB.readAt ? -1 : 0;\n  } else if (inboxNotificationA.readAt || inboxNotificationB.readAt) {\n    return inboxNotificationA.readAt ? 1 : -1;\n  }\n  return 0;\n}\nfunction upsertComment(thread, comment) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  if (comment.threadId !== thread.id) {\n    warn(\n      `Comment ${comment.id} does not belong to thread ${thread.id}`\n    );\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (existingComment2) => existingComment2.id === comment.id\n  );\n  if (existingComment === void 0) {\n    const updatedAt = new Date(\n      Math.max(thread.updatedAt?.getTime() || 0, comment.createdAt.getTime())\n    );\n    const updatedThread = {\n      ...thread,\n      updatedAt,\n      comments: [...thread.comments, comment]\n    };\n    return updatedThread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  if (existingComment.editedAt === void 0 || comment.editedAt === void 0 || existingComment.editedAt <= comment.editedAt) {\n    const updatedComments = thread.comments.map(\n      (existingComment2) => existingComment2.id === comment.id ? comment : existingComment2\n    );\n    const updatedThread = {\n      ...thread,\n      updatedAt: new Date(\n        Math.max(\n          thread.updatedAt?.getTime() || 0,\n          comment.editedAt?.getTime() || comment.createdAt.getTime()\n        )\n      ),\n      comments: updatedComments\n    };\n    return updatedThread;\n  }\n  return thread;\n}\nfunction deleteComment(thread, commentId, deletedAt) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      deletedAt,\n      body: void 0\n    } : comment\n  );\n  if (!updatedComments.some((comment) => comment.deletedAt === void 0)) {\n    return {\n      ...thread,\n      deletedAt,\n      updatedAt: deletedAt,\n      comments: []\n    };\n  }\n  return {\n    ...thread,\n    updatedAt: deletedAt,\n    comments: updatedComments\n  };\n}\nfunction addReaction(thread, commentId, reaction) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      reactions: upsertReaction(comment.reactions, reaction)\n    } : comment\n  );\n  return {\n    ...thread,\n    updatedAt: new Date(\n      Math.max(reaction.createdAt.getTime(), thread.updatedAt?.getTime() || 0)\n    ),\n    comments: updatedComments\n  };\n}\nfunction removeReaction(thread, commentId, emoji, userId, removedAt) {\n  if (thread.deletedAt !== void 0) {\n    return thread;\n  }\n  const existingComment = thread.comments.find(\n    (comment) => comment.id === commentId\n  );\n  if (existingComment === void 0) {\n    return thread;\n  }\n  if (existingComment.deletedAt !== void 0) {\n    return thread;\n  }\n  const updatedComments = thread.comments.map(\n    (comment) => comment.id === commentId ? {\n      ...comment,\n      reactions: comment.reactions.map(\n        (reaction) => reaction.emoji === emoji ? {\n          ...reaction,\n          users: reaction.users.filter((user) => user.id !== userId)\n        } : reaction\n      ).filter((reaction) => reaction.users.length > 0)\n      // Remove reactions with no users left\n    } : comment\n  );\n  return {\n    ...thread,\n    updatedAt: new Date(\n      Math.max(removedAt.getTime(), thread.updatedAt?.getTime() || 0)\n    ),\n    comments: updatedComments\n  };\n}\nfunction upsertReaction(reactions, reaction) {\n  const existingReaction = reactions.find(\n    (existingReaction2) => existingReaction2.emoji === reaction.emoji\n  );\n  if (existingReaction === void 0) {\n    return [\n      ...reactions,\n      {\n        emoji: reaction.emoji,\n        createdAt: reaction.createdAt,\n        users: [{ id: reaction.userId }]\n      }\n    ];\n  }\n  if (existingReaction.users.some((user) => user.id === reaction.userId) === false) {\n    return reactions.map(\n      (existingReaction2) => existingReaction2.emoji === reaction.emoji ? {\n        ...existingReaction2,\n        users: [...existingReaction2.users, { id: reaction.userId }]\n      } : existingReaction2\n    );\n  }\n  return reactions;\n}\n\n// src/client.ts\nvar MIN_THROTTLE = 16;\nvar MAX_THROTTLE = 1e3;\nvar DEFAULT_THROTTLE = 100;\nvar MIN_BACKGROUND_KEEP_ALIVE_TIMEOUT = 15e3;\nvar MIN_LOST_CONNECTION_TIMEOUT = 200;\nvar RECOMMENDED_MIN_LOST_CONNECTION_TIMEOUT = 1e3;\nvar MAX_LOST_CONNECTION_TIMEOUT = 3e4;\nvar DEFAULT_LOST_CONNECTION_TIMEOUT = 5e3;\nvar RESOLVE_USERS_BATCH_DELAY = 50;\nvar RESOLVE_ROOMS_INFO_BATCH_DELAY = 50;\nfunction getBaseUrl(baseUrl) {\n  if (typeof baseUrl === \"string\" && baseUrl.startsWith(\"http\")) {\n    return baseUrl;\n  } else {\n    return DEFAULT_BASE_URL;\n  }\n}\nfunction getAuthBearerHeaderFromAuthValue(authValue) {\n  if (authValue.type === \"public\") {\n    return authValue.publicApiKey;\n  } else {\n    return authValue.token.raw;\n  }\n}\nfunction createClient(options) {\n  const clientOptions = options;\n  const throttleDelay = getThrottle(clientOptions.throttle ?? DEFAULT_THROTTLE);\n  const lostConnectionTimeout = getLostConnectionTimeout(\n    clientOptions.lostConnectionTimeout ?? DEFAULT_LOST_CONNECTION_TIMEOUT\n  );\n  const backgroundKeepAliveTimeout = getBackgroundKeepAliveTimeout(\n    clientOptions.backgroundKeepAliveTimeout\n  );\n  const baseUrl = getBaseUrl(clientOptions.baseUrl);\n  const authManager = createAuthManager(options);\n  const roomsById = /* @__PURE__ */ new Map();\n  function teardownRoom(room) {\n    unlinkDevTools(room.id);\n    roomsById.delete(room.id);\n    room.destroy();\n  }\n  function leaseRoom(details) {\n    const leave = () => {\n      const self = leave;\n      if (!details.unsubs.delete(self)) {\n        warn(\n          \"This leave function was already called. Calling it more than once has no effect.\"\n        );\n      } else {\n        if (details.unsubs.size === 0) {\n          teardownRoom(details.room);\n        }\n      }\n    };\n    details.unsubs.add(leave);\n    return {\n      room: details.room,\n      leave\n    };\n  }\n  function enterRoom(roomId, ...args) {\n    const existing = roomsById.get(roomId);\n    if (existing !== void 0) {\n      return leaseRoom(existing);\n    }\n    const options2 = args[0] ?? {};\n    const initialPresence = (typeof options2.initialPresence === \"function\" ? options2.initialPresence(roomId) : options2.initialPresence) ?? {};\n    const initialStorage = (typeof options2.initialStorage === \"function\" ? options2.initialStorage(roomId) : options2.initialStorage) ?? {};\n    const newRoom = createRoom(\n      { initialPresence, initialStorage },\n      {\n        roomId,\n        throttleDelay,\n        lostConnectionTimeout,\n        backgroundKeepAliveTimeout,\n        polyfills: clientOptions.polyfills,\n        delegates: clientOptions.mockedDelegates ?? {\n          createSocket: makeCreateSocketDelegateForRoom(\n            roomId,\n            baseUrl,\n            clientOptions.polyfills?.WebSocket\n          ),\n          authenticate: makeAuthDelegateForRoom(roomId, authManager)\n        },\n        enableDebugLogging: clientOptions.enableDebugLogging,\n        unstable_batchedUpdates: options2?.unstable_batchedUpdates,\n        baseUrl,\n        unstable_fallbackToHTTP: !!clientOptions.unstable_fallbackToHTTP,\n        unstable_streamData: !!clientOptions.unstable_streamData\n      }\n    );\n    const newRoomDetails = {\n      room: newRoom,\n      unsubs: /* @__PURE__ */ new Set()\n    };\n    roomsById.set(roomId, newRoomDetails);\n    setupDevTools(() => Array.from(roomsById.keys()));\n    linkDevTools(roomId, newRoom);\n    const shouldConnect = options2.autoConnect ?? true;\n    if (shouldConnect) {\n      if (typeof atob === \"undefined\") {\n        if (clientOptions.polyfills?.atob === void 0) {\n          throw new Error(\n            \"You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill\"\n          );\n        }\n        global.atob = clientOptions.polyfills.atob;\n      }\n      newRoom.connect();\n    }\n    return leaseRoom(newRoomDetails);\n  }\n  function getRoom(roomId) {\n    const room = roomsById.get(roomId)?.room;\n    return room ? room : null;\n  }\n  function logout() {\n    authManager.reset();\n    for (const { room } of roomsById.values()) {\n      if (!isIdle(room.getStatus())) {\n        room.reconnect();\n      }\n    }\n  }\n  const currentUserIdStore = createStore(null);\n  const {\n    getInboxNotifications,\n    getInboxNotificationsSince,\n    getUnreadInboxNotificationsCount,\n    markAllInboxNotificationsAsRead,\n    markInboxNotificationAsRead,\n    deleteAllInboxNotifications,\n    deleteInboxNotification\n  } = createNotificationsApi({\n    baseUrl,\n    fetcher: clientOptions.polyfills?.fetch || /* istanbul ignore next */\n    fetch,\n    authManager,\n    currentUserIdStore\n  });\n  const cacheStore = createClientStore();\n  const resolveUsers = clientOptions.resolveUsers;\n  const warnIfNoResolveUsers = createDevelopmentWarning(\n    () => !resolveUsers,\n    \"Set the resolveUsers option in createClient to specify user info.\"\n  );\n  const usersStore = createBatchStore(\n    async (batchedUserIds) => {\n      const userIds = batchedUserIds.flat();\n      const users = await resolveUsers?.({ userIds });\n      warnIfNoResolveUsers();\n      return users ?? userIds.map(() => void 0);\n    },\n    { delay: RESOLVE_USERS_BATCH_DELAY }\n  );\n  const resolveRoomsInfo = clientOptions.resolveRoomsInfo;\n  const warnIfNoResolveRoomsInfo = createDevelopmentWarning(\n    () => !resolveRoomsInfo,\n    \"Set the resolveRoomsInfo option in createClient to specify room info.\"\n  );\n  const roomsInfoStore = createBatchStore(\n    async (batchedRoomIds) => {\n      const roomIds = batchedRoomIds.flat();\n      const roomsInfo = await resolveRoomsInfo?.({ roomIds });\n      warnIfNoResolveRoomsInfo();\n      return roomsInfo ?? roomIds.map(() => void 0);\n    },\n    { delay: RESOLVE_ROOMS_INFO_BATCH_DELAY }\n  );\n  return Object.defineProperty(\n    {\n      enterRoom,\n      getRoom,\n      logout,\n      getInboxNotifications,\n      getInboxNotificationsSince,\n      getUnreadInboxNotificationsCount,\n      markAllInboxNotificationsAsRead,\n      markInboxNotificationAsRead,\n      deleteAllInboxNotifications,\n      deleteInboxNotification,\n      // Internal\n      [kInternal]: {\n        currentUserIdStore,\n        resolveMentionSuggestions: clientOptions.resolveMentionSuggestions,\n        cacheStore,\n        usersStore,\n        roomsInfoStore,\n        getRoomIds() {\n          return Array.from(roomsById.keys());\n        }\n      }\n    },\n    kInternal,\n    {\n      enumerable: false\n    }\n  );\n}\nvar NotificationsApiError = class extends Error {\n  constructor(message, status, details) {\n    super(message);\n    this.message = message;\n    this.status = status;\n    this.details = details;\n  }\n};\nfunction checkBounds(option, value, min, max, recommendedMin) {\n  if (typeof value !== \"number\" || value < min || max !== void 0 && value > max) {\n    throw new Error(\n      max !== void 0 ? `${option} should be between ${recommendedMin ?? min} and ${max}.` : `${option} should be at least ${recommendedMin ?? min}.`\n    );\n  }\n  return value;\n}\nfunction getBackgroundKeepAliveTimeout(value) {\n  if (value === void 0) return void 0;\n  return checkBounds(\n    \"backgroundKeepAliveTimeout\",\n    value,\n    MIN_BACKGROUND_KEEP_ALIVE_TIMEOUT\n  );\n}\nfunction getThrottle(value) {\n  return checkBounds(\"throttle\", value, MIN_THROTTLE, MAX_THROTTLE);\n}\nfunction getLostConnectionTimeout(value) {\n  return checkBounds(\n    \"lostConnectionTimeout\",\n    value,\n    MIN_LOST_CONNECTION_TIMEOUT,\n    MAX_LOST_CONNECTION_TIMEOUT,\n    RECOMMENDED_MIN_LOST_CONNECTION_TIMEOUT\n  );\n}\nfunction createDevelopmentWarning(condition, ...args) {\n  let hasWarned = false;\n  if (true) {\n    return () => {\n      if (!hasWarned && (typeof condition === \"function\" ? condition() : condition)) {\n        warn(...args);\n        hasWarned = true;\n      }\n    };\n  } else {}\n}\n\n// src/comments/comment-body.ts\nfunction isCommentBodyParagraph(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyText(element) {\n  return !(\"type\" in element) && \"text\" in element && typeof element.text === \"string\";\n}\nfunction isCommentBodyMention(element) {\n  return \"type\" in element && element.type === \"mention\";\n}\nfunction isCommentBodyLink(element) {\n  return \"type\" in element && element.type === \"link\";\n}\nvar commentBodyElementsGuards = {\n  paragraph: isCommentBodyParagraph,\n  text: isCommentBodyText,\n  link: isCommentBodyLink,\n  mention: isCommentBodyMention\n};\nvar commentBodyElementsTypes = {\n  paragraph: \"block\",\n  text: \"inline\",\n  link: \"inline\",\n  mention: \"inline\"\n};\nfunction traverseCommentBody(body, elementOrVisitor, possiblyVisitor) {\n  if (!body || !body?.content) {\n    return;\n  }\n  const element = typeof elementOrVisitor === \"string\" ? elementOrVisitor : void 0;\n  const type = element ? commentBodyElementsTypes[element] : \"all\";\n  const guard = element ? commentBodyElementsGuards[element] : () => true;\n  const visitor = typeof elementOrVisitor === \"function\" ? elementOrVisitor : possiblyVisitor;\n  for (const block of body.content) {\n    if (type === \"all\" || type === \"block\") {\n      if (guard(block)) {\n        visitor?.(block);\n      }\n    }\n    if (type === \"all\" || type === \"inline\") {\n      for (const inline of block.children) {\n        if (guard(inline)) {\n          visitor?.(inline);\n        }\n      }\n    }\n  }\n}\nfunction getMentionedIdsFromCommentBody(body) {\n  const mentionedIds = /* @__PURE__ */ new Set();\n  traverseCommentBody(\n    body,\n    \"mention\",\n    (mention) => mentionedIds.add(mention.id)\n  );\n  return Array.from(mentionedIds);\n}\nasync function resolveUsersInCommentBody(body, resolveUsers) {\n  const resolvedUsers = /* @__PURE__ */ new Map();\n  if (!resolveUsers) {\n    return resolvedUsers;\n  }\n  const userIds = getMentionedIdsFromCommentBody(body);\n  const users = await resolveUsers({\n    userIds\n  });\n  for (const [index, userId] of userIds.entries()) {\n    const user = users?.[index];\n    if (user) {\n      resolvedUsers.set(userId, user);\n    }\n  }\n  return resolvedUsers;\n}\nvar htmlEscapables = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&#39;\"\n};\nvar htmlEscapablesRegex = new RegExp(\n  Object.keys(htmlEscapables).map((entity) => `\\\\${entity}`).join(\"|\"),\n  \"g\"\n);\nfunction htmlSafe(value) {\n  return new HtmlSafeString([String(value)], []);\n}\nfunction joinHtml(strings) {\n  if (strings.length <= 0) {\n    return new HtmlSafeString([\"\"], []);\n  }\n  return new HtmlSafeString(\n    [\"\", ...Array(strings.length - 1).fill(\"\"), \"\"],\n    strings\n  );\n}\nfunction escapeHtml(value) {\n  if (value instanceof HtmlSafeString) {\n    return value.toString();\n  }\n  if (Array.isArray(value)) {\n    return joinHtml(value).toString();\n  }\n  return String(value).replace(\n    htmlEscapablesRegex,\n    (character) => htmlEscapables[character]\n  );\n}\nvar HtmlSafeString = class {\n  constructor(strings, values) {\n    this._strings = strings;\n    this._values = values;\n  }\n  toString() {\n    return this._strings.reduce((result, str, i) => {\n      return result + escapeHtml(nn(this._values[i - 1])) + str;\n    });\n  }\n};\nfunction html(strings, ...values) {\n  return new HtmlSafeString(strings, values);\n}\nvar markdownEscapables = {\n  _: \"\\\\_\",\n  \"*\": \"\\\\*\",\n  \"#\": \"\\\\#\",\n  \"`\": \"\\\\`\",\n  \"~\": \"\\\\~\",\n  \"!\": \"\\\\!\",\n  \"|\": \"\\\\|\",\n  \"(\": \"\\\\(\",\n  \")\": \"\\\\)\",\n  \"{\": \"\\\\{\",\n  \"}\": \"\\\\}\",\n  \"[\": \"\\\\[\",\n  \"]\": \"\\\\]\"\n};\nvar markdownEscapablesRegex = new RegExp(\n  Object.keys(markdownEscapables).map((entity) => `\\\\${entity}`).join(\"|\"),\n  \"g\"\n);\nfunction joinMarkdown(strings) {\n  if (strings.length <= 0) {\n    return new MarkdownSafeString([\"\"], []);\n  }\n  return new MarkdownSafeString(\n    [\"\", ...Array(strings.length - 1).fill(\"\"), \"\"],\n    strings\n  );\n}\nfunction escapeMarkdown(value) {\n  if (value instanceof MarkdownSafeString) {\n    return value.toString();\n  }\n  if (Array.isArray(value)) {\n    return joinMarkdown(value).toString();\n  }\n  return String(value).replace(\n    markdownEscapablesRegex,\n    (character) => markdownEscapables[character]\n  );\n}\nvar MarkdownSafeString = class {\n  constructor(strings, values) {\n    this._strings = strings;\n    this._values = values;\n  }\n  toString() {\n    return this._strings.reduce((result, str, i) => {\n      return result + escapeMarkdown(nn(this._values[i - 1])) + str;\n    });\n  }\n};\nfunction markdown(strings, ...values) {\n  return new MarkdownSafeString(strings, values);\n}\nfunction toAbsoluteUrl(url) {\n  if (url.startsWith(\"http://\") || url.startsWith(\"https://\")) {\n    return url;\n  } else if (url.startsWith(\"www.\")) {\n    return \"https://\" + url;\n  }\n  return;\n}\nvar stringifyCommentBodyPlainElements = {\n  paragraph: ({ children }) => children,\n  text: ({ element }) => element.text,\n  link: ({ element }) => element.text ?? element.url,\n  mention: ({ element, user }) => {\n    return `@${user?.name ?? element.id}`;\n  }\n};\nvar stringifyCommentBodyHtmlElements = {\n  paragraph: ({ children }) => {\n    return children ? html`<p>${htmlSafe(children)}</p>` : children;\n  },\n  text: ({ element }) => {\n    let children = element.text;\n    if (!children) {\n      return children;\n    }\n    if (element.bold) {\n      children = html`<strong>${children}</strong>`;\n    }\n    if (element.italic) {\n      children = html`<em>${children}</em>`;\n    }\n    if (element.strikethrough) {\n      children = html`<s>${children}</s>`;\n    }\n    if (element.code) {\n      children = html`<code>${children}</code>`;\n    }\n    return children;\n  },\n  link: ({ element, href }) => {\n    return html`<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${element.text ?? element.url}</a>`;\n  },\n  mention: ({ element, user }) => {\n    return html`<span data-mention>@${user?.name ?? element.id}</span>`;\n  }\n};\nvar stringifyCommentBodyMarkdownElements = {\n  paragraph: ({ children }) => {\n    return children;\n  },\n  text: ({ element }) => {\n    let children = element.text;\n    if (!children) {\n      return children;\n    }\n    if (element.bold) {\n      children = markdown`**${children}**`;\n    }\n    if (element.italic) {\n      children = markdown`_${children}_`;\n    }\n    if (element.strikethrough) {\n      children = markdown`~~${children}~~`;\n    }\n    if (element.code) {\n      children = markdown`\\`${children}\\``;\n    }\n    return children;\n  },\n  link: ({ element, href }) => {\n    return markdown`[${element.text ?? element.url}](${href})`;\n  },\n  mention: ({ element, user }) => {\n    return markdown`@${user?.name ?? element.id}`;\n  }\n};\nasync function stringifyCommentBody(body, options) {\n  const format = options?.format ?? \"plain\";\n  const separator = options?.separator ?? (format === \"markdown\" ? \"\\n\\n\" : \"\\n\");\n  const elements = {\n    ...format === \"html\" ? stringifyCommentBodyHtmlElements : format === \"markdown\" ? stringifyCommentBodyMarkdownElements : stringifyCommentBodyPlainElements,\n    ...options?.elements\n  };\n  const resolvedUsers = await resolveUsersInCommentBody(\n    body,\n    options?.resolveUsers\n  );\n  const blocks = body.content.flatMap((block, blockIndex) => {\n    switch (block.type) {\n      case \"paragraph\": {\n        const inlines = block.children.flatMap((inline, inlineIndex) => {\n          if (isCommentBodyMention(inline)) {\n            return inline.id ? [\n              elements.mention(\n                {\n                  element: inline,\n                  user: resolvedUsers.get(inline.id)\n                },\n                inlineIndex\n              )\n            ] : [];\n          }\n          if (isCommentBodyLink(inline)) {\n            return [\n              elements.link(\n                {\n                  element: inline,\n                  href: toAbsoluteUrl(inline.url) ?? inline.url\n                },\n                inlineIndex\n              )\n            ];\n          }\n          if (isCommentBodyText(inline)) {\n            return [elements.text({ element: inline }, inlineIndex)];\n          }\n          return [];\n        });\n        return [\n          elements.paragraph(\n            { element: block, children: inlines.join(\"\") },\n            blockIndex\n          )\n        ];\n      }\n      default:\n        return [];\n    }\n  });\n  return blocks.join(separator);\n}\n\n// src/crdts/utils.ts\nfunction toPlainLson(lson) {\n  if (lson instanceof LiveObject) {\n    return {\n      liveblocksType: \"LiveObject\",\n      data: Object.fromEntries(\n        Object.entries(lson.toObject()).flatMap(\n          ([key, value]) => value !== void 0 ? [[key, toPlainLson(value)]] : []\n        )\n      )\n    };\n  } else if (lson instanceof LiveMap) {\n    return {\n      liveblocksType: \"LiveMap\",\n      data: Object.fromEntries(\n        [...lson].map(([key, value]) => [key, toPlainLson(value)])\n      )\n    };\n  } else if (lson instanceof LiveList) {\n    return {\n      liveblocksType: \"LiveList\",\n      data: [...lson].map((item) => toPlainLson(item))\n    };\n  } else {\n    return lson;\n  }\n}\n\n// src/immutable.ts\nfunction lsonObjectToJson(obj) {\n  const result = {};\n  for (const key in obj) {\n    const val = obj[key];\n    if (val !== void 0) {\n      result[key] = lsonToJson(val);\n    }\n  }\n  return result;\n}\nfunction liveObjectToJson(liveObject) {\n  return lsonObjectToJson(liveObject.toObject());\n}\nfunction liveMapToJson(map) {\n  const result = {};\n  for (const [key, value] of map.entries()) {\n    result[key] = lsonToJson(value);\n  }\n  return result;\n}\nfunction lsonListToJson(value) {\n  return value.map(lsonToJson);\n}\nfunction liveListToJson(value) {\n  return lsonListToJson(value.toArray());\n}\nfunction lsonToJson(value) {\n  if (value instanceof LiveObject) {\n    return liveObjectToJson(value);\n  } else if (value instanceof LiveList) {\n    return liveListToJson(value);\n  } else if (value instanceof LiveMap) {\n    return liveMapToJson(value);\n  } else if (value instanceof LiveRegister) {\n    return value.data;\n  }\n  if (Array.isArray(value)) {\n    return lsonListToJson(value);\n  } else if (isPlainObject(value)) {\n    return lsonObjectToJson(value);\n  }\n  return value;\n}\nfunction deepLiveify(value) {\n  if (Array.isArray(value)) {\n    return new LiveList(value.map(deepLiveify));\n  } else if (isPlainObject(value)) {\n    const init = {};\n    for (const key in value) {\n      const val = value[key];\n      if (val === void 0) {\n        continue;\n      }\n      init[key] = deepLiveify(val);\n    }\n    return new LiveObject(init);\n  } else {\n    return value;\n  }\n}\nfunction patchLiveList(liveList, prev, next) {\n  let i = 0;\n  let prevEnd = prev.length - 1;\n  let nextEnd = next.length - 1;\n  let prevNode = prev[0];\n  let nextNode = next[0];\n  outer: {\n    while (prevNode === nextNode) {\n      ++i;\n      if (i > prevEnd || i > nextEnd) {\n        break outer;\n      }\n      prevNode = prev[i];\n      nextNode = next[i];\n    }\n    prevNode = prev[prevEnd];\n    nextNode = next[nextEnd];\n    while (prevNode === nextNode) {\n      prevEnd--;\n      nextEnd--;\n      if (i > prevEnd || i > nextEnd) {\n        break outer;\n      }\n      prevNode = prev[prevEnd];\n      nextNode = next[nextEnd];\n    }\n  }\n  if (i > prevEnd) {\n    if (i <= nextEnd) {\n      while (i <= nextEnd) {\n        liveList.insert(deepLiveify(next[i]), i);\n        i++;\n      }\n    }\n  } else if (i > nextEnd) {\n    let localI = i;\n    while (localI <= prevEnd) {\n      liveList.delete(i);\n      localI++;\n    }\n  } else {\n    while (i <= prevEnd && i <= nextEnd) {\n      prevNode = prev[i];\n      nextNode = next[i];\n      const liveListNode = liveList.get(i);\n      if (isLiveObject(liveListNode) && isPlainObject(prevNode) && isPlainObject(nextNode)) {\n        patchLiveObject(liveListNode, prevNode, nextNode);\n      } else {\n        liveList.set(i, deepLiveify(nextNode));\n      }\n      i++;\n    }\n    while (i <= nextEnd) {\n      liveList.insert(deepLiveify(next[i]), i);\n      i++;\n    }\n    let localI = i;\n    while (localI <= prevEnd) {\n      liveList.delete(i);\n      localI++;\n    }\n  }\n}\nfunction patchLiveObjectKey(liveObject, key, prev, next) {\n  if (true) {\n    const nonSerializableValue = findNonSerializableValue(next);\n    if (nonSerializableValue) {\n      error2(\n        `New state path: '${nonSerializableValue.path}' value: '${String(\n          nonSerializableValue.value\n        )}' is not serializable.\nOnly serializable value can be synced with Liveblocks.`\n      );\n      return;\n    }\n  }\n  const value = liveObject.get(key);\n  if (next === void 0) {\n    liveObject.delete(key);\n  } else if (value === void 0) {\n    liveObject.set(key, deepLiveify(next));\n  } else if (prev === next) {\n    return;\n  } else if (isLiveList(value) && Array.isArray(prev) && Array.isArray(next)) {\n    patchLiveList(value, prev, next);\n  } else if (isLiveObject(value) && isPlainObject(prev) && isPlainObject(next)) {\n    patchLiveObject(value, prev, next);\n  } else {\n    liveObject.set(key, deepLiveify(next));\n  }\n}\nfunction patchLiveObject(root, prev, next) {\n  const updates = {};\n  for (const key in next) {\n    patchLiveObjectKey(root, key, prev[key], next[key]);\n  }\n  for (const key in prev) {\n    if (next[key] === void 0) {\n      root.delete(key);\n    }\n  }\n  if (Object.keys(updates).length > 0) {\n    root.update(updates);\n  }\n}\nfunction getParentsPath(node) {\n  const path = [];\n  while (node.parent.type === \"HasParent\") {\n    if (isLiveList(node.parent.node)) {\n      path.push(node.parent.node._indexOfPosition(node.parent.key));\n    } else {\n      path.push(node.parent.key);\n    }\n    node = node.parent.node;\n  }\n  return path;\n}\nfunction legacy_patchImmutableObject(state, updates) {\n  return updates.reduce(\n    (state2, update) => legacy_patchImmutableObjectWithUpdate(state2, update),\n    state\n  );\n}\nfunction legacy_patchImmutableObjectWithUpdate(state, update) {\n  const path = getParentsPath(update.node);\n  return legacy_patchImmutableNode(state, path, update);\n}\nfunction legacy_patchImmutableNode(state, path, update) {\n  const pathItem = path.pop();\n  if (pathItem === void 0) {\n    switch (update.type) {\n      case \"LiveObject\": {\n        if (!isJsonObject(state)) {\n          throw new Error(\n            \"Internal: received update on LiveObject but state was not an object\"\n          );\n        }\n        const newState = Object.assign({}, state);\n        for (const key in update.updates) {\n          if (update.updates[key]?.type === \"update\") {\n            const val = update.node.get(key);\n            if (val !== void 0) {\n              newState[key] = lsonToJson(val);\n            }\n          } else if (update.updates[key]?.type === \"delete\") {\n            delete newState[key];\n          }\n        }\n        return newState;\n      }\n      case \"LiveList\": {\n        if (!Array.isArray(state)) {\n          throw new Error(\n            \"Internal: received update on LiveList but state was not an array\"\n          );\n        }\n        let newState = state.map((x) => x);\n        for (const listUpdate of update.updates) {\n          if (listUpdate.type === \"set\") {\n            newState = newState.map(\n              (item, index) => index === listUpdate.index ? lsonToJson(listUpdate.item) : item\n            );\n          } else if (listUpdate.type === \"insert\") {\n            if (listUpdate.index === newState.length) {\n              newState.push(lsonToJson(listUpdate.item));\n            } else {\n              newState = [\n                ...newState.slice(0, listUpdate.index),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index)\n              ];\n            }\n          } else if (listUpdate.type === \"delete\") {\n            newState.splice(listUpdate.index, 1);\n          } else if (listUpdate.type === \"move\") {\n            if (listUpdate.previousIndex > listUpdate.index) {\n              newState = [\n                ...newState.slice(0, listUpdate.index),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index, listUpdate.previousIndex),\n                ...newState.slice(listUpdate.previousIndex + 1)\n              ];\n            } else {\n              newState = [\n                ...newState.slice(0, listUpdate.previousIndex),\n                ...newState.slice(\n                  listUpdate.previousIndex + 1,\n                  listUpdate.index + 1\n                ),\n                lsonToJson(listUpdate.item),\n                ...newState.slice(listUpdate.index + 1)\n              ];\n            }\n          }\n        }\n        return newState;\n      }\n      case \"LiveMap\": {\n        if (!isJsonObject(state)) {\n          throw new Error(\n            \"Internal: received update on LiveMap but state was not an object\"\n          );\n        }\n        const newState = Object.assign({}, state);\n        for (const key in update.updates) {\n          if (update.updates[key]?.type === \"update\") {\n            const value = update.node.get(key);\n            if (value !== void 0) {\n              newState[key] = lsonToJson(value);\n            }\n          } else if (update.updates[key]?.type === \"delete\") {\n            delete newState[key];\n          }\n        }\n        return newState;\n      }\n    }\n  }\n  if (Array.isArray(state)) {\n    const newArray = [...state];\n    newArray[pathItem] = legacy_patchImmutableNode(\n      state[pathItem],\n      path,\n      update\n    );\n    return newArray;\n  } else if (isJsonObject(state)) {\n    const node = state[pathItem];\n    if (node === void 0) {\n      return state;\n    } else {\n      const stateAsObj = state;\n      return {\n        ...stateAsObj,\n        [pathItem]: legacy_patchImmutableNode(node, path, update)\n      };\n    }\n  } else {\n    return state;\n  }\n}\n\n// src/lib/deprecation.ts\nvar _emittedDeprecationWarnings = /* @__PURE__ */ new Set();\nfunction deprecate(message, key = message) {\n  if (true) {\n    if (!_emittedDeprecationWarnings.has(key)) {\n      _emittedDeprecationWarnings.add(key);\n      errorWithTitle(\"Deprecation warning\", message);\n    }\n  }\n}\nfunction deprecateIf(condition, message, key = message) {\n  if (true) {\n    if (condition) {\n      deprecate(message, key);\n    }\n  }\n}\nfunction throwUsageError(message) {\n  if (true) {\n    const usageError = new Error(message);\n    usageError.name = \"Usage error\";\n    errorWithTitle(\"Usage error\", message);\n    throw usageError;\n  }\n}\nfunction errorIf(condition, message) {\n  if (true) {\n    if (condition) {\n      throwUsageError(message);\n    }\n  }\n}\n\n// src/lib/Poller.ts\nfunction makePoller(callback) {\n  let context = {\n    state: \"stopped\",\n    timeoutHandle: null,\n    interval: null,\n    lastScheduledAt: null,\n    remainingInterval: null\n  };\n  function poll() {\n    if (context.state === \"running\") {\n      schedule(context.interval);\n    }\n    void callback();\n  }\n  function schedule(interval) {\n    context = {\n      state: \"running\",\n      interval: context.state !== \"stopped\" ? context.interval : interval,\n      lastScheduledAt: performance.now(),\n      timeoutHandle: setTimeout(poll, interval),\n      remainingInterval: null\n    };\n  }\n  function scheduleRemaining(remaining) {\n    if (context.state !== \"paused\") {\n      return;\n    }\n    context = {\n      state: \"running\",\n      interval: context.interval,\n      lastScheduledAt: context.lastScheduledAt,\n      timeoutHandle: setTimeout(poll, remaining),\n      remainingInterval: null\n    };\n  }\n  function start(interval) {\n    if (context.state === \"running\") {\n      return;\n    }\n    schedule(interval);\n  }\n  function restart(interval) {\n    stop();\n    start(interval);\n  }\n  function pause() {\n    if (context.state !== \"running\") {\n      return;\n    }\n    clearTimeout(context.timeoutHandle);\n    context = {\n      state: \"paused\",\n      interval: context.interval,\n      lastScheduledAt: context.lastScheduledAt,\n      timeoutHandle: null,\n      remainingInterval: context.interval - (performance.now() - context.lastScheduledAt)\n    };\n  }\n  function resume() {\n    if (context.state !== \"paused\") {\n      return;\n    }\n    scheduleRemaining(context.remainingInterval);\n  }\n  function stop() {\n    if (context.state === \"stopped\") {\n      return;\n    }\n    if (context.timeoutHandle) {\n      clearTimeout(context.timeoutHandle);\n    }\n    context = {\n      state: \"stopped\",\n      interval: null,\n      lastScheduledAt: null,\n      timeoutHandle: null,\n      remainingInterval: null\n    };\n  }\n  return {\n    start,\n    restart,\n    pause,\n    resume,\n    stop\n  };\n}\n\n// src/lib/shallow.ts\nfunction shallowArray(xs, ys) {\n  if (xs.length !== ys.length) {\n    return false;\n  }\n  for (let i = 0; i < xs.length; i++) {\n    if (!Object.is(xs[i], ys[i])) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction shallowObj(objA, objB) {\n  if (typeof objA !== \"object\" || objA === null || typeof objB !== \"object\" || objB === null || Object.prototype.toString.call(objA) !== \"[object Object]\" || Object.prototype.toString.call(objB) !== \"[object Object]\") {\n    return false;\n  }\n  const keysA = Object.keys(objA);\n  if (keysA.length !== Object.keys(objB).length) {\n    return false;\n  }\n  return keysA.every(\n    (key) => Object.prototype.hasOwnProperty.call(objB, key) && Object.is(objA[key], objB[key])\n  );\n}\nfunction shallow(a, b) {\n  if (Object.is(a, b)) {\n    return true;\n  }\n  const isArrayA = Array.isArray(a);\n  const isArrayB = Array.isArray(b);\n  if (isArrayA || isArrayB) {\n    if (!isArrayA || !isArrayB) {\n      return false;\n    }\n    return shallowArray(a, b);\n  }\n  return shallowObj(a, b);\n}\n\n// src/index.ts\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvY29yZS9kaXN0L2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsa0NBQWtDO0FBQ2hFOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sS0FBcUMsRUFBRSxFQUUxQyxDQUFDO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxxQkFBcUIsR0FBRyxVQUFVO0FBQ3hFO0FBQ0E7QUFDQSxJQUFJO0FBQ0osSUFBSTtBQUNKO0FBQ0EscUdBQXFHLGtCQUFrQjtBQUN2SDtBQUNBO0FBQ0EsV0FBVyxTQUFTLEVBQUUsVUFBVTtBQUNoQyxXQUFXLFNBQVMsRUFBRSxjQUFjO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRix3QkFBd0I7QUFDM0c7QUFDQTtBQUNBLGFBQWEsVUFBVSxRQUFRLFlBQVk7QUFDM0MsYUFBYSxTQUFTLFFBQVEsV0FBVztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsZ0NBQWdDLHFCQUFxQixXQUFXLGdCQUFnQix1QkFBdUIsZ0JBQWdCO0FBQ3ZIO0FBQ0E7QUFDQSwwQ0FBMEMsYUFBb0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsYUFBb0I7QUFDOUQ7QUFDQTtBQUNBLHdCQUF3QixNQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlCQUFpQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGtCQUFrQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGVBQWU7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLHdCQUF3QjtBQUN0RDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw2QkFBNkI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLDhCQUE4QjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxLQUFLLFFBQVEsU0FBUyxVQUFVLGNBQWM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixlQUFlO0FBQ3pDLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFlBQVk7QUFDbEM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QywyQkFBMkI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsMEJBQTBCO0FBQzVFO0FBQ0EsMENBQTBDLCtCQUErQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHFCQUFxQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsMkJBQTJCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFTLEdBQUcsZUFBZTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxNQUFxQztBQUMzQztBQUNBO0FBQ0EsZ0JBQWdCLHdEQUF3RDtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE1BQU0sTUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDJCQUEyQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSw0R0FBNEcsYUFBYSxZQUFZLGVBQWU7QUFDcEo7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsaUJBQWlCO0FBQ3JEO0FBQ0Esb0NBQW9DLGdDQUFnQztBQUNwRSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxTQUFTO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDRDQUE0QztBQUM3RTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxRQUFRO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQ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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGdCQUFnQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscUJBQXFCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGtCQUFrQixJQUFJO0FBQzVELFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isb0JBQW9CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9CQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFCQUFxQjtBQUNqQztBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwrQkFBK0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFCQUFxQjtBQUNqQztBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtCQUErQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsTUFBTSxtQ0FBbUMsbUJBQW1CO0FBQzFHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVywrQkFBK0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxNQUFNLG1DQUFtQyx1QkFBdUI7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxNQUFNLG1DQUFtQyx1QkFBdUI7QUFDM0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsTUFBcUMsR0FBRyxDQUFNO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0EsYUFBYSxNQUFxQztBQUNsRDtBQUNBLEVBQUUsQ0FBUTtBQUNWOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksc0JBQXNCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLFFBQVE7QUFDUixpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixtQkFBbUIsK0JBQStCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLGVBQWU7QUFDaEM7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFNBQVM7QUFDNUIsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELCtCQUErQjtBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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Q0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBFQUEwRSxxQkFBcUIsT0FBTyxHQUFHLEtBQUs7QUFDOUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxNQUFxQyxHQUFHLENBQU07QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU8sR0FBRyxTQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLE9BQU8sc0JBQXNCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU07QUFDbkM7QUFDQTtBQUNBO0FBQ0EsY0FBYyxJQUFJLEdBQUcsMEJBQTBCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHFCQUFxQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVSx5QkFBeUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGFBQWEsR0FBRyxRQUFRO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxrQkFBa0I7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixJQUFxQztBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEVBQUUsZ0NBQWdDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxlQUFlO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxZQUFZLG9CQUFvQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsOENBQThDO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sc0JBQXNCLCtCQUErQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixhQUFhO0FBQ3BDO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsbUJBQW1CO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRUFBcUUsTUFBTTtBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNB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QTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDRCQUE0QjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILG9DQUFvQyxlQUFlO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsT0FBTyxJQUFJO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVksNEJBQTRCLFVBQVU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixxQkFBcUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMscUJBQXFCO0FBQ25FLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUNBQWlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLE9BQU87QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxTQUFTO0FBQ3BEO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxTQUFTO0FBQzVEO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Q0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQXFDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwwQkFBMEIsWUFBWTtBQUNsRTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQXFDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBcUM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQXFDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixlQUFlO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQWlFRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3MvY29yZS9kaXN0L2luZGV4Lm1qcz83MmQzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7XG52YXIgX19leHBvcnQgPSAodGFyZ2V0LCBhbGwpID0+IHtcbiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpXG4gICAgX19kZWZQcm9wKHRhcmdldCwgbmFtZSwgeyBnZXQ6IGFsbFtuYW1lXSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbn07XG5cbi8vIHNyYy92ZXJzaW9uLnRzXG52YXIgUEtHX05BTUUgPSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcbnZhciBQS0dfVkVSU0lPTiA9IFwiMi40LjBcIjtcbnZhciBQS0dfRk9STUFUID0gXCJlc21cIjtcblxuLy8gc3JjL2R1cGUtZGV0ZWN0aW9uLnRzXG52YXIgZyA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDoge307XG52YXIgY3Jvc3NMaW5rZWREb2NzID0gXCJodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvY3Jvc3MtbGlua2VkXCI7XG52YXIgZHVwZXNEb2NzID0gXCJodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvZHVwZXNcIjtcbnZhciBTUEFDRSA9IFwiIFwiO1xuZnVuY3Rpb24gZXJyb3IobXNnKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBjb25zb2xlLmVycm9yKG1zZyk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gIH1cbn1cbmZ1bmN0aW9uIGRldGVjdER1cGVzKHBrZ05hbWUsIHBrZ1ZlcnNpb24sIHBrZ0Zvcm1hdCkge1xuICBjb25zdCBwa2dJZCA9IFN5bWJvbC5mb3IocGtnTmFtZSk7XG4gIGNvbnN0IHBrZ0J1aWxkSW5mbyA9IHBrZ0Zvcm1hdCA/IGAke3BrZ1ZlcnNpb24gfHwgXCJkZXZcIn0gKCR7cGtnRm9ybWF0fSlgIDogcGtnVmVyc2lvbiB8fCBcImRldlwiO1xuICBpZiAoIWdbcGtnSWRdKSB7XG4gICAgZ1twa2dJZF0gPSBwa2dCdWlsZEluZm87XG4gIH0gZWxzZSBpZiAoZ1twa2dJZF0gPT09IHBrZ0J1aWxkSW5mbykge1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IG1zZyA9IFtcbiAgICAgIGBNdWx0aXBsZSBjb3BpZXMgb2YgTGl2ZWJsb2NrcyBhcmUgYmVpbmcgbG9hZGVkIGluIHlvdXIgcHJvamVjdC4gVGhpcyB3aWxsIGNhdXNlIGlzc3VlcyEgU2VlICR7ZHVwZXNEb2NzICsgU1BBQ0V9YCxcbiAgICAgIFwiXCIsXG4gICAgICBcIkNvbmZsaWN0czpcIixcbiAgICAgIGAtICR7cGtnTmFtZX0gJHtnW3BrZ0lkXX0gKGFscmVhZHkgbG9hZGVkKWAsXG4gICAgICBgLSAke3BrZ05hbWV9ICR7cGtnQnVpbGRJbmZvfSAodHJ5aW5nIHRvIGxvYWQgdGhpcyBub3cpYFxuICAgIF0uam9pbihcIlxcblwiKTtcbiAgICBlcnJvcihtc2cpO1xuICB9XG4gIGlmIChwa2dWZXJzaW9uICYmIFBLR19WRVJTSU9OICYmIHBrZ1ZlcnNpb24gIT09IFBLR19WRVJTSU9OKSB7XG4gICAgZXJyb3IoXG4gICAgICBbXG4gICAgICAgIGBDcm9zcy1saW5rZWQgdmVyc2lvbnMgb2YgTGl2ZWJsb2NrcyBmb3VuZCwgd2hpY2ggd2lsbCBjYXVzZSBpc3N1ZXMhIFNlZSAke2Nyb3NzTGlua2VkRG9jcyArIFNQQUNFfWAsXG4gICAgICAgIFwiXCIsXG4gICAgICAgIFwiQ29uZmxpY3RzOlwiLFxuICAgICAgICBgLSAke1BLR19OQU1FfSBpcyBhdCAke1BLR19WRVJTSU9OfWAsXG4gICAgICAgIGAtICR7cGtnTmFtZX0gaXMgYXQgJHtwa2dWZXJzaW9ufWAsXG4gICAgICAgIFwiXCIsXG4gICAgICAgIFwiQWx3YXlzIHVwZ3JhZGUgYWxsIExpdmVibG9ja3MgcGFja2FnZXMgdG8gdGhlIHNhbWUgdmVyc2lvbiBudW1iZXIuXCJcbiAgICAgIF0uam9pbihcIlxcblwiKVxuICAgICk7XG4gIH1cbn1cblxuLy8gc3JjL2xpYi9hc3NlcnQudHNcbmZ1bmN0aW9uIGFzc2VydE5ldmVyKF92YWx1ZSwgZXJybXNnKSB7XG4gIHRocm93IG5ldyBFcnJvcihlcnJtc2cpO1xufVxuZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgZXJybXNnKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBpZiAoIWNvbmRpdGlvbikge1xuICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKGVycm1zZyk7XG4gICAgICBlcnIubmFtZSA9IFwiQXNzZXJ0aW9uIGZhaWx1cmVcIjtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIG5uKHZhbHVlLCBlcnJtc2cgPSBcIkV4cGVjdGVkIHZhbHVlIHRvIGJlIG5vbi1udWxsYWJsZVwiKSB7XG4gIGFzc2VydCh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwLCBlcnJtc2cpO1xuICByZXR1cm4gdmFsdWU7XG59XG5cbi8vIHNyYy9saWIvY29udHJvbGxlZFByb21pc2UudHNcbmZ1bmN0aW9uIGNvbnRyb2xsZWRQcm9taXNlKCkge1xuICBsZXQgcmVzb2x2ZTtcbiAgbGV0IHJlamVjdDtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgIHJlc29sdmUgPSByZXM7XG4gICAgcmVqZWN0ID0gcmVqO1xuICB9KTtcbiAgcmV0dXJuIFtwcm9taXNlLCByZXNvbHZlLCByZWplY3RdO1xufVxuZnVuY3Rpb24gUHJvbWlzZV93aXRoUmVzb2x2ZXJzKCkge1xuICBjb25zdCBbcHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0XSA9IGNvbnRyb2xsZWRQcm9taXNlKCk7XG4gIHJldHVybiB7IHByb21pc2UsIHJlc29sdmUsIHJlamVjdCB9O1xufVxuXG4vLyBzcmMvbGliL0V2ZW50U291cmNlLnRzXG5mdW5jdGlvbiBtYWtlRXZlbnRTb3VyY2UoKSB7XG4gIGNvbnN0IF9vbmV0aW1lT2JzZXJ2ZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgY29uc3QgX29ic2VydmVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gIGxldCBfYnVmZmVyID0gbnVsbDtcbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgX2J1ZmZlciA9IFtdO1xuICB9XG4gIGZ1bmN0aW9uIHVucGF1c2UoKSB7XG4gICAgaWYgKF9idWZmZXIgPT09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBfYnVmZmVyKSB7XG4gICAgICBub3RpZnkoZXZlbnQpO1xuICAgIH1cbiAgICBfYnVmZmVyID0gbnVsbDtcbiAgfVxuICBmdW5jdGlvbiBzdWJzY3JpYmUoY2FsbGJhY2spIHtcbiAgICBfb2JzZXJ2ZXJzLmFkZChjYWxsYmFjayk7XG4gICAgcmV0dXJuICgpID0+IF9vYnNlcnZlcnMuZGVsZXRlKGNhbGxiYWNrKTtcbiAgfVxuICBmdW5jdGlvbiBzdWJzY3JpYmVPbmNlKGNhbGxiYWNrKSB7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuYWRkKGNhbGxiYWNrKTtcbiAgICByZXR1cm4gKCkgPT4gX29uZXRpbWVPYnNlcnZlcnMuZGVsZXRlKGNhbGxiYWNrKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiB3YWl0VW50aWwocHJlZGljYXRlKSB7XG4gICAgbGV0IHVuc3ViO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzKSA9PiB7XG4gICAgICB1bnN1YiA9IHN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKHByZWRpY2F0ZSA9PT0gdm9pZCAwIHx8IHByZWRpY2F0ZShldmVudCkpIHtcbiAgICAgICAgICByZXMoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KS5maW5hbGx5KCgpID0+IHVuc3ViPy4oKSk7XG4gIH1cbiAgZnVuY3Rpb24gbm90aWZ5T3JCdWZmZXIoZXZlbnQpIHtcbiAgICBpZiAoX2J1ZmZlciAhPT0gbnVsbCkge1xuICAgICAgX2J1ZmZlci5wdXNoKGV2ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm90aWZ5KGV2ZW50KTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gbm90aWZ5KGV2ZW50KSB7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuZm9yRWFjaCgoY2FsbGJhY2spID0+IGNhbGxiYWNrKGV2ZW50KSk7XG4gICAgX29uZXRpbWVPYnNlcnZlcnMuY2xlYXIoKTtcbiAgICBfb2JzZXJ2ZXJzLmZvckVhY2goKGNhbGxiYWNrKSA9PiBjYWxsYmFjayhldmVudCkpO1xuICB9XG4gIGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIF9vbmV0aW1lT2JzZXJ2ZXJzLmNsZWFyKCk7XG4gICAgX29ic2VydmVycy5jbGVhcigpO1xuICB9XG4gIGZ1bmN0aW9uIGNvdW50KCkge1xuICAgIHJldHVybiBfb25ldGltZU9ic2VydmVycy5zaXplICsgX29ic2VydmVycy5zaXplO1xuICB9XG4gIHJldHVybiB7XG4gICAgLy8gUHJpdmF0ZS9pbnRlcm5hbCBjb250cm9sIG92ZXIgZXZlbnQgZW1pc3Npb25cbiAgICBub3RpZnk6IG5vdGlmeU9yQnVmZmVyLFxuICAgIHN1YnNjcmliZSxcbiAgICBzdWJzY3JpYmVPbmNlLFxuICAgIGNsZWFyLFxuICAgIGNvdW50LFxuICAgIHdhaXRVbnRpbCxcbiAgICBwYXVzZSxcbiAgICB1bnBhdXNlLFxuICAgIC8vIFB1YmxpY2x5IGV4cG9zYWJsZSBzdWJzY3JpcHRpb24gQVBJXG4gICAgb2JzZXJ2YWJsZToge1xuICAgICAgc3Vic2NyaWJlLFxuICAgICAgc3Vic2NyaWJlT25jZSxcbiAgICAgIHdhaXRVbnRpbFxuICAgIH1cbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9mYW5jeS1jb25zb2xlLnRzXG52YXIgZmFuY3lfY29uc29sZV9leHBvcnRzID0ge307XG5fX2V4cG9ydChmYW5jeV9jb25zb2xlX2V4cG9ydHMsIHtcbiAgZXJyb3I6ICgpID0+IGVycm9yMixcbiAgZXJyb3JXaXRoVGl0bGU6ICgpID0+IGVycm9yV2l0aFRpdGxlLFxuICB3YXJuOiAoKSA9PiB3YXJuLFxuICB3YXJuV2l0aFRpdGxlOiAoKSA9PiB3YXJuV2l0aFRpdGxlXG59KTtcbnZhciBiYWRnZSA9IFwiYmFja2dyb3VuZDojMGUwZDEyO2JvcmRlci1yYWRpdXM6OTk5OXB4O2NvbG9yOiNmZmY7cGFkZGluZzozcHggN3B4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6NjAwO1wiO1xudmFyIGJvbGQgPSBcImZvbnQtd2VpZ2h0OjYwMFwiO1xuZnVuY3Rpb24gd3JhcChtZXRob2QpIHtcbiAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiID8gY29uc29sZVttZXRob2RdIDogKFxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgKG1lc3NhZ2UsIC4uLmFyZ3MpID0+IGNvbnNvbGVbbWV0aG9kXShcIiVjTGl2ZWJsb2Nrc1wiLCBiYWRnZSwgbWVzc2FnZSwgLi4uYXJncylcbiAgKTtcbn1cbnZhciB3YXJuID0gd3JhcChcIndhcm5cIik7XG52YXIgZXJyb3IyID0gd3JhcChcImVycm9yXCIpO1xuZnVuY3Rpb24gd3JhcFdpdGhUaXRsZShtZXRob2QpIHtcbiAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiID8gY29uc29sZVttZXRob2RdIDogKFxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgKHRpdGxlLCBtZXNzYWdlLCAuLi5hcmdzKSA9PiBjb25zb2xlW21ldGhvZF0oXG4gICAgICBgJWNMaXZlYmxvY2tzJWMgJHt0aXRsZX1gLFxuICAgICAgYmFkZ2UsXG4gICAgICBib2xkLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIC4uLmFyZ3NcbiAgICApXG4gICk7XG59XG52YXIgd2FybldpdGhUaXRsZSA9IHdyYXBXaXRoVGl0bGUoXCJ3YXJuXCIpO1xudmFyIGVycm9yV2l0aFRpdGxlID0gd3JhcFdpdGhUaXRsZShcImVycm9yXCIpO1xuXG4vLyBzcmMvbGliL2ZzbS50c1xuZnVuY3Rpb24gZGlzdGFuY2Uoc3RhdGUxLCBzdGF0ZTIpIHtcbiAgaWYgKHN0YXRlMSA9PT0gc3RhdGUyKSB7XG4gICAgcmV0dXJuIFswLCAwXTtcbiAgfVxuICBjb25zdCBjaHVua3MxID0gc3RhdGUxLnNwbGl0KFwiLlwiKTtcbiAgY29uc3QgY2h1bmtzMiA9IHN0YXRlMi5zcGxpdChcIi5cIik7XG4gIGNvbnN0IG1pbkxlbiA9IE1hdGgubWluKGNodW5rczEubGVuZ3RoLCBjaHVua3MyLmxlbmd0aCk7XG4gIGxldCBzaGFyZWQgPSAwO1xuICBmb3IgKDsgc2hhcmVkIDwgbWluTGVuOyBzaGFyZWQrKykge1xuICAgIGlmIChjaHVua3MxW3NoYXJlZF0gIT09IGNodW5rczJbc2hhcmVkXSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIGNvbnN0IHVwID0gY2h1bmtzMS5sZW5ndGggLSBzaGFyZWQ7XG4gIGNvbnN0IGRvd24gPSBjaHVua3MyLmxlbmd0aCAtIHNoYXJlZDtcbiAgcmV0dXJuIFt1cCwgZG93bl07XG59XG5mdW5jdGlvbiBwYXR0ZXJucyh0YXJnZXRTdGF0ZSwgbGV2ZWxzKSB7XG4gIGNvbnN0IHBhcnRzID0gdGFyZ2V0U3RhdGUuc3BsaXQoXCIuXCIpO1xuICBpZiAobGV2ZWxzIDwgMSB8fCBsZXZlbHMgPiBwYXJ0cy5sZW5ndGggKyAxKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBudW1iZXIgb2YgbGV2ZWxzXCIpO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBpZiAobGV2ZWxzID4gcGFydHMubGVuZ3RoKSB7XG4gICAgcmVzdWx0LnB1c2goXCIqXCIpO1xuICB9XG4gIGZvciAobGV0IGkgPSBwYXJ0cy5sZW5ndGggLSBsZXZlbHMgKyAxOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBzbGljZSA9IHBhcnRzLnNsaWNlKDAsIGkpO1xuICAgIGlmIChzbGljZS5sZW5ndGggPiAwKSB7XG4gICAgICByZXN1bHQucHVzaChzbGljZS5qb2luKFwiLlwiKSArIFwiLipcIik7XG4gICAgfVxuICB9XG4gIHJlc3VsdC5wdXNoKHRhcmdldFN0YXRlKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbnZhciBTYWZlQ29udGV4dCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaW5pdGlhbENvbnRleHQpIHtcbiAgICB0aGlzLmN1cnIgPSBpbml0aWFsQ29udGV4dDtcbiAgfVxuICBnZXQgY3VycmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyO1xuICB9XG4gIC8qKlxuICAgKiBDYWxsIGEgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBhbGxvd3MgcGF0Y2hpbmcgb2YgdGhlIGNvbnRleHQsIGJ5XG4gICAqIGNhbGxpbmcgYGNvbnRleHQucGF0Y2goKWAuIFBhdGNoaW5nIGlzIG9ubHkgYWxsb3dlZCBmb3IgdGhlIGR1cmF0aW9uXG4gICAqIG9mIHRoaXMgd2luZG93LlxuICAgKi9cbiAgYWxsb3dQYXRjaGluZyhjYWxsYmFjaykge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBhbGxvd2VkID0gdHJ1ZTtcbiAgICBjb25zdCBwYXRjaGFibGVDb250ZXh0ID0ge1xuICAgICAgLi4udGhpcy5jdXJyLFxuICAgICAgcGF0Y2gocGF0Y2gpIHtcbiAgICAgICAgaWYgKGFsbG93ZWQpIHtcbiAgICAgICAgICBzZWxmLmN1cnIgPSBPYmplY3QuYXNzaWduKHt9LCBzZWxmLmN1cnIsIHBhdGNoKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhaXIgb2YgT2JqZWN0LmVudHJpZXMocGF0Y2gpKSB7XG4gICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBwYWlyO1xuICAgICAgICAgICAgaWYgKGtleSAhPT0gXCJwYXRjaFwiKSB7XG4gICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4gbm8gbG9uZ2VyIHBhdGNoIHN0YWxlIGNvbnRleHRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGNhbGxiYWNrKHBhdGNoYWJsZUNvbnRleHQpO1xuICAgIGFsbG93ZWQgPSBmYWxzZTtcbiAgICByZXR1cm47XG4gIH1cbn07XG52YXIgbmV4dElkID0gMTtcbnZhciBGU00gPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbml0aWFsIHN0YXRlLCB3aGljaCBpcyBkZWZpbmVkIGJ5IHRoZSBmaXJzdCBjYWxsIG1hZGUgdG9cbiAgICogLmFkZFN0YXRlKCkuXG4gICAqL1xuICBnZXQgaW5pdGlhbFN0YXRlKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuc3RhdGVzLnZhbHVlcygpW1N5bWJvbC5pdGVyYXRvcl0oKS5uZXh0KCk7XG4gICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBzdGF0ZXMgZGVmaW5lZCB5ZXRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXN1bHQudmFsdWU7XG4gICAgfVxuICB9XG4gIGdldCBjdXJyZW50U3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID09PSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgPT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBzdGFydGVkIHlldFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgc3RvcHBlZFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsO1xuICB9XG4gIC8qKlxuICAgKiBTdGFydHMgdGhlIG1hY2hpbmUgYnkgZW50ZXJpbmcgdGhlIGluaXRpYWwgc3RhdGUuXG4gICAqL1xuICBzdGFydCgpIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgIT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdGF0ZSBtYWNoaW5lIGhhcyBhbHJlYWR5IHN0YXJ0ZWRcIik7XG4gICAgfVxuICAgIHRoaXMucnVubmluZ1N0YXRlID0gMSAvKiBTVEFSVEVEICovO1xuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gdGhpcy5pbml0aWFsU3RhdGU7XG4gICAgdGhpcy5lbnRlcihudWxsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKipcbiAgICogU3RvcHMgdGhlIHN0YXRlIG1hY2hpbmUuIFN0b3BwaW5nIHRoZSBzdGF0ZSBtYWNoaW5lIHdpbGwgY2FsbCBleGl0XG4gICAqIGhhbmRsZXJzIGZvciB0aGUgY3VycmVudCBzdGF0ZSwgYnV0IG5vdCBlbnRlciBhIG5ldyBzdGF0ZS5cbiAgICovXG4gIHN0b3AoKSB7XG4gICAgaWYgKHRoaXMucnVubmluZ1N0YXRlICE9PSAxIC8qIFNUQVJURUQgKi8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzdG9wIGEgc3RhdGUgbWFjaGluZSB0aGF0IGhhc24ndCBzdGFydGVkIHlldFwiKTtcbiAgICB9XG4gICAgdGhpcy5leGl0KG51bGwpO1xuICAgIHRoaXMucnVubmluZ1N0YXRlID0gMiAvKiBTVE9QUEVEICovO1xuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gbnVsbDtcbiAgfVxuICBjb25zdHJ1Y3Rvcihpbml0aWFsQ29udGV4dCkge1xuICAgIHRoaXMuaWQgPSBuZXh0SWQrKztcbiAgICB0aGlzLnJ1bm5pbmdTdGF0ZSA9IDAgLyogTk9UX1NUQVJURURfWUVUICovO1xuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gbnVsbDtcbiAgICB0aGlzLnN0YXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgdGhpcy5lbnRlckZucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5jbGVhbnVwU3RhY2sgPSBbXTtcbiAgICB0aGlzLmtub3duRXZlbnRUeXBlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgdGhpcy5hbGxvd2VkVHJhbnNpdGlvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQgPSBuZXcgU2FmZUNvbnRleHQoaW5pdGlhbENvbnRleHQpO1xuICAgIHRoaXMuZXZlbnRIdWIgPSB7XG4gICAgICBkaWRSZWNlaXZlRXZlbnQ6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgICAgd2lsbFRyYW5zaXRpb246IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgICAgZGlkSWdub3JlRXZlbnQ6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgICAgd2lsbEV4aXRTdGF0ZTogbWFrZUV2ZW50U291cmNlKCksXG4gICAgICBkaWRFbnRlclN0YXRlOiBtYWtlRXZlbnRTb3VyY2UoKVxuICAgIH07XG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICBkaWRSZWNlaXZlRXZlbnQ6IHRoaXMuZXZlbnRIdWIuZGlkUmVjZWl2ZUV2ZW50Lm9ic2VydmFibGUsXG4gICAgICB3aWxsVHJhbnNpdGlvbjogdGhpcy5ldmVudEh1Yi53aWxsVHJhbnNpdGlvbi5vYnNlcnZhYmxlLFxuICAgICAgZGlkSWdub3JlRXZlbnQ6IHRoaXMuZXZlbnRIdWIuZGlkSWdub3JlRXZlbnQub2JzZXJ2YWJsZSxcbiAgICAgIHdpbGxFeGl0U3RhdGU6IHRoaXMuZXZlbnRIdWIud2lsbEV4aXRTdGF0ZS5vYnNlcnZhYmxlLFxuICAgICAgZGlkRW50ZXJTdGF0ZTogdGhpcy5ldmVudEh1Yi5kaWRFbnRlclN0YXRlLm9ic2VydmFibGVcbiAgICB9O1xuICB9XG4gIGdldCBjb250ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRDb250ZXh0LmN1cnJlbnQ7XG4gIH1cbiAgLyoqXG4gICAqIERlZmluZSBhbiBleHBsaWNpdCBmaW5pdGUgc3RhdGUgaW4gdGhlIHN0YXRlIG1hY2hpbmUuXG4gICAqL1xuICBhZGRTdGF0ZShzdGF0ZSkge1xuICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSAhPT0gMCAvKiBOT1RfU1RBUlRFRF9ZRVQgKi8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgc3RhcnRlZFwiKTtcbiAgICB9XG4gICAgdGhpcy5zdGF0ZXMuYWRkKHN0YXRlKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBvbkVudGVyKG5hbWVPclBhdHRlcm4sIGVudGVyRm4pIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nU3RhdGUgIT09IDAgLyogTk9UX1NUQVJURURfWUVUICovKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbHJlYWR5IHN0YXJ0ZWRcIik7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVudGVyRm5zLmhhcyhuYW1lT3JQYXR0ZXJuKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAvLyBUT0RPIFdlIF9jdXJyZW50bHlfIGRvbid0IHN1cHBvcnQgbXVsdGlwbGUgLm9uRW50ZXJzKCkgZm9yIHRoZSBzYW1lXG4gICAgICAgIC8vIHN0YXRlLCBidXQgdGhpcyBpcyBub3QgYSBmdW5kYW1lbnRhbCBsaW1pdGF0aW9uLiBKdXN0IG5vdFxuICAgICAgICAvLyBpbXBsZW1lbnRlZCB5ZXQuIElmIHdlIHdhbnRlZCB0bywgd2UgY291bGQgbWFrZSB0aGlzIGFuIGFycmF5LlxuICAgICAgICBgZW50ZXIvZXhpdCBmdW5jdGlvbiBmb3IgJHtuYW1lT3JQYXR0ZXJufSBhbHJlYWR5IGV4aXN0c2BcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuZW50ZXJGbnMuc2V0KG5hbWVPclBhdHRlcm4sIGVudGVyRm4pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIG9uRW50ZXJBc3luYyhuYW1lT3JQYXR0ZXJuLCBwcm9taXNlRm4sIG9uT0ssIG9uRXJyb3IpIHtcbiAgICByZXR1cm4gdGhpcy5vbkVudGVyKG5hbWVPclBhdHRlcm4sICgpID0+IHtcbiAgICAgIGNvbnN0IGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgIGNvbnN0IHNpZ25hbCA9IGFib3J0Q29udHJvbGxlci5zaWduYWw7XG4gICAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgICAgdm9pZCBwcm9taXNlRm4odGhpcy5jdXJyZW50Q29udGV4dC5jdXJyZW50LCBzaWduYWwpLnRoZW4oXG4gICAgICAgIC8vIE9uIE9LXG4gICAgICAgIChkYXRhKSA9PiB7XG4gICAgICAgICAgaWYgKCFzaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb24oeyB0eXBlOiBcIkFTWU5DX09LXCIsIGRhdGEgfSwgb25PSyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyBPbiBFcnJvclxuICAgICAgICAocmVhc29uKSA9PiB7XG4gICAgICAgICAgaWYgKCFzaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb24oeyB0eXBlOiBcIkFTWU5DX0VSUk9SXCIsIHJlYXNvbiB9LCBvbkVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBpZiAoIWRvbmUpIHtcbiAgICAgICAgICBhYm9ydENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuICBnZXRTdGF0ZXNNYXRjaGluZyhuYW1lT3JQYXR0ZXJuKSB7XG4gICAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICAgIGlmIChuYW1lT3JQYXR0ZXJuID09PSBcIipcIikge1xuICAgICAgZm9yIChjb25zdCBzdGF0ZSBvZiB0aGlzLnN0YXRlcykge1xuICAgICAgICBtYXRjaGVzLnB1c2goc3RhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobmFtZU9yUGF0dGVybi5lbmRzV2l0aChcIi4qXCIpKSB7XG4gICAgICBjb25zdCBwcmVmaXggPSBuYW1lT3JQYXR0ZXJuLnNsaWNlKDAsIC0xKTtcbiAgICAgIGZvciAoY29uc3Qgc3RhdGUgb2YgdGhpcy5zdGF0ZXMpIHtcbiAgICAgICAgaWYgKHN0YXRlLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgICAgIG1hdGNoZXMucHVzaChzdGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmFtZSA9IG5hbWVPclBhdHRlcm47XG4gICAgICBpZiAodGhpcy5zdGF0ZXMuaGFzKG5hbWUpKSB7XG4gICAgICAgIG1hdGNoZXMucHVzaChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHN0YXRlcyBtYXRjaCAke0pTT04uc3RyaW5naWZ5KG5hbWVPclBhdHRlcm4pfWApO1xuICAgIH1cbiAgICByZXR1cm4gbWF0Y2hlcztcbiAgfVxuICAvKipcbiAgICogRGVmaW5lIGFsbCBhbGxvd2VkIG91dGdvaW5nIHRyYW5zaXRpb25zIGZvciBhIHN0YXRlLlxuICAgKlxuICAgKiBUaGUgdGFyZ2V0cyBmb3IgZWFjaCBldmVudCBjYW4gYmUgZGVmaW5lZCBhcyBhIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdGhlXG4gICAqIG5leHQgc3RhdGUgdG8gdHJhbnNpdGlvbiB0by4gVGhlc2UgZnVuY3Rpb25zIGNhbiBsb29rIGF0IHRoZSBgZXZlbnRgIG9yXG4gICAqIGBjb250ZXh0YCBwYXJhbXMgdG8gY29uZGl0aW9uYWxseSBkZWNpZGUgd2hpY2ggbmV4dCBzdGF0ZSB0byB0cmFuc2l0aW9uXG4gICAqIHRvLlxuICAgKlxuICAgKiBJZiB5b3Ugc2V0IGl0IHRvIGBudWxsYCwgdGhlbiB0aGUgdHJhbnNpdGlvbiB3aWxsIGJlIGV4cGxpY2l0bHkgZm9yYmlkZGVuXG4gICAqIGFuZCB0aHJvdyBhbiBlcnJvci4gSWYgeW91IGRvbid0IGRlZmluZSBhIHRhcmdldCBmb3IgYSB0cmFuc2l0aW9uLCB0aGVuXG4gICAqIHN1Y2ggZXZlbnRzIHdpbGwgZ2V0IGlnbm9yZWQuXG4gICAqL1xuICBhZGRUcmFuc2l0aW9ucyhuYW1lT3JQYXR0ZXJuLCBtYXBwaW5nKSB7XG4gICAgaWYgKHRoaXMucnVubmluZ1N0YXRlICE9PSAwIC8qIE5PVF9TVEFSVEVEX1lFVCAqLykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxyZWFkeSBzdGFydGVkXCIpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHNyY1N0YXRlIG9mIHRoaXMuZ2V0U3RhdGVzTWF0Y2hpbmcobmFtZU9yUGF0dGVybikpIHtcbiAgICAgIGxldCBtYXAgPSB0aGlzLmFsbG93ZWRUcmFuc2l0aW9ucy5nZXQoc3JjU3RhdGUpO1xuICAgICAgaWYgKG1hcCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIG1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuYWxsb3dlZFRyYW5zaXRpb25zLnNldChzcmNTdGF0ZSwgbWFwKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgW3R5cGUsIHRhcmdldF9dIG9mIE9iamVjdC5lbnRyaWVzKG1hcHBpbmcpKSB7XG4gICAgICAgIGlmIChtYXAuaGFzKHR5cGUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFRyeWluZyB0byBzZXQgdHJhbnNpdGlvbiBcIiR7dHlwZX1cIiBvbiBcIiR7c3JjU3RhdGV9XCIgKHZpYSBcIiR7bmFtZU9yUGF0dGVybn1cIiksIGJ1dCBhIHRyYW5zaXRpb24gYWxyZWFkeSBleGlzdHMgdGhlcmUuYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGFyZ2V0XztcbiAgICAgICAgdGhpcy5rbm93bkV2ZW50VHlwZXMuYWRkKHR5cGUpO1xuICAgICAgICBpZiAodGFyZ2V0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBjb25zdCB0YXJnZXRGbiA9IHR5cGVvZiB0YXJnZXQgPT09IFwiZnVuY3Rpb25cIiA/IHRhcmdldCA6ICgpID0+IHRhcmdldDtcbiAgICAgICAgICBtYXAuc2V0KHR5cGUsIHRhcmdldEZuKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKipcbiAgICogTGlrZSBgLmFkZFRyYW5zaXRpb24oKWAsIGJ1dCB0YWtlcyBhbiAoYW5vbnltb3VzKSB0cmFuc2l0aW9uIHdoZW5ldmVyIHRoZVxuICAgKiB0aW1lciBmaXJlcy5cbiAgICpcbiAgICogQHBhcmFtIHN0YXRlT3JQYXR0ZXJuIFRoZSBzdGF0ZSBuYW1lLCBvciBzdGF0ZSBncm91cCBwYXR0ZXJuIG5hbWUuXG4gICAqIEBwYXJhbSBhZnRlciAgICAgICAgICBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIGFmdGVyIHdoaWNoIHRvIHRha2UgdGhlXG4gICAqICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uLiBJZiBpbiB0aGUgbWVhbiB0aW1lLCBhbm90aGVyIHRyYW5zaXRpb25cbiAgICogICAgICAgICAgICAgICAgICAgICAgIGlzIHRha2VuLCB0aGUgdGltZXIgd2lsbCBnZXQgY2FuY2VsbGVkLlxuICAgKiBAcGFyYW0gdGFyZ2V0ICAgICBUaGUgdGFyZ2V0IHN0YXRlIHRvIGdvIHRvLlxuICAgKi9cbiAgYWRkVGltZWRUcmFuc2l0aW9uKHN0YXRlT3JQYXR0ZXJuLCBhZnRlcjIsIHRhcmdldCkge1xuICAgIHJldHVybiB0aGlzLm9uRW50ZXIoc3RhdGVPclBhdHRlcm4sICgpID0+IHtcbiAgICAgIGNvbnN0IG1zID0gdHlwZW9mIGFmdGVyMiA9PT0gXCJmdW5jdGlvblwiID8gYWZ0ZXIyKHRoaXMuY3VycmVudENvbnRleHQuY3VycmVudCkgOiBhZnRlcjI7XG4gICAgICBjb25zdCB0aW1lb3V0SUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uKHsgdHlwZTogXCJUSU1FUlwiIH0sIHRhcmdldCk7XG4gICAgICB9LCBtcyk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElEKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbiAgZ2V0VGFyZ2V0Rm4oZXZlbnROYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuYWxsb3dlZFRyYW5zaXRpb25zLmdldCh0aGlzLmN1cnJlbnRTdGF0ZSk/LmdldChldmVudE5hbWUpO1xuICB9XG4gIC8qKlxuICAgKiBFeGl0cyB0aGUgY3VycmVudCBzdGF0ZSwgYW5kIGV4ZWN1dGVzIGFueSBuZWNlc3NhcnkgY2xlYW51cCBmdW5jdGlvbnMuXG4gICAqIENhbGwgdGhpcyBiZWZvcmUgY2hhbmdpbmcgdGhlIGN1cnJlbnQgc3RhdGUgdG8gdGhlIG5leHQgc3RhdGUuXG4gICAqXG4gICAqIEBwYXJhbSBsZXZlbHMgRGVmaW5lcyBob3cgbWFueSBcImxldmVsc1wiIG9mIG5lc3Rpbmcgd2lsbCBiZVxuICAgKiBleGl0ZWQuIEZvciBleGFtcGxlLCBpZiB5b3UgdHJhbnNpdGlvbiBmcm9tIGBmb28uYmFyLnF1eGAgdG9cbiAgICogYGZvby5iYXIuYmF6YCwgdGhlbiB0aGUgbGV2ZWwgaXMgMS4gQnV0IGlmIHlvdSB0cmFuc2l0aW9uIGZyb21cbiAgICogYGZvby5iYXIucXV4YCB0byBgYmxhLmJsYWAsIHRoZW4gdGhlIGxldmVsIGlzIDMuXG4gICAqIElmIGBudWxsYCwgaXQgd2lsbCBleGl0IGFsbCBsZXZlbHMuXG4gICAqL1xuICBleGl0KGxldmVscykge1xuICAgIHRoaXMuZXZlbnRIdWIud2lsbEV4aXRTdGF0ZS5ub3RpZnkodGhpcy5jdXJyZW50U3RhdGUpO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQuYWxsb3dQYXRjaGluZygocGF0Y2hhYmxlQ29udGV4dCkgPT4ge1xuICAgICAgbGV2ZWxzID0gbGV2ZWxzID8/IHRoaXMuY2xlYW51cFN0YWNrLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGV2ZWxzOyBpKyspIHtcbiAgICAgICAgdGhpcy5jbGVhbnVwU3RhY2sucG9wKCk/LihwYXRjaGFibGVDb250ZXh0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogRW50ZXJzIHRoZSBjdXJyZW50IHN0YXRlLCBhbmQgZXhlY3V0ZXMgYW55IG5lY2Vzc2FyeSBvbkVudGVyIGhhbmRsZXJzLlxuICAgKiBDYWxsIHRoaXMgZGlyZWN0bHkgX2FmdGVyXyBzZXR0aW5nIHRoZSBjdXJyZW50IHN0YXRlIHRvIHRoZSBuZXh0IHN0YXRlLlxuICAgKi9cbiAgZW50ZXIobGV2ZWxzKSB7XG4gICAgY29uc3QgZW50ZXJQYXR0ZXJucyA9IHBhdHRlcm5zKFxuICAgICAgdGhpcy5jdXJyZW50U3RhdGUsXG4gICAgICBsZXZlbHMgPz8gdGhpcy5jdXJyZW50U3RhdGUuc3BsaXQoXCIuXCIpLmxlbmd0aCArIDFcbiAgICApO1xuICAgIHRoaXMuY3VycmVudENvbnRleHQuYWxsb3dQYXRjaGluZygocGF0Y2hhYmxlQ29udGV4dCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGVudGVyUGF0dGVybnMpIHtcbiAgICAgICAgY29uc3QgZW50ZXJGbiA9IHRoaXMuZW50ZXJGbnMuZ2V0KHBhdHRlcm4pO1xuICAgICAgICBjb25zdCBjbGVhbnVwRm4gPSBlbnRlckZuPy4ocGF0Y2hhYmxlQ29udGV4dCk7XG4gICAgICAgIGlmICh0eXBlb2YgY2xlYW51cEZuID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICB0aGlzLmNsZWFudXBTdGFjay5wdXNoKGNsZWFudXBGbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jbGVhbnVwU3RhY2sucHVzaChudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuZXZlbnRIdWIuZGlkRW50ZXJTdGF0ZS5ub3RpZnkodGhpcy5jdXJyZW50U3RhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBTZW5kcyBhbiBldmVudCB0byB0aGUgbWFjaGluZSwgd2hpY2ggbWF5IGNhdXNlIGFuIGludGVybmFsIHN0YXRlXG4gICAqIHRyYW5zaXRpb24gdG8gaGFwcGVuLiBXaGVuIHRoYXQgaGFwcGVucywgd2lsbCB0cmlnZ2VyIHNpZGUgZWZmZWN0cy5cbiAgICovXG4gIHNlbmQoZXZlbnQpIHtcbiAgICBpZiAoIXRoaXMua25vd25FdmVudFR5cGVzLmhhcyhldmVudC50eXBlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGV2ZW50ICR7SlNPTi5zdHJpbmdpZnkoZXZlbnQudHlwZSl9YCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJ1bm5pbmdTdGF0ZSA9PT0gMiAvKiBTVE9QUEVEICovKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRhcmdldEZuID0gdGhpcy5nZXRUYXJnZXRGbihldmVudC50eXBlKTtcbiAgICBpZiAodGFyZ2V0Rm4gIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHRoaXMudHJhbnNpdGlvbihldmVudCwgdGFyZ2V0Rm4pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmV2ZW50SHViLmRpZElnbm9yZUV2ZW50Lm5vdGlmeShldmVudCk7XG4gICAgfVxuICB9XG4gIHRyYW5zaXRpb24oZXZlbnQsIHRhcmdldCkge1xuICAgIHRoaXMuZXZlbnRIdWIuZGlkUmVjZWl2ZUV2ZW50Lm5vdGlmeShldmVudCk7XG4gICAgY29uc3Qgb2xkU3RhdGUgPSB0aGlzLmN1cnJlbnRTdGF0ZTtcbiAgICBjb25zdCB0YXJnZXRGbiA9IHR5cGVvZiB0YXJnZXQgPT09IFwiZnVuY3Rpb25cIiA/IHRhcmdldCA6ICgpID0+IHRhcmdldDtcbiAgICBjb25zdCBuZXh0VGFyZ2V0ID0gdGFyZ2V0Rm4oZXZlbnQsIHRoaXMuY3VycmVudENvbnRleHQuY3VycmVudCk7XG4gICAgbGV0IG5leHRTdGF0ZTtcbiAgICBsZXQgZWZmZWN0cyA9IHZvaWQgMDtcbiAgICBpZiAobmV4dFRhcmdldCA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5ldmVudEh1Yi5kaWRJZ25vcmVFdmVudC5ub3RpZnkoZXZlbnQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG5leHRUYXJnZXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIG5leHRTdGF0ZSA9IG5leHRUYXJnZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHRTdGF0ZSA9IG5leHRUYXJnZXQudGFyZ2V0O1xuICAgICAgZWZmZWN0cyA9IEFycmF5LmlzQXJyYXkobmV4dFRhcmdldC5lZmZlY3QpID8gbmV4dFRhcmdldC5lZmZlY3QgOiBbbmV4dFRhcmdldC5lZmZlY3RdO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc3RhdGVzLmhhcyhuZXh0U3RhdGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbmV4dCBzdGF0ZSBuYW1lOiAke0pTT04uc3RyaW5naWZ5KG5leHRTdGF0ZSl9YCk7XG4gICAgfVxuICAgIHRoaXMuZXZlbnRIdWIud2lsbFRyYW5zaXRpb24ubm90aWZ5KHsgZnJvbTogb2xkU3RhdGUsIHRvOiBuZXh0U3RhdGUgfSk7XG4gICAgY29uc3QgW3VwLCBkb3duXSA9IGRpc3RhbmNlKHRoaXMuY3VycmVudFN0YXRlLCBuZXh0U3RhdGUpO1xuICAgIGlmICh1cCA+IDApIHtcbiAgICAgIHRoaXMuZXhpdCh1cCk7XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFN0YXRlT3JOdWxsID0gbmV4dFN0YXRlO1xuICAgIGlmIChlZmZlY3RzICE9PSB2b2lkIDApIHtcbiAgICAgIGNvbnN0IGVmZmVjdHNUb1J1biA9IGVmZmVjdHM7XG4gICAgICB0aGlzLmN1cnJlbnRDb250ZXh0LmFsbG93UGF0Y2hpbmcoKHBhdGNoYWJsZUNvbnRleHQpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBlZmZlY3Qgb2YgZWZmZWN0c1RvUnVuKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBlZmZlY3QgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgZWZmZWN0KHBhdGNoYWJsZUNvbnRleHQsIGV2ZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGF0Y2hhYmxlQ29udGV4dC5wYXRjaChlZmZlY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChkb3duID4gMCkge1xuICAgICAgdGhpcy5lbnRlcihkb3duKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNyYy9saWIvdXRpbHMudHNcbmZ1bmN0aW9uIHJhaXNlKG1zZykge1xuICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbn1cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QoYmxvYikge1xuICByZXR1cm4gYmxvYiAhPT0gbnVsbCAmJiB0eXBlb2YgYmxvYiA9PT0gXCJvYmplY3RcIiAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYmxvYikgPT09IFwiW29iamVjdCBPYmplY3RdXCI7XG59XG5mdW5jdGlvbiBlbnRyaWVzKG9iaikge1xuICByZXR1cm4gT2JqZWN0LmVudHJpZXMob2JqKTtcbn1cbmZ1bmN0aW9uIHRyeVBhcnNlSnNvbihyYXdNZXNzYWdlKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UocmF3TWVzc2FnZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG59XG5mdW5jdGlvbiBkZWVwQ2xvbmUodmFsdWUpIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbn1cbmZ1bmN0aW9uIGI2NGRlY29kZShiNjR2YWx1ZSkge1xuICB0cnkge1xuICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gYjY0dmFsdWUucmVwbGFjZSgvLS9nLCBcIitcIikucmVwbGFjZSgvXy9nLCBcIi9cIik7XG4gICAgY29uc3QgZGVjb2RlZFZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KFxuICAgICAgYXRvYihmb3JtYXR0ZWRWYWx1ZSkuc3BsaXQoXCJcIikubWFwKGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgcmV0dXJuIFwiJVwiICsgKFwiMDBcIiArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgICAgIH0pLmpvaW4oXCJcIilcbiAgICApO1xuICAgIHJldHVybiBkZWNvZGVkVmFsdWU7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBhdG9iKGI2NHZhbHVlKTtcbiAgfVxufVxuZnVuY3Rpb24gY29tcGFjdChpdGVtcykge1xuICByZXR1cm4gaXRlbXMuZmlsdGVyKFxuICAgIChpdGVtKSA9PiBpdGVtICE9PSBudWxsICYmIGl0ZW0gIT09IHZvaWQgMFxuICApO1xufVxuZnVuY3Rpb24gY29tcGFjdE9iamVjdChvYmopIHtcbiAgY29uc3QgbmV3T2JqID0geyAuLi5vYmogfTtcbiAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gaztcbiAgICBpZiAobmV3T2JqW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgZGVsZXRlIG5ld09ialtrZXldO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBuZXdPYmo7XG59XG5mdW5jdGlvbiB3YWl0KG1pbGxpcykge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlcykgPT4gc2V0VGltZW91dChyZXMsIG1pbGxpcykpO1xufVxuYXN5bmMgZnVuY3Rpb24gd2l0aFRpbWVvdXQocHJvbWlzZSwgbWlsbGlzLCBlcnJtc2cpIHtcbiAgbGV0IHRpbWVySUQ7XG4gIGNvbnN0IHRpbWVyJCA9IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHtcbiAgICB0aW1lcklEID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICByZWplY3QobmV3IEVycm9yKGVycm1zZykpO1xuICAgIH0sIG1pbGxpcyk7XG4gIH0pO1xuICByZXR1cm4gUHJvbWlzZS5yYWNlKFtwcm9taXNlLCB0aW1lciRdKS5maW5hbGx5KCgpID0+IGNsZWFyVGltZW91dCh0aW1lcklEKSk7XG59XG5mdW5jdGlvbiBtZW1vaXplT25TdWNjZXNzKGZhY3RvcnlGbikge1xuICBsZXQgY2FjaGVkID0gbnVsbDtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBpZiAoY2FjaGVkID09PSBudWxsKSB7XG4gICAgICBjYWNoZWQgPSBmYWN0b3J5Rm4oKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGNhY2hlZCA9IG51bGw7XG4gICAgICAgIH0sIDVlMyk7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVkO1xuICB9O1xufVxuXG4vLyBzcmMvcHJvdG9jb2wvU2VydmVyTXNnLnRzXG52YXIgU2VydmVyTXNnQ29kZSA9IC8qIEBfX1BVUkVfXyAqLyAoKFNlcnZlck1zZ0NvZGUyKSA9PiB7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVBEQVRFX1BSRVNFTkNFXCJdID0gMTAwXSA9IFwiVVBEQVRFX1BSRVNFTkNFXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVNFUl9KT0lORURcIl0gPSAxMDFdID0gXCJVU0VSX0pPSU5FRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlVTRVJfTEVGVFwiXSA9IDEwMl0gPSBcIlVTRVJfTEVGVFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIkJST0FEQ0FTVEVEX0VWRU5UXCJdID0gMTAzXSA9IFwiQlJPQURDQVNURURfRVZFTlRcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJST09NX1NUQVRFXCJdID0gMTA0XSA9IFwiUk9PTV9TVEFURVwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIklOSVRJQUxfU1RPUkFHRV9TVEFURVwiXSA9IDIwMF0gPSBcIklOSVRJQUxfU1RPUkFHRV9TVEFURVwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlVQREFURV9TVE9SQUdFXCJdID0gMjAxXSA9IFwiVVBEQVRFX1NUT1JBR0VcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJSRUpFQ1RfU1RPUkFHRV9PUFwiXSA9IDI5OV0gPSBcIlJFSkVDVF9TVE9SQUdFX09QXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVVBEQVRFX1lET0NcIl0gPSAzMDBdID0gXCJVUERBVEVfWURPQ1wiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlRIUkVBRF9DUkVBVEVEXCJdID0gNDAwXSA9IFwiVEhSRUFEX0NSRUFURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJUSFJFQURfREVMRVRFRFwiXSA9IDQwN10gPSBcIlRIUkVBRF9ERUxFVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiVEhSRUFEX01FVEFEQVRBX1VQREFURURcIl0gPSA0MDFdID0gXCJUSFJFQURfTUVUQURBVEFfVVBEQVRFRFwiO1xuICBTZXJ2ZXJNc2dDb2RlMltTZXJ2ZXJNc2dDb2RlMltcIlRIUkVBRF9VUERBVEVEXCJdID0gNDA4XSA9IFwiVEhSRUFEX1VQREFURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX0NSRUFURURcIl0gPSA0MDJdID0gXCJDT01NRU5UX0NSRUFURURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX0VESVRFRFwiXSA9IDQwM10gPSBcIkNPTU1FTlRfRURJVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiQ09NTUVOVF9ERUxFVEVEXCJdID0gNDA0XSA9IFwiQ09NTUVOVF9ERUxFVEVEXCI7XG4gIFNlcnZlck1zZ0NvZGUyW1NlcnZlck1zZ0NvZGUyW1wiQ09NTUVOVF9SRUFDVElPTl9BRERFRFwiXSA9IDQwNV0gPSBcIkNPTU1FTlRfUkVBQ1RJT05fQURERURcIjtcbiAgU2VydmVyTXNnQ29kZTJbU2VydmVyTXNnQ29kZTJbXCJDT01NRU5UX1JFQUNUSU9OX1JFTU9WRURcIl0gPSA0MDZdID0gXCJDT01NRU5UX1JFQUNUSU9OX1JFTU9WRURcIjtcbiAgcmV0dXJuIFNlcnZlck1zZ0NvZGUyO1xufSkoU2VydmVyTXNnQ29kZSB8fCB7fSk7XG5cbi8vIHNyYy90eXBlcy9JV2ViU29ja2V0LnRzXG52YXIgV2Vic29ja2V0Q2xvc2VDb2RlcyA9IC8qIEBfX1BVUkVfXyAqLyAoKFdlYnNvY2tldENsb3NlQ29kZXMyKSA9PiB7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiQ0xPU0VfTk9STUFMXCJdID0gMWUzXSA9IFwiQ0xPU0VfTk9STUFMXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiQ0xPU0VfQUJOT1JNQUxcIl0gPSAxMDA2XSA9IFwiQ0xPU0VfQUJOT1JNQUxcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJVTkVYUEVDVEVEX0NPTkRJVElPTlwiXSA9IDEwMTFdID0gXCJVTkVYUEVDVEVEX0NPTkRJVElPTlwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIlRSWV9BR0FJTl9MQVRFUlwiXSA9IDEwMTNdID0gXCJUUllfQUdBSU5fTEFURVJcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJJTlZBTElEX01FU1NBR0VfRk9STUFUXCJdID0gNGUzXSA9IFwiSU5WQUxJRF9NRVNTQUdFX0ZPUk1BVFwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIk5PVF9BTExPV0VEXCJdID0gNDAwMV0gPSBcIk5PVF9BTExPV0VEXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9NRVNTQUdFU19QRVJfU0VDT05EU1wiXSA9IDQwMDJdID0gXCJNQVhfTlVNQkVSX09GX01FU1NBR0VTX1BFUl9TRUNPTkRTXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9DT05DVVJSRU5UX0NPTk5FQ1RJT05TXCJdID0gNDAwM10gPSBcIk1BWF9OVU1CRVJfT0ZfQ09OQ1VSUkVOVF9DT05ORUNUSU9OU1wiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIk1BWF9OVU1CRVJfT0ZfTUVTU0FHRVNfUEVSX0RBWV9QRVJfQVBQXCJdID0gNDAwNF0gPSBcIk1BWF9OVU1CRVJfT0ZfTUVTU0FHRVNfUEVSX0RBWV9QRVJfQVBQXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiTUFYX05VTUJFUl9PRl9DT05DVVJSRU5UX0NPTk5FQ1RJT05TX1BFUl9ST09NXCJdID0gNDAwNV0gPSBcIk1BWF9OVU1CRVJfT0ZfQ09OQ1VSUkVOVF9DT05ORUNUSU9OU19QRVJfUk9PTVwiO1xuICBXZWJzb2NrZXRDbG9zZUNvZGVzMltXZWJzb2NrZXRDbG9zZUNvZGVzMltcIlJPT01fSURfVVBEQVRFRFwiXSA9IDQwMDZdID0gXCJST09NX0lEX1VQREFURURcIjtcbiAgV2Vic29ja2V0Q2xvc2VDb2RlczJbV2Vic29ja2V0Q2xvc2VDb2RlczJbXCJLSUNLRURcIl0gPSA0MTAwXSA9IFwiS0lDS0VEXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiVE9LRU5fRVhQSVJFRFwiXSA9IDQxMDldID0gXCJUT0tFTl9FWFBJUkVEXCI7XG4gIFdlYnNvY2tldENsb3NlQ29kZXMyW1dlYnNvY2tldENsb3NlQ29kZXMyW1wiQ0xPU0VfV0lUSE9VVF9SRVRSWVwiXSA9IDQ5OTldID0gXCJDTE9TRV9XSVRIT1VUX1JFVFJZXCI7XG4gIHJldHVybiBXZWJzb2NrZXRDbG9zZUNvZGVzMjtcbn0pKFdlYnNvY2tldENsb3NlQ29kZXMgfHwge30pO1xuZnVuY3Rpb24gc2hvdWxkRGlzY29ubmVjdChjb2RlKSB7XG4gIHJldHVybiBjb2RlID09PSA0OTk5IC8qIENMT1NFX1dJVEhPVVRfUkVUUlkgKi8gfHwgY29kZSA+PSA0ZTMgJiYgY29kZSA8IDQxMDA7XG59XG5mdW5jdGlvbiBzaG91bGRSZWF1dGgoY29kZSkge1xuICByZXR1cm4gY29kZSA+PSA0MTAwICYmIGNvZGUgPCA0MjAwO1xufVxuZnVuY3Rpb24gc2hvdWxkUmV0cnlXaXRob3V0UmVhdXRoKGNvZGUpIHtcbiAgcmV0dXJuIGNvZGUgPT09IDEwMTMgLyogVFJZX0FHQUlOX0xBVEVSICovIHx8IGNvZGUgPj0gNDIwMCAmJiBjb2RlIDwgNDMwMDtcbn1cblxuLy8gc3JjL2Nvbm5lY3Rpb24udHNcbmZ1bmN0aW9uIGlzSWRsZShzdGF0dXMpIHtcbiAgcmV0dXJuIHN0YXR1cyA9PT0gXCJpbml0aWFsXCIgfHwgc3RhdHVzID09PSBcImRpc2Nvbm5lY3RlZFwiO1xufVxuZnVuY3Rpb24gdG9OZXdDb25uZWN0aW9uU3RhdHVzKG1hY2hpbmUpIHtcbiAgY29uc3Qgc3RhdGUgPSBtYWNoaW5lLmN1cnJlbnRTdGF0ZTtcbiAgc3dpdGNoIChzdGF0ZSkge1xuICAgIGNhc2UgXCJAb2suY29ubmVjdGVkXCI6XG4gICAgY2FzZSBcIkBvay5hd2FpdGluZy1wb25nXCI6XG4gICAgICByZXR1cm4gXCJjb25uZWN0ZWRcIjtcbiAgICBjYXNlIFwiQGlkbGUuaW5pdGlhbFwiOlxuICAgICAgcmV0dXJuIFwiaW5pdGlhbFwiO1xuICAgIGNhc2UgXCJAYXV0aC5idXN5XCI6XG4gICAgY2FzZSBcIkBhdXRoLmJhY2tvZmZcIjpcbiAgICBjYXNlIFwiQGNvbm5lY3RpbmcuYnVzeVwiOlxuICAgIGNhc2UgXCJAY29ubmVjdGluZy5iYWNrb2ZmXCI6XG4gICAgY2FzZSBcIkBpZGxlLnpvbWJpZVwiOlxuICAgICAgcmV0dXJuIG1hY2hpbmUuY29udGV4dC5zdWNjZXNzQ291bnQgPiAwID8gXCJyZWNvbm5lY3RpbmdcIiA6IFwiY29ubmVjdGluZ1wiO1xuICAgIGNhc2UgXCJAaWRsZS5mYWlsZWRcIjpcbiAgICAgIHJldHVybiBcImRpc2Nvbm5lY3RlZFwiO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIoc3RhdGUsIFwiVW5rbm93biBzdGF0ZVwiKTtcbiAgfVxufVxudmFyIEJBQ0tPRkZfREVMQVlTID0gWzI1MCwgNTAwLCAxZTMsIDJlMywgNGUzLCA4ZTMsIDFlNF07XG52YXIgUkVTRVRfREVMQVkgPSBCQUNLT0ZGX0RFTEFZU1swXSAtIDE7XG52YXIgQkFDS09GRl9ERUxBWVNfU0xPVyA9IFsyZTMsIDNlNCwgNmU0LCAzZTVdO1xudmFyIEhFQVJUQkVBVF9JTlRFUlZBTCA9IDNlNDtcbnZhciBQT05HX1RJTUVPVVQgPSAyZTM7XG52YXIgQVVUSF9USU1FT1VUID0gMWU0O1xudmFyIFNPQ0tFVF9DT05ORUNUX1RJTUVPVVQgPSAxZTQ7XG52YXIgU3RvcFJldHJ5aW5nID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHJlYXNvbikge1xuICAgIHN1cGVyKHJlYXNvbik7XG4gIH1cbn07XG52YXIgTGl2ZWJsb2Nrc0Vycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IobWVzc2FnZSwgY29kZSkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gIH1cbn07XG5mdW5jdGlvbiBuZXh0QmFja29mZkRlbGF5KGN1cnJlbnREZWxheSwgZGVsYXlzKSB7XG4gIHJldHVybiBkZWxheXMuZmluZCgoZGVsYXkpID0+IGRlbGF5ID4gY3VycmVudERlbGF5KSA/PyBkZWxheXNbZGVsYXlzLmxlbmd0aCAtIDFdO1xufVxuZnVuY3Rpb24gaW5jcmVhc2VCYWNrb2ZmRGVsYXkoY29udGV4dCkge1xuICBjb250ZXh0LnBhdGNoKHtcbiAgICBiYWNrb2ZmRGVsYXk6IG5leHRCYWNrb2ZmRGVsYXkoY29udGV4dC5iYWNrb2ZmRGVsYXksIEJBQ0tPRkZfREVMQVlTKVxuICB9KTtcbn1cbmZ1bmN0aW9uIGluY3JlYXNlQmFja29mZkRlbGF5QWdncmVzc2l2ZWx5KGNvbnRleHQpIHtcbiAgY29udGV4dC5wYXRjaCh7XG4gICAgYmFja29mZkRlbGF5OiBuZXh0QmFja29mZkRlbGF5KGNvbnRleHQuYmFja29mZkRlbGF5LCBCQUNLT0ZGX0RFTEFZU19TTE9XKVxuICB9KTtcbn1cbmZ1bmN0aW9uIHJlc2V0U3VjY2Vzc0NvdW50KGNvbnRleHQpIHtcbiAgY29udGV4dC5wYXRjaCh7IHN1Y2Nlc3NDb3VudDogMCB9KTtcbn1cbmZ1bmN0aW9uIGxvZyhsZXZlbCwgbWVzc2FnZSkge1xuICBjb25zdCBsb2dnZXIgPSBsZXZlbCA9PT0gMiAvKiBFUlJPUiAqLyA/IGVycm9yMiA6IGxldmVsID09PSAxIC8qIFdBUk4gKi8gPyB3YXJuIDogKFxuICAgIC8qIGJsYWNrIGhvbGUgKi9cbiAgICAoKSA9PiB7XG4gICAgfVxuICApO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGxvZ2dlcihtZXNzYWdlKTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGxvZ1ByZW1hdHVyZUVycm9yT3JDbG9zZUV2ZW50KGUpIHtcbiAgY29uc3QgY29ubiA9IFwiQ29ubmVjdGlvbiB0byBMaXZlYmxvY2tzIHdlYnNvY2tldCBzZXJ2ZXJcIjtcbiAgcmV0dXJuIChjdHgpID0+IHtcbiAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB3YXJuKGAke2Nvbm59IGNvdWxkIG5vdCBiZSBlc3RhYmxpc2hlZC4gJHtTdHJpbmcoZSl9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdhcm4oXG4gICAgICAgIGlzQ2xvc2VFdmVudChlKSA/IGAke2Nvbm59IGNsb3NlZCBwcmVtYXR1cmVseSAoY29kZTogJHtlLmNvZGV9KS4gUmV0cnlpbmcgaW4gJHtjdHguYmFja29mZkRlbGF5fW1zLmAgOiBgJHtjb25ufSBjb3VsZCBub3QgYmUgZXN0YWJsaXNoZWQuYFxuICAgICAgKTtcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiBsb2dDbG9zZUV2ZW50KGV2ZW50KSB7XG4gIGNvbnN0IGRldGFpbHMgPSBbYGNvZGU6ICR7ZXZlbnQuY29kZX1gXTtcbiAgaWYgKGV2ZW50LnJlYXNvbikge1xuICAgIGRldGFpbHMucHVzaChgcmVhc29uOiAke2V2ZW50LnJlYXNvbn1gKTtcbiAgfVxuICByZXR1cm4gKGN0eCkgPT4ge1xuICAgIHdhcm4oXG4gICAgICBgQ29ubmVjdGlvbiB0byBMaXZlYmxvY2tzIHdlYnNvY2tldCBzZXJ2ZXIgY2xvc2VkICgke2RldGFpbHMuam9pbihcIiwgXCIpfSkuIFJldHJ5aW5nIGluICR7Y3R4LmJhY2tvZmZEZWxheX1tcy5gXG4gICAgKTtcbiAgfTtcbn1cbnZhciBsb2dQZXJtYW5lbnRDbG9zZSA9IGxvZyhcbiAgMSAvKiBXQVJOICovLFxuICBcIkNvbm5lY3Rpb24gdG8gV2ViU29ja2V0IGNsb3NlZCBwZXJtYW5lbnRseS4gV29uJ3QgcmV0cnkuXCJcbik7XG5mdW5jdGlvbiBpc0Nsb3NlRXZlbnQoZXJyb3IzKSB7XG4gIHJldHVybiAhKGVycm9yMyBpbnN0YW5jZW9mIEVycm9yKSAmJiBlcnJvcjMudHlwZSA9PT0gXCJjbG9zZVwiO1xufVxuZnVuY3Rpb24gZW5hYmxlVHJhY2luZyhtYWNoaW5lKSB7XG4gIGNvbnN0IHN0YXJ0ID0gKC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG4gIGZ1bmN0aW9uIGxvZzIoLi4uYXJncykge1xuICAgIHdhcm4oXG4gICAgICBgJHsoKCgvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gc3RhcnQpIC8gMWUzKS50b0ZpeGVkKDIpfSBbRlNNICMke21hY2hpbmUuaWR9XWAsXG4gICAgICAuLi5hcmdzXG4gICAgKTtcbiAgfVxuICBjb25zdCB1bnN1YnMgPSBbXG4gICAgbWFjaGluZS5ldmVudHMuZGlkUmVjZWl2ZUV2ZW50LnN1YnNjcmliZSgoZSkgPT4gbG9nMihgRXZlbnQgJHtlLnR5cGV9YCkpLFxuICAgIG1hY2hpbmUuZXZlbnRzLndpbGxUcmFuc2l0aW9uLnN1YnNjcmliZShcbiAgICAgICh7IGZyb20sIHRvIH0pID0+IGxvZzIoXCJUcmFuc2l0aW9uaW5nXCIsIGZyb20sIFwiXFx1MjE5MlwiLCB0bylcbiAgICApLFxuICAgIG1hY2hpbmUuZXZlbnRzLmRpZElnbm9yZUV2ZW50LnN1YnNjcmliZShcbiAgICAgIChlKSA9PiBsb2cyKFwiSWdub3JlZCBldmVudFwiLCBlLnR5cGUsIGUsIFwiKGN1cnJlbnQgc3RhdGUgd29uJ3QgaGFuZGxlIGl0KVwiKVxuICAgIClcbiAgICAvLyBtYWNoaW5lLmV2ZW50cy53aWxsRXhpdFN0YXRlLnN1YnNjcmliZSgocykgPT4gbG9nKFwiRXhpdGluZyBzdGF0ZVwiLCBzKSksXG4gICAgLy8gbWFjaGluZS5ldmVudHMuZGlkRW50ZXJTdGF0ZS5zdWJzY3JpYmUoKHMpID0+IGxvZyhcIkVudGVyaW5nIHN0YXRlXCIsIHMpKSxcbiAgXTtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBmb3IgKGNvbnN0IHVuc3ViIG9mIHVuc3Vicykge1xuICAgICAgdW5zdWIoKTtcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiBkZWZpbmVDb25uZWN0aXZpdHlFdmVudHMobWFjaGluZSkge1xuICBjb25zdCBzdGF0dXNEaWRDaGFuZ2UgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgY29uc3QgZGlkQ29ubmVjdCA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBjb25zdCBkaWREaXNjb25uZWN0ID0gbWFrZUV2ZW50U291cmNlKCk7XG4gIGxldCBsYXN0U3RhdHVzID0gbnVsbDtcbiAgY29uc3QgdW5zdWJzY3JpYmUgPSBtYWNoaW5lLmV2ZW50cy5kaWRFbnRlclN0YXRlLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgY29uc3QgY3VyclN0YXR1cyA9IHRvTmV3Q29ubmVjdGlvblN0YXR1cyhtYWNoaW5lKTtcbiAgICBpZiAoY3VyclN0YXR1cyAhPT0gbGFzdFN0YXR1cykge1xuICAgICAgc3RhdHVzRGlkQ2hhbmdlLm5vdGlmeShjdXJyU3RhdHVzKTtcbiAgICB9XG4gICAgaWYgKGxhc3RTdGF0dXMgPT09IFwiY29ubmVjdGVkXCIgJiYgY3VyclN0YXR1cyAhPT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgZGlkRGlzY29ubmVjdC5ub3RpZnkoKTtcbiAgICB9IGVsc2UgaWYgKGxhc3RTdGF0dXMgIT09IFwiY29ubmVjdGVkXCIgJiYgY3VyclN0YXR1cyA9PT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgZGlkQ29ubmVjdC5ub3RpZnkoKTtcbiAgICB9XG4gICAgbGFzdFN0YXR1cyA9IGN1cnJTdGF0dXM7XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIHN0YXR1c0RpZENoYW5nZTogc3RhdHVzRGlkQ2hhbmdlLm9ic2VydmFibGUsXG4gICAgZGlkQ29ubmVjdDogZGlkQ29ubmVjdC5vYnNlcnZhYmxlLFxuICAgIGRpZERpc2Nvbm5lY3Q6IGRpZERpc2Nvbm5lY3Qub2JzZXJ2YWJsZSxcbiAgICB1bnN1YnNjcmliZVxuICB9O1xufVxudmFyIGFzc2lnbiA9IChwYXRjaCkgPT4gKGN0eCkgPT4gY3R4LnBhdGNoKHBhdGNoKTtcbmZ1bmN0aW9uIGNyZWF0ZUNvbm5lY3Rpb25TdGF0ZU1hY2hpbmUoZGVsZWdhdGVzLCBvcHRpb25zKSB7XG4gIGNvbnN0IG9uTWVzc2FnZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICBvbk1lc3NhZ2UucGF1c2UoKTtcbiAgY29uc3Qgb25MaXZlYmxvY2tzRXJyb3IgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgZnVuY3Rpb24gZmlyZUVycm9yRXZlbnQoZXJybXNnLCBlcnJjb2RlKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IGVyciA9IG5ldyBMaXZlYmxvY2tzRXJyb3IoZXJybXNnLCBlcnJjb2RlKTtcbiAgICAgIG9uTGl2ZWJsb2Nrc0Vycm9yLm5vdGlmeShlcnIpO1xuICAgIH07XG4gIH1cbiAgY29uc3QgaW5pdGlhbENvbnRleHQgPSB7XG4gICAgc3VjY2Vzc0NvdW50OiAwLFxuICAgIGF1dGhWYWx1ZTogbnVsbCxcbiAgICBzb2NrZXQ6IG51bGwsXG4gICAgYmFja29mZkRlbGF5OiBSRVNFVF9ERUxBWVxuICB9O1xuICBjb25zdCBtYWNoaW5lID0gbmV3IEZTTShpbml0aWFsQ29udGV4dCkuYWRkU3RhdGUoXCJAaWRsZS5pbml0aWFsXCIpLmFkZFN0YXRlKFwiQGlkbGUuZmFpbGVkXCIpLmFkZFN0YXRlKFwiQGlkbGUuem9tYmllXCIpLmFkZFN0YXRlKFwiQGF1dGguYnVzeVwiKS5hZGRTdGF0ZShcIkBhdXRoLmJhY2tvZmZcIikuYWRkU3RhdGUoXCJAY29ubmVjdGluZy5idXN5XCIpLmFkZFN0YXRlKFwiQGNvbm5lY3RpbmcuYmFja29mZlwiKS5hZGRTdGF0ZShcIkBvay5jb25uZWN0ZWRcIikuYWRkU3RhdGUoXCJAb2suYXdhaXRpbmctcG9uZ1wiKTtcbiAgbWFjaGluZS5hZGRUcmFuc2l0aW9ucyhcIipcIiwge1xuICAgIFJFQ09OTkVDVDoge1xuICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCByZXNldFN1Y2Nlc3NDb3VudF1cbiAgICB9LFxuICAgIERJU0NPTk5FQ1Q6IFwiQGlkbGUuaW5pdGlhbFwiXG4gIH0pO1xuICBtYWNoaW5lLm9uRW50ZXIoXCJAaWRsZS4qXCIsIHJlc2V0U3VjY2Vzc0NvdW50KS5hZGRUcmFuc2l0aW9ucyhcIkBpZGxlLipcIiwge1xuICAgIENPTk5FQ1Q6IChfLCBjdHgpID0+IChcbiAgICAgIC8vIElmIHdlIHN0aWxsIGhhdmUgYSBrbm93biBhdXRoVmFsdWUsIHRyeSB0byByZWNvbm5lY3QgdG8gdGhlIHNvY2tldCBkaXJlY3RseSxcbiAgICAgIC8vIG90aGVyd2lzZSwgdHJ5IHRvIG9idGFpbiBhIG5ldyBhdXRoVmFsdWVcbiAgICAgIGN0eC5hdXRoVmFsdWUgIT09IG51bGwgPyBcIkBjb25uZWN0aW5nLmJ1c3lcIiA6IFwiQGF1dGguYnVzeVwiXG4gICAgKVxuICB9KTtcbiAgbWFjaGluZS5hZGRUcmFuc2l0aW9ucyhcIkBhdXRoLmJhY2tvZmZcIiwge1xuICAgIE5BVklHQVRPUl9PTkxJTkU6IHtcbiAgICAgIHRhcmdldDogXCJAYXV0aC5idXN5XCIsXG4gICAgICBlZmZlY3Q6IGFzc2lnbih7IGJhY2tvZmZEZWxheTogUkVTRVRfREVMQVkgfSlcbiAgICB9XG4gIH0pLmFkZFRpbWVkVHJhbnNpdGlvbihcbiAgICBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAoY3R4KSA9PiBjdHguYmFja29mZkRlbGF5LFxuICAgIFwiQGF1dGguYnVzeVwiXG4gICkub25FbnRlckFzeW5jKFxuICAgIFwiQGF1dGguYnVzeVwiLFxuICAgICgpID0+IHdpdGhUaW1lb3V0KFxuICAgICAgZGVsZWdhdGVzLmF1dGhlbnRpY2F0ZSgpLFxuICAgICAgQVVUSF9USU1FT1VULFxuICAgICAgXCJUaW1lZCBvdXQgZHVyaW5nIGF1dGhcIlxuICAgICksXG4gICAgLy8gT24gc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvblxuICAgIChva0V2ZW50KSA9PiAoe1xuICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJ1c3lcIixcbiAgICAgIGVmZmVjdDogYXNzaWduKHtcbiAgICAgICAgYXV0aFZhbHVlOiBva0V2ZW50LmRhdGFcbiAgICAgIH0pXG4gICAgfSksXG4gICAgLy8gQXV0aCBmYWlsZWRcbiAgICAoZmFpbGVkRXZlbnQpID0+IHtcbiAgICAgIGlmIChmYWlsZWRFdmVudC5yZWFzb24gaW5zdGFuY2VvZiBTdG9wUmV0cnlpbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0YXJnZXQ6IFwiQGlkbGUuZmFpbGVkXCIsXG4gICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICBsb2coMiAvKiBFUlJPUiAqLywgZmFpbGVkRXZlbnQucmVhc29uLm1lc3NhZ2UpLFxuICAgICAgICAgICAgZmlyZUVycm9yRXZlbnQoZmFpbGVkRXZlbnQucmVhc29uLm1lc3NhZ2UsIC0xKVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldDogXCJAYXV0aC5iYWNrb2ZmXCIsXG4gICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgIGluY3JlYXNlQmFja29mZkRlbGF5LFxuICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgIDIgLyogRVJST1IgKi8sXG4gICAgICAgICAgICBgQXV0aGVudGljYXRpb24gZmFpbGVkOiAke2ZhaWxlZEV2ZW50LnJlYXNvbiBpbnN0YW5jZW9mIEVycm9yID8gZmFpbGVkRXZlbnQucmVhc29uLm1lc3NhZ2UgOiBTdHJpbmcoZmFpbGVkRXZlbnQucmVhc29uKX1gXG4gICAgICAgICAgKVxuICAgICAgICBdXG4gICAgICB9O1xuICAgIH1cbiAgKTtcbiAgY29uc3Qgb25Tb2NrZXRFcnJvciA9IChldmVudCkgPT4gbWFjaGluZS5zZW5kKHsgdHlwZTogXCJFWFBMSUNJVF9TT0NLRVRfRVJST1JcIiwgZXZlbnQgfSk7XG4gIGNvbnN0IG9uU29ja2V0Q2xvc2UgPSAoZXZlbnQpID0+IG1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiRVhQTElDSVRfU09DS0VUX0NMT1NFXCIsIGV2ZW50IH0pO1xuICBjb25zdCBvblNvY2tldE1lc3NhZ2UgPSAoZXZlbnQpID0+IGV2ZW50LmRhdGEgPT09IFwicG9uZ1wiID8gbWFjaGluZS5zZW5kKHsgdHlwZTogXCJQT05HXCIgfSkgOiBvbk1lc3NhZ2Uubm90aWZ5KGV2ZW50KTtcbiAgZnVuY3Rpb24gdGVhcmRvd25Tb2NrZXQoc29ja2V0KSB7XG4gICAgaWYgKHNvY2tldCkge1xuICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCBvblNvY2tldEVycm9yKTtcbiAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgb25Tb2NrZXRDbG9zZSk7XG4gICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgb25Tb2NrZXRNZXNzYWdlKTtcbiAgICAgIHNvY2tldC5jbG9zZSgpO1xuICAgIH1cbiAgfVxuICBtYWNoaW5lLmFkZFRyYW5zaXRpb25zKFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLCB7XG4gICAgTkFWSUdBVE9SX09OTElORToge1xuICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJ1c3lcIixcbiAgICAgIGVmZmVjdDogYXNzaWduKHsgYmFja29mZkRlbGF5OiBSRVNFVF9ERUxBWSB9KVxuICAgIH1cbiAgfSkuYWRkVGltZWRUcmFuc2l0aW9uKFxuICAgIFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLFxuICAgIChjdHgpID0+IGN0eC5iYWNrb2ZmRGVsYXksXG4gICAgXCJAY29ubmVjdGluZy5idXN5XCJcbiAgKS5vbkVudGVyQXN5bmMoXG4gICAgXCJAY29ubmVjdGluZy5idXN5XCIsXG4gICAgLy9cbiAgICAvLyBVc2UgdGhlIFwiY3JlYXRlU29ja2V0XCIgZGVsZWdhdGUgZnVuY3Rpb24gKHByb3ZpZGVkIHRvIHRoZVxuICAgIC8vIE1hbmFnZWRTb2NrZXQpIHRvIGNyZWF0ZSB0aGUgYWN0dWFsIFdlYlNvY2tldCBjb25uZWN0aW9uIGluc3RhbmNlLlxuICAgIC8vIFRoZW4sIHNldCB1cCBhbGwgdGhlIG5lY2Vzc2FyeSBldmVudCBsaXN0ZW5lcnMsIGFuZCB3YWl0IGZvciB0aGVcbiAgICAvLyBcIm9wZW5cIiBldmVudCB0byBvY2N1ci5cbiAgICAvL1xuICAgIC8vIFdoZW4gdGhlIFwib3BlblwiIGV2ZW50IGhhcHBlbnMsIHdlJ3JlIHJlYWR5IHRvIHRyYW5zaXRpb24gdG8gdGhlXG4gICAgLy8gT0sgc3RhdGUuIFRoaXMgaXMgZG9uZSBieSByZXNvbHZpbmcgdGhlIFByb21pc2UuXG4gICAgLy9cbiAgICBhc3luYyAoY3R4LCBzaWduYWwpID0+IHtcbiAgICAgIGxldCBjYXB0dXJlZFByZW1hdHVyZUV2ZW50ID0gbnVsbDtcbiAgICAgIGxldCB1bmNvbmZpcm1lZFNvY2tldCA9IG51bGw7XG4gICAgICBjb25zdCBjb25uZWN0JCA9IG5ldyBQcm9taXNlKFxuICAgICAgICAocmVzb2x2ZSwgcmVqKSA9PiB7XG4gICAgICAgICAgaWYgKGN0eC5hdXRoVmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGF1dGggYXV0aFZhbHVlXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBzb2NrZXQgPSBkZWxlZ2F0ZXMuY3JlYXRlU29ja2V0KGN0eC5hdXRoVmFsdWUpO1xuICAgICAgICAgIHVuY29uZmlybWVkU29ja2V0ID0gc29ja2V0O1xuICAgICAgICAgIGZ1bmN0aW9uIHJlamVjdChldmVudCkge1xuICAgICAgICAgICAgY2FwdHVyZWRQcmVtYXR1cmVFdmVudCA9IGV2ZW50O1xuICAgICAgICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG9uU29ja2V0TWVzc2FnZSk7XG4gICAgICAgICAgICByZWooZXZlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBbYWN0b3IkLCBkaWRSZWNlaXZlQWN0b3JdID0gY29udHJvbGxlZFByb21pc2UoKTtcbiAgICAgICAgICBpZiAoIW9wdGlvbnMud2FpdEZvckFjdG9ySWQpIHtcbiAgICAgICAgICAgIGRpZFJlY2VpdmVBY3RvcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmdW5jdGlvbiB3YWl0Rm9yQWN0b3JJZChldmVudCkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyTXNnID0gdHJ5UGFyc2VKc29uKGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgaWYgKHNlcnZlck1zZz8udHlwZSA9PT0gMTA0IC8qIFJPT01fU1RBVEUgKi8pIHtcbiAgICAgICAgICAgICAgZGlkUmVjZWl2ZUFjdG9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBvblNvY2tldE1lc3NhZ2UpO1xuICAgICAgICAgIGlmIChvcHRpb25zLndhaXRGb3JBY3RvcklkKSB7XG4gICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgd2FpdEZvckFjdG9ySWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIHJlamVjdCk7XG4gICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCByZWplY3QpO1xuICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwib3BlblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIG9uU29ja2V0RXJyb3IpO1xuICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCBvblNvY2tldENsb3NlKTtcbiAgICAgICAgICAgIGNvbnN0IHVuc3ViID0gKCkgPT4ge1xuICAgICAgICAgICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIHJlamVjdCk7XG4gICAgICAgICAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgc29ja2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIHdhaXRGb3JBY3RvcklkKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2b2lkIGFjdG9yJC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShbc29ja2V0LCB1bnN1Yl0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gd2l0aFRpbWVvdXQoXG4gICAgICAgIGNvbm5lY3QkLFxuICAgICAgICBTT0NLRVRfQ09OTkVDVF9USU1FT1VULFxuICAgICAgICBcIlRpbWVkIG91dCBkdXJpbmcgd2Vic29ja2V0IGNvbm5lY3Rpb25cIlxuICAgICAgKS50aGVuKFxuICAgICAgICAvL1xuICAgICAgICAvLyBQYXJ0IDM6XG4gICAgICAgIC8vIEJ5IG5vdywgb3VyIFwib3BlblwiIGV2ZW50IGhhcyBmaXJlZCwgYW5kIHRoZSBwcm9taXNlIGhhcyBiZWVuXG4gICAgICAgIC8vIHJlc29sdmVkLiBUd28gcG9zc2libGUgc2NlbmFyaW9zOlxuICAgICAgICAvL1xuICAgICAgICAvLyAxLiBUaGUgaGFwcHkgcGF0aC4gTW9zdCBsaWtlbHkuXG4gICAgICAgIC8vIDIuIFVoLW9oLiBBIHByZW1hdHVyZSBjbG9zZS9lcnJvciBldmVudCBoYXMgYmVlbiBvYnNlcnZlZC4gTGV0J3NcbiAgICAgICAgLy8gICAgcmVqZWN0IHRoZSBwcm9taXNlIGFmdGVyIGFsbC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gQW55IGNsb3NlL2Vycm9yIGV2ZW50IHRoYXQgd2lsbCBnZXQgc2NoZWR1bGVkIGFmdGVyIHRoaXMgcG9pbnRcbiAgICAgICAgLy8gb253YXJkcywgd2lsbCBiZSBjYXVnaHQgaW4gdGhlIE9LIHN0YXRlLCBhbmQgZGVhbHQgd2l0aFxuICAgICAgICAvLyBhY2NvcmRpbmdseS5cbiAgICAgICAgLy9cbiAgICAgICAgKFtzb2NrZXQsIHVuc3ViXSkgPT4ge1xuICAgICAgICAgIHVuc3ViKCk7XG4gICAgICAgICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBYm9ydGVkXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2FwdHVyZWRQcmVtYXR1cmVFdmVudCkge1xuICAgICAgICAgICAgdGhyb3cgY2FwdHVyZWRQcmVtYXR1cmVFdmVudDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNvY2tldDtcbiAgICAgICAgfVxuICAgICAgKS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICB0ZWFyZG93blNvY2tldCh1bmNvbmZpcm1lZFNvY2tldCk7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8vIE9ubHkgdHJhbnNpdGlvbiB0byBPSyBzdGF0ZSBhZnRlciBhIHN1Y2Nlc3NmdWxseSBvcGVuZWQgV2ViU29ja2V0IGNvbm5lY3Rpb25cbiAgICAob2tFdmVudCkgPT4gKHtcbiAgICAgIHRhcmdldDogXCJAb2suY29ubmVjdGVkXCIsXG4gICAgICBlZmZlY3Q6IGFzc2lnbih7XG4gICAgICAgIHNvY2tldDogb2tFdmVudC5kYXRhLFxuICAgICAgICBiYWNrb2ZmRGVsYXk6IFJFU0VUX0RFTEFZXG4gICAgICB9KVxuICAgIH0pLFxuICAgIC8vIElmIHRoZSBXZWJTb2NrZXQgY29ubmVjdGlvbiBjYW5ub3QgYmUgZXN0YWJsaXNoZWRcbiAgICAoZmFpbHVyZSkgPT4ge1xuICAgICAgY29uc3QgZXJyID0gZmFpbHVyZS5yZWFzb247XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgU3RvcFJldHJ5aW5nKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGFyZ2V0OiBcIkBpZGxlLmZhaWxlZFwiLFxuICAgICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgICAgbG9nKDIgLyogRVJST1IgKi8sIGVyci5tZXNzYWdlKSxcbiAgICAgICAgICAgIGZpcmVFcnJvckV2ZW50KGVyci5tZXNzYWdlLCAtMSlcbiAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoaXNDbG9zZUV2ZW50KGVycikpIHtcbiAgICAgICAgaWYgKGVyci5jb2RlID09PSA0MTA5IC8qIFRPS0VOX0VYUElSRUQgKi8pIHtcbiAgICAgICAgICByZXR1cm4gXCJAYXV0aC5idXN5XCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNob3VsZFJldHJ5V2l0aG91dFJlYXV0aChlcnIuY29kZSkpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJhY2tvZmZcIixcbiAgICAgICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgICAgICBpbmNyZWFzZUJhY2tvZmZEZWxheUFnZ3Jlc3NpdmVseSxcbiAgICAgICAgICAgICAgbG9nUHJlbWF0dXJlRXJyb3JPckNsb3NlRXZlbnQoZXJyKVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNob3VsZERpc2Nvbm5lY3QoZXJyLmNvZGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhcmdldDogXCJAaWRsZS5mYWlsZWRcIixcbiAgICAgICAgICAgIGVmZmVjdDogW1xuICAgICAgICAgICAgICBsb2coMiAvKiBFUlJPUiAqLywgZXJyLnJlYXNvbiksXG4gICAgICAgICAgICAgIGZpcmVFcnJvckV2ZW50KGVyci5yZWFzb24sIGVyci5jb2RlKVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldDogXCJAYXV0aC5iYWNrb2ZmXCIsXG4gICAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCBsb2dQcmVtYXR1cmVFcnJvck9yQ2xvc2VFdmVudChlcnIpXVxuICAgICAgfTtcbiAgICB9XG4gICk7XG4gIGNvbnN0IHNlbmRIZWFydGJlYXQgPSB7XG4gICAgdGFyZ2V0OiBcIkBvay5hd2FpdGluZy1wb25nXCIsXG4gICAgZWZmZWN0OiAoY3R4KSA9PiB7XG4gICAgICBjdHguc29ja2V0Py5zZW5kKFwicGluZ1wiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IG1heWJlSGVhcnRiZWF0ID0gKCkgPT4ge1xuICAgIGNvbnN0IGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGRvY3VtZW50IDogdm9pZCAwO1xuICAgIGNvbnN0IGNhblpvbWJpZSA9IGRvYz8udmlzaWJpbGl0eVN0YXRlID09PSBcImhpZGRlblwiICYmIGRlbGVnYXRlcy5jYW5ab21iaWUoKTtcbiAgICByZXR1cm4gY2FuWm9tYmllID8gXCJAaWRsZS56b21iaWVcIiA6IHNlbmRIZWFydGJlYXQ7XG4gIH07XG4gIG1hY2hpbmUuYWRkVGltZWRUcmFuc2l0aW9uKFwiQG9rLmNvbm5lY3RlZFwiLCBIRUFSVEJFQVRfSU5URVJWQUwsIG1heWJlSGVhcnRiZWF0KS5hZGRUcmFuc2l0aW9ucyhcIkBvay5jb25uZWN0ZWRcIiwge1xuICAgIE5BVklHQVRPUl9PRkZMSU5FOiBtYXliZUhlYXJ0YmVhdCxcbiAgICAvLyBEb24ndCB0YWtlIHRoZSBicm93c2VyJ3Mgd29yZCBmb3IgaXQgd2hlbiBpdCBzYXlzIGl0J3Mgb2ZmbGluZS4gRG8gYSBwaW5nL3BvbmcgdG8gbWFrZSBzdXJlLlxuICAgIFdJTkRPV19HT1RfRk9DVVM6IHNlbmRIZWFydGJlYXRcbiAgfSk7XG4gIG1hY2hpbmUuYWRkVHJhbnNpdGlvbnMoXCJAaWRsZS56b21iaWVcIiwge1xuICAgIFdJTkRPV19HT1RfRk9DVVM6IFwiQGNvbm5lY3RpbmcuYmFja29mZlwiXG4gICAgLy8gV2hlbiBpbiB6b21iaWUgc3RhdGUsIHRoZSBjbGllbnQgd2lsbCB0cnkgdG8gd2FrZSB1cCBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIHdpbmRvdyByZWdhaW5zIGZvY3VzXG4gIH0pO1xuICBtYWNoaW5lLm9uRW50ZXIoXCJAb2suKlwiLCAoY3R4KSA9PiB7XG4gICAgY3R4LnBhdGNoKHsgc3VjY2Vzc0NvdW50OiBjdHguc3VjY2Vzc0NvdW50ICsgMSB9KTtcbiAgICBjb25zdCB0aW1lcklEID0gc2V0VGltZW91dChcbiAgICAgIC8vIE9uIHRoZSBuZXh0IHRpY2ssIHN0YXJ0IGRlbGl2ZXJpbmcgYWxsIG1lc3NhZ2VzIHRoYXQgaGF2ZSBhbHJlYWR5XG4gICAgICAvLyBiZWVuIHJlY2VpdmVkLCBhbmQgY29udGludWUgc3luY2hyb25vdXMgZGVsaXZlcnkgb2YgYWxsIGZ1dHVyZVxuICAgICAgLy8gaW5jb21pbmcgbWVzc2FnZXMuXG4gICAgICBvbk1lc3NhZ2UudW5wYXVzZSxcbiAgICAgIDBcbiAgICApO1xuICAgIHJldHVybiAoY3R4MikgPT4ge1xuICAgICAgdGVhcmRvd25Tb2NrZXQoY3R4Mi5zb2NrZXQpO1xuICAgICAgY3R4Mi5wYXRjaCh7IHNvY2tldDogbnVsbCB9KTtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcklEKTtcbiAgICAgIG9uTWVzc2FnZS5wYXVzZSgpO1xuICAgIH07XG4gIH0pLmFkZFRyYW5zaXRpb25zKFwiQG9rLmF3YWl0aW5nLXBvbmdcIiwgeyBQT05HOiBcIkBvay5jb25uZWN0ZWRcIiB9KS5hZGRUaW1lZFRyYW5zaXRpb24oXCJAb2suYXdhaXRpbmctcG9uZ1wiLCBQT05HX1RJTUVPVVQsIHtcbiAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYnVzeVwiLFxuICAgIC8vIExvZyBpbXBsaWNpdCBjb25uZWN0aW9uIGxvc3MgYW5kIGRyb3AgdGhlIGN1cnJlbnQgb3BlbiBzb2NrZXRcbiAgICBlZmZlY3Q6IGxvZyhcbiAgICAgIDEgLyogV0FSTiAqLyxcbiAgICAgIFwiUmVjZWl2ZWQgbm8gcG9uZyBmcm9tIHNlcnZlciwgYXNzdW1lIGltcGxpY2l0IGNvbm5lY3Rpb24gbG9zcy5cIlxuICAgIClcbiAgfSkuYWRkVHJhbnNpdGlvbnMoXCJAb2suKlwiLCB7XG4gICAgLy8gV2hlbiBhIHNvY2tldCByZWNlaXZlcyBhbiBlcnJvciwgdGhpcyBjYW4gY2F1c2UgdGhlIGNsb3Npbmcgb2YgdGhlXG4gICAgLy8gc29ja2V0LCBvciBub3QuIFNvIGFsd2F5cyBjaGVjayB0byBzZWUgaWYgdGhlIHNvY2tldCBpcyBzdGlsbCBPUEVOIG9yXG4gICAgLy8gbm90LiBXaGVuIHN0aWxsIE9QRU4sIGRvbid0IHRyYW5zaXRpb24uXG4gICAgRVhQTElDSVRfU09DS0VUX0VSUk9SOiAoXywgY29udGV4dCkgPT4ge1xuICAgICAgaWYgKGNvbnRleHQuc29ja2V0Py5yZWFkeVN0YXRlID09PSAxKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0OiBcIkBjb25uZWN0aW5nLmJhY2tvZmZcIixcbiAgICAgICAgZWZmZWN0OiBpbmNyZWFzZUJhY2tvZmZEZWxheVxuICAgICAgfTtcbiAgICB9LFxuICAgIEVYUExJQ0lUX1NPQ0tFVF9DTE9TRTogKGUpID0+IHtcbiAgICAgIGlmIChzaG91bGREaXNjb25uZWN0KGUuZXZlbnQuY29kZSkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0YXJnZXQ6IFwiQGlkbGUuZmFpbGVkXCIsXG4gICAgICAgICAgZWZmZWN0OiBbXG4gICAgICAgICAgICBsb2dQZXJtYW5lbnRDbG9zZSxcbiAgICAgICAgICAgIGZpcmVFcnJvckV2ZW50KGUuZXZlbnQucmVhc29uLCBlLmV2ZW50LmNvZGUpXG4gICAgICAgICAgXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHNob3VsZFJlYXV0aChlLmV2ZW50LmNvZGUpKSB7XG4gICAgICAgIGlmIChlLmV2ZW50LmNvZGUgPT09IDQxMDkgLyogVE9LRU5fRVhQSVJFRCAqLykge1xuICAgICAgICAgIHJldHVybiBcIkBhdXRoLmJ1c3lcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFyZ2V0OiBcIkBhdXRoLmJhY2tvZmZcIixcbiAgICAgICAgICAgIGVmZmVjdDogW2luY3JlYXNlQmFja29mZkRlbGF5LCBsb2dDbG9zZUV2ZW50KGUuZXZlbnQpXVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzaG91bGRSZXRyeVdpdGhvdXRSZWF1dGgoZS5ldmVudC5jb2RlKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRhcmdldDogXCJAY29ubmVjdGluZy5iYWNrb2ZmXCIsXG4gICAgICAgICAgZWZmZWN0OiBbaW5jcmVhc2VCYWNrb2ZmRGVsYXlBZ2dyZXNzaXZlbHksIGxvZ0Nsb3NlRXZlbnQoZS5ldmVudCldXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0YXJnZXQ6IFwiQGNvbm5lY3RpbmcuYmFja29mZlwiLFxuICAgICAgICBlZmZlY3Q6IFtpbmNyZWFzZUJhY2tvZmZEZWxheSwgbG9nQ2xvc2VFdmVudChlLmV2ZW50KV1cbiAgICAgIH07XG4gICAgfVxuICB9KTtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGNvbnN0IGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGRvY3VtZW50IDogdm9pZCAwO1xuICAgIGNvbnN0IHdpbiA9IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB2b2lkIDA7XG4gICAgY29uc3Qgcm9vdCA9IHdpbiA/PyBkb2M7XG4gICAgbWFjaGluZS5vbkVudGVyKFwiKlwiLCAoY3R4KSA9PiB7XG4gICAgICBmdW5jdGlvbiBvbk5ldHdvcmtPZmZsaW5lKCkge1xuICAgICAgICBtYWNoaW5lLnNlbmQoeyB0eXBlOiBcIk5BVklHQVRPUl9PRkZMSU5FXCIgfSk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBvbk5ldHdvcmtCYWNrT25saW5lKCkge1xuICAgICAgICBtYWNoaW5lLnNlbmQoeyB0eXBlOiBcIk5BVklHQVRPUl9PTkxJTkVcIiB9KTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIG9uVmlzaWJpbGl0eUNoYW5nZSgpIHtcbiAgICAgICAgaWYgKGRvYz8udmlzaWJpbGl0eVN0YXRlID09PSBcInZpc2libGVcIikge1xuICAgICAgICAgIG1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiV0lORE9XX0dPVF9GT0NVU1wiIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB3aW4/LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmxpbmVcIiwgb25OZXR3b3JrQmFja09ubGluZSk7XG4gICAgICB3aW4/LmFkZEV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIG9uTmV0d29ya09mZmxpbmUpO1xuICAgICAgcm9vdD8uYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgb25WaXNpYmlsaXR5Q2hhbmdlKTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIHJvb3Q/LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIG9uVmlzaWJpbGl0eUNoYW5nZSk7XG4gICAgICAgIHdpbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCBvbk5ldHdvcmtCYWNrT25saW5lKTtcbiAgICAgICAgd2luPy5yZW1vdmVFdmVudExpc3RlbmVyKFwib2ZmbGluZVwiLCBvbk5ldHdvcmtPZmZsaW5lKTtcbiAgICAgICAgdGVhcmRvd25Tb2NrZXQoY3R4LnNvY2tldCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG4gIGNvbnN0IGNsZWFudXBzID0gW107XG4gIGNvbnN0IHsgc3RhdHVzRGlkQ2hhbmdlLCBkaWRDb25uZWN0LCBkaWREaXNjb25uZWN0LCB1bnN1YnNjcmliZSB9ID0gZGVmaW5lQ29ubmVjdGl2aXR5RXZlbnRzKG1hY2hpbmUpO1xuICBjbGVhbnVwcy5wdXNoKHVuc3Vic2NyaWJlKTtcbiAgaWYgKG9wdGlvbnMuZW5hYmxlRGVidWdMb2dnaW5nKSB7XG4gICAgY2xlYW51cHMucHVzaChlbmFibGVUcmFjaW5nKG1hY2hpbmUpKTtcbiAgfVxuICBtYWNoaW5lLnN0YXJ0KCk7XG4gIHJldHVybiB7XG4gICAgbWFjaGluZSxcbiAgICBjbGVhbnVwcyxcbiAgICAvLyBPYnNlcnZhYmxlIGV2ZW50cyB0aGF0IHdpbGwgYmUgZW1pdHRlZCBieSB0aGlzIG1hY2hpbmVcbiAgICBldmVudHM6IHtcbiAgICAgIHN0YXR1c0RpZENoYW5nZSxcbiAgICAgIGRpZENvbm5lY3QsXG4gICAgICBkaWREaXNjb25uZWN0LFxuICAgICAgb25NZXNzYWdlOiBvbk1lc3NhZ2Uub2JzZXJ2YWJsZSxcbiAgICAgIG9uTGl2ZWJsb2Nrc0Vycm9yOiBvbkxpdmVibG9ja3NFcnJvci5vYnNlcnZhYmxlXG4gICAgfVxuICB9O1xufVxudmFyIE1hbmFnZWRTb2NrZXQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGRlbGVnYXRlcywgZW5hYmxlRGVidWdMb2dnaW5nID0gZmFsc2UsIHdhaXRGb3JBY3RvcklkID0gdHJ1ZSkge1xuICAgIGNvbnN0IHsgbWFjaGluZSwgZXZlbnRzLCBjbGVhbnVwcyB9ID0gY3JlYXRlQ29ubmVjdGlvblN0YXRlTWFjaGluZShcbiAgICAgIGRlbGVnYXRlcyxcbiAgICAgIHsgd2FpdEZvckFjdG9ySWQsIGVuYWJsZURlYnVnTG9nZ2luZyB9XG4gICAgKTtcbiAgICB0aGlzLm1hY2hpbmUgPSBtYWNoaW5lO1xuICAgIHRoaXMuZXZlbnRzID0gZXZlbnRzO1xuICAgIHRoaXMuY2xlYW51cHMgPSBjbGVhbnVwcztcbiAgfVxuICBnZXRTdGF0dXMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB0b05ld0Nvbm5lY3Rpb25TdGF0dXModGhpcy5tYWNoaW5lKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBcImluaXRpYWxcIjtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgYXV0aCBhdXRoVmFsdWUuXG4gICAqL1xuICBnZXQgYXV0aFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLm1hY2hpbmUuY29udGV4dC5hdXRoVmFsdWU7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgdGhpcyBtZXRob2QgdG8gdHJ5IHRvIGNvbm5lY3QgdG8gYSBXZWJTb2NrZXQuIFRoaXMgb25seSBoYXMgYW4gZWZmZWN0XG4gICAqIGlmIHRoZSBtYWNoaW5lIGlzIGlkbGUgYXQgdGhlIG1vbWVudCwgb3RoZXJ3aXNlIHRoaXMgaXMgYSBuby1vcC5cbiAgICovXG4gIGNvbm5lY3QoKSB7XG4gICAgdGhpcy5tYWNoaW5lLnNlbmQoeyB0eXBlOiBcIkNPTk5FQ1RcIiB9KTtcbiAgfVxuICAvKipcbiAgICogSWYgaWRsZSwgd2lsbCB0cnkgdG8gY29ubmVjdC4gT3RoZXJ3aXNlLCBpdCB3aWxsIGF0dGVtcHQgdG8gcmVjb25uZWN0IHRvXG4gICAqIHRoZSBzb2NrZXQsIHBvdGVudGlhbGx5IG9idGFpbmluZyBhIG5ldyBhdXRoVmFsdWUgZmlyc3QsIGlmIG5lZWRlZC5cbiAgICovXG4gIHJlY29ubmVjdCgpIHtcbiAgICB0aGlzLm1hY2hpbmUuc2VuZCh7IHR5cGU6IFwiUkVDT05ORUNUXCIgfSk7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgdGhpcyBtZXRob2QgdG8gZGlzY29ubmVjdCBmcm9tIHRoZSBjdXJyZW50IFdlYlNvY2tldC4gSXMgZ29pbmcgdG8gYmVcbiAgICogYSBuby1vcCBpZiB0aGVyZSBpcyBubyBhY3RpdmUgY29ubmVjdGlvbi5cbiAgICovXG4gIGRpc2Nvbm5lY3QoKSB7XG4gICAgdGhpcy5tYWNoaW5lLnNlbmQoeyB0eXBlOiBcIkRJU0NPTk5FQ1RcIiB9KTtcbiAgfVxuICAvKipcbiAgICogQ2FsbCB0aGlzIHRvIHN0b3AgdGhlIG1hY2hpbmUgYW5kIHJ1biBuZWNlc3NhcnkgY2xlYW51cCBmdW5jdGlvbnMuIEFmdGVyXG4gICAqIGNhbGxpbmcgZGVzdHJveSgpLCB5b3UgY2FuIG5vIGxvbmdlciB1c2UgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzIGJlZm9yZVxuICAgKiBsZXR0aW5nIHRoZSBpbnN0YW5jZSBnZXQgZ2FyYmFnZSBjb2xsZWN0ZWQuXG4gICAqL1xuICBkZXN0cm95KCkge1xuICAgIHRoaXMubWFjaGluZS5zdG9wKCk7XG4gICAgbGV0IGNsZWFudXA7XG4gICAgd2hpbGUgKGNsZWFudXAgPSB0aGlzLmNsZWFudXBzLnBvcCgpKSB7XG4gICAgICBjbGVhbnVwKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBTYWZlbHkgc2VuZCBhIG1lc3NhZ2UgdG8gdGhlIGN1cnJlbnQgV2ViU29ja2V0IGNvbm5lY3Rpb24uIFdpbGwgZW1pdCBhIGxvZ1xuICAgKiBtZXNzYWdlIGlmIHRoaXMgaXMgc29tZWhvdyBpbXBvc3NpYmxlLlxuICAgKi9cbiAgc2VuZChkYXRhKSB7XG4gICAgY29uc3Qgc29ja2V0ID0gdGhpcy5tYWNoaW5lLmNvbnRleHQ/LnNvY2tldDtcbiAgICBpZiAoc29ja2V0ID09PSBudWxsKSB7XG4gICAgICB3YXJuKFwiQ2Fubm90IHNlbmQ6IG5vdCBjb25uZWN0ZWQgeWV0XCIsIGRhdGEpO1xuICAgIH0gZWxzZSBpZiAoc29ja2V0LnJlYWR5U3RhdGUgIT09IDEpIHtcbiAgICAgIHdhcm4oXCJDYW5ub3Qgc2VuZDogV2ViU29ja2V0IG5vIGxvbmdlciBvcGVuXCIsIGRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzb2NrZXQuc2VuZChkYXRhKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIE5PVEU6IFVzZWQgYnkgdGhlIEUyRSBhcHAgb25seSwgdG8gc2ltdWxhdGUgZXhwbGljaXQgZXZlbnRzLlxuICAgKiBOb3QgaWRlYWwgdG8ga2VlcCBleHBvc2VkIDooXG4gICAqL1xuICBfcHJpdmF0ZVNlbmRNYWNoaW5lRXZlbnQoZXZlbnQpIHtcbiAgICB0aGlzLm1hY2hpbmUuc2VuZChldmVudCk7XG4gIH1cbn07XG5cbi8vIHNyYy9wcm90b2NvbC9BdXRoVG9rZW4udHNcbmZ1bmN0aW9uIGNhbldyaXRlU3RvcmFnZShzY29wZXMpIHtcbiAgcmV0dXJuIHNjb3Blcy5pbmNsdWRlcyhcInJvb206d3JpdGVcIiAvKiBXcml0ZSAqLyk7XG59XG5mdW5jdGlvbiBjYW5Db21tZW50KHNjb3Blcykge1xuICByZXR1cm4gc2NvcGVzLmluY2x1ZGVzKFwiY29tbWVudHM6d3JpdGVcIiAvKiBDb21tZW50c1dyaXRlICovKSB8fCBzY29wZXMuaW5jbHVkZXMoXCJyb29tOndyaXRlXCIgLyogV3JpdGUgKi8pO1xufVxuZnVuY3Rpb24gaXNWYWxpZEF1dGhUb2tlblBheWxvYWQoZGF0YSkge1xuICByZXR1cm4gaXNQbGFpbk9iamVjdChkYXRhKSAmJiAoZGF0YS5rID09PSBcImFjY1wiIC8qIEFDQ0VTU19UT0tFTiAqLyB8fCBkYXRhLmsgPT09IFwiaWRcIiAvKiBJRF9UT0tFTiAqLyB8fCBkYXRhLmsgPT09IFwic2VjLWxlZ2FjeVwiIC8qIFNFQ1JFVF9MRUdBQ1kgKi8pO1xufVxuZnVuY3Rpb24gcGFyc2VBdXRoVG9rZW4ocmF3VG9rZW5TdHJpbmcpIHtcbiAgY29uc3QgdG9rZW5QYXJ0cyA9IHJhd1Rva2VuU3RyaW5nLnNwbGl0KFwiLlwiKTtcbiAgaWYgKHRva2VuUGFydHMubGVuZ3RoICE9PSAzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQXV0aGVudGljYXRpb24gZXJyb3I6IGludmFsaWQgSldUIHRva2VuXCIpO1xuICB9XG4gIGNvbnN0IHBheWxvYWQgPSB0cnlQYXJzZUpzb24oYjY0ZGVjb2RlKHRva2VuUGFydHNbMV0pKTtcbiAgaWYgKCEocGF5bG9hZCAmJiBpc1ZhbGlkQXV0aFRva2VuUGF5bG9hZChwYXlsb2FkKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIkF1dGhlbnRpY2F0aW9uIGVycm9yOiBleHBlY3RlZCBhIHZhbGlkIHRva2VuIGJ1dCBkaWQgbm90IGdldCBvbmUuIEhpbnQ6IGlmIHlvdSBhcmUgdXNpbmcgYSBjYWxsYmFjaywgZW5zdXJlIHRoZSByb29tIGlzIHBhc3NlZCB3aGVuIGNyZWF0aW5nIHRoZSB0b2tlbi4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1jbGllbnQjY3JlYXRlQ2xpZW50Q2FsbGJhY2tcIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICByYXc6IHJhd1Rva2VuU3RyaW5nLFxuICAgIHBhcnNlZDogcGF5bG9hZFxuICB9O1xufVxuXG4vLyBzcmMvYXV0aC1tYW5hZ2VyLnRzXG5mdW5jdGlvbiBjcmVhdGVBdXRoTWFuYWdlcihhdXRoT3B0aW9ucykge1xuICBjb25zdCBhdXRoZW50aWNhdGlvbiA9IHByZXBhcmVBdXRoZW50aWNhdGlvbihhdXRoT3B0aW9ucyk7XG4gIGNvbnN0IHNlZW5Ub2tlbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICBjb25zdCB0b2tlbnMgPSBbXTtcbiAgY29uc3QgZXhwaXJ5VGltZXMgPSBbXTtcbiAgY29uc3QgcmVxdWVzdFByb21pc2VzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgc2VlblRva2Vucy5jbGVhcigpO1xuICAgIHRva2Vucy5sZW5ndGggPSAwO1xuICAgIGV4cGlyeVRpbWVzLmxlbmd0aCA9IDA7XG4gICAgcmVxdWVzdFByb21pc2VzLmNsZWFyKCk7XG4gIH1cbiAgZnVuY3Rpb24gaGFzQ29ycmVzcG9uZGluZ1Njb3BlcyhyZXF1ZXN0ZWRTY29wZSwgc2NvcGVzKSB7XG4gICAgaWYgKHJlcXVlc3RlZFNjb3BlID09PSBcImNvbW1lbnRzOnJlYWRcIikge1xuICAgICAgcmV0dXJuIHNjb3Blcy5pbmNsdWRlcyhcImNvbW1lbnRzOnJlYWRcIiAvKiBDb21tZW50c1JlYWQgKi8pIHx8IHNjb3Blcy5pbmNsdWRlcyhcImNvbW1lbnRzOndyaXRlXCIgLyogQ29tbWVudHNXcml0ZSAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwicm9vbTpyZWFkXCIgLyogUmVhZCAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwicm9vbTp3cml0ZVwiIC8qIFdyaXRlICovKTtcbiAgICB9IGVsc2UgaWYgKHJlcXVlc3RlZFNjb3BlID09PSBcInJvb206cmVhZFwiKSB7XG4gICAgICByZXR1cm4gc2NvcGVzLmluY2x1ZGVzKFwicm9vbTpyZWFkXCIgLyogUmVhZCAqLykgfHwgc2NvcGVzLmluY2x1ZGVzKFwicm9vbTp3cml0ZVwiIC8qIFdyaXRlICovKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZ1bmN0aW9uIGdldENhY2hlZFRva2VuKHJlcXVlc3RPcHRpb25zKSB7XG4gICAgY29uc3Qgbm93ID0gTWF0aC5jZWlsKERhdGUubm93KCkgLyAxZTMpO1xuICAgIGZvciAobGV0IGkgPSB0b2tlbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2ldO1xuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gZXhwaXJ5VGltZXNbaV07XG4gICAgICBpZiAoZXhwaXJlc0F0IDw9IG5vdykge1xuICAgICAgICB0b2tlbnMuc3BsaWNlKGksIDEpO1xuICAgICAgICBleHBpcnlUaW1lcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKHRva2VuLnBhcnNlZC5rID09PSBcImlkXCIgLyogSURfVE9LRU4gKi8pIHtcbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgfSBlbHNlIGlmICh0b2tlbi5wYXJzZWQuayA9PT0gXCJhY2NcIiAvKiBBQ0NFU1NfVE9LRU4gKi8pIHtcbiAgICAgICAgaWYgKCFyZXF1ZXN0T3B0aW9ucy5yb29tSWQgJiYgT2JqZWN0LmVudHJpZXModG9rZW4ucGFyc2VkLnBlcm1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBbcmVzb3VyY2UsIHNjb3Blc10gb2YgT2JqZWN0LmVudHJpZXModG9rZW4ucGFyc2VkLnBlcm1zKSkge1xuICAgICAgICAgIGlmICghcmVxdWVzdE9wdGlvbnMucm9vbUlkKSB7XG4gICAgICAgICAgICBpZiAocmVzb3VyY2UuaW5jbHVkZXMoXCIqXCIpICYmIGhhc0NvcnJlc3BvbmRpbmdTY29wZXMocmVxdWVzdE9wdGlvbnMucmVxdWVzdGVkU2NvcGUsIHNjb3BlcykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAocmVzb3VyY2UuaW5jbHVkZXMoXCIqXCIpICYmIHJlcXVlc3RPcHRpb25zLnJvb21JZC5zdGFydHNXaXRoKHJlc291cmNlLnJlcGxhY2UoXCIqXCIsIFwiXCIpKSB8fCByZXF1ZXN0T3B0aW9ucy5yb29tSWQgPT09IHJlc291cmNlICYmIGhhc0NvcnJlc3BvbmRpbmdTY29wZXMocmVxdWVzdE9wdGlvbnMucmVxdWVzdGVkU2NvcGUsIHNjb3BlcykpIHtcbiAgICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYWtlQXV0aFJlcXVlc3Qob3B0aW9ucykge1xuICAgIGNvbnN0IGZldGNoZXIgPSBhdXRoT3B0aW9ucy5wb2x5ZmlsbHM/LmZldGNoID8/ICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiID8gdm9pZCAwIDogd2luZG93LmZldGNoKTtcbiAgICBpZiAoYXV0aGVudGljYXRpb24udHlwZSA9PT0gXCJwcml2YXRlXCIpIHtcbiAgICAgIGlmIChmZXRjaGVyID09PSB2b2lkIDApIHtcbiAgICAgICAgdGhyb3cgbmV3IFN0b3BSZXRyeWluZyhcbiAgICAgICAgICBcIlRvIHVzZSBMaXZlYmxvY2tzIGNsaWVudCBpbiBhIG5vbi1ET00gZW52aXJvbm1lbnQgd2l0aCBhIHVybCBhcyBhdXRoIGVuZHBvaW50LCB5b3UgbmVlZCB0byBwcm92aWRlIGEgZmV0Y2ggcG9seWZpbGwuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hBdXRoRW5kcG9pbnQoZmV0Y2hlciwgYXV0aGVudGljYXRpb24udXJsLCB7XG4gICAgICAgIHJvb206IG9wdGlvbnMucm9vbUlkXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlQXV0aFRva2VuKHJlc3BvbnNlLnRva2VuKTtcbiAgICAgIGlmIChzZWVuVG9rZW5zLmhhcyhwYXJzZWQucmF3KSkge1xuICAgICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKFxuICAgICAgICAgIFwiVGhlIHNhbWUgTGl2ZWJsb2NrcyBhdXRoIHRva2VuIHdhcyBpc3N1ZWQgZnJvbSB0aGUgYmFja2VuZCBiZWZvcmUuIENhY2hpbmcgTGl2ZWJsb2NrcyB0b2tlbnMgaXMgbm90IHN1cHBvcnRlZC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnNlZDtcbiAgICB9XG4gICAgaWYgKGF1dGhlbnRpY2F0aW9uLnR5cGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXV0aGVudGljYXRpb24uY2FsbGJhY2sob3B0aW9ucy5yb29tSWQpO1xuICAgICAgaWYgKHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLnRva2VuID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgY29uc3QgcGFyc2VkID0gcGFyc2VBdXRoVG9rZW4ocmVzcG9uc2UudG9rZW4pO1xuICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3BvbnNlLmVycm9yID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgY29uc3QgcmVhc29uID0gYEF1dGhlbnRpY2F0aW9uIGZhaWxlZDogJHtcInJlYXNvblwiIGluIHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZS5yZWFzb24gPT09IFwic3RyaW5nXCIgPyByZXNwb25zZS5yZWFzb24gOiBcIkZvcmJpZGRlblwifWA7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yID09PSBcImZvcmJpZGRlblwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKHJlYXNvbik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZWFzb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnWW91ciBhdXRoZW50aWNhdGlvbiBjYWxsYmFjayBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgdG9rZW4sIGJ1dCBpdCBkaWQgbm90LiBIaW50OiB0aGUgcmV0dXJuIHZhbHVlIHNob3VsZCBsb29rIGxpa2U6IHsgdG9rZW46IFwiLi4uXCIgfSdcbiAgICAgICk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiVW5leHBlY3RlZCBhdXRoZW50aWNhdGlvbiB0eXBlLiBNdXN0IGJlIHByaXZhdGUgb3IgY3VzdG9tLlwiXG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRBdXRoVmFsdWUocmVxdWVzdE9wdGlvbnMpIHtcbiAgICBpZiAoYXV0aGVudGljYXRpb24udHlwZSA9PT0gXCJwdWJsaWNcIikge1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJwdWJsaWNcIiwgcHVibGljQXBpS2V5OiBhdXRoZW50aWNhdGlvbi5wdWJsaWNBcGlLZXkgfTtcbiAgICB9XG4gICAgY29uc3QgY2FjaGVkVG9rZW4gPSBnZXRDYWNoZWRUb2tlbihyZXF1ZXN0T3B0aW9ucyk7XG4gICAgaWYgKGNhY2hlZFRva2VuICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwic2VjcmV0XCIsIHRva2VuOiBjYWNoZWRUb2tlbiB9O1xuICAgIH1cbiAgICBsZXQgY3VycmVudFByb21pc2U7XG4gICAgaWYgKHJlcXVlc3RPcHRpb25zLnJvb21JZCkge1xuICAgICAgY3VycmVudFByb21pc2UgPSByZXF1ZXN0UHJvbWlzZXMuZ2V0KHJlcXVlc3RPcHRpb25zLnJvb21JZCk7XG4gICAgICBpZiAoY3VycmVudFByb21pc2UgPT09IHZvaWQgMCkge1xuICAgICAgICBjdXJyZW50UHJvbWlzZSA9IG1ha2VBdXRoUmVxdWVzdChyZXF1ZXN0T3B0aW9ucyk7XG4gICAgICAgIHJlcXVlc3RQcm9taXNlcy5zZXQocmVxdWVzdE9wdGlvbnMucm9vbUlkLCBjdXJyZW50UHJvbWlzZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRQcm9taXNlID0gcmVxdWVzdFByb21pc2VzLmdldChcImxpdmVibG9ja3MtdXNlci10b2tlblwiKTtcbiAgICAgIGlmIChjdXJyZW50UHJvbWlzZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGN1cnJlbnRQcm9taXNlID0gbWFrZUF1dGhSZXF1ZXN0KHJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgcmVxdWVzdFByb21pc2VzLnNldChcImxpdmVibG9ja3MtdXNlci10b2tlblwiLCBjdXJyZW50UHJvbWlzZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGN1cnJlbnRQcm9taXNlO1xuICAgICAgY29uc3QgQlVGRkVSID0gMzA7XG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxZTMpICsgKHRva2VuLnBhcnNlZC5leHAgLSB0b2tlbi5wYXJzZWQuaWF0KSAtIEJVRkZFUjtcbiAgICAgIHNlZW5Ub2tlbnMuYWRkKHRva2VuLnJhdyk7XG4gICAgICBpZiAodG9rZW4ucGFyc2VkLmsgIT09IFwic2VjLWxlZ2FjeVwiIC8qIFNFQ1JFVF9MRUdBQ1kgKi8pIHtcbiAgICAgICAgdG9rZW5zLnB1c2godG9rZW4pO1xuICAgICAgICBleHBpcnlUaW1lcy5wdXNoKGV4cGlyZXNBdCk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyB0eXBlOiBcInNlY3JldFwiLCB0b2tlbiB9O1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpZiAocmVxdWVzdE9wdGlvbnMucm9vbUlkKSB7XG4gICAgICAgIHJlcXVlc3RQcm9taXNlcy5kZWxldGUocmVxdWVzdE9wdGlvbnMucm9vbUlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcXVlc3RQcm9taXNlcy5kZWxldGUoXCJsaXZlYmxvY2tzLXVzZXItdG9rZW5cIik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgcmVzZXQsXG4gICAgZ2V0QXV0aFZhbHVlXG4gIH07XG59XG5mdW5jdGlvbiBwcmVwYXJlQXV0aGVudGljYXRpb24oYXV0aE9wdGlvbnMpIHtcbiAgY29uc3QgeyBwdWJsaWNBcGlLZXksIGF1dGhFbmRwb2ludCB9ID0gYXV0aE9wdGlvbnM7XG4gIGlmIChhdXRoRW5kcG9pbnQgIT09IHZvaWQgMCAmJiBwdWJsaWNBcGlLZXkgIT09IHZvaWQgMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiWW91IGNhbm5vdCBzaW11bHRhbmVvdXNseSB1c2UgYHB1YmxpY0FwaUtleWAgYW5kIGBhdXRoRW5kcG9pbnRgIG9wdGlvbnMuIFBsZWFzZSBwaWNrIG9uZSBhbmQgbGVhdmUgdGhlIG90aGVyIG9wdGlvbiB1bnNwZWNpZmllZC4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1jbGllbnQjY3JlYXRlQ2xpZW50XCJcbiAgICApO1xuICB9XG4gIGlmICh0eXBlb2YgcHVibGljQXBpS2V5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgaWYgKHB1YmxpY0FwaUtleS5zdGFydHNXaXRoKFwic2tfXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiSW52YWxpZCBgcHVibGljQXBpS2V5YCBvcHRpb24uIFRoZSB2YWx1ZSB5b3UgcGFzc2VkIGlzIGEgc2VjcmV0IGtleSwgd2hpY2ggc2hvdWxkIG5vdCBiZSB1c2VkIGZyb20gdGhlIGNsaWVudC4gUGxlYXNlIG9ubHkgZXZlciBwYXNzIGEgcHVibGljIGtleSBoZXJlLiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRQdWJsaWNLZXlcIlxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKCFwdWJsaWNBcGlLZXkuc3RhcnRzV2l0aChcInBrX1wiKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkludmFsaWQga2V5LiBQbGVhc2UgdXNlIHRoZSBwdWJsaWMga2V5IGZvcm1hdDogcGtfPHB1YmxpYyBrZXk+LiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRQdWJsaWNLZXlcIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwicHVibGljXCIsXG4gICAgICBwdWJsaWNBcGlLZXlcbiAgICB9O1xuICB9XG4gIGlmICh0eXBlb2YgYXV0aEVuZHBvaW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwicHJpdmF0ZVwiLFxuICAgICAgdXJsOiBhdXRoRW5kcG9pbnRcbiAgICB9O1xuICB9IGVsc2UgaWYgKHR5cGVvZiBhdXRoRW5kcG9pbnQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcImN1c3RvbVwiLFxuICAgICAgY2FsbGJhY2s6IGF1dGhFbmRwb2ludFxuICAgIH07XG4gIH0gZWxzZSBpZiAoYXV0aEVuZHBvaW50ICE9PSB2b2lkIDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIlRoZSBgYXV0aEVuZHBvaW50YCBvcHRpb24gbXVzdCBiZSBhIHN0cmluZyBvciBhIGZ1bmN0aW9uLiBGb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvYXBpLXJlZmVyZW5jZS9saXZlYmxvY2tzLWNsaWVudCNjcmVhdGVDbGllbnRBdXRoRW5kcG9pbnRcIlxuICAgICk7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKFxuICAgIFwiSW52YWxpZCBMaXZlYmxvY2tzIGNsaWVudCBvcHRpb25zLiBQbGVhc2UgcHJvdmlkZSBlaXRoZXIgYSBgcHVibGljQXBpS2V5YCBvciBgYXV0aEVuZHBvaW50YCBvcHRpb24uIFRoZXkgY2Fubm90IGJvdGggYmUgZW1wdHkuIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3MtY2xpZW50I2NyZWF0ZUNsaWVudFwiXG4gICk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEF1dGhFbmRwb2ludChmZXRjaDIsIGVuZHBvaW50LCBib2R5KSB7XG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoMihlbmRwb2ludCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXG4gIH0pO1xuICBpZiAoIXJlcy5vaykge1xuICAgIGNvbnN0IHJlYXNvbiA9IGAkeyhhd2FpdCByZXMudGV4dCgpKS50cmltKCkgfHwgXCJyZWFzb24gbm90IHByb3ZpZGVkIGluIGF1dGggcmVzcG9uc2VcIn0gKCR7cmVzLnN0YXR1c30gcmV0dXJuZWQgYnkgUE9TVCAke2VuZHBvaW50fSlgO1xuICAgIGlmIChyZXMuc3RhdHVzID09PSA0MDEgfHwgcmVzLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKGBVbmF1dGhvcml6ZWQ6ICR7cmVhc29ufWApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBhdXRoZW50aWNhdGU6ICR7cmVhc29ufWApO1xuICAgIH1cbiAgfVxuICBsZXQgZGF0YTtcbiAgdHJ5IHtcbiAgICBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgfSBjYXRjaCAoZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgRXhwZWN0ZWQgYSBKU09OIHJlc3BvbnNlIHdoZW4gZG9pbmcgYSBQT1NUIHJlcXVlc3Qgb24gXCIke2VuZHBvaW50fVwiLiAke1N0cmluZyhcbiAgICAgICAgZXJcbiAgICAgICl9YFxuICAgICk7XG4gIH1cbiAgaWYgKCFpc1BsYWluT2JqZWN0KGRhdGEpIHx8IHR5cGVvZiBkYXRhLnRva2VuICE9PSBcInN0cmluZ1wiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYEV4cGVjdGVkIGEgSlNPTiByZXNwb25zZSBvZiB0aGUgZm9ybSBcXGB7IHRva2VuOiBcIi4uLlwiIH1cXGAgd2hlbiBkb2luZyBhIFBPU1QgcmVxdWVzdCBvbiBcIiR7ZW5kcG9pbnR9XCIsIGJ1dCBnb3QgJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgZGF0YVxuICAgICAgKX1gXG4gICAgKTtcbiAgfVxuICBjb25zdCB7IHRva2VuIH0gPSBkYXRhO1xuICByZXR1cm4geyB0b2tlbiB9O1xufVxuXG4vLyBzcmMvY29uc3RhbnRzLnRzXG52YXIgREVGQVVMVF9CQVNFX1VSTCA9IFwiaHR0cHM6Ly9hcGkubGl2ZWJsb2Nrcy5pb1wiO1xuXG4vLyBzcmMvaW50ZXJuYWwudHNcbnZhciBrSW50ZXJuYWwgPSBTeW1ib2woKTtcblxuLy8gc3JjL2RldnRvb2xzL2JyaWRnZS50c1xudmFyIF9icmlkZ2VBY3RpdmUgPSBmYWxzZTtcbmZ1bmN0aW9uIGFjdGl2YXRlQnJpZGdlKGFsbG93ZWQpIHtcbiAgX2JyaWRnZUFjdGl2ZSA9IGFsbG93ZWQ7XG59XG5mdW5jdGlvbiBzZW5kVG9QYW5lbChtZXNzYWdlLCBvcHRpb25zKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgfHwgdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBmdWxsTXNnID0ge1xuICAgIC4uLm1lc3NhZ2UsXG4gICAgc291cmNlOiBcImxpdmVibG9ja3MtZGV2dG9vbHMtY2xpZW50XCJcbiAgfTtcbiAgaWYgKCEob3B0aW9ucz8uZm9yY2UgfHwgX2JyaWRnZUFjdGl2ZSkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgd2luZG93LnBvc3RNZXNzYWdlKGZ1bGxNc2csIFwiKlwiKTtcbn1cbnZhciBldmVudFNvdXJjZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIiAmJiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQuc291cmNlID09PSB3aW5kb3cgJiYgZXZlbnQuZGF0YT8uc291cmNlID09PSBcImxpdmVibG9ja3MtZGV2dG9vbHMtcGFuZWxcIikge1xuICAgICAgZXZlbnRTb3VyY2Uubm90aWZ5KGV2ZW50LmRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgfVxuICB9KTtcbn1cbnZhciBvbk1lc3NhZ2VGcm9tUGFuZWwgPSBldmVudFNvdXJjZS5vYnNlcnZhYmxlO1xuXG4vLyBzcmMvZGV2dG9vbHMvaW5kZXgudHNcbnZhciBWRVJTSU9OID0gUEtHX1ZFUlNJT04gfHwgXCJkZXZcIjtcbnZhciBfZGV2dG9vbHNTZXR1cEhhc1J1biA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0dXBEZXZUb29scyhnZXRBbGxSb29tcykge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiIHx8IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKF9kZXZ0b29sc1NldHVwSGFzUnVuKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIF9kZXZ0b29sc1NldHVwSGFzUnVuID0gdHJ1ZTtcbiAgb25NZXNzYWdlRnJvbVBhbmVsLnN1YnNjcmliZSgobXNnKSA9PiB7XG4gICAgc3dpdGNoIChtc2cubXNnKSB7XG4gICAgICBjYXNlIFwiY29ubmVjdFwiOiB7XG4gICAgICAgIGFjdGl2YXRlQnJpZGdlKHRydWUpO1xuICAgICAgICBmb3IgKGNvbnN0IHJvb21JZCBvZiBnZXRBbGxSb29tcygpKSB7XG4gICAgICAgICAgc2VuZFRvUGFuZWwoe1xuICAgICAgICAgICAgbXNnOiBcInJvb206OmF2YWlsYWJsZVwiLFxuICAgICAgICAgICAgcm9vbUlkLFxuICAgICAgICAgICAgY2xpZW50VmVyc2lvbjogVkVSU0lPTlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHNlbmRUb1BhbmVsKHsgbXNnOiBcIndha2UtdXAtZGV2dG9vbHNcIiB9LCB7IGZvcmNlOiB0cnVlIH0pO1xufVxudmFyIHVuc3Vic0J5Um9vbUlkID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbmZ1bmN0aW9uIHN0b3BTeW5jU3RyZWFtKHJvb21JZCkge1xuICBjb25zdCB1bnN1YnMgPSB1bnN1YnNCeVJvb21JZC5nZXQocm9vbUlkKSA/PyBbXTtcbiAgdW5zdWJzQnlSb29tSWQuZGVsZXRlKHJvb21JZCk7XG4gIGZvciAoY29uc3QgdW5zdWIgb2YgdW5zdWJzKSB7XG4gICAgdW5zdWIoKTtcbiAgfVxufVxuZnVuY3Rpb24gc3RhcnRTeW5jU3RyZWFtKHJvb20pIHtcbiAgc3RvcFN5bmNTdHJlYW0ocm9vbS5pZCk7XG4gIGZ1bGxTeW5jKHJvb20pO1xuICB1bnN1YnNCeVJvb21JZC5zZXQocm9vbS5pZCwgW1xuICAgIC8vIFdoZW4gdGhlIGNvbm5lY3Rpb24gc3RhdHVzIGNoYW5nZXNcbiAgICByb29tLmV2ZW50cy5zdGF0dXMuc3Vic2NyaWJlKCgpID0+IHBhcnRpYWxTeW5jQ29ubmVjdGlvbihyb29tKSksXG4gICAgLy8gV2hlbiBzdG9yYWdlIGluaXRpYWxpemVzLCBzZW5kIHRoZSB1cGRhdGVcbiAgICByb29tLmV2ZW50cy5zdG9yYWdlRGlkTG9hZC5zdWJzY3JpYmVPbmNlKCgpID0+IHBhcnRpYWxTeW5jU3RvcmFnZShyb29tKSksXG4gICAgLy8gQW55IHRpbWUgc3RvcmFnZSB1cGRhdGVzLCBzZW5kIHRoZSBuZXcgc3RvcmFnZSByb290XG4gICAgcm9vbS5ldmVudHMuc3RvcmFnZUJhdGNoLnN1YnNjcmliZSgoKSA9PiBwYXJ0aWFsU3luY1N0b3JhZ2Uocm9vbSkpLFxuICAgIC8vIEFueSB0aW1lIFwibWVcIiBvciBcIm90aGVyc1wiIHVwZGF0ZXMsIHNlbmQgdGhlIG5ldyB2YWx1ZXMgYWNjb3JkaW5nbHlcbiAgICByb29tLmV2ZW50cy5zZWxmLnN1YnNjcmliZSgoKSA9PiBwYXJ0aWFsU3luY01lKHJvb20pKSxcbiAgICByb29tLmV2ZW50cy5vdGhlcnMuc3Vic2NyaWJlKCgpID0+IHBhcnRpYWxTeW5jT3RoZXJzKHJvb20pKSxcbiAgICAvLyBBbnkgdGltZSB5ZG9jIGlzIHVwZGF0ZWQsIGZvcndhcmQgdGhlIHVwZGF0ZVxuICAgIHJvb20uZXZlbnRzLnlkb2Muc3Vic2NyaWJlKCh1cGRhdGUpID0+IHN5bmNZZG9jVXBkYXRlKHJvb20sIHVwZGF0ZSkpLFxuICAgIC8vIEFueSB0aW1lIGEgY3VzdG9tIHJvb20gZXZlbnQgaXMgcmVjZWl2ZWQsIGZvcndhcmQgaXRcbiAgICByb29tLmV2ZW50cy5jdXN0b21FdmVudC5zdWJzY3JpYmUoXG4gICAgICAoZXZlbnREYXRhKSA9PiBmb3J3YXJkRXZlbnQocm9vbSwgZXZlbnREYXRhKVxuICAgIClcbiAgXSk7XG59XG5mdW5jdGlvbiBzeW5jWWRvY1VwZGF0ZShyb29tLCB1cGRhdGUpIHtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjpzeW5jOjp5ZG9jXCIsXG4gICAgcm9vbUlkOiByb29tLmlkLFxuICAgIHVwZGF0ZVxuICB9KTtcbn1cbnZhciBsb2FkZWRBdCA9IERhdGUubm93KCk7XG52YXIgZXZlbnRDb3VudGVyID0gMDtcbmZ1bmN0aW9uIG5leHRFdmVudElkKCkge1xuICByZXR1cm4gYGV2ZW50LSR7bG9hZGVkQXR9LSR7ZXZlbnRDb3VudGVyKyt9YDtcbn1cbmZ1bmN0aW9uIGZvcndhcmRFdmVudChyb29tLCBldmVudERhdGEpIHtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjpldmVudHM6OmN1c3RvbS1ldmVudFwiLFxuICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICBldmVudDoge1xuICAgICAgdHlwZTogXCJDdXN0b21FdmVudFwiLFxuICAgICAgaWQ6IG5leHRFdmVudElkKCksXG4gICAgICBrZXk6IFwiRXZlbnRcIixcbiAgICAgIGNvbm5lY3Rpb25JZDogZXZlbnREYXRhLmNvbm5lY3Rpb25JZCxcbiAgICAgIHBheWxvYWQ6IGV2ZW50RGF0YS5ldmVudFxuICAgIH1cbiAgfSk7XG59XG5mdW5jdGlvbiBwYXJ0aWFsU3luY0Nvbm5lY3Rpb24ocm9vbSkge1xuICBzZW5kVG9QYW5lbCh7XG4gICAgbXNnOiBcInJvb206OnN5bmM6OnBhcnRpYWxcIixcbiAgICByb29tSWQ6IHJvb20uaWQsXG4gICAgc3RhdHVzOiByb29tLmdldFN0YXR1cygpXG4gIH0pO1xufVxuZnVuY3Rpb24gcGFydGlhbFN5bmNTdG9yYWdlKHJvb20pIHtcbiAgY29uc3Qgcm9vdCA9IHJvb20uZ2V0U3RvcmFnZVNuYXBzaG90KCk7XG4gIGlmIChyb290KSB7XG4gICAgc2VuZFRvUGFuZWwoe1xuICAgICAgbXNnOiBcInJvb206OnN5bmM6OnBhcnRpYWxcIixcbiAgICAgIHJvb21JZDogcm9vbS5pZCxcbiAgICAgIHN0b3JhZ2U6IHJvb3QudG9UcmVlTm9kZShcInJvb3RcIikucGF5bG9hZFxuICAgIH0pO1xuICB9XG59XG5mdW5jdGlvbiBwYXJ0aWFsU3luY01lKHJvb20pIHtcbiAgY29uc3QgbWUgPSByb29tW2tJbnRlcm5hbF0uZ2V0U2VsZl9mb3JEZXZUb29scygpO1xuICBpZiAobWUpIHtcbiAgICBzZW5kVG9QYW5lbCh7XG4gICAgICBtc2c6IFwicm9vbTo6c3luYzo6cGFydGlhbFwiLFxuICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgbWVcbiAgICB9KTtcbiAgfVxufVxuZnVuY3Rpb24gcGFydGlhbFN5bmNPdGhlcnMocm9vbSkge1xuICBjb25zdCBvdGhlcnMgPSByb29tW2tJbnRlcm5hbF0uZ2V0T3RoZXJzX2ZvckRldlRvb2xzKCk7XG4gIGlmIChvdGhlcnMpIHtcbiAgICBzZW5kVG9QYW5lbCh7XG4gICAgICBtc2c6IFwicm9vbTo6c3luYzo6cGFydGlhbFwiLFxuICAgICAgcm9vbUlkOiByb29tLmlkLFxuICAgICAgb3RoZXJzXG4gICAgfSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGZ1bGxTeW5jKHJvb20pIHtcbiAgY29uc3Qgcm9vdCA9IHJvb20uZ2V0U3RvcmFnZVNuYXBzaG90KCk7XG4gIGNvbnN0IG1lID0gcm9vbVtrSW50ZXJuYWxdLmdldFNlbGZfZm9yRGV2VG9vbHMoKTtcbiAgY29uc3Qgb3RoZXJzID0gcm9vbVtrSW50ZXJuYWxdLmdldE90aGVyc19mb3JEZXZUb29scygpO1xuICByb29tLmZldGNoWURvYyhcIlwiKTtcbiAgc2VuZFRvUGFuZWwoe1xuICAgIG1zZzogXCJyb29tOjpzeW5jOjpmdWxsXCIsXG4gICAgcm9vbUlkOiByb29tLmlkLFxuICAgIHN0YXR1czogcm9vbS5nZXRTdGF0dXMoKSxcbiAgICBzdG9yYWdlOiByb290Py50b1RyZWVOb2RlKFwicm9vdFwiKS5wYXlsb2FkID8/IG51bGwsXG4gICAgbWUsXG4gICAgb3RoZXJzXG4gIH0pO1xufVxudmFyIHJvb21DaGFubmVsTGlzdGVuZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbmZ1bmN0aW9uIHN0b3BSb29tQ2hhbm5lbExpc3RlbmVyKHJvb21JZCkge1xuICBjb25zdCBsaXN0ZW5lciA9IHJvb21DaGFubmVsTGlzdGVuZXJzLmdldChyb29tSWQpO1xuICByb29tQ2hhbm5lbExpc3RlbmVycy5kZWxldGUocm9vbUlkKTtcbiAgaWYgKGxpc3RlbmVyKSB7XG4gICAgbGlzdGVuZXIoKTtcbiAgfVxufVxuZnVuY3Rpb24gbGlua0RldlRvb2xzKHJvb21JZCwgcm9vbSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiIHx8IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgc2VuZFRvUGFuZWwoeyBtc2c6IFwicm9vbTo6YXZhaWxhYmxlXCIsIHJvb21JZCwgY2xpZW50VmVyc2lvbjogVkVSU0lPTiB9KTtcbiAgc3RvcFJvb21DaGFubmVsTGlzdGVuZXIocm9vbUlkKTtcbiAgcm9vbUNoYW5uZWxMaXN0ZW5lcnMuc2V0KFxuICAgIHJvb21JZCxcbiAgICAvLyBSZXR1cm5zIHRoZSB1bnN1YnNjcmliZSBjYWxsYmFjaywgdGhhdCB3ZSBzdG9yZSBpbiB0aGVcbiAgICAvLyByb29tQ2hhbm5lbExpc3RlbmVycyByZWdpc3RyeVxuICAgIG9uTWVzc2FnZUZyb21QYW5lbC5zdWJzY3JpYmUoKG1zZykgPT4ge1xuICAgICAgc3dpdGNoIChtc2cubXNnKSB7XG4gICAgICAgIGNhc2UgXCJyb29tOjpzdWJzY3JpYmVcIjoge1xuICAgICAgICAgIGlmIChtc2cucm9vbUlkID09PSByb29tSWQpIHtcbiAgICAgICAgICAgIHN0YXJ0U3luY1N0cmVhbShyb29tKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInJvb206OnVuc3Vic2NyaWJlXCI6IHtcbiAgICAgICAgICBpZiAobXNnLnJvb21JZCA9PT0gcm9vbUlkKSB7XG4gICAgICAgICAgICBzdG9wU3luY1N0cmVhbShyb29tSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICk7XG59XG5mdW5jdGlvbiB1bmxpbmtEZXZUb29scyhyb29tSWQpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIiB8fCB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHN0b3BTeW5jU3RyZWFtKHJvb21JZCk7XG4gIHN0b3BSb29tQ2hhbm5lbExpc3RlbmVyKHJvb21JZCk7XG4gIHNlbmRUb1BhbmVsKHtcbiAgICBtc2c6IFwicm9vbTo6dW5hdmFpbGFibGVcIixcbiAgICByb29tSWRcbiAgfSk7XG59XG5cbi8vIHNyYy9saWIvc3RyaW5naWZ5LnRzXG5mdW5jdGlvbiBzdHJpbmdpZnkob2JqZWN0LCAuLi5hcmdzKSB7XG4gIGlmICh0eXBlb2Ygb2JqZWN0ICE9PSBcIm9iamVjdFwiIHx8IG9iamVjdCA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iamVjdCkpIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqZWN0LCAuLi5hcmdzKTtcbiAgfVxuICBjb25zdCBzb3J0ZWRPYmplY3QgPSBPYmplY3Qua2V5cyhvYmplY3QpLnNvcnQoKS5yZWR1Y2UoXG4gICAgKHNvcnRlZE9iamVjdDIsIGtleSkgPT4ge1xuICAgICAgc29ydGVkT2JqZWN0MltrZXldID0gb2JqZWN0W2tleV07XG4gICAgICByZXR1cm4gc29ydGVkT2JqZWN0MjtcbiAgICB9LFxuICAgIHt9XG4gICk7XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShzb3J0ZWRPYmplY3QsIC4uLmFyZ3MpO1xufVxuXG4vLyBzcmMvbGliL2JhdGNoLnRzXG52YXIgREVGQVVMVF9TSVpFID0gNTA7XG52YXIgQmF0Y2hDYWxsID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcihpbnB1dCkge1xuICAgIHRoaXMuaW5wdXQgPSBpbnB1dDtcbiAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmUsIHJlamVjdCB9ID0gUHJvbWlzZV93aXRoUmVzb2x2ZXJzKCk7XG4gICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTtcbiAgICB0aGlzLnJlc29sdmUgPSByZXNvbHZlO1xuICAgIHRoaXMucmVqZWN0ID0gcmVqZWN0O1xuICB9XG59O1xudmFyIEJhdGNoID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcihjYWxsYmFjaywgb3B0aW9ucykge1xuICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIHRoaXMuc2l6ZSA9IG9wdGlvbnMuc2l6ZSA/PyBERUZBVUxUX1NJWkU7XG4gICAgdGhpcy5kZWxheSA9IG9wdGlvbnMuZGVsYXk7XG4gIH1cbiAgY2xlYXJEZWxheVRpbWVvdXQoKSB7XG4gICAgaWYgKHRoaXMuZGVsYXlUaW1lb3V0SWQgIT09IHZvaWQgMCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lb3V0SWQpO1xuICAgICAgdGhpcy5kZWxheVRpbWVvdXRJZCA9IHZvaWQgMDtcbiAgICB9XG4gIH1cbiAgc2NoZWR1bGUoKSB7XG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID09PSB0aGlzLnNpemUpIHtcbiAgICAgIHZvaWQgdGhpcy5mbHVzaCgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5xdWV1ZS5sZW5ndGggPT09IDEpIHtcbiAgICAgIHRoaXMuY2xlYXJEZWxheVRpbWVvdXQoKTtcbiAgICAgIHRoaXMuZGVsYXlUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHZvaWQgdGhpcy5mbHVzaCgpLCB0aGlzLmRlbGF5KTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZmx1c2goKSB7XG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNhbGxzID0gdGhpcy5xdWV1ZS5zcGxpY2UoMCk7XG4gICAgY29uc3QgaW5wdXRzID0gY2FsbHMubWFwKChjYWxsKSA9PiBjYWxsLmlucHV0KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuY2FsbGJhY2soaW5wdXRzKTtcbiAgICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICAgIGNhbGxzLmZvckVhY2goKGNhbGwsIGluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc3VsdHM/LltpbmRleF07XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZXN1bHRzKSkge1xuICAgICAgICAgIGNhbGwucmVqZWN0KG5ldyBFcnJvcihcIkNhbGxiYWNrIG11c3QgcmV0dXJuIGFuIGFycmF5LlwiKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY2FsbHMubGVuZ3RoICE9PSByZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgIGNhbGwucmVqZWN0KFxuICAgICAgICAgICAgbmV3IEVycm9yKFxuICAgICAgICAgICAgICBgQ2FsbGJhY2sgbXVzdCByZXR1cm4gYW4gYXJyYXkgb2YgdGhlIHNhbWUgbGVuZ3RoIGFzIHRoZSBudW1iZXIgb2YgcHJvdmlkZWQgaXRlbXMuIEV4cGVjdGVkICR7Y2FsbHMubGVuZ3RofSwgYnV0IGdvdCAke3Jlc3VsdHMubGVuZ3RofS5gXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIGNhbGwucmVqZWN0KHJlc3VsdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yMykge1xuICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICBjYWxscy5mb3JFYWNoKChjYWxsKSA9PiB7XG4gICAgICAgIGNhbGwucmVqZWN0KGVycm9yMyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZ2V0KGlucHV0KSB7XG4gICAgY29uc3QgZXhpc3RpbmdDYWxsID0gdGhpcy5xdWV1ZS5maW5kKFxuICAgICAgKGNhbGwyKSA9PiBzdHJpbmdpZnkoY2FsbDIuaW5wdXQpID09PSBzdHJpbmdpZnkoaW5wdXQpXG4gICAgKTtcbiAgICBpZiAoZXhpc3RpbmdDYWxsKSB7XG4gICAgICByZXR1cm4gZXhpc3RpbmdDYWxsLnByb21pc2U7XG4gICAgfVxuICAgIGNvbnN0IGNhbGwgPSBuZXcgQmF0Y2hDYWxsKGlucHV0KTtcbiAgICB0aGlzLnF1ZXVlLnB1c2goY2FsbCk7XG4gICAgdGhpcy5zY2hlZHVsZSgpO1xuICAgIHJldHVybiBjYWxsLnByb21pc2U7XG4gIH1cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xuICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICB0aGlzLmNsZWFyRGVsYXlUaW1lb3V0KCk7XG4gIH1cbn07XG5mdW5jdGlvbiBjcmVhdGVCYXRjaFN0b3JlKGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gIGNvbnN0IGJhdGNoID0gbmV3IEJhdGNoKGNhbGxiYWNrLCBvcHRpb25zKTtcbiAgY29uc3QgY2FjaGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBjb25zdCBldmVudFNvdXJjZTIgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgZnVuY3Rpb24gZ2V0Q2FjaGVLZXkoYXJncykge1xuICAgIHJldHVybiBzdHJpbmdpZnkoYXJncyk7XG4gIH1cbiAgZnVuY3Rpb24gc2V0U3RhdGVBbmROb3RpZnkoY2FjaGVLZXksIHN0YXRlKSB7XG4gICAgY2FjaGUuc2V0KGNhY2hlS2V5LCBzdGF0ZSk7XG4gICAgZXZlbnRTb3VyY2UyLm5vdGlmeSgpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldChpbnB1dCkge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gZ2V0Q2FjaGVLZXkoaW5wdXQpO1xuICAgIGlmIChjYWNoZS5oYXMoY2FjaGVLZXkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBzZXRTdGF0ZUFuZE5vdGlmeShjYWNoZUtleSwgeyBpc0xvYWRpbmc6IHRydWUgfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiYXRjaC5nZXQoaW5wdXQpO1xuICAgICAgc2V0U3RhdGVBbmROb3RpZnkoY2FjaGVLZXksIHsgaXNMb2FkaW5nOiBmYWxzZSwgZGF0YTogcmVzdWx0IH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yMykge1xuICAgICAgc2V0U3RhdGVBbmROb3RpZnkoY2FjaGVLZXksIHtcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yM1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGdldFN0YXRlKGlucHV0KSB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBnZXRDYWNoZUtleShpbnB1dCk7XG4gICAgcmV0dXJuIGNhY2hlLmdldChjYWNoZUtleSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5ldmVudFNvdXJjZTIub2JzZXJ2YWJsZSxcbiAgICBnZXQsXG4gICAgZ2V0U3RhdGVcbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9jcmVhdGUtc3RvcmUudHNcbmZ1bmN0aW9uIGNyZWF0ZVN0b3JlKGluaXRpYWxTdGF0ZSkge1xuICBsZXQgc3RhdGUgPSBpbml0aWFsU3RhdGU7XG4gIGNvbnN0IHN1YnNjcmliZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuICBmdW5jdGlvbiBzZXQoY2FsbGJhY2spIHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IGNhbGxiYWNrKHN0YXRlKTtcbiAgICBpZiAoc3RhdGUgPT09IG5ld1N0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0YXRlID0gbmV3U3RhdGU7XG4gICAgZm9yIChjb25zdCBzdWJzY3JpYmVyIG9mIHN1YnNjcmliZXJzKSB7XG4gICAgICBzdWJzY3JpYmVyKHN0YXRlKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gc3Vic2NyaWJlKGNhbGxiYWNrKSB7XG4gICAgc3Vic2NyaWJlcnMuYWRkKGNhbGxiYWNrKTtcbiAgICBjYWxsYmFjayhzdGF0ZSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHN1YnNjcmliZXJzLmRlbGV0ZShjYWxsYmFjayk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGdldCxcbiAgICBzZXQsXG4gICAgc3Vic2NyaWJlXG4gIH07XG59XG5cbi8vIHNyYy9jb252ZXJ0LXBsYWluLWRhdGEudHNcbmZ1bmN0aW9uIGNvbnZlcnRUb0NvbW1lbnREYXRhKGRhdGEpIHtcbiAgY29uc3QgZWRpdGVkQXQgPSBkYXRhLmVkaXRlZEF0ID8gbmV3IERhdGUoZGF0YS5lZGl0ZWRBdCkgOiB2b2lkIDA7XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgY29uc3QgcmVhY3Rpb25zID0gZGF0YS5yZWFjdGlvbnMubWFwKChyZWFjdGlvbikgPT4gKHtcbiAgICAuLi5yZWFjdGlvbixcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHJlYWN0aW9uLmNyZWF0ZWRBdClcbiAgfSkpO1xuICBpZiAoZGF0YS5ib2R5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICByZWFjdGlvbnMsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICBlZGl0ZWRBdFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZGVsZXRlZEF0ID0gbmV3IERhdGUoZGF0YS5kZWxldGVkQXQpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgcmVhY3Rpb25zLFxuICAgICAgY3JlYXRlZEF0LFxuICAgICAgZWRpdGVkQXQsXG4gICAgICBkZWxldGVkQXRcbiAgICB9O1xuICB9XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9UaHJlYWREYXRhKGRhdGEpIHtcbiAgY29uc3QgdXBkYXRlZEF0ID0gZGF0YS51cGRhdGVkQXQgPyBuZXcgRGF0ZShkYXRhLnVwZGF0ZWRBdCkgOiB2b2lkIDA7XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgY29uc3QgY29tbWVudHMgPSBkYXRhLmNvbW1lbnRzLm1hcChcbiAgICAoY29tbWVudCkgPT4gY29udmVydFRvQ29tbWVudERhdGEoY29tbWVudClcbiAgKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIGNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQsXG4gICAgY29tbWVudHNcbiAgfTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb0NvbW1lbnRVc2VyUmVhY3Rpb24oZGF0YSkge1xuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdClcbiAgfTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YShkYXRhKSB7XG4gIGNvbnN0IG5vdGlmaWVkQXQgPSBuZXcgRGF0ZShkYXRhLm5vdGlmaWVkQXQpO1xuICBjb25zdCByZWFkQXQgPSBkYXRhLnJlYWRBdCA/IG5ldyBEYXRlKGRhdGEucmVhZEF0KSA6IG51bGw7XG4gIGlmIChcImFjdGl2aXRpZXNcIiBpbiBkYXRhKSB7XG4gICAgY29uc3QgYWN0aXZpdGllcyA9IGRhdGEuYWN0aXZpdGllcy5tYXAoKGFjdGl2aXR5KSA9PiAoe1xuICAgICAgLi4uYWN0aXZpdHksXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKGFjdGl2aXR5LmNyZWF0ZWRBdClcbiAgICB9KSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBub3RpZmllZEF0LFxuICAgICAgcmVhZEF0LFxuICAgICAgYWN0aXZpdGllc1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIG5vdGlmaWVkQXQsXG4gICAgcmVhZEF0XG4gIH07XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9UaHJlYWREZWxldGVJbmZvKGRhdGEpIHtcbiAgY29uc3QgZGVsZXRlZEF0ID0gbmV3IERhdGUoZGF0YS5kZWxldGVkQXQpO1xuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgZGVsZXRlZEF0XG4gIH07XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRlbGV0ZUluZm8oZGF0YSkge1xuICBjb25zdCBkZWxldGVkQXQgPSBuZXcgRGF0ZShkYXRhLmRlbGV0ZWRBdCk7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBkZWxldGVkQXRcbiAgfTtcbn1cblxuLy8gc3JjL2xpYi91cmwudHNcbmZ1bmN0aW9uIHRvVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykge1xuICBjb25zdCByZXN1bHQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHBhcmFtcykpIHtcbiAgICBpZiAodmFsdWUgIT09IHZvaWQgMCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgcmVzdWx0LnNldChrZXksIHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gdXJsam9pbihiYXNlVXJsLCBwYXRoLCBwYXJhbXMpIHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTChwYXRoLCBiYXNlVXJsKTtcbiAgaWYgKHBhcmFtcyAhPT0gdm9pZCAwKSB7XG4gICAgdXJsLnNlYXJjaCA9IChwYXJhbXMgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMgPyBwYXJhbXMgOiB0b1VSTFNlYXJjaFBhcmFtcyhwYXJhbXMpKS50b1N0cmluZygpO1xuICB9XG4gIHJldHVybiB1cmwudG9TdHJpbmcoKTtcbn1cblxuLy8gc3JjL25vdGlmaWNhdGlvbnMudHNcbnZhciBNQVJLX0lOQk9YX05PVElGSUNBVElPTlNfQVNfUkVBRF9CQVRDSF9ERUxBWSA9IDUwO1xuZnVuY3Rpb24gY3JlYXRlTm90aWZpY2F0aW9uc0FwaSh7XG4gIGJhc2VVcmwsXG4gIGF1dGhNYW5hZ2VyLFxuICBjdXJyZW50VXNlcklkU3RvcmUsXG4gIGZldGNoZXJcbn0pIHtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hKc29uKGVuZHBvaW50LCBvcHRpb25zLCBwYXJhbXMpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBhdXRoTWFuYWdlci5nZXRBdXRoVmFsdWUoe1xuICAgICAgcmVxdWVzdGVkU2NvcGU6IFwiY29tbWVudHM6cmVhZFwiXG4gICAgfSk7XG4gICAgaWYgKGF1dGhWYWx1ZS50eXBlID09PSBcInNlY3JldFwiICYmIGF1dGhWYWx1ZS50b2tlbi5wYXJzZWQuayA9PT0gXCJhY2NcIiAvKiBBQ0NFU1NfVE9LRU4gKi8pIHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGF1dGhWYWx1ZS50b2tlbi5wYXJzZWQudWlkO1xuICAgICAgY3VycmVudFVzZXJJZFN0b3JlLnNldCgoKSA9PiB1c2VySWQpO1xuICAgIH1cbiAgICBjb25zdCB1cmwgPSB1cmxqb2luKGJhc2VVcmwsIGAvdjIvYyR7ZW5kcG9pbnR9YCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoZXIodXJsLnRvU3RyaW5nKCksIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLm9wdGlvbnM/LmhlYWRlcnMsXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtnZXRBdXRoQmVhcmVySGVhZGVyRnJvbUF1dGhWYWx1ZShhdXRoVmFsdWUpfWBcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDQwMCAmJiByZXNwb25zZS5zdGF0dXMgPCA2MDApIHtcbiAgICAgICAgbGV0IGVycm9yMztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBlcnJvckJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIGVycm9yQm9keS5tZXNzYWdlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgZXJyb3JCb2R5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yMztcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGJvZHk7XG4gICAgdHJ5IHtcbiAgICAgIGJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBib2R5ID0ge307XG4gICAgfVxuICAgIHJldHVybiBib2R5O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldEluYm94Tm90aWZpY2F0aW9ucygpIHtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnNcIiwgdm9pZCAwLCB7fSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRocmVhZHM6IGpzb24udGhyZWFkcy5tYXAoY29udmVydFRvVGhyZWFkRGF0YSksXG4gICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IGpzb24uaW5ib3hOb3RpZmljYXRpb25zLm1hcChcbiAgICAgICAgY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EYXRhXG4gICAgICApLFxuICAgICAgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKGpzb24ubWV0YS5yZXF1ZXN0ZWRBdClcbiAgICB9O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlKG9wdGlvbnMpIHtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnNcIiwgdm9pZCAwLCB7XG4gICAgICBzaW5jZTogb3B0aW9ucy5zaW5jZS50b0lTT1N0cmluZygpXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRocmVhZHM6IHtcbiAgICAgICAgdXBkYXRlZDoganNvbi50aHJlYWRzLm1hcChjb252ZXJ0VG9UaHJlYWREYXRhKSxcbiAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkVGhyZWFkcy5tYXAoY29udmVydFRvVGhyZWFkRGVsZXRlSW5mbylcbiAgICAgIH0sXG4gICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHtcbiAgICAgICAgdXBkYXRlZDoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YSksXG4gICAgICAgIGRlbGV0ZWQ6IGpzb24uZGVsZXRlZEluYm94Tm90aWZpY2F0aW9ucy5tYXAoXG4gICAgICAgICAgY29udmVydFRvSW5ib3hOb3RpZmljYXRpb25EZWxldGVJbmZvXG4gICAgICAgIClcbiAgICAgIH0sXG4gICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoanNvbi5tZXRhLnJlcXVlc3RlZEF0KVxuICAgIH07XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0VW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQoKSB7XG4gICAgY29uc3QgeyBjb3VudCB9ID0gYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnMvY291bnRcIik7XG4gICAgcmV0dXJuIGNvdW50O1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIG1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnMvcmVhZFwiLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaW5ib3hOb3RpZmljYXRpb25JZHM6IFwiYWxsXCIgfSlcbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWRzKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFwiL2luYm94LW5vdGlmaWNhdGlvbnMvcmVhZFwiLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaW5ib3hOb3RpZmljYXRpb25JZHMgfSlcbiAgICB9KTtcbiAgfVxuICBjb25zdCBiYXRjaGVkTWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZCA9IG5ldyBCYXRjaChcbiAgICBhc3luYyAoYmF0Y2hlZEluYm94Tm90aWZpY2F0aW9uSWRzKSA9PiB7XG4gICAgICBjb25zdCBpbmJveE5vdGlmaWNhdGlvbklkcyA9IGJhdGNoZWRJbmJveE5vdGlmaWNhdGlvbklkcy5mbGF0KCk7XG4gICAgICBhd2FpdCBtYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWRzKTtcbiAgICAgIHJldHVybiBpbmJveE5vdGlmaWNhdGlvbklkcztcbiAgICB9LFxuICAgIHsgZGVsYXk6IE1BUktfSU5CT1hfTk9USUZJQ0FUSU9OU19BU19SRUFEX0JBVENIX0RFTEFZIH1cbiAgKTtcbiAgYXN5bmMgZnVuY3Rpb24gbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWQpIHtcbiAgICBhd2FpdCBiYXRjaGVkTWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZC5nZXQoaW5ib3hOb3RpZmljYXRpb25JZCk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zKCkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcIi9pbmJveC1ub3RpZmljYXRpb25zXCIsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUluYm94Tm90aWZpY2F0aW9uKGluYm94Tm90aWZpY2F0aW9uSWQpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL2luYm94LW5vdGlmaWNhdGlvbnMvJHtlbmNvZGVVUklDb21wb25lbnQoaW5ib3hOb3RpZmljYXRpb25JZCl9YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGdldEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICBnZXRJbmJveE5vdGlmaWNhdGlvbnNTaW5jZSxcbiAgICBnZXRVbnJlYWRJbmJveE5vdGlmaWNhdGlvbnNDb3VudCxcbiAgICBtYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkLFxuICAgIG1hcmtJbmJveE5vdGlmaWNhdGlvbkFzUmVhZCxcbiAgICBkZWxldGVBbGxJbmJveE5vdGlmaWNhdGlvbnMsXG4gICAgZGVsZXRlSW5ib3hOb3RpZmljYXRpb25cbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9wb3NpdGlvbi50c1xudmFyIE1JTl9DT0RFID0gMzI7XG52YXIgTUFYX0NPREUgPSAxMjY7XG52YXIgTlVNX0RJR0lUUyA9IE1BWF9DT0RFIC0gTUlOX0NPREUgKyAxO1xudmFyIFpFUk8gPSBudGhEaWdpdCgwKTtcbnZhciBPTkUgPSBudGhEaWdpdCgxKTtcbnZhciBaRVJPX05JTkUgPSBaRVJPICsgbnRoRGlnaXQoLTEpO1xuZnVuY3Rpb24gbnRoRGlnaXQobikge1xuICBjb25zdCBjb2RlID0gTUlOX0NPREUgKyAobiA8IDAgPyBOVU1fRElHSVRTICsgbiA6IG4pO1xuICBpZiAoY29kZSA8IE1JTl9DT0RFIHx8IGNvZGUgPiBNQVhfQ09ERSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBuIHZhbHVlOiAke259YCk7XG4gIH1cbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG59XG5mdW5jdGlvbiBtYWtlUG9zaXRpb24oeCwgeSkge1xuICBpZiAoeCAhPT0gdm9pZCAwICYmIHkgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBiZXR3ZWVuKHgsIHkpO1xuICB9IGVsc2UgaWYgKHggIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBhZnRlcih4KTtcbiAgfSBlbHNlIGlmICh5ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gYmVmb3JlKHkpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBPTkU7XG4gIH1cbn1cbmZ1bmN0aW9uIGJlZm9yZShwb3MpIHtcbiAgY29uc3QgbGFzdEluZGV4ID0gcG9zLmxlbmd0aCAtIDE7XG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IGxhc3RJbmRleDsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IHBvcy5jaGFyQ29kZUF0KGkpO1xuICAgIGlmIChjb2RlIDw9IE1JTl9DT0RFKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKGkgPT09IGxhc3RJbmRleCkge1xuICAgICAgaWYgKGNvZGUgPT09IE1JTl9DT0RFICsgMSkge1xuICAgICAgICByZXR1cm4gcG9zLnN1YnN0cmluZygwLCBpKSArIFpFUk9fTklORTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwb3Muc3Vic3RyaW5nKDAsIGkpICsgU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlIC0gMSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBwb3Muc3Vic3RyaW5nKDAsIGkgKyAxKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIE9ORTtcbn1cbmZ1bmN0aW9uIGFmdGVyKHBvcykge1xuICBmb3IgKGxldCBpID0gMDsgaSA8PSBwb3MubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IHBvcy5jaGFyQ29kZUF0KGkpO1xuICAgIGlmIChjb2RlID49IE1BWF9DT0RFKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcmV0dXJuIHBvcy5zdWJzdHJpbmcoMCwgaSkgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUgKyAxKTtcbiAgfVxuICByZXR1cm4gcG9zICsgT05FO1xufVxuZnVuY3Rpb24gYmV0d2VlbihsbywgaGkpIHtcbiAgaWYgKGxvIDwgaGkpIHtcbiAgICByZXR1cm4gX2JldHdlZW4obG8sIGhpKTtcbiAgfSBlbHNlIGlmIChsbyA+IGhpKSB7XG4gICAgcmV0dXJuIF9iZXR3ZWVuKGhpLCBsbyk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGNvbXB1dGUgdmFsdWUgYmV0d2VlbiB0d28gZXF1YWwgcG9zaXRpb25zXCIpO1xuICB9XG59XG5mdW5jdGlvbiBfYmV0d2VlbihsbywgaGkpIHtcbiAgbGV0IGluZGV4ID0gMDtcbiAgY29uc3QgbG9MZW4gPSBsby5sZW5ndGg7XG4gIGNvbnN0IGhpTGVuID0gaGkubGVuZ3RoO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IGxvQ29kZSA9IGluZGV4IDwgbG9MZW4gPyBsby5jaGFyQ29kZUF0KGluZGV4KSA6IE1JTl9DT0RFO1xuICAgIGNvbnN0IGhpQ29kZSA9IGluZGV4IDwgaGlMZW4gPyBoaS5jaGFyQ29kZUF0KGluZGV4KSA6IE1BWF9DT0RFO1xuICAgIGlmIChsb0NvZGUgPT09IGhpQ29kZSkge1xuICAgICAgaW5kZXgrKztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoaGlDb2RlIC0gbG9Db2RlID09PSAxKSB7XG4gICAgICBjb25zdCBzaXplID0gaW5kZXggKyAxO1xuICAgICAgbGV0IHByZWZpeCA9IGxvLnN1YnN0cmluZygwLCBzaXplKTtcbiAgICAgIGlmIChwcmVmaXgubGVuZ3RoIDwgc2l6ZSkge1xuICAgICAgICBwcmVmaXggKz0gWkVSTy5yZXBlYXQoc2l6ZSAtIHByZWZpeC5sZW5ndGgpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3VmZml4ID0gbG8uc3Vic3RyaW5nKHNpemUpO1xuICAgICAgY29uc3QgbmluZXMgPSBcIlwiO1xuICAgICAgcmV0dXJuIHByZWZpeCArIF9iZXR3ZWVuKHN1ZmZpeCwgbmluZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGFrZU4obG8sIGluZGV4KSArIFN0cmluZy5mcm9tQ2hhckNvZGUoaGlDb2RlICsgbG9Db2RlID4+IDEpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gdGFrZU4ocG9zLCBuKSB7XG4gIHJldHVybiBuIDwgcG9zLmxlbmd0aCA/IHBvcy5zdWJzdHJpbmcoMCwgbikgOiBwb3MgKyBaRVJPLnJlcGVhdChuIC0gcG9zLmxlbmd0aCk7XG59XG52YXIgTUlOX05PTl9aRVJPX0NPREUgPSBNSU5fQ09ERSArIDE7XG5mdW5jdGlvbiBpc1BvcyhzdHIpIHtcbiAgaWYgKHN0ciA9PT0gXCJcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBsYXN0SWR4ID0gc3RyLmxlbmd0aCAtIDE7XG4gIGNvbnN0IGxhc3QgPSBzdHIuY2hhckNvZGVBdChsYXN0SWR4KTtcbiAgaWYgKGxhc3QgPCBNSU5fTk9OX1pFUk9fQ09ERSB8fCBsYXN0ID4gTUFYX0NPREUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXN0SWR4OyBpKyspIHtcbiAgICBjb25zdCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgaWYgKGNvZGUgPCBNSU5fQ09ERSB8fCBjb2RlID4gTUFYX0NPREUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9Qb3Moc3RyKSB7XG4gIGNvbnN0IGNvZGVzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIGNvZGVzLnB1c2goY29kZSA8IE1JTl9DT0RFID8gTUlOX0NPREUgOiBjb2RlID4gTUFYX0NPREUgPyBNQVhfQ09ERSA6IGNvZGUpO1xuICB9XG4gIHdoaWxlIChjb2Rlcy5sZW5ndGggPiAwICYmIGNvZGVzW2NvZGVzLmxlbmd0aCAtIDFdID09PSBNSU5fQ09ERSkge1xuICAgIGNvZGVzLmxlbmd0aC0tO1xuICB9XG4gIHJldHVybiBjb2Rlcy5sZW5ndGggPiAwID8gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5jb2RlcykgOiAoXG4gICAgLy8gRWRnZSBjYXNlOiB0aGUgc3RyIHdhcyBhIDAtb25seSBzdHJpbmcsIHdoaWNoIGlzIGludmFsaWQuIERlZmF1bHQgYmFjayB0byAuMVxuICAgIE9ORVxuICApO1xufVxuZnVuY3Rpb24gYXNQb3Moc3RyKSB7XG4gIHJldHVybiBpc1BvcyhzdHIpID8gc3RyIDogY29udmVydFRvUG9zKHN0cik7XG59XG5cbi8vIHNyYy9wcm90b2NvbC9PcC50c1xudmFyIE9wQ29kZSA9IC8qIEBfX1BVUkVfXyAqLyAoKE9wQ29kZTIpID0+IHtcbiAgT3BDb2RlMltPcENvZGUyW1wiSU5JVFwiXSA9IDBdID0gXCJJTklUXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIlNFVF9QQVJFTlRfS0VZXCJdID0gMV0gPSBcIlNFVF9QQVJFTlRfS0VZXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIkNSRUFURV9MSVNUXCJdID0gMl0gPSBcIkNSRUFURV9MSVNUXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIlVQREFURV9PQkpFQ1RcIl0gPSAzXSA9IFwiVVBEQVRFX09CSkVDVFwiO1xuICBPcENvZGUyW09wQ29kZTJbXCJDUkVBVEVfT0JKRUNUXCJdID0gNF0gPSBcIkNSRUFURV9PQkpFQ1RcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiREVMRVRFX0NSRFRcIl0gPSA1XSA9IFwiREVMRVRFX0NSRFRcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiREVMRVRFX09CSkVDVF9LRVlcIl0gPSA2XSA9IFwiREVMRVRFX09CSkVDVF9LRVlcIjtcbiAgT3BDb2RlMltPcENvZGUyW1wiQ1JFQVRFX01BUFwiXSA9IDddID0gXCJDUkVBVEVfTUFQXCI7XG4gIE9wQ29kZTJbT3BDb2RlMltcIkNSRUFURV9SRUdJU1RFUlwiXSA9IDhdID0gXCJDUkVBVEVfUkVHSVNURVJcIjtcbiAgcmV0dXJuIE9wQ29kZTI7XG59KShPcENvZGUgfHwge30pO1xuZnVuY3Rpb24gYWNrT3Aob3BJZCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sXG4gICAgaWQ6IFwiQUNLXCIsXG4gICAgLy8gKEgpQUNLXG4gICAgb3BJZFxuICB9O1xufVxuZnVuY3Rpb24gaXNBY2tPcChvcCkge1xuICByZXR1cm4gb3AudHlwZSA9PT0gNSAvKiBERUxFVEVfQ1JEVCAqLyAmJiBvcC5pZCA9PT0gXCJBQ0tcIjtcbn1cblxuLy8gc3JjL2NyZHRzL0Fic3RyYWN0Q3JkdC50c1xuZnVuY3Rpb24gY3JkdEFzTGl2ZU5vZGUodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gSGFzUGFyZW50KG5vZGUsIGtleSwgcG9zID0gYXNQb3Moa2V5KSkge1xuICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7IHR5cGU6IFwiSGFzUGFyZW50XCIsIG5vZGUsIGtleSwgcG9zIH0pO1xufVxudmFyIE5vUGFyZW50ID0gT2JqZWN0LmZyZWV6ZSh7IHR5cGU6IFwiTm9QYXJlbnRcIiB9KTtcbmZ1bmN0aW9uIE9ycGhhbmVkKG9sZEtleSwgb2xkUG9zID0gYXNQb3Mob2xkS2V5KSkge1xuICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7IHR5cGU6IFwiT3JwaGFuZWRcIiwgb2xkS2V5LCBvbGRQb3MgfSk7XG59XG52YXIgQWJzdHJhY3RDcmR0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgdGhpcy5fcGFyZW50ID0gTm9QYXJlbnQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfZ2V0UGFyZW50S2V5T3JUaHJvdygpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmtleTtcbiAgICAgIGNhc2UgXCJOb1BhcmVudFwiOlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXJlbnQga2V5IGlzIG1pc3NpbmdcIik7XG4gICAgICBjYXNlIFwiT3JwaGFuZWRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Lm9sZEtleTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBhc3NlcnROZXZlcih0aGlzLnBhcmVudCwgXCJVbmtub3duIHN0YXRlXCIpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGdldCBfcGFyZW50UG9zKCkge1xuICAgIHN3aXRjaCAodGhpcy5wYXJlbnQudHlwZSkge1xuICAgICAgY2FzZSBcIkhhc1BhcmVudFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQucG9zO1xuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhcmVudCBrZXkgaXMgbWlzc2luZ1wiKTtcbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQub2xkUG9zO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgZ2V0IF9wb29sKCkge1xuICAgIHJldHVybiB0aGlzLl9fcG9vbDtcbiAgfVxuICBnZXQgcm9vbUlkKCkge1xuICAgIHJldHVybiB0aGlzLl9fcG9vbCA/IHRoaXMuX19wb29sLnJvb21JZCA6IG51bGw7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgX2lkKCkge1xuICAgIHJldHVybiB0aGlzLl9faWQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgcGFyZW50KCkge1xuICAgIHJldHVybiB0aGlzLl9wYXJlbnQ7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXQgX3BhcmVudEtleSgpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmtleTtcbiAgICAgIGNhc2UgXCJOb1BhcmVudFwiOlxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQub2xkS2V5O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKHRoaXMucGFyZW50LCBcIlVua25vd24gc3RhdGVcIik7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5KG9wLCBfaXNMb2NhbCkge1xuICAgIHN3aXRjaCAob3AudHlwZSkge1xuICAgICAgY2FzZSA1IC8qIERFTEVURV9DUkRUICovOiB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Lm5vZGUuX2RldGFjaENoaWxkKGNyZHRBc0xpdmVOb2RlKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2V0UGFyZW50TGluayhuZXdQYXJlbnROb2RlLCBuZXdQYXJlbnRLZXkpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjpcbiAgICAgICAgaWYgKHRoaXMucGFyZW50Lm5vZGUgIT09IG5ld1BhcmVudE5vZGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IHBhcmVudDogbm9kZSBhbHJlYWR5IGhhcyBhIHBhcmVudFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9wYXJlbnQgPSBIYXNQYXJlbnQobmV3UGFyZW50Tm9kZSwgbmV3UGFyZW50S2V5KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIGNhc2UgXCJPcnBoYW5lZFwiOlxuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6IHtcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gSGFzUGFyZW50KG5ld1BhcmVudE5vZGUsIG5ld1BhcmVudEtleSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBhc3NlcnROZXZlcih0aGlzLnBhcmVudCwgXCJVbmtub3duIHN0YXRlXCIpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2goaWQsIHBvb2wpIHtcbiAgICBpZiAodGhpcy5fX2lkIHx8IHRoaXMuX19wb29sKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgYXR0YWNoIG5vZGU6IGFscmVhZHkgYXR0YWNoZWRcIik7XG4gICAgfVxuICAgIHBvb2wuYWRkTm9kZShpZCwgY3JkdEFzTGl2ZU5vZGUodGhpcykpO1xuICAgIHRoaXMuX19pZCA9IGlkO1xuICAgIHRoaXMuX19wb29sID0gcG9vbDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2goKSB7XG4gICAgaWYgKHRoaXMuX19wb29sICYmIHRoaXMuX19pZCkge1xuICAgICAgdGhpcy5fX3Bvb2wuZGVsZXRlTm9kZSh0aGlzLl9faWQpO1xuICAgIH1cbiAgICBzd2l0Y2ggKHRoaXMucGFyZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgXCJIYXNQYXJlbnRcIjoge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBPcnBoYW5lZCh0aGlzLnBhcmVudC5rZXksIHRoaXMucGFyZW50LnBvcyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIk5vUGFyZW50XCI6IHtcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gTm9QYXJlbnQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIk9ycGhhbmVkXCI6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBhc3NlcnROZXZlcih0aGlzLnBhcmVudCwgXCJVbmtub3duIHN0YXRlXCIpO1xuICAgIH1cbiAgICB0aGlzLl9fcG9vbCA9IHZvaWQgMDtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqXG4gICAqIENsZWFyIHRoZSBJbW11dGFibGUgY2FjaGUsIHNvIHRoYXQgdGhlIG5leHQgY2FsbCB0byBgLnRvSW1tdXRhYmxlKClgIHdpbGxcbiAgICogcmVjb21wdXRlIHRoZSBlcXVpdmFsZW50IEltbXV0YWJsZSB2YWx1ZSBhZ2Fpbi4gIENhbGwgdGhpcyBhZnRlciBldmVyeVxuICAgKiBtdXRhdGlvbiB0byB0aGUgTGl2ZSBub2RlLlxuICAgKi9cbiAgaW52YWxpZGF0ZSgpIHtcbiAgICBpZiAodGhpcy5fY2FjaGVkSW1tdXRhYmxlICE9PSB2b2lkIDAgfHwgdGhpcy5fY2FjaGVkVHJlZU5vZGUgIT09IHZvaWQgMCkge1xuICAgICAgdGhpcy5fY2FjaGVkSW1tdXRhYmxlID0gdm9pZCAwO1xuICAgICAgdGhpcy5fY2FjaGVkVHJlZU5vZGUgPSB2b2lkIDA7XG4gICAgICBpZiAodGhpcy5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIikge1xuICAgICAgICB0aGlzLnBhcmVudC5ub2RlLmludmFsaWRhdGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKlxuICAgKiBSZXR1cm4gYW4gc25hcHNob3Qgb2YgdGhpcyBMaXZlIHRyZWUgZm9yIHVzZSBpbiBEZXZUb29scy5cbiAgICovXG4gIHRvVHJlZU5vZGUoa2V5KSB7XG4gICAgaWYgKHRoaXMuX2NhY2hlZFRyZWVOb2RlID09PSB2b2lkIDAgfHwgdGhpcy5fY2FjaGVkVHJlZU5vZGVLZXkgIT09IGtleSkge1xuICAgICAgdGhpcy5fY2FjaGVkVHJlZU5vZGVLZXkgPSBrZXk7XG4gICAgICB0aGlzLl9jYWNoZWRUcmVlTm9kZSA9IHRoaXMuX3RvVHJlZU5vZGUoa2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NhY2hlZFRyZWVOb2RlO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm4gYW4gaW1tdXRhYmxlIHNuYXBzaG90IG9mIHRoaXMgTGl2ZSBub2RlIGFuZCBpdHMgY2hpbGRyZW4uXG4gICAqL1xuICB0b0ltbXV0YWJsZSgpIHtcbiAgICBpZiAodGhpcy5fY2FjaGVkSW1tdXRhYmxlID09PSB2b2lkIDApIHtcbiAgICAgIHRoaXMuX2NhY2hlZEltbXV0YWJsZSA9IHRoaXMuX3RvSW1tdXRhYmxlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYWNoZWRJbW11dGFibGU7XG4gIH1cbn07XG5cbi8vIHNyYy9wcm90b2NvbC9TZXJpYWxpemVkQ3JkdC50c1xudmFyIENyZHRUeXBlID0gLyogQF9fUFVSRV9fICovICgoQ3JkdFR5cGUyKSA9PiB7XG4gIENyZHRUeXBlMltDcmR0VHlwZTJbXCJPQkpFQ1RcIl0gPSAwXSA9IFwiT0JKRUNUXCI7XG4gIENyZHRUeXBlMltDcmR0VHlwZTJbXCJMSVNUXCJdID0gMV0gPSBcIkxJU1RcIjtcbiAgQ3JkdFR5cGUyW0NyZHRUeXBlMltcIk1BUFwiXSA9IDJdID0gXCJNQVBcIjtcbiAgQ3JkdFR5cGUyW0NyZHRUeXBlMltcIlJFR0lTVEVSXCJdID0gM10gPSBcIlJFR0lTVEVSXCI7XG4gIHJldHVybiBDcmR0VHlwZTI7XG59KShDcmR0VHlwZSB8fCB7fSk7XG5mdW5jdGlvbiBpc1Jvb3RDcmR0KGNyZHQpIHtcbiAgcmV0dXJuIGNyZHQudHlwZSA9PT0gMCAvKiBPQkpFQ1QgKi8gJiYgIWlzQ2hpbGRDcmR0KGNyZHQpO1xufVxuZnVuY3Rpb24gaXNDaGlsZENyZHQoY3JkdCkge1xuICByZXR1cm4gY3JkdC5wYXJlbnRJZCAhPT0gdm9pZCAwICYmIGNyZHQucGFyZW50S2V5ICE9PSB2b2lkIDA7XG59XG5cbi8vIHNyYy9saWIvbmFub2lkLnRzXG52YXIgbmFub2lkID0gKHQgPSAyMSkgPT4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSh0KSkucmVkdWNlKFxuICAodDIsIGUpID0+IHQyICs9IChlICY9IDYzKSA8IDM2ID8gZS50b1N0cmluZygzNikgOiBlIDwgNjIgPyAoZSAtIDI2KS50b1N0cmluZygzNikudG9VcHBlckNhc2UoKSA6IGUgPCA2MyA/IFwiX1wiIDogXCItXCIsXG4gIFwiXCJcbik7XG5cbi8vIHNyYy9jcmR0cy9MaXZlUmVnaXN0ZXIudHNcbnZhciBMaXZlUmVnaXN0ZXIgPSBjbGFzcyBfTGl2ZVJlZ2lzdGVyIGV4dGVuZHMgQWJzdHJhY3RDcmR0IHtcbiAgY29uc3RydWN0b3IoZGF0YSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gIH1cbiAgZ2V0IGRhdGEoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2Rlc2VyaWFsaXplKFtpZCwgaXRlbV0sIF9wYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgcmVnaXN0ZXIgPSBuZXcgX0xpdmVSZWdpc3RlcihpdGVtLmRhdGEpO1xuICAgIHJlZ2lzdGVyLl9hdHRhY2goaWQsIHBvb2wpO1xuICAgIHJldHVybiByZWdpc3RlcjtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b09wcyhwYXJlbnRJZCwgcGFyZW50S2V5LCBwb29sKSB7XG4gICAgaWYgKHRoaXMuX2lkID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJDYW5ub3Qgc2VyaWFsaXplIHJlZ2lzdGVyIGlmIHBhcmVudElkIG9yIHBhcmVudEtleSBpcyB1bmRlZmluZWRcIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgdHlwZTogOCAvKiBDUkVBVEVfUkVHSVNURVIgKi8sXG4gICAgICAgIG9wSWQ6IHBvb2w/LmdlbmVyYXRlT3BJZCgpLFxuICAgICAgICBpZDogdGhpcy5faWQsXG4gICAgICAgIHBhcmVudElkLFxuICAgICAgICBwYXJlbnRLZXksXG4gICAgICAgIGRhdGE6IHRoaXMuZGF0YVxuICAgICAgfVxuICAgIF07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2VyaWFsaXplKCkge1xuICAgIGlmICh0aGlzLnBhcmVudC50eXBlICE9PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIExpdmVSZWdpc3RlciBpZiBwYXJlbnQgaXMgbWlzc2luZ1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IDMgLyogUkVHSVNURVIgKi8sXG4gICAgICBwYXJlbnRJZDogbm4odGhpcy5wYXJlbnQubm9kZS5faWQsIFwiUGFyZW50IG5vZGUgZXhwZWN0ZWQgdG8gaGF2ZSBJRFwiKSxcbiAgICAgIHBhcmVudEtleTogdGhpcy5wYXJlbnQua2V5LFxuICAgICAgZGF0YTogdGhpcy5kYXRhXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2hDaGlsZChfb3ApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2hDaGlsZChfY3JkdCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5KG9wLCBpc0xvY2FsKSB7XG4gICAgcmV0dXJuIHN1cGVyLl9hcHBseShvcCwgaXNMb2NhbCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9UcmVlTm9kZShrZXkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJKc29uXCIsXG4gICAgICBpZDogdGhpcy5faWQgPz8gbmFub2lkKCksXG4gICAgICBrZXksXG4gICAgICBwYXlsb2FkOiB0aGlzLl9kYXRhXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICBjbG9uZSgpIHtcbiAgICByZXR1cm4gZGVlcENsb25lKHRoaXMuZGF0YSk7XG4gIH1cbn07XG5cbi8vIHNyYy9jcmR0cy9MaXZlTGlzdC50c1xuZnVuY3Rpb24gY29tcGFyZU5vZGVQb3NpdGlvbihpdGVtQSwgaXRlbUIpIHtcbiAgY29uc3QgcG9zQSA9IGl0ZW1BLl9wYXJlbnRQb3M7XG4gIGNvbnN0IHBvc0IgPSBpdGVtQi5fcGFyZW50UG9zO1xuICByZXR1cm4gcG9zQSA9PT0gcG9zQiA/IDAgOiBwb3NBIDwgcG9zQiA/IC0xIDogMTtcbn1cbnZhciBMaXZlTGlzdCA9IGNsYXNzIF9MaXZlTGlzdCBleHRlbmRzIEFic3RyYWN0Q3JkdCB7XG4gIGNvbnN0cnVjdG9yKGl0ZW1zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9pdGVtcyA9IFtdO1xuICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtTZXQoKTtcbiAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGxldCBwb3NpdGlvbiA9IHZvaWQgMDtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gbWFrZVBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgIGNvbnN0IG5vZGUgPSBsc29uVG9MaXZlTm9kZShpdGVtKTtcbiAgICAgIG5vZGUuX3NldFBhcmVudExpbmsodGhpcywgbmV3UG9zaXRpb24pO1xuICAgICAgdGhpcy5faXRlbXMucHVzaChub2RlKTtcbiAgICAgIHBvc2l0aW9uID0gbmV3UG9zaXRpb247XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIF9kZXNlcmlhbGl6ZShbaWRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgbGlzdCA9IG5ldyBfTGl2ZUxpc3QoW10pO1xuICAgIGxpc3QuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnRUb0NoaWxkcmVuLmdldChpZCk7XG4gICAgaWYgKGNoaWxkcmVuID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBsaXN0O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtpZDIsIGNyZHRdIG9mIGNoaWxkcmVuKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGRlc2VyaWFsaXplKFtpZDIsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKGxpc3QsIGNyZHQucGFyZW50S2V5KTtcbiAgICAgIGxpc3QuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgIH1cbiAgICByZXR1cm4gbGlzdDtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqIFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IHRoZSByZXN1bHRpbmcgb3BzIHdpbGwgYmUgc2VudCB0byB0aGUgc2VydmVyIGlmIHRoZXkgaGF2ZSBhbiAnb3BJZCdcbiAgICogc28gd2UgbXV0YXRlIF91bmFja25vd2xlZGdlZFNldHMgdG8gYXZvaWQgcG90ZW50aWFsIGZsaWNrZXJpbmdcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL2xpdmVibG9ja3MvbGl2ZWJsb2Nrcy9wdWxsLzExNzdcbiAgICpcbiAgICogVGhpcyBpcyBxdWl0ZSB1bmludHVpdGl2ZSBhbmQgc2hvdWxkIGRpc2FwcGVhciBhcyBzb29uIGFzXG4gICAqIHdlIGludHJvZHVjZSBhbiBleHBsaWNpdCBMaXZlTGlzdC5TZXQgb3BlcmF0aW9uXG4gICAqL1xuICBfdG9PcHMocGFyZW50SWQsIHBhcmVudEtleSwgcG9vbCkge1xuICAgIGlmICh0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIGl0ZW0gaXMgbm90IGF0dGFjaGVkXCIpO1xuICAgIH1cbiAgICBjb25zdCBvcHMgPSBbXTtcbiAgICBjb25zdCBvcCA9IHtcbiAgICAgIGlkOiB0aGlzLl9pZCxcbiAgICAgIG9wSWQ6IHBvb2w/LmdlbmVyYXRlT3BJZCgpLFxuICAgICAgdHlwZTogMiAvKiBDUkVBVEVfTElTVCAqLyxcbiAgICAgIHBhcmVudElkLFxuICAgICAgcGFyZW50S2V5XG4gICAgfTtcbiAgICBvcHMucHVzaChvcCk7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICBjb25zdCBwYXJlbnRLZXkyID0gaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpO1xuICAgICAgY29uc3QgY2hpbGRPcHMgPSBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKFxuICAgICAgICBpdGVtLl90b09wcyh0aGlzLl9pZCwgcGFyZW50S2V5MiwgcG9vbCksXG4gICAgICAgIHZvaWQgMFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNoaWxkT3BJZCA9IGNoaWxkT3BzWzBdLm9wSWQ7XG4gICAgICBpZiAoY2hpbGRPcElkICE9PSB2b2lkIDApIHtcbiAgICAgICAgdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLnNldChwYXJlbnRLZXkyLCBjaGlsZE9wSWQpO1xuICAgICAgfVxuICAgICAgb3BzLnB1c2goLi4uY2hpbGRPcHMpO1xuICAgIH1cbiAgICByZXR1cm4gb3BzO1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICpcbiAgICogQWRkcyBhIG5ldyBpdGVtIGludG8gdGhlIHNvcnRlZCBsaXN0LCBpbiB0aGUgY29ycmVjdCBwb3NpdGlvbi5cbiAgICovXG4gIF9pbnNlcnRBbmRTb3J0KGl0ZW0pIHtcbiAgICB0aGlzLl9pdGVtcy5wdXNoKGl0ZW0pO1xuICAgIHRoaXMuX3NvcnRJdGVtcygpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3NvcnRJdGVtcygpIHtcbiAgICB0aGlzLl9pdGVtcy5zb3J0KGNvbXBhcmVOb2RlUG9zaXRpb24pO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2luZGV4T2ZQb3NpdGlvbihwb3NpdGlvbikge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcy5maW5kSW5kZXgoXG4gICAgICAoaXRlbSkgPT4gaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpID09PSBwb3NpdGlvblxuICAgICk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXR0YWNoKGlkLCBwb29sKSB7XG4gICAgc3VwZXIuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICBpdGVtLl9hdHRhY2gocG9vbC5nZW5lcmF0ZUlkKCksIHBvb2wpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9kZXRhY2goKSB7XG4gICAgc3VwZXIuX2RldGFjaCgpO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLl9pdGVtcykge1xuICAgICAgaXRlbS5fZGV0YWNoKCk7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5U2V0UmVtb3RlKG9wKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3QgeyBpZCwgcGFyZW50S2V5OiBrZXkgfSA9IG9wO1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGNoaWxkLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY29uc3QgZGVsZXRlZElkID0gb3AuZGVsZXRlZElkO1xuICAgIGNvbnN0IGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgIGlmIChpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gIT09IC0xKSB7XG4gICAgICBjb25zdCBpdGVtV2l0aFNhbWVQb3NpdGlvbiA9IHRoaXMuX2l0ZW1zW2luZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbl07XG4gICAgICBpZiAoaXRlbVdpdGhTYW1lUG9zaXRpb24uX2lkID09PSBkZWxldGVkSWQpIHtcbiAgICAgICAgaXRlbVdpdGhTYW1lUG9zaXRpb24uX2RldGFjaCgpO1xuICAgICAgICB0aGlzLl9pdGVtc1tpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb25dID0gY2hpbGQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgc2V0RGVsdGEoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uLCBjaGlsZClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5hZGQoaXRlbVdpdGhTYW1lUG9zaXRpb24pO1xuICAgICAgICB0aGlzLl9pdGVtc1tpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb25dID0gY2hpbGQ7XG4gICAgICAgIGNvbnN0IGRlbHRhID0gW1xuICAgICAgICAgIHNldERlbHRhKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiwgY2hpbGQpXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGRlbGV0ZURlbHRhMiA9IHRoaXMuX2RldGFjaEl0ZW1Bc3NvY2lhdGVkVG9TZXRPcGVyYXRpb24oXG4gICAgICAgICAgb3AuZGVsZXRlZElkXG4gICAgICAgICk7XG4gICAgICAgIGlmIChkZWxldGVEZWx0YTIpIHtcbiAgICAgICAgICBkZWx0YS5wdXNoKGRlbGV0ZURlbHRhMik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdXBkYXRlcyA9IFtdO1xuICAgICAgY29uc3QgZGVsZXRlRGVsdGEyID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihcbiAgICAgICAgb3AuZGVsZXRlZElkXG4gICAgICApO1xuICAgICAgaWYgKGRlbGV0ZURlbHRhMikge1xuICAgICAgICB1cGRhdGVzLnB1c2goZGVsZXRlRGVsdGEyKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgICAgdXBkYXRlcy5wdXNoKGluc2VydERlbHRhKHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpLCBjaGlsZCkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmV2ZXJzZTogW10sXG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIHVwZGF0ZXMpXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldEFjayhvcCkge1xuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGF0dGFjaCBjaGlsZCBpZiBtYW5hZ2VkIHBvb2wgaXMgbm90IHByZXNlbnRcIik7XG4gICAgfVxuICAgIGNvbnN0IGRlbHRhID0gW107XG4gICAgY29uc3QgZGVsZXRlZERlbHRhID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihvcC5kZWxldGVkSWQpO1xuICAgIGlmIChkZWxldGVkRGVsdGEpIHtcbiAgICAgIGRlbHRhLnB1c2goZGVsZXRlZERlbHRhKTtcbiAgICB9XG4gICAgY29uc3QgdW5hY2tub3dsZWRnZWRPcElkID0gdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLmdldChvcC5wYXJlbnRLZXkpO1xuICAgIGlmICh1bmFja25vd2xlZGdlZE9wSWQgIT09IHZvaWQgMCkge1xuICAgICAgaWYgKHVuYWNrbm93bGVkZ2VkT3BJZCAhPT0gb3Aub3BJZCkge1xuICAgICAgICByZXR1cm4gZGVsdGEubGVuZ3RoID09PSAwID8geyBtb2RpZmllZDogZmFsc2UgfSA6IHsgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgZGVsdGEpLCByZXZlcnNlOiBbXSB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLmRlbGV0ZShvcC5wYXJlbnRLZXkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gPSB0aGlzLl9pbmRleE9mUG9zaXRpb24ob3AucGFyZW50S2V5KTtcbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLl9pdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLl9pZCA9PT0gb3AuaWQpO1xuICAgIGlmIChleGlzdGluZ0l0ZW0gIT09IHZvaWQgMCkge1xuICAgICAgaWYgKGV4aXN0aW5nSXRlbS5fcGFyZW50S2V5ID09PSBvcC5wYXJlbnRLZXkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZGVsdGEubGVuZ3RoID4gMCA/IG1ha2VVcGRhdGUodGhpcywgZGVsdGEpIDogZmFsc2UsXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gIT09IC0xKSB7XG4gICAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuYWRkKFxuICAgICAgICAgIHRoaXMuX2l0ZW1zW2luZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbl1cbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5faXRlbXMuc3BsaWNlKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiwgMSk7XG4gICAgICAgIGRlbHRhLnB1c2goZGVsZXRlRGVsdGEoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uKSk7XG4gICAgICB9XG4gICAgICBjb25zdCBwcmV2aW91c0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihleGlzdGluZ0l0ZW0pO1xuICAgICAgZXhpc3RpbmdJdGVtLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG9wLnBhcmVudEtleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihleGlzdGluZ0l0ZW0pO1xuICAgICAgaWYgKG5ld0luZGV4ICE9PSBwcmV2aW91c0luZGV4KSB7XG4gICAgICAgIGRlbHRhLnB1c2gobW92ZURlbHRhKHByZXZpb3VzSW5kZXgsIG5ld0luZGV4LCBleGlzdGluZ0l0ZW0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBkZWx0YS5sZW5ndGggPiAwID8gbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSkgOiBmYWxzZSxcbiAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG9ycGhhbiA9IHRoaXMuX3Bvb2wuZ2V0Tm9kZShvcC5pZCk7XG4gICAgICBpZiAob3JwaGFuICYmIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuaGFzKG9ycGhhbikpIHtcbiAgICAgICAgb3JwaGFuLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG9wLnBhcmVudEtleSk7XG4gICAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuZGVsZXRlKG9ycGhhbik7XG4gICAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQob3JwaGFuKTtcbiAgICAgICAgY29uc3QgcmVjcmVhdGVkSXRlbUluZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihvcnBoYW4pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGl0ZW0gYXQgdGhpcyBwb3NpdGlvbiwgdXBkYXRlIGlzIGEgc2V0LCBlbHNlIGl0J3MgYW4gaW5zZXJ0XG4gICAgICAgICAgICBpbmRleE9mSXRlbVdpdGhTYW1lUG9zaXRpb24gPT09IC0xID8gaW5zZXJ0RGVsdGEocmVjcmVhdGVkSXRlbUluZGV4LCBvcnBoYW4pIDogc2V0RGVsdGEocmVjcmVhdGVkSXRlbUluZGV4LCBvcnBoYW4pLFxuICAgICAgICAgICAgLi4uZGVsdGFcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGluZGV4T2ZJdGVtV2l0aFNhbWVQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IG5ld0l0ZW0sIG5ld0luZGV4IH0gPSB0aGlzLl9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChcbiAgICAgICAgICBvcCxcbiAgICAgICAgICBvcC5wYXJlbnRLZXlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbXG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpdGVtIGF0IHRoaXMgcG9zaXRpb24sIHVwZGF0ZSBpcyBhIHNldCwgZWxzZSBpdCdzIGFuIGluc2VydFxuICAgICAgICAgICAgaW5kZXhPZkl0ZW1XaXRoU2FtZVBvc2l0aW9uID09PSAtMSA/IGluc2VydERlbHRhKG5ld0luZGV4LCBuZXdJdGVtKSA6IHNldERlbHRhKG5ld0luZGV4LCBuZXdJdGVtKSxcbiAgICAgICAgICAgIC4uLmRlbHRhXG4gICAgICAgICAgXSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHVwZGF0ZSBkZWx0YSBvZiB0aGUgZGVsZXRpb24gb3IgbnVsbFxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9kZXRhY2hJdGVtQXNzb2NpYXRlZFRvU2V0T3BlcmF0aW9uKGRlbGV0ZWRJZCkge1xuICAgIGlmIChkZWxldGVkSWQgPT09IHZvaWQgMCB8fCB0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBkZWxldGVkSXRlbSA9IHRoaXMuX3Bvb2wuZ2V0Tm9kZShkZWxldGVkSWQpO1xuICAgIGlmIChkZWxldGVkSXRlbSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5fZGV0YWNoQ2hpbGQoZGVsZXRlZEl0ZW0pO1xuICAgIGlmIChyZXN1bHQubW9kaWZpZWQgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdC5tb2RpZmllZC51cGRhdGVzWzBdO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5UmVtb3RlSW5zZXJ0KG9wKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgY29uc3Qga2V5ID0gYXNQb3Mob3AucGFyZW50S2V5KTtcbiAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihrZXkpO1xuICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCAhPT0gLTEpIHtcbiAgICAgIHRoaXMuX3NoaWZ0SXRlbVBvc2l0aW9uKGV4aXN0aW5nSXRlbUluZGV4LCBrZXkpO1xuICAgIH1cbiAgICBjb25zdCB7IG5ld0l0ZW0sIG5ld0luZGV4IH0gPSB0aGlzLl9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChvcCwga2V5KTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2luc2VydERlbHRhKG5ld0luZGV4LCBuZXdJdGVtKV0pLFxuICAgICAgcmV2ZXJzZTogW11cbiAgICB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5SW5zZXJ0QWNrKG9wKSB7XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5faXRlbXMuZmluZCgoaXRlbSkgPT4gaXRlbS5faWQgPT09IG9wLmlkKTtcbiAgICBjb25zdCBrZXkgPSBhc1BvcyhvcC5wYXJlbnRLZXkpO1xuICAgIGNvbnN0IGl0ZW1JbmRleEF0UG9zaXRpb24gPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XG4gICAgICBpZiAoZXhpc3RpbmdJdGVtLl9wYXJlbnRLZXkgPT09IGtleSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgb2xkUG9zaXRpb25JbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoZXhpc3RpbmdJdGVtKTtcbiAgICAgICAgaWYgKGl0ZW1JbmRleEF0UG9zaXRpb24gIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5fc2hpZnRJdGVtUG9zaXRpb24oaXRlbUluZGV4QXRQb3NpdGlvbiwga2V5KTtcbiAgICAgICAgfVxuICAgICAgICBleGlzdGluZ0l0ZW0uX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICAgICAgdGhpcy5fc29ydEl0ZW1zKCk7XG4gICAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgICAgIGlmIChuZXdJbmRleCA9PT0gb2xkUG9zaXRpb25JbmRleCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgbW92ZURlbHRhKG9sZFBvc2l0aW9uSW5kZXgsIG5ld0luZGV4LCBleGlzdGluZ0l0ZW0pXG4gICAgICAgICAgXSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgb3JwaGFuID0gbm4odGhpcy5fcG9vbCkuZ2V0Tm9kZShvcC5pZCk7XG4gICAgICBpZiAob3JwaGFuICYmIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuaGFzKG9ycGhhbikpIHtcbiAgICAgICAgb3JwaGFuLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICAgIHRoaXMuX2ltcGxpY2l0bHlEZWxldGVkSXRlbXMuZGVsZXRlKG9ycGhhbik7XG4gICAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQob3JwaGFuKTtcbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIG9ycGhhbildKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGl0ZW1JbmRleEF0UG9zaXRpb24gIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5fc2hpZnRJdGVtUG9zaXRpb24oaXRlbUluZGV4QXRQb3NpdGlvbiwga2V5KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IG5ld0l0ZW0sIG5ld0luZGV4IH0gPSB0aGlzLl9jcmVhdGVBdHRhY2hJdGVtQW5kU29ydChvcCwga2V5KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIG5ld0l0ZW0pXSksXG4gICAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlJbnNlcnRVbmRvUmVkbyhvcCkge1xuICAgIGNvbnN0IHsgaWQsIHBhcmVudEtleToga2V5IH0gPSBvcDtcbiAgICBjb25zdCBjaGlsZCA9IGNyZWF0aW9uT3BUb0xpdmVOb2RlKG9wKTtcbiAgICBpZiAodGhpcy5fcG9vbD8uZ2V0Tm9kZShpZCkgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGNoaWxkLl9hdHRhY2goaWQsIG5uKHRoaXMuX3Bvb2wpKTtcbiAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgbGV0IG5ld0tleSA9IGtleTtcbiAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggIT09IC0xKSB7XG4gICAgICBjb25zdCBiZWZvcmUyID0gdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdPy5fcGFyZW50UG9zO1xuICAgICAgY29uc3QgYWZ0ZXIyID0gdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXggKyAxXT8uX3BhcmVudFBvcztcbiAgICAgIG5ld0tleSA9IG1ha2VQb3NpdGlvbihiZWZvcmUyLCBhZnRlcjIpO1xuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICB9XG4gICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2luc2VydERlbHRhKG5ld0luZGV4LCBjaGlsZCldKSxcbiAgICAgIHJldmVyc2U6IFt7IHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sIGlkIH1dXG4gICAgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldFVuZG9SZWRvKG9wKSB7XG4gICAgY29uc3QgeyBpZCwgcGFyZW50S2V5OiBrZXkgfSA9IG9wO1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGlmICh0aGlzLl9wb29sPy5nZXROb2RlKGlkKSAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgdGhpcy5fdW5hY2tub3dsZWRnZWRTZXRzLnNldChrZXksIG5uKG9wLm9wSWQpKTtcbiAgICBjb25zdCBpbmRleE9mSXRlbVdpdGhTYW1lS2V5ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKGtleSk7XG4gICAgY2hpbGQuX2F0dGFjaChpZCwgbm4odGhpcy5fcG9vbCkpO1xuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY29uc3QgbmV3S2V5ID0ga2V5O1xuICAgIGlmIChpbmRleE9mSXRlbVdpdGhTYW1lS2V5ICE9PSAtMSkge1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5faXRlbXNbaW5kZXhPZkl0ZW1XaXRoU2FtZUtleV07XG4gICAgICBleGlzdGluZ0l0ZW0uX2RldGFjaCgpO1xuICAgICAgdGhpcy5faXRlbXNbaW5kZXhPZkl0ZW1XaXRoU2FtZUtleV0gPSBjaGlsZDtcbiAgICAgIGNvbnN0IHJldmVyc2UgPSBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKFxuICAgICAgICBleGlzdGluZ0l0ZW0uX3RvT3BzKG5uKHRoaXMuX2lkKSwga2V5LCB0aGlzLl9wb29sKSxcbiAgICAgICAgb3AuaWRcbiAgICAgICk7XG4gICAgICBjb25zdCBkZWx0YSA9IFtzZXREZWx0YShpbmRleE9mSXRlbVdpdGhTYW1lS2V5LCBjaGlsZCldO1xuICAgICAgY29uc3QgZGVsZXRlZERlbHRhID0gdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihcbiAgICAgICAgb3AuZGVsZXRlZElkXG4gICAgICApO1xuICAgICAgaWYgKGRlbGV0ZWREZWx0YSkge1xuICAgICAgICBkZWx0YS5wdXNoKGRlbGV0ZWREZWx0YSk7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBkZWx0YSksXG4gICAgICAgIHJldmVyc2VcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgICAgdGhpcy5fZGV0YWNoSXRlbUFzc29jaWF0ZWRUb1NldE9wZXJhdGlvbihvcC5kZWxldGVkSWQpO1xuICAgICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJldmVyc2U6IFt7IHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sIGlkIH1dLFxuICAgICAgICBtb2RpZmllZDogbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEobmV3SW5kZXgsIGNoaWxkKV0pXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hdHRhY2hDaGlsZChvcCwgc291cmNlKSB7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYXR0YWNoIGNoaWxkIGlmIG1hbmFnZWQgcG9vbCBpcyBub3QgcHJlc2VudFwiKTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdDtcbiAgICBpZiAob3AuaW50ZW50ID09PSBcInNldFwiKSB7XG4gICAgICBpZiAoc291cmNlID09PSAxIC8qIFJFTU9URSAqLykge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseVNldFJlbW90ZShvcCk7XG4gICAgICB9IGVsc2UgaWYgKHNvdXJjZSA9PT0gMiAvKiBBQ0sgKi8pIHtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5fYXBwbHlTZXRBY2sob3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5fYXBwbHlTZXRVbmRvUmVkbyhvcCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzb3VyY2UgPT09IDEgLyogUkVNT1RFICovKSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuX2FwcGx5UmVtb3RlSW5zZXJ0KG9wKTtcbiAgICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseUluc2VydEFjayhvcCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgPSB0aGlzLl9hcHBseUluc2VydFVuZG9SZWRvKG9wKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlc3VsdC5tb2RpZmllZCAhPT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2RldGFjaENoaWxkKGNoaWxkKSB7XG4gICAgaWYgKGNoaWxkKSB7XG4gICAgICBjb25zdCBwYXJlbnRLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICAgIGNvbnN0IHJldmVyc2UgPSBjaGlsZC5fdG9PcHMobm4odGhpcy5faWQpLCBwYXJlbnRLZXksIHRoaXMuX3Bvb2wpO1xuICAgICAgY29uc3QgaW5kZXhUb0RlbGV0ZSA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgaWYgKGluZGV4VG9EZWxldGUgPT09IC0xKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXhUb0RlbGV0ZSwgMSk7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIGNoaWxkLl9kZXRhY2goKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFtkZWxldGVEZWx0YShpbmRleFRvRGVsZXRlKV0pLFxuICAgICAgICByZXZlcnNlXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldENoaWxkS2V5UmVtb3RlKG5ld0tleSwgY2hpbGQpIHtcbiAgICBpZiAodGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5oYXMoY2hpbGQpKSB7XG4gICAgICB0aGlzLl9pbXBsaWNpdGx5RGVsZXRlZEl0ZW1zLmRlbGV0ZShjaGlsZCk7XG4gICAgICBjaGlsZC5fc2V0UGFyZW50TGluayh0aGlzLCBuZXdLZXkpO1xuICAgICAgdGhpcy5faW5zZXJ0QW5kU29ydChjaGlsZCk7XG4gICAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW2luc2VydERlbHRhKG5ld0luZGV4LCBjaGlsZCldKSxcbiAgICAgICAgcmV2ZXJzZTogW11cbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzS2V5ID0gY2hpbGQuX3BhcmVudEtleTtcbiAgICBpZiAobmV3S2V5ID09PSBwcmV2aW91c0tleSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA9PT0gLTEpIHtcbiAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAobmV3SW5kZXggPT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFttb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgbmV3SW5kZXgsIGNoaWxkKV0pLFxuICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLl9zZXRQYXJlbnRMaW5rKFxuICAgICAgICB0aGlzLFxuICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGNoaWxkKTtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAobmV3SW5kZXggPT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGlmaWVkOiBtYWtlVXBkYXRlKHRoaXMsIFttb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgbmV3SW5kZXgsIGNoaWxkKV0pLFxuICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHlTZXRDaGlsZEtleUFjayhuZXdLZXksIGNoaWxkKSB7XG4gICAgY29uc3QgcHJldmlvdXNLZXkgPSBubihjaGlsZC5fcGFyZW50S2V5KTtcbiAgICBpZiAodGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5oYXMoY2hpbGQpKSB7XG4gICAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHRoaXMuX2luZGV4T2ZQb3NpdGlvbihuZXdLZXkpO1xuICAgICAgdGhpcy5faW1wbGljaXRseURlbGV0ZWRJdGVtcy5kZWxldGUoY2hpbGQpO1xuICAgICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ICE9PSAtMSkge1xuICAgICAgICB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uX3NldFBhcmVudExpbmsoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICAgIHRoaXMuX2luc2VydEFuZFNvcnQoY2hpbGQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAobmV3S2V5ID09PSBwcmV2aW91c0tleSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGlmaWVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24obmV3S2V5KTtcbiAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLl9zZXRQYXJlbnRMaW5rKFxuICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgbWFrZVBvc2l0aW9uKG5ld0tleSwgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXggKyAxXT8uX3BhcmVudFBvcylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIG5ld0tleSk7XG4gICAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAocHJldmlvdXNJbmRleCA9PT0gbmV3SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RpZmllZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW1xuICAgICAgICAgICAgbW92ZURlbHRhKHByZXZpb3VzSW5kZXgsIG5ld0luZGV4LCBjaGlsZClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICByZXZlcnNlOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVNldENoaWxkS2V5VW5kb1JlZG8obmV3S2V5LCBjaGlsZCkge1xuICAgIGNvbnN0IHByZXZpb3VzS2V5ID0gbm4oY2hpbGQuX3BhcmVudEtleSk7XG4gICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdGhpcy5faW5kZXhPZlBvc2l0aW9uKG5ld0tleSk7XG4gICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ICE9PSAtMSkge1xuICAgICAgdGhpcy5faXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLl9zZXRQYXJlbnRMaW5rKFxuICAgICAgICB0aGlzLFxuICAgICAgICBtYWtlUG9zaXRpb24obmV3S2V5LCB0aGlzLl9pdGVtc1tleGlzdGluZ0l0ZW1JbmRleCArIDFdPy5fcGFyZW50UG9zKVxuICAgICAgKTtcbiAgICB9XG4gICAgY2hpbGQuX3NldFBhcmVudExpbmsodGhpcywgbmV3S2V5KTtcbiAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoY2hpbGQpO1xuICAgIGlmIChwcmV2aW91c0luZGV4ID09PSBuZXdJbmRleCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kaWZpZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IG1ha2VVcGRhdGUodGhpcywgW21vdmVEZWx0YShwcmV2aW91c0luZGV4LCBuZXdJbmRleCwgY2hpbGQpXSksXG4gICAgICByZXZlcnNlOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAxIC8qIFNFVF9QQVJFTlRfS0VZICovLFxuICAgICAgICAgIGlkOiBubihjaGlsZC5faWQpLFxuICAgICAgICAgIHBhcmVudEtleTogcHJldmlvdXNLZXlcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2V0Q2hpbGRLZXkobmV3S2V5LCBjaGlsZCwgc291cmNlKSB7XG4gICAgaWYgKHNvdXJjZSA9PT0gMSAvKiBSRU1PVEUgKi8pIHtcbiAgICAgIHJldHVybiB0aGlzLl9hcHBseVNldENoaWxkS2V5UmVtb3RlKG5ld0tleSwgY2hpbGQpO1xuICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5U2V0Q2hpbGRLZXlBY2sobmV3S2V5LCBjaGlsZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLl9hcHBseVNldENoaWxkS2V5VW5kb1JlZG8obmV3S2V5LCBjaGlsZCk7XG4gICAgfVxuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2FwcGx5KG9wLCBpc0xvY2FsKSB7XG4gICAgcmV0dXJuIHN1cGVyLl9hcHBseShvcCwgaXNMb2NhbCk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfc2VyaWFsaXplKCkge1xuICAgIGlmICh0aGlzLnBhcmVudC50eXBlICE9PSBcIkhhc1BhcmVudFwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIExpdmVMaXN0IGlmIHBhcmVudCBpcyBtaXNzaW5nXCIpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogMSAvKiBMSVNUICovLFxuICAgICAgcGFyZW50SWQ6IG5uKHRoaXMucGFyZW50Lm5vZGUuX2lkLCBcIlBhcmVudCBub2RlIGV4cGVjdGVkIHRvIGhhdmUgSURcIiksXG4gICAgICBwYXJlbnRLZXk6IHRoaXMucGFyZW50LmtleVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cy5cbiAgICovXG4gIGdldCBsZW5ndGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmxlbmd0aDtcbiAgfVxuICAvKipcbiAgICogQWRkcyBvbmUgZWxlbWVudCB0byB0aGUgZW5kIG9mIHRoZSBMaXZlTGlzdC5cbiAgICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gYWRkIHRvIHRoZSBlbmQgb2YgdGhlIExpdmVMaXN0LlxuICAgKi9cbiAgcHVzaChlbGVtZW50KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICByZXR1cm4gdGhpcy5pbnNlcnQoZWxlbWVudCwgdGhpcy5sZW5ndGgpO1xuICB9XG4gIC8qKlxuICAgKiBJbnNlcnRzIG9uZSBlbGVtZW50IGF0IGEgc3BlY2lmaWVkIGluZGV4LlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byBpbnNlcnQuXG4gICAqIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggYXQgd2hpY2ggeW91IHdhbnQgdG8gaW5zZXJ0IHRoZSBlbGVtZW50LlxuICAgKi9cbiAgaW5zZXJ0KGVsZW1lbnQsIGluZGV4KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDYW5ub3QgaW5zZXJ0IGxpc3QgaXRlbSBhdCBpbmRleCBcIlx1MDAxZCR7aW5kZXh9XCIuIGluZGV4IHNob3VsZCBiZSBiZXR3ZWVuIDAgYW5kICR7dGhpcy5faXRlbXMubGVuZ3RofWBcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IGJlZm9yZTIgPSB0aGlzLl9pdGVtc1tpbmRleCAtIDFdID8gdGhpcy5faXRlbXNbaW5kZXggLSAxXS5fcGFyZW50UG9zIDogdm9pZCAwO1xuICAgIGNvbnN0IGFmdGVyMiA9IHRoaXMuX2l0ZW1zW2luZGV4XSA/IHRoaXMuX2l0ZW1zW2luZGV4XS5fcGFyZW50UG9zIDogdm9pZCAwO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gbWFrZVBvc2l0aW9uKGJlZm9yZTIsIGFmdGVyMik7XG4gICAgY29uc3QgdmFsdWUgPSBsc29uVG9MaXZlTm9kZShlbGVtZW50KTtcbiAgICB2YWx1ZS5fc2V0UGFyZW50TGluayh0aGlzLCBwb3NpdGlvbik7XG4gICAgdGhpcy5faW5zZXJ0QW5kU29ydCh2YWx1ZSk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgJiYgdGhpcy5faWQpIHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5fcG9vbC5nZW5lcmF0ZUlkKCk7XG4gICAgICB2YWx1ZS5fYXR0YWNoKGlkLCB0aGlzLl9wb29sKTtcbiAgICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2goXG4gICAgICAgIHZhbHVlLl90b09wcyh0aGlzLl9pZCwgcG9zaXRpb24sIHRoaXMuX3Bvb2wpLFxuICAgICAgICBbeyB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovLCBpZCB9XSxcbiAgICAgICAgLyogQF9fUFVSRV9fICovIG5ldyBNYXAoW1xuICAgICAgICAgIFt0aGlzLl9pZCwgbWFrZVVwZGF0ZSh0aGlzLCBbaW5zZXJ0RGVsdGEoaW5kZXgsIHZhbHVlKV0pXVxuICAgICAgICBdKVxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIE1vdmUgb25lIGVsZW1lbnQgZnJvbSBvbmUgaW5kZXggdG8gYW5vdGhlci5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgZWxlbWVudCB0byBtb3ZlXG4gICAqIEBwYXJhbSB0YXJnZXRJbmRleCBUaGUgaW5kZXggd2hlcmUgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIGFmdGVyIG1vdmluZy5cbiAgICovXG4gIG1vdmUoaW5kZXgsIHRhcmdldEluZGV4KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAodGFyZ2V0SW5kZXggPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0YXJnZXRJbmRleCBjYW5ub3QgYmUgbGVzcyB0aGFuIDBcIik7XG4gICAgfVxuICAgIGlmICh0YXJnZXRJbmRleCA+PSB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJ0YXJnZXRJbmRleCBjYW5ub3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0aGFuIHRoZSBsaXN0IGxlbmd0aFwiXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbmRleCBjYW5ub3QgYmUgbGVzcyB0aGFuIDBcIik7XG4gICAgfVxuICAgIGlmIChpbmRleCA+PSB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImluZGV4IGNhbm5vdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRoYW4gdGhlIGxpc3QgbGVuZ3RoXCIpO1xuICAgIH1cbiAgICBsZXQgYmVmb3JlUG9zaXRpb24gPSBudWxsO1xuICAgIGxldCBhZnRlclBvc2l0aW9uID0gbnVsbDtcbiAgICBpZiAoaW5kZXggPCB0YXJnZXRJbmRleCkge1xuICAgICAgYWZ0ZXJQb3NpdGlvbiA9IHRhcmdldEluZGV4ID09PSB0aGlzLl9pdGVtcy5sZW5ndGggLSAxID8gdm9pZCAwIDogdGhpcy5faXRlbXNbdGFyZ2V0SW5kZXggKyAxXS5fcGFyZW50UG9zO1xuICAgICAgYmVmb3JlUG9zaXRpb24gPSB0aGlzLl9pdGVtc1t0YXJnZXRJbmRleF0uX3BhcmVudFBvcztcbiAgICB9IGVsc2Uge1xuICAgICAgYWZ0ZXJQb3NpdGlvbiA9IHRoaXMuX2l0ZW1zW3RhcmdldEluZGV4XS5fcGFyZW50UG9zO1xuICAgICAgYmVmb3JlUG9zaXRpb24gPSB0YXJnZXRJbmRleCA9PT0gMCA/IHZvaWQgMCA6IHRoaXMuX2l0ZW1zW3RhcmdldEluZGV4IC0gMV0uX3BhcmVudFBvcztcbiAgICB9XG4gICAgY29uc3QgcG9zaXRpb24gPSBtYWtlUG9zaXRpb24oYmVmb3JlUG9zaXRpb24sIGFmdGVyUG9zaXRpb24pO1xuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07XG4gICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IGl0ZW0uX2dldFBhcmVudEtleU9yVGhyb3coKTtcbiAgICBpdGVtLl9zZXRQYXJlbnRMaW5rKHRoaXMsIHBvc2l0aW9uKTtcbiAgICB0aGlzLl9zb3J0SXRlbXMoKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiB0aGlzLl9pZCkge1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcChbXG4gICAgICAgIFt0aGlzLl9pZCwgbWFrZVVwZGF0ZSh0aGlzLCBbbW92ZURlbHRhKGluZGV4LCB0YXJnZXRJbmRleCwgaXRlbSldKV1cbiAgICAgIF0pO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IDEgLyogU0VUX1BBUkVOVF9LRVkgKi8sXG4gICAgICAgICAgICBpZDogbm4oaXRlbS5faWQpLFxuICAgICAgICAgICAgb3BJZDogdGhpcy5fcG9vbC5nZW5lcmF0ZU9wSWQoKSxcbiAgICAgICAgICAgIHBhcmVudEtleTogcG9zaXRpb25cbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAxIC8qIFNFVF9QQVJFTlRfS0VZICovLFxuICAgICAgICAgICAgaWQ6IG5uKGl0ZW0uX2lkKSxcbiAgICAgICAgICAgIHBhcmVudEtleTogcHJldmlvdXNQb3NpdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgc3RvcmFnZVVwZGF0ZXNcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBEZWxldGVzIGFuIGVsZW1lbnQgYXQgdGhlIHNwZWNpZmllZCBpbmRleFxuICAgKiBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHRvIGRlbGV0ZVxuICAgKi9cbiAgZGVsZXRlKGluZGV4KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ2Fubm90IGRlbGV0ZSBsaXN0IGl0ZW0gYXQgaW5kZXggXCIke2luZGV4fVwiLiBpbmRleCBzaG91bGQgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMuX2l0ZW1zLmxlbmd0aCAtIDF9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuX2l0ZW1zW2luZGV4XTtcbiAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgIGlmICh0aGlzLl9wb29sKSB7XG4gICAgICBjb25zdCBjaGlsZFJlY29yZElkID0gaXRlbS5faWQ7XG4gICAgICBpZiAoY2hpbGRSZWNvcmRJZCkge1xuICAgICAgICBjb25zdCBzdG9yYWdlVXBkYXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzLnNldChcbiAgICAgICAgICBubih0aGlzLl9pZCksXG4gICAgICAgICAgbWFrZVVwZGF0ZSh0aGlzLCBbZGVsZXRlRGVsdGEoaW5kZXgpXSlcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgICBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiBjaGlsZFJlY29yZElkLFxuICAgICAgICAgICAgICBvcElkOiB0aGlzLl9wb29sLmdlbmVyYXRlT3BJZCgpLFxuICAgICAgICAgICAgICB0eXBlOiA1IC8qIERFTEVURV9DUkRUICovXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBpdGVtLl90b09wcyhubih0aGlzLl9pZCksIGl0ZW0uX2dldFBhcmVudEtleU9yVGhyb3coKSksXG4gICAgICAgICAgc3RvcmFnZVVwZGF0ZXNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCkge1xuICAgICAgY29uc3Qgb3BzID0gW107XG4gICAgICBjb25zdCByZXZlcnNlT3BzID0gW107XG4gICAgICBjb25zdCB1cGRhdGVEZWx0YSA9IFtdO1xuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX2l0ZW1zKSB7XG4gICAgICAgIGl0ZW0uX2RldGFjaCgpO1xuICAgICAgICBjb25zdCBjaGlsZElkID0gaXRlbS5faWQ7XG4gICAgICAgIGlmIChjaGlsZElkKSB7XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLyxcbiAgICAgICAgICAgIGlkOiBjaGlsZElkLFxuICAgICAgICAgICAgb3BJZDogdGhpcy5fcG9vbC5nZW5lcmF0ZU9wSWQoKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldmVyc2VPcHMucHVzaChcbiAgICAgICAgICAgIC4uLml0ZW0uX3RvT3BzKG5uKHRoaXMuX2lkKSwgaXRlbS5fZ2V0UGFyZW50S2V5T3JUaHJvdygpKVxuICAgICAgICAgICk7XG4gICAgICAgICAgdXBkYXRlRGVsdGEucHVzaChkZWxldGVEZWx0YSgwKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgIHN0b3JhZ2VVcGRhdGVzLnNldChubih0aGlzLl9pZCksIG1ha2VVcGRhdGUodGhpcywgdXBkYXRlRGVsdGEpKTtcbiAgICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2gob3BzLCByZXZlcnNlT3BzLCBzdG9yYWdlVXBkYXRlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLl9pdGVtcykge1xuICAgICAgICBpdGVtLl9kZXRhY2goKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICB9XG4gIH1cbiAgc2V0KGluZGV4LCBpdGVtKSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ2Fubm90IHNldCBsaXN0IGl0ZW0gYXQgaW5kZXggXCJcdTAwMWQke2luZGV4fVwiLiBpbmRleCBzaG91bGQgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMuX2l0ZW1zLmxlbmd0aCAtIDF9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5faXRlbXNbaW5kZXhdO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gZXhpc3RpbmdJdGVtLl9nZXRQYXJlbnRLZXlPclRocm93KCk7XG4gICAgY29uc3QgZXhpc3RpbmdJZCA9IGV4aXN0aW5nSXRlbS5faWQ7XG4gICAgZXhpc3RpbmdJdGVtLl9kZXRhY2goKTtcbiAgICBjb25zdCB2YWx1ZSA9IGxzb25Ub0xpdmVOb2RlKGl0ZW0pO1xuICAgIHZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIHBvc2l0aW9uKTtcbiAgICB0aGlzLl9pdGVtc1tpbmRleF0gPSB2YWx1ZTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICBpZiAodGhpcy5fcG9vbCAmJiB0aGlzLl9pZCkge1xuICAgICAgY29uc3QgaWQgPSB0aGlzLl9wb29sLmdlbmVyYXRlSWQoKTtcbiAgICAgIHZhbHVlLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXMuX2lkLCBtYWtlVXBkYXRlKHRoaXMsIFtzZXREZWx0YShpbmRleCwgdmFsdWUpXSkpO1xuICAgICAgY29uc3Qgb3BzID0gSEFDS19hZGRJbnRlbnRBbmREZWxldGVkSWRUb09wZXJhdGlvbihcbiAgICAgICAgdmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBwb3NpdGlvbiwgdGhpcy5fcG9vbCksXG4gICAgICAgIGV4aXN0aW5nSWRcbiAgICAgICk7XG4gICAgICB0aGlzLl91bmFja25vd2xlZGdlZFNldHMuc2V0KHBvc2l0aW9uLCBubihvcHNbMF0ub3BJZCkpO1xuICAgICAgY29uc3QgcmV2ZXJzZU9wcyA9IEhBQ0tfYWRkSW50ZW50QW5kRGVsZXRlZElkVG9PcGVyYXRpb24oXG4gICAgICAgIGV4aXN0aW5nSXRlbS5fdG9PcHModGhpcy5faWQsIHBvc2l0aW9uLCB2b2lkIDApLFxuICAgICAgICBpZFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2gob3BzLCByZXZlcnNlT3BzLCBzdG9yYWdlVXBkYXRlcyk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIEFycmF5IG9mIGFsbCB0aGUgZWxlbWVudHMgaW4gdGhlIExpdmVMaXN0LlxuICAgKi9cbiAgdG9BcnJheSgpIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXMubWFwKFxuICAgICAgKGVudHJ5KSA9PiBsaXZlTm9kZVRvTHNvbihlbnRyeSlcbiAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eXG4gICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGSVhNRSEgVGhpcyBpc24ndCBzYWZlLlxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIFRlc3RzIHdoZXRoZXIgYWxsIGVsZW1lbnRzIHBhc3MgdGhlIHRlc3QgaW1wbGVtZW50ZWQgYnkgdGhlIHByb3ZpZGVkIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0gcHJlZGljYXRlIEZ1bmN0aW9uIHRvIHRlc3QgZm9yIGVhY2ggZWxlbWVudCwgdGFraW5nIHR3byBhcmd1bWVudHMgKHRoZSBlbGVtZW50IGFuZCBpdHMgaW5kZXgpLlxuICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBwcmVkaWNhdGUgZnVuY3Rpb24gcmV0dXJucyBhIHRydXRoeSB2YWx1ZSBmb3IgZXZlcnkgZWxlbWVudC4gT3RoZXJ3aXNlLCBmYWxzZS5cbiAgICovXG4gIGV2ZXJ5KHByZWRpY2F0ZSkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5ldmVyeShwcmVkaWNhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGVsZW1lbnRzIHRoYXQgcGFzcyB0aGUgdGVzdCBpbXBsZW1lbnRlZCBieSB0aGUgcHJvdmlkZWQgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUgRnVuY3Rpb24gdG8gdGVzdCBlYWNoIGVsZW1lbnQgb2YgdGhlIExpdmVMaXN0LiBSZXR1cm4gYSB2YWx1ZSB0aGF0IGNvZXJjZXMgdG8gdHJ1ZSB0byBrZWVwIHRoZSBlbGVtZW50LCBvciB0byBmYWxzZSBvdGhlcndpc2UuXG4gICAqIEByZXR1cm5zIEFuIGFycmF5IHdpdGggdGhlIGVsZW1lbnRzIHRoYXQgcGFzcyB0aGUgdGVzdC5cbiAgICovXG4gIGZpbHRlcihwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuZmlsdGVyKHByZWRpY2F0ZSk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBzYXRpc2ZpZXMgdGhlIHByb3ZpZGVkIHRlc3RpbmcgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUgRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIHZhbHVlLlxuICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIExpdmVMaXN0IHRoYXQgc2F0aXNmaWVzIHRoZSBwcm92aWRlZCB0ZXN0aW5nIGZ1bmN0aW9uLiBPdGhlcndpc2UsIHVuZGVmaW5lZCBpcyByZXR1cm5lZC5cbiAgICovXG4gIGZpbmQocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmZpbmQocHJlZGljYXRlKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIExpdmVMaXN0IHRoYXQgc2F0aXNmaWVzIHRoZSBwcm92aWRlZCB0ZXN0aW5nIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0gcHJlZGljYXRlIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgb24gZWFjaCB2YWx1ZSB1bnRpbCB0aGUgZnVuY3Rpb24gcmV0dXJucyB0cnVlLCBpbmRpY2F0aW5nIHRoYXQgdGhlIHNhdGlzZnlpbmcgZWxlbWVudCB3YXMgZm91bmQuXG4gICAqIEByZXR1cm5zIFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgTGl2ZUxpc3QgdGhhdCBwYXNzZXMgdGhlIHRlc3QuIE90aGVyd2lzZSwgLTEuXG4gICAqL1xuICBmaW5kSW5kZXgocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmZpbmRJbmRleChwcmVkaWNhdGUpO1xuICB9XG4gIC8qKlxuICAgKiBFeGVjdXRlcyBhIHByb3ZpZGVkIGZ1bmN0aW9uIG9uY2UgZm9yIGVhY2ggZWxlbWVudC5cbiAgICogQHBhcmFtIGNhbGxiYWNrZm4gRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIGVsZW1lbnQuXG4gICAqL1xuICBmb3JFYWNoKGNhbGxiYWNrZm4pIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuZm9yRWFjaChjYWxsYmFja2ZuKTtcbiAgfVxuICAvKipcbiAgICogR2V0IHRoZSBlbGVtZW50IGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguXG4gICAqIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb24gdGhlIGVsZW1lbnQgdG8gZ2V0LlxuICAgKiBAcmV0dXJucyBUaGUgZWxlbWVudCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIHVuZGVmaW5lZC5cbiAgICovXG4gIGdldChpbmRleCkge1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgICByZXR1cm4gbGl2ZU5vZGVUb0xzb24odGhpcy5faXRlbXNbaW5kZXhdKTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZmlyc3QgaW5kZXggYXQgd2hpY2ggYSBnaXZlbiBlbGVtZW50IGNhbiBiZSBmb3VuZCBpbiB0aGUgTGl2ZUxpc3QsIG9yIC0xIGlmIGl0IGlzIG5vdCBwcmVzZW50LlxuICAgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIGxvY2F0ZS5cbiAgICogQHBhcmFtIGZyb21JbmRleCBUaGUgaW5kZXggdG8gc3RhcnQgdGhlIHNlYXJjaCBhdC5cbiAgICogQHJldHVybnMgVGhlIGZpcnN0IGluZGV4IG9mIHRoZSBlbGVtZW50IGluIHRoZSBMaXZlTGlzdDsgLTEgaWYgbm90IGZvdW5kLlxuICAgKi9cbiAgaW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuaW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsYXN0IGluZGV4IGF0IHdoaWNoIGEgZ2l2ZW4gZWxlbWVudCBjYW4gYmUgZm91bmQgaW4gdGhlIExpdmVMaXN0LCBvciAtMSBpZiBpdCBpcyBub3QgcHJlc2VudC4gVGhlIExpdmVMc2l0IGlzIHNlYXJjaGVkIGJhY2t3YXJkcywgc3RhcnRpbmcgYXQgZnJvbUluZGV4LlxuICAgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIGxvY2F0ZS5cbiAgICogQHBhcmFtIGZyb21JbmRleCBUaGUgaW5kZXggYXQgd2hpY2ggdG8gc3RhcnQgc2VhcmNoaW5nIGJhY2t3YXJkcy5cbiAgICogQHJldHVybnNcbiAgICovXG4gIGxhc3RJbmRleE9mKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCkge1xuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5sYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IHBvcHVsYXRlZCB3aXRoIHRoZSByZXN1bHRzIG9mIGNhbGxpbmcgYSBwcm92aWRlZCBmdW5jdGlvbiBvbiBldmVyeSBlbGVtZW50LlxuICAgKiBAcGFyYW0gY2FsbGJhY2sgRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZm9yIGV2ZXJ5IGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIEFuIGFycmF5IHdpdGggZWFjaCBlbGVtZW50IGJlaW5nIHRoZSByZXN1bHQgb2YgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKi9cbiAgbWFwKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zLm1hcChcbiAgICAgIChlbnRyeSwgaSkgPT4gY2FsbGJhY2soXG4gICAgICAgIGxpdmVOb2RlVG9Mc29uKGVudHJ5KSxcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBGSVhNRSEgVGhpcyBpc24ndCBzYWZlLlxuICAgICAgICBpXG4gICAgICApXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogVGVzdHMgd2hldGhlciBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgTGl2ZUxpc3QgcGFzc2VzIHRoZSB0ZXN0IGltcGxlbWVudGVkIGJ5IHRoZSBwcm92aWRlZCBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHByZWRpY2F0ZSBGdW5jdGlvbiB0byB0ZXN0IGZvciBlYWNoIGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHJldHVybnMgYSB0cnV0aHkgdmFsdWUgZm9yIGF0IGxlYXN0IG9uZSBlbGVtZW50LiBPdGhlcndpc2UsIGZhbHNlLlxuICAgKi9cbiAgc29tZShwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuc29tZShwcmVkaWNhdGUpO1xuICB9XG4gIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgIHJldHVybiBuZXcgTGl2ZUxpc3RJdGVyYXRvcih0aGlzLl9pdGVtcyk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfY3JlYXRlQXR0YWNoSXRlbUFuZFNvcnQob3AsIGtleSkge1xuICAgIGNvbnN0IG5ld0l0ZW0gPSBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCk7XG4gICAgbmV3SXRlbS5fYXR0YWNoKG9wLmlkLCBubih0aGlzLl9wb29sKSk7XG4gICAgbmV3SXRlbS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgIHRoaXMuX2luc2VydEFuZFNvcnQobmV3SXRlbSk7XG4gICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLl9pbmRleE9mUG9zaXRpb24oa2V5KTtcbiAgICByZXR1cm4geyBuZXdJdGVtLCBuZXdJbmRleCB9O1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3NoaWZ0SXRlbVBvc2l0aW9uKGluZGV4LCBrZXkpIHtcbiAgICBjb25zdCBzaGlmdGVkUG9zaXRpb24gPSBtYWtlUG9zaXRpb24oXG4gICAgICBrZXksXG4gICAgICB0aGlzLl9pdGVtcy5sZW5ndGggPiBpbmRleCArIDEgPyB0aGlzLl9pdGVtc1tpbmRleCArIDFdPy5fcGFyZW50UG9zIDogdm9pZCAwXG4gICAgKTtcbiAgICB0aGlzLl9pdGVtc1tpbmRleF0uX3NldFBhcmVudExpbmsodGhpcywgc2hpZnRlZFBvc2l0aW9uKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b1RyZWVOb2RlKGtleSkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkxpdmVMaXN0XCIsXG4gICAgICBpZDogdGhpcy5faWQgPz8gbmFub2lkKCksXG4gICAgICBrZXksXG4gICAgICBwYXlsb2FkOiB0aGlzLl9pdGVtcy5tYXAoXG4gICAgICAgIChpdGVtLCBpbmRleCkgPT4gaXRlbS50b1RyZWVOb2RlKGluZGV4LnRvU3RyaW5nKCkpXG4gICAgICApXG4gICAgfTtcbiAgfVxuICB0b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gc3VwZXIudG9JbW11dGFibGUoKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9pdGVtcy5tYXAoKG5vZGUpID0+IG5vZGUudG9JbW11dGFibGUoKSk7XG4gICAgcmV0dXJuIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIiA/IHJlc3VsdCA6IE9iamVjdC5mcmVlemUocmVzdWx0KTtcbiAgfVxuICBjbG9uZSgpIHtcbiAgICByZXR1cm4gbmV3IF9MaXZlTGlzdCh0aGlzLl9pdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uY2xvbmUoKSkpO1xuICB9XG59O1xudmFyIExpdmVMaXN0SXRlcmF0b3IgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGl0ZW1zKSB7XG4gICAgdGhpcy5faW5uZXJJdGVyYXRvciA9IGl0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgfVxuICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBuZXh0KCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2lubmVySXRlcmF0b3IubmV4dCgpO1xuICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBsaXZlTm9kZVRvTHNvbihyZXN1bHQudmFsdWUpO1xuICAgIHJldHVybiB7IHZhbHVlIH07XG4gIH1cbn07XG5mdW5jdGlvbiBtYWtlVXBkYXRlKGxpdmVMaXN0LCBkZWx0YVVwZGF0ZXMpIHtcbiAgcmV0dXJuIHtcbiAgICBub2RlOiBsaXZlTGlzdCxcbiAgICB0eXBlOiBcIkxpdmVMaXN0XCIsXG4gICAgdXBkYXRlczogZGVsdGFVcGRhdGVzXG4gIH07XG59XG5mdW5jdGlvbiBzZXREZWx0YShpbmRleCwgaXRlbSkge1xuICByZXR1cm4ge1xuICAgIGluZGV4LFxuICAgIHR5cGU6IFwic2V0XCIsXG4gICAgaXRlbTogaXRlbSBpbnN0YW5jZW9mIExpdmVSZWdpc3RlciA/IGl0ZW0uZGF0YSA6IGl0ZW1cbiAgfTtcbn1cbmZ1bmN0aW9uIGRlbGV0ZURlbHRhKGluZGV4KSB7XG4gIHJldHVybiB7XG4gICAgaW5kZXgsXG4gICAgdHlwZTogXCJkZWxldGVcIlxuICB9O1xufVxuZnVuY3Rpb24gaW5zZXJ0RGVsdGEoaW5kZXgsIGl0ZW0pIHtcbiAgcmV0dXJuIHtcbiAgICBpbmRleCxcbiAgICB0eXBlOiBcImluc2VydFwiLFxuICAgIGl0ZW06IGl0ZW0gaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIgPyBpdGVtLmRhdGEgOiBpdGVtXG4gIH07XG59XG5mdW5jdGlvbiBtb3ZlRGVsdGEocHJldmlvdXNJbmRleCwgaW5kZXgsIGl0ZW0pIHtcbiAgcmV0dXJuIHtcbiAgICBpbmRleCxcbiAgICB0eXBlOiBcIm1vdmVcIixcbiAgICBwcmV2aW91c0luZGV4LFxuICAgIGl0ZW06IGl0ZW0gaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIgPyBpdGVtLmRhdGEgOiBpdGVtXG4gIH07XG59XG5mdW5jdGlvbiBIQUNLX2FkZEludGVudEFuZERlbGV0ZWRJZFRvT3BlcmF0aW9uKG9wcywgZGVsZXRlZElkKSB7XG4gIHJldHVybiBvcHMubWFwKChvcCwgaW5kZXgpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgIGNvbnN0IGZpcnN0T3AgPSBvcDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmZpcnN0T3AsXG4gICAgICAgIGludGVudDogXCJzZXRcIixcbiAgICAgICAgZGVsZXRlZElkXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gb3A7XG4gICAgfVxuICB9KTtcbn1cblxuLy8gc3JjL2xpYi9mcmVlemUudHNcbnZhciBmcmVlemUgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIgPyAoXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICh4KSA9PiB4XG4pIDogT2JqZWN0LmZyZWV6ZTtcblxuLy8gc3JjL2NyZHRzL0xpdmVNYXAudHNcbnZhciBMaXZlTWFwID0gY2xhc3MgX0xpdmVNYXAgZXh0ZW5kcyBBYnN0cmFjdENyZHQge1xuICBjb25zdHJ1Y3RvcihlbnRyaWVzMikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy51bmFja25vd2xlZGdlZFNldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgaWYgKGVudHJpZXMyKSB7XG4gICAgICBjb25zdCBtYXBwZWRFbnRyaWVzID0gW107XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzMikge1xuICAgICAgICBjb25zdCBub2RlID0gbHNvblRvTGl2ZU5vZGUodmFsdWUpO1xuICAgICAgICBub2RlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICAgIG1hcHBlZEVudHJpZXMucHVzaChba2V5LCBub2RlXSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9tYXAgPSBuZXcgTWFwKG1hcHBlZEVudHJpZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9tYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfdG9PcHMocGFyZW50SWQsIHBhcmVudEtleSwgcG9vbCkge1xuICAgIGlmICh0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VyaWFsaXplIGl0ZW0gaXMgbm90IGF0dGFjaGVkXCIpO1xuICAgIH1cbiAgICBjb25zdCBvcHMgPSBbXTtcbiAgICBjb25zdCBvcCA9IHtcbiAgICAgIGlkOiB0aGlzLl9pZCxcbiAgICAgIG9wSWQ6IHBvb2w/LmdlbmVyYXRlT3BJZCgpLFxuICAgICAgdHlwZTogNyAvKiBDUkVBVEVfTUFQICovLFxuICAgICAgcGFyZW50SWQsXG4gICAgICBwYXJlbnRLZXlcbiAgICB9O1xuICAgIG9wcy5wdXNoKG9wKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIG9wcy5wdXNoKC4uLnZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5LCBwb29sKSk7XG4gICAgfVxuICAgIHJldHVybiBvcHM7XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIF9kZXNlcmlhbGl6ZShbaWQsIF9pdGVtXSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCkge1xuICAgIGNvbnN0IG1hcCA9IG5ldyBfTGl2ZU1hcCgpO1xuICAgIG1hcC5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICBjb25zdCBjaGlsZHJlbiA9IHBhcmVudFRvQ2hpbGRyZW4uZ2V0KGlkKTtcbiAgICBpZiAoY2hpbGRyZW4gPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG1hcDtcbiAgICB9XG4gICAgZm9yIChjb25zdCBbaWQyLCBjcmR0XSBvZiBjaGlsZHJlbikge1xuICAgICAgY29uc3QgY2hpbGQgPSBkZXNlcmlhbGl6ZShbaWQyLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgICBjaGlsZC5fc2V0UGFyZW50TGluayhtYXAsIGNyZHQucGFyZW50S2V5KTtcbiAgICAgIG1hcC5fbWFwLnNldChjcmR0LnBhcmVudEtleSwgY2hpbGQpO1xuICAgICAgbWFwLmludmFsaWRhdGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIG1hcDtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfYXR0YWNoKGlkLCBwb29sKSB7XG4gICAgc3VwZXIuX2F0dGFjaChpZCwgcG9vbCk7XG4gICAgZm9yIChjb25zdCBbX2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9hdHRhY2gocG9vbC5nZW5lcmF0ZUlkKCksIHBvb2wpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfYXR0YWNoQ2hpbGQob3AsIHNvdXJjZSkge1xuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGF0dGFjaCBjaGlsZCBpZiBtYW5hZ2VkIHBvb2wgaXMgbm90IHByZXNlbnRcIik7XG4gICAgfVxuICAgIGNvbnN0IHsgaWQsIHBhcmVudEtleSwgb3BJZCB9ID0gb3A7XG4gICAgY29uc3Qga2V5ID0gcGFyZW50S2V5O1xuICAgIGNvbnN0IGNoaWxkID0gY3JlYXRpb25PcFRvTGl2ZU5vZGUob3ApO1xuICAgIGlmICh0aGlzLl9wb29sLmdldE5vZGUoaWQpICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBpZiAoc291cmNlID09PSAyIC8qIEFDSyAqLykge1xuICAgICAgY29uc3QgbGFzdFVwZGF0ZU9wSWQgPSB0aGlzLnVuYWNrbm93bGVkZ2VkU2V0LmdldChrZXkpO1xuICAgICAgaWYgKGxhc3RVcGRhdGVPcElkID09PSBvcElkKSB7XG4gICAgICAgIHRoaXMudW5hY2tub3dsZWRnZWRTZXQuZGVsZXRlKGtleSk7XG4gICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgfSBlbHNlIGlmIChsYXN0VXBkYXRlT3BJZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAxIC8qIFJFTU9URSAqLykge1xuICAgICAgdGhpcy51bmFja25vd2xlZGdlZFNldC5kZWxldGUoa2V5KTtcbiAgICB9XG4gICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBsZXQgcmV2ZXJzZTtcbiAgICBpZiAocHJldmlvdXNWYWx1ZSkge1xuICAgICAgY29uc3QgdGhpc0lkID0gbm4odGhpcy5faWQpO1xuICAgICAgcmV2ZXJzZSA9IHByZXZpb3VzVmFsdWUuX3RvT3BzKHRoaXNJZCwga2V5KTtcbiAgICAgIHByZXZpb3VzVmFsdWUuX2RldGFjaCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZlcnNlID0gW3sgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLywgaWQgfV07XG4gICAgfVxuICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgY2hpbGQuX2F0dGFjaChpZCwgdGhpcy5fcG9vbCk7XG4gICAgdGhpcy5fbWFwLnNldChrZXksIGNoaWxkKTtcbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kaWZpZWQ6IHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICAgIHVwZGF0ZXM6IHsgW2tleV06IHsgdHlwZTogXCJ1cGRhdGVcIiB9IH1cbiAgICAgIH0sXG4gICAgICByZXZlcnNlXG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfZGV0YWNoKCkge1xuICAgIHN1cGVyLl9kZXRhY2goKTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5fbWFwLnZhbHVlcygpKSB7XG4gICAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgX2RldGFjaENoaWxkKGNoaWxkKSB7XG4gICAgY29uc3QgaWQgPSBubih0aGlzLl9pZCk7XG4gICAgY29uc3QgcGFyZW50S2V5ID0gbm4oY2hpbGQuX3BhcmVudEtleSk7XG4gICAgY29uc3QgcmV2ZXJzZSA9IGNoaWxkLl90b09wcyhpZCwgcGFyZW50S2V5LCB0aGlzLl9wb29sKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmICh2YWx1ZSA9PT0gY2hpbGQpIHtcbiAgICAgICAgdGhpcy5fbWFwLmRlbGV0ZShrZXkpO1xuICAgICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2hpbGQuX2RldGFjaCgpO1xuICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGUgPSB7XG4gICAgICBub2RlOiB0aGlzLFxuICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICB1cGRhdGVzOiB7IFtwYXJlbnRLZXldOiB7IHR5cGU6IFwiZGVsZXRlXCIgfSB9XG4gICAgfTtcbiAgICByZXR1cm4geyBtb2RpZmllZDogc3RvcmFnZVVwZGF0ZSwgcmV2ZXJzZSB9O1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIF9zZXJpYWxpemUoKSB7XG4gICAgaWYgKHRoaXMucGFyZW50LnR5cGUgIT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXJpYWxpemUgTGl2ZU1hcCBpZiBwYXJlbnQgaXMgbWlzc2luZ1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IDIgLyogTUFQICovLFxuICAgICAgcGFyZW50SWQ6IG5uKHRoaXMucGFyZW50Lm5vZGUuX2lkLCBcIlBhcmVudCBub2RlIGV4cGVjdGVkIHRvIGhhdmUgSURcIiksXG4gICAgICBwYXJlbnRLZXk6IHRoaXMucGFyZW50LmtleVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzcGVjaWZpZWQgZWxlbWVudCBmcm9tIHRoZSBMaXZlTWFwLlxuICAgKiBAcGFyYW0ga2V5IFRoZSBrZXkgb2YgdGhlIGVsZW1lbnQgdG8gcmV0dXJuLlxuICAgKiBAcmV0dXJucyBUaGUgZWxlbWVudCBhc3NvY2lhdGVkIHdpdGggdGhlIHNwZWNpZmllZCBrZXksIG9yIHVuZGVmaW5lZCBpZiB0aGUga2V5IGNhbid0IGJlIGZvdW5kIGluIHRoZSBMaXZlTWFwLlxuICAgKi9cbiAgZ2V0KGtleSkge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgICByZXR1cm4gbGl2ZU5vZGVUb0xzb24odmFsdWUpO1xuICB9XG4gIC8qKlxuICAgKiBBZGRzIG9yIHVwZGF0ZXMgYW4gZWxlbWVudCB3aXRoIGEgc3BlY2lmaWVkIGtleSBhbmQgYSB2YWx1ZS5cbiAgICogQHBhcmFtIGtleSBUaGUga2V5IG9mIHRoZSBlbGVtZW50IHRvIGFkZC4gU2hvdWxkIGJlIGEgc3RyaW5nLlxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBlbGVtZW50IHRvIGFkZC4gU2hvdWxkIGJlIHNlcmlhbGl6YWJsZSB0byBKU09OLlxuICAgKi9cbiAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGlmIChvbGRWYWx1ZSkge1xuICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgIH1cbiAgICBjb25zdCBpdGVtID0gbHNvblRvTGl2ZU5vZGUodmFsdWUpO1xuICAgIGl0ZW0uX3NldFBhcmVudExpbmsodGhpcywga2V5KTtcbiAgICB0aGlzLl9tYXAuc2V0KGtleSwgaXRlbSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgJiYgdGhpcy5faWQpIHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5fcG9vbC5nZW5lcmF0ZUlkKCk7XG4gICAgICBpdGVtLl9hdHRhY2goaWQsIHRoaXMuX3Bvb2wpO1xuICAgICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgc3RvcmFnZVVwZGF0ZXMuc2V0KHRoaXMuX2lkLCB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU1hcFwiLFxuICAgICAgICB1cGRhdGVzOiB7IFtrZXldOiB7IHR5cGU6IFwidXBkYXRlXCIgfSB9XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG9wcyA9IGl0ZW0uX3RvT3BzKHRoaXMuX2lkLCBrZXksIHRoaXMuX3Bvb2wpO1xuICAgICAgdGhpcy51bmFja25vd2xlZGdlZFNldC5zZXQoa2V5LCBubihvcHNbMF0ub3BJZCkpO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgaXRlbS5fdG9PcHModGhpcy5faWQsIGtleSwgdGhpcy5fcG9vbCksXG4gICAgICAgIG9sZFZhbHVlID8gb2xkVmFsdWUuX3RvT3BzKHRoaXMuX2lkLCBrZXkpIDogW3sgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLywgaWQgfV0sXG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzXG4gICAgICApO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBMaXZlTWFwLlxuICAgKi9cbiAgZ2V0IHNpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcC5zaXplO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgYW4gZWxlbWVudCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IGV4aXN0cyBvciBub3QuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgZWxlbWVudCB0byB0ZXN0IGZvciBwcmVzZW5jZS5cbiAgICovXG4gIGhhcyhrZXkpIHtcbiAgICByZXR1cm4gdGhpcy5fbWFwLmhhcyhrZXkpO1xuICB9XG4gIC8qKlxuICAgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBieSBrZXkuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgZWxlbWVudCB0byByZW1vdmUuXG4gICAqIEByZXR1cm5zIHRydWUgaWYgYW4gZWxlbWVudCBleGlzdGVkIGFuZCBoYXMgYmVlbiByZW1vdmVkLCBvciBmYWxzZSBpZiB0aGUgZWxlbWVudCBkb2VzIG5vdCBleGlzdC5cbiAgICovXG4gIGRlbGV0ZShrZXkpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgaWYgKGl0ZW0gPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpdGVtLl9kZXRhY2goKTtcbiAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgJiYgaXRlbS5faWQpIHtcbiAgICAgIGNvbnN0IHRoaXNJZCA9IG5uKHRoaXMuX2lkKTtcbiAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgIHN0b3JhZ2VVcGRhdGVzLnNldCh0aGlzSWQsIHtcbiAgICAgICAgbm9kZTogdGhpcyxcbiAgICAgICAgdHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICAgIHVwZGF0ZXM6IHsgW2tleV06IHsgdHlwZTogXCJkZWxldGVcIiB9IH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5fcG9vbC5kaXNwYXRjaChcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IDUgLyogREVMRVRFX0NSRFQgKi8sXG4gICAgICAgICAgICBpZDogaXRlbS5faWQsXG4gICAgICAgICAgICBvcElkOiB0aGlzLl9wb29sLmdlbmVyYXRlT3BJZCgpXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBpdGVtLl90b09wcyh0aGlzSWQsIGtleSksXG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBJdGVyYXRvciBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgW2tleSwgdmFsdWVdIHBhaXJzIGZvciBlYWNoIGVsZW1lbnQuXG4gICAqL1xuICBlbnRyaWVzKCkge1xuICAgIGNvbnN0IGlubmVySXRlcmF0b3IgPSB0aGlzLl9tYXAuZW50cmllcygpO1xuICAgIHJldHVybiB7XG4gICAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgICAgbmV4dCgpIHtcbiAgICAgICAgY29uc3QgaXRlcmF0b3JWYWx1ZSA9IGlubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICBpZiAoaXRlcmF0b3JWYWx1ZS5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlbnRyeSA9IGl0ZXJhdG9yVmFsdWUudmFsdWU7XG4gICAgICAgIGNvbnN0IGtleSA9IGVudHJ5WzBdO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGxpdmVOb2RlVG9Mc29uKGl0ZXJhdG9yVmFsdWUudmFsdWVbMV0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBba2V5LCB2YWx1ZV1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBTYW1lIGZ1bmN0aW9uIG9iamVjdCBhcyB0aGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgZW50cmllcyBtZXRob2QuXG4gICAqL1xuICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICByZXR1cm4gdGhpcy5lbnRyaWVzKCk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBuZXcgSXRlcmF0b3Igb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIGtleXMgZm9yIGVhY2ggZWxlbWVudC5cbiAgICovXG4gIGtleXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcC5rZXlzKCk7XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBuZXcgSXRlcmF0b3Igb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIHZhbHVlcyBmb3IgZWFjaCBlbGVtZW50LlxuICAgKi9cbiAgdmFsdWVzKCkge1xuICAgIGNvbnN0IGlubmVySXRlcmF0b3IgPSB0aGlzLl9tYXAudmFsdWVzKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBuZXh0KCkge1xuICAgICAgICBjb25zdCBpdGVyYXRvclZhbHVlID0gaW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIGlmIChpdGVyYXRvclZhbHVlLmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbHVlID0gbGl2ZU5vZGVUb0xzb24oaXRlcmF0b3JWYWx1ZS52YWx1ZSk7XG4gICAgICAgIHJldHVybiB7IHZhbHVlIH07XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogRXhlY3V0ZXMgYSBwcm92aWRlZCBmdW5jdGlvbiBvbmNlIHBlciBlYWNoIGtleS92YWx1ZSBwYWlyIGluIHRoZSBNYXAgb2JqZWN0LCBpbiBpbnNlcnRpb24gb3JkZXIuXG4gICAqIEBwYXJhbSBjYWxsYmFjayBGdW5jdGlvbiB0byBleGVjdXRlIGZvciBlYWNoIGVudHJ5IGluIHRoZSBtYXAuXG4gICAqL1xuICBmb3JFYWNoKGNhbGxiYWNrKSB7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzKSB7XG4gICAgICBjYWxsYmFjayhlbnRyeVsxXSwgZW50cnlbMF0sIHRoaXMpO1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b1RyZWVOb2RlKGtleSkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkxpdmVNYXBcIixcbiAgICAgIGlkOiB0aGlzLl9pZCA/PyBuYW5vaWQoKSxcbiAgICAgIGtleSxcbiAgICAgIHBheWxvYWQ6IEFycmF5LmZyb20odGhpcy5fbWFwLmVudHJpZXMoKSkubWFwKFxuICAgICAgICAoW2tleTIsIHZhbF0pID0+IHZhbC50b1RyZWVOb2RlKGtleTIpXG4gICAgICApXG4gICAgfTtcbiAgfVxuICB0b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gc3VwZXIudG9JbW11dGFibGUoKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkge1xuICAgICAgcmVzdWx0LnNldChrZXksIHZhbHVlLnRvSW1tdXRhYmxlKCkpO1xuICAgIH1cbiAgICByZXR1cm4gZnJlZXplKHJlc3VsdCk7XG4gIH1cbiAgY2xvbmUoKSB7XG4gICAgcmV0dXJuIG5ldyBfTGl2ZU1hcChcbiAgICAgIEFycmF5LmZyb20odGhpcy5fbWFwKS5tYXAoKFtrZXksIG5vZGVdKSA9PiBba2V5LCBub2RlLmNsb25lKCldKVxuICAgICk7XG4gIH1cbn07XG5cbi8vIHNyYy9jcmR0cy9MaXZlT2JqZWN0LnRzXG52YXIgTGl2ZU9iamVjdCA9IGNsYXNzIF9MaXZlT2JqZWN0IGV4dGVuZHMgQWJzdHJhY3RDcmR0IHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2J1aWxkUm9vdEFuZFBhcmVudFRvQ2hpbGRyZW4oaXRlbXMpIHtcbiAgICBjb25zdCBwYXJlbnRUb0NoaWxkcmVuID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICBsZXQgcm9vdCA9IG51bGw7XG4gICAgZm9yIChjb25zdCBbaWQsIGNyZHRdIG9mIGl0ZW1zKSB7XG4gICAgICBpZiAoaXNSb290Q3JkdChjcmR0KSkge1xuICAgICAgICByb290ID0gW2lkLCBjcmR0XTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHR1cGxlID0gW2lkLCBjcmR0XTtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnRUb0NoaWxkcmVuLmdldChjcmR0LnBhcmVudElkKTtcbiAgICAgICAgaWYgKGNoaWxkcmVuICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBjaGlsZHJlbi5wdXNoKHR1cGxlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwYXJlbnRUb0NoaWxkcmVuLnNldChjcmR0LnBhcmVudElkLCBbdHVwbGVdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAocm9vdCA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUm9vdCBjYW4ndCBiZSBudWxsXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3Jvb3QsIHBhcmVudFRvQ2hpbGRyZW5dO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIF9mcm9tSXRlbXMoaXRlbXMsIHBvb2wpIHtcbiAgICBjb25zdCBbcm9vdCwgcGFyZW50VG9DaGlsZHJlbl0gPSBfTGl2ZU9iamVjdC5fYnVpbGRSb290QW5kUGFyZW50VG9DaGlsZHJlbihpdGVtcyk7XG4gICAgcmV0dXJuIF9MaXZlT2JqZWN0Ll9kZXNlcmlhbGl6ZShcbiAgICAgIHJvb3QsXG4gICAgICBwYXJlbnRUb0NoaWxkcmVuLFxuICAgICAgcG9vbFxuICAgICk7XG4gIH1cbiAgY29uc3RydWN0b3Iob2JqID0ge30pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IG8gPSBjb21wYWN0T2JqZWN0KG9iaik7XG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMobykpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gb1trZXldO1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX21hcCA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMobykpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvT3BzKHBhcmVudElkLCBwYXJlbnRLZXksIHBvb2wpIHtcbiAgICBpZiAodGhpcy5faWQgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNlcmlhbGl6ZSBpdGVtIGlzIG5vdCBhdHRhY2hlZFwiKTtcbiAgICB9XG4gICAgY29uc3Qgb3BJZCA9IHBvb2w/LmdlbmVyYXRlT3BJZCgpO1xuICAgIGNvbnN0IG9wcyA9IFtdO1xuICAgIGNvbnN0IG9wID0ge1xuICAgICAgdHlwZTogNCAvKiBDUkVBVEVfT0JKRUNUICovLFxuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgb3BJZCxcbiAgICAgIHBhcmVudElkLFxuICAgICAgcGFyZW50S2V5LFxuICAgICAgZGF0YToge31cbiAgICB9O1xuICAgIG9wcy5wdXNoKG9wKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmIChpc0xpdmVOb2RlKHZhbHVlKSkge1xuICAgICAgICBvcHMucHVzaCguLi52YWx1ZS5fdG9PcHModGhpcy5faWQsIGtleSwgcG9vbCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3AuZGF0YVtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvcHM7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgX2Rlc2VyaWFsaXplKFtpZCwgaXRlbV0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpIHtcbiAgICBjb25zdCBsaXZlT2JqID0gbmV3IF9MaXZlT2JqZWN0KGl0ZW0uZGF0YSk7XG4gICAgbGl2ZU9iai5fYXR0YWNoKGlkLCBwb29sKTtcbiAgICByZXR1cm4gdGhpcy5fZGVzZXJpYWxpemVDaGlsZHJlbihsaXZlT2JqLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBfZGVzZXJpYWxpemVDaGlsZHJlbihsaXZlT2JqLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnRUb0NoaWxkcmVuLmdldChubihsaXZlT2JqLl9pZCkpO1xuICAgIGlmIChjaGlsZHJlbiA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gbGl2ZU9iajtcbiAgICB9XG4gICAgZm9yIChjb25zdCBbaWQsIGNyZHRdIG9mIGNoaWxkcmVuKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGRlc2VyaWFsaXplVG9Mc29uKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgICAgaWYgKGlzTGl2ZVN0cnVjdHVyZShjaGlsZCkpIHtcbiAgICAgICAgY2hpbGQuX3NldFBhcmVudExpbmsobGl2ZU9iaiwgY3JkdC5wYXJlbnRLZXkpO1xuICAgICAgfVxuICAgICAgbGl2ZU9iai5fbWFwLnNldChjcmR0LnBhcmVudEtleSwgY2hpbGQpO1xuICAgICAgbGl2ZU9iai5pbnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHJldHVybiBsaXZlT2JqO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2F0dGFjaChpZCwgcG9vbCkge1xuICAgIHN1cGVyLl9hdHRhY2goaWQsIHBvb2wpO1xuICAgIGZvciAoY29uc3QgW19rZXksIHZhbHVlXSBvZiB0aGlzLl9tYXApIHtcbiAgICAgIGlmIChpc0xpdmVOb2RlKHZhbHVlKSkge1xuICAgICAgICB2YWx1ZS5fYXR0YWNoKHBvb2wuZ2VuZXJhdGVJZCgpLCBwb29sKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXR0YWNoQ2hpbGQob3AsIHNvdXJjZSkge1xuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGF0dGFjaCBjaGlsZCBpZiBtYW5hZ2VkIHBvb2wgaXMgbm90IHByZXNlbnRcIik7XG4gICAgfVxuICAgIGNvbnN0IHsgaWQsIG9wSWQsIHBhcmVudEtleToga2V5IH0gPSBvcDtcbiAgICBjb25zdCBjaGlsZCA9IGNyZWF0aW9uT3BUb0xzb24ob3ApO1xuICAgIGlmICh0aGlzLl9wb29sLmdldE5vZGUoaWQpICE9PSB2b2lkIDApIHtcbiAgICAgIGlmICh0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpID09PSBvcElkKSB7XG4gICAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZSA9PT0gMCAvKiBVTkRPUkVET19SRUNPTk5FQ1QgKi8pIHtcbiAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuc2V0KGtleSwgbm4ob3BJZCkpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5nZXQoa2V5KSA9PT0gdm9pZCAwKSB7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpID09PSBvcElkKSB7XG4gICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmRlbGV0ZShrZXkpO1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBjb25zdCB0aGlzSWQgPSBubih0aGlzLl9pZCk7XG4gICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBsZXQgcmV2ZXJzZTtcbiAgICBpZiAoaXNMaXZlTm9kZShwcmV2aW91c1ZhbHVlKSkge1xuICAgICAgcmV2ZXJzZSA9IHByZXZpb3VzVmFsdWUuX3RvT3BzKHRoaXNJZCwga2V5KTtcbiAgICAgIHByZXZpb3VzVmFsdWUuX2RldGFjaCgpO1xuICAgIH0gZWxzZSBpZiAocHJldmlvdXNWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXZlcnNlID0gW3sgdHlwZTogNiAvKiBERUxFVEVfT0JKRUNUX0tFWSAqLywgaWQ6IHRoaXNJZCwga2V5IH1dO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZlcnNlID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgICAgIGlkOiB0aGlzSWQsXG4gICAgICAgICAgZGF0YTogeyBba2V5XTogcHJldmlvdXNWYWx1ZSB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICAgIHRoaXMuX21hcC5zZXQoa2V5LCBjaGlsZCk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgaWYgKGlzTGl2ZVN0cnVjdHVyZShjaGlsZCkpIHtcbiAgICAgIGNoaWxkLl9zZXRQYXJlbnRMaW5rKHRoaXMsIGtleSk7XG4gICAgICBjaGlsZC5fYXR0YWNoKGlkLCB0aGlzLl9wb29sKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHJldmVyc2UsXG4gICAgICBtb2RpZmllZDoge1xuICAgICAgICBub2RlOiB0aGlzLFxuICAgICAgICB0eXBlOiBcIkxpdmVPYmplY3RcIixcbiAgICAgICAgdXBkYXRlczogeyBba2V5XTogeyB0eXBlOiBcInVwZGF0ZVwiIH0gfVxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfZGV0YWNoQ2hpbGQoY2hpbGQpIHtcbiAgICBpZiAoY2hpbGQpIHtcbiAgICAgIGNvbnN0IGlkID0gbm4odGhpcy5faWQpO1xuICAgICAgY29uc3QgcGFyZW50S2V5ID0gbm4oY2hpbGQuX3BhcmVudEtleSk7XG4gICAgICBjb25zdCByZXZlcnNlID0gY2hpbGQuX3RvT3BzKGlkLCBwYXJlbnRLZXksIHRoaXMuX3Bvb2wpO1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gY2hpbGQpIHtcbiAgICAgICAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNoaWxkLl9kZXRhY2goKTtcbiAgICAgIGNvbnN0IHN0b3JhZ2VVcGRhdGUgPSB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB7XG4gICAgICAgICAgW3BhcmVudEtleV06IHsgdHlwZTogXCJkZWxldGVcIiB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4geyBtb2RpZmllZDogc3RvcmFnZVVwZGF0ZSwgcmV2ZXJzZSB9O1xuICAgIH1cbiAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBfZGV0YWNoKCkge1xuICAgIHN1cGVyLl9kZXRhY2goKTtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHRoaXMuX21hcC52YWx1ZXMoKSkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLl9kZXRhY2goKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfYXBwbHkob3AsIGlzTG9jYWwpIHtcbiAgICBpZiAob3AudHlwZSA9PT0gMyAvKiBVUERBVEVfT0JKRUNUICovKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXBwbHlVcGRhdGUob3AsIGlzTG9jYWwpO1xuICAgIH0gZWxzZSBpZiAob3AudHlwZSA9PT0gNiAvKiBERUxFVEVfT0JKRUNUX0tFWSAqLykge1xuICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5RGVsZXRlT2JqZWN0S2V5KG9wLCBpc0xvY2FsKTtcbiAgICB9XG4gICAgcmV0dXJuIHN1cGVyLl9hcHBseShvcCwgaXNMb2NhbCk7XG4gIH1cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgX3NlcmlhbGl6ZSgpIHtcbiAgICBjb25zdCBkYXRhID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7XG4gICAgICBpZiAoIWlzTGl2ZU5vZGUodmFsdWUpKSB7XG4gICAgICAgIGRhdGFba2V5XSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIiAmJiB0aGlzLnBhcmVudC5ub2RlLl9pZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogMCAvKiBPQkpFQ1QgKi8sXG4gICAgICAgIHBhcmVudElkOiB0aGlzLnBhcmVudC5ub2RlLl9pZCxcbiAgICAgICAgcGFyZW50S2V5OiB0aGlzLnBhcmVudC5rZXksXG4gICAgICAgIGRhdGFcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IDAgLyogT0JKRUNUICovLFxuICAgICAgICBkYXRhXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseVVwZGF0ZShvcCwgaXNMb2NhbCkge1xuICAgIGxldCBpc01vZGlmaWVkID0gZmFsc2U7XG4gICAgY29uc3QgaWQgPSBubih0aGlzLl9pZCk7XG4gICAgY29uc3QgcmV2ZXJzZSA9IFtdO1xuICAgIGNvbnN0IHJldmVyc2VVcGRhdGUgPSB7XG4gICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICBpZCxcbiAgICAgIGRhdGE6IHt9XG4gICAgfTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvcC5kYXRhKSB7XG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgICByZXZlcnNlLnB1c2goLi4ub2xkVmFsdWUuX3RvT3BzKGlkLCBrZXkpKTtcbiAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgfSBlbHNlIGlmIChvbGRWYWx1ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldmVyc2VVcGRhdGUuZGF0YVtrZXldID0gb2xkVmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKG9sZFZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV2ZXJzZS5wdXNoKHsgdHlwZTogNiAvKiBERUxFVEVfT0JKRUNUX0tFWSAqLywgaWQsIGtleSB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgdXBkYXRlRGVsdGEgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvcC5kYXRhKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG9wLmRhdGFba2V5XTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKGlzTG9jYWwpIHtcbiAgICAgICAgdGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5zZXQoa2V5LCBubihvcC5vcElkKSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuZ2V0KGtleSkgPT09IHZvaWQgMCkge1xuICAgICAgICBpc01vZGlmaWVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fcHJvcFRvTGFzdFVwZGF0ZS5nZXQoa2V5KSA9PT0gb3Aub3BJZCkge1xuICAgICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmRlbGV0ZShrZXkpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgICBpZiAoaXNMaXZlTm9kZShvbGRWYWx1ZSkpIHtcbiAgICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgfVxuICAgICAgaXNNb2RpZmllZCA9IHRydWU7XG4gICAgICB1cGRhdGVEZWx0YVtrZXldID0geyB0eXBlOiBcInVwZGF0ZVwiIH07XG4gICAgICB0aGlzLl9tYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyhyZXZlcnNlVXBkYXRlLmRhdGEpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV2ZXJzZS51bnNoaWZ0KHJldmVyc2VVcGRhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gaXNNb2RpZmllZCA/IHtcbiAgICAgIG1vZGlmaWVkOiB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB1cGRhdGVEZWx0YVxuICAgICAgfSxcbiAgICAgIHJldmVyc2VcbiAgICB9IDogeyBtb2RpZmllZDogZmFsc2UgfTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9hcHBseURlbGV0ZU9iamVjdEtleShvcCwgaXNMb2NhbCkge1xuICAgIGNvbnN0IGtleSA9IG9wLmtleTtcbiAgICBpZiAodGhpcy5fbWFwLmhhcyhrZXkpID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIGlmICghaXNMb2NhbCAmJiB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLmdldChrZXkpICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgIH1cbiAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBjb25zdCBpZCA9IG5uKHRoaXMuX2lkKTtcbiAgICBsZXQgcmV2ZXJzZSA9IFtdO1xuICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgcmV2ZXJzZSA9IG9sZFZhbHVlLl90b09wcyhpZCwgb3Aua2V5KTtcbiAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICB9IGVsc2UgaWYgKG9sZFZhbHVlICE9PSB2b2lkIDApIHtcbiAgICAgIHJldmVyc2UgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAzIC8qIFVQREFURV9PQkpFQ1QgKi8sXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgZGF0YTogeyBba2V5XTogb2xkVmFsdWUgfVxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgICB0aGlzLl9tYXAuZGVsZXRlKGtleSk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1vZGlmaWVkOiB7XG4gICAgICAgIG5vZGU6IHRoaXMsXG4gICAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgICB1cGRhdGVzOiB7IFtvcC5rZXldOiB7IHR5cGU6IFwiZGVsZXRlXCIgfSB9XG4gICAgICB9LFxuICAgICAgcmV2ZXJzZVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFRyYW5zZm9ybSB0aGUgTGl2ZU9iamVjdCBpbnRvIGEgamF2YXNjcmlwdCBvYmplY3RcbiAgICovXG4gIHRvT2JqZWN0KCkge1xuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModGhpcy5fbWFwKTtcbiAgfVxuICAvKipcbiAgICogQWRkcyBvciB1cGRhdGVzIGEgcHJvcGVydHkgd2l0aCBhIHNwZWNpZmllZCBrZXkgYW5kIGEgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gYWRkXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIHByb3BlcnR5IHRvIGFkZFxuICAgKi9cbiAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICB0aGlzLl9wb29sPy5hc3NlcnRTdG9yYWdlSXNXcml0YWJsZSgpO1xuICAgIHRoaXMudXBkYXRlKHsgW2tleV06IHZhbHVlIH0pO1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgc3BlY2lmaWVkIHByb3BlcnR5IGZyb20gdGhlIExpdmVPYmplY3QuXG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0XG4gICAqL1xuICBnZXQoa2V5KSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhIGtleSBmcm9tIHRoZSBMaXZlT2JqZWN0XG4gICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZGVsZXRlXG4gICAqL1xuICBkZWxldGUoa2V5KSB7XG4gICAgdGhpcy5fcG9vbD8uYXNzZXJ0U3RvcmFnZUlzV3JpdGFibGUoKTtcbiAgICBjb25zdCBrZXlBc1N0cmluZyA9IGtleTtcbiAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5QXNTdHJpbmcpO1xuICAgIGlmIChvbGRWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLl9wb29sID09PSB2b2lkIDAgfHwgdGhpcy5faWQgPT09IHZvaWQgMCkge1xuICAgICAgaWYgKGlzTGl2ZU5vZGUob2xkVmFsdWUpKSB7XG4gICAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX21hcC5kZWxldGUoa2V5QXNTdHJpbmcpO1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCByZXZlcnNlO1xuICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgb2xkVmFsdWUuX2RldGFjaCgpO1xuICAgICAgcmV2ZXJzZSA9IG9sZFZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5QXNTdHJpbmcpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZlcnNlID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgICAgIGRhdGE6IHsgW2tleUFzU3RyaW5nXTogb2xkVmFsdWUgfSxcbiAgICAgICAgICBpZDogdGhpcy5faWRcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gICAgdGhpcy5fbWFwLmRlbGV0ZShrZXlBc1N0cmluZyk7XG4gICAgdGhpcy5pbnZhbGlkYXRlKCk7XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHN0b3JhZ2VVcGRhdGVzLnNldCh0aGlzLl9pZCwge1xuICAgICAgbm9kZTogdGhpcyxcbiAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgdXBkYXRlczogeyBba2V5XTogeyB0eXBlOiBcImRlbGV0ZVwiIH0gfVxuICAgIH0pO1xuICAgIHRoaXMuX3Bvb2wuZGlzcGF0Y2goXG4gICAgICBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovLFxuICAgICAgICAgIGtleToga2V5QXNTdHJpbmcsXG4gICAgICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgICAgIG9wSWQ6IHRoaXMuX3Bvb2wuZ2VuZXJhdGVPcElkKClcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIHJldmVyc2UsXG4gICAgICBzdG9yYWdlVXBkYXRlc1xuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZHMgb3IgdXBkYXRlcyBtdWx0aXBsZSBwcm9wZXJ0aWVzIGF0IG9uY2Ugd2l0aCBhbiBvYmplY3QuXG4gICAqIEBwYXJhbSBwYXRjaCBUaGUgb2JqZWN0IHVzZWQgdG8gb3ZlcnJpZGVzIHByb3BlcnRpZXNcbiAgICovXG4gIHVwZGF0ZShwYXRjaCkge1xuICAgIHRoaXMuX3Bvb2w/LmFzc2VydFN0b3JhZ2VJc1dyaXRhYmxlKCk7XG4gICAgaWYgKHRoaXMuX3Bvb2wgPT09IHZvaWQgMCB8fCB0aGlzLl9pZCA9PT0gdm9pZCAwKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRjaCkge1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhdGNoW2tleV07XG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgICAgIGlmIChpc0xpdmVOb2RlKG9sZFZhbHVlKSkge1xuICAgICAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNMaXZlTm9kZShuZXdWYWx1ZSkpIHtcbiAgICAgICAgICBuZXdWYWx1ZS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21hcC5zZXQoa2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBvcHMgPSBbXTtcbiAgICBjb25zdCByZXZlcnNlT3BzID0gW107XG4gICAgY29uc3Qgb3BJZCA9IHRoaXMuX3Bvb2wuZ2VuZXJhdGVPcElkKCk7XG4gICAgY29uc3QgdXBkYXRlZFByb3BzID0ge307XG4gICAgY29uc3QgcmV2ZXJzZVVwZGF0ZU9wID0ge1xuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgdHlwZTogMyAvKiBVUERBVEVfT0JKRUNUICovLFxuICAgICAgZGF0YToge31cbiAgICB9O1xuICAgIGNvbnN0IHVwZGF0ZURlbHRhID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gcGF0Y2gpIHtcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGF0Y2hba2V5XTtcbiAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgICBpZiAoaXNMaXZlTm9kZShvbGRWYWx1ZSkpIHtcbiAgICAgICAgcmV2ZXJzZU9wcy5wdXNoKC4uLm9sZFZhbHVlLl90b09wcyh0aGlzLl9pZCwga2V5KSk7XG4gICAgICAgIG9sZFZhbHVlLl9kZXRhY2goKTtcbiAgICAgIH0gZWxzZSBpZiAob2xkVmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgICByZXZlcnNlT3BzLnB1c2goeyB0eXBlOiA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovLCBpZDogdGhpcy5faWQsIGtleSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldmVyc2VVcGRhdGVPcC5kYXRhW2tleV0gPSBvbGRWYWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0xpdmVOb2RlKG5ld1ZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZS5fc2V0UGFyZW50TGluayh0aGlzLCBrZXkpO1xuICAgICAgICBuZXdWYWx1ZS5fYXR0YWNoKHRoaXMuX3Bvb2wuZ2VuZXJhdGVJZCgpLCB0aGlzLl9wb29sKTtcbiAgICAgICAgY29uc3QgbmV3QXR0YWNoQ2hpbGRPcHMgPSBuZXdWYWx1ZS5fdG9PcHModGhpcy5faWQsIGtleSwgdGhpcy5fcG9vbCk7XG4gICAgICAgIGNvbnN0IGNyZWF0ZUNyZHRPcCA9IG5ld0F0dGFjaENoaWxkT3BzLmZpbmQoXG4gICAgICAgICAgKG9wKSA9PiBvcC5wYXJlbnRJZCA9PT0gdGhpcy5faWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNyZWF0ZUNyZHRPcCkge1xuICAgICAgICAgIHRoaXMuX3Byb3BUb0xhc3RVcGRhdGUuc2V0KGtleSwgbm4oY3JlYXRlQ3JkdE9wLm9wSWQpKTtcbiAgICAgICAgfVxuICAgICAgICBvcHMucHVzaCguLi5uZXdBdHRhY2hDaGlsZE9wcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1cGRhdGVkUHJvcHNba2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgICB0aGlzLl9wcm9wVG9MYXN0VXBkYXRlLnNldChrZXksIG9wSWQpO1xuICAgICAgfVxuICAgICAgdGhpcy5fbWFwLnNldChrZXksIG5ld1ZhbHVlKTtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICAgICAgdXBkYXRlRGVsdGFba2V5XSA9IHsgdHlwZTogXCJ1cGRhdGVcIiB9O1xuICAgIH1cbiAgICBpZiAoT2JqZWN0LmtleXMocmV2ZXJzZVVwZGF0ZU9wLmRhdGEpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV2ZXJzZU9wcy51bnNoaWZ0KHJldmVyc2VVcGRhdGVPcCk7XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVkUHJvcHMpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgb3BzLnVuc2hpZnQoe1xuICAgICAgICBvcElkLFxuICAgICAgICBpZDogdGhpcy5faWQsXG4gICAgICAgIHR5cGU6IDMgLyogVVBEQVRFX09CSkVDVCAqLyxcbiAgICAgICAgZGF0YTogdXBkYXRlZFByb3BzXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHN0b3JhZ2VVcGRhdGVzLnNldCh0aGlzLl9pZCwge1xuICAgICAgbm9kZTogdGhpcyxcbiAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgdXBkYXRlczogdXBkYXRlRGVsdGFcbiAgICB9KTtcbiAgICB0aGlzLl9wb29sLmRpc3BhdGNoKG9wcywgcmV2ZXJzZU9wcywgc3RvcmFnZVVwZGF0ZXMpO1xuICB9XG4gIHRvSW1tdXRhYmxlKCkge1xuICAgIHJldHVybiBzdXBlci50b0ltbXV0YWJsZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgdG9UcmVlTm9kZShrZXkpIHtcbiAgICByZXR1cm4gc3VwZXIudG9UcmVlTm9kZShrZXkpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvVHJlZU5vZGUoa2V5KSB7XG4gICAgY29uc3Qgbm9kZUlkID0gdGhpcy5faWQgPz8gbmFub2lkKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiTGl2ZU9iamVjdFwiLFxuICAgICAgaWQ6IG5vZGVJZCxcbiAgICAgIGtleSxcbiAgICAgIHBheWxvYWQ6IEFycmF5LmZyb20odGhpcy5fbWFwLmVudHJpZXMoKSkubWFwKFxuICAgICAgICAoW2tleTIsIHZhbHVlXSkgPT4gaXNMaXZlTm9kZSh2YWx1ZSkgPyB2YWx1ZS50b1RyZWVOb2RlKGtleTIpIDogeyB0eXBlOiBcIkpzb25cIiwgaWQ6IGAke25vZGVJZH06JHtrZXkyfWAsIGtleToga2V5MiwgcGF5bG9hZDogdmFsdWUgfVxuICAgICAgKVxuICAgIH07XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9JbW11dGFibGUoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIHRoaXMuX21hcCkge1xuICAgICAgcmVzdWx0W2tleV0gPSBpc0xpdmVTdHJ1Y3R1cmUodmFsKSA/IHZhbC50b0ltbXV0YWJsZSgpIDogdmFsO1xuICAgIH1cbiAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiID8gcmVzdWx0IDogT2JqZWN0LmZyZWV6ZShyZXN1bHQpO1xuICB9XG4gIGNsb25lKCkge1xuICAgIHJldHVybiBuZXcgX0xpdmVPYmplY3QoXG4gICAgICBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIEFycmF5LmZyb20odGhpcy5fbWFwKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW1xuICAgICAgICAgIGtleSxcbiAgICAgICAgICBpc0xpdmVTdHJ1Y3R1cmUodmFsdWUpID8gdmFsdWUuY2xvbmUoKSA6IGRlZXBDbG9uZSh2YWx1ZSlcbiAgICAgICAgXSlcbiAgICAgIClcbiAgICApO1xuICB9XG59O1xuXG4vLyBzcmMvY3JkdHMvbGl2ZWJsb2Nrcy1oZWxwZXJzLnRzXG5mdW5jdGlvbiBjcmVhdGlvbk9wVG9MaXZlTm9kZShvcCkge1xuICByZXR1cm4gbHNvblRvTGl2ZU5vZGUoY3JlYXRpb25PcFRvTHNvbihvcCkpO1xufVxuZnVuY3Rpb24gY3JlYXRpb25PcFRvTHNvbihvcCkge1xuICBzd2l0Y2ggKG9wLnR5cGUpIHtcbiAgICBjYXNlIDggLyogQ1JFQVRFX1JFR0lTVEVSICovOlxuICAgICAgcmV0dXJuIG9wLmRhdGE7XG4gICAgY2FzZSA0IC8qIENSRUFURV9PQkpFQ1QgKi86XG4gICAgICByZXR1cm4gbmV3IExpdmVPYmplY3Qob3AuZGF0YSk7XG4gICAgY2FzZSA3IC8qIENSRUFURV9NQVAgKi86XG4gICAgICByZXR1cm4gbmV3IExpdmVNYXAoKTtcbiAgICBjYXNlIDIgLyogQ1JFQVRFX0xJU1QgKi86XG4gICAgICByZXR1cm4gbmV3IExpdmVMaXN0KFtdKTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKG9wLCBcIlVua25vd24gY3JlYXRpb24gT3BcIik7XG4gIH1cbn1cbmZ1bmN0aW9uIGlzU2FtZU5vZGVPckNoaWxkT2Yobm9kZSwgcGFyZW50KSB7XG4gIGlmIChub2RlID09PSBwYXJlbnQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAobm9kZS5wYXJlbnQudHlwZSA9PT0gXCJIYXNQYXJlbnRcIikge1xuICAgIHJldHVybiBpc1NhbWVOb2RlT3JDaGlsZE9mKG5vZGUucGFyZW50Lm5vZGUsIHBhcmVudCk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gZGVzZXJpYWxpemUoW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCkge1xuICBzd2l0Y2ggKGNyZHQudHlwZSkge1xuICAgIGNhc2UgMCAvKiBPQkpFQ1QgKi86IHtcbiAgICAgIHJldHVybiBMaXZlT2JqZWN0Ll9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAxIC8qIExJU1QgKi86IHtcbiAgICAgIHJldHVybiBMaXZlTGlzdC5fZGVzZXJpYWxpemUoW2lkLCBjcmR0XSwgcGFyZW50VG9DaGlsZHJlbiwgcG9vbCk7XG4gICAgfVxuICAgIGNhc2UgMiAvKiBNQVAgKi86IHtcbiAgICAgIHJldHVybiBMaXZlTWFwLl9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAzIC8qIFJFR0lTVEVSICovOiB7XG4gICAgICByZXR1cm4gTGl2ZVJlZ2lzdGVyLl9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBDUkRUIHR5cGVcIik7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBkZXNlcmlhbGl6ZVRvTHNvbihbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKSB7XG4gIHN3aXRjaCAoY3JkdC50eXBlKSB7XG4gICAgY2FzZSAwIC8qIE9CSkVDVCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVPYmplY3QuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDEgLyogTElTVCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVMaXN0Ll9kZXNlcmlhbGl6ZShbaWQsIGNyZHRdLCBwYXJlbnRUb0NoaWxkcmVuLCBwb29sKTtcbiAgICB9XG4gICAgY2FzZSAyIC8qIE1BUCAqLzoge1xuICAgICAgcmV0dXJuIExpdmVNYXAuX2Rlc2VyaWFsaXplKFtpZCwgY3JkdF0sIHBhcmVudFRvQ2hpbGRyZW4sIHBvb2wpO1xuICAgIH1cbiAgICBjYXNlIDMgLyogUkVHSVNURVIgKi86IHtcbiAgICAgIHJldHVybiBjcmR0LmRhdGE7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgQ1JEVCB0eXBlXCIpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gaXNMaXZlU3RydWN0dXJlKHZhbHVlKSB7XG4gIHJldHVybiBpc0xpdmVMaXN0KHZhbHVlKSB8fCBpc0xpdmVNYXAodmFsdWUpIHx8IGlzTGl2ZU9iamVjdCh2YWx1ZSk7XG59XG5mdW5jdGlvbiBpc0xpdmVOb2RlKHZhbHVlKSB7XG4gIHJldHVybiBpc0xpdmVTdHJ1Y3R1cmUodmFsdWUpIHx8IGlzTGl2ZVJlZ2lzdGVyKHZhbHVlKTtcbn1cbmZ1bmN0aW9uIGlzTGl2ZUxpc3QodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgTGl2ZUxpc3Q7XG59XG5mdW5jdGlvbiBpc0xpdmVNYXAodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgTGl2ZU1hcDtcbn1cbmZ1bmN0aW9uIGlzTGl2ZU9iamVjdCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBMaXZlT2JqZWN0O1xufVxuZnVuY3Rpb24gaXNMaXZlUmVnaXN0ZXIodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgTGl2ZVJlZ2lzdGVyO1xufVxuZnVuY3Rpb24gY2xvbmVMc29uKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXNMaXZlU3RydWN0dXJlKHZhbHVlKSA/IHZhbHVlLmNsb25lKCkgOiBkZWVwQ2xvbmUodmFsdWUpO1xufVxuZnVuY3Rpb24gbGl2ZU5vZGVUb0xzb24ob2JqKSB7XG4gIGlmIChvYmogaW5zdGFuY2VvZiBMaXZlUmVnaXN0ZXIpIHtcbiAgICByZXR1cm4gb2JqLmRhdGE7XG4gIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgTGl2ZUxpc3QgfHwgb2JqIGluc3RhbmNlb2YgTGl2ZU1hcCB8fCBvYmogaW5zdGFuY2VvZiBMaXZlT2JqZWN0KSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXNzZXJ0TmV2ZXIob2JqLCBcIlVua25vd24gQWJzdHJhY3RDcmR0XCIpO1xuICB9XG59XG5mdW5jdGlvbiBsc29uVG9MaXZlTm9kZSh2YWx1ZSkge1xuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlT2JqZWN0IHx8IHZhbHVlIGluc3RhbmNlb2YgTGl2ZU1hcCB8fCB2YWx1ZSBpbnN0YW5jZW9mIExpdmVMaXN0KSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXcgTGl2ZVJlZ2lzdGVyKHZhbHVlKTtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0VHJlZXNEaWZmT3BlcmF0aW9ucyhjdXJyZW50SXRlbXMsIG5ld0l0ZW1zKSB7XG4gIGNvbnN0IG9wcyA9IFtdO1xuICBjdXJyZW50SXRlbXMuZm9yRWFjaCgoXywgaWQpID0+IHtcbiAgICBpZiAoIW5ld0l0ZW1zLmdldChpZCkpIHtcbiAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgdHlwZTogNSAvKiBERUxFVEVfQ1JEVCAqLyxcbiAgICAgICAgaWRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIG5ld0l0ZW1zLmZvckVhY2goKGNyZHQsIGlkKSA9PiB7XG4gICAgY29uc3QgY3VycmVudENyZHQgPSBjdXJyZW50SXRlbXMuZ2V0KGlkKTtcbiAgICBpZiAoY3VycmVudENyZHQpIHtcbiAgICAgIGlmIChjcmR0LnR5cGUgPT09IDAgLyogT0JKRUNUICovKSB7XG4gICAgICAgIGlmIChjdXJyZW50Q3JkdC50eXBlICE9PSAwIC8qIE9CSkVDVCAqLyB8fCBKU09OLnN0cmluZ2lmeShjcmR0LmRhdGEpICE9PSBKU09OLnN0cmluZ2lmeShjdXJyZW50Q3JkdC5kYXRhKSkge1xuICAgICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6IDMgLyogVVBEQVRFX09CSkVDVCAqLyxcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgZGF0YTogY3JkdC5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjcmR0LnBhcmVudEtleSAhPT0gY3VycmVudENyZHQucGFyZW50S2V5KSB7XG4gICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAxIC8qIFNFVF9QQVJFTlRfS0VZICovLFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIHBhcmVudEtleTogbm4oY3JkdC5wYXJlbnRLZXksIFwiUGFyZW50IGtleSBtdXN0IG5vdCBiZSBtaXNzaW5nXCIpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzd2l0Y2ggKGNyZHQudHlwZSkge1xuICAgICAgICBjYXNlIDMgLyogUkVHSVNURVIgKi86XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogOCAvKiBDUkVBVEVfUkVHSVNURVIgKi8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHBhcmVudElkOiBjcmR0LnBhcmVudElkLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBjcmR0LnBhcmVudEtleSxcbiAgICAgICAgICAgIGRhdGE6IGNyZHQuZGF0YVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEgLyogTElTVCAqLzpcbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIENSRUFURV9MSVNUICovLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBwYXJlbnRJZDogY3JkdC5wYXJlbnRJZCxcbiAgICAgICAgICAgIHBhcmVudEtleTogY3JkdC5wYXJlbnRLZXlcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAwIC8qIE9CSkVDVCAqLzpcbiAgICAgICAgICBpZiAoY3JkdC5wYXJlbnRJZCA9PT0gdm9pZCAwIHx8IGNyZHQucGFyZW50S2V5ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgXCJJbnRlcm5hbCBlcnJvci4gQ2Fubm90IHNlcmlhbGl6ZSBzdG9yYWdlIHJvb3QgaW50byBhbiBvcGVyYXRpb25cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogNCAvKiBDUkVBVEVfT0JKRUNUICovLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBwYXJlbnRJZDogY3JkdC5wYXJlbnRJZCxcbiAgICAgICAgICAgIHBhcmVudEtleTogY3JkdC5wYXJlbnRLZXksXG4gICAgICAgICAgICBkYXRhOiBjcmR0LmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyIC8qIE1BUCAqLzpcbiAgICAgICAgICBvcHMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiA3IC8qIENSRUFURV9NQVAgKi8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHBhcmVudElkOiBjcmR0LnBhcmVudElkLFxuICAgICAgICAgICAgcGFyZW50S2V5OiBjcmR0LnBhcmVudEtleVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiBvcHM7XG59XG5mdW5jdGlvbiBtZXJnZU9iamVjdFN0b3JhZ2VVcGRhdGVzKGZpcnN0LCBzZWNvbmQpIHtcbiAgY29uc3QgdXBkYXRlcyA9IGZpcnN0LnVwZGF0ZXM7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMoc2Vjb25kLnVwZGF0ZXMpKSB7XG4gICAgdXBkYXRlc1trZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5zZWNvbmQsXG4gICAgdXBkYXRlc1xuICB9O1xufVxuZnVuY3Rpb24gbWVyZ2VNYXBTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKSB7XG4gIGNvbnN0IHVwZGF0ZXMgPSBmaXJzdC51cGRhdGVzO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzKHNlY29uZC51cGRhdGVzKSkge1xuICAgIHVwZGF0ZXNba2V5XSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiB7XG4gICAgLi4uc2Vjb25kLFxuICAgIHVwZGF0ZXNcbiAgfTtcbn1cbmZ1bmN0aW9uIG1lcmdlTGlzdFN0b3JhZ2VVcGRhdGVzKGZpcnN0LCBzZWNvbmQpIHtcbiAgY29uc3QgdXBkYXRlcyA9IGZpcnN0LnVwZGF0ZXM7XG4gIHJldHVybiB7XG4gICAgLi4uc2Vjb25kLFxuICAgIHVwZGF0ZXM6IHVwZGF0ZXMuY29uY2F0KHNlY29uZC51cGRhdGVzKVxuICB9O1xufVxuZnVuY3Rpb24gbWVyZ2VTdG9yYWdlVXBkYXRlcyhmaXJzdCwgc2Vjb25kKSB7XG4gIGlmIChmaXJzdCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHNlY29uZDtcbiAgfVxuICBpZiAoZmlyc3QudHlwZSA9PT0gXCJMaXZlT2JqZWN0XCIgJiYgc2Vjb25kLnR5cGUgPT09IFwiTGl2ZU9iamVjdFwiKSB7XG4gICAgcmV0dXJuIG1lcmdlT2JqZWN0U3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCk7XG4gIH0gZWxzZSBpZiAoZmlyc3QudHlwZSA9PT0gXCJMaXZlTWFwXCIgJiYgc2Vjb25kLnR5cGUgPT09IFwiTGl2ZU1hcFwiKSB7XG4gICAgcmV0dXJuIG1lcmdlTWFwU3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCk7XG4gIH0gZWxzZSBpZiAoZmlyc3QudHlwZSA9PT0gXCJMaXZlTGlzdFwiICYmIHNlY29uZC50eXBlID09PSBcIkxpdmVMaXN0XCIpIHtcbiAgICByZXR1cm4gbWVyZ2VMaXN0U3RvcmFnZVVwZGF0ZXMoZmlyc3QsIHNlY29uZCk7XG4gIH0gZWxzZSB7XG4gIH1cbiAgcmV0dXJuIHNlY29uZDtcbn1cbmZ1bmN0aW9uIGlzUGxhaW4odmFsdWUpIHtcbiAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgcmV0dXJuIHZhbHVlID09PSB2b2lkIDAgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlID09PSBcImJvb2xlYW5cIiB8fCB0eXBlID09PSBcIm51bWJlclwiIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IGlzUGxhaW5PYmplY3QodmFsdWUpO1xufVxuZnVuY3Rpb24gZmluZE5vblNlcmlhbGl6YWJsZVZhbHVlKHZhbHVlLCBwYXRoID0gXCJcIikge1xuICBpZiAoIWlzUGxhaW4pIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGF0aDogcGF0aCB8fCBcInJvb3RcIixcbiAgICAgIHZhbHVlXG4gICAgfTtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAoY29uc3QgW2tleSwgbmVzdGVkVmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkge1xuICAgIGNvbnN0IG5lc3RlZFBhdGggPSBwYXRoID8gcGF0aCArIFwiLlwiICsga2V5IDoga2V5O1xuICAgIGlmICghaXNQbGFpbihuZXN0ZWRWYWx1ZSkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhdGg6IG5lc3RlZFBhdGgsXG4gICAgICAgIHZhbHVlOiBuZXN0ZWRWYWx1ZVxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBuZXN0ZWRWYWx1ZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgY29uc3Qgbm9uU2VyaWFsaXphYmxlTmVzdGVkVmFsdWUgPSBmaW5kTm9uU2VyaWFsaXphYmxlVmFsdWUoXG4gICAgICAgIG5lc3RlZFZhbHVlLFxuICAgICAgICBuZXN0ZWRQYXRoXG4gICAgICApO1xuICAgICAgaWYgKG5vblNlcmlhbGl6YWJsZU5lc3RlZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiBub25TZXJpYWxpemFibGVOZXN0ZWRWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyBzcmMvbGliL2NyZWF0ZUlkcy50c1xudmFyIFRIUkVBRF9JRF9QUkVGSVggPSBcInRoXCI7XG52YXIgQ09NTUVOVF9JRF9QUkVGSVggPSBcImNtXCI7XG52YXIgSU5CT1hfTk9USUZJQ0FUSU9OX0lEX1BSRUZJWCA9IFwiaW5cIjtcbmZ1bmN0aW9uIGNyZWF0ZU9wdGltaXN0aWNJZChwcmVmaXgpIHtcbiAgcmV0dXJuIGAke3ByZWZpeH1fJHtuYW5vaWQoKX1gO1xufVxuZnVuY3Rpb24gY3JlYXRlVGhyZWFkSWQoKSB7XG4gIHJldHVybiBjcmVhdGVPcHRpbWlzdGljSWQoVEhSRUFEX0lEX1BSRUZJWCk7XG59XG5mdW5jdGlvbiBjcmVhdGVDb21tZW50SWQoKSB7XG4gIHJldHVybiBjcmVhdGVPcHRpbWlzdGljSWQoQ09NTUVOVF9JRF9QUkVGSVgpO1xufVxuZnVuY3Rpb24gY3JlYXRlSW5ib3hOb3RpZmljYXRpb25JZCgpIHtcbiAgcmV0dXJuIGNyZWF0ZU9wdGltaXN0aWNJZChJTkJPWF9OT1RJRklDQVRJT05fSURfUFJFRklYKTtcbn1cblxuLy8gc3JjL2xpYi9kZWJ1Zy50c1xuZnVuY3Rpb24gY2FwdHVyZVN0YWNrVHJhY2UobXNnLCB0cmFjZVJvb3QpIHtcbiAgY29uc3QgZXJyb3JMaWtlID0geyBuYW1lOiBtc2cgfTtcbiAgaWYgKHR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZShlcnJvckxpa2UsIHRyYWNlUm9vdCk7XG4gIHJldHVybiBlcnJvckxpa2Uuc3RhY2s7XG59XG5cbi8vIHNyYy9saWIvSnNvbi50c1xuZnVuY3Rpb24gaXNKc29uU2NhbGFyKGRhdGEpIHtcbiAgcmV0dXJuIGRhdGEgPT09IG51bGwgfHwgdHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIGRhdGEgPT09IFwibnVtYmVyXCIgfHwgdHlwZW9mIGRhdGEgPT09IFwiYm9vbGVhblwiO1xufVxuZnVuY3Rpb24gaXNKc29uQXJyYXkoZGF0YSkge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheShkYXRhKTtcbn1cbmZ1bmN0aW9uIGlzSnNvbk9iamVjdChkYXRhKSB7XG4gIHJldHVybiAhaXNKc29uU2NhbGFyKGRhdGEpICYmICFpc0pzb25BcnJheShkYXRhKTtcbn1cblxuLy8gc3JjL2xpYi9vYmplY3RUb1F1ZXJ5LnRzXG52YXIgaWRlbnRpZmllclJlZ2V4ID0gL15bYS16QS1aX11bYS16QS1aMC05X10qJC87XG5mdW5jdGlvbiBvYmplY3RUb1F1ZXJ5KG9iaikge1xuICBsZXQgZmlsdGVyTGlzdCA9IFtdO1xuICBjb25zdCBlbnRyaWVzMiA9IE9iamVjdC5lbnRyaWVzKG9iaik7XG4gIGNvbnN0IGtleVZhbHVlUGFpcnMgPSBbXTtcbiAgY29uc3Qga2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvciA9IFtdO1xuICBjb25zdCBpbmRleGVkS2V5cyA9IFtdO1xuICBlbnRyaWVzMi5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICBpZiAoIWlkZW50aWZpZXJSZWdleC50ZXN0KGtleSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIktleSBtdXN0IG9ubHkgY29udGFpbiBsZXR0ZXJzLCBudW1iZXJzLCBfXCIpO1xuICAgIH1cbiAgICBpZiAoaXNTaW1wbGVWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgIGtleVZhbHVlUGFpcnMucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgIH0gZWxzZSBpZiAoaXNWYWx1ZVdpdGhPcGVyYXRvcih2YWx1ZSkpIHtcbiAgICAgIGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmICEoXCJzdGFydHNXaXRoXCIgaW4gdmFsdWUpKSB7XG4gICAgICBpbmRleGVkS2V5cy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfVxuICB9KTtcbiAgZmlsdGVyTGlzdCA9IFtcbiAgICAuLi5nZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnMoa2V5VmFsdWVQYWlycyksXG4gICAgLi4uZ2V0RmlsdGVyc0Zyb21LZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yKGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IpXG4gIF07XG4gIGluZGV4ZWRLZXlzLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGNvbnN0IG5lc3RlZEVudHJpZXMgPSBPYmplY3QuZW50cmllcyh2YWx1ZSk7XG4gICAgY29uc3QgbktleVZhbHVlUGFpcnMgPSBbXTtcbiAgICBjb25zdCBuS2V5VmFsdWVQYWlyc1dpdGhPcGVyYXRvciA9IFtdO1xuICAgIG5lc3RlZEVudHJpZXMuZm9yRWFjaCgoW25lc3RlZEtleSwgbmVzdGVkVmFsdWVdKSA9PiB7XG4gICAgICBpZiAoaXNTdHJpbmdFbXB0eShuZXN0ZWRLZXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIktleSBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgICB9XG4gICAgICBpZiAoaXNTaW1wbGVWYWx1ZShuZXN0ZWRWYWx1ZSkpIHtcbiAgICAgICAgbktleVZhbHVlUGFpcnMucHVzaChbZm9ybWF0RmlsdGVyS2V5KGtleSwgbmVzdGVkS2V5KSwgbmVzdGVkVmFsdWVdKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNWYWx1ZVdpdGhPcGVyYXRvcihuZXN0ZWRWYWx1ZSkpIHtcbiAgICAgICAgbktleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IucHVzaChbXG4gICAgICAgICAgZm9ybWF0RmlsdGVyS2V5KGtleSwgbmVzdGVkS2V5KSxcbiAgICAgICAgICBuZXN0ZWRWYWx1ZVxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBmaWx0ZXJMaXN0ID0gW1xuICAgICAgLi4uZmlsdGVyTGlzdCxcbiAgICAgIC4uLmdldEZpbHRlcnNGcm9tS2V5VmFsdWVQYWlycyhuS2V5VmFsdWVQYWlycyksXG4gICAgICAuLi5nZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IobktleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IpXG4gICAgXTtcbiAgfSk7XG4gIHJldHVybiBmaWx0ZXJMaXN0Lm1hcChcbiAgICAoeyBrZXksIG9wZXJhdG9yLCB2YWx1ZSB9KSA9PiBmb3JtYXRGaWx0ZXIoa2V5LCBvcGVyYXRvciwgZm9ybWF0RmlsdGVyVmFsdWUodmFsdWUpKVxuICApLmpvaW4oXCIgQU5EIFwiKTtcbn1cbnZhciBnZXRGaWx0ZXJzRnJvbUtleVZhbHVlUGFpcnMgPSAoa2V5VmFsdWVQYWlycykgPT4ge1xuICBjb25zdCBmaWx0ZXJzID0gW107XG4gIGtleVZhbHVlUGFpcnMuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgZmlsdGVycy5wdXNoKHtcbiAgICAgIGtleSxcbiAgICAgIG9wZXJhdG9yOiBcIjpcIixcbiAgICAgIHZhbHVlXG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gZmlsdGVycztcbn07XG52YXIgZ2V0RmlsdGVyc0Zyb21LZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yID0gKGtleVZhbHVlUGFpcnNXaXRoT3BlcmF0b3IpID0+IHtcbiAgY29uc3QgZmlsdGVycyA9IFtdO1xuICBrZXlWYWx1ZVBhaXJzV2l0aE9wZXJhdG9yLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGlmIChcInN0YXJ0c1dpdGhcIiBpbiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUuc3RhcnRzV2l0aCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgZmlsdGVycy5wdXNoKHtcbiAgICAgICAga2V5LFxuICAgICAgICBvcGVyYXRvcjogXCJeXCIsXG4gICAgICAgIHZhbHVlOiB2YWx1ZS5zdGFydHNXaXRoXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmlsdGVycztcbn07XG52YXIgaXNTaW1wbGVWYWx1ZSA9ICh2YWx1ZSkgPT4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcbnZhciBpc1ZhbHVlV2l0aE9wZXJhdG9yID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwgJiYgXCJzdGFydHNXaXRoXCIgaW4gdmFsdWUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xudmFyIGZvcm1hdEZpbHRlciA9IChrZXksIG9wZXJhdG9yLCB2YWx1ZSkgPT4ge1xuICByZXR1cm4gYCR7a2V5fSR7b3BlcmF0b3J9JHt2YWx1ZX1gO1xufTtcbnZhciBmb3JtYXRGaWx0ZXJLZXkgPSAoa2V5LCBuZXN0ZWRLZXkpID0+IHtcbiAgaWYgKG5lc3RlZEtleSkge1xuICAgIHJldHVybiBgJHtrZXl9WyR7SlNPTi5zdHJpbmdpZnkobmVzdGVkS2V5KX1dYDtcbiAgfVxuICByZXR1cm4ga2V5O1xufTtcbnZhciBmb3JtYXRGaWx0ZXJWYWx1ZSA9ICh2YWx1ZSkgPT4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgaWYgKGlzU3RyaW5nRW1wdHkodmFsdWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG59O1xudmFyIGlzU3RyaW5nRW1wdHkgPSAodmFsdWUpID0+IHtcbiAgcmV0dXJuICF2YWx1ZSB8fCB2YWx1ZS50b1N0cmluZygpLnRyaW0oKSA9PT0gXCJcIjtcbn07XG5cbi8vIHNyYy9wcm90b2NvbC9DbGllbnRNc2cudHNcbnZhciBDbGllbnRNc2dDb2RlID0gLyogQF9fUFVSRV9fICovICgoQ2xpZW50TXNnQ29kZTIpID0+IHtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJVUERBVEVfUFJFU0VOQ0VcIl0gPSAxMDBdID0gXCJVUERBVEVfUFJFU0VOQ0VcIjtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJCUk9BRENBU1RfRVZFTlRcIl0gPSAxMDNdID0gXCJCUk9BRENBU1RfRVZFTlRcIjtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJGRVRDSF9TVE9SQUdFXCJdID0gMjAwXSA9IFwiRkVUQ0hfU1RPUkFHRVwiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIlVQREFURV9TVE9SQUdFXCJdID0gMjAxXSA9IFwiVVBEQVRFX1NUT1JBR0VcIjtcbiAgQ2xpZW50TXNnQ29kZTJbQ2xpZW50TXNnQ29kZTJbXCJGRVRDSF9ZRE9DXCJdID0gMzAwXSA9IFwiRkVUQ0hfWURPQ1wiO1xuICBDbGllbnRNc2dDb2RlMltDbGllbnRNc2dDb2RlMltcIlVQREFURV9ZRE9DXCJdID0gMzAxXSA9IFwiVVBEQVRFX1lET0NcIjtcbiAgcmV0dXJuIENsaWVudE1zZ0NvZGUyO1xufSkoQ2xpZW50TXNnQ29kZSB8fCB7fSk7XG5cbi8vIHNyYy9yZWZzL0ltbXV0YWJsZVJlZi50c1xuZnVuY3Rpb24gbWVyZ2UodGFyZ2V0LCBwYXRjaCkge1xuICBsZXQgdXBkYXRlZCA9IGZhbHNlO1xuICBjb25zdCBuZXdWYWx1ZSA9IHsgLi4udGFyZ2V0IH07XG4gIE9iamVjdC5rZXlzKHBhdGNoKS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gaztcbiAgICBjb25zdCB2YWwgPSBwYXRjaFtrZXldO1xuICAgIGlmIChuZXdWYWx1ZVtrZXldICE9PSB2YWwpIHtcbiAgICAgIGlmICh2YWwgPT09IHZvaWQgMCkge1xuICAgICAgICBkZWxldGUgbmV3VmFsdWVba2V5XTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1ZhbHVlW2tleV0gPSB2YWw7XG4gICAgICB9XG4gICAgICB1cGRhdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdXBkYXRlZCA/IG5ld1ZhbHVlIDogdGFyZ2V0O1xufVxudmFyIEltbXV0YWJsZVJlZiA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fZXYgPSBtYWtlRXZlbnRTb3VyY2UoKTtcbiAgfVxuICBnZXQgZGlkSW52YWxpZGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZXYub2JzZXJ2YWJsZTtcbiAgfVxuICBpbnZhbGlkYXRlKCkge1xuICAgIGlmICh0aGlzLl9jYWNoZSAhPT0gdm9pZCAwKSB7XG4gICAgICB0aGlzLl9jYWNoZSA9IHZvaWQgMDtcbiAgICAgIHRoaXMuX2V2Lm5vdGlmeSgpO1xuICAgIH1cbiAgfVxuICBnZXQgY3VycmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2FjaGUgPz8gKHRoaXMuX2NhY2hlID0gdGhpcy5fdG9JbW11dGFibGUoKSk7XG4gIH1cbn07XG5cbi8vIHNyYy9yZWZzL090aGVyc1JlZi50c1xuZnVuY3Rpb24gbWFrZVVzZXIoY29ubiwgcHJlc2VuY2UpIHtcbiAgY29uc3QgeyBjb25uZWN0aW9uSWQsIGlkLCBpbmZvIH0gPSBjb25uO1xuICBjb25zdCBjYW5Xcml0ZSA9IGNhbldyaXRlU3RvcmFnZShjb25uLnNjb3Blcyk7XG4gIHJldHVybiBmcmVlemUoXG4gICAgY29tcGFjdE9iamVjdCh7XG4gICAgICBjb25uZWN0aW9uSWQsXG4gICAgICBpZCxcbiAgICAgIGluZm8sXG4gICAgICBjYW5Xcml0ZSxcbiAgICAgIGNhbkNvbW1lbnQ6IGNhbkNvbW1lbnQoY29ubi5zY29wZXMpLFxuICAgICAgaXNSZWFkT25seTogIWNhbldyaXRlLFxuICAgICAgLy8gRGVwcmVjYXRlZCwga2VwdCBmb3IgYmFja3dhcmQtY29tcGF0aWJpbGl0eVxuICAgICAgcHJlc2VuY2VcbiAgICB9KVxuICApO1xufVxudmFyIE90aGVyc1JlZiA9IGNsYXNzIGV4dGVuZHMgSW1tdXRhYmxlUmVmIHtcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9jb25uZWN0aW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5fcHJlc2VuY2VzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICB0aGlzLl91c2VycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIH1cbiAgY29ubmVjdGlvbklkcygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbnMua2V5cygpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX3RvSW1tdXRhYmxlKCkge1xuICAgIGNvbnN0IHVzZXJzID0gY29tcGFjdChcbiAgICAgIEFycmF5LmZyb20odGhpcy5fcHJlc2VuY2VzLmtleXMoKSkubWFwKFxuICAgICAgICAoY29ubmVjdGlvbklkKSA9PiB0aGlzLmdldFVzZXIoTnVtYmVyKGNvbm5lY3Rpb25JZCkpXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4gdXNlcnM7XG4gIH1cbiAgY2xlYXJPdGhlcnMoKSB7XG4gICAgdGhpcy5fY29ubmVjdGlvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuX3ByZXNlbmNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5fdXNlcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgX2dldFVzZXIoY29ubmVjdGlvbklkKSB7XG4gICAgY29uc3QgY29ubiA9IHRoaXMuX2Nvbm5lY3Rpb25zLmdldChjb25uZWN0aW9uSWQpO1xuICAgIGNvbnN0IHByZXNlbmNlID0gdGhpcy5fcHJlc2VuY2VzLmdldChjb25uZWN0aW9uSWQpO1xuICAgIGlmIChjb25uICE9PSB2b2lkIDAgJiYgcHJlc2VuY2UgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG1ha2VVc2VyKGNvbm4sIHByZXNlbmNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBnZXRVc2VyKGNvbm5lY3Rpb25JZCkge1xuICAgIGNvbnN0IGNhY2hlZFVzZXIgPSB0aGlzLl91c2Vycy5nZXQoY29ubmVjdGlvbklkKTtcbiAgICBpZiAoY2FjaGVkVXNlcikge1xuICAgICAgcmV0dXJuIGNhY2hlZFVzZXI7XG4gICAgfVxuICAgIGNvbnN0IGNvbXB1dGVkVXNlciA9IHRoaXMuX2dldFVzZXIoY29ubmVjdGlvbklkKTtcbiAgICBpZiAoY29tcHV0ZWRVc2VyKSB7XG4gICAgICB0aGlzLl91c2Vycy5zZXQoY29ubmVjdGlvbklkLCBjb21wdXRlZFVzZXIpO1xuICAgICAgcmV0dXJuIGNvbXB1dGVkVXNlcjtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF9pbnZhbGlkYXRlVXNlcihjb25uZWN0aW9uSWQpIHtcbiAgICBpZiAodGhpcy5fdXNlcnMuaGFzKGNvbm5lY3Rpb25JZCkpIHtcbiAgICAgIHRoaXMuX3VzZXJzLmRlbGV0ZShjb25uZWN0aW9uSWQpO1xuICAgIH1cbiAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgfVxuICAvKipcbiAgICogUmVjb3JkcyBhIGtub3duIGNvbm5lY3Rpb24uIFRoaXMgcmVjb3JkcyB0aGUgY29ubmVjdGlvbiBJRCBhbmQgdGhlXG4gICAqIGFzc29jaWF0ZWQgbWV0YWRhdGEuXG4gICAqL1xuICBzZXRDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCwgbWV0YVVzZXJJZCwgbWV0YVVzZXJJbmZvLCBzY29wZXMpIHtcbiAgICB0aGlzLl9jb25uZWN0aW9ucy5zZXQoXG4gICAgICBjb25uZWN0aW9uSWQsXG4gICAgICBmcmVlemUoe1xuICAgICAgICBjb25uZWN0aW9uSWQsXG4gICAgICAgIGlkOiBtZXRhVXNlcklkLFxuICAgICAgICBpbmZvOiBtZXRhVXNlckluZm8sXG4gICAgICAgIHNjb3Blc1xuICAgICAgfSlcbiAgICApO1xuICAgIGlmICh0aGlzLl9wcmVzZW5jZXMuaGFzKGNvbm5lY3Rpb25JZCkpIHtcbiAgICAgIHRoaXMuX2ludmFsaWRhdGVVc2VyKGNvbm5lY3Rpb25JZCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZW1vdmVzIGEga25vd24gY29ubmVjdGlvbklkLiBSZW1vdmVzIGJvdGggdGhlIGNvbm5lY3Rpb24ncyBtZXRhZGF0YSBhbmRcbiAgICogdGhlIHByZXNlbmNlIGluZm9ybWF0aW9uLlxuICAgKi9cbiAgcmVtb3ZlQ29ubmVjdGlvbihjb25uZWN0aW9uSWQpIHtcbiAgICB0aGlzLl9jb25uZWN0aW9ucy5kZWxldGUoY29ubmVjdGlvbklkKTtcbiAgICB0aGlzLl9wcmVzZW5jZXMuZGVsZXRlKGNvbm5lY3Rpb25JZCk7XG4gICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgfVxuICAvKipcbiAgICogU3RvcmVzIGEgbmV3IHVzZXIgZnJvbSBhIGZ1bGwgcHJlc2VuY2UgdXBkYXRlLiBJZiB0aGUgdXNlciBhbHJlYWR5IGV4aXN0cyxcbiAgICogaXRzIGtub3duIHByZXNlbmNlIGRhdGEgaXMgb3ZlcndyaXR0ZW4uXG4gICAqL1xuICBzZXRPdGhlcihjb25uZWN0aW9uSWQsIHByZXNlbmNlKSB7XG4gICAgdGhpcy5fcHJlc2VuY2VzLnNldChjb25uZWN0aW9uSWQsIGZyZWV6ZShjb21wYWN0T2JqZWN0KHByZXNlbmNlKSkpO1xuICAgIGlmICh0aGlzLl9jb25uZWN0aW9ucy5oYXMoY29ubmVjdGlvbklkKSkge1xuICAgICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFBhdGNoZXMgdGhlIHByZXNlbmNlIGRhdGEgZm9yIGFuIGV4aXN0aW5nIFwib3RoZXJcIi4gSWYgd2UgZG9uJ3Qga25vdyB0aGVcbiAgICogaW5pdGlhbCBwcmVzZW5jZSBkYXRhIGZvciB0aGlzIHVzZXIgeWV0LCBkaXNjYXJkIHRoaXMgcGF0Y2ggYW5kIGF3YWl0IHRoZVxuICAgKiBmdWxsIC5zZXRPdGhlcigpIGNhbGwgZmlyc3QuXG4gICAqL1xuICBwYXRjaE90aGVyKGNvbm5lY3Rpb25JZCwgcGF0Y2gpIHtcbiAgICBjb25zdCBvbGRQcmVzZW5jZSA9IHRoaXMuX3ByZXNlbmNlcy5nZXQoY29ubmVjdGlvbklkKTtcbiAgICBpZiAob2xkUHJlc2VuY2UgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBuZXdQcmVzZW5jZSA9IG1lcmdlKG9sZFByZXNlbmNlLCBwYXRjaCk7XG4gICAgaWYgKG9sZFByZXNlbmNlICE9PSBuZXdQcmVzZW5jZSkge1xuICAgICAgdGhpcy5fcHJlc2VuY2VzLnNldChjb25uZWN0aW9uSWQsIGZyZWV6ZShuZXdQcmVzZW5jZSkpO1xuICAgICAgdGhpcy5faW52YWxpZGF0ZVVzZXIoY29ubmVjdGlvbklkKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNyYy9yZWZzL1BhdGNoYWJsZVJlZi50c1xudmFyIFBhdGNoYWJsZVJlZiA9IGNsYXNzIGV4dGVuZHMgSW1tdXRhYmxlUmVmIHtcbiAgY29uc3RydWN0b3IoZGF0YSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YSA9IGZyZWV6ZShjb21wYWN0T2JqZWN0KGRhdGEpKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICAvKipcbiAgICogUGF0Y2hlcyB0aGUgY3VycmVudCBvYmplY3QuXG4gICAqL1xuICBwYXRjaChwYXRjaCkge1xuICAgIGNvbnN0IG9sZERhdGEgPSB0aGlzLl9kYXRhO1xuICAgIGNvbnN0IG5ld0RhdGEgPSBtZXJnZShvbGREYXRhLCBwYXRjaCk7XG4gICAgaWYgKG9sZERhdGEgIT09IG5ld0RhdGEpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBmcmVlemUobmV3RGF0YSk7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNyYy9yZWZzL1ZhbHVlUmVmLnRzXG52YXIgVmFsdWVSZWYgPSBjbGFzcyBleHRlbmRzIEltbXV0YWJsZVJlZiB7XG4gIGNvbnN0cnVjdG9yKGluaXRpYWxWYWx1ZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fdmFsdWUgPSBmcmVlemUoaW5pdGlhbFZhbHVlKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIF90b0ltbXV0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cbiAgc2V0KG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5fdmFsdWUgPSBmcmVlemUobmV3VmFsdWUpO1xuICAgIHRoaXMuaW52YWxpZGF0ZSgpO1xuICB9XG59O1xudmFyIERlcml2ZWRSZWYgPSBjbGFzcyBleHRlbmRzIEltbXV0YWJsZVJlZiB7XG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICBzdXBlcigpO1xuICAgIGNvbnN0IHRyYW5zZm9ybUZuID0gYXJncy5wb3AoKTtcbiAgICBjb25zdCBvdGhlclJlZnMgPSBhcmdzO1xuICAgIHRoaXMuX3JlZnMgPSBvdGhlclJlZnM7XG4gICAgdGhpcy5fcmVmcy5mb3JFYWNoKChyZWYpID0+IHtcbiAgICAgIHJlZi5kaWRJbnZhbGlkYXRlLnN1YnNjcmliZSgoKSA9PiB0aGlzLmludmFsaWRhdGUoKSk7XG4gICAgfSk7XG4gICAgdGhpcy5fdHJhbnNmb3JtID0gdHJhbnNmb3JtRm47XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBfdG9JbW11dGFibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RyYW5zZm9ybShcbiAgICAgIC4uLnRoaXMuX3JlZnMubWFwKChyZWYpID0+IHJlZi5jdXJyZW50KVxuICAgICk7XG4gIH1cbn07XG5cbi8vIHNyYy9yb29tLnRzXG52YXIgTUFYX1NPQ0tFVF9NRVNTQUdFX1NJWkUgPSAxMDI0ICogMTAyNCAtIDEwMjQ7XG5mdW5jdGlvbiBtYWtlSWRGYWN0b3J5KGNvbm5lY3Rpb25JZCkge1xuICBsZXQgY291bnQgPSAwO1xuICByZXR1cm4gKCkgPT4gYCR7Y29ubmVjdGlvbklkfToke2NvdW50Kyt9YDtcbn1cbmZ1bmN0aW9uIHVzZXJUb1RyZWVOb2RlKGtleSwgdXNlcikge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiVXNlclwiLFxuICAgIGlkOiBgJHt1c2VyLmNvbm5lY3Rpb25JZH1gLFxuICAgIGtleSxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBjb25uZWN0aW9uSWQ6IHVzZXIuY29ubmVjdGlvbklkLFxuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICBpbmZvOiB1c2VyLmluZm8sXG4gICAgICBwcmVzZW5jZTogdXNlci5wcmVzZW5jZSxcbiAgICAgIGlzUmVhZE9ubHk6ICF1c2VyLmNhbldyaXRlXG4gICAgfVxuICB9O1xufVxuZnVuY3Rpb24gaW5zdGFsbEJhY2tncm91bmRUYWJTcHkoKSB7XG4gIGNvbnN0IGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGRvY3VtZW50IDogdm9pZCAwO1xuICBjb25zdCBpbkJhY2tncm91bmRTaW5jZSA9IHsgY3VycmVudDogbnVsbCB9O1xuICBmdW5jdGlvbiBvblZpc2liaWxpdHlDaGFuZ2UoKSB7XG4gICAgaWYgKGRvYz8udmlzaWJpbGl0eVN0YXRlID09PSBcImhpZGRlblwiKSB7XG4gICAgICBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ID0gaW5CYWNrZ3JvdW5kU2luY2UuY3VycmVudCA/PyBEYXRlLm5vdygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ID0gbnVsbDtcbiAgICB9XG4gIH1cbiAgZG9jPy5hZGRFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCBvblZpc2liaWxpdHlDaGFuZ2UpO1xuICBjb25zdCB1bnN1YiA9ICgpID0+IHtcbiAgICBkb2M/LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIG9uVmlzaWJpbGl0eUNoYW5nZSk7XG4gIH07XG4gIHJldHVybiBbaW5CYWNrZ3JvdW5kU2luY2UsIHVuc3ViXTtcbn1cbnZhciBDb21tZW50c0FwaUVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHN0YXR1cywgZGV0YWlscykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgdGhpcy5kZXRhaWxzID0gZGV0YWlscztcbiAgfVxufTtcbmZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnRzQXBpKHJvb21JZCwgZ2V0QXV0aFZhbHVlLCBmZXRjaENsaWVudEFwaSkge1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaENvbW1lbnRzQXBpKGVuZHBvaW50LCBwYXJhbXMsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBnZXRBdXRoVmFsdWUoKTtcbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkocm9vbUlkLCBlbmRwb2ludCwgYXV0aFZhbHVlLCBvcHRpb25zLCBwYXJhbXMpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGZldGNoSnNvbihlbmRwb2ludCwgb3B0aW9ucywgcGFyYW1zKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKGVuZHBvaW50LCBwYXJhbXMsIG9wdGlvbnMpO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gNDAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDYwMCkge1xuICAgICAgICBsZXQgZXJyb3IzO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGVycm9yQm9keSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBlcnJvcjMgPSBuZXcgQ29tbWVudHNBcGlFcnJvcihcbiAgICAgICAgICAgIGVycm9yQm9keS5tZXNzYWdlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgZXJyb3JCb2R5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IENvbW1lbnRzQXBpRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCwgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJvcjM7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBib2R5O1xuICAgIHRyeSB7XG4gICAgICBib2R5ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgYm9keSA9IHt9O1xuICAgIH1cbiAgICByZXR1cm4gYm9keTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBnZXRUaHJlYWRzU2luY2Uob3B0aW9ucykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hDb21tZW50c0FwaShcbiAgICAgIFwiL3RocmVhZHNcIixcbiAgICAgIHtcbiAgICAgICAgc2luY2U6IG9wdGlvbnM/LnNpbmNlPy50b0lTT1N0cmluZygpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgIHVwZGF0ZWQ6IGpzb24uZGF0YS5tYXAoY29udmVydFRvVGhyZWFkRGF0YSksXG4gICAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkVGhyZWFkcy5tYXAoY29udmVydFRvVGhyZWFkRGVsZXRlSW5mbylcbiAgICAgICAgfSxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiB7XG4gICAgICAgICAgdXBkYXRlZDoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YSksXG4gICAgICAgICAgZGVsZXRlZDoganNvbi5kZWxldGVkSW5ib3hOb3RpZmljYXRpb25zLm1hcChcbiAgICAgICAgICAgIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGVsZXRlSW5mb1xuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKGpzb24ubWV0YS5yZXF1ZXN0ZWRBdClcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGhyZWFkczoge1xuICAgICAgICAgIHVwZGF0ZWQ6IFtdLFxuICAgICAgICAgIGRlbGV0ZWQ6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uczoge1xuICAgICAgICAgIHVwZGF0ZWQ6IFtdLFxuICAgICAgICAgIGRlbGV0ZWQ6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVlc3RlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhyZWFkcy5cIik7XG4gICAgfVxuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGdldFRocmVhZHMob3B0aW9ucykge1xuICAgIGxldCBxdWVyeTtcbiAgICBpZiAob3B0aW9ucz8ucXVlcnkpIHtcbiAgICAgIHF1ZXJ5ID0gb2JqZWN0VG9RdWVyeShvcHRpb25zLnF1ZXJ5KTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKFxuICAgICAgXCIvdGhyZWFkc1wiLFxuICAgICAge1xuICAgICAgICBxdWVyeVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRocmVhZHM6IGpzb24uZGF0YS5tYXAoY29udmVydFRvVGhyZWFkRGF0YSksXG4gICAgICAgIGluYm94Tm90aWZpY2F0aW9uczoganNvbi5pbmJveE5vdGlmaWNhdGlvbnMubWFwKFxuICAgICAgICAgIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YVxuICAgICAgICApLFxuICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoanNvbi5tZXRhLnJlcXVlc3RlZEF0KVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWRzOiBbXSxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBbXSxcbiAgICAgICAgZGVsZXRlZFRocmVhZHM6IFtdLFxuICAgICAgICBkZWxldGVkSW5ib3hOb3RpZmljYXRpb25zOiBbXSxcbiAgICAgICAgcmVxdWVzdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aHJlYWRzLlwiKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0VGhyZWFkKHRocmVhZElkKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENvbW1lbnRzQXBpKFxuICAgICAgYC90aHJlYWQtd2l0aC1ub3RpZmljYXRpb24vJHt0aHJlYWRJZH1gXG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWQ6IGNvbnZlcnRUb1RocmVhZERhdGEoanNvbi50aHJlYWQpLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbjoganNvbi5pbmJveE5vdGlmaWNhdGlvbiA/IGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YShqc29uLmluYm94Tm90aWZpY2F0aW9uKSA6IHZvaWQgMFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aHJlYWQ6IHZvaWQgMCxcbiAgICAgICAgaW5ib3hOb3RpZmljYXRpb246IHZvaWQgMFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aHJlYWQgJHt0aHJlYWRJZH0uYCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRocmVhZCh7XG4gICAgbWV0YWRhdGEsXG4gICAgYm9keSxcbiAgICBjb21tZW50SWQgPSBjcmVhdGVDb21tZW50SWQoKSxcbiAgICB0aHJlYWRJZCA9IGNyZWF0ZVRocmVhZElkKClcbiAgfSkge1xuICAgIGNvbnN0IHRocmVhZCA9IGF3YWl0IGZldGNoSnNvbihcIi90aHJlYWRzXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBpZDogdGhyZWFkSWQsXG4gICAgICAgIGNvbW1lbnQ6IHtcbiAgICAgICAgICBpZDogY29tbWVudElkLFxuICAgICAgICAgIGJvZHlcbiAgICAgICAgfSxcbiAgICAgICAgbWV0YWRhdGFcbiAgICAgIH0pXG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb1RocmVhZERhdGEodGhyZWFkKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBkZWxldGVUaHJlYWQodGhyZWFkSWQpIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCJcbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBlZGl0VGhyZWFkTWV0YWRhdGEoe1xuICAgIG1ldGFkYXRhLFxuICAgIHRocmVhZElkXG4gIH0pIHtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vbWV0YWRhdGFgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEpXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrVGhyZWFkQXNSZXNvbHZlZCh0aHJlYWRJZCkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L21hcmstYXMtcmVzb2x2ZWRgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBtYXJrVGhyZWFkQXNVbnJlc29sdmVkKHRocmVhZElkKSB7XG4gICAgYXdhaXQgZmV0Y2hKc29uKFxuICAgICAgYC90aHJlYWRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRocmVhZElkKX0vbWFyay1hcy11bnJlc29sdmVkYCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIlxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29tbWVudCh7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkID0gY3JlYXRlQ29tbWVudElkKCksXG4gICAgYm9keVxuICB9KSB7XG4gICAgY29uc3QgY29tbWVudCA9IGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzYCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBpZDogY29tbWVudElkLFxuICAgICAgICAgIGJvZHlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBjb252ZXJ0VG9Db21tZW50RGF0YShjb21tZW50KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBlZGl0Q29tbWVudCh7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkLFxuICAgIGJvZHlcbiAgfSkge1xuICAgIGNvbnN0IGNvbW1lbnQgPSBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9jb21tZW50cy8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgY29tbWVudElkXG4gICAgICApfWAsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgYm9keVxuICAgICAgICB9KVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnREYXRhKGNvbW1lbnQpO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQyKHtcbiAgICB0aHJlYWRJZCxcbiAgICBjb21tZW50SWRcbiAgfSkge1xuICAgIGF3YWl0IGZldGNoSnNvbihcbiAgICAgIGAvdGhyZWFkcy8ke2VuY29kZVVSSUNvbXBvbmVudCh0aHJlYWRJZCl9L2NvbW1lbnRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICBjb21tZW50SWRcbiAgICAgICl9YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBhZGRSZWFjdGlvbjIoe1xuICAgIHRocmVhZElkLFxuICAgIGNvbW1lbnRJZCxcbiAgICBlbW9qaVxuICB9KSB7XG4gICAgY29uc3QgcmVhY3Rpb24gPSBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9jb21tZW50cy8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgY29tbWVudElkXG4gICAgICApfS9yZWFjdGlvbnNgLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlbW9qaSB9KVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnRVc2VyUmVhY3Rpb24ocmVhY3Rpb24pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHJlbW92ZVJlYWN0aW9uMih7XG4gICAgdGhyZWFkSWQsXG4gICAgY29tbWVudElkLFxuICAgIGVtb2ppXG4gIH0pIHtcbiAgICBhd2FpdCBmZXRjaEpzb24oXG4gICAgICBgL3RocmVhZHMvJHtlbmNvZGVVUklDb21wb25lbnQodGhyZWFkSWQpfS9jb21tZW50cy8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgY29tbWVudElkXG4gICAgICApfS9yZWFjdGlvbnMvJHtlbmNvZGVVUklDb21wb25lbnQoZW1vamkpfWAsXG4gICAgICB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBnZXRUaHJlYWRzLFxuICAgIGdldFRocmVhZHNTaW5jZSxcbiAgICBnZXRUaHJlYWQsXG4gICAgY3JlYXRlVGhyZWFkLFxuICAgIGRlbGV0ZVRocmVhZCxcbiAgICBlZGl0VGhyZWFkTWV0YWRhdGEsXG4gICAgbWFya1RocmVhZEFzUmVzb2x2ZWQsXG4gICAgbWFya1RocmVhZEFzVW5yZXNvbHZlZCxcbiAgICBjcmVhdGVDb21tZW50LFxuICAgIGVkaXRDb21tZW50LFxuICAgIGRlbGV0ZUNvbW1lbnQ6IGRlbGV0ZUNvbW1lbnQyLFxuICAgIGFkZFJlYWN0aW9uOiBhZGRSZWFjdGlvbjIsXG4gICAgcmVtb3ZlUmVhY3Rpb246IHJlbW92ZVJlYWN0aW9uMlxuICB9O1xufVxudmFyIE1BUktfSU5CT1hfTk9USUZJQ0FUSU9OU19BU19SRUFEX0JBVENIX0RFTEFZMiA9IDUwO1xuZnVuY3Rpb24gY3JlYXRlUm9vbShvcHRpb25zLCBjb25maWcpIHtcbiAgY29uc3QgaW5pdGlhbFByZXNlbmNlID0gb3B0aW9ucy5pbml0aWFsUHJlc2VuY2U7XG4gIGNvbnN0IGluaXRpYWxTdG9yYWdlID0gb3B0aW9ucy5pbml0aWFsU3RvcmFnZTtcbiAgY29uc3QgW2luQmFja2dyb3VuZFNpbmNlLCB1bmluc3RhbGxCZ1RhYlNweV0gPSBpbnN0YWxsQmFja2dyb3VuZFRhYlNweSgpO1xuICBjb25zdCBkZWxlZ2F0ZXMgPSB7XG4gICAgLi4uY29uZmlnLmRlbGVnYXRlcyxcbiAgICAvLyBBIGNvbm5lY3Rpb24gaXMgYWxsb3dlZCB0byBnbyBpbnRvIFwiem9tYmllIHN0YXRlXCIgb25seSBpZiBhbGwgb2YgdGhlXG4gICAgLy8gZm9sbG93aW5nIGNvbmRpdGlvbnMgYXBwbHk6XG4gICAgLy9cbiAgICAvLyAtIFRoZSBgYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXRgIGNsaWVudCBvcHRpb24gaXMgY29uZmlndXJlZFxuICAgIC8vIC0gVGhlIGJyb3dzZXIgd2luZG93IGhhcyBiZWVuIGluIHRoZSBiYWNrZ3JvdW5kIGZvciBhdCBsZWFzdFxuICAgIC8vICAgYGJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0YCBtaWxsaXNlY29uZHNcbiAgICAvLyAtIFRoZXJlIGFyZSBubyBwZW5kaW5nIGNoYW5nZXNcbiAgICAvL1xuICAgIGNhblpvbWJpZSgpIHtcbiAgICAgIHJldHVybiBjb25maWcuYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQgIT09IHZvaWQgMCAmJiBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ICE9PSBudWxsICYmIERhdGUubm93KCkgPiBpbkJhY2tncm91bmRTaW5jZS5jdXJyZW50ICsgY29uZmlnLmJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0ICYmIGdldFN0b3JhZ2VTdGF0dXMoKSAhPT0gXCJzeW5jaHJvbml6aW5nXCI7XG4gICAgfVxuICB9O1xuICBjb25zdCBtYW5hZ2VkU29ja2V0ID0gbmV3IE1hbmFnZWRTb2NrZXQoXG4gICAgZGVsZWdhdGVzLFxuICAgIGNvbmZpZy5lbmFibGVEZWJ1Z0xvZ2dpbmdcbiAgKTtcbiAgY29uc3QgY29udGV4dCA9IHtcbiAgICBidWZmZXI6IHtcbiAgICAgIGZsdXNoVGltZXJJRDogdm9pZCAwLFxuICAgICAgbGFzdEZsdXNoZWRBdDogMCxcbiAgICAgIHByZXNlbmNlVXBkYXRlczogKFxuICAgICAgICAvLyBRdWV1ZSB1cCB0aGUgaW5pdGlhbCBwcmVzZW5jZSBtZXNzYWdlIGFzIGEgRnVsbCBQcmVzZW5jZeKEoiB1cGRhdGVcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IFwiZnVsbFwiLFxuICAgICAgICAgIGRhdGE6IGluaXRpYWxQcmVzZW5jZVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgbWVzc2FnZXM6IFtdLFxuICAgICAgc3RvcmFnZU9wZXJhdGlvbnM6IFtdXG4gICAgfSxcbiAgICBzdGF0aWNTZXNzaW9uSW5mbzogbmV3IFZhbHVlUmVmKG51bGwpLFxuICAgIGR5bmFtaWNTZXNzaW9uSW5mbzogbmV3IFZhbHVlUmVmKG51bGwpLFxuICAgIG15UHJlc2VuY2U6IG5ldyBQYXRjaGFibGVSZWYoaW5pdGlhbFByZXNlbmNlKSxcbiAgICBvdGhlcnM6IG5ldyBPdGhlcnNSZWYoKSxcbiAgICBpbml0aWFsU3RvcmFnZSxcbiAgICBpZEZhY3Rvcnk6IG51bGwsXG4gICAgLy8gU3RvcmFnZVxuICAgIGNsb2NrOiAwLFxuICAgIG9wQ2xvY2s6IDAsXG4gICAgbm9kZXM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksXG4gICAgcm9vdDogdm9pZCAwLFxuICAgIHVuZG9TdGFjazogW10sXG4gICAgcmVkb1N0YWNrOiBbXSxcbiAgICBwYXVzZWRIaXN0b3J5OiBudWxsLFxuICAgIGFjdGl2ZUJhdGNoOiBudWxsLFxuICAgIHVuYWNrbm93bGVkZ2VkT3BzOiAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLFxuICAgIC8vIERlYnVnXG4gICAgb3BTdGFja1RyYWNlczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiID8gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSA6IHZvaWQgMFxuICB9O1xuICBjb25zdCBkb05vdEJhdGNoVXBkYXRlcyA9IChjYikgPT4gY2IoKTtcbiAgY29uc3QgYmF0Y2hVcGRhdGVzID0gY29uZmlnLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzID8/IGRvTm90QmF0Y2hVcGRhdGVzO1xuICBsZXQgbGFzdFRva2VuS2V5O1xuICBmdW5jdGlvbiBvblN0YXR1c0RpZENoYW5nZShuZXdTdGF0dXMpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBtYW5hZ2VkU29ja2V0LmF1dGhWYWx1ZTtcbiAgICBpZiAoYXV0aFZhbHVlICE9PSBudWxsKSB7XG4gICAgICBjb25zdCB0b2tlbktleSA9IGdldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSk7XG4gICAgICBpZiAodG9rZW5LZXkgIT09IGxhc3RUb2tlbktleSkge1xuICAgICAgICBsYXN0VG9rZW5LZXkgPSB0b2tlbktleTtcbiAgICAgICAgaWYgKGF1dGhWYWx1ZS50eXBlID09PSBcInNlY3JldFwiKSB7XG4gICAgICAgICAgY29uc3QgdG9rZW4gPSBhdXRoVmFsdWUudG9rZW4ucGFyc2VkO1xuICAgICAgICAgIGNvbnRleHQuc3RhdGljU2Vzc2lvbkluZm8uc2V0KHtcbiAgICAgICAgICAgIHVzZXJJZDogdG9rZW4uayA9PT0gXCJzZWMtbGVnYWN5XCIgLyogU0VDUkVUX0xFR0FDWSAqLyA/IHRva2VuLmlkIDogdG9rZW4udWlkLFxuICAgICAgICAgICAgdXNlckluZm86IHRva2VuLmsgPT09IFwic2VjLWxlZ2FjeVwiIC8qIFNFQ1JFVF9MRUdBQ1kgKi8gPyB0b2tlbi5pbmZvIDogdG9rZW4udWlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb250ZXh0LnN0YXRpY1Nlc3Npb25JbmZvLnNldCh7XG4gICAgICAgICAgICB1c2VySWQ6IHZvaWQgMCxcbiAgICAgICAgICAgIHVzZXJJbmZvOiB2b2lkIDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgZXZlbnRIdWIuc3RhdHVzLm5vdGlmeShuZXdTdGF0dXMpO1xuICAgICAgbm90aWZ5U2VsZkNoYW5nZWQoZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgIH0pO1xuICB9XG4gIGxldCBfY29ubmVjdGlvbkxvc3NUaW1lcklkO1xuICBsZXQgX2hhc0xvc3RDb25uZWN0aW9uID0gZmFsc2U7XG4gIGZ1bmN0aW9uIGhhbmRsZUNvbm5lY3Rpb25Mb3NzRXZlbnQobmV3U3RhdHVzKSB7XG4gICAgaWYgKG5ld1N0YXR1cyA9PT0gXCJyZWNvbm5lY3RpbmdcIikge1xuICAgICAgX2Nvbm5lY3Rpb25Mb3NzVGltZXJJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgICAgIGV2ZW50SHViLmxvc3RDb25uZWN0aW9uLm5vdGlmeShcImxvc3RcIik7XG4gICAgICAgICAgX2hhc0xvc3RDb25uZWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgICBjb250ZXh0Lm90aGVycy5jbGVhck90aGVycygpO1xuICAgICAgICAgIG5vdGlmeSh7IG90aGVyczogW3sgdHlwZTogXCJyZXNldFwiIH1dIH0sIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBjb25maWcubG9zdENvbm5lY3Rpb25UaW1lb3V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2xlYXJUaW1lb3V0KF9jb25uZWN0aW9uTG9zc1RpbWVySWQpO1xuICAgICAgaWYgKF9oYXNMb3N0Q29ubmVjdGlvbikge1xuICAgICAgICBpZiAobmV3U3RhdHVzID09PSBcImRpc2Nvbm5lY3RlZFwiKSB7XG4gICAgICAgICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgICAgICAgIGV2ZW50SHViLmxvc3RDb25uZWN0aW9uLm5vdGlmeShcImZhaWxlZFwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgICAgICAgZXZlbnRIdWIubG9zdENvbm5lY3Rpb24ubm90aWZ5KFwicmVzdG9yZWRcIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgX2hhc0xvc3RDb25uZWN0aW9uID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIG9uRGlkQ29ubmVjdCgpIHtcbiAgICBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPSB7XG4gICAgICB0eXBlOiBcImZ1bGxcIixcbiAgICAgIGRhdGE6IChcbiAgICAgICAgLy8gQmVjYXVzZSBjb250ZXh0Lm1lLmN1cnJlbnQgaXMgYSByZWFkb25seSBvYmplY3QsIHdlJ2xsIGhhdmUgdG9cbiAgICAgICAgLy8gbWFrZSBhIGNvcHkgaGVyZS4gT3RoZXJ3aXNlLCB0eXBlIGVycm9ycyBoYXBwZW4gbGF0ZXIgd2hlblxuICAgICAgICAvLyBcInBhdGNoaW5nXCIgbXkgcHJlc2VuY2UuXG4gICAgICAgIHsgLi4uY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnQgfVxuICAgICAgKVxuICAgIH07XG4gICAgaWYgKF9nZXRTdG9yYWdlJCAhPT0gbnVsbCkge1xuICAgICAgcmVmcmVzaFN0b3JhZ2UoeyBmbHVzaDogZmFsc2UgfSk7XG4gICAgfVxuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gb25EaWREaXNjb25uZWN0KCkge1xuICAgIGNsZWFyVGltZW91dChjb250ZXh0LmJ1ZmZlci5mbHVzaFRpbWVySUQpO1xuICB9XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLm9uTWVzc2FnZS5zdWJzY3JpYmUoaGFuZGxlU2VydmVyTWVzc2FnZSk7XG4gIG1hbmFnZWRTb2NrZXQuZXZlbnRzLnN0YXR1c0RpZENoYW5nZS5zdWJzY3JpYmUob25TdGF0dXNEaWRDaGFuZ2UpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5zdGF0dXNEaWRDaGFuZ2Uuc3Vic2NyaWJlKGhhbmRsZUNvbm5lY3Rpb25Mb3NzRXZlbnQpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5kaWRDb25uZWN0LnN1YnNjcmliZShvbkRpZENvbm5lY3QpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5kaWREaXNjb25uZWN0LnN1YnNjcmliZShvbkRpZERpc2Nvbm5lY3QpO1xuICBtYW5hZ2VkU29ja2V0LmV2ZW50cy5vbkxpdmVibG9ja3NFcnJvci5zdWJzY3JpYmUoKGVycikgPT4ge1xuICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgIGVycm9yMihcbiAgICAgICAgICBgQ29ubmVjdGlvbiB0byB3ZWJzb2NrZXQgc2VydmVyIGNsb3NlZC4gUmVhc29uOiAke2Vyci5tZXNzYWdlfSAoY29kZTogJHtlcnIuY29kZX0pLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGV2ZW50SHViLmVycm9yLm5vdGlmeShlcnIpO1xuICAgIH0pO1xuICB9KTtcbiAgY29uc3QgcG9vbCA9IHtcbiAgICByb29tSWQ6IGNvbmZpZy5yb29tSWQsXG4gICAgZ2V0Tm9kZTogKGlkKSA9PiBjb250ZXh0Lm5vZGVzLmdldChpZCksXG4gICAgYWRkTm9kZTogKGlkLCBub2RlKSA9PiB2b2lkIGNvbnRleHQubm9kZXMuc2V0KGlkLCBub2RlKSxcbiAgICBkZWxldGVOb2RlOiAoaWQpID0+IHZvaWQgY29udGV4dC5ub2Rlcy5kZWxldGUoaWQpLFxuICAgIGdlbmVyYXRlSWQ6ICgpID0+IGAke2dldENvbm5lY3Rpb25JZCgpfToke2NvbnRleHQuY2xvY2srK31gLFxuICAgIGdlbmVyYXRlT3BJZDogKCkgPT4gYCR7Z2V0Q29ubmVjdGlvbklkKCl9OiR7Y29udGV4dC5vcENsb2NrKyt9YCxcbiAgICBkaXNwYXRjaChvcHMsIHJldmVyc2UsIHN0b3JhZ2VVcGRhdGVzKSB7XG4gICAgICBjb25zdCBhY3RpdmVCYXRjaCA9IGNvbnRleHQuYWN0aXZlQmF0Y2g7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrVHJhY2UgPSBjYXB0dXJlU3RhY2tUcmFjZShcIlN0b3JhZ2UgbXV0YXRpb25cIiwgdGhpcy5kaXNwYXRjaCk7XG4gICAgICAgIGlmIChzdGFja1RyYWNlKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgICAgICAgIGlmIChvcC5vcElkKSB7XG4gICAgICAgICAgICAgIG5uKGNvbnRleHQub3BTdGFja1RyYWNlcykuc2V0KG9wLm9wSWQsIHN0YWNrVHJhY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGFjdGl2ZUJhdGNoKSB7XG4gICAgICAgIGZvciAoY29uc3Qgb3Agb2Ygb3BzKSB7XG4gICAgICAgICAgYWN0aXZlQmF0Y2gub3BzLnB1c2gob3ApO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHN0b3JhZ2VVcGRhdGVzKSB7XG4gICAgICAgICAgYWN0aXZlQmF0Y2gudXBkYXRlcy5zdG9yYWdlVXBkYXRlcy5zZXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBtZXJnZVN0b3JhZ2VVcGRhdGVzKFxuICAgICAgICAgICAgICBhY3RpdmVCYXRjaC51cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLmdldChrZXkpLFxuICAgICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgYWN0aXZlQmF0Y2gucmV2ZXJzZU9wcy51bnNoaWZ0KC4uLnJldmVyc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgICAgICBhZGRUb1VuZG9TdGFjayhyZXZlcnNlLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICAgICAgY29udGV4dC5yZWRvU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgICBkaXNwYXRjaE9wcyhvcHMpO1xuICAgICAgICAgIG5vdGlmeSh7IHN0b3JhZ2VVcGRhdGVzIH0sIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBhc3NlcnRTdG9yYWdlSXNXcml0YWJsZTogKCkgPT4ge1xuICAgICAgY29uc3Qgc2NvcGVzID0gY29udGV4dC5keW5hbWljU2Vzc2lvbkluZm8uY3VycmVudD8uc2NvcGVzO1xuICAgICAgaWYgKHNjb3BlcyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNhbldyaXRlID0gY2FuV3JpdGVTdG9yYWdlKHNjb3Blcyk7XG4gICAgICBpZiAoIWNhbldyaXRlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkNhbm5vdCB3cml0ZSB0byBzdG9yYWdlIHdpdGggYSByZWFkIG9ubHkgdXNlciwgcGxlYXNlIGVuc3VyZSB0aGUgdXNlciBoYXMgd3JpdGUgcGVybWlzc2lvbnNcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgZXZlbnRIdWIgPSB7XG4gICAgc3RhdHVzOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICAvLyBOZXcvcmVjb21tZW5kZWQgQVBJXG4gICAgbG9zdENvbm5lY3Rpb246IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGN1c3RvbUV2ZW50OiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBzZWxmOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBteVByZXNlbmNlOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBvdGhlcnM6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGVycm9yOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBzdG9yYWdlQmF0Y2g6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIGhpc3Rvcnk6IG1ha2VFdmVudFNvdXJjZSgpLFxuICAgIHN0b3JhZ2VEaWRMb2FkOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBzdG9yYWdlU3RhdHVzOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICB5ZG9jOiBtYWtlRXZlbnRTb3VyY2UoKSxcbiAgICBjb21tZW50czogbWFrZUV2ZW50U291cmNlKClcbiAgfTtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hDbGllbnRBcGkocm9vbUlkLCBlbmRwb2ludCwgYXV0aFZhbHVlLCBvcHRpb25zMiwgcGFyYW1zKSB7XG4gICAgY29uc3QgdXJsID0gdXJsam9pbihcbiAgICAgIGNvbmZpZy5iYXNlVXJsLFxuICAgICAgYC92Mi9jL3Jvb21zLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHJvb21JZCl9JHtlbmRwb2ludH1gLFxuICAgICAgcGFyYW1zXG4gICAgKTtcbiAgICBjb25zdCBmZXRjaGVyID0gY29uZmlnLnBvbHlmaWxscz8uZmV0Y2ggfHwgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBmZXRjaDtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2hlcih1cmwsIHtcbiAgICAgIC4uLm9wdGlvbnMyLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAuLi5vcHRpb25zMj8uaGVhZGVycyxcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2dldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSl9YFxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHN0cmVhbUZldGNoKGF1dGhWYWx1ZSwgcm9vbUlkKSB7XG4gICAgcmV0dXJuIGZldGNoQ2xpZW50QXBpKHJvb21JZCwgXCIvc3RvcmFnZVwiLCBhdXRoVmFsdWUsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiBodHRwUG9zdFRvUm9vbShlbmRwb2ludCwgYm9keSkge1xuICAgIGlmICghbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhdXRob3JpemVkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkoY29uZmlnLnJvb21JZCwgZW5kcG9pbnQsIG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGV4dE1lbnRpb24odXNlcklkLCBtZW50aW9uSWQpIHtcbiAgICBpZiAoIW1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgYXV0aG9yaXplZFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZldGNoQ2xpZW50QXBpKFxuICAgICAgY29uZmlnLnJvb21JZCxcbiAgICAgIFwiL3RleHQtbWVudGlvbnNcIixcbiAgICAgIG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLFxuICAgICAge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBtZW50aW9uSWRcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRleHRNZW50aW9uKG1lbnRpb25JZCkge1xuICAgIGlmICghbWFuYWdlZFNvY2tldC5hdXRoVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhdXRob3JpemVkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZmV0Y2hDbGllbnRBcGkoXG4gICAgICBjb25maWcucm9vbUlkLFxuICAgICAgYC90ZXh0LW1lbnRpb25zLyR7bWVudGlvbklkfWAsXG4gICAgICBtYW5hZ2VkU29ja2V0LmF1dGhWYWx1ZSxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiByZXBvcnRUZXh0RWRpdG9yKHR5cGUsIHJvb3RLZXkpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBkZWxlZ2F0ZXMuYXV0aGVudGljYXRlKCk7XG4gICAgcmV0dXJuIGZldGNoQ2xpZW50QXBpKGNvbmZpZy5yb29tSWQsIFwiL3RleHQtbWV0YWRhdGFcIiwgYXV0aFZhbHVlLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcm9vdEtleVxuICAgICAgfSlcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBzZW5kTWVzc2FnZXMobWVzc2FnZXMpIHtcbiAgICBjb25zdCBzZXJpYWxpemVkUGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VzKTtcbiAgICBjb25zdCBub25jZSA9IGNvbnRleHQuZHluYW1pY1Nlc3Npb25JbmZvLmN1cnJlbnQ/Lm5vbmNlO1xuICAgIGlmIChjb25maWcudW5zdGFibGVfZmFsbGJhY2tUb0hUVFAgJiYgbm9uY2UpIHtcbiAgICAgIGNvbnN0IHNpemUgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc2VyaWFsaXplZFBheWxvYWQpLmxlbmd0aDtcbiAgICAgIGlmIChzaXplID4gTUFYX1NPQ0tFVF9NRVNTQUdFX1NJWkUpIHtcbiAgICAgICAgdm9pZCBodHRwUG9zdFRvUm9vbShcIi9zZW5kLW1lc3NhZ2VcIiwgeyBub25jZSwgbWVzc2FnZXMgfSkudGhlbihcbiAgICAgICAgICAocmVzcCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFyZXNwLm9rICYmIHJlc3Auc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgICAgICAgbWFuYWdlZFNvY2tldC5yZWNvbm5lY3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHdhcm4oXG4gICAgICAgICAgXCJNZXNzYWdlIHdhcyB0b28gbGFyZ2UgZm9yIHdlYnNvY2tldHMgYW5kIHNlbnQgb3ZlciBIVFRQIGluc3RlYWRcIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIG1hbmFnZWRTb2NrZXQuc2VuZChzZXJpYWxpemVkUGF5bG9hZCk7XG4gIH1cbiAgY29uc3Qgc2VsZiA9IG5ldyBEZXJpdmVkUmVmKFxuICAgIGNvbnRleHQuc3RhdGljU2Vzc2lvbkluZm8sXG4gICAgY29udGV4dC5keW5hbWljU2Vzc2lvbkluZm8sXG4gICAgY29udGV4dC5teVByZXNlbmNlLFxuICAgIChzdGF0aWNTZXNzaW9uLCBkeW5hbWljU2Vzc2lvbiwgbXlQcmVzZW5jZSkgPT4ge1xuICAgICAgaWYgKHN0YXRpY1Nlc3Npb24gPT09IG51bGwgfHwgZHluYW1pY1Nlc3Npb24gPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjYW5Xcml0ZSA9IGNhbldyaXRlU3RvcmFnZShkeW5hbWljU2Vzc2lvbi5zY29wZXMpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvbm5lY3Rpb25JZDogZHluYW1pY1Nlc3Npb24uYWN0b3IsXG4gICAgICAgICAgaWQ6IHN0YXRpY1Nlc3Npb24udXNlcklkLFxuICAgICAgICAgIGluZm86IHN0YXRpY1Nlc3Npb24udXNlckluZm8sXG4gICAgICAgICAgcHJlc2VuY2U6IG15UHJlc2VuY2UsXG4gICAgICAgICAgY2FuV3JpdGUsXG4gICAgICAgICAgY2FuQ29tbWVudDogY2FuQ29tbWVudChkeW5hbWljU2Vzc2lvbi5zY29wZXMpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICApO1xuICBsZXQgX2xhc3RTZWxmO1xuICBmdW5jdGlvbiBub3RpZnlTZWxmQ2hhbmdlZChiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBjb25zdCBjdXJyU2VsZiA9IHNlbGYuY3VycmVudDtcbiAgICBpZiAoY3VyclNlbGYgIT09IG51bGwgJiYgY3VyclNlbGYgIT09IF9sYXN0U2VsZikge1xuICAgICAgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKCgpID0+IHtcbiAgICAgICAgZXZlbnRIdWIuc2VsZi5ub3RpZnkoY3VyclNlbGYpO1xuICAgICAgfSk7XG4gICAgICBfbGFzdFNlbGYgPSBjdXJyU2VsZjtcbiAgICB9XG4gIH1cbiAgY29uc3Qgc2VsZkFzVHJlZU5vZGUgPSBuZXcgRGVyaXZlZFJlZihcbiAgICBzZWxmLFxuICAgIChtZSkgPT4gbWUgIT09IG51bGwgPyB1c2VyVG9UcmVlTm9kZShcIk1lXCIsIG1lKSA6IG51bGxcbiAgKTtcbiAgZnVuY3Rpb24gY3JlYXRlT3JVcGRhdGVSb290RnJvbU1lc3NhZ2UobWVzc2FnZSwgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgaWYgKG1lc3NhZ2UuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnRlcm5hbCBlcnJvcjogY2Fubm90IGxvYWQgc3RvcmFnZSB3aXRob3V0IGl0ZW1zXCIpO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5yb290ICE9PSB2b2lkIDApIHtcbiAgICAgIHVwZGF0ZVJvb3QobWVzc2FnZS5pdGVtcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGV4dC5yb290ID0gTGl2ZU9iamVjdC5fZnJvbUl0ZW1zKG1lc3NhZ2UuaXRlbXMsIHBvb2wpO1xuICAgIH1cbiAgICBjb25zdCBjYW5Xcml0ZSA9IHNlbGYuY3VycmVudD8uY2FuV3JpdGUgPz8gdHJ1ZTtcbiAgICBjb25zdCBzdGFja1NpemVCZWZvcmUgPSBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGg7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gY29udGV4dC5pbml0aWFsU3RvcmFnZSkge1xuICAgICAgaWYgKGNvbnRleHQucm9vdC5nZXQoa2V5KSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGlmIChjYW5Xcml0ZSkge1xuICAgICAgICAgIGNvbnRleHQucm9vdC5zZXQoa2V5LCBjbG9uZUxzb24oY29udGV4dC5pbml0aWFsU3RvcmFnZVtrZXldKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2FybihcbiAgICAgICAgICAgIGBBdHRlbXB0ZWQgdG8gcG9wdWxhdGUgbWlzc2luZyBzdG9yYWdlIGtleSAnJHtrZXl9JywgYnV0IGN1cnJlbnQgdXNlciBoYXMgbm8gd3JpdGUgYWNjZXNzYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY29udGV4dC51bmRvU3RhY2subGVuZ3RoID0gc3RhY2tTaXplQmVmb3JlO1xuICB9XG4gIGZ1bmN0aW9uIHVwZGF0ZVJvb3QoaXRlbXMsIGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGlmIChjb250ZXh0LnJvb3QgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50SXRlbXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGZvciAoY29uc3QgW2lkLCBub2RlXSBvZiBjb250ZXh0Lm5vZGVzKSB7XG4gICAgICBjdXJyZW50SXRlbXMuc2V0KGlkLCBub2RlLl9zZXJpYWxpemUoKSk7XG4gICAgfVxuICAgIGNvbnN0IG9wcyA9IGdldFRyZWVzRGlmZk9wZXJhdGlvbnMoY3VycmVudEl0ZW1zLCBuZXcgTWFwKGl0ZW1zKSk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXBwbHlPcHMob3BzLCBmYWxzZSk7XG4gICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICB9XG4gIGZ1bmN0aW9uIF9hZGRUb1JlYWxVbmRvU3RhY2soaGlzdG9yeU9wcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgaWYgKGNvbnRleHQudW5kb1N0YWNrLmxlbmd0aCA+PSA1MCkge1xuICAgICAgY29udGV4dC51bmRvU3RhY2suc2hpZnQoKTtcbiAgICB9XG4gICAgY29udGV4dC51bmRvU3RhY2sucHVzaChoaXN0b3J5T3BzKTtcbiAgICBvbkhpc3RvcnlDaGFuZ2UoYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKTtcbiAgfVxuICBmdW5jdGlvbiBhZGRUb1VuZG9TdGFjayhoaXN0b3J5T3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBpZiAoY29udGV4dC5wYXVzZWRIaXN0b3J5ICE9PSBudWxsKSB7XG4gICAgICBjb250ZXh0LnBhdXNlZEhpc3RvcnkudW5zaGlmdCguLi5oaXN0b3J5T3BzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX2FkZFRvUmVhbFVuZG9TdGFjayhoaXN0b3J5T3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBub3RpZnkodXBkYXRlcywgYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKSB7XG4gICAgY29uc3Qgc3RvcmFnZVVwZGF0ZXMgPSB1cGRhdGVzLnN0b3JhZ2VVcGRhdGVzO1xuICAgIGNvbnN0IG90aGVyc1VwZGF0ZXMgPSB1cGRhdGVzLm90aGVycztcbiAgICBiYXRjaGVkVXBkYXRlc1dyYXBwZXIoKCkgPT4ge1xuICAgICAgaWYgKG90aGVyc1VwZGF0ZXMgIT09IHZvaWQgMCAmJiBvdGhlcnNVcGRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgb3RoZXJzID0gY29udGV4dC5vdGhlcnMuY3VycmVudDtcbiAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiBvdGhlcnNVcGRhdGVzKSB7XG4gICAgICAgICAgZXZlbnRIdWIub3RoZXJzLm5vdGlmeSh7IC4uLmV2ZW50LCBvdGhlcnMgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh1cGRhdGVzLnByZXNlbmNlID8/IGZhbHNlKSB7XG4gICAgICAgIG5vdGlmeVNlbGZDaGFuZ2VkKGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgZXZlbnRIdWIubXlQcmVzZW5jZS5ub3RpZnkoY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnQpO1xuICAgICAgfVxuICAgICAgaWYgKHN0b3JhZ2VVcGRhdGVzICE9PSB2b2lkIDAgJiYgc3RvcmFnZVVwZGF0ZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgY29uc3QgdXBkYXRlczIgPSBBcnJheS5mcm9tKHN0b3JhZ2VVcGRhdGVzLnZhbHVlcygpKTtcbiAgICAgICAgZXZlbnRIdWIuc3RvcmFnZUJhdGNoLm5vdGlmeSh1cGRhdGVzMik7XG4gICAgICB9XG4gICAgICBub3RpZnlTdG9yYWdlU3RhdHVzKCk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0Q29ubmVjdGlvbklkKCkge1xuICAgIGNvbnN0IGluZm8gPSBjb250ZXh0LmR5bmFtaWNTZXNzaW9uSW5mby5jdXJyZW50O1xuICAgIGlmIChpbmZvKSB7XG4gICAgICByZXR1cm4gaW5mby5hY3RvcjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJJbnRlcm5hbC4gVHJpZWQgdG8gZ2V0IGNvbm5lY3Rpb24gaWQgYnV0IGNvbm5lY3Rpb24gd2FzIG5ldmVyIG9wZW5cIlxuICAgICk7XG4gIH1cbiAgZnVuY3Rpb24gYXBwbHlPcHMocmF3T3BzLCBpc0xvY2FsKSB7XG4gICAgY29uc3Qgb3V0cHV0ID0ge1xuICAgICAgcmV2ZXJzZTogW10sXG4gICAgICBzdG9yYWdlVXBkYXRlczogLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSxcbiAgICAgIHByZXNlbmNlOiBmYWxzZVxuICAgIH07XG4gICAgY29uc3QgY3JlYXRlZE5vZGVJZHMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICAgIGNvbnN0IG9wcyA9IHJhd09wcy5tYXAoKG9wKSA9PiB7XG4gICAgICBpZiAob3AudHlwZSAhPT0gXCJwcmVzZW5jZVwiICYmICFvcC5vcElkKSB7XG4gICAgICAgIHJldHVybiB7IC4uLm9wLCBvcElkOiBwb29sLmdlbmVyYXRlT3BJZCgpIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gb3A7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgIGlmIChvcC50eXBlID09PSBcInByZXNlbmNlXCIpIHtcbiAgICAgICAgY29uc3QgcmV2ZXJzZSA9IHtcbiAgICAgICAgICB0eXBlOiBcInByZXNlbmNlXCIsXG4gICAgICAgICAgZGF0YToge31cbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gb3AuZGF0YSkge1xuICAgICAgICAgIHJldmVyc2UuZGF0YVtrZXldID0gY29udGV4dC5teVByZXNlbmNlLmN1cnJlbnRba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0Lm15UHJlc2VuY2UucGF0Y2gob3AuZGF0YSk7XG4gICAgICAgIGlmIChjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPT09IG51bGwpIHtcbiAgICAgICAgICBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPSB7IHR5cGU6IFwicGFydGlhbFwiLCBkYXRhOiBvcC5kYXRhIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gb3AuZGF0YSkge1xuICAgICAgICAgICAgY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzLmRhdGFba2V5XSA9IG9wLmRhdGFba2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgb3V0cHV0LnJldmVyc2UudW5zaGlmdChyZXZlcnNlKTtcbiAgICAgICAgb3V0cHV0LnByZXNlbmNlID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBzb3VyY2U7XG4gICAgICAgIGlmIChpc0xvY2FsKSB7XG4gICAgICAgICAgc291cmNlID0gMCAvKiBVTkRPUkVET19SRUNPTk5FQ1QgKi87XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3Qgb3BJZCA9IG5uKG9wLm9wSWQpO1xuICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgIG5uKGNvbnRleHQub3BTdGFja1RyYWNlcykuZGVsZXRlKG9wSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBkZWxldGVkID0gY29udGV4dC51bmFja25vd2xlZGdlZE9wcy5kZWxldGUob3BJZCk7XG4gICAgICAgICAgc291cmNlID0gZGVsZXRlZCA/IDIgLyogQUNLICovIDogMSAvKiBSRU1PVEUgKi87XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXBwbHlPcFJlc3VsdCA9IGFwcGx5T3Aob3AsIHNvdXJjZSk7XG4gICAgICAgIGlmIChhcHBseU9wUmVzdWx0Lm1vZGlmaWVkKSB7XG4gICAgICAgICAgY29uc3Qgbm9kZUlkID0gYXBwbHlPcFJlc3VsdC5tb2RpZmllZC5ub2RlLl9pZDtcbiAgICAgICAgICBpZiAoIShub2RlSWQgJiYgY3JlYXRlZE5vZGVJZHMuaGFzKG5vZGVJZCkpKSB7XG4gICAgICAgICAgICBvdXRwdXQuc3RvcmFnZVVwZGF0ZXMuc2V0KFxuICAgICAgICAgICAgICBubihhcHBseU9wUmVzdWx0Lm1vZGlmaWVkLm5vZGUuX2lkKSxcbiAgICAgICAgICAgICAgbWVyZ2VTdG9yYWdlVXBkYXRlcyhcbiAgICAgICAgICAgICAgICBvdXRwdXQuc3RvcmFnZVVwZGF0ZXMuZ2V0KG5uKGFwcGx5T3BSZXN1bHQubW9kaWZpZWQubm9kZS5faWQpKSxcbiAgICAgICAgICAgICAgICBhcHBseU9wUmVzdWx0Lm1vZGlmaWVkXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBvdXRwdXQucmV2ZXJzZS51bnNoaWZ0KC4uLmFwcGx5T3BSZXN1bHQucmV2ZXJzZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcC50eXBlID09PSAyIC8qIENSRUFURV9MSVNUICovIHx8IG9wLnR5cGUgPT09IDcgLyogQ1JFQVRFX01BUCAqLyB8fCBvcC50eXBlID09PSA0IC8qIENSRUFURV9PQkpFQ1QgKi8pIHtcbiAgICAgICAgICAgIGNyZWF0ZWROb2RlSWRzLmFkZChubihvcC5pZCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgb3BzLFxuICAgICAgcmV2ZXJzZTogb3V0cHV0LnJldmVyc2UsXG4gICAgICB1cGRhdGVzOiB7XG4gICAgICAgIHN0b3JhZ2VVcGRhdGVzOiBvdXRwdXQuc3RvcmFnZVVwZGF0ZXMsXG4gICAgICAgIHByZXNlbmNlOiBvdXRwdXQucHJlc2VuY2VcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGFwcGx5T3Aob3AsIHNvdXJjZSkge1xuICAgIGlmIChpc0Fja09wKG9wKSkge1xuICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgfVxuICAgIHN3aXRjaCAob3AudHlwZSkge1xuICAgICAgY2FzZSA2IC8qIERFTEVURV9PQkpFQ1RfS0VZICovOlxuICAgICAgY2FzZSAzIC8qIFVQREFURV9PQkpFQ1QgKi86XG4gICAgICBjYXNlIDUgLyogREVMRVRFX0NSRFQgKi86IHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGNvbnRleHQubm9kZXMuZ2V0KG9wLmlkKTtcbiAgICAgICAgaWYgKG5vZGUgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlLl9hcHBseShvcCwgc291cmNlID09PSAwIC8qIFVORE9SRURPX1JFQ09OTkVDVCAqLyk7XG4gICAgICB9XG4gICAgICBjYXNlIDEgLyogU0VUX1BBUkVOVF9LRVkgKi86IHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGNvbnRleHQubm9kZXMuZ2V0KG9wLmlkKTtcbiAgICAgICAgaWYgKG5vZGUgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnBhcmVudC50eXBlID09PSBcIkhhc1BhcmVudFwiICYmIGlzTGl2ZUxpc3Qobm9kZS5wYXJlbnQubm9kZSkpIHtcbiAgICAgICAgICByZXR1cm4gbm9kZS5wYXJlbnQubm9kZS5fc2V0Q2hpbGRLZXkoXG4gICAgICAgICAgICBhc1BvcyhvcC5wYXJlbnRLZXkpLFxuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIHNvdXJjZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWQ6IGZhbHNlIH07XG4gICAgICB9XG4gICAgICBjYXNlIDQgLyogQ1JFQVRFX09CSkVDVCAqLzpcbiAgICAgIGNhc2UgMiAvKiBDUkVBVEVfTElTVCAqLzpcbiAgICAgIGNhc2UgNyAvKiBDUkVBVEVfTUFQICovOlxuICAgICAgY2FzZSA4IC8qIENSRUFURV9SRUdJU1RFUiAqLzoge1xuICAgICAgICBpZiAob3AucGFyZW50SWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB7IG1vZGlmaWVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBjb250ZXh0Lm5vZGVzLmdldChvcC5wYXJlbnRJZCk7XG4gICAgICAgIGlmIChwYXJlbnROb2RlID09PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4geyBtb2RpZmllZDogZmFsc2UgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50Tm9kZS5fYXR0YWNoQ2hpbGQob3AsIHNvdXJjZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIHVwZGF0ZVByZXNlbmNlKHBhdGNoLCBvcHRpb25zMikge1xuICAgIGNvbnN0IG9sZFZhbHVlcyA9IHt9O1xuICAgIGlmIChjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMgPT09IG51bGwpIHtcbiAgICAgIGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcyA9IHtcbiAgICAgICAgdHlwZTogXCJwYXJ0aWFsXCIsXG4gICAgICAgIGRhdGE6IHt9XG4gICAgICB9O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRjaCkge1xuICAgICAgY29uc3Qgb3ZlcnJpZGVWYWx1ZSA9IHBhdGNoW2tleV07XG4gICAgICBpZiAob3ZlcnJpZGVWYWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29udGV4dC5idWZmZXIucHJlc2VuY2VVcGRhdGVzLmRhdGFba2V5XSA9IG92ZXJyaWRlVmFsdWU7XG4gICAgICBvbGRWYWx1ZXNba2V5XSA9IGNvbnRleHQubXlQcmVzZW5jZS5jdXJyZW50W2tleV07XG4gICAgfVxuICAgIGNvbnRleHQubXlQcmVzZW5jZS5wYXRjaChwYXRjaCk7XG4gICAgaWYgKGNvbnRleHQuYWN0aXZlQmF0Y2gpIHtcbiAgICAgIGlmIChvcHRpb25zMj8uYWRkVG9IaXN0b3J5KSB7XG4gICAgICAgIGNvbnRleHQuYWN0aXZlQmF0Y2gucmV2ZXJzZU9wcy51bnNoaWZ0KHtcbiAgICAgICAgICB0eXBlOiBcInByZXNlbmNlXCIsXG4gICAgICAgICAgZGF0YTogb2xkVmFsdWVzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29udGV4dC5hY3RpdmVCYXRjaC51cGRhdGVzLnByZXNlbmNlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICAgIGJhdGNoVXBkYXRlcygoKSA9PiB7XG4gICAgICAgIGlmIChvcHRpb25zMj8uYWRkVG9IaXN0b3J5KSB7XG4gICAgICAgICAgYWRkVG9VbmRvU3RhY2soXG4gICAgICAgICAgICBbeyB0eXBlOiBcInByZXNlbmNlXCIsIGRhdGE6IG9sZFZhbHVlcyB9XSxcbiAgICAgICAgICAgIGRvTm90QmF0Y2hVcGRhdGVzXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBub3RpZnkoeyBwcmVzZW5jZTogdHJ1ZSB9LCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gb25VcGRhdGVQcmVzZW5jZU1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGlmIChtZXNzYWdlLnRhcmdldEFjdG9yICE9PSB2b2lkIDApIHtcbiAgICAgIGNvbnN0IG9sZFVzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgICAgY29udGV4dC5vdGhlcnMuc2V0T3RoZXIobWVzc2FnZS5hY3RvciwgbWVzc2FnZS5kYXRhKTtcbiAgICAgIGNvbnN0IG5ld1VzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgICAgaWYgKG9sZFVzZXIgPT09IHZvaWQgMCAmJiBuZXdVc2VyICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJlbnRlclwiLCB1c2VyOiBuZXdVc2VyIH07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRleHQub3RoZXJzLnBhdGNoT3RoZXIobWVzc2FnZS5hY3RvciwgbWVzc2FnZS5kYXRhKSwgbWVzc2FnZTtcbiAgICB9XG4gICAgY29uc3QgdXNlciA9IGNvbnRleHQub3RoZXJzLmdldFVzZXIobWVzc2FnZS5hY3Rvcik7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwidXBkYXRlXCIsXG4gICAgICAgIHVwZGF0ZXM6IG1lc3NhZ2UuZGF0YSxcbiAgICAgICAgdXNlclxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gb25Vc2VyTGVmdE1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGNvbnN0IHVzZXIgPSBjb250ZXh0Lm90aGVycy5nZXRVc2VyKG1lc3NhZ2UuYWN0b3IpO1xuICAgIGlmICh1c2VyKSB7XG4gICAgICBjb250ZXh0Lm90aGVycy5yZW1vdmVDb25uZWN0aW9uKG1lc3NhZ2UuYWN0b3IpO1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJsZWF2ZVwiLCB1c2VyIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGZ1bmN0aW9uIG9uUm9vbVN0YXRlTWVzc2FnZShtZXNzYWdlLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBjb250ZXh0LmR5bmFtaWNTZXNzaW9uSW5mby5zZXQoe1xuICAgICAgYWN0b3I6IG1lc3NhZ2UuYWN0b3IsXG4gICAgICBub25jZTogbWVzc2FnZS5ub25jZSxcbiAgICAgIHNjb3BlczogbWVzc2FnZS5zY29wZXNcbiAgICB9KTtcbiAgICBjb250ZXh0LmlkRmFjdG9yeSA9IG1ha2VJZEZhY3RvcnkobWVzc2FnZS5hY3Rvcik7XG4gICAgbm90aWZ5U2VsZkNoYW5nZWQoYmF0Y2hlZFVwZGF0ZXNXcmFwcGVyKTtcbiAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb25JZCBvZiBjb250ZXh0Lm90aGVycy5jb25uZWN0aW9uSWRzKCkpIHtcbiAgICAgIGNvbnN0IHVzZXIgPSBtZXNzYWdlLnVzZXJzW2Nvbm5lY3Rpb25JZF07XG4gICAgICBpZiAodXNlciA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRleHQub3RoZXJzLnJlbW92ZUNvbm5lY3Rpb24oY29ubmVjdGlvbklkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBrZXkgaW4gbWVzc2FnZS51c2Vycykge1xuICAgICAgY29uc3QgdXNlciA9IG1lc3NhZ2UudXNlcnNba2V5XTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25JZCA9IE51bWJlcihrZXkpO1xuICAgICAgY29udGV4dC5vdGhlcnMuc2V0Q29ubmVjdGlvbihcbiAgICAgICAgY29ubmVjdGlvbklkLFxuICAgICAgICB1c2VyLmlkLFxuICAgICAgICB1c2VyLmluZm8sXG4gICAgICAgIHVzZXIuc2NvcGVzXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4geyB0eXBlOiBcInJlc2V0XCIgfTtcbiAgfVxuICBmdW5jdGlvbiBjYW5VbmRvKCkge1xuICAgIHJldHVybiBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGggPiAwO1xuICB9XG4gIGZ1bmN0aW9uIGNhblJlZG8oKSB7XG4gICAgcmV0dXJuIGNvbnRleHQucmVkb1N0YWNrLmxlbmd0aCA+IDA7XG4gIH1cbiAgZnVuY3Rpb24gb25IaXN0b3J5Q2hhbmdlKGJhdGNoZWRVcGRhdGVzV3JhcHBlcikge1xuICAgIGJhdGNoZWRVcGRhdGVzV3JhcHBlcigoKSA9PiB7XG4gICAgICBldmVudEh1Yi5oaXN0b3J5Lm5vdGlmeSh7IGNhblVuZG86IGNhblVuZG8oKSwgY2FuUmVkbzogY2FuUmVkbygpIH0pO1xuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIG9uVXNlckpvaW5lZE1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGNvbnRleHQub3RoZXJzLnNldENvbm5lY3Rpb24oXG4gICAgICBtZXNzYWdlLmFjdG9yLFxuICAgICAgbWVzc2FnZS5pZCxcbiAgICAgIG1lc3NhZ2UuaW5mbyxcbiAgICAgIG1lc3NhZ2Uuc2NvcGVzXG4gICAgKTtcbiAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKHtcbiAgICAgIHR5cGU6IDEwMCAvKiBVUERBVEVfUFJFU0VOQ0UgKi8sXG4gICAgICBkYXRhOiBjb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudCxcbiAgICAgIHRhcmdldEFjdG9yOiBtZXNzYWdlLmFjdG9yXG4gICAgfSk7XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICBjb25zdCB1c2VyID0gY29udGV4dC5vdGhlcnMuZ2V0VXNlcihtZXNzYWdlLmFjdG9yKTtcbiAgICByZXR1cm4gdXNlciA/IHsgdHlwZTogXCJlbnRlclwiLCB1c2VyIH0gOiB2b2lkIDA7XG4gIH1cbiAgZnVuY3Rpb24gcGFyc2VTZXJ2ZXJNZXNzYWdlKGRhdGEpIHtcbiAgICBpZiAoIWlzSnNvbk9iamVjdChkYXRhKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xuICB9XG4gIGZ1bmN0aW9uIHBhcnNlU2VydmVyTWVzc2FnZXModGV4dCkge1xuICAgIGNvbnN0IGRhdGEgPSB0cnlQYXJzZUpzb24odGV4dCk7XG4gICAgaWYgKGRhdGEgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChpc0pzb25BcnJheShkYXRhKSkge1xuICAgICAgcmV0dXJuIGNvbXBhY3QoZGF0YS5tYXAoKGl0ZW0pID0+IHBhcnNlU2VydmVyTWVzc2FnZShpdGVtKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29tcGFjdChbcGFyc2VTZXJ2ZXJNZXNzYWdlKGRhdGEpXSk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGFwcGx5QW5kU2VuZE9wcyhvZmZsaW5lT3BzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpIHtcbiAgICBpZiAob2ZmbGluZU9wcy5zaXplID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgY29uc3Qgb3BzID0gQXJyYXkuZnJvbShvZmZsaW5lT3BzLnZhbHVlcygpKTtcbiAgICBjb25zdCByZXN1bHQgPSBhcHBseU9wcyhvcHMsIHRydWUpO1xuICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgdHlwZTogMjAxIC8qIFVQREFURV9TVE9SQUdFICovLFxuICAgICAgb3BzOiByZXN1bHQub3BzXG4gICAgfSk7XG4gICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBiYXRjaGVkVXBkYXRlc1dyYXBwZXIpO1xuICAgIHNlbmRNZXNzYWdlcyhtZXNzYWdlcyk7XG4gIH1cbiAgZnVuY3Rpb24gaGFuZGxlU2VydmVyTWVzc2FnZShldmVudCkge1xuICAgIGlmICh0eXBlb2YgZXZlbnQuZGF0YSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXNzYWdlcyA9IHBhcnNlU2VydmVyTWVzc2FnZXMoZXZlbnQuZGF0YSk7XG4gICAgaWYgKG1lc3NhZ2VzID09PSBudWxsIHx8IG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB1cGRhdGVzID0ge1xuICAgICAgc3RvcmFnZVVwZGF0ZXM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksXG4gICAgICBvdGhlcnM6IFtdXG4gICAgfTtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7XG4gICAgICAgIHN3aXRjaCAobWVzc2FnZS50eXBlKSB7XG4gICAgICAgICAgY2FzZSAxMDEgLyogVVNFUl9KT0lORUQgKi86IHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJKb2luZWRVcGRhdGUgPSBvblVzZXJKb2luZWRNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgaWYgKHVzZXJKb2luZWRVcGRhdGUpIHtcbiAgICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaCh1c2VySm9pbmVkVXBkYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDEwMCAvKiBVUERBVEVfUFJFU0VOQ0UgKi86IHtcbiAgICAgICAgICAgIGNvbnN0IG90aGVyc1ByZXNlbmNlVXBkYXRlID0gb25VcGRhdGVQcmVzZW5jZU1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAob3RoZXJzUHJlc2VuY2VVcGRhdGUpIHtcbiAgICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaChvdGhlcnNQcmVzZW5jZVVwZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSAxMDMgLyogQlJPQURDQVNURURfRVZFTlQgKi86IHtcbiAgICAgICAgICAgIGNvbnN0IG90aGVycyA9IGNvbnRleHQub3RoZXJzLmN1cnJlbnQ7XG4gICAgICAgICAgICBldmVudEh1Yi5jdXN0b21FdmVudC5ub3RpZnkoe1xuICAgICAgICAgICAgICBjb25uZWN0aW9uSWQ6IG1lc3NhZ2UuYWN0b3IsXG4gICAgICAgICAgICAgIHVzZXI6IG1lc3NhZ2UuYWN0b3IgPCAwID8gbnVsbCA6IG90aGVycy5maW5kKCh1KSA9PiB1LmNvbm5lY3Rpb25JZCA9PT0gbWVzc2FnZS5hY3RvcikgPz8gbnVsbCxcbiAgICAgICAgICAgICAgZXZlbnQ6IG1lc3NhZ2UuZXZlbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgMTAyIC8qIFVTRVJfTEVGVCAqLzoge1xuICAgICAgICAgICAgY29uc3QgZXZlbnQyID0gb25Vc2VyTGVmdE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAoZXZlbnQyKSB7XG4gICAgICAgICAgICAgIHVwZGF0ZXMub3RoZXJzLnB1c2goZXZlbnQyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDMwMCAvKiBVUERBVEVfWURPQyAqLzoge1xuICAgICAgICAgICAgZXZlbnRIdWIueWRvYy5ub3RpZnkobWVzc2FnZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSAxMDQgLyogUk9PTV9TVEFURSAqLzoge1xuICAgICAgICAgICAgdXBkYXRlcy5vdGhlcnMucHVzaChvblJvb21TdGF0ZU1lc3NhZ2UobWVzc2FnZSwgZG9Ob3RCYXRjaFVwZGF0ZXMpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDIwMCAvKiBJTklUSUFMX1NUT1JBR0VfU1RBVEUgKi86IHtcbiAgICAgICAgICAgIHByb2Nlc3NJbml0aWFsU3RvcmFnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDIwMSAvKiBVUERBVEVfU1RPUkFHRSAqLzoge1xuICAgICAgICAgICAgY29uc3QgYXBwbHlSZXN1bHQgPSBhcHBseU9wcyhtZXNzYWdlLm9wcywgZmFsc2UpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgYXBwbHlSZXN1bHQudXBkYXRlcy5zdG9yYWdlVXBkYXRlcykge1xuICAgICAgICAgICAgICB1cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLnNldChcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgbWVyZ2VTdG9yYWdlVXBkYXRlcyh1cGRhdGVzLnN0b3JhZ2VVcGRhdGVzLmdldChrZXkpLCB2YWx1ZSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDI5OSAvKiBSRUpFQ1RfU1RPUkFHRV9PUCAqLzoge1xuICAgICAgICAgICAgZXJyb3JXaXRoVGl0bGUoXG4gICAgICAgICAgICAgIFwiU3RvcmFnZSBtdXRhdGlvbiByZWplY3Rpb24gZXJyb3JcIixcbiAgICAgICAgICAgICAgbWVzc2FnZS5yZWFzb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHRyYWNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgICAgICAgICAgIGZvciAoY29uc3Qgb3BJZCBvZiBtZXNzYWdlLm9wSWRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJhY2UgPSBjb250ZXh0Lm9wU3RhY2tUcmFjZXM/LmdldChvcElkKTtcbiAgICAgICAgICAgICAgICBpZiAodHJhY2UpIHtcbiAgICAgICAgICAgICAgICAgIHRyYWNlcy5hZGQodHJhY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAodHJhY2VzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgd2FybldpdGhUaXRsZShcbiAgICAgICAgICAgICAgICAgIFwiVGhlIGZvbGxvd2luZyBmdW5jdGlvbiBjYWxscyBjYXVzZWQgdGhlIHJlamVjdGVkIHN0b3JhZ2UgbXV0YXRpb25zOlwiLFxuICAgICAgICAgICAgICAgICAgYFxuXG4ke0FycmF5LmZyb20odHJhY2VzKS5qb2luKFwiXFxuXFxuXCIpfWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBgU3RvcmFnZSBtdXRhdGlvbnMgcmVqZWN0ZWQgYnkgc2VydmVyOiAke21lc3NhZ2UucmVhc29ufWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDQwMCAvKiBUSFJFQURfQ1JFQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwNyAvKiBUSFJFQURfREVMRVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwMSAvKiBUSFJFQURfTUVUQURBVEFfVVBEQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwOCAvKiBUSFJFQURfVVBEQVRFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwNSAvKiBDT01NRU5UX1JFQUNUSU9OX0FEREVEICovOlxuICAgICAgICAgIGNhc2UgNDA2IC8qIENPTU1FTlRfUkVBQ1RJT05fUkVNT1ZFRCAqLzpcbiAgICAgICAgICBjYXNlIDQwMiAvKiBDT01NRU5UX0NSRUFURUQgKi86XG4gICAgICAgICAgY2FzZSA0MDMgLyogQ09NTUVOVF9FRElURUQgKi86XG4gICAgICAgICAgY2FzZSA0MDQgLyogQ09NTUVOVF9ERUxFVEVEICovOiB7XG4gICAgICAgICAgICBldmVudEh1Yi5jb21tZW50cy5ub3RpZnkobWVzc2FnZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIG5vdGlmeSh1cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gZmx1c2hOb3dPclNvb24oKSB7XG4gICAgY29uc3Qgc3RvcmFnZU9wcyA9IGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zO1xuICAgIGlmIChzdG9yYWdlT3BzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoY29uc3Qgb3Agb2Ygc3RvcmFnZU9wcykge1xuICAgICAgICBjb250ZXh0LnVuYWNrbm93bGVkZ2VkT3BzLnNldChubihvcC5vcElkKSwgb3ApO1xuICAgICAgfVxuICAgICAgbm90aWZ5U3RvcmFnZVN0YXR1cygpO1xuICAgIH1cbiAgICBpZiAobWFuYWdlZFNvY2tldC5nZXRTdGF0dXMoKSAhPT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnMgPSBbXTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBlbGFwc2VkTWlsbGlzID0gbm93IC0gY29udGV4dC5idWZmZXIubGFzdEZsdXNoZWRBdDtcbiAgICBpZiAoZWxhcHNlZE1pbGxpcyA+PSBjb25maWcudGhyb3R0bGVEZWxheSkge1xuICAgICAgY29uc3QgbWVzc2FnZXNUb0ZsdXNoID0gc2VyaWFsaXplQnVmZmVyKCk7XG4gICAgICBpZiAobWVzc2FnZXNUb0ZsdXNoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBzZW5kTWVzc2FnZXMobWVzc2FnZXNUb0ZsdXNoKTtcbiAgICAgIGNvbnRleHQuYnVmZmVyID0ge1xuICAgICAgICBmbHVzaFRpbWVySUQ6IHZvaWQgMCxcbiAgICAgICAgbGFzdEZsdXNoZWRBdDogbm93LFxuICAgICAgICBtZXNzYWdlczogW10sXG4gICAgICAgIHN0b3JhZ2VPcGVyYXRpb25zOiBbXSxcbiAgICAgICAgcHJlc2VuY2VVcGRhdGVzOiBudWxsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjbGVhclRpbWVvdXQoY29udGV4dC5idWZmZXIuZmx1c2hUaW1lcklEKTtcbiAgICAgIGNvbnRleHQuYnVmZmVyLmZsdXNoVGltZXJJRCA9IHNldFRpbWVvdXQoXG4gICAgICAgIGZsdXNoTm93T3JTb29uLFxuICAgICAgICBjb25maWcudGhyb3R0bGVEZWxheSAtIGVsYXBzZWRNaWxsaXNcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIHNlcmlhbGl6ZUJ1ZmZlcigpIHtcbiAgICBjb25zdCBtZXNzYWdlcyA9IFtdO1xuICAgIGlmIChjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMpIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goXG4gICAgICAgIGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcy50eXBlID09PSBcImZ1bGxcIiA/IHtcbiAgICAgICAgICB0eXBlOiAxMDAgLyogVVBEQVRFX1BSRVNFTkNFICovLFxuICAgICAgICAgIC8vIFBvcHVsYXRpbmcgdGhlIGB0YXJnZXRBY3RvcmAgZmllbGQgdHVybnMgdGhpcyBtZXNzYWdlIGludG9cbiAgICAgICAgICAvLyBhIEZ1bGwgUHJlc2VuY2XihKIgdXBkYXRlIG1lc3NhZ2UgKG5vdCBhIHBhdGNoKSwgd2hpY2ggd2lsbCBnZXRcbiAgICAgICAgICAvLyBpbnRlcnByZXRlZCBieSBvdGhlciBjbGllbnRzIGFzIHN1Y2guXG4gICAgICAgICAgdGFyZ2V0QWN0b3I6IC0xLFxuICAgICAgICAgIGRhdGE6IGNvbnRleHQuYnVmZmVyLnByZXNlbmNlVXBkYXRlcy5kYXRhXG4gICAgICAgIH0gOiB7XG4gICAgICAgICAgdHlwZTogMTAwIC8qIFVQREFURV9QUkVTRU5DRSAqLyxcbiAgICAgICAgICBkYXRhOiBjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXMuZGF0YVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKGV2ZW50KTtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICB0eXBlOiAyMDEgLyogVVBEQVRFX1NUT1JBR0UgKi8sXG4gICAgICAgIG9wczogY29udGV4dC5idWZmZXIuc3RvcmFnZU9wZXJhdGlvbnNcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZXM7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlWURvYyh1cGRhdGUsIGd1aWQpIHtcbiAgICBjb25zdCBjbGllbnRNc2cgPSB7XG4gICAgICB0eXBlOiAzMDEgLyogVVBEQVRFX1lET0MgKi8sXG4gICAgICB1cGRhdGUsXG4gICAgICBndWlkXG4gICAgfTtcbiAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKGNsaWVudE1zZyk7XG4gICAgZXZlbnRIdWIueWRvYy5ub3RpZnkoY2xpZW50TXNnKTtcbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGZ1bmN0aW9uIGJyb2FkY2FzdEV2ZW50KGV2ZW50LCBvcHRpb25zMiA9IHtcbiAgICBzaG91bGRRdWV1ZUV2ZW50SWZOb3RSZWFkeTogZmFsc2VcbiAgfSkge1xuICAgIGlmIChtYW5hZ2VkU29ja2V0LmdldFN0YXR1cygpICE9PSBcImNvbm5lY3RlZFwiICYmICFvcHRpb25zMi5zaG91bGRRdWV1ZUV2ZW50SWZOb3RSZWFkeSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKHtcbiAgICAgIHR5cGU6IDEwMyAvKiBCUk9BRENBU1RfRVZFTlQgKi8sXG4gICAgICBldmVudFxuICAgIH0pO1xuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gZGlzcGF0Y2hPcHMob3BzKSB7XG4gICAgY29uc3QgeyBzdG9yYWdlT3BlcmF0aW9ucyB9ID0gY29udGV4dC5idWZmZXI7XG4gICAgZm9yIChjb25zdCBvcCBvZiBvcHMpIHtcbiAgICAgIHN0b3JhZ2VPcGVyYXRpb25zLnB1c2gob3ApO1xuICAgIH1cbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGxldCBfZ2V0U3RvcmFnZSQgPSBudWxsO1xuICBsZXQgX3Jlc29sdmVTdG9yYWdlUHJvbWlzZSA9IG51bGw7XG4gIGZ1bmN0aW9uIHByb2Nlc3NJbml0aWFsU3RvcmFnZShtZXNzYWdlKSB7XG4gICAgY29uc3QgdW5hY2tub3dsZWRnZWRPcHMgPSBuZXcgTWFwKGNvbnRleHQudW5hY2tub3dsZWRnZWRPcHMpO1xuICAgIGNyZWF0ZU9yVXBkYXRlUm9vdEZyb21NZXNzYWdlKG1lc3NhZ2UsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICBhcHBseUFuZFNlbmRPcHModW5hY2tub3dsZWRnZWRPcHMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICBfcmVzb2x2ZVN0b3JhZ2VQcm9taXNlPy4oKTtcbiAgICBub3RpZnlTdG9yYWdlU3RhdHVzKCk7XG4gICAgZXZlbnRIdWIuc3RvcmFnZURpZExvYWQubm90aWZ5KCk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gc3RyZWFtU3RvcmFnZSgpIHtcbiAgICBpZiAoIW1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN0cmVhbUZldGNoKG1hbmFnZWRTb2NrZXQuYXV0aFZhbHVlLCBjb25maWcucm9vbUlkKTtcbiAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHJlc3VsdC5qc29uKCk7XG4gICAgcHJvY2Vzc0luaXRpYWxTdG9yYWdlKHsgdHlwZTogMjAwIC8qIElOSVRJQUxfU1RPUkFHRV9TVEFURSAqLywgaXRlbXMgfSk7XG4gIH1cbiAgZnVuY3Rpb24gcmVmcmVzaFN0b3JhZ2Uob3B0aW9uczIpIHtcbiAgICBjb25zdCBtZXNzYWdlcyA9IGNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzO1xuICAgIGlmIChjb25maWcudW5zdGFibGVfc3RyZWFtRGF0YSkge1xuICAgICAgdm9pZCBzdHJlYW1TdG9yYWdlKCk7XG4gICAgfSBlbHNlIGlmICghbWVzc2FnZXMuc29tZSgobXNnKSA9PiBtc2cudHlwZSA9PT0gMjAwIC8qIEZFVENIX1NUT1JBR0UgKi8pKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKHsgdHlwZTogMjAwIC8qIEZFVENIX1NUT1JBR0UgKi8gfSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zMi5mbHVzaCkge1xuICAgICAgZmx1c2hOb3dPclNvb24oKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gc3RhcnRMb2FkaW5nU3RvcmFnZSgpIHtcbiAgICBpZiAoX2dldFN0b3JhZ2UkID09PSBudWxsKSB7XG4gICAgICByZWZyZXNoU3RvcmFnZSh7IGZsdXNoOiB0cnVlIH0pO1xuICAgICAgX2dldFN0b3JhZ2UkID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgX3Jlc29sdmVTdG9yYWdlUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgICB9KTtcbiAgICAgIG5vdGlmeVN0b3JhZ2VTdGF0dXMoKTtcbiAgICB9XG4gICAgcmV0dXJuIF9nZXRTdG9yYWdlJDtcbiAgfVxuICBmdW5jdGlvbiBnZXRTdG9yYWdlU25hcHNob3QoKSB7XG4gICAgY29uc3Qgcm9vdCA9IGNvbnRleHQucm9vdDtcbiAgICBpZiAocm9vdCAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gcm9vdDtcbiAgICB9IGVsc2Uge1xuICAgICAgdm9pZCBzdGFydExvYWRpbmdTdG9yYWdlKCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0U3RvcmFnZSgpIHtcbiAgICBpZiAoY29udGV4dC5yb290ICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICByb290OiBjb250ZXh0LnJvb3RcbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBzdGFydExvYWRpbmdTdG9yYWdlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvb3Q6IG5uKGNvbnRleHQucm9vdClcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGZldGNoWURvYyh2ZWN0b3IsIGd1aWQpIHtcbiAgICBpZiAoIWNvbnRleHQuYnVmZmVyLm1lc3NhZ2VzLmZpbmQoKG0pID0+IHtcbiAgICAgIHJldHVybiBtLnR5cGUgPT09IDMwMCAvKiBGRVRDSF9ZRE9DICovICYmIG0udmVjdG9yID09PSB2ZWN0b3IgJiYgbS5ndWlkID09PSBndWlkO1xuICAgIH0pKSB7XG4gICAgICBjb250ZXh0LmJ1ZmZlci5tZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgdHlwZTogMzAwIC8qIEZFVENIX1lET0MgKi8sXG4gICAgICAgIHZlY3RvcixcbiAgICAgICAgZ3VpZFxuICAgICAgfSk7XG4gICAgfVxuICAgIGZsdXNoTm93T3JTb29uKCk7XG4gIH1cbiAgZnVuY3Rpb24gdW5kbygpIHtcbiAgICBpZiAoY29udGV4dC5hY3RpdmVCYXRjaCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kbyBpcyBub3QgYWxsb3dlZCBkdXJpbmcgYSBiYXRjaFwiKTtcbiAgICB9XG4gICAgY29uc3QgaGlzdG9yeU9wcyA9IGNvbnRleHQudW5kb1N0YWNrLnBvcCgpO1xuICAgIGlmIChoaXN0b3J5T3BzID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29udGV4dC5wYXVzZWRIaXN0b3J5ID0gbnVsbDtcbiAgICBjb25zdCByZXN1bHQgPSBhcHBseU9wcyhoaXN0b3J5T3BzLCB0cnVlKTtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgbm90aWZ5KHJlc3VsdC51cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICBjb250ZXh0LnJlZG9TdGFjay5wdXNoKHJlc3VsdC5yZXZlcnNlKTtcbiAgICAgIG9uSGlzdG9yeUNoYW5nZShkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBvcCBvZiByZXN1bHQub3BzKSB7XG4gICAgICBpZiAob3AudHlwZSAhPT0gXCJwcmVzZW5jZVwiKSB7XG4gICAgICAgIGNvbnRleHQuYnVmZmVyLnN0b3JhZ2VPcGVyYXRpb25zLnB1c2gob3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBmbHVzaE5vd09yU29vbigpO1xuICB9XG4gIGZ1bmN0aW9uIHJlZG8oKSB7XG4gICAgaWYgKGNvbnRleHQuYWN0aXZlQmF0Y2gpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInJlZG8gaXMgbm90IGFsbG93ZWQgZHVyaW5nIGEgYmF0Y2hcIik7XG4gICAgfVxuICAgIGNvbnN0IGhpc3RvcnlPcHMgPSBjb250ZXh0LnJlZG9TdGFjay5wb3AoKTtcbiAgICBpZiAoaGlzdG9yeU9wcyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnRleHQucGF1c2VkSGlzdG9yeSA9IG51bGw7XG4gICAgY29uc3QgcmVzdWx0ID0gYXBwbHlPcHMoaGlzdG9yeU9wcywgdHJ1ZSk7XG4gICAgYmF0Y2hVcGRhdGVzKCgpID0+IHtcbiAgICAgIG5vdGlmeShyZXN1bHQudXBkYXRlcywgZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgICAgY29udGV4dC51bmRvU3RhY2sucHVzaChyZXN1bHQucmV2ZXJzZSk7XG4gICAgICBvbkhpc3RvcnlDaGFuZ2UoZG9Ob3RCYXRjaFVwZGF0ZXMpO1xuICAgIH0pO1xuICAgIGZvciAoY29uc3Qgb3Agb2YgcmVzdWx0Lm9wcykge1xuICAgICAgaWYgKG9wLnR5cGUgIT09IFwicHJlc2VuY2VcIikge1xuICAgICAgICBjb250ZXh0LmJ1ZmZlci5zdG9yYWdlT3BlcmF0aW9ucy5wdXNoKG9wKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZmx1c2hOb3dPclNvb24oKTtcbiAgfVxuICBmdW5jdGlvbiBjbGVhcigpIHtcbiAgICBjb250ZXh0LnVuZG9TdGFjay5sZW5ndGggPSAwO1xuICAgIGNvbnRleHQucmVkb1N0YWNrLmxlbmd0aCA9IDA7XG4gIH1cbiAgZnVuY3Rpb24gYmF0Y2goY2FsbGJhY2spIHtcbiAgICBpZiAoY29udGV4dC5hY3RpdmVCYXRjaCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGxldCByZXR1cm5WYWx1ZSA9IHZvaWQgMDtcbiAgICBiYXRjaFVwZGF0ZXMoKCkgPT4ge1xuICAgICAgY29udGV4dC5hY3RpdmVCYXRjaCA9IHtcbiAgICAgICAgb3BzOiBbXSxcbiAgICAgICAgdXBkYXRlczoge1xuICAgICAgICAgIHN0b3JhZ2VVcGRhdGVzOiAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLFxuICAgICAgICAgIHByZXNlbmNlOiBmYWxzZSxcbiAgICAgICAgICBvdGhlcnM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHJldmVyc2VPcHM6IFtdXG4gICAgICB9O1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuVmFsdWUgPSBjYWxsYmFjaygpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgY29uc3QgY3VycmVudEJhdGNoID0gY29udGV4dC5hY3RpdmVCYXRjaDtcbiAgICAgICAgY29udGV4dC5hY3RpdmVCYXRjaCA9IG51bGw7XG4gICAgICAgIGlmIChjdXJyZW50QmF0Y2gucmV2ZXJzZU9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYWRkVG9VbmRvU3RhY2soY3VycmVudEJhdGNoLnJldmVyc2VPcHMsIGRvTm90QmF0Y2hVcGRhdGVzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudEJhdGNoLm9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29udGV4dC5yZWRvU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudEJhdGNoLm9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZGlzcGF0Y2hPcHMoY3VycmVudEJhdGNoLm9wcyk7XG4gICAgICAgIH1cbiAgICAgICAgbm90aWZ5KGN1cnJlbnRCYXRjaC51cGRhdGVzLCBkb05vdEJhdGNoVXBkYXRlcyk7XG4gICAgICAgIGZsdXNoTm93T3JTb29uKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICB9XG4gIGZ1bmN0aW9uIHBhdXNlSGlzdG9yeSgpIHtcbiAgICBpZiAoY29udGV4dC5wYXVzZWRIaXN0b3J5ID09PSBudWxsKSB7XG4gICAgICBjb250ZXh0LnBhdXNlZEhpc3RvcnkgPSBbXTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gcmVzdW1lSGlzdG9yeSgpIHtcbiAgICBjb25zdCBoaXN0b3J5T3BzID0gY29udGV4dC5wYXVzZWRIaXN0b3J5O1xuICAgIGNvbnRleHQucGF1c2VkSGlzdG9yeSA9IG51bGw7XG4gICAgaWYgKGhpc3RvcnlPcHMgIT09IG51bGwgJiYgaGlzdG9yeU9wcy5sZW5ndGggPiAwKSB7XG4gICAgICBfYWRkVG9SZWFsVW5kb1N0YWNrKGhpc3RvcnlPcHMsIGJhdGNoVXBkYXRlcyk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGdldFN0b3JhZ2VTdGF0dXMoKSB7XG4gICAgaWYgKGNvbnRleHQucm9vdCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gX2dldFN0b3JhZ2UkID09PSBudWxsID8gXCJub3QtbG9hZGVkXCIgOiBcImxvYWRpbmdcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNvbnRleHQudW5hY2tub3dsZWRnZWRPcHMuc2l6ZSA9PT0gMCA/IFwic3luY2hyb25pemVkXCIgOiBcInN5bmNocm9uaXppbmdcIjtcbiAgICB9XG4gIH1cbiAgbGV0IF9sYXN0U3RvcmFnZVN0YXR1cyA9IGdldFN0b3JhZ2VTdGF0dXMoKTtcbiAgZnVuY3Rpb24gbm90aWZ5U3RvcmFnZVN0YXR1cygpIHtcbiAgICBjb25zdCBzdG9yYWdlU3RhdHVzID0gZ2V0U3RvcmFnZVN0YXR1cygpO1xuICAgIGlmIChfbGFzdFN0b3JhZ2VTdGF0dXMgIT09IHN0b3JhZ2VTdGF0dXMpIHtcbiAgICAgIF9sYXN0U3RvcmFnZVN0YXR1cyA9IHN0b3JhZ2VTdGF0dXM7XG4gICAgICBldmVudEh1Yi5zdG9yYWdlU3RhdHVzLm5vdGlmeShzdG9yYWdlU3RhdHVzKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gaXNQcmVzZW5jZVJlYWR5KCkge1xuICAgIHJldHVybiBzZWxmLmN1cnJlbnQgIT09IG51bGw7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gd2FpdFVudGlsUHJlc2VuY2VSZWFkeSgpIHtcbiAgICB3aGlsZSAoIWlzUHJlc2VuY2VSZWFkeSgpKSB7XG4gICAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmUgfSA9IFByb21pc2Vfd2l0aFJlc29sdmVycygpO1xuICAgICAgY29uc3QgdW5zdWIxID0gZXZlbnRzLnNlbGYuc3Vic2NyaWJlT25jZShyZXNvbHZlKTtcbiAgICAgIGNvbnN0IHVuc3ViMiA9IGV2ZW50cy5zdGF0dXMuc3Vic2NyaWJlT25jZShyZXNvbHZlKTtcbiAgICAgIGF3YWl0IHByb21pc2U7XG4gICAgICB1bnN1YjEoKTtcbiAgICAgIHVuc3ViMigpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBpc1N0b3JhZ2VSZWFkeSgpIHtcbiAgICByZXR1cm4gZ2V0U3RvcmFnZVNuYXBzaG90KCkgIT09IG51bGw7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gd2FpdFVudGlsU3RvcmFnZVJlYWR5KCkge1xuICAgIHdoaWxlICghaXNTdG9yYWdlUmVhZHkoKSkge1xuICAgICAgYXdhaXQgZ2V0U3RvcmFnZSgpO1xuICAgIH1cbiAgfVxuICBjb25zdCBvdGhlcnNfZm9yRGV2VG9vbHMgPSBuZXcgRGVyaXZlZFJlZihcbiAgICBjb250ZXh0Lm90aGVycyxcbiAgICAob3RoZXJzKSA9PiBvdGhlcnMubWFwKChvdGhlciwgaW5kZXgpID0+IHVzZXJUb1RyZWVOb2RlKGBPdGhlciAke2luZGV4fWAsIG90aGVyKSlcbiAgKTtcbiAgY29uc3QgZXZlbnRzID0ge1xuICAgIHN0YXR1czogZXZlbnRIdWIuc3RhdHVzLm9ic2VydmFibGUsXG4gICAgbG9zdENvbm5lY3Rpb246IGV2ZW50SHViLmxvc3RDb25uZWN0aW9uLm9ic2VydmFibGUsXG4gICAgY3VzdG9tRXZlbnQ6IGV2ZW50SHViLmN1c3RvbUV2ZW50Lm9ic2VydmFibGUsXG4gICAgb3RoZXJzOiBldmVudEh1Yi5vdGhlcnMub2JzZXJ2YWJsZSxcbiAgICBzZWxmOiBldmVudEh1Yi5zZWxmLm9ic2VydmFibGUsXG4gICAgbXlQcmVzZW5jZTogZXZlbnRIdWIubXlQcmVzZW5jZS5vYnNlcnZhYmxlLFxuICAgIGVycm9yOiBldmVudEh1Yi5lcnJvci5vYnNlcnZhYmxlLFxuICAgIC8qKiBAZGVwcmVjYXRlZCAqL1xuICAgIHN0b3JhZ2U6IGV2ZW50SHViLnN0b3JhZ2VCYXRjaC5vYnNlcnZhYmxlLFxuICAgIHN0b3JhZ2VCYXRjaDogZXZlbnRIdWIuc3RvcmFnZUJhdGNoLm9ic2VydmFibGUsXG4gICAgaGlzdG9yeTogZXZlbnRIdWIuaGlzdG9yeS5vYnNlcnZhYmxlLFxuICAgIHN0b3JhZ2VEaWRMb2FkOiBldmVudEh1Yi5zdG9yYWdlRGlkTG9hZC5vYnNlcnZhYmxlLFxuICAgIHN0b3JhZ2VTdGF0dXM6IGV2ZW50SHViLnN0b3JhZ2VTdGF0dXMub2JzZXJ2YWJsZSxcbiAgICB5ZG9jOiBldmVudEh1Yi55ZG9jLm9ic2VydmFibGUsXG4gICAgY29tbWVudHM6IGV2ZW50SHViLmNvbW1lbnRzLm9ic2VydmFibGVcbiAgfTtcbiAgY29uc3QgY29tbWVudHNBcGkgPSBjcmVhdGVDb21tZW50c0FwaShcbiAgICBjb25maWcucm9vbUlkLFxuICAgIGRlbGVnYXRlcy5hdXRoZW50aWNhdGUsXG4gICAgZmV0Y2hDbGllbnRBcGlcbiAgKTtcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hOb3RpZmljYXRpb25zSnNvbihlbmRwb2ludCwgb3B0aW9uczIpIHtcbiAgICBjb25zdCBhdXRoVmFsdWUgPSBhd2FpdCBkZWxlZ2F0ZXMuYXV0aGVudGljYXRlKCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENsaWVudEFwaShcbiAgICAgIGNvbmZpZy5yb29tSWQsXG4gICAgICBlbmRwb2ludCxcbiAgICAgIGF1dGhWYWx1ZSxcbiAgICAgIG9wdGlvbnMyXG4gICAgKTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDQwMCAmJiByZXNwb25zZS5zdGF0dXMgPCA2MDApIHtcbiAgICAgICAgbGV0IGVycm9yMztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBlcnJvckJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIGVycm9yQm9keS5tZXNzYWdlLFxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgZXJyb3JCb2R5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgZXJyb3IzID0gbmV3IE5vdGlmaWNhdGlvbnNBcGlFcnJvcihcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yMztcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGJvZHk7XG4gICAgdHJ5IHtcbiAgICAgIGJvZHkgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBib2R5ID0ge307XG4gICAgfVxuICAgIHJldHVybiBib2R5O1xuICB9XG4gIGZ1bmN0aW9uIGdldE5vdGlmaWNhdGlvblNldHRpbmdzKCkge1xuICAgIHJldHVybiBmZXRjaE5vdGlmaWNhdGlvbnNKc29uKFxuICAgICAgXCIvbm90aWZpY2F0aW9uLXNldHRpbmdzXCJcbiAgICApO1xuICB9XG4gIGZ1bmN0aW9uIHVwZGF0ZU5vdGlmaWNhdGlvblNldHRpbmdzKHNldHRpbmdzKSB7XG4gICAgcmV0dXJuIGZldGNoTm90aWZpY2F0aW9uc0pzb24oXG4gICAgICBcIi9ub3RpZmljYXRpb24tc2V0dGluZ3NcIixcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc2V0dGluZ3MpLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gbWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZChpbmJveE5vdGlmaWNhdGlvbklkcykge1xuICAgIGF3YWl0IGZldGNoTm90aWZpY2F0aW9uc0pzb24oXCIvaW5ib3gtbm90aWZpY2F0aW9ucy9yZWFkXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBpbmJveE5vdGlmaWNhdGlvbklkcyB9KVxuICAgIH0pO1xuICB9XG4gIGNvbnN0IGJhdGNoZWRNYXJrSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkID0gbmV3IEJhdGNoKFxuICAgIGFzeW5jIChiYXRjaGVkSW5ib3hOb3RpZmljYXRpb25JZHMpID0+IHtcbiAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uSWRzID0gYmF0Y2hlZEluYm94Tm90aWZpY2F0aW9uSWRzLmZsYXQoKTtcbiAgICAgIGF3YWl0IG1hcmtJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQoaW5ib3hOb3RpZmljYXRpb25JZHMpO1xuICAgICAgcmV0dXJuIGluYm94Tm90aWZpY2F0aW9uSWRzO1xuICAgIH0sXG4gICAgeyBkZWxheTogTUFSS19JTkJPWF9OT1RJRklDQVRJT05TX0FTX1JFQURfQkFUQ0hfREVMQVkyIH1cbiAgKTtcbiAgYXN5bmMgZnVuY3Rpb24gbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkKGluYm94Tm90aWZpY2F0aW9uSWQpIHtcbiAgICBhd2FpdCBiYXRjaGVkTWFya0luYm94Tm90aWZpY2F0aW9uc0FzUmVhZC5nZXQoaW5ib3hOb3RpZmljYXRpb25JZCk7XG4gIH1cbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShcbiAgICB7XG4gICAgICBba0ludGVybmFsXToge1xuICAgICAgICBnZXQgcHJlc2VuY2VCdWZmZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIGRlZXBDbG9uZShjb250ZXh0LmJ1ZmZlci5wcmVzZW5jZVVwZGF0ZXM/LmRhdGEgPz8gbnVsbCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHByZXR0aWVyLWlnbm9yZVxuICAgICAgICBnZXQgdW5kb1N0YWNrKCkge1xuICAgICAgICAgIHJldHVybiBkZWVwQ2xvbmUoY29udGV4dC51bmRvU3RhY2spO1xuICAgICAgICB9LFxuICAgICAgICAvLyBwcmV0dGllci1pZ25vcmVcbiAgICAgICAgZ2V0IG5vZGVDb3VudCgpIHtcbiAgICAgICAgICByZXR1cm4gY29udGV4dC5ub2Rlcy5zaXplO1xuICAgICAgICB9LFxuICAgICAgICAvLyBwcmV0dGllci1pZ25vcmVcbiAgICAgICAgLy8gc2VuZCBtZXRhZGF0YSB3aGVuIHVzaW5nIGEgdGV4dCBlZGl0b3JcbiAgICAgICAgcmVwb3J0VGV4dEVkaXRvcixcbiAgICAgICAgLy8gY3JlYXRlIGEgdGV4dCBtZW50aW9uIHdoZW4gdXNpbmcgYSB0ZXh0IGVkaXRvclxuICAgICAgICBjcmVhdGVUZXh0TWVudGlvbixcbiAgICAgICAgLy8gZGVsZXRlIGEgdGV4dCBtZW50aW9uIHdoZW4gdXNpbmcgYSB0ZXh0IGVkaXRvclxuICAgICAgICBkZWxldGVUZXh0TWVudGlvbixcbiAgICAgICAgLy8gU3VwcG9ydCBmb3IgdGhlIExpdmVibG9ja3MgYnJvd3NlciBleHRlbnNpb25cbiAgICAgICAgZ2V0U2VsZl9mb3JEZXZUb29sczogKCkgPT4gc2VsZkFzVHJlZU5vZGUuY3VycmVudCxcbiAgICAgICAgZ2V0T3RoZXJzX2ZvckRldlRvb2xzOiAoKSA9PiBvdGhlcnNfZm9yRGV2VG9vbHMuY3VycmVudCxcbiAgICAgICAgLy8gcHJldHRpZXItaWdub3JlXG4gICAgICAgIHNpbXVsYXRlOiB7XG4gICAgICAgICAgLy8gVGhlc2UgZXhpc3Qgb25seSBmb3Igb3VyIEUyRSB0ZXN0aW5nIGFwcFxuICAgICAgICAgIGV4cGxpY2l0Q2xvc2U6IChldmVudCkgPT4gbWFuYWdlZFNvY2tldC5fcHJpdmF0ZVNlbmRNYWNoaW5lRXZlbnQoeyB0eXBlOiBcIkVYUExJQ0lUX1NPQ0tFVF9DTE9TRVwiLCBldmVudCB9KSxcbiAgICAgICAgICByYXdTZW5kOiAoZGF0YSkgPT4gbWFuYWdlZFNvY2tldC5zZW5kKGRhdGEpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpZDogY29uZmlnLnJvb21JZCxcbiAgICAgIHN1YnNjcmliZTogbWFrZUNsYXNzaWNTdWJzY3JpYmVGbihldmVudHMpLFxuICAgICAgY29ubmVjdDogKCkgPT4gbWFuYWdlZFNvY2tldC5jb25uZWN0KCksXG4gICAgICByZWNvbm5lY3Q6ICgpID0+IG1hbmFnZWRTb2NrZXQucmVjb25uZWN0KCksXG4gICAgICBkaXNjb25uZWN0OiAoKSA9PiBtYW5hZ2VkU29ja2V0LmRpc2Nvbm5lY3QoKSxcbiAgICAgIGRlc3Ryb3k6ICgpID0+IHtcbiAgICAgICAgdW5pbnN0YWxsQmdUYWJTcHkoKTtcbiAgICAgICAgbWFuYWdlZFNvY2tldC5kZXN0cm95KCk7XG4gICAgICB9LFxuICAgICAgLy8gUHJlc2VuY2VcbiAgICAgIHVwZGF0ZVByZXNlbmNlLFxuICAgICAgdXBkYXRlWURvYyxcbiAgICAgIGJyb2FkY2FzdEV2ZW50LFxuICAgICAgLy8gU3RvcmFnZVxuICAgICAgYmF0Y2gsXG4gICAgICBoaXN0b3J5OiB7XG4gICAgICAgIHVuZG8sXG4gICAgICAgIHJlZG8sXG4gICAgICAgIGNhblVuZG8sXG4gICAgICAgIGNhblJlZG8sXG4gICAgICAgIGNsZWFyLFxuICAgICAgICBwYXVzZTogcGF1c2VIaXN0b3J5LFxuICAgICAgICByZXN1bWU6IHJlc3VtZUhpc3RvcnlcbiAgICAgIH0sXG4gICAgICBmZXRjaFlEb2MsXG4gICAgICBnZXRTdG9yYWdlLFxuICAgICAgZ2V0U3RvcmFnZVNuYXBzaG90LFxuICAgICAgZ2V0U3RvcmFnZVN0YXR1cyxcbiAgICAgIGlzUHJlc2VuY2VSZWFkeSxcbiAgICAgIGlzU3RvcmFnZVJlYWR5LFxuICAgICAgd2FpdFVudGlsUHJlc2VuY2VSZWFkeTogbWVtb2l6ZU9uU3VjY2Vzcyh3YWl0VW50aWxQcmVzZW5jZVJlYWR5KSxcbiAgICAgIHdhaXRVbnRpbFN0b3JhZ2VSZWFkeTogbWVtb2l6ZU9uU3VjY2Vzcyh3YWl0VW50aWxTdG9yYWdlUmVhZHkpLFxuICAgICAgZXZlbnRzLFxuICAgICAgLy8gQ29yZVxuICAgICAgZ2V0U3RhdHVzOiAoKSA9PiBtYW5hZ2VkU29ja2V0LmdldFN0YXR1cygpLFxuICAgICAgZ2V0U2VsZjogKCkgPT4gc2VsZi5jdXJyZW50LFxuICAgICAgLy8gUHJlc2VuY2VcbiAgICAgIGdldFByZXNlbmNlOiAoKSA9PiBjb250ZXh0Lm15UHJlc2VuY2UuY3VycmVudCxcbiAgICAgIGdldE90aGVyczogKCkgPT4gY29udGV4dC5vdGhlcnMuY3VycmVudCxcbiAgICAgIGdldE5vdGlmaWNhdGlvblNldHRpbmdzLFxuICAgICAgdXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MsXG4gICAgICBtYXJrSW5ib3hOb3RpZmljYXRpb25Bc1JlYWQsXG4gICAgICAuLi5jb21tZW50c0FwaVxuICAgIH0sXG4gICAgLy8gRXhwbGljdGx5IG1ha2UgdGhlIGludGVybmFsIGZpZWxkIG5vbi1lbnVtZXJhYmxlLCB0byBhdm9pZCBhZ2dyZXNzaXZlXG4gICAgLy8gZnJlZXppbmcgd2hlbiB1c2VkIHdpdGggSW1tZXJcbiAgICBrSW50ZXJuYWwsXG4gICAgeyBlbnVtZXJhYmxlOiBmYWxzZSB9XG4gICk7XG59XG5mdW5jdGlvbiBtYWtlQ2xhc3NpY1N1YnNjcmliZUZuKGV2ZW50cykge1xuICBmdW5jdGlvbiBzdWJzY3JpYmVUb0xpdmVTdHJ1Y3R1cmVEZWVwbHkobm9kZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZXZlbnRzLnN0b3JhZ2VCYXRjaC5zdWJzY3JpYmUoKHVwZGF0ZXMpID0+IHtcbiAgICAgIGNvbnN0IHJlbGF0ZWRVcGRhdGVzID0gdXBkYXRlcy5maWx0ZXIoXG4gICAgICAgICh1cGRhdGUpID0+IGlzU2FtZU5vZGVPckNoaWxkT2YodXBkYXRlLm5vZGUsIG5vZGUpXG4gICAgICApO1xuICAgICAgaWYgKHJlbGF0ZWRVcGRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY2FsbGJhY2socmVsYXRlZFVwZGF0ZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIHN1YnNjcmliZVRvTGl2ZVN0cnVjdHVyZVNoYWxsb3dseShub2RlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBldmVudHMuc3RvcmFnZUJhdGNoLnN1YnNjcmliZSgodXBkYXRlcykgPT4ge1xuICAgICAgZm9yIChjb25zdCB1cGRhdGUgb2YgdXBkYXRlcykge1xuICAgICAgICBpZiAodXBkYXRlLm5vZGUuX2lkID09PSBub2RlLl9pZCkge1xuICAgICAgICAgIGNhbGxiYWNrKHVwZGF0ZS5ub2RlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGZ1bmN0aW9uIHN1YnNjcmliZShmaXJzdCwgc2Vjb25kLCBvcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBmaXJzdCA9PT0gXCJzdHJpbmdcIiAmJiBpc1Jvb21FdmVudE5hbWUoZmlyc3QpKSB7XG4gICAgICBpZiAodHlwZW9mIHNlY29uZCAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlY29uZCBhcmd1bWVudCBtdXN0IGJlIGEgY2FsbGJhY2sgZnVuY3Rpb25cIik7XG4gICAgICB9XG4gICAgICBjb25zdCBjYWxsYmFjayA9IHNlY29uZDtcbiAgICAgIHN3aXRjaCAoZmlyc3QpIHtcbiAgICAgICAgY2FzZSBcImV2ZW50XCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5jdXN0b21FdmVudC5zdWJzY3JpYmUoXG4gICAgICAgICAgICBjYWxsYmFja1xuICAgICAgICAgICk7XG4gICAgICAgIGNhc2UgXCJteS1wcmVzZW5jZVwiOlxuICAgICAgICAgIHJldHVybiBldmVudHMubXlQcmVzZW5jZS5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICBjYXNlIFwib3RoZXJzXCI6IHtcbiAgICAgICAgICBjb25zdCBjYiA9IGNhbGxiYWNrO1xuICAgICAgICAgIHJldHVybiBldmVudHMub3RoZXJzLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3RoZXJzLCAuLi5pbnRlcm5hbEV2ZW50IH0gPSBldmVudDtcbiAgICAgICAgICAgIHJldHVybiBjYihvdGhlcnMsIGludGVybmFsRXZlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgICAgIHJldHVybiBldmVudHMuZXJyb3Iuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgY2FzZSBcInN0YXR1c1wiOlxuICAgICAgICAgIHJldHVybiBldmVudHMuc3RhdHVzLnN1YnNjcmliZShjYWxsYmFjayk7XG4gICAgICAgIGNhc2UgXCJsb3N0LWNvbm5lY3Rpb25cIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLmxvc3RDb25uZWN0aW9uLnN1YnNjcmliZShcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgY2FzZSBcImhpc3RvcnlcIjpcbiAgICAgICAgICByZXR1cm4gZXZlbnRzLmhpc3Rvcnkuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgY2FzZSBcInN0b3JhZ2Utc3RhdHVzXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5zdG9yYWdlU3RhdHVzLnN1YnNjcmliZShcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgKTtcbiAgICAgICAgY2FzZSBcImNvbW1lbnRzXCI6XG4gICAgICAgICAgcmV0dXJuIGV2ZW50cy5jb21tZW50cy5zdWJzY3JpYmUoXG4gICAgICAgICAgICBjYWxsYmFja1xuICAgICAgICAgICk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGFzc2VydE5ldmVyKFxuICAgICAgICAgICAgZmlyc3QsXG4gICAgICAgICAgICBgXCIke1N0cmluZyhmaXJzdCl9XCIgaXMgbm90IGEgdmFsaWQgZXZlbnQgbmFtZWBcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc2Vjb25kID09PSB2b2lkIDAgfHwgdHlwZW9mIGZpcnN0ID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGlmICh0eXBlb2YgZmlyc3QgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjb25zdCBzdG9yYWdlQ2FsbGJhY2sgPSBmaXJzdDtcbiAgICAgICAgcmV0dXJuIGV2ZW50cy5zdG9yYWdlQmF0Y2guc3Vic2NyaWJlKHN0b3JhZ2VDYWxsYmFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQbGVhc2Ugc3BlY2lmeSBhIGxpc3RlbmVyIGNhbGxiYWNrXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaXNMaXZlTm9kZShmaXJzdCkpIHtcbiAgICAgIGNvbnN0IG5vZGUgPSBmaXJzdDtcbiAgICAgIGlmIChvcHRpb25zPy5pc0RlZXApIHtcbiAgICAgICAgY29uc3Qgc3RvcmFnZUNhbGxiYWNrID0gc2Vjb25kO1xuICAgICAgICByZXR1cm4gc3Vic2NyaWJlVG9MaXZlU3RydWN0dXJlRGVlcGx5KG5vZGUsIHN0b3JhZ2VDYWxsYmFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBub2RlQ2FsbGJhY2sgPSBzZWNvbmQ7XG4gICAgICAgIHJldHVybiBzdWJzY3JpYmVUb0xpdmVTdHJ1Y3R1cmVTaGFsbG93bHkobm9kZSwgbm9kZUNhbGxiYWNrKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYCR7U3RyaW5nKGZpcnN0KX0gaXMgbm90IGEgdmFsdWUgdGhhdCBjYW4gYmUgc3Vic2NyaWJlZCB0by5gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gc3Vic2NyaWJlO1xufVxuZnVuY3Rpb24gaXNSb29tRXZlbnROYW1lKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSA9PT0gXCJteS1wcmVzZW5jZVwiIHx8IHZhbHVlID09PSBcIm90aGVyc1wiIHx8IHZhbHVlID09PSBcImV2ZW50XCIgfHwgdmFsdWUgPT09IFwiZXJyb3JcIiB8fCB2YWx1ZSA9PT0gXCJoaXN0b3J5XCIgfHwgdmFsdWUgPT09IFwic3RhdHVzXCIgfHwgdmFsdWUgPT09IFwic3RvcmFnZS1zdGF0dXNcIiB8fCB2YWx1ZSA9PT0gXCJsb3N0LWNvbm5lY3Rpb25cIiB8fCB2YWx1ZSA9PT0gXCJjb25uZWN0aW9uXCIgfHwgdmFsdWUgPT09IFwiY29tbWVudHNcIjtcbn1cbmZ1bmN0aW9uIG1ha2VBdXRoRGVsZWdhdGVGb3JSb29tKHJvb21JZCwgYXV0aE1hbmFnZXIpIHtcbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcbiAgICByZXR1cm4gYXV0aE1hbmFnZXIuZ2V0QXV0aFZhbHVlKHsgcmVxdWVzdGVkU2NvcGU6IFwicm9vbTpyZWFkXCIsIHJvb21JZCB9KTtcbiAgfTtcbn1cbmZ1bmN0aW9uIG1ha2VDcmVhdGVTb2NrZXREZWxlZ2F0ZUZvclJvb20ocm9vbUlkLCBiYXNlVXJsLCBXZWJTb2NrZXRQb2x5ZmlsbCkge1xuICByZXR1cm4gKGF1dGhWYWx1ZSkgPT4ge1xuICAgIGNvbnN0IHdzID0gV2ViU29ja2V0UG9seWZpbGwgPz8gKHR5cGVvZiBXZWJTb2NrZXQgPT09IFwidW5kZWZpbmVkXCIgPyB2b2lkIDAgOiBXZWJTb2NrZXQpO1xuICAgIGlmICh3cyA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgU3RvcFJldHJ5aW5nKFxuICAgICAgICBcIlRvIHVzZSBMaXZlYmxvY2tzIGNsaWVudCBpbiBhIG5vbi1ET00gZW52aXJvbm1lbnQsIHlvdSBuZWVkIHRvIHByb3ZpZGUgYSBXZWJTb2NrZXQgcG9seWZpbGwuXCJcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYmFzZVVybCk7XG4gICAgdXJsLnByb3RvY29sID0gdXJsLnByb3RvY29sID09PSBcImh0dHA6XCIgPyBcIndzXCIgOiBcIndzc1wiO1xuICAgIHVybC5wYXRobmFtZSA9IFwiL3Y3XCI7XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyb29tSWRcIiwgcm9vbUlkKTtcbiAgICBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwic2VjcmV0XCIpIHtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwidG9rXCIsIGF1dGhWYWx1ZS50b2tlbi5yYXcpO1xuICAgIH0gZWxzZSBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwicHVibGljXCIpIHtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwicHVia2V5XCIsIGF1dGhWYWx1ZS5wdWJsaWNBcGlLZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYXNzZXJ0TmV2ZXIoYXV0aFZhbHVlLCBcIlVuaGFuZGxlZCBjYXNlXCIpO1xuICAgIH1cbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInZlcnNpb25cIiwgUEtHX1ZFUlNJT04gfHwgXCJkZXZcIik7XG4gICAgcmV0dXJuIG5ldyB3cyh1cmwudG9TdHJpbmcoKSk7XG4gIH07XG59XG5cbi8vIHNyYy9zdG9yZS50c1xuZnVuY3Rpb24gY3JlYXRlQ2xpZW50U3RvcmUoKSB7XG4gIGNvbnN0IHN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICAgIHRocmVhZHM6IHt9LFxuICAgIHF1ZXJpZXM6IHt9LFxuICAgIG9wdGltaXN0aWNVcGRhdGVzOiBbXSxcbiAgICBpbmJveE5vdGlmaWNhdGlvbnM6IHt9LFxuICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB7fVxuICB9KTtcbiAgY29uc3Qgb3B0aW1pc3RpY1VwZGF0ZXNFdmVudFNvdXJjZSA9IG1ha2VFdmVudFNvdXJjZSgpO1xuICByZXR1cm4ge1xuICAgIC4uLnN0b3JlLFxuICAgIGRlbGV0ZVRocmVhZCh0aHJlYWRJZCkge1xuICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIHRocmVhZHM6IGRlbGV0ZUtleUltbXV0YWJsZShzdGF0ZS50aHJlYWRzLCB0aHJlYWRJZCksXG4gICAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhzdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnMpLmZpbHRlcihcbiAgICAgICAgICAgICAgKFtfaWQsIG5vdGlmaWNhdGlvbl0pID0+IG5vdGlmaWNhdGlvbi5raW5kID09PSBcInRocmVhZFwiICYmIG5vdGlmaWNhdGlvbi50aHJlYWRJZCA9PT0gdGhyZWFkSWRcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVwZGF0ZVRocmVhZEFuZE5vdGlmaWNhdGlvbih0aHJlYWQsIGluYm94Tm90aWZpY2F0aW9uKSB7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWQuaWRdO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIHRocmVhZHM6IGV4aXN0aW5nVGhyZWFkID09PSB2b2lkIDAgfHwgY29tcGFyZVRocmVhZHModGhyZWFkLCBleGlzdGluZ1RocmVhZCkgPT09IDEgPyB7IC4uLnN0YXRlLnRocmVhZHMsIFt0aHJlYWQuaWRdOiB0aHJlYWQgfSA6IHN0YXRlLnRocmVhZHMsXG4gICAgICAgICAgaW5ib3hOb3RpZmljYXRpb25zOiBpbmJveE5vdGlmaWNhdGlvbiA9PT0gdm9pZCAwID8gc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zIDoge1xuICAgICAgICAgICAgLi4uc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICAgICAgW2luYm94Tm90aWZpY2F0aW9uLmlkXTogaW5ib3hOb3RpZmljYXRpb25cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVwZGF0ZVRocmVhZHNBbmROb3RpZmljYXRpb25zKHRocmVhZHMsIGluYm94Tm90aWZpY2F0aW9ucywgZGVsZXRlZFRocmVhZHMsIGRlbGV0ZWRJbmJveE5vdGlmaWNhdGlvbnMsIHF1ZXJ5S2V5KSB7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgdGhyZWFkczogYXBwbHlUaHJlYWRVcGRhdGVzKHN0YXRlLnRocmVhZHMsIHtcbiAgICAgICAgICBuZXdUaHJlYWRzOiB0aHJlYWRzLFxuICAgICAgICAgIGRlbGV0ZWRUaHJlYWRzXG4gICAgICAgIH0pLFxuICAgICAgICBpbmJveE5vdGlmaWNhdGlvbnM6IGFwcGx5Tm90aWZpY2F0aW9uc1VwZGF0ZXMoXG4gICAgICAgICAgc3RhdGUuaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5ld0luYm94Tm90aWZpY2F0aW9uczogaW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgICAgICAgZGVsZXRlZE5vdGlmaWNhdGlvbnM6IGRlbGV0ZWRJbmJveE5vdGlmaWNhdGlvbnNcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHF1ZXJpZXM6IHF1ZXJ5S2V5ICE9PSB2b2lkIDAgPyB7XG4gICAgICAgICAgLi4uc3RhdGUucXVlcmllcyxcbiAgICAgICAgICBbcXVlcnlLZXldOiB7IGlzTG9hZGluZzogZmFsc2UsIGRhdGE6IHZvaWQgMCB9XG4gICAgICAgIH0gOiBzdGF0ZS5xdWVyaWVzXG4gICAgICB9KSk7XG4gICAgfSxcbiAgICB1cGRhdGVSb29tSW5ib3hOb3RpZmljYXRpb25TZXR0aW5ncyhyb29tSWQsIHNldHRpbmdzLCBxdWVyeUtleSkge1xuICAgICAgc3RvcmUuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB7XG4gICAgICAgICAgLi4uc3RhdGUubm90aWZpY2F0aW9uU2V0dGluZ3MsXG4gICAgICAgICAgW3Jvb21JZF06IHNldHRpbmdzXG4gICAgICAgIH0sXG4gICAgICAgIHF1ZXJpZXM6IHtcbiAgICAgICAgICAuLi5zdGF0ZS5xdWVyaWVzLFxuICAgICAgICAgIFtxdWVyeUtleV06IHsgaXNMb2FkaW5nOiBmYWxzZSwgZGF0YTogdm9pZCAwIH1cbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgcHVzaE9wdGltaXN0aWNVcGRhdGUob3B0aW1pc3RpY1VwZGF0ZSkge1xuICAgICAgb3B0aW1pc3RpY1VwZGF0ZXNFdmVudFNvdXJjZS5ub3RpZnkob3B0aW1pc3RpY1VwZGF0ZSk7XG4gICAgICBzdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZXM6IFsuLi5zdGF0ZS5vcHRpbWlzdGljVXBkYXRlcywgb3B0aW1pc3RpY1VwZGF0ZV1cbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIHNldFF1ZXJ5U3RhdGUocXVlcnlLZXksIHF1ZXJ5U3RhdGUpIHtcbiAgICAgIHN0b3JlLnNldCgoc3RhdGUpID0+ICh7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBxdWVyaWVzOiB7XG4gICAgICAgICAgLi4uc3RhdGUucXVlcmllcyxcbiAgICAgICAgICBbcXVlcnlLZXldOiBxdWVyeVN0YXRlXG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIG9wdGltaXN0aWNVcGRhdGVzRXZlbnRTb3VyY2VcbiAgfTtcbn1cbmZ1bmN0aW9uIGRlbGV0ZUtleUltbXV0YWJsZShyZWNvcmQsIGtleSkge1xuICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY29yZCwga2V5KSkge1xuICAgIGNvbnN0IHsgW2tleV06IF90b0RlbGV0ZSwgLi4ucmVzdCB9ID0gcmVjb3JkO1xuICAgIHJldHVybiByZXN0O1xuICB9XG4gIHJldHVybiByZWNvcmQ7XG59XG5mdW5jdGlvbiBjb21wYXJlVGhyZWFkcyh0aHJlYWQxLCB0aHJlYWQyKSB7XG4gIGlmICh0aHJlYWQxLnVwZGF0ZWRBdCAmJiB0aHJlYWQyLnVwZGF0ZWRBdCkge1xuICAgIHJldHVybiB0aHJlYWQxLnVwZGF0ZWRBdCA+IHRocmVhZDIudXBkYXRlZEF0ID8gMSA6IHRocmVhZDEudXBkYXRlZEF0IDwgdGhyZWFkMi51cGRhdGVkQXQgPyAtMSA6IDA7XG4gIH0gZWxzZSBpZiAodGhyZWFkMS51cGRhdGVkQXQgfHwgdGhyZWFkMi51cGRhdGVkQXQpIHtcbiAgICByZXR1cm4gdGhyZWFkMS51cGRhdGVkQXQgPyAxIDogLTE7XG4gIH1cbiAgaWYgKHRocmVhZDEuY3JlYXRlZEF0ID4gdGhyZWFkMi5jcmVhdGVkQXQpIHtcbiAgICByZXR1cm4gMTtcbiAgfSBlbHNlIGlmICh0aHJlYWQxLmNyZWF0ZWRBdCA8IHRocmVhZDIuY3JlYXRlZEF0KSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIHJldHVybiAwO1xufVxuZnVuY3Rpb24gYXBwbHlPcHRpbWlzdGljVXBkYXRlcyhzdGF0ZSkge1xuICBjb25zdCByZXN1bHQgPSB7XG4gICAgdGhyZWFkczoge1xuICAgICAgLi4uc3RhdGUudGhyZWFkc1xuICAgIH0sXG4gICAgaW5ib3hOb3RpZmljYXRpb25zOiB7XG4gICAgICAuLi5zdGF0ZS5pbmJveE5vdGlmaWNhdGlvbnNcbiAgICB9LFxuICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB7XG4gICAgICAuLi5zdGF0ZS5ub3RpZmljYXRpb25TZXR0aW5nc1xuICAgIH1cbiAgfTtcbiAgZm9yIChjb25zdCBvcHRpbWlzdGljVXBkYXRlIG9mIHN0YXRlLm9wdGltaXN0aWNVcGRhdGVzKSB7XG4gICAgc3dpdGNoIChvcHRpbWlzdGljVXBkYXRlLnR5cGUpIHtcbiAgICAgIGNhc2UgXCJjcmVhdGUtdGhyZWFkXCI6IHtcbiAgICAgICAgcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWQuaWRdID0gb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVkaXQtdGhyZWFkLW1ldGFkYXRhXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhyZWFkLnVwZGF0ZWRBdCAhPT0gdm9pZCAwICYmIHRocmVhZC51cGRhdGVkQXQgPiBvcHRpbWlzdGljVXBkYXRlLnVwZGF0ZWRBdCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSB7XG4gICAgICAgICAgLi4udGhyZWFkLFxuICAgICAgICAgIHVwZGF0ZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS51cGRhdGVkQXQsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIC4uLnRocmVhZC5tZXRhZGF0YSxcbiAgICAgICAgICAgIC4uLm9wdGltaXN0aWNVcGRhdGUubWV0YWRhdGFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm1hcmstdGhyZWFkLWFzLXJlc29sdmVkXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0ge1xuICAgICAgICAgIC4uLnRocmVhZCxcbiAgICAgICAgICByZXNvbHZlZDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJtYXJrLXRocmVhZC1hcy11bnJlc29sdmVkXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0ge1xuICAgICAgICAgIC4uLnRocmVhZCxcbiAgICAgICAgICByZXNvbHZlZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY3JlYXRlLWNvbW1lbnRcIjoge1xuICAgICAgICBjb25zdCB0aHJlYWQgPSByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLmNvbW1lbnQudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gdXBzZXJ0Q29tbWVudChcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50XG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGluYm94Tm90aWZpY2F0aW9uID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zKS5maW5kKFxuICAgICAgICAgIChub3RpZmljYXRpb24pID0+IG5vdGlmaWNhdGlvbi5raW5kID09PSBcInRocmVhZFwiICYmIG5vdGlmaWNhdGlvbi50aHJlYWRJZCA9PT0gdGhyZWFkLmlkXG4gICAgICAgICk7XG4gICAgICAgIGlmIChpbmJveE5vdGlmaWNhdGlvbiA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9uc1tpbmJveE5vdGlmaWNhdGlvbi5pZF0gPSB7XG4gICAgICAgICAgLi4uaW5ib3hOb3RpZmljYXRpb24sXG4gICAgICAgICAgbm90aWZpZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50LmNyZWF0ZWRBdCxcbiAgICAgICAgICByZWFkQXQ6IG9wdGltaXN0aWNVcGRhdGUuY29tbWVudC5jcmVhdGVkQXRcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZWRpdC1jb21tZW50XCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50LnRocmVhZElkXTtcbiAgICAgICAgaWYgKHRocmVhZCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnRocmVhZHNbdGhyZWFkLmlkXSA9IHVwc2VydENvbW1lbnQoXG4gICAgICAgICAgdGhyZWFkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUuY29tbWVudFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJkZWxldGUtY29tbWVudFwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gZGVsZXRlQ29tbWVudChcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50SWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5kZWxldGVkQXRcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZGVsZXRlLXRocmVhZFwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXSA9IHtcbiAgICAgICAgICAuLi5yZXN1bHQudGhyZWFkc1tvcHRpbWlzdGljVXBkYXRlLnRocmVhZElkXSxcbiAgICAgICAgICBkZWxldGVkQXQ6IG9wdGltaXN0aWNVcGRhdGUuZGVsZXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5kZWxldGVkQXQsXG4gICAgICAgICAgY29tbWVudHM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImFkZC1yZWFjdGlvblwiOiB7XG4gICAgICAgIGNvbnN0IHRocmVhZCA9IHJlc3VsdC50aHJlYWRzW29wdGltaXN0aWNVcGRhdGUudGhyZWFkSWRdO1xuICAgICAgICBpZiAodGhyZWFkID09PSB2b2lkIDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQudGhyZWFkc1t0aHJlYWQuaWRdID0gYWRkUmVhY3Rpb24oXG4gICAgICAgICAgdGhyZWFkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUuY29tbWVudElkLFxuICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUucmVhY3Rpb25cbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3ZlLXJlYWN0aW9uXCI6IHtcbiAgICAgICAgY29uc3QgdGhyZWFkID0gcmVzdWx0LnRocmVhZHNbb3B0aW1pc3RpY1VwZGF0ZS50aHJlYWRJZF07XG4gICAgICAgIGlmICh0aHJlYWQgPT09IHZvaWQgMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC50aHJlYWRzW3RocmVhZC5pZF0gPSByZW1vdmVSZWFjdGlvbihcbiAgICAgICAgICB0aHJlYWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5jb21tZW50SWQsXG4gICAgICAgICAgb3B0aW1pc3RpY1VwZGF0ZS5lbW9qaSxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLnVzZXJJZCxcbiAgICAgICAgICBvcHRpbWlzdGljVXBkYXRlLnJlbW92ZWRBdFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJtYXJrLWluYm94LW5vdGlmaWNhdGlvbi1hcy1yZWFkXCI6IHtcbiAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9uc1tvcHRpbWlzdGljVXBkYXRlLmluYm94Tm90aWZpY2F0aW9uSWRdID0ge1xuICAgICAgICAgIC4uLnN0YXRlLmluYm94Tm90aWZpY2F0aW9uc1tvcHRpbWlzdGljVXBkYXRlLmluYm94Tm90aWZpY2F0aW9uSWRdLFxuICAgICAgICAgIHJlYWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5yZWFkQXRcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwibWFyay1hbGwtaW5ib3gtbm90aWZpY2F0aW9ucy1hcy1yZWFkXCI6IHtcbiAgICAgICAgZm9yIChjb25zdCBpZCBpbiByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgcmVzdWx0LmluYm94Tm90aWZpY2F0aW9uc1tpZF0gPSB7XG4gICAgICAgICAgICAuLi5yZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zW2lkXSxcbiAgICAgICAgICAgIHJlYWRBdDogb3B0aW1pc3RpY1VwZGF0ZS5yZWFkQXRcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImRlbGV0ZS1pbmJveC1ub3RpZmljYXRpb25cIjoge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgW29wdGltaXN0aWNVcGRhdGUuaW5ib3hOb3RpZmljYXRpb25JZF06IF8sXG4gICAgICAgICAgLi4uaW5ib3hOb3RpZmljYXRpb25zXG4gICAgICAgIH0gPSByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zO1xuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zID0gaW5ib3hOb3RpZmljYXRpb25zO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJkZWxldGUtYWxsLWluYm94LW5vdGlmaWNhdGlvbnNcIjoge1xuICAgICAgICByZXN1bHQuaW5ib3hOb3RpZmljYXRpb25zID0ge307XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVwZGF0ZS1ub3RpZmljYXRpb24tc2V0dGluZ3NcIjoge1xuICAgICAgICByZXN1bHQubm90aWZpY2F0aW9uU2V0dGluZ3Nbb3B0aW1pc3RpY1VwZGF0ZS5yb29tSWRdID0ge1xuICAgICAgICAgIC4uLnJlc3VsdC5ub3RpZmljYXRpb25TZXR0aW5nc1tvcHRpbWlzdGljVXBkYXRlLnJvb21JZF0sXG4gICAgICAgICAgLi4ub3B0aW1pc3RpY1VwZGF0ZS5zZXR0aW5nc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gYXBwbHlUaHJlYWRVcGRhdGVzKGV4aXN0aW5nVGhyZWFkcywgdXBkYXRlcykge1xuICBjb25zdCB1cGRhdGVkVGhyZWFkcyA9IHsgLi4uZXhpc3RpbmdUaHJlYWRzIH07XG4gIHVwZGF0ZXMubmV3VGhyZWFkcy5mb3JFYWNoKCh0aHJlYWQpID0+IHtcbiAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHVwZGF0ZWRUaHJlYWRzW3RocmVhZC5pZF07XG4gICAgaWYgKGV4aXN0aW5nVGhyZWFkKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlVGhyZWFkcyhleGlzdGluZ1RocmVhZCwgdGhyZWFkKTtcbiAgICAgIGlmIChyZXN1bHQgPT09IDEpIHJldHVybjtcbiAgICB9XG4gICAgdXBkYXRlZFRocmVhZHNbdGhyZWFkLmlkXSA9IHRocmVhZDtcbiAgfSk7XG4gIHVwZGF0ZXMuZGVsZXRlZFRocmVhZHMuZm9yRWFjaCgoeyBpZCwgZGVsZXRlZEF0IH0pID0+IHtcbiAgICBjb25zdCBleGlzdGluZ1RocmVhZCA9IHVwZGF0ZWRUaHJlYWRzW2lkXTtcbiAgICBpZiAoZXhpc3RpbmdUaHJlYWQgPT09IHZvaWQgMCkgcmV0dXJuO1xuICAgIGV4aXN0aW5nVGhyZWFkLmRlbGV0ZWRBdCA9IGRlbGV0ZWRBdDtcbiAgICBleGlzdGluZ1RocmVhZC51cGRhdGVkQXQgPSBkZWxldGVkQXQ7XG4gICAgZXhpc3RpbmdUaHJlYWQuY29tbWVudHMgPSBbXTtcbiAgfSk7XG4gIHJldHVybiB1cGRhdGVkVGhyZWFkcztcbn1cbmZ1bmN0aW9uIGFwcGx5Tm90aWZpY2F0aW9uc1VwZGF0ZXMoZXhpc3RpbmdJbmJveE5vdGlmaWNhdGlvbnMsIHVwZGF0ZXMpIHtcbiAgY29uc3QgdXBkYXRlZEluYm94Tm90aWZpY2F0aW9ucyA9IHsgLi4uZXhpc3RpbmdJbmJveE5vdGlmaWNhdGlvbnMgfTtcbiAgdXBkYXRlcy5uZXdJbmJveE5vdGlmaWNhdGlvbnMuZm9yRWFjaCgobm90aWZpY2F0aW9uKSA9PiB7XG4gICAgY29uc3QgZXhpc3RpbmdOb3RpZmljYXRpb24gPSB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zW25vdGlmaWNhdGlvbi5pZF07XG4gICAgaWYgKGV4aXN0aW5nTm90aWZpY2F0aW9uKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlSW5ib3hOb3RpZmljYXRpb25zKFxuICAgICAgICBleGlzdGluZ05vdGlmaWNhdGlvbixcbiAgICAgICAgbm90aWZpY2F0aW9uXG4gICAgICApO1xuICAgICAgaWYgKHJlc3VsdCA9PT0gMSkgcmV0dXJuO1xuICAgIH1cbiAgICB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zW25vdGlmaWNhdGlvbi5pZF0gPSBub3RpZmljYXRpb247XG4gIH0pO1xuICB1cGRhdGVzLmRlbGV0ZWROb3RpZmljYXRpb25zLmZvckVhY2goXG4gICAgKHsgaWQgfSkgPT4gZGVsZXRlIHVwZGF0ZWRJbmJveE5vdGlmaWNhdGlvbnNbaWRdXG4gICk7XG4gIHJldHVybiB1cGRhdGVkSW5ib3hOb3RpZmljYXRpb25zO1xufVxuZnVuY3Rpb24gY29tcGFyZUluYm94Tm90aWZpY2F0aW9ucyhpbmJveE5vdGlmaWNhdGlvbkEsIGluYm94Tm90aWZpY2F0aW9uQikge1xuICBpZiAoaW5ib3hOb3RpZmljYXRpb25BLm5vdGlmaWVkQXQgPiBpbmJveE5vdGlmaWNhdGlvbkIubm90aWZpZWRBdCkge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2UgaWYgKGluYm94Tm90aWZpY2F0aW9uQS5ub3RpZmllZEF0IDwgaW5ib3hOb3RpZmljYXRpb25CLm5vdGlmaWVkQXQpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgaWYgKGluYm94Tm90aWZpY2F0aW9uQS5yZWFkQXQgJiYgaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCkge1xuICAgIHJldHVybiBpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0ID4gaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCA/IDEgOiBpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0IDwgaW5ib3hOb3RpZmljYXRpb25CLnJlYWRBdCA/IC0xIDogMDtcbiAgfSBlbHNlIGlmIChpbmJveE5vdGlmaWNhdGlvbkEucmVhZEF0IHx8IGluYm94Tm90aWZpY2F0aW9uQi5yZWFkQXQpIHtcbiAgICByZXR1cm4gaW5ib3hOb3RpZmljYXRpb25BLnJlYWRBdCA/IDEgOiAtMTtcbiAgfVxuICByZXR1cm4gMDtcbn1cbmZ1bmN0aW9uIHVwc2VydENvbW1lbnQodGhyZWFkLCBjb21tZW50KSB7XG4gIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGlmIChjb21tZW50LnRocmVhZElkICE9PSB0aHJlYWQuaWQpIHtcbiAgICB3YXJuKFxuICAgICAgYENvbW1lbnQgJHtjb21tZW50LmlkfSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhyZWFkICR7dGhyZWFkLmlkfWBcbiAgICApO1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgZXhpc3RpbmdDb21tZW50ID0gdGhyZWFkLmNvbW1lbnRzLmZpbmQoXG4gICAgKGV4aXN0aW5nQ29tbWVudDIpID0+IGV4aXN0aW5nQ29tbWVudDIuaWQgPT09IGNvbW1lbnQuaWRcbiAgKTtcbiAgaWYgKGV4aXN0aW5nQ29tbWVudCA9PT0gdm9pZCAwKSB7XG4gICAgY29uc3QgdXBkYXRlZEF0ID0gbmV3IERhdGUoXG4gICAgICBNYXRoLm1heCh0aHJlYWQudXBkYXRlZEF0Py5nZXRUaW1lKCkgfHwgMCwgY29tbWVudC5jcmVhdGVkQXQuZ2V0VGltZSgpKVxuICAgICk7XG4gICAgY29uc3QgdXBkYXRlZFRocmVhZCA9IHtcbiAgICAgIC4uLnRocmVhZCxcbiAgICAgIHVwZGF0ZWRBdCxcbiAgICAgIGNvbW1lbnRzOiBbLi4udGhyZWFkLmNvbW1lbnRzLCBjb21tZW50XVxuICAgIH07XG4gICAgcmV0dXJuIHVwZGF0ZWRUaHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5lZGl0ZWRBdCA9PT0gdm9pZCAwIHx8IGNvbW1lbnQuZWRpdGVkQXQgPT09IHZvaWQgMCB8fCBleGlzdGluZ0NvbW1lbnQuZWRpdGVkQXQgPD0gY29tbWVudC5lZGl0ZWRBdCkge1xuICAgIGNvbnN0IHVwZGF0ZWRDb21tZW50cyA9IHRocmVhZC5jb21tZW50cy5tYXAoXG4gICAgICAoZXhpc3RpbmdDb21tZW50MikgPT4gZXhpc3RpbmdDb21tZW50Mi5pZCA9PT0gY29tbWVudC5pZCA/IGNvbW1lbnQgOiBleGlzdGluZ0NvbW1lbnQyXG4gICAgKTtcbiAgICBjb25zdCB1cGRhdGVkVGhyZWFkID0ge1xuICAgICAgLi4udGhyZWFkLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShcbiAgICAgICAgTWF0aC5tYXgoXG4gICAgICAgICAgdGhyZWFkLnVwZGF0ZWRBdD8uZ2V0VGltZSgpIHx8IDAsXG4gICAgICAgICAgY29tbWVudC5lZGl0ZWRBdD8uZ2V0VGltZSgpIHx8IGNvbW1lbnQuY3JlYXRlZEF0LmdldFRpbWUoKVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgY29tbWVudHM6IHVwZGF0ZWRDb21tZW50c1xuICAgIH07XG4gICAgcmV0dXJuIHVwZGF0ZWRUaHJlYWQ7XG4gIH1cbiAgcmV0dXJuIHRocmVhZDtcbn1cbmZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQodGhyZWFkLCBjb21tZW50SWQsIGRlbGV0ZWRBdCkge1xuICBpZiAodGhyZWFkLmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCBleGlzdGluZ0NvbW1lbnQgPSB0aHJlYWQuY29tbWVudHMuZmluZChcbiAgICAoY29tbWVudCkgPT4gY29tbWVudC5pZCA9PT0gY29tbWVudElkXG4gICk7XG4gIGlmIChleGlzdGluZ0NvbW1lbnQgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgaWYgKGV4aXN0aW5nQ29tbWVudC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgdXBkYXRlZENvbW1lbnRzID0gdGhyZWFkLmNvbW1lbnRzLm1hcChcbiAgICAoY29tbWVudCkgPT4gY29tbWVudC5pZCA9PT0gY29tbWVudElkID8ge1xuICAgICAgLi4uY29tbWVudCxcbiAgICAgIGRlbGV0ZWRBdCxcbiAgICAgIGJvZHk6IHZvaWQgMFxuICAgIH0gOiBjb21tZW50XG4gICk7XG4gIGlmICghdXBkYXRlZENvbW1lbnRzLnNvbWUoKGNvbW1lbnQpID0+IGNvbW1lbnQuZGVsZXRlZEF0ID09PSB2b2lkIDApKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRocmVhZCxcbiAgICAgIGRlbGV0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogZGVsZXRlZEF0LFxuICAgICAgY29tbWVudHM6IFtdXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIC4uLnRocmVhZCxcbiAgICB1cGRhdGVkQXQ6IGRlbGV0ZWRBdCxcbiAgICBjb21tZW50czogdXBkYXRlZENvbW1lbnRzXG4gIH07XG59XG5mdW5jdGlvbiBhZGRSZWFjdGlvbih0aHJlYWQsIGNvbW1lbnRJZCwgcmVhY3Rpb24pIHtcbiAgaWYgKHRocmVhZC5kZWxldGVkQXQgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0aHJlYWQ7XG4gIH1cbiAgY29uc3QgZXhpc3RpbmdDb21tZW50ID0gdGhyZWFkLmNvbW1lbnRzLmZpbmQoXG4gICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IGNvbW1lbnRJZFxuICApO1xuICBpZiAoZXhpc3RpbmdDb21tZW50ID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGlmIChleGlzdGluZ0NvbW1lbnQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGNvbnN0IHVwZGF0ZWRDb21tZW50cyA9IHRocmVhZC5jb21tZW50cy5tYXAoXG4gICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IGNvbW1lbnRJZCA/IHtcbiAgICAgIC4uLmNvbW1lbnQsXG4gICAgICByZWFjdGlvbnM6IHVwc2VydFJlYWN0aW9uKGNvbW1lbnQucmVhY3Rpb25zLCByZWFjdGlvbilcbiAgICB9IDogY29tbWVudFxuICApO1xuICByZXR1cm4ge1xuICAgIC4uLnRocmVhZCxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKFxuICAgICAgTWF0aC5tYXgocmVhY3Rpb24uY3JlYXRlZEF0LmdldFRpbWUoKSwgdGhyZWFkLnVwZGF0ZWRBdD8uZ2V0VGltZSgpIHx8IDApXG4gICAgKSxcbiAgICBjb21tZW50czogdXBkYXRlZENvbW1lbnRzXG4gIH07XG59XG5mdW5jdGlvbiByZW1vdmVSZWFjdGlvbih0aHJlYWQsIGNvbW1lbnRJZCwgZW1vamksIHVzZXJJZCwgcmVtb3ZlZEF0KSB7XG4gIGlmICh0aHJlYWQuZGVsZXRlZEF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGhyZWFkO1xuICB9XG4gIGNvbnN0IGV4aXN0aW5nQ29tbWVudCA9IHRocmVhZC5jb21tZW50cy5maW5kKFxuICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSBjb21tZW50SWRcbiAgKTtcbiAgaWYgKGV4aXN0aW5nQ29tbWVudCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBpZiAoZXhpc3RpbmdDb21tZW50LmRlbGV0ZWRBdCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRocmVhZDtcbiAgfVxuICBjb25zdCB1cGRhdGVkQ29tbWVudHMgPSB0aHJlYWQuY29tbWVudHMubWFwKFxuICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSBjb21tZW50SWQgPyB7XG4gICAgICAuLi5jb21tZW50LFxuICAgICAgcmVhY3Rpb25zOiBjb21tZW50LnJlYWN0aW9ucy5tYXAoXG4gICAgICAgIChyZWFjdGlvbikgPT4gcmVhY3Rpb24uZW1vamkgPT09IGVtb2ppID8ge1xuICAgICAgICAgIC4uLnJlYWN0aW9uLFxuICAgICAgICAgIHVzZXJzOiByZWFjdGlvbi51c2Vycy5maWx0ZXIoKHVzZXIpID0+IHVzZXIuaWQgIT09IHVzZXJJZClcbiAgICAgICAgfSA6IHJlYWN0aW9uXG4gICAgICApLmZpbHRlcigocmVhY3Rpb24pID0+IHJlYWN0aW9uLnVzZXJzLmxlbmd0aCA+IDApXG4gICAgICAvLyBSZW1vdmUgcmVhY3Rpb25zIHdpdGggbm8gdXNlcnMgbGVmdFxuICAgIH0gOiBjb21tZW50XG4gICk7XG4gIHJldHVybiB7XG4gICAgLi4udGhyZWFkLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoXG4gICAgICBNYXRoLm1heChyZW1vdmVkQXQuZ2V0VGltZSgpLCB0aHJlYWQudXBkYXRlZEF0Py5nZXRUaW1lKCkgfHwgMClcbiAgICApLFxuICAgIGNvbW1lbnRzOiB1cGRhdGVkQ29tbWVudHNcbiAgfTtcbn1cbmZ1bmN0aW9uIHVwc2VydFJlYWN0aW9uKHJlYWN0aW9ucywgcmVhY3Rpb24pIHtcbiAgY29uc3QgZXhpc3RpbmdSZWFjdGlvbiA9IHJlYWN0aW9ucy5maW5kKFxuICAgIChleGlzdGluZ1JlYWN0aW9uMikgPT4gZXhpc3RpbmdSZWFjdGlvbjIuZW1vamkgPT09IHJlYWN0aW9uLmVtb2ppXG4gICk7XG4gIGlmIChleGlzdGluZ1JlYWN0aW9uID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gW1xuICAgICAgLi4ucmVhY3Rpb25zLFxuICAgICAge1xuICAgICAgICBlbW9qaTogcmVhY3Rpb24uZW1vamksXG4gICAgICAgIGNyZWF0ZWRBdDogcmVhY3Rpb24uY3JlYXRlZEF0LFxuICAgICAgICB1c2VyczogW3sgaWQ6IHJlYWN0aW9uLnVzZXJJZCB9XVxuICAgICAgfVxuICAgIF07XG4gIH1cbiAgaWYgKGV4aXN0aW5nUmVhY3Rpb24udXNlcnMuc29tZSgodXNlcikgPT4gdXNlci5pZCA9PT0gcmVhY3Rpb24udXNlcklkKSA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gcmVhY3Rpb25zLm1hcChcbiAgICAgIChleGlzdGluZ1JlYWN0aW9uMikgPT4gZXhpc3RpbmdSZWFjdGlvbjIuZW1vamkgPT09IHJlYWN0aW9uLmVtb2ppID8ge1xuICAgICAgICAuLi5leGlzdGluZ1JlYWN0aW9uMixcbiAgICAgICAgdXNlcnM6IFsuLi5leGlzdGluZ1JlYWN0aW9uMi51c2VycywgeyBpZDogcmVhY3Rpb24udXNlcklkIH1dXG4gICAgICB9IDogZXhpc3RpbmdSZWFjdGlvbjJcbiAgICApO1xuICB9XG4gIHJldHVybiByZWFjdGlvbnM7XG59XG5cbi8vIHNyYy9jbGllbnQudHNcbnZhciBNSU5fVEhST1RUTEUgPSAxNjtcbnZhciBNQVhfVEhST1RUTEUgPSAxZTM7XG52YXIgREVGQVVMVF9USFJPVFRMRSA9IDEwMDtcbnZhciBNSU5fQkFDS0dST1VORF9LRUVQX0FMSVZFX1RJTUVPVVQgPSAxNWUzO1xudmFyIE1JTl9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCA9IDIwMDtcbnZhciBSRUNPTU1FTkRFRF9NSU5fTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQgPSAxZTM7XG52YXIgTUFYX0xPU1RfQ09OTkVDVElPTl9USU1FT1VUID0gM2U0O1xudmFyIERFRkFVTFRfTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQgPSA1ZTM7XG52YXIgUkVTT0xWRV9VU0VSU19CQVRDSF9ERUxBWSA9IDUwO1xudmFyIFJFU09MVkVfUk9PTVNfSU5GT19CQVRDSF9ERUxBWSA9IDUwO1xuZnVuY3Rpb24gZ2V0QmFzZVVybChiYXNlVXJsKSB7XG4gIGlmICh0eXBlb2YgYmFzZVVybCA9PT0gXCJzdHJpbmdcIiAmJiBiYXNlVXJsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgcmV0dXJuIGJhc2VVcmw7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERFRkFVTFRfQkFTRV9VUkw7XG4gIH1cbn1cbmZ1bmN0aW9uIGdldEF1dGhCZWFyZXJIZWFkZXJGcm9tQXV0aFZhbHVlKGF1dGhWYWx1ZSkge1xuICBpZiAoYXV0aFZhbHVlLnR5cGUgPT09IFwicHVibGljXCIpIHtcbiAgICByZXR1cm4gYXV0aFZhbHVlLnB1YmxpY0FwaUtleTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXV0aFZhbHVlLnRva2VuLnJhdztcbiAgfVxufVxuZnVuY3Rpb24gY3JlYXRlQ2xpZW50KG9wdGlvbnMpIHtcbiAgY29uc3QgY2xpZW50T3B0aW9ucyA9IG9wdGlvbnM7XG4gIGNvbnN0IHRocm90dGxlRGVsYXkgPSBnZXRUaHJvdHRsZShjbGllbnRPcHRpb25zLnRocm90dGxlID8/IERFRkFVTFRfVEhST1RUTEUpO1xuICBjb25zdCBsb3N0Q29ubmVjdGlvblRpbWVvdXQgPSBnZXRMb3N0Q29ubmVjdGlvblRpbWVvdXQoXG4gICAgY2xpZW50T3B0aW9ucy5sb3N0Q29ubmVjdGlvblRpbWVvdXQgPz8gREVGQVVMVF9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVFxuICApO1xuICBjb25zdCBiYWNrZ3JvdW5kS2VlcEFsaXZlVGltZW91dCA9IGdldEJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0KFxuICAgIGNsaWVudE9wdGlvbnMuYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXRcbiAgKTtcbiAgY29uc3QgYmFzZVVybCA9IGdldEJhc2VVcmwoY2xpZW50T3B0aW9ucy5iYXNlVXJsKTtcbiAgY29uc3QgYXV0aE1hbmFnZXIgPSBjcmVhdGVBdXRoTWFuYWdlcihvcHRpb25zKTtcbiAgY29uc3Qgcm9vbXNCeUlkID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgZnVuY3Rpb24gdGVhcmRvd25Sb29tKHJvb20pIHtcbiAgICB1bmxpbmtEZXZUb29scyhyb29tLmlkKTtcbiAgICByb29tc0J5SWQuZGVsZXRlKHJvb20uaWQpO1xuICAgIHJvb20uZGVzdHJveSgpO1xuICB9XG4gIGZ1bmN0aW9uIGxlYXNlUm9vbShkZXRhaWxzKSB7XG4gICAgY29uc3QgbGVhdmUgPSAoKSA9PiB7XG4gICAgICBjb25zdCBzZWxmID0gbGVhdmU7XG4gICAgICBpZiAoIWRldGFpbHMudW5zdWJzLmRlbGV0ZShzZWxmKSkge1xuICAgICAgICB3YXJuKFxuICAgICAgICAgIFwiVGhpcyBsZWF2ZSBmdW5jdGlvbiB3YXMgYWxyZWFkeSBjYWxsZWQuIENhbGxpbmcgaXQgbW9yZSB0aGFuIG9uY2UgaGFzIG5vIGVmZmVjdC5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGRldGFpbHMudW5zdWJzLnNpemUgPT09IDApIHtcbiAgICAgICAgICB0ZWFyZG93blJvb20oZGV0YWlscy5yb29tKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgZGV0YWlscy51bnN1YnMuYWRkKGxlYXZlKTtcbiAgICByZXR1cm4ge1xuICAgICAgcm9vbTogZGV0YWlscy5yb29tLFxuICAgICAgbGVhdmVcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGVudGVyUm9vbShyb29tSWQsIC4uLmFyZ3MpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IHJvb21zQnlJZC5nZXQocm9vbUlkKTtcbiAgICBpZiAoZXhpc3RpbmcgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGxlYXNlUm9vbShleGlzdGluZyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdGlvbnMyID0gYXJnc1swXSA/PyB7fTtcbiAgICBjb25zdCBpbml0aWFsUHJlc2VuY2UgPSAodHlwZW9mIG9wdGlvbnMyLmluaXRpYWxQcmVzZW5jZSA9PT0gXCJmdW5jdGlvblwiID8gb3B0aW9uczIuaW5pdGlhbFByZXNlbmNlKHJvb21JZCkgOiBvcHRpb25zMi5pbml0aWFsUHJlc2VuY2UpID8/IHt9O1xuICAgIGNvbnN0IGluaXRpYWxTdG9yYWdlID0gKHR5cGVvZiBvcHRpb25zMi5pbml0aWFsU3RvcmFnZSA9PT0gXCJmdW5jdGlvblwiID8gb3B0aW9uczIuaW5pdGlhbFN0b3JhZ2Uocm9vbUlkKSA6IG9wdGlvbnMyLmluaXRpYWxTdG9yYWdlKSA/PyB7fTtcbiAgICBjb25zdCBuZXdSb29tID0gY3JlYXRlUm9vbShcbiAgICAgIHsgaW5pdGlhbFByZXNlbmNlLCBpbml0aWFsU3RvcmFnZSB9LFxuICAgICAge1xuICAgICAgICByb29tSWQsXG4gICAgICAgIHRocm90dGxlRGVsYXksXG4gICAgICAgIGxvc3RDb25uZWN0aW9uVGltZW91dCxcbiAgICAgICAgYmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQsXG4gICAgICAgIHBvbHlmaWxsczogY2xpZW50T3B0aW9ucy5wb2x5ZmlsbHMsXG4gICAgICAgIGRlbGVnYXRlczogY2xpZW50T3B0aW9ucy5tb2NrZWREZWxlZ2F0ZXMgPz8ge1xuICAgICAgICAgIGNyZWF0ZVNvY2tldDogbWFrZUNyZWF0ZVNvY2tldERlbGVnYXRlRm9yUm9vbShcbiAgICAgICAgICAgIHJvb21JZCxcbiAgICAgICAgICAgIGJhc2VVcmwsXG4gICAgICAgICAgICBjbGllbnRPcHRpb25zLnBvbHlmaWxscz8uV2ViU29ja2V0XG4gICAgICAgICAgKSxcbiAgICAgICAgICBhdXRoZW50aWNhdGU6IG1ha2VBdXRoRGVsZWdhdGVGb3JSb29tKHJvb21JZCwgYXV0aE1hbmFnZXIpXG4gICAgICAgIH0sXG4gICAgICAgIGVuYWJsZURlYnVnTG9nZ2luZzogY2xpZW50T3B0aW9ucy5lbmFibGVEZWJ1Z0xvZ2dpbmcsXG4gICAgICAgIHVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzOiBvcHRpb25zMj8udW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMsXG4gICAgICAgIGJhc2VVcmwsXG4gICAgICAgIHVuc3RhYmxlX2ZhbGxiYWNrVG9IVFRQOiAhIWNsaWVudE9wdGlvbnMudW5zdGFibGVfZmFsbGJhY2tUb0hUVFAsXG4gICAgICAgIHVuc3RhYmxlX3N0cmVhbURhdGE6ICEhY2xpZW50T3B0aW9ucy51bnN0YWJsZV9zdHJlYW1EYXRhXG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCBuZXdSb29tRGV0YWlscyA9IHtcbiAgICAgIHJvb206IG5ld1Jvb20sXG4gICAgICB1bnN1YnM6IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KClcbiAgICB9O1xuICAgIHJvb21zQnlJZC5zZXQocm9vbUlkLCBuZXdSb29tRGV0YWlscyk7XG4gICAgc2V0dXBEZXZUb29scygoKSA9PiBBcnJheS5mcm9tKHJvb21zQnlJZC5rZXlzKCkpKTtcbiAgICBsaW5rRGV2VG9vbHMocm9vbUlkLCBuZXdSb29tKTtcbiAgICBjb25zdCBzaG91bGRDb25uZWN0ID0gb3B0aW9uczIuYXV0b0Nvbm5lY3QgPz8gdHJ1ZTtcbiAgICBpZiAoc2hvdWxkQ29ubmVjdCkge1xuICAgICAgaWYgKHR5cGVvZiBhdG9iID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGlmIChjbGllbnRPcHRpb25zLnBvbHlmaWxscz8uYXRvYiA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJZb3UgbmVlZCB0byBwb2x5ZmlsbCBhdG9iIHRvIHVzZSB0aGUgY2xpZW50IGluIHlvdXIgZW52aXJvbm1lbnQuIFBsZWFzZSBmb2xsb3cgdGhlIGluc3RydWN0aW9ucyBhdCBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9lcnJvcnMvbGl2ZWJsb2Nrcy1jbGllbnQvYXRvYi1wb2x5ZmlsbFwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBnbG9iYWwuYXRvYiA9IGNsaWVudE9wdGlvbnMucG9seWZpbGxzLmF0b2I7XG4gICAgICB9XG4gICAgICBuZXdSb29tLmNvbm5lY3QoKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlYXNlUm9vbShuZXdSb29tRGV0YWlscyk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0Um9vbShyb29tSWQpIHtcbiAgICBjb25zdCByb29tID0gcm9vbXNCeUlkLmdldChyb29tSWQpPy5yb29tO1xuICAgIHJldHVybiByb29tID8gcm9vbSA6IG51bGw7XG4gIH1cbiAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgIGF1dGhNYW5hZ2VyLnJlc2V0KCk7XG4gICAgZm9yIChjb25zdCB7IHJvb20gfSBvZiByb29tc0J5SWQudmFsdWVzKCkpIHtcbiAgICAgIGlmICghaXNJZGxlKHJvb20uZ2V0U3RhdHVzKCkpKSB7XG4gICAgICAgIHJvb20ucmVjb25uZWN0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNvbnN0IGN1cnJlbnRVc2VySWRTdG9yZSA9IGNyZWF0ZVN0b3JlKG51bGwpO1xuICBjb25zdCB7XG4gICAgZ2V0SW5ib3hOb3RpZmljYXRpb25zLFxuICAgIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlLFxuICAgIGdldFVucmVhZEluYm94Tm90aWZpY2F0aW9uc0NvdW50LFxuICAgIG1hcmtBbGxJbmJveE5vdGlmaWNhdGlvbnNBc1JlYWQsXG4gICAgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkLFxuICAgIGRlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICBkZWxldGVJbmJveE5vdGlmaWNhdGlvblxuICB9ID0gY3JlYXRlTm90aWZpY2F0aW9uc0FwaSh7XG4gICAgYmFzZVVybCxcbiAgICBmZXRjaGVyOiBjbGllbnRPcHRpb25zLnBvbHlmaWxscz8uZmV0Y2ggfHwgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBmZXRjaCxcbiAgICBhdXRoTWFuYWdlcixcbiAgICBjdXJyZW50VXNlcklkU3RvcmVcbiAgfSk7XG4gIGNvbnN0IGNhY2hlU3RvcmUgPSBjcmVhdGVDbGllbnRTdG9yZSgpO1xuICBjb25zdCByZXNvbHZlVXNlcnMgPSBjbGllbnRPcHRpb25zLnJlc29sdmVVc2VycztcbiAgY29uc3Qgd2FybklmTm9SZXNvbHZlVXNlcnMgPSBjcmVhdGVEZXZlbG9wbWVudFdhcm5pbmcoXG4gICAgKCkgPT4gIXJlc29sdmVVc2VycyxcbiAgICBcIlNldCB0aGUgcmVzb2x2ZVVzZXJzIG9wdGlvbiBpbiBjcmVhdGVDbGllbnQgdG8gc3BlY2lmeSB1c2VyIGluZm8uXCJcbiAgKTtcbiAgY29uc3QgdXNlcnNTdG9yZSA9IGNyZWF0ZUJhdGNoU3RvcmUoXG4gICAgYXN5bmMgKGJhdGNoZWRVc2VySWRzKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWRzID0gYmF0Y2hlZFVzZXJJZHMuZmxhdCgpO1xuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCByZXNvbHZlVXNlcnM/Lih7IHVzZXJJZHMgfSk7XG4gICAgICB3YXJuSWZOb1Jlc29sdmVVc2VycygpO1xuICAgICAgcmV0dXJuIHVzZXJzID8/IHVzZXJJZHMubWFwKCgpID0+IHZvaWQgMCk7XG4gICAgfSxcbiAgICB7IGRlbGF5OiBSRVNPTFZFX1VTRVJTX0JBVENIX0RFTEFZIH1cbiAgKTtcbiAgY29uc3QgcmVzb2x2ZVJvb21zSW5mbyA9IGNsaWVudE9wdGlvbnMucmVzb2x2ZVJvb21zSW5mbztcbiAgY29uc3Qgd2FybklmTm9SZXNvbHZlUm9vbXNJbmZvID0gY3JlYXRlRGV2ZWxvcG1lbnRXYXJuaW5nKFxuICAgICgpID0+ICFyZXNvbHZlUm9vbXNJbmZvLFxuICAgIFwiU2V0IHRoZSByZXNvbHZlUm9vbXNJbmZvIG9wdGlvbiBpbiBjcmVhdGVDbGllbnQgdG8gc3BlY2lmeSByb29tIGluZm8uXCJcbiAgKTtcbiAgY29uc3Qgcm9vbXNJbmZvU3RvcmUgPSBjcmVhdGVCYXRjaFN0b3JlKFxuICAgIGFzeW5jIChiYXRjaGVkUm9vbUlkcykgPT4ge1xuICAgICAgY29uc3Qgcm9vbUlkcyA9IGJhdGNoZWRSb29tSWRzLmZsYXQoKTtcbiAgICAgIGNvbnN0IHJvb21zSW5mbyA9IGF3YWl0IHJlc29sdmVSb29tc0luZm8/Lih7IHJvb21JZHMgfSk7XG4gICAgICB3YXJuSWZOb1Jlc29sdmVSb29tc0luZm8oKTtcbiAgICAgIHJldHVybiByb29tc0luZm8gPz8gcm9vbUlkcy5tYXAoKCkgPT4gdm9pZCAwKTtcbiAgICB9LFxuICAgIHsgZGVsYXk6IFJFU09MVkVfUk9PTVNfSU5GT19CQVRDSF9ERUxBWSB9XG4gICk7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoXG4gICAge1xuICAgICAgZW50ZXJSb29tLFxuICAgICAgZ2V0Um9vbSxcbiAgICAgIGxvZ291dCxcbiAgICAgIGdldEluYm94Tm90aWZpY2F0aW9ucyxcbiAgICAgIGdldEluYm94Tm90aWZpY2F0aW9uc1NpbmNlLFxuICAgICAgZ2V0VW5yZWFkSW5ib3hOb3RpZmljYXRpb25zQ291bnQsXG4gICAgICBtYXJrQWxsSW5ib3hOb3RpZmljYXRpb25zQXNSZWFkLFxuICAgICAgbWFya0luYm94Tm90aWZpY2F0aW9uQXNSZWFkLFxuICAgICAgZGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zLFxuICAgICAgZGVsZXRlSW5ib3hOb3RpZmljYXRpb24sXG4gICAgICAvLyBJbnRlcm5hbFxuICAgICAgW2tJbnRlcm5hbF06IHtcbiAgICAgICAgY3VycmVudFVzZXJJZFN0b3JlLFxuICAgICAgICByZXNvbHZlTWVudGlvblN1Z2dlc3Rpb25zOiBjbGllbnRPcHRpb25zLnJlc29sdmVNZW50aW9uU3VnZ2VzdGlvbnMsXG4gICAgICAgIGNhY2hlU3RvcmUsXG4gICAgICAgIHVzZXJzU3RvcmUsXG4gICAgICAgIHJvb21zSW5mb1N0b3JlLFxuICAgICAgICBnZXRSb29tSWRzKCkge1xuICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHJvb21zQnlJZC5rZXlzKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBrSW50ZXJuYWwsXG4gICAge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICB9XG4gICk7XG59XG52YXIgTm90aWZpY2F0aW9uc0FwaUVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHN0YXR1cywgZGV0YWlscykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgdGhpcy5kZXRhaWxzID0gZGV0YWlscztcbiAgfVxufTtcbmZ1bmN0aW9uIGNoZWNrQm91bmRzKG9wdGlvbiwgdmFsdWUsIG1pbiwgbWF4LCByZWNvbW1lbmRlZE1pbikge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm51bWJlclwiIHx8IHZhbHVlIDwgbWluIHx8IG1heCAhPT0gdm9pZCAwICYmIHZhbHVlID4gbWF4KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgbWF4ICE9PSB2b2lkIDAgPyBgJHtvcHRpb259IHNob3VsZCBiZSBiZXR3ZWVuICR7cmVjb21tZW5kZWRNaW4gPz8gbWlufSBhbmQgJHttYXh9LmAgOiBgJHtvcHRpb259IHNob3VsZCBiZSBhdCBsZWFzdCAke3JlY29tbWVuZGVkTWluID8/IG1pbn0uYFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZ2V0QmFja2dyb3VuZEtlZXBBbGl2ZVRpbWVvdXQodmFsdWUpIHtcbiAgaWYgKHZhbHVlID09PSB2b2lkIDApIHJldHVybiB2b2lkIDA7XG4gIHJldHVybiBjaGVja0JvdW5kcyhcbiAgICBcImJhY2tncm91bmRLZWVwQWxpdmVUaW1lb3V0XCIsXG4gICAgdmFsdWUsXG4gICAgTUlOX0JBQ0tHUk9VTkRfS0VFUF9BTElWRV9USU1FT1VUXG4gICk7XG59XG5mdW5jdGlvbiBnZXRUaHJvdHRsZSh2YWx1ZSkge1xuICByZXR1cm4gY2hlY2tCb3VuZHMoXCJ0aHJvdHRsZVwiLCB2YWx1ZSwgTUlOX1RIUk9UVExFLCBNQVhfVEhST1RUTEUpO1xufVxuZnVuY3Rpb24gZ2V0TG9zdENvbm5lY3Rpb25UaW1lb3V0KHZhbHVlKSB7XG4gIHJldHVybiBjaGVja0JvdW5kcyhcbiAgICBcImxvc3RDb25uZWN0aW9uVGltZW91dFwiLFxuICAgIHZhbHVlLFxuICAgIE1JTl9MT1NUX0NPTk5FQ1RJT05fVElNRU9VVCxcbiAgICBNQVhfTE9TVF9DT05ORUNUSU9OX1RJTUVPVVQsXG4gICAgUkVDT01NRU5ERURfTUlOX0xPU1RfQ09OTkVDVElPTl9USU1FT1VUXG4gICk7XG59XG5mdW5jdGlvbiBjcmVhdGVEZXZlbG9wbWVudFdhcm5pbmcoY29uZGl0aW9uLCAuLi5hcmdzKSB7XG4gIGxldCBoYXNXYXJuZWQgPSBmYWxzZTtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoIWhhc1dhcm5lZCAmJiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gXCJmdW5jdGlvblwiID8gY29uZGl0aW9uKCkgOiBjb25kaXRpb24pKSB7XG4gICAgICAgIHdhcm4oLi4uYXJncyk7XG4gICAgICAgIGhhc1dhcm5lZCA9IHRydWU7XG4gICAgICB9XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgIH07XG4gIH1cbn1cblxuLy8gc3JjL2NvbW1lbnRzL2NvbW1lbnQtYm9keS50c1xuZnVuY3Rpb24gaXNDb21tZW50Qm9keVBhcmFncmFwaChlbGVtZW50KSB7XG4gIHJldHVybiBcInR5cGVcIiBpbiBlbGVtZW50ICYmIGVsZW1lbnQudHlwZSA9PT0gXCJtZW50aW9uXCI7XG59XG5mdW5jdGlvbiBpc0NvbW1lbnRCb2R5VGV4dChlbGVtZW50KSB7XG4gIHJldHVybiAhKFwidHlwZVwiIGluIGVsZW1lbnQpICYmIFwidGV4dFwiIGluIGVsZW1lbnQgJiYgdHlwZW9mIGVsZW1lbnQudGV4dCA9PT0gXCJzdHJpbmdcIjtcbn1cbmZ1bmN0aW9uIGlzQ29tbWVudEJvZHlNZW50aW9uKGVsZW1lbnQpIHtcbiAgcmV0dXJuIFwidHlwZVwiIGluIGVsZW1lbnQgJiYgZWxlbWVudC50eXBlID09PSBcIm1lbnRpb25cIjtcbn1cbmZ1bmN0aW9uIGlzQ29tbWVudEJvZHlMaW5rKGVsZW1lbnQpIHtcbiAgcmV0dXJuIFwidHlwZVwiIGluIGVsZW1lbnQgJiYgZWxlbWVudC50eXBlID09PSBcImxpbmtcIjtcbn1cbnZhciBjb21tZW50Qm9keUVsZW1lbnRzR3VhcmRzID0ge1xuICBwYXJhZ3JhcGg6IGlzQ29tbWVudEJvZHlQYXJhZ3JhcGgsXG4gIHRleHQ6IGlzQ29tbWVudEJvZHlUZXh0LFxuICBsaW5rOiBpc0NvbW1lbnRCb2R5TGluayxcbiAgbWVudGlvbjogaXNDb21tZW50Qm9keU1lbnRpb25cbn07XG52YXIgY29tbWVudEJvZHlFbGVtZW50c1R5cGVzID0ge1xuICBwYXJhZ3JhcGg6IFwiYmxvY2tcIixcbiAgdGV4dDogXCJpbmxpbmVcIixcbiAgbGluazogXCJpbmxpbmVcIixcbiAgbWVudGlvbjogXCJpbmxpbmVcIlxufTtcbmZ1bmN0aW9uIHRyYXZlcnNlQ29tbWVudEJvZHkoYm9keSwgZWxlbWVudE9yVmlzaXRvciwgcG9zc2libHlWaXNpdG9yKSB7XG4gIGlmICghYm9keSB8fCAhYm9keT8uY29udGVudCkge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBlbGVtZW50ID0gdHlwZW9mIGVsZW1lbnRPclZpc2l0b3IgPT09IFwic3RyaW5nXCIgPyBlbGVtZW50T3JWaXNpdG9yIDogdm9pZCAwO1xuICBjb25zdCB0eXBlID0gZWxlbWVudCA/IGNvbW1lbnRCb2R5RWxlbWVudHNUeXBlc1tlbGVtZW50XSA6IFwiYWxsXCI7XG4gIGNvbnN0IGd1YXJkID0gZWxlbWVudCA/IGNvbW1lbnRCb2R5RWxlbWVudHNHdWFyZHNbZWxlbWVudF0gOiAoKSA9PiB0cnVlO1xuICBjb25zdCB2aXNpdG9yID0gdHlwZW9mIGVsZW1lbnRPclZpc2l0b3IgPT09IFwiZnVuY3Rpb25cIiA/IGVsZW1lbnRPclZpc2l0b3IgOiBwb3NzaWJseVZpc2l0b3I7XG4gIGZvciAoY29uc3QgYmxvY2sgb2YgYm9keS5jb250ZW50KSB7XG4gICAgaWYgKHR5cGUgPT09IFwiYWxsXCIgfHwgdHlwZSA9PT0gXCJibG9ja1wiKSB7XG4gICAgICBpZiAoZ3VhcmQoYmxvY2spKSB7XG4gICAgICAgIHZpc2l0b3I/LihibG9jayk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlID09PSBcImFsbFwiIHx8IHR5cGUgPT09IFwiaW5saW5lXCIpIHtcbiAgICAgIGZvciAoY29uc3QgaW5saW5lIG9mIGJsb2NrLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmIChndWFyZChpbmxpbmUpKSB7XG4gICAgICAgICAgdmlzaXRvcj8uKGlubGluZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldE1lbnRpb25lZElkc0Zyb21Db21tZW50Qm9keShib2R5KSB7XG4gIGNvbnN0IG1lbnRpb25lZElkcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gIHRyYXZlcnNlQ29tbWVudEJvZHkoXG4gICAgYm9keSxcbiAgICBcIm1lbnRpb25cIixcbiAgICAobWVudGlvbikgPT4gbWVudGlvbmVkSWRzLmFkZChtZW50aW9uLmlkKVxuICApO1xuICByZXR1cm4gQXJyYXkuZnJvbShtZW50aW9uZWRJZHMpO1xufVxuYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZVVzZXJzSW5Db21tZW50Qm9keShib2R5LCByZXNvbHZlVXNlcnMpIHtcbiAgY29uc3QgcmVzb2x2ZWRVc2VycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGlmICghcmVzb2x2ZVVzZXJzKSB7XG4gICAgcmV0dXJuIHJlc29sdmVkVXNlcnM7XG4gIH1cbiAgY29uc3QgdXNlcklkcyA9IGdldE1lbnRpb25lZElkc0Zyb21Db21tZW50Qm9keShib2R5KTtcbiAgY29uc3QgdXNlcnMgPSBhd2FpdCByZXNvbHZlVXNlcnMoe1xuICAgIHVzZXJJZHNcbiAgfSk7XG4gIGZvciAoY29uc3QgW2luZGV4LCB1c2VySWRdIG9mIHVzZXJJZHMuZW50cmllcygpKSB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJzPy5baW5kZXhdO1xuICAgIGlmICh1c2VyKSB7XG4gICAgICByZXNvbHZlZFVzZXJzLnNldCh1c2VySWQsIHVzZXIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzb2x2ZWRVc2Vycztcbn1cbnZhciBodG1sRXNjYXBhYmxlcyA9IHtcbiAgXCImXCI6IFwiJmFtcDtcIixcbiAgXCI8XCI6IFwiJmx0O1wiLFxuICBcIj5cIjogXCImZ3Q7XCIsXG4gICdcIic6IFwiJnF1b3Q7XCIsXG4gIFwiJ1wiOiBcIiYjMzk7XCJcbn07XG52YXIgaHRtbEVzY2FwYWJsZXNSZWdleCA9IG5ldyBSZWdFeHAoXG4gIE9iamVjdC5rZXlzKGh0bWxFc2NhcGFibGVzKS5tYXAoKGVudGl0eSkgPT4gYFxcXFwke2VudGl0eX1gKS5qb2luKFwifFwiKSxcbiAgXCJnXCJcbik7XG5mdW5jdGlvbiBodG1sU2FmZSh2YWx1ZSkge1xuICByZXR1cm4gbmV3IEh0bWxTYWZlU3RyaW5nKFtTdHJpbmcodmFsdWUpXSwgW10pO1xufVxuZnVuY3Rpb24gam9pbkh0bWwoc3RyaW5ncykge1xuICBpZiAoc3RyaW5ncy5sZW5ndGggPD0gMCkge1xuICAgIHJldHVybiBuZXcgSHRtbFNhZmVTdHJpbmcoW1wiXCJdLCBbXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBIdG1sU2FmZVN0cmluZyhcbiAgICBbXCJcIiwgLi4uQXJyYXkoc3RyaW5ncy5sZW5ndGggLSAxKS5maWxsKFwiXCIpLCBcIlwiXSxcbiAgICBzdHJpbmdzXG4gICk7XG59XG5mdW5jdGlvbiBlc2NhcGVIdG1sKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEh0bWxTYWZlU3RyaW5nKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIGpvaW5IdG1sKHZhbHVlKS50b1N0cmluZygpO1xuICB9XG4gIHJldHVybiBTdHJpbmcodmFsdWUpLnJlcGxhY2UoXG4gICAgaHRtbEVzY2FwYWJsZXNSZWdleCxcbiAgICAoY2hhcmFjdGVyKSA9PiBodG1sRXNjYXBhYmxlc1tjaGFyYWN0ZXJdXG4gICk7XG59XG52YXIgSHRtbFNhZmVTdHJpbmcgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKHN0cmluZ3MsIHZhbHVlcykge1xuICAgIHRoaXMuX3N0cmluZ3MgPSBzdHJpbmdzO1xuICAgIHRoaXMuX3ZhbHVlcyA9IHZhbHVlcztcbiAgfVxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5fc3RyaW5ncy5yZWR1Y2UoKHJlc3VsdCwgc3RyLCBpKSA9PiB7XG4gICAgICByZXR1cm4gcmVzdWx0ICsgZXNjYXBlSHRtbChubih0aGlzLl92YWx1ZXNbaSAtIDFdKSkgKyBzdHI7XG4gICAgfSk7XG4gIH1cbn07XG5mdW5jdGlvbiBodG1sKHN0cmluZ3MsIC4uLnZhbHVlcykge1xuICByZXR1cm4gbmV3IEh0bWxTYWZlU3RyaW5nKHN0cmluZ3MsIHZhbHVlcyk7XG59XG52YXIgbWFya2Rvd25Fc2NhcGFibGVzID0ge1xuICBfOiBcIlxcXFxfXCIsXG4gIFwiKlwiOiBcIlxcXFwqXCIsXG4gIFwiI1wiOiBcIlxcXFwjXCIsXG4gIFwiYFwiOiBcIlxcXFxgXCIsXG4gIFwiflwiOiBcIlxcXFx+XCIsXG4gIFwiIVwiOiBcIlxcXFwhXCIsXG4gIFwifFwiOiBcIlxcXFx8XCIsXG4gIFwiKFwiOiBcIlxcXFwoXCIsXG4gIFwiKVwiOiBcIlxcXFwpXCIsXG4gIFwie1wiOiBcIlxcXFx7XCIsXG4gIFwifVwiOiBcIlxcXFx9XCIsXG4gIFwiW1wiOiBcIlxcXFxbXCIsXG4gIFwiXVwiOiBcIlxcXFxdXCJcbn07XG52YXIgbWFya2Rvd25Fc2NhcGFibGVzUmVnZXggPSBuZXcgUmVnRXhwKFxuICBPYmplY3Qua2V5cyhtYXJrZG93bkVzY2FwYWJsZXMpLm1hcCgoZW50aXR5KSA9PiBgXFxcXCR7ZW50aXR5fWApLmpvaW4oXCJ8XCIpLFxuICBcImdcIlxuKTtcbmZ1bmN0aW9uIGpvaW5NYXJrZG93bihzdHJpbmdzKSB7XG4gIGlmIChzdHJpbmdzLmxlbmd0aCA8PSAwKSB7XG4gICAgcmV0dXJuIG5ldyBNYXJrZG93blNhZmVTdHJpbmcoW1wiXCJdLCBbXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBNYXJrZG93blNhZmVTdHJpbmcoXG4gICAgW1wiXCIsIC4uLkFycmF5KHN0cmluZ3MubGVuZ3RoIC0gMSkuZmlsbChcIlwiKSwgXCJcIl0sXG4gICAgc3RyaW5nc1xuICApO1xufVxuZnVuY3Rpb24gZXNjYXBlTWFya2Rvd24odmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTWFya2Rvd25TYWZlU3RyaW5nKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIGpvaW5NYXJrZG93bih2YWx1ZSkudG9TdHJpbmcoKTtcbiAgfVxuICByZXR1cm4gU3RyaW5nKHZhbHVlKS5yZXBsYWNlKFxuICAgIG1hcmtkb3duRXNjYXBhYmxlc1JlZ2V4LFxuICAgIChjaGFyYWN0ZXIpID0+IG1hcmtkb3duRXNjYXBhYmxlc1tjaGFyYWN0ZXJdXG4gICk7XG59XG52YXIgTWFya2Rvd25TYWZlU3RyaW5nID0gY2xhc3Mge1xuICBjb25zdHJ1Y3RvcihzdHJpbmdzLCB2YWx1ZXMpIHtcbiAgICB0aGlzLl9zdHJpbmdzID0gc3RyaW5ncztcbiAgICB0aGlzLl92YWx1ZXMgPSB2YWx1ZXM7XG4gIH1cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3N0cmluZ3MucmVkdWNlKChyZXN1bHQsIHN0ciwgaSkgPT4ge1xuICAgICAgcmV0dXJuIHJlc3VsdCArIGVzY2FwZU1hcmtkb3duKG5uKHRoaXMuX3ZhbHVlc1tpIC0gMV0pKSArIHN0cjtcbiAgICB9KTtcbiAgfVxufTtcbmZ1bmN0aW9uIG1hcmtkb3duKHN0cmluZ3MsIC4uLnZhbHVlcykge1xuICByZXR1cm4gbmV3IE1hcmtkb3duU2FmZVN0cmluZyhzdHJpbmdzLCB2YWx1ZXMpO1xufVxuZnVuY3Rpb24gdG9BYnNvbHV0ZVVybCh1cmwpIHtcbiAgaWYgKHVybC5zdGFydHNXaXRoKFwiaHR0cDovL1wiKSB8fCB1cmwuc3RhcnRzV2l0aChcImh0dHBzOi8vXCIpKSB7XG4gICAgcmV0dXJuIHVybDtcbiAgfSBlbHNlIGlmICh1cmwuc3RhcnRzV2l0aChcInd3dy5cIikpIHtcbiAgICByZXR1cm4gXCJodHRwczovL1wiICsgdXJsO1xuICB9XG4gIHJldHVybjtcbn1cbnZhciBzdHJpbmdpZnlDb21tZW50Qm9keVBsYWluRWxlbWVudHMgPSB7XG4gIHBhcmFncmFwaDogKHsgY2hpbGRyZW4gfSkgPT4gY2hpbGRyZW4sXG4gIHRleHQ6ICh7IGVsZW1lbnQgfSkgPT4gZWxlbWVudC50ZXh0LFxuICBsaW5rOiAoeyBlbGVtZW50IH0pID0+IGVsZW1lbnQudGV4dCA/PyBlbGVtZW50LnVybCxcbiAgbWVudGlvbjogKHsgZWxlbWVudCwgdXNlciB9KSA9PiB7XG4gICAgcmV0dXJuIGBAJHt1c2VyPy5uYW1lID8/IGVsZW1lbnQuaWR9YDtcbiAgfVxufTtcbnZhciBzdHJpbmdpZnlDb21tZW50Qm9keUh0bWxFbGVtZW50cyA9IHtcbiAgcGFyYWdyYXBoOiAoeyBjaGlsZHJlbiB9KSA9PiB7XG4gICAgcmV0dXJuIGNoaWxkcmVuID8gaHRtbGA8cD4ke2h0bWxTYWZlKGNoaWxkcmVuKX08L3A+YCA6IGNoaWxkcmVuO1xuICB9LFxuICB0ZXh0OiAoeyBlbGVtZW50IH0pID0+IHtcbiAgICBsZXQgY2hpbGRyZW4gPSBlbGVtZW50LnRleHQ7XG4gICAgaWYgKCFjaGlsZHJlbikge1xuICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5ib2xkKSB7XG4gICAgICBjaGlsZHJlbiA9IGh0bWxgPHN0cm9uZz4ke2NoaWxkcmVufTwvc3Ryb25nPmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50Lml0YWxpYykge1xuICAgICAgY2hpbGRyZW4gPSBodG1sYDxlbT4ke2NoaWxkcmVufTwvZW0+YDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuc3RyaWtldGhyb3VnaCkge1xuICAgICAgY2hpbGRyZW4gPSBodG1sYDxzPiR7Y2hpbGRyZW59PC9zPmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50LmNvZGUpIHtcbiAgICAgIGNoaWxkcmVuID0gaHRtbGA8Y29kZT4ke2NoaWxkcmVufTwvY29kZT5gO1xuICAgIH1cbiAgICByZXR1cm4gY2hpbGRyZW47XG4gIH0sXG4gIGxpbms6ICh7IGVsZW1lbnQsIGhyZWYgfSkgPT4ge1xuICAgIHJldHVybiBodG1sYDxhIGhyZWY9XCIke2hyZWZ9XCIgdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9vcGVuZXIgbm9yZWZlcnJlclwiPiR7ZWxlbWVudC50ZXh0ID8/IGVsZW1lbnQudXJsfTwvYT5gO1xuICB9LFxuICBtZW50aW9uOiAoeyBlbGVtZW50LCB1c2VyIH0pID0+IHtcbiAgICByZXR1cm4gaHRtbGA8c3BhbiBkYXRhLW1lbnRpb24+QCR7dXNlcj8ubmFtZSA/PyBlbGVtZW50LmlkfTwvc3Bhbj5gO1xuICB9XG59O1xudmFyIHN0cmluZ2lmeUNvbW1lbnRCb2R5TWFya2Rvd25FbGVtZW50cyA9IHtcbiAgcGFyYWdyYXBoOiAoeyBjaGlsZHJlbiB9KSA9PiB7XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xuICB9LFxuICB0ZXh0OiAoeyBlbGVtZW50IH0pID0+IHtcbiAgICBsZXQgY2hpbGRyZW4gPSBlbGVtZW50LnRleHQ7XG4gICAgaWYgKCFjaGlsZHJlbikge1xuICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5ib2xkKSB7XG4gICAgICBjaGlsZHJlbiA9IG1hcmtkb3duYCoqJHtjaGlsZHJlbn0qKmA7XG4gICAgfVxuICAgIGlmIChlbGVtZW50Lml0YWxpYykge1xuICAgICAgY2hpbGRyZW4gPSBtYXJrZG93bmBfJHtjaGlsZHJlbn1fYDtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuc3RyaWtldGhyb3VnaCkge1xuICAgICAgY2hpbGRyZW4gPSBtYXJrZG93bmB+fiR7Y2hpbGRyZW59fn5gO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5jb2RlKSB7XG4gICAgICBjaGlsZHJlbiA9IG1hcmtkb3duYFxcYCR7Y2hpbGRyZW59XFxgYDtcbiAgICB9XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xuICB9LFxuICBsaW5rOiAoeyBlbGVtZW50LCBocmVmIH0pID0+IHtcbiAgICByZXR1cm4gbWFya2Rvd25gWyR7ZWxlbWVudC50ZXh0ID8/IGVsZW1lbnQudXJsfV0oJHtocmVmfSlgO1xuICB9LFxuICBtZW50aW9uOiAoeyBlbGVtZW50LCB1c2VyIH0pID0+IHtcbiAgICByZXR1cm4gbWFya2Rvd25gQCR7dXNlcj8ubmFtZSA/PyBlbGVtZW50LmlkfWA7XG4gIH1cbn07XG5hc3luYyBmdW5jdGlvbiBzdHJpbmdpZnlDb21tZW50Qm9keShib2R5LCBvcHRpb25zKSB7XG4gIGNvbnN0IGZvcm1hdCA9IG9wdGlvbnM/LmZvcm1hdCA/PyBcInBsYWluXCI7XG4gIGNvbnN0IHNlcGFyYXRvciA9IG9wdGlvbnM/LnNlcGFyYXRvciA/PyAoZm9ybWF0ID09PSBcIm1hcmtkb3duXCIgPyBcIlxcblxcblwiIDogXCJcXG5cIik7XG4gIGNvbnN0IGVsZW1lbnRzID0ge1xuICAgIC4uLmZvcm1hdCA9PT0gXCJodG1sXCIgPyBzdHJpbmdpZnlDb21tZW50Qm9keUh0bWxFbGVtZW50cyA6IGZvcm1hdCA9PT0gXCJtYXJrZG93blwiID8gc3RyaW5naWZ5Q29tbWVudEJvZHlNYXJrZG93bkVsZW1lbnRzIDogc3RyaW5naWZ5Q29tbWVudEJvZHlQbGFpbkVsZW1lbnRzLFxuICAgIC4uLm9wdGlvbnM/LmVsZW1lbnRzXG4gIH07XG4gIGNvbnN0IHJlc29sdmVkVXNlcnMgPSBhd2FpdCByZXNvbHZlVXNlcnNJbkNvbW1lbnRCb2R5KFxuICAgIGJvZHksXG4gICAgb3B0aW9ucz8ucmVzb2x2ZVVzZXJzXG4gICk7XG4gIGNvbnN0IGJsb2NrcyA9IGJvZHkuY29udGVudC5mbGF0TWFwKChibG9jaywgYmxvY2tJbmRleCkgPT4ge1xuICAgIHN3aXRjaCAoYmxvY2sudHlwZSkge1xuICAgICAgY2FzZSBcInBhcmFncmFwaFwiOiB7XG4gICAgICAgIGNvbnN0IGlubGluZXMgPSBibG9jay5jaGlsZHJlbi5mbGF0TWFwKChpbmxpbmUsIGlubGluZUluZGV4KSA9PiB7XG4gICAgICAgICAgaWYgKGlzQ29tbWVudEJvZHlNZW50aW9uKGlubGluZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBpbmxpbmUuaWQgPyBbXG4gICAgICAgICAgICAgIGVsZW1lbnRzLm1lbnRpb24oXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgZWxlbWVudDogaW5saW5lLFxuICAgICAgICAgICAgICAgICAgdXNlcjogcmVzb2x2ZWRVc2Vycy5nZXQoaW5saW5lLmlkKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5saW5lSW5kZXhcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSA6IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNDb21tZW50Qm9keUxpbmsoaW5saW5lKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgZWxlbWVudHMubGluayhcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBlbGVtZW50OiBpbmxpbmUsXG4gICAgICAgICAgICAgICAgICBocmVmOiB0b0Fic29sdXRlVXJsKGlubGluZS51cmwpID8/IGlubGluZS51cmxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlubGluZUluZGV4XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc0NvbW1lbnRCb2R5VGV4dChpbmxpbmUpKSB7XG4gICAgICAgICAgICByZXR1cm4gW2VsZW1lbnRzLnRleHQoeyBlbGVtZW50OiBpbmxpbmUgfSwgaW5saW5lSW5kZXgpXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBlbGVtZW50cy5wYXJhZ3JhcGgoXG4gICAgICAgICAgICB7IGVsZW1lbnQ6IGJsb2NrLCBjaGlsZHJlbjogaW5saW5lcy5qb2luKFwiXCIpIH0sXG4gICAgICAgICAgICBibG9ja0luZGV4XG4gICAgICAgICAgKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBibG9ja3Muam9pbihzZXBhcmF0b3IpO1xufVxuXG4vLyBzcmMvY3JkdHMvdXRpbHMudHNcbmZ1bmN0aW9uIHRvUGxhaW5Mc29uKGxzb24pIHtcbiAgaWYgKGxzb24gaW5zdGFuY2VvZiBMaXZlT2JqZWN0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpdmVibG9ja3NUeXBlOiBcIkxpdmVPYmplY3RcIixcbiAgICAgIGRhdGE6IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgT2JqZWN0LmVudHJpZXMobHNvbi50b09iamVjdCgpKS5mbGF0TWFwKFxuICAgICAgICAgIChba2V5LCB2YWx1ZV0pID0+IHZhbHVlICE9PSB2b2lkIDAgPyBbW2tleSwgdG9QbGFpbkxzb24odmFsdWUpXV0gOiBbXVxuICAgICAgICApXG4gICAgICApXG4gICAgfTtcbiAgfSBlbHNlIGlmIChsc29uIGluc3RhbmNlb2YgTGl2ZU1hcCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaXZlYmxvY2tzVHlwZTogXCJMaXZlTWFwXCIsXG4gICAgICBkYXRhOiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIFsuLi5sc29uXS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgdG9QbGFpbkxzb24odmFsdWUpXSlcbiAgICAgIClcbiAgICB9O1xuICB9IGVsc2UgaWYgKGxzb24gaW5zdGFuY2VvZiBMaXZlTGlzdCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaXZlYmxvY2tzVHlwZTogXCJMaXZlTGlzdFwiLFxuICAgICAgZGF0YTogWy4uLmxzb25dLm1hcCgoaXRlbSkgPT4gdG9QbGFpbkxzb24oaXRlbSkpXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbHNvbjtcbiAgfVxufVxuXG4vLyBzcmMvaW1tdXRhYmxlLnRzXG5mdW5jdGlvbiBsc29uT2JqZWN0VG9Kc29uKG9iaikge1xuICBjb25zdCByZXN1bHQgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgY29uc3QgdmFsID0gb2JqW2tleV07XG4gICAgaWYgKHZhbCAhPT0gdm9pZCAwKSB7XG4gICAgICByZXN1bHRba2V5XSA9IGxzb25Ub0pzb24odmFsKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGxpdmVPYmplY3RUb0pzb24obGl2ZU9iamVjdCkge1xuICByZXR1cm4gbHNvbk9iamVjdFRvSnNvbihsaXZlT2JqZWN0LnRvT2JqZWN0KCkpO1xufVxuZnVuY3Rpb24gbGl2ZU1hcFRvSnNvbihtYXApIHtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG1hcC5lbnRyaWVzKCkpIHtcbiAgICByZXN1bHRba2V5XSA9IGxzb25Ub0pzb24odmFsdWUpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBsc29uTGlzdFRvSnNvbih2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUubWFwKGxzb25Ub0pzb24pO1xufVxuZnVuY3Rpb24gbGl2ZUxpc3RUb0pzb24odmFsdWUpIHtcbiAgcmV0dXJuIGxzb25MaXN0VG9Kc29uKHZhbHVlLnRvQXJyYXkoKSk7XG59XG5mdW5jdGlvbiBsc29uVG9Kc29uKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdmVPYmplY3QpIHtcbiAgICByZXR1cm4gbGl2ZU9iamVjdFRvSnNvbih2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlTGlzdCkge1xuICAgIHJldHVybiBsaXZlTGlzdFRvSnNvbih2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXZlTWFwKSB7XG4gICAgcmV0dXJuIGxpdmVNYXBUb0pzb24odmFsdWUpO1xuICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgTGl2ZVJlZ2lzdGVyKSB7XG4gICAgcmV0dXJuIHZhbHVlLmRhdGE7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIGxzb25MaXN0VG9Kc29uKHZhbHVlKTtcbiAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KHZhbHVlKSkge1xuICAgIHJldHVybiBsc29uT2JqZWN0VG9Kc29uKHZhbHVlKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBkZWVwTGl2ZWlmeSh2YWx1ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gbmV3IExpdmVMaXN0KHZhbHVlLm1hcChkZWVwTGl2ZWlmeSkpO1xuICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgY29uc3QgaW5pdCA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIHZhbHVlKSB7XG4gICAgICBjb25zdCB2YWwgPSB2YWx1ZVtrZXldO1xuICAgICAgaWYgKHZhbCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaW5pdFtrZXldID0gZGVlcExpdmVpZnkodmFsKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBMaXZlT2JqZWN0KGluaXQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxufVxuZnVuY3Rpb24gcGF0Y2hMaXZlTGlzdChsaXZlTGlzdCwgcHJldiwgbmV4dCkge1xuICBsZXQgaSA9IDA7XG4gIGxldCBwcmV2RW5kID0gcHJldi5sZW5ndGggLSAxO1xuICBsZXQgbmV4dEVuZCA9IG5leHQubGVuZ3RoIC0gMTtcbiAgbGV0IHByZXZOb2RlID0gcHJldlswXTtcbiAgbGV0IG5leHROb2RlID0gbmV4dFswXTtcbiAgb3V0ZXI6IHtcbiAgICB3aGlsZSAocHJldk5vZGUgPT09IG5leHROb2RlKSB7XG4gICAgICArK2k7XG4gICAgICBpZiAoaSA+IHByZXZFbmQgfHwgaSA+IG5leHRFbmQpIHtcbiAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICB9XG4gICAgICBwcmV2Tm9kZSA9IHByZXZbaV07XG4gICAgICBuZXh0Tm9kZSA9IG5leHRbaV07XG4gICAgfVxuICAgIHByZXZOb2RlID0gcHJldltwcmV2RW5kXTtcbiAgICBuZXh0Tm9kZSA9IG5leHRbbmV4dEVuZF07XG4gICAgd2hpbGUgKHByZXZOb2RlID09PSBuZXh0Tm9kZSkge1xuICAgICAgcHJldkVuZC0tO1xuICAgICAgbmV4dEVuZC0tO1xuICAgICAgaWYgKGkgPiBwcmV2RW5kIHx8IGkgPiBuZXh0RW5kKSB7XG4gICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgfVxuICAgICAgcHJldk5vZGUgPSBwcmV2W3ByZXZFbmRdO1xuICAgICAgbmV4dE5vZGUgPSBuZXh0W25leHRFbmRdO1xuICAgIH1cbiAgfVxuICBpZiAoaSA+IHByZXZFbmQpIHtcbiAgICBpZiAoaSA8PSBuZXh0RW5kKSB7XG4gICAgICB3aGlsZSAoaSA8PSBuZXh0RW5kKSB7XG4gICAgICAgIGxpdmVMaXN0Lmluc2VydChkZWVwTGl2ZWlmeShuZXh0W2ldKSwgaSk7XG4gICAgICAgIGkrKztcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAoaSA+IG5leHRFbmQpIHtcbiAgICBsZXQgbG9jYWxJID0gaTtcbiAgICB3aGlsZSAobG9jYWxJIDw9IHByZXZFbmQpIHtcbiAgICAgIGxpdmVMaXN0LmRlbGV0ZShpKTtcbiAgICAgIGxvY2FsSSsrO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB3aGlsZSAoaSA8PSBwcmV2RW5kICYmIGkgPD0gbmV4dEVuZCkge1xuICAgICAgcHJldk5vZGUgPSBwcmV2W2ldO1xuICAgICAgbmV4dE5vZGUgPSBuZXh0W2ldO1xuICAgICAgY29uc3QgbGl2ZUxpc3ROb2RlID0gbGl2ZUxpc3QuZ2V0KGkpO1xuICAgICAgaWYgKGlzTGl2ZU9iamVjdChsaXZlTGlzdE5vZGUpICYmIGlzUGxhaW5PYmplY3QocHJldk5vZGUpICYmIGlzUGxhaW5PYmplY3QobmV4dE5vZGUpKSB7XG4gICAgICAgIHBhdGNoTGl2ZU9iamVjdChsaXZlTGlzdE5vZGUsIHByZXZOb2RlLCBuZXh0Tm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaXZlTGlzdC5zZXQoaSwgZGVlcExpdmVpZnkobmV4dE5vZGUpKTtcbiAgICAgIH1cbiAgICAgIGkrKztcbiAgICB9XG4gICAgd2hpbGUgKGkgPD0gbmV4dEVuZCkge1xuICAgICAgbGl2ZUxpc3QuaW5zZXJ0KGRlZXBMaXZlaWZ5KG5leHRbaV0pLCBpKTtcbiAgICAgIGkrKztcbiAgICB9XG4gICAgbGV0IGxvY2FsSSA9IGk7XG4gICAgd2hpbGUgKGxvY2FsSSA8PSBwcmV2RW5kKSB7XG4gICAgICBsaXZlTGlzdC5kZWxldGUoaSk7XG4gICAgICBsb2NhbEkrKztcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHBhdGNoTGl2ZU9iamVjdEtleShsaXZlT2JqZWN0LCBrZXksIHByZXYsIG5leHQpIHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgIGNvbnN0IG5vblNlcmlhbGl6YWJsZVZhbHVlID0gZmluZE5vblNlcmlhbGl6YWJsZVZhbHVlKG5leHQpO1xuICAgIGlmIChub25TZXJpYWxpemFibGVWYWx1ZSkge1xuICAgICAgZXJyb3IyKFxuICAgICAgICBgTmV3IHN0YXRlIHBhdGg6ICcke25vblNlcmlhbGl6YWJsZVZhbHVlLnBhdGh9JyB2YWx1ZTogJyR7U3RyaW5nKFxuICAgICAgICAgIG5vblNlcmlhbGl6YWJsZVZhbHVlLnZhbHVlXG4gICAgICAgICl9JyBpcyBub3Qgc2VyaWFsaXphYmxlLlxuT25seSBzZXJpYWxpemFibGUgdmFsdWUgY2FuIGJlIHN5bmNlZCB3aXRoIExpdmVibG9ja3MuYFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgY29uc3QgdmFsdWUgPSBsaXZlT2JqZWN0LmdldChrZXkpO1xuICBpZiAobmV4dCA9PT0gdm9pZCAwKSB7XG4gICAgbGl2ZU9iamVjdC5kZWxldGUoa2V5KTtcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgbGl2ZU9iamVjdC5zZXQoa2V5LCBkZWVwTGl2ZWlmeShuZXh0KSk7XG4gIH0gZWxzZSBpZiAocHJldiA9PT0gbmV4dCkge1xuICAgIHJldHVybjtcbiAgfSBlbHNlIGlmIChpc0xpdmVMaXN0KHZhbHVlKSAmJiBBcnJheS5pc0FycmF5KHByZXYpICYmIEFycmF5LmlzQXJyYXkobmV4dCkpIHtcbiAgICBwYXRjaExpdmVMaXN0KHZhbHVlLCBwcmV2LCBuZXh0KTtcbiAgfSBlbHNlIGlmIChpc0xpdmVPYmplY3QodmFsdWUpICYmIGlzUGxhaW5PYmplY3QocHJldikgJiYgaXNQbGFpbk9iamVjdChuZXh0KSkge1xuICAgIHBhdGNoTGl2ZU9iamVjdCh2YWx1ZSwgcHJldiwgbmV4dCk7XG4gIH0gZWxzZSB7XG4gICAgbGl2ZU9iamVjdC5zZXQoa2V5LCBkZWVwTGl2ZWlmeShuZXh0KSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHBhdGNoTGl2ZU9iamVjdChyb290LCBwcmV2LCBuZXh0KSB7XG4gIGNvbnN0IHVwZGF0ZXMgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gbmV4dCkge1xuICAgIHBhdGNoTGl2ZU9iamVjdEtleShyb290LCBrZXksIHByZXZba2V5XSwgbmV4dFtrZXldKTtcbiAgfVxuICBmb3IgKGNvbnN0IGtleSBpbiBwcmV2KSB7XG4gICAgaWYgKG5leHRba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICByb290LmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgfVxuICBpZiAoT2JqZWN0LmtleXModXBkYXRlcykubGVuZ3RoID4gMCkge1xuICAgIHJvb3QudXBkYXRlKHVwZGF0ZXMpO1xuICB9XG59XG5mdW5jdGlvbiBnZXRQYXJlbnRzUGF0aChub2RlKSB7XG4gIGNvbnN0IHBhdGggPSBbXTtcbiAgd2hpbGUgKG5vZGUucGFyZW50LnR5cGUgPT09IFwiSGFzUGFyZW50XCIpIHtcbiAgICBpZiAoaXNMaXZlTGlzdChub2RlLnBhcmVudC5ub2RlKSkge1xuICAgICAgcGF0aC5wdXNoKG5vZGUucGFyZW50Lm5vZGUuX2luZGV4T2ZQb3NpdGlvbihub2RlLnBhcmVudC5rZXkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGF0aC5wdXNoKG5vZGUucGFyZW50LmtleSk7XG4gICAgfVxuICAgIG5vZGUgPSBub2RlLnBhcmVudC5ub2RlO1xuICB9XG4gIHJldHVybiBwYXRoO1xufVxuZnVuY3Rpb24gbGVnYWN5X3BhdGNoSW1tdXRhYmxlT2JqZWN0KHN0YXRlLCB1cGRhdGVzKSB7XG4gIHJldHVybiB1cGRhdGVzLnJlZHVjZShcbiAgICAoc3RhdGUyLCB1cGRhdGUpID0+IGxlZ2FjeV9wYXRjaEltbXV0YWJsZU9iamVjdFdpdGhVcGRhdGUoc3RhdGUyLCB1cGRhdGUpLFxuICAgIHN0YXRlXG4gICk7XG59XG5mdW5jdGlvbiBsZWdhY3lfcGF0Y2hJbW11dGFibGVPYmplY3RXaXRoVXBkYXRlKHN0YXRlLCB1cGRhdGUpIHtcbiAgY29uc3QgcGF0aCA9IGdldFBhcmVudHNQYXRoKHVwZGF0ZS5ub2RlKTtcbiAgcmV0dXJuIGxlZ2FjeV9wYXRjaEltbXV0YWJsZU5vZGUoc3RhdGUsIHBhdGgsIHVwZGF0ZSk7XG59XG5mdW5jdGlvbiBsZWdhY3lfcGF0Y2hJbW11dGFibGVOb2RlKHN0YXRlLCBwYXRoLCB1cGRhdGUpIHtcbiAgY29uc3QgcGF0aEl0ZW0gPSBwYXRoLnBvcCgpO1xuICBpZiAocGF0aEl0ZW0gPT09IHZvaWQgMCkge1xuICAgIHN3aXRjaCAodXBkYXRlLnR5cGUpIHtcbiAgICAgIGNhc2UgXCJMaXZlT2JqZWN0XCI6IHtcbiAgICAgICAgaWYgKCFpc0pzb25PYmplY3Qoc3RhdGUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJJbnRlcm5hbDogcmVjZWl2ZWQgdXBkYXRlIG9uIExpdmVPYmplY3QgYnV0IHN0YXRlIHdhcyBub3QgYW4gb2JqZWN0XCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB1cGRhdGUudXBkYXRlcykge1xuICAgICAgICAgIGlmICh1cGRhdGUudXBkYXRlc1trZXldPy50eXBlID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB2YWwgPSB1cGRhdGUubm9kZS5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWwgIT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICBuZXdTdGF0ZVtrZXldID0gbHNvblRvSnNvbih2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAodXBkYXRlLnVwZGF0ZXNba2V5XT8udHlwZSA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgZGVsZXRlIG5ld1N0YXRlW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJMaXZlTGlzdFwiOiB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIkludGVybmFsOiByZWNlaXZlZCB1cGRhdGUgb24gTGl2ZUxpc3QgYnV0IHN0YXRlIHdhcyBub3QgYW4gYXJyYXlcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5ld1N0YXRlID0gc3RhdGUubWFwKCh4KSA9PiB4KTtcbiAgICAgICAgZm9yIChjb25zdCBsaXN0VXBkYXRlIG9mIHVwZGF0ZS51cGRhdGVzKSB7XG4gICAgICAgICAgaWYgKGxpc3RVcGRhdGUudHlwZSA9PT0gXCJzZXRcIikge1xuICAgICAgICAgICAgbmV3U3RhdGUgPSBuZXdTdGF0ZS5tYXAoXG4gICAgICAgICAgICAgIChpdGVtLCBpbmRleCkgPT4gaW5kZXggPT09IGxpc3RVcGRhdGUuaW5kZXggPyBsc29uVG9Kc29uKGxpc3RVcGRhdGUuaXRlbSkgOiBpdGVtXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAobGlzdFVwZGF0ZS50eXBlID09PSBcImluc2VydFwiKSB7XG4gICAgICAgICAgICBpZiAobGlzdFVwZGF0ZS5pbmRleCA9PT0gbmV3U3RhdGUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlLnB1c2gobHNvblRvSnNvbihsaXN0VXBkYXRlLml0ZW0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlID0gW1xuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKDAsIGxpc3RVcGRhdGUuaW5kZXgpLFxuICAgICAgICAgICAgICAgIGxzb25Ub0pzb24obGlzdFVwZGF0ZS5pdGVtKSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShsaXN0VXBkYXRlLmluZGV4KVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAobGlzdFVwZGF0ZS50eXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICBuZXdTdGF0ZS5zcGxpY2UobGlzdFVwZGF0ZS5pbmRleCwgMSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChsaXN0VXBkYXRlLnR5cGUgPT09IFwibW92ZVwiKSB7XG4gICAgICAgICAgICBpZiAobGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4ID4gbGlzdFVwZGF0ZS5pbmRleCkge1xuICAgICAgICAgICAgICBuZXdTdGF0ZSA9IFtcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZSgwLCBsaXN0VXBkYXRlLmluZGV4KSxcbiAgICAgICAgICAgICAgICBsc29uVG9Kc29uKGxpc3RVcGRhdGUuaXRlbSksXG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUuc2xpY2UobGlzdFVwZGF0ZS5pbmRleCwgbGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4KSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShsaXN0VXBkYXRlLnByZXZpb3VzSW5kZXggKyAxKVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbmV3U3RhdGUgPSBbXG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUuc2xpY2UoMCwgbGlzdFVwZGF0ZS5wcmV2aW91c0luZGV4KSxcbiAgICAgICAgICAgICAgICAuLi5uZXdTdGF0ZS5zbGljZShcbiAgICAgICAgICAgICAgICAgIGxpc3RVcGRhdGUucHJldmlvdXNJbmRleCArIDEsXG4gICAgICAgICAgICAgICAgICBsaXN0VXBkYXRlLmluZGV4ICsgMVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgbHNvblRvSnNvbihsaXN0VXBkYXRlLml0ZW0pLFxuICAgICAgICAgICAgICAgIC4uLm5ld1N0YXRlLnNsaWNlKGxpc3RVcGRhdGUuaW5kZXggKyAxKVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiTGl2ZU1hcFwiOiB7XG4gICAgICAgIGlmICghaXNKc29uT2JqZWN0KHN0YXRlKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiSW50ZXJuYWw6IHJlY2VpdmVkIHVwZGF0ZSBvbiBMaXZlTWFwIGJ1dCBzdGF0ZSB3YXMgbm90IGFuIG9iamVjdFwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIHN0YXRlKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdXBkYXRlLnVwZGF0ZXMpIHtcbiAgICAgICAgICBpZiAodXBkYXRlLnVwZGF0ZXNba2V5XT8udHlwZSA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB1cGRhdGUubm9kZS5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlW2tleV0gPSBsc29uVG9Kc29uKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKHVwZGF0ZS51cGRhdGVzW2tleV0/LnR5cGUgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBuZXdTdGF0ZVtrZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KHN0YXRlKSkge1xuICAgIGNvbnN0IG5ld0FycmF5ID0gWy4uLnN0YXRlXTtcbiAgICBuZXdBcnJheVtwYXRoSXRlbV0gPSBsZWdhY3lfcGF0Y2hJbW11dGFibGVOb2RlKFxuICAgICAgc3RhdGVbcGF0aEl0ZW1dLFxuICAgICAgcGF0aCxcbiAgICAgIHVwZGF0ZVxuICAgICk7XG4gICAgcmV0dXJuIG5ld0FycmF5O1xuICB9IGVsc2UgaWYgKGlzSnNvbk9iamVjdChzdGF0ZSkpIHtcbiAgICBjb25zdCBub2RlID0gc3RhdGVbcGF0aEl0ZW1dO1xuICAgIGlmIChub2RlID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3RhdGVBc09iaiA9IHN0YXRlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGVBc09iaixcbiAgICAgICAgW3BhdGhJdGVtXTogbGVnYWN5X3BhdGNoSW1tdXRhYmxlTm9kZShub2RlLCBwYXRoLCB1cGRhdGUpXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cbn1cblxuLy8gc3JjL2xpYi9kZXByZWNhdGlvbi50c1xudmFyIF9lbWl0dGVkRGVwcmVjYXRpb25XYXJuaW5ncyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG5mdW5jdGlvbiBkZXByZWNhdGUobWVzc2FnZSwga2V5ID0gbWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKCFfZW1pdHRlZERlcHJlY2F0aW9uV2FybmluZ3MuaGFzKGtleSkpIHtcbiAgICAgIF9lbWl0dGVkRGVwcmVjYXRpb25XYXJuaW5ncy5hZGQoa2V5KTtcbiAgICAgIGVycm9yV2l0aFRpdGxlKFwiRGVwcmVjYXRpb24gd2FybmluZ1wiLCBtZXNzYWdlKTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGRlcHJlY2F0ZUlmKGNvbmRpdGlvbiwgbWVzc2FnZSwga2V5ID0gbWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKGNvbmRpdGlvbikge1xuICAgICAgZGVwcmVjYXRlKG1lc3NhZ2UsIGtleSk7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiB0aHJvd1VzYWdlRXJyb3IobWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgY29uc3QgdXNhZ2VFcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB1c2FnZUVycm9yLm5hbWUgPSBcIlVzYWdlIGVycm9yXCI7XG4gICAgZXJyb3JXaXRoVGl0bGUoXCJVc2FnZSBlcnJvclwiLCBtZXNzYWdlKTtcbiAgICB0aHJvdyB1c2FnZUVycm9yO1xuICB9XG59XG5mdW5jdGlvbiBlcnJvcklmKGNvbmRpdGlvbiwgbWVzc2FnZSkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgaWYgKGNvbmRpdGlvbikge1xuICAgICAgdGhyb3dVc2FnZUVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBzcmMvbGliL1BvbGxlci50c1xuZnVuY3Rpb24gbWFrZVBvbGxlcihjYWxsYmFjaykge1xuICBsZXQgY29udGV4dCA9IHtcbiAgICBzdGF0ZTogXCJzdG9wcGVkXCIsXG4gICAgdGltZW91dEhhbmRsZTogbnVsbCxcbiAgICBpbnRlcnZhbDogbnVsbCxcbiAgICBsYXN0U2NoZWR1bGVkQXQ6IG51bGwsXG4gICAgcmVtYWluaW5nSW50ZXJ2YWw6IG51bGxcbiAgfTtcbiAgZnVuY3Rpb24gcG9sbCgpIHtcbiAgICBpZiAoY29udGV4dC5zdGF0ZSA9PT0gXCJydW5uaW5nXCIpIHtcbiAgICAgIHNjaGVkdWxlKGNvbnRleHQuaW50ZXJ2YWwpO1xuICAgIH1cbiAgICB2b2lkIGNhbGxiYWNrKCk7XG4gIH1cbiAgZnVuY3Rpb24gc2NoZWR1bGUoaW50ZXJ2YWwpIHtcbiAgICBjb250ZXh0ID0ge1xuICAgICAgc3RhdGU6IFwicnVubmluZ1wiLFxuICAgICAgaW50ZXJ2YWw6IGNvbnRleHQuc3RhdGUgIT09IFwic3RvcHBlZFwiID8gY29udGV4dC5pbnRlcnZhbCA6IGludGVydmFsLFxuICAgICAgbGFzdFNjaGVkdWxlZEF0OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgIHRpbWVvdXRIYW5kbGU6IHNldFRpbWVvdXQocG9sbCwgaW50ZXJ2YWwpLFxuICAgICAgcmVtYWluaW5nSW50ZXJ2YWw6IG51bGxcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIHNjaGVkdWxlUmVtYWluaW5nKHJlbWFpbmluZykge1xuICAgIGlmIChjb250ZXh0LnN0YXRlICE9PSBcInBhdXNlZFwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnRleHQgPSB7XG4gICAgICBzdGF0ZTogXCJydW5uaW5nXCIsXG4gICAgICBpbnRlcnZhbDogY29udGV4dC5pbnRlcnZhbCxcbiAgICAgIGxhc3RTY2hlZHVsZWRBdDogY29udGV4dC5sYXN0U2NoZWR1bGVkQXQsXG4gICAgICB0aW1lb3V0SGFuZGxlOiBzZXRUaW1lb3V0KHBvbGwsIHJlbWFpbmluZyksXG4gICAgICByZW1haW5pbmdJbnRlcnZhbDogbnVsbFxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gc3RhcnQoaW50ZXJ2YWwpIHtcbiAgICBpZiAoY29udGV4dC5zdGF0ZSA9PT0gXCJydW5uaW5nXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2NoZWR1bGUoaW50ZXJ2YWwpO1xuICB9XG4gIGZ1bmN0aW9uIHJlc3RhcnQoaW50ZXJ2YWwpIHtcbiAgICBzdG9wKCk7XG4gICAgc3RhcnQoaW50ZXJ2YWwpO1xuICB9XG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlICE9PSBcInJ1bm5pbmdcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjbGVhclRpbWVvdXQoY29udGV4dC50aW1lb3V0SGFuZGxlKTtcbiAgICBjb250ZXh0ID0ge1xuICAgICAgc3RhdGU6IFwicGF1c2VkXCIsXG4gICAgICBpbnRlcnZhbDogY29udGV4dC5pbnRlcnZhbCxcbiAgICAgIGxhc3RTY2hlZHVsZWRBdDogY29udGV4dC5sYXN0U2NoZWR1bGVkQXQsXG4gICAgICB0aW1lb3V0SGFuZGxlOiBudWxsLFxuICAgICAgcmVtYWluaW5nSW50ZXJ2YWw6IGNvbnRleHQuaW50ZXJ2YWwgLSAocGVyZm9ybWFuY2Uubm93KCkgLSBjb250ZXh0Lmxhc3RTY2hlZHVsZWRBdClcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIHJlc3VtZSgpIHtcbiAgICBpZiAoY29udGV4dC5zdGF0ZSAhPT0gXCJwYXVzZWRcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzY2hlZHVsZVJlbWFpbmluZyhjb250ZXh0LnJlbWFpbmluZ0ludGVydmFsKTtcbiAgfVxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIGlmIChjb250ZXh0LnN0YXRlID09PSBcInN0b3BwZWRcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC50aW1lb3V0SGFuZGxlKSB7XG4gICAgICBjbGVhclRpbWVvdXQoY29udGV4dC50aW1lb3V0SGFuZGxlKTtcbiAgICB9XG4gICAgY29udGV4dCA9IHtcbiAgICAgIHN0YXRlOiBcInN0b3BwZWRcIixcbiAgICAgIGludGVydmFsOiBudWxsLFxuICAgICAgbGFzdFNjaGVkdWxlZEF0OiBudWxsLFxuICAgICAgdGltZW91dEhhbmRsZTogbnVsbCxcbiAgICAgIHJlbWFpbmluZ0ludGVydmFsOiBudWxsXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHN0YXJ0LFxuICAgIHJlc3RhcnQsXG4gICAgcGF1c2UsXG4gICAgcmVzdW1lLFxuICAgIHN0b3BcbiAgfTtcbn1cblxuLy8gc3JjL2xpYi9zaGFsbG93LnRzXG5mdW5jdGlvbiBzaGFsbG93QXJyYXkoeHMsIHlzKSB7XG4gIGlmICh4cy5sZW5ndGggIT09IHlzLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IHhzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKCFPYmplY3QuaXMoeHNbaV0sIHlzW2ldKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIHNoYWxsb3dPYmoob2JqQSwgb2JqQikge1xuICBpZiAodHlwZW9mIG9iakEgIT09IFwib2JqZWN0XCIgfHwgb2JqQSA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqQiAhPT0gXCJvYmplY3RcIiB8fCBvYmpCID09PSBudWxsIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmpBKSAhPT0gXCJbb2JqZWN0IE9iamVjdF1cIiB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqQikgIT09IFwiW29iamVjdCBPYmplY3RdXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3Qga2V5c0EgPSBPYmplY3Qua2V5cyhvYmpBKTtcbiAgaWYgKGtleXNBLmxlbmd0aCAhPT0gT2JqZWN0LmtleXMob2JqQikubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBrZXlzQS5ldmVyeShcbiAgICAoa2V5KSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqQiwga2V5KSAmJiBPYmplY3QuaXMob2JqQVtrZXldLCBvYmpCW2tleV0pXG4gICk7XG59XG5mdW5jdGlvbiBzaGFsbG93KGEsIGIpIHtcbiAgaWYgKE9iamVjdC5pcyhhLCBiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IGlzQXJyYXlBID0gQXJyYXkuaXNBcnJheShhKTtcbiAgY29uc3QgaXNBcnJheUIgPSBBcnJheS5pc0FycmF5KGIpO1xuICBpZiAoaXNBcnJheUEgfHwgaXNBcnJheUIpIHtcbiAgICBpZiAoIWlzQXJyYXlBIHx8ICFpc0FycmF5Qikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gc2hhbGxvd0FycmF5KGEsIGIpO1xuICB9XG4gIHJldHVybiBzaGFsbG93T2JqKGEsIGIpO1xufVxuXG4vLyBzcmMvaW5kZXgudHNcbmRldGVjdER1cGVzKFBLR19OQU1FLCBQS0dfVkVSU0lPTiwgUEtHX0ZPUk1BVCk7XG5leHBvcnQge1xuICBDbGllbnRNc2dDb2RlLFxuICBDb21tZW50c0FwaUVycm9yLFxuICBDcmR0VHlwZSxcbiAgTGl2ZUxpc3QsXG4gIExpdmVNYXAsXG4gIExpdmVPYmplY3QsXG4gIE5vdGlmaWNhdGlvbnNBcGlFcnJvcixcbiAgT3BDb2RlLFxuICBTZXJ2ZXJNc2dDb2RlLFxuICBXZWJzb2NrZXRDbG9zZUNvZGVzLFxuICBhY2tPcCxcbiAgYWRkUmVhY3Rpb24sXG4gIGFwcGx5T3B0aW1pc3RpY1VwZGF0ZXMsXG4gIGFzUG9zLFxuICBhc3NlcnQsXG4gIGFzc2VydE5ldmVyLFxuICBiNjRkZWNvZGUsXG4gIGNsb25lTHNvbixcbiAgZmFuY3lfY29uc29sZV9leHBvcnRzIGFzIGNvbnNvbGUsXG4gIGNvbnZlcnRUb0NvbW1lbnREYXRhLFxuICBjb252ZXJ0VG9Db21tZW50VXNlclJlYWN0aW9uLFxuICBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRhdGEsXG4gIGNvbnZlcnRUb1RocmVhZERhdGEsXG4gIGNyZWF0ZUNsaWVudCxcbiAgY3JlYXRlQ29tbWVudElkLFxuICBjcmVhdGVJbmJveE5vdGlmaWNhdGlvbklkLFxuICBjcmVhdGVUaHJlYWRJZCxcbiAgZGVsZXRlQ29tbWVudCxcbiAgZGVwcmVjYXRlLFxuICBkZXByZWNhdGVJZixcbiAgZGV0ZWN0RHVwZXMsXG4gIGVycm9ySWYsXG4gIGZyZWV6ZSxcbiAgZ2V0TWVudGlvbmVkSWRzRnJvbUNvbW1lbnRCb2R5LFxuICBpc0NoaWxkQ3JkdCxcbiAgaXNKc29uQXJyYXksXG4gIGlzSnNvbk9iamVjdCxcbiAgaXNKc29uU2NhbGFyLFxuICBpc0xpdmVOb2RlLFxuICBpc1BsYWluT2JqZWN0LFxuICBpc1Jvb3RDcmR0LFxuICBrSW50ZXJuYWwsXG4gIGxlZ2FjeV9wYXRjaEltbXV0YWJsZU9iamVjdCxcbiAgbHNvblRvSnNvbixcbiAgbWFrZUV2ZW50U291cmNlLFxuICBtYWtlUG9sbGVyLFxuICBtYWtlUG9zaXRpb24sXG4gIG1lbW9pemVPblN1Y2Nlc3MsXG4gIG5hbm9pZCxcbiAgbm4sXG4gIG9iamVjdFRvUXVlcnksXG4gIHBhdGNoTGl2ZU9iamVjdEtleSxcbiAgcmFpc2UsXG4gIHJlbW92ZVJlYWN0aW9uLFxuICBzaGFsbG93LFxuICBzdHJpbmdpZnksXG4gIHN0cmluZ2lmeUNvbW1lbnRCb2R5LFxuICB0aHJvd1VzYWdlRXJyb3IsXG4gIHRvUGxhaW5Mc29uLFxuICB0cnlQYXJzZUpzb24sXG4gIHVwc2VydENvbW1lbnQsXG4gIHdhaXQsXG4gIHdpdGhUaW1lb3V0XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@liveblocks/core/dist/index.mjs\n");

/***/ }),

/***/ "(action-browser)/./node_modules/@liveblocks/node/dist/index.mjs":
/*!******************************************************!*\
  !*** ./node_modules/@liveblocks/node/dist/index.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Liveblocks: () => (/* binding */ Liveblocks),\n/* harmony export */   LiveblocksError: () => (/* binding */ LiveblocksError),\n/* harmony export */   WebhookHandler: () => (/* binding */ WebhookHandler),\n/* harmony export */   getMentionedIdsFromCommentBody: () => (/* reexport safe */ _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.getMentionedIdsFromCommentBody),\n/* harmony export */   stringifyCommentBody: () => (/* reexport safe */ _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.stringifyCommentBody)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @liveblocks/core */ \"(action-browser)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _stablelib_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @stablelib/base64 */ \"(action-browser)/./node_modules/@stablelib/base64/lib/base64.js\");\n/* harmony import */ var fast_sha256__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fast-sha256 */ \"(action-browser)/./node_modules/fast-sha256/sha256.js\");\n// src/index.ts\n\n\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/node\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/client.ts\n\n\n// src/utils.ts\nvar DEFAULT_BASE_URL = \"https://api.liveblocks.io\";\nfunction getBaseUrl(baseUrl) {\n  if (typeof baseUrl === \"string\" && baseUrl.startsWith(\"http\")) {\n    return baseUrl;\n  } else {\n    return DEFAULT_BASE_URL;\n  }\n}\nasync function fetchPolyfill() {\n  return typeof globalThis.fetch !== \"undefined\" ? globalThis.fetch : (await Promise.all(/*! import() */[__webpack_require__.e(\"vendor-chunks/tr46\"), __webpack_require__.e(\"vendor-chunks/node-fetch\"), __webpack_require__.e(\"vendor-chunks/whatwg-url\"), __webpack_require__.e(\"vendor-chunks/webidl-conversions\")]).then(__webpack_require__.bind(__webpack_require__, /*! node-fetch */ \"(action-browser)/./node_modules/node-fetch/lib/index.mjs\"))).default;\n}\nfunction isNonEmpty(value) {\n  return typeof value === \"string\" && value.length > 0;\n}\nfunction assertNonEmpty(value, field) {\n  if (!isNonEmpty(value)) {\n    throw new Error(\n      `Invalid value for field \"${field}\". Please provide a non-empty string. For more information: https://liveblocks.io/docs/api-reference/liveblocks-node#authorize`\n    );\n  }\n}\nfunction assertSecretKey(value, field) {\n  if (!isNonEmpty(value) || !value.startsWith(\"sk_\")) {\n    throw new Error(\n      `Invalid value for field \"${field}\". Secret keys must start with \"sk_\". Please provide the secret key from your Liveblocks dashboard at https://liveblocks.io/dashboard/apikeys.`\n    );\n  }\n}\nfunction normalizeStatusCode(statusCode) {\n  if (statusCode >= 200 && statusCode < 300) {\n    return 200;\n  } else if (statusCode >= 500) {\n    return 503;\n  } else {\n    return 403;\n  }\n}\nfunction toURLSearchParams(params) {\n  const result = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== void 0 && value !== null) {\n      result.set(key, value.toString());\n    }\n  }\n  return result;\n}\nfunction urljoin(baseUrl, path, params) {\n  const url2 = new URL(path, baseUrl);\n  if (params !== void 0) {\n    url2.search = (params instanceof URLSearchParams ? params : toURLSearchParams(params)).toString();\n  }\n  return url2.toString();\n}\nfunction url(strings, ...values) {\n  return strings.reduce(\n    (result, str, i) => result + encodeURIComponent(values[i - 1] ?? \"\") + str\n  );\n}\n\n// src/Session.ts\nvar ALL_PERMISSIONS = Object.freeze([\n  \"room:write\",\n  \"room:read\",\n  \"room:presence:write\",\n  \"comments:write\",\n  \"comments:read\"\n]);\nfunction isPermission(value) {\n  return ALL_PERMISSIONS.includes(value);\n}\nvar MAX_PERMS_PER_SET = 10;\nvar READ_ACCESS = Object.freeze([\n  \"room:read\",\n  \"room:presence:write\",\n  \"comments:read\"\n]);\nvar FULL_ACCESS = Object.freeze([\"room:write\", \"comments:write\"]);\nvar roomPatternRegex = /^([*]|[^*]{1,128}[*]?)$/;\nvar Session = class {\n  /** @internal */\n  constructor(postFn, userId, userInfo) {\n    this.FULL_ACCESS = FULL_ACCESS;\n    this.READ_ACCESS = READ_ACCESS;\n    /** @internal */\n    this._sealed = false;\n    /** @internal */\n    this._permissions = /* @__PURE__ */ new Map();\n    assertNonEmpty(userId, \"userId\");\n    this._postFn = postFn;\n    this._userId = userId;\n    this._userInfo = userInfo;\n  }\n  /** @internal */\n  getOrCreate(roomId) {\n    if (this._sealed) {\n      throw new Error(\"You can no longer change these permissions.\");\n    }\n    let perms = this._permissions.get(roomId);\n    if (perms) {\n      return perms;\n    } else {\n      if (this._permissions.size >= MAX_PERMS_PER_SET) {\n        throw new Error(\n          \"You cannot add permissions for more than 10 rooms in a single token\"\n        );\n      }\n      perms = /* @__PURE__ */ new Set();\n      this._permissions.set(roomId, perms);\n      return perms;\n    }\n  }\n  allow(roomIdOrPattern, newPerms) {\n    if (typeof roomIdOrPattern !== \"string\") {\n      throw new Error(\"Room name or pattern must be a string\");\n    }\n    if (!roomPatternRegex.test(roomIdOrPattern)) {\n      throw new Error(\"Invalid room name or pattern\");\n    }\n    if (newPerms.length === 0) {\n      throw new Error(\"Permission list cannot be empty\");\n    }\n    const existingPerms = this.getOrCreate(roomIdOrPattern);\n    for (const perm of newPerms) {\n      if (!isPermission(perm)) {\n        throw new Error(`Not a valid permission: ${perm}`);\n      }\n      existingPerms.add(perm);\n    }\n    return this;\n  }\n  /** @internal - For unit tests only */\n  hasPermissions() {\n    return this._permissions.size > 0;\n  }\n  /** @internal - For unit tests only */\n  seal() {\n    if (this._sealed) {\n      throw new Error(\n        \"You cannot reuse Session instances. Please create a new session every time.\"\n      );\n    }\n    this._sealed = true;\n  }\n  /** @internal - For unit tests only */\n  serializePermissions() {\n    return Object.fromEntries(\n      Array.from(this._permissions.entries()).map(([pat, perms]) => [\n        pat,\n        Array.from(perms)\n      ])\n    );\n  }\n  /**\n   * Call this to authorize the session to access Liveblocks. Note that this\n   * will return a Liveblocks \"access token\". Anyone that obtains such access\n   * token will have access to the allowed resources.\n   */\n  async authorize() {\n    this.seal();\n    if (!this.hasPermissions()) {\n      console.warn(\n        \"Access tokens without any permission will not be supported soon, you should use wildcards when the client requests a token for resources outside a room. See https://liveblocks.io/docs/errors/liveblocks-client/access-tokens-not-enough-permissions\"\n      );\n    }\n    try {\n      const resp = await this._postFn(url`/v2/authorize-user`, {\n        // Required\n        userId: this._userId,\n        permissions: this.serializePermissions(),\n        // Optional metadata\n        userInfo: this._userInfo\n      });\n      return {\n        status: normalizeStatusCode(resp.status),\n        body: await resp.text()\n      };\n    } catch (er) {\n      return {\n        status: 503,\n        body: 'Call to /v2/authorize-user failed. See \"error\" for more information.',\n        error: er\n      };\n    }\n  }\n};\n\n// src/client.ts\nvar Liveblocks = class {\n  /**\n   * Interact with the Liveblocks API from your Node.js backend.\n   */\n  constructor(options) {\n    const options_ = options;\n    const secret = options_.secret;\n    assertSecretKey(secret, \"secret\");\n    this._secret = secret;\n    this._baseUrl = new URL(getBaseUrl(options.baseUrl));\n  }\n  /** @internal */\n  async post(path, json) {\n    const url2 = urljoin(this._baseUrl, path);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`,\n      \"Content-Type\": \"application/json\"\n    };\n    const fetch = await fetchPolyfill();\n    const res = await fetch(url2, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(json)\n    });\n    return res;\n  }\n  /** @internal */\n  async put(path, json) {\n    const url2 = urljoin(this._baseUrl, path);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`,\n      \"Content-Type\": \"application/json\"\n    };\n    const fetch = await fetchPolyfill();\n    return await fetch(url2, {\n      method: \"PUT\",\n      headers,\n      body: JSON.stringify(json)\n    });\n  }\n  /** @internal */\n  async putBinary(path, body, params) {\n    const url2 = urljoin(this._baseUrl, path, params);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`,\n      \"Content-Type\": \"application/octet-stream\"\n    };\n    const fetch = await fetchPolyfill();\n    return await fetch(url2, { method: \"PUT\", headers, body });\n  }\n  /** @internal */\n  async delete(path) {\n    const url2 = urljoin(this._baseUrl, path);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`\n    };\n    const fetch = await fetchPolyfill();\n    const res = await fetch(url2, { method: \"DELETE\", headers });\n    return res;\n  }\n  /** @internal */\n  async get(path, params) {\n    const url2 = urljoin(this._baseUrl, path, params);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`\n    };\n    const fetch = await fetchPolyfill();\n    const res = await fetch(url2, { method: \"GET\", headers });\n    return res;\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Authentication\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Prepares a new session to authorize a user to access Liveblocks.\n   *\n   * IMPORTANT:\n   * Always make sure that you trust the user making the request to your\n   * backend before calling .prepareSession()!\n   *\n   * @param userId Tell Liveblocks the user ID of the user to authorize. Must\n   * uniquely identify the user account in your system. The uniqueness of this\n   * value will determine how many MAUs will be counted/billed.\n   *\n   * @param options.userInfo Custom metadata to attach to this user. Data you\n   * add here will be visible to all other clients in the room, through the\n   * `other.info` property.\n   *\n   */\n  prepareSession(userId, ...rest) {\n    const options = rest[0];\n    return new Session(this.post.bind(this), userId, options?.userInfo);\n  }\n  /**\n   * Call this to authenticate the user as an actor you want to allow to use\n   * Liveblocks.\n   *\n   * You should use this method only if you want to manage your permissions\n   * through the Liveblocks Permissions API. This method is more complicated to\n   * set up, but allows for finer-grained specification of permissions.\n   *\n   * Calling `.identifyUser()` only lets you securely identify a user (and what\n   * groups they belong to). What permissions this user will end up having is\n   * determined by whatever permissions you assign the user/group in your\n   * Liveblocks account, through the Permissions API:\n   * https://liveblocks.io/docs/rooms/permissions\n   *\n   * IMPORTANT:\n   * Always verify that you trust the user making the request before calling\n   * .identifyUser()!\n   *\n   * @param identity Tell Liveblocks the user ID of the user to authenticate.\n   * Must uniquely identify the user account in your system. The uniqueness of\n   * this value will determine how many MAUs will be counted/billed.\n   *\n   * If you also want to assign which groups this user belongs to, use the\n   * object form and specify the `groupIds` property. Those `groupIds` should\n   * match the groupIds you assigned permissions to via the Liveblocks\n   * Permissions API, see\n   * https://liveblocks.io/docs/rooms/permissions#permissions-levels-groups-accesses-example\n   *\n   * @param options.userInfo Custom metadata to attach to this user. Data you\n   * add here will be visible to all other clients in the room, through the\n   * `other.info` property.\n   */\n  // These fields define the security identity of the user. Whatever you pass in here will define which\n  async identifyUser(identity, ...rest) {\n    const options = rest[0];\n    const path = url`/v2/identify-user`;\n    const userId = typeof identity === \"string\" ? identity : identity.userId;\n    const groupIds = typeof identity === \"string\" ? void 0 : identity.groupIds;\n    assertNonEmpty(userId, \"userId\");\n    try {\n      const resp = await this.post(path, {\n        userId,\n        groupIds,\n        // Optional metadata\n        userInfo: options?.userInfo\n      });\n      return {\n        status: normalizeStatusCode(resp.status),\n        body: await resp.text()\n      };\n    } catch (er) {\n      return {\n        status: 503,\n        body: `Call to ${urljoin(\n          this._baseUrl,\n          path\n        )} failed. See \"error\" for more information.`,\n        error: er\n      };\n    }\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Room\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Returns a list of your rooms. The rooms are returned sorted by creation date, from newest to oldest. You can filter rooms by metadata, users accesses and groups accesses.\n   * @param params.limit (optional) A limit on the number of rooms to be returned. The limit can range between 1 and 100, and defaults to 20.\n   * @param params.startingAfter (optional) A cursor used for pagination. You get the value from the response of the previous page.\n   * @param params.userId (optional) A filter on users accesses.\n   * @param params.metadata (optional) A filter on metadata. Multiple metadata keys can be used to filter rooms.\n   * @param params.groupIds (optional) A filter on groups accesses. Multiple groups can be used.\n   * @param params.query (optional) A query to filter rooms by. It is based on our query language. You can filter by metadata and room ID.\n   * @returns A list of rooms.\n   */\n  async getRooms(params = {}) {\n    const path = url`/v2/rooms`;\n    let query;\n    if (typeof params.query === \"string\") {\n      query = params.query;\n    } else if (typeof params.query === \"object\") {\n      query = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.objectToQuery)(params.query);\n    }\n    const queryParams = {\n      limit: params.limit,\n      startingAfter: params.startingAfter,\n      userId: params.userId,\n      groupIds: params.groupIds ? params.groupIds.join(\",\") : void 0,\n      // \"Flatten\" {metadata: {foo: \"bar\"}} to {\"metadata.foo\": \"bar\"}\n      ...Object.fromEntries(\n        Object.entries(params.metadata ?? {}).map(([key, val]) => [\n          `metadata.${key}`,\n          val\n        ])\n      ),\n      query\n    };\n    const res = await this.get(path, queryParams);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const rooms = data.data.map((room) => {\n      const lastConnectionAt = room.lastConnectionAt ? new Date(room.lastConnectionAt) : void 0;\n      const createdAt = new Date(room.createdAt);\n      return {\n        ...room,\n        createdAt,\n        lastConnectionAt\n      };\n    });\n    return {\n      ...data,\n      data: rooms\n    };\n  }\n  /**\n   * Creates a new room with the given id.\n   * @param roomId The id of the room to create.\n   * @param params.defaultAccesses The default accesses for the room.\n   * @param params.groupsAccesses (optional) The group accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.usersAccesses (optional) The user accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.metadata (optional) The metadata for the room. Supports upto a maximum of 50 entries. Key length has a limit of 40 characters. Value length has a limit of 256 characters.\n   * @returns The created room.\n   */\n  async createRoom(roomId, params) {\n    const { defaultAccesses, groupsAccesses, usersAccesses, metadata } = params;\n    const res = await this.post(url`/v2/rooms`, {\n      id: roomId,\n      defaultAccesses,\n      groupsAccesses,\n      usersAccesses,\n      metadata\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const lastConnectionAt = data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0;\n    const createdAt = new Date(data.createdAt);\n    return {\n      ...data,\n      lastConnectionAt,\n      createdAt\n    };\n  }\n  /**\n   * Returns a room with the given id.\n   * @param roomId The id of the room to return.\n   * @returns The room with the given id.\n   */\n  async getRoom(roomId) {\n    const res = await this.get(url`/v2/rooms/${roomId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const lastConnectionAt = data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0;\n    const createdAt = new Date(data.createdAt);\n    return {\n      ...data,\n      createdAt,\n      lastConnectionAt\n    };\n  }\n  /**\n   * Updates specific properties of a room. Its not necessary to provide the entire rooms information.\n   * Setting a property to `null` means to delete this property.\n   * @param roomId The id of the room to update.\n   * @param params.defaultAccesses (optional) The default accesses for the room.\n   * @param params.groupsAccesses (optional) The group accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.usersAccesses (optional) The user accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.metadata (optional) The metadata for the room. Supports upto a maximum of 50 entries. Key length has a limit of 40 characters. Value length has a limit of 256 characters.\n   * @returns The updated room.\n   */\n  async updateRoom(roomId, params) {\n    const { defaultAccesses, groupsAccesses, usersAccesses, metadata } = params;\n    const res = await this.post(url`/v2/rooms/${roomId}`, {\n      defaultAccesses,\n      groupsAccesses,\n      usersAccesses,\n      metadata\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const lastConnectionAt = data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0;\n    const createdAt = new Date(data.createdAt);\n    return {\n      ...data,\n      lastConnectionAt,\n      createdAt\n    };\n  }\n  /**\n   * Deletes a room with the given id. A deleted room is no longer accessible from the API or the dashboard and it cannot be restored.\n   * @param roomId The id of the room to delete.\n   */\n  async deleteRoom(roomId) {\n    const res = await this.delete(url`/v2/rooms/${roomId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns a list of users currently present in the requested room. For better performance, we recommand to call this endpoint every 10 seconds maximum. Duplicates can happen if a user is in the requested room with multiple browser tabs opened.\n   * @param roomId The id of the room to get the users from.\n   * @returns A list of users currently present in the requested room.\n   */\n  async getActiveUsers(roomId) {\n    const res = await this.get(url`/v2/rooms/${roomId}/active_users`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Boadcasts an event to a room without having to connect to it via the client from @liveblocks/client. The connectionId passed to event listeners is -1 when using this API.\n   * @param roomId The id of the room to broadcast the event to.\n   * @param message The message to broadcast. It can be any JSON serializable value.\n   */\n  async broadcastEvent(roomId, message) {\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/broadcast_event`,\n      message\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  async getStorageDocument(roomId, format = \"plain-lson\") {\n    const res = await this.get(url`/v2/rooms/${roomId}/storage`, { format });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Initializes a rooms Storage. The room must already exist and have an empty Storage.\n   * Calling this endpoint will disconnect all users from the room if there are any.\n   *\n   * @param roomId The id of the room to initialize the storage from.\n   * @param document The document to initialize the storage with.\n   * @returns The initialized storage document. It is of the same format as the one passed in.\n   */\n  async initializeStorageDocument(roomId, document) {\n    const res = await this.post(url`/v2/rooms/${roomId}/storage`, document);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Deletes all of the rooms Storage data and disconnect all users from the room if there are any. Note that this does not delete the Yjs document in the room if one exists.\n   * @param roomId The id of the room to delete the storage from.\n   */\n  async deleteStorageDocument(roomId) {\n    const res = await this.delete(url`/v2/rooms/${roomId}/storage`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Yjs\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Returns a JSON representation of the rooms Yjs document.\n   * @param roomId The id of the room to get the Yjs document from.\n   * @param params.format (optional) If true, YText will return formatting.\n   * @param params.key (optional) If provided, returns only a single keys value, e.g. doc.get(key).toJSON().\n   * @param params.type (optional) Used with key to override the inferred type, i.e. \"ymap\" will return doc.get(key, Y.Map).\n   * @returns A JSON representation of the rooms Yjs document.\n   */\n  async getYjsDocument(roomId, params = {}) {\n    const { format, key, type } = params;\n    const path = url`v2/rooms/${roomId}/ydoc`;\n    const res = await this.get(path, {\n      formatting: format ? \"true\" : void 0,\n      key,\n      type\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Send a Yjs binary update to the rooms Yjs document. You can use this endpoint to initialize Yjs data for the room or to update the rooms Yjs document.\n   * @param roomId The id of the room to send the Yjs binary update to.\n   * @param update The Yjs update to send. Typically the result of calling `Yjs.encodeStateAsUpdate(doc)`. Read the [Yjs documentation](https://docs.yjs.dev/api/document-updates) to learn how to create a binary update.\n   * @param params.guid (optional) If provided, the binary update will be applied to the Yjs subdocument with the given guid. If not provided, the binary update will be applied to the root Yjs document.\n   */\n  async sendYjsBinaryUpdate(roomId, update, params = {}) {\n    const res = await this.putBinary(url`/v2/rooms/${roomId}/ydoc`, update, {\n      guid: params.guid\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns the rooms Yjs document encoded as a single binary update. This can be used by Y.applyUpdate(responseBody) to get a copy of the document in your backend.\n   * See [Yjs documentation](https://docs.yjs.dev/api/document-updates) for more information on working with updates.\n   * @param roomId The id of the room to get the Yjs document from.\n   * @param params.guid (optional) If provided, returns the binary update of the Yjs subdocument with the given guid. If not provided, returns the binary update of the root Yjs document.\n   * @returns The rooms Yjs document encoded as a single binary update.\n   */\n  async getYjsDocumentAsBinaryUpdate(roomId, params = {}) {\n    const res = await this.get(url`/v2/rooms/${roomId}/ydoc-binary`, {\n      guid: params.guid\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return res.arrayBuffer();\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Schema Validation\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Creates a new schema which can be referenced later to enforce a rooms Storage data structure.\n   * @param name The name used to reference the schema. Must be a non-empty string with less than 65 characters and only contain lowercase letters, numbers and dashes\n   * @param body The exact allowed shape of data in the room. It is a multi-line string written in the [Liveblocks schema syntax](https://liveblocks.io/docs/platform/schema-validation/syntax).\n   * @returns The created schema.\n   */\n  async createSchema(name, body) {\n    const res = await this.post(url`/v2/schemas`, {\n      name,\n      body\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Returns a schema by its id.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   * @returns The schema with the given id.\n   */\n  async getSchema(schemaId) {\n    const res = await this.get(url`/v2/schemas/${schemaId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Updates the body for the schema. A schema can only be updated if it is not used by any room.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   * @param body The exact allowed shape of data in the room. It is a multi-line string written in the [Liveblocks schema syntax](https://liveblocks.io/docs/platform/schema-validation/syntax).\n   * @returns The updated schema. The version of the schema will be incremented.\n   */\n  async updateSchema(schemaId, body) {\n    const res = await this.put(url`/v2/schemas/${schemaId}`, {\n      body\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Deletes a schema by its id. A schema can only be deleted if it is not used by any room.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   */\n  async deleteSchema(schemaId) {\n    const res = await this.delete(url`/v2/schemas/${schemaId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns the schema attached to a room.\n   * @param roomId The id of the room to get the schema from.\n   * @returns\n   */\n  async getSchemaByRoomId(roomId) {\n    const res = await this.get(url`/v2/rooms/${roomId}/schema`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Attaches a schema to a room, and instantly enables runtime schema validation for the room.\n   * If the current contents of the rooms Storage do not match the schema, attaching will fail and the error message will give details on why the schema failed to attach.\n   * @param roomId The id of the room to attach the schema to.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   * @returns The schema id as JSON.\n   */\n  async attachSchemaToRoom(roomId, schemaId) {\n    const res = await this.post(url`/v2/rooms/${roomId}/schema`, {\n      schema: schemaId\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Detaches a schema from a room, and disables runtime schema validation for the room.\n   * @param roomId The id of the room to detach the schema from.\n   */\n  async detachSchemaFromRoom(roomId) {\n    const res = await this.delete(url`/v2/rooms/${roomId}/schema`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Comments\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Gets all the threads in a room.\n   *\n   * @param params.roomId The room ID to get the threads from.\n   * @param params.query The query to filter threads by. It is based on our query language and can filter by metadata.\n   * @returns A list of threads.\n   */\n  async getThreads(params) {\n    const { roomId } = params;\n    let query;\n    if (typeof params.query === \"string\") {\n      query = params.query;\n    } else if (typeof params.query === \"object\") {\n      query = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.objectToQuery)(params.query);\n    }\n    const res = await this.get(url`/v2/rooms/${roomId}/threads`, {\n      query\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const { data } = await res.json();\n    return {\n      data: data.map((thread) => (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(thread))\n    };\n  }\n  /**\n   * Gets a thread.\n   *\n   * @param params.roomId The room ID to get the thread from.\n   * @param params.threadId The thread ID.\n   * @returns A thread.\n   */\n  async getThread(params) {\n    const { roomId, threadId } = params;\n    const res = await this.get(url`/v2/rooms/${roomId}/threads/${threadId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Gets a thread's participants.\n   *\n   * Participants are users who have commented on the thread\n   * or users and groups that have been mentioned in a comment.\n   *\n   * @param params.roomId The room ID to get the thread participants from.\n   * @param params.threadId The thread ID to get the participants from.\n   * @returns An object containing an array of participant IDs.\n   */\n  async getThreadParticipants(params) {\n    const { roomId, threadId } = params;\n    const res = await this.get(\n      url`/v2/rooms/${roomId}/threads/${threadId}/participants`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Gets a thread's comment.\n   *\n   * @param params.roomId The room ID to get the comment from.\n   * @param params.threadId The thread ID to get the comment from.\n   * @param params.commentId The comment ID.\n   * @returns A comment.\n   */\n  async getComment(params) {\n    const { roomId, threadId, commentId } = params;\n    const res = await this.get(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentData)(await res.json());\n  }\n  /**\n   * Creates a comment.\n   *\n   * @param params.roomId The room ID to create the comment in.\n   * @param params.threadId The thread ID to create the comment in.\n   * @param params.data.userId The user ID of the user who is set to create the comment.\n   * @param params.data.createdAt (optional) The date the comment is set to be created.\n   * @param params.data.body The body of the comment.\n   * @returns The created comment.\n   */\n  async createComment(params) {\n    const { roomId, threadId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments`,\n      {\n        ...data,\n        createdAt: data.createdAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentData)(await res.json());\n  }\n  /**\n   * Edits a comment.\n   * @param params.roomId The room ID to edit the comment in.\n   * @param params.threadId The thread ID to edit the comment in.\n   * @param params.commentId The comment ID to edit.\n   * @param params.data.body The body of the comment.\n   * @param params.data.editedAt (optional) The date the comment was edited.\n   * @returns The edited comment.\n   */\n  async editComment(params) {\n    const { roomId, threadId, commentId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}`,\n      {\n        ...data,\n        editedAt: data.editedAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentData)(await res.json());\n  }\n  /**\n   * Deletes a comment. Deletes a comment. If there are no remaining comments in the thread, the thread is also deleted.\n   * @param params.roomId The room ID to delete the comment in.\n   * @param params.threadId The thread ID to delete the comment in.\n   * @param params.commentId The comment ID to delete.\n   */\n  async deleteComment(params) {\n    const { roomId, threadId, commentId } = params;\n    const res = await this.delete(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Creates a new thread. The thread will be created with the specified comment as its first comment.\n   * If the thread already exists, a `LiveblocksError` will be thrown with status code 409.\n   * @param params.roomId The room ID to create the thread in.\n   * @param params.thread.metadata (optional) The metadata for the thread. Supports upto a maximum of 10 entries. Value must be a string, boolean or number\n   * @param params.thread.comment.userId The user ID of the user who created the comment.\n   * @param params.thread.comment.createdAt (optional) The date the comment was created.\n   * @param params.thread.comment.body The body of the comment.\n   * @returns The created thread. The thread will be created with the specified comment as its first comment.\n   */\n  async createThread(params) {\n    const { roomId, data } = params;\n    const res = await this.post(url`/v2/rooms/${roomId}/threads`, {\n      ...data,\n      comment: {\n        ...data.comment,\n        createdAt: data.comment.createdAt?.toISOString()\n      }\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Deletes a thread and all of its comments.\n   * @param params.roomId The room ID to delete the thread in.\n   * @param params.threadId The thread ID to delete.\n   */\n  async deleteThread(params) {\n    const { roomId, threadId } = params;\n    const res = await this.delete(url`/v2/rooms/${roomId}/threads/${threadId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Mark a thread as resolved.\n   * @param params.roomId The room ID of the thread.\n   * @param params.threadId The thread ID to mark as resolved.\n   * @param params.data.userId The user ID of the user who marked the thread as resolved.\n   * @returns The thread marked as resolved.\n   */\n  async markThreadAsResolved(params) {\n    const { roomId, threadId } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/mark-as-resolved`,\n      {}\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Mark a thread as unresolved.\n   * @param params.roomId The room ID of the thread.\n   * @param params.threadId The thread ID to mark as unresolved.\n   * @param params.data.userId The user ID of the user who marked the thread as unresolved.\n   * @returns The thread marked as unresolved.\n   */\n  async markThreadAsUnresolved(params) {\n    const { roomId, threadId } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/mark-as-unresolved`,\n      {}\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Updates the metadata of the specified thread in a room.\n   * @param params.roomId The room ID to update the thread in.\n   * @param params.threadId The thread ID to update.\n   * @param params.data.metadata The metadata for the thread. Value must be a string, boolean or number\n   * @param params.data.userId The user ID of the user who updated the thread.\n   * @param params.data.updatedAt (optional) The date the thread is set to be updated.\n   * @returns The updated thread metadata.\n   */\n  async editThreadMetadata(params) {\n    const { roomId, threadId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/metadata`,\n      {\n        ...data,\n        updatedAt: data.updatedAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Adds a new comment reaction to a comment.\n   * @param params.roomId The room ID to add the comment reaction in.\n   * @param params.threadId The thread ID to add the comment reaction in.\n   * @param params.commentId The comment ID to add the reaction in.\n   * @param params.data.emoji The (emoji) reaction to add.\n   * @param params.data.userId The user ID of the user associated with the reaction.\n   * @param params.data.createdAt (optional) The date the reaction is set to be created.\n   * @returns The created comment reaction.\n   */\n  async addCommentReaction(params) {\n    const { roomId, threadId, commentId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}/add-reaction`,\n      {\n        ...data,\n        createdAt: data.createdAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const reaction = await res.json();\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentUserReaction)(reaction);\n  }\n  /**\n   * Removes a reaction from a comment.\n   * @param params.roomId The room ID to remove the comment reaction from.\n   * @param params.threadId The thread ID to remove the comment reaction from.\n   * @param params.commentId The comment ID to remove the reaction from.\n   * @param params.data.emoji The (emoji) reaction to remove.\n   * @param params.data.userId The user ID of the user associated with the reaction.\n   * @param params.data.removedAt (optional) The date the reaction is set to be removed.\n   */\n  async removeCommentReaction(params) {\n    const { roomId, threadId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${params.commentId}/remove-reaction`,\n      {\n        ...data,\n        removedAt: data.removedAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns the inbox notifications for a user.\n   * @param params.userId The user ID to get the inbox notifications from.\n   * @param params.inboxNotificationId The ID of the inbox notification to get.\n   */\n  async getInboxNotification(params) {\n    const { userId, inboxNotificationId } = params;\n    const res = await this.get(\n      url`/v2/users/${userId}/inbox-notifications/${inboxNotificationId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToInboxNotificationData)(\n      await res.json()\n    );\n  }\n  /**\n   * Gets the user's room notification settings.\n   * @param params.userId The user ID to get the room notifications from.\n   * @param params.roomId The room ID to get the room notification settings from.\n   */\n  async getRoomNotificationSettings(params) {\n    const { userId, roomId } = params;\n    const res = await this.get(\n      url`/v2/rooms/${roomId}/users/${userId}/notification-settings`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Updates the user's room notification settings.\n   * @param params.userId The user ID to update the room notification settings for.\n   * @param params.roomId The room ID to update the room notification settings for.\n   * @param params.data The new room notification settings for the user.\n   */\n  async updateRoomNotificationSettings(params) {\n    const { userId, roomId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/users/${userId}/notification-settings`,\n      data\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Delete the user's room notification settings.\n   * @param params.userId The user ID to delete the room notification settings from.\n   * @param params.roomId The room ID to delete the room notification settings from.\n   */\n  async deleteRoomNotificationSettings(params) {\n    const { userId, roomId } = params;\n    const res = await this.delete(\n      url`/v2/rooms/${roomId}/users/${userId}/notification-settings`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Update a room ID.\n   * @param params.roomId The current ID of the room.\n   * @param params.newRoomId The new room ID.\n   */\n  async updateRoomId(params) {\n    const { currentRoomId, newRoomId } = params;\n    const res = await this.post(\n      url`/v2/rooms/${currentRoomId}/update-room-id`,\n      {\n        newRoomId\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    return {\n      ...data,\n      createdAt: new Date(data.createdAt),\n      lastConnectionAt: data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0\n    };\n  }\n  async triggerInboxNotification(params) {\n    const res = await this.post(url`/v2/inbox-notifications/trigger`, params);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Deletes an inbox notification for a user.\n   * @param params.userId The user ID for which to delete the inbox notification.\n   * @param params.inboxNotificationId The ID of the inbox notification to delete.\n   */\n  async deleteInboxNotification(params) {\n    const { userId, inboxNotificationId } = params;\n    const res = await this.delete(\n      url`/v2/users/${userId}/inbox-notifications/${inboxNotificationId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Deletes all inbox notifications for a user.\n   * @param params.userId The user ID for which to delete all the inbox notifications.\n   */\n  async deleteAllInboxNotifications(params) {\n    const { userId } = params;\n    const res = await this.delete(url`/v2/users/${userId}/inbox-notifications`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n};\nvar LiveblocksError = class extends Error {\n  constructor(status, message = \"\") {\n    super(message);\n    this.name = \"LiveblocksError\";\n    this.status = status;\n  }\n};\n\n// src/webhooks.ts\n\n\nvar _WebhookHandler = class _WebhookHandler {\n  constructor(secret) {\n    if (!secret) throw new Error(\"Secret is required\");\n    if (typeof secret !== \"string\") throw new Error(\"Secret must be a string\");\n    if (secret.startsWith(_WebhookHandler.secretPrefix) === false)\n      throw new Error(\"Invalid secret, must start with whsec_\");\n    const secretKey = secret.slice(_WebhookHandler.secretPrefix.length);\n    this.secretBuffer = Buffer.from(secretKey, \"base64\");\n  }\n  /**\n   * Verifies a webhook request and returns the event\n   */\n  verifyRequest(request) {\n    const { headers, rawBody } = request;\n    const { webhookId, timestamp, rawSignatures } = this.verifyHeaders(headers);\n    if (typeof rawBody !== \"string\") {\n      throw new Error(\n        `Invalid rawBody field, must be a string, got \"${typeof rawBody}\" instead. It is likely that you need to JSON.stringify the body before passing it.`\n      );\n    }\n    this.verifyTimestamp(timestamp);\n    const signature = this.sign(`${webhookId}.${timestamp}.${rawBody}`);\n    const expectedSignatures = rawSignatures.split(\" \").map((rawSignature) => {\n      const [, parsedSignature] = rawSignature.split(\",\");\n      return parsedSignature;\n    }).filter(isNotUndefined);\n    if (expectedSignatures.includes(signature) === false)\n      throw new Error(\n        `Invalid signature, expected one of ${expectedSignatures.join(\n          \", \"\n        )}, got ${signature}`\n      );\n    const event = JSON.parse(rawBody);\n    this.verifyWebhookEventType(event);\n    return event;\n  }\n  /**\n   * Verifies the headers and returns the webhookId, timestamp and rawSignatures\n   */\n  verifyHeaders(headers) {\n    const usingNativeHeaders = typeof Headers !== \"undefined\" && headers instanceof Headers;\n    const normalizedHeaders = usingNativeHeaders ? Object.fromEntries(headers) : headers;\n    const sanitizedHeaders = {};\n    Object.keys(normalizedHeaders).forEach((key) => {\n      sanitizedHeaders[key.toLowerCase()] = normalizedHeaders[key];\n    });\n    const webhookId = sanitizedHeaders[\"webhook-id\"];\n    if (typeof webhookId !== \"string\")\n      throw new Error(\"Invalid webhook-id header\");\n    const timestamp = sanitizedHeaders[\"webhook-timestamp\"];\n    if (typeof timestamp !== \"string\")\n      throw new Error(\"Invalid webhook-timestamp header\");\n    const rawSignatures = sanitizedHeaders[\"webhook-signature\"];\n    if (typeof rawSignatures !== \"string\")\n      throw new Error(\"Invalid webhook-signature header\");\n    return { webhookId, timestamp, rawSignatures };\n  }\n  /**\n   * Signs the content with the secret\n   * @param content\n   * @returns `string`\n   */\n  sign(content) {\n    const encoder = new TextEncoder();\n    const toSign = encoder.encode(content);\n    return _stablelib_base64__WEBPACK_IMPORTED_MODULE_1__.encode(fast_sha256__WEBPACK_IMPORTED_MODULE_2__.hmac(this.secretBuffer, toSign));\n  }\n  /**\n   * Verifies that the timestamp is not too old or in the future\n   */\n  verifyTimestamp(timestampHeader) {\n    const now = Math.floor(Date.now() / 1e3);\n    const timestamp = parseInt(timestampHeader, 10);\n    if (isNaN(timestamp)) {\n      throw new Error(\"Invalid timestamp\");\n    }\n    if (timestamp < now - WEBHOOK_TOLERANCE_IN_SECONDS) {\n      throw new Error(\"Timestamp too old\");\n    }\n    if (timestamp > now + WEBHOOK_TOLERANCE_IN_SECONDS) {\n      throw new Error(\"Timestamp in the future\");\n    }\n  }\n  /**\n   * Ensures that the event is a known event type\n   * or throws and prompts the user to upgrade to a higher version of @liveblocks/node\n   */\n  verifyWebhookEventType(event) {\n    if (event && event.type && [\n      \"storageUpdated\",\n      \"userEntered\",\n      \"userLeft\",\n      \"roomCreated\",\n      \"roomDeleted\",\n      \"commentCreated\",\n      \"commentEdited\",\n      \"commentDeleted\",\n      \"commentReactionAdded\",\n      \"commentReactionRemoved\",\n      \"threadMetadataUpdated\",\n      \"threadCreated\",\n      \"threadDeleted\",\n      \"ydocUpdated\",\n      \"notification\",\n      \"threadMarkedAsResolved\",\n      \"threadMarkedAsUnresolved\"\n    ].includes(event.type)) {\n      if (event.type === \"notification\") {\n        const notification = event;\n        if (notification.data.kind === \"thread\" || notification.data.kind === \"textMention\" || notification.data.kind.startsWith(\"$\")) {\n          return;\n        } else {\n          throw new Error(\n            `Unknown notification kind: ${notification.data.kind}`\n          );\n        }\n      }\n      return;\n    }\n    throw new Error(\n      \"Unknown event type, please upgrade to a higher version of @liveblocks/node\"\n    );\n  }\n};\n_WebhookHandler.secretPrefix = \"whsec_\";\nvar WebhookHandler = _WebhookHandler;\nvar WEBHOOK_TOLERANCE_IN_SECONDS = 5 * 60;\nvar isNotUndefined = (value) => value !== void 0;\n\n// src/index.ts\n\n(0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.detectDupes)(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9ub2RlL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7QUFDK0M7O0FBRS9DO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBTzBCOztBQUUxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLDRXQUFvQjtBQUNqRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxNQUFNO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxNQUFNO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLE1BQU07QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxLQUFLO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsYUFBYTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsYUFBYTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGFBQWE7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDhCQUE4QjtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGFBQWE7QUFDNUM7QUFDQTtBQUNBLG9DQUFvQywyQkFBMkI7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGFBQWE7QUFDNUM7QUFDQTtBQUNBLG9DQUFvQyx3QkFBd0I7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLDBDQUEwQyx1QkFBdUI7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUkwQjtBQUMxQiw2REFBVztBQU9UO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saXZlZG9jcy8uL25vZGVfbW9kdWxlcy9AbGl2ZWJsb2Nrcy9ub2RlL2Rpc3QvaW5kZXgubWpzPzRhOGQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2luZGV4LnRzXG5pbXBvcnQgeyBkZXRlY3REdXBlcyB9IGZyb20gXCJAbGl2ZWJsb2Nrcy9jb3JlXCI7XG5cbi8vIHNyYy92ZXJzaW9uLnRzXG52YXIgUEtHX05BTUUgPSBcIkBsaXZlYmxvY2tzL25vZGVcIjtcbnZhciBQS0dfVkVSU0lPTiA9IFwiMi40LjBcIjtcbnZhciBQS0dfRk9STUFUID0gXCJlc21cIjtcblxuLy8gc3JjL2NsaWVudC50c1xuaW1wb3J0IHtcbiAgY29udmVydFRvQ29tbWVudERhdGEsXG4gIGNvbnZlcnRUb0NvbW1lbnRVc2VyUmVhY3Rpb24sXG4gIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YSxcbiAgY29udmVydFRvVGhyZWFkRGF0YSxcbiAgb2JqZWN0VG9RdWVyeVxufSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuXG4vLyBzcmMvdXRpbHMudHNcbnZhciBERUZBVUxUX0JBU0VfVVJMID0gXCJodHRwczovL2FwaS5saXZlYmxvY2tzLmlvXCI7XG5mdW5jdGlvbiBnZXRCYXNlVXJsKGJhc2VVcmwpIHtcbiAgaWYgKHR5cGVvZiBiYXNlVXJsID09PSBcInN0cmluZ1wiICYmIGJhc2VVcmwuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICByZXR1cm4gYmFzZVVybDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gREVGQVVMVF9CQVNFX1VSTDtcbiAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hQb2x5ZmlsbCgpIHtcbiAgcmV0dXJuIHR5cGVvZiBnbG9iYWxUaGlzLmZldGNoICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsVGhpcy5mZXRjaCA6IChhd2FpdCBpbXBvcnQoXCJub2RlLWZldGNoXCIpKS5kZWZhdWx0O1xufVxuZnVuY3Rpb24gaXNOb25FbXB0eSh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmxlbmd0aCA+IDA7XG59XG5mdW5jdGlvbiBhc3NlcnROb25FbXB0eSh2YWx1ZSwgZmllbGQpIHtcbiAgaWYgKCFpc05vbkVtcHR5KHZhbHVlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBJbnZhbGlkIHZhbHVlIGZvciBmaWVsZCBcIiR7ZmllbGR9XCIuIFBsZWFzZSBwcm92aWRlIGEgbm9uLWVtcHR5IHN0cmluZy4gRm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2FwaS1yZWZlcmVuY2UvbGl2ZWJsb2Nrcy1ub2RlI2F1dGhvcml6ZWBcbiAgICApO1xuICB9XG59XG5mdW5jdGlvbiBhc3NlcnRTZWNyZXRLZXkodmFsdWUsIGZpZWxkKSB7XG4gIGlmICghaXNOb25FbXB0eSh2YWx1ZSkgfHwgIXZhbHVlLnN0YXJ0c1dpdGgoXCJza19cIikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgSW52YWxpZCB2YWx1ZSBmb3IgZmllbGQgXCIke2ZpZWxkfVwiLiBTZWNyZXQga2V5cyBtdXN0IHN0YXJ0IHdpdGggXCJza19cIi4gUGxlYXNlIHByb3ZpZGUgdGhlIHNlY3JldCBrZXkgZnJvbSB5b3VyIExpdmVibG9ja3MgZGFzaGJvYXJkIGF0IGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kYXNoYm9hcmQvYXBpa2V5cy5gXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gbm9ybWFsaXplU3RhdHVzQ29kZShzdGF0dXNDb2RlKSB7XG4gIGlmIChzdGF0dXNDb2RlID49IDIwMCAmJiBzdGF0dXNDb2RlIDwgMzAwKSB7XG4gICAgcmV0dXJuIDIwMDtcbiAgfSBlbHNlIGlmIChzdGF0dXNDb2RlID49IDUwMCkge1xuICAgIHJldHVybiA1MDM7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDQwMztcbiAgfVxufVxuZnVuY3Rpb24gdG9VUkxTZWFyY2hQYXJhbXMocGFyYW1zKSB7XG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocGFyYW1zKSkge1xuICAgIGlmICh2YWx1ZSAhPT0gdm9pZCAwICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgICByZXN1bHQuc2V0KGtleSwgdmFsdWUudG9TdHJpbmcoKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiB1cmxqb2luKGJhc2VVcmwsIHBhdGgsIHBhcmFtcykge1xuICBjb25zdCB1cmwyID0gbmV3IFVSTChwYXRoLCBiYXNlVXJsKTtcbiAgaWYgKHBhcmFtcyAhPT0gdm9pZCAwKSB7XG4gICAgdXJsMi5zZWFyY2ggPSAocGFyYW1zIGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zID8gcGFyYW1zIDogdG9VUkxTZWFyY2hQYXJhbXMocGFyYW1zKSkudG9TdHJpbmcoKTtcbiAgfVxuICByZXR1cm4gdXJsMi50b1N0cmluZygpO1xufVxuZnVuY3Rpb24gdXJsKHN0cmluZ3MsIC4uLnZhbHVlcykge1xuICByZXR1cm4gc3RyaW5ncy5yZWR1Y2UoXG4gICAgKHJlc3VsdCwgc3RyLCBpKSA9PiByZXN1bHQgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWVzW2kgLSAxXSA/PyBcIlwiKSArIHN0clxuICApO1xufVxuXG4vLyBzcmMvU2Vzc2lvbi50c1xudmFyIEFMTF9QRVJNSVNTSU9OUyA9IE9iamVjdC5mcmVlemUoW1xuICBcInJvb206d3JpdGVcIixcbiAgXCJyb29tOnJlYWRcIixcbiAgXCJyb29tOnByZXNlbmNlOndyaXRlXCIsXG4gIFwiY29tbWVudHM6d3JpdGVcIixcbiAgXCJjb21tZW50czpyZWFkXCJcbl0pO1xuZnVuY3Rpb24gaXNQZXJtaXNzaW9uKHZhbHVlKSB7XG4gIHJldHVybiBBTExfUEVSTUlTU0lPTlMuaW5jbHVkZXModmFsdWUpO1xufVxudmFyIE1BWF9QRVJNU19QRVJfU0VUID0gMTA7XG52YXIgUkVBRF9BQ0NFU1MgPSBPYmplY3QuZnJlZXplKFtcbiAgXCJyb29tOnJlYWRcIixcbiAgXCJyb29tOnByZXNlbmNlOndyaXRlXCIsXG4gIFwiY29tbWVudHM6cmVhZFwiXG5dKTtcbnZhciBGVUxMX0FDQ0VTUyA9IE9iamVjdC5mcmVlemUoW1wicm9vbTp3cml0ZVwiLCBcImNvbW1lbnRzOndyaXRlXCJdKTtcbnZhciByb29tUGF0dGVyblJlZ2V4ID0gL14oWypdfFteKl17MSwxMjh9WypdPykkLztcbnZhciBTZXNzaW9uID0gY2xhc3Mge1xuICAvKiogQGludGVybmFsICovXG4gIGNvbnN0cnVjdG9yKHBvc3RGbiwgdXNlcklkLCB1c2VySW5mbykge1xuICAgIHRoaXMuRlVMTF9BQ0NFU1MgPSBGVUxMX0FDQ0VTUztcbiAgICB0aGlzLlJFQURfQUNDRVNTID0gUkVBRF9BQ0NFU1M7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHRoaXMuX3NlYWxlZCA9IGZhbHNlO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICB0aGlzLl9wZXJtaXNzaW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgYXNzZXJ0Tm9uRW1wdHkodXNlcklkLCBcInVzZXJJZFwiKTtcbiAgICB0aGlzLl9wb3N0Rm4gPSBwb3N0Rm47XG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xuICAgIHRoaXMuX3VzZXJJbmZvID0gdXNlckluZm87XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXRPckNyZWF0ZShyb29tSWQpIHtcbiAgICBpZiAodGhpcy5fc2VhbGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgY2FuIG5vIGxvbmdlciBjaGFuZ2UgdGhlc2UgcGVybWlzc2lvbnMuXCIpO1xuICAgIH1cbiAgICBsZXQgcGVybXMgPSB0aGlzLl9wZXJtaXNzaW9ucy5nZXQocm9vbUlkKTtcbiAgICBpZiAocGVybXMpIHtcbiAgICAgIHJldHVybiBwZXJtcztcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuX3Blcm1pc3Npb25zLnNpemUgPj0gTUFYX1BFUk1TX1BFUl9TRVQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiWW91IGNhbm5vdCBhZGQgcGVybWlzc2lvbnMgZm9yIG1vcmUgdGhhbiAxMCByb29tcyBpbiBhIHNpbmdsZSB0b2tlblwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBwZXJtcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgICB0aGlzLl9wZXJtaXNzaW9ucy5zZXQocm9vbUlkLCBwZXJtcyk7XG4gICAgICByZXR1cm4gcGVybXM7XG4gICAgfVxuICB9XG4gIGFsbG93KHJvb21JZE9yUGF0dGVybiwgbmV3UGVybXMpIHtcbiAgICBpZiAodHlwZW9mIHJvb21JZE9yUGF0dGVybiAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUm9vbSBuYW1lIG9yIHBhdHRlcm4gbXVzdCBiZSBhIHN0cmluZ1wiKTtcbiAgICB9XG4gICAgaWYgKCFyb29tUGF0dGVyblJlZ2V4LnRlc3Qocm9vbUlkT3JQYXR0ZXJuKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCByb29tIG5hbWUgb3IgcGF0dGVyblwiKTtcbiAgICB9XG4gICAgaWYgKG5ld1Blcm1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGVybWlzc2lvbiBsaXN0IGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICB9XG4gICAgY29uc3QgZXhpc3RpbmdQZXJtcyA9IHRoaXMuZ2V0T3JDcmVhdGUocm9vbUlkT3JQYXR0ZXJuKTtcbiAgICBmb3IgKGNvbnN0IHBlcm0gb2YgbmV3UGVybXMpIHtcbiAgICAgIGlmICghaXNQZXJtaXNzaW9uKHBlcm0pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTm90IGEgdmFsaWQgcGVybWlzc2lvbjogJHtwZXJtfWApO1xuICAgICAgfVxuICAgICAgZXhpc3RpbmdQZXJtcy5hZGQocGVybSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgLSBGb3IgdW5pdCB0ZXN0cyBvbmx5ICovXG4gIGhhc1Blcm1pc3Npb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9wZXJtaXNzaW9ucy5zaXplID4gMDtcbiAgfVxuICAvKiogQGludGVybmFsIC0gRm9yIHVuaXQgdGVzdHMgb25seSAqL1xuICBzZWFsKCkge1xuICAgIGlmICh0aGlzLl9zZWFsZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJZb3UgY2Fubm90IHJldXNlIFNlc3Npb24gaW5zdGFuY2VzLiBQbGVhc2UgY3JlYXRlIGEgbmV3IHNlc3Npb24gZXZlcnkgdGltZS5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5fc2VhbGVkID0gdHJ1ZTtcbiAgfVxuICAvKiogQGludGVybmFsIC0gRm9yIHVuaXQgdGVzdHMgb25seSAqL1xuICBzZXJpYWxpemVQZXJtaXNzaW9ucygpIHtcbiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgQXJyYXkuZnJvbSh0aGlzLl9wZXJtaXNzaW9ucy5lbnRyaWVzKCkpLm1hcCgoW3BhdCwgcGVybXNdKSA9PiBbXG4gICAgICAgIHBhdCxcbiAgICAgICAgQXJyYXkuZnJvbShwZXJtcylcbiAgICAgIF0pXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogQ2FsbCB0aGlzIHRvIGF1dGhvcml6ZSB0aGUgc2Vzc2lvbiB0byBhY2Nlc3MgTGl2ZWJsb2Nrcy4gTm90ZSB0aGF0IHRoaXNcbiAgICogd2lsbCByZXR1cm4gYSBMaXZlYmxvY2tzIFwiYWNjZXNzIHRva2VuXCIuIEFueW9uZSB0aGF0IG9idGFpbnMgc3VjaCBhY2Nlc3NcbiAgICogdG9rZW4gd2lsbCBoYXZlIGFjY2VzcyB0byB0aGUgYWxsb3dlZCByZXNvdXJjZXMuXG4gICAqL1xuICBhc3luYyBhdXRob3JpemUoKSB7XG4gICAgdGhpcy5zZWFsKCk7XG4gICAgaWYgKCF0aGlzLmhhc1Blcm1pc3Npb25zKCkpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgXCJBY2Nlc3MgdG9rZW5zIHdpdGhvdXQgYW55IHBlcm1pc3Npb24gd2lsbCBub3QgYmUgc3VwcG9ydGVkIHNvb24sIHlvdSBzaG91bGQgdXNlIHdpbGRjYXJkcyB3aGVuIHRoZSBjbGllbnQgcmVxdWVzdHMgYSB0b2tlbiBmb3IgcmVzb3VyY2VzIG91dHNpZGUgYSByb29tLiBTZWUgaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvZXJyb3JzL2xpdmVibG9ja3MtY2xpZW50L2FjY2Vzcy10b2tlbnMtbm90LWVub3VnaC1wZXJtaXNzaW9uc1wiXG4gICAgICApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuX3Bvc3RGbih1cmxgL3YyL2F1dGhvcml6ZS11c2VyYCwge1xuICAgICAgICAvLyBSZXF1aXJlZFxuICAgICAgICB1c2VySWQ6IHRoaXMuX3VzZXJJZCxcbiAgICAgICAgcGVybWlzc2lvbnM6IHRoaXMuc2VyaWFsaXplUGVybWlzc2lvbnMoKSxcbiAgICAgICAgLy8gT3B0aW9uYWwgbWV0YWRhdGFcbiAgICAgICAgdXNlckluZm86IHRoaXMuX3VzZXJJbmZvXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogbm9ybWFsaXplU3RhdHVzQ29kZShyZXNwLnN0YXR1cyksXG4gICAgICAgIGJvZHk6IGF3YWl0IHJlc3AudGV4dCgpXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDUwMyxcbiAgICAgICAgYm9keTogJ0NhbGwgdG8gL3YyL2F1dGhvcml6ZS11c2VyIGZhaWxlZC4gU2VlIFwiZXJyb3JcIiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4nLFxuICAgICAgICBlcnJvcjogZXJcbiAgICAgIH07XG4gICAgfVxuICB9XG59O1xuXG4vLyBzcmMvY2xpZW50LnRzXG52YXIgTGl2ZWJsb2NrcyA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIEludGVyYWN0IHdpdGggdGhlIExpdmVibG9ja3MgQVBJIGZyb20geW91ciBOb2RlLmpzIGJhY2tlbmQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgY29uc3Qgb3B0aW9uc18gPSBvcHRpb25zO1xuICAgIGNvbnN0IHNlY3JldCA9IG9wdGlvbnNfLnNlY3JldDtcbiAgICBhc3NlcnRTZWNyZXRLZXkoc2VjcmV0LCBcInNlY3JldFwiKTtcbiAgICB0aGlzLl9zZWNyZXQgPSBzZWNyZXQ7XG4gICAgdGhpcy5fYmFzZVVybCA9IG5ldyBVUkwoZ2V0QmFzZVVybChvcHRpb25zLmJhc2VVcmwpKTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGFzeW5jIHBvc3QocGF0aCwganNvbikge1xuICAgIGNvbnN0IHVybDIgPSB1cmxqb2luKHRoaXMuX2Jhc2VVcmwsIHBhdGgpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5fc2VjcmV0fWAsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgIH07XG4gICAgY29uc3QgZmV0Y2ggPSBhd2FpdCBmZXRjaFBvbHlmaWxsKCk7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsMiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShqc29uKVxuICAgIH0pO1xuICAgIHJldHVybiByZXM7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBhc3luYyBwdXQocGF0aCwganNvbikge1xuICAgIGNvbnN0IHVybDIgPSB1cmxqb2luKHRoaXMuX2Jhc2VVcmwsIHBhdGgpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5fc2VjcmV0fWAsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgIH07XG4gICAgY29uc3QgZmV0Y2ggPSBhd2FpdCBmZXRjaFBvbHlmaWxsKCk7XG4gICAgcmV0dXJuIGF3YWl0IGZldGNoKHVybDIsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShqc29uKVxuICAgIH0pO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgYXN5bmMgcHV0QmluYXJ5KHBhdGgsIGJvZHksIHBhcmFtcykge1xuICAgIGNvbnN0IHVybDIgPSB1cmxqb2luKHRoaXMuX2Jhc2VVcmwsIHBhdGgsIHBhcmFtcyk7XG4gICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLl9zZWNyZXR9YCxcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCJcbiAgICB9O1xuICAgIGNvbnN0IGZldGNoID0gYXdhaXQgZmV0Y2hQb2x5ZmlsbCgpO1xuICAgIHJldHVybiBhd2FpdCBmZXRjaCh1cmwyLCB7IG1ldGhvZDogXCJQVVRcIiwgaGVhZGVycywgYm9keSB9KTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGFzeW5jIGRlbGV0ZShwYXRoKSB7XG4gICAgY29uc3QgdXJsMiA9IHVybGpvaW4odGhpcy5fYmFzZVVybCwgcGF0aCk7XG4gICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLl9zZWNyZXR9YFxuICAgIH07XG4gICAgY29uc3QgZmV0Y2ggPSBhd2FpdCBmZXRjaFBvbHlmaWxsKCk7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsMiwgeyBtZXRob2Q6IFwiREVMRVRFXCIsIGhlYWRlcnMgfSk7XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGFzeW5jIGdldChwYXRoLCBwYXJhbXMpIHtcbiAgICBjb25zdCB1cmwyID0gdXJsam9pbih0aGlzLl9iYXNlVXJsLCBwYXRoLCBwYXJhbXMpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5fc2VjcmV0fWBcbiAgICB9O1xuICAgIGNvbnN0IGZldGNoID0gYXdhaXQgZmV0Y2hQb2x5ZmlsbCgpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybDIsIHsgbWV0aG9kOiBcIkdFVFwiLCBoZWFkZXJzIH0pO1xuICAgIHJldHVybiByZXM7XG4gIH1cbiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBBdXRoZW50aWNhdGlvblxuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIG5ldyBzZXNzaW9uIHRvIGF1dGhvcml6ZSBhIHVzZXIgdG8gYWNjZXNzIExpdmVibG9ja3MuXG4gICAqXG4gICAqIElNUE9SVEFOVDpcbiAgICogQWx3YXlzIG1ha2Ugc3VyZSB0aGF0IHlvdSB0cnVzdCB0aGUgdXNlciBtYWtpbmcgdGhlIHJlcXVlc3QgdG8geW91clxuICAgKiBiYWNrZW5kIGJlZm9yZSBjYWxsaW5nIC5wcmVwYXJlU2Vzc2lvbigpIVxuICAgKlxuICAgKiBAcGFyYW0gdXNlcklkIFRlbGwgTGl2ZWJsb2NrcyB0aGUgdXNlciBJRCBvZiB0aGUgdXNlciB0byBhdXRob3JpemUuIE11c3RcbiAgICogdW5pcXVlbHkgaWRlbnRpZnkgdGhlIHVzZXIgYWNjb3VudCBpbiB5b3VyIHN5c3RlbS4gVGhlIHVuaXF1ZW5lc3Mgb2YgdGhpc1xuICAgKiB2YWx1ZSB3aWxsIGRldGVybWluZSBob3cgbWFueSBNQVVzIHdpbGwgYmUgY291bnRlZC9iaWxsZWQuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zLnVzZXJJbmZvIEN1c3RvbSBtZXRhZGF0YSB0byBhdHRhY2ggdG8gdGhpcyB1c2VyLiBEYXRhIHlvdVxuICAgKiBhZGQgaGVyZSB3aWxsIGJlIHZpc2libGUgdG8gYWxsIG90aGVyIGNsaWVudHMgaW4gdGhlIHJvb20sIHRocm91Z2ggdGhlXG4gICAqIGBvdGhlci5pbmZvYCBwcm9wZXJ0eS5cbiAgICpcbiAgICovXG4gIHByZXBhcmVTZXNzaW9uKHVzZXJJZCwgLi4ucmVzdCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSByZXN0WzBdO1xuICAgIHJldHVybiBuZXcgU2Vzc2lvbih0aGlzLnBvc3QuYmluZCh0aGlzKSwgdXNlcklkLCBvcHRpb25zPy51c2VySW5mbyk7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgdGhpcyB0byBhdXRoZW50aWNhdGUgdGhlIHVzZXIgYXMgYW4gYWN0b3IgeW91IHdhbnQgdG8gYWxsb3cgdG8gdXNlXG4gICAqIExpdmVibG9ja3MuXG4gICAqXG4gICAqIFlvdSBzaG91bGQgdXNlIHRoaXMgbWV0aG9kIG9ubHkgaWYgeW91IHdhbnQgdG8gbWFuYWdlIHlvdXIgcGVybWlzc2lvbnNcbiAgICogdGhyb3VnaCB0aGUgTGl2ZWJsb2NrcyBQZXJtaXNzaW9ucyBBUEkuIFRoaXMgbWV0aG9kIGlzIG1vcmUgY29tcGxpY2F0ZWQgdG9cbiAgICogc2V0IHVwLCBidXQgYWxsb3dzIGZvciBmaW5lci1ncmFpbmVkIHNwZWNpZmljYXRpb24gb2YgcGVybWlzc2lvbnMuXG4gICAqXG4gICAqIENhbGxpbmcgYC5pZGVudGlmeVVzZXIoKWAgb25seSBsZXRzIHlvdSBzZWN1cmVseSBpZGVudGlmeSBhIHVzZXIgKGFuZCB3aGF0XG4gICAqIGdyb3VwcyB0aGV5IGJlbG9uZyB0bykuIFdoYXQgcGVybWlzc2lvbnMgdGhpcyB1c2VyIHdpbGwgZW5kIHVwIGhhdmluZyBpc1xuICAgKiBkZXRlcm1pbmVkIGJ5IHdoYXRldmVyIHBlcm1pc3Npb25zIHlvdSBhc3NpZ24gdGhlIHVzZXIvZ3JvdXAgaW4geW91clxuICAgKiBMaXZlYmxvY2tzIGFjY291bnQsIHRocm91Z2ggdGhlIFBlcm1pc3Npb25zIEFQSTpcbiAgICogaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3Mvcm9vbXMvcGVybWlzc2lvbnNcbiAgICpcbiAgICogSU1QT1JUQU5UOlxuICAgKiBBbHdheXMgdmVyaWZ5IHRoYXQgeW91IHRydXN0IHRoZSB1c2VyIG1ha2luZyB0aGUgcmVxdWVzdCBiZWZvcmUgY2FsbGluZ1xuICAgKiAuaWRlbnRpZnlVc2VyKCkhXG4gICAqXG4gICAqIEBwYXJhbSBpZGVudGl0eSBUZWxsIExpdmVibG9ja3MgdGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgdG8gYXV0aGVudGljYXRlLlxuICAgKiBNdXN0IHVuaXF1ZWx5IGlkZW50aWZ5IHRoZSB1c2VyIGFjY291bnQgaW4geW91ciBzeXN0ZW0uIFRoZSB1bmlxdWVuZXNzIG9mXG4gICAqIHRoaXMgdmFsdWUgd2lsbCBkZXRlcm1pbmUgaG93IG1hbnkgTUFVcyB3aWxsIGJlIGNvdW50ZWQvYmlsbGVkLlxuICAgKlxuICAgKiBJZiB5b3UgYWxzbyB3YW50IHRvIGFzc2lnbiB3aGljaCBncm91cHMgdGhpcyB1c2VyIGJlbG9uZ3MgdG8sIHVzZSB0aGVcbiAgICogb2JqZWN0IGZvcm0gYW5kIHNwZWNpZnkgdGhlIGBncm91cElkc2AgcHJvcGVydHkuIFRob3NlIGBncm91cElkc2Agc2hvdWxkXG4gICAqIG1hdGNoIHRoZSBncm91cElkcyB5b3UgYXNzaWduZWQgcGVybWlzc2lvbnMgdG8gdmlhIHRoZSBMaXZlYmxvY2tzXG4gICAqIFBlcm1pc3Npb25zIEFQSSwgc2VlXG4gICAqIGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL3Jvb21zL3Blcm1pc3Npb25zI3Blcm1pc3Npb25zLWxldmVscy1ncm91cHMtYWNjZXNzZXMtZXhhbXBsZVxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucy51c2VySW5mbyBDdXN0b20gbWV0YWRhdGEgdG8gYXR0YWNoIHRvIHRoaXMgdXNlci4gRGF0YSB5b3VcbiAgICogYWRkIGhlcmUgd2lsbCBiZSB2aXNpYmxlIHRvIGFsbCBvdGhlciBjbGllbnRzIGluIHRoZSByb29tLCB0aHJvdWdoIHRoZVxuICAgKiBgb3RoZXIuaW5mb2AgcHJvcGVydHkuXG4gICAqL1xuICAvLyBUaGVzZSBmaWVsZHMgZGVmaW5lIHRoZSBzZWN1cml0eSBpZGVudGl0eSBvZiB0aGUgdXNlci4gV2hhdGV2ZXIgeW91IHBhc3MgaW4gaGVyZSB3aWxsIGRlZmluZSB3aGljaFxuICBhc3luYyBpZGVudGlmeVVzZXIoaWRlbnRpdHksIC4uLnJlc3QpIHtcbiAgICBjb25zdCBvcHRpb25zID0gcmVzdFswXTtcbiAgICBjb25zdCBwYXRoID0gdXJsYC92Mi9pZGVudGlmeS11c2VyYDtcbiAgICBjb25zdCB1c2VySWQgPSB0eXBlb2YgaWRlbnRpdHkgPT09IFwic3RyaW5nXCIgPyBpZGVudGl0eSA6IGlkZW50aXR5LnVzZXJJZDtcbiAgICBjb25zdCBncm91cElkcyA9IHR5cGVvZiBpZGVudGl0eSA9PT0gXCJzdHJpbmdcIiA/IHZvaWQgMCA6IGlkZW50aXR5Lmdyb3VwSWRzO1xuICAgIGFzc2VydE5vbkVtcHR5KHVzZXJJZCwgXCJ1c2VySWRcIik7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCB0aGlzLnBvc3QocGF0aCwge1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIGdyb3VwSWRzLFxuICAgICAgICAvLyBPcHRpb25hbCBtZXRhZGF0YVxuICAgICAgICB1c2VySW5mbzogb3B0aW9ucz8udXNlckluZm9cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiBub3JtYWxpemVTdGF0dXNDb2RlKHJlc3Auc3RhdHVzKSxcbiAgICAgICAgYm9keTogYXdhaXQgcmVzcC50ZXh0KClcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogNTAzLFxuICAgICAgICBib2R5OiBgQ2FsbCB0byAke3VybGpvaW4oXG4gICAgICAgICAgdGhpcy5fYmFzZVVybCxcbiAgICAgICAgICBwYXRoXG4gICAgICAgICl9IGZhaWxlZC4gU2VlIFwiZXJyb3JcIiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5gLFxuICAgICAgICBlcnJvcjogZXJcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogUm9vbVxuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbGlzdCBvZiB5b3VyIHJvb21zLiBUaGUgcm9vbXMgYXJlIHJldHVybmVkIHNvcnRlZCBieSBjcmVhdGlvbiBkYXRlLCBmcm9tIG5ld2VzdCB0byBvbGRlc3QuIFlvdSBjYW4gZmlsdGVyIHJvb21zIGJ5IG1ldGFkYXRhLCB1c2VycyBhY2Nlc3NlcyBhbmQgZ3JvdXBzIGFjY2Vzc2VzLlxuICAgKiBAcGFyYW0gcGFyYW1zLmxpbWl0IChvcHRpb25hbCkgQSBsaW1pdCBvbiB0aGUgbnVtYmVyIG9mIHJvb21zIHRvIGJlIHJldHVybmVkLiBUaGUgbGltaXQgY2FuIHJhbmdlIGJldHdlZW4gMSBhbmQgMTAwLCBhbmQgZGVmYXVsdHMgdG8gMjAuXG4gICAqIEBwYXJhbSBwYXJhbXMuc3RhcnRpbmdBZnRlciAob3B0aW9uYWwpIEEgY3Vyc29yIHVzZWQgZm9yIHBhZ2luYXRpb24uIFlvdSBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHJlc3BvbnNlIG9mIHRoZSBwcmV2aW91cyBwYWdlLlxuICAgKiBAcGFyYW0gcGFyYW1zLnVzZXJJZCAob3B0aW9uYWwpIEEgZmlsdGVyIG9uIHVzZXJzIGFjY2Vzc2VzLlxuICAgKiBAcGFyYW0gcGFyYW1zLm1ldGFkYXRhIChvcHRpb25hbCkgQSBmaWx0ZXIgb24gbWV0YWRhdGEuIE11bHRpcGxlIG1ldGFkYXRhIGtleXMgY2FuIGJlIHVzZWQgdG8gZmlsdGVyIHJvb21zLlxuICAgKiBAcGFyYW0gcGFyYW1zLmdyb3VwSWRzIChvcHRpb25hbCkgQSBmaWx0ZXIgb24gZ3JvdXBzIGFjY2Vzc2VzLiBNdWx0aXBsZSBncm91cHMgY2FuIGJlIHVzZWQuXG4gICAqIEBwYXJhbSBwYXJhbXMucXVlcnkgKG9wdGlvbmFsKSBBIHF1ZXJ5IHRvIGZpbHRlciByb29tcyBieS4gSXQgaXMgYmFzZWQgb24gb3VyIHF1ZXJ5IGxhbmd1YWdlLiBZb3UgY2FuIGZpbHRlciBieSBtZXRhZGF0YSBhbmQgcm9vbSBJRC5cbiAgICogQHJldHVybnMgQSBsaXN0IG9mIHJvb21zLlxuICAgKi9cbiAgYXN5bmMgZ2V0Um9vbXMocGFyYW1zID0ge30pIHtcbiAgICBjb25zdCBwYXRoID0gdXJsYC92Mi9yb29tc2A7XG4gICAgbGV0IHF1ZXJ5O1xuICAgIGlmICh0eXBlb2YgcGFyYW1zLnF1ZXJ5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBxdWVyeSA9IHBhcmFtcy5xdWVyeTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXMucXVlcnkgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHF1ZXJ5ID0gb2JqZWN0VG9RdWVyeShwYXJhbXMucXVlcnkpO1xuICAgIH1cbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHtcbiAgICAgIGxpbWl0OiBwYXJhbXMubGltaXQsXG4gICAgICBzdGFydGluZ0FmdGVyOiBwYXJhbXMuc3RhcnRpbmdBZnRlcixcbiAgICAgIHVzZXJJZDogcGFyYW1zLnVzZXJJZCxcbiAgICAgIGdyb3VwSWRzOiBwYXJhbXMuZ3JvdXBJZHMgPyBwYXJhbXMuZ3JvdXBJZHMuam9pbihcIixcIikgOiB2b2lkIDAsXG4gICAgICAvLyBcIkZsYXR0ZW5cIiB7bWV0YWRhdGE6IHtmb286IFwiYmFyXCJ9fSB0byB7XCJtZXRhZGF0YS5mb29cIjogXCJiYXJcIn1cbiAgICAgIC4uLk9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgT2JqZWN0LmVudHJpZXMocGFyYW1zLm1ldGFkYXRhID8/IHt9KS5tYXAoKFtrZXksIHZhbF0pID0+IFtcbiAgICAgICAgICBgbWV0YWRhdGEuJHtrZXl9YCxcbiAgICAgICAgICB2YWxcbiAgICAgICAgXSlcbiAgICAgICksXG4gICAgICBxdWVyeVxuICAgIH07XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQocGF0aCwgcXVlcnlQYXJhbXMpO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgIGNvbnN0IHJvb21zID0gZGF0YS5kYXRhLm1hcCgocm9vbSkgPT4ge1xuICAgICAgY29uc3QgbGFzdENvbm5lY3Rpb25BdCA9IHJvb20ubGFzdENvbm5lY3Rpb25BdCA/IG5ldyBEYXRlKHJvb20ubGFzdENvbm5lY3Rpb25BdCkgOiB2b2lkIDA7XG4gICAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShyb29tLmNyZWF0ZWRBdCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5yb29tLFxuICAgICAgICBjcmVhdGVkQXQsXG4gICAgICAgIGxhc3RDb25uZWN0aW9uQXRcbiAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBkYXRhOiByb29tc1xuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgcm9vbSB3aXRoIHRoZSBnaXZlbiBpZC5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gY3JlYXRlLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRlZmF1bHRBY2Nlc3NlcyBUaGUgZGVmYXVsdCBhY2Nlc3NlcyBmb3IgdGhlIHJvb20uXG4gICAqIEBwYXJhbSBwYXJhbXMuZ3JvdXBzQWNjZXNzZXMgKG9wdGlvbmFsKSBUaGUgZ3JvdXAgYWNjZXNzZXMgZm9yIHRoZSByb29tLiBDYW4gY29udGFpbiBhIG1heGltdW0gb2YgMTAwIGVudHJpZXMuIEtleSBsZW5ndGggaGFzIGEgbGltaXQgb2YgNDAgY2hhcmFjdGVycy5cbiAgICogQHBhcmFtIHBhcmFtcy51c2Vyc0FjY2Vzc2VzIChvcHRpb25hbCkgVGhlIHVzZXIgYWNjZXNzZXMgZm9yIHRoZSByb29tLiBDYW4gY29udGFpbiBhIG1heGltdW0gb2YgMTAwIGVudHJpZXMuIEtleSBsZW5ndGggaGFzIGEgbGltaXQgb2YgNDAgY2hhcmFjdGVycy5cbiAgICogQHBhcmFtIHBhcmFtcy5tZXRhZGF0YSAob3B0aW9uYWwpIFRoZSBtZXRhZGF0YSBmb3IgdGhlIHJvb20uIFN1cHBvcnRzIHVwdG8gYSBtYXhpbXVtIG9mIDUwIGVudHJpZXMuIEtleSBsZW5ndGggaGFzIGEgbGltaXQgb2YgNDAgY2hhcmFjdGVycy4gVmFsdWUgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDI1NiBjaGFyYWN0ZXJzLlxuICAgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCByb29tLlxuICAgKi9cbiAgYXN5bmMgY3JlYXRlUm9vbShyb29tSWQsIHBhcmFtcykge1xuICAgIGNvbnN0IHsgZGVmYXVsdEFjY2Vzc2VzLCBncm91cHNBY2Nlc3NlcywgdXNlcnNBY2Nlc3NlcywgbWV0YWRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QodXJsYC92Mi9yb29tc2AsIHtcbiAgICAgIGlkOiByb29tSWQsXG4gICAgICBkZWZhdWx0QWNjZXNzZXMsXG4gICAgICBncm91cHNBY2Nlc3NlcyxcbiAgICAgIHVzZXJzQWNjZXNzZXMsXG4gICAgICBtZXRhZGF0YVxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgIGNvbnN0IGxhc3RDb25uZWN0aW9uQXQgPSBkYXRhLmxhc3RDb25uZWN0aW9uQXQgPyBuZXcgRGF0ZShkYXRhLmxhc3RDb25uZWN0aW9uQXQpIDogdm9pZCAwO1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIGxhc3RDb25uZWN0aW9uQXQsXG4gICAgICBjcmVhdGVkQXRcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgcm9vbSB3aXRoIHRoZSBnaXZlbiBpZC5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gcmV0dXJuLlxuICAgKiBAcmV0dXJucyBUaGUgcm9vbSB3aXRoIHRoZSBnaXZlbiBpZC5cbiAgICovXG4gIGFzeW5jIGdldFJvb20ocm9vbUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQodXJsYC92Mi9yb29tcy8ke3Jvb21JZH1gKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICBjb25zdCBsYXN0Q29ubmVjdGlvbkF0ID0gZGF0YS5sYXN0Q29ubmVjdGlvbkF0ID8gbmV3IERhdGUoZGF0YS5sYXN0Q29ubmVjdGlvbkF0KSA6IHZvaWQgMDtcbiAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICBsYXN0Q29ubmVjdGlvbkF0XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogVXBkYXRlcyBzcGVjaWZpYyBwcm9wZXJ0aWVzIG9mIGEgcm9vbS4gSXTigJlzIG5vdCBuZWNlc3NhcnkgdG8gcHJvdmlkZSB0aGUgZW50aXJlIHJvb23igJlzIGluZm9ybWF0aW9uLlxuICAgKiBTZXR0aW5nIGEgcHJvcGVydHkgdG8gYG51bGxgIG1lYW5zIHRvIGRlbGV0ZSB0aGlzIHByb3BlcnR5LlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGVmYXVsdEFjY2Vzc2VzIChvcHRpb25hbCkgVGhlIGRlZmF1bHQgYWNjZXNzZXMgZm9yIHRoZSByb29tLlxuICAgKiBAcGFyYW0gcGFyYW1zLmdyb3Vwc0FjY2Vzc2VzIChvcHRpb25hbCkgVGhlIGdyb3VwIGFjY2Vzc2VzIGZvciB0aGUgcm9vbS4gQ2FuIGNvbnRhaW4gYSBtYXhpbXVtIG9mIDEwMCBlbnRyaWVzLiBLZXkgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDQwIGNoYXJhY3RlcnMuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcnNBY2Nlc3NlcyAob3B0aW9uYWwpIFRoZSB1c2VyIGFjY2Vzc2VzIGZvciB0aGUgcm9vbS4gQ2FuIGNvbnRhaW4gYSBtYXhpbXVtIG9mIDEwMCBlbnRyaWVzLiBLZXkgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDQwIGNoYXJhY3RlcnMuXG4gICAqIEBwYXJhbSBwYXJhbXMubWV0YWRhdGEgKG9wdGlvbmFsKSBUaGUgbWV0YWRhdGEgZm9yIHRoZSByb29tLiBTdXBwb3J0cyB1cHRvIGEgbWF4aW11bSBvZiA1MCBlbnRyaWVzLiBLZXkgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDQwIGNoYXJhY3RlcnMuIFZhbHVlIGxlbmd0aCBoYXMgYSBsaW1pdCBvZiAyNTYgY2hhcmFjdGVycy5cbiAgICogQHJldHVybnMgVGhlIHVwZGF0ZWQgcm9vbS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVJvb20ocm9vbUlkLCBwYXJhbXMpIHtcbiAgICBjb25zdCB7IGRlZmF1bHRBY2Nlc3NlcywgZ3JvdXBzQWNjZXNzZXMsIHVzZXJzQWNjZXNzZXMsIG1ldGFkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9YCwge1xuICAgICAgZGVmYXVsdEFjY2Vzc2VzLFxuICAgICAgZ3JvdXBzQWNjZXNzZXMsXG4gICAgICB1c2Vyc0FjY2Vzc2VzLFxuICAgICAgbWV0YWRhdGFcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICBjb25zdCBsYXN0Q29ubmVjdGlvbkF0ID0gZGF0YS5sYXN0Q29ubmVjdGlvbkF0ID8gbmV3IERhdGUoZGF0YS5sYXN0Q29ubmVjdGlvbkF0KSA6IHZvaWQgMDtcbiAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBsYXN0Q29ubmVjdGlvbkF0LFxuICAgICAgY3JlYXRlZEF0XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhIHJvb20gd2l0aCB0aGUgZ2l2ZW4gaWQuIEEgZGVsZXRlZCByb29tIGlzIG5vIGxvbmdlciBhY2Nlc3NpYmxlIGZyb20gdGhlIEFQSSBvciB0aGUgZGFzaGJvYXJkIGFuZCBpdCBjYW5ub3QgYmUgcmVzdG9yZWQuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGRlbGV0ZS5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVJvb20ocm9vbUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUodXJsYC92Mi9yb29tcy8ke3Jvb21JZH1gKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIGxpc3Qgb2YgdXNlcnMgY3VycmVudGx5IHByZXNlbnQgaW4gdGhlIHJlcXVlc3RlZCByb29tLiBGb3IgYmV0dGVyIHBlcmZvcm1hbmNlLCB3ZSByZWNvbW1hbmQgdG8gY2FsbCB0aGlzIGVuZHBvaW50IGV2ZXJ5IDEwIHNlY29uZHMgbWF4aW11bS4gRHVwbGljYXRlcyBjYW4gaGFwcGVuIGlmIGEgdXNlciBpcyBpbiB0aGUgcmVxdWVzdGVkIHJvb20gd2l0aCBtdWx0aXBsZSBicm93c2VyIHRhYnMgb3BlbmVkLlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byBnZXQgdGhlIHVzZXJzIGZyb20uXG4gICAqIEByZXR1cm5zIEEgbGlzdCBvZiB1c2VycyBjdXJyZW50bHkgcHJlc2VudCBpbiB0aGUgcmVxdWVzdGVkIHJvb20uXG4gICAqL1xuICBhc3luYyBnZXRBY3RpdmVVc2Vycyhyb29tSWQpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdldCh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS9hY3RpdmVfdXNlcnNgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbiAgfVxuICAvKipcbiAgICogQm9hZGNhc3RzIGFuIGV2ZW50IHRvIGEgcm9vbSB3aXRob3V0IGhhdmluZyB0byBjb25uZWN0IHRvIGl0IHZpYSB0aGUgY2xpZW50IGZyb20gQGxpdmVibG9ja3MvY2xpZW50LiBUaGUgY29ubmVjdGlvbklkIHBhc3NlZCB0byBldmVudCBsaXN0ZW5lcnMgaXMgLTEgd2hlbiB1c2luZyB0aGlzIEFQSS5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gYnJvYWRjYXN0IHRoZSBldmVudCB0by5cbiAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gYnJvYWRjYXN0LiBJdCBjYW4gYmUgYW55IEpTT04gc2VyaWFsaXphYmxlIHZhbHVlLlxuICAgKi9cbiAgYXN5bmMgYnJvYWRjYXN0RXZlbnQocm9vbUlkLCBtZXNzYWdlKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vYnJvYWRjYXN0X2V2ZW50YCxcbiAgICAgIG1lc3NhZ2VcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGdldFN0b3JhZ2VEb2N1bWVudChyb29tSWQsIGZvcm1hdCA9IFwicGxhaW4tbHNvblwiKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vc3RvcmFnZWAsIHsgZm9ybWF0IH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyBhIHJvb23igJlzIFN0b3JhZ2UuIFRoZSByb29tIG11c3QgYWxyZWFkeSBleGlzdCBhbmQgaGF2ZSBhbiBlbXB0eSBTdG9yYWdlLlxuICAgKiBDYWxsaW5nIHRoaXMgZW5kcG9pbnQgd2lsbCBkaXNjb25uZWN0IGFsbCB1c2VycyBmcm9tIHRoZSByb29tIGlmIHRoZXJlIGFyZSBhbnkuXG4gICAqXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGluaXRpYWxpemUgdGhlIHN0b3JhZ2UgZnJvbS5cbiAgICogQHBhcmFtIGRvY3VtZW50IFRoZSBkb2N1bWVudCB0byBpbml0aWFsaXplIHRoZSBzdG9yYWdlIHdpdGguXG4gICAqIEByZXR1cm5zIFRoZSBpbml0aWFsaXplZCBzdG9yYWdlIGRvY3VtZW50LiBJdCBpcyBvZiB0aGUgc2FtZSBmb3JtYXQgYXMgdGhlIG9uZSBwYXNzZWQgaW4uXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplU3RvcmFnZURvY3VtZW50KHJvb21JZCwgZG9jdW1lbnQpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vc3RvcmFnZWAsIGRvY3VtZW50KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhbGwgb2YgdGhlIHJvb23igJlzIFN0b3JhZ2UgZGF0YSBhbmQgZGlzY29ubmVjdCBhbGwgdXNlcnMgZnJvbSB0aGUgcm9vbSBpZiB0aGVyZSBhcmUgYW55LiBOb3RlIHRoYXQgdGhpcyBkb2VzIG5vdCBkZWxldGUgdGhlIFlqcyBkb2N1bWVudCBpbiB0aGUgcm9vbSBpZiBvbmUgZXhpc3RzLlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byBkZWxldGUgdGhlIHN0b3JhZ2UgZnJvbS5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVN0b3JhZ2VEb2N1bWVudChyb29tSWQpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmRlbGV0ZSh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS9zdG9yYWdlYCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gIH1cbiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBZanNcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuICAvKipcbiAgICogUmV0dXJucyBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgdGhlIHJvb23igJlzIFlqcyBkb2N1bWVudC5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gZ2V0IHRoZSBZanMgZG9jdW1lbnQgZnJvbS5cbiAgICogQHBhcmFtIHBhcmFtcy5mb3JtYXQgKG9wdGlvbmFsKSBJZiB0cnVlLCBZVGV4dCB3aWxsIHJldHVybiBmb3JtYXR0aW5nLlxuICAgKiBAcGFyYW0gcGFyYW1zLmtleSAob3B0aW9uYWwpIElmIHByb3ZpZGVkLCByZXR1cm5zIG9ubHkgYSBzaW5nbGUga2V54oCZcyB2YWx1ZSwgZS5nLiBkb2MuZ2V0KGtleSkudG9KU09OKCkuXG4gICAqIEBwYXJhbSBwYXJhbXMudHlwZSAob3B0aW9uYWwpIFVzZWQgd2l0aCBrZXkgdG8gb3ZlcnJpZGUgdGhlIGluZmVycmVkIHR5cGUsIGkuZS4gXCJ5bWFwXCIgd2lsbCByZXR1cm4gZG9jLmdldChrZXksIFkuTWFwKS5cbiAgICogQHJldHVybnMgQSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSByb29t4oCZcyBZanMgZG9jdW1lbnQuXG4gICAqL1xuICBhc3luYyBnZXRZanNEb2N1bWVudChyb29tSWQsIHBhcmFtcyA9IHt9KSB7XG4gICAgY29uc3QgeyBmb3JtYXQsIGtleSwgdHlwZSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHBhdGggPSB1cmxgdjIvcm9vbXMvJHtyb29tSWR9L3lkb2NgO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHBhdGgsIHtcbiAgICAgIGZvcm1hdHRpbmc6IGZvcm1hdCA/IFwidHJ1ZVwiIDogdm9pZCAwLFxuICAgICAga2V5LFxuICAgICAgdHlwZVxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBTZW5kIGEgWWpzIGJpbmFyeSB1cGRhdGUgdG8gdGhlIHJvb23igJlzIFlqcyBkb2N1bWVudC4gWW91IGNhbiB1c2UgdGhpcyBlbmRwb2ludCB0byBpbml0aWFsaXplIFlqcyBkYXRhIGZvciB0aGUgcm9vbSBvciB0byB1cGRhdGUgdGhlIHJvb23igJlzIFlqcyBkb2N1bWVudC5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gc2VuZCB0aGUgWWpzIGJpbmFyeSB1cGRhdGUgdG8uXG4gICAqIEBwYXJhbSB1cGRhdGUgVGhlIFlqcyB1cGRhdGUgdG8gc2VuZC4gVHlwaWNhbGx5IHRoZSByZXN1bHQgb2YgY2FsbGluZyBgWWpzLmVuY29kZVN0YXRlQXNVcGRhdGUoZG9jKWAuIFJlYWQgdGhlIFtZanMgZG9jdW1lbnRhdGlvbl0oaHR0cHM6Ly9kb2NzLnlqcy5kZXYvYXBpL2RvY3VtZW50LXVwZGF0ZXMpIHRvIGxlYXJuIGhvdyB0byBjcmVhdGUgYSBiaW5hcnkgdXBkYXRlLlxuICAgKiBAcGFyYW0gcGFyYW1zLmd1aWQgKG9wdGlvbmFsKSBJZiBwcm92aWRlZCwgdGhlIGJpbmFyeSB1cGRhdGUgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBZanMgc3ViZG9jdW1lbnQgd2l0aCB0aGUgZ2l2ZW4gZ3VpZC4gSWYgbm90IHByb3ZpZGVkLCB0aGUgYmluYXJ5IHVwZGF0ZSB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIHJvb3QgWWpzIGRvY3VtZW50LlxuICAgKi9cbiAgYXN5bmMgc2VuZFlqc0JpbmFyeVVwZGF0ZShyb29tSWQsIHVwZGF0ZSwgcGFyYW1zID0ge30pIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnB1dEJpbmFyeSh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS95ZG9jYCwgdXBkYXRlLCB7XG4gICAgICBndWlkOiBwYXJhbXMuZ3VpZFxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSByb29t4oCZcyBZanMgZG9jdW1lbnQgZW5jb2RlZCBhcyBhIHNpbmdsZSBiaW5hcnkgdXBkYXRlLiBUaGlzIGNhbiBiZSB1c2VkIGJ5IFkuYXBwbHlVcGRhdGUocmVzcG9uc2VCb2R5KSB0byBnZXQgYSBjb3B5IG9mIHRoZSBkb2N1bWVudCBpbiB5b3VyIGJhY2tlbmQuXG4gICAqIFNlZSBbWWpzIGRvY3VtZW50YXRpb25dKGh0dHBzOi8vZG9jcy55anMuZGV2L2FwaS9kb2N1bWVudC11cGRhdGVzKSBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB3b3JraW5nIHdpdGggdXBkYXRlcy5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gZ2V0IHRoZSBZanMgZG9jdW1lbnQgZnJvbS5cbiAgICogQHBhcmFtIHBhcmFtcy5ndWlkIChvcHRpb25hbCkgSWYgcHJvdmlkZWQsIHJldHVybnMgdGhlIGJpbmFyeSB1cGRhdGUgb2YgdGhlIFlqcyBzdWJkb2N1bWVudCB3aXRoIHRoZSBnaXZlbiBndWlkLiBJZiBub3QgcHJvdmlkZWQsIHJldHVybnMgdGhlIGJpbmFyeSB1cGRhdGUgb2YgdGhlIHJvb3QgWWpzIGRvY3VtZW50LlxuICAgKiBAcmV0dXJucyBUaGUgcm9vbeKAmXMgWWpzIGRvY3VtZW50IGVuY29kZWQgYXMgYSBzaW5nbGUgYmluYXJ5IHVwZGF0ZS5cbiAgICovXG4gIGFzeW5jIGdldFlqc0RvY3VtZW50QXNCaW5hcnlVcGRhdGUocm9vbUlkLCBwYXJhbXMgPSB7fSkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3lkb2MtYmluYXJ5YCwge1xuICAgICAgZ3VpZDogcGFyYW1zLmd1aWRcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzLmFycmF5QnVmZmVyKCk7XG4gIH1cbiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBTY2hlbWEgVmFsaWRhdGlvblxuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHNjaGVtYSB3aGljaCBjYW4gYmUgcmVmZXJlbmNlZCBsYXRlciB0byBlbmZvcmNlIGEgcm9vbeKAmXMgU3RvcmFnZSBkYXRhIHN0cnVjdHVyZS5cbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgdXNlZCB0byByZWZlcmVuY2UgdGhlIHNjaGVtYS4gTXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcgd2l0aCBsZXNzIHRoYW4gNjUgY2hhcmFjdGVycyBhbmQgb25seSBjb250YWluIGxvd2VyY2FzZSBsZXR0ZXJzLCBudW1iZXJzIGFuZCBkYXNoZXNcbiAgICogQHBhcmFtIGJvZHkgVGhlIGV4YWN0IGFsbG93ZWQgc2hhcGUgb2YgZGF0YSBpbiB0aGUgcm9vbS4gSXQgaXMgYSBtdWx0aS1saW5lIHN0cmluZyB3cml0dGVuIGluIHRoZSBbTGl2ZWJsb2NrcyBzY2hlbWEgc3ludGF4XShodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9wbGF0Zm9ybS9zY2hlbWEtdmFsaWRhdGlvbi9zeW50YXgpLlxuICAgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCBzY2hlbWEuXG4gICAqL1xuICBhc3luYyBjcmVhdGVTY2hlbWEobmFtZSwgYm9keSkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdCh1cmxgL3YyL3NjaGVtYXNgLCB7XG4gICAgICBuYW1lLFxuICAgICAgYm9keVxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgICBjb25zdCB1cGRhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLnVwZGF0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkQXRcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgc2NoZW1hIGJ5IGl0cyBpZC5cbiAgICogQHBhcmFtIHNjaGVtYUlkIElkIG9mIHRoZSBzY2hlbWEgLSB0aGlzIGlzIHRoZSBjb21iaW5hdGlvbiBvZiB0aGUgc2NoZW1hIG5hbWUgYW5kIHZlcnNpb24gb2YgdGhlIHNjaGVtYSB0byB1cGRhdGUuIEZvciBleGFtcGxlLCBgbXktc2NoZW1hQDFgLlxuICAgKiBAcmV0dXJucyBUaGUgc2NoZW1hIHdpdGggdGhlIGdpdmVuIGlkLlxuICAgKi9cbiAgYXN5bmMgZ2V0U2NoZW1hKHNjaGVtYUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQodXJsYC92Mi9zY2hlbWFzLyR7c2NoZW1hSWR9YCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICAgIGNvbnN0IHVwZGF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEudXBkYXRlZEF0KTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIGNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdFxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIGJvZHkgZm9yIHRoZSBzY2hlbWEuIEEgc2NoZW1hIGNhbiBvbmx5IGJlIHVwZGF0ZWQgaWYgaXQgaXMgbm90IHVzZWQgYnkgYW55IHJvb20uXG4gICAqIEBwYXJhbSBzY2hlbWFJZCBJZCBvZiB0aGUgc2NoZW1hIC0gdGhpcyBpcyB0aGUgY29tYmluYXRpb24gb2YgdGhlIHNjaGVtYSBuYW1lIGFuZCB2ZXJzaW9uIG9mIHRoZSBzY2hlbWEgdG8gdXBkYXRlLiBGb3IgZXhhbXBsZSwgYG15LXNjaGVtYUAxYC5cbiAgICogQHBhcmFtIGJvZHkgVGhlIGV4YWN0IGFsbG93ZWQgc2hhcGUgb2YgZGF0YSBpbiB0aGUgcm9vbS4gSXQgaXMgYSBtdWx0aS1saW5lIHN0cmluZyB3cml0dGVuIGluIHRoZSBbTGl2ZWJsb2NrcyBzY2hlbWEgc3ludGF4XShodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9wbGF0Zm9ybS9zY2hlbWEtdmFsaWRhdGlvbi9zeW50YXgpLlxuICAgKiBAcmV0dXJucyBUaGUgdXBkYXRlZCBzY2hlbWEuIFRoZSB2ZXJzaW9uIG9mIHRoZSBzY2hlbWEgd2lsbCBiZSBpbmNyZW1lbnRlZC5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNjaGVtYShzY2hlbWFJZCwgYm9keSkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucHV0KHVybGAvdjIvc2NoZW1hcy8ke3NjaGVtYUlkfWAsIHtcbiAgICAgIGJvZHlcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdCk7XG4gICAgY29uc3QgdXBkYXRlZEF0ID0gbmV3IERhdGUoZGF0YS51cGRhdGVkQXQpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhIHNjaGVtYSBieSBpdHMgaWQuIEEgc2NoZW1hIGNhbiBvbmx5IGJlIGRlbGV0ZWQgaWYgaXQgaXMgbm90IHVzZWQgYnkgYW55IHJvb20uXG4gICAqIEBwYXJhbSBzY2hlbWFJZCBJZCBvZiB0aGUgc2NoZW1hIC0gdGhpcyBpcyB0aGUgY29tYmluYXRpb24gb2YgdGhlIHNjaGVtYSBuYW1lIGFuZCB2ZXJzaW9uIG9mIHRoZSBzY2hlbWEgdG8gdXBkYXRlLiBGb3IgZXhhbXBsZSwgYG15LXNjaGVtYUAxYC5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVNjaGVtYShzY2hlbWFJZCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKHVybGAvdjIvc2NoZW1hcy8ke3NjaGVtYUlkfWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBzY2hlbWEgYXR0YWNoZWQgdG8gYSByb29tLlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byBnZXQgdGhlIHNjaGVtYSBmcm9tLlxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgYXN5bmMgZ2V0U2NoZW1hQnlSb29tSWQocm9vbUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vc2NoZW1hYCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICAgIGNvbnN0IHVwZGF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEudXBkYXRlZEF0KTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIGNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdFxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEF0dGFjaGVzIGEgc2NoZW1hIHRvIGEgcm9vbSwgYW5kIGluc3RhbnRseSBlbmFibGVzIHJ1bnRpbWUgc2NoZW1hIHZhbGlkYXRpb24gZm9yIHRoZSByb29tLlxuICAgKiBJZiB0aGUgY3VycmVudCBjb250ZW50cyBvZiB0aGUgcm9vbeKAmXMgU3RvcmFnZSBkbyBub3QgbWF0Y2ggdGhlIHNjaGVtYSwgYXR0YWNoaW5nIHdpbGwgZmFpbCBhbmQgdGhlIGVycm9yIG1lc3NhZ2Ugd2lsbCBnaXZlIGRldGFpbHMgb24gd2h5IHRoZSBzY2hlbWEgZmFpbGVkIHRvIGF0dGFjaC5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gYXR0YWNoIHRoZSBzY2hlbWEgdG8uXG4gICAqIEBwYXJhbSBzY2hlbWFJZCBJZCBvZiB0aGUgc2NoZW1hIC0gdGhpcyBpcyB0aGUgY29tYmluYXRpb24gb2YgdGhlIHNjaGVtYSBuYW1lIGFuZCB2ZXJzaW9uIG9mIHRoZSBzY2hlbWEgdG8gdXBkYXRlLiBGb3IgZXhhbXBsZSwgYG15LXNjaGVtYUAxYC5cbiAgICogQHJldHVybnMgVGhlIHNjaGVtYSBpZCBhcyBKU09OLlxuICAgKi9cbiAgYXN5bmMgYXR0YWNoU2NoZW1hVG9Sb29tKHJvb21JZCwgc2NoZW1hSWQpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vc2NoZW1hYCwge1xuICAgICAgc2NoZW1hOiBzY2hlbWFJZFxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBEZXRhY2hlcyBhIHNjaGVtYSBmcm9tIGEgcm9vbSwgYW5kIGRpc2FibGVzIHJ1bnRpbWUgc2NoZW1hIHZhbGlkYXRpb24gZm9yIHRoZSByb29tLlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byBkZXRhY2ggdGhlIHNjaGVtYSBmcm9tLlxuICAgKi9cbiAgYXN5bmMgZGV0YWNoU2NoZW1hRnJvbVJvb20ocm9vbUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vc2NoZW1hYCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gIH1cbiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBDb21tZW50c1xuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4gIC8qKlxuICAgKiBHZXRzIGFsbCB0aGUgdGhyZWFkcyBpbiBhIHJvb20uXG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGdldCB0aGUgdGhyZWFkcyBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLnF1ZXJ5IFRoZSBxdWVyeSB0byBmaWx0ZXIgdGhyZWFkcyBieS4gSXQgaXMgYmFzZWQgb24gb3VyIHF1ZXJ5IGxhbmd1YWdlIGFuZCBjYW4gZmlsdGVyIGJ5IG1ldGFkYXRhLlxuICAgKiBAcmV0dXJucyBBIGxpc3Qgb2YgdGhyZWFkcy5cbiAgICovXG4gIGFzeW5jIGdldFRocmVhZHMocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQgfSA9IHBhcmFtcztcbiAgICBsZXQgcXVlcnk7XG4gICAgaWYgKHR5cGVvZiBwYXJhbXMucXVlcnkgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHF1ZXJ5ID0gcGFyYW1zLnF1ZXJ5O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhcmFtcy5xdWVyeSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgcXVlcnkgPSBvYmplY3RUb1F1ZXJ5KHBhcmFtcy5xdWVyeSk7XG4gICAgfVxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3RocmVhZHNgLCB7XG4gICAgICBxdWVyeVxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogZGF0YS5tYXAoKHRocmVhZCkgPT4gY29udmVydFRvVGhyZWFkRGF0YSh0aHJlYWQpKVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEdldHMgYSB0aHJlYWQuXG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGdldCB0aGUgdGhyZWFkIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRC5cbiAgICogQHJldHVybnMgQSB0aHJlYWQuXG4gICAqL1xuICBhc3luYyBnZXRUaHJlYWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0VG9UaHJlYWREYXRhKGF3YWl0IHJlcy5qc29uKCkpO1xuICB9XG4gIC8qKlxuICAgKiBHZXRzIGEgdGhyZWFkJ3MgcGFydGljaXBhbnRzLlxuICAgKlxuICAgKiBQYXJ0aWNpcGFudHMgYXJlIHVzZXJzIHdobyBoYXZlIGNvbW1lbnRlZCBvbiB0aGUgdGhyZWFkXG4gICAqIG9yIHVzZXJzIGFuZCBncm91cHMgdGhhdCBoYXZlIGJlZW4gbWVudGlvbmVkIGluIGEgY29tbWVudC5cbiAgICpcbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gZ2V0IHRoZSB0aHJlYWQgcGFydGljaXBhbnRzIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byBnZXQgdGhlIHBhcnRpY2lwYW50cyBmcm9tLlxuICAgKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyBhbiBhcnJheSBvZiBwYXJ0aWNpcGFudCBJRHMuXG4gICAqL1xuICBhc3luYyBnZXRUaHJlYWRQYXJ0aWNpcGFudHMocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L3BhcnRpY2lwYW50c2BcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBHZXRzIGEgdGhyZWFkJ3MgY29tbWVudC5cbiAgICpcbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gZ2V0IHRoZSBjb21tZW50IGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byBnZXQgdGhlIGNvbW1lbnQgZnJvbS5cbiAgICogQHBhcmFtIHBhcmFtcy5jb21tZW50SWQgVGhlIGNvbW1lbnQgSUQuXG4gICAqIEByZXR1cm5zIEEgY29tbWVudC5cbiAgICovXG4gIGFzeW5jIGdldENvbW1lbnQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkLCBjb21tZW50SWQgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdldChcbiAgICAgIHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3RocmVhZHMvJHt0aHJlYWRJZH0vY29tbWVudHMvJHtjb21tZW50SWR9YFxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnREYXRhKGF3YWl0IHJlcy5qc29uKCkpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgY29tbWVudC5cbiAgICpcbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gY3JlYXRlIHRoZSBjb21tZW50IGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gY3JlYXRlIHRoZSBjb21tZW50IGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEudXNlcklkIFRoZSB1c2VyIElEIG9mIHRoZSB1c2VyIHdobyBpcyBzZXQgdG8gY3JlYXRlIHRoZSBjb21tZW50LlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEuY3JlYXRlZEF0IChvcHRpb25hbCkgVGhlIGRhdGUgdGhlIGNvbW1lbnQgaXMgc2V0IHRvIGJlIGNyZWF0ZWQuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS5ib2R5IFRoZSBib2R5IG9mIHRoZSBjb21tZW50LlxuICAgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCBjb21tZW50LlxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQ29tbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgdGhyZWFkSWQsIGRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L2NvbW1lbnRzYCxcbiAgICAgIHtcbiAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgY3JlYXRlZEF0OiBkYXRhLmNyZWF0ZWRBdD8udG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnREYXRhKGF3YWl0IHJlcy5qc29uKCkpO1xuICB9XG4gIC8qKlxuICAgKiBFZGl0cyBhIGNvbW1lbnQuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGVkaXQgdGhlIGNvbW1lbnQgaW4uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byBlZGl0IHRoZSBjb21tZW50IGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLmNvbW1lbnRJZCBUaGUgY29tbWVudCBJRCB0byBlZGl0LlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEuYm9keSBUaGUgYm9keSBvZiB0aGUgY29tbWVudC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLmVkaXRlZEF0IChvcHRpb25hbCkgVGhlIGRhdGUgdGhlIGNvbW1lbnQgd2FzIGVkaXRlZC5cbiAgICogQHJldHVybnMgVGhlIGVkaXRlZCBjb21tZW50LlxuICAgKi9cbiAgYXN5bmMgZWRpdENvbW1lbnQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkLCBjb21tZW50SWQsIGRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L2NvbW1lbnRzLyR7Y29tbWVudElkfWAsXG4gICAgICB7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIGVkaXRlZEF0OiBkYXRhLmVkaXRlZEF0Py50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gY29udmVydFRvQ29tbWVudERhdGEoYXdhaXQgcmVzLmpzb24oKSk7XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYSBjb21tZW50LiBEZWxldGVzIGEgY29tbWVudC4gSWYgdGhlcmUgYXJlIG5vIHJlbWFpbmluZyBjb21tZW50cyBpbiB0aGUgdGhyZWFkLCB0aGUgdGhyZWFkIGlzIGFsc28gZGVsZXRlZC5cbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gZGVsZXRlIHRoZSBjb21tZW50IGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gZGVsZXRlIHRoZSBjb21tZW50IGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLmNvbW1lbnRJZCBUaGUgY29tbWVudCBJRCB0byBkZWxldGUuXG4gICAqL1xuICBhc3luYyBkZWxldGVDb21tZW50KHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCwgY29tbWVudElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L2NvbW1lbnRzLyR7Y29tbWVudElkfWBcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHRocmVhZC4gVGhlIHRocmVhZCB3aWxsIGJlIGNyZWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIGNvbW1lbnQgYXMgaXRzIGZpcnN0IGNvbW1lbnQuXG4gICAqIElmIHRoZSB0aHJlYWQgYWxyZWFkeSBleGlzdHMsIGEgYExpdmVibG9ja3NFcnJvcmAgd2lsbCBiZSB0aHJvd24gd2l0aCBzdGF0dXMgY29kZSA0MDkuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGNyZWF0ZSB0aGUgdGhyZWFkIGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZC5tZXRhZGF0YSAob3B0aW9uYWwpIFRoZSBtZXRhZGF0YSBmb3IgdGhlIHRocmVhZC4gU3VwcG9ydHMgdXB0byBhIG1heGltdW0gb2YgMTAgZW50cmllcy4gVmFsdWUgbXVzdCBiZSBhIHN0cmluZywgYm9vbGVhbiBvciBudW1iZXJcbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWQuY29tbWVudC51c2VySWQgVGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgd2hvIGNyZWF0ZWQgdGhlIGNvbW1lbnQuXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkLmNvbW1lbnQuY3JlYXRlZEF0IChvcHRpb25hbCkgVGhlIGRhdGUgdGhlIGNvbW1lbnQgd2FzIGNyZWF0ZWQuXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkLmNvbW1lbnQuYm9keSBUaGUgYm9keSBvZiB0aGUgY29tbWVudC5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgdGhyZWFkLiBUaGUgdGhyZWFkIHdpbGwgYmUgY3JlYXRlZCB3aXRoIHRoZSBzcGVjaWZpZWQgY29tbWVudCBhcyBpdHMgZmlyc3QgY29tbWVudC5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVRocmVhZChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgZGF0YSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdCh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzYCwge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIGNvbW1lbnQ6IHtcbiAgICAgICAgLi4uZGF0YS5jb21tZW50LFxuICAgICAgICBjcmVhdGVkQXQ6IGRhdGEuY29tbWVudC5jcmVhdGVkQXQ/LnRvSVNPU3RyaW5nKClcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gY29udmVydFRvVGhyZWFkRGF0YShhd2FpdCByZXMuanNvbigpKTtcbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhIHRocmVhZCBhbmQgYWxsIG9mIGl0cyBjb21tZW50cy5cbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gZGVsZXRlIHRoZSB0aHJlYWQgaW4uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byBkZWxldGUuXG4gICAqL1xuICBhc3luYyBkZWxldGVUaHJlYWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBNYXJrIGEgdGhyZWFkIGFzIHJlc29sdmVkLlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCBvZiB0aGUgdGhyZWFkLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gbWFyayBhcyByZXNvbHZlZC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLnVzZXJJZCBUaGUgdXNlciBJRCBvZiB0aGUgdXNlciB3aG8gbWFya2VkIHRoZSB0aHJlYWQgYXMgcmVzb2x2ZWQuXG4gICAqIEByZXR1cm5zIFRoZSB0aHJlYWQgbWFya2VkIGFzIHJlc29sdmVkLlxuICAgKi9cbiAgYXN5bmMgbWFya1RocmVhZEFzUmVzb2x2ZWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9tYXJrLWFzLXJlc29sdmVkYCxcbiAgICAgIHt9XG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gY29udmVydFRvVGhyZWFkRGF0YShhd2FpdCByZXMuanNvbigpKTtcbiAgfVxuICAvKipcbiAgICogTWFyayBhIHRocmVhZCBhcyB1bnJlc29sdmVkLlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCBvZiB0aGUgdGhyZWFkLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gbWFyayBhcyB1bnJlc29sdmVkLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEudXNlcklkIFRoZSB1c2VyIElEIG9mIHRoZSB1c2VyIHdobyBtYXJrZWQgdGhlIHRocmVhZCBhcyB1bnJlc29sdmVkLlxuICAgKiBAcmV0dXJucyBUaGUgdGhyZWFkIG1hcmtlZCBhcyB1bnJlc29sdmVkLlxuICAgKi9cbiAgYXN5bmMgbWFya1RocmVhZEFzVW5yZXNvbHZlZChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgdGhyZWFkSWQgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L21hcmstYXMtdW5yZXNvbHZlZGAsXG4gICAgICB7fVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb1RocmVhZERhdGEoYXdhaXQgcmVzLmpzb24oKSk7XG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIG1ldGFkYXRhIG9mIHRoZSBzcGVjaWZpZWQgdGhyZWFkIGluIGEgcm9vbS5cbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gdXBkYXRlIHRoZSB0aHJlYWQgaW4uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS5tZXRhZGF0YSBUaGUgbWV0YWRhdGEgZm9yIHRoZSB0aHJlYWQuIFZhbHVlIG11c3QgYmUgYSBzdHJpbmcsIGJvb2xlYW4gb3IgbnVtYmVyXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS51c2VySWQgVGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgd2hvIHVwZGF0ZWQgdGhlIHRocmVhZC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLnVwZGF0ZWRBdCAob3B0aW9uYWwpIFRoZSBkYXRlIHRoZSB0aHJlYWQgaXMgc2V0IHRvIGJlIHVwZGF0ZWQuXG4gICAqIEByZXR1cm5zIFRoZSB1cGRhdGVkIHRocmVhZCBtZXRhZGF0YS5cbiAgICovXG4gIGFzeW5jIGVkaXRUaHJlYWRNZXRhZGF0YShwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgdGhyZWFkSWQsIGRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L21ldGFkYXRhYCxcbiAgICAgIHtcbiAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBkYXRhLnVwZGF0ZWRBdD8udG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHJlcy5qc29uKCk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZHMgYSBuZXcgY29tbWVudCByZWFjdGlvbiB0byBhIGNvbW1lbnQuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGFkZCB0aGUgY29tbWVudCByZWFjdGlvbiBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWRJZCBUaGUgdGhyZWFkIElEIHRvIGFkZCB0aGUgY29tbWVudCByZWFjdGlvbiBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy5jb21tZW50SWQgVGhlIGNvbW1lbnQgSUQgdG8gYWRkIHRoZSByZWFjdGlvbiBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLmVtb2ppIFRoZSAoZW1vamkpIHJlYWN0aW9uIHRvIGFkZC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLnVzZXJJZCBUaGUgdXNlciBJRCBvZiB0aGUgdXNlciBhc3NvY2lhdGVkIHdpdGggdGhlIHJlYWN0aW9uLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEuY3JlYXRlZEF0IChvcHRpb25hbCkgVGhlIGRhdGUgdGhlIHJlYWN0aW9uIGlzIHNldCB0byBiZSBjcmVhdGVkLlxuICAgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCBjb21tZW50IHJlYWN0aW9uLlxuICAgKi9cbiAgYXN5bmMgYWRkQ29tbWVudFJlYWN0aW9uKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCwgY29tbWVudElkLCBkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9jb21tZW50cy8ke2NvbW1lbnRJZH0vYWRkLXJlYWN0aW9uYCxcbiAgICAgIHtcbiAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgY3JlYXRlZEF0OiBkYXRhLmNyZWF0ZWRBdD8udG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgcmVhY3Rpb24gPSBhd2FpdCByZXMuanNvbigpO1xuICAgIHJldHVybiBjb252ZXJ0VG9Db21tZW50VXNlclJlYWN0aW9uKHJlYWN0aW9uKTtcbiAgfVxuICAvKipcbiAgICogUmVtb3ZlcyBhIHJlYWN0aW9uIGZyb20gYSBjb21tZW50LlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byByZW1vdmUgdGhlIGNvbW1lbnQgcmVhY3Rpb24gZnJvbS5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWRJZCBUaGUgdGhyZWFkIElEIHRvIHJlbW92ZSB0aGUgY29tbWVudCByZWFjdGlvbiBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLmNvbW1lbnRJZCBUaGUgY29tbWVudCBJRCB0byByZW1vdmUgdGhlIHJlYWN0aW9uIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS5lbW9qaSBUaGUgKGVtb2ppKSByZWFjdGlvbiB0byByZW1vdmUuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS51c2VySWQgVGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSByZWFjdGlvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLnJlbW92ZWRBdCAob3B0aW9uYWwpIFRoZSBkYXRlIHRoZSByZWFjdGlvbiBpcyBzZXQgdG8gYmUgcmVtb3ZlZC5cbiAgICovXG4gIGFzeW5jIHJlbW92ZUNvbW1lbnRSZWFjdGlvbihwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgdGhyZWFkSWQsIGRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L2NvbW1lbnRzLyR7cGFyYW1zLmNvbW1lbnRJZH0vcmVtb3ZlLXJlYWN0aW9uYCxcbiAgICAgIHtcbiAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgcmVtb3ZlZEF0OiBkYXRhLnJlbW92ZWRBdD8udG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGluYm94IG5vdGlmaWNhdGlvbnMgZm9yIGEgdXNlci5cbiAgICogQHBhcmFtIHBhcmFtcy51c2VySWQgVGhlIHVzZXIgSUQgdG8gZ2V0IHRoZSBpbmJveCBub3RpZmljYXRpb25zIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMuaW5ib3hOb3RpZmljYXRpb25JZCBUaGUgSUQgb2YgdGhlIGluYm94IG5vdGlmaWNhdGlvbiB0byBnZXQuXG4gICAqL1xuICBhc3luYyBnZXRJbmJveE5vdGlmaWNhdGlvbihwYXJhbXMpIHtcbiAgICBjb25zdCB7IHVzZXJJZCwgaW5ib3hOb3RpZmljYXRpb25JZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KFxuICAgICAgdXJsYC92Mi91c2Vycy8ke3VzZXJJZH0vaW5ib3gtbm90aWZpY2F0aW9ucy8ke2luYm94Tm90aWZpY2F0aW9uSWR9YFxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb0luYm94Tm90aWZpY2F0aW9uRGF0YShcbiAgICAgIGF3YWl0IHJlcy5qc29uKClcbiAgICApO1xuICB9XG4gIC8qKlxuICAgKiBHZXRzIHRoZSB1c2VyJ3Mgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcklkIFRoZSB1c2VyIElEIHRvIGdldCB0aGUgcm9vbSBub3RpZmljYXRpb25zIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGdldCB0aGUgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MgZnJvbS5cbiAgICovXG4gIGFzeW5jIGdldFJvb21Ob3RpZmljYXRpb25TZXR0aW5ncyhwYXJhbXMpIHtcbiAgICBjb25zdCB7IHVzZXJJZCwgcm9vbUlkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS91c2Vycy8ke3VzZXJJZH0vbm90aWZpY2F0aW9uLXNldHRpbmdzYFxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHJlcy5qc29uKCk7XG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIHVzZXIncyByb29tIG5vdGlmaWNhdGlvbiBzZXR0aW5ncy5cbiAgICogQHBhcmFtIHBhcmFtcy51c2VySWQgVGhlIHVzZXIgSUQgdG8gdXBkYXRlIHRoZSByb29tIG5vdGlmaWNhdGlvbiBzZXR0aW5ncyBmb3IuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIHVwZGF0ZSB0aGUgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MgZm9yLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEgVGhlIG5ldyByb29tIG5vdGlmaWNhdGlvbiBzZXR0aW5ncyBmb3IgdGhlIHVzZXIuXG4gICAqL1xuICBhc3luYyB1cGRhdGVSb29tTm90aWZpY2F0aW9uU2V0dGluZ3MocGFyYW1zKSB7XG4gICAgY29uc3QgeyB1c2VySWQsIHJvb21JZCwgZGF0YSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdChcbiAgICAgIHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3VzZXJzLyR7dXNlcklkfS9ub3RpZmljYXRpb24tc2V0dGluZ3NgLFxuICAgICAgZGF0YVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHJlcy5qc29uKCk7XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZSB0aGUgdXNlcidzIHJvb20gbm90aWZpY2F0aW9uIHNldHRpbmdzLlxuICAgKiBAcGFyYW0gcGFyYW1zLnVzZXJJZCBUaGUgdXNlciBJRCB0byBkZWxldGUgdGhlIHJvb20gbm90aWZpY2F0aW9uIHNldHRpbmdzIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGRlbGV0ZSB0aGUgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MgZnJvbS5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVJvb21Ob3RpZmljYXRpb25TZXR0aW5ncyhwYXJhbXMpIHtcbiAgICBjb25zdCB7IHVzZXJJZCwgcm9vbUlkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS91c2Vycy8ke3VzZXJJZH0vbm90aWZpY2F0aW9uLXNldHRpbmdzYFxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZSBhIHJvb20gSUQuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSBjdXJyZW50IElEIG9mIHRoZSByb29tLlxuICAgKiBAcGFyYW0gcGFyYW1zLm5ld1Jvb21JZCBUaGUgbmV3IHJvb20gSUQuXG4gICAqL1xuICBhc3luYyB1cGRhdGVSb29tSWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyBjdXJyZW50Um9vbUlkLCBuZXdSb29tSWQgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7Y3VycmVudFJvb21JZH0vdXBkYXRlLXJvb20taWRgLFxuICAgICAge1xuICAgICAgICBuZXdSb29tSWRcbiAgICAgIH1cbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdCksXG4gICAgICBsYXN0Q29ubmVjdGlvbkF0OiBkYXRhLmxhc3RDb25uZWN0aW9uQXQgPyBuZXcgRGF0ZShkYXRhLmxhc3RDb25uZWN0aW9uQXQpIDogdm9pZCAwXG4gICAgfTtcbiAgfVxuICBhc3luYyB0cmlnZ2VySW5ib3hOb3RpZmljYXRpb24ocGFyYW1zKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KHVybGAvdjIvaW5ib3gtbm90aWZpY2F0aW9ucy90cmlnZ2VyYCwgcGFyYW1zKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhbiBpbmJveCBub3RpZmljYXRpb24gZm9yIGEgdXNlci5cbiAgICogQHBhcmFtIHBhcmFtcy51c2VySWQgVGhlIHVzZXIgSUQgZm9yIHdoaWNoIHRvIGRlbGV0ZSB0aGUgaW5ib3ggbm90aWZpY2F0aW9uLlxuICAgKiBAcGFyYW0gcGFyYW1zLmluYm94Tm90aWZpY2F0aW9uSWQgVGhlIElEIG9mIHRoZSBpbmJveCBub3RpZmljYXRpb24gdG8gZGVsZXRlLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlSW5ib3hOb3RpZmljYXRpb24ocGFyYW1zKSB7XG4gICAgY29uc3QgeyB1c2VySWQsIGluYm94Tm90aWZpY2F0aW9uSWQgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmRlbGV0ZShcbiAgICAgIHVybGAvdjIvdXNlcnMvJHt1c2VySWR9L2luYm94LW5vdGlmaWNhdGlvbnMvJHtpbmJveE5vdGlmaWNhdGlvbklkfWBcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBEZWxldGVzIGFsbCBpbmJveCBub3RpZmljYXRpb25zIGZvciBhIHVzZXIuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcklkIFRoZSB1c2VyIElEIGZvciB3aGljaCB0byBkZWxldGUgYWxsIHRoZSBpbmJveCBub3RpZmljYXRpb25zLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQWxsSW5ib3hOb3RpZmljYXRpb25zKHBhcmFtcykge1xuICAgIGNvbnN0IHsgdXNlcklkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUodXJsYC92Mi91c2Vycy8ke3VzZXJJZH0vaW5ib3gtbm90aWZpY2F0aW9uc2ApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG59O1xudmFyIExpdmVibG9ja3NFcnJvciA9IGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihzdGF0dXMsIG1lc3NhZ2UgPSBcIlwiKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gXCJMaXZlYmxvY2tzRXJyb3JcIjtcbiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgfVxufTtcblxuLy8gc3JjL3dlYmhvb2tzLnRzXG5pbXBvcnQgKiBhcyBiYXNlNjQgZnJvbSBcIkBzdGFibGVsaWIvYmFzZTY0XCI7XG5pbXBvcnQgKiBhcyBzaGEyNTYgZnJvbSBcImZhc3Qtc2hhMjU2XCI7XG52YXIgX1dlYmhvb2tIYW5kbGVyID0gY2xhc3MgX1dlYmhvb2tIYW5kbGVyIHtcbiAgY29uc3RydWN0b3Ioc2VjcmV0KSB7XG4gICAgaWYgKCFzZWNyZXQpIHRocm93IG5ldyBFcnJvcihcIlNlY3JldCBpcyByZXF1aXJlZFwiKTtcbiAgICBpZiAodHlwZW9mIHNlY3JldCAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEVycm9yKFwiU2VjcmV0IG11c3QgYmUgYSBzdHJpbmdcIik7XG4gICAgaWYgKHNlY3JldC5zdGFydHNXaXRoKF9XZWJob29rSGFuZGxlci5zZWNyZXRQcmVmaXgpID09PSBmYWxzZSlcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc2VjcmV0LCBtdXN0IHN0YXJ0IHdpdGggd2hzZWNfXCIpO1xuICAgIGNvbnN0IHNlY3JldEtleSA9IHNlY3JldC5zbGljZShfV2ViaG9va0hhbmRsZXIuc2VjcmV0UHJlZml4Lmxlbmd0aCk7XG4gICAgdGhpcy5zZWNyZXRCdWZmZXIgPSBCdWZmZXIuZnJvbShzZWNyZXRLZXksIFwiYmFzZTY0XCIpO1xuICB9XG4gIC8qKlxuICAgKiBWZXJpZmllcyBhIHdlYmhvb2sgcmVxdWVzdCBhbmQgcmV0dXJucyB0aGUgZXZlbnRcbiAgICovXG4gIHZlcmlmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIGNvbnN0IHsgaGVhZGVycywgcmF3Qm9keSB9ID0gcmVxdWVzdDtcbiAgICBjb25zdCB7IHdlYmhvb2tJZCwgdGltZXN0YW1wLCByYXdTaWduYXR1cmVzIH0gPSB0aGlzLnZlcmlmeUhlYWRlcnMoaGVhZGVycyk7XG4gICAgaWYgKHR5cGVvZiByYXdCb2R5ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBJbnZhbGlkIHJhd0JvZHkgZmllbGQsIG11c3QgYmUgYSBzdHJpbmcsIGdvdCBcIiR7dHlwZW9mIHJhd0JvZHl9XCIgaW5zdGVhZC4gSXQgaXMgbGlrZWx5IHRoYXQgeW91IG5lZWQgdG8gSlNPTi5zdHJpbmdpZnkgdGhlIGJvZHkgYmVmb3JlIHBhc3NpbmcgaXQuYFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy52ZXJpZnlUaW1lc3RhbXAodGltZXN0YW1wKTtcbiAgICBjb25zdCBzaWduYXR1cmUgPSB0aGlzLnNpZ24oYCR7d2ViaG9va0lkfS4ke3RpbWVzdGFtcH0uJHtyYXdCb2R5fWApO1xuICAgIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlcyA9IHJhd1NpZ25hdHVyZXMuc3BsaXQoXCIgXCIpLm1hcCgocmF3U2lnbmF0dXJlKSA9PiB7XG4gICAgICBjb25zdCBbLCBwYXJzZWRTaWduYXR1cmVdID0gcmF3U2lnbmF0dXJlLnNwbGl0KFwiLFwiKTtcbiAgICAgIHJldHVybiBwYXJzZWRTaWduYXR1cmU7XG4gICAgfSkuZmlsdGVyKGlzTm90VW5kZWZpbmVkKTtcbiAgICBpZiAoZXhwZWN0ZWRTaWduYXR1cmVzLmluY2x1ZGVzKHNpZ25hdHVyZSkgPT09IGZhbHNlKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW52YWxpZCBzaWduYXR1cmUsIGV4cGVjdGVkIG9uZSBvZiAke2V4cGVjdGVkU2lnbmF0dXJlcy5qb2luKFxuICAgICAgICAgIFwiLCBcIlxuICAgICAgICApfSwgZ290ICR7c2lnbmF0dXJlfWBcbiAgICAgICk7XG4gICAgY29uc3QgZXZlbnQgPSBKU09OLnBhcnNlKHJhd0JvZHkpO1xuICAgIHRoaXMudmVyaWZ5V2ViaG9va0V2ZW50VHlwZShldmVudCk7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG4gIC8qKlxuICAgKiBWZXJpZmllcyB0aGUgaGVhZGVycyBhbmQgcmV0dXJucyB0aGUgd2ViaG9va0lkLCB0aW1lc3RhbXAgYW5kIHJhd1NpZ25hdHVyZXNcbiAgICovXG4gIHZlcmlmeUhlYWRlcnMoaGVhZGVycykge1xuICAgIGNvbnN0IHVzaW5nTmF0aXZlSGVhZGVycyA9IHR5cGVvZiBIZWFkZXJzICE9PSBcInVuZGVmaW5lZFwiICYmIGhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRIZWFkZXJzID0gdXNpbmdOYXRpdmVIZWFkZXJzID8gT2JqZWN0LmZyb21FbnRyaWVzKGhlYWRlcnMpIDogaGVhZGVycztcbiAgICBjb25zdCBzYW5pdGl6ZWRIZWFkZXJzID0ge307XG4gICAgT2JqZWN0LmtleXMobm9ybWFsaXplZEhlYWRlcnMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgc2FuaXRpemVkSGVhZGVyc1trZXkudG9Mb3dlckNhc2UoKV0gPSBub3JtYWxpemVkSGVhZGVyc1trZXldO1xuICAgIH0pO1xuICAgIGNvbnN0IHdlYmhvb2tJZCA9IHNhbml0aXplZEhlYWRlcnNbXCJ3ZWJob29rLWlkXCJdO1xuICAgIGlmICh0eXBlb2Ygd2ViaG9va0lkICE9PSBcInN0cmluZ1wiKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB3ZWJob29rLWlkIGhlYWRlclwiKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzYW5pdGl6ZWRIZWFkZXJzW1wid2ViaG9vay10aW1lc3RhbXBcIl07XG4gICAgaWYgKHR5cGVvZiB0aW1lc3RhbXAgIT09IFwic3RyaW5nXCIpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHdlYmhvb2stdGltZXN0YW1wIGhlYWRlclwiKTtcbiAgICBjb25zdCByYXdTaWduYXR1cmVzID0gc2FuaXRpemVkSGVhZGVyc1tcIndlYmhvb2stc2lnbmF0dXJlXCJdO1xuICAgIGlmICh0eXBlb2YgcmF3U2lnbmF0dXJlcyAhPT0gXCJzdHJpbmdcIilcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgd2ViaG9vay1zaWduYXR1cmUgaGVhZGVyXCIpO1xuICAgIHJldHVybiB7IHdlYmhvb2tJZCwgdGltZXN0YW1wLCByYXdTaWduYXR1cmVzIH07XG4gIH1cbiAgLyoqXG4gICAqIFNpZ25zIHRoZSBjb250ZW50IHdpdGggdGhlIHNlY3JldFxuICAgKiBAcGFyYW0gY29udGVudFxuICAgKiBAcmV0dXJucyBgc3RyaW5nYFxuICAgKi9cbiAgc2lnbihjb250ZW50KSB7XG4gICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpO1xuICAgIGNvbnN0IHRvU2lnbiA9IGVuY29kZXIuZW5jb2RlKGNvbnRlbnQpO1xuICAgIHJldHVybiBiYXNlNjQuZW5jb2RlKHNoYTI1Ni5obWFjKHRoaXMuc2VjcmV0QnVmZmVyLCB0b1NpZ24pKTtcbiAgfVxuICAvKipcbiAgICogVmVyaWZpZXMgdGhhdCB0aGUgdGltZXN0YW1wIGlzIG5vdCB0b28gb2xkIG9yIGluIHRoZSBmdXR1cmVcbiAgICovXG4gIHZlcmlmeVRpbWVzdGFtcCh0aW1lc3RhbXBIZWFkZXIpIHtcbiAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxZTMpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IHBhcnNlSW50KHRpbWVzdGFtcEhlYWRlciwgMTApO1xuICAgIGlmIChpc05hTih0aW1lc3RhbXApKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHRpbWVzdGFtcFwiKTtcbiAgICB9XG4gICAgaWYgKHRpbWVzdGFtcCA8IG5vdyAtIFdFQkhPT0tfVE9MRVJBTkNFX0lOX1NFQ09ORFMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRpbWVzdGFtcCB0b28gb2xkXCIpO1xuICAgIH1cbiAgICBpZiAodGltZXN0YW1wID4gbm93ICsgV0VCSE9PS19UT0xFUkFOQ0VfSU5fU0VDT05EUykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGltZXN0YW1wIGluIHRoZSBmdXR1cmVcIik7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBFbnN1cmVzIHRoYXQgdGhlIGV2ZW50IGlzIGEga25vd24gZXZlbnQgdHlwZVxuICAgKiBvciB0aHJvd3MgYW5kIHByb21wdHMgdGhlIHVzZXIgdG8gdXBncmFkZSB0byBhIGhpZ2hlciB2ZXJzaW9uIG9mIEBsaXZlYmxvY2tzL25vZGVcbiAgICovXG4gIHZlcmlmeVdlYmhvb2tFdmVudFR5cGUoZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHlwZSAmJiBbXG4gICAgICBcInN0b3JhZ2VVcGRhdGVkXCIsXG4gICAgICBcInVzZXJFbnRlcmVkXCIsXG4gICAgICBcInVzZXJMZWZ0XCIsXG4gICAgICBcInJvb21DcmVhdGVkXCIsXG4gICAgICBcInJvb21EZWxldGVkXCIsXG4gICAgICBcImNvbW1lbnRDcmVhdGVkXCIsXG4gICAgICBcImNvbW1lbnRFZGl0ZWRcIixcbiAgICAgIFwiY29tbWVudERlbGV0ZWRcIixcbiAgICAgIFwiY29tbWVudFJlYWN0aW9uQWRkZWRcIixcbiAgICAgIFwiY29tbWVudFJlYWN0aW9uUmVtb3ZlZFwiLFxuICAgICAgXCJ0aHJlYWRNZXRhZGF0YVVwZGF0ZWRcIixcbiAgICAgIFwidGhyZWFkQ3JlYXRlZFwiLFxuICAgICAgXCJ0aHJlYWREZWxldGVkXCIsXG4gICAgICBcInlkb2NVcGRhdGVkXCIsXG4gICAgICBcIm5vdGlmaWNhdGlvblwiLFxuICAgICAgXCJ0aHJlYWRNYXJrZWRBc1Jlc29sdmVkXCIsXG4gICAgICBcInRocmVhZE1hcmtlZEFzVW5yZXNvbHZlZFwiXG4gICAgXS5pbmNsdWRlcyhldmVudC50eXBlKSkge1xuICAgICAgaWYgKGV2ZW50LnR5cGUgPT09IFwibm90aWZpY2F0aW9uXCIpIHtcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gZXZlbnQ7XG4gICAgICAgIGlmIChub3RpZmljYXRpb24uZGF0YS5raW5kID09PSBcInRocmVhZFwiIHx8IG5vdGlmaWNhdGlvbi5kYXRhLmtpbmQgPT09IFwidGV4dE1lbnRpb25cIiB8fCBub3RpZmljYXRpb24uZGF0YS5raW5kLnN0YXJ0c1dpdGgoXCIkXCIpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBVbmtub3duIG5vdGlmaWNhdGlvbiBraW5kOiAke25vdGlmaWNhdGlvbi5kYXRhLmtpbmR9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJVbmtub3duIGV2ZW50IHR5cGUsIHBsZWFzZSB1cGdyYWRlIHRvIGEgaGlnaGVyIHZlcnNpb24gb2YgQGxpdmVibG9ja3Mvbm9kZVwiXG4gICAgKTtcbiAgfVxufTtcbl9XZWJob29rSGFuZGxlci5zZWNyZXRQcmVmaXggPSBcIndoc2VjX1wiO1xudmFyIFdlYmhvb2tIYW5kbGVyID0gX1dlYmhvb2tIYW5kbGVyO1xudmFyIFdFQkhPT0tfVE9MRVJBTkNFX0lOX1NFQ09ORFMgPSA1ICogNjA7XG52YXIgaXNOb3RVbmRlZmluZWQgPSAodmFsdWUpID0+IHZhbHVlICE9PSB2b2lkIDA7XG5cbi8vIHNyYy9pbmRleC50c1xuaW1wb3J0IHtcbiAgZ2V0TWVudGlvbmVkSWRzRnJvbUNvbW1lbnRCb2R5LFxuICBzdHJpbmdpZnlDb21tZW50Qm9keVxufSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuZGV0ZWN0RHVwZXMoUEtHX05BTUUsIFBLR19WRVJTSU9OLCBQS0dfRk9STUFUKTtcbmV4cG9ydCB7XG4gIExpdmVibG9ja3MsXG4gIExpdmVibG9ja3NFcnJvcixcbiAgV2ViaG9va0hhbmRsZXIsXG4gIGdldE1lbnRpb25lZElkc0Zyb21Db21tZW50Qm9keSxcbiAgc3RyaW5naWZ5Q29tbWVudEJvZHlcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./node_modules/@liveblocks/node/dist/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@liveblocks/node/dist/index.mjs":
/*!******************************************************!*\
  !*** ./node_modules/@liveblocks/node/dist/index.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Liveblocks: () => (/* binding */ Liveblocks),\n/* harmony export */   LiveblocksError: () => (/* binding */ LiveblocksError),\n/* harmony export */   WebhookHandler: () => (/* binding */ WebhookHandler),\n/* harmony export */   getMentionedIdsFromCommentBody: () => (/* reexport safe */ _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.getMentionedIdsFromCommentBody),\n/* harmony export */   stringifyCommentBody: () => (/* reexport safe */ _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.stringifyCommentBody)\n/* harmony export */ });\n/* harmony import */ var _liveblocks_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @liveblocks/core */ \"(rsc)/./node_modules/@liveblocks/core/dist/index.mjs\");\n/* harmony import */ var _stablelib_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @stablelib/base64 */ \"(rsc)/./node_modules/@stablelib/base64/lib/base64.js\");\n/* harmony import */ var fast_sha256__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fast-sha256 */ \"(rsc)/./node_modules/fast-sha256/sha256.js\");\n// src/index.ts\n\n\n// src/version.ts\nvar PKG_NAME = \"@liveblocks/node\";\nvar PKG_VERSION = \"2.4.0\";\nvar PKG_FORMAT = \"esm\";\n\n// src/client.ts\n\n\n// src/utils.ts\nvar DEFAULT_BASE_URL = \"https://api.liveblocks.io\";\nfunction getBaseUrl(baseUrl) {\n  if (typeof baseUrl === \"string\" && baseUrl.startsWith(\"http\")) {\n    return baseUrl;\n  } else {\n    return DEFAULT_BASE_URL;\n  }\n}\nasync function fetchPolyfill() {\n  return typeof globalThis.fetch !== \"undefined\" ? globalThis.fetch : (await Promise.all(/*! import() */[__webpack_require__.e(\"vendor-chunks/tr46\"), __webpack_require__.e(\"vendor-chunks/node-fetch\"), __webpack_require__.e(\"vendor-chunks/whatwg-url\"), __webpack_require__.e(\"vendor-chunks/webidl-conversions\")]).then(__webpack_require__.bind(__webpack_require__, /*! node-fetch */ \"(rsc)/./node_modules/node-fetch/lib/index.mjs\"))).default;\n}\nfunction isNonEmpty(value) {\n  return typeof value === \"string\" && value.length > 0;\n}\nfunction assertNonEmpty(value, field) {\n  if (!isNonEmpty(value)) {\n    throw new Error(\n      `Invalid value for field \"${field}\". Please provide a non-empty string. For more information: https://liveblocks.io/docs/api-reference/liveblocks-node#authorize`\n    );\n  }\n}\nfunction assertSecretKey(value, field) {\n  if (!isNonEmpty(value) || !value.startsWith(\"sk_\")) {\n    throw new Error(\n      `Invalid value for field \"${field}\". Secret keys must start with \"sk_\". Please provide the secret key from your Liveblocks dashboard at https://liveblocks.io/dashboard/apikeys.`\n    );\n  }\n}\nfunction normalizeStatusCode(statusCode) {\n  if (statusCode >= 200 && statusCode < 300) {\n    return 200;\n  } else if (statusCode >= 500) {\n    return 503;\n  } else {\n    return 403;\n  }\n}\nfunction toURLSearchParams(params) {\n  const result = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== void 0 && value !== null) {\n      result.set(key, value.toString());\n    }\n  }\n  return result;\n}\nfunction urljoin(baseUrl, path, params) {\n  const url2 = new URL(path, baseUrl);\n  if (params !== void 0) {\n    url2.search = (params instanceof URLSearchParams ? params : toURLSearchParams(params)).toString();\n  }\n  return url2.toString();\n}\nfunction url(strings, ...values) {\n  return strings.reduce(\n    (result, str, i) => result + encodeURIComponent(values[i - 1] ?? \"\") + str\n  );\n}\n\n// src/Session.ts\nvar ALL_PERMISSIONS = Object.freeze([\n  \"room:write\",\n  \"room:read\",\n  \"room:presence:write\",\n  \"comments:write\",\n  \"comments:read\"\n]);\nfunction isPermission(value) {\n  return ALL_PERMISSIONS.includes(value);\n}\nvar MAX_PERMS_PER_SET = 10;\nvar READ_ACCESS = Object.freeze([\n  \"room:read\",\n  \"room:presence:write\",\n  \"comments:read\"\n]);\nvar FULL_ACCESS = Object.freeze([\"room:write\", \"comments:write\"]);\nvar roomPatternRegex = /^([*]|[^*]{1,128}[*]?)$/;\nvar Session = class {\n  /** @internal */\n  constructor(postFn, userId, userInfo) {\n    this.FULL_ACCESS = FULL_ACCESS;\n    this.READ_ACCESS = READ_ACCESS;\n    /** @internal */\n    this._sealed = false;\n    /** @internal */\n    this._permissions = /* @__PURE__ */ new Map();\n    assertNonEmpty(userId, \"userId\");\n    this._postFn = postFn;\n    this._userId = userId;\n    this._userInfo = userInfo;\n  }\n  /** @internal */\n  getOrCreate(roomId) {\n    if (this._sealed) {\n      throw new Error(\"You can no longer change these permissions.\");\n    }\n    let perms = this._permissions.get(roomId);\n    if (perms) {\n      return perms;\n    } else {\n      if (this._permissions.size >= MAX_PERMS_PER_SET) {\n        throw new Error(\n          \"You cannot add permissions for more than 10 rooms in a single token\"\n        );\n      }\n      perms = /* @__PURE__ */ new Set();\n      this._permissions.set(roomId, perms);\n      return perms;\n    }\n  }\n  allow(roomIdOrPattern, newPerms) {\n    if (typeof roomIdOrPattern !== \"string\") {\n      throw new Error(\"Room name or pattern must be a string\");\n    }\n    if (!roomPatternRegex.test(roomIdOrPattern)) {\n      throw new Error(\"Invalid room name or pattern\");\n    }\n    if (newPerms.length === 0) {\n      throw new Error(\"Permission list cannot be empty\");\n    }\n    const existingPerms = this.getOrCreate(roomIdOrPattern);\n    for (const perm of newPerms) {\n      if (!isPermission(perm)) {\n        throw new Error(`Not a valid permission: ${perm}`);\n      }\n      existingPerms.add(perm);\n    }\n    return this;\n  }\n  /** @internal - For unit tests only */\n  hasPermissions() {\n    return this._permissions.size > 0;\n  }\n  /** @internal - For unit tests only */\n  seal() {\n    if (this._sealed) {\n      throw new Error(\n        \"You cannot reuse Session instances. Please create a new session every time.\"\n      );\n    }\n    this._sealed = true;\n  }\n  /** @internal - For unit tests only */\n  serializePermissions() {\n    return Object.fromEntries(\n      Array.from(this._permissions.entries()).map(([pat, perms]) => [\n        pat,\n        Array.from(perms)\n      ])\n    );\n  }\n  /**\n   * Call this to authorize the session to access Liveblocks. Note that this\n   * will return a Liveblocks \"access token\". Anyone that obtains such access\n   * token will have access to the allowed resources.\n   */\n  async authorize() {\n    this.seal();\n    if (!this.hasPermissions()) {\n      console.warn(\n        \"Access tokens without any permission will not be supported soon, you should use wildcards when the client requests a token for resources outside a room. See https://liveblocks.io/docs/errors/liveblocks-client/access-tokens-not-enough-permissions\"\n      );\n    }\n    try {\n      const resp = await this._postFn(url`/v2/authorize-user`, {\n        // Required\n        userId: this._userId,\n        permissions: this.serializePermissions(),\n        // Optional metadata\n        userInfo: this._userInfo\n      });\n      return {\n        status: normalizeStatusCode(resp.status),\n        body: await resp.text()\n      };\n    } catch (er) {\n      return {\n        status: 503,\n        body: 'Call to /v2/authorize-user failed. See \"error\" for more information.',\n        error: er\n      };\n    }\n  }\n};\n\n// src/client.ts\nvar Liveblocks = class {\n  /**\n   * Interact with the Liveblocks API from your Node.js backend.\n   */\n  constructor(options) {\n    const options_ = options;\n    const secret = options_.secret;\n    assertSecretKey(secret, \"secret\");\n    this._secret = secret;\n    this._baseUrl = new URL(getBaseUrl(options.baseUrl));\n  }\n  /** @internal */\n  async post(path, json) {\n    const url2 = urljoin(this._baseUrl, path);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`,\n      \"Content-Type\": \"application/json\"\n    };\n    const fetch = await fetchPolyfill();\n    const res = await fetch(url2, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(json)\n    });\n    return res;\n  }\n  /** @internal */\n  async put(path, json) {\n    const url2 = urljoin(this._baseUrl, path);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`,\n      \"Content-Type\": \"application/json\"\n    };\n    const fetch = await fetchPolyfill();\n    return await fetch(url2, {\n      method: \"PUT\",\n      headers,\n      body: JSON.stringify(json)\n    });\n  }\n  /** @internal */\n  async putBinary(path, body, params) {\n    const url2 = urljoin(this._baseUrl, path, params);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`,\n      \"Content-Type\": \"application/octet-stream\"\n    };\n    const fetch = await fetchPolyfill();\n    return await fetch(url2, { method: \"PUT\", headers, body });\n  }\n  /** @internal */\n  async delete(path) {\n    const url2 = urljoin(this._baseUrl, path);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`\n    };\n    const fetch = await fetchPolyfill();\n    const res = await fetch(url2, { method: \"DELETE\", headers });\n    return res;\n  }\n  /** @internal */\n  async get(path, params) {\n    const url2 = urljoin(this._baseUrl, path, params);\n    const headers = {\n      Authorization: `Bearer ${this._secret}`\n    };\n    const fetch = await fetchPolyfill();\n    const res = await fetch(url2, { method: \"GET\", headers });\n    return res;\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Authentication\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Prepares a new session to authorize a user to access Liveblocks.\n   *\n   * IMPORTANT:\n   * Always make sure that you trust the user making the request to your\n   * backend before calling .prepareSession()!\n   *\n   * @param userId Tell Liveblocks the user ID of the user to authorize. Must\n   * uniquely identify the user account in your system. The uniqueness of this\n   * value will determine how many MAUs will be counted/billed.\n   *\n   * @param options.userInfo Custom metadata to attach to this user. Data you\n   * add here will be visible to all other clients in the room, through the\n   * `other.info` property.\n   *\n   */\n  prepareSession(userId, ...rest) {\n    const options = rest[0];\n    return new Session(this.post.bind(this), userId, options?.userInfo);\n  }\n  /**\n   * Call this to authenticate the user as an actor you want to allow to use\n   * Liveblocks.\n   *\n   * You should use this method only if you want to manage your permissions\n   * through the Liveblocks Permissions API. This method is more complicated to\n   * set up, but allows for finer-grained specification of permissions.\n   *\n   * Calling `.identifyUser()` only lets you securely identify a user (and what\n   * groups they belong to). What permissions this user will end up having is\n   * determined by whatever permissions you assign the user/group in your\n   * Liveblocks account, through the Permissions API:\n   * https://liveblocks.io/docs/rooms/permissions\n   *\n   * IMPORTANT:\n   * Always verify that you trust the user making the request before calling\n   * .identifyUser()!\n   *\n   * @param identity Tell Liveblocks the user ID of the user to authenticate.\n   * Must uniquely identify the user account in your system. The uniqueness of\n   * this value will determine how many MAUs will be counted/billed.\n   *\n   * If you also want to assign which groups this user belongs to, use the\n   * object form and specify the `groupIds` property. Those `groupIds` should\n   * match the groupIds you assigned permissions to via the Liveblocks\n   * Permissions API, see\n   * https://liveblocks.io/docs/rooms/permissions#permissions-levels-groups-accesses-example\n   *\n   * @param options.userInfo Custom metadata to attach to this user. Data you\n   * add here will be visible to all other clients in the room, through the\n   * `other.info` property.\n   */\n  // These fields define the security identity of the user. Whatever you pass in here will define which\n  async identifyUser(identity, ...rest) {\n    const options = rest[0];\n    const path = url`/v2/identify-user`;\n    const userId = typeof identity === \"string\" ? identity : identity.userId;\n    const groupIds = typeof identity === \"string\" ? void 0 : identity.groupIds;\n    assertNonEmpty(userId, \"userId\");\n    try {\n      const resp = await this.post(path, {\n        userId,\n        groupIds,\n        // Optional metadata\n        userInfo: options?.userInfo\n      });\n      return {\n        status: normalizeStatusCode(resp.status),\n        body: await resp.text()\n      };\n    } catch (er) {\n      return {\n        status: 503,\n        body: `Call to ${urljoin(\n          this._baseUrl,\n          path\n        )} failed. See \"error\" for more information.`,\n        error: er\n      };\n    }\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Room\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Returns a list of your rooms. The rooms are returned sorted by creation date, from newest to oldest. You can filter rooms by metadata, users accesses and groups accesses.\n   * @param params.limit (optional) A limit on the number of rooms to be returned. The limit can range between 1 and 100, and defaults to 20.\n   * @param params.startingAfter (optional) A cursor used for pagination. You get the value from the response of the previous page.\n   * @param params.userId (optional) A filter on users accesses.\n   * @param params.metadata (optional) A filter on metadata. Multiple metadata keys can be used to filter rooms.\n   * @param params.groupIds (optional) A filter on groups accesses. Multiple groups can be used.\n   * @param params.query (optional) A query to filter rooms by. It is based on our query language. You can filter by metadata and room ID.\n   * @returns A list of rooms.\n   */\n  async getRooms(params = {}) {\n    const path = url`/v2/rooms`;\n    let query;\n    if (typeof params.query === \"string\") {\n      query = params.query;\n    } else if (typeof params.query === \"object\") {\n      query = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.objectToQuery)(params.query);\n    }\n    const queryParams = {\n      limit: params.limit,\n      startingAfter: params.startingAfter,\n      userId: params.userId,\n      groupIds: params.groupIds ? params.groupIds.join(\",\") : void 0,\n      // \"Flatten\" {metadata: {foo: \"bar\"}} to {\"metadata.foo\": \"bar\"}\n      ...Object.fromEntries(\n        Object.entries(params.metadata ?? {}).map(([key, val]) => [\n          `metadata.${key}`,\n          val\n        ])\n      ),\n      query\n    };\n    const res = await this.get(path, queryParams);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const rooms = data.data.map((room) => {\n      const lastConnectionAt = room.lastConnectionAt ? new Date(room.lastConnectionAt) : void 0;\n      const createdAt = new Date(room.createdAt);\n      return {\n        ...room,\n        createdAt,\n        lastConnectionAt\n      };\n    });\n    return {\n      ...data,\n      data: rooms\n    };\n  }\n  /**\n   * Creates a new room with the given id.\n   * @param roomId The id of the room to create.\n   * @param params.defaultAccesses The default accesses for the room.\n   * @param params.groupsAccesses (optional) The group accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.usersAccesses (optional) The user accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.metadata (optional) The metadata for the room. Supports upto a maximum of 50 entries. Key length has a limit of 40 characters. Value length has a limit of 256 characters.\n   * @returns The created room.\n   */\n  async createRoom(roomId, params) {\n    const { defaultAccesses, groupsAccesses, usersAccesses, metadata } = params;\n    const res = await this.post(url`/v2/rooms`, {\n      id: roomId,\n      defaultAccesses,\n      groupsAccesses,\n      usersAccesses,\n      metadata\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const lastConnectionAt = data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0;\n    const createdAt = new Date(data.createdAt);\n    return {\n      ...data,\n      lastConnectionAt,\n      createdAt\n    };\n  }\n  /**\n   * Returns a room with the given id.\n   * @param roomId The id of the room to return.\n   * @returns The room with the given id.\n   */\n  async getRoom(roomId) {\n    const res = await this.get(url`/v2/rooms/${roomId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const lastConnectionAt = data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0;\n    const createdAt = new Date(data.createdAt);\n    return {\n      ...data,\n      createdAt,\n      lastConnectionAt\n    };\n  }\n  /**\n   * Updates specific properties of a room. Its not necessary to provide the entire rooms information.\n   * Setting a property to `null` means to delete this property.\n   * @param roomId The id of the room to update.\n   * @param params.defaultAccesses (optional) The default accesses for the room.\n   * @param params.groupsAccesses (optional) The group accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.usersAccesses (optional) The user accesses for the room. Can contain a maximum of 100 entries. Key length has a limit of 40 characters.\n   * @param params.metadata (optional) The metadata for the room. Supports upto a maximum of 50 entries. Key length has a limit of 40 characters. Value length has a limit of 256 characters.\n   * @returns The updated room.\n   */\n  async updateRoom(roomId, params) {\n    const { defaultAccesses, groupsAccesses, usersAccesses, metadata } = params;\n    const res = await this.post(url`/v2/rooms/${roomId}`, {\n      defaultAccesses,\n      groupsAccesses,\n      usersAccesses,\n      metadata\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const lastConnectionAt = data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0;\n    const createdAt = new Date(data.createdAt);\n    return {\n      ...data,\n      lastConnectionAt,\n      createdAt\n    };\n  }\n  /**\n   * Deletes a room with the given id. A deleted room is no longer accessible from the API or the dashboard and it cannot be restored.\n   * @param roomId The id of the room to delete.\n   */\n  async deleteRoom(roomId) {\n    const res = await this.delete(url`/v2/rooms/${roomId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns a list of users currently present in the requested room. For better performance, we recommand to call this endpoint every 10 seconds maximum. Duplicates can happen if a user is in the requested room with multiple browser tabs opened.\n   * @param roomId The id of the room to get the users from.\n   * @returns A list of users currently present in the requested room.\n   */\n  async getActiveUsers(roomId) {\n    const res = await this.get(url`/v2/rooms/${roomId}/active_users`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Boadcasts an event to a room without having to connect to it via the client from @liveblocks/client. The connectionId passed to event listeners is -1 when using this API.\n   * @param roomId The id of the room to broadcast the event to.\n   * @param message The message to broadcast. It can be any JSON serializable value.\n   */\n  async broadcastEvent(roomId, message) {\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/broadcast_event`,\n      message\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  async getStorageDocument(roomId, format = \"plain-lson\") {\n    const res = await this.get(url`/v2/rooms/${roomId}/storage`, { format });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Initializes a rooms Storage. The room must already exist and have an empty Storage.\n   * Calling this endpoint will disconnect all users from the room if there are any.\n   *\n   * @param roomId The id of the room to initialize the storage from.\n   * @param document The document to initialize the storage with.\n   * @returns The initialized storage document. It is of the same format as the one passed in.\n   */\n  async initializeStorageDocument(roomId, document) {\n    const res = await this.post(url`/v2/rooms/${roomId}/storage`, document);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Deletes all of the rooms Storage data and disconnect all users from the room if there are any. Note that this does not delete the Yjs document in the room if one exists.\n   * @param roomId The id of the room to delete the storage from.\n   */\n  async deleteStorageDocument(roomId) {\n    const res = await this.delete(url`/v2/rooms/${roomId}/storage`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Yjs\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Returns a JSON representation of the rooms Yjs document.\n   * @param roomId The id of the room to get the Yjs document from.\n   * @param params.format (optional) If true, YText will return formatting.\n   * @param params.key (optional) If provided, returns only a single keys value, e.g. doc.get(key).toJSON().\n   * @param params.type (optional) Used with key to override the inferred type, i.e. \"ymap\" will return doc.get(key, Y.Map).\n   * @returns A JSON representation of the rooms Yjs document.\n   */\n  async getYjsDocument(roomId, params = {}) {\n    const { format, key, type } = params;\n    const path = url`v2/rooms/${roomId}/ydoc`;\n    const res = await this.get(path, {\n      formatting: format ? \"true\" : void 0,\n      key,\n      type\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Send a Yjs binary update to the rooms Yjs document. You can use this endpoint to initialize Yjs data for the room or to update the rooms Yjs document.\n   * @param roomId The id of the room to send the Yjs binary update to.\n   * @param update The Yjs update to send. Typically the result of calling `Yjs.encodeStateAsUpdate(doc)`. Read the [Yjs documentation](https://docs.yjs.dev/api/document-updates) to learn how to create a binary update.\n   * @param params.guid (optional) If provided, the binary update will be applied to the Yjs subdocument with the given guid. If not provided, the binary update will be applied to the root Yjs document.\n   */\n  async sendYjsBinaryUpdate(roomId, update, params = {}) {\n    const res = await this.putBinary(url`/v2/rooms/${roomId}/ydoc`, update, {\n      guid: params.guid\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns the rooms Yjs document encoded as a single binary update. This can be used by Y.applyUpdate(responseBody) to get a copy of the document in your backend.\n   * See [Yjs documentation](https://docs.yjs.dev/api/document-updates) for more information on working with updates.\n   * @param roomId The id of the room to get the Yjs document from.\n   * @param params.guid (optional) If provided, returns the binary update of the Yjs subdocument with the given guid. If not provided, returns the binary update of the root Yjs document.\n   * @returns The rooms Yjs document encoded as a single binary update.\n   */\n  async getYjsDocumentAsBinaryUpdate(roomId, params = {}) {\n    const res = await this.get(url`/v2/rooms/${roomId}/ydoc-binary`, {\n      guid: params.guid\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return res.arrayBuffer();\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Schema Validation\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Creates a new schema which can be referenced later to enforce a rooms Storage data structure.\n   * @param name The name used to reference the schema. Must be a non-empty string with less than 65 characters and only contain lowercase letters, numbers and dashes\n   * @param body The exact allowed shape of data in the room. It is a multi-line string written in the [Liveblocks schema syntax](https://liveblocks.io/docs/platform/schema-validation/syntax).\n   * @returns The created schema.\n   */\n  async createSchema(name, body) {\n    const res = await this.post(url`/v2/schemas`, {\n      name,\n      body\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Returns a schema by its id.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   * @returns The schema with the given id.\n   */\n  async getSchema(schemaId) {\n    const res = await this.get(url`/v2/schemas/${schemaId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Updates the body for the schema. A schema can only be updated if it is not used by any room.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   * @param body The exact allowed shape of data in the room. It is a multi-line string written in the [Liveblocks schema syntax](https://liveblocks.io/docs/platform/schema-validation/syntax).\n   * @returns The updated schema. The version of the schema will be incremented.\n   */\n  async updateSchema(schemaId, body) {\n    const res = await this.put(url`/v2/schemas/${schemaId}`, {\n      body\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Deletes a schema by its id. A schema can only be deleted if it is not used by any room.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   */\n  async deleteSchema(schemaId) {\n    const res = await this.delete(url`/v2/schemas/${schemaId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns the schema attached to a room.\n   * @param roomId The id of the room to get the schema from.\n   * @returns\n   */\n  async getSchemaByRoomId(roomId) {\n    const res = await this.get(url`/v2/rooms/${roomId}/schema`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    const createdAt = new Date(data.createdAt);\n    const updatedAt = new Date(data.updatedAt);\n    return {\n      ...data,\n      createdAt,\n      updatedAt\n    };\n  }\n  /**\n   * Attaches a schema to a room, and instantly enables runtime schema validation for the room.\n   * If the current contents of the rooms Storage do not match the schema, attaching will fail and the error message will give details on why the schema failed to attach.\n   * @param roomId The id of the room to attach the schema to.\n   * @param schemaId Id of the schema - this is the combination of the schema name and version of the schema to update. For example, `my-schema@1`.\n   * @returns The schema id as JSON.\n   */\n  async attachSchemaToRoom(roomId, schemaId) {\n    const res = await this.post(url`/v2/rooms/${roomId}/schema`, {\n      schema: schemaId\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Detaches a schema from a room, and disables runtime schema validation for the room.\n   * @param roomId The id of the room to detach the schema from.\n   */\n  async detachSchemaFromRoom(roomId) {\n    const res = await this.delete(url`/v2/rooms/${roomId}/schema`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /* -------------------------------------------------------------------------------------------------\n   * Comments\n   * -----------------------------------------------------------------------------------------------*/\n  /**\n   * Gets all the threads in a room.\n   *\n   * @param params.roomId The room ID to get the threads from.\n   * @param params.query The query to filter threads by. It is based on our query language and can filter by metadata.\n   * @returns A list of threads.\n   */\n  async getThreads(params) {\n    const { roomId } = params;\n    let query;\n    if (typeof params.query === \"string\") {\n      query = params.query;\n    } else if (typeof params.query === \"object\") {\n      query = (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.objectToQuery)(params.query);\n    }\n    const res = await this.get(url`/v2/rooms/${roomId}/threads`, {\n      query\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const { data } = await res.json();\n    return {\n      data: data.map((thread) => (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(thread))\n    };\n  }\n  /**\n   * Gets a thread.\n   *\n   * @param params.roomId The room ID to get the thread from.\n   * @param params.threadId The thread ID.\n   * @returns A thread.\n   */\n  async getThread(params) {\n    const { roomId, threadId } = params;\n    const res = await this.get(url`/v2/rooms/${roomId}/threads/${threadId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Gets a thread's participants.\n   *\n   * Participants are users who have commented on the thread\n   * or users and groups that have been mentioned in a comment.\n   *\n   * @param params.roomId The room ID to get the thread participants from.\n   * @param params.threadId The thread ID to get the participants from.\n   * @returns An object containing an array of participant IDs.\n   */\n  async getThreadParticipants(params) {\n    const { roomId, threadId } = params;\n    const res = await this.get(\n      url`/v2/rooms/${roomId}/threads/${threadId}/participants`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Gets a thread's comment.\n   *\n   * @param params.roomId The room ID to get the comment from.\n   * @param params.threadId The thread ID to get the comment from.\n   * @param params.commentId The comment ID.\n   * @returns A comment.\n   */\n  async getComment(params) {\n    const { roomId, threadId, commentId } = params;\n    const res = await this.get(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentData)(await res.json());\n  }\n  /**\n   * Creates a comment.\n   *\n   * @param params.roomId The room ID to create the comment in.\n   * @param params.threadId The thread ID to create the comment in.\n   * @param params.data.userId The user ID of the user who is set to create the comment.\n   * @param params.data.createdAt (optional) The date the comment is set to be created.\n   * @param params.data.body The body of the comment.\n   * @returns The created comment.\n   */\n  async createComment(params) {\n    const { roomId, threadId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments`,\n      {\n        ...data,\n        createdAt: data.createdAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentData)(await res.json());\n  }\n  /**\n   * Edits a comment.\n   * @param params.roomId The room ID to edit the comment in.\n   * @param params.threadId The thread ID to edit the comment in.\n   * @param params.commentId The comment ID to edit.\n   * @param params.data.body The body of the comment.\n   * @param params.data.editedAt (optional) The date the comment was edited.\n   * @returns The edited comment.\n   */\n  async editComment(params) {\n    const { roomId, threadId, commentId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}`,\n      {\n        ...data,\n        editedAt: data.editedAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentData)(await res.json());\n  }\n  /**\n   * Deletes a comment. Deletes a comment. If there are no remaining comments in the thread, the thread is also deleted.\n   * @param params.roomId The room ID to delete the comment in.\n   * @param params.threadId The thread ID to delete the comment in.\n   * @param params.commentId The comment ID to delete.\n   */\n  async deleteComment(params) {\n    const { roomId, threadId, commentId } = params;\n    const res = await this.delete(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Creates a new thread. The thread will be created with the specified comment as its first comment.\n   * If the thread already exists, a `LiveblocksError` will be thrown with status code 409.\n   * @param params.roomId The room ID to create the thread in.\n   * @param params.thread.metadata (optional) The metadata for the thread. Supports upto a maximum of 10 entries. Value must be a string, boolean or number\n   * @param params.thread.comment.userId The user ID of the user who created the comment.\n   * @param params.thread.comment.createdAt (optional) The date the comment was created.\n   * @param params.thread.comment.body The body of the comment.\n   * @returns The created thread. The thread will be created with the specified comment as its first comment.\n   */\n  async createThread(params) {\n    const { roomId, data } = params;\n    const res = await this.post(url`/v2/rooms/${roomId}/threads`, {\n      ...data,\n      comment: {\n        ...data.comment,\n        createdAt: data.comment.createdAt?.toISOString()\n      }\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Deletes a thread and all of its comments.\n   * @param params.roomId The room ID to delete the thread in.\n   * @param params.threadId The thread ID to delete.\n   */\n  async deleteThread(params) {\n    const { roomId, threadId } = params;\n    const res = await this.delete(url`/v2/rooms/${roomId}/threads/${threadId}`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Mark a thread as resolved.\n   * @param params.roomId The room ID of the thread.\n   * @param params.threadId The thread ID to mark as resolved.\n   * @param params.data.userId The user ID of the user who marked the thread as resolved.\n   * @returns The thread marked as resolved.\n   */\n  async markThreadAsResolved(params) {\n    const { roomId, threadId } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/mark-as-resolved`,\n      {}\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Mark a thread as unresolved.\n   * @param params.roomId The room ID of the thread.\n   * @param params.threadId The thread ID to mark as unresolved.\n   * @param params.data.userId The user ID of the user who marked the thread as unresolved.\n   * @returns The thread marked as unresolved.\n   */\n  async markThreadAsUnresolved(params) {\n    const { roomId, threadId } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/mark-as-unresolved`,\n      {}\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToThreadData)(await res.json());\n  }\n  /**\n   * Updates the metadata of the specified thread in a room.\n   * @param params.roomId The room ID to update the thread in.\n   * @param params.threadId The thread ID to update.\n   * @param params.data.metadata The metadata for the thread. Value must be a string, boolean or number\n   * @param params.data.userId The user ID of the user who updated the thread.\n   * @param params.data.updatedAt (optional) The date the thread is set to be updated.\n   * @returns The updated thread metadata.\n   */\n  async editThreadMetadata(params) {\n    const { roomId, threadId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/metadata`,\n      {\n        ...data,\n        updatedAt: data.updatedAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Adds a new comment reaction to a comment.\n   * @param params.roomId The room ID to add the comment reaction in.\n   * @param params.threadId The thread ID to add the comment reaction in.\n   * @param params.commentId The comment ID to add the reaction in.\n   * @param params.data.emoji The (emoji) reaction to add.\n   * @param params.data.userId The user ID of the user associated with the reaction.\n   * @param params.data.createdAt (optional) The date the reaction is set to be created.\n   * @returns The created comment reaction.\n   */\n  async addCommentReaction(params) {\n    const { roomId, threadId, commentId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${commentId}/add-reaction`,\n      {\n        ...data,\n        createdAt: data.createdAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const reaction = await res.json();\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToCommentUserReaction)(reaction);\n  }\n  /**\n   * Removes a reaction from a comment.\n   * @param params.roomId The room ID to remove the comment reaction from.\n   * @param params.threadId The thread ID to remove the comment reaction from.\n   * @param params.commentId The comment ID to remove the reaction from.\n   * @param params.data.emoji The (emoji) reaction to remove.\n   * @param params.data.userId The user ID of the user associated with the reaction.\n   * @param params.data.removedAt (optional) The date the reaction is set to be removed.\n   */\n  async removeCommentReaction(params) {\n    const { roomId, threadId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/threads/${threadId}/comments/${params.commentId}/remove-reaction`,\n      {\n        ...data,\n        removedAt: data.removedAt?.toISOString()\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Returns the inbox notifications for a user.\n   * @param params.userId The user ID to get the inbox notifications from.\n   * @param params.inboxNotificationId The ID of the inbox notification to get.\n   */\n  async getInboxNotification(params) {\n    const { userId, inboxNotificationId } = params;\n    const res = await this.get(\n      url`/v2/users/${userId}/inbox-notifications/${inboxNotificationId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return (0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.convertToInboxNotificationData)(\n      await res.json()\n    );\n  }\n  /**\n   * Gets the user's room notification settings.\n   * @param params.userId The user ID to get the room notifications from.\n   * @param params.roomId The room ID to get the room notification settings from.\n   */\n  async getRoomNotificationSettings(params) {\n    const { userId, roomId } = params;\n    const res = await this.get(\n      url`/v2/rooms/${roomId}/users/${userId}/notification-settings`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Updates the user's room notification settings.\n   * @param params.userId The user ID to update the room notification settings for.\n   * @param params.roomId The room ID to update the room notification settings for.\n   * @param params.data The new room notification settings for the user.\n   */\n  async updateRoomNotificationSettings(params) {\n    const { userId, roomId, data } = params;\n    const res = await this.post(\n      url`/v2/rooms/${roomId}/users/${userId}/notification-settings`,\n      data\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    return await res.json();\n  }\n  /**\n   * Delete the user's room notification settings.\n   * @param params.userId The user ID to delete the room notification settings from.\n   * @param params.roomId The room ID to delete the room notification settings from.\n   */\n  async deleteRoomNotificationSettings(params) {\n    const { userId, roomId } = params;\n    const res = await this.delete(\n      url`/v2/rooms/${roomId}/users/${userId}/notification-settings`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Update a room ID.\n   * @param params.roomId The current ID of the room.\n   * @param params.newRoomId The new room ID.\n   */\n  async updateRoomId(params) {\n    const { currentRoomId, newRoomId } = params;\n    const res = await this.post(\n      url`/v2/rooms/${currentRoomId}/update-room-id`,\n      {\n        newRoomId\n      }\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n    const data = await res.json();\n    return {\n      ...data,\n      createdAt: new Date(data.createdAt),\n      lastConnectionAt: data.lastConnectionAt ? new Date(data.lastConnectionAt) : void 0\n    };\n  }\n  async triggerInboxNotification(params) {\n    const res = await this.post(url`/v2/inbox-notifications/trigger`, params);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Deletes an inbox notification for a user.\n   * @param params.userId The user ID for which to delete the inbox notification.\n   * @param params.inboxNotificationId The ID of the inbox notification to delete.\n   */\n  async deleteInboxNotification(params) {\n    const { userId, inboxNotificationId } = params;\n    const res = await this.delete(\n      url`/v2/users/${userId}/inbox-notifications/${inboxNotificationId}`\n    );\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n  /**\n   * Deletes all inbox notifications for a user.\n   * @param params.userId The user ID for which to delete all the inbox notifications.\n   */\n  async deleteAllInboxNotifications(params) {\n    const { userId } = params;\n    const res = await this.delete(url`/v2/users/${userId}/inbox-notifications`);\n    if (!res.ok) {\n      const text = await res.text();\n      throw new LiveblocksError(res.status, text);\n    }\n  }\n};\nvar LiveblocksError = class extends Error {\n  constructor(status, message = \"\") {\n    super(message);\n    this.name = \"LiveblocksError\";\n    this.status = status;\n  }\n};\n\n// src/webhooks.ts\n\n\nvar _WebhookHandler = class _WebhookHandler {\n  constructor(secret) {\n    if (!secret) throw new Error(\"Secret is required\");\n    if (typeof secret !== \"string\") throw new Error(\"Secret must be a string\");\n    if (secret.startsWith(_WebhookHandler.secretPrefix) === false)\n      throw new Error(\"Invalid secret, must start with whsec_\");\n    const secretKey = secret.slice(_WebhookHandler.secretPrefix.length);\n    this.secretBuffer = Buffer.from(secretKey, \"base64\");\n  }\n  /**\n   * Verifies a webhook request and returns the event\n   */\n  verifyRequest(request) {\n    const { headers, rawBody } = request;\n    const { webhookId, timestamp, rawSignatures } = this.verifyHeaders(headers);\n    if (typeof rawBody !== \"string\") {\n      throw new Error(\n        `Invalid rawBody field, must be a string, got \"${typeof rawBody}\" instead. It is likely that you need to JSON.stringify the body before passing it.`\n      );\n    }\n    this.verifyTimestamp(timestamp);\n    const signature = this.sign(`${webhookId}.${timestamp}.${rawBody}`);\n    const expectedSignatures = rawSignatures.split(\" \").map((rawSignature) => {\n      const [, parsedSignature] = rawSignature.split(\",\");\n      return parsedSignature;\n    }).filter(isNotUndefined);\n    if (expectedSignatures.includes(signature) === false)\n      throw new Error(\n        `Invalid signature, expected one of ${expectedSignatures.join(\n          \", \"\n        )}, got ${signature}`\n      );\n    const event = JSON.parse(rawBody);\n    this.verifyWebhookEventType(event);\n    return event;\n  }\n  /**\n   * Verifies the headers and returns the webhookId, timestamp and rawSignatures\n   */\n  verifyHeaders(headers) {\n    const usingNativeHeaders = typeof Headers !== \"undefined\" && headers instanceof Headers;\n    const normalizedHeaders = usingNativeHeaders ? Object.fromEntries(headers) : headers;\n    const sanitizedHeaders = {};\n    Object.keys(normalizedHeaders).forEach((key) => {\n      sanitizedHeaders[key.toLowerCase()] = normalizedHeaders[key];\n    });\n    const webhookId = sanitizedHeaders[\"webhook-id\"];\n    if (typeof webhookId !== \"string\")\n      throw new Error(\"Invalid webhook-id header\");\n    const timestamp = sanitizedHeaders[\"webhook-timestamp\"];\n    if (typeof timestamp !== \"string\")\n      throw new Error(\"Invalid webhook-timestamp header\");\n    const rawSignatures = sanitizedHeaders[\"webhook-signature\"];\n    if (typeof rawSignatures !== \"string\")\n      throw new Error(\"Invalid webhook-signature header\");\n    return { webhookId, timestamp, rawSignatures };\n  }\n  /**\n   * Signs the content with the secret\n   * @param content\n   * @returns `string`\n   */\n  sign(content) {\n    const encoder = new TextEncoder();\n    const toSign = encoder.encode(content);\n    return _stablelib_base64__WEBPACK_IMPORTED_MODULE_1__.encode(fast_sha256__WEBPACK_IMPORTED_MODULE_2__.hmac(this.secretBuffer, toSign));\n  }\n  /**\n   * Verifies that the timestamp is not too old or in the future\n   */\n  verifyTimestamp(timestampHeader) {\n    const now = Math.floor(Date.now() / 1e3);\n    const timestamp = parseInt(timestampHeader, 10);\n    if (isNaN(timestamp)) {\n      throw new Error(\"Invalid timestamp\");\n    }\n    if (timestamp < now - WEBHOOK_TOLERANCE_IN_SECONDS) {\n      throw new Error(\"Timestamp too old\");\n    }\n    if (timestamp > now + WEBHOOK_TOLERANCE_IN_SECONDS) {\n      throw new Error(\"Timestamp in the future\");\n    }\n  }\n  /**\n   * Ensures that the event is a known event type\n   * or throws and prompts the user to upgrade to a higher version of @liveblocks/node\n   */\n  verifyWebhookEventType(event) {\n    if (event && event.type && [\n      \"storageUpdated\",\n      \"userEntered\",\n      \"userLeft\",\n      \"roomCreated\",\n      \"roomDeleted\",\n      \"commentCreated\",\n      \"commentEdited\",\n      \"commentDeleted\",\n      \"commentReactionAdded\",\n      \"commentReactionRemoved\",\n      \"threadMetadataUpdated\",\n      \"threadCreated\",\n      \"threadDeleted\",\n      \"ydocUpdated\",\n      \"notification\",\n      \"threadMarkedAsResolved\",\n      \"threadMarkedAsUnresolved\"\n    ].includes(event.type)) {\n      if (event.type === \"notification\") {\n        const notification = event;\n        if (notification.data.kind === \"thread\" || notification.data.kind === \"textMention\" || notification.data.kind.startsWith(\"$\")) {\n          return;\n        } else {\n          throw new Error(\n            `Unknown notification kind: ${notification.data.kind}`\n          );\n        }\n      }\n      return;\n    }\n    throw new Error(\n      \"Unknown event type, please upgrade to a higher version of @liveblocks/node\"\n    );\n  }\n};\n_WebhookHandler.secretPrefix = \"whsec_\";\nvar WebhookHandler = _WebhookHandler;\nvar WEBHOOK_TOLERANCE_IN_SECONDS = 5 * 60;\nvar isNotUndefined = (value) => value !== void 0;\n\n// src/index.ts\n\n(0,_liveblocks_core__WEBPACK_IMPORTED_MODULE_0__.detectDupes)(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3Mvbm9kZS9kaXN0L2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQytDOztBQUUvQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQU8wQjs7QUFFMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZFQUE2RSxpV0FBb0I7QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsTUFBTTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsTUFBTTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxNQUFNO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsS0FBSztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSwwQ0FBMEMsdUJBQXVCO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFJMEI7QUFDMUIsNkRBQVc7QUFPVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGl2ZWRvY3MvLi9ub2RlX21vZHVsZXMvQGxpdmVibG9ja3Mvbm9kZS9kaXN0L2luZGV4Lm1qcz9kMGUxIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9pbmRleC50c1xuaW1wb3J0IHsgZGV0ZWN0RHVwZXMgfSBmcm9tIFwiQGxpdmVibG9ja3MvY29yZVwiO1xuXG4vLyBzcmMvdmVyc2lvbi50c1xudmFyIFBLR19OQU1FID0gXCJAbGl2ZWJsb2Nrcy9ub2RlXCI7XG52YXIgUEtHX1ZFUlNJT04gPSBcIjIuNC4wXCI7XG52YXIgUEtHX0ZPUk1BVCA9IFwiZXNtXCI7XG5cbi8vIHNyYy9jbGllbnQudHNcbmltcG9ydCB7XG4gIGNvbnZlcnRUb0NvbW1lbnREYXRhLFxuICBjb252ZXJ0VG9Db21tZW50VXNlclJlYWN0aW9uLFxuICBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRhdGEsXG4gIGNvbnZlcnRUb1RocmVhZERhdGEsXG4gIG9iamVjdFRvUXVlcnlcbn0gZnJvbSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcblxuLy8gc3JjL3V0aWxzLnRzXG52YXIgREVGQVVMVF9CQVNFX1VSTCA9IFwiaHR0cHM6Ly9hcGkubGl2ZWJsb2Nrcy5pb1wiO1xuZnVuY3Rpb24gZ2V0QmFzZVVybChiYXNlVXJsKSB7XG4gIGlmICh0eXBlb2YgYmFzZVVybCA9PT0gXCJzdHJpbmdcIiAmJiBiYXNlVXJsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgcmV0dXJuIGJhc2VVcmw7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERFRkFVTFRfQkFTRV9VUkw7XG4gIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoUG9seWZpbGwoKSB7XG4gIHJldHVybiB0eXBlb2YgZ2xvYmFsVGhpcy5mZXRjaCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFRoaXMuZmV0Y2ggOiAoYXdhaXQgaW1wb3J0KFwibm9kZS1mZXRjaFwiKSkuZGVmYXVsdDtcbn1cbmZ1bmN0aW9uIGlzTm9uRW1wdHkodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5sZW5ndGggPiAwO1xufVxuZnVuY3Rpb24gYXNzZXJ0Tm9uRW1wdHkodmFsdWUsIGZpZWxkKSB7XG4gIGlmICghaXNOb25FbXB0eSh2YWx1ZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgSW52YWxpZCB2YWx1ZSBmb3IgZmllbGQgXCIke2ZpZWxkfVwiLiBQbGVhc2UgcHJvdmlkZSBhIG5vbi1lbXB0eSBzdHJpbmcuIEZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9hcGktcmVmZXJlbmNlL2xpdmVibG9ja3Mtbm9kZSNhdXRob3JpemVgXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gYXNzZXJ0U2VjcmV0S2V5KHZhbHVlLCBmaWVsZCkge1xuICBpZiAoIWlzTm9uRW1wdHkodmFsdWUpIHx8ICF2YWx1ZS5zdGFydHNXaXRoKFwic2tfXCIpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYEludmFsaWQgdmFsdWUgZm9yIGZpZWxkIFwiJHtmaWVsZH1cIi4gU2VjcmV0IGtleXMgbXVzdCBzdGFydCB3aXRoIFwic2tfXCIuIFBsZWFzZSBwcm92aWRlIHRoZSBzZWNyZXQga2V5IGZyb20geW91ciBMaXZlYmxvY2tzIGRhc2hib2FyZCBhdCBodHRwczovL2xpdmVibG9ja3MuaW8vZGFzaGJvYXJkL2FwaWtleXMuYFxuICAgICk7XG4gIH1cbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZVN0YXR1c0NvZGUoc3RhdHVzQ29kZSkge1xuICBpZiAoc3RhdHVzQ29kZSA+PSAyMDAgJiYgc3RhdHVzQ29kZSA8IDMwMCkge1xuICAgIHJldHVybiAyMDA7XG4gIH0gZWxzZSBpZiAoc3RhdHVzQ29kZSA+PSA1MDApIHtcbiAgICByZXR1cm4gNTAzO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiA0MDM7XG4gIH1cbn1cbmZ1bmN0aW9uIHRvVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykge1xuICBjb25zdCByZXN1bHQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHBhcmFtcykpIHtcbiAgICBpZiAodmFsdWUgIT09IHZvaWQgMCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgcmVzdWx0LnNldChrZXksIHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gdXJsam9pbihiYXNlVXJsLCBwYXRoLCBwYXJhbXMpIHtcbiAgY29uc3QgdXJsMiA9IG5ldyBVUkwocGF0aCwgYmFzZVVybCk7XG4gIGlmIChwYXJhbXMgIT09IHZvaWQgMCkge1xuICAgIHVybDIuc2VhcmNoID0gKHBhcmFtcyBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcyA/IHBhcmFtcyA6IHRvVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykpLnRvU3RyaW5nKCk7XG4gIH1cbiAgcmV0dXJuIHVybDIudG9TdHJpbmcoKTtcbn1cbmZ1bmN0aW9uIHVybChzdHJpbmdzLCAuLi52YWx1ZXMpIHtcbiAgcmV0dXJuIHN0cmluZ3MucmVkdWNlKFxuICAgIChyZXN1bHQsIHN0ciwgaSkgPT4gcmVzdWx0ICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlc1tpIC0gMV0gPz8gXCJcIikgKyBzdHJcbiAgKTtcbn1cblxuLy8gc3JjL1Nlc3Npb24udHNcbnZhciBBTExfUEVSTUlTU0lPTlMgPSBPYmplY3QuZnJlZXplKFtcbiAgXCJyb29tOndyaXRlXCIsXG4gIFwicm9vbTpyZWFkXCIsXG4gIFwicm9vbTpwcmVzZW5jZTp3cml0ZVwiLFxuICBcImNvbW1lbnRzOndyaXRlXCIsXG4gIFwiY29tbWVudHM6cmVhZFwiXG5dKTtcbmZ1bmN0aW9uIGlzUGVybWlzc2lvbih2YWx1ZSkge1xuICByZXR1cm4gQUxMX1BFUk1JU1NJT05TLmluY2x1ZGVzKHZhbHVlKTtcbn1cbnZhciBNQVhfUEVSTVNfUEVSX1NFVCA9IDEwO1xudmFyIFJFQURfQUNDRVNTID0gT2JqZWN0LmZyZWV6ZShbXG4gIFwicm9vbTpyZWFkXCIsXG4gIFwicm9vbTpwcmVzZW5jZTp3cml0ZVwiLFxuICBcImNvbW1lbnRzOnJlYWRcIlxuXSk7XG52YXIgRlVMTF9BQ0NFU1MgPSBPYmplY3QuZnJlZXplKFtcInJvb206d3JpdGVcIiwgXCJjb21tZW50czp3cml0ZVwiXSk7XG52YXIgcm9vbVBhdHRlcm5SZWdleCA9IC9eKFsqXXxbXipdezEsMTI4fVsqXT8pJC87XG52YXIgU2Vzc2lvbiA9IGNsYXNzIHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb25zdHJ1Y3Rvcihwb3N0Rm4sIHVzZXJJZCwgdXNlckluZm8pIHtcbiAgICB0aGlzLkZVTExfQUNDRVNTID0gRlVMTF9BQ0NFU1M7XG4gICAgdGhpcy5SRUFEX0FDQ0VTUyA9IFJFQURfQUNDRVNTO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICB0aGlzLl9zZWFsZWQgPSBmYWxzZTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgdGhpcy5fcGVybWlzc2lvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGFzc2VydE5vbkVtcHR5KHVzZXJJZCwgXCJ1c2VySWRcIik7XG4gICAgdGhpcy5fcG9zdEZuID0gcG9zdEZuO1xuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcbiAgICB0aGlzLl91c2VySW5mbyA9IHVzZXJJbmZvO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgZ2V0T3JDcmVhdGUocm9vbUlkKSB7XG4gICAgaWYgKHRoaXMuX3NlYWxlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IGNhbiBubyBsb25nZXIgY2hhbmdlIHRoZXNlIHBlcm1pc3Npb25zLlwiKTtcbiAgICB9XG4gICAgbGV0IHBlcm1zID0gdGhpcy5fcGVybWlzc2lvbnMuZ2V0KHJvb21JZCk7XG4gICAgaWYgKHBlcm1zKSB7XG4gICAgICByZXR1cm4gcGVybXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLl9wZXJtaXNzaW9ucy5zaXplID49IE1BWF9QRVJNU19QRVJfU0VUKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIllvdSBjYW5ub3QgYWRkIHBlcm1pc3Npb25zIGZvciBtb3JlIHRoYW4gMTAgcm9vbXMgaW4gYSBzaW5nbGUgdG9rZW5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcGVybXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpO1xuICAgICAgdGhpcy5fcGVybWlzc2lvbnMuc2V0KHJvb21JZCwgcGVybXMpO1xuICAgICAgcmV0dXJuIHBlcm1zO1xuICAgIH1cbiAgfVxuICBhbGxvdyhyb29tSWRPclBhdHRlcm4sIG5ld1Blcm1zKSB7XG4gICAgaWYgKHR5cGVvZiByb29tSWRPclBhdHRlcm4gIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJvb20gbmFtZSBvciBwYXR0ZXJuIG11c3QgYmUgYSBzdHJpbmdcIik7XG4gICAgfVxuICAgIGlmICghcm9vbVBhdHRlcm5SZWdleC50ZXN0KHJvb21JZE9yUGF0dGVybikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcm9vbSBuYW1lIG9yIHBhdHRlcm5cIik7XG4gICAgfVxuICAgIGlmIChuZXdQZXJtcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlBlcm1pc3Npb24gbGlzdCBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgfVxuICAgIGNvbnN0IGV4aXN0aW5nUGVybXMgPSB0aGlzLmdldE9yQ3JlYXRlKHJvb21JZE9yUGF0dGVybik7XG4gICAgZm9yIChjb25zdCBwZXJtIG9mIG5ld1Blcm1zKSB7XG4gICAgICBpZiAoIWlzUGVybWlzc2lvbihwZXJtKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vdCBhIHZhbGlkIHBlcm1pc3Npb246ICR7cGVybX1gKTtcbiAgICAgIH1cbiAgICAgIGV4aXN0aW5nUGVybXMuYWRkKHBlcm0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKiogQGludGVybmFsIC0gRm9yIHVuaXQgdGVzdHMgb25seSAqL1xuICBoYXNQZXJtaXNzaW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fcGVybWlzc2lvbnMuc2l6ZSA+IDA7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAtIEZvciB1bml0IHRlc3RzIG9ubHkgKi9cbiAgc2VhbCgpIHtcbiAgICBpZiAodGhpcy5fc2VhbGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiWW91IGNhbm5vdCByZXVzZSBTZXNzaW9uIGluc3RhbmNlcy4gUGxlYXNlIGNyZWF0ZSBhIG5ldyBzZXNzaW9uIGV2ZXJ5IHRpbWUuXCJcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuX3NlYWxlZCA9IHRydWU7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAtIEZvciB1bml0IHRlc3RzIG9ubHkgKi9cbiAgc2VyaWFsaXplUGVybWlzc2lvbnMoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgIEFycmF5LmZyb20odGhpcy5fcGVybWlzc2lvbnMuZW50cmllcygpKS5tYXAoKFtwYXQsIHBlcm1zXSkgPT4gW1xuICAgICAgICBwYXQsXG4gICAgICAgIEFycmF5LmZyb20ocGVybXMpXG4gICAgICBdKVxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIENhbGwgdGhpcyB0byBhdXRob3JpemUgdGhlIHNlc3Npb24gdG8gYWNjZXNzIExpdmVibG9ja3MuIE5vdGUgdGhhdCB0aGlzXG4gICAqIHdpbGwgcmV0dXJuIGEgTGl2ZWJsb2NrcyBcImFjY2VzcyB0b2tlblwiLiBBbnlvbmUgdGhhdCBvYnRhaW5zIHN1Y2ggYWNjZXNzXG4gICAqIHRva2VuIHdpbGwgaGF2ZSBhY2Nlc3MgdG8gdGhlIGFsbG93ZWQgcmVzb3VyY2VzLlxuICAgKi9cbiAgYXN5bmMgYXV0aG9yaXplKCkge1xuICAgIHRoaXMuc2VhbCgpO1xuICAgIGlmICghdGhpcy5oYXNQZXJtaXNzaW9ucygpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIFwiQWNjZXNzIHRva2VucyB3aXRob3V0IGFueSBwZXJtaXNzaW9uIHdpbGwgbm90IGJlIHN1cHBvcnRlZCBzb29uLCB5b3Ugc2hvdWxkIHVzZSB3aWxkY2FyZHMgd2hlbiB0aGUgY2xpZW50IHJlcXVlc3RzIGEgdG9rZW4gZm9yIHJlc291cmNlcyBvdXRzaWRlIGEgcm9vbS4gU2VlIGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL2Vycm9ycy9saXZlYmxvY2tzLWNsaWVudC9hY2Nlc3MtdG9rZW5zLW5vdC1lbm91Z2gtcGVybWlzc2lvbnNcIlxuICAgICAgKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCB0aGlzLl9wb3N0Rm4odXJsYC92Mi9hdXRob3JpemUtdXNlcmAsIHtcbiAgICAgICAgLy8gUmVxdWlyZWRcbiAgICAgICAgdXNlcklkOiB0aGlzLl91c2VySWQsXG4gICAgICAgIHBlcm1pc3Npb25zOiB0aGlzLnNlcmlhbGl6ZVBlcm1pc3Npb25zKCksXG4gICAgICAgIC8vIE9wdGlvbmFsIG1ldGFkYXRhXG4gICAgICAgIHVzZXJJbmZvOiB0aGlzLl91c2VySW5mb1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IG5vcm1hbGl6ZVN0YXR1c0NvZGUocmVzcC5zdGF0dXMpLFxuICAgICAgICBib2R5OiBhd2FpdCByZXNwLnRleHQoKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiA1MDMsXG4gICAgICAgIGJvZHk6ICdDYWxsIHRvIC92Mi9hdXRob3JpemUtdXNlciBmYWlsZWQuIFNlZSBcImVycm9yXCIgZm9yIG1vcmUgaW5mb3JtYXRpb24uJyxcbiAgICAgICAgZXJyb3I6IGVyXG4gICAgICB9O1xuICAgIH1cbiAgfVxufTtcblxuLy8gc3JjL2NsaWVudC50c1xudmFyIExpdmVibG9ja3MgPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBJbnRlcmFjdCB3aXRoIHRoZSBMaXZlYmxvY2tzIEFQSSBmcm9tIHlvdXIgTm9kZS5qcyBiYWNrZW5kLlxuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIGNvbnN0IG9wdGlvbnNfID0gb3B0aW9ucztcbiAgICBjb25zdCBzZWNyZXQgPSBvcHRpb25zXy5zZWNyZXQ7XG4gICAgYXNzZXJ0U2VjcmV0S2V5KHNlY3JldCwgXCJzZWNyZXRcIik7XG4gICAgdGhpcy5fc2VjcmV0ID0gc2VjcmV0O1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBuZXcgVVJMKGdldEJhc2VVcmwob3B0aW9ucy5iYXNlVXJsKSk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBhc3luYyBwb3N0KHBhdGgsIGpzb24pIHtcbiAgICBjb25zdCB1cmwyID0gdXJsam9pbih0aGlzLl9iYXNlVXJsLCBwYXRoKTtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuX3NlY3JldH1gLFxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICB9O1xuICAgIGNvbnN0IGZldGNoID0gYXdhaXQgZmV0Y2hQb2x5ZmlsbCgpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybDIsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoanNvbilcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzO1xuICB9XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgYXN5bmMgcHV0KHBhdGgsIGpzb24pIHtcbiAgICBjb25zdCB1cmwyID0gdXJsam9pbih0aGlzLl9iYXNlVXJsLCBwYXRoKTtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuX3NlY3JldH1gLFxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICB9O1xuICAgIGNvbnN0IGZldGNoID0gYXdhaXQgZmV0Y2hQb2x5ZmlsbCgpO1xuICAgIHJldHVybiBhd2FpdCBmZXRjaCh1cmwyLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoanNvbilcbiAgICB9KTtcbiAgfVxuICAvKiogQGludGVybmFsICovXG4gIGFzeW5jIHB1dEJpbmFyeShwYXRoLCBib2R5LCBwYXJhbXMpIHtcbiAgICBjb25zdCB1cmwyID0gdXJsam9pbih0aGlzLl9iYXNlVXJsLCBwYXRoLCBwYXJhbXMpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5fc2VjcmV0fWAsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiXG4gICAgfTtcbiAgICBjb25zdCBmZXRjaCA9IGF3YWl0IGZldGNoUG9seWZpbGwoKTtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2godXJsMiwgeyBtZXRob2Q6IFwiUFVUXCIsIGhlYWRlcnMsIGJvZHkgfSk7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBhc3luYyBkZWxldGUocGF0aCkge1xuICAgIGNvbnN0IHVybDIgPSB1cmxqb2luKHRoaXMuX2Jhc2VVcmwsIHBhdGgpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5fc2VjcmV0fWBcbiAgICB9O1xuICAgIGNvbnN0IGZldGNoID0gYXdhaXQgZmV0Y2hQb2x5ZmlsbCgpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybDIsIHsgbWV0aG9kOiBcIkRFTEVURVwiLCBoZWFkZXJzIH0pO1xuICAgIHJldHVybiByZXM7XG4gIH1cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBhc3luYyBnZXQocGF0aCwgcGFyYW1zKSB7XG4gICAgY29uc3QgdXJsMiA9IHVybGpvaW4odGhpcy5fYmFzZVVybCwgcGF0aCwgcGFyYW1zKTtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuX3NlY3JldH1gXG4gICAgfTtcbiAgICBjb25zdCBmZXRjaCA9IGF3YWl0IGZldGNoUG9seWZpbGwoKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwyLCB7IG1ldGhvZDogXCJHRVRcIiwgaGVhZGVycyB9KTtcbiAgICByZXR1cm4gcmVzO1xuICB9XG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogQXV0aGVudGljYXRpb25cbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuICAvKipcbiAgICogUHJlcGFyZXMgYSBuZXcgc2Vzc2lvbiB0byBhdXRob3JpemUgYSB1c2VyIHRvIGFjY2VzcyBMaXZlYmxvY2tzLlxuICAgKlxuICAgKiBJTVBPUlRBTlQ6XG4gICAqIEFsd2F5cyBtYWtlIHN1cmUgdGhhdCB5b3UgdHJ1c3QgdGhlIHVzZXIgbWFraW5nIHRoZSByZXF1ZXN0IHRvIHlvdXJcbiAgICogYmFja2VuZCBiZWZvcmUgY2FsbGluZyAucHJlcGFyZVNlc3Npb24oKSFcbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZCBUZWxsIExpdmVibG9ja3MgdGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgdG8gYXV0aG9yaXplLiBNdXN0XG4gICAqIHVuaXF1ZWx5IGlkZW50aWZ5IHRoZSB1c2VyIGFjY291bnQgaW4geW91ciBzeXN0ZW0uIFRoZSB1bmlxdWVuZXNzIG9mIHRoaXNcbiAgICogdmFsdWUgd2lsbCBkZXRlcm1pbmUgaG93IG1hbnkgTUFVcyB3aWxsIGJlIGNvdW50ZWQvYmlsbGVkLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucy51c2VySW5mbyBDdXN0b20gbWV0YWRhdGEgdG8gYXR0YWNoIHRvIHRoaXMgdXNlci4gRGF0YSB5b3VcbiAgICogYWRkIGhlcmUgd2lsbCBiZSB2aXNpYmxlIHRvIGFsbCBvdGhlciBjbGllbnRzIGluIHRoZSByb29tLCB0aHJvdWdoIHRoZVxuICAgKiBgb3RoZXIuaW5mb2AgcHJvcGVydHkuXG4gICAqXG4gICAqL1xuICBwcmVwYXJlU2Vzc2lvbih1c2VySWQsIC4uLnJlc3QpIHtcbiAgICBjb25zdCBvcHRpb25zID0gcmVzdFswXTtcbiAgICByZXR1cm4gbmV3IFNlc3Npb24odGhpcy5wb3N0LmJpbmQodGhpcyksIHVzZXJJZCwgb3B0aW9ucz8udXNlckluZm8pO1xuICB9XG4gIC8qKlxuICAgKiBDYWxsIHRoaXMgdG8gYXV0aGVudGljYXRlIHRoZSB1c2VyIGFzIGFuIGFjdG9yIHlvdSB3YW50IHRvIGFsbG93IHRvIHVzZVxuICAgKiBMaXZlYmxvY2tzLlxuICAgKlxuICAgKiBZb3Ugc2hvdWxkIHVzZSB0aGlzIG1ldGhvZCBvbmx5IGlmIHlvdSB3YW50IHRvIG1hbmFnZSB5b3VyIHBlcm1pc3Npb25zXG4gICAqIHRocm91Z2ggdGhlIExpdmVibG9ja3MgUGVybWlzc2lvbnMgQVBJLiBUaGlzIG1ldGhvZCBpcyBtb3JlIGNvbXBsaWNhdGVkIHRvXG4gICAqIHNldCB1cCwgYnV0IGFsbG93cyBmb3IgZmluZXItZ3JhaW5lZCBzcGVjaWZpY2F0aW9uIG9mIHBlcm1pc3Npb25zLlxuICAgKlxuICAgKiBDYWxsaW5nIGAuaWRlbnRpZnlVc2VyKClgIG9ubHkgbGV0cyB5b3Ugc2VjdXJlbHkgaWRlbnRpZnkgYSB1c2VyIChhbmQgd2hhdFxuICAgKiBncm91cHMgdGhleSBiZWxvbmcgdG8pLiBXaGF0IHBlcm1pc3Npb25zIHRoaXMgdXNlciB3aWxsIGVuZCB1cCBoYXZpbmcgaXNcbiAgICogZGV0ZXJtaW5lZCBieSB3aGF0ZXZlciBwZXJtaXNzaW9ucyB5b3UgYXNzaWduIHRoZSB1c2VyL2dyb3VwIGluIHlvdXJcbiAgICogTGl2ZWJsb2NrcyBhY2NvdW50LCB0aHJvdWdoIHRoZSBQZXJtaXNzaW9ucyBBUEk6XG4gICAqIGh0dHBzOi8vbGl2ZWJsb2Nrcy5pby9kb2NzL3Jvb21zL3Blcm1pc3Npb25zXG4gICAqXG4gICAqIElNUE9SVEFOVDpcbiAgICogQWx3YXlzIHZlcmlmeSB0aGF0IHlvdSB0cnVzdCB0aGUgdXNlciBtYWtpbmcgdGhlIHJlcXVlc3QgYmVmb3JlIGNhbGxpbmdcbiAgICogLmlkZW50aWZ5VXNlcigpIVxuICAgKlxuICAgKiBAcGFyYW0gaWRlbnRpdHkgVGVsbCBMaXZlYmxvY2tzIHRoZSB1c2VyIElEIG9mIHRoZSB1c2VyIHRvIGF1dGhlbnRpY2F0ZS5cbiAgICogTXVzdCB1bmlxdWVseSBpZGVudGlmeSB0aGUgdXNlciBhY2NvdW50IGluIHlvdXIgc3lzdGVtLiBUaGUgdW5pcXVlbmVzcyBvZlxuICAgKiB0aGlzIHZhbHVlIHdpbGwgZGV0ZXJtaW5lIGhvdyBtYW55IE1BVXMgd2lsbCBiZSBjb3VudGVkL2JpbGxlZC5cbiAgICpcbiAgICogSWYgeW91IGFsc28gd2FudCB0byBhc3NpZ24gd2hpY2ggZ3JvdXBzIHRoaXMgdXNlciBiZWxvbmdzIHRvLCB1c2UgdGhlXG4gICAqIG9iamVjdCBmb3JtIGFuZCBzcGVjaWZ5IHRoZSBgZ3JvdXBJZHNgIHByb3BlcnR5LiBUaG9zZSBgZ3JvdXBJZHNgIHNob3VsZFxuICAgKiBtYXRjaCB0aGUgZ3JvdXBJZHMgeW91IGFzc2lnbmVkIHBlcm1pc3Npb25zIHRvIHZpYSB0aGUgTGl2ZWJsb2Nrc1xuICAgKiBQZXJtaXNzaW9ucyBBUEksIHNlZVxuICAgKiBodHRwczovL2xpdmVibG9ja3MuaW8vZG9jcy9yb29tcy9wZXJtaXNzaW9ucyNwZXJtaXNzaW9ucy1sZXZlbHMtZ3JvdXBzLWFjY2Vzc2VzLWV4YW1wbGVcbiAgICpcbiAgICogQHBhcmFtIG9wdGlvbnMudXNlckluZm8gQ3VzdG9tIG1ldGFkYXRhIHRvIGF0dGFjaCB0byB0aGlzIHVzZXIuIERhdGEgeW91XG4gICAqIGFkZCBoZXJlIHdpbGwgYmUgdmlzaWJsZSB0byBhbGwgb3RoZXIgY2xpZW50cyBpbiB0aGUgcm9vbSwgdGhyb3VnaCB0aGVcbiAgICogYG90aGVyLmluZm9gIHByb3BlcnR5LlxuICAgKi9cbiAgLy8gVGhlc2UgZmllbGRzIGRlZmluZSB0aGUgc2VjdXJpdHkgaWRlbnRpdHkgb2YgdGhlIHVzZXIuIFdoYXRldmVyIHlvdSBwYXNzIGluIGhlcmUgd2lsbCBkZWZpbmUgd2hpY2hcbiAgYXN5bmMgaWRlbnRpZnlVc2VyKGlkZW50aXR5LCAuLi5yZXN0KSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHJlc3RbMF07XG4gICAgY29uc3QgcGF0aCA9IHVybGAvdjIvaWRlbnRpZnktdXNlcmA7XG4gICAgY29uc3QgdXNlcklkID0gdHlwZW9mIGlkZW50aXR5ID09PSBcInN0cmluZ1wiID8gaWRlbnRpdHkgOiBpZGVudGl0eS51c2VySWQ7XG4gICAgY29uc3QgZ3JvdXBJZHMgPSB0eXBlb2YgaWRlbnRpdHkgPT09IFwic3RyaW5nXCIgPyB2b2lkIDAgOiBpZGVudGl0eS5ncm91cElkcztcbiAgICBhc3NlcnROb25FbXB0eSh1c2VySWQsIFwidXNlcklkXCIpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwID0gYXdhaXQgdGhpcy5wb3N0KHBhdGgsIHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBncm91cElkcyxcbiAgICAgICAgLy8gT3B0aW9uYWwgbWV0YWRhdGFcbiAgICAgICAgdXNlckluZm86IG9wdGlvbnM/LnVzZXJJbmZvXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogbm9ybWFsaXplU3RhdHVzQ29kZShyZXNwLnN0YXR1cyksXG4gICAgICAgIGJvZHk6IGF3YWl0IHJlc3AudGV4dCgpXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDUwMyxcbiAgICAgICAgYm9keTogYENhbGwgdG8gJHt1cmxqb2luKFxuICAgICAgICAgIHRoaXMuX2Jhc2VVcmwsXG4gICAgICAgICAgcGF0aFxuICAgICAgICApfSBmYWlsZWQuIFNlZSBcImVycm9yXCIgZm9yIG1vcmUgaW5mb3JtYXRpb24uYCxcbiAgICAgICAgZXJyb3I6IGVyXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAqIFJvb21cbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuICAvKipcbiAgICogUmV0dXJucyBhIGxpc3Qgb2YgeW91ciByb29tcy4gVGhlIHJvb21zIGFyZSByZXR1cm5lZCBzb3J0ZWQgYnkgY3JlYXRpb24gZGF0ZSwgZnJvbSBuZXdlc3QgdG8gb2xkZXN0LiBZb3UgY2FuIGZpbHRlciByb29tcyBieSBtZXRhZGF0YSwgdXNlcnMgYWNjZXNzZXMgYW5kIGdyb3VwcyBhY2Nlc3Nlcy5cbiAgICogQHBhcmFtIHBhcmFtcy5saW1pdCAob3B0aW9uYWwpIEEgbGltaXQgb24gdGhlIG51bWJlciBvZiByb29tcyB0byBiZSByZXR1cm5lZC4gVGhlIGxpbWl0IGNhbiByYW5nZSBiZXR3ZWVuIDEgYW5kIDEwMCwgYW5kIGRlZmF1bHRzIHRvIDIwLlxuICAgKiBAcGFyYW0gcGFyYW1zLnN0YXJ0aW5nQWZ0ZXIgKG9wdGlvbmFsKSBBIGN1cnNvciB1c2VkIGZvciBwYWdpbmF0aW9uLiBZb3UgZ2V0IHRoZSB2YWx1ZSBmcm9tIHRoZSByZXNwb25zZSBvZiB0aGUgcHJldmlvdXMgcGFnZS5cbiAgICogQHBhcmFtIHBhcmFtcy51c2VySWQgKG9wdGlvbmFsKSBBIGZpbHRlciBvbiB1c2VycyBhY2Nlc3Nlcy5cbiAgICogQHBhcmFtIHBhcmFtcy5tZXRhZGF0YSAob3B0aW9uYWwpIEEgZmlsdGVyIG9uIG1ldGFkYXRhLiBNdWx0aXBsZSBtZXRhZGF0YSBrZXlzIGNhbiBiZSB1c2VkIHRvIGZpbHRlciByb29tcy5cbiAgICogQHBhcmFtIHBhcmFtcy5ncm91cElkcyAob3B0aW9uYWwpIEEgZmlsdGVyIG9uIGdyb3VwcyBhY2Nlc3Nlcy4gTXVsdGlwbGUgZ3JvdXBzIGNhbiBiZSB1c2VkLlxuICAgKiBAcGFyYW0gcGFyYW1zLnF1ZXJ5IChvcHRpb25hbCkgQSBxdWVyeSB0byBmaWx0ZXIgcm9vbXMgYnkuIEl0IGlzIGJhc2VkIG9uIG91ciBxdWVyeSBsYW5ndWFnZS4gWW91IGNhbiBmaWx0ZXIgYnkgbWV0YWRhdGEgYW5kIHJvb20gSUQuXG4gICAqIEByZXR1cm5zIEEgbGlzdCBvZiByb29tcy5cbiAgICovXG4gIGFzeW5jIGdldFJvb21zKHBhcmFtcyA9IHt9KSB7XG4gICAgY29uc3QgcGF0aCA9IHVybGAvdjIvcm9vbXNgO1xuICAgIGxldCBxdWVyeTtcbiAgICBpZiAodHlwZW9mIHBhcmFtcy5xdWVyeSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcXVlcnkgPSBwYXJhbXMucXVlcnk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zLnF1ZXJ5ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBxdWVyeSA9IG9iamVjdFRvUXVlcnkocGFyYW1zLnF1ZXJ5KTtcbiAgICB9XG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7XG4gICAgICBsaW1pdDogcGFyYW1zLmxpbWl0LFxuICAgICAgc3RhcnRpbmdBZnRlcjogcGFyYW1zLnN0YXJ0aW5nQWZ0ZXIsXG4gICAgICB1c2VySWQ6IHBhcmFtcy51c2VySWQsXG4gICAgICBncm91cElkczogcGFyYW1zLmdyb3VwSWRzID8gcGFyYW1zLmdyb3VwSWRzLmpvaW4oXCIsXCIpIDogdm9pZCAwLFxuICAgICAgLy8gXCJGbGF0dGVuXCIge21ldGFkYXRhOiB7Zm9vOiBcImJhclwifX0gdG8ge1wibWV0YWRhdGEuZm9vXCI6IFwiYmFyXCJ9XG4gICAgICAuLi5PYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHBhcmFtcy5tZXRhZGF0YSA/PyB7fSkubWFwKChba2V5LCB2YWxdKSA9PiBbXG4gICAgICAgICAgYG1ldGFkYXRhLiR7a2V5fWAsXG4gICAgICAgICAgdmFsXG4gICAgICAgIF0pXG4gICAgICApLFxuICAgICAgcXVlcnlcbiAgICB9O1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHBhdGgsIHF1ZXJ5UGFyYW1zKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICBjb25zdCByb29tcyA9IGRhdGEuZGF0YS5tYXAoKHJvb20pID0+IHtcbiAgICAgIGNvbnN0IGxhc3RDb25uZWN0aW9uQXQgPSByb29tLmxhc3RDb25uZWN0aW9uQXQgPyBuZXcgRGF0ZShyb29tLmxhc3RDb25uZWN0aW9uQXQpIDogdm9pZCAwO1xuICAgICAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUocm9vbS5jcmVhdGVkQXQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucm9vbSxcbiAgICAgICAgY3JlYXRlZEF0LFxuICAgICAgICBsYXN0Q29ubmVjdGlvbkF0XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgZGF0YTogcm9vbXNcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHJvb20gd2l0aCB0aGUgZ2l2ZW4gaWQuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGNyZWF0ZS5cbiAgICogQHBhcmFtIHBhcmFtcy5kZWZhdWx0QWNjZXNzZXMgVGhlIGRlZmF1bHQgYWNjZXNzZXMgZm9yIHRoZSByb29tLlxuICAgKiBAcGFyYW0gcGFyYW1zLmdyb3Vwc0FjY2Vzc2VzIChvcHRpb25hbCkgVGhlIGdyb3VwIGFjY2Vzc2VzIGZvciB0aGUgcm9vbS4gQ2FuIGNvbnRhaW4gYSBtYXhpbXVtIG9mIDEwMCBlbnRyaWVzLiBLZXkgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDQwIGNoYXJhY3RlcnMuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcnNBY2Nlc3NlcyAob3B0aW9uYWwpIFRoZSB1c2VyIGFjY2Vzc2VzIGZvciB0aGUgcm9vbS4gQ2FuIGNvbnRhaW4gYSBtYXhpbXVtIG9mIDEwMCBlbnRyaWVzLiBLZXkgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDQwIGNoYXJhY3RlcnMuXG4gICAqIEBwYXJhbSBwYXJhbXMubWV0YWRhdGEgKG9wdGlvbmFsKSBUaGUgbWV0YWRhdGEgZm9yIHRoZSByb29tLiBTdXBwb3J0cyB1cHRvIGEgbWF4aW11bSBvZiA1MCBlbnRyaWVzLiBLZXkgbGVuZ3RoIGhhcyBhIGxpbWl0IG9mIDQwIGNoYXJhY3RlcnMuIFZhbHVlIGxlbmd0aCBoYXMgYSBsaW1pdCBvZiAyNTYgY2hhcmFjdGVycy5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgcm9vbS5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVJvb20ocm9vbUlkLCBwYXJhbXMpIHtcbiAgICBjb25zdCB7IGRlZmF1bHRBY2Nlc3NlcywgZ3JvdXBzQWNjZXNzZXMsIHVzZXJzQWNjZXNzZXMsIG1ldGFkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KHVybGAvdjIvcm9vbXNgLCB7XG4gICAgICBpZDogcm9vbUlkLFxuICAgICAgZGVmYXVsdEFjY2Vzc2VzLFxuICAgICAgZ3JvdXBzQWNjZXNzZXMsXG4gICAgICB1c2Vyc0FjY2Vzc2VzLFxuICAgICAgbWV0YWRhdGFcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICBjb25zdCBsYXN0Q29ubmVjdGlvbkF0ID0gZGF0YS5sYXN0Q29ubmVjdGlvbkF0ID8gbmV3IERhdGUoZGF0YS5sYXN0Q29ubmVjdGlvbkF0KSA6IHZvaWQgMDtcbiAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBsYXN0Q29ubmVjdGlvbkF0LFxuICAgICAgY3JlYXRlZEF0XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIHJvb20gd2l0aCB0aGUgZ2l2ZW4gaWQuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIHJldHVybi5cbiAgICogQHJldHVybnMgVGhlIHJvb20gd2l0aCB0aGUgZ2l2ZW4gaWQuXG4gICAqL1xuICBhc3luYyBnZXRSb29tKHJvb21JZCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9YCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgY29uc3QgbGFzdENvbm5lY3Rpb25BdCA9IGRhdGEubGFzdENvbm5lY3Rpb25BdCA/IG5ldyBEYXRlKGRhdGEubGFzdENvbm5lY3Rpb25BdCkgOiB2b2lkIDA7XG4gICAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgY3JlYXRlZEF0LFxuICAgICAgbGFzdENvbm5lY3Rpb25BdFxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZXMgc3BlY2lmaWMgcHJvcGVydGllcyBvZiBhIHJvb20uIEl04oCZcyBub3QgbmVjZXNzYXJ5IHRvIHByb3ZpZGUgdGhlIGVudGlyZSByb29t4oCZcyBpbmZvcm1hdGlvbi5cbiAgICogU2V0dGluZyBhIHByb3BlcnR5IHRvIGBudWxsYCBtZWFucyB0byBkZWxldGUgdGhpcyBwcm9wZXJ0eS5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRlZmF1bHRBY2Nlc3NlcyAob3B0aW9uYWwpIFRoZSBkZWZhdWx0IGFjY2Vzc2VzIGZvciB0aGUgcm9vbS5cbiAgICogQHBhcmFtIHBhcmFtcy5ncm91cHNBY2Nlc3NlcyAob3B0aW9uYWwpIFRoZSBncm91cCBhY2Nlc3NlcyBmb3IgdGhlIHJvb20uIENhbiBjb250YWluIGEgbWF4aW11bSBvZiAxMDAgZW50cmllcy4gS2V5IGxlbmd0aCBoYXMgYSBsaW1pdCBvZiA0MCBjaGFyYWN0ZXJzLlxuICAgKiBAcGFyYW0gcGFyYW1zLnVzZXJzQWNjZXNzZXMgKG9wdGlvbmFsKSBUaGUgdXNlciBhY2Nlc3NlcyBmb3IgdGhlIHJvb20uIENhbiBjb250YWluIGEgbWF4aW11bSBvZiAxMDAgZW50cmllcy4gS2V5IGxlbmd0aCBoYXMgYSBsaW1pdCBvZiA0MCBjaGFyYWN0ZXJzLlxuICAgKiBAcGFyYW0gcGFyYW1zLm1ldGFkYXRhIChvcHRpb25hbCkgVGhlIG1ldGFkYXRhIGZvciB0aGUgcm9vbS4gU3VwcG9ydHMgdXB0byBhIG1heGltdW0gb2YgNTAgZW50cmllcy4gS2V5IGxlbmd0aCBoYXMgYSBsaW1pdCBvZiA0MCBjaGFyYWN0ZXJzLiBWYWx1ZSBsZW5ndGggaGFzIGEgbGltaXQgb2YgMjU2IGNoYXJhY3RlcnMuXG4gICAqIEByZXR1cm5zIFRoZSB1cGRhdGVkIHJvb20uXG4gICAqL1xuICBhc3luYyB1cGRhdGVSb29tKHJvb21JZCwgcGFyYW1zKSB7XG4gICAgY29uc3QgeyBkZWZhdWx0QWNjZXNzZXMsIGdyb3Vwc0FjY2Vzc2VzLCB1c2Vyc0FjY2Vzc2VzLCBtZXRhZGF0YSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdCh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfWAsIHtcbiAgICAgIGRlZmF1bHRBY2Nlc3NlcyxcbiAgICAgIGdyb3Vwc0FjY2Vzc2VzLFxuICAgICAgdXNlcnNBY2Nlc3NlcyxcbiAgICAgIG1ldGFkYXRhXG4gICAgfSk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgY29uc3QgbGFzdENvbm5lY3Rpb25BdCA9IGRhdGEubGFzdENvbm5lY3Rpb25BdCA/IG5ldyBEYXRlKGRhdGEubGFzdENvbm5lY3Rpb25BdCkgOiB2b2lkIDA7XG4gICAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgbGFzdENvbm5lY3Rpb25BdCxcbiAgICAgIGNyZWF0ZWRBdFxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYSByb29tIHdpdGggdGhlIGdpdmVuIGlkLiBBIGRlbGV0ZWQgcm9vbSBpcyBubyBsb25nZXIgYWNjZXNzaWJsZSBmcm9tIHRoZSBBUEkgb3IgdGhlIGRhc2hib2FyZCBhbmQgaXQgY2Fubm90IGJlIHJlc3RvcmVkLlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byBkZWxldGUuXG4gICAqL1xuICBhc3luYyBkZWxldGVSb29tKHJvb21JZCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKHVybGAvdjIvcm9vbXMvJHtyb29tSWR9YCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgYSBsaXN0IG9mIHVzZXJzIGN1cnJlbnRseSBwcmVzZW50IGluIHRoZSByZXF1ZXN0ZWQgcm9vbS4gRm9yIGJldHRlciBwZXJmb3JtYW5jZSwgd2UgcmVjb21tYW5kIHRvIGNhbGwgdGhpcyBlbmRwb2ludCBldmVyeSAxMCBzZWNvbmRzIG1heGltdW0uIER1cGxpY2F0ZXMgY2FuIGhhcHBlbiBpZiBhIHVzZXIgaXMgaW4gdGhlIHJlcXVlc3RlZCByb29tIHdpdGggbXVsdGlwbGUgYnJvd3NlciB0YWJzIG9wZW5lZC5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gZ2V0IHRoZSB1c2VycyBmcm9tLlxuICAgKiBAcmV0dXJucyBBIGxpc3Qgb2YgdXNlcnMgY3VycmVudGx5IHByZXNlbnQgaW4gdGhlIHJlcXVlc3RlZCByb29tLlxuICAgKi9cbiAgYXN5bmMgZ2V0QWN0aXZlVXNlcnMocm9vbUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vYWN0aXZlX3VzZXJzYCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHJlcy5qc29uKCk7XG4gIH1cbiAgLyoqXG4gICAqIEJvYWRjYXN0cyBhbiBldmVudCB0byBhIHJvb20gd2l0aG91dCBoYXZpbmcgdG8gY29ubmVjdCB0byBpdCB2aWEgdGhlIGNsaWVudCBmcm9tIEBsaXZlYmxvY2tzL2NsaWVudC4gVGhlIGNvbm5lY3Rpb25JZCBwYXNzZWQgdG8gZXZlbnQgbGlzdGVuZXJzIGlzIC0xIHdoZW4gdXNpbmcgdGhpcyBBUEkuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGJyb2FkY2FzdCB0aGUgZXZlbnQgdG8uXG4gICAqIEBwYXJhbSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGJyb2FkY2FzdC4gSXQgY2FuIGJlIGFueSBKU09OIHNlcmlhbGl6YWJsZSB2YWx1ZS5cbiAgICovXG4gIGFzeW5jIGJyb2FkY2FzdEV2ZW50KHJvb21JZCwgbWVzc2FnZSkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdChcbiAgICAgIHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L2Jyb2FkY2FzdF9ldmVudGAsXG4gICAgICBtZXNzYWdlXG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICBhc3luYyBnZXRTdG9yYWdlRG9jdW1lbnQocm9vbUlkLCBmb3JtYXQgPSBcInBsYWluLWxzb25cIikge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3N0b3JhZ2VgLCB7IGZvcm1hdCB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbiAgfVxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgYSByb29t4oCZcyBTdG9yYWdlLiBUaGUgcm9vbSBtdXN0IGFscmVhZHkgZXhpc3QgYW5kIGhhdmUgYW4gZW1wdHkgU3RvcmFnZS5cbiAgICogQ2FsbGluZyB0aGlzIGVuZHBvaW50IHdpbGwgZGlzY29ubmVjdCBhbGwgdXNlcnMgZnJvbSB0aGUgcm9vbSBpZiB0aGVyZSBhcmUgYW55LlxuICAgKlxuICAgKiBAcGFyYW0gcm9vbUlkIFRoZSBpZCBvZiB0aGUgcm9vbSB0byBpbml0aWFsaXplIHRoZSBzdG9yYWdlIGZyb20uXG4gICAqIEBwYXJhbSBkb2N1bWVudCBUaGUgZG9jdW1lbnQgdG8gaW5pdGlhbGl6ZSB0aGUgc3RvcmFnZSB3aXRoLlxuICAgKiBAcmV0dXJucyBUaGUgaW5pdGlhbGl6ZWQgc3RvcmFnZSBkb2N1bWVudC4gSXQgaXMgb2YgdGhlIHNhbWUgZm9ybWF0IGFzIHRoZSBvbmUgcGFzc2VkIGluLlxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZVN0b3JhZ2VEb2N1bWVudChyb29tSWQsIGRvY3VtZW50KSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3N0b3JhZ2VgLCBkb2N1bWVudCk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHJlcy5qc29uKCk7XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYWxsIG9mIHRoZSByb29t4oCZcyBTdG9yYWdlIGRhdGEgYW5kIGRpc2Nvbm5lY3QgYWxsIHVzZXJzIGZyb20gdGhlIHJvb20gaWYgdGhlcmUgYXJlIGFueS4gTm90ZSB0aGF0IHRoaXMgZG9lcyBub3QgZGVsZXRlIHRoZSBZanMgZG9jdW1lbnQgaW4gdGhlIHJvb20gaWYgb25lIGV4aXN0cy5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gZGVsZXRlIHRoZSBzdG9yYWdlIGZyb20uXG4gICAqL1xuICBhc3luYyBkZWxldGVTdG9yYWdlRG9jdW1lbnQocm9vbUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vc3RvcmFnZWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogWWpzXG4gICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbiAgLyoqXG4gICAqIFJldHVybnMgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSByb29t4oCZcyBZanMgZG9jdW1lbnQuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGdldCB0aGUgWWpzIGRvY3VtZW50IGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMuZm9ybWF0IChvcHRpb25hbCkgSWYgdHJ1ZSwgWVRleHQgd2lsbCByZXR1cm4gZm9ybWF0dGluZy5cbiAgICogQHBhcmFtIHBhcmFtcy5rZXkgKG9wdGlvbmFsKSBJZiBwcm92aWRlZCwgcmV0dXJucyBvbmx5IGEgc2luZ2xlIGtleeKAmXMgdmFsdWUsIGUuZy4gZG9jLmdldChrZXkpLnRvSlNPTigpLlxuICAgKiBAcGFyYW0gcGFyYW1zLnR5cGUgKG9wdGlvbmFsKSBVc2VkIHdpdGgga2V5IHRvIG92ZXJyaWRlIHRoZSBpbmZlcnJlZCB0eXBlLCBpLmUuIFwieW1hcFwiIHdpbGwgcmV0dXJuIGRvYy5nZXQoa2V5LCBZLk1hcCkuXG4gICAqIEByZXR1cm5zIEEgSlNPTiByZXByZXNlbnRhdGlvbiBvZiB0aGUgcm9vbeKAmXMgWWpzIGRvY3VtZW50LlxuICAgKi9cbiAgYXN5bmMgZ2V0WWpzRG9jdW1lbnQocm9vbUlkLCBwYXJhbXMgPSB7fSkge1xuICAgIGNvbnN0IHsgZm9ybWF0LCBrZXksIHR5cGUgfSA9IHBhcmFtcztcbiAgICBjb25zdCBwYXRoID0gdXJsYHYyL3Jvb21zLyR7cm9vbUlkfS95ZG9jYDtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdldChwYXRoLCB7XG4gICAgICBmb3JtYXR0aW5nOiBmb3JtYXQgPyBcInRydWVcIiA6IHZvaWQgMCxcbiAgICAgIGtleSxcbiAgICAgIHR5cGVcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbiAgfVxuICAvKipcbiAgICogU2VuZCBhIFlqcyBiaW5hcnkgdXBkYXRlIHRvIHRoZSByb29t4oCZcyBZanMgZG9jdW1lbnQuIFlvdSBjYW4gdXNlIHRoaXMgZW5kcG9pbnQgdG8gaW5pdGlhbGl6ZSBZanMgZGF0YSBmb3IgdGhlIHJvb20gb3IgdG8gdXBkYXRlIHRoZSByb29t4oCZcyBZanMgZG9jdW1lbnQuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIHNlbmQgdGhlIFlqcyBiaW5hcnkgdXBkYXRlIHRvLlxuICAgKiBAcGFyYW0gdXBkYXRlIFRoZSBZanMgdXBkYXRlIHRvIHNlbmQuIFR5cGljYWxseSB0aGUgcmVzdWx0IG9mIGNhbGxpbmcgYFlqcy5lbmNvZGVTdGF0ZUFzVXBkYXRlKGRvYylgLiBSZWFkIHRoZSBbWWpzIGRvY3VtZW50YXRpb25dKGh0dHBzOi8vZG9jcy55anMuZGV2L2FwaS9kb2N1bWVudC11cGRhdGVzKSB0byBsZWFybiBob3cgdG8gY3JlYXRlIGEgYmluYXJ5IHVwZGF0ZS5cbiAgICogQHBhcmFtIHBhcmFtcy5ndWlkIChvcHRpb25hbCkgSWYgcHJvdmlkZWQsIHRoZSBiaW5hcnkgdXBkYXRlIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgWWpzIHN1YmRvY3VtZW50IHdpdGggdGhlIGdpdmVuIGd1aWQuIElmIG5vdCBwcm92aWRlZCwgdGhlIGJpbmFyeSB1cGRhdGUgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSByb290IFlqcyBkb2N1bWVudC5cbiAgICovXG4gIGFzeW5jIHNlbmRZanNCaW5hcnlVcGRhdGUocm9vbUlkLCB1cGRhdGUsIHBhcmFtcyA9IHt9KSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wdXRCaW5hcnkodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0veWRvY2AsIHVwZGF0ZSwge1xuICAgICAgZ3VpZDogcGFyYW1zLmd1aWRcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcm9vbeKAmXMgWWpzIGRvY3VtZW50IGVuY29kZWQgYXMgYSBzaW5nbGUgYmluYXJ5IHVwZGF0ZS4gVGhpcyBjYW4gYmUgdXNlZCBieSBZLmFwcGx5VXBkYXRlKHJlc3BvbnNlQm9keSkgdG8gZ2V0IGEgY29weSBvZiB0aGUgZG9jdW1lbnQgaW4geW91ciBiYWNrZW5kLlxuICAgKiBTZWUgW1lqcyBkb2N1bWVudGF0aW9uXShodHRwczovL2RvY3MueWpzLmRldi9hcGkvZG9jdW1lbnQtdXBkYXRlcykgZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gd29ya2luZyB3aXRoIHVwZGF0ZXMuXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGdldCB0aGUgWWpzIGRvY3VtZW50IGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMuZ3VpZCAob3B0aW9uYWwpIElmIHByb3ZpZGVkLCByZXR1cm5zIHRoZSBiaW5hcnkgdXBkYXRlIG9mIHRoZSBZanMgc3ViZG9jdW1lbnQgd2l0aCB0aGUgZ2l2ZW4gZ3VpZC4gSWYgbm90IHByb3ZpZGVkLCByZXR1cm5zIHRoZSBiaW5hcnkgdXBkYXRlIG9mIHRoZSByb290IFlqcyBkb2N1bWVudC5cbiAgICogQHJldHVybnMgVGhlIHJvb23igJlzIFlqcyBkb2N1bWVudCBlbmNvZGVkIGFzIGEgc2luZ2xlIGJpbmFyeSB1cGRhdGUuXG4gICAqL1xuICBhc3luYyBnZXRZanNEb2N1bWVudEFzQmluYXJ5VXBkYXRlKHJvb21JZCwgcGFyYW1zID0ge30pIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdldCh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS95ZG9jLWJpbmFyeWAsIHtcbiAgICAgIGd1aWQ6IHBhcmFtcy5ndWlkXG4gICAgfSk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcy5hcnJheUJ1ZmZlcigpO1xuICB9XG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogU2NoZW1hIFZhbGlkYXRpb25cbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBzY2hlbWEgd2hpY2ggY2FuIGJlIHJlZmVyZW5jZWQgbGF0ZXIgdG8gZW5mb3JjZSBhIHJvb23igJlzIFN0b3JhZ2UgZGF0YSBzdHJ1Y3R1cmUuXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gcmVmZXJlbmNlIHRoZSBzY2hlbWEuIE11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nIHdpdGggbGVzcyB0aGFuIDY1IGNoYXJhY3RlcnMgYW5kIG9ubHkgY29udGFpbiBsb3dlcmNhc2UgbGV0dGVycywgbnVtYmVycyBhbmQgZGFzaGVzXG4gICAqIEBwYXJhbSBib2R5IFRoZSBleGFjdCBhbGxvd2VkIHNoYXBlIG9mIGRhdGEgaW4gdGhlIHJvb20uIEl0IGlzIGEgbXVsdGktbGluZSBzdHJpbmcgd3JpdHRlbiBpbiB0aGUgW0xpdmVibG9ja3Mgc2NoZW1hIHN5bnRheF0oaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvcGxhdGZvcm0vc2NoZW1hLXZhbGlkYXRpb24vc3ludGF4KS5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgc2NoZW1hLlxuICAgKi9cbiAgYXN5bmMgY3JlYXRlU2NoZW1hKG5hbWUsIGJvZHkpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QodXJsYC92Mi9zY2hlbWFzYCwge1xuICAgICAgbmFtZSxcbiAgICAgIGJvZHlcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLmNyZWF0ZWRBdCk7XG4gICAgY29uc3QgdXBkYXRlZEF0ID0gbmV3IERhdGUoZGF0YS51cGRhdGVkQXQpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogUmV0dXJucyBhIHNjaGVtYSBieSBpdHMgaWQuXG4gICAqIEBwYXJhbSBzY2hlbWFJZCBJZCBvZiB0aGUgc2NoZW1hIC0gdGhpcyBpcyB0aGUgY29tYmluYXRpb24gb2YgdGhlIHNjaGVtYSBuYW1lIGFuZCB2ZXJzaW9uIG9mIHRoZSBzY2hlbWEgdG8gdXBkYXRlLiBGb3IgZXhhbXBsZSwgYG15LXNjaGVtYUAxYC5cbiAgICogQHJldHVybnMgVGhlIHNjaGVtYSB3aXRoIHRoZSBnaXZlbiBpZC5cbiAgICovXG4gIGFzeW5jIGdldFNjaGVtYShzY2hlbWFJZCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvc2NoZW1hcy8ke3NjaGVtYUlkfWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgICBjb25zdCB1cGRhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLnVwZGF0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkQXRcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBib2R5IGZvciB0aGUgc2NoZW1hLiBBIHNjaGVtYSBjYW4gb25seSBiZSB1cGRhdGVkIGlmIGl0IGlzIG5vdCB1c2VkIGJ5IGFueSByb29tLlxuICAgKiBAcGFyYW0gc2NoZW1hSWQgSWQgb2YgdGhlIHNjaGVtYSAtIHRoaXMgaXMgdGhlIGNvbWJpbmF0aW9uIG9mIHRoZSBzY2hlbWEgbmFtZSBhbmQgdmVyc2lvbiBvZiB0aGUgc2NoZW1hIHRvIHVwZGF0ZS4gRm9yIGV4YW1wbGUsIGBteS1zY2hlbWFAMWAuXG4gICAqIEBwYXJhbSBib2R5IFRoZSBleGFjdCBhbGxvd2VkIHNoYXBlIG9mIGRhdGEgaW4gdGhlIHJvb20uIEl0IGlzIGEgbXVsdGktbGluZSBzdHJpbmcgd3JpdHRlbiBpbiB0aGUgW0xpdmVibG9ja3Mgc2NoZW1hIHN5bnRheF0oaHR0cHM6Ly9saXZlYmxvY2tzLmlvL2RvY3MvcGxhdGZvcm0vc2NoZW1hLXZhbGlkYXRpb24vc3ludGF4KS5cbiAgICogQHJldHVybnMgVGhlIHVwZGF0ZWQgc2NoZW1hLiBUaGUgdmVyc2lvbiBvZiB0aGUgc2NoZW1hIHdpbGwgYmUgaW5jcmVtZW50ZWQuXG4gICAqL1xuICBhc3luYyB1cGRhdGVTY2hlbWEoc2NoZW1hSWQsIGJvZHkpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnB1dCh1cmxgL3YyL3NjaGVtYXMvJHtzY2hlbWFJZH1gLCB7XG4gICAgICBib2R5XG4gICAgfSk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpO1xuICAgIGNvbnN0IHVwZGF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEudXBkYXRlZEF0KTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIGNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdFxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYSBzY2hlbWEgYnkgaXRzIGlkLiBBIHNjaGVtYSBjYW4gb25seSBiZSBkZWxldGVkIGlmIGl0IGlzIG5vdCB1c2VkIGJ5IGFueSByb29tLlxuICAgKiBAcGFyYW0gc2NoZW1hSWQgSWQgb2YgdGhlIHNjaGVtYSAtIHRoaXMgaXMgdGhlIGNvbWJpbmF0aW9uIG9mIHRoZSBzY2hlbWEgbmFtZSBhbmQgdmVyc2lvbiBvZiB0aGUgc2NoZW1hIHRvIHVwZGF0ZS4gRm9yIGV4YW1wbGUsIGBteS1zY2hlbWFAMWAuXG4gICAqL1xuICBhc3luYyBkZWxldGVTY2hlbWEoc2NoZW1hSWQpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmRlbGV0ZSh1cmxgL3YyL3NjaGVtYXMvJHtzY2hlbWFJZH1gKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgc2NoZW1hIGF0dGFjaGVkIHRvIGEgcm9vbS5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gZ2V0IHRoZSBzY2hlbWEgZnJvbS5cbiAgICogQHJldHVybnNcbiAgICovXG4gIGFzeW5jIGdldFNjaGVtYUJ5Um9vbUlkKHJvb21JZCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3NjaGVtYWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KTtcbiAgICBjb25zdCB1cGRhdGVkQXQgPSBuZXcgRGF0ZShkYXRhLnVwZGF0ZWRBdCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBjcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkQXRcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBBdHRhY2hlcyBhIHNjaGVtYSB0byBhIHJvb20sIGFuZCBpbnN0YW50bHkgZW5hYmxlcyBydW50aW1lIHNjaGVtYSB2YWxpZGF0aW9uIGZvciB0aGUgcm9vbS5cbiAgICogSWYgdGhlIGN1cnJlbnQgY29udGVudHMgb2YgdGhlIHJvb23igJlzIFN0b3JhZ2UgZG8gbm90IG1hdGNoIHRoZSBzY2hlbWEsIGF0dGFjaGluZyB3aWxsIGZhaWwgYW5kIHRoZSBlcnJvciBtZXNzYWdlIHdpbGwgZ2l2ZSBkZXRhaWxzIG9uIHdoeSB0aGUgc2NoZW1hIGZhaWxlZCB0byBhdHRhY2guXG4gICAqIEBwYXJhbSByb29tSWQgVGhlIGlkIG9mIHRoZSByb29tIHRvIGF0dGFjaCB0aGUgc2NoZW1hIHRvLlxuICAgKiBAcGFyYW0gc2NoZW1hSWQgSWQgb2YgdGhlIHNjaGVtYSAtIHRoaXMgaXMgdGhlIGNvbWJpbmF0aW9uIG9mIHRoZSBzY2hlbWEgbmFtZSBhbmQgdmVyc2lvbiBvZiB0aGUgc2NoZW1hIHRvIHVwZGF0ZS4gRm9yIGV4YW1wbGUsIGBteS1zY2hlbWFAMWAuXG4gICAqIEByZXR1cm5zIFRoZSBzY2hlbWEgaWQgYXMgSlNPTi5cbiAgICovXG4gIGFzeW5jIGF0dGFjaFNjaGVtYVRvUm9vbShyb29tSWQsIHNjaGVtYUlkKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3NjaGVtYWAsIHtcbiAgICAgIHNjaGVtYTogc2NoZW1hSWRcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbiAgfVxuICAvKipcbiAgICogRGV0YWNoZXMgYSBzY2hlbWEgZnJvbSBhIHJvb20sIGFuZCBkaXNhYmxlcyBydW50aW1lIHNjaGVtYSB2YWxpZGF0aW9uIGZvciB0aGUgcm9vbS5cbiAgICogQHBhcmFtIHJvb21JZCBUaGUgaWQgb2YgdGhlIHJvb20gdG8gZGV0YWNoIHRoZSBzY2hlbWEgZnJvbS5cbiAgICovXG4gIGFzeW5jIGRldGFjaFNjaGVtYUZyb21Sb29tKHJvb21JZCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3NjaGVtYWApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogQ29tbWVudHNcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuICAvKipcbiAgICogR2V0cyBhbGwgdGhlIHRocmVhZHMgaW4gYSByb29tLlxuICAgKlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBnZXQgdGhlIHRocmVhZHMgZnJvbS5cbiAgICogQHBhcmFtIHBhcmFtcy5xdWVyeSBUaGUgcXVlcnkgdG8gZmlsdGVyIHRocmVhZHMgYnkuIEl0IGlzIGJhc2VkIG9uIG91ciBxdWVyeSBsYW5ndWFnZSBhbmQgY2FuIGZpbHRlciBieSBtZXRhZGF0YS5cbiAgICogQHJldHVybnMgQSBsaXN0IG9mIHRocmVhZHMuXG4gICAqL1xuICBhc3luYyBnZXRUaHJlYWRzKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkIH0gPSBwYXJhbXM7XG4gICAgbGV0IHF1ZXJ5O1xuICAgIGlmICh0eXBlb2YgcGFyYW1zLnF1ZXJ5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBxdWVyeSA9IHBhcmFtcy5xdWVyeTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXMucXVlcnkgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHF1ZXJ5ID0gb2JqZWN0VG9RdWVyeShwYXJhbXMucXVlcnkpO1xuICAgIH1cbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdldCh1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzYCwge1xuICAgICAgcXVlcnlcbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGE6IGRhdGEubWFwKCh0aHJlYWQpID0+IGNvbnZlcnRUb1RocmVhZERhdGEodGhyZWFkKSlcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBHZXRzIGEgdGhyZWFkLlxuICAgKlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBnZXQgdGhlIHRocmVhZCBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQuXG4gICAqIEByZXR1cm5zIEEgdGhyZWFkLlxuICAgKi9cbiAgYXN5bmMgZ2V0VGhyZWFkKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3RocmVhZHMvJHt0aHJlYWRJZH1gKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gY29udmVydFRvVGhyZWFkRGF0YShhd2FpdCByZXMuanNvbigpKTtcbiAgfVxuICAvKipcbiAgICogR2V0cyBhIHRocmVhZCdzIHBhcnRpY2lwYW50cy5cbiAgICpcbiAgICogUGFydGljaXBhbnRzIGFyZSB1c2VycyB3aG8gaGF2ZSBjb21tZW50ZWQgb24gdGhlIHRocmVhZFxuICAgKiBvciB1c2VycyBhbmQgZ3JvdXBzIHRoYXQgaGF2ZSBiZWVuIG1lbnRpb25lZCBpbiBhIGNvbW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGdldCB0aGUgdGhyZWFkIHBhcnRpY2lwYW50cyBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gZ2V0IHRoZSBwYXJ0aWNpcGFudHMgZnJvbS5cbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgYW4gYXJyYXkgb2YgcGFydGljaXBhbnQgSURzLlxuICAgKi9cbiAgYXN5bmMgZ2V0VGhyZWFkUGFydGljaXBhbnRzKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9wYXJ0aWNpcGFudHNgXG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbiAgfVxuICAvKipcbiAgICogR2V0cyBhIHRocmVhZCdzIGNvbW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGdldCB0aGUgY29tbWVudCBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gZ2V0IHRoZSBjb21tZW50IGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMuY29tbWVudElkIFRoZSBjb21tZW50IElELlxuICAgKiBAcmV0dXJucyBBIGNvbW1lbnQuXG4gICAqL1xuICBhc3luYyBnZXRDb21tZW50KHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCwgY29tbWVudElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5nZXQoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS90aHJlYWRzLyR7dGhyZWFkSWR9L2NvbW1lbnRzLyR7Y29tbWVudElkfWBcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0VG9Db21tZW50RGF0YShhd2FpdCByZXMuanNvbigpKTtcbiAgfVxuICAvKipcbiAgICogQ3JlYXRlcyBhIGNvbW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGNyZWF0ZSB0aGUgY29tbWVudCBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWRJZCBUaGUgdGhyZWFkIElEIHRvIGNyZWF0ZSB0aGUgY29tbWVudCBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLnVzZXJJZCBUaGUgdXNlciBJRCBvZiB0aGUgdXNlciB3aG8gaXMgc2V0IHRvIGNyZWF0ZSB0aGUgY29tbWVudC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLmNyZWF0ZWRBdCAob3B0aW9uYWwpIFRoZSBkYXRlIHRoZSBjb21tZW50IGlzIHNldCB0byBiZSBjcmVhdGVkLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEuYm9keSBUaGUgYm9keSBvZiB0aGUgY29tbWVudC5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgY29tbWVudC5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZUNvbW1lbnQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkLCBkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9jb21tZW50c2AsXG4gICAgICB7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIGNyZWF0ZWRBdDogZGF0YS5jcmVhdGVkQXQ/LnRvSVNPU3RyaW5nKClcbiAgICAgIH1cbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0VG9Db21tZW50RGF0YShhd2FpdCByZXMuanNvbigpKTtcbiAgfVxuICAvKipcbiAgICogRWRpdHMgYSBjb21tZW50LlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBlZGl0IHRoZSBjb21tZW50IGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gZWRpdCB0aGUgY29tbWVudCBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy5jb21tZW50SWQgVGhlIGNvbW1lbnQgSUQgdG8gZWRpdC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLmJvZHkgVGhlIGJvZHkgb2YgdGhlIGNvbW1lbnQuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS5lZGl0ZWRBdCAob3B0aW9uYWwpIFRoZSBkYXRlIHRoZSBjb21tZW50IHdhcyBlZGl0ZWQuXG4gICAqIEByZXR1cm5zIFRoZSBlZGl0ZWQgY29tbWVudC5cbiAgICovXG4gIGFzeW5jIGVkaXRDb21tZW50KHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCwgY29tbWVudElkLCBkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9jb21tZW50cy8ke2NvbW1lbnRJZH1gLFxuICAgICAge1xuICAgICAgICAuLi5kYXRhLFxuICAgICAgICBlZGl0ZWRBdDogZGF0YS5lZGl0ZWRBdD8udG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb0NvbW1lbnREYXRhKGF3YWl0IHJlcy5qc29uKCkpO1xuICB9XG4gIC8qKlxuICAgKiBEZWxldGVzIGEgY29tbWVudC4gRGVsZXRlcyBhIGNvbW1lbnQuIElmIHRoZXJlIGFyZSBubyByZW1haW5pbmcgY29tbWVudHMgaW4gdGhlIHRocmVhZCwgdGhlIHRocmVhZCBpcyBhbHNvIGRlbGV0ZWQuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGRlbGV0ZSB0aGUgY29tbWVudCBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWRJZCBUaGUgdGhyZWFkIElEIHRvIGRlbGV0ZSB0aGUgY29tbWVudCBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy5jb21tZW50SWQgVGhlIGNvbW1lbnQgSUQgdG8gZGVsZXRlLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQ29tbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgdGhyZWFkSWQsIGNvbW1lbnRJZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9jb21tZW50cy8ke2NvbW1lbnRJZH1gXG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyB0aHJlYWQuIFRoZSB0aHJlYWQgd2lsbCBiZSBjcmVhdGVkIHdpdGggdGhlIHNwZWNpZmllZCBjb21tZW50IGFzIGl0cyBmaXJzdCBjb21tZW50LlxuICAgKiBJZiB0aGUgdGhyZWFkIGFscmVhZHkgZXhpc3RzLCBhIGBMaXZlYmxvY2tzRXJyb3JgIHdpbGwgYmUgdGhyb3duIHdpdGggc3RhdHVzIGNvZGUgNDA5LlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBjcmVhdGUgdGhlIHRocmVhZCBpbi5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWQubWV0YWRhdGEgKG9wdGlvbmFsKSBUaGUgbWV0YWRhdGEgZm9yIHRoZSB0aHJlYWQuIFN1cHBvcnRzIHVwdG8gYSBtYXhpbXVtIG9mIDEwIGVudHJpZXMuIFZhbHVlIG11c3QgYmUgYSBzdHJpbmcsIGJvb2xlYW4gb3IgbnVtYmVyXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkLmNvbW1lbnQudXNlcklkIFRoZSB1c2VyIElEIG9mIHRoZSB1c2VyIHdobyBjcmVhdGVkIHRoZSBjb21tZW50LlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZC5jb21tZW50LmNyZWF0ZWRBdCAob3B0aW9uYWwpIFRoZSBkYXRlIHRoZSBjb21tZW50IHdhcyBjcmVhdGVkLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZC5jb21tZW50LmJvZHkgVGhlIGJvZHkgb2YgdGhlIGNvbW1lbnQuXG4gICAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIHRocmVhZC4gVGhlIHRocmVhZCB3aWxsIGJlIGNyZWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIGNvbW1lbnQgYXMgaXRzIGZpcnN0IGNvbW1lbnQuXG4gICAqL1xuICBhc3luYyBjcmVhdGVUaHJlYWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIGRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QodXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkc2AsIHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBjb21tZW50OiB7XG4gICAgICAgIC4uLmRhdGEuY29tbWVudCxcbiAgICAgICAgY3JlYXRlZEF0OiBkYXRhLmNvbW1lbnQuY3JlYXRlZEF0Py50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb1RocmVhZERhdGEoYXdhaXQgcmVzLmpzb24oKSk7XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYSB0aHJlYWQgYW5kIGFsbCBvZiBpdHMgY29tbWVudHMuXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIGRlbGV0ZSB0aGUgdGhyZWFkIGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gZGVsZXRlLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlVGhyZWFkKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3RocmVhZHMvJHt0aHJlYWRJZH1gKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogTWFyayBhIHRocmVhZCBhcyByZXNvbHZlZC5cbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgb2YgdGhlIHRocmVhZC5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWRJZCBUaGUgdGhyZWFkIElEIHRvIG1hcmsgYXMgcmVzb2x2ZWQuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS51c2VySWQgVGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgd2hvIG1hcmtlZCB0aGUgdGhyZWFkIGFzIHJlc29sdmVkLlxuICAgKiBAcmV0dXJucyBUaGUgdGhyZWFkIG1hcmtlZCBhcyByZXNvbHZlZC5cbiAgICovXG4gIGFzeW5jIG1hcmtUaHJlYWRBc1Jlc29sdmVkKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcm9vbUlkLCB0aHJlYWRJZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdChcbiAgICAgIHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3RocmVhZHMvJHt0aHJlYWRJZH0vbWFyay1hcy1yZXNvbHZlZGAsXG4gICAgICB7fVxuICAgICk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRUb1RocmVhZERhdGEoYXdhaXQgcmVzLmpzb24oKSk7XG4gIH1cbiAgLyoqXG4gICAqIE1hcmsgYSB0aHJlYWQgYXMgdW5yZXNvbHZlZC5cbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgb2YgdGhlIHRocmVhZC5cbiAgICogQHBhcmFtIHBhcmFtcy50aHJlYWRJZCBUaGUgdGhyZWFkIElEIHRvIG1hcmsgYXMgdW5yZXNvbHZlZC5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLnVzZXJJZCBUaGUgdXNlciBJRCBvZiB0aGUgdXNlciB3aG8gbWFya2VkIHRoZSB0aHJlYWQgYXMgdW5yZXNvbHZlZC5cbiAgICogQHJldHVybnMgVGhlIHRocmVhZCBtYXJrZWQgYXMgdW5yZXNvbHZlZC5cbiAgICovXG4gIGFzeW5jIG1hcmtUaHJlYWRBc1VucmVzb2x2ZWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9tYXJrLWFzLXVucmVzb2x2ZWRgLFxuICAgICAge31cbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0VG9UaHJlYWREYXRhKGF3YWl0IHJlcy5qc29uKCkpO1xuICB9XG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBtZXRhZGF0YSBvZiB0aGUgc3BlY2lmaWVkIHRocmVhZCBpbiBhIHJvb20uXG4gICAqIEBwYXJhbSBwYXJhbXMucm9vbUlkIFRoZSByb29tIElEIHRvIHVwZGF0ZSB0aGUgdGhyZWFkIGluLlxuICAgKiBAcGFyYW0gcGFyYW1zLnRocmVhZElkIFRoZSB0aHJlYWQgSUQgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEubWV0YWRhdGEgVGhlIG1ldGFkYXRhIGZvciB0aGUgdGhyZWFkLiBWYWx1ZSBtdXN0IGJlIGEgc3RyaW5nLCBib29sZWFuIG9yIG51bWJlclxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEudXNlcklkIFRoZSB1c2VyIElEIG9mIHRoZSB1c2VyIHdobyB1cGRhdGVkIHRoZSB0aHJlYWQuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS51cGRhdGVkQXQgKG9wdGlvbmFsKSBUaGUgZGF0ZSB0aGUgdGhyZWFkIGlzIHNldCB0byBiZSB1cGRhdGVkLlxuICAgKiBAcmV0dXJucyBUaGUgdXBkYXRlZCB0aHJlYWQgbWV0YWRhdGEuXG4gICAqL1xuICBhc3luYyBlZGl0VGhyZWFkTWV0YWRhdGEocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkLCBkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9tZXRhZGF0YWAsXG4gICAgICB7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIHVwZGF0ZWRBdDogZGF0YS51cGRhdGVkQXQ/LnRvSVNPU3RyaW5nKClcbiAgICAgIH1cbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBBZGRzIGEgbmV3IGNvbW1lbnQgcmVhY3Rpb24gdG8gYSBjb21tZW50LlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBhZGQgdGhlIGNvbW1lbnQgcmVhY3Rpb24gaW4uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byBhZGQgdGhlIGNvbW1lbnQgcmVhY3Rpb24gaW4uXG4gICAqIEBwYXJhbSBwYXJhbXMuY29tbWVudElkIFRoZSBjb21tZW50IElEIHRvIGFkZCB0aGUgcmVhY3Rpb24gaW4uXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS5lbW9qaSBUaGUgKGVtb2ppKSByZWFjdGlvbiB0byBhZGQuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS51c2VySWQgVGhlIHVzZXIgSUQgb2YgdGhlIHVzZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSByZWFjdGlvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhLmNyZWF0ZWRBdCAob3B0aW9uYWwpIFRoZSBkYXRlIHRoZSByZWFjdGlvbiBpcyBzZXQgdG8gYmUgY3JlYXRlZC5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgY29tbWVudCByZWFjdGlvbi5cbiAgICovXG4gIGFzeW5jIGFkZENvbW1lbnRSZWFjdGlvbihwYXJhbXMpIHtcbiAgICBjb25zdCB7IHJvb21JZCwgdGhyZWFkSWQsIGNvbW1lbnRJZCwgZGF0YSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdChcbiAgICAgIHVybGAvdjIvcm9vbXMvJHtyb29tSWR9L3RocmVhZHMvJHt0aHJlYWRJZH0vY29tbWVudHMvJHtjb21tZW50SWR9L2FkZC1yZWFjdGlvbmAsXG4gICAgICB7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIGNyZWF0ZWRBdDogZGF0YS5jcmVhdGVkQXQ/LnRvSVNPU3RyaW5nKClcbiAgICAgIH1cbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIGNvbnN0IHJlYWN0aW9uID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICByZXR1cm4gY29udmVydFRvQ29tbWVudFVzZXJSZWFjdGlvbihyZWFjdGlvbik7XG4gIH1cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSByZWFjdGlvbiBmcm9tIGEgY29tbWVudC5cbiAgICogQHBhcmFtIHBhcmFtcy5yb29tSWQgVGhlIHJvb20gSUQgdG8gcmVtb3ZlIHRoZSBjb21tZW50IHJlYWN0aW9uIGZyb20uXG4gICAqIEBwYXJhbSBwYXJhbXMudGhyZWFkSWQgVGhlIHRocmVhZCBJRCB0byByZW1vdmUgdGhlIGNvbW1lbnQgcmVhY3Rpb24gZnJvbS5cbiAgICogQHBhcmFtIHBhcmFtcy5jb21tZW50SWQgVGhlIGNvbW1lbnQgSUQgdG8gcmVtb3ZlIHRoZSByZWFjdGlvbiBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEuZW1vamkgVGhlIChlbW9qaSkgcmVhY3Rpb24gdG8gcmVtb3ZlLlxuICAgKiBAcGFyYW0gcGFyYW1zLmRhdGEudXNlcklkIFRoZSB1c2VyIElEIG9mIHRoZSB1c2VyIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVhY3Rpb24uXG4gICAqIEBwYXJhbSBwYXJhbXMuZGF0YS5yZW1vdmVkQXQgKG9wdGlvbmFsKSBUaGUgZGF0ZSB0aGUgcmVhY3Rpb24gaXMgc2V0IHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyByZW1vdmVDb21tZW50UmVhY3Rpb24ocGFyYW1zKSB7XG4gICAgY29uc3QgeyByb29tSWQsIHRocmVhZElkLCBkYXRhIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdGhyZWFkcy8ke3RocmVhZElkfS9jb21tZW50cy8ke3BhcmFtcy5jb21tZW50SWR9L3JlbW92ZS1yZWFjdGlvbmAsXG4gICAgICB7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIHJlbW92ZWRBdDogZGF0YS5yZW1vdmVkQXQ/LnRvSVNPU3RyaW5nKClcbiAgICAgIH1cbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbmJveCBub3RpZmljYXRpb25zIGZvciBhIHVzZXIuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcklkIFRoZSB1c2VyIElEIHRvIGdldCB0aGUgaW5ib3ggbm90aWZpY2F0aW9ucyBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLmluYm94Tm90aWZpY2F0aW9uSWQgVGhlIElEIG9mIHRoZSBpbmJveCBub3RpZmljYXRpb24gdG8gZ2V0LlxuICAgKi9cbiAgYXN5bmMgZ2V0SW5ib3hOb3RpZmljYXRpb24ocGFyYW1zKSB7XG4gICAgY29uc3QgeyB1c2VySWQsIGluYm94Tm90aWZpY2F0aW9uSWQgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdldChcbiAgICAgIHVybGAvdjIvdXNlcnMvJHt1c2VySWR9L2luYm94LW5vdGlmaWNhdGlvbnMvJHtpbmJveE5vdGlmaWNhdGlvbklkfWBcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0VG9JbmJveE5vdGlmaWNhdGlvbkRhdGEoXG4gICAgICBhd2FpdCByZXMuanNvbigpXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogR2V0cyB0aGUgdXNlcidzIHJvb20gbm90aWZpY2F0aW9uIHNldHRpbmdzLlxuICAgKiBAcGFyYW0gcGFyYW1zLnVzZXJJZCBUaGUgdXNlciBJRCB0byBnZXQgdGhlIHJvb20gbm90aWZpY2F0aW9ucyBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBnZXQgdGhlIHJvb20gbm90aWZpY2F0aW9uIHNldHRpbmdzIGZyb20uXG4gICAqL1xuICBhc3luYyBnZXRSb29tTm90aWZpY2F0aW9uU2V0dGluZ3MocGFyYW1zKSB7XG4gICAgY29uc3QgeyB1c2VySWQsIHJvb21JZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdXNlcnMvJHt1c2VySWR9L25vdGlmaWNhdGlvbi1zZXR0aW5nc2BcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSB1c2VyJ3Mgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcklkIFRoZSB1c2VyIElEIHRvIHVwZGF0ZSB0aGUgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MgZm9yLlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byB1cGRhdGUgdGhlIHJvb20gbm90aWZpY2F0aW9uIHNldHRpbmdzIGZvci5cbiAgICogQHBhcmFtIHBhcmFtcy5kYXRhIFRoZSBuZXcgcm9vbSBub3RpZmljYXRpb24gc2V0dGluZ3MgZm9yIHRoZSB1c2VyLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlUm9vbU5vdGlmaWNhdGlvblNldHRpbmdzKHBhcmFtcykge1xuICAgIGNvbnN0IHsgdXNlcklkLCByb29tSWQsIGRhdGEgfSA9IHBhcmFtcztcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnBvc3QoXG4gICAgICB1cmxgL3YyL3Jvb21zLyR7cm9vbUlkfS91c2Vycy8ke3VzZXJJZH0vbm90aWZpY2F0aW9uLXNldHRpbmdzYCxcbiAgICAgIGRhdGFcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xuICB9XG4gIC8qKlxuICAgKiBEZWxldGUgdGhlIHVzZXIncyByb29tIG5vdGlmaWNhdGlvbiBzZXR0aW5ncy5cbiAgICogQHBhcmFtIHBhcmFtcy51c2VySWQgVGhlIHVzZXIgSUQgdG8gZGVsZXRlIHRoZSByb29tIG5vdGlmaWNhdGlvbiBzZXR0aW5ncyBmcm9tLlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgcm9vbSBJRCB0byBkZWxldGUgdGhlIHJvb20gbm90aWZpY2F0aW9uIHNldHRpbmdzIGZyb20uXG4gICAqL1xuICBhc3luYyBkZWxldGVSb29tTm90aWZpY2F0aW9uU2V0dGluZ3MocGFyYW1zKSB7XG4gICAgY29uc3QgeyB1c2VySWQsIHJvb21JZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKFxuICAgICAgdXJsYC92Mi9yb29tcy8ke3Jvb21JZH0vdXNlcnMvJHt1c2VySWR9L25vdGlmaWNhdGlvbi1zZXR0aW5nc2BcbiAgICApO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBMaXZlYmxvY2tzRXJyb3IocmVzLnN0YXR1cywgdGV4dCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBVcGRhdGUgYSByb29tIElELlxuICAgKiBAcGFyYW0gcGFyYW1zLnJvb21JZCBUaGUgY3VycmVudCBJRCBvZiB0aGUgcm9vbS5cbiAgICogQHBhcmFtIHBhcmFtcy5uZXdSb29tSWQgVGhlIG5ldyByb29tIElELlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlUm9vbUlkKHBhcmFtcykge1xuICAgIGNvbnN0IHsgY3VycmVudFJvb21JZCwgbmV3Um9vbUlkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgdXJsYC92Mi9yb29tcy8ke2N1cnJlbnRSb29tSWR9L3VwZGF0ZS1yb29tLWlkYCxcbiAgICAgIHtcbiAgICAgICAgbmV3Um9vbUlkXG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoZGF0YS5jcmVhdGVkQXQpLFxuICAgICAgbGFzdENvbm5lY3Rpb25BdDogZGF0YS5sYXN0Q29ubmVjdGlvbkF0ID8gbmV3IERhdGUoZGF0YS5sYXN0Q29ubmVjdGlvbkF0KSA6IHZvaWQgMFxuICAgIH07XG4gIH1cbiAgYXN5bmMgdHJpZ2dlckluYm94Tm90aWZpY2F0aW9uKHBhcmFtcykge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucG9zdCh1cmxgL3YyL2luYm94LW5vdGlmaWNhdGlvbnMvdHJpZ2dlcmAsIHBhcmFtcyk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IExpdmVibG9ja3NFcnJvcihyZXMuc3RhdHVzLCB0ZXh0KTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIERlbGV0ZXMgYW4gaW5ib3ggbm90aWZpY2F0aW9uIGZvciBhIHVzZXIuXG4gICAqIEBwYXJhbSBwYXJhbXMudXNlcklkIFRoZSB1c2VyIElEIGZvciB3aGljaCB0byBkZWxldGUgdGhlIGluYm94IG5vdGlmaWNhdGlvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5pbmJveE5vdGlmaWNhdGlvbklkIFRoZSBJRCBvZiB0aGUgaW5ib3ggbm90aWZpY2F0aW9uIHRvIGRlbGV0ZS5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZUluYm94Tm90aWZpY2F0aW9uKHBhcmFtcykge1xuICAgIGNvbnN0IHsgdXNlcklkLCBpbmJveE5vdGlmaWNhdGlvbklkIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5kZWxldGUoXG4gICAgICB1cmxgL3YyL3VzZXJzLyR7dXNlcklkfS9pbmJveC1ub3RpZmljYXRpb25zLyR7aW5ib3hOb3RpZmljYXRpb25JZH1gXG4gICAgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogRGVsZXRlcyBhbGwgaW5ib3ggbm90aWZpY2F0aW9ucyBmb3IgYSB1c2VyLlxuICAgKiBAcGFyYW0gcGFyYW1zLnVzZXJJZCBUaGUgdXNlciBJRCBmb3Igd2hpY2ggdG8gZGVsZXRlIGFsbCB0aGUgaW5ib3ggbm90aWZpY2F0aW9ucy5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZUFsbEluYm94Tm90aWZpY2F0aW9ucyhwYXJhbXMpIHtcbiAgICBjb25zdCB7IHVzZXJJZCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZGVsZXRlKHVybGAvdjIvdXNlcnMvJHt1c2VySWR9L2luYm94LW5vdGlmaWNhdGlvbnNgKTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgTGl2ZWJsb2Nrc0Vycm9yKHJlcy5zdGF0dXMsIHRleHQpO1xuICAgIH1cbiAgfVxufTtcbnZhciBMaXZlYmxvY2tzRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3Ioc3RhdHVzLCBtZXNzYWdlID0gXCJcIikge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9IFwiTGl2ZWJsb2Nrc0Vycm9yXCI7XG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gIH1cbn07XG5cbi8vIHNyYy93ZWJob29rcy50c1xuaW1wb3J0ICogYXMgYmFzZTY0IGZyb20gXCJAc3RhYmxlbGliL2Jhc2U2NFwiO1xuaW1wb3J0ICogYXMgc2hhMjU2IGZyb20gXCJmYXN0LXNoYTI1NlwiO1xudmFyIF9XZWJob29rSGFuZGxlciA9IGNsYXNzIF9XZWJob29rSGFuZGxlciB7XG4gIGNvbnN0cnVjdG9yKHNlY3JldCkge1xuICAgIGlmICghc2VjcmV0KSB0aHJvdyBuZXcgRXJyb3IoXCJTZWNyZXQgaXMgcmVxdWlyZWRcIik7XG4gICAgaWYgKHR5cGVvZiBzZWNyZXQgIT09IFwic3RyaW5nXCIpIHRocm93IG5ldyBFcnJvcihcIlNlY3JldCBtdXN0IGJlIGEgc3RyaW5nXCIpO1xuICAgIGlmIChzZWNyZXQuc3RhcnRzV2l0aChfV2ViaG9va0hhbmRsZXIuc2VjcmV0UHJlZml4KSA9PT0gZmFsc2UpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHNlY3JldCwgbXVzdCBzdGFydCB3aXRoIHdoc2VjX1wiKTtcbiAgICBjb25zdCBzZWNyZXRLZXkgPSBzZWNyZXQuc2xpY2UoX1dlYmhvb2tIYW5kbGVyLnNlY3JldFByZWZpeC5sZW5ndGgpO1xuICAgIHRoaXMuc2VjcmV0QnVmZmVyID0gQnVmZmVyLmZyb20oc2VjcmV0S2V5LCBcImJhc2U2NFwiKTtcbiAgfVxuICAvKipcbiAgICogVmVyaWZpZXMgYSB3ZWJob29rIHJlcXVlc3QgYW5kIHJldHVybnMgdGhlIGV2ZW50XG4gICAqL1xuICB2ZXJpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICBjb25zdCB7IGhlYWRlcnMsIHJhd0JvZHkgfSA9IHJlcXVlc3Q7XG4gICAgY29uc3QgeyB3ZWJob29rSWQsIHRpbWVzdGFtcCwgcmF3U2lnbmF0dXJlcyB9ID0gdGhpcy52ZXJpZnlIZWFkZXJzKGhlYWRlcnMpO1xuICAgIGlmICh0eXBlb2YgcmF3Qm9keSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW52YWxpZCByYXdCb2R5IGZpZWxkLCBtdXN0IGJlIGEgc3RyaW5nLCBnb3QgXCIke3R5cGVvZiByYXdCb2R5fVwiIGluc3RlYWQuIEl0IGlzIGxpa2VseSB0aGF0IHlvdSBuZWVkIHRvIEpTT04uc3RyaW5naWZ5IHRoZSBib2R5IGJlZm9yZSBwYXNzaW5nIGl0LmBcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMudmVyaWZ5VGltZXN0YW1wKHRpbWVzdGFtcCk7XG4gICAgY29uc3Qgc2lnbmF0dXJlID0gdGhpcy5zaWduKGAke3dlYmhvb2tJZH0uJHt0aW1lc3RhbXB9LiR7cmF3Qm9keX1gKTtcbiAgICBjb25zdCBleHBlY3RlZFNpZ25hdHVyZXMgPSByYXdTaWduYXR1cmVzLnNwbGl0KFwiIFwiKS5tYXAoKHJhd1NpZ25hdHVyZSkgPT4ge1xuICAgICAgY29uc3QgWywgcGFyc2VkU2lnbmF0dXJlXSA9IHJhd1NpZ25hdHVyZS5zcGxpdChcIixcIik7XG4gICAgICByZXR1cm4gcGFyc2VkU2lnbmF0dXJlO1xuICAgIH0pLmZpbHRlcihpc05vdFVuZGVmaW5lZCk7XG4gICAgaWYgKGV4cGVjdGVkU2lnbmF0dXJlcy5pbmNsdWRlcyhzaWduYXR1cmUpID09PSBmYWxzZSlcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEludmFsaWQgc2lnbmF0dXJlLCBleHBlY3RlZCBvbmUgb2YgJHtleHBlY3RlZFNpZ25hdHVyZXMuam9pbihcbiAgICAgICAgICBcIiwgXCJcbiAgICAgICAgKX0sIGdvdCAke3NpZ25hdHVyZX1gXG4gICAgICApO1xuICAgIGNvbnN0IGV2ZW50ID0gSlNPTi5wYXJzZShyYXdCb2R5KTtcbiAgICB0aGlzLnZlcmlmeVdlYmhvb2tFdmVudFR5cGUoZXZlbnQpO1xuICAgIHJldHVybiBldmVudDtcbiAgfVxuICAvKipcbiAgICogVmVyaWZpZXMgdGhlIGhlYWRlcnMgYW5kIHJldHVybnMgdGhlIHdlYmhvb2tJZCwgdGltZXN0YW1wIGFuZCByYXdTaWduYXR1cmVzXG4gICAqL1xuICB2ZXJpZnlIZWFkZXJzKGhlYWRlcnMpIHtcbiAgICBjb25zdCB1c2luZ05hdGl2ZUhlYWRlcnMgPSB0eXBlb2YgSGVhZGVycyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBoZWFkZXJzIGluc3RhbmNlb2YgSGVhZGVycztcbiAgICBjb25zdCBub3JtYWxpemVkSGVhZGVycyA9IHVzaW5nTmF0aXZlSGVhZGVycyA/IE9iamVjdC5mcm9tRW50cmllcyhoZWFkZXJzKSA6IGhlYWRlcnM7XG4gICAgY29uc3Qgc2FuaXRpemVkSGVhZGVycyA9IHt9O1xuICAgIE9iamVjdC5rZXlzKG5vcm1hbGl6ZWRIZWFkZXJzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIHNhbml0aXplZEhlYWRlcnNba2V5LnRvTG93ZXJDYXNlKCldID0gbm9ybWFsaXplZEhlYWRlcnNba2V5XTtcbiAgICB9KTtcbiAgICBjb25zdCB3ZWJob29rSWQgPSBzYW5pdGl6ZWRIZWFkZXJzW1wid2ViaG9vay1pZFwiXTtcbiAgICBpZiAodHlwZW9mIHdlYmhvb2tJZCAhPT0gXCJzdHJpbmdcIilcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgd2ViaG9vay1pZCBoZWFkZXJcIik7XG4gICAgY29uc3QgdGltZXN0YW1wID0gc2FuaXRpemVkSGVhZGVyc1tcIndlYmhvb2stdGltZXN0YW1wXCJdO1xuICAgIGlmICh0eXBlb2YgdGltZXN0YW1wICE9PSBcInN0cmluZ1wiKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB3ZWJob29rLXRpbWVzdGFtcCBoZWFkZXJcIik7XG4gICAgY29uc3QgcmF3U2lnbmF0dXJlcyA9IHNhbml0aXplZEhlYWRlcnNbXCJ3ZWJob29rLXNpZ25hdHVyZVwiXTtcbiAgICBpZiAodHlwZW9mIHJhd1NpZ25hdHVyZXMgIT09IFwic3RyaW5nXCIpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHdlYmhvb2stc2lnbmF0dXJlIGhlYWRlclwiKTtcbiAgICByZXR1cm4geyB3ZWJob29rSWQsIHRpbWVzdGFtcCwgcmF3U2lnbmF0dXJlcyB9O1xuICB9XG4gIC8qKlxuICAgKiBTaWducyB0aGUgY29udGVudCB3aXRoIHRoZSBzZWNyZXRcbiAgICogQHBhcmFtIGNvbnRlbnRcbiAgICogQHJldHVybnMgYHN0cmluZ2BcbiAgICovXG4gIHNpZ24oY29udGVudCkge1xuICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcbiAgICBjb25zdCB0b1NpZ24gPSBlbmNvZGVyLmVuY29kZShjb250ZW50KTtcbiAgICByZXR1cm4gYmFzZTY0LmVuY29kZShzaGEyNTYuaG1hYyh0aGlzLnNlY3JldEJ1ZmZlciwgdG9TaWduKSk7XG4gIH1cbiAgLyoqXG4gICAqIFZlcmlmaWVzIHRoYXQgdGhlIHRpbWVzdGFtcCBpcyBub3QgdG9vIG9sZCBvciBpbiB0aGUgZnV0dXJlXG4gICAqL1xuICB2ZXJpZnlUaW1lc3RhbXAodGltZXN0YW1wSGVhZGVyKSB7XG4gICAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMWUzKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBwYXJzZUludCh0aW1lc3RhbXBIZWFkZXIsIDEwKTtcbiAgICBpZiAoaXNOYU4odGltZXN0YW1wKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB0aW1lc3RhbXBcIik7XG4gICAgfVxuICAgIGlmICh0aW1lc3RhbXAgPCBub3cgLSBXRUJIT09LX1RPTEVSQU5DRV9JTl9TRUNPTkRTKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaW1lc3RhbXAgdG9vIG9sZFwiKTtcbiAgICB9XG4gICAgaWYgKHRpbWVzdGFtcCA+IG5vdyArIFdFQkhPT0tfVE9MRVJBTkNFX0lOX1NFQ09ORFMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRpbWVzdGFtcCBpbiB0aGUgZnV0dXJlXCIpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogRW5zdXJlcyB0aGF0IHRoZSBldmVudCBpcyBhIGtub3duIGV2ZW50IHR5cGVcbiAgICogb3IgdGhyb3dzIGFuZCBwcm9tcHRzIHRoZSB1c2VyIHRvIHVwZ3JhZGUgdG8gYSBoaWdoZXIgdmVyc2lvbiBvZiBAbGl2ZWJsb2Nrcy9ub2RlXG4gICAqL1xuICB2ZXJpZnlXZWJob29rRXZlbnRUeXBlKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUgJiYgW1xuICAgICAgXCJzdG9yYWdlVXBkYXRlZFwiLFxuICAgICAgXCJ1c2VyRW50ZXJlZFwiLFxuICAgICAgXCJ1c2VyTGVmdFwiLFxuICAgICAgXCJyb29tQ3JlYXRlZFwiLFxuICAgICAgXCJyb29tRGVsZXRlZFwiLFxuICAgICAgXCJjb21tZW50Q3JlYXRlZFwiLFxuICAgICAgXCJjb21tZW50RWRpdGVkXCIsXG4gICAgICBcImNvbW1lbnREZWxldGVkXCIsXG4gICAgICBcImNvbW1lbnRSZWFjdGlvbkFkZGVkXCIsXG4gICAgICBcImNvbW1lbnRSZWFjdGlvblJlbW92ZWRcIixcbiAgICAgIFwidGhyZWFkTWV0YWRhdGFVcGRhdGVkXCIsXG4gICAgICBcInRocmVhZENyZWF0ZWRcIixcbiAgICAgIFwidGhyZWFkRGVsZXRlZFwiLFxuICAgICAgXCJ5ZG9jVXBkYXRlZFwiLFxuICAgICAgXCJub3RpZmljYXRpb25cIixcbiAgICAgIFwidGhyZWFkTWFya2VkQXNSZXNvbHZlZFwiLFxuICAgICAgXCJ0aHJlYWRNYXJrZWRBc1VucmVzb2x2ZWRcIlxuICAgIF0uaW5jbHVkZXMoZXZlbnQudHlwZSkpIHtcbiAgICAgIGlmIChldmVudC50eXBlID09PSBcIm5vdGlmaWNhdGlvblwiKSB7XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGV2ZW50O1xuICAgICAgICBpZiAobm90aWZpY2F0aW9uLmRhdGEua2luZCA9PT0gXCJ0aHJlYWRcIiB8fCBub3RpZmljYXRpb24uZGF0YS5raW5kID09PSBcInRleHRNZW50aW9uXCIgfHwgbm90aWZpY2F0aW9uLmRhdGEua2luZC5zdGFydHNXaXRoKFwiJFwiKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgVW5rbm93biBub3RpZmljYXRpb24ga2luZDogJHtub3RpZmljYXRpb24uZGF0YS5raW5kfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiVW5rbm93biBldmVudCB0eXBlLCBwbGVhc2UgdXBncmFkZSB0byBhIGhpZ2hlciB2ZXJzaW9uIG9mIEBsaXZlYmxvY2tzL25vZGVcIlxuICAgICk7XG4gIH1cbn07XG5fV2ViaG9va0hhbmRsZXIuc2VjcmV0UHJlZml4ID0gXCJ3aHNlY19cIjtcbnZhciBXZWJob29rSGFuZGxlciA9IF9XZWJob29rSGFuZGxlcjtcbnZhciBXRUJIT09LX1RPTEVSQU5DRV9JTl9TRUNPTkRTID0gNSAqIDYwO1xudmFyIGlzTm90VW5kZWZpbmVkID0gKHZhbHVlKSA9PiB2YWx1ZSAhPT0gdm9pZCAwO1xuXG4vLyBzcmMvaW5kZXgudHNcbmltcG9ydCB7XG4gIGdldE1lbnRpb25lZElkc0Zyb21Db21tZW50Qm9keSxcbiAgc3RyaW5naWZ5Q29tbWVudEJvZHlcbn0gZnJvbSBcIkBsaXZlYmxvY2tzL2NvcmVcIjtcbmRldGVjdER1cGVzKFBLR19OQU1FLCBQS0dfVkVSU0lPTiwgUEtHX0ZPUk1BVCk7XG5leHBvcnQge1xuICBMaXZlYmxvY2tzLFxuICBMaXZlYmxvY2tzRXJyb3IsXG4gIFdlYmhvb2tIYW5kbGVyLFxuICBnZXRNZW50aW9uZWRJZHNGcm9tQ29tbWVudEJvZHksXG4gIHN0cmluZ2lmeUNvbW1lbnRCb2R5XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@liveblocks/node/dist/index.mjs\n");

/***/ })

};
;
#!/usr/bin/env ts-node

import yargs from 'yargs';
import { hideBin } from 'yargs/helpers';
import fs from 'fs-extra';
import path from 'path';

// Define the expected arguments type
interface Argv {
  _: (string | number)[];
  $0: string;
  componentPath?: string;
  stylesPath?: string;
  assetsPath?: string; // Define assetsPath option
}

// Use the Argv type for argv
const argv = yargs(hideBin(process.argv))
  .command('add editor', 'Add editor component and styles', (yargs) => {
    return yargs
      .option('componentPath', {
        alias: 'c',
        type: 'string',
        description: 'Path to add the component',
        default: 'src/components/editor',
      })
      .option('stylesPath', {
        alias: 's',
        type: 'string',
        description: 'Path to add the styles',
        default: 'src/styles',
      })
      .option('assetsPath', {
        alias: 'a',
        type: 'string',
        description: 'Path to add the assets',
        default: 'src/assets',
      });
  })
  .help()
  .alias('help', 'h').argv as Argv;

const defaultComponentPath = 'src/components/editor';
const defaultStylesPath = 'src/styles';
const defaultAssetsPath = 'src/assets';

if (argv._.includes('add')) {
  const componentDestPath = argv.componentPath || defaultComponentPath;
  const stylesDestPath = argv.stylesPath || defaultStylesPath;
  const assetsDestPath = argv.assetsPath || defaultAssetsPath;

  const filesToCopy = [
    {
      src: 'components/editor/Editor.tsx',
      dest: path.join(componentDestPath, 'Editor.tsx'),
    },
    {
      src: 'components/editor/plugins/Theme.ts',
      dest: path.join(componentDestPath, 'plugins', 'Theme.ts'),
    },
    {
      src: 'components/editor/plugins/ToolbarPlugin.tsx',
      dest: path.join(componentDestPath, 'plugins', 'ToolbarPlugin.tsx'),
    },
  ];

  // Copy both light and dark theme style files to the styles folder
  const lightThemeSrc = path.join(__dirname, 'styles', 'light-theme.css');
  const darkThemeSrc = path.join(__dirname, 'styles', 'dark-theme.css');
  fs.copySync(
    lightThemeSrc,
    path.join(process.cwd(), stylesDestPath, 'light-theme.css'),
  );
  fs.copySync(
    darkThemeSrc,
    path.join(process.cwd(), stylesDestPath, 'dark-theme.css'),
  );

  // Copy the editor components and styles
  filesToCopy.forEach((file) => {
    fs.copySync(path.join(__dirname, file.src), file.dest);
  });

  // Copy all files in the assets folder to the specified assets destination path
  const assetsSrcPath = path.join(__dirname, 'assets');
  fs.copySync(assetsSrcPath, path.join(process.cwd(), assetsDestPath));

  console.log(`Editor components added to ${componentDestPath}`);
  console.log(`Editor styles added to ${stylesDestPath} `);
  console.log(`Assets copied to ${assetsDestPath}`);
}
